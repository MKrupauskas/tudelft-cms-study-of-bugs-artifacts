[{"issue_id":"10975","title":"Cloud provisioner VMware testing","url":"https://tickets.puppetlabs.com/browse/PUP-29","created_at":"2013-06-17T17:50:53.000-0700","number":"PUP-29","body":null,"closed_at":"2013-06-17T18:00:26.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-29","labels":"","state":"Closed","updated_at":"2013-06-17T18:00:26.000-0700","timestamp":1652284625.082721,"priority":"Major","status_category":"Done","pull_request":7555},{"issue_id":"11318","title":"Missing files are always treated as changed","url":"https://tickets.puppetlabs.com/browse/PUP-66","created_at":"2013-06-24T18:49:23.000-0700","number":"PUP-66","body":"The implementation of `Puppet::Util::LoadedFile` tracks a file by monitoring the file ctime. If a file is nonexistent and cannot have a ctime, every time the file is checked for changes ctime will be set to the current time. Since this value is constantly changing the file will always be marked as changed.\n\n### Expected behavior\n\nIf a file is initially absent and is still absent when rechecked, it should be unchanged.\n\n### Actual behavior\n\nA file that is absent will be marked as always changed.\n\n- - -\n\n\nNote: as of commit [3a19fff](https://github.com/puppetlabs/puppet/commit/3a19fff) the LoadedFile has been refactored and renamed WatchedFile but this behavior is still present.","closed_at":"2013-07-10T14:20:42.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-66","labels":"redmine","state":"Closed","updated_at":"2013-07-10T14:20:42.000-0700","timestamp":1652284626.324762,"priority":"Major","status_category":"Done","pull_request":7802},{"issue_id":"12274","title":"Schedule resources no longer showing as skipped","url":"https://tickets.puppetlabs.com/browse/PUP-187","created_at":"2013-07-19T14:27:59.000-0700","number":"PUP-187","body":null,"closed_at":"2013-08-01T10:49:17.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-187","labels":"regression","state":"Closed","updated_at":"2013-08-01T10:49:17.000-0700","timestamp":1652284627.682317,"priority":"Major","status_category":"Done","pull_request":2415},{"issue_id":"11361","title":"Puppet 2.7 specs are failing on 1.8.5, but marked as success","url":"https://tickets.puppetlabs.com/browse/PUP-82","created_at":"2013-06-24T22:52:39.000-0700","number":"PUP-82","body":null,"closed_at":"2013-09-03T09:07:33.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-82","labels":"code-orange-deferred","state":"Closed","updated_at":"2013-09-03T09:07:33.000-0700","timestamp":1652284629.347882,"priority":"Major","status_category":"Done","pull_request":8800},{"issue_id":"11335","title":"Security fix using safe_yaml caused a drastic performance hit in 2.7.22","url":"https://tickets.puppetlabs.com/browse/PUP-68","created_at":"2013-06-24T21:35:05.000-0700","number":"PUP-68","body":null,"closed_at":"2013-09-03T09:15:04.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-68","labels":"","state":"Closed","updated_at":"2013-09-03T09:15:04.000-0700","timestamp":1652284629.55399,"priority":"Major","status_category":"Done","pull_request":8701},{"issue_id":"13764","title":"Publish reboot module under puppetlabs namespace","url":"https://tickets.puppetlabs.com/browse/PUP-270","created_at":"2013-08-28T11:42:58.000-0700","number":"PUP-270","body":"The reboot module currently lives in https://github.com/joshcooper/puppetlabs-reboot. We need create a puppetlabs fork, remove the `prompt` parameter, and publish to the forge.","closed_at":"2013-09-18T23:46:51.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-270","labels":"windows","state":"Closed","updated_at":"2013-09-18T23:46:51.000-0700","timestamp":1652284632.45064,"priority":"Major","status_category":"Done","pull_request":3225},{"issue_id":"14960","title":"Older agents can't backup files to 3.3.0 masters","url":"https://tickets.puppetlabs.com/browse/PUP-402","created_at":"2013-09-19T10:24:00.000-0700","number":"PUP-402","body":null,"closed_at":"2013-09-20T13:52:35.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-402","labels":"","state":"Resolved","updated_at":"2013-09-20T13:52:35.000-0700","timestamp":1652284632.867777,"priority":"Normal","status_category":"Done","pull_request":3624},{"issue_id":"11662","title":"Customer Support: Facter issues on facter lib path on AIX","url":"https://tickets.puppetlabs.com/browse/PUP-145","created_at":"2013-07-02T23:37:39.000-0700","number":"PUP-145","body":"This is a support escalation. See http://projects.puppetlabs.com/issues/21577 for more information. \n\nThis came in from Alex Dryer on Support Goalie.","closed_at":"2013-09-30T12:34:16.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-145","labels":"","state":"Closed","updated_at":"2013-09-30T12:34:16.000-0700","timestamp":1652284634.947766,"priority":"Major","status_category":"Done","pull_request":4174},{"issue_id":"11952","title":"Generate and use UUID for catalog generation and retrieval","url":"https://tickets.puppetlabs.com/browse/PUP-153","created_at":"2013-07-10T14:26:40.000-0700","number":"PUP-153","body":"In PE-943, [~chris] describes generating using a UUID to help puppetdb (and therefore burgundy) link between the catalog and report. This is a generalized capability that we roadmapped and need in the Puppet ecosystem, so we should work on a generalized implementation rather than having two different things.","closed_at":"2013-09-30T12:34:17.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-153","labels":"","state":"Resolved","updated_at":"2013-09-30T12:34:17.000-0700","timestamp":1652284635.053294,"priority":"Major","status_category":"Done","pull_request":7815},{"issue_id":"13723","title":"Puppet::Settings misusing WatchedFile, causing Daemon to abort if reparsing configs.","url":"https://tickets.puppetlabs.com/browse/PUP-269","created_at":"2013-08-27T17:24:12.000-0700","number":"PUP-269","body":"See redmine issue for details.","closed_at":"2013-09-30T12:34:18.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-269","labels":"","state":"Resolved","updated_at":"2013-09-30T12:34:18.000-0700","timestamp":1652284635.609875,"priority":"Major","status_category":"Done","pull_request":3498},{"issue_id":"11360","title":"Fix bad face action regex","url":"https://tickets.puppetlabs.com/browse/PUP-81","created_at":"2013-06-24T22:50:37.000-0700","number":"PUP-81","body":"In lib/puppet/interface/action.rb, we try to validate the action name:\n\n<pre>\n    raise \"#{name.inspect} is an invalid action name\" unless name.to_s =~ /^[a-z]\\w*$/\n</pre>\n\nHowever, this doesn't protect against multiline matches. Then we define a method using the name:\n\n<pre>\n    file    = __FILE__ + \"+eval[wrapper]\"\n    line    = __LINE__ + 2 # &lt;== points to the same line as 'def' in the wrapper.\n    wrapper = &lt;&lt;WRAPPER\ndef #{@name}(#{decl.join(\", \")})\n</pre>\n\nAnd then we `eval` that:\n\n<pre>\n      @face.class_eval do eval wrapper, nil, file, line end\n      # or\n      @face.instance_eval do eval wrapper, nil, file, line end\n</pre>\n\nAt a minimum, we should be applying a regexp of `/\\A[a-z]\\w*\\Z/`. We should also not be using `eval` to define a method. \n","closed_at":"2013-10-22T14:53:54.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-81","labels":"code-orange-deferred","state":"Closed","updated_at":"2013-10-22T14:53:54.000-0700","timestamp":1652284651.905405,"priority":"Major","status_category":"Done","pull_request":8498},{"issue_id":"16835","title":"Rewrite html renderer for rdoc on ruby 1.9","url":"https://tickets.puppetlabs.com/browse/PUP-569","created_at":"2013-10-16T13:06:42.000-0700","number":"PUP-569","body":"We use a subclass of the built-in rdoc renderer from rdoc 1. This renderer was completely rewritten and doesn't exist in current rdoc. If we want to keep our rendering customization, we'll have to rewrite this. I think it can be much simpler than the previous version and still be good enough.","closed_at":"2013-11-11T16:02:09.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-569","labels":"redmine","state":"Closed","updated_at":"2013-11-11T16:02:09.000-0800","timestamp":1652284652.757498,"priority":"Normal","status_category":"Done","pull_request":4583},{"issue_id":"14457","title":"Puppet does not manage :vardir owner group","url":"https://tickets.puppetlabs.com/browse/PUP-319","created_at":"2013-09-11T13:52:29.000-0700","number":"PUP-319","body":null,"closed_at":"2013-11-11T16:40:01.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-319","labels":"","state":"Closed","updated_at":"2013-11-11T16:40:01.000-0800","timestamp":1652284652.867358,"priority":"Normal","status_category":"Done","pull_request":3058},{"issue_id":"18972","title":"Package resource documentation for ensure doesn't specify default value","url":"https://tickets.puppetlabs.com/browse/PUP-763","created_at":"2013-11-15T08:28:58.000-0800","number":"PUP-763","body":"(from a customer) \r\n\r\nI've noticed a weird situation in using the `package` resource.\r\nAs stated in http://docs.puppetlabs.com/references/latest/type.html#package-attribute-ensure, the \"ensure\" attribute can have one of the following values: present/installed, absent, purged, held, and latest. It's not stated in there what the default value of the attribute is.\r\n\r\nPlease specify clearly in the docs what the default value of that attribute is.\r\n\r\nSidenote:\r\nI was expecting that by setting 'ensure => undef' or not setting it at all, puppet would not try to install the package, however it still does.\r\nSo:\r\npackage { \"pkgname\": }, or package { \"pkgname\": ensure => undef } would still install the package (I'm actually using a more complicated manifest with some dependencies, but this illustrates the issue).","closed_at":"2013-11-15T09:57:34.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-763","labels":"customer;redmine","state":"Closed","updated_at":"2013-11-15T09:57:34.000-0800","timestamp":1652284653.619167,"priority":"Normal","status_category":"Done","pull_request":6578},{"issue_id":"20739","title":"Windows service doesn't accept extra arguments properly","url":"https://tickets.puppetlabs.com/browse/PUP-982","created_at":"2013-12-10T07:39:09.000-0800","number":"PUP-982","body":"Checking the code responsible of managing the windows service, there is an option to pass extra arguments to the puppet run. \r\n\r\nHowever, when I try to pass additional parameters (like --masterport=XXXX, etc), the options are not properly parsed by the service.rb class.\r\n\r\nAfter taking a look to the code, it appears to be easy to fix, so I'll post a possible solution for this issue.","closed_at":"2013-12-10T07:42:05.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-982","labels":"redmine;windows","state":"Closed","updated_at":"2013-12-10T07:42:05.000-0800","timestamp":1652284653.833828,"priority":"Normal","status_category":"Done","pull_request":8635},{"issue_id":"16149","title":"Resource titles longer than 1024 corrupt state.yaml under Ruby 1.9.x","url":"https://tickets.puppetlabs.com/browse/PUP-508","created_at":"2013-10-02T14:35:11.000-0700","number":"PUP-508","body":"Ruby 1.9.x switched to the Psych YAML parser which is much stricter than the parser used by 1.8.x. In particular [from the YAML 1.1 spec|http://yaml.org/spec/1.1]:\r\n\r\nbq. to avoid unbound lookahead in YAML processors, simple keys are restricted to a single line and must not span more than 1024 stream characters\r\n\r\nThis means that hash keys in YAML files cannot exceed 1024 characters. Puppet can construct such a hash key when the agent creates `state.yaml` files. Resources are added to this file by [creating a hash key|https://github.com/puppetlabs/puppet/blob/3.2.4/lib/puppet/util/storage.rb#L24-L28] from the resource object. For Resources, this ends up calling the `to_s` method which [does the following|https://github.com/puppetlabs/puppet/blob/3.2.4/lib/puppet/resource.rb#L244-L246]:\r\n\r\n{code}\r\ndef to_s\r\n  \"#{type}[#{title}]\"\r\nend\r\n{code}\r\n\r\nThis means any resource with a `title` longer than 1024 will spur the creation of an invalid YAML file. For example, the following ssh key resource:\r\n\r\n{code}\r\nssh_authorized_key { 'ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff':\r\nensure => present,\r\nuser => 'root',\r\ntype => 'rsa',\r\nkey => 'foo',\r\n}\r\n{code}\r\n\r\nWill result in successful creation of the key in `/root/.ssh/authorized_keys`, but a failure of the master to process a YAML report:\r\n\r\n{code}\r\nError: Could not send report: Error 400 on SERVER: (<unknown>): could not find expected ':' while scanning a simple key at line 2685 column 5\r\n{code}\r\n\r\nFollowed by failed agent runs due to `state.yaml`:\r\n\r\n{code}\r\nError: Could not run Puppet configuration client: (<unknown>): could not find expected ':' while scanning a simple key at line 397 column 3\r\nError: Could not run: can't convert Puppet::Util::Log into Integer\r\n{code}","closed_at":"2013-12-11T07:16:17.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-508","labels":"","state":"Closed","updated_at":"2013-12-11T07:16:17.000-0800","timestamp":1652284654.156712,"priority":"Normal","status_category":"Done","pull_request":4313},{"issue_id":"20342","title":"Puppet on Windows can fail to run depending on load order ","url":"https://tickets.puppetlabs.com/browse/PUP-943","created_at":"2013-12-05T14:05:49.000-0800","number":"PUP-943","body":"The Puppet::Util::Windows::Security module doesn't require 'ffi' before using it. The gem is required in other places, though so this seems to be dependent on the load order.\r\n\r\n<pre>\r\n$ ssh Administrator@josh-ny1po54a0o.solar.lan cmd.exe /c puppet agent  --test\r\nC:/ruby193/lib/ruby/site_ruby/1.9.1/puppet/util/windows/security.rb:635:in `&lt;module:API>': uninitialized constant Puppet::Util::Windows::Security::API::FFI (NameError)\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/puppet/util/windows/security.rb:634:in `&lt;module:Security>'\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/puppet/util/windows/security.rb:77:in `&lt;top (required)>'\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/puppet/util/windows.rb:6:in `&lt;module:Windows>'\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/puppet/util/windows.rb:1:in `&lt;top (required)>'\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/puppet/util/monkey_patches.rb:190:in `&lt;top (required)>'\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/puppet/util.rb:16:in `&lt;module:Util>'\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/puppet/util.rb:15:in `&lt;module:Puppet>'\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/puppet/util.rb:14:in `&lt;top (required)>'\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/puppet.rb:8:in `&lt;top (required)>'\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/puppet/util/command_line.rb:12:in `&lt;top (required)>'\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\r\n\tfrom C:/ruby193/lib/ruby/site_ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\r\n\tfrom C:/ruby193/bin/puppet:3:in `&lt;main>'\r\n</pre>\r\n\r\nThe fix is simple, add `require 'ffi'`","closed_at":"2013-12-19T16:52:49.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-943","labels":"redmine;windows","state":"Closed","updated_at":"2013-12-19T16:52:49.000-0800","timestamp":1652284654.4781,"priority":"Normal","status_category":"Done","pull_request":7334},{"issue_id":"19065","title":"$trusted hash is not immutable; can be modified in DSL and templates","url":"https://tickets.puppetlabs.com/browse/PUP-773","created_at":"2013-11-18T11:17:44.000-0800","number":"PUP-773","body":"https://github.com/nfagerlund/evil-made-manifest/blob/master/trusted_hash.pp\r\n\r\nThe code linked above shows how to mutate the $trusted hash with hashed_node_data set to true -- you can add new keys in the DSL, and can overwrite existing keys in a template. In other words, it behaves exactly like a normal hash. \r\n\r\nPer [~henrik.lindberg] in hipchat this morning, that's a bug, and the $trusted hash is meant to fail hard with an error when modified. ","closed_at":"2013-12-19T16:55:48.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-773","labels":"","state":"Closed","updated_at":"2013-12-19T16:55:48.000-0800","timestamp":1652284654.592805,"priority":"Major","status_category":"Done","pull_request":8057},{"issue_id":"18989","title":"Rename \"hashed_node_data\" and \"clientcert\"","url":"https://tickets.puppetlabs.com/browse/PUP-765","created_at":"2013-11-15T11:57:07.000-0800","number":"PUP-765","body":"Item 1: \r\n\r\nIn the comments to DOC-283, [~henrik.lindberg] said the setting \"hashed_node_data\" was named because it resulted in node data being stored in a hash. That's not what the name implies, though: it seems to be stating that certain node data will be run through some kind of cryptographic hash function before being presented to the user. This is confusing. \r\n\r\nInstead, the setting's name should clearly indicate that it makes Puppet expose special verified data. To make it more memorable and self-explaining, it should also tie back to the name of the hash it exposes ($trusted). \r\n\r\nI suggest renaming the setting to \"trusted_node_data\" or \"enable_trusted_data.\" The former has the benefit of starting with \"t,\" so a user searching alphabetically through our list of 200+ settings will find it faster. \r\n\r\nItem 2:\r\n\r\nThe name of the existing un-trusted certname variable ($clientcert) was poorly chosen: it muddies the waters with yet another unnecessary name for the certname, it confounds expections (I've watched even advanced users mistakenly try to use $certname), and it has a frustrating resemblance to the \"hostcert\" setting (which is a path to a file on disk). Furthermore, it's not even accurate when using puppet apply, since a standalone node can't really be called a \"client.\" \r\n\r\nI've hated it forever and this is our one chance to ditch it. We should rename that key in the $trusted hash to \"certname.\" ","closed_at":"2013-12-19T16:58:58.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-765","labels":"","state":"Closed","updated_at":"2013-12-19T16:58:58.000-0800","timestamp":1652284654.700303,"priority":"Normal","status_category":"Done","pull_request":5980},{"issue_id":"14997","title":"Regression on arrays and puppet resources using the name attribute","url":"https://tickets.puppetlabs.com/browse/PUP-403","created_at":"2013-09-20T09:08:40.000-0700","number":"PUP-403","body":null,"closed_at":"2013-12-19T17:14:02.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-403","labels":"","state":"Closed","updated_at":"2013-12-19T17:14:02.000-0800","timestamp":1652284656.963774,"priority":"Normal","status_category":"Done","pull_request":5699},{"issue_id":"20250","title":"\"Could not find value for $confdir\" regression when using $confdir in puppet.conf","url":"https://tickets.puppetlabs.com/browse/PUP-932","created_at":"2013-12-04T14:21:09.000-0800","number":"PUP-932","body":"This is a regression from 3.3.x to 3.4.0-rc1.\n\nWhen puppet.conf contains the following:\n\n{noformat}\n[main]\n    autosign = $confdir/autosign.conf\n{noformat}\n\nAll puppet commands fail as the $confdir can't be interpolated.\n\n{noformat}\n# puppet --version\n3.3.2\n# puppet apply --configprint autosign\n/etc/puppet/autosign.conf\n# yum upgrade --enablerepo=puppetlabs-devel puppet\n[snip, updated to 3.4.0-rc1]\n# rpm -q puppet\npuppet-3.4.0-0.1rc1.el6.noarch\n# puppet apply --configprint autosign\nError: Could not intialize global default settings: Error converting value for param 'autosign': Could not find value for $confdir\n# puppet --version\nError: Could not intialize global default settings: Error converting value for param 'autosign': Could not find value for $confdir\n{noformat}","closed_at":"2013-12-19T17:17:02.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-932","labels":"redmine","state":"Closed","updated_at":"2013-12-19T17:17:02.000-0800","timestamp":1652284658.17046,"priority":"Normal","status_category":"Done","pull_request":7254},{"issue_id":"13487","title":"Can't add domain users to the local Administrators group","url":"https://tickets.puppetlabs.com/browse/PUP-255","created_at":"2013-08-19T17:00:41.000-0700","number":"PUP-255","body":null,"closed_at":"2013-12-19T17:24:39.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-255","labels":"windows","state":"Closed","updated_at":"2013-12-19T17:24:39.000-0800","timestamp":1652284658.27583,"priority":"Major","status_category":"Done","pull_request":2662},{"issue_id":"16843","title":"Windows MSI rememberme properties that have a default value don't behave as expected","url":"https://tickets.puppetlabs.com/browse/PUP-571","created_at":"2013-10-16T13:49:29.000-0700","number":"PUP-571","body":"If you install puppet on windows, the value is persisted in the registry. If you upgrade and don't specify a new value, the persisted value should be re-applied, but is not. Specifically:\r\n\r\n{noformat}\r\n    <Property Id=\"PUPPET_MASTER_SERVER\" Value=\"puppet\">\r\n    <Property Id=\"PUPPET_AGENT_ENVIRONMENT\" Value=\"production\">\r\n{noformat}\r\n\r\nTo reproduce, install 3.3.1 (or whenever the property was introduced):\r\n\r\n{noformat}\r\nstart /w msiexec /qn /i puppet-3.3.1.msi PUPPET_MASTER_SERVER=myotherserver\r\n{noformat}\r\n\r\nMake sure the value is in the registry and puppet.conf:\r\n\r\n{noformat}\r\nreg query \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\Puppet Labs\\PuppetInstaller\" /v RememberedPuppetMasterServer\r\ntype c:\\programdata\\puppetlabs\\puppet\\etc\\puppet.conf\r\n{noformat}\r\n\r\nUpgrade to the new version without specifying a new value:\r\n\r\n{noformat}\r\nstart /w msiexec /qn /i puppet-latest.msi\r\n{noformat}\r\n\r\npuppet.conf will revert back to the default `puppet` instead of the remembered value `myotherserver`\r\n\r\nThis wasn't an issue previously, because once a value was written to puppet.conf, it was never changed, even if a new value was specified in the command line.","closed_at":"2013-12-19T17:30:20.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-571","labels":"windows","state":"Closed","updated_at":"2013-12-19T17:30:20.000-0800","timestamp":1652284658.487436,"priority":"Normal","status_category":"Done","pull_request":4599},{"issue_id":"14649","title":"facter 1.7.3/puppet 3.3.0 custom facts not available in puppet","url":"https://tickets.puppetlabs.com/browse/PUP-340","created_at":"2013-09-13T15:49:38.000-0700","number":"PUP-340","body":"User that has a custom fact does not have it showing up in a puppet manifest","closed_at":"2013-12-19T17:44:32.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-340","labels":"","state":"Closed","updated_at":"2013-12-19T17:44:32.000-0800","timestamp":1652284658.594065,"priority":"Normal","status_category":"Done","pull_request":3195},{"issue_id":"14456","title":"Windows-Vagrant: Publish Shared Vagrant boxes","url":"https://tickets.puppetlabs.com/browse/PUP-318","created_at":"2013-09-11T13:52:05.000-0700","number":"PUP-318","body":"Find a shared location where Vagrant boxes should be placed that is accessible to everyone on the network easily.\n\n`vagrant up` should involve cloning a repo and going to town.\n\nWill go here http://int-resources.ops.puppetlabs.net/vagrant/","closed_at":"2013-12-20T09:55:20.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-318","labels":"","state":"Closed","updated_at":"2013-12-20T09:55:20.000-0800","timestamp":1652284658.918868,"priority":"Normal","status_category":"Done","pull_request":5047},{"issue_id":"21065","title":"Error: Could not intialize global default settings: undefined method `mode=' for #<Puppet::Settings::AutosignSetting:0x7ff361614368>","url":"https://tickets.puppetlabs.com/browse/PUP-1015","created_at":"2013-12-12T09:35:08.000-0800","number":"PUP-1015","body":"Follow-on from #23349... regression from 3.3.x to 3.4.0-rc2.  This affects all Foreman users, since it's the default installer configuration (https://github.com/theforeman/puppet-puppet/blob/master/templates/puppet.conf.erb#L21).\r\n\r\nWith this in puppet.conf:\r\n{code}\r\n[main]\r\n    autosign       = $confdir/autosign.conf { mode = 664 }\r\n{code}\r\n\r\n{code}\r\n# puppet --version\r\nError: Could not intialize global default settings: undefined method `mode=' for #&lt;Puppet::Settings::AutosignSetting:0x7f4b4ecff440&gt;\r\n# rpm -q puppet\r\npuppet-3.4.0-0.1rc2.el6.noarch\r\n{code}\r\n\r\nSorry for not including the full puppet.conf entry in the earlier bug report, we could have avoided a round trip.","closed_at":"2014-01-07T10:38:50.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1015","labels":"redmine","state":"Closed","updated_at":"2014-01-07T10:38:50.000-0800","timestamp":1652284670.890319,"priority":"Normal","status_category":"Done","pull_request":8818},{"issue_id":"22510","title":"enabling future parser breaks puppet - \"Do not add methods to model classes directly...\"","url":"https://tickets.puppetlabs.com/browse/PUP-1235","created_at":"2013-12-24T08:03:39.000-0800","number":"PUP-1235","body":"After enabling the future parser, agent runs fail with \"Could not parse for environment X: Do not add methods to model classes directly, add them to the ClassModule instead on node foo.bar\"\r\n\r\nThis happens even with an empty node definition.\r\n\r\nup-to-date RHEL6.4 on master and agent with puppet 3.3.1 from puppetlabs repo\r\n\r\nThe master is run via apache+passenger.\r\n\r\npuppet.conf on master: \r\n\r\n<pre>\r\n[main]\r\n    dbadapter = mysql\r\n    dbuser = puppet\r\n    dbpassword = myultrasecretpassword\r\n    dbserver = localhost\r\n    dbsocket = /var/lib/mysql/mysql.sock\r\n\r\n[master]\r\n    vardir = /var/lib/puppetmaster\r\n    ssldir = /var/lib/puppetmaster/ssl\r\n    rundir = /var/run/puppet\r\n    autosign = true\r\n    modulepath = /etc/puppet/environments/$environment/modules:/etc/puppet/environments/common/modules\r\n    manifest = /etc/puppet/environments/$environment/site.pp\r\n    hiera_config = /etc/puppet/hiera.yaml\r\n\r\n    reports = log, foreman\r\n\r\n    # set default env for unconfigured nodes\r\n    environment = infrastructure\r\n    storeconfigs = true\r\n    parser = future\r\n</pre>\r\n\r\n\r\npuppet.conf on agent:\r\n\r\n<pre>\r\n[agent]\r\n    server = trantor.vm\r\n    vardir = /var/lib/puppet\r\n    ssldir = $vardir/ssl\r\n\r\n    report = true\r\n    pluginsync = true\r\n\r\n    environment = research\r\n</pre>\r\n\r\nsite.pp:\r\n\r\n<pre>\r\nnode default {\r\n}\r\n</pre>\r\n\r\nHere's the master trace:\r\n\r\n<pre>\r\nError: Could not parse for environment research: Do not add methods to model classes directly, add them to the ClassModule instead on node anacreon.vm\r\n/usr/lib/ruby/site_ruby/rgen/metamodel_builder.rb:198:in `method_added'\r\n/usr/lib/ruby/gems/1.8/gems/activesupport-2.3.16/lib/active_support/core_ext/module/aliasing.rb:33:in `alias_method'\r\n/usr/lib/ruby/gems/1.8/gems/activesupport-2.3.16/lib/active_support/core_ext/module/aliasing.rb:33:in `alias_method_chain'\r\n/usr/lib/ruby/gems/1.8/gems/activesupport-2.3.16/lib/active_support/dependencies.rb:142:in `included'\r\n/usr/lib/ruby/gems/1.8/gems/activesupport-2.3.16/lib/active_support/dependencies.rb:140:in `class_eval'\r\n/usr/lib/ruby/gems/1.8/gems/activesupport-2.3.16/lib/active_support/dependencies.rb:140:in `included'\r\n/usr/lib/ruby/site_ruby/rgen/metamodel_builder/mm_multiple.rb:15:in `include'\r\n/usr/lib/ruby/site_ruby/rgen/metamodel_builder/mm_multiple.rb:15:in `MMMultiple'\r\n/usr/lib/ruby/site_ruby/rgen/metamodel_builder/mm_multiple.rb:14:in `instance_eval'\r\n/usr/lib/ruby/site_ruby/rgen/metamodel_builder/mm_multiple.rb:14:in `MMMultiple'\r\n/usr/lib/ruby/site_ruby/rgen/metamodel_builder/mm_multiple.rb:12:in `each'\r\n/usr/lib/ruby/site_ruby/rgen/metamodel_builder/mm_multiple.rb:12:in `MMMultiple'\r\n/usr/lib/ruby/site_ruby/rgen/ecore/ecore.rb:20\r\n/usr/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require'\r\n/usr/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `require'\r\n/usr/lib/ruby/gems/1.8/gems/activesupport-2.3.16/lib/active_support/dependencies.rb:184:in `require'\r\n/usr/lib/ruby/site_ruby/rgen/transformer.rb:1\r\n/usr/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require'\r\n/usr/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `require'\r\n/usr/lib/ruby/gems/1.8/gems/activesupport-2.3.16/lib/active_support/dependencies.rb:184:in `require'\r\n/usr/lib/ruby/site_ruby/rgen/ecore/ruby_to_ecore.rb:1\r\n/usr/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require'\r\n/usr/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `require'\r\n/usr/lib/ruby/gems/1.8/gems/activesupport-2.3.16/lib/active_support/dependencies.rb:184:in `require'\r\n/usr/lib/ruby/site_ruby/rgen/ecore/ecore_interface.rb:22:in `ecore'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/pops/containment.rb:28:in `eAllContents'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/pops/containment.rb:20:in `each'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/pops/validation/checker3_1.rb:39:in `validate'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/parser/e_parser_adapter.rb:61:in `validate'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/parser/e_parser_adapter.rb:38:in `parse'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/node/environment.rb:468:in `perform_initial_import'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/node/environment.rb:219:in `known_resource_types'\r\n/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/node/environment.rb:216:in `known_resource_types'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/resource/type_collection_helper.rb:5:in `known_resource_types'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/parser/compiler.rb:465:in `initvars'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/parser/compiler.rb:202:in `initialize'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/parser/compiler.rb:29:in `new'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/parser/compiler.rb:29:in `compile'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/indirector/catalog/compiler.rb:88:in `compile'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util/profiler/none.rb:6:in `profile'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util/profiler.rb:26:in `profile'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/indirector/catalog/compiler.rb:86:in `compile'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util.rb:182:in `benchmark'\r\n/usr/lib/ruby/1.8/benchmark.rb:308:in `realtime'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util.rb:181:in `benchmark'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/indirector/catalog/compiler.rb:85:in `compile'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/indirector/catalog/compiler.rb:45:in `find'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/indirector/indirection.rb:197:in `find'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/handler.rb:140:in `do_find'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/handler.rb:97:in `send'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/handler.rb:97:in `process'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util/profiler/none.rb:6:in `profile'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util/profiler.rb:26:in `profile'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/handler.rb:91:in `process'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick/rest.rb:31:in `service'\r\n/usr/lib/ruby/1.8/webrick/httpserver.rb:104:in `service'\r\n/usr/lib/ruby/1.8/webrick/httpserver.rb:65:in `run'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick.rb:35:in `listen'\r\n/usr/lib/ruby/1.8/webrick/server.rb:173:in `call'\r\n/usr/lib/ruby/1.8/webrick/server.rb:173:in `start_thread'\r\n/usr/lib/ruby/1.8/webrick/server.rb:162:in `start'\r\n/usr/lib/ruby/1.8/webrick/server.rb:162:in `start_thread'\r\n/usr/lib/ruby/1.8/webrick/server.rb:95:in `start'\r\n/usr/lib/ruby/1.8/webrick/server.rb:92:in `each'\r\n/usr/lib/ruby/1.8/webrick/server.rb:92:in `start'\r\n/usr/lib/ruby/1.8/webrick/server.rb:23:in `start'\r\n/usr/lib/ruby/1.8/webrick/server.rb:82:in `start'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick.rb:32:in `listen'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick.rb:31:in `initialize'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick.rb:31:in `new'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick.rb:31:in `listen'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick.rb:28:in `synchronize'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick.rb:28:in `listen'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/server.rb:27:in `start'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/daemon.rb:139:in `start'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application/master.rb:289:in `start_webrick_master'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application/master.rb:205:in `main'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application/master.rb:165:in `run_command'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application.rb:364:in `run'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application.rb:457:in `plugin_hook'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application.rb:364:in `run'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util.rb:511:in `exit_on_fail'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application.rb:364:in `run'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util/command_line.rb:132:in `run'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util/command_line.rb:86:in `execute'\r\n/usr/bin/puppet:4\r\nError: Could not parse for environment research: Do not add methods to model classes directly, add them to the ClassModule instead on node anacreon.vm\r\nError: Could not parse for environment research: Do not add methods to model classes directly, add them to the ClassModule instead on node anacreon.vm\r\n/usr/lib/ruby/site_ruby/rgen/metamodel_builder.rb:198:in `method_added'\r\n/usr/lib/ruby/gems/1.8/gems/activesupport-2.3.16/lib/active_support/core_ext/module/aliasing.rb:33:in `alias_method'\r\n/usr/lib/ruby/gems/1.8/gems/activesupport-2.3.16/lib/active_support/core_ext/module/aliasing.rb:33:in `alias_method_chain'\r\n/usr/lib/ruby/gems/1.8/gems/activesupport-2.3.16/lib/active_support/dependencies.rb:142:in `included'\r\n/usr/lib/ruby/gems/1.8/gems/activesupport-2.3.16/lib/active_support/dependencies.rb:140:in `class_eval'\r\n/usr/lib/ruby/gems/1.8/gems/activesupport-2.3.16/lib/active_support/dependencies.rb:140:in `included'\r\n/usr/lib/ruby/site_ruby/rgen/metamodel_builder/mm_multiple.rb:15:in `include'\r\n/usr/lib/ruby/site_ruby/rgen/metamodel_builder/mm_multiple.rb:15:in `MMMultiple'\r\n/usr/lib/ruby/site_ruby/rgen/metamodel_builder/mm_multiple.rb:14:in `instance_eval'\r\n/usr/lib/ruby/site_ruby/rgen/metamodel_builder/mm_multiple.rb:14:in `MMMultiple'\r\n/usr/lib/ruby/site_ruby/rgen/metamodel_builder/mm_multiple.rb:12:in `each'\r\n/usr/lib/ruby/site_ruby/rgen/metamodel_builder/mm_multiple.rb:12:in `MMMultiple'\r\n/usr/lib/ruby/site_ruby/rgen/ecore/ecore.rb:20\r\n/usr/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require'\r\n/usr/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `require'\r\n/usr/lib/ruby/gems/1.8/gems/activesupport-2.3.16/lib/active_support/dependencies.rb:184:in `require'\r\n/usr/lib/ruby/site_ruby/rgen/transformer.rb:1\r\n/usr/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require'\r\n/usr/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `require'\r\n/usr/lib/ruby/gems/1.8/gems/activesupport-2.3.16/lib/active_support/dependencies.rb:184:in `require'\r\n/usr/lib/ruby/site_ruby/rgen/ecore/ruby_to_ecore.rb:1\r\n/usr/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require'\r\n/usr/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `require'\r\n/usr/lib/ruby/gems/1.8/gems/activesupport-2.3.16/lib/active_support/dependencies.rb:184:in `require'\r\n/usr/lib/ruby/site_ruby/rgen/ecore/ecore_interface.rb:22:in `ecore'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/pops/containment.rb:28:in `eAllContents'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/pops/containment.rb:20:in `each'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/pops/validation/checker3_1.rb:39:in `validate'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/parser/e_parser_adapter.rb:61:in `validate'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/parser/e_parser_adapter.rb:38:in `parse'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/node/environment.rb:468:in `perform_initial_import'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/node/environment.rb:219:in `known_resource_types'\r\n/usr/lib/ruby/1.8/monitor.rb:242:in `synchronize'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/node/environment.rb:216:in `known_resource_types'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/resource/type_collection_helper.rb:5:in `known_resource_types'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/parser/compiler.rb:465:in `initvars'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/parser/compiler.rb:202:in `initialize'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/parser/compiler.rb:29:in `new'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/parser/compiler.rb:29:in `compile'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/indirector/catalog/compiler.rb:88:in `compile'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util/profiler/none.rb:6:in `profile'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util/profiler.rb:26:in `profile'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/indirector/catalog/compiler.rb:86:in `compile'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util.rb:182:in `benchmark'\r\n/usr/lib/ruby/1.8/benchmark.rb:308:in `realtime'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util.rb:181:in `benchmark'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/indirector/catalog/compiler.rb:85:in `compile'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/indirector/catalog/compiler.rb:45:in `find'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/indirector/indirection.rb:197:in `find'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/handler.rb:140:in `do_find'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/handler.rb:97:in `send'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/handler.rb:97:in `process'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util/profiler/none.rb:6:in `profile'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util/profiler.rb:26:in `profile'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/handler.rb:91:in `process'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick/rest.rb:31:in `service'\r\n/usr/lib/ruby/1.8/webrick/httpserver.rb:104:in `service'\r\n/usr/lib/ruby/1.8/webrick/httpserver.rb:65:in `run'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick.rb:35:in `listen'\r\n/usr/lib/ruby/1.8/webrick/server.rb:173:in `call'\r\n/usr/lib/ruby/1.8/webrick/server.rb:173:in `start_thread'\r\n/usr/lib/ruby/1.8/webrick/server.rb:162:in `start'\r\n/usr/lib/ruby/1.8/webrick/server.rb:162:in `start_thread'\r\n/usr/lib/ruby/1.8/webrick/server.rb:95:in `start'\r\n/usr/lib/ruby/1.8/webrick/server.rb:92:in `each'\r\n/usr/lib/ruby/1.8/webrick/server.rb:92:in `start'\r\n/usr/lib/ruby/1.8/webrick/server.rb:23:in `start'\r\n/usr/lib/ruby/1.8/webrick/server.rb:82:in `start'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick.rb:32:in `listen'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick.rb:31:in `initialize'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick.rb:31:in `new'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick.rb:31:in `listen'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick.rb:28:in `synchronize'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick.rb:28:in `listen'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/network/server.rb:27:in `start'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/daemon.rb:139:in `start'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application/master.rb:289:in `start_webrick_master'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application/master.rb:205:in `main'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application/master.rb:165:in `run_command'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application.rb:364:in `run'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application.rb:457:in `plugin_hook'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application.rb:364:in `run'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util.rb:511:in `exit_on_fail'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application.rb:364:in `run'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util/command_line.rb:132:in `run'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util/command_line.rb:86:in `execute'\r\n/usr/bin/puppet:4\r\n</pre>\r\n","closed_at":"2014-01-11T13:27:44.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1235","labels":"redmine","state":"Closed","updated_at":"2014-01-11T13:27:44.000-0800","timestamp":1652284671.73004,"priority":"Normal","status_category":"Done","pull_request":3139},{"issue_id":"20924","title":"Class namespace declaration appears to be dynamically scoped","url":"https://tickets.puppetlabs.com/browse/PUP-993","created_at":"2013-12-11T13:29:07.000-0800","number":"PUP-993","body":"In the example below, the class declaration test generates an error\r\n{noformat}\r\n    class role::test {\r\n      class { 'test': }\r\n      #include test\r\n    }\r\n    Duplicate declaration: Class[Role::Test] is already declared; cannot redeclare at /etc/puppetlabs/puppet/modules/role/manifests/test.pp:2\r\n{noformat}\r\nas it appears to be attempting to redeclare itself due to dynamic namespacing in the {{class \\{ 'test': \\}}} declaration.\r\n\r\nthe {{include test}} line also doesn't do the 'right thing' because it declares the {{role::test}} class, however {{include ::test}} does the right thing \r\n\r\nThe workaround is to declare {{class \\{ '::test': \\}}} (or {{include ::test}}) , however I wouldn't expect class declaration lookup to be dynamic as a default - I can see that dynamic lookup would cause this to happen, but  wonder if this behaviour should be reviewed.","closed_at":"2014-01-11T14:32:30.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-993","labels":"redmine","state":"Closed","updated_at":"2014-01-11T14:32:30.000-0800","timestamp":1652284671.948085,"priority":"Normal","status_category":"Done","pull_request":7651},{"issue_id":"21367","title":"Windows puppet service should log to the eventlog","url":"https://tickets.puppetlabs.com/browse/PUP-1049","created_at":"2013-12-16T04:59:36.000-0800","number":"PUP-1049","body":"The windows service code (daemon.rb) logs to a file, since that was implemented prior to eventlog support. Now that we have the latter, the daemon code should use it, e.g. \r\n\r\n{quote}\r\nrequire 'win32/eventlog'\r\neventlog = Win32::EventLog.open(\"Application\")\r\neventlog.report_event(\r\n  :source      => \"Puppet\",\r\n  :event_type  => Win32::EventLog::INFO, # or WARN, ERROR\r\n  :event_id    => 0x01, # or 0x02, 0x03\r\n  :data        => \"the message\"\r\n)\r\neventlog.close\r\n{quote}\r\n\r\n","closed_at":"2014-02-13T16:12:41.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1049","labels":"redmine;windows","state":"Resolved","updated_at":"2014-02-13T16:12:41.000-0800","timestamp":1652284673.360044,"priority":"Normal","status_category":"Done","pull_request":8443},{"issue_id":"11658","title":"Accessing the Puppet::Node::Environment `known_resource_types` instance method on multiple environments forces a regeneration of `known_resource_types`.","url":"https://tickets.puppetlabs.com/browse/PUP-143","created_at":"2013-07-02T19:26:32.000-0700","number":"PUP-143","body":"The relationship between Puppet::Node::Environment instances and Puppet::Resource::TypeCollection is an n:n relationship, as every environment can have a unique list of known types. However there is only one instance of the TypeCollection present at any given time, which is stored as a thread local variable. Furthermore Puppet can only be run as a single thread, so this means that known_resource_types is effectively global.\n\nEvery time the environment changes the current known_resource_types is discarded and must be regenerated. In the worst case this triggers #21561; in the best case this forces Puppet to hit the filesystem and reread all manifests an environment. If a master has a number of active environments this can be very resource intensive.\n\nIt seems reasonable to make the known_resource_types method an instance variable so that if environments are switched this doesn’t force a reload.\n\nThis is a copy of https://projects.puppetlabs.com/issues/21563","closed_at":"2014-02-14T19:11:48.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-143","labels":"","state":"Resolved","updated_at":"2014-02-14T19:11:48.000-0800","timestamp":1652284673.465237,"priority":"Major","status_category":"Done","pull_request":2263},{"issue_id":"18145","title":"Puppert Certificate Signing Allows Invalid Option","url":"https://tickets.puppetlabs.com/browse/PUP-651","created_at":"2013-11-04T10:17:21.000-0800","number":"PUP-651","body":"h1. Description\r\n\r\nIf a puppet user wants to sign all requested certificates from agent nodes and accidentally enters an invalid option \"--al\" the certificate signing will still successfully complete.\r\n\r\nh2. Attachments\r\n\r\nNone.\r\n\r\nh2. Repro Steps\r\n\r\n# On an agent send a certificate request to the master.\r\n# On master execute the following command:\r\n\r\n    puppet cert sign --al\r\n\r\nh2. Expect\r\n\r\nPuppet should fail and report an error that the \"--al\" option is invalid.\r\n\r\nh2. Actual\r\n\r\nPuppet interprets the invalid \"\\-\\-al\" as \"\\-\\-all\" and successfully signs all certificate requests.\r\n\r\n{panel}\r\n{color:red}\r\n[root@centos6 ~]# puppet cert sign --al\r\n{color}\r\nNotice: Signed certificate request for w2k8r2.vm\r\nNotice: Removing file Puppet::SSL::CertificateRequest w2k8r2.vm at '/etc/puppetlabs/puppet/ssl/ca/requests/w2k8r2.vm.pem'\r\n{panel}\r\n","closed_at":"2014-02-14T22:08:52.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-651","labels":"","state":"Closed","updated_at":"2014-02-14T22:08:52.000-0800","timestamp":1652284673.570376,"priority":"Minor","status_category":"Done","pull_request":5891},{"issue_id":"25676","title":"puppet node doesn't retrieve the environment params","url":"https://tickets.puppetlabs.com/browse/PUP-1600","created_at":"2014-02-06T08:28:12.000-0800","number":"PUP-1600","body":"Hi,\r\n\r\nAccording to http://docs.puppetlabs.com/guides/environment.html, I have defined a variable environment in my puppet dashboard.\r\n{code}\r\n# /usr/bin/env PUPPET_DASHBOARD_URL=http://localhost:3000 /usr/share/puppet-dashboard/bin/external_node mynode\r\n---\r\nname: mynode\r\nparameters:\r\n...\r\n  environment: beta\r\n...\r\n{code}\r\nI have configure my master : \r\n{code}\r\n[main]\r\n  ...\r\n    modulepath = $confdir/environments/$environment/modules:$confdir/modules\r\n\r\n[master]\r\n  ...\r\n\r\n[production]\r\n modulepath = $confdir/modules\r\n{code}\r\n\r\nI have installed my module in the right env : \r\n{code}\r\n puppet module list --environment beta\r\n/etc/puppet/environments/beta/modules\r\n└── mymodule (v1.7.7)\r\n/etc/puppet/modules\r\n├── mymodule  (v1.7.6)\r\n{code}\r\n\r\nBut when I update my node it use the production environnement.\r\n{code}puppet agent --test --noop{code}\r\n\r\nAll works with\r\n{code}puppet agent --test --noop --environment beta{code}\r\n\r\nBut in this case, the dashboard settings is useless.\r\n\r\nAm I missing something ?\r\n\r\nBoth master and agent are running on 3.4.2.\r\n\r\nRegards,","closed_at":"2014-02-19T17:42:02.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1600","labels":"","state":"Closed","updated_at":"2014-02-19T17:42:02.000-0800","timestamp":1652284675.900593,"priority":"Normal","status_category":"Done","pull_request":5909},{"issue_id":"23348","title":"Windows agents experience intermittent SSL_connect failures in acceptance testing","url":"https://tickets.puppetlabs.com/browse/PUP-1411","created_at":"2014-01-09T09:27:21.000-0800","number":"PUP-1411","body":"Breaking this out as a separate ticket related to QA-678.\r\nDuring Windows acceptance testing on master, certificate requests non-deterministically fail due with SSL_connect failures:\r\n{code}\r\n#<RuntimeError: PuppetAcceptance::DSL::Helpers.with_puppet_running_on failed (check backtrace for location) because: Host 'oqr39kv18vwtk49' exited with 1 running:\r\n env RUBYLIB=\"`cygpath -w /opt/puppet-git-repos/hiera/lib`;`cygpath -w /opt/puppet-git-repos/hiera-puppet/lib`;${RUBYLIB}\" PATH=\"/opt/puppet-git-repos/hiera/bin:${PATH}\" cmd.exe /c puppet agent --test --server d0d3tnhbac8i81f  \r\nLast 10 lines of output were:\r\n\tExiting; failed to retrieve certificate and waitforcert is disabled\r\n\tError: Could not request certificate: SSL_connect SYSCALL returned=5 errno=0 state=SSLv2/v3 read server hello A\r\n{code}\r\nJanuary 2014 failures of this sort include:\r\n* https://jenkins.puppetlabs.com/job/Puppet-Acceptance-Windows-Per-Commit-master/label=acc-coord,platform=win2008r2/54/console\r\n* https://jenkins.puppetlabs.com/job/Puppet-Acceptance-Windows-master-vcloud-and-github/label=acc-coord,platform=win2008r2/183/console\r\n* https://jenkins.puppetlabs.com/job/Puppet%20Module%20-%20Reboot%20Acceptance/config=windows-2012-x86_64.cfg,label=acc-coord/21/console)\r\n* https://jenkins.puppetlabs.com/job/Puppet-Acceptance-Windows-Per-Commit-master/label=acc-coord,platform=win2008r2/42/console\r\n* https://jenkins.puppetlabs.com/job/Puppet-Acceptance-Windows-Per-Commit-stable/20/label=acc-coord,platform=win2008r2/consoleText\r\nOnly seeing this on Windows 2008 or Windows 2012, so I suspect a test or code problem rather than infrastructure.","closed_at":"2014-02-20T11:04:21.000-0800","comments":18,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1411","labels":"ssl;windows","state":"Closed","updated_at":"2014-02-20T11:04:21.000-0800","timestamp":1652284676.010023,"priority":"Normal","status_category":"Done","pull_request":2305},{"issue_id":"13366","title":"puppet runonce --environment parameter fails silently if bad environment name supplied","url":"https://tickets.puppetlabs.com/browse/PUP-243","created_at":"2013-08-14T16:24:31.000-0700","number":"PUP-243","body":"\n       mco puppet runonce --environment abcd\n\nwith a nonexistent environment 'abcd' at the commandline produces no error message. ","closed_at":"2014-02-27T14:46:42.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-243","labels":"","state":"Closed","updated_at":"2014-02-27T14:46:42.000-0800","timestamp":1652284676.644862,"priority":"Normal","status_category":"Done","pull_request":2612},{"issue_id":"10962","title":"Add support for Dynamic Environments to ARM-8","url":"https://tickets.puppetlabs.com/browse/PUP-21","created_at":"2013-06-17T17:35:23.000-0700","number":"PUP-21","body":"This adds some of the missing parts; dependencies, variables and dynamic environments.\n\nAn examples document / user stories is also added.\n\nThis is still W.I.P as there are things missing from the ARM text that is used in the examples.\n\nThere is also a tentative list of goals, non-goals.\n\nhttps://github.com/puppetlabs/armatures/pull/56","closed_at":"2014-02-27T15:59:14.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-21","labels":"","state":"Closed","updated_at":"2014-02-27T15:59:14.000-0800","timestamp":1652284676.74787,"priority":"Major","status_category":"Done","pull_request":8607},{"issue_id":"13799","title":"Variables outside of class definition in module does not produce error when running puppet apply","url":"https://tickets.puppetlabs.com/browse/PUP-280","created_at":"2013-08-28T15:37:37.000-0700","number":"PUP-280","body":"{noformat}\r\n$var1 = 'een'\r\n\r\nclass elvis {\r\n  $var1 = 'one'\r\n  $var2 = 'two'\r\n  $var3 = 'three'\r\n\r\n  file {'/tmp/ffffff':\r\n    ensure  => file,\r\n    content => \"${::var1} ${var2}\\n\",\r\n  }\r\n\r\n}\r\n{noformat}\r\n\r\nthe content is: \" two\". Since this is not a recommended place to declare a variable we should ideally generate a warning when a user is trying to do this.","closed_at":"2014-03-12T10:22:16.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-280","labels":"","state":"Closed","updated_at":"2014-03-12T10:22:16.000-0700","timestamp":1652284678.639253,"priority":"Minor","status_category":"Done","pull_request":4699},{"issue_id":"23496","title":"appdmg prematurely filters for sources ending in .dmg","url":"https://tickets.puppetlabs.com/browse/PUP-1421","created_at":"2014-01-12T08:03:05.000-0800","number":"PUP-1421","body":"h2. Problem\r\nThe following package resource:\r\n{noformat}\r\npackage { 'Toggl':\r\n  provider => 'appdmg',\r\n  source   => 'https://www.toggl.com/api/v8/installer?app=td&platform=darwin&channel=stable'\r\n}\r\n{noformat} \r\n\r\nFails with:\r\n{noformat}\r\nError: Could not set 'present' on ensure: private method `fail' called for Puppet::Type::Package::ProviderAppdmg:Class at [manifest line]\r\n{noformat}\r\n\r\nh2. Root Cause\r\nIn {{lib/puppet/provider/package/appdmg.rb}} the {{installpkgdmg}} method starts out by validating that the source ends with {{.dmg}}:\r\n{noformat}\r\n  def self.installpkgdmg(source, name)\r\n    unless source =~ /\\.dmg$/i\r\n      self.fail \"Mac OS X PKG DMG's must specify a source string ending in .dmg\"\r\n    end\r\n    # ... proceeds with downloading the source\r\n{noformat}\r\n\r\nIn the example above [Toggl has a download URL|http://support.toggl.com/toggl-on-my-desktop/#download] which is an abstraction to redirect to the latest version:\r\n{noformat}\r\nhttps://www.toggl.com/api/v8/installer?app=td&platform=darwin&channel=stable\r\n{noformat}\r\n\r\nRedirects to the latest version, which is currently:\r\n{noformat}\r\nhttps://55aa37393ef0d1f9fb76-e65c36a55026053efe5868c3826f43f1.ssl.cf1.rackcdn.com/TogglDesktop_2013-10-17-13-05-57.dmg\r\n{noformat}\r\n\r\nIncidentally the download is curled to whatever \"name\" is, and \"name\" is what is ultimately mounted (and this will mount without the .dmg extension). With the validation commented out:\r\n{noformat}\r\nDebug: Executing '/usr/bin/curl -o /tmp/d20140112-38340-1k8oyhr/Toggl -C - -k -L -s --url https://www.toggl.com/api/v8/installer?app=td&platform=darwin&channel=stable'\r\nDebug: Success: curl transfered [Toggl]\r\nDebug: Executing '/usr/bin/hdiutil mount -plist -nobrowse -readonly -mountrandom /tmp /tmp/d20140112-38340-1k8oyhr/Toggl'\r\nDebug: Executing '/usr/bin/ditto --rsrc /private/tmp/dmg.fJGJa8/TogglDesktop.app /Applications/TogglDesktop.app'\r\nDebug: Executing '/usr/bin/hdiutil eject /private/tmp/dmg.fJGJa8'\r\nNotice: /Stage[main]/Toggl/Package[Toggl]/ensure: created\r\n{noformat}\r\n\r\nThis issue was discovered in 3.3.1, but appdmg.rb hasn't changed significantly since then (as of 3.4.2).\r\n\r\nI will submit a PR with the fix.","closed_at":"2014-03-17T10:53:35.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1421","labels":"","state":"Closed","updated_at":"2014-03-17T10:53:35.000-0700","timestamp":1652284680.725808,"priority":"Normal","status_category":"Done","pull_request":2249},{"issue_id":"24306","title":"Windows colors.rb may be subject to Ruby corruption bug with wide strings","url":"https://tickets.puppetlabs.com/browse/PUP-1494","created_at":"2014-01-22T15:44:29.000-0800","number":"PUP-1494","body":"The use of Ruby's native .encode method may lead to corrupted strings that aren't properly null terminated.  If these strings are passed to Win32 API calls this may cause errors / lead to unexpected results / cause further corruption issues.\r\n\r\nThe corruption issues were discovered and fixed in PUP-1389 which has landed in both stable (post 3.4.2) and master (targeted at 3.5.0).\r\n\r\nHowever, not all use cases of .encode('UTF-16LE`) have been replaced that might additionally trigger this corruption.\r\n\r\nSince this can lead to crashy behavior, the calls made in colors.rb should be updated accordingly.","closed_at":"2014-03-17T10:53:36.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1494","labels":"","state":"Closed","updated_at":"2014-03-17T10:53:36.000-0700","timestamp":1652284681.041761,"priority":"Critical","status_category":"Done","pull_request":2290},{"issue_id":"21570","title":"When applying the settings catalog, a failed transaction may not properly surface information about the event that caused it to fail","url":"https://tickets.puppetlabs.com/browse/PUP-1136","created_at":"2013-12-17T07:06:12.000-0800","number":"PUP-1136","body":"The code for this has already been written -- this ticket is simply for tracking it as it moves to Ready for CI.\r\n\r\n[~andy] and [~ethan] paired up and fixed this as it came up during PUP-266\r\n\r\nFrom the commit msg:\r\n\r\n - Previously when the `settings` catalog was built, it was possible\r\n   for a `transaction` to fail, but not generate any useful failure\r\n   information in `report.log` -- resulting in a message to the user of\r\n   \"Got 0 failure(s) while initializing:\"\r\n - Furthermore, the `any_failed?` check against a `transaction` checks\r\n   against the `resource_statuses` of the `transaction`, but the code\r\n   to surface the error was looking in the `report.log`, which was a\r\n   source of confusion\r\n - This commit examines `event` objects inside of `resource_statuses`\r\n   for those with a `status` of `failure`, and uses them to report off\r\n   of instead - resulting in clear error messages\r\n- Additionally, some minor corresponding doc changes were made","closed_at":"2014-03-17T10:53:38.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1136","labels":"","state":"Closed","updated_at":"2014-03-17T10:53:38.000-0700","timestamp":1652284690.947546,"priority":"Major","status_category":"Done","pull_request":8827},{"issue_id":"23097","title":"CA generates subjectKeyIdentifier from issuer cert instead of cert itself","url":"https://tickets.puppetlabs.com/browse/PUP-1387","created_at":"2014-01-07T08:08:19.000-0800","number":"PUP-1387","body":"This regressed in commit 94345ebac6d79a890efc5f49e136c4f76ddda3ef","closed_at":"2014-03-17T10:53:38.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1387","labels":"ssl","state":"Closed","updated_at":"2014-03-17T10:53:38.000-0700","timestamp":1652284691.053862,"priority":"Normal","status_category":"Done","pull_request":2237},{"issue_id":"23956","title":"Ensure services that were previously enabled get enabled after systemd service unit name change","url":"https://tickets.puppetlabs.com/browse/PUP-1463","created_at":"2014-01-17T03:42:36.000-0800","number":"PUP-1463","body":"If you've got puppet versions before 3.4 installed on an OS that uses systemd and have puppetagent.service enabled, it won't be enabled any longer after upgrading the 3.4. Systemd doesn't support enabling a symlinked file despite supporting symlinks for other actions [1] so we need to handle the process of service name transition manually in %preun and %postun.\r\n\r\n1. https://bugzilla.redhat.com/show_bug.cgi?id=955379","closed_at":"2014-03-17T10:53:40.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1463","labels":"","state":"Closed","updated_at":"2014-03-17T10:53:40.000-0700","timestamp":1652284691.159533,"priority":"Normal","status_category":"Done","pull_request":2269},{"issue_id":"22648","title":"PR: Windows Puppet Agent Service gracefully terminates after succesfully being put into a Paused state","url":"https://tickets.puppetlabs.com/browse/PUP-1278","created_at":"2013-12-30T10:26:03.000-0800","number":"PUP-1278","body":"If you successfully pause the Windows Puppet Agent Server, then after a period of time the Puppet Agent service will gracefully stop.  This does not appear to be appropriate behaviour.  The service should remain in a paused state until a Continue or Stop message is sent to the service.\r\n\r\nIt looks like it's to do with the following lines;\r\n\r\n    while running? do\r\n      return if state != RUNNING\r\n\r\nAccording to ruby doco [1] running? is defined as the service is in a RUNNING, PAUSED or IDLE state, but the following line terminates the main loop if the service is not in the running state.\r\nIt seems that the \"return if state != RUNNING\" line is not really required\r\n\r\n[1] http://rubydoc.info/gems/win32-service/0.8.2/frames","closed_at":"2014-03-17T10:53:40.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1278","labels":"redmine;windows","state":"Closed","updated_at":"2014-03-17T10:53:40.000-0700","timestamp":1652284691.412469,"priority":"Normal","status_category":"Done","pull_request":2301},{"issue_id":"26156","title":"PR - Puppet cert list behavior is suboptimal","url":"https://tickets.puppetlabs.com/browse/PUP-1665","created_at":"2014-02-11T17:50:05.000-0800","number":"PUP-1665","body":"In our production environment we have >80000 certificates. Issuing {{puppet cert list}} on a large volume of signed certificates \"hangs\" even though viewing certs does not require traversing the signed repo.\r\n\r\n{{puppet cert list}} should only scan all the signed certs when necessary (signed or all options).","closed_at":"2014-03-17T10:53:44.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1665","labels":"","state":"Closed","updated_at":"2014-03-17T10:53:44.000-0700","timestamp":1652284692.091726,"priority":"Normal","status_category":"Done","pull_request":2349},{"issue_id":"22642","title":"Windows agent only runs when --onetime is specified","url":"https://tickets.puppetlabs.com/browse/PUP-1275","created_at":"2013-12-30T10:18:04.000-0800","number":"PUP-1275","body":"In 2.7.x, you could run the windows agent as `puppet agent` or `puppet agent --no-onetime` and the agent would periodically retrieve and apply catalogs.\r\n\r\nIn 3.0.2, in commit 4d1a2f83d9 (#17361), the agent was modified to fork when not doing a onetime run. But this breaks Windows, because fork is not implemented. This was not detected earlier because the windows service always runs the agent with `--onetime`. There are also no acceptance tests around this behavior.","closed_at":"2014-03-17T10:53:44.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1275","labels":"redmine;windows","state":"Closed","updated_at":"2014-03-17T10:53:44.000-0700","timestamp":1652284692.197174,"priority":"Normal","status_category":"Done","pull_request":2398},{"issue_id":"26875","title":"Puppet::Node::Environment.current should reroute with deprecation warning","url":"https://tickets.puppetlabs.com/browse/PUP-1735","created_at":"2014-02-19T11:05:29.000-0800","number":"PUP-1735","body":"PUP-1118 in commit ecb317b removed Puppet::Node::Environment.current, which I've seen used in two places:\r\n\r\n* kafo\r\n* fancy template headers (e.g. https://github.com/theforeman/puppet-puppet/blob/master/templates/_header.erb)\r\n\r\nI'm worried that there might be other users of this, so would suggest it's rerouted to the `Puppet.lookup(:current_environment)` call and prints a deprecation warning to this ticket.","closed_at":"2014-03-17T10:53:47.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1735","labels":"","state":"Closed","updated_at":"2014-03-17T10:53:47.000-0700","timestamp":1652284692.513856,"priority":"Normal","status_category":"Done","pull_request":2382},{"issue_id":"27845","title":"Puppet device results in SSL stack too deep error","url":"https://tickets.puppetlabs.com/browse/PUP-1839","created_at":"2014-03-03T15:28:50.000-0800","number":"PUP-1839","body":"h1. Background\r\n\r\nChris Spence and myself are working on a new module to manage F5 load balancers (version 11.5 IOS) as numerous clients have been asking for Puppet Labs to update this module.\r\nWe will be handing over this work to the Module Team when they have time to continue the work, as Chris and I have limited time to spend on the development.\r\n\r\nh1. Situation\r\n\r\n(test is the name of our F5 device)\r\nThis module, along with the current version of the F5 module, use the 'puppet device' application to manage interaction with the network devices.\r\nWe have done our development so far on PE 3.1.1 and have proven that we can manage VLANs, node, pool and virtual servers.\r\nLast night I upgraded my PE3.1.1 to PE3.2 and discovered that when I attempted to run {{puppet device -deviceconf=/etc/puppetlabs/puppet/device.conf test -debug}} that I was presented with a {{Error: Could not request certificate: stack level too deep}} message which proceeded many {{Debug: Using cached certificate for ca}} messages. I had run this command from the Puppet Master server as I was using this as the 'smart proxy' to communicate with the F5 Load Balancer LTM. The puppet run also printed out the following warning:\r\n{noformat}\r\nWarning: Puppet.settings.set_value is deprecated. Use Puppet[]= instead.\r\n(at /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application/device.rb:197:in `ensure in block in main')\r\nWarning: Puppet.settings.set_value is deprecated. Use Puppet[]= instead.\r\n(at /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application/device.rb:198:in `ensure in block in main')\r\nWarning: Puppet.settings.set_value is deprecated. Use Puppet[]= instead.\r\n(at /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application/device.rb:199:in `ensure in block in main')\r\n{noformat}\r\n\r\nI had an agent that was still at PE3.1.1 so I attempted to {{puppet device}} on that machine and was successful. I performed a puppet run before this to ensure the types and providers were the same on both machines. I then updated this node to PE3.2 and experienced the same issue as described above with the same errors.\r\nI did note after upgrading that when performing the {{puppet device}} command that a new SSL key was generate for the smart proxy and it attempted to store is within the device SSL directory. This failed due to another issue which I believe Gary Larizza has already reported:\r\n{noformat}\r\nError: Could not request certificate: Could not write /var/opt/lib/pe-puppet/devices/test/ssl/private_keys/agent2.local.pem to privatekeydir: Permission denied - /var/opt/lib/pe-puppet/devices/test/ssl/private_keys/agent2.local.pem\r\n{noformat}\r\nThis is caused by the ownership and permissions on the /var/opt/lib/pe-puppet/devices directory being 'root' and '0750'. Changing this to be owned by pe-puppet corrects this issue.\r\nEven with the above in place we still experience the issue. The following is a listing of the /var/opt/lib/pe-puppet/devices/test/ssl directory:\r\n{noformat}\r\n[root@agent2 ssl]# ls -lR\r\n.:\r\ntotal 24\r\ndrwxr-xr-x. 2 pe-puppet pe-puppet 4096 Feb 11 13:32 certificate_requests\r\ndrwxr-xr-x. 2 pe-puppet pe-puppet 4096 Mar 2 22:34 certs\r\n-rw-r--r--. 1 pe-puppet pe-puppet 967 Mar 2 22:34 crl.pem\r\ndrwxr-x---. 2 pe-puppet pe-puppet 4096 Feb 11 13:32 private\r\ndrwxr-x---. 2 pe-puppet pe-puppet 4096 Mar 3 01:20 private_keys\r\ndrwxr-xr-x. 2 pe-puppet pe-puppet 4096 Mar 3 01:20 public_keys\r\n\r\n./certificate_requests:\r\ntotal 0\r\n\r\n./certs:\r\ntotal 8\r\n-rw-r--r--. 1 pe-puppet pe-puppet 1976 Mar 2 22:34 ca.pem\r\n-rw-r--r--. 1 pe-puppet pe-puppet 1944 Mar 2 22:34 test.pem\r\n\r\n./private:\r\ntotal 0\r\n\r\n./private_keys:\r\ntotal 8\r\n-rw-r-----. 1 pe-puppet pe-puppet 3247 Mar 3 01:20 agent2.local.pem\r\n-rw-------. 1 pe-puppet pe-puppet 3243 Mar 2 22:34 test.pem\r\n\r\n./public_keys:\r\ntotal 4\r\n-rw-r-----. 1 pe-puppet pe-puppet 800 Mar 3 01:20 agent2.local.pem\r\n{noformat}\r\nI uninstalled PE fully from the master and reinstalled from scratch, resulting in the same errors.\r\nI have tested the current F5 module, the new F5 module and the Cisco device and they all have the same issue.\r\n","closed_at":"2014-03-17T10:53:47.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1839","labels":"","state":"Closed","updated_at":"2014-03-17T10:53:47.000-0700","timestamp":1652284692.619706,"priority":"Normal","status_category":"Done","pull_request":2417},{"issue_id":"18932","title":"Remove ca_days from --genconfig output","url":"https://tickets.puppetlabs.com/browse/PUP-759","created_at":"2013-11-14T14:34:08.000-0800","number":"PUP-759","body":"puppet master --gencofig gives me (for ca_ttl):\r\n\r\n    # The default TTL for new certificates. If this setting is set, ca_days is ignored.\r\n    # This setting can be a time interval in seconds (30 or 30s), minutes (30m), hours (6h), days (2d), or years (5y).\r\n    # The default value is '5y'.\r\n    ca_ttl = 157680000\r\n\r\nSince ca_days is no longer a setting, it should not be mentioned here.","closed_at":"2014-03-17T10:53:51.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-759","labels":"redmine","state":"Closed","updated_at":"2014-03-17T10:53:51.000-0700","timestamp":1652284693.146425,"priority":"Normal","status_category":"Done","pull_request":6025},{"issue_id":"24082","title":"msgpack serialization of TagSet broken","url":"https://tickets.puppetlabs.com/browse/PUP-1484","created_at":"2014-01-21T10:50:02.000-0800","number":"PUP-1484","body":null,"closed_at":"2014-03-17T10:53:51.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1484","labels":"","state":"Closed","updated_at":"2014-03-17T10:53:51.000-0700","timestamp":1652284693.358283,"priority":"Normal","status_category":"Done","pull_request":2287},{"issue_id":"26271","title":"Windows stat doesn't expose the correct mode","url":"https://tickets.puppetlabs.com/browse/PUP-1681","created_at":"2014-02-12T16:11:28.000-0800","number":"PUP-1681","body":"When trying to read the mode of a file in Windows, there are two separate code paths that might be used - Puppet::FileSystem.stat in our file system abstraction, and the more direct Puppet::Util::Windows::Security.get_mode.  For example\r\n\r\n{code}\r\nPuppet::FileSystem.stat('c:/inetpub').mode\r\n{code}\r\n\r\n{code}\r\nPuppet::Util::Windows::Security.get_mode('c:/inetpub')\r\n{code}\r\n\r\nAs part of discovery with PUP-1327, it was discovered that these two values are not aligning, and the lower-level get_mode call has the correct intended values.\r\n\r\n{panel}\r\nirb(main):008:0> (Puppet::FileSystem.stat('c:/target.txt').mode & 0777).to_s(8)\r\n=> \"644\"\r\nirb(main):009:0> (Puppet::Util::Windows::Security.get_mode('c:/target.txt') & 0777).to_s(8)\r\n=> \"700\"\r\n...\r\nirb(main):018:0> sd = Puppet::Util::Windows::Security.get_security_descriptor('c:/target.txt')\r\n=> BUILTIN\\Administrators\r\nWIN-QP47VOHA2P4\\None\r\n  BUILTIN\\Administrators:                       0x1f01ff\r\n  NT AUTHORITY\\SYSTEM:(I)                       0x1f01ff\r\n  BUILTIN\\Administrators:(I)                    0x1f01ff\r\n  BUILTIN\\Users:(I)                             0x1200a9\r\nirb(main):019:0> puts sd.inspect\r\nBUILTIN\\Administrators\r\nWIN-QP47VOHA2P4\\None\r\n  BUILTIN\\Administrators:                       0x1f01ff\r\n  NT AUTHORITY\\SYSTEM:(I)                       0x1f01ff\r\n  BUILTIN\\Administrators:(I)                    0x1f01ff\r\n  BUILTIN\\Users:(I)                             0x1200a9\r\n=> nil\r\n{panel}\r\n\r\nFurther details here:\r\nhttps://gist.github.com/joshcooper/8961050","closed_at":"2014-03-17T10:53:52.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1681","labels":"","state":"Closed","updated_at":"2014-03-17T10:53:52.000-0700","timestamp":1652284693.670663,"priority":"Blocker","status_category":"Done","pull_request":2350},{"issue_id":"26705","title":"Yumrepo doesn't permit HTTPS URLs","url":"https://tickets.puppetlabs.com/browse/PUP-1722","created_at":"2014-02-17T05:14:31.000-0800","number":"PUP-1722","body":"Since PUP-789, the yumrepo type doesn't permit HTTPS URLs in yumrepo definitions.  These are valid for base URLs, mirror lists etc and are used particularly by Fedora.\r\n\r\n{noformat}\r\n$ bin/puppet resource yumrepo test baseurl=https://example.com\r\nError: Could not run: Parameter baseurl failed on Yumrepo[test]: Must be a valid URL\r\nWrapped exception:\r\nMust be a valid URL\r\n{noformat}","closed_at":"2014-03-17T10:53:54.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1722","labels":"","state":"Closed","updated_at":"2014-03-17T10:53:54.000-0700","timestamp":1652284693.883283,"priority":"Normal","status_category":"Done","pull_request":2363},{"issue_id":"28727","title":"Error when manifest is a directory but not the same as manifestdir","url":"https://tickets.puppetlabs.com/browse/PUP-1944","created_at":"2014-03-13T18:10:43.000-0700","number":"PUP-1944","body":"In 3.5.0 we introduced a feature whereby the manifest setting was allowed to be a directory. However, if the manifest is set to a directory that is not the {{manifestdir}} directory, then the settings catalog tries to create a file resource to manage the directory as a file. This results in a failed settings catalog application and the master cannot start.\r\n\r\n{noformat}\r\n...\r\nDebug: /File[/etc/puppet/fileserver.conf]: Autorequiring File[/etc/puppet]\r\nDebug: /File[/var/lib/puppet/rrd]: Autorequiring File[/var/lib/puppet]\r\nDebug: /File[/var/lib/puppet/facts.d]: Autorequiring File[/var/lib/puppet]\r\nNotice: /File[/etc/puppet/manifests]: Not removing directory; use 'force' to override\r\nNotice: /File[/etc/puppet/manifests]: Not removing directory; use 'force' to override\r\nError: Could not set 'file' on ensure: Is a directory - /etc/puppet/manifests\r\nError: Could not set 'file' on ensure: Is a directory - /etc/puppet/manifests\r\nWrapped exception:\r\nIs a directory - /etc/puppet/manifests\r\nError: /File[/etc/puppet/manifests]/ensure: change from directory to file failed: Could not set 'file' on ensure: Is a directory - /etc/puppet/manifests\r\nDebug: Finishing transaction 10953320\r\nError: Could not prepare for execution: Got 1 failure(s) while initializing: File[/etc/puppet/manifests]: change from directory to file failed: Could not set 'file' on ensure: Is a directory - /etc/puppet/manifests\r\n[root@p5trqudb6uz5f70 puppet]#\r\n{noformat}\r\n\r\nIn the above example relevant portion of the puppet.conf is:\r\n{noformat}\r\n[master]\r\n    manifestdir=/tmp\r\n    manifest = /etc/puppet/manifests\r\n{noformat}\r\n","closed_at":"2014-03-25T10:21:48.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1944","labels":"","state":"Closed","updated_at":"2014-03-25T10:21:48.000-0700","timestamp":1652284695.791751,"priority":"Normal","status_category":"Done","pull_request":2461},{"issue_id":"29172","title":"Dynamic environments not working with manifestdir setting","url":"https://tickets.puppetlabs.com/browse/PUP-2009","created_at":"2014-03-19T14:36:19.000-0700","number":"PUP-2009","body":"Subsequent to http://projects.puppetlabs.com/issues/23373 being merged in, if you have a dynmaic manifestdir setting, such as:\r\n\r\nmanifestdir=$confdir/environments/$environment/manifests\r\n\r\nAnd your $confdir/environments does not have a $confdir/environments/manifests and is not writeable by puppet's user, then starting master will fail:\r\n\r\n{code}\r\nError: Could not prepare for execution: Got 1 failure(s) while initializing: File[/home/jpartlow/test/\r\nmaster/pe3195/environments/manifests]: change from absent to directory failed: Could not set 'director\r\ny' on ensure: Permission denied - /home/jpartlow/test/master/pe3195/environments/manifests\r\n/home/jpartlow/work/puppet/lib/puppet/settings.rb:943:in `block in use'\r\n/home/jpartlow/work/puppet/lib/puppet/resource/catalog.rb:176:in `apply'\r\n/home/jpartlow/work/puppet/lib/puppet/settings.rb:933:in `use'\r\n/home/jpartlow/work/puppet/lib/puppet/application/master.rb:260:in `setup'\r\n/home/jpartlow/work/puppet/lib/puppet/application.rb:370:in `block (3 levels) in run'\r\n/home/jpartlow/work/puppet/lib/puppet/application.rb:479:in `plugin_hook'\r\n/home/jpartlow/work/puppet/lib/puppet/application.rb:370:in `block (2 levels) in run'\r\n/home/jpartlow/work/puppet/lib/puppet/util.rb:479:in `exit_on_fail'\r\n/home/jpartlow/work/puppet/lib/puppet/application.rb:370:in `block in run'\r\n/home/jpartlow/work/puppet/lib/puppet/context.rb:51:in `override'\r\n/home/jpartlow/work/puppet/lib/puppet.rb:224:in `override'\r\n/home/jpartlow/work/puppet/lib/puppet/application.rb:362:in `run'\r\n/home/jpartlow/work/puppet/lib/puppet/util/command_line.rb:137:in `run'\r\n/home/jpartlow/work/puppet/lib/puppet/util/command_line.rb:91:in `execute'\r\n/home/jpartlow/work/puppet/bin/puppet:4:in `<top (required)>'\r\n/home/jpartlow/work/puppet/.bundle/gems/ruby/1.9.1/bin/puppet:23:in `load'\r\n/home/jpartlow/work/puppet/.bundle/gems/ruby/1.9.1/bin/puppet:23:in `<main>'\r\n{code}","closed_at":"2014-03-25T10:21:49.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2009","labels":"","state":"Closed","updated_at":"2014-03-25T10:21:49.000-0700","timestamp":1652284695.897675,"priority":"Normal","status_category":"Done","pull_request":2464},{"issue_id":"22900","title":"improve error message when File[undef] occurs","url":"https://tickets.puppetlabs.com/browse/PUP-1349","created_at":"2014-01-03T01:28:24.000-0800","number":"PUP-1349","body":"If you create a File resource from a variable that is not defined, the error message doesn't mention the position in the manifest nor the class name that the problematic resource occurs in. This makes it difficult to find out which File resource is broken.\r\n\r\n    $ echo 'file { $foo: ensure => present }' | puppet apply\r\n    Error: Failed to apply catalog: Parameter path failed on File[undef]: File paths must be fully qualified, not 'undef'\r\n","closed_at":"2014-03-26T12:36:03.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1349","labels":"redmine","state":"Closed","updated_at":"2014-03-26T12:36:03.000-0700","timestamp":1652284696.324513,"priority":"Normal","status_category":"Done","pull_request":2245},{"issue_id":"21431","title":"puppetdlock file can be empty","url":"https://tickets.puppetlabs.com/browse/PUP-1092","created_at":"2013-12-16T11:24:08.000-0800","number":"PUP-1092","body":"There seems to be something wrong with the way the $statedir/puppetdlock file is created.  Under normal circumstances, when puppetd is running, the file contains the PID of the running puppetd process.  For example:\r\n\r\n{noformat}\r\n$ cat /var/puppet/state/puppetdlock\r\n26898 [no newline at end of file]\r\n{noformat}\r\n\r\nIf puppetd crashes or is killed, then the file may be empty:\r\n\r\n{noformat}\r\n$ cat /var/puppet/state/puppetdlock\r\n[empty]\r\n$ ls -l /var/puppet/state/puppetdlock\r\n-rw-r--r--   1 root     root           0 Oct 28 14:32 /var/pupp/state/puppetdlock\r\n{noformat}\r\n\r\nThis causes future puppetd runs to fail with \"notice: Run of Puppet configuration client already in progress; skipping\".\r\n\r\nI suspect that the problem is that the lock file is created in such a way that a crash between creating the file and writing to the file leaves the file empty.  A safe technique is to write to a temporary file and then rename the temporary file, so that the actual lock file either does not exist, or exists with correct contents, but never exists with partial contents.\r\n\r\nAlso, the code that complains about \"client already in progress\" could be smarter; it should read the PID from the lock file and verify that the process is actually running.\r\n\r\nIf you need sample code, then see NetBSD's shlock(1) utility (http://cvsweb.netbsd.org/bsdweb.cgi/usr.bin/shlock/), which is derived from the code that was in HoneyDanBer UUCP.","closed_at":"2014-04-17T12:11:29.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1092","labels":"redmine","state":"Closed","updated_at":"2014-04-17T12:11:29.000-0700","timestamp":1652284714.034418,"priority":"Normal","status_category":"Done","pull_request":8761},{"issue_id":"24499","title":"ensure => absent on user resource with forcelocal => true does not work as expected.","url":"https://tickets.puppetlabs.com/browse/PUP-1510","created_at":"2014-01-24T08:30:19.000-0800","number":"PUP-1510","body":"Given:\r\n{code}\r\nuser { 'foo':\r\n  ensure => absent,\r\n  forcelocal => true,\r\n}\r\n{code}\r\nThe {{luserdel}} command should be run just like {{ensure => present}} uses {{luseradd}}. It appears the plumbing to do so is there but {{cmd[:localdelete]}} is never defined. Additionally, there are no references to {{luserdel}} which would be required to do the local user delete.\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/user/useradd.rb#L190","closed_at":"2014-04-21T15:11:46.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1510","labels":"","state":"Closed","updated_at":"2014-04-21T15:11:46.000-0700","timestamp":1652284714.657428,"priority":"Normal","status_category":"Done","pull_request":2354},{"issue_id":"24025","title":"mk_resource_methods getters can't deal with false","url":"https://tickets.puppetlabs.com/browse/PUP-1470","created_at":"2014-01-19T03:27:01.000-0800","number":"PUP-1470","body":"I was writing a type and associated provider and noticed that during a {{puppet resource type}} if a property is set to {{false}} it suddenly didn't show up in the output. \r\n\r\n{code}\r\n  def self.mk_resource_methods\r\n    [resource_type.validproperties, resource_type.parameters].flatten.each do |attr|\r\n      attr = attr.intern\r\n      next if attr == :name\r\n      define_method(attr) do\r\n        @property_hash[attr] || :absent\r\n      end\r\n\r\n      define_method(attr.to_s + \"=\") do |val|\r\n        @property_hash[attr] = val\r\n      end\r\n    end\r\n  end\r\n{code}\r\n\r\nWhen {{@protery_hash[attr]}} returns the value {{false}}, because a property is set to {{false}} it now becomes absent because we end up with {{false || :absent}}","closed_at":"2014-04-27T07:02:14.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1470","labels":"","state":"Closed","updated_at":"2014-04-27T07:02:14.000-0700","timestamp":1652284715.073727,"priority":"Normal","status_category":"Done","pull_request":2277},{"issue_id":"23431","title":"Mount resource error silently skipped at times when running as daemon","url":"https://tickets.puppetlabs.com/browse/PUP-1415","created_at":"2014-01-10T07:10:35.000-0800","number":"PUP-1415","body":"I have a host where puppet is running as daemon, refreshing every 30 minutes as per default, and a custom class is applied.\r\n\r\nThe class contains:\r\n\r\n# A \"file\" resource to ensure a directory is created.\r\n# A \"package\" resource to ensure the nfs-utils RPM is installed.\r\n# A \"mount\" resource to mount a NFS share into the directory created in 1 and add the related line to /etc/fstab. This resource requires resources 1 and 2.\r\n# A \"yumrepo\" resource which creates and enables a local yum repository whose files are located in the mounted share. This requires resource 3.\r\n\r\nThe host has a preexisting problem in its fstab file: there is one custom line which starts with leading spaces, which appears to be a somewhat invalid syntax (cannot find official docs about this, though).\r\n\r\nDue to this problem in fstab, any manual puppet run e.g. \"puppet agent --test\" fails when applying the mount resource and flushing the fstab file, which is ok (\"Could not evaluate: Field 'device' is required\").\r\n\r\nThe real problem happens with periodic automated runs: a first run correctly stops at the mount resource, but the second run terminates with no errors even though it cannot successfully mount the share, and what's worse, it even applies the yumrepo resource, thus ignoring the \"require\" parameter.\r\n\r\nA third run stops again on mount, while a fourth behaves like the second one, and so on. Puppet alternates endlessly between the two behaviours.\r\n\r\nThis is of course very confusing, and also leaves the machine in a broken state, with a configured repository which actually doesn't work.\r\n\r\nI attach the log obtained with \"--debug --verbose --logdest /var/log/puppet/debug.log\". It contains output from two subsequent runs: the first stops at the mount error, while the second one skips it and applies the yumrepo.","closed_at":"2014-05-06T04:55:13.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1415","labels":"","state":"Closed","updated_at":"2014-05-06T04:55:13.000-0700","timestamp":1652284716.839648,"priority":"Normal","status_category":"Done","pull_request":8878},{"issue_id":"27052","title":"Puppet module tool does not work on Solaris","url":"https://tickets.puppetlabs.com/browse/PUP-1749","created_at":"2014-02-21T14:44:07.000-0800","number":"PUP-1749","body":"The Puppet module tool currently doesn't work on Solaris 10 in the absence of specially installed GNU utilities (specifically, gtar is required). The current state is effectively \"workaround required\".\r\n\r\nSolaris 10 is a PE supported platform, and the module tool should work out of the box to enable local testing and module installation.\r\n\r\nHow the Puppet module tool currently fails on Solaris 10 is displayed below.\r\n\r\n{noformat}\r\n/opt/puppet/bin/puppet module install seteam/opencsw --module_repository=http://forgeapi.puppetlabs.com\r\nNotice: Preparing to install into /etc/puppetlabs/puppet/modules ...\r\nNotice: Downloading from http://forgeapi.puppetlabs.com ...\r\nError: Could not extract contents of module archive: Execution of 'tar xzf /var/opt/lib/pe-puppet/puppet-module/cache/seteam-opencsw20140221-10168-3p88ey --no-same-owner -C /var/opt/lib/pe-puppet/puppet-module/cache/tmp-unpacker20140221-10168-1nlhuor' returned 1: tar: z: unknown function modifier\r\nUsage: tar {c|r|t|u|x}[BDeEFhilmnopPqTvw@[0-7]][bfk][X...] [blocksize] [tarfile] [size] [exclude-file...] {file | -I include-file | -C directory file}...\r\n\r\nError: Try 'puppet help module install' for usage\r\n{noformat}","closed_at":"2014-05-06T11:35:36.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1749","labels":"","state":"Closed","updated_at":"2014-05-06T11:35:36.000-0700","timestamp":1652284718.084741,"priority":"Normal","status_category":"Done","pull_request":2378},{"issue_id":"28770","title":"use of 'attr' causes deprecation warning","url":"https://tickets.puppetlabs.com/browse/PUP-1954","created_at":"2014-03-14T13:49:39.000-0700","number":"PUP-1954","body":"This line of code ...\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/0061737bdbd1a70748c09328980fffe2bc843e41/lib/puppet/status.rb#L7\r\n\r\n... causes deprecation warning on newer versions of ruby, including JRuby.  The preferred way to write that is just {{attr_accessor}}.  See PE-3054 for more info.","closed_at":"2014-05-06T11:35:37.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1954","labels":"","state":"Closed","updated_at":"2014-05-06T11:35:37.000-0700","timestamp":1652284718.187953,"priority":"Normal","status_category":"Done","pull_request":2434},{"issue_id":"22783","title":"\"puppet resource service\" fails on Ubuntu ","url":"https://tickets.puppetlabs.com/browse/PUP-1332","created_at":"2014-01-01T17:48:53.000-0800","number":"PUP-1332","body":"I was following the puppet introduction at http://docs.puppetlabs.com/learning/ral.html using Ubuntu 13.10 Saucy Salamander. When I tried to run \"sudo puppet resource service\" I get the error:\r\n\r\nError: Could not run: Execution of '/sbin/status startpar-bridge' returned 1: status: Unknown parameter: JOB\r\n\r\nI'm using Puppet v3.4.1 from the Puppet repo, not the Ubuntu repos.\r\n\r\nI got similar results but with different services in the error message when I tried with Ubuntu 13.04 and 12.04.\r\n\r\nOn 13.04 (Raring Ringtail) using Puppet v3.4.1 from the Puppet repo I get\r\n\r\nError: Could not run: Execution of '/sbin/status idmapd-mounting' returned 1: status: Unknown parameter: MOUNTPOINT\r\n\r\nOn 12.04 (Precise Pangolin, LTS) using Puppet 3.1.1 that comes preinstalled on the Vagrant box at http://puppet-vagrant-boxes.puppetlabs.com/ubuntu-server-12042-x64-vbox4210.box I get\r\n\r\nError: Could not run: Execution of '/sbin/status portmap-wait' returned 1: status: Unknown parameter: WAITER\r\n\r\nIt seems to be the same root cause as http://projects.puppetlabs.com/issues/21478, which was \"fixed\" by https://github.com/puppetlabs/puppet/pull/1731, which looks like a bandaid for one particular instance of the problem rather than addressing the root cause. I don't know much about Upstart so I'm afraid I have no idea what exactly the real problem is or how to address it.","closed_at":"2014-05-06T11:35:40.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1332","labels":"","state":"Closed","updated_at":"2014-05-06T11:35:40.000-0700","timestamp":1652284718.60481,"priority":"Normal","status_category":"Done","pull_request":2475},{"issue_id":"25581","title":"Puppet excessively stats the filesystem when looking for defined types ","url":"https://tickets.puppetlabs.com/browse/PUP-1592","created_at":"2014-02-05T12:51:40.000-0800","number":"PUP-1592","body":"[~masterzen] and I realized that when puppet tries to resolve a defined type, it always tries to first find the defined type within all the plugin directories as it tries to first load it as a resource type and then as a defined type.\r\n\r\nWe should be able to avoid a lot of stats on the filesystem by simply changing the lookup order.\r\n\r\n[~masterzen] has some ideas for a patch.","closed_at":"2014-05-09T09:04:52.000-0700","comments":17,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1592","labels":"","state":"Closed","updated_at":"2014-05-09T09:04:52.000-0700","timestamp":1652284718.933312,"priority":"Normal","status_category":"Done","pull_request":2373},{"issue_id":"35346","title":"PMT will not install puppetlabs/openstack 4.0.0","url":"https://tickets.puppetlabs.com/browse/PUP-2562","created_at":"2014-05-13T11:47:34.000-0700","number":"PUP-2562","body":"Attempting to install {{puppetlabs/openstack --version 4.0.0}} fails under the 3.6.0 release candidate, but succeeds under Puppet 3.5.0.  There is no good reason why this should fail.","closed_at":"2014-05-14T13:01:06.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2562","labels":"","state":"Closed","updated_at":"2014-05-14T13:01:06.000-0700","timestamp":1652284719.253546,"priority":"Blocker","status_category":"Done","pull_request":2648},{"issue_id":"35337","title":"PMT may deadlock when packing or unpacking large tarballs","url":"https://tickets.puppetlabs.com/browse/PUP-2561","created_at":"2014-05-13T11:37:23.000-0700","number":"PUP-2561","body":"Due to changes that were pulled into the 3.6.0 release candidate, some large  tarballs may cause the IO pipeline to fill up prematurely, which blocks all subsequent writes.  Since reads are waiting for writes to finish, this causes module installation and upgrades to hang.","closed_at":"2014-05-14T13:48:17.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2561","labels":"","state":"Closed","updated_at":"2014-05-14T13:48:17.000-0700","timestamp":1652284719.357907,"priority":"Blocker","status_category":"Done","pull_request":2645},{"issue_id":"29210","title":"have test repos pushed to hosts during acceptance testing ","url":"https://tickets.puppetlabs.com/browse/PUP-2010","created_at":"2014-03-19T16:19:33.000-0700","number":"PUP-2010","body":"Currently, in install_utils.rb, repos are pulled directly from the individual test hosts.  This does not work for hosts that live outside our internal network and are unable to reach builds.puppetlabs.lan.  \r\n\r\nBy changing around the logic so that the puppet master node pulls the repos and then pushes them to the test hosts we can test packaged builds in the cloud.","closed_at":"2014-05-15T15:34:48.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2010","labels":"","state":"Closed","updated_at":"2014-05-15T15:34:48.000-0700","timestamp":1652284719.985971,"priority":"Normal","status_category":"Done","pull_request":2456},{"issue_id":"34512","title":"Failed compilation does not populate environment, transaction_uuid in report","url":"https://tickets.puppetlabs.com/browse/PUP-2508","created_at":"2014-05-07T07:02:33.000-0700","number":"PUP-2508","body":"Seems that the transaction_uuid and environment is not populated in a report submission from the agent when the catalog fails to compile. Looking at various other patches around this it looks like at least the environment was intended to appear here but the existing code doesn't achieve this.\r\n\r\ntransaction_uuid on the other hand I believe was just never added to the correct places for this to ever work.\r\n\r\nThis has surfaced because of PDB-16, we're trying to pass on the status of a failed run in a report but currently we make 'environment' mandatory. Obviously one temporary solution for PDB is to make this optional.\r\n\r\nMy current fix is something like this: https://gist.github.com/kbarber/515440b085a627ff573a. Let me see if I can put this into a patch.","closed_at":"2014-05-22T16:07:01.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2508","labels":"","state":"Closed","updated_at":"2014-05-22T16:07:01.000-0700","timestamp":1652284732.498971,"priority":"Normal","status_category":"Done","pull_request":2626},{"issue_id":"33259","title":"Add extra info to property's return","url":"https://tickets.puppetlabs.com/browse/PUP-2369","created_at":"2014-04-27T02:04:32.000-0700","number":"PUP-2369","body":"When working with boolean types in providers it happens too often that the values being passed around aren't what we think they are leading the developer down a twisty road of despair while trying to figure out why his methods aren't working.","closed_at":"2014-06-05T13:48:19.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2369","labels":"","state":"Closed","updated_at":"2014-06-05T13:48:19.000-0700","timestamp":1652284736.189856,"priority":"Trivial","status_category":"Done","pull_request":2628},{"issue_id":"36956","title":"purging ssh_authorized_key fails because of missing user value","url":"https://tickets.puppetlabs.com/browse/PUP-2660","created_at":"2014-05-25T12:20:56.000-0700","number":"PUP-2660","body":"Given the file _/tmp/keytest_ with content\r\n{noformat}\r\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCpIyCCUkkW4CancW11RlGGmcHyIFtwsgIMQGAdBe3WCc+W9MtZDFEFi3XdHQnSRpbsUuiKhiUIKQfuTWXueWIPxtG+Ujde7Ch5MYPbRZ9MDzSYz2MU8/Ir/y7vNLZBadAR131Ok35qL12TMI0Hpzu2o9Y5ZMaf0uoApZAlotJgSsmFAJyq3rdIeIIpdEvTa3C8Yk9ng1p9Dv3nHdx/SpomFIO7rIKIp/vnxplDMBzU7c3akmbI5G3adcRVbZaxiBgJ4X5OKancyq25jqQtduQmgmDOsyr9+DbhcuUafmHpk/lLQ9c8VgvyqbJBaJ7N45NlBGkaZy/frdSeJ+HSEXTr foreman-122dc11d6-bd1e-43e7-a00d-f8e2d0af54ea\r\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC81jWIxrZpzL+IFE9S4yJNMrANeOJke0CbFmk8pBz4rI8RZ+1JBZdD5aZnO15nLVYZlQq1D8BLHy3F02EhfmQBINHUPA373SUedEUPqByQBOslp11sK/u0Op0X7hhW902hOFRszb9VODJifWnkB2bj4FDED6zQf8cIeTIO15CyYxPPeT/EBZ9G4RJsAItXf2ktwWaO94FGcnNYMUzvpsJCMwI4XY8ArqQBsRSrGnauhBD3e1MuqnLF4ujOqLYBwfZ5gw5VSar5i/oSsGswgwjKxmuO0hfTxDVROoIn24AHSTm38lF34djEWIASELEWxDjnFDamawfU2Dpm2MK90Jk/ doug\r\n{noformat}\r\nthe following invocation should remove the _foreman_ key\r\n{code}\r\npuppet apply -e 'user { \"foo\": purge_ssh_keys => \"/tmp/keytest\", }'\r\n{code}\r\nbut it fails with\r\n{noformat}\r\nNotice: /Stage[main]/Main/Ssh_authorized_key[foreman-122dc11d6-bd1e-43e7-a00d-f8e2d0af54ea]/ensure: removed\r\nError: /Stage[main]/Main/Ssh_authorized_key[foreman-122dc11d6-bd1e-43e7-a00d-f8e2d0af54ea]: Could not evaluate: Cannot write SSH authorized keys without user\r\n{noformat}","closed_at":"2014-06-10T11:35:46.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2660","labels":"","state":"Closed","updated_at":"2014-06-10T11:35:46.000-0700","timestamp":1652284736.517313,"priority":"Normal","status_category":"Done","pull_request":2697},{"issue_id":"36713","title":"user purge_ssh_keys not purged","url":"https://tickets.puppetlabs.com/browse/PUP-2635","created_at":"2014-05-22T08:01:05.000-0700","number":"PUP-2635","body":"I'm using Puppet 3.6.0 on Ubuntu 12.04 and I'm trying to purge unmanaged ssh authorized keys.\r\n\r\nI've added this code to my manifest:\r\n\r\n{code}\r\nuser { 'ubuntu': \r\n  purge_ssh_keys => true, \r\n  home => '/home/ubuntu', \r\n}\r\n{code}\r\n\r\nHowever, no keys are purged. I do see the following lines in the agent debug output:\r\n\r\n{noformat}\r\nDebug: /Stage[main]/Role::Search/Ssh_authorized_key[key2purge1]: Nothing to manage: no ensure and the resource doesn't exist\r\nDebug: /Stage[main]/Role::Search/Ssh_authorized_key[key2purge2]: Nothing to manage: no ensure and the resource doesn't exist\r\n{noformat}\r\n\r\nThose are the two keys that I expect would be purged. It appears that puppet has correctly identified the keys to purge, and created resources for them, but did not ensure => absent.","closed_at":"2014-06-10T13:27:54.000-0700","comments":18,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2635","labels":"","state":"Closed","updated_at":"2014-06-10T13:27:54.000-0700","timestamp":1652284736.631717,"priority":"Normal","status_category":"Done","pull_request":2707},{"issue_id":"39565","title":"'puppetca' needs feature to remove (/revoke) a pending certificate signing request","url":"https://tickets.puppetlabs.com/browse/PUP-2801","created_at":"2014-06-18T05:02:24.000-0700","number":"PUP-2801","body":"It is not possible to remove a pending certificate signing request with 'puppetca --revoke $fqdn':\r\n\r\n<pre>\r\n[root@X puppet]# puppetca --list\r\nrhel32bit.x.local\r\n[root@X puppet]# puppetca --revoke rhel32bit.x.local\r\nrhel32bit.x.local\r\nnotice: Revoked certificate with serial # Inventory of signed certificates\r\n\r\nerr: Could not call revoke: Cannot convert into OpenSSL::BN\r\n</pre>\r\n\r\nYou have to remove the certificate signing request manually. 'puppetca' should (IMO) do this.","closed_at":"2014-06-19T14:14:06.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2801","labels":"customer;redmine","state":"Closed","updated_at":"2014-06-19T14:14:06.000-0700","timestamp":1652284737.752402,"priority":"Normal","status_category":"Done","pull_request":2783},{"issue_id":"22586","title":"Default file mode is now 0600 instead of 0644","url":"https://tickets.puppetlabs.com/browse/PUP-1255","created_at":"2013-12-27T04:05:18.000-0800","number":"PUP-1255","body":"As of Puppet 3.4.1 and 2.7.24, the default file mode when no mode is explicitly specified on a file resource has changed from 0644 to 0600.  It appears from the commits (https://github.com/puppetlabs/puppet/commit/65909fbe and 691fbbeaa) that this was not the intention.\r\n\r\n{noformat}\r\n# rpm -q puppet\r\npuppet-3.4.0-1.el6.noarch\r\n# puppet apply -e 'file { \"/tmp/a\": content => \"foo\" }'\r\nNotice: Compiled catalog for foreman.example.com in environment production in 0.04 seconds\r\nNotice: /Stage[main]/Main/File[/tmp/a]/ensure: defined content as '{md5}acbd18db4cc2f85cedef654fccc4a4d8'\r\nNotice: Finished catalog run in 0.07 seconds\r\n# ll /tmp/a\r\n-rw-r--r-- 1 root root 3 Dec 27 12:01 /tmp/a\r\n\r\n# rpm -q puppet\r\npuppet-3.4.1-1.el6.noarch\r\n# puppet apply -e 'file { \"/tmp/a\": content => \"foo\" }'\r\nNotice: Compiled catalog for foreman.example.com in environment production in 0.04 seconds\r\nNotice: /Stage[main]/Main/File[/tmp/a]/ensure: defined content as '{md5}acbd18db4cc2f85cedef654fccc4a4d8'\r\nNotice: Finished catalog run in 0.08 seconds\r\n# ll /tmp/a\r\n-rw------- 1 root root 3 Dec 27 11:58 /tmp/a\r\n{noformat}","closed_at":"2014-07-28T05:10:15.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1255","labels":"","state":"Closed","updated_at":"2014-07-28T05:10:15.000-0700","timestamp":1652284740.140186,"priority":"Normal","status_category":"Done","pull_request":2211},{"issue_id":"10951","title":"(19727) Duplicate file resource detection/path validation weirdness with multiple slashes in paths","url":"https://tickets.puppetlabs.com/browse/PUP-12","created_at":"2013-06-17T17:23:42.000-0700","number":"PUP-12","body":"Puppet is not predictable when multiple slashes are at the front of a file path. Specifically, the File resource does not discriminate between `//foo` and `/foo` and treats them as two different resources. ","closed_at":"2014-07-28T09:53:27.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-12","labels":"redmine","state":"Resolved","updated_at":"2014-07-28T09:53:27.000-0700","timestamp":1652284741.436213,"priority":"Minor","status_category":"Done","pull_request":8172},{"issue_id":"14109","title":"ParsedFile providers do not clear failed flush operations from their queues","url":"https://tickets.puppetlabs.com/browse/PUP-288","created_at":"2013-09-04T09:05:08.000-0700","number":"PUP-288","body":"Providers based on ParsedFile batch up write operations for the files they manage and place them in a queue. At the end of resource processing, the provider class iterates through the queue and flushes each batch of writes to disk.\n\nThe problem is: if one batch of operations fails to flush an exception is raised which causes the program to jump over the code that clears out the queue. This results in failing jobs stuck at the front of the queue which causes all successive resources to fail. Even worse, successive resources fail with the error message of the failed resource which makes it appear that Puppet is attempting to write every ParsedFile resource to a single file. This is very confusing.","closed_at":"2014-07-28T09:53:30.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-288","labels":"","state":"Resolved","updated_at":"2014-07-28T09:53:30.000-0700","timestamp":1652284741.654371,"priority":"Major","status_category":"Done","pull_request":6713},{"issue_id":"14614","title":"Apt package ensure absent/purged causes warnings on 3.3.0","url":"https://tickets.puppetlabs.com/browse/PUP-337","created_at":"2013-09-13T09:52:39.000-0700","number":"PUP-337","body":"Redmine #22529","closed_at":"2014-07-28T09:53:37.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-337","labels":"","state":"Resolved","updated_at":"2014-07-28T09:53:37.000-0700","timestamp":1652284741.871315,"priority":"Critical","status_category":"Done","pull_request":3375},{"issue_id":"35786","title":"Enable TLSv1.2 in apache vhost config","url":"https://tickets.puppetlabs.com/browse/PUP-2582","created_at":"2014-05-15T15:25:13.000-0700","number":"PUP-2582","body":"Our apache vhost configuration is used when building passenger packages on debian. It was added in [d85d73c|https://github.com/puppetlabs/puppet/commit/d85d73c570a60891607d2ce5b42dba4617f4ca6c] and hasn't been updated since. Thanks goes to [~azet] for bringing this to our attention in PUP-2177.\r\n\r\nHowever, we've run into a problem creating a single ciphersuite string that works correctly in openssl versions 0.9.7m <= version < 1.0.0a, and versions >= 1.0.0a. See discussion at https://github.com/puppetlabs/puppet/pull/2494 and http://marc.info/?l=openssl-dev&m=139993778731161&w=2\r\n\r\nWe would like to merge a subset of the changes proposed in PUP-2177 for immediate release in 3.6.1. Specifically, adding support for TLSv1.2, removing AECDH, and other insecure algorithms, e.g DES, MD5.\r\n\r\nOnce the compatibility issues described in PR 2494 are resolved, we'll bring in those changes, which optimize for even greater security, such as PFS.","closed_at":"2014-07-28T09:57:23.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2582","labels":"","state":"Closed","updated_at":"2014-07-28T09:57:23.000-0700","timestamp":1652284742.195806,"priority":"Normal","status_category":"Done","pull_request":2657},{"issue_id":"11303","title":"Runinterval setting broken on Windows with ruby 1.9","url":"https://tickets.puppetlabs.com/browse/PUP-58","created_at":"2013-06-24T17:29:01.000-0700","number":"PUP-58","body":"See https://projects.puppetlabs.com/issues/21043","closed_at":"2014-09-04T10:29:43.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-58","labels":"","state":"Resolved","updated_at":"2014-09-04T10:29:43.000-0700","timestamp":1652284755.18306,"priority":"Major","status_category":"Done","pull_request":8824},{"issue_id":"37819","title":"Audit of mtime/ctime for files on ext4 reports spurious changes (only ruby 1.9+)","url":"https://tickets.puppetlabs.com/browse/PUP-2710","created_at":"2014-06-02T08:49:22.000-0700","number":"PUP-2710","body":"{noformat}\r\n[root@master323-centos ~]# puppet --version\r\n3.4.3 (Puppet Enterprise 3.2.3)\r\n[root@master323-centos ~]# /opt/puppet/bin/ruby --version\r\nruby 1.9.3p484 (2013-11-22 revision 43786) [x86_64-linux]\r\n[root@master323-centos ~]# mkdir /tmp/test/\r\n[root@master323-centos ~]# puppet apply -e \"file { '/tmp/test/watch_me': ensure => directory, audit => [ 'mtime', 'ctime' ] }\"\r\nNotice: Compiled catalog for master323-centos in environment production in 0.17 seconds\r\nNotice: /Stage[main]/Main/File[/tmp/test/watch_me]/ensure: created\r\nNotice: Finished catalog run in 0.33 seconds\r\n[root@master323-centos ~]# puppet apply -e \"file { '/tmp/test/watch_me': ensure => directory, audit => [ 'mtime', 'ctime' ] }\"\r\nNotice: Compiled catalog for master323-centos in environment production in 0.18 seconds\r\nNotice: /Stage[main]/Main/File[/tmp/test/watch_me]/mtime: audit change: previously recorded value absent has been changed to 2014-05-29 18:38:33 +0000\r\nNotice: /Stage[main]/Main/File[/tmp/test/watch_me]/ctime: audit change: previously recorded value absent has been changed to 2014-05-29 18:38:33 +0000\r\nNotice: Finished catalog run in 0.31 seconds\r\n[root@master323-centos ~]# puppet apply -e \"file { '/tmp/test/watch_me': ensure => directory, audit => [ 'mtime', 'ctime' ] }\"\r\nNotice: Compiled catalog for master323-centos in environment production in 0.16 seconds\r\nNotice: /Stage[main]/Main/File[/tmp/test/watch_me]/mtime: audit change: previously recorded value 2014-05-29 18:38:33 +0000 has been changed to 2014-05-29 18:38:33 +0000\r\nNotice: /Stage[main]/Main/File[/tmp/test/watch_me]/ctime: audit change: previously recorded value 2014-05-29 18:38:33 +0000 has been changed to 2014-05-29 18:38:33 +0000\r\nNotice: Finished catalog run in 0.34 seconds\r\n[root@master323-centos ~]# puppet apply -e \"file { '/tmp/test/watch_me': ensure => directory, audit => [ 'mtime', 'ctime' ] }\"\r\nNotice: Compiled catalog for master323-centos in environment production in 0.19 seconds\r\nNotice: /Stage[main]/Main/File[/tmp/test/watch_me]/mtime: audit change: previously recorded value 2014-05-29 18:38:33 +0000 has been changed to 2014-05-29 18:38:33 +0000\r\nNotice: /Stage[main]/Main/File[/tmp/test/watch_me]/ctime: audit change: previously recorded value 2014-05-29 18:38:33 +0000 has been changed to 2014-05-29 18:38:33 +0000\r\nNotice: Finished catalog run in 0.32 seconds\r\n{noformat}\r\n","closed_at":"2014-09-04T13:29:13.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2710","labels":"","state":"Closed","updated_at":"2014-09-04T13:29:13.000-0700","timestamp":1652284756.220566,"priority":"Normal","status_category":"Done","pull_request":2727},{"issue_id":"35605","title":"Mac OS X version comparison fails spuriously","url":"https://tickets.puppetlabs.com/browse/PUP-2577","created_at":"2014-05-14T19:39:56.000-0700","number":"PUP-2577","body":"Hypothetical future versions of Mac OS X, after Mavericks (OS X 10.9) would probably be numbered '10.10.x', causing macosx_productversion_major to return 10.10. This would cause Puppet not to run on this operatingsystem, because although most of the version checks in {{lib/puppet/provider/nameservice/directoryservice.rb}} use the safe Puppet::Util::Package.versioncmp method, the one which determines whether Puppet can run at all ({{fail_if_wrong_version}}) does a naïve string comparison which triggers an amusing Ruby WAT:\r\n\r\n{code}\r\nirb(main):001:0> \"10.10\" > \"10.5\"\r\n=> false\r\nirb(main):002:0> \"10.9\" > \"10.5\"\r\n=> true\r\n{code}\r\n\r\nPure speculation might lead one to conclude that this check should use the same versioncmp helper that the rest of the directoryservice methods use.","closed_at":"2014-09-04T13:29:15.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2577","labels":"","state":"Closed","updated_at":"2014-09-04T13:29:15.000-0700","timestamp":1652284756.53202,"priority":"Normal","status_category":"Done","pull_request":2726},{"issue_id":"32323","title":"ArgumentErrors in file_server config parser are swallowed by raising the error wrong","url":"https://tickets.puppetlabs.com/browse/PUP-2303","created_at":"2014-04-18T11:09:57.000-0700","number":"PUP-2303","body":"Within the parser for the file_serving config, multiple ArgumentErrors are raised with the wrong amount of arguments, raising a different ArgumentError.\r\n\r\nLike: Yo dawg, I heard you like ArgumentErrors so I put an ArgumentError in your ArgumentError.\r\n\r\nPR coming.","closed_at":"2014-09-04T13:29:16.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2303","labels":"","state":"Closed","updated_at":"2014-09-04T13:29:16.000-0700","timestamp":1652284756.634379,"priority":"Normal","status_category":"Done","pull_request":2553},{"issue_id":"34406","title":"Error when evaluating #type in Puppet::Error message interpolation for Puppet::Resource::Ral","url":"https://tickets.puppetlabs.com/browse/PUP-2506","created_at":"2014-05-06T13:26:43.000-0700","number":"PUP-2506","body":"The bug is triggered when the Puppet::Error string is interpolated. The #type method is called recursively and fails with an ArgumentError: wrong number of arguments (0 for 1).\r\n\r\n{code:none}\r\n  def type( request )\r\n    Puppet::Type.type(type_name(request)) or raise Puppet::Error, \"Could not find type #{type}\"\r\n  end\r\n{code}\r\nbq. https://github.com/puppetlabs/puppet/blob/master/lib/puppet/indirector/resource/ral.rb#L62","closed_at":"2014-09-04T13:29:18.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2506","labels":"","state":"Closed","updated_at":"2014-09-04T13:29:18.000-0700","timestamp":1652284756.844247,"priority":"Trivial","status_category":"Done","pull_request":2719},{"issue_id":"29852","title":"unless_uid on user is completely broken wrt ranges","url":"https://tickets.puppetlabs.com/browse/PUP-2031","created_at":"2014-03-25T02:13:24.000-0700","number":"PUP-2031","body":"A PR was merged in PUP-1447 that adds an unless_uid option. However, the implementation is completely broken:\r\n\r\nThis works:\r\n{noformat}\r\n  resources { 'user':\r\n    purge              => true,\r\n    unless_system_user => true,\r\n    unless_uid         => 20000,\r\n  }\r\n{noformat}\r\n\r\nBroken:\r\n{noformat}\r\n  resources { 'user':\r\n    purge              => true,\r\n    unless_system_user => true,\r\n    unless_uid         => 20000..39999,\r\n  }\r\nError: Could not retrieve catalog from remote server: Error 400 on SERVER: Syntax error at '.'; expected '}\r\n{noformat}\r\n\r\nBroken:\r\n{noformat}\r\n  resources { 'user':\r\n    purge              => true,\r\n    unless_system_user => true,\r\n    unless_uid         => [20000..29999, 30000..39999],\r\n  }\r\nError: Could not retrieve catalog from remote server: Error 400 on SERVER: Syntax error at '.'; expected ']'\r\n{noformat}\r\n\r\nBroken:\r\n{noformat}\r\n  resources { 'user':\r\n    purge              => true,\r\n    unless_system_user => true,\r\n    unless_uid         => ['20000..29999', '30000..39999'],\r\n  }\r\nError: /Stage[main]/Users::Resources/Resources[user]: Failed to generate additional resources using 'generate': can't convert Fixnum into String\r\n{noformat}","closed_at":"2014-09-04T13:29:25.000-0700","comments":33,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2031","labels":"","state":"Closed","updated_at":"2014-09-04T13:29:25.000-0700","timestamp":1652284757.168386,"priority":"Major","status_category":"Done","pull_request":2652},{"issue_id":"40767","title":"Read UID_MIN from /etc/login.defs (if available) instead of hardcoding minimum.","url":"https://tickets.puppetlabs.com/browse/PUP-2866","created_at":"2014-06-30T12:44:47.000-0700","number":"PUP-2866","body":null,"closed_at":"2014-09-04T13:29:25.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2866","labels":"","state":"Closed","updated_at":"2014-09-04T13:29:25.000-0700","timestamp":1652284757.276487,"priority":"Normal","status_category":"Done","pull_request":2824},{"issue_id":"40056","title":"Description of disable_warnings setting is incomplete","url":"https://tickets.puppetlabs.com/browse/PUP-2822","created_at":"2014-06-23T10:39:44.000-0700","number":"PUP-2822","body":"The description currently reads:\r\n\r\n{quote}\r\nA list of warning types to disable. Currently the only warning type that can be disabled are deprecations, but more warning types may be added later.\r\n{quote}\r\n\r\nThis needs a clearly labeled list of keywords; right now, the user has to guess. It could also use some context about why you would want to do this. ","closed_at":"2014-09-04T13:29:30.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2822","labels":"","state":"Closed","updated_at":"2014-09-04T13:29:30.000-0700","timestamp":1652284757.379889,"priority":"Normal","status_category":"Done","pull_request":2793},{"issue_id":"13338","title":"User provider password_max_age attribute is flawed under Solaris","url":"https://tickets.puppetlabs.com/browse/PUP-229","created_at":"2013-08-14T15:13:26.000-0700","number":"PUP-229","body":"A user reported this, and did an excellent write up of the issue and a possible fix, so I'm just going to paste that: \r\n\r\nThe password_max_age logic is flawed on Solaris.  At first, it seems to work:\r\n\r\n{noformat}\r\n# tail -1 /etc/passwd\r\nfoobar:x:911:911::/home/foobar:/bin/sh\r\n\r\n# tail -1 /etc/shadow\r\nfoobar:GI2XGzW0DitJk:15931::182:28:::\r\n{noformat}\r\n\r\nExcerpt from Puppet manifest:\r\n\r\n{code}\r\nuser { 'foobar':\r\n  uid => 911,\r\n  gid => 911,\r\n  password_max_age => -1,  <<<<<<<<<<\r\n  ensure => present,\r\n}\r\n{code}\r\n\r\n{noformat}\r\n# /opt/puppet/bin/puppet agent --test\r\n...\r\nnotice: /Stage[main]/Site::Common/User[foobar]/password_max_age: password_max_age changed '182' to '-1'\r\n\r\nroot@its-au-psnpdevap4:/export/home/e05593 # tail -1 /etc/shadow\r\nfoobar:GI2XGzW0DitJk:15931::::::\r\n{noformat}\r\n\r\nSo far so good ... password expiration was removed properly and subsequent puppet runs are quiet.  The problem occurs after a failed login attempt:\r\n\r\n{noformat}\r\nroot@its-au-psnpdevap4:/export/home/e05593 # tail -1 /etc/shadow\r\nfoobar:GI2XGzW0DitJk:15931::::::1\r\n{noformat}\r\n\r\nNotice the last field is now {{1}} indicating 1 failed login.  Puppet will now wrongly claim that password expiration is enabled ... and all subsequent Puppet runs attempt to remove it: \r\n{noformat}\r\n# /opt/puppet/bin/puppet agent --test\r\n...\r\nnotice: /Stage[main]/Site::Common/User[foobar]/password_max_age: password_max_age changed '' to '-1'\r\n{noformat}\r\n\r\nThe logic error is in {{user_role_add.rb}}.  The following patch seems to fix the problem:\r\n{noformat}\r\n--- /opt/puppet/lib/ruby/site_ruby/1.8/puppet/provider/user/user_role_add.rb   2013-06-08 07:47:48.000000000 +1000\r\n+++ user_role_add.rb    2013-08-14 16:55:46.347435848 +1000\r\n@@ -174,7 +174,7 @@\r\n\r\n   def password_max_age\r\n     return :absent unless shadow_entry\r\n-    shadow_entry[4] || -1\r\n+    (shadow_entry[4].nil? || shadow_entry[4].empty?) ? -1 : shadow_entry[4]\r\n   end\r\n\r\n   # Read in /etc/shadow, find the line for our used and rewrite it with the\r\n{noformat}\r\n\r\nPersonally, I find it confusing to have nil array elements, because shadow should always have 9 fields.  I would probably have populated @shadow_entry as follows:\r\n{noformat}\r\n--- /opt/puppet/lib/ruby/site_ruby/1.8/puppet/provider/user/user_role_add.rb   2013-06-08 07:47:48.000000000 +1000\r\n+++ user_role_add.rb    2013-08-14 17:01:14.141392541 +1000\r\n@@ -160,7 +160,7 @@\r\n     return @shadow_entry if defined? @shadow_entry\r\n     @shadow_entry = File.readlines(target_file_path).\r\n       reject { |r| r =~ /^[^\\w]/ }.\r\n-      collect { |l| l.chomp.split(':') }.\r\n+      collect { |l| l.chomp.split(':', -1) }.\r\n       find { |user, _| user == @resource[:name] }\r\n   end\r\n{noformat}\r\n\r\nNote that the original logic error would have been obvious if this approach had been used.  It would also render {{.nil?}} checks unnecessary ... assuming an array length sanity check after the file is read.","closed_at":"2014-09-04T13:29:33.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-229","labels":"puppet","state":"Closed","updated_at":"2014-09-04T13:29:33.000-0700","timestamp":1652284757.586876,"priority":"Normal","status_category":"Done","pull_request":2549},{"issue_id":"29228","title":"Make gem provider match on a single gem name","url":"https://tickets.puppetlabs.com/browse/PUP-2014","created_at":"2014-03-20T04:58:18.000-0700","number":"PUP-2014","body":"*Old Way*\r\n\r\nGem provider would continuously upgrade bundler because it would match on {{0.1.0}} not {{1.5.3}}.\r\n\r\n{{gem list --remote bundler$}}\r\n\r\nREMOTE GEMS\r\nappbundler (0.1.0)\r\nasset_bundler (0.2.0)\r\nassetbundler (0.0.0)\r\natd-asset_bundler (0.0.3)\r\nbowline-bundler (0.0.4)\r\nbundler (1.5.3)\r\ncapistrano-bundler (1.1.2)\r\ncapistrano-ext-rvm-bundler (0.0.2)\r\nctags-bundler (0.0.1)\r\ngem_bundler (0.2)\r\nguard-bundler (2.0.0)\r\nguard-ctags-bundler (1.0.2)\r\nhello_world_bundler (0.1.2)\r\nhoe-bundler (1.2.0)\r\njbundler (0.5.5)\r\nmoneypools-bundler (0.8.1)\r\nmotion-bundler (0.2.1)\r\nmpapis-bundler (1.0.21.1)\r\nofxbundler (0.2.8)\r\nperitor-bundler (0.7.0)\r\nquick-bundler (0.0.3)\r\nrails-assets-bundler (0.0.1)\r\nrubygems-bundler (1.4.2)\r\nrubysl-bundler (2.0.0)\r\nsmart_bundler (0.0.1)\r\ntvd-bundler (0.0.8)\r\nunbundler (0.0.2)\r\nvagrant-bundler (0.1.1)\r\nvagrant-plugin-bundler (0.1.1)\r\nvim-bundler (0.3.0)\r\nweb_resource_bundler (0.0.23)\r\nwidget_bundler (0.0.10)\r\n\r\n*Proposed New Way*\r\n\r\nReturns only the specific gem.\r\n\r\n{{gem list --remote ^bundler$}}\r\n\r\nREMOTE GEMS\r\nbundler (1.5.3)","closed_at":"2014-09-04T13:29:34.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2014","labels":"","state":"Closed","updated_at":"2014-09-04T13:29:34.000-0700","timestamp":1652284757.690263,"priority":"Normal","status_category":"Done","pull_request":2455},{"issue_id":"40380","title":"Limit platforms on which Gemfile tries to install ruby-prof","url":"https://tickets.puppetlabs.com/browse/PUP-2842","created_at":"2014-06-25T11:49:18.000-0700","number":"PUP-2842","body":"The ruby-prof gem is not applicable on all platforms (e.g., jruby).  However, the Gemfile attempts to install it unconditionally.","closed_at":"2014-09-04T13:29:35.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2842","labels":"","state":"Closed","updated_at":"2014-09-04T13:29:35.000-0700","timestamp":1652284757.794423,"priority":"Normal","status_category":"Done","pull_request":2808},{"issue_id":"33483","title":"Deprecate `recurse => inf` for file type","url":"https://tickets.puppetlabs.com/browse/PUP-2379","created_at":"2014-04-28T14:32:03.000-0700","number":"PUP-2379","body":"This was an old synonym for `recurse => true`, but it only makes sense in a world where you can also set integer values for `recurse` instead of using `recurselimit`... which you can't do, anymore. ","closed_at":"2014-09-04T13:29:35.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2379","labels":"","state":"Closed","updated_at":"2014-09-04T13:29:35.000-0700","timestamp":1652284757.898861,"priority":"Normal","status_category":"Done","pull_request":2939},{"issue_id":"43434","title":"install_options are not passed to yum when listing packages","url":"https://tickets.puppetlabs.com/browse/PUP-2971","created_at":"2014-07-24T09:51:36.000-0700","number":"PUP-2971","body":"According to reports in PUP-1060, the enablerepo and disablerepo options are no longer working. At least one of the reports points out that the {{install_options}} is not longer passed to the yum command that lists packages.  This results in packages not being found in enabled repos.\r\n\r\n","closed_at":"2014-09-04T13:29:36.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2971","labels":"","state":"Closed","updated_at":"2014-09-04T13:29:36.000-0700","timestamp":1652284758.005376,"priority":"Normal","status_category":"Done","pull_request":2934},{"issue_id":"39177","title":"'puppet module generate' create not compatible metadata.json with forge","url":"https://tickets.puppetlabs.com/browse/PUP-2781","created_at":"2014-06-14T12:34:48.000-0700","number":"PUP-2781","body":"When one generate module by puppet it automaticlly adds version_range instead of version_requirement which is required to publish module\r\n\r\n{code}\r\n\"dependencies\": [\r\n{ \"name\": \"puppetlabs-stdlib\", \"version_range\": \">= 1.0.0\" }\r\n\r\n]\r\n{code}","closed_at":"2014-09-04T13:29:38.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2781","labels":"","state":"Closed","updated_at":"2014-09-04T13:29:38.000-0700","timestamp":1652284758.109847,"priority":"Critical","status_category":"Done","pull_request":2784},{"issue_id":"30221","title":"puppet module generate can't copy template files without parsing/renaming them","url":"https://tickets.puppetlabs.com/browse/PUP-2079","created_at":"2014-03-27T08:55:15.000-0700","number":"PUP-2079","body":"When creating a new module with \"puppet module generate\", any files\r\nin the skeleton dir named \"*.erb\" are parsed as Ruby erb templates and\r\nrenamed, removing the file extension. This is a pain if you want to\r\ninclude template files in your skeleton directory.","closed_at":"2014-09-04T13:29:43.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2079","labels":"","state":"Closed","updated_at":"2014-09-04T13:29:43.000-0700","timestamp":1652284758.319202,"priority":"Normal","status_category":"Done","pull_request":2759},{"issue_id":"37383","title":"Real-world module skeletons still use the 'description' metadata property","url":"https://tickets.puppetlabs.com/browse/PUP-2691","created_at":"2014-05-28T09:54:10.000-0700","number":"PUP-2691","body":"As per https://github.com/garethr/puppet-module-skeleton/issues/13\r\n\r\nChanges to the way modules are generated in Puppet 3.6 mean that where users could previously rely on the presence of certain absent properties, they no longer can.  The most prevalent example of this is the {{description}} property – including a template in your module skeleton which depends on that property causes template expansion to be aborted mid-run.","closed_at":"2014-09-04T13:29:47.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2691","labels":"","state":"Closed","updated_at":"2014-09-04T13:29:47.000-0700","timestamp":1652284758.528567,"priority":"Normal","status_category":"Done","pull_request":2701},{"issue_id":"38608","title":"Puppet 3.6.1 issue with Forge API v3","url":"https://tickets.puppetlabs.com/browse/PUP-2745","created_at":"2014-06-09T19:20:43.000-0700","number":"PUP-2745","body":"Getting this error on RHEL5 and RHEL6 when trying to install ghoneycutt/puppet. Broken on 3.6.0 and 3.6.1 but downgrading to 3.5.1 fixed the issue.\r\n\r\n[root@sbox09 ~]# puppet module install ghoneycutt/puppet --verbose --debug\r\nNotice: Preparing to install into /etc/puppet/modules ...\r\nNotice: Downloading from https://forgeapi.puppetlabs.com ...\r\nDebug: HTTP GET https://forgeapi.puppetlabs.com/v3/releases?module=ghoneycutt-puppet\r\nDebug: Error in ghoneycutt-puppet@2.1.2 parsing dependency puppetlabs-stdlib (Unparsable version range: \">= 3.2.x\"); using empty range.\r\nDebug: HTTP GET https://forgeapi.puppetlabs.com/v3/releases?module=puppetlabs-apache\r\nDebug: HTTP GET https://forgeapi.puppetlabs.com/v3/releases?module=puppetlabs-firewall\r\nDebug: HTTP GET https://forgeapi.puppetlabs.com/v3/releases?module=puppetlabs-stdlib\r\nDebug: HTTP GET https://forgeapi.puppetlabs.com/v3/releases?module=puppetlabs-stdlib&limit=20&offset=20\r\nDebug: HTTP GET https://forgeapi.puppetlabs.com/v3/releases?module=ripienaar-concat\r\nDebug: HTTP GET https://forgeapi.puppetlabs.com/v3/releases?module=puppetlabs-concat\r\nDebug: HTTP GET https://forgeapi.puppetlabs.com/v3/releases?module=leinaddm-htpasswd\r\nDebug: HTTP GET https://forgeapi.puppetlabs.com/v3/releases?module=puppetlabs-mysql\r\nDebug: HTTP GET https://forgeapi.puppetlabs.com/v3/releases?module=puppetlabs-mysql&limit=20&offset=20\r\nDebug: HTTP GET https://forgeapi.puppetlabs.com/v3/releases?module=bodepd-create_resources\r\nDebug: HTTP GET https://forgeapi.puppetlabs.com/v3/releases?module=puppetlabs-passenger\r\nDebug: HTTP GET https://forgeapi.puppetlabs.com/v3/releases?module=puppetlabs-gcc\r\nDebug: HTTP GET https://forgeapi.puppetlabs.com/v3/releases?module=puppetlabs-ruby\r\nDebug: HTTP GET https://forgeapi.puppetlabs.com/v3/releases?module=ghoneycutt-generic\r\nDebug: HTTP GET https://forgeapi.puppetlabs.com/v3/releases?module=ghoneycutt-backup\r\nDebug: HTTP GET https://forgeapi.puppetlabs.com/v3/releases?module=ghoneycutt-logwatch\r\nDebug: HTTP GET https://forgeapi.puppetlabs.com/v3/releases?module=ghoneycutt-certs\r\nDebug: HTTP GET https://forgeapi.puppetlabs.com/v3/releases?module=ghoneycutt-hosts\r\nDebug: HTTP GET https://forgeapi.puppetlabs.com/v3/releases?module=ghoneycutt-generic>= 1.0.0\r\nError: bad URI(is not URI?): /v3/releases?module=ghoneycutt-generic>= 1.0.0\r\nError: Try 'puppet help module install' for usage","closed_at":"2014-09-05T11:59:21.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2745","labels":"forge-api;module","state":"Resolved","updated_at":"2014-09-05T11:59:21.000-0700","timestamp":1652284759.260052,"priority":"Normal","status_category":"Done","pull_request":2980},{"issue_id":"18726","title":"Could not autoload puppet /util /instrumentation /listeners /log","url":"https://tickets.puppetlabs.com/browse/PUP-724","created_at":"2013-11-12T12:07:40.000-0800","number":"PUP-724","body":null,"closed_at":"2014-09-15T12:00:43.000-0700","comments":40,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-724","labels":"","state":"Closed","updated_at":"2014-09-15T12:00:43.000-0700","timestamp":1652284760.623518,"priority":"Normal","status_category":"Done","pull_request":5670},{"issue_id":"49605","title":"helpful_error_message_when_hostname_not_match_server_certificate test does not tolerate variable DNS alt name order","url":"https://tickets.puppetlabs.com/browse/PUP-3157","created_at":"2014-08-28T17:47:17.000-0700","number":"PUP-3157","body":"The `helpful_error_message_when_hostname_not_match_server_certificate.rb` test evaluates the DNS alt names which appear in the Subject Alternative Name extension from the Puppet master's server certificate.  The order in which these appear in the certificate does not translate directly to the order in which these may be received at the OpenSSL layer and outputted into the agent log.  If the order in which these were inserted into the certificate at signing time were to change, the test would break.  The test should be altered to tolerate a variable order for the enumeration of the DNS alt names.","closed_at":"2014-09-15T15:48:58.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3157","labels":"","state":"Closed","updated_at":"2014-09-15T15:48:58.000-0700","timestamp":1652284761.76501,"priority":"Normal","status_category":"Done","pull_request":3066},{"issue_id":"49935","title":"Intermittent failure for node/check_woy_cache_works testcase","url":"https://tickets.puppetlabs.com/browse/PUP-3175","created_at":"2014-09-02T17:00:56.000-0700","number":"PUP-3175","body":"While running tests against `puppet-server` we have encountered intermittent failures on this test case that we have not been able to reproduce outside of CI. \r\n\r\nThis bug is primarily about isolating this testcase from other tests by pointing it to a temporary yamldir to avoid node yaml files being tainted by previously run tests and to prevent subsequent tests from overwriting the node yaml file created by this test.","closed_at":"2014-09-15T15:48:59.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3175","labels":"","state":"Closed","updated_at":"2014-09-15T15:48:59.000-0700","timestamp":1652284761.868871,"priority":"Normal","status_category":"Done","pull_request":3042},{"issue_id":"50391","title":"Symlinks to missing targets cause a File Not Found error instead of a warning","url":"https://tickets.puppetlabs.com/browse/PUP-3191","created_at":"2014-09-05T14:09:51.000-0700","number":"PUP-3191","body":"When trying to warn about symlinks in a module that is being unpacked for any reason, we use Pathname.realpath, which gives a File Not Found error when the target of the symlink doesn't exist.","closed_at":"2014-09-15T15:49:00.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3191","labels":"","state":"Closed","updated_at":"2014-09-15T15:49:00.000-0700","timestamp":1652284762.078041,"priority":"Minor","status_category":"Done","pull_request":3072},{"issue_id":"50500","title":"Windows service provider references a non-existent class","url":"https://tickets.puppetlabs.com/browse/PUP-3222","created_at":"2014-09-08T10:50:39.000-0700","number":"PUP-3222","body":"MCollective has a dependency on a windows gem that we had to change as part of the FFI work. The issue was posted here:\r\n\r\nhttp://ask.puppetlabs.com/question/13630/mcollective-windows-service-no-longer-working/?answer=13637\r\n\r\nOur docs describe the change in question: https://docs.puppetlabs.com/puppet/latest/reference/deprecated_windows_api.html#updated-gems-and-moved-constants","closed_at":"2014-09-17T12:53:36.000-0700","comments":21,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3222","labels":"","state":"Closed","updated_at":"2014-09-17T12:53:36.000-0700","timestamp":1652284763.029934,"priority":"Normal","status_category":"Done","pull_request":3063},{"issue_id":"42566","title":"yum provider should use osfamily instead of operatingsystem fact","url":"https://tickets.puppetlabs.com/browse/PUP-2944","created_at":"2014-07-16T16:59:25.000-0700","number":"PUP-2944","body":"The yum provider for the package type uses the operatingsystem fact to specify the defaultfor and should be using the osfamily fact so that we do not have to duplicate effort listing all the RedHat derivatives in both places.","closed_at":"2014-10-01T09:58:26.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2944","labels":"redmine","state":"Closed","updated_at":"2014-10-01T09:58:26.000-0700","timestamp":1652284774.491298,"priority":"Normal","status_category":"Done","pull_request":2883},{"issue_id":"21350","title":"The function API has \"interesting\" type conversions","url":"https://tickets.puppetlabs.com/browse/PUP-1032","created_at":"2013-12-16T02:59:19.000-0800","number":"PUP-1032","body":"The type of parameters passed to functions is just weird:\r\nfoo(1) - String \"1\"\r\nfoo(1+1) - String \"2\"\r\nfoo($processorcount) - Numeric\r\nfoo(1*1) - Numeric 1\r\nfoo(1.0) - String \"1.0\"\r\nfoo(1.0+1) - Numeric 2.0\r\nfoo(1.0*1) - Numeric 1.0\r\nfoo(\"1\"+\"1\") - String \"2\"\r\nfoo(undef) - String \"\"\r\n","closed_at":"2014-10-09T16:54:44.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1032","labels":"redmine","state":"Closed","updated_at":"2014-10-09T16:54:44.000-0700","timestamp":1652284775.429945,"priority":"Normal","status_category":"Done","pull_request":8023},{"issue_id":"19781","title":"Deprecate parent parameter for type","url":"https://tickets.puppetlabs.com/browse/PUP-899","created_at":"2013-11-27T09:36:04.000-0800","number":"PUP-899","body":"Puppet types can define a `parent` type, though this doesn't actually work. For example, <https://github.com/puppetlabs/puppet/pull/2092>","closed_at":"2014-10-16T08:51:13.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-899","labels":"redmine","state":"Closed","updated_at":"2014-10-16T08:51:13.000-0700","timestamp":1652284776.576038,"priority":"Normal","status_category":"Done","pull_request":7031},{"issue_id":"51211","title":"Update PMT tests for directory environment support","url":"https://tickets.puppetlabs.com/browse/PUP-3248","created_at":"2014-09-15T10:43:30.000-0700","number":"PUP-3248","body":"Most of the PMT acceptance tests use the `host['distmoduledir']` variable which is not meaningful if the install is using directory environments.\r\n\r\nThe acceptance suite needs to be updated to introspect the module path rather than use `host['distmoduledir']`.","closed_at":"2014-10-22T13:04:34.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3248","labels":"","state":"Closed","updated_at":"2014-10-22T13:04:34.000-0700","timestamp":1652284778.568278,"priority":"Normal","status_category":"Done","pull_request":3109},{"issue_id":"52317","title":"Puppet user provider failing to reset puppet uid on Fedora19 due to usermod bug","url":"https://tickets.puppetlabs.com/browse/PUP-3339","created_at":"2014-09-24T11:47:38.000-0700","number":"PUP-3339","body":"This failure is showing up in the following acceptance test: acceptance/tests/config/puppet_manages_own_configuration_in_robust_manner.rb, but only on Fedora19.  This test removes the puppet user/group and then confirms that the --mkusers flag allows the puppet master to recreate them.  Before doing this, it records the current user/group state, and then in the final teardown step, reapplies the origina user/group state.\r\n\r\nThe failure began showing up after a fix to this test in [1d3fc272|https://github.com/puppetlabs/puppet/commit/1d3fc2724c65c6fce455bc35a87b24b6c361205a] began halting the test if the final puppet apply to reset the puppet user/group failed.  It is likely that this was always failing, but we only began to see it with this change.\r\n\r\nhttps://jenkins.puppetlabs.com/job/Puppet-Package-Acceptance-stable/label=beaker,platform=fedora19/61/\r\n\r\nI've attached a detailed log of the point of failure, but don't know why it's failing.\r\n\r\n*UPDATE:* \r\n\r\nAfter further investigation, this issue was found to be caused by a bug in the {{usermod}} command on Fedora 19. The bug does not appear to be present on Fedora 20. Since Fedora 19 is approaching end of life, we've decided not to fix this issue and just confine the acceptance test not to run on Fedora 19. The following output illustrates the bug which is causing the issue:\r\n\r\nFedora 20:\r\n{noformat}[root@bd4849uiz04imoa ~]# usermod -u 1000 test\r\n[root@bd4849uiz04imoa ~]# cat /etc/passwd\r\ntest:x:1000:1000::/home/test:/bin/bash\r\n[root@bd4849uiz04imoa ~]# ls -l /home/\r\ndrwxr-xr-x. 3 test test 4096 Sep 25 13:27 test\r\n[root@bd4849uiz04imoa ~]# ls -l /var/spool/mail/\r\n-rw-rw----. 1 test mail 0 Sep 25 13:20 test\r\n[root@bd4849uiz04imoa ~]# usermod -u 53 test\r\n[root@bd4849uiz04imoa ~]# ls -l /home/\r\ndrwxr-xr-x. 3 test test 4096 Sep 25 13:27 test\r\n[root@bd4849uiz04imoa ~]# ls -l /var/spool/mail/\r\n-rw-rw----. 1 test mail 0 Sep 25 13:20 test\r\n{noformat}\r\n\r\nFedora 19:\r\n{noformat}[root@nykbnzgen65yxtt ~]# usermod -u 1000 test\r\n[root@nykbnzgen65yxtt ~]# cat /etc/passwd\r\ntest:x:1000:1000::/home/test:/bin/bash\r\n[root@nykbnzgen65yxtt ~]# ls -l /home/\r\ndrwxr-xr-x. 3 test test 4096 Sep 25 13:27 test\r\n[root@nykbnzgen65yxtt ~]# ls -l /var/spool/mail/\r\n-rw-rw----. 1 test mail 0 Sep 25 13:20 test\r\n[root@nykbnzgen65yxtt ~]# usermod -u 53 test\r\nusermod: Failed to change ownership of the home directory\r\n[root@nykbnzgen65yxtt ~]# ls -l /var/spool/mail/\r\n-rw-rw----. 1 test mail 0 Sep 25 13:20 test\r\n[root@nykbnzgen65yxtt ~]# ls -l /home/\r\ndrwxr-xr-x. 3 1000 test 4096 Sep 25 13:27 test\r\n{noformat}\r\n","closed_at":"2014-10-22T13:04:37.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3339","labels":"","state":"Closed","updated_at":"2014-10-22T13:04:37.000-0700","timestamp":1652284778.673582,"priority":"Normal","status_category":"Done","pull_request":3122},{"issue_id":"21403","title":"puppetd doesn't always cleanup lockfile properly","url":"https://tickets.puppetlabs.com/browse/PUP-1070","created_at":"2013-12-16T10:39:48.000-0800","number":"PUP-1070","body":"ok I had the patch #2661 now running for some weeks and I had nearly no problems anymore. However from time to time (maybe once,twice a week) a random client doesn't remove its lockfile (@/var/lib/puppet/state/puppetdlock@), hence future runs fail. I assume this might still happen due to a uncatched exception (as in #2261), however the problem is a) hard or nearly impossible to reproduce and b) it occurs really by random. The only thing I can see in the logs:\r\n\r\n{noformat}\r\nNov 30 19:27:41 foobar puppetd[26228]: Finished catalog run in 98.79 seconds\r\nNov 30 20:00:02 foobar puppetd[3000]: Could not retrieve catalog from remote server: Error 502 on SERVER: <html>^M <head><title>502 Bad Gateway</title></head>^M <body bgcolor=\"white\">^M <center><h1>502 Bad Gateway</h1></center>^M <hr><center>nginx/0.6.39</center>^M </body>^M </html>^M\r\nNov 30 20:00:03 foobar puppetd[3000]: Using cached catalog\r\nNov 30 20:00:03 foobar puppetd[3000]: Could not retrieve catalog; skipping run\r\nNov 30 20:00:04 foobar puppetd[12169]: Run of Puppet configuration client already in progress; skipping\r\nNov 30 20:30:04 foobar puppetd[21230]: Run of Puppet configuration client already in progress; skipping\r\n{noformat}\r\n\r\nas I run puppetd by cron twice an hour with --splay I assume that the run between 19:30 and 20:00 got delayed till 20:00. At this time (20:00) a puppetmaster restart happens and due to that the 502 occured. This was the run of pid 3000, the next run (pid 12169) failed, this could either be as pid 3000 was still running or because there was already no puppetd anymore running and the lock file haven't been removed. However every future run failed as well as the lockfile wasn't removed.\r\n\r\nSo somehow puppet doesn't remove lockfiles properly under certain conditions.\r\n\r\nPS: If you think it's better to reopen the old bugreport, close this one and duplicate and re-open #2261","closed_at":"2014-10-31T06:59:46.000-0700","comments":17,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1070","labels":"customer;redmine","state":"Closed","updated_at":"2014-10-31T06:59:46.000-0700","timestamp":1652284779.718038,"priority":"Normal","status_category":"Done","pull_request":2616},{"issue_id":"45870","title":"User type shell parameter no longer functions properly in PE 3.3 (Puppet 3.6.2) in Solaris 10","url":"https://tickets.puppetlabs.com/browse/PUP-2991","created_at":"2014-07-30T08:32:13.000-0700","number":"PUP-2991","body":"h4.Summary\r\nhttps://github.com/puppetlabs/puppet/commit/73b0c2b0f59db920a14d4d0951b1f1c40d603cb4. Seems to have broken the shell parameter for the user type in Solaris.\r\n\r\nOne is now unable to specify a user's shell after the user has been created. This currently affects all users utilizing Puppet 3.6.2. \r\n\r\nh4.Test Code:\r\n{code}\r\nuser { 'jay':\r\n  ensure => present,\r\n  managehome => true,\r\n  shell => '/bin/sh',\r\n}\r\n{code}\r\n\r\nh4.Expected behavior\r\n\r\nUpon first run with /bin/bash:\r\n\r\n{code}\r\nInfo: Applying configuration version '1406730137'\r\nNotice: /Stage[main]/Main/Node[pe-33-agent-solaris.puppetdebug.vlan]/User[jay]/ensure: created\r\nNotice: Finished catalog run in 2.10 seconds\r\n{code}\r\n\r\nVerifying it's /bin/bash:\r\n{code}\r\n# cat /etc/passwd | grep jay\r\njay:x:102:1::/home/jay:/bin/bash\r\n{code}\r\n\r\nRun after changing the shell to /bin/sh:\r\n{code}\r\nInfo: Applying configuration version '1406730348'\r\nNotice: /Stage[main]/Main/Node[pe-33-agent-solaris.puppetdebug.vlan]/User[jay]/shell: shell changed '/bin/bash' to '/bin/sh'\r\nNotice: Finished catalog run in 3.12 seconds\r\n{code}\r\n\r\nVerifying it's /bin/sh:\r\n{code}\r\n# cat /etc/passwd | grep jay\r\njay:x:102:1::/home/jay:/bin/sh\r\n{code}\r\n\r\nh4. Current behavior(PE 3.3/Puppet 3.6.2):\r\nUpon changing the shell once more, no changes are made.\r\n","closed_at":"2014-11-03T13:11:14.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2991","labels":"customer;solaris","state":"Resolved","updated_at":"2014-11-03T13:11:14.000-0800","timestamp":1652284779.82677,"priority":"Major","status_category":"Done","pull_request":2928},{"issue_id":"41560","title":"Prevent symlinks in packages with PMT build","url":"https://tickets.puppetlabs.com/browse/PUP-2912","created_at":"2014-07-08T14:17:50.000-0700","number":"PUP-2912","body":"FROM PE-3115 \"Symlinks in packages are hard to install and generally not useful for end users. PMT should fail to build packages with symlinks and inform the user why. PF-460 will make it easier for authors to use symlinks in testing/automation settings without packaging them\"","closed_at":"2014-11-03T13:13:52.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2912","labels":"","state":"Resolved","updated_at":"2014-11-03T13:13:52.000-0800","timestamp":1652284779.932302,"priority":"Normal","status_category":"Done","pull_request":2930},{"issue_id":"23608","title":"puppet resource does not handle yum repo files with white space","url":"https://tickets.puppetlabs.com/browse/PUP-1438","created_at":"2014-01-14T09:58:52.000-0800","number":"PUP-1438","body":"When running:\r\n{quote}\r\npuppet resource yumrepo epel\r\n{quote}\r\npuppet reports\r\n{color:red}\r\nError: Could not run: Invalid value \" 1\". Valid values are absent. Valid values match /^(0|1)$/.\r\n{color}\r\n\r\nThis is because a Yum repository file contains white space between the equals and the 0 or the 1 for enabled or disabled. Like this\r\n{quote}\r\n[rhel-6-server-sam-source-rpms]\r\n...\r\nenabled = 0\r\n{quote}\r\n\r\nThis particular repository file is installed via the RedHat subscription manager rpm\r\n{quote}\r\n$ rpm -qf /etc/yum.repos.d/redhat.repo\r\nsubscription-manager-1.9.11-1.el6.x86_64\r\n{quote}\r\n\r\nThis same error occurs when processing the _gpgcheck_ and _sslverify_ keys as well. Although the _sslverify_ is looking for _True_ and _False_ whereas Redhat is using _0_ and _1_\r\n\r\nThe attached modification to the validation regex in the yumrepo.rb resouce file allows puppet to handle these yum repo files.\r\n","closed_at":"2014-11-03T13:22:22.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1438","labels":"","state":"Resolved","updated_at":"2014-11-03T13:22:22.000-0800","timestamp":1652284780.352525,"priority":"Normal","status_category":"Done","pull_request":2288},{"issue_id":"14277","title":"--no-zlib flag doesn't prevent zlib from being required in Puppet","url":"https://tickets.puppetlabs.com/browse/PUP-294","created_at":"2013-09-09T10:26:12.000-0700","number":"PUP-294","body":"Using a ruby without zlib support compiled in, the --no-zlib flag should prevent zlib from being used. It does not accomplish this.\n\n<pre>[root@el4-64 puppet-enterprise-3.1.0-rc0-53-g3f89475-el-4-x86_64]# puppet --no-zlib --version --trace --debug\n/opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require': cannot load such file -- zlib (LoadError)\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/forge/repository.rb:2:in `<top (required)>'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/forge.rb:6:in `<top (required)>'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/module_tool.rb:148:in `<top (required)>'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/module_tool/applications.rb:1:in `<top (required)>'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/module.rb:3:in `<top (required)>'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/parser/files.rb:1:in `<top (required)>'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/parser/templatewrapper.rb:1:in `<top (required)>'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/parser/scope.rb:6:in `<top (required)>'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/parser/methods.rb:2:in `<top (required)>'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/parser/ast/method_call.rb:2:in `<top (required)>'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/parser/ast.rb:116:in `<top (required)>'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/parser/parser.rb:11:in `<top (required)>'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/parser.rb:4:in `<top (required)>'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet.rb:176:in `<top (required)>'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/command_line.rb:12:in `<top (required)>'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /opt/puppet/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\n\tfrom /usr/local/bin/puppet:3:in `<main>'</pre>","closed_at":"2014-11-03T13:27:48.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-294","labels":"","state":"Resolved","updated_at":"2014-11-03T13:27:48.000-0800","timestamp":1652284780.457354,"priority":"Normal","status_category":"Done","pull_request":2938},{"issue_id":"12242","title":"(#21252) Fix problems with false/nil args and returns in lambda","url":"https://tickets.puppetlabs.com/browse/PUP-185","created_at":"2013-07-18T11:05:55.000-0700","number":"PUP-185","body":"https://github.com/puppetlabs/puppet/pull/1710","closed_at":"2014-11-03T13:33:20.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-185","labels":"","state":"Resolved","updated_at":"2014-11-03T13:33:20.000-0800","timestamp":1652284780.773829,"priority":"Major","status_category":"Done","pull_request":2750},{"issue_id":"12241","title":"(#21470) Change validation of \"storeconfigs\" to reflect runtime state.","url":"https://tickets.puppetlabs.com/browse/PUP-184","created_at":"2013-07-18T11:03:32.000-0700","number":"PUP-184","body":"https://github.com/puppetlabs/puppet/pull/1738","closed_at":"2014-11-03T13:33:59.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-184","labels":"","state":"Resolved","updated_at":"2014-11-03T13:33:59.000-0800","timestamp":1652284780.878477,"priority":"Major","status_category":"Done","pull_request":2410},{"issue_id":"11655","title":"File monitoring treats absent files as always changed.","url":"https://tickets.puppetlabs.com/browse/PUP-141","created_at":"2013-07-02T19:20:10.000-0700","number":"PUP-141","body":"The implementation of Puppet::Util::LoadedFile tracks a file by monitoring the file ctime. If a file is nonexistent and cannot have a ctime, every time the file is checked for changes ctime will be set to the current time. Since this value is constantly changing the file will always be marked as changed.\n\nExpected behavior\n\nIf a file is initially absent and is still absent when rechecked, it should be unchanged.\n\nActual behavior\n\nA file that is absent will be marked as always changed.\n\nNote: as of commit 3a19fff52c15266a3171b9bcf93bc1db1788c3b8 the LoadedFile has been refactored and renamed WatchedFile but this behavior is still present.\n\nThis is a copy of https://projects.puppetlabs.com/issues/21307","closed_at":"2014-11-03T13:40:36.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-141","labels":"","state":"Resolved","updated_at":"2014-11-03T13:40:36.000-0800","timestamp":1652284781.303689,"priority":"Major","status_category":"Done","pull_request":8878},{"issue_id":"46456","title":"PMT download treats error responses as modules","url":"https://tickets.puppetlabs.com/browse/PUP-3009","created_at":"2014-08-04T16:19:16.000-0700","number":"PUP-3009","body":"If a module download from forge fails the PMT treats the response as though it were a module and displays a checksum error instead of the error response from forge. \r\n\r\n{noformat}\r\nclavelin:~ adreyer$ puppet module install --module_repository=http://forgeapi.dev puppetlabs-apache --modulepath=/tmp/mods\r\nNotice: Preparing to install into /tmp/mods ...\r\nNotice: Downloading from http://forgeapi.dev ...\r\nError: Downloaded release for puppetlabs-apache did not match expected checksum\r\nError: Try 'puppet help module install' for usage{noformat}\r\n\r\nSince users may run into this with authorization it's important that PMT shows clear error messages.\r\n","closed_at":"2014-11-05T11:49:13.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3009","labels":"PMT","state":"Closed","updated_at":"2014-11-05T11:49:13.000-0800","timestamp":1652284783.385013,"priority":"Normal","status_category":"Done","pull_request":2941},{"issue_id":"14149","title":"Mount type `atboot` property validation is too restrictive in 3.3.0rcX","url":"https://tickets.puppetlabs.com/browse/PUP-292","created_at":"2013-09-04T14:07:58.000-0700","number":"PUP-292","body":"The mount type previously did not validate the `atboot` property, but a recent change makes it only accept yes or no, but not true or false.","closed_at":"2014-11-06T01:50:53.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-292","labels":"","state":"Resolved","updated_at":"2014-11-06T01:50:53.000-0800","timestamp":1652284783.489169,"priority":"Normal","status_category":"Done","pull_request":3623},{"issue_id":"33740","title":"Installation problem for puppetmaster-puppet 3.5.1 on Ubuntu 13.10","url":"https://tickets.puppetlabs.com/browse/PUP-2395","created_at":"2014-04-30T08:10:19.000-0700","number":"PUP-2395","body":"While doing smoke testing for PuppetDB (which requires the installation of Puppet), I found this weird issue: https://gist.github.com/kbarber/1661a6ff53cc7639bf6a\r\n\r\nIt seems there is something up with the puppetmaster-passenger installation, its returning an error about the site missing. Not sure what is going on here, the package works fine on Debian 7.0.\r\n\r\nI had to install apache2 up front, before it was only installing apache2-bin for whatever reason, and it couldn't even create the sites-enabled link.\r\n\r\nI could be completely wrong here, wouldn't mind a second site of eyes on this.","closed_at":"2014-11-07T07:07:45.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2395","labels":"","state":"Closed","updated_at":"2014-11-07T07:07:45.000-0800","timestamp":1652284784.07197,"priority":"Normal","status_category":"Done","pull_request":2622},{"issue_id":"16834","title":"Make rdoc parsing work on 1.9","url":"https://tickets.puppetlabs.com/browse/PUP-568","created_at":"2013-10-16T13:04:47.000-0700","number":"PUP-568","body":"If we ignore our custom html renderer for rdoc it shouldn't be too hard to get parsing working and then rdoc can use the default html renderer.","closed_at":"2014-11-07T07:07:45.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-568","labels":"redmine","state":"Closed","updated_at":"2014-11-07T07:07:45.000-0800","timestamp":1652284784.173722,"priority":"Normal","status_category":"Done","pull_request":4450},{"issue_id":"31015","title":"yumrepo gpgkey and baseurl with multiple URLs broken in 3.5.0","url":"https://tickets.puppetlabs.com/browse/PUP-2162","created_at":"2014-04-04T08:55:04.000-0700","number":"PUP-2162","body":"My yumrepo configuration has been working for months. After the update last night to 3.5.0 all my Scientific/Centos hosts are broken and fail to complete their puppet run. It seems they don't like the multiple options for gpgkeys. If I only include one, then it works (and then I hit another reported bug about the proxy). I am still researching what changed but haven't found anything that jumps out at me yet that is related to gpgkeys.\r\n\r\nMy yumrepo config:\r\n\r\n{code}\r\nyumrepo { \"SL6\":\r\n                descr => \"Scientific Linux $release - ${::architecture}\",\r\n                baseurl => \"http://${reponetwork}/scientificlinux/$release/${::architecture}/os/\",\r\n                enabled => 1,\r\n                enablegroups => 1,\r\n                gpgcheck => 1,\r\n                priority => 1,\r\n                gpgkey => \"file:///etc/pki/rpm-gpg/RPM-GPG-KEY-sl file:///etc/pki/rpm-gpg/RPM-GPG-KEY-sl$release file:///etc/pki/rpm-gpg/RPM-GPG-KEY-cern\",\r\n                proxy => \"_none_\",\r\n        }\r\n{code}\r\n\r\nThe error:\r\n\r\n{code}\r\nError: Failed to apply catalog: Parameter gpgkey failed on Yumrepo[SL6]: Validate method failed for class gpgkey: bad URI(is not URI?): file:///etc/pki/rpm-gpg/RPM-GPG-KEY-sl file:///etc/pki/rpm-gpg/RPM-GPG-KEY-sl6 file:///etc/pki/rpm-gpg/RPM-GPG-KEY-cern at /etc/puppet/modules/repos/manifests/scientific.pp:19\r\nWrapped exception:\r\nValidate method failed for class gpgkey: bad URI(is not URI?): file:///etc/pki/rpm-gpg/RPM-GPG-KEY-sl file:///etc/pki/rpm-gpg/RPM-GPG-KEY-sl6 file:///etc/pki/rpm-gpg/RPM-GPG-KEY-cern\r\n{code}\r\n\r\nAny help would be greatly appreciated.","closed_at":"2014-11-07T07:07:46.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2162","labels":"yumrepo","state":"Closed","updated_at":"2014-11-07T07:07:46.000-0800","timestamp":1652284784.377274,"priority":"Critical","status_category":"Done","pull_request":2503},{"issue_id":"21399","title":"Puppet master can't submit reports to an HTTP server using basic auth","url":"https://tickets.puppetlabs.com/browse/PUP-1068","created_at":"2013-12-16T10:33:36.000-0800","number":"PUP-1068","body":"If you turn on HTTP basic auth in Puppet Dashboard's vhost config, Puppet is unable to communicate with it. Setting a `reporturl` of (for example) <http://puppet:puppet@localhost:3000/reports> will not cause puppet to authenticate itself to Dashboard. \r\n\r\nThe ENC script doesn't work either; see issue #5126. The approach in Matt and my patch in comment 7 could probably be dropped into lib/reports/http.rb.","closed_at":"2014-11-07T07:07:48.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1068","labels":"redmine","state":"Closed","updated_at":"2014-11-07T07:07:48.000-0800","timestamp":1652284784.580971,"priority":"Normal","status_category":"Done","pull_request":8703},{"issue_id":"32149","title":"Insufficient tests on yumrepo's => absent","url":"https://tickets.puppetlabs.com/browse/PUP-2292","created_at":"2014-04-17T03:33:42.000-0700","number":"PUP-2292","body":"When you set => absent on a yumrepo property, the result is a string in ruby. However, it happens that we expect only a symbol there.","closed_at":"2014-11-07T07:07:51.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2292","labels":"test","state":"Closed","updated_at":"2014-11-07T07:07:51.000-0800","timestamp":1652284784.79121,"priority":"Normal","status_category":"Done","pull_request":2545},{"issue_id":"30968","title":"yumrepo removable URL properties cannot be set to 'absent' in Puppet 3.5.0.","url":"https://tickets.puppetlabs.com/browse/PUP-2150","created_at":"2014-04-03T14:36:32.000-0700","number":"PUP-2150","body":"I am on CentOS 6.5 using open-source Puppet 3.5.0. We were previously using Puppet 3.4.3.\r\n\r\nWe are using the epel module from the forge, which specifies a value of 'absent' for all of the yumrepos it manages by default. This does not work in Puppet 3.5.0, causing this error:\r\n\r\n{noformat}\r\nError: Parameter proxy failed on Yumrepo[epel-testing]: Must be a valid URL at /tmp/vagrant-puppet-1/modules-0/epel/manifests/init.pp:57\r\nWrapped exception:\r\nMust be a valid URL\r\n{noformat}\r\n\r\nI have a feeling that this may affect a lot of users.","closed_at":"2014-11-07T07:07:52.000-0800","comments":29,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2150","labels":"","state":"Closed","updated_at":"2014-11-07T07:07:52.000-0800","timestamp":1652284795.414337,"priority":"Critical","status_category":"Done","pull_request":2502},{"issue_id":"30007","title":"rpm provider broken for architecture specifications in 3.5.0-RC2 due to whatprovides functionality change","url":"https://tickets.puppetlabs.com/browse/PUP-2039","created_at":"2014-03-26T00:38:41.000-0700","number":"PUP-2039","body":"Prior to the change to add whatprovides in PUP-897 at [1], you could specify packages like \"glibc.i686\" or \"glibc.x86_64\". That no longer works.","closed_at":"2014-11-07T07:07:53.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2039","labels":"","state":"Closed","updated_at":"2014-11-07T07:07:53.000-0800","timestamp":1652284795.624866,"priority":"Critical","status_category":"Done","pull_request":2476},{"issue_id":"35794","title":"mode attribute of file type doesn't behave like chmod when given X","url":"https://tickets.puppetlabs.com/browse/PUP-2583","created_at":"2014-05-15T16:53:26.000-0700","number":"PUP-2583","body":"{code}\r\nfile { '/tmp/permtest': ensure => 'present', mode => '0600' }\r\n{code}\r\nbehaves as expected creating file '/permtest' with given permissions\r\nchanging to\r\n{code}\r\nfile { '/tmp/permtest': ensure => 'present', mode => 'g+rX' }\r\n{code}\r\ndoesn't behave as expected.  Changes permissions from 0600 to 0650.\r\nThe permissions should be '0640' since /permtest is a file not a directory\r\nand no executable bits are set.","closed_at":"2014-11-07T07:07:55.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2583","labels":"","state":"Closed","updated_at":"2014-11-07T07:07:55.000-0800","timestamp":1652284795.830412,"priority":"Normal","status_category":"Done","pull_request":2728},{"issue_id":"41092","title":"PMT upgrade command returns an error when trying to upgrade a module with only one release","url":"https://tickets.puppetlabs.com/browse/PUP-2882","created_at":"2014-07-02T13:19:58.000-0700","number":"PUP-2882","body":"When you use the \"puppet module upgrade\" command to upgrade a module that has only one published release, it reports that there are no releases available for that module instead of telling you that you already have the latest version.\r\n\r\n{code}\r\n$ bin/puppet module install ghoneycutt/sysklogd\r\nNotice: Preparing to install into /Users/jesse/sandbox/puppet/modules ...\r\nNotice: Downloading from https://forgeapi.puppetlabs.com ...\r\nNotice: Installing -- do not interrupt ...\r\n/Users/jesse/sandbox/puppet/modules\r\n└── ghoneycutt-sysklogd (v1.0.0)\r\n\r\n$ bin/puppet module upgrade ghoneycutt/sysklogd\r\nNotice: Preparing to upgrade 'ghoneycutt-sysklogd' ...\r\nNotice: Found 'ghoneycutt-sysklogd' (v1.0.0) in /Users/jesse/sandbox/puppet/modules ...\r\nNotice: Downloading from https://forgeapi.puppetlabs.com ...\r\nError: Could not upgrade 'ghoneycutt-sysklogd' (v1.0.0 -> latest)\r\n  No releases are available from https://forgeapi.puppetlabs.com\r\n    Does 'ghoneycutt-sysklogd' have at least one published release?\r\n{code}\r\n\r\n(See also: https://groups.google.com/forum/#!msg/puppet-users/9_iiPGyP9ls/-t7LRUdg1T4J)","closed_at":"2014-11-07T07:07:56.000-0800","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2882","labels":"","state":"Closed","updated_at":"2014-11-07T07:07:56.000-0800","timestamp":1652284796.037803,"priority":"Minor","status_category":"Done","pull_request":2913},{"issue_id":"21392","title":"Puppet master fails with 'stack level too deep' error when storeconfigs = true with rails stack 3.1.0","url":"https://tickets.puppetlabs.com/browse/PUP-1064","created_at":"2013-12-16T10:24:41.000-0800","number":"PUP-1064","body":"Out of nowhere, a known-working Puppet stack build script started to fail. The tell-tale error is 'stack level too deep' which from other historical bug reports always seems related to Ruby directly. After many hours of digging around, I checked for updated gem versions on the system. There was an update to rails 3.1.0 (and activerecord, etc.) which apparently is breaking the Puppet master when working with storeconfigs = true. Disabling storeconfigs immediately works as expected again.\r\n\r\nWhen reverting from rails and friends 3.1.0 to 3.0.10, Puppet again works as expected.\r\n\r\nI don't have any insight into where exactly this is all failing, only the version which is causing the issue and the condition to emulate it.\r\n\r\nThis was only tested again Puppet 2.7.3 using the gem install with both webrick and Apache+Passenger.\r\n\r\nAttached is a debug output.","closed_at":"2014-11-07T07:07:57.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1064","labels":"customer;redmine","state":"Closed","updated_at":"2014-11-07T07:07:57.000-0800","timestamp":1652284796.141578,"priority":"Normal","status_category":"Done","pull_request":8657},{"issue_id":"21369","title":"gem package provider is confused by platform components in version strings","url":"https://tickets.puppetlabs.com/browse/PUP-1051","created_at":"2013-12-16T05:15:32.000-0800","number":"PUP-1051","body":"Using: \r\n\r\n    package{'facter':\r\n      ensure          => latest,\r\n      provider        => 'gem',\r\n      source          => \"http://puppet:8808\",\r\n    }\r\n\r\nProduces:\r\n\r\n\r\n    notice: /Stage[main]/Common_puppet::Hpux/Package[facter]/ensure: ensure changed '1.6.17' to '1.6.17 ruby'\r\n\r\nThis happens on every puppet run. \r\n","closed_at":"2014-11-07T07:07:58.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1051","labels":"redmine","state":"Closed","updated_at":"2014-11-07T07:07:58.000-0800","timestamp":1652284796.244087,"priority":"Normal","status_category":"Done","pull_request":8184},{"issue_id":"18813","title":"Guard against duplicate Windows root certs ","url":"https://tickets.puppetlabs.com/browse/PUP-734","created_at":"2013-11-13T09:53:20.000-0800","number":"PUP-734","body":"On Windows, openssl's set_default_paths does nothing, so we preload OpenSSL::X509::Store with X509 certs extracted from the Root trust store. It appears the store can contain duplicate certificates, causing our call to OpenSSL::X509::Store#add_cert to fail with \"cert already in hash table\" <https://groups.google.com/d/topic/puppet-users/t-KLARupllw/discussion> We should be more defensive when adding a cert, so that a single failure to add a cert doesn't prevent puppet from running.","closed_at":"2014-11-07T07:08:02.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-734","labels":"redmine;windows","state":"Closed","updated_at":"2014-11-07T07:08:02.000-0800","timestamp":1652284796.759742,"priority":"Normal","status_category":"Done","pull_request":6551},{"issue_id":"32148","title":"yumrepo priority can not be sent to absent","url":"https://tickets.puppetlabs.com/browse/PUP-2291","created_at":"2014-04-17T03:07:44.000-0700","number":"PUP-2291","body":"yumrepo{\r\n'foo':\r\npriority => absent,\r\n}\r\n\r\n$ puppet apply test.pp \r\nNotice: Compiled catalog for dev050 in environment production in 0.10 seconds\r\nError: Parameter priority failed on Yumrepo[foo]: Must be within range 1-99 at /root/test.pp:4\r\nWrapped exception:\r\nMust be within range 1-99: absent\r\n","closed_at":"2014-11-07T07:08:03.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2291","labels":"","state":"Closed","updated_at":"2014-11-07T07:08:03.000-0800","timestamp":1652284796.863362,"priority":"Normal","status_category":"Done","pull_request":2543},{"issue_id":"21214","title":"FreeBSD: Puppet triggers loading of ZFS module","url":"https://tickets.puppetlabs.com/browse/PUP-1030","created_at":"2013-12-16T01:48:30.000-0800","number":"PUP-1030","body":"When puppet starts the puppet ZFS provider issues the zfs command. On FreeBSD this automatically loads the ZFS kernel module. Even when ZFS is not used on that host. The provider should first check if ZFS is enabled or not. If it's not enabled it shouldn't execute any zpool or zfs commands as those will trigger the automatic load of the kernel module. ","closed_at":"2014-11-11T15:04:04.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1030","labels":"redmine","state":"Closed","updated_at":"2014-11-11T15:04:04.000-0800","timestamp":1652284797.275297,"priority":"Normal","status_category":"Done","pull_request":8689},{"issue_id":"31096","title":"systemd Service provider does not list services with systemd 212","url":"https://tickets.puppetlabs.com/browse/PUP-2168","created_at":"2014-04-05T23:15:58.000-0700","number":"PUP-2168","body":"In systemd version 212, [a change|https://github.com/systemd/systemd/commit/90c3f79dc74229134818e78cb97d315e28ee93b5] was introduced to the default output format of `systemctl list-units`. It now includes a \"legend\" column on the left with characters to indicate if some services have failed.\r\n\r\nThis behavior can be suppressed with the {{--no-legend}} switch, but that is not backwards compatible with versions prior to 212.\r\n\r\nThe effect of this change for puppet is that {{puppet resource service}} lists no services at all.\r\n\r\nInstead, I'd propose a patch, which removes the leading \"{{^}}\" anchor from the regular expression, so that it should work with the old and new output format. I'll be submitting such a patch shortly.","closed_at":"2014-11-13T13:33:57.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2168","labels":"","state":"Closed","updated_at":"2014-11-13T13:33:57.000-0800","timestamp":1652284797.477201,"priority":"Normal","status_category":"Done","pull_request":2506},{"issue_id":"42372","title":"PMT appears to change metadata.json after generating checksums.json","url":"https://tickets.puppetlabs.com/browse/PUP-2936","created_at":"2014-07-15T13:43:30.000-0700","number":"PUP-2936","body":null,"closed_at":"2014-12-30T17:15:04.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2936","labels":"","state":"Resolved","updated_at":"2014-12-30T17:15:04.000-0800","timestamp":1652284799.945674,"priority":"Normal","status_category":"Done","pull_request":2897},{"issue_id":"38741","title":"Module tool fails to install new modules if some existing modules version is not Major.Minor.Patch format","url":"https://tickets.puppetlabs.com/browse/PUP-2752","created_at":"2014-06-11T01:20:37.000-0700","number":"PUP-2752","body":"Since Puppet 3.6.0 the module tool is unable to install new modules if an already existing modules version does not conform to the MAJOR.MINOR.PATCH format.\r\n\r\nI believe this behaviour was introduced with the dependency resolver ( https://github.com/puppetlabs/puppet/commit/6fa68b54ac621d60dbf1b062f8dd66b186d1a87f )\r\n\r\nHow to reproduce problem:\r\n* Place a module that does *not* conform with the X.Y.Z version format in your module folder (e.g. https://github.com/mrintegrity/puppet-pound ). To simulate this with another module just edit the metadata.json accordingly.\r\n* Try to install another module\r\n{code}\r\n% grep version modules/pound/metadata.json \r\n  \"version\": \"0.1\",\r\n% puppet module --modulepath /some/path/to/your/puppet/modules install --version=2.0.1 --ignore-dependencies saz/rsyslog\r\nNotice: Preparing to install into /some/path/to/your/puppet/modules ...\r\nError: Version numbers MUST begin with three dot-separated numbers\r\nError: Try 'puppet help module install' for usage\r\n%\r\n{code}\r\n\r\n\r\nWhat I would expect:\r\n* Only check the version of modules the new module depends on\r\n* Make it a warning instead of an error to avoid breaking existing setups\r\n* Output which modules version does not conform the the correct format (to avoid thinking the module being installed is at fault)\r\n","closed_at":"2015-01-15T11:29:08.000-0800","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2752","labels":"moduletool;pmt","state":"Closed","updated_at":"2015-01-15T11:29:08.000-0800","timestamp":1652284800.461963,"priority":"Critical","status_category":"Done","pull_request":2827},{"issue_id":"26537","title":"Faces help sometimes blows up when descriptions are absent","url":"https://tickets.puppetlabs.com/browse/PUP-1707","created_at":"2014-02-14T12:01:15.000-0800","number":"PUP-1707","body":"Right now, {{puppet man config}} will explode, because there's no description for the --section option. This isn't the intended behavior; it should devolve gracefully to the summary if the description is missing. We're naïvely doing gsub on a value that might be nil. ","closed_at":"2015-01-20T16:17:08.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1707","labels":"","state":"Closed","updated_at":"2015-01-20T16:17:08.000-0800","timestamp":1652284800.668835,"priority":"Normal","status_category":"Done","pull_request":2386},{"issue_id":"10529","title":"Cloud Provisioner FOSS install scripts were not updated to reflect Puppet 3.2 dependency","url":"https://tickets.puppetlabs.com/browse/PUP-1","created_at":"2013-05-28T19:20:05.000-0700","number":"PUP-1","body":"Recently the apt repository layout was changed in Puppet FOSS, requiring a different configuration from users.\r\n\r\nThe open source AWS Cloud Provisioner (and, flowing from that, the VMWare cloud provisioner) scripts to install Puppet were not updated to match, so are currently broken.\r\n\r\nThe failure, on Debian, is that it reports refusing to install the `puppet-common` package, but this is likely rooted in missing the dependency gem for the new parser:\r\n\r\n<pre>\r\nSome packages could not be installed. This may mean that you have\r\nrequested an impossible situation or if you are using the unstable\r\ndistribution that some required packages have not yet been created\r\nor been moved out of Incoming.\r\nThe following information may help to resolve the situation:\r\n\r\nThe following packages have unmet dependencies:\r\n puppet : Depends: puppet-common (= 3.2.1-1puppetlabs1) but it is not going to be installed\r\nE: Unable to correct problems, you have held broken packages.\r\n</pre>\r\n\r\nThis is on a clean, untouched by Puppet Ubuntu 12.04 VM.","closed_at":"2015-01-22T15:06:44.000-0800","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1","labels":"","state":"Resolved","updated_at":"2015-01-22T15:06:44.000-0800","timestamp":1652284800.873715,"priority":"Major","status_category":"Done","pull_request":8905},{"issue_id":"10566","title":"Agent-only install takes a super long time, and may hang until the cert is signed","url":"https://tickets.puppetlabs.com/browse/PUP-2","created_at":"2013-05-31T00:18:46.000-0700","number":"PUP-2","body":"When going through some sample installs w/Brian Cain today, we noticed that when we were doing agent-only installs, we'd eventually get to a line of output that said something like \"setting up agent...\" and it would appear to hang indefinitely.  (I left one open for at least 15 minutes.)\r\n\r\nEventually I guessed that maybe it had to do with a cert request, so I went to the console and approved the cert.  Something like 5 minutes later the installer woke up and finished everything up.","closed_at":"2015-01-22T15:09:57.000-0800","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2","labels":"","state":"Resolved","updated_at":"2015-01-22T15:09:57.000-0800","timestamp":1652284800.979585,"priority":"Blocker","status_category":"Done","pull_request":8607},{"issue_id":"10945","title":"Debug failing spec on windows","url":"https://tickets.puppetlabs.com/browse/PUP-7","created_at":"2013-06-17T17:09:35.000-0700","number":"PUP-7","body":null,"closed_at":"2015-01-22T15:12:51.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7","labels":"","state":"Resolved","updated_at":"2015-01-22T15:12:51.000-0800","timestamp":1652284801.184791,"priority":"Major","status_category":"Done","pull_request":8904},{"issue_id":"11304","title":"Agree on VMware User Stories","url":"https://tickets.puppetlabs.com/browse/PUP-59","created_at":"2013-06-24T17:31:29.000-0700","number":"PUP-59","body":"Jeff will be working with the VMware core team in Palo Alto to come to a final agreement on the user stories to be implemented for the vcloud director integration.  The demo of this integration is slated for VMworld the week of August 24th and the shipping date is slated for Q4 of 2013.","closed_at":"2015-01-22T15:20:10.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-59","labels":"vmware","state":"Resolved","updated_at":"2015-01-22T15:20:10.000-0800","timestamp":1652284802.104566,"priority":"Major","status_category":"Done","pull_request":7775},{"issue_id":"11301","title":"Update RGen to 0.6.5","url":"https://tickets.puppetlabs.com/browse/PUP-56","created_at":"2013-06-24T17:27:57.000-0700","number":"PUP-56","body":"RGen released 0.6.5 which contains a bugfix for the #to_str on empty array issue.\r\n\r\nWhat else is there to do except updating the gemspec?","closed_at":"2015-01-22T15:20:55.000-0800","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-56","labels":"","state":"Resolved","updated_at":"2015-01-22T15:20:55.000-0800","timestamp":1652284802.252121,"priority":"Major","status_category":"Done","pull_request":4583},{"issue_id":"11218","title":"Puppet daemon may sleep for 100 years after receiving USR1 on 64 bit systems","url":"https://tickets.puppetlabs.com/browse/PUP-43","created_at":"2013-06-19T19:23:17.000-0700","number":"PUP-43","body":"http://projects.puppetlabs.com/issues/21320\r\n\r\nquote:\r\n\r\nDue to a bug in Ruby 1.9.3 and earlier, an interrupted select call may be restarted with an invalid value (near 2**32). (Ruby always tries to restart interrupted select calls, unlike the normal behavior of the system call.)\r\n\r\nThis is fixed in 2.0.0 https://github.com/ruby/ruby/commit/b10c3136b0163536a679b10fecbc2992f3b5fa64.\r\n\r\nSince the puppet scheduler uses select to sleep, sending a signal to trigger a run (usually with mcollective) can trigger this bug.\r\n\r\nThis is the same issue as PE-779 but requires a different fix as we cannot patch ruby.","closed_at":"2015-01-22T15:38:33.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-43","labels":"","state":"Resolved","updated_at":"2015-01-22T15:38:33.000-0800","timestamp":1652284802.97316,"priority":"Major","status_category":"Done","pull_request":3807},{"issue_id":"16290","title":" `name` attribute is not always included in a Puppet::Transaction::Event","url":"https://tickets.puppetlabs.com/browse/PUP-526","created_at":"2013-10-04T17:37:00.000-0700","number":"PUP-526","body":"If a whole resource fails - i.e. there is a resource failure that is not specific to a property - the failure event (Puppet::Transaction::Event) will not have a `name` attribute. In PE 3.1.0 release candidates this was causing reports to fail to upload (because we introduced report sanitizing which checked for the `name` attribute and failed if it was not present).\r\n\r\n This can be reproduced by changing the owner or group of an existing file resource to an owner/group that does not exist.\r\n\r\nOur docs (http://docs.puppetlabs.com/puppet/3/reference/format_report.html#puppettransactionevent-1) say that `name` will be absent in inspect reports, but this is not an inspect report. The docs should be updated, but the fact that `name` is absent completely, rather than empty or nil, seems like a bug.\r\n","closed_at":"2015-01-23T10:50:15.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-526","labels":"3.0;PE;PE_3.1;PuppetCore;Reference_Manual","state":"Closed","updated_at":"2015-01-23T10:50:15.000-0800","timestamp":1652284818.410706,"priority":"Normal","status_category":"Done","pull_request":5038},{"issue_id":"23802","title":"[Windows] Copying file resources from non-NTFS volumes causes Invalid DACL errors","url":"https://tickets.puppetlabs.com/browse/PUP-1450","created_at":"2014-01-15T13:12:25.000-0800","number":"PUP-1450","body":"This was originally reported with vagrant-windows, but could have an effect anytime you would copy from a fileshare that is not Windows specific.\r\n\r\n{noformat}\r\nError: /Stage[main]/Main/File[c:/Bob/jenkins-slave/jenkins-slave.exe]: Could not evaluate: \r\nInvalid DACL:  The access control list (ACL) structure is invalid. Could not retrieve file \r\nmetadata for puppet:///modules/jenkins/jenkins-slave.exe: \r\nInvalid DACL:  The access control list (ACL) structure is invalid.\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/util/errors.rb:97:in `fail'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/type/file/source.rb:178:in `rescue in block in metadata'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/type/file/source.rb:171:in `block in metadata'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/type/file/source.rb:170:in `each'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/type/file/source.rb:170:in `metadata'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/type/file/source.rb:111:in `copy_source_values'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/type/file.rb:633:in `retrieve'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/type.rb:1063:in `retrieve_resource'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harness.rb:223:in `from_resource'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harness.rb:17:in `evaluate'\r\n{noformat}","closed_at":"2015-01-23T11:34:54.000-0800","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1450","labels":"3.5.0;windows","state":"Closed","updated_at":"2015-01-23T11:34:54.000-0800","timestamp":1652284818.518332,"priority":"Normal","status_category":"Done","pull_request":2299},{"issue_id":"65054","title":"warning: duplicated key at line 466 ignored: :queue_type","url":"https://tickets.puppetlabs.com/browse/PUP-3902","created_at":"2015-01-22T23:09:41.000-0800","number":"PUP-3902","body":"The setting {{queue_type}} appears twice in 3x. Simply remove one of them. Targeting this at 3.7.5 (planned to be released in orchestration with Puppet 4.0.0).","closed_at":"2015-01-27T10:17:43.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3902","labels":"","state":"Closed","updated_at":"2015-01-27T10:17:43.000-0800","timestamp":1652284818.834004,"priority":"Normal","status_category":"Done","pull_request":3516},{"issue_id":"61109","title":"Catalogs are transformed to resources outside of node environments","url":"https://tickets.puppetlabs.com/browse/PUP-3755","created_at":"2014-12-09T18:56:20.000-0800","number":"PUP-3755","body":"The master prepares a catalog for transmission to an agent by transforming it using the {{to_resource}} method. This call occurs [outside|https://github.com/puppetlabs/puppet/blob/3.7.3/lib/puppet/parser/compiler.rb#L34] of the [context containing the agent's environment|https://github.com/puppetlabs/puppet/blob/3.7.3/lib/puppet/parser/compiler.rb#L117]. This means that any resource operations involving the environment will use the master's 'default' environmant (almost always {{production}} unless set otherwise in {{puppet.conf}}).\r\n\r\nThe resolution to PUP-1381, released in 3.7.0, contains one such operation that involves the environment: a deprecation check. This check will force the default environment to load and can cause runs in other environments to fail if the default environment has any issues.\r\n\r\nh2. Reproduction Case\r\n\r\n*Setup*\r\n\r\n{code}\r\n# puppet.conf\r\n[main]\r\nenvironmentpath = /etc/puppet/environments\r\n\r\n[agent]\r\nenvironment = debug\r\n{code}\r\n\r\n{code:bash}\r\n# Create invalid site.pp for production. Will fail to parse.\r\necho \"import '/tmp/bogus/*.pp'\" > environments/production/manifests/site.pp\r\n\r\n# Create valid site.pp for debug environment.\r\necho -e \"node default{\\nnotify{'hello, world':}\\n}\" > environments/debug/manifests/site.pp\r\n{code}\r\n\r\nStart master and run {{puppet agent -t}}, the first run will fail with a message concerining the {{site.pp}} file in production. The second run will succeed due to environment caching.\r\n\r\n{code}\r\n# puppet master --no-daemonize --logdest=/dev/null &\r\n[1] 25147\r\n\r\n# puppet agent -t --server=$(hostname -f)\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nError: Could not retrieve catalog from remote server: Error 400 on SERVER: Could not\r\nparse for environment production: No file(s) found for import of '/tmp/bogus/*.pp'\r\nat /etc/puppet/environments/production/manifests/site.pp:2 on node poss-head-master.\r\npuppetdebug.vlan\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\n\r\n# puppet agent -t --server=$(hostname -f)\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for poss-head-master.puppetdebug.vlan\r\nInfo: Applying configuration version '1418179472'\r\nNotice: hello, world\r\nNotice: /Stage[main]/Main/Node[default]/Notify[hello, world]/message: defined 'messa\r\nge' as 'hello, world'\r\nNotice: Finished catalog run in 0.03 seconds\r\n{code}\r\n\r\nIn both cases, the catalog is compiled within the {{debug}} environment, but the error referencing {{production}} makes it hard to be sure of that without enabling and parsing a bunch of debug output.","closed_at":"2015-01-27T16:20:20.000-0800","comments":19,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3755","labels":"support","state":"Closed","updated_at":"2015-01-27T16:20:20.000-0800","timestamp":1652284819.044232,"priority":"Major","status_category":"Done","pull_request":3505},{"issue_id":"59788","title":"Issue with empty export resources expression in the Puppet future parser","url":"https://tickets.puppetlabs.com/browse/PUP-3701","created_at":"2014-11-25T14:44:49.000-0800","number":"PUP-3701","body":"This issue was found via this test: https://github.com/puppetlabs/puppetdb/blob/stable/puppet/spec/unit/indirector/catalog/puppetdb_spec.rb#L359 against the puppet master branch.","closed_at":"2015-01-27T16:20:20.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3701","labels":"future-parser","state":"Closed","updated_at":"2015-01-27T16:20:20.000-0800","timestamp":1652284819.151517,"priority":"Critical","status_category":"Done","pull_request":3344},{"issue_id":"58859","title":"The parameter order on the hash type is inconsistent","url":"https://tickets.puppetlabs.com/browse/PUP-3680","created_at":"2014-11-18T06:14:42.000-0800","number":"PUP-3680","body":"The order of parameters on the Hash type is [key_type, value_type, size_from, size_to], and you can optionally leave out the later parameters. But if you only specify one parameter it changes to [value_type] instead of [key_type].\r\n\r\nThis is for convenience, but seems like an unnecessary inconsistency to me that was surprising when using it.","closed_at":"2015-01-27T16:20:22.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3680","labels":"","state":"Closed","updated_at":"2015-01-27T16:20:22.000-0800","timestamp":1652284819.255429,"priority":"Normal","status_category":"Done","pull_request":3361},{"issue_id":"59146","title":"RHEL6 with ruby 1.8.7 and webrick sometimes does not handle HTTP keepalive correctly.","url":"https://tickets.puppetlabs.com/browse/PUP-3682","created_at":"2014-11-19T13:29:45.000-0800","number":"PUP-3682","body":"We periodically see errors in CI when a 3.7.x agent tries to retrieve a catalog or send a report to a 3.7.x master running rhel6, system ruby 1.8.7, with openssl 1.0.1e-fips, and webrick.\r\n\r\nOn the master:\r\n\r\n{noformat}\r\n[root@cdsfnhdbz8rf9c7 ~]# facter os\r\n{\"family\"=>\"RedHat\", \"release\"=>{\"minor\"=>\"5\", \"major\"=>\"6\", \"full\"=>\"6.5\"}, \"name\"=>\"RedHat\"}\r\n[root@cdsfnhdbz8rf9c7 ~]# ruby --version\r\nruby 1.8.7 (2011-06-30 patchlevel 352) [x86_64-linux]\r\n[root@cdsfnhdbz8rf9c7 ~]# openssl version\r\nOpenSSL 1.0.1e-fips 11 Feb 2013\r\n{noformat}\r\n\r\nAgent:\r\n\r\n{noformat}\r\n[root@o086qm75dfopvie ~]# facter os\r\n{\"release\"=>{\"minor\"=>\"5\", \"full\"=>\"6.5\", \"major\"=>\"6\"}, \"family\"=>\"RedHat\", \"name\"=>\"RedHat\"}\r\n[root@o086qm75dfopvie ~]# ruby --version\r\nruby 1.8.7 (2011-06-30 patchlevel 352) [i386-linux]\r\n[root@o086qm75dfopvie ~]# openssl version\r\nOpenSSL 1.0.1e-fips 11 Feb 2013\r\n{noformat}\r\n\r\nWhile this example uses master x86_64 and agent i386, we see the same results when both agent and master are from the same x86_64 template.\r\n\r\nIn master's {{/var/log/messages}}:\r\n\r\n{noformat}\r\nNov 19 13:12:02 fchk0bt9fu7iooo puppet-master[8753]: Compiled catalog for specified_node_name in environment production in 0.04 seconds\r\nNov 19 13:12:03 fchk0bt9fu7iooo puppet-master[8753]: Server Error: SSL_read:: internal error\r\n{noformat}\r\n\r\nIn master's {{/var/log/puppet/masterhttp.log}}:\r\n\r\n{noformat}\r\n2014-11-19 13:12:02] - -> /production/node/specified_node_name?transaction_uuid=a4182d00-7548-40c6-b6dd-314c7f4284cd&fail_on_404=true\r\n[2014-11-19 13:12:02] 10.32.122.19 - - [19/Nov/2014:13:12:02 PST] \"GET /production/file_metadatas/pluginfacts?ignore=.svn&ignore=CVS&ignore=.git&recurse=true&links=manage&checksum_t\r\nype=md5 HTTP/1.1\" 200 283\r\n[2014-11-19 13:12:02] - -> /production/file_metadatas/pluginfacts?ignore=.svn&ignore=CVS&ignore=.git&recurse=true&links=manage&checksum_type=md5\r\n[2014-11-19 13:12:02] 10.32.122.19 - - [19/Nov/2014:13:12:02 PST] \"GET /production/file_metadatas/plugins?ignore=.svn&ignore=CVS&ignore=.git&recurse=true&links=manage&checksum_type=\r\nmd5 HTTP/1.1\" 200 283\r\n[2014-11-19 13:12:02] - -> /production/file_metadatas/plugins?ignore=.svn&ignore=CVS&ignore=.git&recurse=true&links=manage&checksum_type=md5\r\n[2014-11-19 13:12:02] 10.32.122.19 - - [19/Nov/2014:13:12:02 PST] \"POST /production/catalog/specified_node_name HTTP/1.1\" 200 1136\r\n[2014-11-19 13:12:02] - -> /production/catalog/specified_node_name\r\n[2014-11-19 13:12:03] 10.32.122.19 - - [19/Nov/2014:13:12:03 PST] \"PUT /production/report/specified_node_name HTTP/1.1\" 500 2988\r\n[2014-11-19 13:12:03] - -> /production/report/specified_node_name\r\n[2014-11-19 13:12:03] INFO  going to shutdown ...\r\n{noformat}\r\n\r\nAnd the agent reports:\r\n\r\n{noformat}\r\no086qm75dfopvie.delivery.puppetlabs.net (agent) 13:12:21$  env PATH=\"/usr/bin:/opt/puppet-git-repos/hiera/bin:${PATH}\" RUBYLIB=\"/opt/puppet-git-repos/hiera/lib:/opt/puppet-git-repos/hiera-puppet/lib:${RUBYLIB}\" puppet agent  --no-daemonize --verbose --onetime --node_name_fact kernel --server cdsfnhdbz8rf9c7.delivery.puppetlabs.net\r\n...\r\nError: Could not send report: Error 500 on SERVER: {\"stacktrace\":[\"/usr/lib/ruby/1.8/openssl/buffering.rb:36:in `sysread'\",\"/usr/lib/ruby/1.8/openssl/buffering.rb:36:in `fill_rbuff'\",\"/usr/lib/ruby/1.8/openssl/buffering.rb:68:in `read'\",\"/usr/lib/ruby/1.8/webrick/httprequest.rb:328:in `__send__'\",\"/usr/lib/ruby/1.8/webrick/httprequest.rb:328:in `_read_data'\",\"/usr/lib/ruby/1.8/timeout.rb:67:in `timeout'\",\"/usr/lib/ruby/1.8/timeout.rb:101:in `timeout'\",\"/usr/lib/ruby/1.8/webrick/httprequest.rb:327:in `_read_data'\",\"/usr/lib/ruby/1.8/webrick/httprequest.rb:342:in `read_data'\",\"/usr/lib/ruby/1.8/webrick/httprequest.rb:280:in `read_body'\",\"/usr/lib/ruby/1.8/webrick/httprequest.rb:126:in `body'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick/rest.rb:58:in `body'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/network/http/handler.rb:55:in `process'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick/rest.rb:37:in `service'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick/rest.rb:36:in `synchronize'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick/rest.rb:36:in `service'\",\"/usr/lib/ruby/1.8/webrick/httpserver.rb:104:in `service'\",\"/usr/lib/ruby/1.8/webrick/httpserver.rb:65:in `run'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick.rb:33:in `listen'\",\"/usr/lib/ruby/1.8/webrick/server.rb:173:in `call'\",\"/usr/lib/ruby/1.8/webrick/server.rb:173:in `start_thread'\",\"/usr/lib/ruby/1.8/webrick/server.rb:162:in `start'\",\"/usr/lib/ruby/1.8/webrick/server.rb:162:in `start_thread'\",\"/usr/lib/ruby/1.8/webrick/server.rb:95:in `start'\",\"/usr/lib/ruby/1.8/webrick/server.rb:92:in `each'\",\"/usr/lib/ruby/1.8/webrick/server.rb:92:in `start'\",\"/usr/lib/ruby/1.8/webrick/server.rb:23:in `start'\",\"/usr/lib/ruby/1.8/webrick/server.rb:82:in `start'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick.rb:27:in `listen'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick.rb:26:in `initialize'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick.rb:26:in `new'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/network/http/webrick.rb:26:in `listen'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/network/server.rb:27:in `start'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/daemon.rb:139:in `start'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/application/master.rb:286:in `start_webrick_master'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/application/master.rb:199:in `main'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/application/master.rb:160:in `run_command'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/application.rb:381:in `run'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/application.rb:507:in `plugin_hook'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/application.rb:381:in `run'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/util.rb:488:in `exit_on_fail'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/application.rb:381:in `run'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/util/command_line.rb:146:in `run'\",\"/usr/lib/ruby/site_ruby/1.8/puppet/util/command_line.rb:92:in `execute'\",\"/usr/bin/puppet:8\"],\"message\":\"Server Error: SSL_read:: internal error\",\"issue_kind\":\"RUNTIME_ERROR\"}\r\n{noformat}\r\n\r\nThe failure is originating in ruby's native code that calls into openssl, note the double colons in {{\"Server Error: SSL_read:: internal error\"}}. This comes from \r\nhttps://github.com/ruby/ruby/blob/v1_8_7_352/ext/openssl/ossl_ssl.c#L1047 which expects that an openssl specific error message will be formated, e.g. {{SSL_read: <openssl message>: internal error}}\r\n\r\nThe failures do not occur if we:\r\n\r\n# Disable keepalive on the agent, by setting {{http_keepalive_timeout=0}}\r\n# Use rhel6 with 193\r\n# Use rhel6 with passenger\r\n# Use rhel7 (with system ruby 193)","closed_at":"2015-01-27T16:20:23.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3682","labels":"","state":"Closed","updated_at":"2015-01-27T16:20:23.000-0800","timestamp":1652284819.462112,"priority":"Normal","status_category":"Done","pull_request":3325},{"issue_id":"58426","title":"future parser collector override with Resource reference does not work","url":"https://tickets.puppetlabs.com/browse/PUP-3665","created_at":"2014-11-12T12:02:05.000-0800","number":"PUP-3665","body":"With the rewrite of collectors in 3.7.4 a regression was introduced that causes a collector override to fail if the value of an attribute is a Resource type.\r\n{code}\r\nNotify <| ... |> {\r\n  require => Notify[something]\r\n}\r\n{code}\r\n\r\nThis is caused because the 3x logic requires that resources are actual instances of Resource, and not instance of the PResourceType.\r\n\r\nThis unfortunately means that we must add transformation of the result of the attribute value expressions - it now directly returns the 4x result of evaluation.","closed_at":"2015-01-27T18:17:24.000-0800","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3665","labels":"","state":"Closed","updated_at":"2015-01-27T18:17:24.000-0800","timestamp":1652284820.948758,"priority":"Normal","status_category":"Done","pull_request":3473},{"issue_id":"12014","title":"puppet resource_type search raises an error when a module has no manifests dir","url":"https://tickets.puppetlabs.com/browse/PUP-161","created_at":"2013-07-11T11:52:05.000-0700","number":"PUP-161","body":"    [root@puppet-pe3 puppet-enterprise-3.0.0-el-5-i386]# puppet resource_type search '*' --render-as=json\n    Error: Could not call 'search' on 'resource_type': No such file or directory","closed_at":"2015-01-29T15:01:26.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-161","labels":"","state":"Resolved","updated_at":"2015-01-29T15:01:26.000-0800","timestamp":1652284821.26495,"priority":"Major","status_category":"Done","pull_request":2345},{"issue_id":"13838","title":"Release a new registry module","url":"https://tickets.puppetlabs.com/browse/PUP-279","created_at":"2013-08-29T09:06:37.000-0700","number":"PUP-279","body":"There are fixes in master that haven't been released on the forge.","closed_at":"2015-01-30T05:43:58.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-279","labels":"windows","state":"Resolved","updated_at":"2015-01-30T05:43:58.000-0800","timestamp":1652284822.309842,"priority":"Major","status_category":"Done","pull_request":2781},{"issue_id":"12216","title":"Client-enabled profiling does not work under Passenger","url":"https://tickets.puppetlabs.com/browse/PUP-177","created_at":"2013-07-17T12:25:31.000-0700","number":"PUP-177","body":null,"closed_at":"2015-02-05T15:43:12.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-177","labels":"","state":"Resolved","updated_at":"2015-02-05T15:43:12.000-0800","timestamp":1652284824.509518,"priority":"Major","status_category":"Done","pull_request":2670},{"issue_id":"14517","title":"CLONE - Can't `bundle install` on harbard (solaris 10 spec box attached to jenkins.puppetlabs.com)","url":"https://tickets.puppetlabs.com/browse/PUP-333","created_at":"2013-09-12T11:39:41.000-0700","number":"PUP-333","body":"Whats up Harbard?\r\n\r\n\r\nThe FOSS team has been auditing their jobs and making them all run the same commands:\r\n<pre>\r\nbundle install\r\nbundle exec rake spec\r\n</pre>\r\n\r\nBut that breaks on harbard with:\r\n<pre>\r\n[Facter Solaris (master)@2] $ /bin/sh -xe /var/tmp/hudson1563790466863799723.sh\r\n+ bundle install \r\nFetching gem metadata from https://rubygems.org/.........\r\nFetching gem metadata from https://rubygems.org/.\r\nFetching source index from https://rubygems.org/\r\nResolving dependencies...\r\nsudo: no tty present and no askpass program specified\r\nsudo: pam_authenticate: Conversation failure\r\n\r\nGem::Exception: Cannot load gem at [/opt/csw/lib/ruby/gems/1.8/cache/rake-10.1.0.gem] in /export/home/jenkins/workspace/Facter Solaris (master)@2\r\nAn error occurred while installing rake (10.1.0), and Bundler cannot continue.\r\nMake sure that `gem install rake -v '10.1.0'` succeeds before bundling.\r\nBuild step 'Execute shell' marked build as failure\r\n</pre>\r\n\r\nWhile just running:\r\n<pre>\r\nrake spec\r\n</pre>\r\n\r\nworks just fine.....\r\n\r\n\r\nWe want them to use the same script everywhere, and so we need to be able to let them run the same script everywhere, unfortunately I don't know why bundler on Solaris doesn't work like other bunders...","closed_at":"2015-02-12T15:36:59.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-333","labels":"","state":"Resolved","updated_at":"2015-02-12T15:36:59.000-0800","timestamp":1652284825.146781,"priority":"Major","status_category":"Done","pull_request":3373},{"issue_id":"49585","title":"Improve spec tests around pe puppet version","url":"https://tickets.puppetlabs.com/browse/PUP-3155","created_at":"2014-08-28T16:10:24.000-0700","number":"PUP-3155","body":"Several spec tests started to fail when run in CI because of poor isolation with the host environment.\r\n\r\n{code}\r\nFailures:\r\n\r\n  1) Puppet#version should be valid semver\r\n     Failure/Error: SemVer.should be_valid Puppet.version\r\n       expected valid?(\"3.6.2 (Puppet Enterprise 3.3.0)\") to return true, got nil\r\n     # ./spec/unit/puppet_spec.rb:12:in `block (3 levels) in <top (required)>'\r\n\r\n  2) Puppet::Util::CommandLine#execute should print the version and exit if --version is given\r\n     Failure/Error: expect do\r\n       expected /^3.6.2 (Puppet Enterprise 3.3.0)$/ to be printed; got:\r\n       3.6.2 (Puppet Enterprise 3.3.0)\r\n     # ./spec/unit/util/command_line_spec.rb:71:in `block (4 levels) in <top (required)>'\r\n\r\n  3) Puppet::Util::CommandLine#execute should print the version and exit if -V is given\r\n     Failure/Error: expect do\r\n       expected /^3.6.2 (Puppet Enterprise 3.3.0)$/ to be printed; got:\r\n       3.6.2 (Puppet Enterprise 3.3.0)\r\n     # ./spec/unit/util/command_line_spec.rb:71:in `block (4 levels) in <top (required)>'\r\n\r\n  4) Puppet::Util::CommandLine when dealing with puppet commands when the subcommand is not implemented and an external implementation cannot be found should abort and display --version information\r\n     Failure/Error: expect {\r\n       expected /^3.6.2 (Puppet Enterprise 3.3.0)$/ to be printed; got:\r\n       Error: Unknown Puppet subcommand 'whatever'\r\n       3.6.2 (Puppet Enterprise 3.3.0)\r\n     # ./spec/unit/util/command_line_spec.rb:126:in `block (6 levels) in <top (required)>'\r\n\r\n  5) Puppet::Util::CommandLine when dealing with puppet commands when the subcommand is not implemented and an external implementation cannot be found should abort and display -V information\r\n     Failure/Error: expect {\r\n       expected /^3.6.2 (Puppet Enterprise 3.3.0)$/ to be printed; got:\r\n       Error: Unknown Puppet subcommand 'whatever'\r\n       3.6.2 (Puppet Enterprise 3.3.0)\r\n     # ./spec/unit/util/command_line_spec.rb:126:in `block (6 levels) in <top (required)>'\r\n{code}","closed_at":"2015-02-12T16:25:53.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3155","labels":"","state":"Closed","updated_at":"2015-02-12T16:25:53.000-0800","timestamp":1652284827.385628,"priority":"Normal","status_category":"Done","pull_request":3031},{"issue_id":"69892","title":"Internal error from TypeCalculator when function called with incorrect args","url":"https://tickets.puppetlabs.com/browse/PUP-4064","created_at":"2015-03-02T14:32:27.000-0800","number":"PUP-4064","body":"The following expression sends bogus arguments to the lookup function. The result is an unexpected internal error from the TypeCalculator:\r\n{code}\r\npuppet apply --parser future --execute 'lookup(1, 2)'\r\nError: Evaluation Error: Error while evaluating a Function Call, Visitor Error: the configured receiver (Puppet::Pops::Types::TypeCalculator) can't handle instance of: Fixnum at line 1:1 on node\r\n{code}\r\nThe problem is only reproducible on stable. The code on master reports a correct error.","closed_at":"2015-03-26T13:42:53.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4064","labels":"","state":"Closed","updated_at":"2015-03-26T13:42:53.000-0700","timestamp":1652284845.065848,"priority":"Normal","status_category":"Done","pull_request":3666},{"issue_id":"68005","title":"Inferred type of empty hash not assignable to Hash<String,String>","url":"https://tickets.puppetlabs.com/browse/PUP-4008","created_at":"2015-02-13T05:40:52.000-0800","number":"PUP-4008","body":"An empty hash is correctly considered an instance of *Hash\\[String,String\\]* but its inferred type *Hash\\[Undef,Undef,0,0\\]* is not assignable. This is not correct. The inferred type of an empty hash must be assignable to any Hash type that accepts zero entries.","closed_at":"2015-03-26T13:42:53.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4008","labels":"","state":"Closed","updated_at":"2015-03-26T13:42:53.000-0700","timestamp":1652284845.168183,"priority":"Normal","status_category":"Done","pull_request":3613},{"issue_id":"66330","title":"Injected parameter results in omission of block parameter","url":"https://tickets.puppetlabs.com/browse/PUP-3936","created_at":"2015-02-01T09:16:08.000-0800","number":"PUP-3936","body":"An InternalFunction declared with the following dispatch:\r\n{noformat}\r\nPuppet::Functions.create_function('test', Puppet::Functions::InternalFunction) do\r\n      dispatch :test do\r\n        scope_param\r\n        param 'Integer', 'x'\r\n        required_block_param\r\n      end\r\n      def test(scope, x, block)\r\n        nil\r\n      end\r\n    end\r\n{noformat}\r\nwill always fail with _'wrong number of arguments (2 for 3)'_ when called. The probable cause is that the block parameter is never added to the weaving array. The resulting array after weaving thus contains the scope and the parameter, not the block.","closed_at":"2015-03-26T13:42:54.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3936","labels":"","state":"Closed","updated_at":"2015-03-26T13:42:54.000-0700","timestamp":1652284845.270988,"priority":"Normal","status_category":"Done","pull_request":3549},{"issue_id":"67206","title":"Change how block is passed to avoid confusion with missing optional parameters","url":"https://tickets.puppetlabs.com/browse/PUP-3978","created_at":"2015-02-07T15:31:40.000-0800","number":"PUP-3978","body":"A puppet function created using optional parameters followed by a block, that then gets called without providing a value for those optional parameters, will cause the weaving logic to create an arguments array that is too short, leaving the block that is supposed to be last, at the wrong position (it's simply passed on at the position it's placed in by the caller).\r\n\r\nThe fact that a block isn't really a block but a normal parameter in Ruby makes the optional parameter paradigm inconsistent in the dispatch declaration. It can only work without the block since in order to put the block last, a value must be present for each parameter in the invocation. This in turn means that using normal ruby syntax to set parameter default values will fail (passing {{nil}} overrides such a default setting).\r\n\r\nOn solution would be to provide a parameter default value in the dispatch configuration as an optional third argument to _param_ and require that the ruby method that the dispatch is targeting never has any optional parameters (the method _arity_ must never be negative). The default value would be optional in itself and default to {{nil}}. When given, it must of course comply with the parameter _type_ (which is another reason to put it there instead of in the ruby method declaration, defaults declare there doesn't have this requirement).","closed_at":"2015-03-26T13:42:54.000-0700","comments":21,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3978","labels":"","state":"Closed","updated_at":"2015-03-26T13:42:54.000-0700","timestamp":1652284845.382529,"priority":"Normal","status_category":"Done","pull_request":3592},{"issue_id":"69955","title":"defined() function returns wrong value for global variable check","url":"https://tickets.puppetlabs.com/browse/PUP-4072","created_at":"2015-03-03T06:33:54.000-0800","number":"PUP-4072","body":"The defined function cannot handle global references\r\n\r\nLooking up a variable through a fully qualified name fails:\r\n* {{if defined('$::lsbdistcodename')}} -> false\r\n* {{if defined('$lsbdistcodename')}} -> true\r\n\r\nThis is because the logic in scope exists? is different than the logic for lookup_qualified_variable.\r\n\r\nSetting this higher than normal since a defined of {{$foo}} is different than a defined of {{$::foo}}.\r\n\r\nThis was reported first in PUP-4066\r\n\r\nFixing this requires caution to not introduce regressions.","closed_at":"2015-03-26T13:42:54.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4072","labels":"","state":"Closed","updated_at":"2015-03-26T13:42:54.000-0700","timestamp":1652284845.488648,"priority":"Major","status_category":"Done","pull_request":3678},{"issue_id":"69648","title":"create_resources() error messages are less useful in 3.x then they were in 2.x","url":"https://tickets.puppetlabs.com/browse/PUP-4054","created_at":"2015-02-27T07:20:05.000-0800","number":"PUP-4054","body":"When {{create_resources()}} function causes puppet logic to be evaluated, certain errors are not displayed with the puppet context (file/line) that they appear in.\r\nThis can be observed with this simple sample:\r\n{code}\r\nclass breaking {\r\n  $x = 'foo' + 'bar'\r\n}\r\n$classes = { 'breaking' => {} }\r\ncreate_resources('class', $classes)\r\n{code}\r\n\r\nThe result on Puppet 3.7.4 (with current parser) is:\r\n{code}\r\nError: left operand of + is not a number at /Users/henrik/git/puppet/foo.pp:5 on node ...\r\n{code}\r\nThe result with Puppet 3.7.4 (with future parser) and puppet 4.0.0 is:\r\n{code}\r\nError: Evaluation Error: The value 'foo' cannot be converted to Numeric. at /Users/henrik/git/puppet/foo.pp:2:8 on node ...\r\n{code}\r\n\r\nThus, the problem is at least fixed in newer versions.\r\n\r\nORIGINAL REPORT\r\n----\r\nIn PE 2.8 (Puppet 2.7.x) this function will show the file/line number detail of the Puppet DSL code where the exception occurred. \r\n\r\nIn PE 3.x(including PE 3.7 / Puppet 3.7) it shows the file/line number of the Puppet DSL where the create_resources() function was invoked - which is not helpful.","closed_at":"2015-03-26T13:42:54.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4054","labels":"customer;support","state":"Closed","updated_at":"2015-03-26T13:42:54.000-0700","timestamp":1652284845.594202,"priority":"Normal","status_category":"Done","pull_request":3667},{"issue_id":"67640","title":"Struct with optional values is not assignable from Hash where key is missing","url":"https://tickets.puppetlabs.com/browse/PUP-4000","created_at":"2015-02-11T07:39:37.000-0800","number":"PUP-4000","body":"The specification of the Struct type declares that \"Struct supports Optional values - this means that a matching hash may either have undef bound to a key, or that the key is missing.\". A hash without a matching key for such an optional value is however not considered assignable.","closed_at":"2015-03-26T13:42:55.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4000","labels":"","state":"Closed","updated_at":"2015-03-26T13:42:55.000-0700","timestamp":1652284845.803151,"priority":"Normal","status_category":"Done","pull_request":3595},{"issue_id":"70205","title":"File and line numbers often missing from errors","url":"https://tickets.puppetlabs.com/browse/PUP-4086","created_at":"2015-03-04T05:42:38.000-0800","number":"PUP-4086","body":"I've noticed that some classes of error don't include the name and line number of the .pp file where they occurred. I haven't been paying attention to whether it's a particular type of error, but in this example it's failure from a stdlib function.\r\n\r\nLet me know if you want me to do any further debugging.\r\n\r\n{noformat}\r\n2015-03-04 13:35:32,131 DEBUG [puppet-server] Puppet importing '/etc/puppet/environments/SYSAD2994/modules/elasticsearch/manifests/service.pp' in environment SYSAD2994\r\n2015-03-04 13:35:32,143 DEBUG [puppet-server] Puppet Automatically imported elasticsearch::service from elasticsearch/service into SYSAD2994\r\n2015-03-04 13:35:32,219 ERROR [puppet-server] Puppet pick(): must receive at least one non empty value on node disri.lnx.warwick.ac.uk\r\n/usr/share/ruby/vendor_ruby/puppet/util/errors.rb:104:in `fail'\r\n/etc/puppet/environments/SYSAD2994/modules/stdlib/lib/puppet/parser/functions/pick.rb:24:in `real_function_pick'\r\n/usr/share/ruby/vendor_ruby/puppet/parser/functions.rb:164:in `function_pick'\r\n/usr/share/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/usr/share/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/usr/share/ruby/vendor_ruby/puppet/parser/functions.rb:157:in `function_pick'\r\n/usr/share/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:248:in `call_function'\r\n/usr/share/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:771:in `eval_CallNamedFunctionExpression'\r\n/usr/share/ruby/vendor_ruby/puppet/pops/visitor.rb:64:in `visit_this_1'\r\n/usr/share/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:77:in `evaluate'\r\n/usr/share/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:722:in `eval_AttributeOperation'\r\n/usr/share/ruby/vendor_ruby/puppet/pops/visitor.rb:64:in `visit_this_1'\r\n/usr/share/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:77:in `evaluate'\r\n/usr/share/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:689:in `eval_ResourceExpression'\r\norg/jruby/RubyArray.java:1613:in `each'\r\norg/jruby/RubyEnumerable.java:865:in `inject'\r\n/usr/share/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:688:in `eval_ResourceExpression'\r\norg/jruby/RubyArray.java:2412:in `map'\r\n/usr/share/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:649:in `eval_ResourceExpression'\r\n/usr/share/ruby/vendor_ruby/puppet/pops/visitor.rb:64:in `visit_this_1'\r\n...\r\nringutils.clj:75:in `invoke'\r\nringutils.clj:81:in `invoke'\r\ncore.clj:112:in `invoke'\r\ncore.clj:2443:in `invoke'\r\ncore.clj:112:in `doInvoke'\r\nmaster_service.clj:28:in `invoke'\r\ncore.clj:176:in `invoke'\r\ncore.clj:45:in `invoke'\r\njetty9_core.clj:317:in `invoke'\r\n{noformat}","closed_at":"2015-03-26T13:42:56.000-0700","comments":16,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4086","labels":"","state":"Closed","updated_at":"2015-03-26T13:42:56.000-0700","timestamp":1652284855.525194,"priority":"Normal","status_category":"Done","pull_request":3690},{"issue_id":"70055","title":"Remove the 'allow_virtual' warning in the 3.x series","url":"https://tickets.puppetlabs.com/browse/PUP-4076","created_at":"2015-03-03T14:59:09.000-0800","number":"PUP-4076","body":"n Puppet 4, the package type's allow_virtual setting will be true by\r\ndefault. In commit 3f6d7ca, this change was made and the deprecation\r\nwarning for allow_virtual was removed in master. However, many have\r\nfound the deprecation warning to be disruptive in the 3.x series, so\r\nthis commit removes it. We will deprecate in docs instead.","closed_at":"2015-03-26T13:42:57.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4076","labels":"","state":"Closed","updated_at":"2015-03-26T13:42:57.000-0700","timestamp":1652284855.632663,"priority":"Normal","status_category":"Done","pull_request":3681},{"issue_id":"67538","title":"continued shorthand interpolation of numeric variable fails (future parser)","url":"https://tickets.puppetlabs.com/browse/PUP-3998","created_at":"2015-02-10T14:20:34.000-0800","number":"PUP-3998","body":"When attempting to interpolate like this:\r\n{code}\r\nnotice \"${0[foo]}\"\r\n{code}\r\n\r\nThe error message is \r\n{code}\r\nIllegal expression. A Variable is unacceptable as name in a Variable\r\n{code}\r\nIt should have been \r\n{code}\r\nOperator '[]' is not applicable to a Nil Object.\r\n{code}\r\n\r\n(Which BTW should be fixed to say 'undef' instead of Nil Object).\r\n\r\nThe cause of the problem is that the shorthand notation misunderstands a numeric variable (it understands a variable name just fine even if it is undefined).","closed_at":"2015-03-26T13:42:57.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3998","labels":"","state":"Closed","updated_at":"2015-03-26T13:42:57.000-0700","timestamp":1652284855.843295,"priority":"Normal","status_category":"Done","pull_request":3596},{"issue_id":"66324","title":"Environment used before set in Resource.initialize when this needs access to its type","url":"https://tickets.puppetlabs.com/browse/PUP-3934","created_at":"2015-01-31T10:27:13.000-0800","number":"PUP-3934","body":"UPDATED\r\n----\r\nThis was a bug, an internal problem that occurred because the actual code path that triggered the problem had never been considered prior to the changes that made this problem surface.\r\n\r\nORIGINAL\r\n----\r\nI'm not able to do a clean run of the puppet specs when using stable or the tagged 3.7.4 commit. If I revert back to the commit just before this one: [0be9c1a|https://github.com/puppetlabs/puppet/commit/0be9c1adaec3b0d3450f202b89f205cfb8d10090] (fix for PUP-3755), then everything works OK. \r\n\r\nThere's nothing wrong with the commit but it provokes the real problem which is that the Resource initializer method calls on {{resource_type}} which in turn needs the {{current_environment}} at a point where the environment has not been set. Thus, it falls back to the _**root**_ environment rather than using the environment from the catalog that created it and the resource type is not found.\r\n\r\nI have no good explanation to why this test passed everywhere before 3.7.4 was released. I'm not able to get a green 3.7.4 or stable build on any of my machines.\r\n\r\nThe spec that fails is this one:\r\n{noformat}\r\n  1) Pure ruby manifests should allow defines\r\n     Failure/Error: catalog.resource(\"Bar[instance]\").should_not be_nil\r\n     Puppet::Error:\r\n       Could not parse for environment *root*: No file(s) found for import of 'foo' at line 2\r\n     # ./lib/puppet/parser/parser_support.rb:175:in `rescue in parse'\r\n     # ./lib/puppet/parser/parser_support.rb:166:in `parse'\r\n     # ./lib/puppet/node/environment.rb:545:in `perform_initial_import'\r\n     # ./lib/puppet/node/environment.rb:276:in `known_resource_types'\r\n     # ./lib/puppet/resource.rb:276:in `resource_type'\r\n     # ./lib/puppet/resource.rb:242:in `initialize'\r\n     # ./lib/puppet/resource/catalog.rb:305:in `new'\r\n     # ./lib/puppet/resource/catalog.rb:305:in `resource'\r\n     # ./spec/integration/parser/ruby_manifest_spec.rb:39:in `block (2 levels) in <top (required)>'\r\n{noformat}\r\n","closed_at":"2015-03-26T15:48:05.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3934","labels":"","state":"Closed","updated_at":"2015-03-26T15:48:05.000-0700","timestamp":1652284856.771398,"priority":"Major","status_category":"Done","pull_request":3546},{"issue_id":"66480","title":"Type validation fails when validating hashes using a struct type.","url":"https://tickets.puppetlabs.com/browse/PUP-3947","created_at":"2015-02-03T01:56:45.000-0800","number":"PUP-3947","body":"When using the following type:\r\n{noformat}\r\nStruct[{'mode'=>String, 'path'=>Array[String]}]\r\n{noformat}\r\nit should be legal to pass the following hash\r\n{noformat}\r\n{ 'mode' => 'read', 'path' => ['foo', 'fee'] }\r\n{noformat}\r\nbut this fails because the inferred type of the hash is:\r\n{noformat}\r\nHash[Variant[String, String], Variant[String, Tuple[String, String]]]\r\n{noformat}\r\nwhich is considered incompatible, and correctly so.\r\n\r\nThe solution is probably to let infer_set reduce the type of _each pair_ in the hash rather than attempting to combine the reduced type of _all keys_ with the reduced type of _all values_. The pair semantics must be retained during reduction in order to guarantee that the result is assignable to a struct. ","closed_at":"2015-03-26T15:58:14.000-0700","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3947","labels":"","state":"Closed","updated_at":"2015-03-26T15:58:14.000-0700","timestamp":1652284856.879235,"priority":"Normal","status_category":"Done","pull_request":3561},{"issue_id":"67340","title":"Change Closure.call to not take scope","url":"https://tickets.puppetlabs.com/browse/PUP-3987","created_at":"2015-02-09T16:47:10.000-0800","number":"PUP-3987","body":"In Puppet 4.0.0 the Closure.call method does not longer take scope as a parameter (it was unused). This change should have also been made to stable as the API should be the same for 3.7.x with future parser and Puppet 4.0.0.\r\n\r\nThis ticket is about backporting the change from PUP-3274 to stable.","closed_at":"2015-03-26T15:58:59.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3987","labels":"","state":"Closed","updated_at":"2015-03-26T15:58:59.000-0700","timestamp":1652284856.982861,"priority":"Normal","status_category":"Done","pull_request":3588},{"issue_id":"67373","title":"scanf only implemented for future parser","url":"https://tickets.puppetlabs.com/browse/PUP-3991","created_at":"2015-02-10T07:21:03.000-0800","number":"PUP-3991","body":"The scanf function is only implemted or the future parser, but not the classic one. This leads to the possibility of non-backwards compatible code using this function.\r\n\r\nAs the implementation is trivial, I'd suggest adding the function to the classic parser.\r\n\r\nAlternatively, the function could be extracted into the stdlib module, where consumers can take a versioned dependency.","closed_at":"2015-03-27T11:22:01.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3991","labels":"","state":"Closed","updated_at":"2015-03-27T11:22:01.000-0700","timestamp":1652284857.190864,"priority":"Normal","status_category":"Done","pull_request":3593},{"issue_id":"70717","title":"Future parser error when interpolating name segment starting with underscore","url":"https://tickets.puppetlabs.com/browse/PUP-4133","created_at":"2015-03-09T05:43:19.000-0700","number":"PUP-4133","body":"Variables starting with underscore are still supposed to be valid with the future parser, but interpolation of them doesn't work if they're accessed using their qualified variable name.\r\n\r\neg\r\n{code}\r\n$ cat leading_underscore.pp\r\nclass bar ($foo) {\r\n  $_foo = $foo\r\n  notify {\"Name of resource ${bar::_foo}\":\r\n    message => 'something witty here'\r\n  }\r\n}\r\nclass {'bar':\r\n  foo => 'one',\r\n}\r\n$  puppet apply --parser=future leading_underscore.pp\r\nError: Could not parse for environment production: Illegal fully qualified name in file /home/alex/github/test/leading_underscore.pp at line 3:36 on node alex-virtualbox.example.com\r\nError: Could not parse for environment production: Illegal fully qualified name in file /home/alex/github/test/leading_underscore.pp at line 3:36 on node alex-virtualbox.example.com\r\n{code}\r\n\r\nI discussed this on IRC and [~richard] came up with the following example that probably demonstrates the issue more clearly than mine.\r\n{code}\r\n$ cat leading_underscore.pp\r\nclass bar {\r\n  $_foo = \"one\"\r\n}\r\n\r\ninclude bar\r\nnotice(\"${bar::_foo}\")\r\n\r\n$ puppet apply --parser=future leading_underscore.pp\r\nError: Could not parse for environment production: Illegal fully qualified name in file /Users/richardc/src/leading_underscore.pp at line 10:18 on node socks.local\r\nError: Could not parse for environment production: Illegal fully qualified name in file /Users/richardc/src/leading_underscore.pp at line 10:18 on node socks.local\r\n\r\n$ cat leading_underscoreworking.pp\r\nclass bar {\r\n  $_foo = \"one\"\r\n}\r\n\r\ninclude bar\r\nnotice($bar::_foo)\r\n\r\n$ puppet apply --parser=future leading_underscoreworking.pp\r\nNotice: Scope(Class[main]): one\r\nNotice: Compiled catalog for socks.local in environment production in 0.51 seconds\r\nNotice: Finished catalog run in 0.03 seconds\r\n{code}\r\n\r\nThanks,\r\nAlex\r\n\r\nrisk assessment: medium (FR only for now)\r\nprobability: low (variables starting with underscores)\r\nseverity: medium (work arounds exist)\r\ntest layer: unit (https://github.com/puppetlabs/puppet/blob/dda2430457cd06c3381f02163dc9c15925b4bff7/spec/unit/pops/parser/lexer2_spec.rb#L230-L236)","closed_at":"2015-04-07T11:43:40.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4133","labels":"","state":"Closed","updated_at":"2015-04-07T11:43:40.000-0700","timestamp":1652284857.70979,"priority":"Normal","status_category":"Done","pull_request":3707},{"issue_id":"71641","title":"Puppet 4 lexer fails to parse multiple heredocs on the same line","url":"https://tickets.puppetlabs.com/browse/PUP-4205","created_at":"2015-03-14T02:04:30.000-0700","number":"PUP-4205","body":"Parsing this manifest:\r\n\r\n{code}\r\nnotice({ @(foo) => @(bar) })\r\nhello\r\n-foo\r\nworld\r\n-bar\r\n{code}\r\n\r\nResults in:\r\n{code}\r\n$ puppet apply foo.pp\r\nError: Could not parse for environment production: undefined local variable or method `lexing_context' for #<Puppet::Pops::Parser::Lexer2:0x007faadd1551a0> on node peterhu-osx\r\n{code}\r\n\r\nExpected results:\r\n{code}\r\n$ puppet apply foo.pp\r\nNotice: Scope(Class[main]): {hello => world}\r\nNotice: Compiled catalog for peterhu-osx in environment production in 1.18 seconds\r\nNotice: Applied catalog in 0.08 seconds\r\n{code}\r\n\r\nQA risk assessment: medium (FR only for now)\r\nprobability: low (multiple heredocs on same line)\r\nseverity: medium (workarounds exist)\r\ntest layer: unit (https://github.com/puppetlabs/puppet/blob/26ad83f62e1ff1d1df51591f1c2c9b555484d3e0/spec/unit/pops/parser/parse_heredoc_spec.rb#L117-L136)","closed_at":"2015-04-08T09:47:17.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4205","labels":"","state":"Closed","updated_at":"2015-04-08T09:47:17.000-0700","timestamp":1652284858.667282,"priority":"Normal","status_category":"Done","pull_request":3718},{"issue_id":"65999","title":"Puppet 4 lexer misinterprets multiple '/' tokens as a regex following a variable.","url":"https://tickets.puppetlabs.com/browse/PUP-3923","created_at":"2015-01-28T16:37:54.000-0800","number":"PUP-3923","body":"Expected the following code to notice \"2\":\r\n\r\n{code}\r\n$foo = 2\r\nnotice ($foo / 1 / 1)\r\n{code}\r\n\r\nBut instead received this (quite cryptic) error:\r\n\r\n{code}\r\n$ puppet apply foo.pp\r\nError: Could not parse for environment production: Syntax error at '(?-mix: 1 )' at foo.pp:2:14 on node foo\r\n{code}\r\n\r\nIt looks like the lexer isn't handling variables in {{regexp_acceptable?}}.\r\n\r\nRelated: should it also do the same for bare words (it handles names already)?\r\n\r\nWorkaround by forcing the next token following the variable to be something other than '/':\r\n{code}\r\n$foo = 2\r\nnotice (($foo) / 1 / 1)\r\n{code}","closed_at":"2015-04-08T09:47:18.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3923","labels":"","state":"Closed","updated_at":"2015-04-08T09:47:18.000-0700","timestamp":1652284858.770729,"priority":"Major","status_category":"Done","pull_request":3538},{"issue_id":"67244","title":"Missing PMT Acceptance Test for Building Module with a Modulefile","url":"https://tickets.puppetlabs.com/browse/PUP-3981","created_at":"2015-02-09T10:03:43.000-0800","number":"PUP-3981","body":"The PUP-3254 ticket removes support for Modulefile support in the PMT and will warn the user if one is provided. There is currently no acceptance test that verifies that a  user will receive a warning message if a Modulefile is present during module building.","closed_at":"2015-04-08T09:47:18.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3981","labels":"","state":"Closed","updated_at":"2015-04-08T09:47:18.000-0700","timestamp":1652284858.874983,"priority":"Critical","status_category":"Done","pull_request":3587},{"issue_id":"21625","title":"Race condition in Puppet::Util::Lockfile","url":"https://tickets.puppetlabs.com/browse/PUP-1150","created_at":"2013-12-17T12:13:22.000-0800","number":"PUP-1150","body":"Puppet::Util::Lockfile does not exclude other processes from acquiring a lock between the time it checks if the lock file exists and when it writes to the lock file.  This allows for a race condition, and two puppet processes started simultaneously are likely to acquire the same lock.\r\n\r\nThis has been witnessed in the wild where I work because we may have multiple request that trigger puppet runs on certain nodes.  Here's an example:\r\n{code}\r\nDec 11 05:41:46 ded-4 puppet-agent[20075]: Retrieving plugin\r\nDec 11 05:41:46 ded-4 puppet-agent[20076]: Retrieving plugin\r\nDec 11 05:41:46 ded-4 puppet-agent[20076]: Loading facts in /var/lib/puppet/lib/facter/installed_gems.rb\r\nDec 11 05:41:46 ded-4 puppet-agent[20075]: Loading facts in /var/lib/puppet/lib/facter/installed_gems.rb\r\nDec 11 05:41:46 ded-4 puppet-agent[20076]: Loading facts in /var/lib/puppet/facts/ah_custom_facts.rb\r\nDec 11 05:41:46 ded-4 puppet-agent[20075]: Loading facts in /var/lib/puppet/facts/ah_custom_facts.rb\r\nDec 11 05:42:01 ded-4 puppet-agent[20075]: Caching catalog for ded-4.jk-ah-trunk-lucid-458-1.hosting.acquia.com\r\nDec 11 05:42:02 ded-4 puppet-agent[20076]: Caching catalog for ded-4.jk-ah-trunk-lucid-458-1.hosting.acquia.com\r\nDec 11 05:42:06 ded-4 puppet-agent[20075]: Applying configuration version '1386735465'\r\nDec 11 05:42:07 ded-4 puppet-agent[20076]: Applying configuration version '1386739763'\r\n{code}\r\n\r\nNote that these two puppet runs are applying different configurations - this left the node in an undefined state.","closed_at":"2015-04-08T09:47:18.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1150","labels":"puppet-agent","state":"Closed","updated_at":"2015-04-08T09:47:18.000-0700","timestamp":1652284858.977773,"priority":"Normal","status_category":"Done","pull_request":8903},{"issue_id":"20251","title":"Update CONTRIBUTING.md to talk about acceptable kinds of changes","url":"https://tickets.puppetlabs.com/browse/PUP-933","created_at":"2013-12-04T14:36:28.000-0800","number":"PUP-933","body":"[~adrien] wrote some more specific guidance for community contributors which clarifies the kinds of changes that should go into core vs modules vs don't even do it ... This should get pulled into the CONTRIBUTING.md to increase its visibility.","closed_at":"2015-04-09T10:41:06.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-933","labels":"","state":"Closed","updated_at":"2015-04-09T10:41:06.000-0700","timestamp":1652284860.426123,"priority":"Normal","status_category":"Done","pull_request":7400},{"issue_id":"70714","title":"Pass merge strategy to Hiera using Indirector::Request options","url":"https://tickets.puppetlabs.com/browse/PUP-4132","created_at":"2015-03-09T03:51:03.000-0700","number":"PUP-4132","body":"The new lookup function must to pass the _merge_ argument in the options map of the {{Indirector::Request}} object.  The argument must be converted into an argument recognized by Hiera (i.e. :unique becomes :array) before propagating it to the {{Hiera::lookup()}} method.\r\n","closed_at":"2015-04-09T10:41:08.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4132","labels":"","state":"Closed","updated_at":"2015-04-09T10:41:08.000-0700","timestamp":1652284861.16029,"priority":"Normal","status_category":"Done","pull_request":3697},{"issue_id":"56963","title":"Puppet fails to install correct package when 'ensure => $version' is set","url":"https://tickets.puppetlabs.com/browse/PUP-3604","created_at":"2014-11-02T12:04:41.000-0800","number":"PUP-3604","body":"On OpenBSD some packages have multiple versions available, such as Python 2.7 and 3.3, or openldap-server 2.3 and 2.4.\r\n\r\nWith a resource such as:\r\n\r\n```\r\npackage { 'openldap-server':\r\n  ensure => '2.4'\r\n}\r\n```\r\n\r\nPuppet would end up installing the first valid version it saw on a mirror (2.3, and not 2.4), which is generally the correct approach, unless a user specifically sets the version to install with `ensure`.","closed_at":"2015-04-09T10:41:10.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3604","labels":"","state":"Closed","updated_at":"2015-04-09T10:41:10.000-0700","timestamp":1652284861.368188,"priority":"Normal","status_category":"Done","pull_request":3266},{"issue_id":"69739","title":"Acceptance tests should not rely on the puppetpath beaker option","url":"https://tickets.puppetlabs.com/browse/PUP-4057","created_at":"2015-02-27T15:54:59.000-0800","number":"PUP-4057","body":"Several acceptance tests rely on {{puppetpath}} for both code and configuration related paths. Historically that setting was the same as {{puppetconfdir}}, but with the code/config split, it no longer makes sense.\r\n\r\nThe acceptance tests should be updated to:\r\n\r\n# Use beaker's {{host.puppet\\['setting'\\]}} methods so the test doesn't depend on hard-coded beaker default\r\n# Query for {{codedir}} or {{confdir}} as appropriate.\r\n# Take into account the agent vs master application, e.g. {{host.puppet('master')\\['confdir'\\]}}","closed_at":"2015-04-09T10:41:10.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4057","labels":"AIO","state":"Closed","updated_at":"2015-04-09T10:41:10.000-0700","timestamp":1652284861.472159,"priority":"Normal","status_category":"Done","pull_request":3662},{"issue_id":"69480","title":"hiera_include broken","url":"https://tickets.puppetlabs.com/browse/PUP-4046","created_at":"2015-02-26T03:58:19.000-0800","number":"PUP-4046","body":"Using hiera_include() with puppet-agent as of version 0.3.2.29.g49f7b1b-1.el7 cannot be used due to two problems:\r\n\r\n* a missing requirement on hiera/puppet_function\r\n* a 4x function loaded from puppet cannot call another functions because there is no 'private loader'\r\n\r\nThe second problem is reproduced by this manifest:\r\n{code}\r\nclass foo {\r\n  notice yay\r\n}\r\nhiera_include(classes, [foo])\r\n{code}\r\n\r\nWhich reports the error:\r\n{code}\r\nError: Evaluation Error: Error while evaluating a Function Call, Function hiera_include(): cannot call function 'include' - no loader specified at /Users/henrik/git/puppet/foo.pp:4:1\r\n{code}\r\n\r\nORIGINAL REPORT\r\n----\r\nThe following error is produced for the missing requirement.\r\n{code}\r\n[root@puppet4 manifests]# /opt/puppetlabs/puppet/bin/puppet apply default.pp -t\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nError: Evaluation Error: Error while evaluating a Function Call, uninitialized constant Hiera::PuppetFunction at /etc/puppetlabs/puppet/manifests/default.pp:17:1 on node puppet4.vm.super-visions.com\r\nError: Evaluation Error: Error while evaluating a Function Call, uninitialized constant Hiera::PuppetFunction at /etc/puppetlabs/puppet/manifests/default.pp:17:1 on node puppet4.vm.super-visions.com\r\n{code}\r\n\r\ndefault.pp\r\n{code}\r\nhiera_include('classes', [] )\r\n{code}\r\n\r\nhiera.yaml\r\n{code}\r\n---\r\n:backends:\r\n  - yaml\r\n:hierarchy:\r\n  - defaults\r\n  - \"%{clientcert}\"\r\n  - \"%{environment}\"\r\n  - global\r\n\r\n:yaml:\r\n# datadir is empty here, so hiera uses its defaults:\r\n# - /etc/puppetlabs/code/hieradata on *nix\r\n# - %CommonAppData%\\PuppetLabs\\hiera\\var on Windows\r\n# When specifying a datadir, make sure the directory exists.\r\n  :datadir: /etc/puppetlabs/hieradata\r\n{code}\r\n\r\n/etc/puppetlabs/hieradata is empty, same result with a global.yaml file tested and working on puppet-agent-0.3.2.22.g8642ba7-1.el7 (and before).\r\npuppet.conf is empty\r\n\r\nMore testing shows the following:\r\nWhen adding any/all of the following lines 'before' the hiera_include() in the .pp file the error changes.\r\n{code}\r\n$a = hiera('a','a')\r\n$b = hiera_hash('b',{})\r\n$c = hiera_array('c',[])\r\n{code}\r\n\r\nWith the patch from https://github.com/puppetlabs/puppet/pull/3655 applied the error changes to:\r\n{code}\r\n[root@puppet4 ~]# puppet apply /etc/puppetlabs/puppet/manifests/default.pp -t\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nError: Evaluation Error: Error while evaluating a Function Call, Function hiera_include(): cannot call function 'include' - no loader specified at /etc/puppetlabs/puppet/manifests/default.pp:23:1 on node puppet4.vm.super-visions.com\r\nError: Evaluation Error: Error while evaluating a Function Call, Function hiera_include(): cannot call function 'include' - no loader specified at /etc/puppetlabs/puppet/manifests/default.pp:23:1 on node puppet4.vm.super-visions.com\r\n{code}\r\n","closed_at":"2015-04-09T10:41:11.000-0700","comments":17,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4046","labels":"","state":"Closed","updated_at":"2015-04-09T10:41:11.000-0700","timestamp":1652284861.685102,"priority":"Major","status_category":"Done","pull_request":3763},{"issue_id":"48870","title":"(PR 3003) Pacman provider does not work on manjaro linux","url":"https://tickets.puppetlabs.com/browse/PUP-3128","created_at":"2014-08-22T07:07:06.000-0700","number":"PUP-3128","body":"When applying a manifest on a manjaro linux machine you obtain this error:\r\nError: /Package[dnsmasq]: Provider pacman is not functional on this host\r\n\r\nIf someone fixes it before I do, I believe the issue is the line\r\nconfine     :operatingsystem => :archlinux\r\nin pacman.rb\r\nThe output from facter on my machine is:\r\noperatingsystem => Linux\r\noperatingsystemrelease => 3.12.26-1-MANJARO\r\nhence the problem!","closed_at":"2015-04-09T10:41:14.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3128","labels":"","state":"Closed","updated_at":"2015-04-09T10:41:14.000-0700","timestamp":1652284861.996811,"priority":"Critical","status_category":"Done","pull_request":3003},{"issue_id":"70038","title":"Remove master settings from puppet.conf","url":"https://tickets.puppetlabs.com/browse/PUP-4074","created_at":"2015-03-03T14:18:21.000-0800","number":"PUP-4074","body":"Remove the master section and all related settings from the puppet.conf that puppet-agent installs. But don't delete the file, as it still needs to be installed by puppet-agent.\r\n\r\nSERVER-409 and SERVER-410 make these {{[master]}} section settings no longer necessary.","closed_at":"2015-04-09T10:41:19.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4074","labels":"AIO","state":"Closed","updated_at":"2015-04-09T10:41:19.000-0700","timestamp":1652284862.727739,"priority":"Normal","status_category":"Done","pull_request":3679},{"issue_id":"70497","title":"update puppet-agent path acceptance for Windows 2003 and 32-bit app on 64-bit OS","url":"https://tickets.puppetlabs.com/browse/PUP-4088","created_at":"2015-03-05T14:28:09.000-0800","number":"PUP-4088","body":"First version of {{ensure_puppet-agent_paths}} was based on examples specific to Windows Server 2008+ and using matching Ruby and OS architectures. It needs to be extended to cover Windows Server 2003 paths, and running 32-bit Ruby on a 64-bit Windows.","closed_at":"2015-04-09T10:41:22.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4088","labels":"AIO","state":"Closed","updated_at":"2015-04-09T10:41:22.000-0700","timestamp":1652284863.037529,"priority":"Major","status_category":"Done","pull_request":3688},{"issue_id":"55523","title":"Stop overwriting the agent's facts timestamp","url":"https://tickets.puppetlabs.com/browse/PUP-3488","created_at":"2014-10-17T15:08:15.000-0700","number":"PUP-3488","body":"The master overwrites the timestamp on the agent's facts. This change was made in 2010 (https://github.com/puppetlabs/puppet/commit/fb5f859cf4), and does the wrong thing when there is more than one puppet master. We should stop doing this.\r\n","closed_at":"2015-04-09T10:41:22.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3488","labels":"","state":"Closed","updated_at":"2015-04-09T10:41:22.000-0700","timestamp":1652284863.14113,"priority":"Normal","status_category":"Done","pull_request":3461},{"issue_id":"64430","title":"Yum provider cannot parse long package names","url":"https://tickets.puppetlabs.com/browse/PUP-3861","created_at":"2015-01-17T22:36:30.000-0800","number":"PUP-3861","body":"Pull request #2670 replaces yumhelper with a direct call to yum check-update. The output is then parsed line by line for package update information.\r\n\r\nhttps://github.com/puppetlabs/puppet/commit/8b18639427dbeb17c262f9a459f4d1b6c0380b40#diff-d66f8a2f004447ff56ddba30c0b9161d\r\n\r\nUnfortunately, YUM the yum binary performs line wrapping on all output at 80 characters when piped to an external command. Lines may not contain the expected fields if any long package names are present on the system. This can result in a parse error when the provider is invoked.\r\n\r\nWhile this is not in keeping with the unix philosophy, the YUM authors have no plans to change the behavior.\r\n\r\nhttps://bugzilla.redhat.com/show_bug.cgi?id=584525\r\n\r\nThe workaround is either to invoke YUM using the Python API calls, or to use repoquery instead. Repoquery is part of the yum-utils package, which may or may not be present on the system. Invoking repoquery will solve the issue, but creates a new RPM dependency for Puppet. While yum-utils is part of many standard installs, it's not universally available on all platforms.","closed_at":"2015-04-09T10:41:22.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3861","labels":"","state":"Closed","updated_at":"2015-04-09T10:41:22.000-0700","timestamp":1652284863.360813,"priority":"Normal","status_category":"Done","pull_request":3526},{"issue_id":"69941","title":"Deep merge options cannot be passed as options map.","url":"https://tickets.puppetlabs.com/browse/PUP-4070","created_at":"2015-03-03T03:10:36.000-0800","number":"PUP-4070","body":" When using lookup, the merge strategy can be passed as a map with a 'strategy' key and additional options. This map is type validated and everything works fine for the 'unique' and 'hash' strategies but it fails when  using the 'deep' merge strategy since it allows additional options with varying element types (booleans in particular).\r\n\r\nThe reason this fails is that the type validation incorrectly uses 'infer()' on the given map (which produces a Hash type) instead of 'infer_set()' (which produces a Struct type). The assignable? then fails since it tries to verify all elements of the required type using the common element type of the inferred Hash.","closed_at":"2015-04-09T10:41:23.000-0700","comments":23,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4070","labels":"","state":"Closed","updated_at":"2015-04-09T10:41:23.000-0700","timestamp":1652284863.477341,"priority":"Normal","status_category":"Done","pull_request":3670},{"issue_id":"68028","title":"parsed provider destroys file if a line starts with uppercase Q","url":"https://tickets.puppetlabs.com/browse/PUP-4012","created_at":"2015-02-13T10:13:00.000-0800","number":"PUP-4012","body":"if a record in a file starts with an uppercase Q, puppet will merge this line with the previous line when the file is written back to disc, making the file invalid.\r\n\r\nI know this sounds weired\r\n\r\n{code}\r\ndef lines(text)\r\n  # Remove any trailing separators, and then split based on them\r\n  text.sub(/#{self.line_separator}\\Q/,'').split(self.line_separator)\r\nend\r\n{code}\r\n\r\nI don't get the intention but {{\\Q}} does not have a special meaning in this context so every newline (which is the default line_seperator) followed by an uppercase Q are replaced with the empty string.","closed_at":"2015-04-09T10:41:24.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4012","labels":"","state":"Closed","updated_at":"2015-04-09T10:41:24.000-0700","timestamp":1652284863.686435,"priority":"Major","status_category":"Done","pull_request":3605},{"issue_id":"21459","title":"Resource refreshes don't check for failed dependencies","url":"https://tickets.puppetlabs.com/browse/PUP-1106","created_at":"2013-12-16T11:49:34.000-0800","number":"PUP-1106","body":"Given this manifest:\r\n\r\n{code}\r\nexec{\"moo\":\r\n    command => \"/usr/bin/cowsay 'fail :('\",\r\n    refreshonly => true,\r\n    logoutput => true,\r\n    require  => Exec[\"false\"],\r\n    subscribe => [ File[\"/tmp/1\"], File[\"/tmp/2\"], File[\"/tmp/3\"] ]\r\n}\r\n\r\nfile{\"/tmp/1\": content => 1}\r\nfile{\"/tmp/2\": content => 2}\r\nfile{\"/tmp/3\": content => 3}\r\nexec{\"false\": command => \"/bin/false\"}\r\n{code}\r\n\r\nThe Exec\\[moo] shouldn't run it requires Exec\\[false] which will always fail, but it gets notified by the file resources via its subscribes and then runs anyway regardless of the state of the required resources.\r\n\r\nIn version 2.6.5 this might be related to #5670 but I am filing a new bug since I think its not as this bug is also present in 0.25.x while the one in #5670 is 2.6.x only\r\n\r\n{code}\r\nnotice: //File[/tmp/1]/content: defined content as 'unknown checksum'\r\nnotice: //File[/tmp/3]/content: defined content as 'unknown checksum'\r\nerr: //Exec[false]/returns: change from notrun to 0 failed: /bin/false returned 1 instead of one of [0] at /home/rip/test.pp:12\r\nnotice: //File[/tmp/2]/content: defined content as 'unknown checksum'\r\nnotice: //Exec[moo]: Dependency exec[/bin/false] has 1 failures\r\nwarning: //Exec[moo]: Skipping because of failed dependencies\r\nnotice: //Exec[moo]: Triggering 'refresh' from 3 dependencies\r\nnotice: //Exec[moo]/returns:  _________ \r\nnotice: //Exec[moo]/returns: < fail :( >\r\nnotice: //Exec[moo]/returns:  --------- \r\nnotice: //Exec[moo]/returns:         \\   ^__^\r\nnotice: //Exec[moo]/returns:          \\  (oo)\\_______\r\nnotice: //Exec[moo]/returns:             (__)\\       )\\/\\\r\nnotice: //Exec[moo]/returns:                 ||----w |\r\nnotice: //Exec[moo]/returns:                 ||     ||\r\n{code}","closed_at":"2015-04-09T10:41:27.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1106","labels":"customer;redmine","state":"Closed","updated_at":"2015-04-09T10:41:27.000-0700","timestamp":1652284864.316024,"priority":"Normal","status_category":"Done","pull_request":8610},{"issue_id":"55743","title":"Puppet should allow Upstart service provider for Linux Mint","url":"https://tickets.puppetlabs.com/browse/PUP-3492","created_at":"2014-10-21T05:39:31.000-0700","number":"PUP-3492","body":"Recent versions of LinuxMint use Upstart. But puppet does not allow the upstart provider for LinuxMint so you cannot start services.","closed_at":"2015-04-09T10:41:31.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3492","labels":"","state":"Closed","updated_at":"2015-04-09T10:41:31.000-0700","timestamp":1652284865.007503,"priority":"Normal","status_category":"Done","pull_request":3220},{"issue_id":"59935","title":"defined function does not handle qualified variable names correctly","url":"https://tickets.puppetlabs.com/browse/PUP-3718","created_at":"2014-11-27T16:18:33.000-0800","number":"PUP-3718","body":"The defined function can answer if a variable is defined. If the variable name contains '::' it always returns false even if variable is defined.\r\n\r\n{code}\r\n$x = 10\r\nnotice defined('$::x')\r\n{code}\r\nOr variations thereof referencing a variable in a class.\r\n\r\nThere are no tests for this.","closed_at":"2015-04-09T10:41:33.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3718","labels":"","state":"Closed","updated_at":"2015-04-09T10:41:33.000-0700","timestamp":1652284865.52929,"priority":"Normal","status_category":"Done","pull_request":3356},{"issue_id":"65008","title":"Data providers cannot be added in modules","url":"https://tickets.puppetlabs.com/browse/PUP-3900","created_at":"2015-01-22T14:21:03.000-0800","number":"PUP-3900","body":"The new mechanism for \"agnostic data in modules\" introduced in PUP-1640 has issues with handling additional data-provider mechanisms.\r\n\r\nThis manifests as either problems finding the new extensions, or that the default 'none' is not found.\r\n\r\nA preliminary investigation shows that there are issues with the {{PuppetX}} name space which is used as {{puppetx}} in some places and {{puppet_x}} in other. This ended up being wrong when the injector was made to stop squatting on the PuppetX namespace.\r\n\r\nThere also seems to be an issue with the injector handling multiple contributions to a multibind - either in general or specifically for the configuration of the data providers.\r\n","closed_at":"2015-04-09T10:41:34.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3900","labels":"","state":"Closed","updated_at":"2015-04-09T10:41:34.000-0700","timestamp":1652284865.737482,"priority":"Normal","status_category":"Done","pull_request":3512},{"issue_id":"19796","title":"noop => true is ignored when resource is triggered by other resource","url":"https://tickets.puppetlabs.com/browse/PUP-900","created_at":"2013-11-27T11:21:31.000-0800","number":"PUP-900","body":"when running :\r\n\r\n{code}\r\n    file {'/tmp/asd':\r\n      content => generate('/bin/date'),\r\n    notify  => Exec['ttt'],\r\n    }\r\n\r\n\r\n    exec { 'ttt':\r\n      command   =>'/bin/date',\r\n      logoutput => true,\r\n      noop      => true,\r\n    }\r\n{code}\r\n\r\nexec is still ran even tho it's set to noop, any notify to resource makes it ignore noop parameter:\r\n\r\n{code}\r\n    Notice: /Stage[main]//File[/tmp/asd]/ensure: defined content as '{md5}2f61ea5f548d9cfcda74e24a547dfa86'\r\n    Notice: /Stage[main]//Exec[ttt]/returns: current_value notrun, should be 0 (noop)\r\n    Notice: /Stage[main]//Exec[ttt]/returns: Tue Jun 18 14:12:15 CEST 2013\r\n    Notice: /Stage[main]//Exec[ttt]: Triggered 'refresh' from 1 events\r\n    Notice: Finished catalog run in 0.99 seconds\r\n{code}\r\n","closed_at":"2015-04-09T10:41:37.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-900","labels":"redmine;support","state":"Closed","updated_at":"2015-04-09T10:41:37.000-0700","timestamp":1652284875.526475,"priority":"Normal","status_category":"Done","pull_request":8890},{"issue_id":"13766","title":"Powershell execs failing when running Puppet as a service","url":"https://tickets.puppetlabs.com/browse/PUP-271","created_at":"2013-08-28T11:45:48.000-0700","number":"PUP-271","body":"See https://projects.puppetlabs.com/issues/22258","closed_at":"2015-04-09T15:16:15.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-271","labels":"windows","state":"Closed","updated_at":"2015-04-09T15:16:15.000-0700","timestamp":1652284876.142951,"priority":"Major","status_category":"Done","pull_request":3241},{"issue_id":"13618","title":"Exec of powershell.exe broken when running as a service","url":"https://tickets.puppetlabs.com/browse/PUP-258","created_at":"2013-08-26T08:43:26.000-0700","number":"PUP-258","body":"Ruby 1.9 changed how rubyw.exe works, and that broke puppet #21043. We made a change to puppet to use ruby.exe instead, but this seems to break executing powershell via an exec resource #22258.","closed_at":"2015-04-09T15:19:57.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-258","labels":"windows","state":"Resolved","updated_at":"2015-04-09T15:19:57.000-0700","timestamp":1652284876.454793,"priority":"Major","status_category":"Done","pull_request":2663},{"issue_id":"14453","title":"powershell module's unless and onlyif checks fail on ruby 1.8.7","url":"https://tickets.puppetlabs.com/browse/PUP-317","created_at":"2013-09-11T13:15:30.000-0700","number":"PUP-317","body":null,"closed_at":"2015-04-09T15:21:36.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-317","labels":"windows","state":"Resolved","updated_at":"2015-04-09T15:21:36.000-0700","timestamp":1652284876.559374,"priority":"Normal","status_category":"Done","pull_request":3055},{"issue_id":"14636","title":"puppet 3.3.0 ignores File ignore in recursive copy if talking to pre-3.3.0 master","url":"https://tickets.puppetlabs.com/browse/PUP-338","created_at":"2013-09-13T13:39:27.000-0700","number":"PUP-338","body":"A 3.3.0 agent talking to a pre-3.3.0 master will ignore the file resource's ignore list, i.e. it will copy over unwanted files/directories. This is a fallout of the yaml deprecation effort, b/c the array of ignore patterns was serialized as yaml which was then added to the query parameter list (for the file_metadata endpoint).","closed_at":"2015-04-09T15:43:48.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-338","labels":"","state":"Resolved","updated_at":"2015-04-09T15:43:48.000-0700","timestamp":1652284876.869434,"priority":"Normal","status_category":"Done","pull_request":3299},{"issue_id":"37798","title":"Intermittent 'chage' Puppet installation failure on Ubuntu 14.04 during PDB build","url":"https://tickets.puppetlabs.com/browse/PUP-2706","created_at":"2014-06-02T05:59:45.000-0700","number":"PUP-2706","body":"We keep getting this error during Puppet installation for our PuppetDB builds:\r\n\r\n{code}\r\nSetting up ruby-augeas (0.5.0-2) ...\r\nSetting up libaugeas-ruby (0.5.0-2) ...\r\nSetting up ruby-shadow (2.2.0-1) ...\r\nSetting up ruby-json (1.8.0-1build1) ...\r\nSetting up hiera (1.3.3-1puppetlabs1) ...\r\nSetting up puppet-common (3.6.1-1puppetlabs1) ...\r\nchage: the shadow password file is not present\r\n/usr/bin/chage failed with return code 15, shadow not enabled, password aging cannot be set. Continuing.\r\nchfn: PAM: Authentication failure\r\nadduser: `/usr/bin/chfn -f Puppet configuration management daemon puppet' returned error code 1. Exiting.\r\ndpkg: error processing package puppet-common (--configure):\r\n subprocess installed post-installation script returned error exit status 1\r\ndpkg: dependency problems prevent configuration of puppet:\r\n puppet depends on puppet-common (= 3.6.1-1puppetlabs1); however:\r\n  Package puppet-common is not configured yet.\r\n\r\ndpkg: error processing package puppet (--configure):\r\n dependency problems - leaving unconfigured\r\nProcessing triggers for libc-bin (2.19-0ubuntu6) ...\r\nProcessing triggers for ca-certificates (20130906ubuntu2) ...\r\nUpdating certificates in /etc/ssl/certs... 164 added, 0 removed; done.\r\nRunning hooks in /etc/ca-certificates/update.d....done.\r\nErrors were encountered while processing:\r\n puppet-common\r\n puppet\r\nE: Sub-process /usr/bin/dpkg returned an error code (1)\r\nA package failed to install.  Trying to recover:\r\nSetting up puppet-common (3.6.1-1puppetlabs1) ...\r\nSetting up puppet (3.6.1-1puppetlabs1) ...\r\ninitctl: Unable to connect to Upstart: Failed to connect to socket /com/ubuntu/upstart: Connection refused\r\ninvoke-rc.d: policy-rc.d denied execution of start.\r\n{code}\r\n\r\n(see http://jenkins-release.delivery.puppetlabs.net/job/puppetdb-packaging-2014-06-01-21-11-50-afb66e3aa28a5fe69963f490114c9a9f15cf927c/command=pl_deb%20COW=base-trusty-i386.cow/1/console)\r\n\r\nNow this only happens for Ubuntu 14.04, no other distro we can see exhibits this. It seems we're getting it about 50% of the time (rough guess).\r\n\r\nJust today we received the error twice in a row for both our stable and master branches:\r\n\r\nhttp://jenkins-release.delivery.puppetlabs.net/job/puppetdb-packaging-2014-06-01-21-11-50-afb66e3aa28a5fe69963f490114c9a9f15cf927c/command=pl_deb%20COW=base-trusty-i386.cow/1/console\r\nhttp://jenkins-release.delivery.puppetlabs.net/job/puppetdb-packaging-2014-06-01-23-08-48-d07001846081a5f187b287faddd80c9931ce8dbd/command=pl_deb%20COW=base-trusty-i386.cow/1/consoleFull\r\n\r\nIf we can't get a resolution soon we'll have to drop Ubuntu 14.04 build targets from PDB temporarily as its starting to get more and more frequent now and its affecting our day to day.","closed_at":"2015-04-09T16:01:05.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2706","labels":"","state":"Closed","updated_at":"2015-04-09T16:01:05.000-0700","timestamp":1652284877.18617,"priority":"Normal","status_category":"Done","pull_request":3225},{"issue_id":"70206","title":"lookup should lookup in module when looking up qualified names","url":"https://tickets.puppetlabs.com/browse/PUP-4081","created_at":"2015-03-04T06:15:13.000-0800","number":"PUP-4081","body":"The current behavior of the {{lookup}} function is to only lookup data provided by a module data provider if the call to lookup comes from within the module. \r\nThis is done to protect that one module overrides values for other modules (which is not allowed).\r\n\r\nThe rules should be changed so that a lookup for a fully qualified key should be directed to the module matched by the first name segment (if that module supports a data provider).\r\n\r\nWithout this ability, it is not possible to figure out what the value of a parameter will be (unless it is overridden in the environment or globally) unless that call to lookup comes from within the module.\r\n\r\nAll other keys bound by the module data provider continues to be private and should only be visible to lookups from within the module.\r\n","closed_at":"2015-04-21T15:22:58.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4081","labels":"","state":"Closed","updated_at":"2015-04-21T15:22:58.000-0700","timestamp":1652284878.746429,"priority":"Normal","status_category":"Done","pull_request":3701},{"issue_id":"71568","title":"config.ru is missing codedir argument","url":"https://tickets.puppetlabs.com/browse/PUP-4199","created_at":"2015-03-13T12:39:06.000-0700","number":"PUP-4199","body":"config.ru in master doesn't work because it is missing a codedir. \r\n\r\nPatch incoming. ","closed_at":"2015-04-28T15:55:41.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4199","labels":"","state":"Closed","updated_at":"2015-04-28T15:55:41.000-0700","timestamp":1652284879.468502,"priority":"Normal","status_category":"Done","pull_request":3712},{"issue_id":"66831","title":"Presence of createrepo not checked by acceptance/rpm_util.rb","url":"https://tickets.puppetlabs.com/browse/PUP-3960","created_at":"2015-02-04T11:48:38.000-0800","number":"PUP-3960","body":"The helper functions in acceptance/lib/puppet/acceptance/rpm_util.rb do not verify that the packages {{createrepo}} and {{rpmbuild}} are present on the system under test prior to invoking them.\r\n\r\nThis is causing the following acceptance test to fail:\r\n\r\n{{acceptance/tests/resource/package.common_package_name_in_different_providers.rb}}","closed_at":"2015-05-05T15:56:06.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3960","labels":"","state":"Closed","updated_at":"2015-05-05T15:56:06.000-0700","timestamp":1652284880.502869,"priority":"Normal","status_category":"Done","pull_request":3575},{"issue_id":"79188","title":"Stock Puppet shipping with Ubuntu Vivid (3.7.2) has broken service type","url":"https://tickets.puppetlabs.com/browse/PUP-4540","created_at":"2015-05-07T11:00:36.000-0700","number":"PUP-4540","body":"If you run a puppet manifest on Ubuntu Vivid, certain services get detected incorrectly, and Puppet attempts to treat them as Upstart services, using the /sbin/{start,stop,restart,reload,status} commands. For instance, {{mysql}} works that way. The following Puppet manifest exercises the error:\r\n\r\n{code:none}\r\nservice{'mysql':\r\n\tensure => running,\r\n}\r\n\r\nnotify {\"test\":\r\n\tnotify => Service['mysql']\r\n}\r\n{code}\r\n\r\nOutput:\r\n{code:none}\r\n$ sudo puppet apply test.pp \r\nNotice: Compiled catalog for vdanilchenko-vivid.vistaprint.net in environment production in 0.33 seconds\r\nNotice: test\r\nNotice: /Stage[main]/Main/Notify[test]/message: defined 'message' as 'test'\r\nError: /Stage[main]/Main/Service[mysql]: Could not evaluate: Execution of '/sbin/status mysql' returned 1: status: Unable to connect to Upstart: Failed to connect to socket /com/ubuntu/upstart: Connection refused\r\nError: /Stage[main]/Main/Service[mysql]: Failed to call refresh: Execution of '/sbin/status mysql' returned 1: status: Unable to connect to Upstart: Failed to connect to socket /com/ubuntu/upstart: Connection refused\r\nError: /Stage[main]/Main/Service[mysql]: Execution of '/sbin/status mysql' returned 1: status: Unable to connect to Upstart: Failed to connect to socket /com/ubuntu/upstart: Connection refused\r\n{code}\r\nOf course, this fails because running {{/sbin/status mysql}} fails. This can be verified by simply running it on command line.\r\n\r\nNow the {{apache2}} service, for instance, gets detected correctly (Upstart commands also fail, but Puppet treats apache2 as Init service and manages it correctly); but {{mysql}} breaks.\r\n\r\nI didn't test all the services on the system, but the {{cups}} service, for instance, also breaks, just like {{mysql}}.","closed_at":"2015-05-12T12:54:08.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4540","labels":"","state":"Closed","updated_at":"2015-05-12T12:54:08.000-0700","timestamp":1652284881.038961,"priority":"Normal","status_category":"Done","pull_request":3915},{"issue_id":"77622","title":"Document PUP-4201 JSON logging via --logdest","url":"https://tickets.puppetlabs.com/browse/PUP-4465","created_at":"2015-04-27T12:58:28.000-0700","number":"PUP-4465","body":"PUP-4201 added support for specifying {{--logdest /var/log/somefile.json}} and getting a (partial) JSON array of log message objects. This wasn't documented. \r\n\r\nDocs for {{--logdest}} are in several files in lib/puppet/application/<NAME>.rb. The most important ones are apply, agent, and master. All three of these, at least, need edits to reflect the new feature. \r\n\r\nThis feature is quiet enough and odd enough that I believe updating the description of {{--logdest}} is the only documentation we need. \r\n\r\nh2. QA Risk Analysis\r\n| Probability | Low |\r\n| Impact | Low |\r\n| Risk Level | Low |\r\n| Test Level | none|","closed_at":"2015-05-15T17:50:07.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4465","labels":"","state":"Closed","updated_at":"2015-05-15T17:50:07.000-0700","timestamp":1652284881.348276,"priority":"Normal","status_category":"Done","pull_request":3873},{"issue_id":"77516","title":"split with just Regexp (unparameterized type) splits on whitespace","url":"https://tickets.puppetlabs.com/browse/PUP-4463","created_at":"2015-04-26T13:37:41.000-0700","number":"PUP-4463","body":"Since 4.0.0 it is possible to give a Regexp type to split to specify the pattern to split on.  Since a Regexp without a parameter (pattern) has an undef/nil pattern, and this is given directly to the Ruby String#split method, it is taken to mean \"split on whitespace\".\r\n\r\nThis is different that if the pattern is set to the an empty string, or to an empty regular expression where the split is made on \"nothing\" - i.e. between every character.\r\n\r\nThe most reasonable would be if {{Regexp}} and {{Regexp\\['']}} results in the same regular expression while as types they are different since Regexp accepts any other Regexp, while Regexp[''] only accepts that specific regexp.\r\n\r\nh2. QA Risk Analysis\r\n| Probability | Medium (how frequently do people split with {{Regexp}}?) |\r\n| Impact | Low (unexpected results but no data loss) |\r\n| Risk Level | Medium |\r\n| Test Level | Spec |","closed_at":"2015-05-20T15:24:20.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4463","labels":"","state":"Closed","updated_at":"2015-05-20T15:24:20.000-0700","timestamp":1652284883.726211,"priority":"Normal","status_category":"Done","pull_request":3869},{"issue_id":"73785","title":"puppet apply --trace has stopped producing output","url":"https://tickets.puppetlabs.com/browse/PUP-4336","created_at":"2015-03-28T18:18:22.000-0700","number":"PUP-4336","body":"When running something that fails and using the {{--trace}} flag to get a stack trace, no stack trace appears. This works on 3.7.5, but not on 3.x.\r\n\r\nExpected:\r\n{code}\r\npuppet apply -e '1 < blue' --parser future --trace\r\n{code}\r\n\r\nto produce a stack trace, but no stack trace is produced.\r\n\r\n","closed_at":"2015-05-20T15:24:24.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4336","labels":"","state":"Closed","updated_at":"2015-05-20T15:24:24.000-0700","timestamp":1652284883.938806,"priority":"Critical","status_category":"Done","pull_request":3816},{"issue_id":"79447","title":"TypeCalculator.generalize() produces bad types for Struct","url":"https://tickets.puppetlabs.com/browse/PUP-4551","created_at":"2015-05-11T04:15:41.000-0700","number":"PUP-4551","body":"The {{TypeCalculator.generalize}} strips all information about type and represented value (or values) when applied to a {{String}}. This behavior becomes problematic when generalizing a {{Struct}} type since it means that all information about the keys in that struct is lost and a printout of a generalized Struct becomes nonsensical. The struct:\r\n{code}\r\nStruct[{name => String[1], version => String[1]}]\r\n{code}\r\nbecomes:\r\n{code}\r\nStruct[{'' => String, '' => String}]\r\n{code}\r\n","closed_at":"2015-05-20T15:24:25.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4551","labels":"","state":"Closed","updated_at":"2015-05-20T15:24:25.000-0700","timestamp":1652284884.150099,"priority":"Normal","status_category":"Done","pull_request":3912},{"issue_id":"64942","title":"EPP validator should error when specified template file does not exist","url":"https://tickets.puppetlabs.com/browse/PUP-3895","created_at":"2015-01-22T08:42:29.000-0800","number":"PUP-3895","body":"If an attempt is made to validate or render an existing file that is not an {{.epp}} there is no error, and the exit code is 0. A file that is actually missing is flagged with an error.\r\n\r\nrisk: medium\r\nprobability: medium (only affects epp)\r\nseverity: low (only affects epp)\r\ntest layer: acceptance on exit codes in general, no unit test in PR","closed_at":"2015-05-20T15:24:27.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3895","labels":"EPP","state":"Closed","updated_at":"2015-05-20T15:24:27.000-0700","timestamp":1652284884.632725,"priority":"Normal","status_category":"Done","pull_request":3831},{"issue_id":"70534","title":"Zypper provider doesn't work correctly on SLES 10.4 with install_options set","url":"https://tickets.puppetlabs.com/browse/PUP-4090","created_at":"2015-03-05T22:12:37.000-0800","number":"PUP-4090","body":"h2. Overview\r\nAttempting to run puppet with {{install_options}} set to disable GPG checks for package installation results in an error from the {{zypper}} command that the {{--name}} and {--no-gpg-checks}} options are not recognised.\r\n\r\nWith the stock puppet zypper provider, its impossible to install packages with option set.\r\n\r\nh2.  Test case\r\nThe following Puppet code was used to attempt to bypass the {{zypper}} GPG signing requirements:\r\n{noformat}\r\npackage { 'REDACTED':,\r\n  provider => 'zypper',\r\n  name => REDACTED,\r\n  ensure => $user_supplied_variable,\r\n  install_options => [ '--no-gpg-checks' ],\r\n }\r\n{noformat}\r\n\r\nRunning this code resulted in an error from the {{zypper}} command being returned via a failed Puppet execution:\r\n{noformat}\r\n# /opt/puppet/bin/puppet agent --test\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for REDACTED\r\nInfo: Applying configuration version '1425621321'\r\nError: Could not update: Execution of '/usr/bin/zypper --terse install --auto-agree-with-licenses --no-confirm --name --no-gpg-checks REDACTED(was package name)' returned 2: Unknown option --name\r\nUnknown option --no-gpg-checks\r\nWrapped exception:\r\nExecution of '/usr/bin/zypper --terse install --auto-agree-with-licenses --no-confirm --name --no-gpg-checks REDACTED' returned 2: Unknown option --name\r\nUnknown option --no-gpg-checks\r\nError: /Stage[main]/REDACTED/Package[REDACTED]/ensure: change from absent to latest failed: Could not update: Execution of '/usr/bin/zypper --terse install --auto-agree-with-licenses --no-confirm --name --no-gpg-checks REDACTED' returned 2: Unknown option --name\r\nUnknown option --no-gpg-checks\r\nNotice: Finished catalog run in 0.97 seconds\r\n{noformat}\r\n\r\nh2. Experimental workaround\r\nThe {{zypper}} command in this version of SUSE expects the parameters to be ordered in a different way to that which is coded into the {{zypper.rb}} provider.  As an experiment, I was able to rearrange things so that the parameters were fed in the order that the program accepts:\r\n* --no-gpg-checks must come before the action (install)\r\n* --name doesn't seem to be recognised at any position and had to be removed\r\n* package name should directly follow the action, eg {{install foobar}}\r\n\r\nh2. Long term fix\r\nDue to the way {{zypper}} is invoked, perhaps we may need two arguments to be passed to different parts of the command to get it to work as advertised, eg:\r\n{noformat}\r\nzypper $default_options $command_options $subcommand $subcommand_options $package_name\r\n{noformat}\r\nOr perhaps the invocation of the zypper command has changed between SUSE versions?\r\n\r\nrisk: low \r\nprobability: low: zypper install options on sles10\r\nseverity: low (workarounds exist)\r\ntest layer: unit ","closed_at":"2015-05-20T15:24:27.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4090","labels":"","state":"Closed","updated_at":"2015-05-20T15:24:27.000-0700","timestamp":1652284884.739316,"priority":"Normal","status_category":"Done","pull_request":3774},{"issue_id":"76250","title":"The 'err' logging function cannot be called as a statement","url":"https://tickets.puppetlabs.com/browse/PUP-4428","created_at":"2015-04-16T14:31:49.000-0700","number":"PUP-4428","body":"In the language specification: https://github.com/puppetlabs/puppet-specifications/blob/master/language/expressions.md#function-calls\r\n\r\nunder the \"statement style\" subhead, there's a list like:\r\n{code}\r\n# logging\r\ndebug\r\ninfo\r\nnotice\r\nwarning\r\nerror\r\n{code}\r\n\r\nWhere \"error\" is wrong and don't exist. There are also several similar functions that aren't listed. cf. http://docs.puppetlabs.com/references/latest/configuration.html#loglevel\r\n\r\nWe should allow the 'err' function to be called as a statement. The remaining  logging functions are almost never used and should continue to require parentheses.\r\n\r\nrisk: medium (qa manual validate only for now)\r\nprobability: medium\r\nseverity: low (work arounds exist)\r\ntest layer: acceptance (unit test only confirms parser transform)","closed_at":"2015-05-20T15:24:30.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4428","labels":"","state":"Closed","updated_at":"2015-05-20T15:24:30.000-0700","timestamp":1652284885.343132,"priority":"Normal","status_category":"Done","pull_request":3841},{"issue_id":"36519","title":"Server-set global variables like $::environment get overwritten by client facts","url":"https://tickets.puppetlabs.com/browse/PUP-2630","created_at":"2014-05-21T05:29:44.000-0700","number":"PUP-2630","body":"REPORTED PROBLEM\r\n---\r\nAs per the docs (http://docs.puppetlabs.com/puppet/latest/reference/lang_facts_and_builtin_vars.html#variables-set-by-the-puppet-master) the puppet master sets the global $::environment variable to contain the name of the node's environment. However, if a node provides a fact with the name 'environment' that fact's value overrides the server-set environment.\r\n\r\nThe same happens with other server-set global variables, like $::servername and $::serverip.\r\n\r\nAs a result, modules can't reliably use these variables for whatever their intended purpose is.\r\n\r\nIf this is the intended behavior, then the docs should clarify this and discourage use of the server-set variables, because a misbehaving node can override them.\r\n\r\nSOLUTION\r\n---\r\nAfter discussion with Eric Soerenson, we decided that it was best to make this an opt-in and that we are not adding a function - this for the sake of consistency between $facts, $trusted_facts, and $server_facts. This means:\r\n\r\n    At the same place where we currently set $trusted_facts we should also set $server_facts if users have opted in\r\n    The values set in $server_facts are the @server_facts set in the node by the compiler indirection + the current environment name\r\n    The user opts in by using the setting :trusted_server_facts\r\n    The setting is false by default\r\n    We issue a warning if any node parameter is overwritten\r\n    We need a ticket to add a deprecation for the opt-in being set to false\r\n    We need a ticket for 5.0.0 to remove the opt in and make $server_facts default, and to stop merging the server_facts into the node's parameters\r\n\r\nWhen using puppet apply and {{trusted_server_facts}} is true, the {{$server_facts}} will be a hash with only the key {{environment}} set. The value for this key is the environment that was configured locally on the agent, or given on the command line (i.e. in this case there is no call to the master to compute what the master thinks the environment should be for the node).\r\n\r\nh3. an example $server_facts hash\r\n{serverversion => 4.0.0, servername => v85ix8blah.delivery.puppetlabs.net, serverip => 10.32.115.182, environment => production}\r\n\r\nQA\r\n---\r\nrisk: high\r\nprobability: medium\r\nseverity: high (hard to debug, somewhat of a security issue, can spoof environment)\r\ntest layer: acceptance","closed_at":"2015-05-20T15:24:31.000-0700","comments":20,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2630","labels":"","state":"Closed","updated_at":"2015-05-20T15:24:31.000-0700","timestamp":1652284885.661456,"priority":"Normal","status_category":"Done","pull_request":3942},{"issue_id":"78207","title":"Types Array[?], Hash[?,?], and Optional[?] are not assignable to themselves","url":"https://tickets.puppetlabs.com/browse/PUP-4511","created_at":"2015-05-01T05:33:41.000-0700","number":"PUP-4511","body":"The {{TypeCalculator.assignable?}} method does not consider the types {{Array[?]}}, {{Hash[?,?]}}, and {{Optional[?]}} to be assignable to themselves.\r\n\r\nThis is an internal fix. The problem can not be reproduced from Puppet. The only way to reproduce the problem is to use internal Ruby methods.\r\n\r\nh3. QA\r\n----\r\nrisk: low\r\nprobability: low\r\nseverity: low \r\ntest level: unit","closed_at":"2015-05-20T15:24:31.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4511","labels":"","state":"Closed","updated_at":"2015-05-20T15:24:31.000-0700","timestamp":1652284885.867482,"priority":"Normal","status_category":"Done","pull_request":3884},{"issue_id":"78043","title":"The size_type is dropped when inferring common type for String types","url":"https://tickets.puppetlabs.com/browse/PUP-4499","created_at":"2015-04-30T02:28:00.000-0700","number":"PUP-4499","body":"The {{TypeCalculator}} will lose the {{String.size_type}} when computing the common type of two {{String}} types that both have a {{size_type}}. The correct behavior is to compute the common type of the two.\r\n\r\nh3. QA\r\n----\r\nrisk: low\r\nprobability: low\r\nseverity: low\r\ntest level: unit","closed_at":"2015-05-20T15:24:31.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4499","labels":"","state":"Closed","updated_at":"2015-05-20T15:24:31.000-0700","timestamp":1652284885.968704,"priority":"Normal","status_category":"Done","pull_request":3881},{"issue_id":"77491","title":"Single backslash before $ blocks interpolation in heredoc with no escapes enabled","url":"https://tickets.puppetlabs.com/browse/PUP-4462","created_at":"2015-04-24T15:40:13.000-0700","number":"PUP-4462","body":"Ran:\r\n\r\n{code}\r\n$thing = \"hi there\"\r\nnotice(@(\"END INTERP\"))\r\nThis string should be able to interpolate variables, and all backslashes should\r\nbe interpreted as plain old literal backslashes.\r\nVariable standing apart: ${thing}\r\nVariable enjambed: hey${thing}\r\nVariable with single backslash enjambed: \\${thing}\r\nVariable with double backslash enjambed: \\\\${thing}\r\nEND INTERP\r\n{code}\r\n\r\nThe single backslash before the $ causes a problem. I'm pretty sure this is against [the specification of heredocs|https://github.com/puppetlabs/puppet-specifications/blob/master/language/heredoc.md].\r\n\r\nActual result:\r\n\r\n{code}\r\nNotice: Scope(Class[main]): This string should be able to interpolate variables, and all backslashes should\r\nbe interpreted as plain old literal backslashes.\r\nVariable standing apart: hi there\r\nVariable enjambed: heyhi there\r\nVariable with single backslash enjambed: \\${thing}\r\nVariable with double backslash enjambed: \\\\hi there\r\n\r\n{code}\r\n\r\nExpected result: \r\n\r\n{code}\r\nNotice: Scope(Class[main]): This string should be able to interpolate variables, and all backslashes should\r\nbe interpreted as plain old literal backslashes.\r\nVariable standing apart: hi there\r\nVariable enjambed: heyhi there\r\nVariable with single backslash enjambed: \\hi there\r\nVariable with double backslash enjambed: \\\\hi there\r\n\r\n{code}\r\n\r\n3.7.5 and 4.0.0 behave identically. \r\n\r\nIn addition, if any escape (other than '$' escapes) are turned on, it also turns on escaping of '$'. This is caused by the same faulty logic.\r\n\r\nh3. QA\r\n----\r\nrisk: medium (validate only)\r\nprobability: low (single backslash directly before interpolation in pp heredoc)\r\nseverity: medium (obvious issue, workarounds)\r\ntest level: unit","closed_at":"2015-05-20T15:24:33.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4462","labels":"","state":"Closed","updated_at":"2015-05-20T15:24:33.000-0700","timestamp":1652284895.511938,"priority":"Normal","status_category":"Done","pull_request":3867},{"issue_id":"74769","title":"Future parser interpolation with [] after variable prefixed with underscore","url":"https://tickets.puppetlabs.com/browse/PUP-4379","created_at":"2015-04-06T16:45:09.000-0700","number":"PUP-4379","body":"When a variable containing a hash has a name prefixed with an underscore:\r\n{noformat}\r\n$_foo = {\r\n  'a' => 'b',\r\n}\r\nnotify { \"${_foo['a']}\": }\r\n{noformat}\r\n\r\nand run `puppet apply --parser=future` you get the following error:\r\n{noformat}\r\nError: Evaluation Error: The value 'a' cannot be converted to Numeric. on node uagent2.corp.puppetlabs.net\r\nError: Evaluation Error: The value 'a' cannot be converted to Numeric. on node uagent2.corp.puppetlabs.net\r\n{noformat}\r\n\r\nThat looks like it might be assuming that the hash is an array?\r\n\r\nThe following applies without error:\r\n{noformat}\r\n$foo = {\r\n  'a' => 'b',\r\n}\r\nnotify { \"${foo['a']}\": }\r\n{noformat}\r\n\r\nThis fails with the future parser on puppet 3.7.5, and also fails against master (at 7ba7ae8f3b221896a3b77beb6778b7a895671c7d)","closed_at":"2015-05-20T15:24:33.000-0700","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4379","labels":"","state":"Closed","updated_at":"2015-05-20T15:24:33.000-0700","timestamp":1652284895.620002,"priority":"Normal","status_category":"Done","pull_request":3794},{"issue_id":"74584","title":"Splatting attributes into an amended attribute block isn't supported","url":"https://tickets.puppetlabs.com/browse/PUP-4374","created_at":"2015-04-03T14:19:30.000-0700","number":"PUP-4374","body":"Per [~henrik.lindberg] in email, this is supposed to work... but it totally doesn't.\r\n\r\n{code}\r\nnotify {'first':}\r\n\r\n$myattrs = {\"message\" => \"from a reference attribute block\"}\r\n\r\nNotify[first] { *=> $myattrs }\r\n# Error: Could not parse for environment production: The operator '* =>' in an Object is not supported. at /Users/nick/Documents/splat_reference.pp:5:17 on node magpie.lan\r\n\r\nnotify {'extra': *=> $myattrs }\r\n# works fine.\r\n\r\nNotify <| title == 'first' |> { *=> $myattrs }\r\n# Error: Could not parse for environment production: In Puppet::Pops::Model::CollectExpression : Can not use a Puppet::Pops::Model::AttributesOperation where a Puppet::Pops::Model::AttributeOperation is expected on node magpie.lan\r\n{code}\r\n\r\nh3. QA\r\n----\r\nrisk: medium\r\nprobability: low (passing a whole block)\r\nseverity: medium (work-arounds available, obvious problem)\r\ntest layer: unit-integration","closed_at":"2015-05-20T15:24:33.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4374","labels":"","state":"Closed","updated_at":"2015-05-20T15:24:33.000-0700","timestamp":1652284895.724079,"priority":"Normal","status_category":"Done","pull_request":3864},{"issue_id":"78433","title":"Future parser is not correctly handling the default case of a case statement","url":"https://tickets.puppetlabs.com/browse/PUP-4520","created_at":"2015-05-04T12:29:46.000-0700","number":"PUP-4520","body":"According to https://docs.puppetlabs.com/puppet/latest/reference/future_lang_conditional.html#behavior-2 the future parser should always evaluate the default case last; however, that does not seem to be happening.  The following code, executed on a VM always returns the default case.\r\n\r\n{code:puppet}\r\n[root@master ~]# facter is_virtual\r\ntrue\r\n[root@master ~]# cat foo.pp\r\ncase $is_virtual {\r\n  default: { notify { \"default case\": } }\r\n  true: { notify { \"nondefault case\": } }\r\n}\r\n[root@master ~]# puppet apply foo.pp\r\nNotice: Compiled catalog for master.inf.puppetlabs.demo in environment production in 0.51 seconds\r\nNotice: default case\r\nNotice: /Stage[main]/Main/Notify[default case]/message: defined 'message' as 'default case'\r\nNotice: Finished catalog run in 0.28 seconds\r\n{code}","closed_at":"2015-05-20T15:24:33.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4520","labels":"","state":"Closed","updated_at":"2015-05-20T15:24:33.000-0700","timestamp":1652284895.833498,"priority":"Major","status_category":"Done","pull_request":3893},{"issue_id":"79448","title":"Resource parameter validation uses TypeCalculator.infer instead of infer_set","url":"https://tickets.puppetlabs.com/browse/PUP-4552","created_at":"2015-05-11T05:21:00.000-0700","number":"PUP-4552","body":"Type TypeCalculator.infer is used when type constrained resource parameters are validated which means that important information is lost when an error message is printed. The following expression:\r\n{code}\r\ndefine foo(Struct[{b => Integer, d=>String}] $a) { notice $a }\r\nfoo{ bar: a => {b => 5, c => 'stuff'}}\r\n{code}\r\ncurrently results in the following error message:\r\n{code}\r\nError: Expected parameter 'a' of 'Foo[bar]' to have type Struct[{'b'=>Integer, 'd'=>String}], got Hash[String, Scalar]\r\n{code}\r\nthe correct output (when using `infer_set` instead of `infer`) should be:\r\n{code}\r\nError: Expected parameter 'a' of 'Foo[bar]' to have type Struct[{'b'=>Integer, 'd'=>String}], got Struct[{'b'=>Integer, 'c'=>String}]\r\n{code}\r\n","closed_at":"2015-05-20T15:24:35.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4552","labels":"","state":"Closed","updated_at":"2015-05-20T15:24:35.000-0700","timestamp":1652284896.252217,"priority":"Normal","status_category":"Done","pull_request":3937},{"issue_id":"17143","title":"Run spec tests for opened PR on Windows ","url":"https://tickets.puppetlabs.com/browse/PUP-585","created_at":"2013-10-23T13:54:11.000-0700","number":"PUP-585","body":"Filing on behalf of [~ethan].\r\n\r\nTravis-ci works great for running PR on Linux, but they do not support Windows yet: https://github.com/travis-ci/travis-ci/issues/216\r\n\r\n[~branan] and [~ethan] talked about this, and there may be a jenkins plugin to allow us to execute github PR against our internal CI. This would help identify windows issues before the code gets to \"ready for merge\"","closed_at":"2015-05-20T15:24:36.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-585","labels":"windows","state":"Closed","updated_at":"2015-05-20T15:24:36.000-0700","timestamp":1652284896.354422,"priority":"Normal","status_category":"Done","pull_request":4779},{"issue_id":"78045","title":"TypeCalculator instance_of? does not consider String type values.","url":"https://tickets.puppetlabs.com/browse/PUP-4501","created_at":"2015-04-30T02:37:27.000-0700","number":"PUP-4501","body":"The {{TypeCalculator.instance_of?}} method for {{PStringType}} only checks if the incoming object is a {{String}} and if it's size is compliant with the {{size_type}}. It does not check if the type has values and, if so, if the given string is one of them. This check must be added.\r\n\r\nh3. QA\r\n----\r\nrisk: medium\r\nprobability: medium (instance_of? on string values)\r\nseverity: medium (could produce incorrect result)\r\ntest level: unit","closed_at":"2015-05-20T15:24:36.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4501","labels":"","state":"Closed","updated_at":"2015-05-20T15:24:36.000-0700","timestamp":1652284896.558159,"priority":"Normal","status_category":"Done","pull_request":3880},{"issue_id":"71041","title":"defined() function returns true for undef and empty string, and false for \"main\"","url":"https://tickets.puppetlabs.com/browse/PUP-4178","created_at":"2015-03-10T13:21:20.000-0700","number":"PUP-4178","body":"The defined() function is written using the 3.x API and cannot differentiate between undefined and the empty string. Moving the function to the 4.x function API solves that issue.\r\n\r\nThe second issue is if the main class (known as '' internally) really should be available under that name. Everyone knows it as \"main\", and it is not possible to create your own \"main\" class without causing strange side effects.\r\n\r\n{code}\r\npuppet apply -e 'notice(defined(\"\"))'\r\nNotice: Scope(Class[main]): true\r\n\r\npuppet apply -e 'notice(defined(\"main\"))'\r\nNotice: Scope(Class[main]): false\r\n\r\npuppet apply -e 'notice(defined(undef))'\r\nNotice: Scope(Class[main]): true\r\n{code}\r\n\r\nFurther, it is not possible to ask specifically if a class foo is defined, or if a resource type foo is defined using the current version of the function since\r\na request for {{Class\\[foo]}} requires that the class is included in the catalog, and a request for {{'foo'}} is satisfied by either a built in type, a define\r\nor a class. For a resource type (built in or user defined) it is possible to ask for only the type e.g. {{File}}, or {{Resource\\[File]}}. To facilitate this, and for completeness, it should be possible to ask if {{Type\\[Class\\[foo]]}} is defined (as well as {{Type\\[Resource\\[T]]}} (even if the later is not absolutely required).\r\n\r\nThe solutions (in PR 3840) produces:\r\n{code}\r\nnotice defined('')     # false\r\nnotice defined(undef)  # error\r\nnotice defined('main') # true\r\n\r\nclass not_included { }\r\nnotice defined('not_included') # true (but you don't know what it is)\r\nnotice defined(Class[not_included]) # false\r\nnotice defined(Type[Class[not_included]]) # true\r\nnotice defined(Type[Class[non_existing]]) # false\r\n\r\n{code}\r\n\r\nWhen defined is used with the future parser on 3.x, and always on 4.x\r\n\r\nrisk: medium\r\nprobability: medium\r\nseverity: medium (confusing, can cause code to be unpredictable, but work arounds exist)\r\ntest layer: unit","closed_at":"2015-05-20T15:24:36.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4178","labels":"","state":"Closed","updated_at":"2015-05-20T15:24:36.000-0700","timestamp":1652284896.660733,"priority":"Minor","status_category":"Done","pull_request":3840},{"issue_id":"78044","title":"Common type of two strings where only one has values is too restricted","url":"https://tickets.puppetlabs.com/browse/PUP-4500","created_at":"2015-04-30T02:32:36.000-0700","number":"PUP-4500","body":"The {{TypeCalculator.common_type(t1,t2)}} method, when given two Strings where only one of the Strings has values will yield a common String type that is restricted to those values. This is wrong. If one of the types is unrestricted, then the common type must also be unrestricted.\r\n\r\nh3. QA\r\n----\r\nrisk: low\r\nprobability: low \r\nseverity: low\r\ntest level: unit","closed_at":"2015-05-20T15:24:36.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4500","labels":"","state":"Closed","updated_at":"2015-05-20T15:24:36.000-0700","timestamp":1652284896.764285,"priority":"Normal","status_category":"Done","pull_request":3881},{"issue_id":"74946","title":"Can't write WOMANS HAT emoji with \\uXXXX unicode escapes","url":"https://tickets.puppetlabs.com/browse/PUP-4385","created_at":"2015-04-07T14:41:03.000-0700","number":"PUP-4385","body":"Unicode includes a bunch of 5+ hex digit characters now; most notably emoji, but I think there might be some real human language characters in there too.\r\n\r\nPuppet's \\u escape sequences don't accommodate these. The 5-digit versions get truncated, and the alternate 2x4-digit forms result in an error. \r\n\r\n{code}\r\nnotice(\"5 digit unicode \\u1f452 hat\") # prints: 5 digit unicode ὅ2 hat\r\n# notice(\"double 4 digit unicode \\uD83D\\uDC52 hat\") # Results in Error: Could not parse for environment production: invalid byte sequence in UTF-8 on node magpie.lan\r\nnotice(\"literal 👒 hat\") # works fine\r\n{code}\r\n\r\nh2. Update\r\nThe implementation allows using the escape \r\n{code}\r\n\\u{nnnn}\r\n{code}\r\n where n is 1 or more hex digits.\r\n{code:puppet}\r\nnotice(\"5 digit unicode \\u{1f452} hat\")\r\n{code}\r\n\r\nh2. QA Risk Analysis\r\n| Probability | Medium (anyone using 5+ byte unicode characters)|\r\n| Impact | Medium (broken Unicode support breaks puppet) |\r\n| Risk Level | Medium |\r\n| Test Level | Spec |","closed_at":"2015-05-20T15:24:37.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4385","labels":"","state":"Closed","updated_at":"2015-05-20T15:24:37.000-0700","timestamp":1652284896.868387,"priority":"Minor","status_category":"Done","pull_request":3797},{"issue_id":"62710","title":"hiera('some::key', undef) returns empty string","url":"https://tickets.puppetlabs.com/browse/PUP-3863","created_at":"2014-12-31T11:11:50.000-0800","number":"PUP-3863","body":"When using the {{hiera()}} function with a second parameter of {{undef}}, Hiera returns the empty string for the value. When using Puppet 3.7 future parser, this means that Hiera returns a truthy value when it cannot find a key.\r\n\r\nIn the Puppet 3 language, this doesn't matter because {{'' == undef}} evaluates to {{true}}.\r\n\r\nA workaround for this is to specify a second parameter of {{false}} instead of {{undef}}, but that doesn't make this behavior any less confusing.\r\n\r\n*Final resolution:* In the Puppet 4 language, the hiera functions will now respect and return a default of {{undef}}, same as they do in the Puppet 3 language. ([in comment|https://tickets.puppetlabs.com/browse/PUP-3863?focusedCommentId=134708&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-134708])\r\n\r\nrisk assessment: high\r\nprobability: high (regression)\r\nseverity: medium (can work around in puppet code, but it's not-expected)\r\nhighest test layer: acceptance\r\nFR only for now (acceptance is ticketed in a larger test for all functions) [PUP-4342|https://tickets.puppetlabs.com/browse/PUP-4342]","closed_at":"2015-05-20T15:24:38.000-0700","comments":28,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3863","labels":"future-parser","state":"Closed","updated_at":"2015-05-20T15:24:38.000-0700","timestamp":1652284897.078187,"priority":"Normal","status_category":"Done","pull_request":3776},{"issue_id":"73783","title":"hiera_include stopped working","url":"https://tickets.puppetlabs.com/browse/PUP-4334","created_at":"2015-03-28T13:45:43.000-0700","number":"PUP-4334","body":"This worked in version 3.7.4, and is broken in 3.7.5:\r\nhiera_include('classes', '')\r\nnode foo {\r\n}\r\n\r\nBut only as a catalog compile driven for nodes, I can't get it to happen for puppet apply.\r\n\r\nIt gets a failure of:\r\nError: Could not retrieve catalog from remote server: Error 400 on SERVER: Evaluation Error: Error while evaluating a Function Call, uninitialized constant Hiera::PuppetFunction at .../manifests/site.pp:48:1 on node puppetmaster\r\n\r\nWhere line 48 is where I have hiera_include('classes', '')","closed_at":"2015-05-20T15:24:38.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4334","labels":"hiera","state":"Closed","updated_at":"2015-05-20T15:24:38.000-0700","timestamp":1652284897.18456,"priority":"Blocker","status_category":"Done","pull_request":3763},{"issue_id":"75667","title":"Splat unfolding not supported in method call syntax","url":"https://tickets.puppetlabs.com/browse/PUP-4398","created_at":"2015-04-11T21:58:56.000-0700","number":"PUP-4398","body":"I expected the following to be equivalent:\r\n\r\nFunction call sytnax:\r\n{code}\r\nwith(*[1, 2, 3]) |$x, $y, $z| {\r\n    notice $x, $y, $z\r\n}\r\n{code}\r\n\r\nMethod call syntax:\r\n{code}\r\n(*[1, 2, 3]).with |$x, $y, $z| {\r\n    notice $x, $y, $z\r\n}\r\n{code}\r\n\r\nThe function call outputs:\r\n{code}\r\nNotice: Scope(Class[main]): 1 2 3\r\n{code}\r\n\r\nThe method call outputs an error:\r\n{code}\r\nError: Evaluation Error: Parameter $y is required but no value was given at...\r\n{code}\r\n\r\nIn the latter, $x is the array without being unfolded.\r\n\r\nNote: I could not find a workaround in the syntax to be able to splat for a method call.\r\n\r\nrisk: medium\r\nprobability: low (unfolding IN arrays/method calls/etc)\r\nseverity: medium (no work arounds other than using different class function structure)\r\ntest layer: unit","closed_at":"2015-05-20T15:24:39.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4398","labels":"","state":"Closed","updated_at":"2015-05-20T15:24:39.000-0700","timestamp":1652284897.288278,"priority":"Normal","status_category":"Done","pull_request":3824},{"issue_id":"63137","title":"Duplicated error output","url":"https://tickets.puppetlabs.com/browse/PUP-3814","created_at":"2015-01-07T04:17:08.000-0800","number":"PUP-3814","body":"{code}\r\n[mguezuraga@server ~]$ puppet apply -e \"notice this_will_fail('yes')\"\r\nError: Unknown function this_will_fail at line 1 on node server\r\nError: Unknown function this_will_fail at line 1 on node server\r\n[mguezuraga@server ~]$\r\n{code}\r\n\r\nI started looking into this, because I saw it on a different place, such as:\r\n\r\n{code}\r\n[mguezuraga@server ~]$ cat test.pp\r\nservice { \"nginx\":\r\n    ensure => \"running\",\r\n}\r\n\r\n# Forcing an error in nginx.conf\r\n[mguezuraga@server ~]$ sudo puppet apply test.pp\r\nNotice: Compiled catalog for server in environment production in 0.24 seconds\r\nError: Could not start Service[nginx]: Execution of '/sbin/service nginx start' returned 1: Starting nginx: nginx: [emerg] \"worker_processes\" directive invalid value in /etc/nginx/nginx.conf:8\r\n[FAILED]\r\nWrapped exception:\r\nExecution of '/sbin/service nginx start' returned 1: Starting nginx: nginx: [emerg] \"worker_processes\" directive invalid value in /etc/nginx/nginx.conf:8\r\n[FAILED]\r\nError: /Stage[main]/Main/Service[nginx]/ensure: change from stopped to running failed: Could not start Service[nginx]: Execution of '/sbin/service nginx start' returned 1: Starting nginx: nginx: [emerg] \"worker_processes\" directive invalid value in /etc/nginx/nginx.conf:8\r\n[FAILED]\r\nNotice: Finished catalog run in 1.31 seconds\r\n[mguezuraga@server ~]$\r\n{code}\r\n\r\nrisk: medium (low severity)\r\nprobability: high\r\nseverity: low (meh, but impacts overall quality \"feel\")\r\nhighest test layer: acceptance","closed_at":"2015-05-20T15:24:39.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3814","labels":"","state":"Closed","updated_at":"2015-05-20T15:24:39.000-0700","timestamp":1652284897.391361,"priority":"Minor","status_category":"Done","pull_request":3865},{"issue_id":"72534","title":"unless with else when then part is empty produces nil result (future parser)","url":"https://tickets.puppetlabs.com/browse/PUP-4278","created_at":"2015-03-20T15:58:48.000-0700","number":"PUP-4278","body":"{code}\r\nnotice unless false {} else { correct }\r\n{code}\r\nshould notice 'correct', but notices ''.\r\n\r\nIf instead this is evaluated:\r\n{code}\r\nnotice unless false { derp } else { correct }\r\n{code}\r\nthe value 'correct' is noticed.\r\n","closed_at":"2015-05-20T15:24:39.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4278","labels":"","state":"Closed","updated_at":"2015-05-20T15:24:39.000-0700","timestamp":1652284897.493006,"priority":"Major","status_category":"Done","pull_request":3749},{"issue_id":"34218","title":"Puppet running as Solaris SMF service needs to run child processes in separate \"contract\"","url":"https://tickets.puppetlabs.com/browse/PUP-2455","created_at":"2014-05-05T00:48:51.000-0700","number":"PUP-2455","body":"If Puppet is running on a Solaris server as an SMF service, and starts a long-running process - e.g. it starts a daemon via an init script - that process is within the same \"contract\" as the Puppet agent process. If the Puppet agent is stopped/restarted, SMF waits for the **contract** to finish, not just the agent process. As the daemon doesn't terminate, the contract doesn't finish within the configured timeout, and so SMF puts the service into \"maintenance\" state and sends **kill -9** to all processes still left in the contract.\r\n\r\nIt is possible to force a process to run in a new contract (e.g. using \"/usr/bin/ctrun\") and it would be useful if Puppet could support this on Solaris, so that the agent can be stopped/restarted without affecting services that it manages.\r\n\r\n\r\n\r\nSteps to reproduce:\r\n\r\n1. Configure and run a puppet agent as an SMF service (using the default \"contract\" model of service management).\r\n   (For example, install & configure the OpenCSW Puppet package)\r\n2. Set puppet to manage a daemon that is started by an init script.\r\n3. Try to stop the puppet agent.\r\n4. Observe (from the service log files, server's messages file, and process listings) that the init-controlled daemon has been killed and the puppet agent service placed into \"maintenance\" state.\r\n\r\nIn my test scenario, Puppet was starting an exim daemon via an init script. \r\n{code}\r\n# ptree -c\r\n[process contract 1]\r\n  1     /sbin/init\r\n    [process contract 4]\r\n      7     /lib/svc/bin/svc.startd\r\n[...]\r\n        [process contract 3431]\r\n          4056  ./exim -bd -q1m\r\n          4138  /opt/csw/bin/ruby18 /opt/csw/sbin/puppetd\r\n          4270  pkgserv -N pkginfo\r\n\r\n# svcadm disable cswpuppetd\r\n# tail -f /var/svc/log/network-cswpuppetd:default.log\r\n[ Nov 12 17:48:27 Stopping because service disabled. ]\r\n[ Nov 12 17:48:27 Executing stop method (\"/var/opt/csw/svc/method/svc-cswpuppetd stop\") ]\r\nStopping Puppet client services: puppetd\r\n[ Nov 12 17:48:32 Method \"stop\" exited with status 0 ]\r\n[ Nov 12 17:49:27 Method or service exit timed out.  Killing contract 3431 ]\r\n^C\r\n# ps -ef | grep exim\r\n    root  4394  2825   0 18:03:13 pts/1       0:00 grep exim\r\n# svcs -vx\r\nsvc:/network/cswpuppetd:default (?)\r\n State: maintenance since Mon Nov 12 17:49:28 2012\r\nReason: Method failed.\r\n   See: http://sun.com/msg/SMF-8000-8Q\r\n   See: /var/svc/log/network-cswpuppetd:default.log\r\nImpact: This service is not running.\r\n\r\n{code}","closed_at":"2015-05-26T15:51:06.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2455","labels":"redmine;solaris","state":"Closed","updated_at":"2015-05-26T15:51:06.000-0700","timestamp":1652284899.209731,"priority":"Normal","status_category":"Done","pull_request":3805},{"issue_id":"77922","title":"Adding user to group fails","url":"https://tickets.puppetlabs.com/browse/PUP-4491","created_at":"2015-04-29T08:24:11.000-0700","number":"PUP-4491","body":"When adding a user to a group, the command usermod fails:\r\n\r\n{code:title=user.pp}\r\nuser {'root':\r\n  groups => ['root', 'wheel'],\r\n}\r\n{code}\r\n\r\n{code:title=Console output}\r\nError: Could not set groups on user[root]: Execution of '/usr/sbin/usermod -S root,wheel root' returned 2: /usr/sbin/usermod: invalid option -- 'S'\r\n{code}","closed_at":"2015-06-03T18:16:03.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4491","labels":"","state":"Closed","updated_at":"2015-06-03T18:16:03.000-0700","timestamp":1652284899.817052,"priority":"Normal","status_category":"Done","pull_request":3909},{"issue_id":"82032","title":"Puppet::Parser::Scope has no inspect method which is causing an extremely large string to be produced","url":"https://tickets.puppetlabs.com/browse/PUP-4665","created_at":"2015-05-28T11:57:25.000-0700","number":"PUP-4665","body":"Recently, SERVER-556 was filed against Puppet Server. After some investigation, it seems that when an error is thrown in Puppet's {{template}} function, Ruby will call inspect on the top-level scope object, but not use the returned string.\r\n\r\nHowever, since the {{Puppet::Parser::Scope}} class has no inspect method of its own, inspecting the scope object causes an absolutely massive string to be produced and never used. The more code the user has in their environment, the larger the string. This string can grow so large that it can cause an OOM error when running Puppet Server due to the restrictions placed on the heap size.\r\n\r\nWe need to add an {{inspect}} method to the {{Puppet::Parser::Scope}} class that returns something simple to avoid this.","closed_at":"2015-06-05T15:20:19.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4665","labels":"","state":"Closed","updated_at":"2015-06-05T15:20:19.000-0700","timestamp":1652284900.226768,"priority":"Normal","status_category":"Done","pull_request":3973},{"issue_id":"74565","title":"Windows ADSI User groups property should behave similarly to Groups members property","url":"https://tickets.puppetlabs.com/browse/PUP-4373","created_at":"2015-04-03T11:58:13.000-0700","number":"PUP-4373","body":"When setting groups using the User resource:\r\n\r\n{noformat}\r\nuser { \"bud\":\r\n  ensure => present,\r\n  groups => ['BUILTIN\\Administrators'],\r\n}\r\n{noformat}\r\n\r\nit runs into issues because it is trying to compare names and not SIDs like the users in a group resource do. It also doesn't allow empty groups like can be done with PUP-3653. \r\n\r\nWe should enhance it so it has more parity with the groups resource.","closed_at":"2015-06-08T06:44:09.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4373","labels":"windows","state":"Closed","updated_at":"2015-06-08T06:44:09.000-0700","timestamp":1652284900.730262,"priority":"Minor","status_category":"Done","pull_request":3939},{"issue_id":"21420","title":"Pacman provider constantly reinstalls package groups on arch linux","url":"https://tickets.puppetlabs.com/browse/PUP-1085","created_at":"2013-12-16T11:19:31.000-0800","number":"PUP-1085","body":"The pacman system understands the concept of package \"groups\"; a group of packages given a name, all of which are installed when that name is specified. The default repos' package groups can be seen at https://www.archlinux.org/groups/; examples include kdebase (22 packages; https://www.archlinux.org/groups/x86_64/kdebase/), xorg (77 packages ;https://www.archlinux.org/groups/x86_64/xorg/) and xorg-apps (37 packages; https://www.archlinux.org/groups/x86_64/xorg-apps/).\r\n\r\nIf I specify one of these groups as a Package resource in my manifest, the packages within the group are reinstalled at every puppet run. This is because running a package list query (listcmd; pacman -Q) only lists the actual packages installed, not the groups.\r\n\r\nThe pacman provider (self.instances) should also execute `pacman -Qg` and add the unique values of the first column of output (the names of installed package groups) to the list of installed packages - this will stop the reinstall from happening.","closed_at":"2015-06-09T15:43:34.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1085","labels":"arch;package;pacman;redmine","state":"Closed","updated_at":"2015-06-09T15:43:34.000-0700","timestamp":1652284901.240322,"priority":"Normal","status_category":"Done","pull_request":8536},{"issue_id":"68247","title":"Update embedded docs for package resource type in light of PUP-1073","url":"https://tickets.puppetlabs.com/browse/PUP-4027","created_at":"2015-02-17T16:35:20.000-0800","number":"PUP-4027","body":"Update the main description for the resource type, as well as the description of the :name attribute. Salient points are:\r\n\r\n* Different providers can use the same package name, but resources need unique titles. \r\n* When making a resource reference to a package resource, you need to do Package['title of resource'], not Package[name]. Automatic aliasing doesn't work with this type anymore. \r\n\r\nAlso, let's fix the examples in the :name description, because they're actually kind of heinous. Make it so they actually set {{name => ...etc}} and use a stable and reliable resource title. ","closed_at":"2015-06-09T15:52:41.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4027","labels":"","state":"Closed","updated_at":"2015-06-09T15:52:41.000-0700","timestamp":1652284901.543374,"priority":"Normal","status_category":"Done","pull_request":3624},{"issue_id":"76367","title":"With a gem install of puppet, when run as root, 'puppet {agent|apply}' fail","url":"https://tickets.puppetlabs.com/browse/PUP-4436","created_at":"2015-04-17T16:22:39.000-0700","number":"PUP-4436","body":"This is because of the new AIO paths. For package installs, these directories are created, and for non-root users, the appropriate directories are created. But gem installs run as root will run into something like this:\r\n\r\n{code}\r\n[root@om6o1hcgialwa9i ~]# puppet apply -e 'notice foo'\r\nNotice: Scope(Class[main]): foo\r\nNotice: Compiled catalog for om6o1hcgialwa9i.delivery.puppetlabs.net in environment production in 0.36 seconds\r\nError: Cannot create /etc/puppetlabs/puppet; parent directory /etc/puppetlabs does not exist\r\nError: /File[/etc/puppetlabs/puppet]/ensure: change from absent to directory failed: Cannot create /etc/puppetlabs/puppet; parent directory /etc/puppetlabs does not exist\r\nError: Cannot create /etc/puppetlabs/code; parent directory /etc/puppetlabs does not exist\r\nError: /File[/etc/puppetlabs/code]/ensure: change from absent to directory failed: Cannot create /etc/puppetlabs/code; parent directory /etc/puppetlabs does not exist\r\nError: Cannot create /opt/puppetlabs/puppet/cache; parent directory /opt/puppetlabs/puppet does not exist\r\nError: /File[/opt/puppetlabs/puppet/cache]/ensure: change from absent to directory failed: Cannot create /opt/puppetlabs/puppet/cache; parent directory /opt/puppetlabs/puppet does not exist\r\nError: Cannot create /var/log/puppetlabs/puppet; parent directory /var/log/puppetlabs does not exist\r\nError: /File[/var/log/puppetlabs/puppet]/ensure: change from absent to directory failed: Cannot create /var/log/puppetlabs/puppet; parent directory /var/log/puppetlabs does not exist\r\nNotice: /File[/opt/puppetlabs/puppet/cache/state]: Dependency File[/opt/puppetlabs/puppet/cache] has failures: true\r\nWarning: /File[/opt/puppetlabs/puppet/cache/state]: Skipping because of failed dependencies\r\nNotice: /File[/opt/puppetlabs/puppet/cache/lib]: Dependency File[/opt/puppetlabs/puppet/cache] has failures: true\r\nWarning: /File[/opt/puppetlabs/puppet/cache/lib]: Skipping because of failed dependencies\r\nNotice: /File[/etc/puppetlabs/puppet/ssl]: Dependency File[/etc/puppetlabs/puppet] has failures: true\r\nWarning: /File[/etc/puppetlabs/puppet/ssl]: Skipping because of failed dependencies\r\nNotice: /File[/etc/puppetlabs/puppet/ssl/certs]: Dependency File[/etc/puppetlabs/puppet] has failures: true\r\nWarning: /File[/etc/puppetlabs/puppet/ssl/certs]: Skipping because of failed dependencies\r\nNotice: /File[/etc/puppetlabs/puppet/ssl/public_keys]: Dependency File[/etc/puppetlabs/puppet] has failures: true\r\nWarning: /File[/etc/puppetlabs/puppet/ssl/public_keys]: Skipping because of failed dependencies\r\nNotice: /File[/etc/puppetlabs/puppet/ssl/certificate_requests]: Dependency File[/etc/puppetlabs/puppet] has failures: true\r\nWarning: /File[/etc/puppetlabs/puppet/ssl/certificate_requests]: Skipping because of failed dependencies\r\nNotice: /File[/etc/puppetlabs/puppet/ssl/private_keys]: Dependency File[/etc/puppetlabs/puppet] has failures: true\r\nWarning: /File[/etc/puppetlabs/puppet/ssl/private_keys]: Skipping because of failed dependencies\r\nNotice: /File[/etc/puppetlabs/puppet/ssl/private]: Dependency File[/etc/puppetlabs/puppet] has failures: true\r\nWarning: /File[/etc/puppetlabs/puppet/ssl/private]: Skipping because of failed dependencies\r\nNotice: /File[/opt/puppetlabs/puppet/cache/client_yaml]: Dependency File[/opt/puppetlabs/puppet/cache] has failures: true\r\nWarning: /File[/opt/puppetlabs/puppet/cache/client_yaml]: Skipping because of failed dependencies\r\nNotice: /File[/opt/puppetlabs/puppet/cache/client_data]: Dependency File[/opt/puppetlabs/puppet/cache] has failures: true\r\nWarning: /File[/opt/puppetlabs/puppet/cache/client_data]: Skipping because of failed dependencies\r\nNotice: /File[/opt/puppetlabs/puppet/cache/clientbucket]: Dependency File[/opt/puppetlabs/puppet/cache] has failures: true\r\nWarning: /File[/opt/puppetlabs/puppet/cache/clientbucket]: Skipping because of failed dependencies\r\nNotice: /File[/opt/puppetlabs/puppet/cache/state/graphs]: Dependency File[/opt/puppetlabs/puppet/cache] has failures: true\r\nWarning: /File[/opt/puppetlabs/puppet/cache/state/graphs]: Skipping because of failed dependencies\r\nNotice: /File[/opt/puppetlabs/puppet/cache/facts.d]: Dependency File[/opt/puppetlabs/puppet/cache] has failures: true\r\nWarning: /File[/opt/puppetlabs/puppet/cache/facts.d]: Skipping because of failed dependencies\r\nError: Got 4 failure(s) while initializing: File[/etc/puppetlabs/puppet]: change from absent to directory failed: Cannot create /etc/puppetlabs/puppet; parent directory /etc/puppetlabs does not exist; File[/etc/puppetlabs/code]: change from absent to directory failed: Cannot create /etc/puppetlabs/code; parent directory /etc/puppetlabs does not exist; File[/opt/puppetlabs/puppet/cache]: change from absent to directory failed: Cannot create /opt/puppetlabs/puppet/cache; parent directory /opt/puppetlabs/puppet does not exist; File[/var/log/puppetlabs/puppet]: change from absent to directory failed: Cannot create /var/log/puppetlabs/puppet; parent directory /var/log/puppetlabs does not exist\r\n{code}\r\n\r\nh3. QA\r\n----\r\nrisk: high \r\nprobability: medium (gem installs run as root)\r\nseverity: high (must run from different install)\r\ntest level: acceptance","closed_at":"2015-06-14T12:12:43.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4436","labels":"","state":"Closed","updated_at":"2015-06-14T12:12:43.000-0700","timestamp":1652284902.155481,"priority":"Normal","status_category":"Done","pull_request":3919},{"issue_id":"24979","title":"PR (2311) Undefined method `groups' for nil:NilClass","url":"https://tickets.puppetlabs.com/browse/PUP-1547","created_at":"2014-01-30T08:03:41.000-0800","number":"PUP-1547","body":"Lost quite some time in a rspec-puppet issue due to this error\r\nUltimately it was due to being on os x and setting {{operatingsystem}} fact to centos, making puppet unable to find providers for the user type.\r\n\r\n{code}\r\n     NoMethodError:\r\n       undefined method `groups' for nil:NilClass\r\n     # /Users/csanchez/.rvm/gems/ruby-1.9.3-p484/gems/puppet-3.4.2/lib/puppet/property/list.rb:57:in `retrieve'\r\n     # /Users/csanchez/.rvm/gems/ruby-1.9.3-p484/gems/puppet-3.4.2/lib/puppet/property/list.rb:46:in `should'\r\n     # /Users/csanchez/.rvm/gems/ruby-1.9.3-p484/gems/puppet-3.4.2/lib/puppet/type/user.rb:359:in `block (2 levels) in <module:Puppet>'\r\n{code}\r\n","closed_at":"2015-06-15T18:12:11.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1547","labels":"","state":"Closed","updated_at":"2015-06-15T18:12:11.000-0700","timestamp":1652284902.358964,"priority":"Normal","status_category":"Done","pull_request":2311},{"issue_id":"21551","title":"Node regex beginning with dash results in invalid tag","url":"https://tickets.puppetlabs.com/browse/PUP-1121","created_at":"2013-12-16T22:22:19.000-0800","number":"PUP-1121","body":"A node regex starting with a dash results in a tag that begins with a dash, which Puppet doesn't accept as valid:\r\n\r\n{noformat}\r\nnode /-(abc|def)-/ {\r\n{noformat}\r\n\r\nresults in the following error when it is matched:\r\n\r\n{noformat}\r\nInvalid tag \"-abcdef-\" on node host-abc-5678.example.com\r\n{noformat}\r\n\r\nRemoving the initial dash works as expected:\r\n\r\n{noformat}\r\nnode /(abc|def)-/ {\r\n{noformat}\r\n","closed_at":"2015-06-18T09:56:20.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1121","labels":"redmine","state":"Resolved","updated_at":"2015-06-18T09:56:20.000-0700","timestamp":1652284902.561469,"priority":"Normal","status_category":"Done","pull_request":8764},{"issue_id":"81974","title":"Make systemd the default service provider for Fedora 22","url":"https://tickets.puppetlabs.com/browse/PUP-4663","created_at":"2015-05-28T08:17:36.000-0700","number":"PUP-4663","body":"Fedora 22 has been released, and the Puppet systemd service provider needs an update to make it the default in that platform. The current code (https://github.com/puppetlabs/puppet/blob/3.x/lib/puppet/provider/service/systemd.rb#L10) only lists Fedora 17 to 21, so for Fedora 22 it goes with the default redhat provider, which has known issues (e.g. chkconfig --add).\r\n\r\nThis issue is present in both master and the 3.x branches.","closed_at":"2015-06-24T16:20:16.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4663","labels":"","state":"Closed","updated_at":"2015-06-24T16:20:16.000-0700","timestamp":1652284903.573084,"priority":"Normal","status_category":"Done","pull_request":3993},{"issue_id":"79179","title":"plugin face application does not use source permissions during fact sync","url":"https://tickets.puppetlabs.com/browse/PUP-4538","created_at":"2015-05-07T10:21:38.000-0700","number":"PUP-4538","body":"If you use the {{plugin}} face application to download plugins, then any executable external facts will not be executable and will run into the same problem described in PUP-4420.\r\n\r\n{noformat}\r\n$ bundle exec puppet plugin download --server ql1prr50yqgx40d.delivery.puppetlabs.net --http_debug\r\n...\r\n<- \"GET /puppet/v3/file_metadatas/pluginfacts?environment=production&links=follow&recurse=true&ignore=.svn&ignore=CVS&ignore=.git&checksum_type=md5 HTTP/1.1\\r\\nAccept: pson, yaml, binary\\r\\nX-Puppet-Version: 4.0.0\\r\\nAccept-Encoding: gzip;q=1.0,deflate;q=0.6,identity;q=0.3\\r\\nUser-Agent: Ruby\\r\\nConnection: close\\r\\nHost: ql1prr50yqgx40d.delivery.puppetlabs.net:8140\\r\\n\\r\\n\"\r\n-> \"HTTP/1.1 200 OK\\r\\n\"\r\n-> \"Date: Thu, 07 May 2015 17:18:56 GMT\\r\\n\"\r\n-> \"Content-Type: text/pson;charset=ISO-8859-1\\r\\n\"\r\n-> \"X-Puppet-Version: 4.0.0\\r\\n\"\r\n-> \"Connection: close\\r\\n\"\r\n-> \"Server: Jetty(9.1.z-SNAPSHOT)\\r\\n\"\r\n-> \"\\r\\n\"\r\nreading all...\r\n-> \"[{\\\"path\\\":\\\"/etc/puppetlabs/code/environments/production/modules/foo/facts.d\\\",\\\"relative_path\\\":\\\".\\\",\\\"links\\\":\\\"follow\\\",\\\"owner\\\":998,\\\"group\\\":997,\\\"mode\\\":420,\\\"checksum\\\":{\\\"type\\\":\\\"ctime\\\",\\\"value\\\":\\\"{ctime}2015-05-07 10:13:17 -0700\\\"},\\\"type\\\":\\\"directory\\\",\\\"destination\\\":null},{\\\"path\\\":\\\"/etc/puppetlabs/code/environments/production/modules/foo/facts.d\\\",\\\"relative_path\\\":\\\"foo.sh\\\",\\\"links\\\":\\\"follow\\\",\\\"owner\\\":998,\\\"group\\\":997,\\\"mode\\\":420,\\\"checksum\\\":{\\\"type\\\":\\\"md5\\\",\\\"value\\\":\\\"{md5}940339479f148a731c7b820dfba2223d\\\"},\\\"type\\\":\\\"file\\\",\\\"destination\\\":null}]\"\r\n{noformat}\r\n\r\nThe {{plugin}} face application should use {{/lib/puppet/configurer/downloader_factory.rb}} to create the downloader objects so that we have consistent behavior when using {{puppet agent}} and {{puppet plugin}} ","closed_at":"2015-06-24T16:20:17.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4538","labels":"","state":"Closed","updated_at":"2015-06-24T16:20:17.000-0700","timestamp":1652284903.673923,"priority":"Normal","status_category":"Done","pull_request":3945},{"issue_id":"78066","title":"systemd should be the default provider for Debian Jessie","url":"https://tickets.puppetlabs.com/browse/PUP-4503","created_at":"2015-04-30T09:25:26.000-0700","number":"PUP-4503","body":"There is, unfortunately, a bug in systemd on Debian Jessie where older sysvinit scripts can't detect the enabled status. Therefore you should not just enable that as the default.\r\n\r\nI wrote a version of a provider based on systemd that can check enabled via both systemd AND sysvinit and then the enable/disable in systemd does the right thing.\r\n\r\nhttps://gist.github.com/leepa/9818b46b29b161413824\r\n\r\nThis is a bug because Puppet 3.7.5 does not work correctly at all on Debian Jessie because of this.","closed_at":"2015-06-24T16:20:19.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4503","labels":"","state":"Closed","updated_at":"2015-06-24T16:20:19.000-0700","timestamp":1652284903.878943,"priority":"Normal","status_category":"Done","pull_request":3932},{"issue_id":"80935","title":"Cannot install packages without membership to any group with pacman provider ","url":"https://tickets.puppetlabs.com/browse/PUP-4635","created_at":"2015-05-20T06:46:45.000-0700","number":"PUP-4635","body":"$ puppet apply -e 'package { \"git\": ensure => present }'\r\nNotice: Compiled catalog for arch in environment production in 1.00 seconds\r\nError: /Stage[main]/Main/Package[git]: Could not evaluate: Error while getting installed groups\r\nNotice: Applied catalog in 0.81 seconds","closed_at":"2015-06-24T16:20:19.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4635","labels":"arch;community;package;pacman","state":"Closed","updated_at":"2015-06-24T16:20:19.000-0700","timestamp":1652284904.254564,"priority":"Major","status_category":"Done","pull_request":3989},{"issue_id":"82041","title":"acceptance test build_ignore_module_file fails if '/tmp/test' already exists","url":"https://tickets.puppetlabs.com/browse/PUP-4666","created_at":"2015-05-28T12:39:28.000-0700","number":"PUP-4666","body":"In the Puppet Server acceptance test pipeline, we've seen the \"build_ignore_module_file_test\" Puppet acceptance test fail if a directory named \"/tmp/test\" exists when the test is run.  The test expects to be able to create a directory with that name and so fails when it is pre-existing.  I'm not exactly sure what it is during the job execution which creates that directory.  I think it would be safer, though, if the test just created its own unique tmpdir on the master rather than relying upon a hard-coded one.","closed_at":"2015-06-24T16:20:21.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4666","labels":"","state":"Closed","updated_at":"2015-06-24T16:20:21.000-0700","timestamp":1652284904.458033,"priority":"Normal","status_category":"Done","pull_request":3970},{"issue_id":"81896","title":"EPP template can't explicitly access top scope variables if there's no node definition in the scope chain","url":"https://tickets.puppetlabs.com/browse/PUP-4662","created_at":"2015-05-27T16:32:55.000-0700","number":"PUP-4662","body":"If you try to explicitly access a top scope variable that is shadowed by a template parameter, Puppet will incorrectly use the parameter value instead unless there's a node scope present in the scope chain. \r\n\r\nManifest:\r\n\r\n{code}\r\n$testvar = \"from top scope\"\r\n\r\nnode 'magpie.lan' {\r\n  $testvar = \"from node scope\"\r\n}\r\n\r\ninclude epp_class\r\n\r\nclass epp_class {\r\n  $testvar = \"from the local scope\"\r\n\r\n  notify { \"mynotify\":\r\n    message => epp( 'epp_test/future_epp_scope_bug.epp', { testvar => \"from the params\" } ),\r\n  }\r\n}\r\n{code}\r\n\r\nTemplate:\r\n\r\n{code}\r\n<%- |$testvar| -%>\r\ntestvar is <%= $testvar %>.\r\nTop testvar is <%= $::testvar %>\r\nLocal testvar is <%= $epp_class::testvar %>.\r\n{code}\r\n\r\nResult: \r\n\r\n{code}\r\ntestvar is from the params.\r\nTop testvar is from the params\r\nLocal testvar is from the local scope.\r\n{code}\r\n\r\nIf you move that {{include epp_class}} into the node definition, it will instead say \"Top testvar is from top scope\". ","closed_at":"2015-06-24T16:20:24.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4662","labels":"","state":"Closed","updated_at":"2015-06-24T16:20:24.000-0700","timestamp":1652284904.769408,"priority":"Normal","status_category":"Done","pull_request":3982},{"issue_id":"83228","title":"Make fqdn_rand() Return A Numeric Instead of a String","url":"https://tickets.puppetlabs.com/browse/PUP-4698","created_at":"2015-06-04T14:25:57.000-0700","number":"PUP-4698","body":"While testing the following snippet of code with the puppet 4 parser it would fail unexpectedly on only a few nodes.  \r\n\r\n{code}\r\n$cron_minute = fqdn_rand( 60 ) \r\nif ($cron_minute >= '60') { \r\n  fail (\"Variable cron_minute in module connection_watcher is >= 60. Values must be < 60. The cron_minute value is $cron_minute.\") \r\n}\r\n{code}\r\n\r\nUpon further research, I figured the issue was because of the comparison of two strings not working the same was as two integers would.  \r\n\r\nSo, changing over to numeric for the comparison resolves the issue.  \r\n\r\n{code}\r\n$cron_minute = 0 + fqdn_rand( 60 ) #change a string to a numeric type\r\n  if ($cron_minute >= 60) {\r\n    fail (\"Variable cron_minute in module connection_watcher is >= 60. Values must be < 60. The cron_minute value is $cron_minute.\")\r\n  }\r\n{code}\r\n\r\nIt turns out the issue with the original code only shows up with the values '7', '8', and '9' because the comparison compares lexiographically and makes a decision on the first two values since '7', '8' and '9' are > '6' (the first character in '60').\r\n\r\nAt the end of the day it seems that fqdn_rand should just return a numeric as it will always be a number and is only a string for historical reasons.  \r\n","closed_at":"2015-06-24T16:20:24.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4698","labels":"tcse","state":"Closed","updated_at":"2015-06-24T16:20:24.000-0700","timestamp":1652284904.875296,"priority":"Normal","status_category":"Done","pull_request":4020},{"issue_id":"76609","title":"manifest changes are ignored when using hiera_include","url":"https://tickets.puppetlabs.com/browse/PUP-4461","created_at":"2015-04-21T00:51:59.000-0700","number":"PUP-4461","body":"I'm experimenting with puppetserver 2 / puppet-agent 1 and I'm running into an issue where changes to manifests don't get picked up by the server.\r\nWhen I'm making changes to a manifest after starting puppetserver it is working for the first 2 or 3 changes I make.\r\nAfter that new changes don't get picked up anymore until I restart puppetserver.\r\nI can reproduce that behavior. \r\n\r\nFor an example session see: https://gist.github.com/roman-mueller/cf776fd180a085a551c2\r\n\r\nI'm running:\r\nCentOS 7.0.1406 (but also reproduced it on CentOS 7.1.1503)\r\npuppetserver-2.0.0-1.el7.noarch\r\npuppet-agent-1.0.0-1.el7.x86_64\r\n\r\nI've set \"environment_timeout = 0\" in the \"production/environment.conf\" - which also should be the default.\r\nEverything else is kept on default settings too.\r\nI've committed my experimental Vagrant environment here:\r\nhttps://github.com/roman-mueller/puppet4-sandbox\r\nNote that this is using vboxsf but I get the same behavior with local files. \r\n\r\nWhen I'm running strace on the puppetserver PID I can see for the first 2 puppet agent runs that global/manifests/init.pp gets accessed.\r\nAfter that it is not getting read anymore.\r\nI've also waited 45 minutes, but still the change was not picked up.\r\nOnly a restart of the puppetserver fixes it at that point.\r\n\r\nWORK AROUND\r\n---\r\nThere is no simple work around, but there is a simple patch that can be applied.\r\n\r\nThe problem is on line 17 of lib/puppet/pops/loaders.rb which says:\r\n{code:ruby}\r\n@@puppet_system_loader ||= create_puppet_system_loader()\r\n{code}\r\nThis can be patched to read:\r\n{code:ruby}\r\n@@puppet_system_loader = create_puppet_system_loader()\r\n{code}\r\n\r\nh3. QA\r\n----\r\n\r\nrisk: medium (manual validate only for now)\r\nprobability: medium (hiera_include picking up manifest changes downstream only)\r\nseverity: medium (changes not picked up, confusing but possibly not blocking)\r\ntest level: acceptance (we should update existing acceptance to ensure an altered manifest is picked up)","closed_at":"2015-06-26T08:21:05.000-0700","comments":19,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4461","labels":"","state":"Closed","updated_at":"2015-06-26T08:21:05.000-0700","timestamp":1652284905.50025,"priority":"Critical","status_category":"Done","pull_request":3868},{"issue_id":"81407","title":"Problem of indentation with epp()","url":"https://tickets.puppetlabs.com/browse/PUP-4648","created_at":"2015-05-22T16:08:52.000-0700","number":"PUP-4648","body":"Hi,\r\n\r\nI have just tried the {{epp()}} function in a basic module with this code:\r\n\r\n{code:pp}\r\nclass test {\r\n  file { '/tmp/a':\r\n    ensure  => present,\r\n    content => epp('test/foo.epp', { 'a'=> '1234', 'b' => '5678',}),\r\n  }\r\n}\r\n{code}\r\n\r\nHere is my embedded puppet template {{foo.epp}}:\r\n\r\n{code}\r\n<%- |$a, $b| -%>\r\nblabla blabla\r\nblabla blabla\r\n  Should be indented\r\n  Should be indented <%= $a %>\r\n  Should be indented <%= $b %>\r\nblabla blabla\r\nblabla blabla\r\n{code}\r\n\r\nAfter a puppet run (directly on my puppet server), here is the content of the {{/tmp/a}} file:\r\n\r\n{code}\r\nblabla blabla\r\nblabla blabla\r\nShould be indented\r\nShould be indented 1234\r\n  Should be indented 5678\r\nblabla blabla\r\nblabla blabla\r\n{code}\r\n\r\nI have 2 lines which should be indented but this not the case.\r\n\r\nRq: if I remove the first line of the template (ie the declaration of the template's parameter), the indentation is correct.\r\n\r\nUPDATE\r\n---\r\nThis was caused by several factors; the specification was vague and the implementation was not correct. This led to the problem reported here (loosing expected indentation). In general the trimming operations removed too much whitespace (on lines it should not touch). The specification has been updated with clearer rules. Basically:\r\n* A right trim tags trims trailing whitepace at most up to and including a line break on the same line as the end (right trimming) tag\r\n* A left trim tag trims leading whitepsace at most up to, but not including a line break on the same line as the opening (left trimming) tag\r\n* A comment tag is always left trimming\r\n\r\nThe fix for this ticket (problem with indentation) makes the implementation compliant with the specification.","closed_at":"2015-07-08T12:10:33.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4648","labels":"","state":"Closed","updated_at":"2015-07-08T12:10:33.000-0700","timestamp":1652284913.873776,"priority":"Normal","status_category":"Done","pull_request":3986},{"issue_id":"66329","title":"Pluginsync errors when no source is available and modulepath directory is a symlink","url":"https://tickets.puppetlabs.com/browse/PUP-3935","created_at":"2015-01-31T20:21:08.000-0800","number":"PUP-3935","body":"h3. Context\r\n\r\nCurrently, Puppet produces one of two pluginsync errors during an agent run if the root of a modulepath directory is a symlink and no modules contain a facts.d or lib directory.\r\n\r\nIn the normal case, when the base module path is a directory and none if its modules include facts.d or lib directories, pluginsync returns the path to the module path directory itself, at which point the file type disables recursion in its `recurse_remote` method and stops the agent from attempting to download plugins.\r\n\r\nHowever, if the base module path is not a directory (in this case a link), `recurse_remote` returns early, causing the agent-side facts.d or lib directory to not have its 'source' metadata set, leading to a failing query back to the master.\r\n\r\nh3. Steps to reproduce\r\n\r\n1) Install any version of Puppet from 3.5.1 onward\r\n2) Edit {{puppet.conf}} to look like the following (where this is both the master and the agent):\r\n\r\n{noformat}\r\n[main]\r\n    logdir = /var/log/puppet\r\n    rundir = /var/run/puppet\r\n    ssldir = $vardir/ssl\r\n    server = miyxwpjl6z3zkmn.delivery.puppetlabs.net\r\n    basemodulepath = /usr/share/puppet/modules:/h/puppet_modules\r\n    environmentpath = $confdir/environments\r\n\r\n[agent]\r\n    classfile = $vardir/classes.txt\r\n    localconfig = $vardir/localconfig\r\n    pluginsync = true\r\n    environment = production\r\n{noformat}\r\n\r\n3) {{mkdir -p /h/puppet_modules}}\r\n4) {{mkdir -p /etc/puppet/environments/production}}\r\n5) {{ln -s /h/puppet_modules /etc/puppet/environments/production/modules}}\r\n6) {{puppet module install puppetlabs-stdlib}}\r\n7) Start the master with {{puppet master --verbose --no-daemonize}}\r\n8) Run the agent with {{puppet agent -t}}\r\n\r\nTo \"fix\" the error, simply run {{mkdir /h/puppet_modules/stdlib/facts.d}}.\r\n\r\nh3. Output\r\n{noformat}\r\n[root@foupsthuyg3ci5r ~]# puppet agent -t\r\nInfo: Retrieving pluginfacts\r\nError: /File[/var/lib/puppet/facts.d]: Could not evaluate: Could not retrieve information from environment production source(s) puppet://foupsthuyg3ci5r.delivery.puppetlabs.net/pluginfacts\r\nInfo: Retrieving plugin\r\nError: /File[/var/lib/puppet/lib]: Could not evaluate: Could not retrieve information from environment production source(s) puppet://foupsthuyg3ci5r.delivery.puppetlabs.net/plugins\r\nInfo: Caching catalog for foupsthuyg3ci5r.delivery.puppetlabs.net\r\nInfo: Applying configuration version '1422752263'\r\nNotice: Finished catalog run in 0.04 seconds\r\n{noformat}","closed_at":"2015-07-17T13:35:59.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3935","labels":"","state":"Closed","updated_at":"2015-07-17T13:35:59.000-0700","timestamp":1652284915.928587,"priority":"Normal","status_category":"Done","pull_request":3547},{"issue_id":"48451","title":"Debug logging messages can't be used by providers with a \"path\" method","url":"https://tickets.puppetlabs.com/browse/PUP-3088","created_at":"2014-08-19T12:59:15.000-0700","number":"PUP-3088","body":"The definition of the `debug` logging method contains some very bad assumptions. In particular, logging at the debug level will attempt to set a source line for the message (location in ruby file, puppet manifest, etc.). Unfortunately, the method which sets the source line [assumes|https://github.com/puppetlabs/puppet/blob/3.6.2/lib/puppet/util/log.rb#L317-L328] that if the object which emitted the log message responds to the {{path}} method, then it also responds to {{tags}}, {{file}} and {{line}}.\r\n\r\nThis assumption is disastrous when a class using debug logging defines a {{path}} method purely by coincidence. The original reproduction case for this is the Solaris Zone provider which has a {{path}} property and emits log messages at {{debug}} level:\r\n\r\n{code:title=test_zone.pp}\r\nzone { 'test_zone':\r\n  ensure => 'running',\r\n  path => '/zones/test_zone',\r\n  # This part is required, it adds un-modeled configuration to the zone\r\n  # which results in \"Ignoring zone output\" debug messages.\r\n  create_args => \"\\nadd net\\nset address=172.16.12.6\\nset physical=ixgbe0\\nend\",\r\n}\r\n{code}\r\n\r\n{noformat}\r\n# /opt/puppet/bin/puppet apply --debug --trace zone_test.pp \r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/concat_basedir.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/custom_auth_conf.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/facter_dot_d.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/ip6tables_version.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/iptables_persistent_version.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/iptables_version.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/pe_build.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/pe_postgres_default_version.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/pe_puppetdb_server_status.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/pe_version.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/platform_tag.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/postgres_default_version.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/puppet_vardir.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/root_home.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/staging_http_get.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/windows.rb\r\nNotice: Compiled catalog for pe-331-agent-solaris.puppetdebug.vlan in environment production in 0.07 seconds\r\nDebug: Creating default schedules\r\nDebug: Failed to load library 'selinux' for feature 'selinux'\r\nDebug: Using settings: adding file resource 'confdir': 'File[/etc/puppetlabs/puppet]{:path=>\"/etc/puppetlabs/puppet\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Failed to load library 'shadow' for feature 'libshadow'\r\nDebug: Puppet::Type::User::ProviderDirectoryservice: file /usr/bin/uuidgen does not exist\r\nDebug: Puppet::Type::User::ProviderUseradd: file chage does not exist\r\nDebug: Failed to load library 'ldap' for feature 'ldap'\r\nDebug: Puppet::Type::User::ProviderLdap: feature ldap is missing\r\nDebug: Puppet::Type::User::ProviderPw: file pw does not exist\r\nDebug: /User[pe-puppet]: Provider user_role_add does not support features libuser; not managing attribute forcelocal\r\nDebug: Puppet::Type::Group::ProviderDirectoryservice: file /usr/bin/dscl does not exist\r\nDebug: Failed to load library 'ldap' for feature 'ldap'\r\nDebug: Puppet::Type::Group::ProviderLdap: feature ldap is missing\r\nDebug: Puppet::Type::Group::ProviderPw: file pw does not exist\r\nDebug: /Group[pe-puppet]: Provider groupadd does not support features libuser; not managing attribute forcelocal\r\nDebug: Using settings: adding file resource 'vardir': 'File[/var/opt/lib/pe-puppet]{:path=>\"/var/opt/lib/pe-puppet\", :owner=>\"pe-puppet\", :group=>\"pe-puppet\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'logdir': 'File[/var/log/pe-puppet]{:path=>\"/var/log/pe-puppet\", :mode=>\"750\", :owner=>\"pe-puppet\", :group=>\"pe-puppet\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'statedir': 'File[/var/opt/lib/pe-puppet/state]{:path=>\"/var/opt/lib/pe-puppet/state\", :mode=>\"1755\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'rundir': 'File[/var/run/pe-puppet]{:path=>\"/var/run/pe-puppet\", :mode=>\"755\", :owner=>\"pe-puppet\", :group=>\"pe-puppet\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'libdir': 'File[/var/opt/lib/pe-puppet/lib]{:path=>\"/var/opt/lib/pe-puppet/lib\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'certdir': 'File[/etc/puppetlabs/puppet/ssl/certs]{:path=>\"/etc/puppetlabs/puppet/ssl/certs\", :mode=>\"755\", :owner=>\"pe-puppet\", :group=>\"pe-puppet\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'ssldir': 'File[/etc/puppetlabs/puppet/ssl]{:path=>\"/etc/puppetlabs/puppet/ssl\", :mode=>\"771\", :owner=>\"pe-puppet\", :group=>\"pe-puppet\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'publickeydir': 'File[/etc/puppetlabs/puppet/ssl/public_keys]{:path=>\"/etc/puppetlabs/puppet/ssl/public_keys\", :mode=>\"755\", :owner=>\"pe-puppet\", :group=>\"pe-puppet\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'requestdir': 'File[/etc/puppetlabs/puppet/ssl/certificate_requests]{:path=>\"/etc/puppetlabs/puppet/ssl/certificate_requests\", :mode=>\"755\", :owner=>\"pe-puppet\", :group=>\"pe-puppet\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'privatekeydir': 'File[/etc/puppetlabs/puppet/ssl/private_keys]{:path=>\"/etc/puppetlabs/puppet/ssl/private_keys\", :mode=>\"750\", :owner=>\"pe-puppet\", :group=>\"pe-puppet\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'privatedir': 'File[/etc/puppetlabs/puppet/ssl/private]{:path=>\"/etc/puppetlabs/puppet/ssl/private\", :mode=>\"750\", :owner=>\"pe-puppet\", :group=>\"pe-puppet\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'hostcert': 'File[/etc/puppetlabs/puppet/ssl/certs/pe-331-agent-solaris.puppetdebug.vlan.pem]{:path=>\"/etc/puppetlabs/puppet/ssl/certs/pe-331-agent-solaris.puppetdebug.vlan.pem\", :mode=>\"644\", :owner=>\"pe-puppet\", :group=>\"pe-puppet\", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'hostprivkey': 'File[/etc/puppetlabs/puppet/ssl/private_keys/pe-331-agent-solaris.puppetdebug.vlan.pem]{:path=>\"/etc/puppetlabs/puppet/ssl/private_keys/pe-331-agent-solaris.puppetdebug.vlan.pem\", :mode=>\"640\", :owner=>\"pe-puppet\", :group=>\"pe-puppet\", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'hostpubkey': 'File[/etc/puppetlabs/puppet/ssl/public_keys/pe-331-agent-solaris.puppetdebug.vlan.pem]{:path=>\"/etc/puppetlabs/puppet/ssl/public_keys/pe-331-agent-solaris.puppetdebug.vlan.pem\", :mode=>\"644\", :owner=>\"pe-puppet\", :group=>\"pe-puppet\", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'localcacert': 'File[/etc/puppetlabs/puppet/ssl/certs/ca.pem]{:path=>\"/etc/puppetlabs/puppet/ssl/certs/ca.pem\", :mode=>\"644\", :owner=>\"pe-puppet\", :group=>\"pe-puppet\", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'hostcrl': 'File[/etc/puppetlabs/puppet/ssl/crl.pem]{:path=>\"/etc/puppetlabs/puppet/ssl/crl.pem\", :mode=>\"644\", :owner=>\"pe-puppet\", :group=>\"pe-puppet\", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'statefile': 'File[/var/opt/lib/pe-puppet/state/state.yaml]{:path=>\"/var/opt/lib/pe-puppet/state/state.yaml\", :mode=>\"660\", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'clientyamldir': 'File[/var/opt/lib/pe-puppet/client_yaml]{:path=>\"/var/opt/lib/pe-puppet/client_yaml\", :mode=>\"750\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'client_datadir': 'File[/var/opt/lib/pe-puppet/client_data]{:path=>\"/var/opt/lib/pe-puppet/client_data\", :mode=>\"750\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'resourcefile': 'File[/var/opt/lib/pe-puppet/state/resources.txt]{:path=>\"/var/opt/lib/pe-puppet/state/resources.txt\", :mode=>\"640\", :owner=>\"root\", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'clientbucketdir': 'File[/var/opt/lib/pe-puppet/clientbucket]{:path=>\"/var/opt/lib/pe-puppet/clientbucket\", :mode=>\"750\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'lastrunfile': 'File[/var/opt/lib/pe-puppet/state/last_run_summary.yaml]{:path=>\"/var/opt/lib/pe-puppet/state/last_run_summary.yaml\", :mode=>\"644\", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'lastrunreport': 'File[/var/opt/lib/pe-puppet/state/last_run_report.yaml]{:path=>\"/var/opt/lib/pe-puppet/state/last_run_report.yaml\", :mode=>\"640\", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'graphdir': 'File[/var/opt/lib/pe-puppet/state/graphs]{:path=>\"/var/opt/lib/pe-puppet/state/graphs\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'pluginfactdest': 'File[/var/opt/lib/pe-puppet/facts.d]{:path=>\"/var/opt/lib/pe-puppet/facts.d\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: /File[/var/opt/lib/pe-puppet/state]: Autorequiring File[/var/opt/lib/pe-puppet]\r\nDebug: /File[/var/opt/lib/pe-puppet/lib]: Autorequiring File[/var/opt/lib/pe-puppet]\r\nDebug: /File[/etc/puppetlabs/puppet/ssl/certs]: Autorequiring File[/etc/puppetlabs/puppet/ssl]\r\nDebug: /File[/etc/puppetlabs/puppet/ssl]: Autorequiring File[/etc/puppetlabs/puppet]\r\nDebug: /File[/etc/puppetlabs/puppet/ssl/public_keys]: Autorequiring File[/etc/puppetlabs/puppet/ssl]\r\nDebug: /File[/etc/puppetlabs/puppet/ssl/certificate_requests]: Autorequiring File[/etc/puppetlabs/puppet/ssl]\r\nDebug: /File[/etc/puppetlabs/puppet/ssl/private_keys]: Autorequiring File[/etc/puppetlabs/puppet/ssl]\r\nDebug: /File[/etc/puppetlabs/puppet/ssl/private]: Autorequiring File[/etc/puppetlabs/puppet/ssl]\r\nDebug: /File[/etc/puppetlabs/puppet/ssl/certs/pe-331-agent-solaris.puppetdebug.vlan.pem]: Autorequiring File[/etc/puppetlabs/puppet/ssl/certs]\r\nDebug: /File[/etc/puppetlabs/puppet/ssl/private_keys/pe-331-agent-solaris.puppetdebug.vlan.pem]: Autorequiring File[/etc/puppetlabs/puppet/ssl/private_keys]\r\nDebug: /File[/etc/puppetlabs/puppet/ssl/public_keys/pe-331-agent-solaris.puppetdebug.vlan.pem]: Autorequiring File[/etc/puppetlabs/puppet/ssl/public_keys]\r\nDebug: /File[/etc/puppetlabs/puppet/ssl/certs/ca.pem]: Autorequiring File[/etc/puppetlabs/puppet/ssl/certs]\r\nDebug: /File[/etc/puppetlabs/puppet/ssl/crl.pem]: Autorequiring File[/etc/puppetlabs/puppet/ssl]\r\nDebug: /File[/var/opt/lib/pe-puppet/state/state.yaml]: Autorequiring File[/var/opt/lib/pe-puppet/state]\r\nDebug: /File[/var/opt/lib/pe-puppet/client_yaml]: Autorequiring File[/var/opt/lib/pe-puppet]\r\nDebug: /File[/var/opt/lib/pe-puppet/client_data]: Autorequiring File[/var/opt/lib/pe-puppet]\r\nDebug: /File[/var/opt/lib/pe-puppet/state/resources.txt]: Autorequiring File[/var/opt/lib/pe-puppet/state]\r\nDebug: /File[/var/opt/lib/pe-puppet/clientbucket]: Autorequiring File[/var/opt/lib/pe-puppet]\r\nDebug: /File[/var/opt/lib/pe-puppet/state/last_run_summary.yaml]: Autorequiring File[/var/opt/lib/pe-puppet/state]\r\nDebug: /File[/var/opt/lib/pe-puppet/state/last_run_report.yaml]: Autorequiring File[/var/opt/lib/pe-puppet/state]\r\nDebug: /File[/var/opt/lib/pe-puppet/state/graphs]: Autorequiring File[/var/opt/lib/pe-puppet/state]\r\nDebug: /File[/var/opt/lib/pe-puppet/facts.d]: Autorequiring File[/var/opt/lib/pe-puppet]\r\nDebug: Finishing transaction 75121300\r\nDebug: Loaded state in 0.05 seconds\r\nDebug: Loaded state in 0.05 seconds\r\nInfo: Applying configuration version '1408477665'\r\nDebug: Executing '/usr/sbin/zoneadm -z test_zone list -p'\r\nDebug: Executing '/usr/sbin/zonecfg -z test_zone info'\r\nError: /Stage[main]/Main/Zone[test_zone]: Could not evaluate: undefined method `tags' for Zone[test_zone](provider=solaris):Puppet::Type::Zone::ProviderSolaris\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/log.rb:322:in `source='\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/log.rb:253:in `initialize'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/log.rb:84:in `new'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/log.rb:84:in `create'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:98:in `block (2 levels) in logmethods'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/provider/zone/solaris.rb:240:in `block in getconfig'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/provider/zone/solaris.rb:221:in `each'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/provider/zone/solaris.rb:221:in `getconfig'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/provider/zone/solaris.rb:317:in `config_status'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/provider/zone/solaris.rb:290:in `status'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/provider/zone/solaris.rb:175:in `properties'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/type/zone.rb:360:in `retrieve'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/type.rb:1063:in `retrieve_resource'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/transaction/resource_harness.rb:223:in `from_resource'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/transaction/resource_harness.rb:19:in `evaluate'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/transaction.rb:174:in `apply'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/transaction.rb:187:in `eval_resource'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/transaction.rb:117:in `call'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/transaction.rb:117:in `block (2 levels) in evaluate'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:327:in `block in thinmark'\r\n/opt/puppet/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:326:in `thinmark'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/transaction.rb:117:in `block in evaluate'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/graph/relationship_graph.rb:118:in `traverse'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/transaction.rb:108:in `evaluate'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/resource/catalog.rb:167:in `block in apply'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/log.rb:149:in `with_destination'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/transaction/report.rb:112:in `as_logging_destination'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/resource/catalog.rb:166:in `apply'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/configurer.rb:117:in `block in apply_catalog'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:161:in `block in benchmark'\r\n/opt/puppet/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:160:in `benchmark'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/configurer.rb:116:in `apply_catalog'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/configurer.rb:191:in `run'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application/apply.rb:288:in `apply_catalog'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application/apply.rb:228:in `block in main'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/context.rb:64:in `override'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet.rb:234:in `override'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application/apply.rb:190:in `main'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application/apply.rb:151:in `run_command'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application.rb:371:in `block (2 levels) in run'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application.rb:477:in `plugin_hook'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application.rb:371:in `block in run'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:479:in `exit_on_fail'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application.rb:371:in `run'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/command_line.rb:137:in `run'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/command_line.rb:91:in `execute'\r\n/opt/puppet/bin/puppet:8:in `<main>'\r\nDebug: Finishing transaction 72323310\r\nDebug: Storing state\r\nDebug: Stored state in 0.09 seconds\r\nNotice: Finished catalog run in 0.40 seconds\r\nDebug: Using settings: adding file resource 'rrddir': 'File[/var/opt/lib/pe-puppet/rrd]{:path=>\"/var/opt/lib/pe-puppet/rrd\", :mode=>\"750\", :owner=>\"pe-puppet\", :group=>\"pe-puppet\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Finishing transaction 72173660\r\nDebug: Received report to process from pe-331-agent-solaris.puppetdebug.vlan\r\nDebug: Processing report from pe-331-agent-solaris.puppetdebug.vlan with processor Puppet::Reports::Store\r\n{noformat}\r\n\r\nThis behavior can be re-produced much easier on other platforms by adding a debug statement to the `File` provider and enabling a {{path}} getter by adding mk_resource_methods to the provider definition:\r\n\r\n{code:title=debug_file.patch}\r\ndiff --git a/lib/puppet/provider/file/posix.rb b/lib/puppet/provider/file/posix.rb\r\nindex 0ce7d22..dfaace8 100644\r\n--- a/lib/puppet/provider/file/posix.rb\r\n+++ b/lib/puppet/provider/file/posix.rb\r\n@@ -52,7 +52,12 @@ Puppet::Type.type(:file).provide :posix do\r\n     Integer(value) rescue gid(value) || false\r\n   end\r\n \r\n+  # DEBUG: Creates a `path` method for accessing the `path` property.\r\n+  mk_resource_methods\r\n+\r\n   def owner\r\n+    debug 'Fetching file owner.'\r\n+\r\n     unless stat = resource.stat\r\n       return :absent\r\n     end\r\n{code}\r\n\r\n{noformat}\r\n# puppet apply --debug --trace -e 'file{\"/tmp/tst\": ensure => file, owner => root}'\r\nInfo: Loading facts in /etc/puppet/modules/stdlib/lib/facter/pe_version.rb\r\nInfo: Loading facts in /etc/puppet/modules/stdlib/lib/facter/facter_dot_d.rb\r\nInfo: Loading facts in /etc/puppet/modules/stdlib/lib/facter/puppet_vardir.rb\r\nInfo: Loading facts in /etc/puppet/modules/stdlib/lib/facter/root_home.rb\r\nInfo: Loading facts in /etc/puppet/modules/concat/lib/facter/concat_basedir.rb\r\nDebug: Failed to load library 'selinux' for feature 'selinux'\r\nNotice: Compiled catalog for poss-head-centos.puppetdebug.vlan in environment production in 0.48 seconds\r\nDebug: Creating default schedules\r\nDebug: Using settings: adding file resource 'confdir': 'File[/etc/puppet]{:path=>\"/etc/puppet\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Failed to load library 'shadow' for feature 'libshadow'\r\nDebug: Puppet::Type::User::ProviderDirectoryservice: file /usr/bin/dsimport does not exist\r\nDebug: Failed to load library 'ldap' for feature 'ldap'\r\nDebug: Puppet::Type::User::ProviderLdap: feature ldap is missing\r\nDebug: Puppet::Type::User::ProviderPw: file pw does not exist\r\nDebug: Puppet::Type::User::ProviderUser_role_add: file roleadd does not exist\r\nDebug: Puppet::Type::Group::ProviderDirectoryservice: file /usr/bin/dscl does not exist\r\nDebug: Failed to load library 'ldap' for feature 'ldap'\r\nDebug: Puppet::Type::Group::ProviderLdap: feature ldap is missing\r\nDebug: Puppet::Type::Group::ProviderPw: file pw does not exist\r\nDebug: Using settings: adding file resource 'vardir': 'File[/var/lib/puppet]{:path=>\"/var/lib/puppet\", :owner=>\"puppet\", :group=>\"puppet\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'logdir': 'File[/var/lib/puppet/log]{:path=>\"/var/lib/puppet/log\", :mode=>\"750\", :owner=>\"puppet\", :group=>\"puppet\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'statedir': 'File[/var/lib/puppet/state]{:path=>\"/var/lib/puppet/state\", :mode=>\"1755\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'rundir': 'File[/var/lib/puppet/run]{:path=>\"/var/lib/puppet/run\", :mode=>\"755\", :owner=>\"puppet\", :group=>\"puppet\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'libdir': 'File[/var/lib/puppet/lib]{:path=>\"/var/lib/puppet/lib\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'certdir': 'File[/etc/puppet/ssl/certs]{:path=>\"/etc/puppet/ssl/certs\", :mode=>\"755\", :owner=>\"puppet\", :group=>\"puppet\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'ssldir': 'File[/etc/puppet/ssl]{:path=>\"/etc/puppet/ssl\", :mode=>\"771\", :owner=>\"puppet\", :group=>\"puppet\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'publickeydir': 'File[/etc/puppet/ssl/public_keys]{:path=>\"/etc/puppet/ssl/public_keys\", :mode=>\"755\", :owner=>\"puppet\", :group=>\"puppet\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'requestdir': 'File[/etc/puppet/ssl/certificate_requests]{:path=>\"/etc/puppet/ssl/certificate_requests\", :mode=>\"755\", :owner=>\"puppet\", :group=>\"puppet\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'privatekeydir': 'File[/etc/puppet/ssl/private_keys]{:path=>\"/etc/puppet/ssl/private_keys\", :mode=>\"750\", :owner=>\"puppet\", :group=>\"puppet\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'privatedir': 'File[/etc/puppet/ssl/private]{:path=>\"/etc/puppet/ssl/private\", :mode=>\"750\", :owner=>\"puppet\", :group=>\"puppet\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'hostcert': 'File[/etc/puppet/ssl/certs/poss-head-centos.puppetdebug.vlan.pem]{:path=>\"/etc/puppet/ssl/certs/poss-head-centos.puppetdebug.vlan.pem\", :mode=>\"644\", :owner=>\"puppet\", :group=>\"puppet\", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'hostprivkey': 'File[/etc/puppet/ssl/private_keys/poss-head-centos.puppetdebug.vlan.pem]{:path=>\"/etc/puppet/ssl/private_keys/poss-head-centos.puppetdebug.vlan.pem\", :mode=>\"640\", :owner=>\"puppet\", :group=>\"puppet\", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'hostpubkey': 'File[/etc/puppet/ssl/public_keys/poss-head-centos.puppetdebug.vlan.pem]{:path=>\"/etc/puppet/ssl/public_keys/poss-head-centos.puppetdebug.vlan.pem\", :mode=>\"644\", :owner=>\"puppet\", :group=>\"puppet\", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'localcacert': 'File[/etc/puppet/ssl/certs/ca.pem]{:path=>\"/etc/puppet/ssl/certs/ca.pem\", :mode=>\"644\", :owner=>\"puppet\", :group=>\"puppet\", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'hostcrl': 'File[/etc/puppet/ssl/crl.pem]{:path=>\"/etc/puppet/ssl/crl.pem\", :mode=>\"644\", :owner=>\"puppet\", :group=>\"puppet\", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'statefile': 'File[/var/lib/puppet/state/state.yaml]{:path=>\"/var/lib/puppet/state/state.yaml\", :mode=>\"660\", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'clientyamldir': 'File[/var/lib/puppet/client_yaml]{:path=>\"/var/lib/puppet/client_yaml\", :mode=>\"750\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'client_datadir': 'File[/var/lib/puppet/client_data]{:path=>\"/var/lib/puppet/client_data\", :mode=>\"750\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'clientbucketdir': 'File[/var/lib/puppet/clientbucket]{:path=>\"/var/lib/puppet/clientbucket\", :mode=>\"750\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'lastrunfile': 'File[/var/lib/puppet/state/last_run_summary.yaml]{:path=>\"/var/lib/puppet/state/last_run_summary.yaml\", :mode=>\"644\", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'lastrunreport': 'File[/var/lib/puppet/state/last_run_report.yaml]{:path=>\"/var/lib/puppet/state/last_run_report.yaml\", :mode=>\"640\", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'graphdir': 'File[/var/lib/puppet/state/graphs]{:path=>\"/var/lib/puppet/state/graphs\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Using settings: adding file resource 'pluginfactdest': 'File[/var/lib/puppet/facts.d]{:path=>\"/var/lib/puppet/facts.d\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: /File[/var/lib/puppet/log]: Autorequiring File[/var/lib/puppet]\r\nDebug: /File[/var/lib/puppet/state]: Autorequiring File[/var/lib/puppet]\r\nDebug: /File[/var/lib/puppet/run]: Autorequiring File[/var/lib/puppet]\r\nDebug: /File[/var/lib/puppet/lib]: Autorequiring File[/var/lib/puppet]\r\nDebug: /File[/etc/puppet/ssl/certs]: Autorequiring File[/etc/puppet/ssl]\r\nDebug: /File[/etc/puppet/ssl]: Autorequiring File[/etc/puppet]\r\nDebug: /File[/etc/puppet/ssl/public_keys]: Autorequiring File[/etc/puppet/ssl]\r\nDebug: /File[/etc/puppet/ssl/certificate_requests]: Autorequiring File[/etc/puppet/ssl]\r\nDebug: /File[/etc/puppet/ssl/private_keys]: Autorequiring File[/etc/puppet/ssl]\r\nDebug: /File[/etc/puppet/ssl/private]: Autorequiring File[/etc/puppet/ssl]\r\nDebug: /File[/etc/puppet/ssl/certs/poss-head-centos.puppetdebug.vlan.pem]: Autorequiring File[/etc/puppet/ssl/certs]\r\nDebug: /File[/etc/puppet/ssl/private_keys/poss-head-centos.puppetdebug.vlan.pem]: Autorequiring File[/etc/puppet/ssl/private_keys]\r\nDebug: /File[/etc/puppet/ssl/public_keys/poss-head-centos.puppetdebug.vlan.pem]: Autorequiring File[/etc/puppet/ssl/public_keys]\r\nDebug: /File[/etc/puppet/ssl/certs/ca.pem]: Autorequiring File[/etc/puppet/ssl/certs]\r\nDebug: /File[/etc/puppet/ssl/crl.pem]: Autorequiring File[/etc/puppet/ssl]\r\nDebug: /File[/var/lib/puppet/state/state.yaml]: Autorequiring File[/var/lib/puppet/state]\r\nDebug: /File[/var/lib/puppet/client_yaml]: Autorequiring File[/var/lib/puppet]\r\nDebug: /File[/var/lib/puppet/client_data]: Autorequiring File[/var/lib/puppet]\r\nDebug: /File[/var/lib/puppet/clientbucket]: Autorequiring File[/var/lib/puppet]\r\nDebug: /File[/var/lib/puppet/state/last_run_summary.yaml]: Autorequiring File[/var/lib/puppet/state]\r\nDebug: /File[/var/lib/puppet/state/last_run_report.yaml]: Autorequiring File[/var/lib/puppet/state]\r\nDebug: /File[/var/lib/puppet/state/graphs]: Autorequiring File[/var/lib/puppet/state]\r\nDebug: /File[/var/lib/puppet/facts.d]: Autorequiring File[/var/lib/puppet]\r\nError: /File[/etc/puppet/ssl]: Could not evaluate: undefined method `tags' for File[/etc/puppet/ssl](provider=posix):Puppet::Type::File::ProviderPosix\r\n/puppetlabs/puppet/lib/puppet/util/log.rb:322:in `source='\r\n/puppetlabs/puppet/lib/puppet/util/log.rb:253:in `initialize'\r\n/puppetlabs/puppet/lib/puppet/util/log.rb:84:in `new'\r\n/puppetlabs/puppet/lib/puppet/util/log.rb:84:in `create'\r\n/puppetlabs/puppet/lib/puppet/util.rb:98:in `block (2 levels) in logmethods'\r\n/puppetlabs/puppet/lib/puppet/provider/file/posix.rb:57:in `owner'\r\n/puppetlabs/puppet/lib/puppet/property.rb:471:in `retrieve'\r\n/puppetlabs/puppet/lib/puppet/type.rb:1045:in `block in retrieve'\r\n/puppetlabs/puppet/lib/puppet/type.rb:1040:in `each'\r\n/puppetlabs/puppet/lib/puppet/type.rb:1040:in `retrieve'\r\n/puppetlabs/puppet/lib/puppet/type/file.rb:673:in `retrieve'\r\n/puppetlabs/puppet/lib/puppet/type.rb:1063:in `retrieve_resource'\r\n/puppetlabs/puppet/lib/puppet/transaction/resource_harness.rb:223:in `from_resource'\r\n/puppetlabs/puppet/lib/puppet/transaction/resource_harness.rb:19:in `evaluate'\r\n/puppetlabs/puppet/lib/puppet/transaction.rb:174:in `apply'\r\n/puppetlabs/puppet/lib/puppet/transaction.rb:187:in `eval_resource'\r\n/puppetlabs/puppet/lib/puppet/transaction.rb:117:in `call'\r\n/puppetlabs/puppet/lib/puppet/transaction.rb:117:in `block (2 levels) in evaluate'\r\n/puppetlabs/puppet/lib/puppet/util.rb:327:in `block in thinmark'\r\n/opt/rh/ruby193/root/usr/share/ruby/benchmark.rb:295:in `realtime'\r\n/puppetlabs/puppet/lib/puppet/util.rb:326:in `thinmark'\r\n/puppetlabs/puppet/lib/puppet/transaction.rb:117:in `block in evaluate'\r\n/puppetlabs/puppet/lib/puppet/graph/relationship_graph.rb:118:in `traverse'\r\n/puppetlabs/puppet/lib/puppet/transaction.rb:108:in `evaluate'\r\n/puppetlabs/puppet/lib/puppet/resource/catalog.rb:167:in `block in apply'\r\n/puppetlabs/puppet/lib/puppet/util/log.rb:153:in `with_destination'\r\n/puppetlabs/puppet/lib/puppet/transaction/report.rb:112:in `as_logging_destination'\r\n/puppetlabs/puppet/lib/puppet/resource/catalog.rb:166:in `apply'\r\n/puppetlabs/puppet/lib/puppet/settings.rb:957:in `use'\r\n/puppetlabs/puppet/lib/puppet/configurer.rb:48:in `initialize'\r\n/puppetlabs/puppet/lib/puppet/application/apply.rb:287:in `new'\r\n/puppetlabs/puppet/lib/puppet/application/apply.rb:287:in `apply_catalog'\r\n/puppetlabs/puppet/lib/puppet/application/apply.rb:228:in `block in main'\r\n/puppetlabs/puppet/lib/puppet/context.rb:64:in `override'\r\n/puppetlabs/puppet/lib/puppet.rb:234:in `override'\r\n/puppetlabs/puppet/lib/puppet/application/apply.rb:190:in `main'\r\n/puppetlabs/puppet/lib/puppet/application/apply.rb:151:in `run_command'\r\n/puppetlabs/puppet/lib/puppet/application.rb:371:in `block (2 levels) in run'\r\n/puppetlabs/puppet/lib/puppet/application.rb:477:in `plugin_hook'\r\n/puppetlabs/puppet/lib/puppet/application.rb:371:in `block in run'\r\n/puppetlabs/puppet/lib/puppet/util.rb:479:in `exit_on_fail'\r\n/puppetlabs/puppet/lib/puppet/application.rb:371:in `run'\r\n/puppetlabs/puppet/lib/puppet/util/command_line.rb:137:in `run'\r\n/puppetlabs/puppet/lib/puppet/util/command_line.rb:91:in `execute'\r\n/puppetlabs/puppet/bin/puppet:8:in `<main>'\r\nNotice: /File[/etc/puppet/ssl/private_keys]: Dependency File[/etc/puppet/ssl] has failures: true\r\nWarning: /File[/etc/puppet/ssl/private_keys]: Skipping because of failed dependencies\r\nNotice: /File[/etc/puppet/ssl/private_keys/poss-head-centos.puppetdebug.vlan.pem]: Dependency File[/etc/puppet/ssl] has failures: true\r\nWarning: /File[/etc/puppet/ssl/private_keys/poss-head-centos.puppetdebug.vlan.pem]: Skipping because of failed dependencies\r\nError: /File[/var/lib/puppet]: Could not evaluate: undefined method `tags' for File[/var/lib/puppet](provider=posix):Puppet::Type::File::ProviderPosix\r\n/puppetlabs/puppet/lib/puppet/util/log.rb:322:in `source='\r\n/puppetlabs/puppet/lib/puppet/util/log.rb:253:in `initialize'\r\n/puppetlabs/puppet/lib/puppet/util/log.rb:84:in `new'\r\n/puppetlabs/puppet/lib/puppet/util/log.rb:84:in `create'\r\n/puppetlabs/puppet/lib/puppet/util.rb:98:in `block (2 levels) in logmethods'\r\n/puppetlabs/puppet/lib/puppet/provider/file/posix.rb:57:in `owner'\r\n/puppetlabs/puppet/lib/puppet/property.rb:471:in `retrieve'\r\n/puppetlabs/puppet/lib/puppet/type.rb:1045:in `block in retrieve'\r\n/puppetlabs/puppet/lib/puppet/type.rb:1040:in `each'\r\n/puppetlabs/puppet/lib/puppet/type.rb:1040:in `retrieve'\r\n/puppetlabs/puppet/lib/puppet/type/file.rb:673:in `retrieve'\r\n/puppetlabs/puppet/lib/puppet/type.rb:1063:in `retrieve_resource'\r\n/puppetlabs/puppet/lib/puppet/transaction/resource_harness.rb:223:in `from_resource'\r\n/puppetlabs/puppet/lib/puppet/transaction/resource_harness.rb:19:in `evaluate'\r\n/puppetlabs/puppet/lib/puppet/transaction.rb:174:in `apply'\r\n/puppetlabs/puppet/lib/puppet/transaction.rb:187:in `eval_resource'\r\n/puppetlabs/puppet/lib/puppet/transaction.rb:117:in `call'\r\n/puppetlabs/puppet/lib/puppet/transaction.rb:117:in `block (2 levels) in evaluate'\r\n/puppetlabs/puppet/lib/puppet/util.rb:327:in `block in thinmark'\r\n/opt/rh/ruby193/root/usr/share/ruby/benchmark.rb:295:in `realtime'\r\n/puppetlabs/puppet/lib/puppet/util.rb:326:in `thinmark'\r\n/puppetlabs/puppet/lib/puppet/transaction.rb:117:in `block in evaluate'\r\n/puppetlabs/puppet/lib/puppet/graph/relationship_graph.rb:118:in `traverse'\r\n/puppetlabs/puppet/lib/puppet/transaction.rb:108:in `evaluate'\r\n/puppetlabs/puppet/lib/puppet/resource/catalog.rb:167:in `block in apply'\r\n/puppetlabs/puppet/lib/puppet/util/log.rb:153:in `with_destination'\r\n/puppetlabs/puppet/lib/puppet/transaction/report.rb:112:in `as_logging_destination'\r\n/puppetlabs/puppet/lib/puppet/resource/catalog.rb:166:in `apply'\r\n/puppetlabs/puppet/lib/puppet/settings.rb:957:in `use'\r\n/puppetlabs/puppet/lib/puppet/configurer.rb:48:in `initialize'\r\n/puppetlabs/puppet/lib/puppet/application/apply.rb:287:in `new'\r\n/puppetlabs/puppet/lib/puppet/application/apply.rb:287:in `apply_catalog'\r\n/puppetlabs/puppet/lib/puppet/application/apply.rb:228:in `block in main'\r\n/puppetlabs/puppet/lib/puppet/context.rb:64:in `override'\r\n/puppetlabs/puppet/lib/puppet.rb:234:in `override'\r\n/puppetlabs/puppet/lib/puppet/application/apply.rb:190:in `main'\r\n/puppetlabs/puppet/lib/puppet/application/apply.rb:151:in `run_command'\r\n/puppetlabs/puppet/lib/puppet/application.rb:371:in `block (2 levels) in run'\r\n/puppetlabs/puppet/lib/puppet/application.rb:477:in `plugin_hook'\r\n/puppetlabs/puppet/lib/puppet/application.rb:371:in `block in run'\r\n/puppetlabs/puppet/lib/puppet/util.rb:479:in `exit_on_fail'\r\n/puppetlabs/puppet/lib/puppet/application.rb:371:in `run'\r\n/puppetlabs/puppet/lib/puppet/util/command_line.rb:137:in `run'\r\n/puppetlabs/puppet/lib/puppet/util/command_line.rb:91:in `execute'\r\n/puppetlabs/puppet/bin/puppet:8:in `<main>'\r\nNotice: /File[/var/lib/puppet/facts.d]: Dependency File[/var/lib/puppet] has failures: true\r\nWarning: /File[/var/lib/puppet/facts.d]: Skipping because of failed dependencies\r\nNotice: /File[/etc/puppet/ssl/crl.pem]: Dependency File[/etc/puppet/ssl] has failures: true\r\nWarning: /File[/etc/puppet/ssl/crl.pem]: Skipping because of failed dependencies\r\nNotice: /File[/var/lib/puppet/client_data]: Dependency File[/var/lib/puppet] has failures: true\r\nWarning: /File[/var/lib/puppet/client_data]: Skipping because of failed dependencies\r\nNotice: /File[/var/lib/puppet/run]: Dependency File[/var/lib/puppet] has failures: true\r\nWarning: /File[/var/lib/puppet/run]: Skipping because of failed dependencies\r\nNotice: /File[/var/lib/puppet/state]: Dependency File[/var/lib/puppet] has failures: true\r\nWarning: /File[/var/lib/puppet/state]: Skipping because of failed dependencies\r\nNotice: /File[/var/lib/puppet/state/last_run_report.yaml]: Dependency File[/var/lib/puppet] has failures: true\r\nWarning: /File[/var/lib/puppet/state/last_run_report.yaml]: Skipping because of failed dependencies\r\nNotice: /File[/var/lib/puppet/state/graphs]: Dependency File[/var/lib/puppet] has failures: true\r\nWarning: /File[/var/lib/puppet/state/graphs]: Skipping because of failed dependencies\r\nNotice: /File[/var/lib/puppet/client_yaml]: Dependency File[/var/lib/puppet] has failures: true\r\nWarning: /File[/var/lib/puppet/client_yaml]: Skipping because of failed dependencies\r\nNotice: /File[/var/lib/puppet/lib]: Dependency File[/var/lib/puppet] has failures: true\r\nWarning: /File[/var/lib/puppet/lib]: Skipping because of failed dependencies\r\nNotice: /File[/var/lib/puppet/clientbucket]: Dependency File[/var/lib/puppet] has failures: true\r\nWarning: /File[/var/lib/puppet/clientbucket]: Skipping because of failed dependencies\r\nNotice: /File[/etc/puppet/ssl/public_keys]: Dependency File[/etc/puppet/ssl] has failures: true\r\nWarning: /File[/etc/puppet/ssl/public_keys]: Skipping because of failed dependencies\r\nNotice: /File[/etc/puppet/ssl/public_keys/poss-head-centos.puppetdebug.vlan.pem]: Dependency File[/etc/puppet/ssl] has failures: true\r\nWarning: /File[/etc/puppet/ssl/public_keys/poss-head-centos.puppetdebug.vlan.pem]: Skipping because of failed dependencies\r\nNotice: /File[/var/lib/puppet/state/state.yaml]: Dependency File[/var/lib/puppet] has failures: true\r\nWarning: /File[/var/lib/puppet/state/state.yaml]: Skipping because of failed dependencies\r\nNotice: /File[/etc/puppet/ssl/certs]: Dependency File[/etc/puppet/ssl] has failures: true\r\nWarning: /File[/etc/puppet/ssl/certs]: Skipping because of failed dependencies\r\nNotice: /File[/etc/puppet/ssl/certs/ca.pem]: Dependency File[/etc/puppet/ssl] has failures: true\r\nWarning: /File[/etc/puppet/ssl/certs/ca.pem]: Skipping because of failed dependencies\r\nNotice: /File[/etc/puppet/ssl/certs/poss-head-centos.puppetdebug.vlan.pem]: Dependency File[/etc/puppet/ssl] has failures: true\r\nWarning: /File[/etc/puppet/ssl/certs/poss-head-centos.puppetdebug.vlan.pem]: Skipping because of failed dependencies\r\nNotice: /File[/var/lib/puppet/log]: Dependency File[/var/lib/puppet] has failures: true\r\nWarning: /File[/var/lib/puppet/log]: Skipping because of failed dependencies\r\nNotice: /File[/etc/puppet/ssl/private]: Dependency File[/etc/puppet/ssl] has failures: true\r\nWarning: /File[/etc/puppet/ssl/private]: Skipping because of failed dependencies\r\nNotice: /File[/etc/puppet/ssl/certificate_requests]: Dependency File[/etc/puppet/ssl] has failures: true\r\nWarning: /File[/etc/puppet/ssl/certificate_requests]: Skipping because of failed dependencies\r\nNotice: /File[/var/lib/puppet/state/last_run_summary.yaml]: Dependency File[/var/lib/puppet] has failures: true\r\nWarning: /File[/var/lib/puppet/state/last_run_summary.yaml]: Skipping because of failed dependencies\r\nDebug: Finishing transaction 16863400\r\nError: Got 2 failure(s) while initializing: File[/etc/puppet/ssl]: undefined method `tags' for File[/etc/puppet/ssl](provider=posix):Puppet::Type::File::ProviderPosix; File[/var/lib/puppet]: undefined method `tags' for File[/var/lib/puppet](provider=posix):Puppet::Type::File::ProviderPosix\r\n/puppetlabs/puppet/lib/puppet/settings.rb:967:in `block in use'\r\n/puppetlabs/puppet/lib/puppet/resource/catalog.rb:179:in `apply'\r\n/puppetlabs/puppet/lib/puppet/settings.rb:957:in `use'\r\n/puppetlabs/puppet/lib/puppet/configurer.rb:48:in `initialize'\r\n/puppetlabs/puppet/lib/puppet/application/apply.rb:287:in `new'\r\n/puppetlabs/puppet/lib/puppet/application/apply.rb:287:in `apply_catalog'\r\n/puppetlabs/puppet/lib/puppet/application/apply.rb:228:in `block in main'\r\n/puppetlabs/puppet/lib/puppet/context.rb:64:in `override'\r\n/puppetlabs/puppet/lib/puppet.rb:234:in `override'\r\n/puppetlabs/puppet/lib/puppet/application/apply.rb:190:in `main'\r\n/puppetlabs/puppet/lib/puppet/application/apply.rb:151:in `run_command'\r\n/puppetlabs/puppet/lib/puppet/application.rb:371:in `block (2 levels) in run'\r\n/puppetlabs/puppet/lib/puppet/application.rb:477:in `plugin_hook'\r\n/puppetlabs/puppet/lib/puppet/application.rb:371:in `block in run'\r\n/puppetlabs/puppet/lib/puppet/util.rb:479:in `exit_on_fail'\r\n/puppetlabs/puppet/lib/puppet/application.rb:371:in `run'\r\n/puppetlabs/puppet/lib/puppet/util/command_line.rb:137:in `run'\r\n/puppetlabs/puppet/lib/puppet/util/command_line.rb:91:in `execute'\r\n/puppetlabs/puppet/bin/puppet:8:in `<main>'\r\n{noformat}","closed_at":"2015-07-20T09:05:16.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3088","labels":"logging","state":"Closed","updated_at":"2015-07-20T09:05:16.000-0700","timestamp":1652284916.1369,"priority":"Normal","status_category":"Done","pull_request":4000},{"issue_id":"85515","title":"Solaris Zones provider debug and error messages are less informative in Puppet 4","url":"https://tickets.puppetlabs.com/browse/PUP-4770","created_at":"2015-06-19T11:47:06.000-0700","number":"PUP-4770","body":"https://github.com/puppetlabs/puppet/pull/3244 changed the Solaris Zone provider's debug and error messages to use the global utilities, which means they're not prefixed with the provider context. This was done to circumvent PUP-3088; now that PUP-3088 is fixed, we should revert the change to the zone provider.","closed_at":"2015-07-22T14:18:59.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4770","labels":"","state":"Closed","updated_at":"2015-07-22T14:18:59.000-0700","timestamp":1652284917.775322,"priority":"Normal","status_category":"Done","pull_request":4053},{"issue_id":"86251","title":"Acceptance failing on check_woy_cache_works.rb on all platforms (master and stable)","url":"https://tickets.puppetlabs.com/browse/PUP-4787","created_at":"2015-06-25T08:30:57.000-0700","number":"PUP-4787","body":"The test {noformat}check_woy_cache_works.rb{noformat} is failing in CI on both master and stable.\r\n\r\nOutput:\r\n\r\n{noformat}\r\nTest Case tests/node/check_woy_cache_works.rb reported: #<RuntimeError: PuppetAcceptance::DSL::Helpers.with_puppet_running_on failed (check backtrace for location) because: Host 'qqhxd1481q6vur4.delivery.puppetlabs.net' exited with 1 running:\r\n puppet node search \"*\" --node_terminus yaml --clientyamldir /tmp/check_woy_cache_works.37UB1g/yamldir --render-as json\r\nLast 10 lines of output were:\r\n\tError: undefined method `empty?' for nil:NilClass\r\n\tError: Try 'puppet help node search' for usage\r\n{noformat}\r\n\r\nThe test started failing after the merging of https://tickets.puppetlabs.com/browse/PUP-4775.","closed_at":"2015-07-22T14:19:00.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4787","labels":"","state":"Closed","updated_at":"2015-07-22T14:19:00.000-0700","timestamp":1652284917.983219,"priority":"Normal","status_category":"Done","pull_request":4057},{"issue_id":"84945","title":"RSpec 3.3 produces many warning messages during Puppet spec runs","url":"https://tickets.puppetlabs.com/browse/PUP-4758","created_at":"2015-06-16T17:24:47.000-0700","number":"PUP-4758","body":"RSpec 3.3 now logs a (useful and correct) warning message whenever an example uses `raise_error` without any arguments; doing so can potentially mask bugs (it's the same as rescuing all errors and going \"okie dokie\").\r\n\r\n{quote}\r\nWARNING: Using the `raise_error` matcher without providing a specific error or message risks false positives, since `raise_error` will match when Ruby raises a `NoMethodError`, `NameError` or `ArgumentError`, potentially allowing the expectation to pass without even executing the method you are intending to call. Instead consider providing a specific error class or message. This message can be supressed by setting: `RSpec::Expectations.configuration.warn_about_potential_false_positives = false`.\r\n{quote}\r\n\r\nWe should go through the specs and fix every instance of {{raise_error}} to pass at least the type of error that's expected.","closed_at":"2015-07-22T14:19:01.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4758","labels":"","state":"Closed","updated_at":"2015-07-22T14:19:01.000-0700","timestamp":1652284918.086526,"priority":"Normal","status_category":"Done","pull_request":4050},{"issue_id":"88028","title":"meaning of Integer[0] different in a ruby function","url":"https://tickets.puppetlabs.com/browse/PUP-4826","created_at":"2015-07-07T20:11:51.000-0700","number":"PUP-4826","body":"Update\r\n----\r\nTh 4.x function API created types that were more restrictive for {{Integer}} and {{Float}} than the corresponding expressions in the puppet language.\r\nWhen using {{Integer\\[1]}}, the expectation was that this produces the type {{Integer\\[1, default]}}, but it produced {{Integer\\[1,1]}}. The handling of\r\n{{Float}} had the same problem.\r\n\r\nAfter the fix, the types in the 4.x function API behaves as documented for the Puppet Language.\r\n\r\nOriginal\r\n----\r\n\r\nHi,\r\n\r\nAccording to [the documentation|http://docs.puppetlabs.com/puppet/4.2/reference/lang_data_number.html#parameters],\r\n\r\n{code}\r\nInteger[0]\r\n{code}\r\n\r\nmatches any integer greater than or equal to 0. But the behavior is different in a ruby function. Here is the content of the ruby function {{f.rb}} in a {{test}} puppet module :\r\n\r\n{code:ruby}\r\n# The function is in <module-root>/test/lib/puppet/functions/test/f.rb\r\nPuppet::Functions.create_function(:'test::f') do\r\n\r\n  dispatch :f do\r\n    required_param 'Integer[0]', :n\r\n  end\r\n\r\n  def f(n)\r\n    true\r\n  end\r\n\r\nend\r\n{code}\r\n\r\nThen, if I try to call the function in a puppet class like this:\r\n\r\n{code:puppet}\r\nclass test {\r\n\r\n  test::f(10)\r\n\r\n}\r\n{code}\r\n\r\nI have this error:\r\n\r\n{code}\r\nroot@puppet4:~# puppet agent --test\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nError: Could not retrieve catalog from remote server: Error 400 on SERVER: Evaluation Error: Error while evaluating a Function Call, function 'test::f' called with mis-matched arguments\r\nexpected:\r\n  test::f(Integer[0, 0] n) - arg count {1}\r\nactual:\r\n  test::f(Integer) - arg count {1} at /etc/puppetlabs/code/environments/production/modules/test/manifests/init.pp:12:3 on node puppet4.athome.priv\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\n{code}\r\n\r\nIn ruby function, it seems that:\r\n\r\n{code}\r\nInteger[0] <=> Integer[0, 0]\r\n{code}\r\n\r\nIt isn't a big problem because there is a workaround with:\r\n\r\n{code}\r\nPuppet::Functions.create_function(:'test::f') do\r\n\r\n  dispatch :f do\r\n    #required_param 'Integer[0]', :n\r\n    required_param 'Integer[0, default]', :n\r\n  end\r\n\r\n  def f(n)\r\n    true\r\n  end\r\n\r\nend\r\n{code}\r\n\r\nHowever it seems to me that there is a little inconsistency.\r\nRegards.","closed_at":"2015-07-22T14:19:01.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4826","labels":"","state":"Closed","updated_at":"2015-07-22T14:19:01.000-0700","timestamp":1652284918.190494,"priority":"Normal","status_category":"Done","pull_request":4076},{"issue_id":"79136","title":"Transitory failure on rdoc specs in AppVeyor","url":"https://tickets.puppetlabs.com/browse/PUP-4537","created_at":"2015-05-07T08:26:54.000-0700","number":"PUP-4537","body":"Encountered a transitory failure in spec/integration/util/rdoc when running in AppVeyor.\r\n\r\n{code}\r\n[00:13:33] Failures:\r\n[00:13:33] \r\n[00:13:33]   1) RDoc::Parser rdoc2 support behaves like an_rdoc_site documents the a_module::a_plugin type\r\n[00:13:33]      Failure/Error: Puppet::Util::RDoc.rdoc(doc_dir, [modules_dir, manifests_dir])\r\n[00:13:33]      RDoc::Error:\r\n[00:13:33]        error generating C:/Users/appveyor/AppData/Local/Temp/1/rspecrun20150506-1356-1tdbqqr/rdoc_parser_tmp20150506-1356-1yd6bk1/doc/__/__/Users/appveyor/AppData/Local/Temp/1/rspecrun20150506-1356-1tdbqqr/rdoc_parser_tmp20150506-1356-1yd6bk1/modules/a_module/lib/puppet/type/a_plugin_rb.html: No such file or directory @ rb_sysopen - C:/Users/appveyor/AppData/Local/Temp/1/rspecrun20150506-1356-1tdbqqr/rdoc_parser_tmp20150506-1356-1yd6bk1/doc/__/__/Users/appveyor/AppData/Local/Temp/1/rspecrun20150506-1356-1tdbqqr/rdoc_parser_tmp20150506-1356-1yd6bk1/modules/a_module/manifests/a_type_pp.html (Errno::ENOENT)\r\n[00:13:33]      Shared Example Group: :an_rdoc_site called from ./spec/integration/util/rdoc/parser_spec.rb:180\r\n[00:13:33]      # ./lib/puppet/util/rdoc.rb:39:in `rdoc'\r\n[00:13:33]      # ./spec/integration/util/rdoc/parser_spec\r\n[00:13:33] .rb:141:in `block (2 levels) in <top (required)>'\r\n[00:13:33]      # ./spec/integration/util/rdoc/parser_spec.rb:133:in `block (3 levels) in <top (required)>'\r\n[00:13:33]      # ./lib/puppet/context.rb:64:in `override'\r\n[00:13:33]      # ./lib/puppet.rb:223:in `override'\r\n[00:13:33]      # ./spec/integration/util/rdoc/parser_spec.rb:132:in `block (2 levels) in <top (required)>'\r\n[00:13:33] \r\n[00:13:33]   2) RDoc::Parser rdoc2 support behaves like an_rdoc_site documents the a_module::a_fact fact\r\n[00:13:33]      Failure/Error: Puppet::Util::RDoc.rdoc(doc_dir, [modules_dir, manifests_dir])\r\n[00:13:33]      RDoc::Error:\r\n[00:13:33]        error generating C:/Users/appveyor/AppData/Local/Temp/1/rspecrun20150506-1356-1tdbqqr/rdoc_parser_tmp20150506-1356-1bl19oe/doc/__/__/Users/appveyor/AppData/Local/Temp/1/rspecrun20150506-1356-1tdbqqr/rdoc_parser_tmp20150506-1356-1bl19oe/modules/a_module/lib/puppet/type/a_plugin_rb.html: No such file or directory @ rb_sysopen - C:/Users/appveyor/AppData/Local/Temp/1/rspecrun20150506-1356-1tdbqqr/rdoc_parser_tmp20150506-1356-1bl19oe/doc/__/__/Users/appveyor/AppData/Local/Temp/1\r\n[00:13:33] /rspecrun20150506-1356-1tdbqqr/rdoc_parser_tmp20150506-1356-1bl19oe/modules/a_module/manifests/a_type_pp.html (Errno::ENOENT)\r\n[00:13:33]      Shared Example Group: :an_rdoc_site called from ./spec/integration/util/rdoc/parser_spec.rb:180\r\n[00:13:33]      # ./lib/puppet/util/rdoc.rb:39:in `rdoc'\r\n[00:13:33]      # ./spec/integration/util/rdoc/parser_spec.rb:141:in `block (2 levels) in <top (required)>'\r\n[00:13:33]      # ./spec/integration/util/rdoc/parser_spec.rb:133:in `block (3 levels) in <top (required)>'\r\n[00:13:33]      # ./lib/puppet/context.rb:64:in `override'\r\n[00:13:33]      # ./lib/puppet.rb:223:in `override'\r\n[00:13:33]      # ./spec/integration/util/rdoc/parser_spec.rb:132:in `block (2 levels) in <top (required)>'\r\n{code}\r\n\r\nFull log attached.","closed_at":"2015-07-22T14:19:02.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4537","labels":"rdoc;windows","state":"Closed","updated_at":"2015-07-22T14:19:02.000-0700","timestamp":1652284918.294289,"priority":"Normal","status_category":"Done","pull_request":4046},{"issue_id":"75827","title":"Ordering dependency exists between certificate_request_spec.rb and autosign_spec.rb","url":"https://tickets.puppetlabs.com/browse/PUP-4405","created_at":"2015-04-13T17:19:45.000-0700","number":"PUP-4405","body":"If autosign_spec.rb isn't run first, certificate_request_spec.rb will fail. This blocks using the parallel:spec rake task to run spec tests faster on Windows.\r\n\r\nSpecifically, it appears {{host.generate_certificate_request}} needs to be called before all the calls to {{Puppet::SSL::CertificateRequest.indirection.save(@csr)}}.\r\n\r\nSo far this has only been confirmed on Windows.\r\n\r\n\r\n\r\nh2. QA Risk Analysis\r\nN/A for testing framework","closed_at":"2015-07-22T14:19:02.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4405","labels":"","state":"Closed","updated_at":"2015-07-22T14:19:02.000-0700","timestamp":1652284918.397446,"priority":"Normal","status_category":"Done","pull_request":4066},{"issue_id":"85789","title":"Puppet gem dependencies are out of date","url":"https://tickets.puppetlabs.com/browse/PUP-4777","created_at":"2015-06-22T16:55:39.000-0700","number":"PUP-4777","body":"Installing puppet 4.2.0 as a gem won't install hiera 3.0, even though that is the combination we'll be shipping in puppet-agent 1.2.0.\r\n\r\n{noformat}\r\n$ gem install ./hiera-3.0.0.gem\r\nSuccessfully installed hiera-3.0.0\r\n1 gem installed\r\n$ gem install ./puppet-4.2.0.gem\r\nFetching: hiera-2.0.0.gem (100%)\r\nSuccessfully installed hiera-2.0.0\r\nSuccessfully installed puppet-4.2.0\r\n2 gems installed\r\n{noformat}\r\n\r\nAlso if you try to run puppet from source, bundler will refuse to use hiera 3:\r\n\r\n{noformat}\r\n$ echo $HIERA_LOCATION\r\nfile:///Users/josh/work/hiera\r\n$ bundle exec hiera --version\r\n3.0.0\r\n$ cd ../puppet\r\n$ bundle update\r\nFetching gem metadata from https://rubygems.org/.......\r\nFetching version metadata from https://rubygems.org/..\r\nResolving dependencies...\r\nCould not find gem 'hiera (< 3, >= 2.0) ruby', which is required by gem 'puppet (>= 0)\r\nruby', in any of the sources.\r\n{noformat}","closed_at":"2015-07-22T14:19:02.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4777","labels":"","state":"Closed","updated_at":"2015-07-22T14:19:02.000-0700","timestamp":1652284918.500521,"priority":"Normal","status_category":"Done","pull_request":4045},{"issue_id":"31935","title":"yumrepo attributes cannot be set to '_none_'","url":"https://tickets.puppetlabs.com/browse/PUP-2271","created_at":"2014-04-15T13:27:53.000-0700","number":"PUP-2271","body":"The {{yumrepo}} attribute cannot be set to the value \"_none_\" even though this is a supported value for the yum {{proxy}} parameter. We should fix this.\r\n\r\n{code}\r\n$ puppet apply -e \"yumrepo {'base': proxy => '_none_'}\"\r\nNotice: Compiled catalog for localhost.localdomain in environment production in 0.03 seconds\r\nError: Parameter proxy failed on Yumrepo[base]: Validate method failed for class proxy: Must be a valid URL at line 1\r\nWrapped exception:\r\nValidate method failed for class proxy: Must be a valid URL\r\n{code}","closed_at":"2015-07-28T03:13:21.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2271","labels":"","state":"Closed","updated_at":"2015-07-28T03:13:21.000-0700","timestamp":1652284919.216765,"priority":"Normal","status_category":"Done","pull_request":2767},{"issue_id":"86843","title":"Custom facts not loaded when using puppet resource command","url":"https://tickets.puppetlabs.com/browse/PUP-4847","created_at":"2015-06-30T11:58:42.000-0700","number":"PUP-4847","body":"I'm seeing an issue where when running puppet resource, it does not load custom facts (puppet apply works ok).\r\n\r\nThis is a masterless installation (i.e. no certs setup), so I don't believe this to be a pluginsync issue.\r\n\r\n{code}\r\nroot@hkmjr2cbdmkpxh2:~# /opt/puppetlabs/bin/puppet module install puppetlabs-firewall\r\nNotice: Preparing to install into /etc/puppetlabs/code/environments/production/modules ...\r\nNotice: Downloading from https://forgeapi.puppetlabs.com ...\r\nNotice: Installing -- do not interrupt ...\r\n/etc/puppetlabs/code/environments/production/modules\r\n└── puppetlabs-firewall (v1.6.0)\r\nroot@hkmjr2cbdmkpxh2:/opt/puppetlabs/bin# ls /etc/puppetlabs/code/environments/production/modules/firewall/lib/facter/iptables_version.rb\r\n/etc/puppetlabs/code/environments/production/modules/firewall/lib/facter/iptables_version.rb\r\nroot@hkmjr2cbdmkpxh2:/opt/puppetlabs/bin# cat test.pp\r\nnotify {\"$::iptables_version\":}\r\nroot@hkmjr2cbdmkpxh2:/opt/puppetlabs/bin# strace -efile -f ./puppet apply test.pp 2>&1 | grep iptables_version\r\n[pid  1817] stat(\"/etc/puppetlabs/code/environments/production/modules/firewall/lib/facter/iptables_version.rb\", {st_mode=S_IFREG|0644, st_size=234, ...}) = 0\r\n[pid  1817] open(\"/etc/puppetlabs/code/environments/production/modules/firewall/lib/facter/iptables_version.rb\", O_RDONLY|O_CLOEXEC) = 8\r\n[pid  1817] open(\"/etc/puppetlabs/code/environments/production/modules/firewall/lib/facter/iptables_version.rb\", O_RDONLY|O_CLOEXEC) = 8\r\n[pid  1817] lstat(\"/etc/puppetlabs/code/environments/production/modules/firewall/lib/facter/iptables_version.rb\", {st_mode=S_IFREG|0644, st_size=234, ...}) = 0\r\n[pid  1817] stat(\"/etc/puppetlabs/code/environments/production/modules/firewall/lib/facter/iptables_version.rb\", {st_mode=S_IFREG|0644, st_size=234, ...}) = 0\r\nroot@hkmjr2cbdmkpxh2:/opt/puppetlabs/bin# strace -efile -f ./puppet resource firewall 2>&1 | grep iptables_version\r\nroot@hkmjr2cbdmkpxh2:/opt/puppetlabs/bin# ./puppet resource firewall\r\nError: Could not autoload puppet/provider/firewall/iptables: undefined method `value' for nil:NilClass\r\nError: Could not autoload puppet/type/firewall: Could not autoload puppet/provider/firewall/iptables: undefined method `value' for nil:NilClass\r\nError: Could not run: Could not autoload puppet/type/firewall: Could not autoload puppet/provider/firewall/iptables: undefined method `value' for nil:NilClass\r\nroot@hkmjr2cbdmkpxh2:/opt/puppetlabs/bin# ./puppet resource firewall --trace --debug\r\nDebug: Runtime environment: puppet_version=4.2.0, ruby_version=2.1.6, run_mode=user, default_encoding=UTF-8\r\nDebug: Facter: searching for custom fact \"iptables_version\".\r\nDebug: Facter: fact \"facterversion\" has resolved to \"3.0.1\".\r\nDebug: Facter: skipping external facts for \"/opt/puppetlabs/facter/facts.d\": No such file or directory\r\nDebug: Facter: skipping external facts for \"/etc/facter/facts.d\": No such file or directory\r\nDebug: Facter: skipping external facts for \"/etc/puppetlabs/facter/facts.d\": No such file or directory\r\nDebug: Facter: no external facts were found.\r\nDebug: Facter: loading all custom facts.\r\nDebug: Facter: custom fact \"iptables_version\" was not found.\r\nError: Could not autoload puppet/provider/firewall/iptables: undefined method `value' for nil:NilClass\r\n/etc/puppetlabs/code/environments/production/modules/firewall/lib/puppet/provider/firewall/iptables.rb:44:in `block in <top (required)>'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/classgen.rb:136:in `class_eval'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/classgen.rb:136:in `genthing'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/classgen.rb:36:in `genclass'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:1778:in `provide'\r\n/etc/puppetlabs/code/environments/production/modules/firewall/lib/puppet/provider/firewall/iptables.rb:4:in `<top (required)>'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:59:in `load'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:59:in `load_file'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:74:in `block in loadall'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:72:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:72:in `loadall'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:203:in `loadall'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/metatype/manager.rb:116:in `newtype'\r\n/etc/puppetlabs/code/environments/production/modules/firewall/lib/puppet/type/firewall.rb:12:in `<top (required)>'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:59:in `load'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:59:in `load_file'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:189:in `load'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/metatype/manager.rb:157:in `type'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/resource.rb:194:in `parse_args'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/resource.rb:136:in `main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:352:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:438:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:124:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\nError: Could not autoload puppet/type/firewall: Could not autoload puppet/provider/firewall/iptables: undefined method `value' for nil:NilClass\r\n/etc/puppetlabs/code/environments/production/modules/firewall/lib/puppet/provider/firewall/iptables.rb:44:in `block in <top (required)>'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/classgen.rb:136:in `class_eval'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/classgen.rb:136:in `genthing'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/classgen.rb:36:in `genclass'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:1778:in `provide'\r\n/etc/puppetlabs/code/environments/production/modules/firewall/lib/puppet/provider/firewall/iptables.rb:4:in `<top (required)>'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:59:in `load'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:59:in `load_file'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:74:in `block in loadall'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:72:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:72:in `loadall'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:203:in `loadall'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/metatype/manager.rb:116:in `newtype'\r\n/etc/puppetlabs/code/environments/production/modules/firewall/lib/puppet/type/firewall.rb:12:in `<top (required)>'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:59:in `load'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:59:in `load_file'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:189:in `load'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/metatype/manager.rb:157:in `type'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/resource.rb:194:in `parse_args'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/resource.rb:136:in `main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:352:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:438:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:124:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\nError: Could not run: Could not autoload puppet/type/firewall: Could not autoload puppet/provider/firewall/iptables: undefined method `value' for nil:NilClass\r\n/etc/puppetlabs/code/environments/production/modules/firewall/lib/puppet/provider/firewall/iptables.rb:44:in `block in <top (required)>'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/classgen.rb:136:in `class_eval'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/classgen.rb:136:in `genthing'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/classgen.rb:36:in `genclass'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:1778:in `provide'\r\n/etc/puppetlabs/code/environments/production/modules/firewall/lib/puppet/provider/firewall/iptables.rb:4:in `<top (required)>'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:59:in `load'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:59:in `load_file'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:74:in `block in loadall'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:72:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:72:in `loadall'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:203:in `loadall'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/metatype/manager.rb:116:in `newtype'\r\n/etc/puppetlabs/code/environments/production/modules/firewall/lib/puppet/type/firewall.rb:12:in `<top (required)>'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:59:in `load'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:59:in `load_file'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:189:in `load'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/metatype/manager.rb:157:in `type'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/resource.rb:194:in `parse_args'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/resource.rb:136:in `main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:352:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:438:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:124:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\n{code}\r\n\r\n\r\n{code}\r\nroot@hkmjr2cbdmkpxh2:/opt/puppetlabs/bin# ./puppet --version\r\n4.2.0\r\nroot@hkmjr2cbdmkpxh2:/opt/puppetlabs/bin# ./facter --version\r\n3.0.1 (commit 9b1ef723a1494a01e0eccfe93a75fd43316690c2)\r\n{code}\r\n\r\nThis is caused by new Facter behavior, but the new Facter behavior makes a lot more sense, so fixing in Puppet by re-initializing Facter after $LOAD_PATH manipulation.","closed_at":"2015-07-29T15:41:42.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4847","labels":"","state":"Closed","updated_at":"2015-07-29T15:41:42.000-0700","timestamp":1652284919.935751,"priority":"Critical","status_category":"Done","pull_request":4079},{"issue_id":"86342","title":"hiera_include does not have access to variables from node scope when future parser is enabled","url":"https://tickets.puppetlabs.com/browse/PUP-4789","created_at":"2015-06-25T15:30:45.000-0700","number":"PUP-4789","body":"The 4.x hiera include function does not propagate the correct scope to the include function and this screws up in which context/scope things are being looked up.\r\n\r\nWORKAROUND\r\n----\r\nInstead of {{hiera_include}} use {{include hiera_array('classes')}} as the problem is with the 'include' functionality inside of hiera_include.\r\n\r\nREPRODUCTION\r\n----\r\n{noformat}\r\n[root@master381-centos-2 ~]# cat /etc/puppetlabs/puppet/environments/production/modules/test/manifests/init.pp\r\nclass test {\r\n\r\n  notify { \"my role is ${role}\": }\r\n\r\n}\r\n[root@master381-centos-2 ~]# cat /etc/puppetlabs/puppet/environments/production/modules/test_wrapper/manifests/init.pp\r\nclass test_wrapper {\r\n\r\n  notify { \"in test_wrapper ${role}\" : }\r\n  include test\r\n\r\n}\r\n[root@master381-centos-2 ~]# cat /etc/puppetlabs/puppet/environments/production/manifests/site.pp\r\n\r\nnode default {\r\n  #$role = 'my_test_role'\r\n  hiera_include( 'classes' )\r\n  #include hiera_array('classes')\r\n  notify { \"${role}\" : }\r\n\r\n}\r\n{noformat}","closed_at":"2015-07-29T15:42:08.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4789","labels":"tcse","state":"Closed","updated_at":"2015-07-29T15:42:08.000-0700","timestamp":1652284920.046628,"priority":"Normal","status_category":"Done","pull_request":4058},{"issue_id":"84376","title":"Uppercase letters in parameter variable names","url":"https://tickets.puppetlabs.com/browse/PUP-4752","created_at":"2015-06-12T07:43:32.000-0700","number":"PUP-4752","body":"According to https://docs.puppetlabs.com/puppet/4.1/reference/lang_reserved.html#parameters\r\nuppercase letters are not allowed in parameter names.  Reference documentation as far back as at least 2.7 also forbids them.\r\n\r\nFollowing discussion on IRC,\r\nPuppet 4 is a lot stricter than puppet 3, and *does* check variables names, but *not* if they appear as names of parameters.  Apparently, it should, and that it doesn't is a bug.\r\n\r\nUPDATE\r\n----\r\nThe only validation taking place on parameters is a check that they are are numeric. When improving the checking, it should also be validated that the name does not include '::'.","closed_at":"2015-07-29T15:42:45.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4752","labels":"","state":"Closed","updated_at":"2015-07-29T15:42:45.000-0700","timestamp":1652284920.153633,"priority":"Normal","status_category":"Done","pull_request":4068},{"issue_id":"86440","title":"Global parser = future with environment.conf parser = current gives an error","url":"https://tickets.puppetlabs.com/browse/PUP-4848","created_at":"2015-06-26T10:39:35.000-0700","number":"PUP-4848","body":"Update\r\n----\r\nCollect expressions in a manifest will result in an attempt to use 4.x code that has not been loaded when the parser setting is future and an environment sets parser to current. The problem does not occur if the master prior to evaluating a collexpr in a parser=current environment has evaluated something in an environment where parser=future. This can be reproduced with this manifest, having main setting parser=future, and production environment parser=current.\r\n\r\n{code:puppet}\r\nnode default {\r\n  @file {'/tmp/somefile':\r\n    content => \"puppet file\",\r\n    tag => ['specialfile']\r\n  }\r\n\r\n  File <| tag == 'specialfile' |>\r\n}\r\n{code}\r\n\r\nOriginal\r\n----\r\n1. Set parser = future in puppet.conf\r\n2. Set parser = current in environment.conf for production\r\n3.  service pe-puppetserver restart\r\n4.  run puppet agent -t \r\n5.  Get the following error\r\n\r\n{noformat}\r\n[root@master381-centos ~]# service pe-puppetserver restart; puppet agent -t\r\nStopping pe-puppetserver:                                  [  OK  ]\r\nStarting pe-puppetserver:                                  [  OK  ]\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nError: Could not retrieve catalog from remote server: Error 400 on SERVER: uninitialized constant Puppet::Pops at /opt/puppet/share/puppet/modules/puppet_enterprise/manifests/profile/agent.pp:12 on node master381-centos\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\n{noformat}\r\n\r\nThe issue does not occur by simply enabling future parser or by using current parser but only in this specific configuration.  I think.  ","closed_at":"2015-08-06T14:56:02.000-0700","comments":23,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4848","labels":"tcse","state":"Closed","updated_at":"2015-08-06T14:56:02.000-0700","timestamp":1652284922.525941,"priority":"Normal","status_category":"Done","pull_request":4086},{"issue_id":"18411","title":"puppet facts find returns facts for wrong node","url":"https://tickets.puppetlabs.com/browse/PUP-704","created_at":"2013-11-07T08:02:13.000-0800","number":"PUP-704","body":"[root@master mconotify]# puppet -V\r\n3.3.1 (Puppet Enterprise 3.1.0)\r\n[root@master mconotify]# puppet facts find --render-as yaml  puppet06.puppet.tld|grep fqdn\r\n    fqdn: master.spence.org.uk.local\r\n","closed_at":"2015-08-07T13:38:49.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-704","labels":"","state":"Closed","updated_at":"2015-08-07T13:38:49.000-0700","timestamp":1652284923.163511,"priority":"Normal","status_category":"Done","pull_request":6556},{"issue_id":"56732","title":"'ensure' parameter is always treated as if it were a property","url":"https://tickets.puppetlabs.com/browse/PUP-3589","created_at":"2014-10-30T01:06:24.000-0700","number":"PUP-3589","body":"Puppet (since at least 2.6.0; I've marked the earliest and latest available released versions as affected) considers any parameter named 'ensure' on a type to be a property that can be synced. While this is true for all built-in types, it is not generally true. A property is a special type of parameter, and if 'ensure' is not a property, then Ruby will throw undefined method exceptions in at least two different places in the code because Puppet assumes that methods defined by Puppet::Property are available.\r\n\r\nA real-world use case where it makes sense to have an 'ensure' parameter which is not a property is a type that exists only to generate additional resources on the agent. For example, we have a custom type (Gen_file) that has a 'command' parameter, runs this command on the agent, and generates a File resource with the command output as its contents. Gen_file itself has no syncable state, so it makes no sense for it to have properties, but it does have an 'ensure' parameter whose value is passed onto the generated File resource's 'ensure' property.\r\n\r\nI intend to submit a pull request to fix this behaviour shortly, which will highlight the specific parts of the code where this assumption is made.","closed_at":"2015-09-08T22:39:07.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3589","labels":"","state":"Closed","updated_at":"2015-09-08T22:39:07.000-0700","timestamp":1652284932.356182,"priority":"Minor","status_category":"Done","pull_request":3257},{"issue_id":"68842","title":"puppet device always exits 0","url":"https://tickets.puppetlabs.com/browse/PUP-4032","created_at":"2015-02-20T09:36:33.000-0800","number":"PUP-4032","body":"Compile errors, resource failures, --detailed-exitcodes... it always exits 0.","closed_at":"2015-09-08T22:56:18.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4032","labels":"","state":"Resolved","updated_at":"2015-09-08T22:56:18.000-0700","timestamp":1652284932.461587,"priority":"Normal","status_category":"Done","pull_request":3633},{"issue_id":"92676","title":"Puppet::FileSystem.unlink fails on Windows when the target path doesn't exist","url":"https://tickets.puppetlabs.com/browse/PUP-5018","created_at":"2015-08-10T11:57:37.000-0700","number":"PUP-5018","body":"When attempting to delete a symlink on Windows for a target path that no longer exists, Puppet throws a Permission Denied error.\r\n\r\nThis was discovered during the work for MODULES-2175.\r\n{noformat}\r\n[1] pry(DscSymlink)> e.class\r\n=> Errno::EACCES\r\n{noformat}\r\n\r\n*Expected:* The link should be removed.\r\n\r\n*Repro:* To reproduce, create a symlink, delete the target path and then try to unlink it:\r\n\r\n{noformat}\r\n    it \"should unlink a symlink if the existing link path does not exist\" do\r\n      path =   Dir.mktmpdir('test')\r\n      symlink_path = \"#{path}\\\\link\"\r\n      link_target = Dir.mktmpdir('link_test')\r\n      Puppet::FileSystem.symlink(link_target, symlink_path, { :force => true})\r\n      system(\"rmdir /s /q \\\"#{link_target}\\\"\")\r\n\r\n      Puppet::FileSystem.unlink(symlink_path)\r\n    end\r\n{noformat}\r\n","closed_at":"2015-09-14T13:50:39.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5018","labels":"windows","state":"Closed","updated_at":"2015-09-14T13:50:39.000-0700","timestamp":1652284934.581933,"priority":"Normal","status_category":"Done","pull_request":4147},{"issue_id":"91046","title":"acceptance test curl fails on sles-10","url":"https://tickets.puppetlabs.com/browse/PUP-4952","created_at":"2015-07-29T08:51:05.000-0700","number":"PUP-4952","body":"In finishing up the work for PUP-4757, I saw that {{tests/concurrency/ticket_2659_concurrent_catalog_requests.rb}} fails for just sles-10 platforms while trying to run a curl command:\r\n\r\n{noformat}\r\nerror:0D0C50A1:asn1 encoding routines:ASN1_item_verify:unknown message digest algorithm\r\n{noformat}\r\n\r\nThe output from the [Jenkins job|https://jenkins.puppetlabs.com/view/PE-Only%20Agents/job/platform_aio-suite_intn-sys_stable-pe-puppet/27/SLAVE_LABEL=beaker,TEST_TARGET=sles-10-x86_64/] is below:\r\n\r\n{noformat}\r\nLaunched 7242\r\nAll requests are finished\r\n\r\nvi0wlol4yl8zhej.delivery.puppetlabs.net (agent) executed in 0.44 seconds\r\n\r\n  * Checking the results of catalog request #0\r\n\r\nvi0wlol4yl8zhej.delivery.puppetlabs.net (agent) 14:25:16$ cat /tmp/concurrent-loop-script.WI7228/catalog-request-0.out\r\nCurling: https://vhe7vlgjov1x02t.delivery.puppetlabs.net:8140/puppet/v3/catalog/vi0wlol4yl8zhej.delivery.puppetlabs.net?environment=production\r\n* About to connect() to vhe7vlgjov1x02t.delivery.puppetlabs.net port 8140\r\n*   Trying 10.32.113.13... connected\r\n* Connected to vhe7vlgjov1x02t.delivery.puppetlabs.net (10.32.113.13) port 8140\r\n* successfully set certificate verify locations:\r\n*   CAfile: /etc/puppetlabs/puppet/ssl/certs/ca.pem\r\n  CApath: none\r\n* SSLv3, TLS handshake, Client hello (1):\r\nSSLv3, TLS handshake, Server hello (2):\r\nSSLv3, TLS handshake, CERT (11):\r\nSSLv3, TLS alert, Server hello (2):\r\nerror:0D0C50A1:asn1 encoding routines:ASN1_item_verify:unknown message digest algorithm\r\n* Closing connection #0\r\ncurl: (35) error:0D0C50A1:asn1 encoding routines:ASN1_item_verify:unknown message digest algorithm\r\n5117 Completed\r\n\r\nvi0wlol4yl8zhej.delivery.puppetlabs.net (agent) executed in 0.03 seconds\r\nWarning: \r\nExpected /< HTTP\\/1.* 200/ to match \"Curling: https://vhe7vlgjov1x02t.delivery.puppetlabs.net:8140/puppet/v3/catalog/vi0wlol4yl8zhej.delivery.puppetlabs.net?environment=production\\n* About to connect() to vhe7vlgjov1x02t.delivery.puppetlabs.net port 8140\\n*   Trying 10.32.113.13... connected\\n* Connected to vhe7vlgjov1x02t.delivery.puppetlabs.net (10.32.113.13) port 8140\\n* successfully set certificate verify locations:\\n*   CAfile: /etc/puppetlabs/puppet/ssl/certs/ca.pem\\n  CApath: none\\n* SSLv3, TLS handshake, Client hello (1):\\nSSLv3, TLS handshake, Server hello (2):\\nSSLv3, TLS handshake, CERT (11):\\nSSLv3, TLS alert, Server hello (2):\\nerror:0D0C50A1:asn1 encoding routines:ASN1_item_verify:unknown message digest algorithm\\n* Closing connection #0\\ncurl: (35) error:0D0C50A1:asn1 encoding routines:ASN1_item_verify:unknown message digest algorithm\\n5117 Completed\\n\".\r\n{noformat}\r\n\r\nIt also outputs a stack trace which I've included here if needed:\r\n{noformat}\r\n/var/lib/jenkins/workspace/platform_aio-suite_intn-sys_stable-pe-puppet/SLAVE_LABEL/beaker/TEST_TARGET/sles-10-x86_64/puppet/acceptance/.bundle/gems/gems/beaker-2.18.3/lib/beaker/dsl/outcomes.rb:42\r\n/var/lib/jenkins/workspace/platform_aio-suite_intn-sys_stable-pe-puppet/SLAVE_LABEL/beaker/TEST_TARGET/sles-10-x86_64/puppet/acceptance/.bundle/gems/gems/beaker-2.18.3/lib/beaker/dsl/helpers/puppet_helpers.rb:174\r\n/var/lib/jenkins/workspace/platform_aio-suite_intn-sys_stable-pe-puppet/SLAVE_LABEL/beaker/TEST_TARGET/sles-10-x86_64/puppet/acceptance/.bundle/gems/gems/beaker-2.18.3/lib/beaker/dsl/helpers/puppet_helpers.rb:214\r\n/var/lib/jenkins/workspace/platform_aio-suite_intn-sys_stable-pe-puppet/SLAVE_LABEL/beaker/TEST_TARGET/sles-10-x86_64/puppet/acceptance/tests/concurrency/ticket_2659_concurrent_catalog_requests.rb:66\r\n/var/lib/jenkins/workspace/platform_aio-suite_intn-sys_stable-pe-puppet/SLAVE_LABEL/beaker/TEST_TARGET/sles-10-x86_64/puppet/acceptance/.bundle/gems/gems/beaker-2.18.3/lib/beaker/test_case.rb:128\r\n/var/lib/jenkins/workspace/platform_aio-suite_intn-sys_stable-pe-puppet/SLAVE_LABEL/beaker/TEST_TARGET/sles-10-x86_64/puppet/acceptance/.bundle/gems/gems/beaker-2.18.3/lib/beaker/test_case.rb:128\r\n/usr/local/rvm/rubies/ruby-1.9.3-p484/lib/ruby/1.9.1/benchmark.rb:295\r\n/var/lib/jenkins/workspace/platform_aio-suite_intn-sys_stable-pe-puppet/SLAVE_LABEL/beaker/TEST_TARGET/sles-10-x86_64/puppet/acceptance/.bundle/gems/gems/beaker-2.18.3/lib/beaker/test_case.rb:125\r\n/var/lib/jenkins/workspace/platform_aio-suite_intn-sys_stable-pe-puppet/SLAVE_LABEL/beaker/TEST_TARGET/sles-10-x86_64/puppet/acceptance/.bundle/gems/gems/beaker-2.18.3/lib/beaker/test_suite.rb:311\r\n/var/lib/jenkins/workspace/platform_aio-suite_intn-sys_stable-pe-puppet/SLAVE_LABEL/beaker/TEST_TARGET/sles-10-x86_64/puppet/acceptance/.bundle/gems/gems/beaker-2.18.3/lib/beaker/test_suite.rb:308\r\n/var/lib/jenkins/workspace/platform_aio-suite_intn-sys_stable-pe-puppet/SLAVE_LABEL/beaker/TEST_TARGET/sles-10-x86_64/puppet/acceptance/.bundle/gems/gems/beaker-2.18.3/lib/beaker/test_suite.rb:308\r\n/var/lib/jenkins/workspace/platform_aio-suite_intn-sys_stable-pe-puppet/SLAVE_LABEL/beaker/TEST_TARGET/sles-10-x86_64/puppet/acceptance/.bundle/gems/gems/beaker-2.18.3/lib/beaker/test_suite.rb:357\r\n/var/lib/jenkins/workspace/platform_aio-suite_intn-sys_stable-pe-puppet/SLAVE_LABEL/beaker/TEST_TARGET/sles-10-x86_64/puppet/acceptance/.bundle/gems/gems/beaker-2.18.3/lib/beaker/cli.rb:155\r\n/var/lib/jenkins/workspace/platform_aio-suite_intn-sys_stable-pe-puppet/SLAVE_LABEL/beaker/TEST_TARGET/sles-10-x86_64/puppet/acceptance/.bundle/gems/gems/beaker-2.18.3/lib/beaker/cli.rb:97\r\n/var/lib/jenkins/workspace/platform_aio-suite_intn-sys_stable-pe-puppet/SLAVE_LABEL/beaker/TEST_TARGET/sles-10-x86_64/puppet/acceptance/.bundle/gems/gems/beaker-2.18.3/bin/beaker:6\r\n/var/lib/jenkins/workspace/platform_aio-suite_intn-sys_stable-pe-puppet/SLAVE_LABEL/beaker/TEST_TARGET/sles-10-x86_64/puppet/acceptance/.bundle/gems/bin/beaker:23\r\n/var/lib/jenkins/workspace/platform_aio-suite_intn-sys_stable-pe-puppet/SLAVE_LABEL/beaker/TEST_TARGET/sles-10-x86_64/puppet/acceptance/.bundle/gems/bin/beaker:23\r\n{noformat}","closed_at":"2015-09-14T13:50:39.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4952","labels":"","state":"Closed","updated_at":"2015-09-14T13:50:39.000-0700","timestamp":1652284934.796904,"priority":"Normal","status_category":"Done","pull_request":4153},{"issue_id":"93244","title":"`--parser future` breaks `class application {}` ","url":"https://tickets.puppetlabs.com/browse/PUP-5036","created_at":"2015-08-13T08:12:23.000-0700","number":"PUP-5036","body":"First noticed after updating to 3.8.2. Compilation will fail with error: \r\n\r\n{{Error: Could not parse for environment production: Syntax error at 'application'  at line 1:7 on node build.setup}}\r\n\r\nInvestigation concurred that if you have a class named {{application}}, and the {{--parser future}} options specified, the compilation will fail: \r\n\r\n\r\n{code}\r\n[root@build puppet]# puppet apply -e 'class application {}'\r\nNotice: Compiled catalog for build.setup in environment production in 0.04 seconds\r\nNotice: Finished catalog run in 0.01 seconds\r\n[root@build puppet]# puppet apply -e 'class application {}' --parser future\r\nError: Could not parse for environment production: Syntax error at 'application'  at line 1:7 on node build.setup\r\nError: Could not parse for environment production: Syntax error at 'application'  at line 1:7 on node build.setup\r\n{code}\r\n\r\nFixed by rolling back to 3.8.1: \r\n\r\n{code}\r\nInstalled:\r\n  puppet.noarch 0:3.8.1-1.el6\r\n\r\nComplete!\r\n[vagrant@build puppet]$ puppet apply -e 'class application {}' Notice: Compiled catalog for build.setup in environment production in 0.01 seconds\r\nNotice: Finished catalog run in 0.02 seconds\r\n[vagrant@build puppet]$ puppet apply -e 'class application {}' --parser future\r\nNotice: Compiled catalog for build.setup in environment production in 0.24 seconds\r\nNotice: Finished catalog run in 0.02 seconds\r\n{code}","closed_at":"2015-09-14T13:50:40.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5036","labels":"","state":"Closed","updated_at":"2015-09-14T13:50:40.000-0700","timestamp":1652284934.903693,"priority":"Major","status_category":"Done","pull_request":4158},{"issue_id":"47399","title":"exec resource with timeout doesn't kill executed command that times out","url":"https://tickets.puppetlabs.com/browse/PUP-3045","created_at":"2014-08-12T01:25:30.000-0700","number":"PUP-3045","body":"Trivial reproduction case:\r\n\r\nexec { \"sleep\":\r\n  command => \"/bin/sleep 1800\",\r\n  timeout => 10,\r\n}\r\n\r\nWith this, Puppet exits after roughly 10 seconds, but the sleep continues to run until the 1800 seconds are over.\r\n\r\nMy expectation would be for the sleep to get killed after the timeout hits.\r\n\r\nAs far as I can tell, the relevant code didn't change (much) till current head, so I suspect the issue still exists.","closed_at":"2015-09-14T13:50:40.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3045","labels":"customer;support","state":"Closed","updated_at":"2015-09-14T13:50:40.000-0700","timestamp":1652284935.00993,"priority":"Normal","status_category":"Done","pull_request":4159},{"issue_id":"96615","title":"Investigate Puppet acceptance failures on Solaris 10 x86_64","url":"https://tickets.puppetlabs.com/browse/PUP-5191","created_at":"2015-09-02T17:34:57.000-0700","number":"PUP-5191","body":"Ran with {{be rake ci:test:aio SHA=bd98fdd74b51eba26a76dcb2fd2d3afc0fc3596c CONFIG=config/nodes/solaris-10-x86_64.yaml SUITE_VERSION=1.2.3.230.gbd98fdd}}, probably need to get a new build.\r\n\r\n{code}\r\n      Test Suite: tests @ 2015-09-02 15:57:00 -0700\r\n\r\n      - Host Configuration Summary -\r\n\r\n\r\n              - Test Case Summary for suite 'tests' -\r\n       Total Suite Time: 5512.83 seconds\r\n      Average Test Time: 19.41 seconds\r\n              Attempted: 284\r\n                 Passed: 203\r\n                 Failed: 2\r\n                Errored: 9\r\n                Skipped: 68\r\n                Pending: 2\r\n                  Total: 284\r\n\r\n      - Specific Test Case Status -\r\n\r\nFailed Tests Cases:\r\n  Test Case tests/ticket_2455_on_solaris_init_provider_should_start_service_in_own_smf_contract.rb reported: #<Beaker::DSL::Outcomes::FailTest:\r\nThe fixture process sleepy_daemon is not alone in its SMF contract on qnio9m24e99vu6u.delivery.puppetlabs.net.\r\n>\r\n  Test Case tests/concurrency/ticket_2659_concurrent_catalog_requests.rb reported: #<Beaker::DSL::Outcomes::FailTest:\r\nExpected /< HTTP\\/1.* 200/ to match \"sleep: bad character in argument\\nCurling: https://lwj6fmovcxp7yjx.delivery.puppetlabs.net:8140/puppet/v3/catalog/qnio9m24e99vu6u.delivery.puppetlabs.net?environment=production\\nenv: No such file or directory\\n696 Completed\\n\".\r\n>\r\nErrored Tests Cases:\r\n  Test Case tests/allow_symlinks_as_config_directories.rb reported: #<Beaker::Host::CommandFailure: Host 'qnio9m24e99vu6u.delivery.puppetlabs.net' exited with 2 running:\r\n [ $(readlink /tmp/puppet_conf-symlink.7Maa6b) = /tmp/puppet_conf-directory.0Ma45b ]\r\nLast 10 lines of output were:\r\n\tbash: readlink: command not found\r\n\tbash: line 0: [: =: unary operator expected>\r\n  Test Case tests/ticket_9862_puppet_runs_without_service_user_or_group_present.rb reported: #<Beaker::Host::CommandFailure: Host 'qnio9m24e99vu6u.delivery.puppetlabs.net' exited with 1 running:\r\n find \"/opt/puppetlabs/puppet/cache\" -user existinguser\r\nLast 10 lines of output were:\r\n\tfind: cannot find existinguser name>\r\n  Test Case tests/config/apply_file_metadata_specified_in_config.rb reported: #<Beaker::Host::CommandFailure: Host 'qnio9m24e99vu6u.delivery.puppetlabs.net' exited with 127 running:\r\n stat --format '%U:%G:%a' /tmp/apply_file_metadata_specified_in_config.Xva4If/log\r\nLast 10 lines of output were:\r\n\tbash: stat: command not found>\r\n  Test Case tests/resource/file/symbolic_modes.rb reported: #<Beaker::Host::CommandFailure: Host 'qnio9m24e99vu6u.delivery.puppetlabs.net' exited with 127 running:\r\n stat --format '%U:%G:%a' /tmp/symbolic-modes.DdaGAp/file\r\nLast 10 lines of output were:\r\n\tbash: stat: command not found>\r\n  Test Case tests/resource/mount/defined.rb reported: #<Beaker::Host::CommandFailure: Host 'qnio9m24e99vu6u.delivery.puppetlabs.net' exited with 2 running:\r\n cp /etc/fstab /tmp/fstab\r\nLast 10 lines of output were:\r\n\tcp: cannot access /etc/fstab>\r\n  Test Case tests/resource/mount/destroy.rb reported: #<Beaker::Host::CommandFailure: Host 'qnio9m24e99vu6u.delivery.puppetlabs.net' exited with 2 running:\r\n cp /etc/fstab /tmp/fstab\r\nLast 10 lines of output were:\r\n\tcp: cannot access /etc/fstab>\r\n  Test Case tests/resource/mount/modify.rb reported: #<Beaker::Host::CommandFailure: Host 'qnio9m24e99vu6u.delivery.puppetlabs.net' exited with 2 running:\r\n cp /etc/fstab /tmp/fstab\r\nLast 10 lines of output were:\r\n\tcp: cannot access /etc/fstab>\r\n  Test Case tests/resource/mount/mounted.rb reported: #<Beaker::Host::CommandFailure: Host 'qnio9m24e99vu6u.delivery.puppetlabs.net' exited with 2 running:\r\n cp /etc/fstab /tmp/fstab\r\nLast 10 lines of output were:\r\n\tcp: cannot access /etc/fstab>\r\n  Test Case tests/resource/mount/query.rb reported: #<Beaker::Host::CommandFailure: Host 'qnio9m24e99vu6u.delivery.puppetlabs.net' exited with 2 running:\r\n cp /etc/fstab /tmp/fstab\r\nLast 10 lines of output were:\r\n\tcp: cannot access /etc/fstab>\r\nSkipped Tests Cases:\r\n  Test Case tests/ticket_15560_managehome.rb skip\r\n  Test Case tests/aix/aix_package_provider.rb skip\r\n  Test Case tests/aix/nim_package_provider.rb skip\r\n  Test Case tests/config/puppet_manages_own_configuration_in_robust_manner.rb skip\r\n  Test Case tests/external_ca_support/apache_external_root_ca.rb skip\r\n  Test Case tests/windows/eventlog.rb skip\r\n  Test Case tests/modules/changes/module_with_modified_file.rb skip\r\n  Test Case tests/modules/changes/module_with_removed_file.rb skip\r\n  Test Case tests/modules/changes/unmodified_module.rb skip\r\n  Test Case tests/modules/install/already_installed.rb skip\r\n  Test Case tests/modules/install/already_installed_elsewhere.rb skip\r\n  Test Case tests/modules/install/already_installed_with_local_changes.rb skip\r\n  Test Case tests/modules/install/basic_install.rb skip\r\n  Test Case tests/modules/install/force_ignores_dependencies.rb skip\r\n  Test Case tests/modules/install/ignoring_dependencies.rb skip\r\n  Test Case tests/modules/install/nonexistent_directory.rb skip\r\n  Test Case tests/modules/install/nonexistent_module.rb skip\r\n  Test Case tests/modules/install/with_debug.rb skip\r\n  Test Case tests/modules/install/with_dependencies.rb skip\r\n  Test Case tests/modules/install/with_environment.rb skip\r\n  Test Case tests/modules/install/with_existing_module_directory.rb skip\r\n  Test Case tests/modules/install/with_modulepath.rb skip\r\n  Test Case tests/modules/install/with_necessary_upgrade.rb skip\r\n  Test Case tests/modules/install/with_no_dependencies.rb skip\r\n  Test Case tests/modules/install/with_unnecessary_upgrade.rb skip\r\n  Test Case tests/modules/install/with_unsatisfied_constraints.rb skip\r\n  Test Case tests/modules/install/with_version.rb skip\r\n  Test Case tests/modules/list/with_environment.rb skip\r\n  Test Case tests/modules/search/formatting.rb skip\r\n  Test Case tests/modules/search/no_results.rb skip\r\n  Test Case tests/modules/uninstall/with_multiple_modules_installed.rb skip\r\n  Test Case tests/modules/upgrade/in_a_secondary_directory.rb skip\r\n  Test Case tests/modules/upgrade/introducing_new_dependencies.rb skip\r\n  Test Case tests/modules/upgrade/not_upgradable.rb skip\r\n  Test Case tests/modules/upgrade/that_was_installed_twice.rb skip\r\n  Test Case tests/modules/upgrade/to_a_specific_version.rb skip\r\n  Test Case tests/modules/upgrade/to_installed_version.rb skip\r\n  Test Case tests/modules/upgrade/with_constraints_on_it.rb skip\r\n  Test Case tests/modules/upgrade/with_constraints_on_its_dependencies.rb skip\r\n  Test Case tests/modules/upgrade/with_environment.rb skip\r\n  Test Case tests/modules/upgrade/with_local_changes.rb skip\r\n  Test Case tests/modules/upgrade/with_scattered_dependencies.rb skip\r\n  Test Case tests/modules/upgrade/with_update_available.rb skip\r\n  Test Case tests/resource/file/should_create_symlink.rb skip\r\n  Test Case tests/resource/file/ticket_7680-follow-symlinks.rb skip\r\n  Test Case tests/resource/package/common_package_name_in_different_providers.rb skip\r\n  Test Case tests/resource/package/does_not_exist.rb skip\r\n  Test Case tests/resource/package/yum.rb skip\r\n  Test Case tests/resource/scheduled_task/should_create.rb skip\r\n  Test Case tests/resource/scheduled_task/should_destroy.rb skip\r\n  Test Case tests/resource/scheduled_task/should_modify.rb skip\r\n  Test Case tests/resource/scheduled_task/should_query.rb skip\r\n  Test Case tests/resource/service/AIX_service_provider.rb skip\r\n  Test Case tests/resource/service/launchd_provider.rb skip\r\n  Test Case tests/resource/service/ticket_1343_should_add_and_remove_symlinks.rb skip\r\n  Test Case tests/resource/service/ticket_14297_handle_upstart.rb skip\r\n  Test Case tests/resource/service/ticket_4123_should_list_all_running_redhat.rb skip\r\n  Test Case tests/resource/service/ticket_4124_should_list_all_disabled.rb skip\r\n  Test Case tests/resource/ssh_authorized_key/query.rb skip\r\n  Test Case tests/resource/zone/ticket_4840_should_create_zone_with_zpool.rb skip\r\n  Test Case tests/resource/package/ips/basic_tests.rb skip\r\n  Test Case tests/resource/package/ips/should_be_holdable.rb skip\r\n  Test Case tests/resource/package/ips/should_be_idempotent.rb skip\r\n  Test Case tests/resource/package/ips/should_be_updatable.rb skip\r\n  Test Case tests/resource/package/ips/should_be_versionable.rb skip\r\n  Test Case tests/resource/package/ips/should_create.rb skip\r\n  Test Case tests/resource/package/ips/should_query.rb skip\r\n  Test Case tests/resource/package/ips/should_remove.rb skip\r\nPending Tests Cases:\r\n  Test Case tests/resource/user/should_modify_when_not_managing_home.rb pending\r\n  Test Case tests/resource/user/should_modify_while_managing_home.rb pending\r\n\r\n\r\nFailed: errored in TestSuite: report_and_raise_on_failure\r\n#<RuntimeError: Failed while running the tests suite>\r\nNo tests to run for suite 'post_suite'\r\n\r\nYou can reproduce this run with:\r\n/Users/michaelsmith/puppetlabs/puppet/acceptance/.bundle/gems/ruby/2.1.0/bin/beaker --options-file merged_options.rb --hosts=config/nodes/solaris-10-x86_64\r\n\r\nYou can re-run commands against the already provisioned SUT(s) with:\r\n/Users/michaelsmith/puppetlabs/puppet/acceptance/.bundle/gems/ruby/2.1.0/bin/beaker --options-file merged_options.rb --hosts=config/nodes/solaris-10-x86_64\r\n\r\nImportant ENV variables that may have affected your run:\r\n    GEM_HOME\t\t/Users/michaelsmith/puppetlabs/puppet/acceptance/.bundle/gems/ruby/2.1.0\r\n    GEM_PATH\r\n    RUBYLIB\t\t/Users/michaelsmith/.rbenv/versions/2.1.5/lib/ruby/gems/2.1.0/gems/bundler-1.9.7/lib\r\n    PATH\t\t/Users/michaelsmith/puppetlabs/puppet/acceptance/.bundle/gems/ruby/2.1.0/bin:/Users/michaelsmith/.rbenv/versions/2.1.5/bin:/usr/local/Cellar/rbenv/0.4.0/libexec:/Users/michaelsmith/Documents/google-cloud-sdk/bin:/Users/michaelsmith/.rbenv/shims:/usr/local/bin:/usr/local/sbin:/usr/bin:/bin:/usr/sbin:/sbin:/opt/X11/bin:/usr/local/MacGPG2/bin\r\n    home\t\t/Users/michaelsmith\r\nFailed running the test suite.\r\n{code}","closed_at":"2015-09-14T13:50:40.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5191","labels":"","state":"Closed","updated_at":"2015-09-14T13:50:40.000-0700","timestamp":1652284935.221925,"priority":"Normal","status_category":"Done","pull_request":4219},{"issue_id":"75820","title":"Spec tests on Windows expect environment setup","url":"https://tickets.puppetlabs.com/browse/PUP-4404","created_at":"2015-04-13T16:33:39.000-0700","number":"PUP-4404","body":"There's no requirement that Windows installations have an Administrator user, but the Puppet spec tests expect one to exist. Change the tests to use the current user.\r\n\r\nThis blocks using AppVeyor for CI, as those machines don't have Administrator users.","closed_at":"2015-09-15T13:27:26.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4404","labels":"","state":"Closed","updated_at":"2015-09-15T13:27:26.000-0700","timestamp":1652284935.641708,"priority":"Normal","status_category":"Done","pull_request":3813},{"issue_id":"84095","title":"launchd enable/disable on OS X 10.11","url":"https://tickets.puppetlabs.com/browse/PUP-4738","created_at":"2015-06-10T09:47:05.000-0700","number":"PUP-4738","body":"On OS X 10.11, the entire /System folder is write protected by the kernel.  \r\n\r\nThe launchd provider currently uses both the global overrides plist at /var/db/launchd.db/com.apple.launchd/overrides.plist as well as the Disabled key in the job plists.  This works fine for items in /Library/LaunchDaemons and /Library/LaunchAgents, but modifying the job plist is not possible for those in the /System folder.\r\n\r\nThis provider should be changed to either use only the global overrides plist or to not modify anything in the system folder.  ","closed_at":"2015-09-15T15:06:05.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4738","labels":"","state":"Closed","updated_at":"2015-09-15T15:06:05.000-0700","timestamp":1652284935.848806,"priority":"Major","status_category":"Done","pull_request":4164},{"issue_id":"87140","title":"Puppet caches parse results when environment_timeout is set to 0","url":"https://tickets.puppetlabs.com/browse/PUP-4810","created_at":"2015-07-01T17:43:00.000-0700","number":"PUP-4810","body":"When {{environment_timeout}} is set to {{0}}, caching of parsed manifests is essentially a no-op as any object put into the cache is immediately marked as expired. However, Puppet still builds a cache when the timeout is set to 0  which consumes memory. This memory usage can be significant, especially when classifier sync hits the {{resource_types/*}} endpoint on each environment.\r\n\r\nh2. Reproduction Case\r\n\r\n*  Install {{puppet-agent}} and {{puppetserver}}.\r\n*  Edit {{/opt/puppetlabs/puppet/puppet.conf}} and set {{environment_timeout}} to 0 in the {{master}} section.\r\n*  Edit {{/opt/puppetlabs/puppet/auth.conf}} and allow unrestricted access to the {{environments}} and {{resource_types}} endpoints:\r\n\r\n{code}\r\npath /puppet/v3/environments\r\nauth any\r\nmethod find\r\nallow *\r\n\r\npath /puppet/v3/resource_type\r\nauth any\r\nmethod search\r\nallow *\r\n{code}\r\n\r\n*  Create a large number of classes in the {{production}} environment, and then a large number of copies of that environment (the number created is a bit excessive since the classes are simple, but real-world environments have shown this behavior with only hundreds of classes):\r\n\r\n{code:bash}\r\nmkdir -p /etc/puppetlabs/code/environments/production/modules/test_classes/manifests\r\n\r\ncat <<EOF | /opt/puppetlabs/puppet/bin/erb > /etc/puppetlabs/code/environments/production/modules/test_classes/manifests/init.pp\r\n<% 100000.times do |i| %>\r\nclass test_class_<%= i %> () {}\r\n<% end %>\r\nEOF\r\n\r\nfor i in $(seq 100);do cp -r /etc/puppetlabs/code/environments/production /etc/puppetlabs/code/environments/test_${i}; done\r\n{code}\r\n\r\n*  Restart the puppetserver.\r\n*  Simulate classifier syncs using the following script:\r\n\r\n{code:bash}\r\n#!/bin/bash\r\n\r\nget_env_list() {\r\n  curl -s -k \\\r\n    https://localhost:8140/puppet/v3/environments |\\\r\n    /opt/puppetlabs/puppet/bin/ruby -rjson -e \\\r\n    'puts JSON.load($stdin.read())[\"environments\"].keys.sort'\r\n}\r\n\r\nget_env_classes() {\r\n  start_time=`date +%s`\r\n  curl -s -k \\\r\n    \"https://localhost:8140/puppet/v3/resource_types/*?environment=$1\" > /tmp/${1}_classes.json;\r\n  echo \"Sync time: $(expr `date +%s` - $start_time) seconds\";\r\n}\r\n\r\nget_all_classes() {\r\n  for env in $(get_env_list); do\r\n    echo \"Fectching classes for: $env\";\r\n    get_env_classes $env\r\n  done\r\n}\r\n\r\nwhile :; do get_all_classes; done\r\n{code}\r\n\r\nh3. Outcome\r\n\r\nDuring class sync, each class is persisted to the cache despite {{environment_timeout}} being set to zero. This causes the Puppet Server to run out of memory:\r\n\r\n!pup_42_unpatched.png|thumbnail!\r\n\r\nh3. Expected Outcome\r\n\r\nWhen `environment_timeout` is set to 0, no memory is wasted on caching classes.\r\n\r\nApplying a quick spike for this change:\r\n\r\n{code:diff}\r\ndiff --git a/puppet/environments.rb b/puppet/environments.rb\r\nindex fa5a028..0ac12b7 100644\r\n--- a/puppet/environments.rb\r\n+++ b/puppet/environments.rb\r\n@@ -304,7 +304,8 @@ module Puppet::Environments\r\n       if result = @cache[name]\r\n         return result.value\r\n       elsif (result = @loader.get(name))\r\n-        @cache[name] = entry(result)\r\n+        e = entry(result)\r\n+        @cache[name] = e unless e.is_a?(NotCachedEntry)\r\n         result\r\n       end\r\n     end\r\n{code}\r\n\r\nResults in the Puppet Server being able to sustain syncing a large number of classes:\r\n\r\n!pup_42_patched.png|thumbnail!","closed_at":"2015-09-22T09:36:46.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4810","labels":"customer;support","state":"Closed","updated_at":"2015-09-22T09:36:46.000-0700","timestamp":1652284938.284851,"priority":"Major","status_category":"Done","pull_request":4073},{"issue_id":"75451","title":"Regression: Webrick fails to start if the puppet user and group don't exist","url":"https://tickets.puppetlabs.com/browse/PUP-4394","created_at":"2015-04-09T16:40:13.000-0700","number":"PUP-4394","body":"If you install puppet-agent and try to start webrick, it will attempt to switch to the {{puppet}} user and group, and fail, because the puppet-agent package no longer creates these accounts.\r\n\r\n{noformat}\r\n[root@yvf37tnj11yfmn1 ~]# puppet master --verbose --no-daemonize\r\nWarning: could not change to group \"puppet\": Invalid group: puppet\r\ncould not change to group \"puppet\"\r\nCould not change to user puppet: Invalid user: puppet\r\n{noformat}\r\n\r\nThe desired behavior is that puppet's webrick code should not switch uid/gid to a non-existent account.\r\n\r\nTo work around the issue, specify the puppet {{user}} and {{group}} to accounts that are known to exist, either in {{puppet.conf}}, command line, etc:\r\n\r\n{noformat}\r\n[root@yvf37tnj11yfmn1 ~]# puppet master --verbose --no-daemonize --user root --group root\r\nNotice: Starting Puppet master version 4.0.0\r\n{noformat}\r\n\r\nThis was not discovered earlier because we have only been testing webrick on hosts where {{puppetserver}} is installed, and that package does create the {{puppet}} user and group.\r\n\r\nRisk Assessment: low (but already verified)\r\nProbability: low (webrick)\r\nImpact: low (obvious problem, existing warnings/errors)\r\nTest Layer: Unit/Integration","closed_at":"2015-10-05T21:53:12.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4394","labels":"","state":"Closed","updated_at":"2015-10-05T21:53:12.000-0700","timestamp":1652284942.215608,"priority":"Normal","status_category":"Done","pull_request":3850},{"issue_id":"89088","title":"Package resources no longer fail with bad names on EL5","url":"https://tickets.puppetlabs.com/browse/PUP-4865","created_at":"2015-07-14T16:49:07.000-0700","number":"PUP-4865","body":"Running with AIO on EL5 platforms \r\n\r\n{noformat}\r\npackage { 'clearly doenst exist':\r\n  name => 'doesnotexist',\r\n}\r\n{noformat}\r\n\r\nno longer returns an error in the puppet run. This is probably due to the fact that `yum install doesnotexist` returns 0 and the fact that yumhelper.py was removed.","closed_at":"2015-10-07T13:14:03.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4865","labels":"","state":"Closed","updated_at":"2015-10-07T13:14:03.000-0700","timestamp":1652284951.918547,"priority":"Normal","status_category":"Done","pull_request":4108},{"issue_id":"80964","title":"Manifest with future parser code fails in a non-production environment with environment.conf parser=future setting","url":"https://tickets.puppetlabs.com/browse/PUP-4636","created_at":"2015-05-20T10:40:38.000-0700","number":"PUP-4636","body":"Testing the following setup:\r\n\r\n* Puppet 3.8.0\r\n* puppet.conf\r\n** environmentpath=$confdir/environments\r\n* environments/production\r\n** no environment.conf\r\n* environments/testing/environment.conf\r\n** parser=future\r\n* environment/testing/manifests/site.pp\r\n\r\n{noformat}\r\nnotify { 'testing env': }\r\n$list = [1,2,3]\r\n$listb = $list.map |$i| {\r\n    $i + 1 \r\n}\r\nnotify { \"list: ${list}\": }\r\nnotify { \"listb: ${listb}\": }\r\n{noformat}\r\n\r\n`puppet agent -t` (against a webrick master serving those environments)\r\n\r\nis raising:\r\n\r\n{noformat}\r\nError: Evaluation Error: Error while evaluating a Method call, uninitialized constant Puppet::Pops::Loaders at /home/jpartlow/test/master/parser-settings/environments/testing/manifests/site.pp:3:15 on node\r\n percival.corp.puppetlabs.net\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/parser/compiler.rb:277:in `loaders'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/evaluator/runtime3_support.rb:234:in `call_function'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/evaluator/evaluator_impl.rb:833:in `call_function_with_block'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/evaluator/evaluator_impl.rb:825:in `eval_CallMethodExpression'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/visitor.rb:43:in `block in visit_this'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/visitor.rb:39:in `each'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/visitor.rb:39:in `visit_this'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/visitor.rb:66:in `visit_this_1'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/evaluator/evaluator_impl.rb:77:in `evaluate'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/evaluator/evaluator_impl.rb:299:in `eval_AssignmentExpression'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/visitor.rb:64:in `visit_this_1'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/evaluator/evaluator_impl.rb:77:in `evaluate'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/evaluator/evaluator_impl.rb:563:in `block in eval_BlockExpression'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/evaluator/evaluator_impl.rb:563:in `each'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/evaluator/evaluator_impl.rb:563:in `eval_BlockExpression'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/visitor.rb:43:in `block in visit_this'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/visitor.rb:39:in `each'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/visitor.rb:39:in `visit_this'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/visitor.rb:66:in `visit_this_1'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/evaluator/evaluator_impl.rb:77:in `evaluate'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/evaluator/evaluator_impl.rb:634:in `eval_Program'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/visitor.rb:43:in `block in visit_this'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/visitor.rb:39:in `each'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/visitor.rb:39:in `visit_this'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/visitor.rb:66:in `visit_this_1'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/evaluator/evaluator_impl.rb:77:in `evaluate'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/pops/parser/evaluating_parser.rb:57:in `evaluate'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/parser/ast/pops_bridge.rb:96:in `evaluate'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/parser/ast.rb:61:in `safeevaluate'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/parser/ast/block_expression.rb:11:in `block in evaluate'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/parser/ast/block_expression.rb:10:in `each'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/parser/ast/block_expression.rb:10:in `evaluate'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/parser/ast.rb:61:in `safeevaluate'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/resource/type.rb:127:in `evaluate_code'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/parser/resource.rb:79:in `evaluate'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/parser/compiler.rb:429:in `evaluate_main'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/parser/compiler.rb:135:in `block (2 levels) in compile'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/util/profiler.rb:51:in `profile'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/parser/compiler.rb:135:in `block (2 levels) in compile'                                                                                                [59/1875]\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/util/profiler.rb:51:in `profile'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/parser/compiler.rb:135:in `block in compile'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/context.rb:64:in `override'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet.rb:244:in `override'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/parser/compiler.rb:121:in `compile'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/parser/compiler.rb:34:in `compile'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/catalog/compiler.rb:95:in `block (2 levels) in compile'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/util/profiler.rb:51:in `profile'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/catalog/compiler.rb:93:in `block in compile'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/util.rb:161:in `block in benchmark'\r\n/home/jpartlow/.rbenv/versions/1.9.3-p484/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/util.rb:160:in `benchmark'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/catalog/compiler.rb:92:in `compile'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/catalog/compiler.rb:52:in `find'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/indirection.rb:201:in `find'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/network/http/api/v1.rb:105:in `do_find'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/network/http/api/v1.rb:50:in `block in call'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/context.rb:64:in `override'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet.rb:244:in `override'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/network/http/api/v1.rb:49:in `call'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/network/http/route.rb:82:in `block in process'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/network/http/route.rb:81:in `each'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/network/http/route.rb:81:in `process'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/network/http/handler.rb:63:in `block in process'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/util/profiler.rb:51:in `profile'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/network/http/handler.rb:61:in `process'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/network/http/webrick/rest.rb:37:in `block in service'\r\n<internal:prelude>:10:in `synchronize'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/network/http/webrick/rest.rb:36:in `service'\r\n/home/jpartlow/.rbenv/versions/1.9.3-p484/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'\r\n/home/jpartlow/.rbenv/versions/1.9.3-p484/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'\r\n/home/jpartlow/work/src/pl/puppet/lib/puppet/network/http/webrick.rb:33:in `block (2 levels) in listen'\r\n/home/jpartlow/.rbenv/versions/1.9.3-p484/lib/ruby/1.9.1/webrick/server.rb:191:in `call'\r\n/home/jpartlow/.rbenv/versions/1.9.3-p484/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'\r\n{noformat}\r\n\r\nh3. UPDATE\r\nA workaround is to set the default environment to use future parser, and then in each environment that should not use future parser, set {{parser==current}}. While this is painful until this is released it is the only way to use parser setting per environment in puppet 3.8.0.\r\n","closed_at":"2015-10-28T18:08:13.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4636","labels":"DSL;Server","state":"Closed","updated_at":"2015-10-28T18:08:13.000-0700","timestamp":1652284955.431747,"priority":"Major","status_category":"Done","pull_request":3958},{"issue_id":"99077","title":"Puppet cert generate leaves ca_key as 644 on first run","url":"https://tickets.puppetlabs.com/browse/PUP-5274","created_at":"2015-09-22T15:17:02.000-0700","number":"PUP-5274","body":"On the first run of `puppet cert generate`, if a ca is not already set up, puppet will generate a ca_key, but will leave it as world readable, which isn't good. Subsequent puppet cert calls will manage the permissions of the file correctly as 640, but the key will be world readable for an indeterminate amount of time. You can see it in action below:\r\n\r\n{code}\r\nroot@klga76ahkykjzad:~# rm -rf /etc/puppetlabs/puppet/ssl/\r\nroot@klga76ahkykjzad:~# /opt/puppetlabs/bin/puppet cert generate foo\r\nNotice: Signed certificate request for ca\r\nls -la /etc/puppetlabs/puppet/ssl/caNotice: foo has a waiting certificate request\r\nNotice: Signed certificate request for foo\r\nNotice: Removing file Puppet::SSL::CertificateRequest foo at '/etc/puppetlabs/puppet/ssl/ca/requests/foo.pem'\r\nNotice: Removing file Puppet::SSL::CertificateRequest foo at '/etc/puppetlabs/puppet/ssl/certificate_requests/foo.pem'\r\nroot@klga76ahkykjzad:~# ls -la /etc/puppetlabs/puppet/ssl/ca/\r\ntotal 44\r\ndrwxr-xr-x 5 root root 4096 Sep 22 15:14 .\r\ndrwxrwx--x 8 root root 4096 Sep 22 15:14 ..\r\n-rw-r--r-- 1 root root  995 Sep 22 15:14 ca_crl.pem\r\n-rw-r--r-- 1 root root 2057 Sep 22 15:14 ca_crt.pem\r\n-rw-r--r-- 1 root root 3247 Sep 22 15:14 ca_key.pem\r\n-rw-r--r-- 1 root root  800 Sep 22 15:14 ca_pub.pem\r\n-rw-r--r-- 1 root root  169 Sep 22 15:14 inventory.txt\r\ndrwxr-x--- 2 root root 4096 Sep 22 15:14 private\r\ndrwxr-xr-x 2 root root 4096 Sep 22 15:14 requests\r\n-rw-r--r-- 1 root root    4 Sep 22 15:14 serial\r\ndrwxr-xr-x 2 root root 4096 Sep 22 15:14 signed\r\nroot@klga76ahkykjzad:~# /opt/puppetlabs/bin/puppet cert help\r\nError: Invalid method help to apply\r\nroot@klga76ahkykjzad:~# ls -la /etc/puppetlabs/puppet/ssl/ca/\r\ntotal 44\r\ndrwxr-xr-x 5 root root 4096 Sep 22 15:14 .\r\ndrwxrwx--x 8 root root 4096 Sep 22 15:14 ..\r\n-rw-r--r-- 1 root root  995 Sep 22 15:14 ca_crl.pem\r\n-rw-r--r-- 1 root root 2057 Sep 22 15:14 ca_crt.pem\r\n-rw-r----- 1 root root 3247 Sep 22 15:14 ca_key.pem\r\n-rw-r--r-- 1 root root  800 Sep 22 15:14 ca_pub.pem\r\n-rw-r--r-- 1 root root  169 Sep 22 15:14 inventory.txt\r\ndrwxr-x--- 2 root root 4096 Sep 22 15:14 private\r\ndrwxr-xr-x 2 root root 4096 Sep 22 15:14 requests\r\n-rw-r--r-- 1 root root    4 Sep 22 15:14 serial\r\ndrwxr-xr-x 2 root root 4096 Sep 22 15:14 signed\r\n{code}","closed_at":"2015-10-29T16:51:11.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5274","labels":"product-security","state":"Closed","updated_at":"2015-10-29T16:51:11.000-0700","timestamp":1652284956.186784,"priority":"Normal","status_category":"Done","pull_request":4312},{"issue_id":"101230","title":"Puppet filter function does not behave consistently across all supported argument types.","url":"https://tickets.puppetlabs.com/browse/PUP-5350","created_at":"2015-10-09T15:18:41.000-0700","number":"PUP-5350","body":"The overload of the {{filter}} function that takes a {{Hash}} behaves differently from the other overloads that take an \"enumerable\" type.\r\n\r\nFor example:\r\n{code}\r\nnotice({a => 1, b => 2, c => 3}.filter |$k, $v| { $v })\r\n{code}\r\n\r\nWill output\r\n{code}\r\n{a => 1, b=> 2, c => 3}\r\n{code}\r\n\r\nHowever:\r\n{code}\r\nnotice([1, 2, 3].filter |$v| { $v })\r\n{code}\r\n\r\nWill output:\r\n{code}\r\n[]\r\n{code}\r\n\r\nThe first example returns an {{Integer}} and results in not filtering the element.  The second example also returns an {{Integer}}, but this results in filtering the element.\r\n\r\nOne of these behaviors is incorrect and should be made consistent.\r\n\r\nCause of bug:\r\n\r\nIn the {{filter}} function's implementation, the {{Hash}} overload uses {{hash#select}} and returns the result of yielding to the lambda, which Ruby treats as true if the value is _truthy_.  The enumerable overload instead has a direct comparison of the lambda's return value to {{true}}.","closed_at":"2015-10-29T16:51:11.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5350","labels":"","state":"Closed","updated_at":"2015-10-29T16:51:11.000-0700","timestamp":1652284956.29608,"priority":"Normal","status_category":"Done","pull_request":4339},{"issue_id":"99700","title":"Puppet::Error raised by an indirector save method is silent","url":"https://tickets.puppetlabs.com/browse/PUP-5290","created_at":"2015-09-29T02:43:03.000-0700","number":"PUP-5290","body":"When the PuppetDB raises a Puppet::Error during catalog save (for example here: https://github.com/puppetlabs/puppetdb/blob/3.1.1/puppet/lib/puppet/indirector/catalog/puppetdb.rb#L326) it is silently dropped by the apply application here: https://github.com/puppetlabs/puppet/blob/4.2.2/lib/puppet/application/apply.rb#L257-L260\r\n\r\nThis leads to a silent exit where no clue what the error is is given to the user.\r\n\r\nI think a decent solution would be to add an exception handler to the indirector caching that logs exceptions (and doesn't abort if they happen as caching failure shouldn't be critical). That would be here: https://github.com/puppetlabs/puppet/blob/4.2.2/lib/puppet/indirector/indirection.rb#L199","closed_at":"2015-10-29T16:51:12.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5290","labels":"","state":"Closed","updated_at":"2015-10-29T16:51:12.000-0700","timestamp":1652284956.40144,"priority":"Normal","status_category":"Done","pull_request":4303},{"issue_id":"100605","title":"password-disclosure-when-changing-a-users-password fails on AIX","url":"https://tickets.puppetlabs.com/browse/PUP-5310","created_at":"2015-10-05T07:00:59.000-0700","number":"PUP-5310","body":"Puppet acceptance test Case {{tests/ticket_6857_password-disclosure-when-changing-a-users-password.rb}} fails with the following:\r\n\r\n{code}\r\nTest Case tests/ticket_6857_password-disclosure-when-changing-a-users-password.rb reported: #<Minitest::Assertion: Expected /current_value \\[old password hash redacted\\], should be \\[new password hash redacted\\]/ to match \"pe-aix-53-acceptance: \\e[mNotice: Compiled catalog for pe-aix-53-acceptance.delivery.puppetlabs.net in environment production in 0.42 seconds\\e[0m\\n\\e[0;32mInfo: Applying configuration version '1443972467'\\e[0m\\n\\e[mNotice: /Stage[main]/Main/User[passwordtestuser]/ensure: current_value absent, should be present (noop)\\e[0m\\n\\e[mNotice: Class[Main]: Would have triggered 'refresh' from 1 events\\e[0m\\n\\e[mNotice: Stage[main]: Would have triggered 'refresh' from 1 events\\e[0m\\n\\e[mNotice: Applied catalog in 0.16 seconds\\e[0m\\n\".>\r\n{code}","closed_at":"2015-10-29T16:51:12.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5310","labels":"","state":"Closed","updated_at":"2015-10-29T16:51:12.000-0700","timestamp":1652284956.507058,"priority":"Normal","status_category":"Done","pull_request":4346},{"issue_id":"99030","title":"tests/resource/file/source_attribute.rb susceptible to timing failures","url":"https://tickets.puppetlabs.com/browse/PUP-5272","created_at":"2015-09-22T10:53:22.000-0700","number":"PUP-5272","body":"The `tests/resource/file/source_attribute.rb` has been shown to intermittently fail in CI due to the duration of execution of the test. If the validation step takes too long to execute, it will fail due to the mtime attribute changing.","closed_at":"2015-10-29T16:51:12.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5272","labels":"","state":"Closed","updated_at":"2015-10-29T16:51:12.000-0700","timestamp":1652284956.617454,"priority":"Normal","status_category":"Done","pull_request":4289},{"issue_id":"103407","title":"Yum package provider: ensure => latest fails when security packages are present","url":"https://tickets.puppetlabs.com/browse/PUP-5453","created_at":"2015-10-29T02:40:07.000-0700","number":"PUP-5453","body":"When the yum provider has packages marked as security, the yum provider fails to ensure => latest on a package. This is almost like https://tickets.puppetlabs.com/browse/PUP-4497 and this fix should be almost the same.\r\n\r\nOutput of `yum check-update` ends with:\r\n```\r\nSecurity: kernel-3.10.0-229.14.1.el7.x86_64 is an installed security update\r\nSecurity: kernel-3.10.0-229.4.2.el7.x86_64 is the currently running version\r\n```","closed_at":"2015-11-02T11:39:45.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5453","labels":"","state":"Closed","updated_at":"2015-11-02T11:39:45.000-0800","timestamp":1652284957.688025,"priority":"Normal","status_category":"Done","pull_request":4387},{"issue_id":"102126","title":"Fix regression that reintroduced file watching for directory environments","url":"https://tickets.puppetlabs.com/browse/PUP-5398","created_at":"2015-10-20T07:49:19.000-0700","number":"PUP-5398","body":"The fix for PUP-3389 introduced a regression that resulted in all manifests being watched for directory environments. This has the effect that directory environments will be evicted when the filetimeout triggers (default 15s). The settings \"infinite\" therefore does not have the intended effect. \r\n\r\nThis also causes performance issues since it means using very inefficient file watching that results in potentially millions of kernel calls to stat files.\r\n\r\n","closed_at":"2015-11-03T18:24:35.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5398","labels":"","state":"Closed","updated_at":"2015-11-03T18:24:35.000-0800","timestamp":1652284958.572616,"priority":"Major","status_category":"Done","pull_request":4364},{"issue_id":"91125","title":"filebucket fails when environment is specified","url":"https://tickets.puppetlabs.com/browse/PUP-4954","created_at":"2015-07-29T12:29:35.000-0700","number":"PUP-4954","body":"If the agent's `puppet.conf` specifies an environment, then filebucketing fails with an inscrutable error and the run is marked as failed in the Console.\r\n\r\n{code}\r\nroot@binford2k:~ # cat /etc/puppetlabs/puppet/puppet.conf\r\n# This file can be used to override the default puppet settings.\r\n# See the following links for more details on what settings are available:\r\n# - https://docs.puppetlabs.com/puppet/latest/reference/config_important_settings.html\r\n# - https://docs.puppetlabs.com/puppet/latest/reference/config_about_settings.html\r\n# - https://docs.puppetlabs.com/puppet/latest/reference/config_file_main.html\r\n# - https://docs.puppetlabs.com/references/latest/configuration.html\r\n[main]\r\nserver = master.puppetlabs.vm\r\nenvironment_timeout = 0\r\nenvironmentpath = /etc/puppetlabs/code/environments\r\n[agent]\r\ncertname = binford2k.puppetlabs.vm\r\nenvironment = binford2k\r\nroot@binford2k:~ # puppet agent -t\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for binford2k.puppetlabs.vm\r\nInfo: Applying configuration version '1438197631'\r\nNotice: Hello binford2k.puppetlabs.vm\r\nNotice: /Stage[main]/Main/Node[default]/Notify[Hello binford2k.puppetlabs.vm]/message: defined 'message' as 'Hello binford2k.puppetlabs.vm'\r\nNotice: /Stage[main]/Userprefs::Bash/File[/root/.bashrc.puppet]/content:\r\n--- /root/.bashrc.puppet\t2015-07-29 19:20:26.719816423 +0000\r\n+++ /tmp/puppet-file20150729-52505-17roz3n\t2015-07-29 19:20:34.453201837 +0000\r\n@@ -1,5 +1,3 @@\r\n-#boogers\r\n-\r\n # NOTE: This file is managed by Puppet; any changes you make will be erased.\r\n\r\n parse_git_branch ()\r\n\r\nInfo: Computing checksum on file /root/.bashrc.puppet\r\nError: Could not back up /root/.bashrc.puppet: Could not find a directory environment named 'binford2k' anywhere in the path: /etc/puppetlabs/code/environments. Does the directory exist?\r\nError: Could not back up /root/.bashrc.puppet: Could not find a directory environment named 'binford2k' anywhere in the path: /etc/puppetlabs/code/environments. Does the directory exist?\r\nError: /Stage[main]/Userprefs::Bash/File[/root/.bashrc.puppet]/content: change from {md5}1df06bcfcafd1511cccea89849c37102 to {md5}c81901d08fb7e2c27fff6ca1e450e99e failed: Could not back up /root/.bashrc.puppet: Could not find a directory environment named 'binford2k' anywhere in the path: /etc/puppetlabs/code/environments. Does the directory exist?\r\nInfo: Stage[main]: Unscheduling all events on Stage[main]\r\nNotice: Applied catalog in 1.35 seconds\r\n{code}\r\n\r\nThe environment exists and *the file does not get updated*.","closed_at":"2015-11-06T13:30:26.000-0800","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4954","labels":"","state":"Closed","updated_at":"2015-11-06T13:30:26.000-0800","timestamp":1652284959.434343,"priority":"Major","status_category":"Done","pull_request":4355},{"issue_id":"74954","title":"Windows Group resource reports errors incorrectly when specifying an invalid group member","url":"https://tickets.puppetlabs.com/browse/PUP-4386","created_at":"2015-04-07T15:13:42.000-0700","number":"PUP-4386","body":"Because of the bug described in PUP-1542, extraneous messages may be output from Puppet when error message generation for an event fails in the resource harness sync_if_needed method.\r\n\r\nThere are 2 issues specifically in the Windows group code:\r\n\r\n* {{members_to_s}} expects a string, but is passed an array when trying to create the message, which is an easily correctable issue\r\n* {{members_to_s}} tries to resolve bad usernames to sid objects, then tries to access the {{account}} member of {{nil}} sid object\r\n\r\nInitially spiked a solution for both of these issues in: https://github.com/Iristyle/puppet/commit/a6393b07772146101ae1894381e96cea25f05ed2\r\n\r\nSimple repo example.  Assume that the current system has:\r\n\r\n{code}\r\nbundle exec puppet resource group guests\r\n\r\ngroup { 'guests':\r\n  ensure  => 'present',\r\n  gid     => 'S-1-5-32-546',\r\n  members => ['Guest', 'Administrator'],\r\n}\r\n{code}\r\n\r\nTrying to apply the following manifest with a bad user:\r\n\r\n{code}\r\ngroup { 'guests':\r\n  ensure => present,\r\n  members => ['Guest', 'Administrator', ''],\r\n}\r\n\r\n# generates\r\n\r\nNotice: Compiled catalog for vagrant-2008r2.corp.puppetlabs.net in environment production in 0.22 seconds Error: Could not resolve username:\r\nError: /Group[Guests]: Could not evaluate: Puppet::Util::Log requires a message\r\nNotice: Finished catalog run in 0.05 seconds\r\n{code}\r\n\r\n\r\nThis spiked change does not lose error detail, nor trigger an extraneous /\r\nmisleading message:\r\n\r\n{code}\r\nNotice: Compiled catalog for vagrant-2008r2.corp.puppetlabs.net in environment production in 0.22 seconds Error: Could not resolve username:\r\nError: /Stage[main]/Main/Group[Guests]/members: change from VAGRANT-2008R2\\Guest,VAGRANT-2008R2\\Administrator to [\"Guest\", \"Administrator\", \"\"] failed: Could not resolve username:\r\nNotice: Finished catalog run in 0.05 seconds\r\n{code}","closed_at":"2015-11-11T19:39:17.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4386","labels":"windows","state":"Closed","updated_at":"2015-11-11T19:39:17.000-0800","timestamp":1652284959.655915,"priority":"Normal","status_category":"Done","pull_request":4010},{"issue_id":"25948","title":"Add mount provider for AIX","url":"https://tickets.puppetlabs.com/browse/PUP-1628","created_at":"2014-02-10T06:09:33.000-0800","number":"PUP-1628","body":"Puppet does not provides a correct provider for the mount type on AIX.\r\n\r\nA new provider must be created.\r\n\r\nMountpoints in AIX are managed by the commands: crfs, lsfs, rmfs, chfs (http://publib.boulder.ibm.com/infocenter/aix/v6r1/index.jsp?topic=/com.ibm.aix.cmds/doc/aixcmds1/crfs.htm). For nfs mountpoints the commands mknfsmnt, chnfsmnt, rmnfsmnt and chnfsmnt are provided, but they can partially be managed with former commands.\r\n\r\nThe commands update the file /etc/filesystems that has following syntax:\r\n\r\n    /usr:\r\n       dev             = /dev/hd2\r\n       vfs             = jfs2\r\n       log             = /dev/hd8\r\n       mount           = automatic\r\n       check           = false\r\n       type            = bootfs\r\n       vol             = /usr\r\n       free            = false\r\n\r\n    /var:\r\n       dev             = /dev/hd9var\r\n       vfs             = jfs2\r\n       log             = /dev/hd8\r\n       mount           = automatic\r\n       check           = false\r\n       type            = bootfs\r\n       vol             = /var\r\n       free            = false\r\n\r\n**IMPORTANT**: crfs (create) and rmfs (remove), if it is a local filesystem,  will create and format (using jfs/jfs2) the needed Logical Volume, or directly remove the Logical Volume losing data.   \r\n\r\nTwo approaches:\r\n 1. Use command line tools and operate as expected by AIX commands: Operate on the LV. In that case type should be extended with new parameters (Volume Group, LV name, size...)\r\n 2. Modify directly /etc/filesystems files, and manage the Logical Volumes using a LVM type (as in other OS)\r\n\r\n\r\nrisk: medium (manual validate)\r\nprobability: medium (aix)\r\nseverity: medium (can't manage aix mounts)\r\ntest layer (no acceptance setup for aix)\r\n","closed_at":"2015-11-12T11:35:38.000-0800","comments":16,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1628","labels":"aix;customer;redmine","state":"Closed","updated_at":"2015-11-12T11:35:38.000-0800","timestamp":1652284959.88008,"priority":"Normal","status_category":"Done","pull_request":3769},{"issue_id":"14438","title":"Windows agents don't run on non-EN US systems","url":"https://tickets.puppetlabs.com/browse/PUP-316","created_at":"2013-09-11T10:19:48.000-0700","number":"PUP-316","body":"This is an issue in win32-dir gem, which apparently is not fixed.","closed_at":"2015-11-12T11:35:39.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-316","labels":"windows","state":"Resolved","updated_at":"2015-11-12T11:35:39.000-0800","timestamp":1652284959.990482,"priority":"Normal","status_category":"Done","pull_request":6884},{"issue_id":"31031","title":"yumrepo resource completely broken with 3.5 release","url":"https://tickets.puppetlabs.com/browse/PUP-2163","created_at":"2014-04-04T10:30:13.000-0700","number":"PUP-2163","body":"1. Any attribute that can take 'absent' as a value, either complains about it being invalid or puts the actual text value 'absent' in to the produced repo file.\r\n\r\nhttp://docs.puppetlabs.com/references/latest/type.html#yumrepo\r\n\r\nfor example:\r\nexclude => absent\r\n\r\nends up looking like \r\nexclude=absent\r\n\r\nin the .repo file.\r\n\r\n2. yumrepo resource title should become the repo id, and the attribute name should become the name value in the .repo file. If you manage to produce a repo file by not specifying any attribute with absent you will be greeted by this error when running yum..\r\n\r\n{code}\r\nRepository 'local-base' is missing name in configuration, using id\r\nRepository 'local-centosplus' is missing name in configuration, using id\r\nRepository 'local-extras' is missing name in configuration, using id\r\nRepository 'local-updates' is missing name in configuration, using id\r\n{code}\r\n\r\n3. When using ensure => absent on an existing repository id of say 'base' for centos/rhel it removes the entire CentOS-Base.repo file which contains more than just the base repo. It should edit the repo in place.\r\n\r\n4. The name attribute becomes the repo filename, where as the title (repository id) attribute should really be used as the file name. Because usually repository name's are long winded and contain lots of spaces..\r\n\r\nAs it stands I'll have to rollback our puppet clients and servers to the previous release until this is fixed/sane.","closed_at":"2015-11-12T11:35:39.000-0800","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2163","labels":"yumrepo","state":"Closed","updated_at":"2015-11-12T11:35:39.000-0800","timestamp":1652284960.103065,"priority":"Blocker","status_category":"Done","pull_request":2520},{"issue_id":"69560","title":"Acceptance suite and install.rb use incorrect paths on Windows for codedir","url":"https://tickets.puppetlabs.com/browse/PUP-4050","created_at":"2015-02-26T12:06:23.000-0800","number":"PUP-4050","body":"According to https://github.com/puppetlabs/puppet-specifications/blob/master/file_paths.md#puppet-agent-windows, {{:codedir}} is at {{C:\\ProgramData\\PuppetLabs\\code}}. The install.rb in Puppet sets it to {{C:\\ProgramData\\PuppetLabs\\puppet\\code}}, which is incorrect.\r\n\r\nAdditionally, the existing YAML files being used for acceptance that feature these paths should be modified:\r\nhttps://github.com/puppetlabs/puppet/blob/master/acceptance/config/nodes/win2012r2-rubyx64.yaml\r\nhttps://github.com/puppetlabs/puppet/blob/master/acceptance/config/nodes/win2012r2-rubyx86.yaml","closed_at":"2015-11-13T10:45:02.000-0800","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4050","labels":"AIO","state":"Closed","updated_at":"2015-11-13T10:45:02.000-0800","timestamp":1652284960.320288,"priority":"Normal","status_category":"Done","pull_request":4008},{"issue_id":"100611","title":"Fix acceptance tests for AIX","url":"https://tickets.puppetlabs.com/browse/PUP-5315","created_at":"2015-10-05T07:25:24.000-0700","number":"PUP-5315","body":"The following 21 puppet acceptance tests error out as indicated below. Most of these errors are the result of shell commands that are incompatible AIX.\r\n\r\nList of tests\r\n{code}\r\ntests/allow_symlinks_as_config_directories.rb\r\ntests/ticket_9862_puppet_runs_without_service_user_or_group_present.rb\r\ntests/aix/nim_package_provider.rb\r\ntests/config/apply_file_metadata_specified_in_config.rb\r\ntests/environment/can_enumerate_environments.rb\r\ntests/security/cve-2013-1652_improper_query_params.rb\r\ntests/security/cve-2013-4761_resource_type.rb\r\ntests/modules/install/basic_install.rb\r\ntests/modules/install/with_version.rb\r\ntests/resource/file/symbolic_modes.rb\r\ntests/resource/group/should_not_create_existing.rb\r\ntests/resource/mount/defined.rb\r\ntests/resource/mount/destroy.rb\r\ntests/resource/mount/modify.rb\r\ntests/resource/mount/mounted.rb\r\ntests/resource/package/common_package_name_in_different_providers.rb\r\ntests/resource/package/yum.rb\r\ntests/resource/service/puppet_mcollective_service_management.rb\r\ntests/resource/user/should_create.rb\r\ntests/resource/user/should_modify_gid.rb\r\ntests/resource/user/should_not_create_existing.rb\r\n{code}\r\n\r\nError results\r\n{code}\r\nErrored Tests Cases:\r\n                Test Case tests/allow_symlinks_as_config_directories.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-53-acceptance' exited with 2 running:\r\n               [ $(readlink /tmp/puppet_conf-symlink.6430) = /tmp/puppet_conf-directory.29613 ]\r\n              Last 10 lines of output were:\r\n              \tbash: readlink: command not found\r\n              \tbash: line 0: [: =: unary operator expected>\r\n                Test Case tests/ticket_9862_puppet_runs_without_service_user_or_group_present.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-53-acceptance' exited with 127 running:\r\n               stat --format '%U:%G:%a' /tmp/ticket_9862_puppet_runs_without_service_user_or_group_present.2081/log\r\n              Last 10 lines of output were:\r\n              \tbash: stat: command not found>\r\n                Test Case tests/aix/nim_package_provider.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-53-acceptance' exited with 0 running:\r\n               puppet apply --detailed-exitcodes --verbose\r\n              Last 10 lines of output were:\r\n              \tNotice: Compiled catalog for pe-aix-53-acceptance.delivery.puppetlabs.net in environment production in 1.52 seconds\r\n              \tInfo: Applying configuration version '1443972955'\r\n              \tNotice: Applied catalog in 0.17 seconds>\r\n                Test Case tests/config/apply_file_metadata_specified_in_config.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-53-acceptance' exited with 127 running:\r\n               stat --format '%U:%G:%a' /tmp/apply_file_metadata_specified_in_config.2046/log\r\n              Last 10 lines of output were:\r\n              \tbash: stat: command not found>\r\n                Test Case tests/environment/can_enumerate_environments.rb reported: #<RuntimeError: PuppetAcceptance::DSL::Helpers.with_puppet_running_on failed (check backtrace for location) because: Host 'pe-aix-53-acceptance' exited with 2 running:\r\n               curl --tlsv1 -ksv https://oxgwrmrqdurja2p.delivery.puppetlabs.net:8140/puppet/v3/environments\r\n              Last 10 lines of output were:\r\n              \tcurl: option -ksv is unknown\r\n              \tcurl: try 'curl --help' for more information\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/host.rb:309:in `exec'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/dsl/helpers/host_helpers.rb:73:in `block in on'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/shared/host_manager.rb:105:in `run_block_on'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/dsl/patterns.rb:32:in `block_on'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/dsl/helpers/host_helpers.rb:63:in `on'\r\n              tests/environment/can_enumerate_environments.rb:59:in `block (4 levels) in run_test'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/dsl/structure.rb:43:in `step'\r\n              tests/environment/can_enumerate_environments.rb:58:in `block (3 levels) in run_test'\r\n              tests/environment/can_enumerate_environments.rb:57:in `each'\r\n              tests/environment/can_enumerate_environments.rb:57:in `block (2 levels) in run_test'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/dsl/helpers/puppet_helpers.rb:171:in `with_puppet_running_on'\r\n              tests/environment/can_enumerate_environments.rb:56:in `block in run_test'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/test_case.rb:128:in `eval'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/test_case.rb:128:in `block in run_test'\r\n              /usr/local/rvm/rubies/ruby-1.9.3-p484/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/test_case.rb:125:in `run_test'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/test_suite.rb:311:in `block in run'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/test_suite.rb:308:in `each'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/test_suite.rb:308:in `run'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/test_suite.rb:357:in `run_and_raise_on_failure'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/cli.rb:155:in `run_suite'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/cli.rb:97:in `execute!'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/bin/beaker:6:in `<top (required)>'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/bin/beaker:23:in `load'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/bin/beaker:23:in `<main>'\r\n              >\r\n                Test Case tests/security/cve-2013-1652_improper_query_params.rb reported: #<RuntimeError: PuppetAcceptance::DSL::Helpers.with_puppet_running_on failed (check backtrace for location) because: Host 'pe-aix-53-acceptance' exited with 2 running:\r\n               curl --tlsv1 -g --cert \"/etc/puppetlabs/puppet/ssl/certs/pe-aix-53-acceptance.delivery.puppetlabs.net.pem\" --key \"/etc/puppetlabs/puppet/ssl/private_keys/pe-aix-53-acceptance.delivery.puppetlabs.net.pem\" -k -H 'Accept: pson' 'https://oxgwrmrqdurja2p.delivery.puppetlabs.net:8140/puppet/v3/catalog/pe-aix-53-acceptance.delivery.puppetlabs.net?environment=production&use_node=---%20!ruby/object:Puppet::Node%0A%20%20name:%20oxgwrmrqdurja2p.delivery.puppetlabs.net%0A%20%20classes:%20[]%0A%20%20parameters:%20%7B%7D%0A%20%20facts:%20%7B%7D'\r\n              Last 10 lines of output were:\r\n              \tcurl: option -k is unknown\r\n              \tcurl: try 'curl --help' for more information\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/host.rb:309:in `exec'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/dsl/helpers/host_helpers.rb:73:in `block in on'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/shared/host_manager.rb:105:in `run_block_on'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/dsl/patterns.rb:32:in `block_on'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/dsl/helpers/host_helpers.rb:63:in `on'\r\n              tests/security/cve-2013-1652_improper_query_params.rb:29:in `block (5 levels) in run_test'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/dsl/structure.rb:43:in `step'\r\n              tests/security/cve-2013-1652_improper_query_params.rb:28:in `block (4 levels) in run_test'\r\n              tests/security/cve-2013-1652_improper_query_params.rb:11:in `each'\r\n              tests/security/cve-2013-1652_improper_query_params.rb:11:in `block (3 levels) in run_test'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/dsl/helpers/puppet_helpers.rb:171:in `with_puppet_running_on'\r\n              tests/security/cve-2013-1652_improper_query_params.rb:7:in `block (2 levels) in run_test'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/dsl/structure.rb:58:in `test_name'\r\n             tests/security/cve-2013-1652_improper_query_params.rb:3:in `block in run_test'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/test_case.rb:128:in `eval'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/test_case.rb:128:in `block in run_test'\r\n              /usr/local/rvm/rubies/ruby-1.9.3-p484/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/test_case.rb:125:in `run_test'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/test_suite.rb:311:in `block in run'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/test_suite.rb:308:in `each'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/test_suite.rb:308:in `run'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/test_suite.rb:357:in `run_and_raise_on_failure'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/cli.rb:155:in `run_suite'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/cli.rb:97:in `execute!'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/bin/beaker:6:in `<top (required)>'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/bin/beaker:23:in `load'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/bin/beaker:23:in `<main>'\r\n              >\r\n                Test Case tests/security/cve-2013-4761_resource_type.rb reported: #<RuntimeError: PuppetAcceptance::DSL::Helpers.with_puppet_running_on failed (check backtrace for location) because: Host 'pe-aix-53-acceptance' exited with 2 running:\r\n               curl --tlsv1 -g --cert \"/etc/puppetlabs/puppet/ssl/certs/pe-aix-53-acceptance.delivery.puppetlabs.net.pem\" --key \"/etc/puppetlabs/puppet/ssl/private_keys/pe-aix-53-acceptance.delivery.puppetlabs.net.pem\" -k -H 'Accept: pson' 'https://oxgwrmrqdurja2p.delivery.puppetlabs.net:8140/puppet/v3/resource_type/::..::..::..::..::..::tmp::exploit?environment=production'\r\n              Last 10 lines of output were:\r\n              \tcurl: option -k is unknown\r\n              \tcurl: try 'curl --help' for more information\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/host.rb:309:in `exec'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/dsl/helpers/host_helpers.rb:73:in `block in on'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/shared/host_manager.rb:105:in `run_block_on'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/dsl/patterns.rb:32:in `block_on'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/dsl/helpers/host_helpers.rb:63:in `on'\r\n              tests/security/cve-2013-4761_resource_type.rb:51:in `block (5 levels) in run_test'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/dsl/structure.rb:43:in `step'\r\n              tests/security/cve-2013-4761_resource_type.rb:44:in `block (4 levels) in run_test'\r\n              tests/security/cve-2013-4761_resource_type.rb:37:in `each'\r\n              tests/security/cve-2013-4761_resource_type.rb:37:in `block (3 levels) in run_test'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/dsl/helpers/puppet_helpers.rb:171:in `with_puppet_running_on'\r\n              tests/security/cve-2013-4761_resource_type.rb:33:in `block (2 levels) in run_test'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/dsl/structure.rb:58:in `test_name'\r\n              tests/security/cve-2013-4761_resource_type.rb:10:in `block in run_test'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/test_case.rb:128:in `eval'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/test_case.rb:128:in `block in run_test'\r\n              /usr/local/rvm/rubies/ruby-1.9.3-p484/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/test_case.rb:125:in `run_test'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/test_suite.rb:311:in `block in run'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/test_suite.rb:308:in `each'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/test_suite.rb:308:in `run'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/test_suite.rb:357:in `run_and_raise_on_failure'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/cli.rb:155:in `run_suite'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/lib/beaker/cli.rb:97:in `execute!'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-2.25.0/bin/beaker:6:in `<top (required)>'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/bin/beaker:23:in `load'\r\n              /var/lib/jenkins/workspace/platform_aio-suite_intn-sys_adhoc-puppet/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/bin/beaker:23:in `<main>'\r\n              >\r\n                Test Case tests/modules/install/basic_install.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-53-acceptance' exited with 1 running:\r\n               puppet module install pmtacceptance-nginx\r\n              Last 10 lines of output were:\r\n              \tNotice: Preparing to install into /etc/puppetlabs/code/environments/production/modules ...\r\n              \tNotice: Downloading from https://forgeapi.puppetlabs.com ...\r\n              \tError: Could not connect via HTTPS to https://forgeapi.puppetlabs.com\r\n              \t  Unable to verify the SSL certificate\r\n              \t    The certificate may not be signed by a valid CA\r\n              \t    The CA bundle included with OpenSSL may not be valid or up to date>\r\n                Test Case tests/modules/install/with_version.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-53-acceptance' exited with 1 running:\r\n               puppet module install --version '< 1.7.0' pmtacceptance-java\r\n              Last 10 lines of output were:\r\n              \tNotice: Preparing to install into /etc/puppetlabs/code/environments/production/modules ...\r\n              \tNotice: Downloading from https://forgeapi.puppetlabs.com ...\r\n              \tError: Could not connect via HTTPS to https://forgeapi.puppetlabs.com\r\n              \t  Unable to verify the SSL certificate\r\n              \t    The certificate may not be signed by a valid CA\r\n              \t    The CA bundle included with OpenSSL may not be valid or up to date>\r\n                Test Case tests/resource/file/symbolic_modes.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-53-acceptance' exited with 127 running:\r\n               stat --format '%U:%G:%a' /tmp/symbolic-modes.19205/file\r\n              Last 10 lines of output were:\r\n              \tbash: stat: command not found>\r\n                Test Case tests/resource/group/should_not_create_existing.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-53-acceptance' exited with 86 running:\r\n               if ! lsgroup test-group-1443979156; then mkgroup test-group-1443979156; fi\r\n              Last 10 lines of output were:\r\n              \t3004-686 Group \"test-group-1443979156\" does not exist.\r\n              \t3004-694 Error adding \"test-group-1443979156\" : Name is too long.>\r\n                Test Case tests/resource/mount/defined.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-53-acceptance' exited with 2 running:\r\n               cat /etc/fstab\r\n              Last 10 lines of output were:\r\n              \tcat: 0652-050 Cannot open /etc/fstab.>\r\n                Test Case tests/resource/mount/destroy.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-53-acceptance' exited with 1 running:\r\n               yes | mkfs -t ext3 -q /tmp/pl559317\r\n              Last 10 lines of output were:\r\n              \tmkfs: Not a recognized flag: t\r\n              \tUsage: mkfs [-b BootProgram] [-i Inodes] [-l Label] [-o Options] [-p Prototype]\r\n              \t\t[-s Size] [-v VolumeLabel] [-V vfs] {Device|Filesystem}>\r\n                Test Case tests/resource/mount/modify.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-53-acceptance' exited with 1 running:\r\n               yes | mkfs -t ext3 -q /tmp/pl103746\r\n              Last 10 lines of output were:\r\n              \tmkfs: Not a recognized flag: t\r\n              \tUsage: mkfs [-b BootProgram] [-i Inodes] [-l Label] [-o Options] [-p Prototype]\r\n              \t\t[-s Size] [-v VolumeLabel] [-V vfs] {Device|Filesystem}>\r\n                Test Case tests/resource/mount/mounted.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-53-acceptance' exited with 1 running:\r\n               yes | mkfs -t ext3 -q /tmp/pl598605\r\n              Last 10 lines of output were:\r\n              \tmkfs: Not a recognized flag: t\r\n              \tUsage: mkfs [-b BootProgram] [-i Inodes] [-l Label] [-o Options] [-p Prototype]\r\n              \t\t[-s Size] [-v VolumeLabel] [-V vfs] {Device|Filesystem}>\r\n                Test Case tests/resource/package/common_package_name_in_different_providers.rb reported: #<NoMethodError: undefined method `each' for nil:NilClass>\r\n                Test Case tests/resource/package/yum.rb reported: #<NoMethodError: undefined method `each' for nil:NilClass>\r\n                Test Case tests/resource/service/puppet_mcollective_service_management.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-53-acceptance' exited with 4 running:\r\n               puppet apply --detailed-exitcodes --verbose\r\n              Last 10 lines of output were:\r\n              \tNotice: Compiled catalog for pe-aix-53-acceptance.delivery.puppetlabs.net in environment production in 0.71 seconds\r\n              \tInfo: Applying configuration version '1443979394'\r\n              \tError: Could not stop Service[puppet]: Execution of '/usr/bin/stopsrc -s puppet' returned 1: 0513-056 Timeout waiting for command response. If you specified a foreign host,\r\n              \tsee the /etc/inittab file on the foreign host to verify that the SRC daemon\r\n              \t(srcmstr) was started with the -r flag to accept remote requests.\r\n              \tError: /Stage[main]/Main/Service[puppet]/ensure: change from running to stopped failed: Could not stop Service[puppet]: Execution of '/usr/bin/stopsrc -s puppet' returned 1: 0513-056 Timeout waiting for command response. If you specified a foreign host,\r\n              \tsee the /etc/inittab file on the foreign host to verify that the SRC daemon\r\n              \t(srcmstr) was started with the -r flag to accept remote requests.\r\n              \tNotice: Applied catalog in 60.35 seconds>\r\n                Test Case tests/resource/user/should_create.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-53-acceptance' exited with 2 running:\r\n               lsgroup pl637994\r\n              Last 10 lines of output were:\r\n              \t3004-686 Group \"pl637994\" does not exist.>\r\n                Test Case tests/resource/user/should_modify_gid.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-53-acceptance' exited with 2 running:\r\n               lsgroup -a id pl72781old\r\n              Last 10 lines of output were:\r\n              \t3004-686 Group \"pl72781old\" does not exist.>\r\n                Test Case tests/resource/user/should_not_create_existing.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-53-acceptance' exited with 86 running:\r\n               if ! lsuser user305768; then mkuser user305768; fi\r\n              Last 10 lines of output were:\r\n              \t3004-687 User \"user305768\" does not exist.\r\n              \t3004-694 Error adding \"user305768\" : Name is too long.>\r\n{code}","closed_at":"2015-11-16T09:10:01.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5315","labels":"","state":"Closed","updated_at":"2015-11-16T09:10:01.000-0800","timestamp":1652284960.429535,"priority":"Normal","status_category":"Done","pull_request":4328},{"issue_id":"100608","title":"user resource should_create_with_gid test fails on AIX","url":"https://tickets.puppetlabs.com/browse/PUP-5313","created_at":"2015-10-05T07:06:51.000-0700","number":"PUP-5313","body":"Puppet acceptance test Case {{tests/resource/user/should_create_with_gid.rb}} fails with the following:\r\n\r\n{code}\r\nTest Case tests/resource/user/should_create_with_gid.rb reported: #<Beaker::DSL::Outcomes::FailTest: \r\n              expected gid 208 but got: \r\n{code}","closed_at":"2015-11-16T09:10:32.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5313","labels":"","state":"Closed","updated_at":"2015-11-16T09:10:32.000-0800","timestamp":1652284960.537465,"priority":"Normal","status_category":"Done","pull_request":4348},{"issue_id":"100607","title":"concurrent_catalog_requests test fails on AIX","url":"https://tickets.puppetlabs.com/browse/PUP-5312","created_at":"2015-10-05T07:04:44.000-0700","number":"PUP-5312","body":"Puppet acceptance test Case {{tests/concurrency/ticket_2659_concurrent_catalog_requests.rb}} fails with the following:\r\n{code}\r\nTest Case tests/concurrency/ticket_2659_concurrent_catalog_requests.rb reported: #<Beaker::DSL::Outcomes::FailTest: \r\n              Expected /< HTTP\\/1.* 200/ to match \"sleep: 0509-020 Specify time as a positive integer.\\nCurling: https://oxgwrmrqdurja2p.delivery.puppetlabs.net:8140/puppet/v3/catalog/pe-aix-53-acceptance.delivery.puppetlabs.net?environment=production\\ncurl: A file or directory in the path name does not exist.\\n848050 Completed\\n\".\r\n{code}","closed_at":"2015-11-16T09:10:43.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5312","labels":"","state":"Closed","updated_at":"2015-11-16T09:10:43.000-0800","timestamp":1652284960.911115,"priority":"Normal","status_category":"Done","pull_request":4347},{"issue_id":"100610","title":"user should_manage_shell test fails on AIX","url":"https://tickets.puppetlabs.com/browse/PUP-5314","created_at":"2015-10-05T07:08:37.000-0700","number":"PUP-5314","body":"Puppet acceptance test case {{tests/resource/user/should_manage_shell.rb}} fails with the following\r\n{code}\r\nTest Case tests/resource/user/should_manage_shell.rb reported: #<Beaker::DSL::Outcomes::FailTest: \r\n              didn't set the user shell for pl339772\r\n{code}","closed_at":"2015-11-18T13:08:52.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5314","labels":"","state":"Closed","updated_at":"2015-11-18T13:08:52.000-0800","timestamp":1652284961.017895,"priority":"Normal","status_category":"Done","pull_request":4345},{"issue_id":"96897","title":"missing help for 'puppet lookup' command line option","url":"https://tickets.puppetlabs.com/browse/PUP-5202","created_at":"2015-09-04T11:38:59.000-0700","number":"PUP-5202","body":"No help is available for 'puppet lookup' commandline option\r\n\r\n{code}\r\n[root@gsiw4grv2nzupgg ~]# puppet lookup --help\r\nNo help available for puppet lookup\r\n\r\n[root@gsiw4grv2nzupgg ~]# puppet help\r\n\r\nUsage: puppet <subcommand> [options] <action> [options]\r\n\r\nAvailable subcommands:\r\n...\r\n  inspect           Send an inspection report\r\n  key               Create, save, and remove certificate keys.\r\n  lookup\r\n  man               Display Puppet manual pages.\r\n\r\n{code}","closed_at":"2015-11-18T13:08:52.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5202","labels":"","state":"Closed","updated_at":"2015-11-18T13:08:52.000-0800","timestamp":1652284961.124392,"priority":"Normal","status_category":"Done","pull_request":4242},{"issue_id":"91205","title":"Runtime type does not treat ruby Module correctly.","url":"https://tickets.puppetlabs.com/browse/PUP-4960","created_at":"2015-07-30T05:46:59.000-0700","number":"PUP-4960","body":"The {{Runtime}} type does not handle the case where the LHS is a ruby {{Module}} and RHS is implements that Module. This can be tested using following statement. It will print \"Notice: nope\" indicating that {{Array}} is not assignable to {{Enumerable}}.\r\n{code}\r\npuppet apply -e 'if Runtime[\"ruby\",\"Enumerable\"] > Runtime[\"ruby\", \"Array\"] { notify{yes:} } else { notify{nope:} }'\r\n{code}\r\n","closed_at":"2015-11-18T13:08:53.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4960","labels":"","state":"Closed","updated_at":"2015-11-18T13:08:53.000-0800","timestamp":1652284961.227557,"priority":"Normal","status_category":"Done","pull_request":4298},{"issue_id":"99736","title":"regsubst doesn't work on empty arrays in puppet 4.x","url":"https://tickets.puppetlabs.com/browse/PUP-5292","created_at":"2015-09-29T09:40:37.000-0700","number":"PUP-5292","body":"regsubst gives an error about being called with the wrong type if you give it an empty array of strings to do substitutions on. This used to work in Puppet 3.x.\r\n\r\n{code}\r\n$ puppet apply -e 'notice(regsubst([],\"\",\"\"))'\r\nError: Evaluation Error: Error while evaluating a Function Call, function 'regsubst' called with mis-matched arguments\r\nexpected one of:\r\n  regsubst(Variant[Array[String], String] target, String pattern, String replacement, Optional[Pattern[/^[GEIM]*$/]] flags?, Enum['N', 'E', 'S', 'U'] encoding?) - arg count {3,5}\r\n  regsubst(Variant[Array[String], String] target, Variant[Regexp, Type[Regexp]] pattern, String replacement, Pattern[/^G?$/] flags?) - arg count {3,4}\r\nactual:\r\n  regsubst(Array[Undef], String, String) - arg count {3}  at line 1:8 on node valentina.local\r\n{code}","closed_at":"2015-11-18T13:08:57.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5292","labels":"","state":"Closed","updated_at":"2015-11-18T13:08:57.000-0800","timestamp":1652284961.853265,"priority":"Normal","status_category":"Done","pull_request":4362},{"issue_id":"90335","title":"puppet resource package does not display installs that use QuietDisplayName ","url":"https://tickets.puppetlabs.com/browse/PUP-4917","created_at":"2015-07-23T01:30:46.000-0700","number":"PUP-4917","body":"The Programs and Features view of *Windows Server 2012 R2* is displaying *McAfee Agent* in Version *4.8.0.887*.\r\n\r\n!ProgramsAndFeaturesW2012.png|thumbnail!\r\n\r\nHowever, the execution of the following command in the Windows Command Prompt as Administrator\r\n{code:JavaScript}\r\npuppet resource package\r\n{code}\r\nreturns the following output where the *McAfee Agent* is not displayed:\r\n{code:JavaScript}\r\npackage { 'McAfee VirusScan Enterprise':\r\n  ensure => '8.8.04001',\r\n}\r\npackage { 'Microsoft Silverlight':\r\n  ensure => '5.1.30514.0',\r\n}\r\npackage { 'Microsoft Visual C++ 2008 Redistributable - x64 9.0.30729.6161':\r\n  ensure => '9.0.30729.6161',\r\n}\r\npackage { 'Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.4148':\r\n  ensure => '9.0.30729.4148',\r\n}\r\npackage { 'Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.6161':\r\n  ensure => '9.0.30729.6161',\r\n}\r\npackage { 'Puppet Agent (64-bit)':\r\n  ensure => '1.2.2',\r\n}\r\npackage { 'VMware Tools':\r\n  ensure => '9.4.12.2627939',\r\n}\r\n...\r\n{code}\r\n\r\nIn comparison, on *Windows Server 2008 R2* with installed *McAfee Agent* in Version *4.6.0.2292* it is displayed on the Programs and Features view and also by _*puppet resource package*_:\r\n\r\n{code:JavaScript}\r\npackage { 'McAfee Agent':\r\n  ensure => '4.6.0.2292',\r\n}\r\npackage { 'McAfee VirusScan Enterprise':\r\n  ensure => '8.8.02004',\r\n}\r\npackage { 'Microsoft .NET Framework 4.5.2':\r\n  ensure => '4.5.51209',\r\n}\r\npackage { 'Microsoft Visual C++ 2008 Redistributable - x64 9.0.30729.6161':\r\n  ensure => '9.0.30729.6161',\r\n}\r\npackage { 'Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.4148':\r\n  ensure => '9.0.30729.4148',\r\n}\r\npackage { 'Puppet Agent (64-bit)':\r\n  ensure => '1.2.1',\r\n}\r\npackage { 'VMware Tools':\r\n  ensure => '9.4.12.2627939',\r\n}\r\n...\r\n{code}\r\n\r\n!ProgramsAndFeaturesW2008.png|thumbnail!","closed_at":"2015-11-18T13:08:57.000-0800","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4917","labels":"windows","state":"Closed","updated_at":"2015-11-18T13:08:57.000-0800","timestamp":1652284961.95892,"priority":"Normal","status_category":"Done","pull_request":4392},{"issue_id":"90643","title":"Relationship with a parameter does not work","url":"https://tickets.puppetlabs.com/browse/PUP-4926","created_at":"2015-07-27T05:57:54.000-0700","number":"PUP-4926","body":"Test.pp:\r\n\r\n{code}\r\nnotify {\r\n  '1':\r\n}\r\n\r\ndefine mynotify(Type[Notify] $req) {\r\n  notify {\r\n    $title:\r\n  }\r\n  $req -> Mynotify[$title]\r\n}\r\n\r\nmynotify {\r\n  '2':\r\n    req => Notify['1']\r\n}\r\n\r\n{code}\r\n\r\nh2. Expected:\r\n\r\nRelationship works: Notify['1'] is triggered before Notify['2']\r\n\r\nh2. Result:\r\n\r\n{code}\r\npuppet apply test.pp\r\nError: Evaluation Error: Illegal relationship operand, can not form a relationship with an Object. A Catalog type is required. at /root/test.pp:9:8 on node foo\r\n{code}\r\n\r\n\r\nh2. Workaround:\r\n\r\n{code}\r\nnotify {\r\n  '1':\r\n}\r\n\r\ndefine mynotify(String $prereq) {\r\n  $req = Notify[$prereq] \r\n  notify {\r\n    $title:\r\n  }\r\n  $req -> Mynotify[$title]\r\n}\r\n\r\nmynotify {\r\n  '2':\r\n    prereq => '1'\r\n}\r\n{code}\r\n{code}\r\nNotice: Compiled catalog for foo in environment production in 0.48 seconds\r\nNotice: 1\r\nNotice: /Stage[main]/Main/Notify[1]/message: defined 'message' as '1'\r\nNotice: 2\r\nNotice: /Stage[main]/Main/Mynotify[2]/Notify[2]/message: defined 'message' as '2'\r\nNotice: Applied catalog in 0.06 seconds\r\n{code}","closed_at":"2015-11-18T13:08:58.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4926","labels":"","state":"Closed","updated_at":"2015-11-18T13:08:58.000-0800","timestamp":1652284962.385397,"priority":"Normal","status_category":"Done","pull_request":4107},{"issue_id":"101720","title":"Don't restart puppetserver twice each time with_puppet_running_on is called","url":"https://tickets.puppetlabs.com/browse/PUP-5383","created_at":"2015-10-14T22:52:53.000-0700","number":"PUP-5383","body":"Beaker's {{with_puppet_running_on}} method will restart {{puppetserver}} twice, once to lay down the test specified configuration, e.g. ssl, autosign policy, environment directories, and again at the end, to restore the original configuration. The second restart is unnecessary in FOSS and adds 25 MINUTES to the total acceptance run.\r\n\r\nBeaker added support to not restart the second time in BKR-53. However, due to BKR-574, the option can't be specified globally, and must be specified for each test.\r\n\r\nOnce BKR-574 is fixed, we should disable the second restart in puppet acceptance.","closed_at":"2015-11-18T13:09:01.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5383","labels":"","state":"Closed","updated_at":"2015-11-18T13:09:01.000-0800","timestamp":1652284973.037166,"priority":"Normal","status_category":"Done","pull_request":4383},{"issue_id":"93179","title":"Update node terminus configured_environment to mirror agent_specified_environment","url":"https://tickets.puppetlabs.com/browse/PUP-5032","created_at":"2015-08-12T15:14:37.000-0700","number":"PUP-5032","body":"Puppet's communication with the node and catalog terminus included a configured_environment option in the last release. That option sometimes includes redundant or irrelevant information when Puppet[:environment] has the default setting. That redundant information precludes it from being used to identify when an agent has explicitly requested a particular environment.\r\n\r\nChange the behavior of configured_environment to only be set when the environment setting is explicitly set.\r\n\r\nThis would technically be a breaking change in Puppet's node and catalog terminus behavior, but seeing as we have yet to document it I think it's a reasonable break.","closed_at":"2015-11-18T13:09:02.000-0800","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5032","labels":"","state":"Closed","updated_at":"2015-11-18T13:09:02.000-0800","timestamp":1652284973.14311,"priority":"Normal","status_category":"Done","pull_request":4228},{"issue_id":"83304","title":"Yum provider fails spec tests due to root requirement","url":"https://tickets.puppetlabs.com/browse/PUP-4701","created_at":"2015-06-05T00:42:20.000-0700","number":"PUP-4701","body":"41 spec tests fail when running on a Fedora 21 machine. They all fail with the same stacktrace that has this at the top:\r\n{code}\r\nPuppet::Error:\r\n       The yum provider can only be used as root\r\n     # ./lib/puppet/provider/package/yum.rb:29:in `prefetch'\r\n{code}\r\n","closed_at":"2015-11-18T13:09:07.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4701","labels":"","state":"Closed","updated_at":"2015-11-18T13:09:07.000-0800","timestamp":1652284973.769087,"priority":"Normal","status_category":"Done","pull_request":4006},{"issue_id":"100606","title":"aix_package_provider test fails on AIX","url":"https://tickets.puppetlabs.com/browse/PUP-5311","created_at":"2015-10-05T07:02:56.000-0700","number":"PUP-5311","body":"Puppet acceptance test Case {{tests/aix/aix_package_provider.rb}} fails with the following:\r\n\r\n{code}\r\nTest Case tests/aix/aix_package_provider.rb reported: #<Minitest::Assertion: Didn't get an error about downgrading packages.\r\n              Expected /aix package provider is unable to downgrade packages/ to match \"\\e[mNotice: Compiled catalog for pe-aix-53-acceptance.delivery.puppetlabs.net in environment production in 1.54 seconds\\e[0m\\n\\e[0;32mInfo: Applying configuration version '1443972941'\\e[0m\\n\\e[mNotice: Applied catalog in 0.44 seconds\\e[0m\\n\".>\r\n{code}","closed_at":"2015-11-18T13:09:09.000-0800","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5311","labels":"","state":"Closed","updated_at":"2015-11-18T13:09:09.000-0800","timestamp":1652284974.189891,"priority":"Normal","status_category":"Done","pull_request":4357},{"issue_id":"99780","title":"Environment compilation fails if there is no site { } declaration","url":"https://tickets.puppetlabs.com/browse/PUP-5293","created_at":"2015-09-29T13:36:03.000-0700","number":"PUP-5293","body":"Compiling an environment catalog without including a {{site}} declaration causing an error about trying to convert nil to array. This seems to happen because of this code in {{environment_compiler.rb}}:\r\n\r\n{code}\r\n  def prune_env_catalog\r\n    # Everything under Class[main], that is not under (inclusive of) Site[site] should be pruned as those resources\r\n    # are intended for nodes in a node catalog.\r\n    #\r\n    the_main_class_resource = @catalog.resource('Class', '')\r\n    the_site_resource = @catalog.resource('Site', 'site')\r\n\r\n    # Get downstream vertexes returns a hash where the keys are the resources and values nesting level\r\n    rooted_in_main = @catalog.downstream_from_vertex(the_main_class_resource).keys\r\n    if the_site_resource\r\n      keep_from_site = @catalog.downstream_from_vertex(the_site_resource).keys\r\n      keep_from_site << the_site_resource\r\n    end\r\n\r\n    to_be_removed = rooted_in_main - keep_from_site\r\n    @catalog.remove_resource(*to_be_removed)\r\n    # The compiler keeps a list of added resources, this shadows that list with the now pruned result\r\n    @pruned_resources = @catalog.resources\r\n  end\r\n{code}\r\n\r\nIf there is no site resource, {{keep_from_site}} is never set and is nil. So {{rooted_in_main - keep_from_site}} is Array - nil, which fails.","closed_at":"2015-11-18T13:09:09.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5293","labels":"","state":"Closed","updated_at":"2015-11-18T13:09:09.000-0800","timestamp":1652284974.2951,"priority":"Blocker","status_category":"Done","pull_request":4309},{"issue_id":"94892","title":"classes within a modules namespace cannot be used to produce capabilities","url":"https://tickets.puppetlabs.com/browse/PUP-5075","created_at":"2015-08-24T17:45:50.000-0700","number":"PUP-5075","body":"I have an [ELK module|https://github.com/puppetlabs/appmgmt-module-elk/blob/master/manifests/elasticsearch.pp] that I used with earlier versions of the language to demonstrate appmgmt. \r\n\r\nIn an attempt to use David's latest language implementation in dev/xnode, I modified my capability mapping to match xnode-spec. \r\n\r\n{code}\r\n# map data from the capability resource (left) to this profile (right)\r\nElk::Elasticsearch produces Es_instance {\r\n  port     => $es_port,\r\n  host     => $::fqdn,\r\n  clustername => $cluster_name\r\n}\r\n{code}\r\n\r\nWhen asked to list apps for the environment, validating the environment graph, the CLI tells me:\r\n\r\n{noformat}\r\n[root@appmgmt-services puppetlabs]# /opt/puppetlabs/bin/deployer-client --host https://appmgmt-services.vm:9999 apps\r\njava.lang.Exception: Received HTTP 500: Server Error: Illegal class reference at /etc/puppetlabs/code/environments/production/modules/elk/manifests/elasticsearch.pp:28:5 in environment production\r\n{noformat}\r\n\r\nIn discussion with David, the likely bug is that Puppet expects top-scope class names like elk to work but not namespaces under the module name, like elk::elasticsearch.","closed_at":"2015-11-18T13:09:12.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5075","labels":"","state":"Closed","updated_at":"2015-11-18T13:09:12.000-0800","timestamp":1652284975.125837,"priority":"Blocker","status_category":"Done","pull_request":4195},{"issue_id":"97184","title":"component to capability mapping (both produce and consume) don't allow trailing comma on last parameter","url":"https://tickets.puppetlabs.com/browse/PUP-5214","created_at":"2015-09-08T17:20:58.000-0700","number":"PUP-5214","body":"Since Puppet 2.7, the language allowed the last parameter in a resource, class param list--wherever, to have a trailing comma. This is convenient as a courtesy to the next person modifying the parameter list who may not think to add a comma to your parameter when they add their own. \r\n\r\n{code}\r\nForge::Db produces Sql {\r\n  user     => $user,\r\n  password => $password,\r\n  host     => $host,\r\n  database => $name,\r\n}\r\nForge::Api consumes Sql {\r\n  db_name => $database,\r\n  db_user => $user,\r\n  db_password => $password,\r\n  db_host => $host,\r\n}\r\n{code}\r\n\r\nBoth of these statements fail when the comma after either $name and $host are present. We need to allow these trailing commas to remain consistent with the behavior expected from the rest of the Puppet DSL. ","closed_at":"2015-11-18T13:09:12.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5214","labels":"","state":"Closed","updated_at":"2015-11-18T13:09:12.000-0800","timestamp":1652284975.22898,"priority":"Normal","status_category":"Done","pull_request":4239},{"issue_id":"102770","title":"puppet lookup creates phantom node","url":"https://tickets.puppetlabs.com/browse/PUP-5425","created_at":"2015-10-23T13:53:14.000-0700","number":"PUP-5425","body":"Immediately after installing 2015.3.0-rc4-12-g0b26932, running {{puppet lookup key1 --debug}} as root doesn't error out but adds a new node {{default}} to PuppetDB. \r\n\r\nRe-running the command exhibits the behavior described in PUP-5423\r\n\r\nDebug output attached.","closed_at":"2015-11-18T13:09:14.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5425","labels":"","state":"Closed","updated_at":"2015-11-18T13:09:14.000-0800","timestamp":1652284975.332615,"priority":"Blocker","status_category":"Done","pull_request":4388},{"issue_id":"87911","title":"Regression PMT cannot connect to forge on OSX","url":"https://tickets.puppetlabs.com/browse/PUP-4822","created_at":"2015-07-07T13:44:59.000-0700","number":"PUP-4822","body":"The PMT fails to connect:\r\n\r\n{noformat}\r\nvfyfy4ou7ntrxfp:~ root# puppet module install puppetlabs-stdlib\r\nNotice: Preparing to install into /etc/puppetlabs/code/environments/production/modules ...\r\nNotice: Downloading from https://forgeapi.puppetlabs.com ...\r\nError: Could not connect via HTTPS to https://forgeapi.puppetlabs.com\r\n  Unable to verify the SSL certificate\r\n    The certificate may not be signed by a valid CA\r\n    The CA bundle included with OpenSSL may not be valid or up to date\r\n{noformat}\r\n\r\nHowever, using the system openssl, it does successfully connect:\r\n\r\n{noformat}\r\nvfyfy4ou7ntrxfp:~ root# openssl s_client -connect forgeapi.puppetlabs.com:443\r\nCONNECTED(00000003)\r\ndepth=1 /C=US/O=GeoTrust Inc./CN=GeoTrust SSL CA - G2\r\nverify error:num=20:unable to get local issuer certificate\r\nverify return:0\r\n---\r\n{noformat}\r\n\r\nIt seems osx patches system openssl so it looks in the keystore, but that doesn't work for puppet-agent, because we compile openssl ourselves.\r\n\r\nThe fix for PUP-3450 would fix this issue. Filing this as a separate issue because it affects OSX acceptance (which fails try to connect to the test forge).\r\n\r\nh4. Workaround\r\n\r\nCreate a file {{/opt/puppetlabs/puppet/ssl/cert.pem}} with the GeoTrust Global CA below, making sure permissions are not writable by non-root:\r\n\r\n{noformat}\r\n-----BEGIN CERTIFICATE-----\r\nMIIDVDCCAjygAwIBAgIDAjRWMA0GCSqGSIb3DQEBBQUAMEIxCzAJBgNVBAYTAlVT\r\nMRYwFAYDVQQKEw1HZW9UcnVzdCBJbmMuMRswGQYDVQQDExJHZW9UcnVzdCBHbG9i\r\nYWwgQ0EwHhcNMDIwNTIxMDQwMDAwWhcNMjIwNTIxMDQwMDAwWjBCMQswCQYDVQQG\r\nEwJVUzEWMBQGA1UEChMNR2VvVHJ1c3QgSW5jLjEbMBkGA1UEAxMSR2VvVHJ1c3Qg\r\nR2xvYmFsIENBMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA2swYYzD9\r\n9BcjGlZ+W988bDjkcbd4kdS8odhM+KhDtgPpTSEHCIjaWC9mOSm9BXiLnTjoBbdq\r\nfnGk5sRgprDvgOSJKA+eJdbtg/OtppHHmMlCGDUUna2YRpIuT8rxh0PBFpVXLVDv\r\niS2Aelet8u5fa9IAjbkU+BQVNdnARqN7csiRv8lVK83Qlz6cJmTM386DGXHKTubU\r\n1XupGc1V3sjs0l44U+VcT4wt/lAjNvxm5suOpDkZALeVAjmRCw7+OC7RHQWa9k0+\r\nbw8HHa8sHo9gOeL6NlMTOdReJivbPagUvTLrGAMoUgRx5aszPeE4uwc2hGKceeoW\r\nMPRfwCvocWvk+QIDAQABo1MwUTAPBgNVHRMBAf8EBTADAQH/MB0GA1UdDgQWBBTA\r\nephojYn7qwVkDBF9qn1luMrMTjAfBgNVHSMEGDAWgBTAephojYn7qwVkDBF9qn1l\r\nuMrMTjANBgkqhkiG9w0BAQUFAAOCAQEANeMpauUvXVSOKVCUn5kaFOSPeCpilKIn\r\nZ57QzxpeR+nBsqTP3UEaBU6bS+5Kb1VSsyShNwrrZHYqLizz/Tt1kL/6cdjHPTfS\r\ntQWVYrmm3ok9Nns4d0iXrKYgjy6myQzCsplFAMfOEVEiIuCl6rYVSAlk6l5PdPcF\r\nPseKUgzbFbS9bZvlxrFUaKnjaZC2mqUPuLk/IH2uSrW4nOQdtqvmlKXBx4Ot2/Un\r\nhw4EbNX/3aBd7YdStysVAq45pmp06drE57xNNB6pXE0zX5IJL4hmXXeXxx12E6nV\r\n5fEWCRE11azbJHFwLJhWC9kXtNHjUStedejV0NxPNO3CBWaAocvmMw==\r\n-----END CERTIFICATE-----\r\n{noformat}\r\n\r\nand PMT will work:\r\n\r\n{noformat}\r\ncpwj90x3cw44guh:~ root# /opt/puppetlabs/bin/puppet module install puppetlabs-stdlib\r\nNotice: Preparing to install into /etc/puppetlabs/code/environments/production/modules ...\r\nNotice: Downloading from https://forgeapi.puppetlabs.com ...\r\nNotice: Installing -- do not interrupt ...\r\n/etc/puppetlabs/code/environments/production/modules\r\n└── puppetlabs-stdlib (v4.7.0) \r\n{noformat}\r\n\r\n","closed_at":"2015-11-18T18:33:01.000-0800","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4822","labels":"regression","state":"Closed","updated_at":"2015-11-18T18:33:01.000-0800","timestamp":1652284975.439154,"priority":"Normal","status_category":"Done","pull_request":4135},{"issue_id":"80131","title":"multi-resource references do not accept trailing commas","url":"https://tickets.puppetlabs.com/browse/PUP-4610","created_at":"2015-05-13T17:50:33.000-0700","number":"PUP-4610","body":"I generally expect that puppet will allow trailing commas when enumerating a list.  This could be considered either a bug or a feature request but I found the result from the following example surprising.\r\n\r\n{code}\r\nnotify { \"a\": }\r\nnotify { \"b\": }\r\nnotify { \"c\": }\r\n\r\nNotify[\r\n  'b',\r\n  'c',\r\n] {\r\n  require => Notify['a']\r\n}\r\n{code}\r\n\r\n{code}\r\n$ bundle exec puppet --version\r\n4.0.0\r\n$ bundle exec puppet apply test.pp\r\nError: Could not parse for environment production: Syntax error at ']' at /home/jhoblitt/tmp/test.pp:8:1 on node leo\r\nError: Could not parse for environment production: Syntax error at ']' at /home/jhoblitt/tmp/test.pp:8:1 on node leo\r\n{code}","closed_at":"2015-11-24T16:19:00.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4610","labels":"","state":"Closed","updated_at":"2015-11-24T16:19:00.000-0800","timestamp":1652284976.16192,"priority":"Normal","status_category":"Done","pull_request":4419},{"issue_id":"84177","title":"Add missing query parameters to Puppet HTTPS API docs","url":"https://tickets.puppetlabs.com/browse/PUP-4740","created_at":"2015-06-10T15:45:58.000-0700","number":"PUP-4740","body":"The API docs (at api/doc in the Puppet source) are missing some query parameters that are used by puppet agent in some requests. The ones I know about are {{source_permissions}} and {{configured_environment}} (see PUP-4521). ","closed_at":"2015-11-24T17:11:02.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4740","labels":"","state":"Closed","updated_at":"2015-11-24T17:11:02.000-0800","timestamp":1652284976.265384,"priority":"Normal","status_category":"Done","pull_request":4342},{"issue_id":"100604","title":"Yum package provider: ensure => latest fails when kernel is updated but not current","url":"https://tickets.puppetlabs.com/browse/PUP-5309","created_at":"2015-10-05T06:26:47.000-0700","number":"PUP-5309","body":"Similar to PUP-4497, puppet fail to run when there are kernel upgrade that didnt get apply:\r\n\r\n{code}\r\n# yum check-update \r\nLoaded plugins: product-id, rhnplugin, subscription-manager \r\nThis system is receiving updates from RHN Classic or Red Hat Satellite.\r\n\r\nopenldap.x86_64 2.4.39-7.el7_1 rhel-x86_64-server-7 \r\nSecurity: kernel-3.10.0-229.14.1.el7.x86_64 is an installed security update \r\nSecurity: kernel-3.10.0-123.el7.x86_64 is the currently running version\r\n{code}\r\n\r\nError:\r\n\r\n{code}\r\nError: /Stage[main]/Pe_r10k::Package/Package[pe-r10k]/ensure: change from 2.0.3.0-1.el7 to latest failed: Could not get latest version: undefined method `[]' for nil:NilClass \r\nError: Could not get latest version: undefined method `[]' for nil:NilClass \r\nError: /Stage[main]/Puppet_enterprise::Packages/Package[pe-java]/ensure: change from 1.8.0.51-1.b16.pe.el7 to latest failed: Could not get latest version: undefined method `[]' for nil:NilClass \r\nError: Could not get latest version: undefined method `[]' for nil:NilClass \r\n{code}\r\n\r\nWhen system is rebooted to use the latest kernel, the error will go away.","closed_at":"2015-11-27T02:52:29.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5309","labels":"","state":"Closed","updated_at":"2015-11-27T02:52:29.000-0800","timestamp":1652284976.370152,"priority":"Normal","status_category":"Done","pull_request":4377},{"issue_id":"106572","title":"Hiera special pseudo-variables breaking with puppet 4.3","url":"https://tickets.puppetlabs.com/browse/PUP-5525","created_at":"2015-11-20T05:00:58.000-0800","number":"PUP-5525","body":"puppet 4.3.0 breaks hiera Special Pseudo-Variables like calling_module.\r\n\r\nreproduce:\r\n{code}\r\n#hiera.yaml:\r\n---\r\n:backends:\r\n  - yaml\r\n\r\n:hierarchy:\r\n  - modules/%{calling_module}\r\n  - global\r\n\r\n:yaml:\r\n  :datadir: \"/etc/puppetlabs/code/hiera\"\r\n{code}\r\n\r\n{code}\r\n#/etc/puppetlabs/code/hiera/modules/test.yaml:\r\ntest::p1: 'hiera value'\r\n{code}\r\n\r\n#test module: /etc/puppetlabs/code/modules/test/manifests/init.pp:\r\n{code:puppet}\r\nclass test ( $p1 = \"default module value\" ) { notice($p1) }\r\n{code}\r\n\r\nwith puppet 4.3.0:\r\n{code}\r\npuppet apply --hiera_config [...]/hiera.yaml --modulepath=/etc/puppetlabs/code/hiera/modules  -e 'include ::test'\r\nNotice: Scope(Class[Test]): default module value\r\nNotice: Compiled catalog for puppet4.3.0 in environment production in 0.38 seconds\r\n{code}\r\n\r\nwith puppet 4.2.3:\r\n{code}\r\npuppet apply --hiera_config [...]/hiera.yaml --modulepath=/etc/puppetlabs/code/hiera/modules/  -e 'include ::test'\r\nNotice: Scope(Class[Test]): hiera value\r\nNotice: Compiled catalog for puppet4.2.3 in environment production in 0.64 seconds\r\n{code}\r\n\r\nAs the documentation for the puppet 4.3 release states that the new lookup feature \"integrates with the existing Hiera system\" I think this is a bug.","closed_at":"2015-11-30T13:03:50.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5525","labels":"","state":"Closed","updated_at":"2015-11-30T13:03:50.000-0800","timestamp":1652284976.679091,"priority":"Normal","status_category":"Done","pull_request":4459},{"issue_id":"62785","title":"Issue with Collectors and the Future Parser","url":"https://tickets.puppetlabs.com/browse/PUP-3806","created_at":"2015-01-02T15:59:43.000-0800","number":"PUP-3806","body":"When running with the apache module with the future parser enabled we're getting the following error:\r\n{noformat}\r\nError: Evaluation Error: Error while evaluating a Virtual Query, Cannot transform object of class Puppet::Pops::Model::ConcatenatedString at /etc/puppetlabs/puppet/modules/apache/manifests/mod.pp:70:27 on node localhost.localdomain\r\n       \tError: Evaluation Error: Error while evaluating a Virtual Query, Cannot transform object of class Puppet::Pops::Model::ConcatenatedString at /etc/puppetlabs/puppet/modules/apache/manifests/mod.pp:70:27 on node localhost.localdomain\r\n{noformat}\r\n\r\nThe line that is is causing the failure is\r\n{noformat}\r\nPackage[$_package] -> File<| title == \"${mod}.conf\" |>\r\n{noformat}\r\n\r\nA small example that also reproduces this error is\r\n{noformat}\r\n@file{'/tmp/foo':\r\n  ensure => file\r\n}\r\n\r\n$thing = 'foo'\r\n\r\nnotify{\"Thing is: ${thing}\":}\r\n\r\nFile <| title == \"/tmp/${thing}\" |>\r\n{noformat}\r\n\r\n[~chuck] used bisect and believes the bug was introduced in https://github.com/puppetlabs/puppet/commit/95b738e","closed_at":"2015-12-08T15:41:34.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3806","labels":"","state":"Closed","updated_at":"2015-12-08T15:41:34.000-0800","timestamp":1652284977.59775,"priority":"Normal","status_category":"Done","pull_request":3446},{"issue_id":"62309","title":"Empty LiteralHash and LiteralList parameters get parsed with positioning information that excludes their closing delimiter","url":"https://tickets.puppetlabs.com/browse/PUP-3786","created_at":"2014-12-21T11:59:27.000-0800","number":"PUP-3786","body":"h2. Reproduction Case\r\n\r\n{code:ruby}\r\n# literal_test.rb\r\nrequire 'puppet'\r\nrequire 'puppet/pops'\r\n \r\nparser = Puppet::Pops::Parser::Parser.new\r\n  \r\nresult = parser.parse_string <<-EOM\r\nclass test::class (\r\n  $param_one = {},\r\n  $param_two = { },\r\n  $param_three = {a => b},\r\n  $param_four = [],\r\n  $param_five = [ ],\r\n  $param_six = [a],\r\n) {}\r\nEOM\r\n\r\nresult.current.definitions.each do |d|\r\n  d.parameters.each do |p|\r\n    puts \"#{p.name}: #{p.value.length}\"\r\n  end\r\nend\r\n{code}\r\n\r\nh3. Outcome\r\n\r\n{noformat}\r\n# ruby literal_test.rb \r\nparam_one: 1\r\nparam_two: 1\r\nparam_three: 8\r\nparam_four: 1\r\nparam_five: 1\r\nparam_six: 3\r\n{noformat}\r\n\r\nh3. Expected Outcome\r\n\r\nParams one and four get parsed with a length of 2 and params two and five get a length of 3.","closed_at":"2015-12-08T15:47:44.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3786","labels":"future-parser","state":"Closed","updated_at":"2015-12-08T15:47:44.000-0800","timestamp":1652284977.701011,"priority":"Normal","status_category":"Done","pull_request":3493},{"issue_id":"93038","title":"error message \"illegal comma separated argument list\" does not give a line number","url":"https://tickets.puppetlabs.com/browse/PUP-5026","created_at":"2015-08-12T00:39:36.000-0700","number":"PUP-5026","body":"h2. Overview\r\nIf code accidentally includes bad list syntax in the body of their class code, they will receive an error message that does not include a line number.  This is somewhat confusing.  I had this error and spent a good few minutes looking at the parameters to my class before I realised the error was in the body of my code.\r\n\r\nh2. Expected behaviour\r\nThe compile error should give a line number so that user's can find the error easily\r\n\r\nh2. Actual behaviour\r\nUser's receive the message {{illegal comma separated argument list}} which contains a filename but no line number.\r\n\r\nSpecifically, the testcase below gives the message:\r\n{noformat}\r\nError: Could not parse for environment production: illegal comma separated argument list in /Users/geoff/whoops.pp\r\n{noformat}\r\n\r\nh2. Testcase\r\n{noformat}\r\nclass whoops($a,$b,$c) {\r\n  $d = \"oh noes\",  \"b\"\r\n}\r\n{noformat}\r\n\r\nh2.  Suggested fix\r\nThe line number should be included in the error message","closed_at":"2015-12-11T09:06:34.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5026","labels":"","state":"Closed","updated_at":"2015-12-11T09:06:34.000-0800","timestamp":1652284978.213687,"priority":"Normal","status_category":"Done","pull_request":4254},{"issue_id":"72500","title":"Case and Selector match should be deep","url":"https://tickets.puppetlabs.com/browse/PUP-4277","created_at":"2015-03-20T15:01:04.000-0700","number":"PUP-4277","body":"Case and selector match should be recursive. Currently, the match operator only performs a surface level match.\r\n{code}\r\ncase [green, 2, $whatever] {\r\n  [/ee/, Integer[0,10], default] : { notice 'yes' }\r\n  default: { notice 'no' }\r\n}\r\n{code}\r\nThe above example should notice 'yes', it currently notices 'no'.\r\n\r\nUPDATE\r\n---\r\nRecursive matching means that the same matching rules (as for the surface level) now applies recursively:\r\n* A literal {{default}} accepts any value (e.g. [1,2,3] is matched by [1, default, 3] )\r\n* A regexp can match a String value (e.g. \"hello world\" is matched by /hello .*/)\r\n* A data type can match a value of that type (e.g. 3 matches Integer[1,10])\r\n\r\n* Arrays must match in size to match the option\r\n* Hashes match if the keys in the option have an equal key in the tested value, and the option key's value match the tested value.\r\n* Array entries and hash entries (values) are processed recursively.\r\n\r\nThe relevant section in the specification is: https://github.com/puppetlabs/puppet-specifications/blob/4.0.0/language/expressions.md#case-expression\r\n(note the reference to the tag 4.0.0 as there are additional features in the 4.1.0 version - notably PUP-4193 - lambda support).\r\n\r\nrisk assessment: medium (manual validate for now)\r\nprobability: low\r\nseverity: medium (work arounds)\r\ntest layer: unit","closed_at":"2015-12-16T11:56:39.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4277","labels":"","state":"Closed","updated_at":"2015-12-16T11:56:39.000-0800","timestamp":1652284978.520854,"priority":"Normal","status_category":"Done","pull_request":3762},{"issue_id":"95099","title":"Message for missing title is unhelpful","url":"https://tickets.puppetlabs.com/browse/PUP-5090","created_at":"2015-08-25T21:26:41.000-0700","number":"PUP-5090","body":"h2. Overview\r\nIf customers accidentally forget to type a resource title (or forget to capitalise the first letter of a type to set resource defaults), then the error message shown by puppet is hard to understand.\r\n\r\nh2. Testcase\r\n{noformat}\r\nfile {\r\n  owner => \"root\",\r\n}\r\n{noformat}\r\n\r\nh2. Expected message\r\n{noformat}\r\nMissing or Invalid resource title at /root/test.pp:1:1\r\n{noformat}\r\n\r\nh2. Actual message\r\n{noformat}\r\nError: Could not parse for environment production: This Name has no effect. A value-producing expression without other effect may only be placed last in a block/sequence at /root/test.pp:1:1 on node geoff.puppetlabs.vm\r\n{noformat}\r\n\r\nh2. Customer impact\r\nCustomers do not understand the current message and require assistance to fix their code","closed_at":"2015-12-16T12:02:50.000-0800","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5090","labels":"","state":"Closed","updated_at":"2015-12-16T12:02:50.000-0800","timestamp":1652284978.626213,"priority":"Normal","status_category":"Done","pull_request":4422},{"issue_id":"100818","title":"Master should return 74 when puppet user doesn't exist","url":"https://tickets.puppetlabs.com/browse/PUP-5317","created_at":"2015-10-05T14:43:14.000-0700","number":"PUP-5317","body":"Previously, when trying to run a master and the puppet user didn't exist, we exited with {{74}}.\r\n\r\nIn commit 144ea123965, a change was made to more gracefully handle failing, but raised a {{Puppet::Error}} instead of exiting with 74 as before. This causes {{puppet_manages_own_configuration_in_robust_manner.rb}} to fail.\r\n\r\nWe should go back to exiting with {{74}}.","closed_at":"2015-12-16T15:32:47.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5317","labels":"","state":"Closed","updated_at":"2015-12-16T15:32:47.000-0800","timestamp":1652284978.729657,"priority":"Normal","status_category":"Done","pull_request":4320},{"issue_id":"99820","title":"Capability resource params without default values fail during env catalog compilation","url":"https://tickets.puppetlabs.com/browse/PUP-5294","created_at":"2015-09-29T14:59:23.000-0700","number":"PUP-5294","body":"The following sort of code no longer works after a recent change to puppet:\r\n\r\n{code}\r\ndefine producer($foo) { }\r\nProducer produces Capres {\r\n  foo => $foo,\r\n}\r\n\r\ndefine consumer($foo) { }\r\nConsumer consumes Capres {\r\n  foo => $foo,\r\n}\r\n\r\napplication myapp() {\r\n  producer { something:\r\n    foo => \"some value\",\r\n    export => Capres[name],\r\n  }\r\n\r\n  consumer { something:\r\n    consume => Capres[name],\r\n  }\r\n}\r\n{code}\r\n\r\nThe gist of this application is that some parameter {{$foo}} is set on a producer, which attempts to convey that value to a consumer via a capability resource. However, when evaluating an instance of the application during environment catalog compilation, the consumer's parameters are validated and it fails because there is no value supplied for the {{$foo}} parameter.\r\n\r\nIn reality, this situation is perfectly acceptable, as no parameters are meant to be set in the environment catalog. We only want to know the type and title of the resources, along with the capabilities that they exchange. On the agent node, the parameters will be populated by the capability resources that are consumed. At environment compilation time, the capabilities haven't been produced and so that doesn't work.\r\n\r\nIt seems the solution to this problem is to avoid setting and/or validating resource params during environment catalog compilation, since all we care about are the identities of the resources involved. We can't actually set the parameters at this time, since their defaults/values may depend on node facts that aren't available during environment catalog compilation.\r\n\r\nThis seems likely to have been introduced by https://github.com/puppetlabs/puppet/commit/fcf939ebc287eb6ceba7126199c26afc673c44a4.","closed_at":"2015-12-17T10:11:33.000-0800","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5294","labels":"","state":"Closed","updated_at":"2015-12-17T10:11:33.000-0800","timestamp":1652284978.834466,"priority":"Blocker","status_category":"Done","pull_request":4333},{"issue_id":"25168","title":"Windows - Specifying well-known SIDs as a group / user in manifests causes errors","url":"https://tickets.puppetlabs.com/browse/PUP-1559","created_at":"2014-01-31T11:02:05.000-0800","number":"PUP-1559","body":"This fix was already done as part of PUP-266 as ADSI queries were failing against well know SIDS like {code}S-1-5-6{code}\r\n\r\nEven though PUP-266 has been moved to a post 4.0 release, since this code is complete and tested, it should make it's way into 3.4\r\n\r\nCommit msg notes:\r\n\r\n* Previously, calling Puppet::Util::ADSI::Group.exists? for a well-known group SID would return false, because the WinNT:// style URI used to find the group would not examine / lookup the SID, but would instead create a broken Uri that the underlying OS could not understand\r\n* Now, the given group name is checked to see if it's a SID before the Uri is constructed, and a SID style Uri is created where appropriate","closed_at":"2016-01-11T00:47:08.000-0800","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1559","labels":"","state":"Closed","updated_at":"2016-01-11T00:47:08.000-0800","timestamp":1652284980.483451,"priority":"Normal","status_category":"Done","pull_request":2317},{"issue_id":"12756","title":"Puppet Windows Exec providers don't support runas","url":"https://tickets.puppetlabs.com/browse/PUP-207","created_at":"2013-08-02T09:07:06.000-0700","number":"PUP-207","body":"It appears we don't support configuring a runas user for Windows, it is possible via powershell commands, but being able to have native support inside the provider should be useful and allow feature parity with our linux exec providers.","closed_at":"2016-01-11T14:42:16.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-207","labels":"","state":"Closed","updated_at":"2016-01-11T14:42:16.000-0800","timestamp":1652284980.685965,"priority":"Normal","status_category":"Done","pull_request":2852},{"issue_id":"78336","title":"Agent does not stop with Ctrl-C","url":"https://tickets.puppetlabs.com/browse/PUP-4516","created_at":"2015-05-03T03:50:53.000-0700","number":"PUP-4516","body":"When running a puppet run from the command line the agent catches a Ctrl-C, but does not stop.\r\n\r\n{code}\r\n^CNotice: Caught INT; storing stop\r\n^CNotice: Caught INT; storing stop\r\n^CNotice: Caught INT; storing stop\r\n^CNotice: Caught INT; storing stop\r\n^CNotice: Caught INT; storing stop\r\nInfo: Caching catalog for ue1a-util03.ineu.us\r\nInfo: Applying configuration version '1430650119'\r\n.... run continues to completion\r\n{code}\r\n\r\nThis is with puppet-agent-1.0.1 on CentOS7","closed_at":"2016-01-20T22:37:28.000-0800","comments":31,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4516","labels":"","state":"Closed","updated_at":"2016-01-20T22:37:28.000-0800","timestamp":1652284982.073977,"priority":"Normal","status_category":"Done","pull_request":4375},{"issue_id":"111436","title":"Disallow numeric ranges where from > to","url":"https://tickets.puppetlabs.com/browse/PUP-5658","created_at":"2016-01-07T01:59:25.000-0800","number":"PUP-5658","body":"An integer type can be declared as {{Integer[10,0]}} or {{Integer[0,10]}}. The intention was to give the type a sense of direction which then would affect iterating over the range. This design has been rejected since the direction has no bearing on the constraint. The descending iteration aspect will be covered in a coming release where an {{Iterable}} type is introduced.\r\n\r\nThis, in combination with that the current implementation has a bug that turns descending iteration into an ascending iteration (see PUP-5648) made us decide to change the current behavior so that any construct for a Numeric where the range is declared with from > to should yield an error.\r\n","closed_at":"2016-01-21T16:38:35.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5658","labels":"","state":"Closed","updated_at":"2016-01-21T16:38:35.000-0800","timestamp":1652284982.284306,"priority":"Normal","status_category":"Done","pull_request":4556},{"issue_id":"106001","title":"No error context when a non-numeric index is used on a string","url":"https://tickets.puppetlabs.com/browse/PUP-5509","created_at":"2015-11-16T14:32:54.000-0800","number":"PUP-5509","body":"Having a non-capitalized resource type with a relationship Metaparameter resource will give non-descript errors during puppet runs and when using puppet apply.\r\n\r\nManifest with correct metaparameter:\r\n\r\n{code}\r\nclass test {\r\nfile {'test':\r\n ensure => present,\r\n require => Package['ehs']\r\n }\r\n}\r\n{code}\r\n\r\nManifest causing error:\r\n{code}\r\nclass test {\r\nfile {'test':\r\n ensure => present,\r\n require => package['ehs']\r\n }\r\n}\r\n{code}\r\n\r\nPuppet Run\r\n{code}\r\n[root@pe-201522-master manifests]# puppet agent -t\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nError: Could not retrieve catalog from remote server: Error 400 on SERVER: Evaluation Error: The value 'ehs' cannot be converted to Numeric. on node pe-201522-master.puppetdebug.vlan\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\n{code}\r\n\r\n","closed_at":"2016-01-21T16:38:35.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5509","labels":"","state":"Closed","updated_at":"2016-01-21T16:38:35.000-0800","timestamp":1652284982.38922,"priority":"Normal","status_category":"Done","pull_request":4484},{"issue_id":"106510","title":"Puppet node does not keep attributes consistent with parameters","url":"https://tickets.puppetlabs.com/browse/PUP-5522","created_at":"2015-11-19T13:19:28.000-0800","number":"PUP-5522","body":"The Puppet::Node class has two attributes, environment_name and environment. It also has a parameter named 'environment'. These are not kept in sync which causes problems for the catalog_preview application. See PRE-81. I think it's better to fix this in the puppet code than adding a workaround in the catalog preview program.\r\n","closed_at":"2016-01-22T13:41:35.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5522","labels":"","state":"Closed","updated_at":"2016-01-22T13:41:35.000-0800","timestamp":1652284982.699919,"priority":"Normal","status_category":"Done","pull_request":4456},{"issue_id":"97007","title":"call_function and metadata.json: call a function from a different module, very strange behavior","url":"https://tickets.puppetlabs.com/browse/PUP-5209","created_at":"2015-09-07T19:02:44.000-0700","number":"PUP-5209","body":"Hi,\r\n\r\nAll my code is in the attached file. It's very minimal to reproduce the problem. There are few files:\r\n\r\n{code}\r\n~# tree production/\r\nproduction/\r\n|-- manifests/\r\n|   `-- site.pp\r\n|-- modules/\r\n|   |-- moda/\r\n|   |   `-- lib/\r\n|   |       `-- puppet/\r\n|   |           `-- functions/\r\n|   |               `-- moda/\r\n|   |                   `-- foo.rb\r\n|   `-- modb/\r\n|       |-- lib/\r\n|       |   `-- puppet/\r\n|       |       `-- functions/\r\n|       |           `-- modb/\r\n|       |               `-- bar.rb\r\n|       |-- manifests/\r\n|       |   `-- init.pp\r\n|       `-- metadata.json\r\n`-- environment.conf\r\n{code}\r\n\r\nIn the {{site.pp}} I just include the {{modb}} puppet class. And in the {{modb}} class I use a custom function {{:modb::bar()}} which calls another function from the {{moda}} module. I have this error:\r\n\r\n{code}\r\nroot@puppet4:~# puppet agent --test\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nError: Could not retrieve catalog from remote server: Error 400 on SERVER: Evaluation Error: Error while evaluating a Function Call, Function modb::bar(): cannot call function '::moda::foo' - not found at /etc/puppetlabs/code/environments/production/modules/modb/manifests/init.pp:4:32 on node puppet4.athome.priv\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\n{code}\r\n\r\nAnd the *very* *very* curious behavior: if I *just* remove the {{metadata.json}} of the {{modb}} module (no other operation), the puppet run works well!\r\n\r\n{code}\r\nroot@puppet4:~# rm /etc/puppetlabs/code/environments/production/modules/modb/metadata.json \r\nroot@puppet4:~# puppet agent --test\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Caching catalog for puppet4.athome.priv\r\nInfo: Applying configuration version '1441677483'\r\nNotice: foo\r\nNotice: /Stage[main]/Modb/Notify[Test1]/message: defined 'message' as 'foo'\r\nNotice: bar\r\nNotice: /Stage[main]/Modb/Notify[Test2]/message: defined 'message' as 'bar'\r\nNotice: Applied catalog in 0.04 seconds\r\n{code}\r\n\r\nRegards.\r\nFrançois Lafont\r\n","closed_at":"2016-01-26T06:52:49.000-0800","comments":28,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5209","labels":"","state":"Closed","updated_at":"2016-01-26T06:52:49.000-0800","timestamp":1652284982.914239,"priority":"Normal","status_category":"Done","pull_request":4533},{"issue_id":"94525","title":"Puppet 4 --profile is not complete compared to 3","url":"https://tickets.puppetlabs.com/browse/PUP-5063","created_at":"2015-08-21T07:24:57.000-0700","number":"PUP-5063","body":"Given sample code like:\r\n\r\n{code}\r\nclass profile_test {\r\n  notice(\"hello from ${name}\")\r\n  notify{\"inside ${name}\": }\r\n}\r\n\r\ninclude profile_test\r\n{code}\r\n\r\nPuppet 3 profiler were quite handy and complete:\r\n\r\n{code}\r\nDebug: Runtime environment: run_mode=user, puppet_version=3.7.5, ruby_version=1.8.7\r\nDebug: PROFILE [apply] 1 Setup server facts for compiling: took 0.0001 seconds\r\nDebug: PROFILE [apply] 2.1 Compile: Set node parameters: took 0.0013 seconds\r\nDebug: PROFILE [apply] 2.2 Compile: Created settings scope: took 0.0305 seconds\r\nNotice: Scope(Class[Profile_test]): hello from profile_test\r\nDebug: PROFILE [apply] 2.3.1.1 Called notice: took 0.0002 seconds\r\nDebug: PROFILE [apply] 2.3.1 Called include: took 0.0061 seconds\r\nDebug: PROFILE [apply] 2.3 Compile: Evaluated main: took 0.0097 seconds\r\nDebug: PROFILE [apply] 2.4 Compile: Evaluated AST node: took 0.0000 seconds\r\nDebug: PROFILE [apply] 2.5 Compile: Evaluated node classes: took 0.0001 seconds\r\nDebug: PROFILE [apply] 2.6.1.1 Evaluated definitions: took 0.0000 seconds\r\nDebug: PROFILE [apply] 2.6.1 Iterated (1) on generators: took 0.0004 seconds\r\nDebug: PROFILE [apply] 2.6 Compile: Evaluated generators: took 0.0007 seconds\r\nDebug: PROFILE [apply] 2.7 Compile: Finished catalog: took 0.0005 seconds\r\nDebug: PROFILE [apply] 2 Compiled catalog for devco.net in environment production: took 0.0542 seconds\r\n.\r\n.\r\n.\r\n.\r\nDebug: functions: 0.006307 ms (2 calls)\r\nDebug: functions -> include: 0.006126 ms (1 calls)\r\nDebug: functions -> notice: 0.000181 ms (1 calls)\r\n{code}\r\n\r\nIn puppet4 there is no mention of the notice() and so the stats is even just wrong:\r\n\r\n{code}\r\nDebug: functions: 0.004328061 s (1 calls)\r\nDebug: functions -> include: 0.004328061 s (1 calls)\r\n{code}\r\n\r\nNot sure if this only affect a certain class of function - like legacy ones maybe vs ones of the new API, did not investigate that.","closed_at":"2016-01-26T06:52:50.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5063","labels":"","state":"Closed","updated_at":"2016-01-26T06:52:50.000-0800","timestamp":1652284983.020388,"priority":"Normal","status_category":"Done","pull_request":4489},{"issue_id":"95900","title":"unterminated c-style comment causes hang","url":"https://tickets.puppetlabs.com/browse/PUP-5127","created_at":"2015-08-31T19:49:10.000-0700","number":"PUP-5127","body":"In my manifest file for my node, I had an unterminated c-style comment:\r\n\r\nhaving a manifest file containing {{/\\*}} is sufficient to cause this (though other stupid errors like terminating with another {{/\\*}} or bad nesting can also trigger the bug).\r\n\r\nTested with a simple:\r\n\r\n{noformat}\r\nstrace -fff puppet master --debug --no-daemonize --compile puppet-agent \r\n{noformat}\r\n\r\nrelevant strace output:\r\n{noformat}\r\n[pid  3469] stat(\"/etc/puppet/environments/vagrant/manifests/puppet-agent.pp\", {st_mode=S_IFREG|0644, st_size=5, ...}) = 0\r\n[pid  3469] stat(\"/etc/puppet/environments/vagrant/manifests/puppet-agent.pp\", {st_mode=S_IFREG|0644, st_size=5, ...}) = 0\r\n[pid  3469] stat(\"/etc/puppet/environments/vagrant/manifests/puppet-agent.pp\", {st_mode=S_IFREG|0644, st_size=5, ...}) = 0\r\n[pid  3469] open(\"/etc/puppet/environments/vagrant/manifests/puppet-agent.pp\", O_RDONLY) = 5\r\n[pid  3469] fstat(5, {st_mode=S_IFREG|0644, st_size=5, ...}) = 0\r\n[pid  3469] fstat(5, {st_mode=S_IFREG|0644, st_size=5, ...}) = 0\r\n[pid  3469] ioctl(5, SNDCTL_TMR_TIMEBASE or SNDRV_TIMER_IOCTL_NEXT_DEVICE or TCGETS, 0x7fff7c8788e0) = -1 ENOTTY (Inappropriate ioctl for device)\r\n[pid  3469] fstat(5, {st_mode=S_IFREG|0644, st_size=5, ...}) = 0\r\n[pid  3469] lseek(5, 0, SEEK_CUR)       = 0\r\n[pid  3469] read(5, \"  /*\\n\", 5)        = 5\r\n[pid  3469] read(5, \"\", 8192)           = 0\r\n[pid  3469] close(5)                    = 0\r\n{noformat}\r\n\r\nI was originally suspecting that it was trying to read() past EOF looking for the comment terminator (and perhaps it still is) but it looks like it hangs after close()\r\n\r\nThis causes a complete hang of puppet after that line. I left it running for about 20 minutes and it still persistently hung.","closed_at":"2016-01-26T06:52:50.000-0800","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5127","labels":"","state":"Closed","updated_at":"2016-01-26T06:52:50.000-0800","timestamp":1652284983.125573,"priority":"Major","status_category":"Done","pull_request":4457},{"issue_id":"107878","title":"parse_string doesnt interpolate %{key} with Puppet 4.0","url":"https://tickets.puppetlabs.com/browse/PUP-5578","created_at":"2015-12-02T00:37:22.000-0800","number":"PUP-5578","body":"Several backends need to pass {{%\\{key\\}}} to `Backend.parse_string` in order for it to get interpolated, hiera-http and hiera-mysql are both examples of this.  In Puppet 4.0 the {{%\\{key\\}}} does not get interpolated (regardless of the hiera version) but running hiera from the command line does work.  So I'm unsure if this is a PUPPET or HIERA issue, but I'm filing it here to start with.\r\n\r\nPlease see https://github.com/crayfishx/hiera-http/issues/38 for a detailed description\r\n\r\n","closed_at":"2016-01-26T06:55:07.000-0800","comments":17,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5578","labels":"","state":"Closed","updated_at":"2016-01-26T06:55:07.000-0800","timestamp":1652284983.36798,"priority":"Major","status_category":"Done","pull_request":4482},{"issue_id":"107178","title":"Debian provider fails on Debian 8 systems without systemd present","url":"https://tickets.puppetlabs.com/browse/PUP-5548","created_at":"2015-11-25T08:49:54.000-0800","number":"PUP-5548","body":"https://github.com/puppetlabs/puppet/commit/75160b78dc4a9189949da50a6b76e42172a45770#commitcomment-14619787 added a bit of logic in the Debian provider for Debian 8 / Ubuntu 15.04 and newer systems to use systemctl to properly determine service status. However, it's possible to remove systemd from a Debian 8 system all together and run entirely with sysvinit. In such a case, the provider will fail as systemctl doesn't exist.\r\n\r\nThe provider should check that systemctl exists before attempting to use it in Debian 8 / Ubuntu 15.04.","closed_at":"2016-01-26T06:55:07.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5548","labels":"","state":"Closed","updated_at":"2016-01-26T06:55:07.000-0800","timestamp":1652284983.471199,"priority":"Normal","status_category":"Done","pull_request":4478},{"issue_id":"109242","title":"Subkeys of lookup_options are found when using Hiera data binding","url":"https://tickets.puppetlabs.com/browse/PUP-5598","created_at":"2015-12-11T04:10:33.000-0800","number":"PUP-5598","body":"If a hiera databinding contains an entry like this:\r\n{code}\r\nlookup_options:\r\n  some::hash:\r\n    merge: deep\r\n{code}\r\nthen while it's impossible to find the key {{lookup_options}} it is possible to find the subentry using the key {{lookup_options.some::hash}}. This is wrong. Neither the {{lookup_options}} hash nor any of its sub-keys should be possible to find using a normal lookup. \r\n","closed_at":"2016-01-26T06:55:07.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5598","labels":"","state":"Closed","updated_at":"2016-01-26T06:55:07.000-0800","timestamp":1652284983.574805,"priority":"Normal","status_category":"Done","pull_request":4496},{"issue_id":"106050","title":"puppet lookup command rejects `--merge first`","url":"https://tickets.puppetlabs.com/browse/PUP-5511","created_at":"2015-11-17T07:23:27.000-0800","number":"PUP-5511","body":"If the lookup data sets a default merge strategy for a key, it's impossible to override that strategy on the CLI and request a first-found lookup. \r\n\r\n{code}\r\n╚ᐅ puppet lookup datatest::testparam --merge first --node stranger.magpie.lan\r\nError: Could not parse application options: The --merge option only accepts 'unique', 'hash', or 'deep'.\r\nRun 'puppet lookup --help' for more details\r\n{code}\r\n\r\nThis prevents a reasonable use case, and it conflicts with the behavior of the lookup() function (which does allow `first` as its third argument and behaves as expected).","closed_at":"2016-01-26T06:55:07.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5511","labels":"","state":"Closed","updated_at":"2016-01-26T06:55:07.000-0800","timestamp":1652284992.852515,"priority":"Normal","status_category":"Done","pull_request":4454},{"issue_id":"109570","title":"Windows package provider can crash with \"Memory access is out of bounds\" when registry values are corrupt","url":"https://tickets.puppetlabs.com/browse/PUP-5640","created_at":"2015-12-15T07:46:17.000-0800","number":"PUP-5640","body":"I was adding some software packages for Windows when I started getting the following error:\r\nError: Failed to apply catalog: Memory access offset=0 size=4 is out of bounds\r\n\r\nI tried the following, but continued to get the same error:\r\n* rerun puppet agent\r\n* restart Windows computer\r\n* uninstall and reinstall puppet agent completely (including deleting everything from %programdata% folder)\r\n* restart puppetserver and the machine puppetserver runs on\r\n* revert to old version of production environment code that was working previously\r\n\r\nI know very little about coding in Ruby, but poking around a little based on the debug output didn't lead me to anything obvious.\r\n\r\nIt sounds like an array index out of bounds, maybe?\r\n\r\nIf anyone has tips on how to further debug (stack trace, etc.), I'm happy to try and contribute to a solution, just not sure where to go from here.\r\n\r\nAttached is a log of the debug run with some domain names and user account names changed for privacy.  You can see the error pop up four lines from the bottom.","closed_at":"2016-01-26T06:55:07.000-0800","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5640","labels":"puppet-agent;windows","state":"Closed","updated_at":"2016-01-26T06:55:07.000-0800","timestamp":1652284992.957711,"priority":"Normal","status_category":"Done","pull_request":4534},{"issue_id":"103618","title":"puppet lookup command too verbose: implied application of manifest (site.pp by default) and all its output","url":"https://tickets.puppetlabs.com/browse/PUP-5461","created_at":"2015-10-30T09:15:45.000-0700","number":"PUP-5461","body":"'puppet lookup symbol' is supposed to return the value of symbol as discovered by the lookup() function.  There is an implied application of a manifest (production environment, site.pp by default).  If these manifests generate output, then that becomes part of the output of the puppet lookup command.\r\n\r\nHere is an example using branch=master, sha = ef9569c59088b85ad8476695a24d479be0dfb376\r\n{code}\r\n[root@lmrgtt9kjyg5esn manifests]# puppet --version\r\n4.3.0\r\n[root@lmrgtt9kjyg5esn manifests]# pwd\r\n/etc/puppetlabs/code/environments/production/modules/data_module/manifests\r\n[root@lmrgtt9kjyg5esn manifests]# cat init.pp\r\n\r\nclass data_module(\r\n) {\r\n  notice(\"Hello from modules/data_module/manifests/init.pp!\")\r\n  notice(\"Goodbye from modules/data_module/manifests/init.pp!\")\r\n}\r\n[root@lmrgtt9kjyg5esn manifests]# puppet lookup data_module::key_in_module\r\nNotice: Scope(Class[Data_module]): Hello from modules/data_module/manifests/init.pp!\r\nNotice: Scope(Class[Data_module]): Goodbye from modules/data_module/manifests/init.pp!\r\n--- data_module1\r\n...\r\n[root@lmrgtt9kjyg5esn manifests]#\r\n{code}\r\nThe expected value is only at the end of the output.","closed_at":"2016-01-26T06:55:08.000-0800","comments":23,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5461","labels":"","state":"Closed","updated_at":"2016-01-26T06:55:08.000-0800","timestamp":1652284993.067899,"priority":"Normal","status_category":"Done","pull_request":4546},{"issue_id":"107246","title":"epp template don't check param, just check the number of params","url":"https://tickets.puppetlabs.com/browse/PUP-5552","created_at":"2015-11-26T07:14:38.000-0800","number":"PUP-5552","body":"when we tried tu do template, only the number of parametter are check.\r\n\r\nWhy if i defined a list of parameters, when call the template whith most number of parameter, the compilator return un error.\r\n\r\nIf i call the template with other parameter name that i have declared in the epp template, i have no compilator error","closed_at":"2016-01-26T06:55:08.000-0800","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5552","labels":"","state":"Closed","updated_at":"2016-01-26T06:55:08.000-0800","timestamp":1652284993.175121,"priority":"Normal","status_category":"Done","pull_request":4475},{"issue_id":"110205","title":"Functions written in Puppet language errors don't mention the file","url":"https://tickets.puppetlabs.com/browse/PUP-5628","created_at":"2015-12-21T00:12:46.000-0800","number":"PUP-5628","body":"With Puppet 4 you've done a fantastic job of improving the error messages to indicate the specific file, and the underlying problem. Bravo!\r\n\r\nCould you add a bit of love to the functions written in the Puppet language? They don't mention which function name, which file name, nothing. All I know is that some Puppet function has an error in it:\r\n\r\n{code}Error: Could not retrieve catalog from remote server: Error 400 on SERVER: Syntax error at ')' at line 26:38 on node client.example.com\r\n{code}\r\n\r\nThe same problem appears when calling log functions and {{fail()}} in particular.\r\n\r\n{code}\r\nError: Could not retrieve catalog from remote server: Error 400 on SERVER: Evaluation Error: Error while evaluating a Function Call, Cannot convert 'True' to a boolean value. at line 13:18 on node client.example.com\r\n{code}","closed_at":"2016-01-26T06:55:08.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5628","labels":"","state":"Closed","updated_at":"2016-01-26T06:55:08.000-0800","timestamp":1652284993.278933,"priority":"Normal","status_category":"Done","pull_request":4529},{"issue_id":"111132","title":"A puppet function declaration must be a top level construct","url":"https://tickets.puppetlabs.com/browse/PUP-5651","created_at":"2016-01-05T08:19:33.000-0800","number":"PUP-5651","body":"It's currently possible to write:\r\n{code:puppet}\r\nclass foo {\r\n  function bar() {\r\n  }\r\n}\r\n{code}\r\nThis should not be possible since a function is a top level construct.","closed_at":"2016-01-26T06:55:08.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5651","labels":"","state":"Closed","updated_at":"2016-01-26T06:55:08.000-0800","timestamp":1652284993.382215,"priority":"Normal","status_category":"Done","pull_request":4554},{"issue_id":"109019","title":"hiera lookup regression in resource like class definitions with undef parameter","url":"https://tickets.puppetlabs.com/browse/PUP-5592","created_at":"2015-12-10T02:45:48.000-0800","number":"PUP-5592","body":"Another regression with hiera lookups if classes are defined resource like and a parameter is configured undef. With prior versions a hiera lookup happened for this parameter. With 4.3.x no lookup occurs. Short reproducer:\r\n\r\n* hiera.yaml:\r\n{code:java}\r\n---\r\n:backends:\r\n  - yaml\r\n\r\n:hierarchy:\r\n  - global\r\n\r\n:yaml:\r\n  :datadir: \"/etc/puppetlabs/code/hiera\"\r\n{code}\r\n\r\n* /etc/puppetlabs/code/hiera/global.yaml:\r\n{code:java}\r\ntest::p: 'hiera value'\r\n{code}\r\n\r\n* test module: /etc/puppetlabs/code/modules/test/manifests/init.pp:\r\n{code:java}\r\nclass test (\r\n  $p = 'default module value',\r\n) {\r\n  notice($p)\r\n}\r\n{code}\r\n\r\nwith puppet 4.3.1:\r\n{code:java}\r\npuppet apply --hiera_config [..]/hiera.yaml --modulepath=/etc/puppetlabs/code/modules -e 'class { \"test\": p => undef }'\r\nNotice: Scope(Class[Test]): default module value\r\nNotice: Compiled catalog for puppet4.3.1 in environment production in 0.10 seconds\r\n{code}\r\n\r\nwith puppet 4.2.3:\r\n{code:java}\r\npuppet apply --hiera_config [..]/hiera.yaml --modulepath=/etc/puppetlabs/code/modules -e 'class { \"test\": p => undef }'\r\nNotice: Scope(Class[Test]): hiera value\r\nNotice: Compiled catalog for puppet4.2.3 in environment production in 0.65 seconds\r\n{code}\r\n\r\nAnd an example were this happens in the wild is the module jfryman-nginx with the parameter migration from init.pp to config.pp (an example parameter is server_tokens among others).","closed_at":"2016-01-26T06:55:08.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5592","labels":"","state":"Closed","updated_at":"2016-01-26T06:55:08.000-0800","timestamp":1652284993.485815,"priority":"Normal","status_category":"Done","pull_request":4492},{"issue_id":"109146","title":"Generated resource state is retrieved prematurely","url":"https://tickets.puppetlabs.com/browse/PUP-5595","created_at":"2015-12-10T11:41:09.000-0800","number":"PUP-5595","body":"Issue discovered while working with the {{lwf/remote_file}} type/provider.\r\n\r\nRemote_file generates a file resource to enforce owner, group and mode parameters. The following is an example use of the resource.\r\n\r\n{code}\r\nremote_file { 'download':\r\n  source      => 'https://github.com/dimetron/vagrant_docker_dbora12c/archive/master.zip',\r\n  path        => \"/tmp/linuxamd64_12102_database_1of2.zip\",\r\n  verify_peer => false,\r\n  mode        => '0644',\r\n}\r\n{code}\r\n\r\nThis worked as expected in Puppet 4.2.x However, in Puppet 4.3.1, there is a problem. This is the output from puppet applying this code.\r\n\r\n{code}\r\n[reidmv@halcyon:~/] % puppet apply ~/src/tse-control-repo/test.pp\r\nNotice: Compiled catalog for halcyon.corp.puppetlabs.net in environment production in 0.06 seconds\r\nNotice: /Stage[main]/Main/Remote_file[download]/ensure: created\r\nNotice: /Stage[main]/Main/File[/tmp/linuxamd64_12102_database_1of2.zip]/ensure: created\r\nNotice: Applied catalog in 1.03 seconds\r\n[reidmv@halcyon:~/] % ls -l /tmp/linuxamd64_12102_database_1of2.zip\r\n-rw-r--r-- 1 reidmv staff 0 Dec 10 10:49 /tmp/linuxamd64_12102_database_1of2.zip\r\n[reidmv@halcyon:~/] %\r\n{code}\r\n\r\nNotice that the generated File resource re-creates the file (as an empty file) rather than just changing the mode.\r\n\r\nIf the code directly specifies Remote_file without mode (so no generated file resource) and the File resource explicitly, the behavior is as expected.\r\n\r\n{code}\r\nremote_file { 'download':\r\n  source      => 'https://github.com/dimetron/vagrant_docker_dbora12c/archive/master.zip',\r\n  path        => \"/tmp/linuxamd64_12102_database_1of2.zip\",\r\n  verify_peer => false,\r\n}\r\n\r\nfile { \"download\":\r\n  path => \"/tmp/linuxamd64_12102_database_1of2.zip\",\r\n  mode => '0644',\r\n}\r\n{code}\r\n\r\nThen Puppet outputs the following on apply:\r\n\r\n{code}\r\n[reidmv@halcyon:~/] % puppet apply ~/src/tse-control-repo/test.pp\r\nNotice: Compiled catalog for halcyon.corp.puppetlabs.net in environment production in 0.05 seconds\r\nNotice: /Stage[main]/Main/Remote_file[download]/ensure: created\r\nNotice: /Stage[main]/Main/File[download]/mode: mode changed '0600' to '0644'\r\nNotice: Applied catalog in 0.92 seconds\r\n[reidmv@halcyon:~/] %\r\n{code}\r\n\r\nThe generated file resource fails to correctly detect that the file already exists.\r\n\r\nWe played around with pry for a bit trying to figure out what was going on and figured out that ensure’s retrieve method was called for the generated file before the remote_file resource was evaluated. The stacktrace from when retrieve is called in 4.3.1 with the generated resource is attached (ignore the line number on the top of the stack as it's off due to our debugging code).\r\n\r\nThe resource graphs for each manifest are attached as well.\r\n","closed_at":"2016-01-26T06:55:08.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5595","labels":"","state":"Closed","updated_at":"2016-01-26T06:55:08.000-0800","timestamp":1652284993.589208,"priority":"Normal","status_category":"Done","pull_request":4490},{"issue_id":"107196","title":"package version behavior for epoch versioned rpm's in centos is broken.","url":"https://tickets.puppetlabs.com/browse/PUP-5549","created_at":"2015-11-25T10:41:58.000-0800","number":"PUP-5549","body":"puppet-agent 1.3.0\r\nCentOS 7\r\n\r\nI just upgraded from puppet-agent 1.2.4 and all of a sudden I have multiple packages throwing the following notice every single puppet run:\r\n{code:}\r\nNotice: /Stage[main]/Logstash::Package/Logstash::Package::Install[logstash]/Package[logstash]/ensure: ensure changed '1:1.5.5-1' to '1.5.5-1'\r\n{code:}\r\nI'm not 100% positive, but it looks as though this change made be the culprit:\r\nhttps://tickets.puppetlabs.com/browse/PUP-5025\r\n\r\nI tried adding the epoch to the begging of the version given to puppet and I get this:\r\n{code:}\r\nError: Could not update: Execution of '/usr/bin/yum -d 0 -e 0 -y install logstash-1:1.5.5-1' returned 1: Error: Nothing to do\r\nError: /Package[logstash]/ensure: change from purged to 1:1.5.5-1 failed: Could not update: Execution of '/usr/bin/yum -d 0 -e 0 -y install logstash-1:1.5.5-1' returned 1: Error: Nothing to do\r\n{code:}\r\n\r\n","closed_at":"2016-01-26T06:55:08.000-0800","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5549","labels":"","state":"Closed","updated_at":"2016-01-26T06:55:08.000-0800","timestamp":1652284993.694384,"priority":"Normal","status_category":"Done","pull_request":4474},{"issue_id":"105572","title":"lookup adapter \"lookup_global\" produces bad error message for faulty hiera.yaml","url":"https://tickets.puppetlabs.com/browse/PUP-5502","created_at":"2015-11-12T17:11:44.000-0800","number":"PUP-5502","body":"When there is something wrong with the yaml syntax in a {{hiera.yaml}} the error message produced by the logic in lookup_adapter.lookup_global is not very helpful. It shows the error message twice, the reference to the faulty file says {{<unknown>}}, and the stack trace that is produced is for the location in the lookup_adapter, not where the error occurred. \r\n\r\nTo trigger the error use a hiera yaml with a hierachy like this:\r\n{code:yaml}\r\n:hierarchy:\r\n  - %{boom}\r\n{code}\r\n(error is that there should be quotes around the entry)\r\n\r\nThe error can look like this:\r\n{code}\r\nError: Could not run: Error from DataBinding 'hiera' while looking up 'lookup_options': (<unknown>): found character that cannot start any token while scanning for the next token at line 3 column 11 in (<unknown>): found character that cannot start any token while scanning for the next token at line 3 column 11\r\n{code}\r\n\r\nI think this is of importance to fix since it provides no clue to the user where the error may be. ","closed_at":"2016-01-26T06:55:10.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5502","labels":"","state":"Closed","updated_at":"2016-01-26T06:55:10.000-0800","timestamp":1652284993.903304,"priority":"Normal","status_category":"Done","pull_request":4483},{"issue_id":"111804","title":"Windows ADSI User and Group exists? checks are invalid","url":"https://tickets.puppetlabs.com/browse/PUP-5684","created_at":"2016-01-10T14:30:38.000-0800","number":"PUP-5684","body":"{{Puppet::Util::Windows::ADSI::User}} and {{Puppet::Util::Windows::ADSI::Group}} both implement an exists member something like:\r\n\r\n{code}\r\ndef self.exists?(name)\r\n  Puppet::Util::Windows::ADSI.connectable?(Group.uri(name))\r\nend\r\n{code}\r\n\r\nSee https://github.com/puppetlabs/puppet/blob/d26bfd2e9ba08f092114348ebad5e4421270f315/lib/puppet/util/windows/adsi.rb#L324-L326 and https://github.com/puppetlabs/puppet/blob/d26bfd2e9ba08f092114348ebad5e4421270f315/lib/puppet/util/windows/adsi.rb#L467-L469\r\n\r\nThis code is actually incorrect, because a uri like {{WinNT://<SID>}} might be errantly built inside the {{uri}} method and consumed by the {{exists?}} method.  Such a {{WinNT://}} style URI is technically valid, but only for very specific use cases; it cannot be used as a moniker to resolve a user or group when calling {{WIN32OLE.connect}}.  So a COM object that is returned when calling {{WIN32OLE.connect('WinNT://<SID>')}} implements [IADs|https://msdn.microsoft.com/en-us/library/windows/desktop/aa705950(v=vs.85).aspx] but not {{IADsGroup}} or {{IADsUser}}.  When retrieving the {{.Class}} property, the value is always going to be {{\"Domain\"}} (even though the object returned is not an {{IADsDomain}}.\r\n\r\nThis was discovered during the testing of PUP-5538, and should be fixed prior to that PR being merged.\r\n\r\n{noformat}\r\n[37] pry(main)> admins_by_name = WIN32OLE.connect('WinNT://./Administrators,group')\r\n=> #<WIN32OLE:0x00000008f260e0>\r\n[38] pry(main)> admins_by_name.Class\r\n=> \"Group\"\r\n[39] pry(main)> admins_by_name.objectSID\r\n=> [1, 2, 0, 0, 0, 0, 0, 5, 32, 0, 0, 0, 32, 2, 0, 0]\r\n\r\n\r\n[40] pry(main)> admins_by_sid = WIN32OLE.connect('WinNT://S-1-5-32-544')\r\n=> #<WIN32OLE:0x000000088429b8>\r\n[41] pry(main)> admins_by_sid.Class\r\n=> \"Domain\"\r\n[42] pry(main)> admins_by_sid.objectSID\r\nNoMethodError: unknown property or method: `objectSID'\r\n    HRESULT error code:0x80020006\r\n      Unknown name.\r\nfrom (pry):42:in `method_missing'\r\n{noformat}\r\n\r\nThe methods {{sid_uri}} and {{sid_uri_safe}} should **only be used** to generate a SID style uri when adding members to a group via [IADsGroup::Add|https://msdn.microsoft.com/en-us/library/windows/desktop/aa706022(v=vs.85).aspx]","closed_at":"2016-01-26T06:55:10.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5684","labels":"windows","state":"Closed","updated_at":"2016-01-26T06:55:10.000-0800","timestamp":1652284994.008353,"priority":"Blocker","status_category":"Done","pull_request":4564},{"issue_id":"108821","title":"Type without namevar causes failures with no error","url":"https://tickets.puppetlabs.com/browse/PUP-5589","created_at":"2015-12-08T21:05:43.000-0800","number":"PUP-5589","body":"When trying to compile a catalog with a resource type that does not have a namevar specified in the type (ie, no parameter with `:namevar => true` and no `isnamevar` call) then the puppet run will exit 1 as soon as the catalog compile is finished with no back trace, error message, or any other indicator that anything is wrong.\r\n\r\nThis makes it extremely difficult to debug (ie, guessing at what is missing).","closed_at":"2016-01-26T06:55:10.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5589","labels":"","state":"Closed","updated_at":"2016-01-26T06:55:10.000-0800","timestamp":1652284994.113669,"priority":"Normal","status_category":"Done","pull_request":4532},{"issue_id":"109557","title":"Error message for declaring resource without title is confusing","url":"https://tickets.puppetlabs.com/browse/PUP-5612","created_at":"2015-12-15T01:34:30.000-0800","number":"PUP-5612","body":"When someone makes the mistake of doing something like this\r\n\r\n{code}\r\nexec {\r\n  command => 'do something',\r\n}\r\n{code}\r\n\r\nPuppet will complain with:\r\n{code}\r\n A Host Class Definition can not end with a value-producing expression without other effect\r\n{code}\r\n\r\nThis error message is incredibly confusing to anyone without a deeper understanding of the language. What \"host class definition\"?","closed_at":"2016-01-26T06:55:10.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5612","labels":"","state":"Closed","updated_at":"2016-01-26T06:55:10.000-0800","timestamp":1652284994.219455,"priority":"Normal","status_category":"Done","pull_request":4535},{"issue_id":"110900","title":"puppet lookup command creates new SSL hierarchy with self-signed CA","url":"https://tickets.puppetlabs.com/browse/PUP-5644","created_at":"2016-01-03T02:38:03.000-0800","number":"PUP-5644","body":"Puppet lookup docs says it works on both masterless Puppet nodes, and nodes with a Puppet master (perhaps the docs should say server?). However it fails on agents, and produces an unexpected and unwelcome side effect on Puppet apply nodes.\r\n\r\nWhen using a masterless Puppet it creates a new SSL directory and populates a CA with a new key in the local node's name.\r\n\r\n{code}\r\n[vagrant@client ~]$ cd .puppetlabs/etc/puppet\r\n\r\n[vagrant@client puppet]$  ls -la ssl\r\nls: cannot access ssl: No such file or directory\r\n\r\n[vagrant@client puppet]$  puppet lookup puppet4::config\r\nNotice: Signed certificate request for ca\r\n---\r\nlog_level: info\r\n\r\n[vagrant@client puppet]$ ls -la ssl\r\ntotal 4\r\ndrwxrwx--x 8 vagrant vagrant 119 Jan  3 10:23 .\r\ndrwxrwxr-x 4 vagrant vagrant  49 Jan  3 10:23 ..\r\ndrwxr-xr-x 5 vagrant vagrant 149 Jan  3 10:23 ca\r\ndrwxr-xr-x 2 vagrant vagrant   6 Jan  3 10:23 certificate_requests\r\ndrwxr-xr-x 2 vagrant vagrant  19 Jan  3 10:23 certs\r\n-rw-r--r-- 1 vagrant vagrant 967 Jan  3 10:23 crl.pem\r\ndrwxr-x--- 2 vagrant vagrant   6 Jan  3 10:23 private\r\ndrwxr-x--- 2 vagrant vagrant   6 Jan  3 10:23 private_keys\r\ndrwxr-xr-x 2 vagrant vagrant   6 Jan  3 10:23 public_keys\r\n\r\n$ openssl x509 -subject -fingerprint -noout -in ssl/ca/ca_crt.pem \r\nsubject= /CN=Puppet CA: client.example.com\r\nSHA1 Fingerprint=DB:A7:FE:80:37:5A:1E:91:C9:FD:B7:0B:88:0E:D0:7D:54:4C:5E:C8\r\n{code}\r\n\r\nFurthermore, on systems which do have an existing Puppet server, it produces the same local CA creation and then complains about the certificate not matching:\r\n\r\n{code}\r\nvagrant@client ssl]$ puppet lookup puppet4::config\r\nError: Could not prepare for execution: The certificate retrieved from the master does not match the agent's private key.\r\nCertificate fingerprint: 01:56:F3:17:17:A9:65:40:85:04:93:F3:14:A2:6A:A1:AE:DE:B3:52:0E:E7:B7:11:BD:4B:8C:64:74:EF:53:F9\r\nTo fix this, remove the certificate (blah blah blah...)\r\n{code}\r\n\r\nAs before it has created a new SSL CA locally, which of course doesn't match the key used on the node's real certificate.\r\n\r\n{code}\r\n[vagrant@client puppet]$ ls -la ssl/ca\r\ntotal 8\r\ndrwxr-xr-x 5 vagrant vagrant   82 Jan  3 10:33 .\r\ndrwxrwx--x 8 vagrant vagrant  119 Jan  3 10:33 ..\r\n-rw-r----- 1 vagrant vagrant 3243 Jan  3 10:33 ca_key.pem\r\n-rw-r--r-- 1 vagrant vagrant  800 Jan  3 10:33 ca_pub.pem\r\ndrwxr-x--- 2 vagrant vagrant    6 Jan  3 10:33 private\r\ndrwxr-xr-x 2 vagrant vagrant    6 Jan  3 10:33 requests\r\ndrwxr-xr-x 2 vagrant vagrant    6 Jan  3 10:33 signed\r\n{code}","closed_at":"2016-01-26T06:55:10.000-0800","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5644","labels":"","state":"Closed","updated_at":"2016-01-26T06:55:10.000-0800","timestamp":1652284994.325402,"priority":"Major","status_category":"Done","pull_request":4542},{"issue_id":"78014","title":"Yum package provider: ensure => latest fails when obsoleted packages are present","url":"https://tickets.puppetlabs.com/browse/PUP-4497","created_at":"2015-04-29T15:46:49.000-0700","number":"PUP-4497","body":"When the yum provider has packages marked as obsoleted, the yum provider fails to ensure => latest on a package.\r\n{noformat}\r\n[root@localhost provider]# puppet apply -e \"package{'puppet-agent': ensure => 'latest'}\"\r\nNotice: Compiled catalog for centos-70-x64.ineu.us in environment production in 0.79 seconds\r\nError: Could not get latest version: undefined method `[]' for nil:NilClass\r\nError: /Stage[main]/Main/Package[puppet-agent]/ensure: change from 1.0.1-1.el7 to latest failed: Could not get latest version: undefined method `[]' for nil:NilClass\r\nNotice: Applied catalog in 0.38 seconds\r\n{noformat}\r\nTo duplicate, bring up a CentOS7.0 VM, install puppet-agent 1.0.1","closed_at":"2016-02-16T05:40:33.000-0800","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4497","labels":"","state":"Closed","updated_at":"2016-02-16T05:40:33.000-0800","timestamp":1652284998.268211,"priority":"Normal","status_category":"Done","pull_request":3960},{"issue_id":"71636","title":"puppetversion fact is missing","url":"https://tickets.puppetlabs.com/browse/PUP-4359","created_at":"2015-03-13T16:05:33.000-0700","number":"PUP-4359","body":"Executing puppet with cfacter and stdlib generates an error every time puppet runs:\r\n\r\n{noformat}\r\n[root@jaiuwwlivqmy8by ~]# puppet --version\r\n4.0.0-rc1\r\n[root@jaiuwwlivqmy8by ~]# facter --version\r\n2.4.2\r\n[root@jaiuwwlivqmy8by ~]# cfacter --version\r\n0.4.0 (commit f4eecdfa9ff69c801bfedba3fc0fd5285e86b3c5)\r\n[root@jaiuwwlivqmy8by ~]# facter puppetversion\r\n4.0.0-rc1\r\n[root@jaiuwwlivqmy8by ~]# cfacter puppetversion\r\n\r\n[root@jaiuwwlivqmy8by ~]# time puppet agent -t --server $(facter fqdn) --cfacter --trace\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nError: Facter: error while resolving custom fact \"pe_version\": undefined method `match' for nil:NilClass\r\nbacktrace:\r\n/opt/puppetlabs/puppet/cache/lib/facter/pe_version.rb:13:in `block (2 levels) in <top (required)>'\r\n/opt/puppetlabs/puppet/cache/lib/facter/pe_version.rb:20:in `call'\r\n/opt/puppetlabs/puppet/cache/lib/facter/pe_version.rb:20:in `value'\r\n/opt/puppetlabs/puppet/cache/lib/facter/pe_version.rb:20:in `block (2 levels) in <top (required)>'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/facts/facter.rb:27:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/facts/facter.rb:27:in `to_hash'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/facts/facter.rb:27:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:194:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer/fact_handler.rb:15:in `find_facts'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer/fact_handler.rb:31:in `facts_for_uploading'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:97:in `get_facts'\r\n{noformat}\r\n\r\nThe error occurs because cfacter doesn't define the {{puppetversion}} fact, which causes stdlib issues:\r\n\r\n{code:ruby}\r\n    pe_ver = Facter.value(\"puppetversion\").match(/Puppet Enterprise (\\d+\\.\\d+\\.\\d+)/)\r\n{code}\r\n\r\nIt makes sense for cfacter to not generate the {{puppetversion}} fact when run standalone (because we don't want a cyclic dependency). But I would think puppet would inject its {{puppetversion}} into facter (whichever implementation is being used), so that the fact is present during fact resolution and later compilation. So arguably this is a puppet issue, but may affect the facter/cfacter interface?\r\n\r\nrisk assessment: high\r\nprobability: high (PE requires)\r\nseverity: high\r\ntest layer: unit\r\n\r\nh3. Resolution:\r\n\r\nPuppet now adds the puppetversion fact if it's using cfacter. ","closed_at":"2016-02-18T02:06:20.000-0800","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4359","labels":"","state":"Closed","updated_at":"2016-02-18T02:06:20.000-0800","timestamp":1652284998.784021,"priority":"Normal","status_category":"Done","pull_request":3836},{"issue_id":"109840","title":"When a module using lookup_options include another using lookup_options the 2nd is ignored","url":"https://tickets.puppetlabs.com/browse/PUP-5618","created_at":"2015-12-16T11:08:56.000-0800","number":"PUP-5618","body":"Given 2 modules both with lookup_options based hiera configuration is used like this:\r\n\r\n{code}\r\nclass profile::base(\r\n  Array[String] $packages = []\r\n) {\r\n  notice($packages)\r\n\r\n  include users\r\n}\r\n{code}\r\n\r\nand the users module is:\r\n\r\n{code}\r\nclass users($local={}) {\r\n  notice($local)\r\n}\r\n{code}\r\n\r\nWith both modules configured to use lookup_options to set the their parameters as merging keys the following happens:\r\n\r\nIncluding the users class directly works, data is merged as per the strategy:\r\n\r\n{code}\r\n$ puppet apply -e 'include users' --test\r\nNotice: Scope(Class[Users]): {bob => {name => Bob, shell => /bin/zsh}}\r\n{code}\r\n\r\nBut if I include the profile - which has its own lookup_options - then the included class strategy is ignored and a first match lookup is done:\r\n\r\n{code}\r\n$ puppet apply -e 'include profile::base' --test\r\nNotice: Scope(Class[Users]): {bob => {shell => /bin/zsh}}\r\n{code}\r\n\r\nI think the description here is probably not enough but it's hard given the amount of files needed to reproduce so I am attaching a tarball with a reproducing setup, extract into ~/.puppetlabs/etc/ and fix the :datadir: path in ~/.puppetlabs/etc/code/hiera.yaml","closed_at":"2016-02-20T15:53:17.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5618","labels":"","state":"Closed","updated_at":"2016-02-20T15:53:17.000-0800","timestamp":1652284999.198029,"priority":"Major","status_category":"Done","pull_request":4512},{"issue_id":"116582","title":"Support Ubuntu 16.04 in systemd provider","url":"https://tickets.puppetlabs.com/browse/PUP-5897","created_at":"2016-02-12T18:37:02.000-0800","number":"PUP-5897","body":"Need to add case for Ubuntu 16.04. Github pull request exists. Making ticket to tie to it.","closed_at":"2016-02-26T11:07:04.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5897","labels":"","state":"Closed","updated_at":"2016-02-26T11:07:04.000-0800","timestamp":1652285000.545873,"priority":"Normal","status_category":"Done","pull_request":4667},{"issue_id":"103139","title":"$trusted is not available in master compile and fails when coming from PDB","url":"https://tickets.puppetlabs.com/browse/PUP-5441","created_at":"2015-10-27T18:59:24.000-0700","number":"PUP-5441","body":"There are two sides to this problem:\r\n* As the subject says - the information in {{$trusted}} is not available when running applications like {{puppet master compile}} and {{puppet lookup}} under most normal configurations (unless being hit by the next part of the problem)\r\n* When having a configuration that directly hits puppet db for information, puppet db stores the trusted information as a regular node parameter. When puppet db terminus returns that, an attempt is subsequently made to set the privileged scope variable {{$trusted}} and that is rejected. There are several tickets that report this problem.\r\n\r\nResurrecting $trusted\r\n-----\r\nWe absolutely do want to resurrect the {{$trusted}} information. If not done, then {{puppet master compile}} will not work if manifests include use of {{$trusted}}, or (as recommended) that the hiera hierarchy uses {{$trusted}} to get a trusted certname as part of the path to data.\r\n\r\nWe should therefore resurrect the information in a reasonable way. This means two things:\r\n* When caching a node - it should cache the trusted facts as a parameter with the name {{\"trusted\"}} just like it is done in puppet db.\r\n* A {{node}} given to the {{compiler}} should be \"sanitized\" before it is used. If there is real trusted data (from a remote request) or from a self authenticated local \"apply\" available, that trusted data should be used. If not available, but available in form of parameters looked up from the node indirection (cache or backing store) that trusted information should be used with one extra processing step being performed.\r\n* If the trusted information comes from the indirection, the attribute {{authenticated}} should be set to {{false}} if the process is not running as root, otherwise, this attribute retains its value (i.e. most likely the value \"remote\" which means that the node cert was used to authenticate).\r\n\r\nNote that the difference in {{$trusted[authenticated]}} is of importance for those that manage secrets as it can be used to take an alternative path in the logic - using anonymized/boilerplate values instead of real values. This is of value if users should be able to run {{master compile}} to debug what is going on in a catalog, but they are not authorized to see certain values. (A fairly advanced use-case). Running as root allows a user to run exactly as if a request was authenticated from a cert - the user must know that the configuration is safe - i.e. that a backing store/cache is in use that can be trusted. \r\n\r\nRelationship to other tickets/reportd problems\r\n----\r\nThis ticket was created because although there are several other reports of the error when trusted is being processed as a parameter - the conditions that cause the problem to occur are different - the reported error typically masks a different error (a configuration failure).\r\n\r\nHere are some of the causes:\r\n\r\n* routes setting points to the wrong or non existing routes.yaml file\r\n* the routes are wrong\r\n* the wrong terminus is used for PDB cache\r\n* user has experimented with termini and have bad data in the cache\r\n* there is a time skew between agent and master that causes a cache miss (cache timeout is taken from {{runinterval}} setting).\r\n* settings for termini are not done which results in defaults being used which leaves it up to the applications used to set the terminus based on if it is running in master, or agent mode. A setting of 'none' is sometimes (rare) what should have been used.\r\n\r\nThe detection of which of these cases that triggrs the 'trusted problem' is difficult to find as the build up of the settings typically fall back on defaults when things are missing (there are several cases above where an error or a warning should be issued to make it easier to find the problem).","closed_at":"2016-03-11T18:02:50.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5441","labels":"","state":"Closed","updated_at":"2016-03-11T18:02:50.000-0800","timestamp":1652285001.96909,"priority":"Blocker","status_category":"Done","pull_request":4390},{"issue_id":"103829","title":"Resource Collectors cannot use resource references in search expressions","url":"https://tickets.puppetlabs.com/browse/PUP-5465","created_at":"2015-11-02T08:56:28.000-0800","number":"PUP-5465","body":"In Puppet 4, resource collectors cannot use resource references in the search expression. This is an ability that did work in Puppet 3 and is currently in the documentation for Puppet 4.\r\n\r\nThe following code in Puppet,\r\n\r\n{code:puppet}\r\nFile<| notify == Service['foo'] |>\r\n{code}\r\n\r\nproduces the error,\r\n\r\n{{Error: Evaluation Error: Error while evaluating a Virtual Query, Cannot transform object of class Puppet::Pops::Model::AccessExpression at /private/tmp/collection.pp:1:1 on node tom-mbp}}\r\n","closed_at":"2016-03-16T17:17:28.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5465","labels":"","state":"Closed","updated_at":"2016-03-16T17:17:28.000-0700","timestamp":1652285002.288321,"priority":"Normal","status_category":"Done","pull_request":4511},{"issue_id":"111996","title":"benchmark:function_loading aborts with stack overflow","url":"https://tickets.puppetlabs.com/browse/PUP-5693","created_at":"2016-01-11T17:41:09.000-0800","number":"PUP-5693","body":"E.g.\r\n\r\n{code}\r\nbe rake benchmark:function_loading\r\nmkdir -p /var/folders/6v/63w2j07x5vv4fdcx449fphxw0000gp/T/function_loading20160111-22619-d335fu\r\n                 user     system      total        real\r\nRun 1      rake aborted!\r\nstack level too deep\r\n{code}\r\n","closed_at":"2016-03-17T10:53:17.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5693","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:17.000-0700","timestamp":1652285002.603198,"priority":"Normal","status_category":"Done","pull_request":4614},{"issue_id":"120352","title":"Puppet types sometimes fail to compare for equality","url":"https://tickets.puppetlabs.com/browse/PUP-6020","created_at":"2016-03-08T05:08:44.000-0800","number":"PUP-6020","body":"The Puppet type system uses a {{==}} method in the topmost {{PAnyType}} class and then other types adds overrides for that method. The topmost class also declares {{eql?}} as an alias for {{==}}. This doesn't work because the alias does not recognize the overrides. It still points to the method in the topmost class.\r\n\r\nAs a consequence, when comparing types for equality using the {{eql?}} method, only the topmost {{==}} method was used. The {{eql?}} method is used by {{Hash}}, {{Set}} and method like Ruby {{uniq}}.\r\n\r\nThe bug can be observed using puppet apply:\r\n{code}\r\npuppet apply -e \"notice({ Variant[Enum[a,b,c]] => 'first', Variant[Pattern[a,b,c]] => 'second'})\"\r\nNotice: Scope(Class[main]): {Variant[Enum['a', 'b', 'c']] => second}\r\n{code}\r\n","closed_at":"2016-03-17T10:53:18.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6020","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:18.000-0700","timestamp":1652285002.812146,"priority":"Major","status_category":"Done","pull_request":4760},{"issue_id":"112491","title":"TypeParser cannot handle negative numbers","url":"https://tickets.puppetlabs.com/browse/PUP-5712","created_at":"2016-01-14T14:08:46.000-0800","number":"PUP-5712","body":"The {{Puppet::Pops::Types::TypeParser}} used when parsing dispatch declarations for a puppet functions written in Ruby is not capable of parsing negative numbers. It is therefore not possible to define a dispatch with a parameter type like {{Integer\\[default,-1\\]}}. The regular parser does not have this problem however so {{puppet apply -e 'Integer\\[default,-1\\]'}} executes without errors.","closed_at":"2016-03-17T10:53:18.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5712","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:18.000-0700","timestamp":1652285002.917995,"priority":"Normal","status_category":"Done","pull_request":4574},{"issue_id":"118225","title":"Restore monkey patch to Symbol","url":"https://tickets.puppetlabs.com/browse/PUP-5962","created_at":"2016-02-23T13:01:48.000-0800","number":"PUP-5962","body":"It pains me immensely to pen a ticket summary like this one, but c'est la vie.\r\n\r\nBackstory:\r\n* back in 2011, for http://projects.puppetlabs.com/issues/5466, we added a monkey patch to add a {{<=>}} method to {{Symbol}} to allow sorting\r\n* in 2012, as part of cleanup the monkey patch was made conditional on whether that version of Ruby already had a {{<=>}} method for {{Symbol}}. As it turns out, ruby 1.8.7 lacks that method, but ruby 1.9.3+ have that method (but a different implementation than our monkey patch).\r\n* in PUP-4330, we vendored the plist gem into puppet. This gem happens to include much the same patch (but without the conditional logic).\r\n* in PUP-1455 (not yet released), we unvendored the plist gem, thus effectively removing that monkey patch for all rubies currently supported.\r\n\r\nThis broke one spec test in the puppet-server test suite, which was how this was discovered. However, given how low-level this is, the potential for breakage in modules seems pretty high, so the prudent approach here is to restore the monkey patch.","closed_at":"2016-03-17T10:53:19.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5962","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:19.000-0700","timestamp":1652285003.022701,"priority":"Normal","status_category":"Done","pull_request":4701},{"issue_id":"115121","title":"Fix memory-leaks caused by global variables holding on to environments","url":"https://tickets.puppetlabs.com/browse/PUP-5813","created_at":"2016-02-03T13:19:48.000-0800","number":"PUP-5813","body":"When searching for memory leaks we found two places where an environment is referenced in such a way that might be prevented from being garbage collected for a very long time (in some cases indefinitely).","closed_at":"2016-03-17T10:53:19.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5813","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:19.000-0700","timestamp":1652285003.124777,"priority":"Normal","status_category":"Done","pull_request":4628},{"issue_id":"116491","title":"Alias types are presented with the wrong name in type mismatches","url":"https://tickets.puppetlabs.com/browse/PUP-5892","created_at":"2016-02-12T07:17:11.000-0800","number":"PUP-5892","body":"Type aliases are presented the wrong way when there is a type mismatch. \r\nGiven:\r\n{code:puppet}\r\ntype MyType = Integer[42,42]\r\nfunction foo(MyType $a) {\r\n  notice $a\r\n}\r\nnotice foo(43)\r\n{code}\r\nI expect the result to be:\r\n{code}\r\nError: Evaluation Error: Error while evaluating a Function Call, 'foo' parameter 'a' expects a MyType value, got Integer at ...\r\n{code}\r\nBut I get this instead:\r\n{code}\r\nError: Evaluation Error: Error while evaluating a Function Call, 'foo' parameter 'a' expects a TypeA value, got Integer at ...\r\n{code}\r\n\r\nIt seems that it not only got the type name wrong, but it also failed to point out that the value is 43, and not the expected 42.","closed_at":"2016-03-17T10:53:20.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5892","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:20.000-0700","timestamp":1652285003.228027,"priority":"Normal","status_category":"Done","pull_request":4664},{"issue_id":"115521","title":"reverse_each and step functions should return undef when given a block to avoid confusion","url":"https://tickets.puppetlabs.com/browse/PUP-5837","created_at":"2016-02-07T19:10:10.000-0800","number":"PUP-5837","body":"In this example it is surprising that the original value is produced and chained to map:\r\n{code:puppet}\r\nnotice [1,2,3,4].step(2)|$x|{ /* irrelevant what happens here*/ }.map |$x| {$x}\r\n{code}\r\nI expect it to notice [1,3]\r\nInstead it notices [1,2,3,4]\r\n\r\n\r\n\r\n","closed_at":"2016-03-17T10:53:20.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5837","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:20.000-0700","timestamp":1652285013.341675,"priority":"Normal","status_category":"Done","pull_request":4657},{"issue_id":"113192","title":"Value of the key dependencies in the metadata.json of modules isn't checked","url":"https://tickets.puppetlabs.com/browse/PUP-5734","created_at":"2016-01-21T08:29:21.000-0800","number":"PUP-5734","body":"With the following metadata.json in a module:\r\n\r\n{code:java}\r\n{\r\n  \"name\": \"\",\r\n  \"version\": \"\",\r\n  \"summary\": \"\",\r\n  \"author\": \"\",\r\n  \"description\": \"\",\r\n  \"source\": \"\",\r\n  \"license\": \"\",\r\n  \"dependencies\": \"\"\r\n}\r\n{code}\r\n\r\nno catalog can be generated anymore with the following error message:\r\n\r\nundefined method `each' for \"\":String\r\n\r\nbecause the code (/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/module.rb Line 157) expects and don't verify that the value of dependencies is an array.","closed_at":"2016-03-17T10:53:20.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5734","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:20.000-0700","timestamp":1652285013.444137,"priority":"Normal","status_category":"Done","pull_request":4590},{"issue_id":"110915","title":"fqdn_rand in real world - only 336 of possible 1440 daily cron slots ever used.","url":"https://tickets.puppetlabs.com/browse/PUP-5646","created_at":"2016-01-04T07:15:34.000-0800","number":"PUP-5646","body":"Take the very typical code for once per day cron on 50000 hosts named\r\n1.example.org, 2.example.org , ...\r\n\r\n{code}\r\ncron{'/bin/true':\r\n   minute => fqdn_rand(60),\r\n   hour    => fqdn_rand(24)\r\n}\r\n{code}\r\n\r\n\r\nThere are 24 * 60 = 1440 cron slots in day but in reality even with 50,000 hosts\r\nonly 336 slots are ever used.\r\n\r\nThe current fqdn_rand code is something like:\r\n\r\n{code}\r\nseed = Digest::MD5.hexdigest(h).hex\r\nhour = Puppet::Util.deterministic_rand(seed,24)\r\nmin  = Puppet::Util.deterministic_rand(seed,60)\r\n{code}\r\n\r\nOur suspicion is that some where  there is a construct \r\nN % 24 and an N % 60 which forces only the minute to ever be\r\nsignificant value with the hour always predictable from the minute. This\r\ncan not be the whole picture because *336* cannot be explained.\r\n\r\nWhilst ignoring the underlying cause for now making following change  to \r\nuse the max number within the seed  helps things\r\nsignificantly. This breaks  the relationship between *fqdn_rand(60)* and\r\n *fqdn_rand(24)* and we now get a flat distribution\r\nwith all 1440  cron slots being used.\r\n\r\n{code}\r\n   seed = Digest::MD5.hexdigest(\"#{h}:24\").hex\r\n    hour = Puppet::Util.deterministic_rand(seed,24)\r\n    seed = Digest::MD5.hexdigest(\"#{h}:60\").hex\r\n    min  = Puppet::Util.deterministic_rand(seed,60)\r\n{code}\r\n\r\nThe above would be a trivial patch to fqdn_rand.rb.\r\n\r\nPlease find attached \r\n\r\n* test_fqdn.rb  simulates 50,000 hosts with the existing and alternate seed method.\r\n* results.dat and results.png data and gnuplot of existing puppet code.\r\n* newresults.dat and newresults.png data and gnuplot of alternate method above.\r\n\r\nThe .dat files are 24 by 60 matrix with a number of the occurrence of each cron slot used.\r\nThe plots are similarly x and y of 24 hours by 60 minutes with a scratter for each cron slot being used.\r\n\r\nThe results.png clearly show most of slots being empty (at zero).  The newresults.png\r\nis a much flatter distribution.\r\n\r\nIt would of course be nice to understand where 336 comes from.\r\n\r\nWe have tested both with ruby 1.8 and ruby 2.0 but find no difference in behavior.\r\n\r\n\r\n\r\n\r\n","closed_at":"2016-03-17T10:53:20.000-0700","comments":16,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5646","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:20.000-0700","timestamp":1652285013.55358,"priority":"Normal","status_category":"Done","pull_request":4543},{"issue_id":"120542","title":"static catalogs do not copy source host and port to content_uri","url":"https://tickets.puppetlabs.com/browse/PUP-6031","created_at":"2016-03-09T10:16:58.000-0800","number":"PUP-6031","body":"If you define a file resource with a source parameter:\r\n\r\n{code:puppet}\r\nfile { '/tmp/file':\r\n  ensure => file,\r\n  source => 'puppet://host:8888/modules/foo/bar',\r\n}\r\n{code}\r\n\r\nThen the {{content_uri}} omits the host and port:\r\n\r\n{code:json}\r\n  \"content_uri\": \"puppet:///modules/foo/bar\"\r\n{code}\r\n\r\nwhich can cause the agent to retrieve the file from a different host/port than was originally specified.\r\n\r\nWe should preserve the host and port. The reason we don't is because we call {{CGI.escape}} which corrupts the URI.","closed_at":"2016-03-17T10:53:21.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6031","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:21.000-0700","timestamp":1652285013.656801,"priority":"Normal","status_category":"Done","pull_request":4769},{"issue_id":"112684","title":"Modify install.rb to install a puppet.bat file on windows","url":"https://tickets.puppetlabs.com/browse/PUP-5718","created_at":"2016-01-15T15:25:37.000-0800","number":"PUP-5718","body":"Our current way of installing puppet drops a ruby script into the bindir that doesn't work on windows. We need install.rb to install a puppet.bat file instead (which we also either need to write or copy over from puppet_for_the_win)","closed_at":"2016-03-17T10:53:22.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5718","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:22.000-0700","timestamp":1652285014.074937,"priority":"Normal","status_category":"Done","pull_request":4599},{"issue_id":"120463","title":"Restrict which files are inlined within the per-environment directory","url":"https://tickets.puppetlabs.com/browse/PUP-6024","created_at":"2016-03-08T15:50:18.000-0800","number":"PUP-6024","body":"Currently puppet's catalog terminus will inline metadata for anything within the per-environment code directory. However, puppetserver's ACL will only allow static content to be retrieved if the path is of the form {{$codedir/environments/<environment>/modules/\\*/files/\\*\\*}}.\r\n\r\nUsually that is the case. However, if a user specifies a environment.conf with a custom [{{modulepath}}|https://github.com/puppetlabs/control-repo/blob/production/environment.conf#L1], then it's possible for the resolved file path to be of the form {{$codedir/environments/<environment>/site/role/\\*\\*}}, where {{role}} is interpreted as the module name. As a result, we will inline file metadata, but puppetserver will refuse to serve file content.\r\n\r\nWe need to be more restrictive and only inline metadata for files of the form:\r\n\r\n{{$codedir/environments/<environment>/\\*/<module>/files/\\*\\*}}.","closed_at":"2016-03-17T10:53:22.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6024","labels":"burnside-ss","state":"Closed","updated_at":"2016-03-17T10:53:22.000-0700","timestamp":1652285014.283031,"priority":"Normal","status_category":"Done","pull_request":4766},{"issue_id":"116591","title":"Data types seems to be messed up on hash parameters","url":"https://tickets.puppetlabs.com/browse/PUP-5898","created_at":"2016-02-13T03:48:57.000-0800","number":"PUP-5898","body":"The following code:\r\n\r\n{code:java}\r\ndefine test ($b) {\r\n  $a = { key => undef }\r\n  notice(\"a: $a\")\r\n  notice(\"b: $b\")\r\n  $a.each |Array $values| {\r\n    notice(\"a values: $values\")\r\n  }\r\n  $b.each |Array $values| {\r\n    notice(\"b values: $values\")\r\n  }\r\n}\r\n\r\n$a = { key => undef }\r\ntest { \"test\":\r\n  b => $a,\r\n}\r\n{code}\r\n\r\ngenerates the following output if run with puppet apply:\r\n\r\n{code}\r\npuppet apply test.pp\r\nNotice: Scope(Test[test]): a: {key => }\r\nNotice: Scope(Test[test]): b: {key => }\r\nNotice: Scope(Test[test]): a values: [key, ]\r\nError: Evaluation Error: Error while evaluating a Resource Statement, Evaluation Error: Error while evaluating a Method call, block parameter 'values' expects an Array value, got Tuple at /home/rvicinus/test.pp:8:5  at /home/rvicinus/test.pp:14 on node puppetmaster\r\n{code}\r\n\r\nI would expect that the second each statement would run like the first, because the supplied hash is absolutely equally created like the one provided to the first each statement. I think somehow assigning the hash to a parameter messes up the data types, because the code works as expected if the Array keyword in the second each statement is removed. This is also the workaround that I use.","closed_at":"2016-03-17T10:53:23.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5898","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:23.000-0700","timestamp":1652285014.389566,"priority":"Major","status_category":"Done","pull_request":4678},{"issue_id":"118450","title":"Add catalog_format to the catalog","url":"https://tickets.puppetlabs.com/browse/PUP-5970","created_at":"2016-02-24T14:19:34.000-0800","number":"PUP-5970","body":"We do not specify the version of catalog's schema, so readers of the catalog don't necessarily know how to interpret the data. We should add a {{catalog_format}} property, serialized with the catalog, like we do for {{Report#report_format}}.","closed_at":"2016-03-17T10:53:23.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5970","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:23.000-0700","timestamp":1652285014.70017,"priority":"Normal","status_category":"Done","pull_request":4718},{"issue_id":"102806","title":"Add a query string with environment when sending HTTP POST","url":"https://tickets.puppetlabs.com/browse/PUP-5428","created_at":"2015-10-24T02:14:00.000-0700","number":"PUP-5428","body":"Hello, \r\n\r\nWhen running a Puppet 4 run, every http call to PuppetServer includes a query string with the current  \"environment\".\r\n\r\n{code}\r\nGET /puppet/v3/node/test.dc01?environment=production\r\nGET /puppet/v3/file_metadata/modules/concat/concatfragments.rb?environment=production...\r\nPUT /puppet/v3/report/test.dc01?environment=production&\r\n.... \r\n{code}\r\n\r\nAll except the POST to get the catalog \r\n\r\n{code}\r\nPOST /puppet/v3/catalog/test.dc01 HTTP/1.1\r\n{code}\r\n\r\nIt makes it hard to load-balance puppet load accross several puppetservers running differents environnments.\r\n\r\nUsing Puppet3.x, the environment was in the uri, so it was easy to loadbalance :\r\n\r\n{code}\r\n  ProxyPassMatch ^/stable/ balancer://puppetserver timeout=600\r\n  <Location ~ ^/stable/ >\r\n   RequestHeader set X-Client-DN \"CN=%{SSL_CLIENT_S_DN_CN}e\"\r\n   ProxyPassReverse balancer://puppetserver\r\n  </Location>\r\n{code}\r\n\r\nUsing Puppet4, I am using ModRewrite : \r\n\r\n{code}\r\n  RewriteCond %{QUERY_STRING} ^(.*)environment=production(.*)$\r\n  RewriteRule ^(.*) balancer://puppetserver$1 [P]\r\n{code}\r\n\r\nIt works well, except for the POST Catalog call.\r\n\r\nIs it possible to add also add a query string to this specific call ? \r\n\r\nRegards\r\n\r\nOlivier","closed_at":"2016-03-17T10:53:23.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5428","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:23.000-0700","timestamp":1652285014.805263,"priority":"Normal","status_category":"Done","pull_request":4400},{"issue_id":"87527","title":"PUP-121 (relative namespacing) was never fully resolved in 3.x future parser","url":"https://tickets.puppetlabs.com/browse/PUP-4818","created_at":"2015-07-06T10:45:52.000-0700","number":"PUP-4818","body":"PUP-121 was about removing relative lookup of class names, and it was marked as resolved in Puppet 3.7.0 (with future parser enabled). It was never actually resolved at all in the 3 series, although it's fixed in 4.0. This is a significant language difference, which seems to have the potential to cause problems for upgraders. \r\n\r\nThe following two manifests prove that this was never resolved:\r\n\r\n{code}\r\nclass foo::thing {\r\n  notify {\"from foo::thing\":}\r\n}\r\n\r\nclass thing {\r\n  notify {\"from ::thing\":}\r\n}\r\n\r\nclass foo {\r\n  class {'thing':}\r\n}\r\n\r\ninclude foo\r\n{code}\r\n\r\nThe above should notify \"from ::thing,\" but in Puppet 3.8 it will notify \"from foo::thing\" instead. \r\n\r\n{code}\r\nclass bar::other {\r\n  class {'other':}\r\n}\r\n\r\nclass other {\r\n  notify {\"from ::other\":}\r\n}\r\n\r\ninclude bar::other\r\n{code}\r\n\r\nThe above should compile cleanly and notify \"from ::other,\" but in Puppet 3.8 it will fail with a duplicate declaration error.\r\n\r\nFurthermore, PUP-121 says that the tests in spec/integration/parser/future_compiler_spec.rb, under \"when resolving class references\" are supposed to prove this is fixed, but they actually seem to have nothing to do with the problem described in PUP-121 (i.e. \"include 'thing' can include something other than the one class named 'thing'\"). If we don't have any real tests that check for this misbehavior, we need some. \r\n\r\nUPDATE\r\n----\r\nWe should add the tests in this ticket to 3.x and make them work for parser=future.\r\nThen merge that to stable and make the tests standard and ensure runtime works as expected - fix the issues. Then merge to master.","closed_at":"2016-03-17T10:53:23.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4818","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:23.000-0700","timestamp":1652285014.911162,"priority":"Major","status_category":"Done","pull_request":4661},{"issue_id":"118288","title":"Recurse tidy resources totally fail","url":"https://tickets.puppetlabs.com/browse/PUP-5963","created_at":"2016-02-23T19:31:37.000-0800","number":"PUP-5963","body":"Since PUP-1963, recursive tidying has been broken","closed_at":"2016-03-17T10:53:24.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5963","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:24.000-0700","timestamp":1652285015.225146,"priority":"Normal","status_category":"Done","pull_request":4706},{"issue_id":"120175","title":"acceptance/direct_puppet/static_catalog_env_control fails on hostname","url":"https://tickets.puppetlabs.com/browse/PUP-6017","created_at":"2016-03-07T09:38:44.000-0800","number":"PUP-6017","body":"The {{acceptance/direct_puppet/static_catalog_env_control.rb}} beaker test uses the agent {{hostname}} to assert catalog content. If the {{nodename}} does not match the {{hostname}} then this test fails.\r\n\r\nExample of failure\r\n{code}\r\n* verify production environment\r\n\r\nsol10.delivery.puppetlabs.net (solaris-10-sparc) 13:34:01$ cat /opt/puppetlabs/puppet/cache/client_data/catalog/sol10.delivery.puppetlabs.net.json\r\n  cat: cannot open /opt/puppetlabs/puppet/cache/client_data/catalog/sol10.delivery.puppetlabs.net.json\r\n\r\nsol10.delivery.puppetlabs.net (solaris-10-sparc) executed in 0.05 seconds\r\nExited: 2\r\n\r\nh2g886gn5iowfhx.delivery.puppetlabs.net (master) 13:34:01$ puppet master --configprint config\r\n  /etc/puppetlabs/puppet/puppet.conf\r\n\r\nh2g886gn5iowfhx.delivery.puppetlabs.net (master) executed in 0.66 seconds\r\n\r\nh2g886gn5iowfhx.delivery.puppetlabs.net (master) 13:34:02$ if [ -f '/tmp/static_catalog_env_control.rb.tiJrxA/code/puppet.conf.bak' ]; then cat '/tmp/static_catalog_env_control.rb.tiJrxA/code/puppet.conf.bak' > '/etc/puppetlabs/puppet/puppet.conf'; rm -f '/tmp/static_catalog_env_control.rb.tiJrxA/code/puppet.conf.bak'; fi\r\n\r\nh2g886gn5iowfhx.delivery.puppetlabs.net (master) executed in 0.02 seconds\r\n\r\nh2g886gn5iowfhx.delivery.puppetlabs.net (master) 13:34:02$ puppet resource service puppetserver ensure=stopped\r\n  Notice: /Service[puppetserver]/ensure: ensure changed 'running' to 'stopped'\r\n  service { 'puppetserver':\r\n    ensure => 'stopped',\r\n  }\r\n\r\nh2g886gn5iowfhx.delivery.puppetlabs.net (master) executed in 1.04 seconds\r\nRuntimeError: PuppetAcceptance::DSL::Helpers.with_puppet_running_on failed (check backtrace for location) because: Host 'sol10.delivery.puppetlabs.net' exited with 2 running:\r\n cat /opt/puppetlabs/puppet/cache/client_data/catalog/sol10.delivery.puppetlabs.net.json\r\nLast 10 lines of output were:\r\n\tcat: cannot open /opt/puppetlabs/puppet/cache/client_data/catalog/sol10.delivery.puppetlabs.net.json\r\n{code}","closed_at":"2016-03-17T10:53:24.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6017","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:24.000-0700","timestamp":1652285015.328575,"priority":"Normal","status_category":"Done","pull_request":4759},{"issue_id":"118799","title":"Make DNF package provider the default for Fedora 23","url":"https://tickets.puppetlabs.com/browse/PUP-5981","created_at":"2016-02-26T11:50:51.000-0800","number":"PUP-5981","body":"We've added support for Fedora 23 but have not updated the DNF provider to make it the default.\r\n\r\n/cc [~stahnma] [~kenn]\r\n\r\nIf this needs to be done for 4.4.0 we'll need to know ASAP to get it in.","closed_at":"2016-03-17T10:53:24.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5981","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:24.000-0700","timestamp":1652285015.640982,"priority":"Normal","status_category":"Done","pull_request":4726},{"issue_id":"119007","title":"Bad error for unresolved type in 4.x function API","url":"https://tickets.puppetlabs.com/browse/PUP-5986","created_at":"2016-02-28T09:44:28.000-0800","number":"PUP-5986","body":"When making a typo in a 4.x function (or using an alias that cannot be loaded), when calling the function, an error like this is displayed:\r\n\r\n{code}\r\nError while evaluating a Function Call, 'then' parameter 'arg' expects a TypeReference value, got String\r\n{code}\r\n(The function's name in this example is called 'then', and it uses a type 'MyAny' with the intent that there should be an alias like {{MyAny = Any}}.\r\n\r\nInstead of giving an error when calling the method, it resulted in an expectancy of a TypeReference.\r\n\r\nSeems a failed type resolution is not reported in this case.\r\n\r\nFunction reproducing the problem:\r\n{code:ruby}\r\nPuppet::Functions.create_function(:then) do\r\n  dispatch :then do\r\n    repeated_param 'MyAny', :arg\r\n    block_param\r\n  end\r\n\r\n  def then(*args)\r\n    yield(*args)\r\n  end\r\nend\r\n{code}\r\nAns calling it like this:\r\n{code}\r\npuppet apply -e 'then(all_you_need_is_love) |$x| { notice $x }'\r\n{code}","closed_at":"2016-03-17T10:53:25.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5986","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:25.000-0700","timestamp":1652285015.744654,"priority":"Normal","status_category":"Done","pull_request":4767},{"issue_id":"115343","title":"Interpolation of an empty variable %{} or %{::} should yield an empty string","url":"https://tickets.puppetlabs.com/browse/PUP-5824","created_at":"2016-02-05T03:33:46.000-0800","number":"PUP-5824","body":"The Hiera data provider should behave the same way as Hiera 3.0 when interpolating an empty string or a string that contains an empty name separator '::'. The interpolated expression should ignore leading and trailing whitespace.\r\n{code}\r\n%{} => ''\r\n%{  } => ''\r\n%{::} => ''\r\n%{ :: } => ''\r\n{code}\r\nLeading and trailing whitespace will always be ignored in the Hiera dataprovider. So:\r\n{code}\r\n%{ some key }\r\n{code}\r\nwill be considered exactly the same as:\r\n{code}\r\n%{some key}\r\n{code}\r\nIn case that someone really want a leading or tralining space in the key, they can use the syntax:\r\n{code}\r\n%{scope(' some key ')}\r\n{code}","closed_at":"2016-03-17T10:53:25.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5824","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:25.000-0700","timestamp":1652285015.955886,"priority":"Normal","status_category":"Done","pull_request":4637},{"issue_id":"112995","title":"Backport PUP-5693 (benchmark function loading) to stable 4.3.3","url":"https://tickets.puppetlabs.com/browse/PUP-5724","created_at":"2016-01-19T15:57:36.000-0800","number":"PUP-5724","body":"in PUP-5693 the benchmark for function_loading was fixed to run on 4.x. The work done there should be cherry picked to stable to be included in a possible future PUP 4.3.3 release","closed_at":"2016-03-17T10:53:27.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5724","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:27.000-0700","timestamp":1652285016.494123,"priority":"Normal","status_category":"Done","pull_request":4614},{"issue_id":"116547","title":"puppet parser validate fails for functions","url":"https://tickets.puppetlabs.com/browse/PUP-5895","created_at":"2016-02-12T13:40:28.000-0800","number":"PUP-5895","body":"The following is valid puppet code in puppet 4, and will run using a puppet apply, but fails a puppet parser validate:\r\n\r\n{code}\r\nfunction validate_this() {\r\n  notice('hello, puppet')\r\n}\r\n\r\nvalidate_this()\r\n{code}\r\n\r\nUsing puppet apply, I get:\r\n{code}\r\n$ puppet apply testcase.pp\r\nNotice: Scope(Class[main]): hello, puppet\r\nNotice: Compiled catalog for macbook.whilefork.com in environment production in 0.03 seconds\r\nNotice: Applied catalog in 0.02 seconds\r\n{code}\r\n\r\nWhen I attempt to validate it:\r\n{code}\r\npuppet parser validate testcase.pp\r\nError: Internal Error: Puppet Context ':loaders' missing - cannot define any functions\r\n{code}\r\n\r\nWe use puppet parser validate in our CI to validate that all .pp files are valid puppet code, so this makes it more difficult to validate puppet code now that we're starting to use functions defined in the puppet language.\r\n\r\nI've validated that this occurs on puppet 4.3.2 on OS X and puppet 4.2.3 on CentOS 7.","closed_at":"2016-03-17T10:53:27.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5895","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:27.000-0700","timestamp":1652285016.600079,"priority":"Normal","status_category":"Done","pull_request":4668},{"issue_id":"115028","title":"Parser never sets location on RHS of \"resource without title\" expressions","url":"https://tickets.puppetlabs.com/browse/PUP-5805","created_at":"2016-02-03T00:37:57.000-0800","number":"PUP-5805","body":"An expression like:\r\n{code:puppet}\r\nnotice {a=>b}\r\n{code}\r\nresults in:\r\n{code}\r\nundefined method `-' for nil:NilClass\r\n{code}\r\nwhereas:\r\n{code:puppet}\r\nnotice({a=>b})\r\n{code}\r\noutputs the string form of the hash. The reason is that the parser treats the first expression as a \"resource without title\" and the method that transforms this into a call never sets the location of the right hand side hash (it can't since it doesn't have access to the delimiting braces).","closed_at":"2016-03-17T10:53:29.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5805","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:29.000-0700","timestamp":1652285017.017419,"priority":"Normal","status_category":"Done","pull_request":4656},{"issue_id":"117321","title":"Administration token detection doesn't work in legacy Windows OS (2003/XP)","url":"https://tickets.puppetlabs.com/browse/PUP-5923","created_at":"2016-02-18T10:40:59.000-0800","number":"PUP-5923","body":"As part of PUP-5735 it was found that the administrative token detection for legacy operating systems always evaluated as true.  This was due to a simple typo at https://github.com/puppetlabs/puppet/blob/master/lib/puppet/util/windows/user.rb#L46\r\n\r\nThe helper function returns a bool type however the check is against an integer.  Therefore is_admin is always returns because bool <> int32 is always true.\r\n\r\nChanging the line to \r\n{code}\r\nis_admin = ismember_pointer.read_win32_bool\r\n{code}\r\nfixes the problem\r\n","closed_at":"2016-03-17T10:53:30.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5923","labels":"windows","state":"Closed","updated_at":"2016-03-17T10:53:30.000-0700","timestamp":1652285017.32812,"priority":"Normal","status_category":"Done","pull_request":4685},{"issue_id":"118904","title":"Environment Data Provider has different interpolation behavior than Hiera","url":"https://tickets.puppetlabs.com/browse/PUP-5983","created_at":"2016-02-26T20:58:16.000-0800","number":"PUP-5983","body":"I haven't found duplicate reports of this.\r\n\r\n+YAML Sample:+\r\n{noformat}\r\n---\r\nsomevar:\r\n    - 1\r\n    - 2\r\n    - 3\r\n    \r\nfoobar: \"%{alias('somevar')}\"\r\n\r\nfoobar_array:\r\n    - \"%{alias('somevar')}\"\r\n\r\nfoobar_hash:\r\n    subkey: \"%{alias('somevar')}\"\r\n    \r\nfoobar_hash_hash:\r\n    subkey:\r\n        subkey: \"%{alias('somevar')}\"\r\n{noformat}\r\n\r\n\r\n+Result of the sample put into Global Hiera+\r\n{noformat}\r\nfor f in somevar foobar foobar_array foobar_hash foobar_hash_hash; do echo $f; puppet lookup $f --node puppet.example.com; done\r\nsomevar\r\n---\r\n- 1\r\n- 2\r\n- 3\r\nfoobar\r\n---\r\n- 1\r\n- 2\r\n- 3\r\nfoobar_array\r\n---\r\n- - 1\r\n  - 2\r\n  - 3\r\nfoobar_hash\r\n---\r\nsubkey:\r\n- 1\r\n- 2\r\n- 3\r\nfoobar_hash_hash\r\n---\r\nsubkey:\r\n  subkey:\r\n  - 1\r\n  - 2\r\n  - 3\r\n{noformat}\r\n\r\nResult put into Environment Hiera\r\n\r\n{noformat}\r\nfor f in somevar foobar foobar_array foobar_hash foobar_hash_hash; do echo $f; puppet lookup $f --node puppet.example.com; done\r\nsomevar\r\n---\r\n- 1\r\n- 2\r\n- 3\r\nfoobar\r\n---\r\n- 1\r\n- 2\r\n- 3\r\nfoobar_array\r\n---\r\n- \"%{alias('somevar')}\"\r\nfoobar_hash\r\n---\r\nsubkey: \"%{alias('somevar')}\"\r\nfoobar_hash_hash\r\n---\r\nsubkey:\r\n  subkey: \"%{alias('somevar')}\"\r\n{noformat}\r\n\r\nObviously, the behavior should be maintained.\r\n","closed_at":"2016-03-17T10:53:30.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5983","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:30.000-0700","timestamp":1652285017.431905,"priority":"Normal","status_category":"Done","pull_request":4728},{"issue_id":"113369","title":"Confusing error message for invalid types for comparison operations","url":"https://tickets.puppetlabs.com/browse/PUP-5741","created_at":"2016-01-21T17:38:52.000-0800","number":"PUP-5741","body":"The following code:\r\n\r\n{code}\r\nnotice(undef > foo)\r\n{code}\r\n\r\nProduces this confusing error message:\r\n\r\n{code}\r\nError: Evaluation Error: Comparison of: #<Puppet::Pops::Model::ModelLabelProvider:0x007fd5943285b8> > String, is not possible. Caused by 'Only Strings and Numbers are comparable'.\r\n{code}\r\n\r\nExpected the compiler's error message to say \"Comparison of Undef > String is not possible...\"\r\n\r\nI'm going to guess that the other comparison operators are similarly affected.","closed_at":"2016-03-17T10:53:32.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5741","labels":"","state":"Closed","updated_at":"2016-03-17T10:53:32.000-0700","timestamp":1652285017.536164,"priority":"Normal","status_category":"Done","pull_request":4597},{"issue_id":"112533","title":"ClassInformationService.classes_per_environment errantly evaluates parameter default expression","url":"https://tickets.puppetlabs.com/browse/PUP-5713","created_at":"2016-01-14T15:11:10.000-0800","number":"PUP-5713","body":"In doing some testing against the {{Puppet::InfoService::ClassInformationService.classes_per_environment()}} method, I found that the value for {{:default_source}} apparently tries to evaluate the expression that it needs to return for a class parameter's default value rather than just retaining the original expression verbatim from the Puppet manifest .pp file, passing that back as a String.\r\n\r\nFor example, I used a Puppet class with the following content...\r\n\r\n{code:puppet}\r\nclass myclass (String $string_with_expression_default = \"for os in family $::osfamily\")\r\n{\r\n}\r\n{code}\r\n\r\n... and used the following code to try to parse it ...\r\n\r\n{code:ruby}\r\nrequire 'puppet'\r\nrequire 'puppet/info_service'\r\n\r\nfiles_to_parse = { \"production\" => [ \"./parse.pp\" ] }\r\n\r\nputs Puppet::InfoService::ClassInformationService.new.classes_per_environment(files_to_parse)\r\n{code}\r\n\r\nI was expecting to get something back like this in stdout:\r\n\r\n{noformat}\r\n{\"production\"=>{\"./parse.pp\"=>[{:name=>\"myclass\", :params=>[{:name=>\"string_with_expression_default\", :type=>\"String\", :default_literal=>\"\\\"for os in family $::osfamily\\\"\"}]}]}}\r\n{noformat}\r\n\r\nInstead, though, I got this:\r\n\r\n{noformat}\r\n{\"production\"=>{\"./parse.pp\"=>{:error=>\"undefined method `<' for nil:NilClass\"}}}\r\n{noformat}\r\n\r\nIf I omit the $ from the default value, just \"for os in family ::osfamily\" instead, then I get more reasonable looking output:\r\n\r\n{noformat}\r\n{\"production\"=>{\"./parse.pp\"=>[{:name=>\"myclass\", :params=>[{:name=>\"string_with_expression_default\", :type=>\"String\", :default_literal=>\"for os in family ::osfamily\"}]}]}}\r\n{noformat}\r\n\r\nAt least at doesn't error out.  But in this case, the string doesn't have the surrounding double-quotes escaped in the value - so there would be no difference between wrapping the value in single-quotes vs. double-quotes, for example. ","closed_at":"2016-03-17T13:33:35.000-0700","comments":21,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5713","labels":"","state":"Closed","updated_at":"2016-03-17T13:33:35.000-0700","timestamp":1652285017.748921,"priority":"Normal","status_category":"Done","pull_request":4580},{"issue_id":"107259","title":"Yum package provider: ensure => latest fails in case of broken update notices","url":"https://tickets.puppetlabs.com/browse/PUP-5555","created_at":"2015-11-27T02:52:28.000-0800","number":"PUP-5555","body":"Similar to PUP-4497 and PUP-5309, ensure => latest fails when `yum check-update` lists broken update notices\r\n\r\n\r\n{code:}\r\n# puppet apply -e \"package{'puppet-agent': ensure => 'latest'}\"\r\nNotice: Compiled catalog for localhost in environment production in 1.00 seconds\r\nError: Could not get latest version: undefined method `[]' for nil:NilClass\r\nError: /Stage[main]/Main/Package[puppet-agent]/ensure: change from 1.3.0-1.el7 to latest failed: Could not get latest version: undefined method `[]' for nil:NilClass\r\nNotice: Applied catalog in 7.66 seconds\r\n{code}\r\n\r\n\r\nyum check-update output:\r\n\r\n{code:}\r\n# yum check-update\r\nLoaded plugins: product-id, subscription-manager, versionlock\r\n\r\nRed_Hat_Enterprise_Linux-Release_Notes-7-en-US.noarch                                                7-2.el7                                                                          rhel-7-server-rpms         \r\nalsa-tools-firmware.x86_64                                                                           1.0.28-2.el7                                                                     rhel-7-server-rpms         \r\n[snip]\r\nUpdate notice RHBA-2014:0722 (from rhel-7-server-rpms) is broken, or a bad duplicate, skipping.\r\nYou should report this problem to the owner of the rhel-7-server-rpms repository.\r\n{code}\r\n\r\n","closed_at":"2016-03-18T11:10:33.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5555","labels":"","state":"Closed","updated_at":"2016-03-18T11:10:33.000-0700","timestamp":1652285017.852924,"priority":"Normal","status_category":"Done","pull_request":4471},{"issue_id":"120671","title":"static catalogs cannot inline metadata for files requiring percent encoding","url":"https://tickets.puppetlabs.com/browse/PUP-6036","created_at":"2016-03-09T17:49:02.000-0800","number":"PUP-6036","body":"If you try to manage a file with characters like ' ' which must be percent encoded in a URI:\r\n\r\n{code:puppet}\r\n  file { '/tmp/file':\r\n    ensure  => file,\r\n    source  => 'puppet:///modules/ntp/ntp d.conf',\r\n  }\r\n{code}\r\n\r\nThen the compiler will fail to inline metadata:\r\n\r\n{noformat}\r\nError: Could not understand URI puppet:///modules/ntp/files/ntp d.conf: bad URI(is not URI?): puppet:///modules/ntp/files/ntp d.conf\r\n/Users/josh/work/puppet/lib/puppet/file_serving/metadata.rb:36:in `rescue in content_uri='\r\n/Users/josh/work/puppet/lib/puppet/file_serving/metadata.rb:33:in `content_uri='\r\n/Users/josh/work/puppet/lib/puppet/indirector/catalog/compiler.rb:236:in `block in inline_metadata'\r\n/Users/josh/work/puppet/lib/puppet/indirector/catalog/compiler.rb:159:in `each'\r\n...\r\n{noformat}","closed_at":"2016-03-23T15:10:55.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6036","labels":"burnside-ss","state":"Closed","updated_at":"2016-03-23T15:10:55.000-0700","timestamp":1652285018.584047,"priority":"Normal","status_category":"Done","pull_request":4775},{"issue_id":"87158","title":"Path of scheduled tasks folder is not necessarily C:\\Windows\\Tasks","url":"https://tickets.puppetlabs.com/browse/PUP-4814","created_at":"2015-07-02T06:53:22.000-0700","number":"PUP-4814","body":"This might be a rare case, but fixing it can improve the code actually. \r\n\r\nIf a Windows Server 2003 system is *upgraded* from Windows 2000 or NT, the default {{%SYSTEMROOT%}} or {{%WINDIR%}} is {{C:\\WINNT}} rather than {{C:\\Windows}}.  This will cause failure of {{scheduled_task}} resource, because {{[taskscheduler.rb| https://github.com/puppetlabs/puppet/blob/master/lib/puppet/util/windows/taskscheduler.rb#L812]}} hardcoded the path of scheduled tasks as {{C:\\Windows\\Tasks}} when testing if a job exists.\r\n\r\n{code}\r\nError: /Stage[main]/test/Scheduled_task[foo]: Could not evaluate: No such file or directory @ dir_initialize - C:/Windows/Tasks\r\n{code}\r\n\r\nI don't think it's a good way:\r\n- The _windows directory_ doesn't have to be {{C:\\Windows}}\r\n- The _system drive_ doesn't have to be {{C:}} \r\n\r\nIt's better to use {{\"#\\{ENV\\['WINDIR'\\]\\}/Tasks\"}} here.\r\n\r\n{code:ruby}\r\n    # Returns whether or not the scheduled task exists.\r\n    def exists?(job_name)\r\n      bool = false\r\n      Dir.foreach('C:/Windows/Tasks'){ |file|\r\n        if File.basename(file, '.job') == job_name\r\n          bool = true\r\n          break\r\n        end\r\n      }\r\n      bool\r\n    end\r\n{code}\r\n\r\n","closed_at":"2016-03-24T11:01:27.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4814","labels":"scheduled_task;windows","state":"Closed","updated_at":"2016-03-24T11:01:27.000-0700","timestamp":1652285018.890358,"priority":"Normal","status_category":"Done","pull_request":4061},{"issue_id":"94367","title":"Puppet service name changed from 'puppet' to 'com.puppetlabs.puppet' on Mac without a major release","url":"https://tickets.puppetlabs.com/browse/PUP-5053","created_at":"2015-08-19T18:43:56.000-0700","number":"PUP-5053","body":"A prior maint commit changed the name of the Puppet service on Mac to {{com.puppetlabs.puppet}}, which breaks anyone trying to manage that service. Notably PE. That's a bad thing to do in a patch release, which is what puppet#stable is targeting.\r\n\r\n*NOTE* The name change was made in puppet#stable, but never released, so there won't be a user visible change between 4.2.1 and 4.2.2.","closed_at":"2016-03-30T11:35:45.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5053","labels":"","state":"Closed","updated_at":"2016-03-30T11:35:45.000-0700","timestamp":1652285019.312982,"priority":"Normal","status_category":"Done","pull_request":4181},{"issue_id":"118340","title":"File type links documentation incorrectly references :ignore value","url":"https://tickets.puppetlabs.com/browse/PUP-5967","created_at":"2016-02-24T09:11:34.000-0800","number":"PUP-5967","body":"The File type documentation for {{links}} mentions {{follow}}, {{manage}}, and {{ignore}}. {{ignore}} is not a legal value for {{links}}; the documentation needs to be updated.","closed_at":"2016-04-13T16:31:13.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5967","labels":"","state":"Closed","updated_at":"2016-04-13T16:31:13.000-0700","timestamp":1652285020.558438,"priority":"Normal","status_category":"Done","pull_request":4785},{"issue_id":"104989","title":"filebucket test fails on AIX","url":"https://tickets.puppetlabs.com/browse/PUP-5483","created_at":"2015-11-09T11:58:59.000-0800","number":"PUP-5483","body":"The {{tests/ticket_4622_filebucket_diff_test.rb}} fails on AIX using pre-release {{puppet-agent}} at SHA {{8be23474284a9f8e2bae551d266f5730af6681cd}}\r\n\r\n{code}\r\n * Find the filebucket diff of the first checksum and the local file and validate the output\r\n  pe-aix-53-agent 11:50:51$ puppet filebucket diff d3b07384d113edec49eaa6238ad5ff00 /tmp/testfile.12858 --remote --server npwomdcssiasjk0.delivery.puppetlabs.net\r\n    1c1,2\r\n    < foo\r\n    ---\r\n    > bar\r\n    > baz\r\n\r\n  pe-aix-53-agent executed in 2.75 seconds\r\nMinitest::Assertion: Expected /\\-foo/ to match \"1c1,2\\n< foo\\n---\\n> bar\\n> baz\".\r\n\r\n{code}","closed_at":"2016-04-13T16:43:39.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5483","labels":"","state":"Closed","updated_at":"2016-04-13T16:43:39.000-0700","timestamp":1652285021.194028,"priority":"Normal","status_category":"Done","pull_request":4434},{"issue_id":"99295","title":"puppet lookup --explain produces unhelpful reference","url":"https://tickets.puppetlabs.com/browse/PUP-5278","created_at":"2015-09-24T05:14:40.000-0700","number":"PUP-5278","body":"As shown in PUP-4475 an unhelpful printout of a merge result can occur when using the --explain option to lookup.\r\n{code}\r\nMerged result: #<Object:0x0000000269eb80>\r\n{code}\r\n\r\nSee other ticket for details.","closed_at":"2016-04-13T16:52:28.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5278","labels":"","state":"Closed","updated_at":"2016-04-13T16:52:28.000-0700","timestamp":1652285021.983733,"priority":"Normal","status_category":"Done","pull_request":4284},{"issue_id":"101073","title":"mount acceptance fails on AIX","url":"https://tickets.puppetlabs.com/browse/PUP-5339","created_at":"2015-10-07T13:36:13.000-0700","number":"PUP-5339","body":"Beaker acceptance tests for mount  fail on AIX due to assumptions about {{mkfs}} and {{fstab}}\r\n\r\n{code}\r\n Test Case tests/resource/mount/defined.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-53-acceptance' exited with 2 running:\r\n               cat /etc/fstab\r\n              Last 10 lines of output were:\r\n              \tcat: 0652-050 Cannot open /etc/fstab.>\r\n                Test Case tests/resource/mount/destroy.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-53-acceptance' exited with 1 running:\r\n               yes | mkfs -t ext3 -q /tmp/pl559317\r\n              Last 10 lines of output were:\r\n              \tmkfs: Not a recognized flag: t\r\n              \tUsage: mkfs [-b BootProgram] [-i Inodes] [-l Label] [-o Options] [-p Prototype]\r\n              \t\t[-s Size] [-v VolumeLabel] [-V vfs] {Device|Filesystem}>\r\n                Test Case tests/resource/mount/modify.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-53-acceptance' exited with 1 running:\r\n               yes | mkfs -t ext3 -q /tmp/pl103746\r\n              Last 10 lines of output were:\r\n              \tmkfs: Not a recognized flag: t\r\n              \tUsage: mkfs [-b BootProgram] [-i Inodes] [-l Label] [-o Options] [-p Prototype]\r\n              \t\t[-s Size] [-v VolumeLabel] [-V vfs] {Device|Filesystem}>\r\n                Test Case tests/resource/mount/mounted.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-53-acceptance' exited with 1 running:\r\n               yes | mkfs -t ext3 -q /tmp/pl598605\r\n              Last 10 lines of output were:\r\n              \tmkfs: Not a recognized flag: t\r\n              \tUsage: mkfs [-b BootProgram] [-i Inodes] [-l Label] [-o Options] [-p Prototype]\r\n              \t\t[-s Size] [-v VolumeLabel] [-V vfs] {Device|Filesystem}>\r\n{code}","closed_at":"2016-04-13T17:03:41.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5339","labels":"","state":"Closed","updated_at":"2016-04-13T17:03:41.000-0700","timestamp":1652285022.409236,"priority":"Normal","status_category":"Done","pull_request":4379},{"issue_id":"102965","title":"solaris 10 sparc, acceptance/tests/resource/zone/dataset fails","url":"https://tickets.puppetlabs.com/browse/PUP-5433","created_at":"2015-10-27T07:15:01.000-0700","number":"PUP-5433","body":"Using {{puppet-agent}} at SHA {{41de77924}}, the {{acceptance/tests/resource/zone/dataset.rb}} acceptance test fails during teardown.\r\n\r\nThe teardown step in this test should be modified accommodate the absence of the zpool.","closed_at":"2016-04-13T17:05:10.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5433","labels":"","state":"Closed","updated_at":"2016-04-13T17:05:10.000-0700","timestamp":1652285022.514125,"priority":"Normal","status_category":"Done","pull_request":4389},{"issue_id":"101975","title":"nim provider fails on AIX","url":"https://tickets.puppetlabs.com/browse/PUP-5391","created_at":"2015-10-17T07:16:02.000-0700","number":"PUP-5391","body":"The {{tests/aix/nim_package_provider.rb}} acceptance test errors while trying to apply a package manifest with the {{nim}} provider. This behavior can be reproduced outside of the test\r\n\r\n{code}\r\nError: Could not set 'present' on ensure: undefined method `execute' for Puppet::Util:Module at 1:/root/nim.pp\r\nError: Could not set 'present' on ensure: undefined method `execute' for Puppet::Util:Module at 1:/root/nim.pp\r\nWrapped exception:\r\nundefined method `execute' for Puppet::Util:Module\r\n{code}\r\n\r\nh2. Steps to reproduce\r\nh3. Create package manifest\r\n{code}\r\ncat > nim.pp << EOS\r\npackage {'cdrecord':\r\n  ensure   => 'present',\r\n  source   => 'lpp_custom',\r\n  provider => nim,\r\n}\r\nEOS\r\n{code}\r\n\r\nh3. Apply manifest\r\n{code}\r\n/opt/puppetlabs/bin/puppet apply nim.pp\r\n{code}","closed_at":"2016-04-13T17:10:32.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5391","labels":"","state":"Closed","updated_at":"2016-04-13T17:10:32.000-0700","timestamp":1652285022.938499,"priority":"Normal","status_category":"Done","pull_request":4368},{"issue_id":"110532","title":"systemd unit puppet.service is missing ExecReload=","url":"https://tickets.puppetlabs.com/browse/PUP-5637","created_at":"2015-12-24T04:22:30.000-0800","number":"PUP-5637","body":"The systemd unit file shipped with puppet 3.8.4 (and lower 3.x versions) does not define an ExecReload command. As a result, systemd does a reload, sending the agent a SIGTERM and possibly killing off any currently running puppet run.\r\nThe agent supports to restart itself on receiving a SIGHUP. Systemd should send this signal to restart the puppet agent.\r\nThis is fixed in puppet 4.3, see https://github.com/puppetlabs/puppet/blob/4.3.0/ext/systemd/puppet.service","closed_at":"2016-04-26T12:23:24.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5637","labels":"","state":"Closed","updated_at":"2016-04-26T12:23:24.000-0700","timestamp":1652285034.909329,"priority":"Normal","status_category":"Done","pull_request":4576},{"issue_id":"101112","title":"Nagios extension check_puppet.rb error","url":"https://tickets.puppetlabs.com/browse/PUP-5356","created_at":"2015-10-08T05:10:29.000-0700","number":"PUP-5356","body":"The extension to check if puppet is running using Nagios (with NRPE) does not work on CentOS 7 (probably on all EL7)\r\n\r\n{noformat}\r\n[root@localhost nagios]# pwd\r\n/usr/share/puppet/ext/nagios\r\n[root@localhost nagios]# ./check_puppet.rb \r\n./check_puppet.rb:30: formal argument cannot be a constant\r\n    \"Default: #{OPTIONS[:statefile]}\") { |OPTIONS[:statefile]| }\r\n                                                 ^\r\n./check_puppet.rb:30: syntax error, unexpected '[', expecting '|'\r\n    \"Default: #{OPTIONS[:statefile]}\") { |OPTIONS[:statefile]| }\r\n                                                  ^\r\n./check_puppet.rb:35: formal argument cannot be a constant\r\n    \"Default: #{OPTIONS[:process]}\")   { |OPTIONS[:process]| }\r\n                                                 ^\r\n./check_puppet.rb:35: syntax error, unexpected '[', expecting '|'\r\n    \"Default: #{OPTIONS[:process]}\")   { |OPTIONS[:process]| }\r\n                                                  ^\r\n./check_puppet.rb:40: formal argument cannot be a constant\r\n...nterval]} minutes\")  { |OPTIONS[:interval]| }\r\n...                               ^\r\n./check_puppet.rb:40: syntax error, unexpected '[', expecting '|'\r\n...terval]} minutes\")  { |OPTIONS[:interval]| }\r\n...                               ^\r\n{noformat}","closed_at":"2016-04-26T12:23:24.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5356","labels":"check_puppet.rb;nagios","state":"Closed","updated_at":"2016-04-26T12:23:24.000-0700","timestamp":1652285035.014508,"priority":"Normal","status_category":"Done","pull_request":4477},{"issue_id":"125900","title":"Stack overflow when checking assignability of recursive aliases","url":"https://tickets.puppetlabs.com/browse/PUP-6145","created_at":"2016-04-09T22:44:40.000-0700","number":"PUP-6145","body":"The following code:\r\n\r\n{code}\r\ntype X = Variant[X, Y, Z]\r\ntype Y = Variant[X, String]\r\ntype Z = Variant[Integer]\r\n\r\nnotice(X >= X)\r\n{code}\r\n\r\nResults in a stack overflow.\r\n\r\nThe expected output should be {{true}}.\r\n\r\nIt is expected that {{X >= Y}}, {{X >= Z}}, {{X >= Variant[String]}}, {{X >= Variant[Integer]}}, {{X >= Variant[String, Integer]}}, {{X >= Integer}}, and {{X >= String}} also evaluate to true.\r\n\r\nACCEPTANCE CRITERIA\r\n----\r\nThat the above example outputs a boolean {{true}} instead of causing an Out of Stack Error.","closed_at":"2016-04-27T07:23:29.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6145","labels":"","state":"Closed","updated_at":"2016-04-27T07:23:29.000-0700","timestamp":1652285035.429781,"priority":"Normal","status_category":"Done","pull_request":4864},{"issue_id":"126133","title":"Access operator is not implemented for Iterable type","url":"https://tickets.puppetlabs.com/browse/PUP-6155","created_at":"2016-04-11T16:04:35.000-0700","number":"PUP-6155","body":"The following code causes a compilation error:\r\n\r\n{code}\r\nfunction foo(Iterable[String] $x) {\r\n  $x.each |$e| {\r\n    notice $e\r\n  }\r\n}\r\n\r\nfoo([bar, baz, cake])\r\n{code}\r\n\r\nResulting in:\r\n{code}\r\nError: Evaluation Error: Operator '[]' is not applicable to an Iterable-Type.\r\n{code}\r\n\r\nExpected output:\r\n{code}\r\nNotice: Scope(Class[main]): bar\r\nNotice: Scope(Class[main]): baz\r\nNotice: Scope(Class[main]): cake\r\n{code}\r\n\r\nThis is because the access operator for {{Iterable}} is not implemented.  I'd expect the access operator to take a single type parameter to construct a constrained {{Iterable}} type.","closed_at":"2016-04-27T07:23:29.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6155","labels":"","state":"Closed","updated_at":"2016-04-27T07:23:29.000-0700","timestamp":1652285035.639099,"priority":"Normal","status_category":"Done","pull_request":4871},{"issue_id":"121876","title":"Optional type misinterpreted by epp() and inline_epp() in puppet 4.4.0","url":"https://tickets.puppetlabs.com/browse/PUP-6064","created_at":"2016-03-17T03:50:35.000-0700","number":"PUP-6064","body":"Here is the code to realize the problem.\r\n\r\n{code}\r\ninline_epp( '<%- |Optional[String[1]] $var| -%>', { 'var' => undef } )\r\n{code}\r\n\r\nThe value {{undef}} is given to the variable {{var}} and it should be accepted by the function {{inline_epp()}} because the type of {{var}} is:\r\n\r\n{code}\r\nOptional[String[1]]\r\n{code}\r\n\r\nwhich means {{ok to have a value undef}}. But with Puppet 4.4.0, we have an error:\r\n\r\n{code}\r\n~# puppet --version\r\n\r\n~# puppet apply /tmp/test.pp \r\nError: Evaluation Error: Error while evaluating a Function Call, lambda: expects a value for parameter 'var' at /tmp/test.pp:1:1 on node puppet.athome.priv\r\n{code}\r\n\r\nWe have exactly the same error with the function {{epp()}}.\r\n\r\nNote: with Puppet 4.3.2, the same worked correctly:\r\n\r\n{code}\r\n~# puppet --version\r\n4.3.2\r\n\r\n~# puppet apply /tmp/test.pp \r\nNotice: Compiled catalog for middleware.athome.priv in environment production in 0.04 seconds\r\nNotice: Applied catalog in 0.12 seconds\r\n{code}\r\n\r\nWhen doing this (setting a default value):\r\n{code:puppet}\r\n# cat pup6064.pp\r\nnotice inline_epp( '<%- |Optional[String[1]] $var=ouch| -%> <%= $var %>', { 'var' => undef } )\r\n# puppet apply pup6064.pp\r\nouch\r\n{code}\r\n\r\nClearly shows the regression - EPP now has define/class instantiation call semantics as the {undef} picks the default.","closed_at":"2016-04-27T07:23:29.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6064","labels":"","state":"Closed","updated_at":"2016-04-27T07:23:29.000-0700","timestamp":1652285035.744298,"priority":"Normal","status_category":"Done","pull_request":4858},{"issue_id":"123157","title":"Subkeys can be matched by string values that contain the subkey.","url":"https://tickets.puppetlabs.com/browse/PUP-6085","created_at":"2016-03-23T09:40:32.000-0700","number":"PUP-6085","body":"A subkey of a dotted key can be matched by a string that contains the key. Given the following data (yaml):\r\n{code:yaml}\r\n---\r\nfoo: bar\r\n{code}\r\na lookup of the key 'foo.bar' will produce 'bar'. This happens because the data provider asks if the value responds to {{:\\[\\]}} and a ruby {{String}} will. Then {{\"bar\"\\[\"bar\"\\]}} returns {{\"bar\"}}.\r\n\r\nACCEPTANCE CRITERIA\r\n----\r\n* that a lookup of {{foo.bar}} does not produce {{'bar'}} when the key {{foo}} is bound to the string {{'bar'}}","closed_at":"2016-04-27T07:23:30.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6085","labels":"","state":"Closed","updated_at":"2016-04-27T07:23:30.000-0700","timestamp":1652285036.061037,"priority":"Normal","status_category":"Done","pull_request":4807},{"issue_id":"126370","title":"Default Tuple type constructed with \"max\" of 0 instead of \"infinity\".","url":"https://tickets.puppetlabs.com/browse/PUP-6167","created_at":"2016-04-12T15:50:14.000-0700","number":"PUP-6167","body":"The following code:\r\n\r\n{code}\r\nnotice(Tuple >= Tuple[String])\r\n{code}\r\n\r\nOutputs {{false}}.  This is because the {{Tuple}} on the LHS has a min/max value of 0, which makes the bounds check on the {{Tuple}} on the RHS, which has min/max of 1, evaluate to false.\r\n\r\nBased on the specification of {{Tuple}}, a default constructed {{Tuple}} should have a \"positive infinity\" default max value (i.e. max {{Integer}}).  Therefore it is expected that the above code outputs {{true}} as all instances of {{Tuple}} should be assignable to default {{Tuple}}.","closed_at":"2016-04-27T07:23:30.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6167","labels":"","state":"Closed","updated_at":"2016-04-27T07:23:30.000-0700","timestamp":1652285036.164978,"priority":"Normal","status_category":"Done","pull_request":4878},{"issue_id":"126039","title":"Parameterized Collection type is incorrectly constructed","url":"https://tickets.puppetlabs.com/browse/PUP-6149","created_at":"2016-04-11T11:52:14.000-0700","number":"PUP-6149","body":"The following code:\r\n\r\n{code}\r\nnotice(Collection[5, 5] > Tuple[Integer, 0, 10])\r\n{code}\r\n\r\nOutputs {{true}} when the expected output is {{false}} because the {{Tuple}}'s range is outside of the accepted range of the {{Collection}}.\r\n\r\nIt looks like the access operator for {{Collection}} is improperly implemented:\r\n\r\n{code}\r\nTypes::PCollectionType.new(size_t)\r\n{code}\r\n\r\nIt is passing the size type as the first argument whereas the initializer for {{PCollectionType}} expects the element type for the first argument and an optional size type for the second.\r\n\r\nI believe this should be:\r\n\r\n{code}\r\nTypes::PCollectionType.new(nil, size_t)\r\n{code}\r\n\r\nACCEPTANCE CRITERIA\r\n----\r\n* {{notice(Collection\\[5, 5] > Tuple\\[Integer, 0, 10])}} - should result in {{false}}","closed_at":"2016-04-27T07:23:30.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6149","labels":"","state":"Closed","updated_at":"2016-04-27T07:23:30.000-0700","timestamp":1652285036.269145,"priority":"Normal","status_category":"Done","pull_request":4873},{"issue_id":"123986","title":"Indirection symbol name inappropriately compared to string","url":"https://tickets.puppetlabs.com/browse/PUP-6105","created_at":"2016-03-29T09:20:29.000-0700","number":"PUP-6105","body":"When I startup Puppet under Puppet Server, I've noticed messages like this one:\r\n\r\n{noformat}\r\n2016-03-29 08:44:49,364 WARN  [clojure-agent-send-pool-7] [puppet-server] Puppet Comparing Symbols to non-Symbol values is deprecated\r\n   (file & line not available)\r\n{noformat}\r\n\r\nTracing the source of the message, it appears to be happening, at least in one case, due to this comparison:\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/master/lib/puppet/indirector/terminus.rb#L73\r\n\r\nIn this case, the previous line does a {{.intern}} call to produce the {{indirection_name}}.  Since the result would produce a symbol, it seems like the comparison above should only compare for an empty symbol - maybe something like...\r\n\r\n{code:ruby}\r\nif indirection_name == :\"\"\r\n  raise Puppet::DevError, \"Could not discern indirection model from class constant\"\r\nend\r\n{code}","closed_at":"2016-04-27T07:23:30.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6105","labels":"","state":"Closed","updated_at":"2016-04-27T07:23:30.000-0700","timestamp":1652285036.373227,"priority":"Normal","status_category":"Done","pull_request":4845},{"issue_id":"125906","title":"PStructType#assignable? ignores Hash key type.","url":"https://tickets.puppetlabs.com/browse/PUP-6147","created_at":"2016-04-10T13:51:09.000-0700","number":"PUP-6147","body":"The following code:\r\n\r\n{code}\r\nnotice(Struct[{foo => String, bar => String}] >= Hash[Integer, String, 2, 2])\r\n{code}\r\n\r\noutputs {{true}} because it ignores the key type in the {{Hash}} entirely for required keys.\r\n\r\nIt is expected that this outputs {{false}} because the keys of the {{Hash}} are not strings.\r\n\r\nI would also expect a {{Hash}} with key type {{String[2]}} to not be assignable if all the keys in the structure are of length 1, for example, so the key strings in the structure probably need to be checked to see if they are an instance of the {{Hash}} key type.\r\n\r\nACCEPTANCE CRITERIA\r\n----\r\nThat the above example outputs {{false}}\r\n","closed_at":"2016-04-27T07:23:31.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6147","labels":"","state":"Closed","updated_at":"2016-04-27T07:23:31.000-0700","timestamp":1652285036.477261,"priority":"Minor","status_category":"Done","pull_request":4866},{"issue_id":"125394","title":"Unexpected result when accessing a hash using a Struct type. ","url":"https://tickets.puppetlabs.com/browse/PUP-6133","created_at":"2016-04-06T15:57:43.000-0700","number":"PUP-6133","body":"The following:\n{code}\nnotice({Struct[{foo => String}] => hi}[Struct[{foo => String}]])\n{code}\n\nOutputs:\n{code}\nNotice: Scope(Class[main]):\n{code}\n\nExpected:\n{code}\nNotice: Scope(Class[main]): hi\n{code}\n\nI'd expect the access of the hash with the same exact type to be successful.\n\nACCEPTANCE CRITERIA\n----\nThat the example above outputs {{hi}} instead of {{undef}}","closed_at":"2016-04-27T07:23:31.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6133","labels":"","state":"Closed","updated_at":"2016-04-27T07:23:31.000-0700","timestamp":1652285036.581737,"priority":"Normal","status_category":"Done","pull_request":4868},{"issue_id":"125913","title":"Callable#assignable? results in undefined method `assignable?' for nil:NilClass","url":"https://tickets.puppetlabs.com/browse/PUP-6148","created_at":"2016-04-10T23:56:21.000-0700","number":"PUP-6148","body":"The following code:\r\n\r\n{code}\r\nnotice(Callable > Callable[String])\r\n{code}\r\n\r\nResults in:\r\n\r\n{code}\r\nError: Evaluation Error: Error while evaluating a '>' expression, undefined method `assignable?' for nil:NilClass at foo.pp:1:17 on node peterhu-osx\r\n{code}\r\n\r\nExpected result is to output {{true}} (all callables should be assignable to {{Callable}}).\r\n\r\nACCEPTANCE CRITERIA\r\n----\r\nThat the above example does not fail, and instead outputs {{true}}","closed_at":"2016-04-27T07:23:31.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6148","labels":"","state":"Closed","updated_at":"2016-04-27T07:23:31.000-0700","timestamp":1652285036.687495,"priority":"Normal","status_category":"Done","pull_request":4867},{"issue_id":"123902","title":"A type alias that has an alias name of a built-in type should be illegal","url":"https://tickets.puppetlabs.com/browse/PUP-6102","created_at":"2016-03-28T15:37:24.000-0700","number":"PUP-6102","body":"I would expect the following to be illegal:\r\n\r\n{code}\r\ntype String = Integer\r\n{code}\r\n\r\nAs {{String}} is a built-in type and should not be \"redefined\".","closed_at":"2016-04-27T07:23:32.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6102","labels":"","state":"Closed","updated_at":"2016-04-27T07:23:32.000-0700","timestamp":1652285036.792759,"priority":"Normal","status_category":"Done","pull_request":4863},{"issue_id":"124636","title":"Unexpected result when using a type alias to a recursive variant.","url":"https://tickets.puppetlabs.com/browse/PUP-6117","created_at":"2016-04-01T12:05:47.000-0700","number":"PUP-6117","body":"I would expect this code:\r\n\r\n{code}\r\ntype MixedScalar = Variant[Integer, MixedScalar]\r\nnotice(foo =~ MixedScalar)\r\n{code}\r\n\r\nto output {{false}}.  Instead it outputs {{true}}.\r\n\r\nACCEPTANCE CRITERIA\r\n----\r\nThat the example above produces false.","closed_at":"2016-04-27T07:23:32.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6117","labels":"","state":"Closed","updated_at":"2016-04-27T07:23:32.000-0700","timestamp":1652285036.897555,"priority":"Major","status_category":"Done","pull_request":4830},{"issue_id":"127090","title":"Puppet CA face broken","url":"https://tickets.puppetlabs.com/browse/PUP-6179","created_at":"2016-04-18T11:06:38.000-0700","number":"PUP-6179","body":"The Puppet CA face appears to have been broken the entire lifetime of Puppet 4.","closed_at":"2016-04-27T07:23:32.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6179","labels":"","state":"Closed","updated_at":"2016-04-27T07:23:32.000-0700","timestamp":1652285037.001111,"priority":"Normal","status_category":"Done","pull_request":4893},{"issue_id":"125905","title":"PStructType#assignable? may return nil when compared against a Hash","url":"https://tickets.puppetlabs.com/browse/PUP-6146","created_at":"2016-04-10T13:21:40.000-0700","number":"PUP-6146","body":"The following code:\n\n{code}\nnotice(Struct[{foo => Integer, bar => String}] >= Hash[String, String, 2, 2])\n{code}\n\noutputs nothing because {{PStructType#assignable?}} returns nil rather than a boolean for this example.\n\nThe expected output should be {{false}} ({{Integer}} is not assignable from {{String}}).\n\nACCEPTANCE CRITERIA\n----\nThat example above outputs {{false}} instead of empty string (for {{undef}}).","closed_at":"2016-04-27T07:23:33.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6146","labels":"","state":"Closed","updated_at":"2016-04-27T07:23:33.000-0700","timestamp":1652285037.105077,"priority":"Minor","status_category":"Done","pull_request":4865},{"issue_id":"126135","title":"Access operator is not implemented for Iterator type","url":"https://tickets.puppetlabs.com/browse/PUP-6156","created_at":"2016-04-11T16:07:38.000-0700","number":"PUP-6156","body":"The following code causes a compilation error:\n\n{code}\nfunction foo(Iterator[String] $x) {\n  $x.each |$e| {\n    notice $e\n  }\n}\n\nfoo([bar, baz, cake].reverse_each)\n{code}\n\nResulting in:\n{code}\nError: Evaluation Error: Operator '[]' is not applicable to an Iterator-Type.\n{code}\n\nExpected output:\n{code}\nNotice: Scope(Class[main]): cake\nNotice: Scope(Class[main]): baz\nNotice: Scope(Class[main]): bar\n{code}\n\nThis is because the access operator for {{Iterator}} is not implemented.  I'd expect the access operator to take a single type parameter to construct a constrained {{Iterator}} type.\n\nACCEPTANCE CRITERIA\n----\n* That it is possible to narrow an {{Iterator}} using access operator i.e {{Iterator\\[T]}}\n* That the above example produces the expected result.","closed_at":"2016-04-27T07:23:33.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6156","labels":"","state":"Closed","updated_at":"2016-04-27T07:23:33.000-0700","timestamp":1652285037.209815,"priority":"Normal","status_category":"Done","pull_request":4872},{"issue_id":"115868","title":"Puppet Array & Hash types should present themselves as just Array/Hash when they are default","url":"https://tickets.puppetlabs.com/browse/PUP-5861","created_at":"2016-02-09T20:58:24.000-0800","number":"PUP-5861","body":"Both Array and Hash presents themselves in string with the default type parameters expanded e.g. {{Hash\\[Scalar, Data, 0]}} when turned into a string. This is surprising and confusing for users.\r\n\r\nThe string operation should check if the type parameters are the default parameters and then suppress the type parameters and present itself as just {{Array}} or {{Hash}}.","closed_at":"2016-04-27T16:18:42.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5861","labels":"","state":"Closed","updated_at":"2016-04-27T16:18:42.000-0700","timestamp":1652285037.626813,"priority":"Normal","status_category":"Done","pull_request":4655},{"issue_id":"116002","title":"Iterators are presenting themselves as Ruby type names","url":"https://tickets.puppetlabs.com/browse/PUP-5875","created_at":"2016-02-10T13:31:57.000-0800","number":"PUP-5875","body":"This code:\r\n\r\n{code}\r\nnotice [].reverse_each\r\n{code}\r\n\r\nOutputs:\r\n\r\n{code}\r\nNotice: Scope(Class[main]): #<Puppet::Pops::Types::Iterator:0x007f93ec28f938>\r\n{code}\r\n\r\nI'd expect either a {{Runtime['ruby', 'iterator']}} or something like {{Iterator[<type of thing being iterated>]}}.\r\n\r\n","closed_at":"2016-04-27T16:19:59.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5875","labels":"","state":"Closed","updated_at":"2016-04-27T16:19:59.000-0700","timestamp":1652285037.836259,"priority":"Normal","status_category":"Done","pull_request":4653},{"issue_id":"115505","title":"Symbol in scope; puppet apply -e 'notify { $environment: }' raises an exception","url":"https://tickets.puppetlabs.com/browse/PUP-5835","created_at":"2016-02-07T12:34:13.000-0800","number":"PUP-5835","body":null,"closed_at":"2016-04-27T16:20:10.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5835","labels":"","state":"Closed","updated_at":"2016-04-27T16:20:10.000-0700","timestamp":1652285037.941975,"priority":"Normal","status_category":"Done","pull_request":4646},{"issue_id":"113443","title":"CapabilityFinder fails when used with PuppetDB 4.0 terminus code","url":"https://tickets.puppetlabs.com/browse/PUP-5745","created_at":"2016-01-22T13:12:02.000-0800","number":"PUP-5745","body":"When used with the terminus code from the upcoming PuppetDB 4.0 release, the CapabilityFinder fails with an arity exception when attempting to call Puppet::Util::Puppetdb::Http.action(url). In PuppetDB 4, this method has a second required argument which is the request mode ('query' vs. 'command'). In this case, the second argument should always be 'query', but we also need to determine whether or not to pass that argument.","closed_at":"2016-04-27T16:27:18.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5745","labels":"","state":"Closed","updated_at":"2016-04-27T16:27:18.000-0700","timestamp":1652285038.261305,"priority":"Major","status_category":"Done","pull_request":4600},{"issue_id":"103169","title":"symbolic_modes tests occasionally fail on OSX","url":"https://tickets.puppetlabs.com/browse/PUP-5444","created_at":"2015-10-28T08:00:16.000-0700","number":"PUP-5444","body":"symbolic_modes tests occasionally fail on OS X like:\r\n\r\n{code}\r\nErrored Tests Cases:\r\n  Test Case tests/resource/file/symbolic_modes.rb reported: #<Beaker::Host::CommandFailure: Host 'nn8elbm0jop4j4t.delivery.puppetlabs.net' exited with 1 running:\r\n env PATH=\"/opt/puppetlabs/puppet/bin:${PATH}\" ruby -e 'require \"etc\"; puts (Etc.getgrgid(File.stat(\"/var/folders/zz/zyxvpxvq6csfxvn_n0000000000000/T/symbolic-modes.XXXXXX.oAsbXzPO/file\").gid).name)'\r\nLast 10 lines of output were:\r\n\t-e:1:in `getgrgid': can't find group for 719 (ArgumentError)\r\n\t\tfrom -e:1:in `<main>'>\r\n{code}","closed_at":"2016-04-27T16:39:42.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5444","labels":"","state":"Closed","updated_at":"2016-04-27T16:39:42.000-0700","timestamp":1652285038.471746,"priority":"Normal","status_category":"Done","pull_request":4453},{"issue_id":"115840","title":"Revert the implementation of PUP-5659 before it is released in 4.4.0","url":"https://tickets.puppetlabs.com/browse/PUP-5850","created_at":"2016-02-09T16:25:25.000-0800","number":"PUP-5850","body":"In PUP-5659 we improved the validation of resource references in meta parameters. This had far reaching consequences that there is no time to fix late in the 4.4.0 release cycle.\r\n\r\nWe will instead revert that change. PUP-5659 is now targeting Puppet 5.0.0.","closed_at":"2016-04-27T16:39:43.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5850","labels":"","state":"Closed","updated_at":"2016-04-27T16:39:43.000-0700","timestamp":1652285038.781984,"priority":"Critical","status_category":"Done","pull_request":4651},{"issue_id":"90658","title":"Acceptance test for packages has dependency on rubygems.org","url":"https://tickets.puppetlabs.com/browse/PUP-4929","created_at":"2015-07-27T09:52:17.000-0700","number":"PUP-4929","body":"The acceptance test tests/resource/package.common_package_name_in_different_providers.rb uses rubygems.org during its run to install a gem. This should be updated to use GEM_SOURCE if set so we can use internal infrastructure.","closed_at":"2016-04-27T16:39:43.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4929","labels":"","state":"Closed","updated_at":"2016-04-27T16:39:43.000-0700","timestamp":1652285038.886386,"priority":"Normal","status_category":"Done","pull_request":4682},{"issue_id":"104556","title":"Puppet acceptance fails on fedora 22","url":"https://tickets.puppetlabs.com/browse/PUP-5478","created_at":"2015-11-05T11:18:34.000-0800","number":"PUP-5478","body":"{noformat}\r\nexport SHA=4c92898c5bde18911e9cfde820c3dd6049941c1e\r\nexport SUITE_VERSION=1.2.7.389.g4c92898\r\nexport CONFIG=config/nodes/fedora-22-x86_64.yaml\r\n{noformat}\r\n\r\n{noformat}\r\nBegin tests/resource/service/service_enable_linux.rb\r\n\r\nSysV and Systemd Service Provider Validation\r\n\r\nxjg7kxzxs85t8md.delivery.puppetlabs.net (agent) 10:11:26$ facter operatingsystemmajrelease\r\n  22\r\n\r\nxjg7kxzxs85t8md.delivery.puppetlabs.net (agent) executed in 0.05 seconds\r\nWarning: \r\nProvider needs manual update to support Fedora 22\r\n{noformat}\r\n\r\n{noformat}\r\nBegin tests/resource/package/common_package_name_in_different_providers.rb\r\n\r\nticket 1073: common package name in two different providers should be allowed\r\n\r\n* Verify gem and ruby-devel on fedora-22 and above if not aio\r\n\r\nxjg7kxzxs85t8md.delivery.puppetlabs.net (agent) 10:06:21$ which dnf\r\n  /usr/bin/dnf\r\n\r\n...\r\n\r\nxjg7kxzxs85t8md.delivery.puppetlabs.net (agent) 10:07:23$ gem list --local\r\n  bash: gem: command not found\r\n{noformat}","closed_at":"2016-04-27T16:39:46.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5478","labels":"","state":"Closed","updated_at":"2016-04-27T16:39:46.000-0700","timestamp":1652285039.6192,"priority":"Normal","status_category":"Done","pull_request":4418},{"issue_id":"98361","title":"On EL4, the AIO puppet-agent is unable to manage the puppet service","url":"https://tickets.puppetlabs.com/browse/PUP-5257","created_at":"2015-09-16T10:32:04.000-0700","number":"PUP-5257","body":"On EL4 builds of the AIO puppet-agent, Puppet is unable to manage the puppet service:\r\n\r\nAs seen in the puppet-agent 1.2.4 build for EL4:\r\n\r\n{code}\r\n# /opt/puppetlabs/puppet/bin/puppet resource service puppet ensure=running\r\nservice { 'puppet':\r\n  ensure => 'running',\r\n}\r\n# service puppet status\r\npuppet is stopped\r\n# service puppet start\r\nStarting puppet agent:                                     [  OK  ]\r\n# /opt/puppetlabs/puppet/bin/puppet resource service puppet ensure=stopped\r\nError: /Service[puppet]/ensure: change from running to stopped failed: SIGTERM\r\nError: Could not run: SIGTERM\r\n{code}\r\n","closed_at":"2016-04-27T16:39:46.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5257","labels":"","state":"Closed","updated_at":"2016-04-27T16:39:46.000-0700","timestamp":1652285039.723292,"priority":"Normal","status_category":"Done","pull_request":4252},{"issue_id":"68019","title":"Spec test failure on ruby 1.8.7: ProviderSystemd should not be the default provider on rhel4","url":"https://tickets.puppetlabs.com/browse/PUP-4011","created_at":"2015-02-13T08:50:55.000-0800","number":"PUP-4011","body":"CI spec test failure on master branch: [See CI failure|https://jenkins.puppetlabs.com/job/Puppet-Specs-stable/275/facter=master,hiera=master,installation=base,label=unit,ruby=ruby-1.8.7-p374/testReport/junit/(root)/Puppet__Type__Service__ProviderSystemd/Puppet__Type__Service__ProviderSystemd_should_not_be_the_default_provider_on_rhel4/]\r\n\r\n\r\n\r\n*Error Message*\r\n{code}\r\nfailed Puppet::Type::Service::ProviderSystemd should not be the default provider on rhel4\r\n{code}\r\n\r\n*Stacktrace*\r\n{code}\r\n        not all expectations were satisfied\r\nunsatisfied expectations:\r\n- expected exactly once, not yet invoked: Facter.value(:operatingsystem)\r\nsatisfied expectations:\r\n- allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n- allowed any number of times, not yet invoked: Puppet::Type::Service.defaultprovider(any_parameters)\r\n- allowed any number of times, not yet invoked: Puppet::Type::Service::ProviderSystemd.which('systemctl')\r\n- expected at least once, invoked twice: Facter.value(:operatingsystemmajrelease)\r\n- expected at least once, invoked 3 times: Facter.value(:osfamily)\r\n\r\n./spec/unit/provider/service/systemd_spec.rb:36\r\n{code}","closed_at":"2016-04-27T16:39:46.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4011","labels":"","state":"Closed","updated_at":"2016-04-27T16:39:46.000-0700","timestamp":1652285039.826359,"priority":"Normal","status_category":"Done","pull_request":3606},{"issue_id":"98370","title":"On SLES 10 and 11 AIO builds of puppet-agent, the puppet service fails to start","url":"https://tickets.puppetlabs.com/browse/PUP-5258","created_at":"2015-09-16T11:19:55.000-0700","number":"PUP-5258","body":"In pre-release builds of the AIO puppet-agent (from the master branch), the puppet service fails to start on SLES 10 and 11:\r\n\r\nAs seen with puppet-agent-1.2.3.338.gd674f45-1.sles11:\r\n\r\n{code}\r\n# service puppet start\r\nStarting puppet services.Error: Could not prepare for execution: The puppet agent command does not take parameters\r\nstartproc:  exit status of parent of /opt/puppetlabs/puppet/bin/puppet: 1\r\n{code}\r\n\r\n\r\n","closed_at":"2016-04-27T16:39:46.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5258","labels":"","state":"Closed","updated_at":"2016-04-27T16:39:46.000-0700","timestamp":1652285039.92954,"priority":"Normal","status_category":"Done","pull_request":4256},{"issue_id":"113182","title":"Add a step(<n>) function","url":"https://tickets.puppetlabs.com/browse/PUP-5730","created_at":"2016-01-21T03:44:59.000-0800","number":"PUP-5730","body":"Add a step(iterable, n) function that takes two arguments and an optional block. The declared parameter types must be `Iterable` and `Integer[1]` (a positive integer).\r\n\r\nIf the function is called without a block, it must return a new iterable that will yield each nth element of the given argument\r\nWhen a block is given, it must be called with each nth element of the given argument. The argument is then returned.\r\n\r\nExample:\r\n{code:puppet}\r\n[1,2,3,4,5,6,7,8].step(3) |$x| { notice($x) }\r\n{code}\r\nwill result in the notices '1', '4', '7'\r\n{code:puppet}\r\n$c =.[1,2,3,4,5,6,7,8].step(3).map |$x| { $x * 10 }\r\n{code}\r\nWill result in:\r\n{code:puppet}\r\n$c == [10, 40, 70]\r\n{code}","closed_at":"2016-04-27T16:40:17.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5730","labels":"","state":"Closed","updated_at":"2016-04-27T16:40:17.000-0700","timestamp":1652285040.242677,"priority":"Normal","status_category":"Done","pull_request":4589},{"issue_id":"113181","title":"Add a reverse_each function","url":"https://tickets.puppetlabs.com/browse/PUP-5729","created_at":"2016-01-21T03:31:13.000-0800","number":"PUP-5729","body":"Add a reverse_each(iterable) function that takes one argument and an optional block. The declared parameter type must be `Iterable`.\r\n\r\nIf the function is called without a block, it must return a new iterable that will yield each element of the given argument in reverse order.\r\nWhen a block is given, it must be called with each element of the given argument in reverse order. The argument is then returned.\r\n\r\nExample:\r\n{code:puppet}\r\n[1,3,5,7].reverse_each |$x| { notice($x) }\r\n{code}\r\nwill result in the notices '7', '5', '3', '1'\r\n{code:puppet}\r\n$c = [1,3,5,7].reverse_each.map |$x| { $x * 10 }\r\n{code}\r\nWill result in:\r\n{code:puppet}\r\n$c == [70, 50, 30, 10].\r\n{code}","closed_at":"2016-04-27T16:40:38.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5729","labels":"","state":"Closed","updated_at":"2016-04-27T16:40:38.000-0700","timestamp":1652285040.352001,"priority":"Normal","status_category":"Done","pull_request":4588},{"issue_id":"84332","title":"resource_types response has AST for parameters' default values","url":"https://tickets.puppetlabs.com/browse/PUP-4747","created_at":"2015-06-11T17:03:24.000-0700","number":"PUP-4747","body":"In Puppet 3.x, the resource_types response would contain the unevaluated code assigned to a parameter's default value. For example, if a class were declared as follows:\r\n\r\n{code}\r\nclass foo($bar=[\"1\", \"2\"]) {\r\n}\r\n{code}\r\n\r\nThen the class's representation in the resource_types response would include:\r\n{code}\r\n\"parameters\": \"[\\\"1\\\", \\\"2\\\"]\"\r\n{code}\r\n\r\nIn Puppet 4.1.0 and above (and probably 4.0.0 as well, though I haven't tested that), the default value is the abstract syntax tree representation rather than the code as written. For the class defined above, the default value in the resource_types response is now:\r\n\r\n{code}\r\n\"parameters\": \"([] '1' '2')\"\r\n{code}","closed_at":"2016-04-27T16:44:44.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4747","labels":"regression","state":"Closed","updated_at":"2016-04-27T16:44:44.000-0700","timestamp":1652285040.459425,"priority":"Blocker","status_category":"Done","pull_request":4030},{"issue_id":"117422","title":"Optional data type and data binding with undef as default value","url":"https://tickets.puppetlabs.com/browse/PUP-5925","created_at":"2016-02-18T16:58:35.000-0800","number":"PUP-5925","body":"ORIGINAL REPORT\r\n-----\r\nAll the files are in .zip attached file. I have a (very basic) module with the function {{data.pp}} as data provider and the default value of a parameter is {{undef}}:\r\n\r\n{code:puppet}\r\nfunction test::data {\r\n  {\r\n    test::foo::param => undef,\r\n  }\r\n}\r\n{code}\r\n\r\nIn the class {{::test::foo}}, I have this code:\r\n\r\n{code:puppet}\r\nclass test::foo ( Optional[ String[1] ] $param ) { }\r\n{code}\r\n\r\nAs you can see, the type of the parameter {{$param}} is an {{Optional}} which means that a {{undef}} value is accepted. However, if I test this code:\r\n\r\n{code:puppet}\r\ninclude '::test::foo'\r\n{code}\r\n\r\nI have an error:\r\n\r\n{code}\r\n~# puppet apply /puppet/modules/test/examples/example.pp \r\nError: Evaluation Error: Error while evaluating a Function Call, Class[Test::Foo]: expects a value for parameter 'param' at /puppet/modules/test/examples/example.pp:1:1 on node puppet.athome.priv\r\n{code}\r\n\r\nIt seems to me that it's not the expected behavior.\r\nRegards.\r\n\r\nPS: currently a possible and simple workaround is to set a {{undef}} default value in the declaration of the class like this:\r\n\r\n{code:puppet}\r\nclass test::foo ( Optional[ String[1] ] $param = undef ) { }\r\n{code}\r\n\r\nbut you have to set the {{undef}} value in two different places.\r\n\r\n\r\nUPDATE\r\n----\r\nThis is fixed so that if an {{undef}} value is bound for a parameter key data binding will assign that {{undef}} to the parameter if the parameter does not have a default value expression. Earlier such a binding would have failed and required that the parameter had a default value expression of {{= undef}} in order to make a lookup of {{undef}} possible.\r\n","closed_at":"2016-04-27T16:46:01.000-0700","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5925","labels":"","state":"Closed","updated_at":"2016-04-27T16:46:01.000-0700","timestamp":1652285040.56848,"priority":"Normal","status_category":"Done","pull_request":4687},{"issue_id":"114237","title":"when puppet module-level data provider function defines an unqualified key, puppet lookup returns nothing","url":"https://tickets.puppetlabs.com/browse/PUP-5761","created_at":"2016-01-28T00:43:37.000-0800","number":"PUP-5761","body":"Define a module level data provider function, either puppet function or ruby function like this:\r\n{code}\r\n[root@b8pwin0w4p7demn ~]# cat /etc/puppetlabs/code/environments/production/modules/hello/lib/puppet/functions/hello/data.rb\r\nPuppet::Functions.create_function(:'hello::data') do\r\n  def data()\r\n    {\r\n      'hello::module_key' => 'module-hello-ruby-function provided data',\r\n      'global_key' => 'module-hello-ruby-function provided data',\r\n    }\r\n  end\r\nend\r\n[root@b8pwin0w4p7demn ~]#\r\n{code}\r\nThat is, defining two key-value pairs, one qualified with the name of the module (hello::module_key), the other unqualified (global_key).\r\n\r\nNow try to lookup hello::module_key.  We get nothing, exit code 1 indicating the key was not found.  --explain does not help.\r\n{code}\r\n[root@b8pwin0w4p7demn ~]# puppet lookup hello::module_key\r\n[root@b8pwin0w4p7demn ~]# echo $?\r\n1\r\n[root@b8pwin0w4p7demn ~]# puppet lookup hello::module_key --explain\r\n\r\n[root@b8pwin0w4p7demn ~]# echo $?\r\n0\r\n[root@b8pwin0w4p7demn ~]#\r\n{code}\r\nNow comment out the second definition in data.rb and try again.\r\n{code}\r\n[root@b8pwin0w4p7demn ~]# vi /etc/puppetlabs/code/environments/production/modules/hello/lib/puppet/functions/hello/data.rb\r\n[root@b8pwin0w4p7demn ~]# cat /etc/puppetlabs/code/environments/production/modules/hello/lib/puppet/functions/hello/data.rb\r\nPuppet::Functions.create_function(:'hello::data') do\r\n  def data()\r\n    {\r\n      'hello::module_key' => 'module-hello-ruby-function provided data',\r\n#      'global_key' => 'module-hello-ruby-function provided data',\r\n    }\r\n  end\r\nend\r\n[root@b8pwin0w4p7demn ~]# puppet lookup hello::module_key\r\n--- module-hello-ruby-function provided data\r\n...\r\n[root@b8pwin0w4p7demn ~]# puppet lookup hello::module_key --explain\r\nMerge strategy first\r\n  Data Binding \"hiera\"\r\n    No such key: \"hello::module_key\"\r\n  Data Provider \"EnvironmentDataProvider\"\r\n    No such key: \"hello::module_key\"\r\n  Module \"hello\" using Data Provider \"FunctionModuleDataProvider\"\r\n    Found key: \"hello::module_key\" value: \"module-hello-ruby-function provided data\"\r\n  Merged result: \"module-hello-ruby-function provided data\"\r\n[root@b8pwin0w4p7demn ~]#\r\n{code}\r\nNow the lookup of the same key succeeds.  Apparently, unqualified keys-value pairs in the function cause the lookup to abort.  I feel an error message is deserved if the lookup aborts due to the presence of an unqualified key in the function's hash.","closed_at":"2016-04-27T16:46:25.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5761","labels":"","state":"Closed","updated_at":"2016-04-27T16:46:25.000-0700","timestamp":1652285040.785072,"priority":"Normal","status_category":"Done","pull_request":4671},{"issue_id":"109055","title":"Yum provider raises exception if check-update returns unexpected exit code","url":"https://tickets.puppetlabs.com/browse/PUP-5594","created_at":"2015-12-10T08:53:17.000-0800","number":"PUP-5594","body":"Installing PE 2015.2.3 on an AWS instance without internet access fails to install the console successfully.  \r\n\r\nThe yum package provider calls `yum check-update`, and the command returns a non-zero exit code. The package provider tries to emit a warning, but calls a private method in doing so. This causes an exception to be raised and the resource to fail.\r\n\r\n{code}\r\n[2015-11-19 16:52:16.287 UTC] INFO Error: Could not get latest version: private method `warn' called for Puppet::Type::Package::ProviderYum:Class\r\n[2015-11-19 16:52:16.287 UTC] INFO Error: /Stage[main]/Pe_nginx/Package[pe-nginx]/ensure: change from 1.8.0-9.pe.el7 to latest failed: Could not get latest version: private method `warn' called for Puppet::Type::Package::ProviderYum:Class\r\n{code}\r\n\r\nSteps to workaround the issue:\r\n1. Run installer\r\n2. Modifed /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/package/yum.rb:83, commenting out the `warn` directive\r\n3. Proceed with installation in GUI\r\n\r\nThis is probably a trivial fix to the yum provider: update it to emit a warn correctly without raising an exception.","closed_at":"2016-04-27T16:47:19.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5594","labels":"puppethack","state":"Closed","updated_at":"2016-04-27T16:47:19.000-0700","timestamp":1652285041.583547,"priority":"Normal","status_category":"Done","pull_request":4494},{"issue_id":"123372","title":"type function: Unit type being returned for empty array and hash","url":"https://tickets.puppetlabs.com/browse/PUP-6089","created_at":"2016-03-23T22:46:01.000-0700","number":"PUP-6089","body":"The following manifest:\r\n\r\n{code}\r\nnotice(type([]))\r\nnotice(type({}))\r\n{code}\r\n\r\nproduces the following output:\r\n\r\n{code}\r\nNotice: Scope(Class[main]): Array[Unit, 0, 0]\r\nNotice: Scope(Class[main]): Hash[Unit, Unit, 0, 0]\r\n{code}\r\n\r\n{{Unit}} is not part of the Puppet type system and should not be displayed.\r\n\r\nExpected output:\r\n\r\n{code}\r\nNotice: Scope(Class[main]): Array[Any, 0, 0]\r\nNotice: Scope(Class[main]): Hash[Any, Any, 0, 0]\r\n{code}\r\n\r\nACCEPTANCE CRITERIA\r\n----\r\n{code:puppet}\r\nnotice(type([]), type({}))\r\n{code}\r\nShould produce:\r\n{code}\r\nNotice: Scope(Class[main]): Array[0, 0] Hash[0, 0]\r\n{code}\r\n\r\nAnd it is illegal to create an empty typed container:\r\n* Array[Integer, 0, 0]\r\n* Hash[Integer, Integer, 0, 0]\r\n","closed_at":"2016-05-02T05:13:51.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6089","labels":"","state":"Closed","updated_at":"2016-05-02T05:13:51.000-0700","timestamp":1652285042.109196,"priority":"Normal","status_category":"Done","pull_request":4846},{"issue_id":"79275","title":"Too many restarts on interface changes for Fedora, RHEL, CentOS","url":"https://tickets.puppetlabs.com/browse/PUP-4545","created_at":"2015-05-08T00:19:05.000-0700","number":"PUP-4545","body":"In https://projects.puppetlabs.com/issues/2776 a workaround was introduced to restart puppet on Fedora, RHEL, CentOS which restarts puppet on each interface change. The script /etc/NetworkManager/dispatcher.d/98-puppet restarts puppet agents every time a interface goes up or down regardless of the type. \r\nNowadays with VMs and containers you can get a lot of interface up downs for virtual interfaces. Because of the workaround from #2776 this creates a lot of un-necessary agent restarts.\r\n\r\nA workaround of the workaround might be to make a regex blacklist  for interface names, e.G. [ 'veht.*', 'vibr.*', 'docker.*']\r\nA cleaner solution would be to actually monitor /etc/resolv.conf in an agent run, since changes in resolv.conf by agent was the original problem,  and not to use NetworkManager for restarts.\r\n","closed_at":"2016-05-03T14:42:46.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4545","labels":"puppet-agent","state":"Closed","updated_at":"2016-05-03T14:42:46.000-0700","timestamp":1652285042.21387,"priority":"Normal","status_category":"Done","pull_request":4780},{"issue_id":"128229","title":"generated modules will not work with ruby 1.8.7","url":"https://tickets.puppetlabs.com/browse/PUP-6232","created_at":"2016-04-25T12:47:14.000-0700","number":"PUP-6232","body":null,"closed_at":"2016-05-04T15:07:08.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6232","labels":"","state":"Resolved","updated_at":"2016-05-04T15:07:08.000-0700","timestamp":1652285042.626017,"priority":"Normal","status_category":"Done","pull_request":4913},{"issue_id":"97630","title":"Centos 4 fails to list instances of ssh_authorized_keys","url":"https://tickets.puppetlabs.com/browse/PUP-5228","created_at":"2015-09-11T12:00:27.000-0700","number":"PUP-5228","body":"{noformat}\r\n# export SHA=1.2.4\r\n# export CONFIG=config/nodes/centos-4-x86_64.yaml\r\n# bundle exec rake ci:test:aio\r\n...\r\nBegin tests/resource/ssh_authorized_key/destroy.rb\r\n\r\nshould delete an entry for an SSH authorized key\r\n\r\n  * (setup) backup ~/.ssh/authorized_keys file\r\n\r\nsb1nht6p15drgb1.delivery.puppetlabs.net (agent) 11:17:00$ cp ~/.ssh/authorized_keys /tmp/auth_keys\r\n\r\nsb1nht6p15drgb1.delivery.puppetlabs.net (agent) executed in 0.04 seconds\r\n\r\n  * (setup) create an authorized key in the ~/.ssh/authorized_keys file\r\n\r\nsb1nht6p15drgb1.delivery.puppetlabs.net (agent) 11:17:00$ echo 'ssh-rsa mykey pl119002' >> ~/.ssh/authorized_keys\r\n\r\nsb1nht6p15drgb1.delivery.puppetlabs.net (agent) executed in 0.04 seconds\r\n\r\n  * delete an authorized key entry with puppet (absent)\r\n\r\nsb1nht6p15drgb1.delivery.puppetlabs.net (agent) 11:17:00$ puppet resource ssh_authorized_key pl119002 ensure=absent user='root' type='rsa' key='mykey'\r\nssh_authorized_key { 'pl119002':\r\n  ensure => 'absent',\r\n}\r\n\r\nsb1nht6p15drgb1.delivery.puppetlabs.net (agent) executed in 0.80 seconds\r\n\r\n  * verify entry deleted from ~/.ssh/authorized_keys\r\n\r\nsb1nht6p15drgb1.delivery.puppetlabs.net (agent) 11:17:01$ cat ~/.ssh/authorized_keys\r\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC/T0ADg8YIX6C9OvDK8V3O4m2KKTaTcShuAfdhSP8/E6w2SUWwLZVGHM8bD65SnDwXnVo89+La2Yn/7QmJyqZO31LVPh2sMzGFmw57a/s06h2ujkWE3jOL5w9cUBWrrkdP7xbUXFWi6fi+PjSi9/vI1IpBi3X7EmI3mC9ftV9QZbj2wQclhpTNsGaCSJA3ye7G/+7XNWXwaMsPxmTYqD4PBZlbVXQ4dqR3oObkZ8wNWd+qmMvxeSuJ69rSGWTeIqwdGpm2vfcIqn1GM2r+lcCBIB+VXoLDN0zNia2+j5KItVHMyDU+/lQS3oYGdejM2cd6fDBcW1AiSijUbQr0d+fR ci+enterprise@puppetlabs.com\r\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDIrRlZ7kz3U/uOjiXrmJpumRHo8fDWBo+AOCSdqokqNRcALUrpNr6iHRR68Ki1EzPRSvGsdqrh9riStAlJxVroLZt8t2Mt+McydxdvHwJcDSWpZ+UZ1KGXUS1vg4569JZjdi+Gl70WAzJqTxhqIogwcNuZbMMBvJe9oAMCXS1TYMXfPiEcw/hQD/kBNvkSMGTn/siMlNPtaCF+rzlarzUqkEpUnsHmGwqFVHLeVFZ94+2ZD3CzBeJ6m3Ke9IA5ytzOYyPuFP/NVNnEnSrwwe7GSjnxZWT2dzjUrqMgGphWFmeU35oz7r+HxRXsugbMUyN3HEudU268ciYeAvG4xMY3 sqa+ci@puppetlabs.com\r\nssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAsMvODgIqL1NoUgP65qmgf0sJjQy78QdA5rHw9tIwK5KstVSh+0w4TLHJq8Jz8E4UeXhx0NioP3kE3otjCC8kSM5y99QOs4qQh7q6cLN9hQpXMQUD9UnJMP0b5agd0PdErH0ML9hnWfsZX707v31VSIbco+X6Kg9wN8WJhlTXgbbrJTUIPnMzNXrN7Z5/jY6Vss7NTCVI7OxUbIna37l5y8s4jxViaXjoVEXP8e4QtTX8p0BYc2vgerI04ZilhbIe4KEcHiR+n/GUr6MmkY5qtLum/7IZLHbHfWha1q7VaPnz/CHmlDySxxq4sF81N4x2V7d0+x8/wNZx2d+duJmV0Q== jenkins/hudson@puppetlabs.com\r\nssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAxPfb1yjRU7E5cQG9+Eq55WWCsLTRmd/tjv/Ym0Sm+3bsoayfKkd7irZEKlyUlgfNx9IkW45E3o8O+LR2+91U4H+Ao6cxLqyXg/5tqLUyyThkS+KBns7HyxC24nnO3h/84mzC1BCO6p3UAwF4gDtYv1LCxshWuwd0dEUTZFTP8E7Xz6dgKnza0745QnRf4xhx3zRwbjW2iJ97bePNZaZf+EgIDPYcjxqUNr69oCfcC0K11oKuqLpu8pmP4rGC/MxqgadGINEJfP+Y14szE/nIjoEJ71IhP9TEDfEAArPMopqed65xOgo/GVFk8Olhi2+xd2JysiVb6dS5BjjFZpBjuw== jenkins/jetty@enkal.puppetlabs.com\r\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDlFK/6B43EQWBR5C6Oe3yFnmjlVGgE1LXQuvpUS1SYR0jIYAGpK6X/4NwTNniwaRQrklE9dlAoDrWB3VxbczuysKNslwE64refp53A933/PV25QY3jx8vlOgi3ri7Aj/Jk+PpBIHsedLzYYOrD/s7xZ5LZ+8bsjolK8+YZnQcBy7sOpGQYUyP4EHQI91jhigjIwzf6/rhVWsKEHDF2v0RnnP+BjbRlYyG0HOGMwbGqg33Pr5QiTfJQWkYl3JCWB5OGnlRq5xiTvB1nyRMC550dgKjVyRtANk/aZVGsC7aC5EGe0qekBCUvctTqXbNR5N2ek54XHhReUqm0PiImLFXT sqa+builders@puppetlabs.com\r\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCsFUzpOJRglp/6/nEzkRriTuKfc+OcAyfFhgGx2lR+CR2pzGYus5VrcHalT/lHphbc5NGMXGa6tVYNkMPXNvrThlBwHhh9FFx5/6LRXbq8/LD2tDAW1tyPU04Qk0LNvoq+GSX/QPdumgwThlSEqkdBO0EQIR2CR8XYWIytFcYolPoozrolFoaiDyymZCJE4CaPi3TFTb1DIBm4i0VrHFXvdeAsMAe9J5x4wAd14UjDjghYNN/0GnoYxzDk6JnKX00Hvs3AriPJrW5Y7UBA6eGdISsLZRtOw5NKdiTEGH3VWwupIUc049FFpa83V0ySX0YwqGLhClTjk8ltMulcqF0J sqa+shipper@puppetlabs.comssh-rsa mykey pl119002\r\n\r\nsb1nht6p15drgb1.delivery.puppetlabs.net (agent) executed in 0.02 seconds\r\nWarning: \r\nfound the ssh_authorized_key for pl119002\r\n{noformat}","closed_at":"2016-05-11T16:51:06.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5228","labels":"","state":"Closed","updated_at":"2016-05-11T16:51:06.000-0700","timestamp":1652285054.948162,"priority":"Normal","status_category":"Done","pull_request":4251},{"issue_id":"121512","title":"File type does not fsync temp file before checksum verification during file creation","url":"https://tickets.puppetlabs.com/browse/PUP-6059","created_at":"2016-03-15T11:16:55.000-0700","number":"PUP-6059","body":"*Summary*\r\n\r\nWe are seeing checksum verification errors when using Puppet to create files in GlusterFS volumes.\r\n\r\nThe apparent cause of this error is that checksum verification happens before the temporary file is completely synced to the file system, and the verification code uses incomplete cached data that doesn't match what was written to disk.\r\n\r\nModifying file.rb to call fsync() on the temporary file descriptor before checksum verification allows file installation on our GlusterFS volumes to succeed.\r\n\r\nWe are submitting this as a Puppet bug because the read-before-sync order of operations seems incorrect regardless of the file system type being used.\r\n\r\n*Demonstration* {code}\r\n# cat /etc/redhat-release \r\nRed Hat Enterprise Linux Server release 6.7 (Santiago)\r\n# rpm -qa glusterfs\r\nglusterfs-3.7.1-16.el6.x86_64\r\n# rpm -qa pe-puppet\r\npe-puppet-3.6.2.14-1.pe.el6.noarch\r\n# uname -r\r\n2.6.32-573.3.1.el6.x86_64\r\n# mount -t glusterfs glusterhost:/glustervolume /mnt\r\n# cat file-test.pp\r\nfile { '/mnt/this-is-a-file':\r\n  ensure   => 'file',\r\n  content  => \"This is a file!\\n\",\r\n  group    => 'root',\r\n  mode     => '644',\r\n  owner    => 'root',\r\n}\r\n# puppet apply file-test.pp\r\nWarning: Setting modulepath is deprecated in puppet.conf. See http://links.puppetlabs.com/env-settings-deprecations\r\n   (at /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/settings.rb:1095:in `block in issue_deprecations')\r\nNotice: Compiled catalog for local-hostname in environment production in 0.13 seconds\r\nError: File written to disk did not match checksum; discarding changes ({md5}3e4e89714360452d113f009f37f742ed vs {md5}d41d8cd98f00b204e9800998ecf8427e)\r\nError: /Stage[main]/Main/File[/mnt/this-is-a-file]/ensure: change from absent to file failed: File written to disk did not match checksum; discarding changes ({md5}3e4e89714360452d113f009f37f742ed vs {md5}d41d8cd98f00b204e9800998ecf8427e)\r\nNotice: Finished catalog run in 0.51 seconds\r\n\r\n{code}\r\n\r\n*Discussion*\r\nSystem call traces using strace show the following sequence of events:\r\n\r\n1) Puppet opens a temp file and writes data:\r\n\r\n{code}27047 open(\"/mnt/this-is-a-file20151112-27047-112t46h\", O_RDWR|O_CREAT|O_EXCL, 0600) = 5\r\n27047 write(5, \"This is a file!\\n\", 16) = 16\r\n{code}\r\n\r\n2) The temp file descriptor remains open while the checksum\r\nverification code opens a *new* file descriptor on the same filename:\r\n\r\n{code}27047 open(\"/mnt/this-is-a-file20151112-27047-112t46h\", O_RDONLY) = 6{code}\r\n\r\n3) The checksum code reads temp file data from the new FD. This\r\nincorrectly returns zero bytes, possibly because of inconsistent\r\ncaching within the clustered file system environment.\r\n\r\n{code}\r\n27047 read(6, \"\", 4096)                 = 0\r\n27047 close(6)                          = 0\r\n{code}\r\n\r\n4) The checksum verification fails and prints an error because the data from the second file descriptor does not match the data written to the first one.\r\n\r\nThe key point is that the file checksum is performed on a second file descriptor *before* the first file descriptor has been completely synced to disk.  That is a data consistency risk regardless of the type of file system, but in practice most file systems serve both file descriptors out of the same cache so no error is found.  Our particular GlusterFS environment exhibits the risk to a greater extent.\r\n\r\n*Potential Patch*\r\n\r\n\r\nAs a test, we added an fsync call immediately before the call to fail_if_checksum_is_wrong in type/file.rb:\r\n{code}\r\n# cat file.rb.patch\r\n--- /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/type/file.rb.dist\t2015-11-11 12:05:46.103283761 -0600\r\n+++ /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/type/file.rb\t2015-11-11 11:46:13.464903043 -0600\r\n@@ -759,6 +759,18 @@\r\n         file.binmode\r\n         content_checksum = write_content(file)\r\n         file.flush\r\n+        begin\r\n+          file.fsync\r\n+        rescue NotImplementedError\r\n+          # fsync may not be implemented by Ruby on all platforms, but\r\n+          # there is absolutely no recovery path if we detect that.  So, we just\r\n+          # ignore the return code.\r\n+          #\r\n+          # However, don't be fooled: that is accepting that we are running in\r\n+          # an unsafe fashion.  If you are porting to a new platform don't stub\r\n+          # that out.\r\n+        end\r\n+\r\n         fail_if_checksum_is_wrong(file.path, content_checksum) if validate_checksum?\r\n         if self[:validate_cmd]\r\n           output = Puppet::Util::Execution.execute(self[:validate_cmd].gsub(self[:validate_replacement], file.path), :failonfail => true, :combine => true)\r\n{code}\r\n\r\nWith this patch file installation operates as expected, even on the GlusterFS file system:\r\n{code}\r\n# strace -f -o works.trace puppet apply file-test.pp \r\nWarning: Setting modulepath is deprecated in puppet.conf. See http://links.puppetlabs.com/env-settings-deprecations\r\n   (at /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/settings.rb:1095:in `block in issue_deprecations')\r\nNotice: Compiled catalog for local-hostname in environment production in 0.16 seconds\r\nNotice: /Stage[main]/Main/File[/mnt/this-is-a-file]/ensure: defined content as '{md5}3e4e89714360452d113f009f37f742ed'\r\nNotice: Finished catalog run in 0.91 seconds\r\n{code}\r\n\r\n","closed_at":"2016-05-17T15:23:39.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6059","labels":"","state":"Closed","updated_at":"2016-05-17T15:23:39.000-0700","timestamp":1652285055.773963,"priority":"Normal","status_category":"Done","pull_request":4790},{"issue_id":"125376","title":"Puppet::Util::Plist should emit formatted plists","url":"https://tickets.puppetlabs.com/browse/PUP-6132","created_at":"2016-04-06T14:25:41.000-0700","number":"PUP-6132","body":"{{Puppet::Util::Plist}}'s {{dump_plist}} and {{write_plist_file}} methods both emit poorly-formatted XML plists by default:\r\n\r\n{code}\r\n$ ruby -e \"require 'puppet';require 'puppet/util/plist'; puts Puppet::Util::Plist.dump_plist(['array','of','things'])\"\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\r\n<plist version=\"1.0\"><array><string>array</string><string>of</string><string>things</string></array></plist>\r\n{code}\r\n\r\nWhile this is valid XML, it's ugly. Formatted, the output should be:\r\n{code}\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\r\n<plist version=\"1.0\">\r\n  <array>\r\n    <string>array</string>\r\n    <string>of</string>\r\n    <string>things</string>\r\n  </array>\r\n</plist>\r\n{code}\r\n\r\nThankfully, the {{cfpropertylist}} module this depends on has a {{:formatted}} option for both {{.to_str}} and {{.save}}. Setting this to {{true}} results in properly-formatted XML.","closed_at":"2016-05-17T15:23:39.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6132","labels":"","state":"Closed","updated_at":"2016-05-17T15:23:39.000-0700","timestamp":1652285055.87599,"priority":"Normal","status_category":"Done","pull_request":4843},{"issue_id":"118605","title":"regression - function regsubs should allow a hash as replacement parameter","url":"https://tickets.puppetlabs.com/browse/PUP-5979","created_at":"2016-02-25T13:33:30.000-0800","number":"PUP-5979","body":"With puppet 3.x and a ruby version newer then 1.8 it was possible to give a hash as the replacement parameter to the function _regsubst_. As puppet 4.x ships with ruby 2.1 it would work now generally, but the parameter validation only accepts a String as replacement parameter.\r\n\r\nFor example the following worked with puppet 3.x and will throw an error with puppet 4.x:\r\n\r\n{code:java}\r\npuppet apply -e 'notice(regsubst(\"tuto\", \"[uo]\", { \"u\" => \"o\", \"o\" => \"u\" }, \"G\"))'\r\n{code}\r\n","closed_at":"2016-05-17T15:23:40.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5979","labels":"","state":"Closed","updated_at":"2016-05-17T15:23:40.000-0700","timestamp":1652285055.97797,"priority":"Normal","status_category":"Done","pull_request":4719},{"issue_id":"126628","title":"Behavior of undef in relationships has changed in master since 4.4.x","url":"https://tickets.puppetlabs.com/browse/PUP-6176","created_at":"2016-04-14T10:17:06.000-0700","number":"PUP-6176","body":"Before (in puppet 4.4.1 and earlier), something like\r\n\r\n{code}puppet apply -e \"user {'matthaus': ensure => present, notify => undef}\"{code}\r\nWould work, but now it causes a compile error:\r\n\r\n{code}puppet apply -e \"user {'matthaus': ensure => present, notify => undef}\"\r\nError: No title provided and \"\" is not a valid resource reference on node wyclef-2.local{code}\r\n\r\nHere is an example of this pattern in the apt module: https://github.com/puppetlabs/puppetlabs-apt/blob/master/manifests/setting.pp#L49-L53.\r\n\r\nWe're seeing test failures in a notify resource that is set to undef, but I presume this would apply to any resource relationship.\r\n\r\nOh, and here's a stacktrace from the master log if that's helpful:\r\n\r\n{code}2016-04-14 09:46:46,667 ERROR [qtp1832930698-137] [puppet-server] Puppet No title provided and \"\" is not a valid resource reference on node bigea6oflt8yfr6.delivery.puppetlabs.net\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource.rb:544:in `extract_type_and_title'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource.rb:529:in `type_and_title'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:353:in `resource'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler/catalog_validator/relationship_validator.rb:33:in `validate_relationship'\r\norg/jruby/RubyArray.java:1613:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler/catalog_validator/relationship_validator.rb:32:in `validate_relationship'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler/catalog_validator/relationship_validator.rb:10:in `validate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:52:in `eachparam'\r\norg/jruby/RubyHash.java:1341:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:50:in `eachparam'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler/catalog_validator/relationship_validator.rb:8:in `validate'\r\norg/jruby/RubyArray.java:1613:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler/catalog_validator/relationship_validator.rb:6:in `validate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:217:in `validate_catalog'\r\norg/jruby/RubyArray.java:1613:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:217:in `validate_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:205:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:204:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:240:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:167:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:35:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:265:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:263:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:223:in `benchmark'\r\n/opt/puppetlabs/server/apps/puppetserver/puppet-server-release.jar!/META-INF/jruby.home/lib/ruby/1.9/benchmark.rb:295:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:222:in `benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:261:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:53:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:194:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:134:in `do_find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:48:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:240:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:47:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:82:in `process'\r\norg/jruby/RubyArray.java:1613:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:81:in `process'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:87:in `process'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:87:in `process'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/handler.rb:60:in `process'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/handler.rb:58:in `process'\r\nfile:/opt/puppetlabs/server/apps/puppetserver/puppet-server-release.jar!/puppet-server-lib/puppet/server/master.rb:42:in `handleRequest'{code}","closed_at":"2016-05-17T15:23:40.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6176","labels":"","state":"Closed","updated_at":"2016-05-17T15:23:40.000-0700","timestamp":1652285056.082733,"priority":"Blocker","status_category":"Done","pull_request":4886},{"issue_id":"109790","title":"puppet device convergence impossibility, and improved error output","url":"https://tickets.puppetlabs.com/browse/PUP-5616","created_at":"2015-12-16T07:02:22.000-0800","number":"PUP-5616","body":"In testing I found that error display was (and has always been) suboptimal, so I have a PR which improves this. First, some errors were never caught and shown to the user\r\n\r\n{code}\r\nNotice: /Stage[main]/Device_hiera::Interfaces/Interface[FastEthernet0/14]/mode: mode changed 'access' to 'trunk'\r\nDebug: Updating interface FastEthernet0/14\r\nDebug: ssh: send conf t\r\nDebug: ssh: expected conf t\r\nEnter configuration commands, one per line.  End with CNTL/Z.\r\nswitch01(config)#\r\nDebug: ssh: send interface FastEthernet0/14\r\nDebug: ssh: expected interface FastEthernet0/14\r\nswitch01(config-if)#\r\nDebug: ssh: send switchport mode trunk\r\nDebug: ssh: expected switchport mode trunk\r\nCommand rejected: An interface whose trunk encapsulation is \"Auto\" can not be configured to \"trunk\" mode.\r\n{code}\r\n\r\nWhen an error was output, it repeated the command sent twice:\r\n\r\n{code}\r\nNotice: /Stage[main]/Device_hiera::Interfaces/Interface[FastEthernet0/14]/mode: mode changed 'trunk' to 'access'\r\nError: Error while executing switchport trunk encapsulation negotiate, device returned switchport trunk encapsulation negotiate\r\nCommand rejected: A port which is configured to \"trunk\" mode can not be configured to negotiate the encapsulation.\r\nswitch01(config-if)#\r\n{code}\r\n\r\nI also found that due to the state parser dropping some input values, one could declare a resource which would never convergence, causing it to be output every time.\r\n\r\n{code}\r\n$ puppet device --verbose\r\nInfo: starting applying configuration to switch01.example.com at ssh://switch01.example.com/\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Caching catalog for switch01.example.com\r\nInfo: Applying configuration version '1450262463'\r\nNotice: /Stage[main]/Device_hiera::Interfaces/Interface[FastEthernet0/12]/native_vlan: defined 'native_vlan' as '200'\r\nInfo: Class[Device_hiera::Interfaces]: Unscheduling all events on Class[Device_hiera::Interfaces]\r\nNotice: Applied catalog in 74.54 seconds\r\n\r\n$ puppet device --verbose\r\nInfo: starting applying configuration to switch01.example.com at ssh://switch01.example.com/\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Caching catalog for switch01.example.com\r\nInfo: Applying configuration version '1450262647'\r\nNotice: /Stage[main]/Device_hiera::Interfaces/Interface[FastEthernet0/12]/native_vlan: defined 'native_vlan' as '200'\r\n{code}\r\n\r\nThe PR I will link to this issue fixes all of these things.","closed_at":"2016-05-17T15:23:40.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5616","labels":"","state":"Closed","updated_at":"2016-05-17T15:23:40.000-0700","timestamp":1652285056.399195,"priority":"Normal","status_category":"Done","pull_request":4507},{"issue_id":"126433","title":"Runtime3Loader initiates load that updates loader, then tries to update again","url":"https://tickets.puppetlabs.com/browse/PUP-6168","created_at":"2016-04-13T01:37:48.000-0700","number":"PUP-6168","body":"The {{Runtime3TypeLoader#find}} method will delegate to the {{known_resource_types}} of the current environment. This might lead to new code being brought in, parsed, and evaluated. and that evaluation might instantiate the very resource type that was first queried. The instantiation updates the {{Runtime3TypeLoader}}. Consequently, when the {{known_resource_types}} returns the entry, it's already stored in the loader and the loaders attempt to now store it again, results in a 'Attempt to redefine entity' exception.\r\n\r\nThis regression was introduced in PUP-6028 which has not yet been released.","closed_at":"2016-05-17T15:23:41.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6168","labels":"","state":"Closed","updated_at":"2016-05-17T15:23:41.000-0700","timestamp":1652285056.608689,"priority":"Blocker","status_category":"Done","pull_request":4877},{"issue_id":"118341","title":"Deprecate Symbol#<=> monkey patch","url":"https://tickets.puppetlabs.com/browse/PUP-5968","created_at":"2016-02-24T09:14:14.000-0800","number":"PUP-5968","body":"We restored the {{Symbol#<=>}} monkey patch in PUP-5962 because our version behaves differently from ruby 1.9.3 and up:\r\n\r\nPuppet:\r\n{code}\r\nirb(main):005:0> :a <=> 'a'\r\n=> 0\r\n{code}\r\n\r\nRuby:\r\n{code}\r\nirb(main):003:0> :a <=> 'a'\r\n=> nil\r\n{code}\r\n\r\nThis ticket is to deprecate puppet's behavior when comparing against non-Symbols. Ideally this could be done when strict mode is enabled and {{Symbol#<=>(other)}} is called, but {{other}} is not a Symbol.\r\n\r\nThere could be performance implications of adding that check, and it may uncover other parts of puppet that rely on the deprecated behavior, like http://projects.puppetlabs.com/issues/5466. Those will need to be fixed also.","closed_at":"2016-05-17T15:23:41.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5968","labels":"","state":"Closed","updated_at":"2016-05-17T15:23:41.000-0700","timestamp":1652285056.715052,"priority":"Normal","status_category":"Done","pull_request":4796},{"issue_id":"124862","title":"Autoloading of native types declared in modules is broken","url":"https://tickets.puppetlabs.com/browse/PUP-6121","created_at":"2016-04-04T09:57:23.000-0700","number":"PUP-6121","body":"The more stringent check for existing resource types that was introduced in PUP-6028 does not work for Ruby types that are auto loaded from modules.","closed_at":"2016-05-17T15:23:41.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6121","labels":"","state":"Closed","updated_at":"2016-05-17T15:23:41.000-0700","timestamp":1652285056.820639,"priority":"Critical","status_category":"Done","pull_request":4833},{"issue_id":"128049","title":"Non-Type expression within the RHS Type expression of a type alias gives unclear error","url":"https://tickets.puppetlabs.com/browse/PUP-6229","created_at":"2016-04-22T16:32:09.000-0700","number":"PUP-6229","body":"It's easiest to give some examples to show what I'm referring to.\r\n\r\n{code:puppet}\r\ntype Foo = Enum[$facts['os']['family']]\r\n{code}\r\n\r\n{code:puppet}\r\ntype Bar = Enum[with() || { \"${facts['os']['family']}: ${facts['os']['name']}\" }]\r\n{code}\r\n\r\n{code:puppet}\r\ntype Baz = Pattern[Integer[1,9].map |$x| {\r\n  $a = $x - 1\r\n  $c = $x + 1\r\n  \"\\\\Aa{${a}}b{${x}}c{${c}}\\\\z\"\r\n}]\r\n{code}\r\n\r\nAll of these produce the same error (although, somewhat confusingly, only if they are used somewhere).\r\n\r\n{code}\r\nError: Evaluation Error: Error while evaluating a Type-Name, The expression <> is not a valid type specification.\r\n{code}\r\n\r\nCompare that to the following:\r\n\r\n{code:puppet}\r\ntype Baz = with() || { Pattern[$facts['os']['family']] }\r\n{code}\r\n\r\nwhich produces the much clearer error message\r\n\r\n{code}\r\nError: Could not parse for environment production: Illegal expression. A Function Call is unacceptable as a type reference in a Type Alias\r\n{code}\r\n\r\nNote that all of these RHS expressions are valid everywhere else that types can be used, which can add to the confusion.","closed_at":"2016-05-17T15:23:42.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6229","labels":"","state":"Closed","updated_at":"2016-05-17T15:23:42.000-0700","timestamp":1652285057.029208,"priority":"Normal","status_category":"Done","pull_request":4951},{"issue_id":"66395","title":"Puppet agent will accept yaml content","url":"https://tickets.puppetlabs.com/browse/PUP-3941","created_at":"2015-02-02T11:42:32.000-0800","number":"PUP-3941","body":"Many of puppet's models have a yaml terminus:\r\n\r\n{noformat}\r\n$ find lib/puppet/indirector -type f -name 'yaml.rb'\r\nlib/puppet/indirector/catalog/yaml.rb\r\nlib/puppet/indirector/facts/yaml.rb\r\nlib/puppet/indirector/node/yaml.rb\r\nlib/puppet/indirector/report/yaml.rb\r\nlib/puppet/indirector/yaml.rb\r\n{noformat}\r\n\r\nbecause we need to be able to serialize the model to disk, e.g. {{last_run_report.yaml}} However, the puppet agent does not filter out yaml when making network requests as can be seen by the \"Accept\" mime header. This means the agent will accept and process yaml if it the server happens to send it in that format. Given the security concerns around yaml, the agent should never accept yaml over the network.\r\n\r\n{noformat}\r\n# puppet agent -td --http_debug 2>&1 >/dev/null | grep 'Accept: '\r\n<- \"GET /puppet/v3/node/agent42?environment=production&transaction_uuid=5ed51dca-d4cf-45e0-ab48-28975ce1a41e&fail_on_404=true HTTP/1.1\\r\\nAccept: pson, msgpack, yaml, raw\\r\\nAccept-Encoding: gzip;q=1.0,deflate;q=0.6,identity;q=0.3\\r\\nUser-Agent: Ruby\\r\\nHost: arcturus.local:8140\\r\\n\\r\\n\"\r\n<- \"GET /puppet/v3/file_metadatas/pluginfacts?environment=production&links=manage&recurse=true&ignore=.svn&ignore=CVS&ignore=.git&checksum_type=md5 HTTP/1.1\\r\\nAccept: pson, msgpack, yaml, raw\\r\\nAccept-Encoding: gzip;q=1.0,deflate;q=0.6,identity;q=0.3\\r\\nUser-Agent: Ruby\\r\\nHost: arcturus.local:8140\\r\\n\\r\\n\"\r\n<- \"GET /puppet/v3/file_metadata/pluginfacts?environment=production&links=manage&checksum_type=md5&source_permissions=use HTTP/1.1\\r\\nAccept: pson, msgpack, yaml, raw\\r\\nAccept-Encoding: gzip;q=1.0,deflate;q=0.6,identity;q=0.3\\r\\nUser-Agent: Ruby\\r\\nHost: arcturus.local:8140\\r\\n\\r\\n\"\r\n<- \"GET /puppet/v3/file_metadatas/plugins?environment=production&links=manage&recurse=true&ignore=.svn&ignore=CVS&ignore=.git&checksum_type=md5 HTTP/1.1\\r\\nAccept: pson, msgpack, yaml, raw\\r\\nAccept-Encoding: gzip;q=1.0,deflate;q=0.6,identity;q=0.3\\r\\nUser-Agent: Ruby\\r\\nHost: arcturus.local:8140\\r\\n\\r\\n\"\r\n<- \"GET /puppet/v3/file_metadata/plugins?environment=production&links=manage&checksum_type=md5&source_permissions=ignore HTTP/1.1\\r\\nAccept: pson, msgpack, yaml, raw\\r\\nAccept-Encoding: gzip;q=1.0,deflate;q=0.6,identity;q=0.3\\r\\nUser-Agent: Ruby\\r\\nHost: arcturus.local:8140\\r\\n\\r\\n\"\r\n<- \"POST /puppet/v3/catalog/agent42 HTTP/1.1\\r\\nAccept: pson, msgpack, yaml, dot, raw\\r\\nAccept-Encoding: gzip;q=1.0,deflate;q=0.6,identity;q=0.3\\r\\nUser-Agent: Ruby\\r\\nHost: arcturus.local:8140\\r\\nContent-Length: 7921\\r\\nContent-Type: application/x-www-form-urlencoded\\r\\n\\r\\n\"\r\n<- \"PUT /puppet/v3/report/agent42?environment=production& HTTP/1.1\\r\\nAccept: pson, yaml\\r\\nAccept-Encoding: gzip;q=1.0,deflate;q=0.6,identity;q=0.3\\r\\nContent-Type: text/pson\\r\\nUser-Agent: Ruby\\r\\nHost: arcturus.local:8140\\r\\nContent-Length: 31751\\r\\n\\r\\n\"\r\n{noformat}\r\n\r\nWhile I don't believe this is a security issue, I'm filing it as internal for now.","closed_at":"2016-05-17T15:23:43.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3941","labels":"","state":"Closed","updated_at":"2016-05-17T15:23:43.000-0700","timestamp":1652285057.781498,"priority":"Normal","status_category":"Done","pull_request":4903},{"issue_id":"123435","title":"Service provider shouldn't die if an smf service is in state \"degraded\"","url":"https://tickets.puppetlabs.com/browse/PUP-6095","created_at":"2016-03-24T11:11:33.000-0700","number":"PUP-6095","body":"Service provider fails if a smf service is in state \"degraded\"\r\n\r\npuppet resource service\r\n<... resources ...>\r\n\r\nsvcadm mark degraded svc:/network/dns/client:default\r\nError: Could not run: Unmanageable state 'degraded' on service \r\nsvc:/network/dns/client:default\r\n\r\n\r\n\r\n\r\n","closed_at":"2016-05-17T15:23:43.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6095","labels":"","state":"Closed","updated_at":"2016-05-17T15:23:43.000-0700","timestamp":1652285058.198593,"priority":"Normal","status_category":"Done","pull_request":4819},{"issue_id":"129309","title":"Empty Array type broken, neither Array[0,0] nor Array[T,0,0] works","url":"https://tickets.puppetlabs.com/browse/PUP-6251","created_at":"2016-05-02T04:44:15.000-0700","number":"PUP-6251","body":"Since 4.4.2 it is impossible to do the following:\r\n\r\n{code:puppet}\r\nif $nodes =~ Array[Data,0,0]\r\n{code}\r\n\r\nI get the following error:\r\n\r\n\r\n{quote}Error while evaluating a '[]' expression, An empty collection may not specify an element type{quote}\r\n\r\n\r\n\r\n\r\nh2. Non technical problems\r\n\r\n\r\n# I would not expect such a change in a _minor (.z) release_\r\n# This change does not make sense because it is a valid usecase (e.g when the upper limit is a variable) to have a type.\r\n\r\n\r\nh2. Technical problems\r\n\r\nh3. To me, the following statements are true\r\n\r\n{code:puppet}\r\n[] =~ Array[String, 0, 0]\r\n[] =~ Array[Integer, 0, 0]\r\n{code}\r\n\r\n\r\nh3. Alternative writing does not work\r\n\r\n{code}\r\ncat test.pp\r\n$test = assert_type(Array[0,0],[])\r\n\r\n\r\npuppet apply test.pp\r\nError: Evaluation Error: Array-Type[] arguments must be types. Got Fixnum at /home/roidelapluie/test.pp:1:27 on node nitrogen\r\n{code}\r\n\r\nSo there is NO workaround to get the feature working again.\r\n\r\n\r\nh3. Impossible to have a variable as length\r\n\r\n{code}\r\n$test = assert_type(Array[Integer, $min,$max],[])\r\n{code}\r\n\r\nwill noly work with max > 0. Hence an extra {{if}} in the code etc etc","closed_at":"2016-05-17T15:23:44.000-0700","comments":20,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6251","labels":"","state":"Closed","updated_at":"2016-05-17T15:23:44.000-0700","timestamp":1652285058.305682,"priority":"Normal","status_category":"Done","pull_request":4933},{"issue_id":"122602","title":"Solution to optimize resolution of TypeReference for known Resource types is broken","url":"https://tickets.puppetlabs.com/browse/PUP-6075","created_at":"2016-03-20T08:33:44.000-0700","number":"PUP-6075","body":"The solution for optimizing resolution of type references for known resource types does not work as intended. This is because the static loader registers these types using a {{TypedName}} where the name is capitalized. The {{TypeParser}} will always attempt to load using a downcased name so it never finds anything even if it uses a loader.\r\n","closed_at":"2016-05-17T15:23:44.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6075","labels":"","state":"Closed","updated_at":"2016-05-17T15:23:44.000-0700","timestamp":1652285058.409835,"priority":"Normal","status_category":"Done","pull_request":4802},{"issue_id":"125341","title":"NotUndef(1) results in error that 'new_function' is not available","url":"https://tickets.puppetlabs.com/browse/PUP-6131","created_at":"2016-04-06T12:27:55.000-0700","number":"PUP-6131","body":"NotUndef(1) results in error that 'new_function' is not available\r\n\r\nACCEPTANCE CRITERIA\r\n----\r\n* It should be possible to \"convert\" to NotUndef using one of:\r\n{code:puppet}\r\nNotUndef(1)\r\nNotUndef[Numeric](1)\r\nNotUndef[Integer](1)\r\n{code}","closed_at":"2016-05-17T15:23:45.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6131","labels":"","state":"Closed","updated_at":"2016-05-17T15:23:45.000-0700","timestamp":1652285058.844994,"priority":"Normal","status_category":"Done","pull_request":4844},{"issue_id":"126047","title":"Output of iterator type emits 'value' text after type","url":"https://tickets.puppetlabs.com/browse/PUP-6151","created_at":"2016-04-11T12:18:31.000-0700","number":"PUP-6151","body":"UPDATED\r\n----\r\nWith the resolution of PUP-6090, output of an iterator type no longer results in an error. However, it emits the type of result and the string 'value' and the 'value' part is confusing as an indicator that it is an instance of Iterator that is noticed.\r\n\r\nGiven the following manifest\r\n{code}\r\nnotice([1,2,3].reverse_each)\r\n{code}\r\n\r\nThe result is:\r\n{code}\r\nNotice: Scope(Class[main]): Iterator[Variant[Integer]] value\r\n{code}\r\n\r\n","closed_at":"2016-05-17T15:23:46.000-0700","comments":28,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6151","labels":"","state":"Closed","updated_at":"2016-05-17T15:23:46.000-0700","timestamp":1652285059.263549,"priority":"Normal","status_category":"Done","pull_request":4952},{"issue_id":"128363","title":"build_should_not_allow_symlinks acceptance test failing on posix platforms","url":"https://tickets.puppetlabs.com/browse/PUP-6235","created_at":"2016-04-26T11:14:18.000-0700","number":"PUP-6235","body":"http://jenkins.puppetlabs.com:8080/job/platform_puppet-agent_intn-van-sys_suite-daily-puppet-master/100/#showFailuresLink\r\n\r\ntests/modules/build.build_should_not_allow_symlinks.rb\r\nfailing on posix platforms.","closed_at":"2016-05-21T11:06:49.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6235","labels":"regression","state":"Closed","updated_at":"2016-05-21T11:06:49.000-0700","timestamp":1652285060.405099,"priority":"Blocker","status_category":"Done","pull_request":4919},{"issue_id":"92022","title":"Fix pip provider for EL6","url":"https://tickets.puppetlabs.com/browse/PUP-4997","created_at":"2015-08-04T17:30:53.000-0700","number":"PUP-4997","body":"the recent python-pip package \"python-pip-7.1.0-1.el6.noarch\" doesn't have /usr/bin/pip-python anymore \"symbolic link to /usr/bin/pip\" and pip provider for EL6 uses pip-python binary ","closed_at":"2016-05-23T01:33:54.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4997","labels":"puppethack","state":"Closed","updated_at":"2016-05-23T01:33:54.000-0700","timestamp":1652285060.614754,"priority":"Normal","status_category":"Done","pull_request":4127},{"issue_id":"113002","title":"Non-English values for USERNAME and USERPROFILE causes multiple home directories to be created","url":"https://tickets.puppetlabs.com/browse/PUP-5726","created_at":"2016-01-19T16:39:12.000-0800","number":"PUP-5726","body":"As part of the investigation into PUP-4339 it was discovered Puppet creates multiple home directories for a user if their home path contains non-english characters (e.g. Umlaut).","closed_at":"2016-05-24T14:49:09.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5726","labels":"i18n;utf-8;windows","state":"Closed","updated_at":"2016-05-24T14:49:09.000-0700","timestamp":1652285060.831401,"priority":"Normal","status_category":"Done","pull_request":4592},{"issue_id":"116088","title":"Ensure Puppet uses FileSystem.read where applicable to read JSON, settings and other files as UTF-8","url":"https://tickets.puppetlabs.com/browse/PUP-5879","created_at":"2016-02-10T18:46:56.000-0800","number":"PUP-5879","body":"There are a number of places in Puppet where the internal file abstraction {{Puppet::FileSystem}} is not used, but should be, to enforce files are read properly as UTF-8.  This primarily affects Windows, where the local codepage frequently causes unnecessary conversions if UTF-8 is not explicitly specified.\r\n\r\nAn initial spike is in the branch - https://github.com/Iristyle/puppet/commits/ticket/stable/PUP-5728-convert-remaining-File-read-calls-to-Puppet-FileSystem that built on the work in PUP-5728\r\n\r\nTwo other items of note:\r\n\r\n* PE-13721 exposed a similar issue in the {{puppet_enterprise}} module in a Japanese Windows - this module should be spot checked and additional tickets filed if similar problems are discovered\r\n* Mcollective should also be analyzed, given it's Ruby code... for areas where it touches the FileSystem, etc (this should result in additional tickets if necessary)","closed_at":"2016-05-24T15:00:26.000-0700","comments":19,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5879","labels":"i18n;utf-8;windows","state":"Closed","updated_at":"2016-05-24T15:00:26.000-0700","timestamp":1652285061.259434,"priority":"Normal","status_category":"Done","pull_request":4665},{"issue_id":"98938","title":"master node catalog must be compiled before environment graph is compiled (stack level too deep)","url":"https://tickets.puppetlabs.com/browse/PUP-5299","created_at":"2015-09-21T13:44:15.000-0700","number":"PUP-5299","body":"Certain order of operations results in a broken puppet-server that is unable to compile node *and* environment graphs until services are restarted. \r\n\r\nTo reproduce, install a build of PE 2015.3. I followed [these instructions|https://gist.github.com/ryanycoleman/ce1e492699f8abcaae31] for my build. \r\n\r\nThen:\r\n- r10k puppetfile install [<this Puppetfile>|https://gist.github.com/ryanycoleman/ce1e492699f8abcaae31#file-05_puppetfile]\r\n- clear environment cache (if applicable)\r\n- /opt/puppetlabs/bin/puppet-app --url https://`hostname -f`:8143 show --verbose\r\n\r\nYou should receive the following response.\r\n\r\n{noformat}\r\njava.lang.Exception: Received HTTP 500: Internal Server Error: org.jruby.exceptions.RaiseException: (SystemStackError) stack level too deep\r\n{noformat}\r\n\r\nThis can be avoided by running puppet agent -t on the server node *before* running puppet-app.\r\n\r\n{noformat}\r\n[root@appmgmt-services ~]# systemctl restart pe-puppetdb.service; systemctl restart pe-puppetserver.service; systemctl restart pe-xnode-service.service\r\n[root@appmgmt-services ~]# /opt/puppetlabs/bin/puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for appmgmt-services.vm\r\nInfo: Applying configuration version '1442867568'\r\nNotice: Applied catalog in 9.32 seconds\r\n[root@appmgmt-services ~]# /opt/puppetlabs/bin/puppet-app --url https://appmgmt-services.vm:8143 show --verbose\r\njava.lang.Exception: Received HTTP 500: Server Error: Evaluation Error: Error while evaluating a Resource Statement, Only applications are allowed at topscope, not Filebucket[main] at /etc/puppetlabs/code/environments/production/manifests/site.pp:20:1 in environment production\r\n{noformat}\r\n\r\nNote the last line is a known bug, choking on the built-in site manifest but having successfully requested an environment graph. ","closed_at":"2016-05-25T16:41:42.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5299","labels":"","state":"Closed","updated_at":"2016-05-25T16:41:42.000-0700","timestamp":1652285062.58092,"priority":"Blocker","status_category":"Done","pull_request":4311},{"issue_id":"99698","title":"puppet device can't handle mode=auto or encapsulation=negotiate","url":"https://tickets.puppetlabs.com/browse/PUP-5289","created_at":"2015-09-29T00:12:28.000-0700","number":"PUP-5289","body":"Widely reported that you must manually change all switchports to access mode before you can configure them with Puppet:\r\n\r\n* http://serverfault.com/questions/512398/puppet-device-not-working-with-catalyst-2950\r\n* http://www.scottyob.com/2012/12/08/my-experiences-of-managing-a-cisco-switch-with-puppet/\r\n* https://groups.google.com/forum/#!topic/puppet-users/dkADnakeQlo\r\n\r\n{code}\r\n$ puppet device switch01.example.com --verbose\r\nInfo: starting applying configuration to switch01.example.com at telnet://switch01.example.com/\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Caching catalog for switch01.example.com\r\nInfo: Applying configuration version '1443506109'\r\nError: Could not perform network device prefetch: Unknown switchport mode: dynamic auto for FastEthernet0/2\r\nNotice: /Stage[main]/Device::Interfaces/Interface[FastEthernet0/2]/description: defined 'description' as 'Adjusted by Puppet'\r\nError: /Stage[main]/Device::Interfaces/Interface[FastEthernet0/2]: Could not evaluate: undefined method `command' for #<Puppet::Type::Interface:0x00000004dcb7f8>\r\nInfo: Creating state file /home/jrhett/.puppetlabs/opt/puppet/cache/devices/switch01.example.com/state/state.yaml\r\nNotice: Applied catalog in 0.56 seconds\r\n{code}\r\n\r\n...and...\r\n\r\n{code}\r\n$ puppet device switch01.example.com --verbose\r\nInfo: starting applying configuration to switch01.example.com at telnet://switch01.example.com/\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Caching catalog for switch01.example.com\r\nInfo: Applying configuration version '1443506824'\r\nError: Could not perform network device prefetch: Unknown switchport encapsulation: negotiate for FastEthernet0/2\r\nNotice: /Stage[main]/Device::Interfaces/Interface[FastEthernet0/2]/description: defined 'description' as 'Adjusted by Puppet'\r\nNotice: /Stage[main]/Device::Interfaces/Interface[FastEthernet0/2]/native_vlan: defined 'native_vlan' as '1'\r\nNotice: /Stage[main]/Device::Interfaces/Interface[FastEthernet0/2]/mode: defined 'mode' as 'access'\r\nError: /Stage[main]/Device::Interfaces/Interface[FastEthernet0/2]: Could not evaluate: undefined method `command' for #<Puppet::Type::Interface:0x00000003efe630>\r\nNotice: Applied catalog in 0.60 seconds\r\n{code}","closed_at":"2016-05-25T16:51:48.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5289","labels":"","state":"Closed","updated_at":"2016-05-25T16:51:48.000-0700","timestamp":1652285062.896335,"priority":"Normal","status_category":"Done","pull_request":4301},{"issue_id":"101089","title":"Empty arrays does not match type of typed arrays","url":"https://tickets.puppetlabs.com/browse/PUP-5342","created_at":"2015-10-07T15:09:47.000-0700","number":"PUP-5342","body":"Puppet thinks that the type of an empty array doesn't match the type of Array[String]. It thinks that the type is Array[Undef].","closed_at":"2016-05-25T17:04:30.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5342","labels":"","state":"Closed","updated_at":"2016-05-25T17:04:30.000-0700","timestamp":1652285063.10876,"priority":"Major","status_category":"Done","pull_request":4341},{"issue_id":"101252","title":"Statically-enabled systemd service is treated like SysV init scripts - enabled each run.","url":"https://tickets.puppetlabs.com/browse/PUP-5353","created_at":"2015-10-12T02:32:31.000-0700","number":"PUP-5353","body":"h2. Overview\r\n\r\nStatically-enabled systemd service is treated like SysV init scripts - enabled each run. One of the example is 'dbus' / 'messagebus' service which is not using SysV init script.\r\n\r\n{code}\r\n# systemctl is-enabled dbus.service\r\nstatic\r\n{code}\r\n\r\n{code}\r\n# ls /usr/lib/systemd/system/multi-user.target.wants/|grep dbus \r\ndbus.service\r\n{code}\r\n\r\nThis is the manifest that is used in the test:\r\n\r\n{code}\r\npackage { 'dbus': ensure => installed, } \r\n$dbus_service = $::operatingsystemmajrelease ? { \r\n'5' => 'messagebus', \r\n'6' => 'messagebus', \r\n'7' => 'dbus', \r\n} \r\nservice { 'messagebus': \r\nensure => running, \r\nname => $dbus_service, \r\nenable => true, \r\nrequire => Package['dbus'], \r\n}\r\n{code}\r\n\r\nEvery puppet run changes enabled from 'false' to 'true':\r\n\r\n{code}\r\n[root@pe-centos7-master ~]# puppet apply /tmp/test.pp \r\nNotice: Compiled catalog for pe-centos7-master in environment production in 0.93 seconds\r\nNotice: /Stage[main]/Main/Service[messagebus]/enable: enable changed 'false' to 'true'\r\nNotice: Applied catalog in 0.30 seconds\r\n{code}\r\n\r\nh2. Workaround\r\n\r\nSetting {{provider => redhat}} on services that use init scripts instead of systemd units should work around the issue.","closed_at":"2016-05-27T13:32:04.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5353","labels":"","state":"Closed","updated_at":"2016-05-27T13:32:04.000-0700","timestamp":1652285063.335365,"priority":"Normal","status_category":"Done","pull_request":4887},{"issue_id":"119279","title":"Puppet module install fails when modules have long path names","url":"https://tickets.puppetlabs.com/browse/PUP-5994","created_at":"2016-03-01T10:27:19.000-0800","number":"PUP-5994","body":"Running {code}puppet module install puppetlabs-dsc{code} silently fails to install some of the files in the module tarball\r\n\r\n{code}\r\nPS C:\\ProgramData\\PuppetLabs\\code\\environments\\production\\modules\\dsc> ls *.psm1 -rec |measure\r\n\r\n\r\nCount    : 28\r\n{code}\r\nThere should be over 240 PSM1 files","closed_at":"2016-05-31T16:25:10.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5994","labels":"","state":"Closed","updated_at":"2016-05-31T16:25:10.000-0700","timestamp":1652285063.542896,"priority":"Major","status_category":"Done","pull_request":4740},{"issue_id":"22671","title":"Yum provider \"purge\" target runs irrespective of package installation status","url":"https://tickets.puppetlabs.com/browse/PUP-1295","created_at":"2013-12-30T11:00:10.000-0800","number":"PUP-1295","body":"It seems the yum provider will try to purge an absent package:\r\n{noformat}\r\n[root@test ~]# cat test.pp \r\npackage { logwatch: ensure => purged; }\r\n\r\n[root@test ~]# /bin/rpm -q logwatch --nosignature --nodigest --qf '%{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}'\r\npackage logwatch is not installed\r\n\r\n[root@test ~]# puppet -d -v test.pp \r\ndebug: Puppet::Type::Package::ProviderRpm: Executing '/bin/rpm --version'\r\ndebug: Puppet::Type::Package::ProviderUrpmi: Executing '/bin/rpm -ql rpm'\r\ndebug: Puppet::Type::Package::ProviderYum: Executing '/bin/rpm --version'\r\ndebug: Puppet::Type::Package::ProviderAptrpm: Executing '/bin/rpm -ql rpm'\r\ndebug: Puppet::Type::Package::ProviderPorts: file /usr/local/sbin/portupgrade does not exist\r\ndebug: Puppet::Type::Package::ProviderAptitude: file /usr/bin/aptitude does not exist\r\ndebug: Puppet::Type::Package::ProviderSunfreeware: file pkg-get does not exist\r\ndebug: Puppet::Type::Package::ProviderUp2date: file /usr/sbin/up2date-nox does not exist\r\ndebug: Puppet::Type::Package::ProviderApt: file /usr/bin/apt-get does not exist\r\ndebug: Puppet::Type::Package::ProviderPortage: file /usr/bin/emerge does not exist\r\ndebug: Puppet::Type::Package::ProviderRug: file /usr/bin/rug does not exist\r\ndebug: Puppet::Type::Package::ProviderDpkg: file /usr/bin/dpkg does not exist\r\ndebug: Puppet::Type::Package::ProviderSun: file /usr/sbin/pkgrm does not exist\r\ndebug: Puppet::Type::Package::ProviderAptrpm: file apt-get does not exist\r\ndebug: Puppet::Type::Package::ProviderFink: file /sw/bin/fink does not exist\r\ndebug: Puppet::Type::Package::ProviderHpux: file /usr/sbin/swremove does not exist\r\ndebug: Puppet::Type::Package::ProviderUrpmi: file urpmi does not exist\r\ndebug: Puppet::Type::Package::ProviderFreebsd: file /usr/sbin/pkg_info does not exist\r\ndebug: Puppet::Type::Package::ProviderOpenbsd: file pkg_info does not exist\r\ndebug: Creating default schedules\r\ndebug: Failed to load library 'selinux' for feature 'selinux'\r\ndebug: Puppet::Type::User::ProviderLdap: true value when expecting false\r\ndebug: Puppet::Type::User::ProviderUser_role_add: file roleadd does not exist\r\ndebug: Puppet::Type::User::ProviderDirectoryservice: file /usr/bin/dscl does not exist\r\ndebug: Puppet::Type::User::ProviderPw: file pw does not exist\r\ndebug: Failed to load library 'ldap' for feature 'ldap'\r\ndebug: /File[/var/lib/puppet/ssl/private]: Autorequiring File[/var/lib/puppet/ssl]\r\ndebug: /File[/var/lib/puppet/client_yaml]: Autorequiring File[/var/lib/puppet]\r\ndebug: /File[/var/lib/puppet/facts]: Autorequiring File[/var/lib/puppet]\r\ndebug: /File[/var/lib/puppet/ssl/public_keys]: Autorequiring File[/var/lib/puppet/ssl]\r\ndebug: /File[/var/lib/puppet/ssl]: Autorequiring File[/var/lib/puppet]\r\ndebug: /File[/var/lib/puppet/ssl/certs/ca.pem]: Autorequiring File[/var/lib/puppet/ssl/certs]\r\ndebug: /File[/var/lib/puppet/lib]: Autorequiring File[/var/lib/puppet]\r\ndebug: /File[/var/lib/puppet/ssl/certificate_requests]: Autorequiring File[/var/lib/puppet/ssl]\r\ndebug: /File[/var/lib/puppet/ssl/certs]: Autorequiring File[/var/lib/puppet/ssl]\r\ndebug: /File[/var/lib/puppet/clientbucket]: Autorequiring File[/var/lib/puppet]\r\ndebug: /File[/var/lib/puppet/ssl/crl.pem]: Autorequiring File[/var/lib/puppet/ssl]\r\ndebug: /File[/var/lib/puppet/state/graphs]: Autorequiring File[/var/lib/puppet/state]\r\ndebug: /File[/var/lib/puppet/ssl/certs/test.pem]: Autorequiring File[/var/lib/puppet/ssl/certs]\r\ndebug: /File[/var/lib/puppet/state/state.yaml]: Autorequiring File[/var/lib/puppet/state]\r\ndebug: /File[/var/lib/puppet/ssl/public_keys/test.pem]: Autorequiring File[/var/lib/puppet/ssl/public_keys]\r\ndebug: /File[/var/lib/puppet/ssl/private_keys]: Autorequiring File[/var/lib/puppet/ssl]\r\ndebug: /File[/var/lib/puppet/ssl/private_keys/test.pem]: Autorequiring File[/var/lib/puppet/ssl/private_keys]\r\ndebug: /File[/var/lib/puppet/state]: Autorequiring File[/var/lib/puppet]\r\ndebug: Finishing transaction 23973287885200 with 0 changes\r\ndebug: Prefetching yum resources for package\r\ndebug: Puppet::Type::Package::ProviderYum: Executing '/bin/rpm --version'\r\ndebug: Puppet::Type::Package::ProviderYum: Executing '/bin/rpm -qa --nosignature --nodigest --qf '%{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\r\n''\r\ninfo: Applying configuration version '1272893121'\r\ndebug: Puppet::Type::Package::ProviderYum: Executing '/bin/rpm -q logwatch --nosignature --nodigest --qf %{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\r\n'\r\ndebug: //Package[logwatch]: Changing ensure\r\ndebug: //Package[logwatch]: 1 change(s)\r\ndebug: Puppet::Type::Package::ProviderYum: Executing '/usr/bin/yum -y erase logwatch'\r\nnotice: //Package[logwatch]/ensure: created\r\ndebug: Finishing transaction 23456258088960 with 1 changes\r\n{noformat}\r\n","closed_at":"2016-06-01T08:25:12.000-0700","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1295","labels":"Community","state":"Closed","updated_at":"2016-06-01T08:25:12.000-0700","timestamp":1652285063.649865,"priority":"Normal","status_category":"Done","pull_request":3921},{"issue_id":"121203","title":"lookup cli --unpack-arrays broken","url":"https://tickets.puppetlabs.com/browse/PUP-6050","created_at":"2016-03-13T06:11:42.000-0700","number":"PUP-6050","body":"unpack-arrays should take an argument, but the code has:\r\n\r\n{code}\r\n  option('--unpack-arrays') do |arg|\r\n    options[:unpack_arrays] = arg\r\n  end\r\n{code}\r\n\r\nso it doesn't actually take it, should be:\r\n\r\n{code}\r\n  option('--unpack-arrays DELIMITER') do |arg|\r\n    options[:unpack_arrays] = arg\r\n  end\r\n{code}\r\n\r\nAdditionally even with that fixed the options are not correctly merged into the options hash it constructs.\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/9849572b805a1cf3cada6b9b0c94f7699c780888/lib/puppet/application/lookup.rb#L275 and https://github.com/puppetlabs/puppet/blob/9849572b805a1cf3cada6b9b0c94f7699c780888/lib/puppet/application/lookup.rb#L279 should use merge! and not merge.  Additionally the key for knockout prefix is \"knockout_prefix\" not \"prefix\"","closed_at":"2016-06-02T07:41:55.000-0700","comments":24,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6050","labels":"","state":"Closed","updated_at":"2016-06-02T07:41:55.000-0700","timestamp":1652285063.763231,"priority":"Major","status_category":"Done","pull_request":4789},{"issue_id":"133930","title":"Enum entries are not unique.","url":"https://tickets.puppetlabs.com/browse/PUP-6354","created_at":"2016-05-25T13:19:18.000-0700","number":"PUP-6354","body":"The following code:\r\n\r\n{code}\r\nnotice Enum[foo, bar, foo, bar]\r\n{code}\r\n\r\nproduces output:\r\n\r\n{code}\r\nNotice: Scope(Class[main]): Enum['bar', 'bar', 'foo', 'foo']\r\n{code}\r\n\r\nExpected output:\r\n\r\n{code}\r\nNotice: Scope(Class[main]): Enum['bar', 'foo']\r\n{code}\r\n\r\nAs the values should be in lexicographic ordering and unique.","closed_at":"2016-06-02T10:54:53.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6354","labels":"","state":"Closed","updated_at":"2016-06-02T10:54:53.000-0700","timestamp":1652285063.869134,"priority":"Normal","status_category":"Done","pull_request":4994},{"issue_id":"132317","title":"Bad message when passing zero sized hash where non empty hash is required","url":"https://tickets.puppetlabs.com/browse/PUP-6319","created_at":"2016-05-18T01:16:59.000-0700","number":"PUP-6319","body":"Passing an empty hash where a non-empty hash is required currently reports an element type mismatch such as:\r\n{code}\r\nexpected a Hash[String, String] value, got Hash[0, 0]\r\n{code}\r\nThis is wrong. It should report the size mismatch.","closed_at":"2016-06-02T10:54:54.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6319","labels":"typesystem","state":"Closed","updated_at":"2016-06-02T10:54:54.000-0700","timestamp":1652285064.072702,"priority":"Normal","status_category":"Done","pull_request":4969},{"issue_id":"132339","title":"Bad message when passing zero sized array where non empty array is required","url":"https://tickets.puppetlabs.com/browse/PUP-6320","created_at":"2016-05-18T04:33:59.000-0700","number":"PUP-6320","body":"Passing an empty array where a non-empty array is required currently reports an element type mismatch such as:\r\n{code}\r\nexpected an Array[String,1,default] value, got Array[0, 0]\r\n{code}\r\nThis is wrong. It should report the size mismatch.","closed_at":"2016-06-02T10:54:54.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6320","labels":"typesystem","state":"Closed","updated_at":"2016-06-02T10:54:54.000-0700","timestamp":1652285064.173999,"priority":"Normal","status_category":"Done","pull_request":4970},{"issue_id":"132881","title":"Quoted string \"undef\" treated as value undef","url":"https://tickets.puppetlabs.com/browse/PUP-6336","created_at":"2016-05-20T08:19:08.000-0700","number":"PUP-6336","body":"Puppet is treating the quoted string \"undef\" as value undef, which breaks (at least) the logrotate module: https://forge.puppet.com/yo61/logrotate\r\n\r\nSample code: \r\n{code:java}\r\n  $var1 = undef\r\n  $var2 = \"undef\"\r\n  $var3 = 'undef'\r\n  $var4 = \"'undef'\"\r\n  $var5 = '\"undef\"'\r\n  notify { \"VAR1: ${var1} VAR2: ${var2} VAR3: ${var3} VAR4: ${var4} VAR5: ${var5}\": }\r\n{code}\r\n\r\nOutputs:\r\n{code:java}\r\nNotice: VAR1:  VAR2:  VAR3:  VAR4: 'undef' VAR5: \"undef\"\r\n{code}\r\n\r\nDiscussion:\r\nhttps://groups.google.com/forum/#!topic/puppet-users/X-XrjM9oJYE\r\nhttps://github.com/yo61/puppet-logrotate/issues/26\r\n\r\n","closed_at":"2016-06-03T14:09:25.000-0700","comments":19,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6336","labels":"couch-ss","state":"Closed","updated_at":"2016-06-03T14:09:25.000-0700","timestamp":1652285064.386518,"priority":"Blocker","status_category":"Done","pull_request":4981},{"issue_id":"124312","title":"`puppet resource user` on Solaris fails when LDAP users are present","url":"https://tickets.puppetlabs.com/browse/PUP-6113","created_at":"2016-03-30T15:29:02.000-0700","number":"PUP-6113","body":"On EL (and probably elsewhere), self.instances for users filters out directory service users. On Solaris, it does not, which causes the `puppet resource` command to crash.\r\n\r\nSolaris should behave like other platforms and filter out directory service users from the user instance list.","closed_at":"2016-06-13T07:39:29.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6113","labels":"","state":"Closed","updated_at":"2016-06-13T07:39:29.000-0700","timestamp":1652285064.903082,"priority":"Normal","status_category":"Done","pull_request":4848},{"issue_id":"134175","title":"trusted facts not available when running \"puppet master\" webrick server","url":"https://tickets.puppetlabs.com/browse/PUP-6365","created_at":"2016-05-27T02:56:12.000-0700","number":"PUP-6365","body":"I evaluated using trusted facts, and for testing purposes, I just ran puppetmaster webrick server like:\r\n\r\npuppet master --verbose --no-daemonize\r\n\r\nHowever, I found that certificate extensions are not available in $trusted variable in site.pp\r\n\r\nI added a \r\n\r\nnotify { \"$trusted\": } \r\nbut the info about the certificate extension was empty.\r\n\r\nWith attached patch, the output of $trusted is filled, and I can base decisions on it.\r\n\r\n\r\n\r\n","closed_at":"2016-06-14T23:54:10.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6365","labels":"facts;trusted","state":"Closed","updated_at":"2016-06-14T23:54:10.000-0700","timestamp":1652285074.348873,"priority":"Normal","status_category":"Done","pull_request":4998},{"issue_id":"48216","title":"When puppet agent fails to retrieve catalog from master, cached catalog is used without regard for the puppet.conf-declared environment","url":"https://tickets.puppetlabs.com/browse/PUP-3077","created_at":"2014-08-18T09:50:47.000-0700","number":"PUP-3077","body":"Steps to reproduce:\r\n\r\n- do not disable {{pe-puppet}} service\r\n- successfully compile catalog from non-Production environment using {{puppet agent -t --noop --environment manage_meta}}, catalog is cached locally\r\n- puppet master fails to compile catalog in agent's assigned environment (e.g. because a new class is assigned for testing non-Production code)\r\n- on next scheduled run, agent enforces non-Production state contained in cached catalog in violation of {{environment = production}} explicitly declared in puppet.conf\r\n    - This is accompanied by the warning message indicating that the ENC is overriding the agent as authoritative source for environment\r\n\r\nObviously, this could have very bad side effects and, while consistent and predictable, falls squarely under the category of undesirable (and unexpected) behavior, in my opinion.","closed_at":"2016-06-15T09:07:09.000-0700","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3077","labels":"TSE","state":"Closed","updated_at":"2016-06-15T09:07:09.000-0700","timestamp":1652285074.455104,"priority":"Normal","status_category":"Done","pull_request":4606},{"issue_id":"107138","title":"Environment is evicted many times during compile","url":"https://tickets.puppetlabs.com/browse/PUP-5547","created_at":"2015-11-25T07:31:41.000-0800","number":"PUP-5547","body":"The environment might be evicted a large number of times during a compile. The reason for this is that the call to the data binding indirection passes the environment in string form rather than the instance which forces a lookup in {{Environments}} which in turn evicts an existing environment if {{environment_timeout = 0}}. That setting happens to be the default.\r\n\r\n","closed_at":"2016-06-20T13:59:38.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5547","labels":"","state":"Closed","updated_at":"2016-06-20T13:59:38.000-0700","timestamp":1652285074.764063,"priority":"Normal","status_category":"Done","pull_request":4465},{"issue_id":"101084","title":"puppet apply doesn't honor --catalog_cache_terminus","url":"https://tickets.puppetlabs.com/browse/PUP-5340","created_at":"2015-10-07T14:51:03.000-0700","number":"PUP-5340","body":"I expected that 'puppet apply' would honor the catalog_cache_terminus setting. But it doesn't.","closed_at":"2016-06-22T16:25:00.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5340","labels":"","state":"Closed","updated_at":"2016-06-22T16:25:00.000-0700","timestamp":1652285075.480453,"priority":"Normal","status_category":"Done","pull_request":4326},{"issue_id":"101673","title":"Compiler raises a cryptic error when no node mappings are defined on an application declaration","url":"https://tickets.puppetlabs.com/browse/PUP-5382","created_at":"2015-10-14T14:46:59.000-0700","number":"PUP-5382","body":"According to the application spec, providing node mappings on the declaration of an application is optional. Currently, the following error will be raised during node catalog compilation if no value for `nodes` is given. Compilation of the environment is not affected.\r\n\r\n{code}\r\nundefined method `value' for nil:NilClass on node master.vm\r\n{code}\r\n\r\nh3. Reproducing\r\n{code}\r\npuppet apply --app_management <<MANIFEST\r\napplication app {\r\n}\r\n\r\nsite {\r\n  app { anapp:\r\n  }\r\n}\r\nMANIFEST\r\n{code}","closed_at":"2016-06-22T16:49:47.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5382","labels":"","state":"Closed","updated_at":"2016-06-22T16:49:47.000-0700","timestamp":1652285075.685703,"priority":"Normal","status_category":"Done","pull_request":4343},{"issue_id":"115048","title":"ClassInformationService.classes_per_environment call for non-existent file does not return errors","url":"https://tickets.puppetlabs.com/browse/PUP-5807","created_at":"2016-02-03T07:31:42.000-0800","number":"PUP-5807","body":"If I pass a path to a manifest file that does not exist to the list of files to be parsed in a call to {{Puppet::InfoService::ClassInformationService.new.classes_per_environment}}, the return value just returns an empty array, as opposed to a hash with an {{:error}} key/value pair in it.\r\n\r\nFor example, running the following code...\r\n\r\n{code:ruby}\r\nrequire 'puppet'\r\nrequire 'puppet/info_service'\r\n\r\nfiles_to_parse = { \"production\" => [ \"./parse.pp\" ] }\r\n\r\nputs Puppet::InfoService::ClassInformationService.new.classes_per_environment(files_to_parse)\r\n{code}\r\n\r\n... where \"./parse.pp\" does not exist produces the following output:\r\n\r\n{noformat}\r\n{\"production\"=>{\"./parse.pp\"=>[]}}\r\n{noformat}\r\n\r\nIf instead I have a file that exists at \"./parse.pp\" which has bad content in it...\r\n\r\n{noformat}\r\nbogus manifest\r\n{noformat}\r\n\r\n... an {{:error}} is returned in a hash associated with the file name:\r\n\r\n{noformat}\r\n{\"production\"=>{\"./parse.pp\"=>{:error=>\"This Name has no effect. A value was produced and then forgotten (one or more preceding expressions may have the wrong form) at ./parse.pp:1:1\"}}}\r\n{noformat}\r\n\r\nIt seems like both cases should result in an {{:error}} key being returned.","closed_at":"2016-06-22T16:59:00.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5807","labels":"","state":"Closed","updated_at":"2016-06-22T16:59:00.000-0700","timestamp":1652285075.791092,"priority":"Normal","status_category":"Done","pull_request":4630},{"issue_id":"115067","title":"ClassInformationService.classes_per_environment returns classes as array rather than nested in hash","url":"https://tickets.puppetlabs.com/browse/PUP-5809","created_at":"2016-02-03T09:42:35.000-0800","number":"PUP-5809","body":"In the original description of the {{classes_per_environment}} method in PUP-4819, the sample aggregrated result looked like this:\r\n\r\n{noformat}\r\n{\r\n'environment' => {\r\n  'filename' => {\r\n    :error     => 'errormessage',\r\n    :classes => [\r\n      { :name => 'classname',\r\n        :params => [\r\n          { :name => 'paramname',\r\n            :type => 'puppettype',\r\n            :default_source => '....',\r\n            :default_literal => <OBJECT>\r\n          },\r\n         # next param\r\n        ],\r\n      # next class\r\n      ],\r\n  # next file\r\n  },\r\n# next env\r\n}\r\n{noformat}\r\n\r\nWhen I use the {{classes_per_environment}} method, a successful parse includes the classes as an array rather than as the value of a key named {{:classes}} in the hash.\r\n\r\nFor example, I used the following code...\r\n\r\n{code:ruby}\r\nrequire 'puppet'\r\nrequire 'puppet/info_service'\r\n\r\nfiles_to_parse = { \"production\" => [ \"./parse.pp\" ] }\r\n\r\nputs Puppet::InfoService::ClassInformationService.new.classes_per_environment(files_to_parse)\r\n{code}\r\n\r\n... to parse the following \"./parse.pp\" file:\r\n\r\n{code:puppet}\r\nclass myclass (String $string_with_single_quotes = \"$::osfamily\",\r\n               String $string_with_double_quotes = \"string with double quotes\",\r\n               Fubar $foo = \"bar\"\r\n               )\r\n{\r\n}\r\n{code}\r\n\r\nThe output from the Ruby code is...\r\n\r\n{noformat}\r\n{\"production\"=>{\"./parse.pp\"=>[{:name=>\"myclass\", :params=>[{:name=>\"string_with_single_quotes\", :type=>\"String\", :default_source=>\"\\\"$::osfamily\\\"\"}, {:name=>\"string_with_double_quotes\", :type=>\"String\", :default_literal=>\"string with double quotes\", :default_source=>\"\\\"string with double quotes\\\"\"}, {:name=>\"foo\", :type=>\"Fubar\", :default_literal=>\"bar\", :default_source=>\"\\\"bar\\\"\"}]}]}}\r\n{noformat}\r\n\r\n... whereas I was thinking that the \"classes\" array would be wrapped in a hash like this ...\r\n\r\n{noformat}\r\n{\"production\"=>{\"./parse.pp\"=>{:classes=>[{:name=>\"myclass\", :params=>[{:name=>\"string_with_single_quotes\", :type=>\"String\", :default_source=>\"\\\"$::osfamily\\\"\"}, {:name=>\"string_with_double_quotes\", :type=>\"String\", :default_literal=>\"string with double quotes\", :default_source=>\"\\\"string with double quotes\\\"\"}, {:name=>\"foo\", :type=>\"Fubar\", :default_literal=>\"bar\", :default_source=>\"\\\"bar\\\"\"}]}]}}}\r\n{noformat}\r\n\r\nWhen an {{:error}} is returned instead of the \"classes\" array, it is wrapped in a subordinate hash, like this:\r\n\r\n{noformat}\r\n{\"production\"=>{\"./parse.pp\"=>{:error=>\"This Name has no effect. A value was produced and then forgotten (one or more preceding expressions may have the wrong form) at ./parse.pp:1:1\"}}}\r\n{noformat}\r\n\r\nI think for consistency and for future expansion of the data structure - e.g., if we ever want to add more per-file metadata in the response than just \"classes\" - that it would be good to wrap the \"classes\" array in a Hash under the {{:classes}} key, as the description in PUP-5807 originally called for.","closed_at":"2016-06-22T16:59:35.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5809","labels":"","state":"Closed","updated_at":"2016-06-22T16:59:35.000-0700","timestamp":1652285075.896514,"priority":"Normal","status_category":"Done","pull_request":4631},{"issue_id":"93232","title":"undefined method `keys' for nil:NilClass in static_compiler","url":"https://tickets.puppetlabs.com/browse/PUP-5035","created_at":"2015-08-13T00:55:08.000-0700","number":"PUP-5035","body":"*get_child_resources()* can return nil if the source attribute of the file resource points to a file instead of a directory.\r\n\r\nThis results in a raised *NoMethodError* with the static compiler set as the catalog terminus and a file resource declared that has the *recurse* parameter set to true, e.g.:\r\n\r\n{code}\r\nfile { '/etc/puppet.conf':\r\n  recurse => true,\r\n  source   => 'puppet:///modules/puppet/puppet.conf',\r\n}\r\n{code}\r\n\r\n*stacktrace:*\r\n2015-08-12 09:51:29 +0200 Puppet (err): undefined method `keys' for nil:NilClass\r\n/opt/ruby2.0/lib/vendor_ruby/2.0.0/puppet/indirector/catalog/static_compiler.rb:192:in `remove_existing_resources'\r\n/opt/ruby2.0/lib/vendor_ruby/2.0.0/puppet/indirector/catalog/static_compiler.rb:122:in `add_children'\r\n/opt/ruby2.0/lib/vendor_ruby/2.0.0/puppet/indirector/catalog/static_compiler.rb:52:in `block in find'\r\n/opt/ruby2.0/lib/vendor_ruby/2.0.0/puppet/indirector/catalog/static_compiler.rb:43:in `each'\r\n/opt/ruby2.0/lib/vendor_ruby/2.0.0/puppet/indirector/catalog/static_compiler.rb:43:in `find'\r\n/opt/ruby2.0/lib/vendor_ruby/2.0.0/puppet/indirector/indirection.rb:201:in `find' \r\n...\r\n","closed_at":"2016-06-22T17:19:45.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5035","labels":"","state":"Closed","updated_at":"2016-06-22T17:19:45.000-0700","timestamp":1652285076.214967,"priority":"Normal","status_category":"Done","pull_request":4402},{"issue_id":"124814","title":"Pip package provider doesn't honor config for custom PyPI repositories","url":"https://tickets.puppetlabs.com/browse/PUP-6120","created_at":"2016-04-04T04:10:40.000-0700","number":"PUP-6120","body":"The pip package provider currently polls PyPI directly, instead of relying on pip from CLI to look up latest version.\r\n\r\nThis makes it impossible to configure pip to use a custom PyPI repository","closed_at":"2016-06-25T18:55:46.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6120","labels":"","state":"Closed","updated_at":"2016-06-25T18:55:46.000-0700","timestamp":1652285076.524673,"priority":"Normal","status_category":"Done","pull_request":4832},{"issue_id":"119802","title":"should_modify_gid acceptance tests should generate an unused unique id","url":"https://tickets.puppetlabs.com/browse/PUP-6004","created_at":"2016-03-03T13:19:47.000-0800","number":"PUP-6004","body":"puppet acceptance failed because the {{should_modify_gid}} acceptance test tried to create a group with a random gid, but it picked gid 33, which is already in use:\r\n\r\n{noformat}\r\n12:12:43 Begin tests/resource/group/should_modify_gid.rb\r\n12:12:43 \r\n12:12:43 should modify gid of existing group\r\n12:12:43 \r\n12:12:43 * ensure that the group exists with gid 33\r\n12:12:43 \r\n12:12:43 oa9vv5ad5m9rv20.delivery.puppetlabs.net (ubuntu1510-32-1) 12:12:43$ puppet resource group pl785040 ensure=present gid=33\r\n12:12:44   Error: Could not create group pl785040: Execution of '/usr/sbin/groupadd -g 33 pl785040' returned 4: groupadd: GID '33' already exists\r\n12:12:44   Error: /Group[pl785040]/ensure: change from absent to present failed: Could not create group pl785040: Execution of '/usr/sbin/groupadd -g 33 pl785040' returned 4: groupadd: GID '33' already exists\r\n12:12:44   group { 'pl785040':\r\n12:12:44     ensure => 'absent',\r\n12:12:44   }\r\n{noformat}","closed_at":"2016-07-06T11:12:19.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6004","labels":"client-onboarding","state":"Resolved","updated_at":"2016-07-06T11:12:19.000-0700","timestamp":1652285076.94006,"priority":"Normal","status_category":"Done","pull_request":5074},{"issue_id":"102062","title":"incorrect path being defined in puppet-agent's init script is causing gems to be installed into puppet's gem env.","url":"https://tickets.puppetlabs.com/browse/PUP-5427","created_at":"2015-10-19T12:21:46.000-0700","number":"PUP-5427","body":"OS: CentOS 6.x\r\nPuppet 4.2.2: puppet-agent-1.2.4-1.el6.x86_64 AND puppet-agent-1.2.6-1.el6.x86_64\r\n\r\nPuppet is installing gems into the puppet provided ruby and not into the system ruby.\r\n\r\nSteps to reproduce:\r\n\r\nAdd this to your node manifest:\r\n  package {'redis':\r\n    ensure   => 'present',\r\n    provider => 'gem',\r\n  }\r\n\r\nrun \"sudo service puppet restart\" on your node.\r\nrun \"gem list\"  - You will find no redis gem.\r\nrun \"/opt/puppetlabs/puppet/bin/gem list\" - Redis gem will be installed here!\r\n\r\nWith some help from the folks on IRC, I found that the init script shipped by puppetlabs has a path which causes the puppet daemon/service to use the puppet provided gem binary vs the system's gem binary.\r\n\r\n$ cat /etc/init.d/puppet |grep PATH\r\nPATH=/opt/puppetlabs/puppet/bin:/usr/bin:/sbin:/bin:/usr/sbin\r\n\r\nIf I remove \"/opt/puppetlabs/puppet/bin\" from the path line and restart the service, the puppet deamon does the right thing and installs the gem into the system ruby.\r\n\r\n\r\n","closed_at":"2016-07-11T14:21:20.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5427","labels":"","state":"Resolved","updated_at":"2016-07-11T14:21:20.000-0700","timestamp":1652285077.676868,"priority":"Normal","status_category":"Done","pull_request":4376},{"issue_id":"21564","title":"Puppet raises error when trying to set owner to non-existant user","url":"https://tickets.puppetlabs.com/browse/PUP-1131","created_at":"2013-12-17T05:20:40.000-0800","number":"PUP-1131","body":"When I ran 0.25.5, I relied on the puppet client to create the puppet user.  Since I've upgraded to 2.6.1, the puppet user must already exist before the puppet client will run, otherwise the puppet client bails with an error:\r\nerr: Could not run Puppet configuration client: Could not find user puppet\r\n\r\nThis seems to be a fairly major regression.","closed_at":"2016-07-11T22:33:34.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1131","labels":"redmine","state":"Closed","updated_at":"2016-07-11T22:33:34.000-0700","timestamp":1652285077.779983,"priority":"Normal","status_category":"Done","pull_request":8794},{"issue_id":"22944","title":"Rubyize yumhelper.py to remove dependency on python","url":"https://tickets.puppetlabs.com/browse/PUP-1362","created_at":"2014-01-03T14:31:29.000-0800","number":"PUP-1362","body":"There are several bugs (bug 11380 being one that triggered this patch) that highlight the fact that the version of python used as the default on a system running puppet can break yumhelper.py.\r\n\r\nThis refactor removes yumhelper.py and moves the functionality into the Yum provider in puppet.","closed_at":"2016-07-11T22:37:01.000-0700","comments":26,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1362","labels":"customer;redmine","state":"Resolved","updated_at":"2016-07-11T22:37:01.000-0700","timestamp":1652285077.888567,"priority":"Normal","status_category":"Done","pull_request":2670},{"issue_id":"139850","title":"Fix Parallel Spec grouping for RSpec 3.5.0","url":"https://tickets.puppetlabs.com/browse/PUP-6467","created_at":"2016-07-01T10:23:44.000-0700","number":"PUP-6467","body":"It was discovered in PUP-6466 that the Parallel Spec code is not compatible with RSpec 3.5.0.  \r\n\r\nThis ticket will cover fixing Puppet parallel spec tests to work with both RSPec 3.5.0 and prior to (3.4.x and below)","closed_at":"2016-07-12T13:42:19.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6467","labels":"","state":"Resolved","updated_at":"2016-07-12T13:42:19.000-0700","timestamp":1652285077.994005,"priority":"Normal","status_category":"Done","pull_request":5098},{"issue_id":"83513","title":"Square braces in title confuse puppet 4 parser","url":"https://tickets.puppetlabs.com/browse/PUP-4709","created_at":"2015-06-08T07:28:49.000-0700","number":"PUP-4709","body":"If we have two resources where the titles begin with an identical string enclosed in square braces, the puppet 4 parser throws an error that duplicate resources have been declared:\r\n{code}\r\nextern% PUPPET_GEM_VERSION='~> 4.0' be puppet apply -e 'notify { \"[foo] bar\": } ; notify { \"[foo] baz\": }'\r\nError: Evaluation Error: Error while evaluating a Resource Statement, Duplicate declaration: Notify[[foo] baz] is already declared in file :1; cannot redeclare at line 1  at line 1:27 on node extern.local\r\n{code}\r\n\r\nIt works fine without the square braces however:\r\n{code}\r\nextern% PUPPET_GEM_VERSION='~> 4.0' be puppet apply -e 'notify { \"foo bar\": } ; notify { \"foo baz\": }'\r\nNotice: Compiled catalog for extern.local in environment production in 0.48 seconds\r\nNotice: foo bar\r\nNotice: /Stage[main]/Main/Notify[foo bar]/message: defined 'message' as 'foo bar'\r\nNotice: foo baz\r\nNotice: /Stage[main]/Main/Notify[foo baz]/message: defined 'message' as 'foo baz'\r\nNotice: Applied catalog in 0.02 seconds\r\n{code}\r\n\r\nAn example of a unit test failure is in puppetlabs-inifile when run against Puppet 4: https://travis-ci.org/puppetlabs/puppetlabs-inifile/jobs/65406398\r\n\r\nUPDATE & WORKAROUND\r\n---\r\nThe problem can manifest itself in different ways - even if not getting the error \"duplicate resource\", the catalog will record the name wrong and it may not be able to later find it, if something else depends on that resource. The underlying problem is a bug in the parsing of a combined type/title as the first right bracket is believed to be the end of the string - e.g. {{Notify\\[\\[foo]bar]}} ends up as {{\\[\"Notify\", \"[foo\"\\]}} instead of the expected {{\\[\"Notify\", \"\\[foo\\]bar\"\\]}}. (In the reported case, both resource end up with the same title as the part after the first right bracket is lost. Other cases may be that the notify is just not found).\r\n\r\nAs a workaround until the fix is released, for notify instances it is possible to use a different title and instead set the message e.g.\r\n{code:puppet}\r\nnotify {'_foo_bar': message = '[foo]bar' }; notify {'_foo_baz': message => '[foo]baz' }\r\n{code}","closed_at":"2016-07-13T09:35:42.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4709","labels":"","state":"Closed","updated_at":"2016-07-13T09:35:42.000-0700","timestamp":1652285078.201503,"priority":"Major","status_category":"Done","pull_request":4018},{"issue_id":"140098","title":"FFI 1.9.11 has a bug when running on Windows","url":"https://tickets.puppetlabs.com/browse/PUP-6473","created_at":"2016-07-05T11:22:14.000-0700","number":"PUP-6473","body":"FFI 1.9.11 was released on July 5th 2016 however it seems to have a bug when running on Windows and specifying a library via a symbol (as opposed to a string).\r\n\r\nThere is an issue raised on Github for it. https://github.com/ffi/ffi/issues/506","closed_at":"2016-07-13T11:05:31.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6473","labels":"","state":"Resolved","updated_at":"2016-07-13T11:05:31.000-0700","timestamp":1652285078.307052,"priority":"Blocker","status_category":"Done","pull_request":5096},{"issue_id":"131831","title":"Acceptance: AIX_service_provider test failing during setup","url":"https://tickets.puppetlabs.com/browse/PUP-6301","created_at":"2016-05-16T07:30:19.000-0700","number":"PUP-6301","body":"The [acceptance/tests/resource/service/AIX_service_provider.rb|https://github.com/puppetlabs/puppet/blob/master/acceptance/tests/resource/service/AIX_service_provider.rb] test is failing in current CI run.\r\n\r\nThe AIX system is no longer automatically starting the service under test when it is created as seen in the example below.\r\n{code}\r\n[0] [AIX] root@pe-aix-61-acceptance:~ # mkssys -s sloth_daemon -p /tmp/sloth_daemon.sh.8996 -u 0 -S -n 15 -f 9\r\n0513-071 The sloth_daemon Subsystem has been added.\r\n[0] [AIX] root@pe-aix-61-acceptance:~ # /opt/puppetlabs/bin/puppet resource service sloth_daemon\r\nservice { 'sloth_daemon':\r\n  ensure => 'stopped',\r\n  enable => 'false',\r\n}\r\n{code}\r\n\r\nThe test fails during setup while trying to assert that is was able to stop the service in preparation for the test. Since the the service was not started upon creation, the assertion fails.\r\n\r\nThe test should be modified to make the initial stopping of the service idempotent so that it does not fail if the service was already stopped prior to this setup step.","closed_at":"2016-07-13T14:41:30.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6301","labels":"","state":"Resolved","updated_at":"2016-07-13T14:41:30.000-0700","timestamp":1652285078.40784,"priority":"Normal","status_category":"Done","pull_request":5118},{"issue_id":"138245","title":"Intermittent Appveyor PR CI failure due to password complexity","url":"https://tickets.puppetlabs.com/browse/PUP-6427","created_at":"2016-06-22T10:19:58.000-0700","number":"PUP-6427","body":"Sometimes an Appveyor PR CI will fail, with errors such as \r\n\r\n{code}\r\n[00:08:02]           WIN32OLERuntimeError:\r\n[00:08:02]             (in OLE method `SetInfo': )\r\n[00:08:02]                 OLE error code:800708C5 in Active Directory\r\n[00:08:02]                   The password does not meet the password policy requirements. Check the minimum password length, password complexity and password history requirements.\r\n[00:08:02]\r\n{code}\r\n\r\nTypically password complexity is disabled so our tests don't need to worry about it, but for some reason it may become enabled again.  This then causes the tests to fail.\r\n\r\nIt is proposed to modify the failing tests to use complex passwords when creating test user accounts instead of easy or blank passwords.","closed_at":"2016-07-14T10:41:17.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6427","labels":"","state":"Resolved","updated_at":"2016-07-14T10:41:17.000-0700","timestamp":1652285079.133441,"priority":"Normal","status_category":"Done","pull_request":5115},{"issue_id":"106448","title":"Exclude unsafe Yocto scripts from service init provider","url":"https://tickets.puppetlabs.com/browse/PUP-5520","created_at":"2015-11-19T10:09:12.000-0800","number":"PUP-5520","body":"Gathering the status of service resources on Yocto Linux causes unintended consequences such as sending shutdown signals to daemons.\r\n\r\nThis is due to a series of unsafe init scripts shipped by Yocto.  Need to exclude these scripts from the service init provider so that Puppet does not try to execute them.","closed_at":"2016-07-20T16:29:39.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5520","labels":"","state":"Closed","updated_at":"2016-07-20T16:29:39.000-0700","timestamp":1652285079.742171,"priority":"Normal","status_category":"Done","pull_request":4480},{"issue_id":"102754","title":"Daemonized agent's pidfile never removed if stopped while waiting for a certificate","url":"https://tickets.puppetlabs.com/browse/PUP-5422","created_at":"2015-10-23T11:10:29.000-0700","number":"PUP-5422","body":"In Solaris, starting the puppet service with {{puppet resource service puppet ensure=running}} creates {{/var/run/puppetlabs/agent.pid}} with the PID of the daemonized process. However, stopping the service correctly kills the service but leaves the pidfile in place with the old PID.\r\n\r\n{noformat}\r\n-bash-3.2# puppet resource service puppet ensure=running\r\nNotice: /Service[puppet]/ensure: ensure changed 'stopped' to 'running'\r\nservice { 'puppet':\r\n  ensure => 'running',\r\n}\r\n\r\n-bash-3.2# puppet resource service puppet\r\nservice { 'puppet':\r\n  ensure => 'running',\r\n  enable => 'true',\r\n}\r\n\r\n-bash-3.2# cat /var/run/puppetlabs/agent.pid\r\n1343\r\n\r\n-bash-3.2# ps -elf | grep 1343\r\n 0 S     root  1343     1   0  40 20        ?   9011        ? 11:07:40 ?           0:00 /opt/puppetlabs/puppet/bin/ruby /op\r\n\r\n# Stopping the service\r\n-bash-3.2# puppet resource service puppet ensure=stopped\r\nNotice: /Service[puppet]/ensure: ensure changed 'running' to 'stopped'\r\nservice { 'puppet':\r\n  ensure => 'stopped',\r\n}\r\n\r\n-bash-3.2# puppet resource service puppet\r\nservice { 'puppet':\r\n  ensure => 'stopped',\r\n  enable => 'false',\r\n}\r\n\r\n-bash-3.2# cat /var/run/puppetlabs/agent.pid\r\n1343\r\n\r\n-bash-3.2# ps -elf | grep puppet\r\n\r\n-bash-3.2# svcs puppet\r\nSTATE          STIME    FMRI\r\ndisabled       11:08:31 svc:/network/puppet:default\r\n{noformat}\r\n\r\nNote: this *only* affects agents which don't have a signed certificate, and it only affects Solaris. This is due to the fact that our puppet service start script in Solaris ({{/lib/svc/method/puppet}}) only runs {{exec /opt/puppetlabs/bin/puppet agent}}, unlike other platforms which use the {{--no-daemonize}} option. This means that other platforms don't even have a pidfile to begin with, since the daemon itself is not running.\r\n\r\nThe certificate aspect is due to the fact that when we can't find a cert, we cycle and wait for it in {{Puppet::SSL::Host.wait_for_cert}} and eventually get hit with the stop signal. Something is preventing {{Puppet::Daemon.stop}} from ever being called, and thus the pidfile remains behind.\r\n\r\nThis fix will affect all daemonization code paths (master [--daemonize], master --no-daemonize, agent --onetime, agent --no-daemonize, agent [--daemonize]); we should verify all those modes still work, and when running as a service that shutdown cleans up correctly. See reproduction steps by [~whopper] below.","closed_at":"2016-07-20T17:08:05.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5422","labels":"","state":"Closed","updated_at":"2016-07-20T17:08:05.000-0700","timestamp":1652285079.846347,"priority":"Normal","status_category":"Done","pull_request":4411},{"issue_id":"98472","title":"Solaris (10) service provider returns before service refresh is complete","url":"https://tickets.puppetlabs.com/browse/PUP-5262","created_at":"2015-09-16T16:46:51.000-0700","number":"PUP-5262","body":"In Solaris 10 x86, refreshing a service causes it to be restarted, as expected. However, Puppet finishes the run and returns before the service has finished restarting, meaning that for a few seconds, {{puppet resource service <name>}} indicates that the service is stopped.\r\n\r\nQuerying again in a few seconds results in the status being 'running' as expected:\r\ntest.pp:\r\n{noformat}\r\nservice { 'puppet':}\r\n\r\nnotify {'Refreshing puppet':\r\n  notify => Service['puppet']\r\n}\r\n{noformat}\r\n\r\n{noformat}\r\n-bash-3.2# puppet resource service puppet\r\nservice { 'puppet':\r\n  ensure => 'running',\r\n  enable => 'true',\r\n}\r\n\r\n-bash-3.2# puppet apply test.pp\r\nNotice: Compiled catalog for koaxfaftdv5jllu.delivery.puppetlabs.net in environment production in 0.63 seconds\r\nNotice: Refreshing puppet\r\nNotice: /Stage[main]/Main/Notify[Refreshing puppet]/message: defined 'message' as 'Refreshing puppet'\r\nNotice: /Stage[main]/Main/Service[puppet]: Triggered 'refresh' from 1 events\r\nNotice: Applied catalog in 0.09 seconds\r\n\r\n-bash-3.2# puppet resource service puppet\r\nservice { 'puppet':\r\n  ensure => 'stopped',\r\n  enable => 'false',\r\n}\r\n\r\n(5 seconds later)\r\n-bash-3.2# puppet resource service puppet\r\nservice { 'puppet':\r\n  ensure => 'running',\r\n  enable => 'true',\r\n}\r\n{noformat}","closed_at":"2016-07-20T17:12:52.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5262","labels":"","state":"Closed","updated_at":"2016-07-20T17:12:52.000-0700","timestamp":1652285079.949201,"priority":"Normal","status_category":"Done","pull_request":4416},{"issue_id":"101764","title":"AIX service provider returns before service operations are complete","url":"https://tickets.puppetlabs.com/browse/PUP-5387","created_at":"2015-10-15T11:01:43.000-0700","number":"PUP-5387","body":"In AIX, when we stop the puppet service with {{puppet resource service puppet ensure=stopped}},\r\npuppet returns before the service has actually finished stopping. AIX's service manager takes a while to stop the service, and for a brief period puppet doesn't understand what state the service is in:\r\n\r\n{noformat}\r\n-bash-3.2# /opt/puppetlabs/puppet/bin/puppet resource service puppet\r\nservice { 'puppet':\r\n  enable => 'false',\r\n}\r\n{noformat}","closed_at":"2016-07-20T17:15:31.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5387","labels":"","state":"Closed","updated_at":"2016-07-20T17:15:31.000-0700","timestamp":1652285080.055444,"priority":"Normal","status_category":"Done","pull_request":4403},{"issue_id":"96273","title":"Don't allow remote filebuckets to be listed","url":"https://tickets.puppetlabs.com/browse/PUP-5151","created_at":"2015-09-01T22:43:58.000-0700","number":"PUP-5151","body":"PUP-1388 made it possible to list remote filebuckets (and has not yet been released). When combined with the default auth.conf granting all authenticated nodes read/write access to the filebucket, then any authenticated node can trivially download all files that have ever been filebucketed from all nodes.\r\n\r\nThis is technically possible today, but much harder, because the node can only ask for files by checksum, and doesn't know what other files have been backed up by other nodes.\r\n\r\nWe should only allow the {{list}} command to work with local filebuckets.","closed_at":"2016-07-20T17:18:13.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5151","labels":"","state":"Closed","updated_at":"2016-07-20T17:18:13.000-0700","timestamp":1652285080.159354,"priority":"Normal","status_category":"Done","pull_request":4352},{"issue_id":"99093","title":"\"produces\" statements seem not to work from a puppet agent run","url":"https://tickets.puppetlabs.com/browse/PUP-5275","created_at":"2015-09-22T17:16:43.000-0700","number":"PUP-5275","body":"Trying to {{export}} a capability when running {{puppet agent}} results in the following error:\r\n\r\n{code}\r\nError: Could not retrieve catalog from remote server: Error 400 on SERVER: Resource type Site::Pql does not produce Sql on node centos7-1.vm\r\n{code}\r\n\r\nThere is a {{Site::Pql produces Sql}} statement in the correct spot (next to the definition), but it seems not to have actually been evaluated.\r\n\r\nIf {{environment_timeout = unlimited}} is enabled and an environment catalog is retrieved first, subsequent agent runs succeed. This seems to indicate that the {{produces}} statements _are_ evaluated when compiling the environment catalog and then cached for the agent run. ","closed_at":"2016-07-21T10:23:26.000-0700","comments":17,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5275","labels":"","state":"Closed","updated_at":"2016-07-21T10:23:26.000-0700","timestamp":1652285080.366226,"priority":"Blocker","status_category":"Done","pull_request":4360},{"issue_id":"139002","title":"Group resource members order can break idempotence in Windows","url":"https://tickets.puppetlabs.com/browse/PUP-6450","created_at":"2016-06-27T21:01:10.000-0700","number":"PUP-6450","body":"Given the following hiera array:\r\n\r\n{code:java}\r\nlocal_admins:\r\n  - 'root'\r\n  - 'bob'\r\n  - 'harry'\r\n  - 'moe'\r\n  - 'vagrant'\r\n{code}\r\n\r\nand the following manifest:\r\n\r\n{code:java}\r\nclass windows_users {\r\n  group { 'Administrators':\r\n    ensure => present,\r\n    name => 'Administrators',\r\n    auth_membership => true,\r\n    members => hiera('local_admins'),\r\n  }\r\n}\r\n{code}\r\n\r\nI am seeing a change every time the manifest runs:\r\n\r\n{code:java}\r\nC:\\Users\\Administrator>puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for pe-201611-agent-win2012\r\nInfo: Applying configuration version '1464303479'\r\nNotice: /Stage[main]/Windows_users/Group[Administrators]/members: members change\r\nd 'PE-201611-AGENT\\vagrant,PE-201611-AGENT\\root,PE-201611-AGENT\\bob,PE-201611-AG\r\nENT\\harry,PE-201611-AGENT\\moe' to 'PE-201611-AGENT\\root,PE-201611-AGENT\\bob,PE-2\r\n01611-AGENT\\harry,PE-201611-AGENT\\moe,PE-201611-AGENT\\vagrant'\r\nNotice: Applied catalog in 0.74 seconds\r\n{code}\r\n\r\nIf I change the order of the array elements:\r\n\r\n{code:java}\r\nlocal_admins:\r\n  - 'vagrant'\r\n  - 'root'\r\n  - 'bob'\r\n  - 'harry'\r\n  - 'moe'\r\n{code}\r\n\r\nThere is no change when the manifest runs.\r\n","closed_at":"2016-07-25T09:46:56.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6450","labels":"windows","state":"Closed","updated_at":"2016-07-25T09:46:56.000-0700","timestamp":1652285080.575708,"priority":"Normal","status_category":"Done","pull_request":5064},{"issue_id":"98835","title":"Puppet scheduled_task provider on windows fails if non-ASCII characters are in Task Name","url":"https://tickets.puppetlabs.com/browse/PUP-5269","created_at":"2015-09-21T08:30:48.000-0700","number":"PUP-5269","body":"If there is a scheduled task with a Non-ASCII name  in the task library({{%SYSTEMROOT%/Tasks}}), {{scheduled_task}} provider will fail. \r\n\r\nOf course I don't name scheduled task like that, but sometimes third-party program or the end users might do so.\r\n\r\nI tried set the {{codepage}} to {{1252}}, but the error occurs anyway. So I guess it's a issue of Ruby again like [PUP-4333|https://tickets.puppetlabs.com/browse/PUP-4333]?\r\n\r\n\r\n{code}\r\nC:\\Users\\Administrator\\Desktop>puppet apply sch.pp --debug --trace\r\n......\r\nInfo: Applying configuration version '1443053017'\r\nError: Could not set 'present' on ensure: U+00AE to IBM437 in conversion from UTF-16LE to UTF-8 to IBM437 at 10:C:/Users/Admi\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/api_types.rb:58:in `encode'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/api_types.rb:58:in `read_wide_string'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/api_types.rb:69:in `block in read_arbitrary_wide_string_up\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/api_types.rb:67:in `upto'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/api_types.rb:67:in `read_arbitrary_wide_string_up_to'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:215:in `block (6 levels) in enum'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/api_types.rb:97:in `read_com_memory_pointer'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:214:in `block (5 levels) in enum'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:213:in `each'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:213:in `block (4 levels) in enum'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/api_types.rb:97:in `read_com_memory_pointer'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:210:in `block (3 levels) in enum'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:204:in `initialize'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:204:in `new'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:204:in `block (2 levels) in enum'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:203:in `initialize'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:203:in `new'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:203:in `block in enum'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:117:in `block in UseInstance'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:114:in `initialize'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:114:in `new'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:114:in `UseInstance'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:202:in `enum'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:514:in `new_work_item'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:191:in `initialize'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/provider/scheduled_task/win32_taskscheduler.rb:214:in `new'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/provider/scheduled_task/win32_taskscheduler.rb:214:in `create'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/property/ensure.rb:16:in `block in defaultvalues'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/property.rb:197:in `call_valuemethod'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/property.rb:498:in `set'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/property.rb:581:in `sync'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harness.rb:204:in `sync'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harness.rb:128:in `sync_if_needed'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harness.rb:81:in `perform_changes'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harness.rb:20:in `evaluate'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:204:in `apply'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:217:in `eval_resource'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:147:in `call'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:147:in `block (2 levels) in evaluate'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:335:in `block in thinmark'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:334:in `thinmark'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:147:in `block in evaluate'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/graph/relationship_graph.rb:118:in `traverse'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:138:in `evaluate'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/resource/catalog.rb:169:in `block in apply'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/log.rb:149:in `with_destination'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/report.rb:112:in `as_logging_destination'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/resource/catalog.rb:168:in `apply'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:120:in `block in apply_catalog'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:161:in `block in benchmark'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:160:in `benchmark'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:119:in `apply_catalog'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:227:in `run_internal'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:134:in `block in run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/context.rb:64:in `override'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet.rb:244:in `override'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:133:in `run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application/apply.rb:302:in `apply_catalog'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application/apply.rb:236:in `block in main'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/context.rb:64:in `override'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet.rb:244:in `override'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application/apply.rb:198:in `main'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application/apply.rb:159:in `run_command'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:381:in `block (2 levels) in run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:507:in `plugin_hook'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:381:in `block in run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:496:in `exit_on_fail'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:381:in `run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/command_line.rb:146:in `run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/command_line.rb:92:in `execute'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/bin/puppet:8:in `<main>'\r\nError: Could not set 'present' on ensure: U+00AE to IBM437 in conversion from UTF-16LE to UTF-8 to IBM437 at 10:C:/Users/Admi\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/api_types.rb:58:in `encode'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/api_types.rb:58:in `read_wide_string'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/api_types.rb:69:in `block in read_arbitrary_wide_string_up\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/api_types.rb:67:in `upto'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/api_types.rb:67:in `read_arbitrary_wide_string_up_to'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:215:in `block (6 levels) in enum'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/api_types.rb:97:in `read_com_memory_pointer'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:214:in `block (5 levels) in enum'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:213:in `each'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:213:in `block (4 levels) in enum'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/api_types.rb:97:in `read_com_memory_pointer'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:210:in `block (3 levels) in enum'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:204:in `initialize'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:204:in `new'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:204:in `block (2 levels) in enum'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:203:in `initialize'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:203:in `new'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:203:in `block in enum'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:117:in `block in UseInstance'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:114:in `initialize'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:114:in `new'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:114:in `UseInstance'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:202:in `enum'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:514:in `new_work_item'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:191:in `initialize'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/provider/scheduled_task/win32_taskscheduler.rb:214:in `new'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/provider/scheduled_task/win32_taskscheduler.rb:214:in `create'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/property/ensure.rb:16:in `block in defaultvalues'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/property.rb:197:in `call_valuemethod'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/property.rb:498:in `set'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/property.rb:581:in `sync'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harness.rb:204:in `sync'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harness.rb:128:in `sync_if_needed'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harness.rb:81:in `perform_changes'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harness.rb:20:in `evaluate'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:204:in `apply'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:217:in `eval_resource'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:147:in `call'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:147:in `block (2 levels) in evaluate'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:335:in `block in thinmark'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:334:in `thinmark'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:147:in `block in evaluate'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/graph/relationship_graph.rb:118:in `traverse'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:138:in `evaluate'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/resource/catalog.rb:169:in `block in apply'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/log.rb:149:in `with_destination'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/report.rb:112:in `as_logging_destination'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/resource/catalog.rb:168:in `apply'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:120:in `block in apply_catalog'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:161:in `block in benchmark'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:160:in `benchmark'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:119:in `apply_catalog'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:227:in `run_internal'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:134:in `block in run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/context.rb:64:in `override'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet.rb:244:in `override'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:133:in `run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application/apply.rb:302:in `apply_catalog'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application/apply.rb:236:in `block in main'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/context.rb:64:in `override'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet.rb:244:in `override'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application/apply.rb:198:in `main'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application/apply.rb:159:in `run_command'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:381:in `block (2 levels) in run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:507:in `plugin_hook'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:381:in `block in run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:496:in `exit_on_fail'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:381:in `run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/command_line.rb:146:in `run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/command_line.rb:92:in `execute'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/bin/puppet:8:in `<main>'\r\nWrapped exception:\r\nU+00AE to IBM437 in conversion from UTF-16LE to UTF-8 to IBM437\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/api_types.rb:58:in `encode'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/api_types.rb:58:in `read_wide_string'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/api_types.rb:69:in `block in read_arbitrary_wide_string_up\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/api_types.rb:67:in `upto'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/api_types.rb:67:in `read_arbitrary_wide_string_up_to'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:215:in `block (6 levels) in enum'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/api_types.rb:97:in `read_com_memory_pointer'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:214:in `block (5 levels) in enum'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:213:in `each'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:213:in `block (4 levels) in enum'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/api_types.rb:97:in `read_com_memory_pointer'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:210:in `block (3 levels) in enum'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:204:in `initialize'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:204:in `new'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:204:in `block (2 levels) in enum'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:203:in `initialize'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:203:in `new'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:203:in `block in enum'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:117:in `block in UseInstance'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:114:in `initialize'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:114:in `new'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:114:in `UseInstance'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:202:in `enum'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:514:in `new_work_item'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler.rb:191:in `initialize'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/provider/scheduled_task/win32_taskscheduler.rb:214:in `new'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/provider/scheduled_task/win32_taskscheduler.rb:214:in `create'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/property/ensure.rb:16:in `block in defaultvalues'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/property.rb:197:in `call_valuemethod'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/property.rb:498:in `set'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/property.rb:581:in `sync'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harness.rb:204:in `sync'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harness.rb:128:in `sync_if_needed'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harness.rb:81:in `perform_changes'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harness.rb:20:in `evaluate'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:204:in `apply'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:217:in `eval_resource'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:147:in `call'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:147:in `block (2 levels) in evaluate'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:335:in `block in thinmark'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:334:in `thinmark'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:147:in `block in evaluate'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/graph/relationship_graph.rb:118:in `traverse'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:138:in `evaluate'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/resource/catalog.rb:169:in `block in apply'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/log.rb:149:in `with_destination'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/report.rb:112:in `as_logging_destination'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/resource/catalog.rb:168:in `apply'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:120:in `block in apply_catalog'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:161:in `block in benchmark'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:160:in `benchmark'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:119:in `apply_catalog'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:227:in `run_internal'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:134:in `block in run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/context.rb:64:in `override'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet.rb:244:in `override'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:133:in `run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application/apply.rb:302:in `apply_catalog'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application/apply.rb:236:in `block in main'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/context.rb:64:in `override'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet.rb:244:in `override'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application/apply.rb:198:in `main'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application/apply.rb:159:in `run_command'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:381:in `block (2 levels) in run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:507:in `plugin_hook'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:381:in `block in run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:496:in `exit_on_fail'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:381:in `run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/command_line.rb:146:in `run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/command_line.rb:92:in `execute'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/bin/puppet:8:in `<main>'\r\nError: /Stage[main]/Main/Scheduled_task[test]/ensure: change from absent to present failed: Could not set 'present' on ensure\r\nversion from UTF-16LE to UTF-8 to IBM437 at 10:C:/Users/Administrator/Desktop/sch.pp\r\nDebug: Finishing transaction 34518192\r\nDebug: Storing state\r\nDebug: Stored state in 0.06 seconds\r\nNotice: Finished catalog run in 0.23 seconds\r\nDebug: Using settings: adding file resource 'rrddir': 'File[C:/ProgramData/PuppetLabs/puppet/var/rrd]{:path=>\"C:/ProgramData/\r\n\", :mode=>\"750\", :ensure=>:directory, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\nDebug: Finishing transaction 33852696\r\nDebug: Received report to process from win2k8sp2x86\r\nDebug: Evicting cache entry for environment 'devel'\r\nDebug: Caching environment 'devel' (ttl = 0 sec)\r\nDebug: Processing report from win2k8sp2x86 with processor Puppet::Reports::Store\r\n\r\nC:\\Users\\Administrator\\Desktop>\r\n\r\n{code}\r\n","closed_at":"2016-07-25T09:46:56.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5269","labels":"puppet-agent;scheduled_task;windows","state":"Closed","updated_at":"2016-07-25T09:46:56.000-0700","timestamp":1652285080.681239,"priority":"Major","status_category":"Done","pull_request":5038},{"issue_id":"38559","title":"RHEL7 traditional services should have provider 'redhat' not 'init'","url":"https://tickets.puppetlabs.com/browse/PUP-2744","created_at":"2014-06-09T13:29:48.000-0700","number":"PUP-2744","body":"I've been digging through the catalog post-compile and I noticed the following pattern. For all services that are in systemd, they have the provider 'systemd'. However, all services that are in the legacy /etc/init.d space are registered with the 'init' provider even though they are clearly registered in chkconfig.\r\n\r\nI'm a bit worried about this since it seems that something is potentially wrong with the provider load order which would be endemic of other issues.\r\n\r\n{code:yaml}\r\n!ruby/object:Puppet::Resource\r\n  type: Service\r\n  title: netconsole\r\n  tags: \r\n    - service\r\n    - netconsole\r\n  parameters: \r\n    !ruby/sym ensure: !ruby/sym stopped\r\n# This should be 'redhat'!\r\n    !ruby/sym provider: !ruby/sym init\r\n    !ruby/sym hasstatus: !ruby/sym \"true\"\r\n    !ruby/sym path: \r\n      - /etc/init.d\r\n    !ruby/sym pattern: netconsole\r\n    !ruby/sym loglevel: !ruby/sym notice\r\n{code}\r\n","closed_at":"2016-07-26T15:53:19.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2744","labels":"catalog;compile;redhat7;service","state":"Closed","updated_at":"2016-07-26T15:53:19.000-0700","timestamp":1652285080.890406,"priority":"Normal","status_category":"Done","pull_request":4755},{"issue_id":"133541","title":"new function (String): not all string-based conversions respect width and precision","url":"https://tickets.puppetlabs.com/browse/PUP-6346","created_at":"2016-05-24T00:04:32.000-0700","number":"PUP-6346","body":"Certain conversions to {{String}} using the {{new}} function respect width and precision of the format argument while some others do not.\r\n\r\nExamples:\r\n\r\n{code}\r\nnotice String(undef, '%.1p')\r\nnotice String(undef, '%#.1p')\r\nnotice String(default, '%.1p')\r\nnotice String(true, '%.2s')\r\nnotice String(true, '%.2y')\r\n{code}\r\n\r\nThis outputs:\r\n\r\n{code}\r\nNotice: Scope(Class[main]): u\r\nNotice: Scope(Class[main]): \"\r\nNotice: Scope(Class[main]): default\r\nNotice: Scope(Class[main]): true\r\nNotice: Scope(Class[main]): yes\r\n{code}\r\n\r\nExpected output:\r\n\r\n{code}\r\nNotice: Scope(Class[main]): u\r\nNotice: Scope(Class[main]): \"\r\nNotice: Scope(Class[main]): d\r\nNotice: Scope(Class[main]): tr\r\nNotice: Scope(Class[main]): ye\r\n{code}\r\n\r\nThe width and precision in a format should be consistently respected.","closed_at":"2016-07-27T08:38:21.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6346","labels":"","state":"Closed","updated_at":"2016-07-27T08:38:21.000-0700","timestamp":1652285081.093789,"priority":"Normal","status_category":"Done","pull_request":5090},{"issue_id":"132014","title":"Numeric.new (and subtypes) does not accept whitespace between sign and leading digit","url":"https://tickets.puppetlabs.com/browse/PUP-6314","created_at":"2016-05-16T17:13:13.000-0700","number":"PUP-6314","body":"The following Puppet code:\r\n\r\n{code}\r\nnotice Integer.new('+ 1')\r\n{code}\r\n\r\nresults in the following error:\r\n\r\n{code}\r\nError while evaluating a Function Call, invalid value for Integer(): \"+ 1\"\r\n{code}\r\n\r\nExpected this to print:\r\n\r\n{code}\r\nNotice: Scope(Class[main]): 1\r\n{code}\r\n\r\nThe problem is the whitespace between the sign and the leading digit in the number; we support it for arithmetic {{String}} to {{Integer}} conversions (e.g. {{notice '+ 1' + '- 1'}} results in {{0}}), so I expect {{Integer.new}} to be consistent with that conversion.\r\n\r\n*Note: this also affects {{Float.new}} (and by extension {{Numeric.new}}).*","closed_at":"2016-07-27T08:38:21.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6314","labels":"","state":"Closed","updated_at":"2016-07-27T08:38:21.000-0700","timestamp":1652285081.195984,"priority":"Normal","status_category":"Done","pull_request":5089},{"issue_id":"133542","title":"new function (String): programmatic representation escapes for Ruby language and not Puppet","url":"https://tickets.puppetlabs.com/browse/PUP-6347","created_at":"2016-05-24T00:14:15.000-0700","number":"PUP-6347","body":"Conversions to {{String}} using the {{new}} function with the {{%p}} format escapes characters for the Ruby language and not the Puppet language.\r\n\r\n{code}\r\nnotice String('foo#{bar}', '%p')\r\nnotice String(\"\\u{1b}\", '%p')\r\nnotice String('$foobar', '%p')\r\n{code}\r\n\r\nOutputs:\r\n\r\n{code}\r\nNotice: Scope(Class[main]): \"foo\\#{bar}\"\r\nNotice: Scope(Class[main]): \"\\e\"\r\nNotice: Scope(Class[main]): \"$foobar\"\r\n{code}\r\n\r\nExpected output:\r\n\r\n{code}\r\nNotice: Scope(Class[main]): \"foo#{bar}\"\r\nNotice: Scope(Class[main]): \"\\u{1b}\"\r\nNotice: Scope(Class[main]): \"\\$foobar\"\r\n{code}\r\n\r\nIn the first example, {{#{...\\}}} should not be escaped as has no semantic meaning in Puppet.\r\n\r\nIn the second example, {{\\e}} is not a valid escape character in Puppet.  We should probably be outputting {{\\u{...\\}}} for ASCII control characters that do not already have an escape representation in Puppet.\r\n\r\nIn the third example, {{$}} needs to be escaped as it starts interpolation in Puppet (like {{#{...\\}}} would need to be in Ruby).\r\n\r\nThis is a result of using {{Kernel#format}} to output the programmatic representation;  there needs to be an implementation that conforms to Puppet strings and not Ruby strings. \r\n","closed_at":"2016-07-27T08:38:21.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6347","labels":"","state":"Closed","updated_at":"2016-07-27T08:38:21.000-0700","timestamp":1652285081.299971,"priority":"Normal","status_category":"Done","pull_request":5091},{"issue_id":"139586","title":"Accessing a required parameter that is unassigned causes bad error message","url":"https://tickets.puppetlabs.com/browse/PUP-6463","created_at":"2016-06-30T12:56:11.000-0700","number":"PUP-6463","body":"I ran into this error trying to include a PE profile class that happened to inherit a class that was already defined in the PE console. This is the minimal repro of the root issue.\r\n\r\nGiven the following site.pp:\r\n\r\n{code:java}\r\nclass breaking (\r\n    String $first,\r\n    String $second = $first,\r\n){}\r\n\r\nnode default {\r\n  include breaking\r\n}\r\n{code}\r\n\r\nThe expected error would be that the required parameter is missing.  But instead the following error happens:\r\n\r\n{noformat}\r\nError: Could not retrieve catalog from remote server: Error 400 on SERVER: Evaluation Error: Error while evaluating a Resource Statement, default expression for $second tries to illegally access not yet evaluated $first at /etc/puppetlabs/code/environments/production/manifests/site.pp:31:3 on node master.puppetlabs.vm\r\n{noformat}\r\n\r\n\r\nTo repro the original issue, start with a stock PE master and add `include puppet_enterprise::profile::mcollective::peadmin` to the default node group. The unnecessary inheritance caused that issue, but the error message pointed to the root issue in puppet with the parameter evaluation order.","closed_at":"2016-07-27T08:42:07.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6463","labels":"","state":"Closed","updated_at":"2016-07-27T08:42:07.000-0700","timestamp":1652285081.404064,"priority":"Normal","status_category":"Done","pull_request":5078},{"issue_id":"75425","title":"Regression: Windows service provider fails to retrieve current state on 2003","url":"https://tickets.puppetlabs.com/browse/PUP-4390","created_at":"2015-04-09T15:14:44.000-0700","number":"PUP-4390","body":"As a result of this issue, using Live Management to return a list of services on 2003 will fail.\r\n\r\nUsing puppet-agent-1.0.0-x86.msi on win2003r2-i386:\r\n\r\n{noformat}\r\nC:\\Program Files\\Puppet Labs\\Puppet\\bin>puppet resource service --trace\r\nError: Could not run: The system call level is not correct. - QueryServiceConfig2: The system call level is not correct.\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/gems/2.1.0/gems/win32-service-0.8.6/lib/win32/windows/helper.rb:36:in `raise_windows_error'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/gems/2.1.0/gems/win32-service-0.8.6/lib/win32/service.rb:1380:in `get_config2_info'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/gems/2.1.0/gems/win32-service-0.8.6/lib/win32/service.rb:1092:in `block in services'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/gems/2.1.0/gems/win32-service-0.8.6/lib/win32/service.rb:1037:in `upto'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/gems/2.1.0/gems/win32-service-0.8.6/lib/win32/service.rb:1037:in `services'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/provider/service/windows.rb:104:in `instances'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/type.rb:1143:in `block in instances'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/type.rb:1136:in `collect'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/type.rb:1136:in `instances'\r\n{noformat}\r\n\r\nStrangely, I can manage a single service resource, just not enumerate all services, or retrieve the current state for a single service:\r\n\r\n{noformat}\r\nC:\\Program Files\\Puppet Labs\\Puppet\\bin>puppet resource service wuauserv\r\nError: Could not run: The system call level is not correct. - QueryServiceConfig\r\n2: The system call level is not correct.\r\n\r\nC:\\Program Files\\Puppet Labs\\Puppet\\bin>puppet resource service wuauserv ensure=stopped\r\nNotice: /Service[wuauserv]/ensure: ensure changed 'running' to 'stopped'\r\nservice { 'wuauserv':\r\n  ensure => 'stopped',\r\n}\r\n\r\nC:\\Program Files\\Puppet Labs\\Puppet\\bin>puppet resource service wuauserv ensure=running\r\nNotice: /Service[wuauserv]/ensure: ensure changed 'stopped' to 'running'\r\nservice { 'wuauserv':\r\n  ensure => 'running',\r\n}\r\n{noformat}\r\n\r\nThis is not an issue on 2008r2-x86_64 with either puppet-agent-1.0.0-x86 or x64:\r\n\r\n{noformat}\r\nC:\\Windows\\system32>puppet resource service wuauserv\r\nservice { 'wuauserv':\r\n  ensure => 'running',\r\n  enable => 'true',\r\n}\r\n\r\nC:\\Windows\\system32>ruby --version\r\nruby 2.1.5p273 (2014-11-13 revision 48405) [i386-mingw32]\r\n{noformat}\r\n\r\nh2. QA Risk Analysis\r\n| Probability | Medium (but how many sites are still running 2003?) |\r\n| Impact | High (invalid data in catalog)\r\n| Risk Level | Medium |\r\n| Test Level | Unit |","closed_at":"2016-07-29T14:06:29.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4390","labels":"windows","state":"Closed","updated_at":"2016-07-29T14:06:29.000-0700","timestamp":1652285082.387599,"priority":"Critical","status_category":"Done","pull_request":3825},{"issue_id":"101668","title":"Evaluating instance match with Optional[T] and NotUndef[T] fails when T is a string value","url":"https://tickets.puppetlabs.com/browse/PUP-5381","created_at":"2015-10-14T14:27:44.000-0700","number":"PUP-5381","body":"{{Optional[T]}} and {{NotUndef[T]}}, where T is a instance of a string, should behave like {{Optional[Enum[T]]}} and {{NotUndef[Enum[T]]}}, respectively.\r\n\r\nThe following evaluates to false as expected:\r\n\r\n{code}\r\nnotice(5 =~ Optional[Enum[foo]])\r\n{code}\r\n\r\nHowever, this produces an error:\r\n\r\n{code}\r\nnotice(5 =~ Optional[foo])\r\n{code}\r\n\r\nOutput:\r\n{code}\r\nError: Evaluation Error: Error while evaluating a '=~' expression, undefined method `instance?' for \"foo\":String at site.pp:1:10 on node peterhu-osx\r\n{code}\r\n\r\nThere may be other operations on {{Optional[string]}} and {{NotUndef[string]}} that result in similar exceptions.","closed_at":"2016-08-03T16:18:02.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5381","labels":"","state":"Closed","updated_at":"2016-08-03T16:18:02.000-0700","timestamp":1652285082.795357,"priority":"Normal","status_category":"Done","pull_request":4365},{"issue_id":"21568","title":"Service Provider 'init' does not detect correct location for script directory on AIX - Patch included","url":"https://tickets.puppetlabs.com/browse/PUP-1134","created_at":"2013-12-17T06:51:36.000-0800","number":"PUP-1134","body":"The correct directory for init scripts on aix is '/etc/rc.d/init.d'\r\n\r\nThis has not been implemented in the 'init' service provider.\r\n\r\nThe fix is very simple (2 lines of code). The attached fix is derived from the github/puppetlabs/puppet master branch.","closed_at":"2016-08-11T09:56:35.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1134","labels":"client-onboarding;redmine","state":"Closed","updated_at":"2016-08-11T09:56:35.000-0700","timestamp":1652285083.31254,"priority":"Normal","status_category":"Done","pull_request":8810},{"issue_id":"24514","title":"Puppet help silently exits when an application fails to load","url":"https://tickets.puppetlabs.com/browse/PUP-1512","created_at":"2014-01-24T09:34:43.000-0800","number":"PUP-1512","body":"The help face-based application only rescues Puppet::Errors when trying to display help for each installed application. If an application, e.g. from a module, has a dependency on a gem that is not installed, then puppet help silently exits with 1:\r\n\r\n{noformat}\r\n0 ~/work/puppet (master)  $ be puppet module install msopentech-windowsazure\r\nNotice: Preparing to install into /Users/josh/.puppet/modules ...\r\nNotice: Downloading from https://forge.puppetlabs.com ...\r\nNotice: Installing -- do not interrupt ...\r\n/Users/josh/.puppet/modules\r\n└── msopentech-windowsazure (v1.1.1)\r\n0 ~/work/puppet (master)  $ be puppet help\r\n1 ~/work/puppet (master)  $\r\n{noformat}\r\n\r\nSomething like this seems to fix the problem, though faces seems to only rescue Puppet::Errors in other places as well:\r\n\r\n{noformat}\r\ndiff --git a/lib/puppet/face/help.rb b/lib/puppet/face/help.rb\r\nindex 44380ab..713d57e 100644\r\n— a/lib/puppet/face/help.rb\r\n+++ b/lib/puppet/face/help.rb\r\n@@ -140,7 +140,9 @@ Detail: \"#{detail.message}\"\r\nbegin\r\nface = Puppet::Face[appname, :current]\r\nresult << [appname, face.summary]\r\nrescue Puppet::Error\r\n+ rescue SystemExit,NoMemoryError\r\n+ raise\r\n+ rescue Exception => e\r\nresult << [ \"! # {appname}\r\n\", \"! Subcommand unavailable due to error. Check error logs.\"\r\nend\r\n{noformat}","closed_at":"2016-08-11T09:56:37.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1512","labels":"","state":"Closed","updated_at":"2016-08-11T09:56:37.000-0700","timestamp":1652285083.415582,"priority":"Normal","status_category":"Done","pull_request":5046},{"issue_id":"32543","title":"Attributes attribute will not accept a single value for the User resource in AIX","url":"https://tickets.puppetlabs.com/browse/PUP-2316","created_at":"2014-04-21T21:41:50.000-0700","number":"PUP-2316","body":"This seems to be a bug specific to AIX. When you pass a single value within the attributes array in a User resource:\r\n\r\n{code}\r\nuser { 'existinguser':\r\n  ensure     => present,\r\n  attributes => ['rlogin=false'],\r\n  home       => '/home/existinguser',\r\n}  \r\n{code}\r\n\r\n\r\nIt throws the following error upon applying the change:\r\n\r\n{code}\r\n\"Error: /User[root]: Could not evaluate: undefined methodmap' for \"rlogin=false\":String\"`\r\n{code}\r\n\r\nThe only workaround I have managed is to add another value to the attributes array.","closed_at":"2016-08-11T09:56:37.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2316","labels":"client-onboarding","state":"Closed","updated_at":"2016-08-11T09:56:37.000-0700","timestamp":1652285083.518224,"priority":"Normal","status_category":"Done","pull_request":5029},{"issue_id":"139496","title":"pip package provider with \"ensure => latest\" displays version change when there is none (problem parsing the output string in some cases)","url":"https://tickets.puppetlabs.com/browse/PUP-6461","created_at":"2016-06-30T07:14:28.000-0700","number":"PUP-6461","body":"When using \r\n  package {'virtualenv':\r\n    ensure   => latest,\r\n    provider => 'pip',\r\n  }\r\n\r\nThe return string from \" pip install --upgrade virtualenv \" is \"\"\"\r\nInstalled version (15.0.2) is most up-to-date (past versions: 15.0.2, 15.0.2, 15.0.1, 15.0.1, 15.0.0, 15.0.0, 14.0.6, 14.0.6, 14.0.5, 14.0.5, 14.0.4, 14.0.4, 14.0.3, 14.0.3, 14.0.2, 14.0.2, 14.0.1, 14.0.1, 14.0.0, 14.0.0, 13.1.2, 13.1.2, 13.1.1, 13.1.1, 13.1.0, 13.1.0, 13.0.3, 13.0.3, 13.0.2, 13.0.2, 13.0.1, 13.0.1, 13.0.0, 13.0.0, 12.1.1, 12.1.1, 12.1.0, 12.1.0, 12.0.7, 12.0.7, 12.0.6, 12.0.5, 12.0.5, 12.0.4, 12.0.4, 12.0.2, 12.0.2, 12.0.1, 12.0.1, 12.0, 12.0, 1.11.6, 1.11.6, 1.11.5, 1.11.4, 1.11.4, 1.11.3, 1.11.3, 1.11.2, 1.11.2, 1.11.1, 1.11.1, 1.11, 1.10.1, 1.10, 1.9.1, 1.9, 1.8.4, 1.8.3, 1.8.2, 1.8.1, 1.8, 1.7.2, 1.7.1.2, 1.7.1.1, 1.7.1, 1.7, 1.6.4, 1.6.3, 1.6.2, 1.6.1, 1.6, 1.5.2, 1.5.1, 1.5, 1.4.9, 1.4.8, 1.4.7, 1.4.6, 1.4.5, 1.4.4, 1.4.3, 1.4.2, 1.4.1, 1.4, 1.3.4, 1.3.3, 1.3.2, 1.3.1, 1.3, 1.2, 1.1, 1.0, 0.9.2, 0.9.1, 0.9, 0.8.4, 0.8.3, 0.8.2, 0.8.1, 0.8)\r\n\"\"\"\r\n\r\nThis makes package provider print this string every single time puppet runs: \"\"\"\r\nensure changed '15.0.2' to '1.5'\r\n\"\"\"\r\n\r\nThough nothing actually changed on the server. I tracked the issue up to:\r\nhttps://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/package/pip.rb#L158\r\n\r\nWhere I guess for some reason the 1.5 version is taken instead of the 15.0.2, probably due to some sorting as '.' is after '5'.","closed_at":"2016-08-11T09:58:41.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6461","labels":"client-onboarding","state":"Closed","updated_at":"2016-08-11T09:58:41.000-0700","timestamp":1652285084.056743,"priority":"Minor","status_category":"Done","pull_request":5106},{"issue_id":"132707","title":"Puppet module tool should handle invalid paths better","url":"https://tickets.puppetlabs.com/browse/PUP-6327","created_at":"2016-05-19T10:46:12.000-0700","number":"PUP-6327","body":"When you install a module that contains file paths valid on the platform that it was built on, but not the platform it's being installed on, PMT fails with an inscrutable error. In hindsight, it's obvious, but the error messaging could be better about what went wrong.\r\n\r\n{code}\r\nPS C:\\Users\\Administrator> puppet module install trlinkin/domain_membership\r\nNotice: Preparing to install into C:/ProgramData/PuppetLabs/code/environments/pr\r\noduction/modules ...\r\nNotice: Downloading from https://forgeapi.puppetlabs.com ...\r\nFailed to add /C=US/O=GeoTrust Inc./CN=GeoTrust Global CA\r\nFailed to add /C=US/O=GeoTrust Inc./CN=GeoTrust Global CA\r\nFailed to add /C=US/O=GeoTrust Inc./CN=GeoTrust Global CA\r\nFailed to add /C=US/O=GeoTrust Inc./CN=GeoTrust Global CA\r\nFailed to add /C=US/O=GeoTrust Inc./CN=GeoTrust Global CA\r\nFailed to add /C=US/O=GeoTrust Inc./CN=GeoTrust Global CA\r\nFailed to add /C=US/O=GeoTrust Inc./CN=GeoTrust Global CA\r\nFailed to add /C=US/O=GeoTrust Inc./CN=GeoTrust Global CA\r\nError: Could not install package\r\n  Package attempted to install file into\r\n  \"trlinkin-domain_membership-1.1.0/:78\" under \"C:/Users/ADMINI~1/AppData/Local/\r\nTemp/cache/tmp20160519-2896-bnlxhg\".\r\n{code}\r\n\r\nThe problem is that {{:78}} is an invalid filename. The actual error is something more like {{mkdir : The given path's format is not supported.}}","closed_at":"2016-08-11T09:58:41.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6327","labels":"","state":"Closed","updated_at":"2016-08-11T09:58:41.000-0700","timestamp":1652285084.359875,"priority":"Normal","status_category":"Done","pull_request":4975},{"issue_id":"138588","title":"directoryservice user provider crashes if no ShadowHashData is found","url":"https://tickets.puppetlabs.com/browse/PUP-6437","created_at":"2016-06-24T09:57:54.000-0700","number":"PUP-6437","body":"Possibly related to [link PUP-6410|https://tickets.puppetlabs.com/browse/PUP-6410], if the {{user/directoryservice}} provider's {{get_attribute_from_dscl}} method returns {{nil}} when trying to fetch {{ShadowHashData}}, the whole thing explodes.\r\n\r\nWe've only seen this rarely, and only when the provider's trying to read an empty username (which is probably another bug that should be handled).\r\n\r\n{code}\r\nDebug: Prefetching directoryservice resources for user\r\nDebug: Executing: '/usr/bin/dscl -plist . readall /Users'\r\nDebug: Executing: '/usr/bin/dscl -plist . read /Users// ShadowHashData'\r\nDebug: Failed with NoMethodError on : #<NoMethodError: undefined method `elements' for nil:NilClass>\r\nDebug: Executing: '/usr/bin/dscl -plist . readall /Groups'\r\nDebug: Storing state\r\nDebug: Stored state in 0.00 seconds\r\nError: Failed to apply catalog: undefined method `empty?' for nil:NilClass\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/provider/user/directoryservice.rb:144:in `generate_attribute_hash'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/provider/user/directoryservice.rb:87:in `block in instances'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/provider/user/directoryservice.rb:86:in `collect'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/provider/user/directoryservice.rb:86:in `instances'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/provider/user/directoryservice.rb:73:in `prefetch'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/transaction.rb:305:in `prefetch'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/transaction.rb:205:in `prefetch_if_necessary'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/transaction.rb:97:in `block in evaluate'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/graph/relationship_graph.rb:116:in `call'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/graph/relationship_graph.rb:116:in `traverse'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/transaction.rb:142:in `evaluate'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/resource/catalog.rb:222:in `block in apply'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/util/log.rb:155:in `with_destination'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/transaction/report.rb:118:in `as_logging_destination'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/resource/catalog.rb:221:in `apply'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/configurer.rb:171:in `block in apply_catalog'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/util.rb:223:in `block in benchmark'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/2.1.0/benchmark.rb:294:in `realtime'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/util.rb:222:in `benchmark'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/configurer.rb:170:in `apply_catalog'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/configurer.rb:315:in `run_internal'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/configurer.rb:186:in `block in run'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/context.rb:65:in `override'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet.rb:240:in `override'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/configurer.rb:185:in `run'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/application/apply.rb:350:in `apply_catalog'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/application/apply.rb:274:in `block in main'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/context.rb:65:in `override'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet.rb:240:in `override'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/application/apply.rb:225:in `main'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/application/apply.rb:170:in `run_command'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/application.rb:344:in `block in run'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/util.rb:540:in `exit_on_fail'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/application.rb:344:in `run'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/util/command_line.rb:128:in `run'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/util/command_line.rb:72:in `execute'\r\n/Library/GoogleCorpSupport/bin/puppet:5:in `<main>'\r\n{code}","closed_at":"2016-08-11T09:58:42.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6437","labels":"","state":"Closed","updated_at":"2016-08-11T09:58:42.000-0700","timestamp":1652285084.764942,"priority":"Normal","status_category":"Done","pull_request":5056},{"issue_id":"137472","title":"static_compiler: symlinks in recursed directories don't work","url":"https://tickets.puppetlabs.com/browse/PUP-6415","created_at":"2016-06-16T08:54:14.000-0700","number":"PUP-6415","body":"When using the {{static_compiler}} terminus with a resource definition like the following:\r\n\r\n{code}\r\n    file { '/tmp/somedir':\r\n        ensure  => directory,\r\n        owner   => 'root',\r\n        group   => 'root',\r\n        links   => 'manage',\r\n        mode    => '0644',\r\n        recurse => true,\r\n        source  => 'puppet:///modules/mymodule/somedir/',\r\n    }\r\n{code}\r\n\r\nWhen the source directory contains a symlink, catalog application aborts because the symlink has no target:\r\n\r\n{code}\r\nError: /Stage[main]/Mymodule::Myclass/File[/tmp/somedir/foo]/ensure: change from absent to link failed: Cannot create a symlink without a target\r\n{code}\r\n\r\nI have a patch for this bug that I will send in via GitHub shortly. Unfortunately, writing an rspec test to check for this condition is beyond my grasp of Ruby.","closed_at":"2016-08-11T09:58:43.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6415","labels":"","state":"Closed","updated_at":"2016-08-11T09:58:43.000-0700","timestamp":1652285095.285719,"priority":"Normal","status_category":"Done","pull_request":5026},{"issue_id":"112835","title":"Poor error reporting when metadata.json is incorrect or incomplete","url":"https://tickets.puppetlabs.com/browse/PUP-5723","created_at":"2016-01-19T06:38:24.000-0800","number":"PUP-5723","body":"If you have a module with a misformed metadata.json file you will get the following error when doing:\r\n\r\n{code}\r\npuppet apply -e 'include aptmirror'\r\nError: Evaluation Error: Error while evaluating a Function Call, Class[Aptmirror]: expects a value for parameter 'nthreads'  at line 1:1 on node ubuntu.localdomain\r\n{code}\r\n\r\nIn this case I removed a comma from the metadata.json file. If I add a --debug I do get a debug message but it is not an error:\r\n{code}\r\nDebug: aptmirror has an invalid and unparsable metadata.json file.  The parse error: 757: unexpected token at\r\n{code}\r\n\r\nThe debug message when the metadata.json file is incomplete is also not helpful. The expectation is that I would get an error message saying that an expected paramater is missing rather then just failing.","closed_at":"2016-08-11T09:58:43.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5723","labels":"","state":"Closed","updated_at":"2016-08-11T09:58:43.000-0700","timestamp":1652285095.39364,"priority":"Minor","status_category":"Done","pull_request":5130},{"issue_id":"134180","title":"trusted facts with apache/nginx and puppetmaster unicorn","url":"https://tickets.puppetlabs.com/browse/PUP-6366","created_at":"2016-05-27T03:29:35.000-0700","number":"PUP-6366","body":"I have gunicorn running behind nginx, but want to make use of trusted facts, but that doesn't seem to work out of the box.\r\n\r\nSome debugging, I found the\r\nlib/puppet/network/http/rack/rest.rb, esp. the +ExportCertData\r\ncomment in it. This is only available in Apache, so switched to use\r\napache in front of unicorn, but still no luck.\r\n\r\nI figured that running unicorn behind apache reverse proxying, the\r\nenvironment variable is not available. Therefore I added an additionalheader that gets passed to unicorn: X-SSL-Client-Cert.\r\nHowever, that header is sent as single line from Apache to unicorn,\r\nand not as valid PEM encoded certificate. Therefore the gsub!\r\nmanipulations to restore a valid PEM certificate again. (see the attached patch)\r\n\r\nWith the attached patch, it works for Apache, just add this to the vhost configuration:\r\nRequestHeader set X-SSL-Client-Cert %{SSL_CLIENT_CERT}e\r\n\r\nWith nginx, there is a bit more trouble. Nginx has $ssl_client_cert variable aswell, but nginx passes that variable on as multi-line header. Doh!\r\nUnicorn doesn't like that at all.\r\n\r\nTherefore have to use nginx lua module, and add this:\r\n\r\n location / {\r\n\r\nset_by_lua $client_cert \"if gx.var.ssl_client_raw_cert then return ngx.var.ssl_client_raw_cert:gsub('\\\\n',' ') end\";\r\n\r\nproxy_set_header X-SSL-Client-Cert $client_cert;\r\n\r\n}\r\n\r\nSo, that patch makes trusted facts available to the puppetmaster when running\r\nwith unicorn behind apache or nginx.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","closed_at":"2016-08-11T09:58:44.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6366","labels":"","state":"Closed","updated_at":"2016-08-11T09:58:44.000-0700","timestamp":1652285095.606607,"priority":"Normal","status_category":"Done","pull_request":5170},{"issue_id":"140734","title":"Bundle install fails to find proper puppet version when source is path or vcs","url":"https://tickets.puppetlabs.com/browse/PUP-6486","created_at":"2016-07-09T08:03:20.000-0700","number":"PUP-6486","body":"When specifying the puppet gem in a gemfile with a local path source or a vcs source (such as github), the existing puppet gem's version file is loaded instead of the version file from the target.  If the version of the previously installed gem does not match the target gem version, bundler fails with an error like:\r\n\r\n{noformat}\r\nCould not find gem 'puppet (= 4.6.0)' in source at `/Users/peter.drake/workspace/puppet`.\r\nSource contains 'puppet' at: 4.5.2\r\n{noformat}\r\n","closed_at":"2016-08-11T09:58:44.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6486","labels":"","state":"Closed","updated_at":"2016-08-11T09:58:44.000-0700","timestamp":1652285095.708375,"priority":"Normal","status_category":"Done","pull_request":5105},{"issue_id":"128348","title":"Serivce SMF restart should use -s","url":"https://tickets.puppetlabs.com/browse/PUP-6233","created_at":"2016-04-26T09:37:21.000-0700","number":"PUP-6233","body":"The restartcmd in smf.rb needs to add the -s flag to make sure that service restarts are synchronous","closed_at":"2016-08-11T09:58:44.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6233","labels":"","state":"Closed","updated_at":"2016-08-11T09:58:44.000-0700","timestamp":1652285096.022428,"priority":"Normal","status_category":"Done","pull_request":5063},{"issue_id":"138139","title":"Regression: puppet help errors out if any application raises while generating help","url":"https://tickets.puppetlabs.com/browse/PUP-6425","created_at":"2016-06-21T18:00:31.000-0700","number":"PUP-6425","body":"PUP-3521 (commit [eccd3b|https://github.com/puppetlabs/puppet/commit/eccd3b427e9463277c890966978ea5bdcd7eacba] modified puppet to not swallow errors silently, but it causes a regression because the {{result}} variable is not in scope. To reproduce, modify an app in lib/puppet/application/*.rb to raise an ArgumentError in its help method, then run:\r\n\r\n{noformat}\r\nbundle exec puppet help\r\nError: undefined local variable or method `result' for #<Puppet::Interface:0x007fab1b563218>\r\n...\r\n{noformat}\r\n\r\nThe problem line is:\r\n\r\n{code:ruby}\r\n    rescue StandardError\r\n      result << [ \"! #{appname}\", \"! Subcommand unavailable due to error. Check error logs.\" ]\r\n    end\r\n{code}\r\n\r\nAlthough the reproduction steps are contrived, I ran into this problem when I had an application in a module and the application called Puppet.settings.initialize_settings twice, which causes puppet to raise an exception.","closed_at":"2016-08-11T09:58:45.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6425","labels":"","state":"Closed","updated_at":"2016-08-11T09:58:45.000-0700","timestamp":1652285096.331748,"priority":"Normal","status_category":"Done","pull_request":5045},{"issue_id":"125119","title":"verbose agent runs result data being sent to console and syslog","url":"https://tickets.puppetlabs.com/browse/PUP-6125","created_at":"2016-04-05T12:18:11.000-0700","number":"PUP-6125","body":"The documentation states\r\n\r\n{quote}\r\n* --logdest:\r\n  Where to send log messages. Choose between 'syslog' (the POSIX syslog\r\n  service), 'eventlog' (the Windows Event Log), 'console', or the path to a log\r\n  file. If debugging or verbosity is enabled, this defaults to 'console'.\r\n  Otherwise, it defaults to 'syslog' on POSIX systems and 'eventlog' on Windows.\r\n{quote}\r\n\r\n|| Flags || Syslog || Console ||\r\n| None | X | |\r\n| --logdest console | | X |\r\n| --logdest syslog | X | |\r\n| --verbose | X | X |\r\n| --verbose --logdest console | | X |\r\n| --test  | X | X |\r\n| --test --verbose | X | X |\r\n\r\nThis becomes a problem when the --test option is used. --test expands and sets --verbose which means diff output will get logged to syslog and the console.\r\n\r\nThe expected result - based on logdest's documentation - is to send output only to the console, not syslog.\r\n\r\nThis is a concern, because --test enables show-diff, which can contain secrets (such as passwords) that should not be printed. As a default, this suggests we should not log show-diff and verbose/debug output to more permanent locations such as syslog/eventlog.","closed_at":"2016-08-11T09:58:45.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6125","labels":"","state":"Closed","updated_at":"2016-08-11T09:58:45.000-0700","timestamp":1652285096.435891,"priority":"Normal","status_category":"Done","pull_request":4982},{"issue_id":"137225","title":"launchd service provider crashes if a zero-length file in the {System,}/Library/Launch{Daemon,Agent} directory exists","url":"https://tickets.puppetlabs.com/browse/PUP-6410","created_at":"2016-06-15T09:42:48.000-0700","number":"PUP-6410","body":"If a zero-length file exists in the standard locations for OS X LaunchAgent or LaunchDaemons exist, puppet will exit with an error:\r\n{code}\r\n# touch /Library/LaunchDaemons/foo\r\n# puppet resource service\r\nError: Could not run: undefined method `elements' for nil:NilClass\r\n{code}\r\n\r\nNot only does this cause {{puppet resource}} to fail, but {{puppet apply}} as well, causing failures.\r\n\r\nI discovered this by adding some logging to {{provider/service/launchd.plist}}, and saw the failure was when trying to read {{/Library/LaunchDaemons/<internal agent>.plist.puppettmp_9913}}, so it appears an interrupted puppet run left the {{.puppettmp_9913}} file, which then caused future runs to fail.\r\n\r\nPuppet 3 is not affected, so this is a regression of sorts. It appears there's an unhandled exception down in {{cfpropertylist}}:\r\n{code}\r\n$ sudo /Library/GoogleCorpSupport/bin/puppet resource --trace service\r\nError: Could not run: undefined method `elements' for nil:NilClass\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/cfpropertylist/rbREXMLParser.rb:22:in `load'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/cfpropertylist/rbCFPropertyList.rb:312:in `load_str'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/cfpropertylist/rbCFPropertyList.rb:248:in `initialize'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/util/plist.rb:83:in `new'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/util/plist.rb:83:in `new_cfpropertylist'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/util/plist.rb:62:in `parse_plist'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/util/plist.rb:39:in `read_plist_file'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/provider/service/launchd.rb:196:in `read_plist'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/provider/service/launchd.rb:138:in `block (2 levels) in make_label_to_path_map'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/provider/service/launchd.rb:137:in `each'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/provider/service/launchd.rb:137:in `block in make_label_to_path_map'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/provider/service/launchd.rb:136:in `each'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/provider/service/launchd.rb:136:in `make_label_to_path_map'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/provider/service/launchd.rb:157:in `jobsearch'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/provider/service/launchd.rb:106:in `instances'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/type.rb:1162:in `block in instances'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/type.rb:1155:in `collect'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/type.rb:1155:in `instances'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/indirector/resource/ral.rb:24:in `search'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/indirector/indirection.rb:269:in `search'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/application/resource.rb:225:in `find_or_save_resources'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/application/resource.rb:140:in `main'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/application.rb:352:in `run_command'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/application.rb:344:in `block in run'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/util.rb:540:in `exit_on_fail'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/application.rb:344:in `run'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/util/command_line.rb:128:in `run'\r\n/Library/GoogleCorpSupport/Ruby/lib/ruby/site_ruby/puppet/util/command_line.rb:72:in `execute'\r\n/Library/GoogleCorpSupport/bin/puppet:5:in `<main>'\r\n{code}","closed_at":"2016-08-11T09:58:45.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6410","labels":"","state":"Closed","updated_at":"2016-08-11T09:58:45.000-0700","timestamp":1652285096.538774,"priority":"Normal","status_category":"Done","pull_request":5022},{"issue_id":"87114","title":"Yumrepo type says uppercase values are allowed when they are not","url":"https://tickets.puppetlabs.com/browse/PUP-4809","created_at":"2015-07-01T15:32:49.000-0700","number":"PUP-4809","body":"* CentOS 7 x86_64\r\n* Puppet 4.2.0 (Installed via puppetlabs-release-pc1-el-7 repository)\r\n\r\nApply the following configuration:\r\n\r\n{code}\r\nyumrepo { 'mariadb' :\r\n  ensure   => present,\r\n  enabled  => True,\r\n  baseurl  => 'http://yum.mariadb.org/10.0/centos7-amd64',\r\n  gpgcheck => True,\r\n  gpgkey   => 'https://yum.mariadb.org/RPM-GPG-KEY-MariaDB',\r\n}\r\n{code}\r\n\r\nThis will produce the following error:\r\n\r\n{code}\r\nError: Parameter enabled failed on Yumrepo[mariadb]: Invalid value True[]{:name=>\"\"}. Valid values are absent. Valid values match /^(True|False|0|1|No|Yes)$/i.\r\n{code}\r\n\r\nApply the following configuration:\r\n\r\n{code}\r\nyumrepo { 'mariadb' :\r\n  ensure   => present,\r\n  enabled  => true,\r\n  baseurl  => 'http://yum.mariadb.org/10.0/centos7-amd64',\r\n  gpgcheck => true,\r\n  gpgkey   => 'https://yum.mariadb.org/RPM-GPG-KEY-MariaDB',\r\n}\r\n{code}\r\n\r\nThe configuration will apply successfully. \r\n\r\nThe issue here is that the error message indicates that valid values for the parameter include 'True', when it will in fact not match on 'True' (with a capital 'T').","closed_at":"2016-08-11T09:58:45.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4809","labels":"client-onboarding","state":"Closed","updated_at":"2016-08-11T09:58:45.000-0700","timestamp":1652285096.640237,"priority":"Normal","status_category":"Done","pull_request":5075},{"issue_id":"116318","title":"Interpolation in interpolation nested string does not work.","url":"https://tickets.puppetlabs.com/browse/PUP-5887","created_at":"2016-02-11T12:20:51.000-0800","number":"PUP-5887","body":"If you do this:\r\n{code}\r\nnotice \"${\"${foo}\"}\"\r\n{code}\r\nThere is a syntax error at the closing \"\r\n\r\nIf doing this (i.e. no interpolation in inner string):\r\n{code}\r\nnotice \"${ \"\\$foo\" }\"\r\n{code}\r\n\r\nThen it works.\r\n\r\nInterpolations are recursive - this looks like is a lexer bug.","closed_at":"2016-08-11T09:58:45.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5887","labels":"","state":"Closed","updated_at":"2016-08-11T09:58:45.000-0700","timestamp":1652285096.746088,"priority":"Normal","status_category":"Done","pull_request":5100},{"issue_id":"124367","title":"The instructions for cleaning a Windows node's certificate are wrong","url":"https://tickets.puppetlabs.com/browse/PUP-6115","created_at":"2016-03-31T10:53:55.000-0700","number":"PUP-6115","body":"On a windows node, if there's some problem with the node's certificate during a puppet agent run (such as a cert already existing on the master with the same name) then instructions are printed to clean the cert on the master and the agent node.\r\n\r\nThe command to delete the certificate in Windows is wrong. See the following screenshot:\r\n!windows.png|thumbnail!\r\n\r\n*The 2 problems are:*\r\n# 'certs' is missing from the path\r\n# Back slashes should be used rather than forward slashes.","closed_at":"2016-08-11T09:58:46.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6115","labels":"cspapercuts","state":"Closed","updated_at":"2016-08-11T09:58:46.000-0700","timestamp":1652285096.851931,"priority":"Normal","status_category":"Done","pull_request":5095},{"issue_id":"143799","title":"Regression: Puppet unable to load PE Trapperkeeper::Orchestrator type, breaking PE installation","url":"https://tickets.puppetlabs.com/browse/PUP-6558","created_at":"2016-07-27T11:40:05.000-0700","number":"PUP-6558","body":"* tl;dr: Puppet commit [b6b7ae4|https://github.com/puppetlabs/puppet/commit/b6b7ae4e4ef96f4a5c16de58e08f7f56a5decc90] looks to have caused a regression in resource type loading, or uncovered an issue elsewhere in the PE stack.\r\n\r\nLast night, the [monolithic smoke integration pipeline|https://jenkins-enterprise.delivery.puppetlabs.net/job/enterprise_pe-acceptance-tests_integration-system_pe_smoke-monolithic_2016.3.x/LAYOUT=64mcd,LEGACY_AGENT_VERSION=NONE,PLATFORM=redhat6,UPGRADE_FROM=NONE,label=beaker-integration-smoke/150/consoleFull] failed on basic puppet enterprise installs with the following error:\r\n\r\n{code}\r\n 2016-07-27 01:38:19,124 - [Error]: Evaluation Error: Error while evaluating a Resource Statement, Evaluation Error: Resource type not found: Puppet_enterprise::Trapperkeeper::Orchestrator\r\n  at /opt/puppetlabs/server/data/enterprise/modules/puppet_enterprise/manifests/profile/orchestrator.pp:60:15\r\n  at /opt/puppetlabs/server/data/enterprise/modules/pe_install/manifests/install.pp:70\r\n  on node v0f4grv1uu3a2dt.delivery.puppetlabs.net\r\n    * /opt/puppetlabs/puppet/bin/puppet enterprise configure  --detailed-exitcodes --modulepath /opt/puppetlabs/server/data/enterprise/modules\r\n    * returned: 1\r\n{code}\r\n\r\nThis is easily reproducible by downloading and attempting to run the installer on [this build|http://enterprise.delivery.puppetlabs.net/2016.3/ci-ready/puppet-enterprise-2016.3.0-rc1-185-g5e0d3fd-el-6-x86_64.tar] of PE 2016.3.\r\n\r\nI ran the installer on this same build with Puppet commit [b6b7ae4|https://github.com/puppetlabs/puppet/commit/b6b7ae4e4ef96f4a5c16de58e08f7f56a5decc90] reverted, and the {{Trapperkeeper::Orchestrator}} type is loaded successfully. Thus, this  auto-loading of pp-defined resource types change seems to be the issue here.","closed_at":"2016-08-11T09:58:46.000-0700","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6558","labels":"","state":"Closed","updated_at":"2016-08-11T09:58:46.000-0700","timestamp":1652285096.959521,"priority":"Blocker","status_category":"Done","pull_request":5164},{"issue_id":"117456","title":"launchd service provider doesn't implement status override.","url":"https://tickets.puppetlabs.com/browse/PUP-5926","created_at":"2016-02-19T03:29:16.000-0800","number":"PUP-5926","body":"I'm seeing some odd behaviour when trying to override the status command of a service which seems to be being ignored.\r\n\r\nAccording to the docs, setting {{hasstatus}} to {{false}} and adding a custom command to the {{status}} attribute should allow me to fine tune how Puppet tries to determine if my service is running...\r\n\r\n{quote}\r\nIf a service’s init script does not support any kind of status command, you should set hasstatus to false and either provide a specific command using the status attribute or expect that Puppet will look for the service name in the process table.\r\n{quote}\r\n\r\nand for {{status}}...\r\n\r\n{quote}\r\nSpecify a status command manually. This command must return 0 if the service is running and a nonzero value otherwise.\r\n{quote}\r\n\r\nI've boiled my problem down to the following example code\r\n\r\n{code}\r\nservice { 'fake_service':\r\n  ensure    => running,\r\n  start     => '/bin/echo start command',\r\n  status    => '/bin/true',\r\n  hasstatus => false,\r\n}\r\n{code}\r\n\r\nThe behaviour I would expect from this is that when evaluating the service, puppet will run {{ /bin/true }} to determine if the service is up, which will return 0, and then stop there since the service should always be deemed running.  However when I run the above code I see that the status command is never run and puppet insists on querying the service through systemctl....\r\n\r\n{code}\r\nDebug: Executing '/usr/bin/systemctl is-active fake_service'\r\nDebug: Executing '/bin/echo start command'\r\nNotice: /Stage[main]/Main/Service[fake_service]/ensure: ensure changed 'stopped' to 'running'\r\n{code}\r\n\r\nSo far I've seen this on Puppet 4.3.1 (MacOS) and Puppet 3.8.4 (Redhat 7.1)\r\n\r\n","closed_at":"2016-08-11T09:58:47.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5926","labels":"","state":"Closed","updated_at":"2016-08-11T09:58:47.000-0700","timestamp":1652285097.382,"priority":"Major","status_category":"Done","pull_request":4956},{"issue_id":"132621","title":"Support tdnf package provider for VMware PhotonOS","url":"https://tickets.puppetlabs.com/browse/PUP-6323","created_at":"2016-05-19T00:55:06.000-0700","number":"PUP-6323","body":"PhotonOS is a RPM derivative OS from VMware. However it does not use yum, nor the newer DNF. It uses a DNF compatible application called TDNF (https://github.com/vmware/tdnf). Some details from http://www.vcritical.com/2015/06/quickly-update-to-docker-1-6-on-photon-by-using-tdnf/\r\n\r\n{quote}\r\nTDNF is a VMware innovation that offers DNF-compatible package management without a massive Python footprint.\r\n{quote}","closed_at":"2016-08-11T09:58:48.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6323","labels":"client-onboarding","state":"Closed","updated_at":"2016-08-11T09:58:48.000-0700","timestamp":1652285097.488078,"priority":"Normal","status_category":"Done","pull_request":5070},{"issue_id":"137324","title":"Pip provider fails when using ensure => latest","url":"https://tickets.puppetlabs.com/browse/PUP-6413","created_at":"2016-06-15T15:06:27.000-0700","number":"PUP-6413","body":"Pypi changed behaviour today because of vulnerabilities in urrlib, which\r\nis used by pip.\r\n\r\nhttp://blog.blindspotsecurity.com/2016/06/advisory-http-header-injection-in.html\r\n\r\nPypi changed to denying http requests entirely instead of redirecting to\r\nhttps. (I guess? I don't really understand)\r\n\r\nWithout this patch:\r\n\r\nroot@derpderp:~# cat foo.pp\r\npackage { 'diskimage-builder':\r\nensure => latest,\r\nprovider => pip,\r\n}\r\n\r\nroot@derpderp:~# puppet apply foo.pp\r\nWarning: Setting templatedir is deprecated. See http://links.puppetlabs.com/env-settings-deprecations\r\n(at /usr/lib/ruby/vendor_ruby/puppet/settings.rb:1139:in `issue_deprecation_warning')\r\nNotice: Compiled catalog for derpderp in environment production in 0.14 seconds\r\nError: Could not get latest version: HTTP-Error: 403 Must access using HTTPS instead of HTTP\r\nError: /Stage[main]/Main/Package[diskimage-builder]/ensure: change from 1.17.0 to latest failed: Could not get latest version: HTTP-Error: 403 Must access using HTTPS instead of HTTP\r\nNotice: Finished catalog run in 0.67 seconds\r\n\r\nSo this breaks any puppet 3.x using the default pip provider.\r\n\r\nWith this patch, it just works.","closed_at":"2016-08-11T09:58:48.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6413","labels":"","state":"Closed","updated_at":"2016-08-11T09:58:48.000-0700","timestamp":1652285097.700012,"priority":"Normal","status_category":"Done","pull_request":5024},{"issue_id":"144366","title":"pe_acceptance tests fail in Non-English Windows","url":"https://tickets.puppetlabs.com/browse/PUP-6570","created_at":"2016-08-01T14:20:15.000-0700","number":"PUP-6570","body":"During the validation of MODULES-3636 it was found that some tests have hardcoded\r\nenglish-only tests e.g.\r\n\r\n{code}\r\nassert_match(/The Marionette Collective Server service was stopped successfully/, result.stdout, \"Failed to stop MCollective service\")\r\n{code}\r\nhttps://github.com/puppetlabs/pe_acceptance_tests/blob/2016.3.x/acceptance/tests/pe_checks/QA-563_windows_exit_mcollective.rb#L13\r\n\r\nhttps://github.com/puppetlabs/pe_acceptance_tests/blob/2016.3.x/acceptance/tests/pe_checks/QA-563_windows_exit_mcollective.rb#L13\r\n\r\nThis results in failures on French windows;\r\n{code}\r\n       Test Case ./acceptance/tests/pe_checks/QA-563_windows_exit_mcollective.rb reported: #<Minitest::Assertion: Failed to stop MCollective service.\r\n      Expected /The Marionette Collective Server service was stopped successfully/ to match \"Le service Marionette Collective Server s'arrte.\\nLe service Marionette Collective Server a t arrt.\\n\\n\".>\r\n          Test line: ./acceptance/tests/pe_checks/QA-563_windows_exit_mcollective.rb:13:in `block (3 levels) in run_test'\r\n{code}\r\n","closed_at":"2016-08-12T13:14:11.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6570","labels":"","state":"Closed","updated_at":"2016-08-12T13:14:11.000-0700","timestamp":1652285098.115061,"priority":"Normal","status_category":"Done","pull_request":5163},{"issue_id":"135299","title":"No title provided and \"\" is not a valid resource reference - caused by create_resources() not filtering out undefs","url":"https://tickets.puppetlabs.com/browse/PUP-6385","created_at":"2016-06-03T11:17:57.000-0700","number":"PUP-6385","body":"Since PUP-6028, catalog compilation now fails when a resource has the {{require}} or {{before}} metaparameters set to {{undef}}.\r\n\r\nThis behaviour was relied upon in the puppetlabs-postgresql module at https://github.com/puppetlabs/puppetlabs-postgresql/blob/4.7.1/manifests/server/extension.pp#L57-L58 where the value of the metaparams is worked out in the manifest and can be undef.\r\n\r\nA simple reproducer, at commit eff7ac6 or master:\r\n\r\n{code}\r\n$ bin/puppet apply -e 'notify { \"a\": require => undef }' --trace\r\nError: No title provided and \"\" is not a valid resource reference on node cobalt\r\n/home/dcleal/code/puppet/puppet/lib/puppet/resource.rb:544:in `extract_type_and_title'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/resource.rb:529:in `type_and_title'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/resource/catalog.rb:353:in `resource'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler/catalog_validator/relationship_validator.rb:33:in `block in validate_relationship'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler/catalog_validator/relationship_validator.rb:32:in `each'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler/catalog_validator/relationship_validator.rb:32:in `validate_relationship'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler/catalog_validator/relationship_validator.rb:10:in `block (2 levels) in validate'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/resource.rb:51:in `block in eachparam'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/resource.rb:50:in `each'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/resource.rb:50:in `eachparam'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler/catalog_validator/relationship_validator.rb:8:in `block in validate'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler/catalog_validator/relationship_validator.rb:6:in `each'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler/catalog_validator/relationship_validator.rb:6:in `validate'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler.rb:217:in `block in validate_catalog'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler.rb:217:in `each'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler.rb:217:in `validate_catalog'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler.rb:205:in `block (2 levels) in compile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/util/profiler.rb:51:in `profile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler.rb:204:in `block in compile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/context.rb:65:in `override'\r\n/home/dcleal/code/puppet/puppet/lib/puppet.rb:240:in `override'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler.rb:167:in `compile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler.rb:35:in `compile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/indirector/catalog/compiler.rb:265:in `block (2 levels) in compile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/util/profiler.rb:51:in `profile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/indirector/catalog/compiler.rb:263:in `block in compile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/util.rb:223:in `block in benchmark'\r\n/home/dcleal/.rvm/rubies/ruby-1.9.3-p448/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/util.rb:222:in `benchmark'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/indirector/catalog/compiler.rb:261:in `compile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/indirector/catalog/compiler.rb:53:in `find'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/indirector/indirection.rb:194:in `find'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/application/apply.rb:256:in `block in main'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/context.rb:65:in `override'\r\n/home/dcleal/code/puppet/puppet/lib/puppet.rb:240:in `override'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/application/apply.rb:225:in `main'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/application/apply.rb:170:in `run_command'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/application.rb:344:in `block in run'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/util.rb:540:in `exit_on_fail'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/application.rb:344:in `run'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/util/command_line.rb:128:in `run'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/util/command_line.rb:72:in `execute'\r\n/home/dcleal/code/puppet/puppet/bin/puppet:5:in `<main>'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/resource.rb:544:in `extract_type_and_title'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/resource.rb:529:in `type_and_title'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/resource/catalog.rb:353:in `resource'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler/catalog_validator/relationship_validator.rb:33:in `block in validate_relationship'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler/catalog_validator/relationship_validator.rb:32:in `each'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler/catalog_validator/relationship_validator.rb:32:in `validate_relationship'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler/catalog_validator/relationship_validator.rb:10:in `block (2 levels) in validate'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/resource.rb:51:in `block in eachparam'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/resource.rb:50:in `each'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/resource.rb:50:in `eachparam'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler/catalog_validator/relationship_validator.rb:8:in `block in validate'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler/catalog_validator/relationship_validator.rb:6:in `each'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler/catalog_validator/relationship_validator.rb:6:in `validate'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler.rb:217:in `block in validate_catalog'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler.rb:217:in `each'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler.rb:217:in `validate_catalog'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler.rb:205:in `block (2 levels) in compile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/util/profiler.rb:51:in `profile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler.rb:204:in `block in compile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/context.rb:65:in `override'\r\n/home/dcleal/code/puppet/puppet/lib/puppet.rb:240:in `override'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler.rb:167:in `compile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/parser/compiler.rb:35:in `compile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/indirector/catalog/compiler.rb:265:in `block (2 levels) in compile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/util/profiler.rb:51:in `profile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/indirector/catalog/compiler.rb:263:in `block in compile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/util.rb:223:in `block in benchmark'\r\n/home/dcleal/.rvm/rubies/ruby-1.9.3-p448/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/util.rb:222:in `benchmark'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/indirector/catalog/compiler.rb:261:in `compile'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/indirector/catalog/compiler.rb:53:in `find'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/indirector/indirection.rb:194:in `find'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/application/apply.rb:256:in `block in main'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/context.rb:65:in `override'\r\n/home/dcleal/code/puppet/puppet/lib/puppet.rb:240:in `override'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/application/apply.rb:225:in `main'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/application/apply.rb:170:in `run_command'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/application.rb:344:in `block in run'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/util.rb:540:in `exit_on_fail'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/application.rb:344:in `run'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/util/command_line.rb:128:in `run'\r\n/home/dcleal/code/puppet/puppet/lib/puppet/util/command_line.rb:72:in `execute'\r\n/home/dcleal/code/puppet/puppet/bin/puppet:5:in `<main>'\r\n{code}\r\n\r\nPreviously this worked (commit f14b653):\r\n\r\n{code}\r\n$ bin/puppet apply -e 'notify { \"a\": require => undef }' --trace\r\nNotice: Compiled catalog for cobalt in environment production in 0.06 seconds\r\nNotice: a\r\nNotice: /Stage[main]/Main/Notify[a]/message: defined 'message' as 'a'\r\nNotice: Applied catalog in 0.04 seconds\r\n{code}\r\n","closed_at":"2016-08-15T11:56:19.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6385","labels":"couch-ss","state":"Closed","updated_at":"2016-08-15T11:56:19.000-0700","timestamp":1652285098.434445,"priority":"Normal","status_category":"Done","pull_request":5004},{"issue_id":"22947","title":"Yum package arch and version ensuring failing","url":"https://tickets.puppetlabs.com/browse/PUP-1364","created_at":"2014-01-03T14:46:07.000-0800","number":"PUP-1364","body":"After lots of trial and error I found a bug in our current Puppet version\r\n\r\nHaving a package line like so:\r\n\r\n{noformat}\r\n package { \"firefox.x86_64\": ensure => \"3.0.12-1.el5.centos\", require => Package[\"xulrunner.x86_64\"] }\r\n{noformat}\r\n\r\nWould fail with debug output:\r\n{noformat}\r\n*_\r\ndebug: //Node[om012274.drd.int]/workstation/workstation_centos53/mozillasuite53/Package[firefox.x86_64]: Changing ensure\r\ndebug: //Node[om012274.drd.int]/workstation/workstation_centos53/mozillasuite53/Package[firefox.x86_64]: 1 change(s)\r\ndebug: Package[firefox.x86_64](provider=yum): Ensuring => 3.0.12-1.el5.centos\r\ndebug: Puppet::Type::Package::ProviderYum: Executing '/usr/bin/yum -d 0 -e 0 -y install firefox.x86_64-3.0.12-1.el5.centos'\r\ndebug: Puppet::Type::Package::ProviderYum: Executing '/bin/rpm -q firefox.x86_64 --nosignature --nodigest --qf %{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE}\r\n%{ARCH}\r\n'\r\nerr: //Node[om012274.drd.int]/workstation/workstation_centos53/mozillasuite53/Package[firefox.x86_64]/ensure: change from absent to 3.0.12-1.el5.centos failed: Could\r\n not update: Could not find package firefox.x86_64 at /etc/puppet/manifests/CentOS.pp:149_*\r\n{noformat}\r\n\r\n\r\nIt didn't matter if I listed ver-release or just ver, same sort of error; it appends the version-[release] to the package name and arch. Which obviously fails as yum packages must be referred to like so:\r\n\r\n{noformat}\r\n          name\r\n          name.arch\r\n          name-ver\r\n          name-ver-rel\r\n          name-ver-rel.arch\r\n          name-epoch:ver-rel.arch\r\n          epoch:name-ver-rel.arch\r\n{noformat}\r\n\r\nSo if I omitted the arch and changed the line to:\r\n{noformat}\r\n package { \"firefox\": ensure => \"3.0.12-1.el5.centos\", require => Package[\"xulrunner.x86_64\"] }\r\n{noformat}\r\n\r\nWe would have more success with the 64bit version but it would try and bring the 32bit Firefox version too along with its dependencies. Not what I wanted.\r\n\r\n{noformat}\r\n*_debug: Package[firefox](provider=yum): Ensuring => 3.0.12-1.el5.centos.x86_64\r\ndebug: Puppet::Type::Package::ProviderYum: Executing '/usr/bin/yum -d 0 -e 0 -y install firefox-3.0.12-1.el5.centos.x86_64'\r\ndebug: Puppet::Type::Package::ProviderYum: Executing '/bin/rpm -q firefox --nosignature --nodigest --qf %{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\r\n'\r\nerr: //Node[om012274.drd.int]/workstation/workstation_centos53/mozillasuite53/Package[firefox]/ensure: change from 3.0.12-1.el5.centos to 3.0.12-1.el5.centos.x86_64 failed: Could not update: Failed to update to version 3.0.12-1.el5.centos.x86_64, got version 3.0.12-1.el5.centos instead at /etc/puppet/manifests/CentOS.pp:149_*\r\n{noformat}\r\n\r\nSo chatting on IRC and more trial and error I found this is the only way to get it to work:\r\n{noformat}\r\n package { \"firefox-3.0.12-1.el5.centos.x86_64\": ensure => \"present\", require => Package[\"xulrunner.x86_64\"] }\r\n{noformat}\r\n\r\nSo this side-steps puppets version management though.\r\n\r\nThis may be fixed in a newer version. I haven't tried yet.\r\n\r\n\r\n\r\n","closed_at":"2016-08-15T12:02:45.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1364","labels":"customer;redmine;yum","state":"Closed","updated_at":"2016-08-15T12:02:45.000-0700","timestamp":1652285098.538883,"priority":"Normal","status_category":"Done","pull_request":4811},{"issue_id":"143581","title":"Acceptance: systemd_enabling_masked_service test failing for Fedora 23 i386","url":"https://tickets.puppetlabs.com/browse/PUP-6549","created_at":"2016-07-26T11:58:25.000-0700","number":"PUP-6549","body":"The [ticket_5024_systemd_enabling_masked_service.rb|https://github.com/puppetlabs/puppet/blob/master/acceptance/tests/resource/service/ticket_5024_systemd_enabling_masked_service.rb] test is failing in current CI runs for Fedora 23 i386.\r\n{noformat}\r\n    Test Case tests/resource/service/ticket_5024_systemd_enabling_masked_service.rb reported: #<Beaker::Host::CommandFailure: Host 'e3cajbwa1ij5zlq.delivery.puppetlabs.net' exited with 4 running:\r\n   puppet apply --verbose --detailed-exitcodes /tmp/apply_manifest.pp.27FMnl\r\n  Last 10 lines of output were:\r\n  \tNotice: Compiled catalog for e3cajbwa1ij5zlq.delivery.puppetlabs.net in environment production in 0.22 seconds\r\n  \tInfo: Applying configuration version '1469553376'\r\n  \tError: Could not start Service[httpd]: Execution of '/usr/bin/systemctl start httpd' returned 1: Job for httpd.service failed because the control process exited with error code. See \"systemctl status httpd.service\" and \"journalctl -xe\" for details.\r\n  \tError: /Stage[main]/Main/Service[httpd]/ensure: change from stopped to running failed: Could not start Service[httpd]: Execution of '/usr/bin/systemctl start httpd' returned 1: Job for httpd.service failed because the control process exited with error code. See \"systemctl status httpd.service\" and \"journalctl -xe\" for details.\r\n  \tNotice: Applied catalog in 0.18 seconds>\r\n{noformat}","closed_at":"2016-08-17T16:05:20.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6549","labels":"","state":"Resolved","updated_at":"2016-08-17T16:05:20.000-0700","timestamp":1652285099.045228,"priority":"Normal","status_category":"Done","pull_request":5146},{"issue_id":"142647","title":"create_resources() doesn't include the file or line reference in resources it creates","url":"https://tickets.puppetlabs.com/browse/PUP-6530","created_at":"2016-07-21T07:46:28.000-0700","number":"PUP-6530","body":"Given the following Puppet code:\r\n\r\n{code}\r\nclass system::hashadmins {\r\n  require mysql::server\r\n  ## Defaults\r\n  Mysql_user {\r\n    ensure               => present,\r\n    max_queries_per_hour => 700,\r\n  }\r\n  ## User Data\r\n  $users = {\r\n    'monica@localhost' => {},\r\n    'brad@localhost'   => {},\r\n    'luke@localhost'   => {},\r\n    'zack@localhost'   => {\r\n      'max_queries_per_hour' => 1300,\r\n    },\r\n    'ralph@localhost'  => {\r\n      'ensure' => 'absent',\r\n    }\r\n  }\r\n  ## Call the function\r\n  create_resources('mysql_user', $users)\r\n}\r\n{code}\r\n\r\n...the resources that are queried look like this coming out of PuppetDB:\r\n\r\n{code: json}\r\n{\r\n        \"certname\": \"gary.puppetlabs.vm\",\r\n        \"environment\": \"gary\",\r\n        \"exported\": false,\r\n        \"file\": null,\r\n        \"line\": null,\r\n        \"parameters\": {\r\n            \"ensure\": \"present\",\r\n            \"max_queries_per_hour\": 1300\r\n        },\r\n        \"resource\": \"964a8bb11e504402830b17f2818b2a848b5fe4ae\",\r\n        \"tags\": [\r\n            \"class\",\r\n            \"system::hashadmins\",\r\n            \"hashadmins\",\r\n            \"system\",\r\n            \"mysql_user\",\r\n            \"default\",\r\n            \"node\"\r\n        ],\r\n        \"title\": \"zack@localhost\",\r\n        \"type\": \"Mysql_user\"\r\n    }\r\n{code}\r\n\r\nYou'll note that the line and file keys are null.  This causes issues down the line with coverage reports like the issue that was posted here --> https://github.com/rodjek/rspec-puppet/issues/364\r\n\r\n","closed_at":"2016-08-17T16:08:17.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6530","labels":"","state":"Closed","updated_at":"2016-08-17T16:08:17.000-0700","timestamp":1652285099.250359,"priority":"Normal","status_category":"Done","pull_request":5168},{"issue_id":"147128","title":"regression: explicit undef cannot be used in create_resources","url":"https://tickets.puppetlabs.com/browse/PUP-6613","created_at":"2016-08-15T05:35:20.000-0700","number":"PUP-6613","body":"The following code works when evaluated from a manifest:\r\n{code:puppet}\r\npuppet apply -e 'define foo($foo) {} foo { \"FOO\": foo => undef }'\r\n{code}\r\n\r\nBut not when done using {{create_resources}}.\r\n\r\nThe rule puppet should use is: if {{undef}} is given then use the default value if one exists, otherwise set an explicit undef. Now the {{create_resources}} function simply filters out all {{undef}} values. (If simply kept, there are other problems since relationships cannot handle undef entries.","closed_at":"2016-08-24T08:11:22.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6613","labels":"regression","state":"Closed","updated_at":"2016-08-24T08:11:22.000-0700","timestamp":1652285100.082796,"priority":"Normal","status_category":"Done","pull_request":5200},{"issue_id":"147642","title":"Puppet file `show_diff` setting leaks information","url":"https://tickets.puppetlabs.com/browse/PUP-6627","created_at":"2016-08-17T09:54:52.000-0700","number":"PUP-6627","body":"Because the sensitive data support in the transaction doesn't propagate through all possible log points, types and providers can leak information by logging arbitrary information at arbitrary points. This is especially problematic because of the `show_diff` setting for files; files are the most common point where sensitive information may be leaked and `show_diff` bypasses this.\r\n\r\nIn the short term we should have special handling for diffing so that when a diff is potentially generated we check to see if the property being diffed is sensitive and redact it accordingly.","closed_at":"2016-08-24T08:11:22.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6627","labels":"","state":"Closed","updated_at":"2016-08-24T08:11:22.000-0700","timestamp":1652285100.186,"priority":"Normal","status_category":"Done","pull_request":5209},{"issue_id":"144804","title":"Function call fails when using camel case for class names. It should be handled by puppet parser syntax validator","url":"https://tickets.puppetlabs.com/browse/PUP-6574","created_at":"2016-08-03T01:10:27.000-0700","number":"PUP-6574","body":"As we understand from the docs that capital letters are not allowed in class and module names but then it should be handled by parser while validating the syntax.","closed_at":"2016-08-24T08:11:24.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6574","labels":"learningVM;module","state":"Closed","updated_at":"2016-08-24T08:11:24.000-0700","timestamp":1652285100.494639,"priority":"Normal","status_category":"Done","pull_request":5172},{"issue_id":"146469","title":"variable scoping change in Puppet 4.6.0","url":"https://tickets.puppetlabs.com/browse/PUP-6608","created_at":"2016-08-11T15:30:34.000-0700","number":"PUP-6608","body":"Variables defined in a class are not in scope after resource-like declaration of that class:\r\n\r\n{code}\r\n$ cat test.pp \r\nclass a($myvar = 'hello') {}\r\nclass { 'a': myvar => 'goodbye' }\r\nnotify { $a::myvar: }\r\n\r\n$ puppet --version\r\n4.5.3\r\n$ puppet apply --strict_variables test.pp \r\nNotice: Compiled catalog for kvm-01.node.vagrant.consul in environment production in 0.03 seconds\r\nNotice: goodbye\r\nNotice: /Stage[main]/Main/Notify[goodbye]/message: defined 'message' as 'goodbye'\r\nNotice: Applied catalog in 0.02 seconds\r\n\r\n$ puppet --version\r\n4.6.0\r\n$ puppet apply --strict_variables test.pp \r\nError: Evaluation Error: Unknown variable: 'a::myvar'. at /home/vagrant/test.pp:3:10 on node kvm-01.node.vagrant.consul\r\n{code}\r\n\r\nWithout strict_variables it could be very dangerous.  Note that if you add an include, it works:\r\n\r\n{code}\r\n$ cat test.pp \r\nclass a($myvar = 'hello') {}\r\nclass { 'a': myvar => 'goodbye' }\r\ninclude a\r\nnotify { $a::myvar: } \r\n\r\n$ puppet --version\r\n4.6.0\r\n$ puppet apply --strict_variables test.pp \r\nNotice: Compiled catalog for kvm-01.node.vagrant.consul in environment production in 0.09 seconds\r\nNotice: goodbye\r\nNotice: /Stage[main]/Main/Notify[goodbye]/message: defined 'message' as 'goodbye'\r\nNotice: Applied catalog in 0.02 seconds\r\n{code}","closed_at":"2016-08-24T08:33:37.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6608","labels":"regression","state":"Closed","updated_at":"2016-08-24T08:33:37.000-0700","timestamp":1652285100.598993,"priority":"Critical","status_category":"Done","pull_request":5198},{"issue_id":"147540","title":"Puppet function_loading benchmark performance degredation","url":"https://tickets.puppetlabs.com/browse/PUP-6622","created_at":"2016-08-16T13:44:23.000-0700","number":"PUP-6622","body":"On Windows 2008R2 / Ruby 2.1, commit https://github.com/puppetlabs/puppet/commit/01db61e24178a3baebbeaa1c58250fcbf447d8bc introduced a 10x performance degredation for the {{benchmark:function_loading}} micro-benchmark in the Puppet suite.  I used git bisect to identify that particular commit.\r\n\r\nh3. For {{2211c64}} (parent of {{01db61e}})\r\n\r\n{code}\r\nC:\\source\\puppet [(2211c64...) +68 ~0 -0 !]> bundle exec rake benchmark:function_loading\r\nDocument generation not available without yard. cannot load such file -- yard\r\nmkdir -p C:/Users/ADMINI~1/AppData/Local/Temp/function_loading20160816-3900-13bswjg\r\nDL is deprecated, please use Fiddle\r\n                 user     system      total        real\r\nRun 1       10.296000   2.125000  12.421000 ( 13.608853)\r\nRun 2        6.766000   1.031000   7.797000 (  8.749664)\r\nRun 3        8.078000   0.797000   8.875000 (  9.692987)\r\nRun 4        8.578000   0.891000   9.469000 ( 10.468348)\r\nRun 5        9.094000   0.844000   9.938000 ( 10.937080)\r\nRun 6        9.984000   0.844000  10.828000 ( 12.093286)\r\nRun 7       10.610000   0.844000  11.454000 ( 12.629397)\r\nRun 8       12.109000   0.843000  12.952000 ( 13.953529)\r\nRun 9       12.250000   1.032000  13.282000 ( 14.311859)\r\nRun 10      13.438000   0.828000  14.266000 ( 15.218068)\r\n> total:   101.203000  10.079000 111.282000 (121.663071)\r\n> avg:      10.120300   1.007900  11.128200 ( 12.166307)\r\n{code}\r\n\r\nh3. For {{01db61e}}\r\n\r\n{code}\r\nC:\\source\\puppet [(01db61e...) +68 ~0 -0 !]> bundle exec rake benchmark:function_loading\r\nDocument generation not available without yard. cannot load such file -- yard\r\nmkdir -p C:/Users/ADMINI~1/AppData/Local/Temp/function_loading20160816-49440-1miin4u\r\nDL is deprecated, please use Fiddle\r\n                 user     system      total        real\r\nRun 1      114.015000  14.797000 128.812000 (142.752140)\r\nRun 2      156.344000  14.547000 170.891000 (184.167353)\r\nRun 3      201.969000  13.188000 215.157000 (228.894914)\r\nRun 4      245.016000  12.828000 257.844000 (271.543842)\r\nRun 5      288.734000  13.312000 302.046000 (315.255168)\r\n{code}\r\n\r\nNOTE: The above was terminated prematurely given the obvious trend of a further decrease of performance on each run.\r\n\r\n\r\nh3. Current stable HEAD ({{13d208b2e935151c6b8cf77e8bf4ad1b45fc72c5}}) as of 8/16/2016\r\n\r\nSome corrective efforts appear to have already been taken to address this performance problem (and it's compounding effect), but the current performance of latest code is still 3x slower than it was on versions of Puppet prior to {{4.6.0}}.\r\n\r\n{code}\r\nC:\\source\\puppet [stable...origin/stable +68 ~0 -0 !]> bundle exec rake benchmark:function_loading\r\nDocument generation not available without yard. cannot load such file -- yard\r\nmkdir -p C:/Users/ADMINI~1/AppData/Local/Temp/function_loading20160816-10824-x58pt6\r\nDL is deprecated, please use Fiddle\r\n                 user     system      total        real\r\nRun 1       29.266000   5.266000  34.532000 ( 35.654881)\r\nRun 2       24.453000   3.969000  28.422000 ( 29.694252)\r\nRun 3       25.563000   3.890000  29.453000 ( 30.420901)\r\nRun 4       26.453000   3.797000  30.250000 ( 31.485412)\r\nRun 5       27.219000   3.563000  30.782000 ( 31.846841)\r\nRun 6       30.390000   3.328000  33.718000 ( 34.311228)\r\nRun 7       29.047000   4.000000  33.047000 ( 33.956486)\r\nRun 8       28.938000   4.219000  33.157000 ( 34.445907)\r\nRun 9       36.890000   3.828000  40.718000 ( 42.357819)\r\nRun 10      59.438000   3.484000  62.922000 ( 64.077050)\r\n> total:   317.657000  39.344000 357.001000 (368.250777)\r\n> avg:      31.765700   3.934400  35.700100 ( 36.825078)\r\n{code}\r\n\r\nh3. Current master HEAD ({{50a20b2}} as of 8/16/2016\r\n\r\nMaster is also exhibiting the slow-down\r\n\r\n{code}\r\n:\\source\\puppet [master...origin/master +68 ~0 -0 !]> bundle exec rake benchmark:function_loading\r\nDocument generation not available without yard. cannot load such file -- yard\r\nmkdir -p C:/Users/ADMINI~1/AppData/Local/Temp/function_loading20160816-26064-1n6bwhd\r\nDL is deprecated, please use Fiddle\r\n                 user     system      total        real\r\nRun 1       29.563000   4.938000  34.501000 ( 35.829908)\r\nRun 2       24.343000   3.890000  28.233000 ( 29.436511)\r\nRun 3       25.782000   3.860000  29.642000 ( 30.963654)\r\nRun 4       25.609000   4.109000  29.718000 ( 30.983185)\r\nRun 5       26.328000   3.703000  30.031000 ( 31.282978)\r\nRun 6       28.610000   3.875000  32.485000 ( 33.677326)\r\nRun 7       26.296000   3.797000  30.093000 ( 31.264224)\r\nRun 8       28.157000   3.812000  31.969000 ( 33.066140)\r\nRun 9       53.203000   3.547000  56.750000 ( 58.190413)\r\nRun 10      53.531000   4.188000  57.719000 ( 58.727435)\r\n> total:   321.422000  39.719000 361.141000 (373.421774)\r\n> avg:      32.142200   3.971900  36.114100 ( 37.342177)\r\n{code}","closed_at":"2016-08-24T08:37:10.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6622","labels":"regression","state":"Closed","updated_at":"2016-08-24T08:37:10.000-0700","timestamp":1652285100.702946,"priority":"Normal","status_category":"Done","pull_request":5205},{"issue_id":"147050","title":"Corrective Change in Puppet 4.6.0 incorrectly errors when custom types are incompatible with it","url":"https://tickets.puppetlabs.com/browse/PUP-6621","created_at":"2016-08-13T10:31:06.000-0700","number":"PUP-6621","body":"Puppet Agent 1.6.0 appears to break some of the cisco module functionality.  The results of the last test run show 15 of the 157  tests cases errored out with a \"Could not evaluate\" failure.\r\n\r\nEmail from Mike at Cisco\r\n{quote}\r\nHi Folks,\r\n\r\nWe actually discovered a problem with the new 1.6.0 rpm :(.  We have a few manifests that fail during application.  Here is an example.\r\n\r\nI tested this in the native bash shell\r\n\r\nroot@n9k-108#puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for n9k-108.cisco.com\r\nInfo: Applying configuration version '1471100275'\r\nNotice: /Stage[main]/Main/Node[default]/Cisco_tacacs_server[default]/ensure: created\r\nNotice: /Stage[main]/Main/Node[default]/Cisco_tacacs_server_host[1.1.1.1]/ensure: created\r\nNotice: /Stage[main]/Main/Node[default]/Cisco_aaa_group_tacacs[group1]/ensure: created\r\nError: Unknown failure comparing values [[\"group1\"]] and [] using insync? on type: Cisco_aaa_authorization_login_exec_svc[test_exec] property: groups\r\nError: /Stage[main]/Main/Node[default]/Cisco_aaa_authorization_login_exec_svc[test_exec]: Could not evaluate: Validate method failed for class groups: undefined method `split' for [\"group1\"]:Array\r\nInfo: Node[default]: Unscheduling all events on Node[default]\r\nNotice: Applied catalog in 4.76 seconds\r\nroot@n9k-108#\r\n\r\nIf I use version 1.5.3 I don’t see the issue.\r\n\r\nHere is a full traceback of the issue:\r\n\r\nroot@n9k-108#puppet agent -t --trace\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for n9k-108.cisco.com\r\nInfo: Applying configuration version '1471100518'\r\nNotice: /Stage[main]/Main/Node[default]/Cisco_tacacs_server[default]/ensure: created\r\nNotice: /Stage[main]/Main/Node[default]/Cisco_tacacs_server_host[1.1.1.1]/ensure: created\r\nNotice: /Stage[main]/Main/Node[default]/Cisco_aaa_group_tacacs[group1]/ensure: created\r\nError: Unknown failure comparing values [[\"group1\"]] and [] using insync? on type: Cisco_aaa_authorization_login_exec_svc[test_exec] property: groups\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/vendor/rgen/lib/rgen/array_extensions.rb:25:in `method_missing'\r\n/opt/puppetlabs/puppet/cache/lib/puppet/type/cisco_aaa_authorization_login_exec_svc.rb:77:in `block (3 levels) in <top (required)>'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parameter.rb:452:in `validate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/property.rb:562:in `block in should='\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/property.rb:562:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/property.rb:562:in `should='\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/property.rb:385:in `insync_values?'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/event.rb:112:in `calculate_corrective_change'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:161:in `sync_if_needed'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:88:in `block in perform_changes'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:87:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:87:in `perform_changes'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:21:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:224:in `apply'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:240:in `eval_resource'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:163:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:163:in `block (2 levels) in evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:386:in `block in thinmark'\r\n/opt/puppetlabs/puppet/lib/ruby/2.1.0/benchmark.rb:294:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:385:in `thinmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:163:in `block in evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:118:in `traverse'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:154:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:222:in `block in apply'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:155:in `with_destination'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/report.rb:137:in `as_logging_destination'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:221:in `apply'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:171:in `block in apply_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:223:in `block in benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/2.1.0/benchmark.rb:294:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:222:in `benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:170:in `apply_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:343:in `run_internal'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:221:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:240:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:195:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:45:in `block (4 levels) in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent/locker.rb:21:in `lock'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:45:in `block (3 levels) in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:98:in `with_client'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:42:in `block (2 levels) in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:65:in `run_in_fork'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:41:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:179:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:179:in `controlled_run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:39:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:353:in `onetime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:331:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:540:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:132:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\nError: /Stage[main]/Main/Node[default]/Cisco_aaa_authorization_login_exec_svc[test_exec]: Could not evaluate: Validate method failed for class groups: undefined method `split' for [\"group1\"]:Array\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/vendor/rgen/lib/rgen/array_extensions.rb:25:in `method_missing'\r\n/opt/puppetlabs/puppet/cache/lib/puppet/type/cisco_aaa_authorization_login_exec_svc.rb:77:in `block (3 levels) in <top (required)>'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parameter.rb:452:in `validate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/property.rb:562:in `block in should='\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/property.rb:562:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/property.rb:562:in `should='\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/property.rb:396:in `insync_values?'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/event.rb:112:in `calculate_corrective_change'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:161:in `sync_if_needed'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:88:in `block in perform_changes'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:87:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:87:in `perform_changes'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:21:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:224:in `apply'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:240:in `eval_resource'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:163:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:163:in `block (2 levels) in evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:386:in `block in thinmark'\r\n/opt/puppetlabs/puppet/lib/ruby/2.1.0/benchmark.rb:294:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:385:in `thinmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:163:in `block in evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:118:in `traverse'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:154:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:222:in `block in apply'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:155:in `with_destination'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/report.rb:137:in `as_logging_destination'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:221:in `apply'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:171:in `block in apply_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:223:in `block in benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/2.1.0/benchmark.rb:294:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:222:in `benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:170:in `apply_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:343:in `run_internal'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:221:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:240:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:195:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:45:in `block (4 levels) in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent/locker.rb:21:in `lock'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:45:in `block (3 levels) in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:98:in `with_client'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:42:in `block (2 levels) in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:65:in `run_in_fork'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:41:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:179:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:179:in `controlled_run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:39:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:353:in `onetime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:331:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:540:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:132:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\nInfo: Node[default]: Unscheduling all events on Node[default]\r\nNotice: Applied catalog in 4.84 seconds\r\nroot@n9k-108#\r\n{quote}\r\n\r\nI'm seeing the same error in the Cisco Module CI pipeline. ","closed_at":"2016-09-02T07:11:56.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6621","labels":"regression","state":"Closed","updated_at":"2016-09-02T07:11:56.000-0700","timestamp":1652285101.341913,"priority":"Major","status_category":"Done","pull_request":5203},{"issue_id":"121207","title":"type mismatch error involving struct member should quote member name","url":"https://tickets.puppetlabs.com/browse/PUP-6053","created_at":"2016-03-13T16:42:15.000-0700","number":"PUP-6053","body":"With this function definitinon:\r\n{code:ruby}\r\n      local_types do\r\n        type 'Radix       = Variant[Default, Integer[2,2], Integer[8,8], Integer[10,10], Integer[16,16]]'\r\n        type 'Convertible = Variant[Undef, Integer, Float, Boolean, String]'\r\n        type 'NamedArgs   = Struct[{from => Convertible, Optional[radix] => Radix}]'\r\n      end\r\n\r\n      dispatch :from_named_args do\r\n        param          'Convertible',  :from\r\n        optional_param 'Radix',   :radix\r\n      end\r\n\r\n      dispatch :from_hash do\r\n        param          'NamedArgs',  :hash_args\r\n      end\r\n{code}\r\nAnd calling it with:\r\n{code:puppet}\r\nthe_function({from => 10, radix => 3})\r\n{code}\r\nThe error message is:\r\n{code}\r\nrejected: parameter 'hash_args' struct member radix expects a value of type...\r\n{code}\r\nI expected the member name to be quoted like this:\r\n{code}\r\nrejected: parameter 'hash_args' struct member 'radix' expects a value of type...\r\n{code}\r\n\r\nIn this case it was readable without the quotes, but not when the struct  member name is\r\nsomething like 'or',  'and', 'struct', 'expects', or 'not rejected' :-)\r\n\r\nACCEPTANCE CRITERIA\r\n----\r\n* That the following example quotes the name {{'always'}}\r\n{code:puppet}\r\npuppet apply -e 'function example(Struct[{always => Integer[100]}] $x) { }; example({always =>3})'\r\n{code}\r\n","closed_at":"2016-09-02T15:14:53.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6053","labels":"","state":"Closed","updated_at":"2016-09-02T15:14:53.000-0700","timestamp":1652285101.960007,"priority":"Normal","status_category":"Done","pull_request":4813},{"issue_id":"130546","title":"Cannot call type() function using postfix notation e.g 1.type() ","url":"https://tickets.puppetlabs.com/browse/PUP-6279","created_at":"2016-05-09T09:24:15.000-0700","number":"PUP-6279","body":"It does not work to call the {{type}} function using postfix /method call syntax.\r\n{code:puppet}\r\nnotice(1.type())\r\n{code}\r\nFails with a syntax error on 'type'.\r\n\r\nIt does however work when calling it as a function:\r\n{code:puppet}\r\nnotice(type(1))\r\n{code}\r\n ","closed_at":"2016-09-02T15:15:14.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6279","labels":"","state":"Closed","updated_at":"2016-09-02T15:15:14.000-0700","timestamp":1652285102.172865,"priority":"Normal","status_category":"Done","pull_request":5000},{"issue_id":"134104","title":"Validate and error if a class or define is given a name starting with ::","url":"https://tickets.puppetlabs.com/browse/PUP-6361","created_at":"2016-05-26T12:54:44.000-0700","number":"PUP-6361","body":"Update\r\n----\r\nIt is not allowed to use a a leading {{::}} (making a name absolute) when defining a class or a user defined resource type.\r\nNested definitions are named with a leading namespace from its container. It is not allowed to break out of that naming convention, and it is meaningless to use {{::}} before top level definitions.\r\n\r\nGiven that it also does not work to use definitions named with a leading {{::}} there is no backwards compatibility issue - only that error comes at compile time instead of when trying to use such a definition.\r\n\r\nOriginal\r\n----\r\nIf you create a class with a name that includes two colons, it appears (as it is difficult to ascertain) to generate a class with an illegal fully qualified name. You can then no longer reference the class because it is an illegal fully qualified name.\r\n\r\n{code}\r\n$ bundle exec puppet apply -e 'class ::passwd {} include passwd'\r\nError: Evaluation Error: Error while evaluating a Function Call, Could not find class ::passwd for build03.nelson.va  at line 1:19 on node build03.nelson.va\r\n\r\n$ bundle exec puppet apply -e 'class ::passwd {} include ::passwd'\r\nError: Evaluation Error: Error while evaluating a Function Call, Could not find class ::passwd for build03.nelson.va  at line 1:19 on node build03.nelson.va\r\n\r\n$ bundle exec puppet apply -e 'class ::passwd {} include ::::passwd'\r\nError: Could not parse for environment production: Illegal fully qualified name  at line 1:29 on node build03.nelson.va\r\n\r\n$ bundle exec puppet apply -e 'class passwd {} include passwd'\r\nNotice: Compiled catalog for build03.nelson.va in environment production in 0.05 seconds\r\nNotice: Applied catalog in 0.01 seconds\r\n\r\n$ bundle exec puppet apply -e 'class passwd {} include ::passwd'\r\nNotice: Compiled catalog for build03.nelson.va in environment production in 0.05 seconds\r\nNotice: Applied catalog in 0.01 seconds\r\n\r\n$ bundle exec puppet --version\r\n4.5.0\r\n{code}\r\n\r\nI feel that attempting to define a class in a way that generates an illegal fully qualified name should generate an error during the definition, rather than during attempts to use it. This would be more clear to authors, earlier in their development process.","closed_at":"2016-09-02T15:15:24.000-0700","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6361","labels":"","state":"Closed","updated_at":"2016-09-02T15:15:24.000-0700","timestamp":1652285102.28037,"priority":"Normal","status_category":"Done","pull_request":5066},{"issue_id":"148867","title":"Function dispatch taking zero arguments is incorrectly chosen","url":"https://tickets.puppetlabs.com/browse/PUP-6647","created_at":"2016-08-24T00:55:36.000-0700","number":"PUP-6647","body":"A Puppet function that is written in Ruby and has a dispatch that takes zero arguments will get a parameter tuple with no contents and no size. This means that the tuple is assignable from all other tuples which in turn means that the dispatch is chosen, no matter what actual parameters that was passed in the call.","closed_at":"2016-09-06T11:16:23.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6647","labels":"","state":"Closed","updated_at":"2016-09-06T11:16:23.000-0700","timestamp":1652285102.383945,"priority":"Normal","status_category":"Done","pull_request":5229},{"issue_id":"148939","title":"hiera_include doesn't work when using environment catalogs and environment caching","url":"https://tickets.puppetlabs.com/browse/PUP-6650","created_at":"2016-08-24T11:09:44.000-0700","number":"PUP-6650","body":"To address PUP-6527, the environment compiler pre-defines a non-functional version of hiera_include at the start of compilation. This causes the \"real\" version, which will fail if used during environment compilation, to never be loaded. However, now that loaders are cached between compilations, there are a couple of serious issues with this behavior:\r\n\r\n• Environment catalog requests will fail if hiera_include is already present in the loader\r\n\r\nFor subsequent environment catalog requests, hiera_include has already either been loaded (if the previous request was for an agent catalog using hiera_include) in the loader or has been pre-loaded as a stub. Our attempt to explicitly define it causes a hard error, because it's a redefinition. This happens whether hiera_include is being used or not; _multiple environment catalog requests will always fail if environment caching is enabled_.\r\n\r\n• hiera_include is non-functional during agent catalog requests following an environment catalog request\r\n\r\nIf the first request for a given process is for an environment catalog, a noop version of hiera_include is created. It will then persist through the lifetime of the environment cache, causing hiera_include in agent catalogs to do nothing. This happens with {{puppet job run}}, for instance.\r\n\r\nThe breaking change was [introduced in 4.6.1 in commit 95ff24739ce85c3b7ca5ca1bffee9247c0cc2c5e|https://github.com/puppetlabs/puppet/commit/95ff24739ce85c3b7ca5ca1bffee9247c0cc2c5e].","closed_at":"2016-09-07T13:20:08.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6650","labels":"regression","state":"Closed","updated_at":"2016-09-07T13:20:08.000-0700","timestamp":1652285102.956688,"priority":"Blocker","status_category":"Done","pull_request":5232},{"issue_id":"149711","title":"Sensitive values are not passed to 3.x user defined types and classes","url":"https://tickets.puppetlabs.com/browse/PUP-6662","created_at":"2016-08-30T06:33:05.000-0700","number":"PUP-6662","body":"When applying this:\r\n{code:puppet}\r\nclass toe(Sensitive[String] $x) {\r\n  notice $x\r\n}\r\nclass { toe: x => Sensitive('ouch') }\r\n{code}\r\nIt results in the error:\r\n{code}\r\nError while evaluating a Resource Statement, Class[Toe]: parameter 'x' expects a Sensitive value, got String at /Users/henrik/git/puppet/sensitive.pp:4:1\r\n{code}\r\nThis is probably because of the transformation to 3.x values that only allows certain data types to pass into the 3.x compiler logic.","closed_at":"2016-09-07T13:21:15.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6662","labels":"","state":"Closed","updated_at":"2016-09-07T13:21:15.000-0700","timestamp":1652285103.058828,"priority":"Critical","status_category":"Done","pull_request":5248},{"issue_id":"148235","title":"Integration test for Windows service fails on Windows 10","url":"https://tickets.puppetlabs.com/browse/PUP-6641","created_at":"2016-08-19T14:06:13.000-0700","number":"PUP-6641","body":"./spec/integration/provider/service/windows_spec.rb:33 uses the lmhosts service to test whether the service is enabled.\r\n\r\nHowever in Windows 10 the service startup type of lmhosts has changed to Manual (Trigger Start).  This means the test will fail because it expects the service to be of type Automatic.  This changed from Windows 8 to Windows 10.\r\n\r\nUnsure on the status for Windows Server.  I also believe that lmhosts will not be available on Nano Server (Could be wrong on that).\r\n\r\nThis test should be changed to not depend on the lmhosts having a startup type of Automatic.","closed_at":"2016-09-12T15:01:58.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6641","labels":"","state":"Resolved","updated_at":"2016-09-12T15:01:58.000-0700","timestamp":1652285103.583045,"priority":"Normal","status_category":"Done","pull_request":5267},{"issue_id":"11657","title":"Using the ENC with multiple environments can load classes that can't be reloaded during a reparse of manifests","url":"https://tickets.puppetlabs.com/browse/PUP-142","created_at":"2013-07-02T19:22:30.000-0700","number":"PUP-142","body":"The ENC can specify a list of classes to load that may not be reachable if manifests are reparsed. If a manifest reparse is triggered (either through switching environments or because of a file change) any classes specified only by the ENC may be lost.\n\nWhen the catalog is being compiled, classes that are explicitly passed by an ENC are parsed first. Each class is explicitly loaded by name.\n\nDuring compilation all classes and related information is loaded into a TypeCollection instance. A number of circumstances can cause all of this to be dumped and reloaded. The code assumes that this is safe because after the information is dumped then an initial parse is triggered, starting with Puppet[:manifest]. When the ENC doesn’t supply an explicit list of classes then parsing the default manifest will find all manifests that can be reached.\n\nSince classes specified by the ENC are loaded by name, the assumption that all classes can by reached by parsing Puppet[:manifest] fails. If a reload is triggered then any classes explicitly loaded by the ENC will be permanently lost.\n\nThis is a copy of https://projects.puppetlabs.com/issues/21561","closed_at":"2016-09-13T11:30:18.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-142","labels":"","state":"Closed","updated_at":"2016-09-13T11:30:18.000-0700","timestamp":1652285103.888174,"priority":"Major","status_category":"Done","pull_request":3252},{"issue_id":"11659","title":"Canonized type names and resource titles can only be looked up by creating a Puppet::Resource","url":"https://tickets.puppetlabs.com/browse/PUP-144","created_at":"2013-07-02T19:28:19.000-0700","number":"PUP-144","body":"When creating a new Puppet::Resource instance, the new object canonizes a number of values like the type and title for a given resource. Moreover the Puppet::Resource is the only class that can create these canonized values. This means that in a number of places we are forced to create a new Puppet resource with all the work that entails just to grab a single value and throw away everything else for the garbage collector.\n\nIn order to get a canonized type name, a new Puppet::Resource has to be created just to extract the canonized type, and that Puppet::Resource is then thrown away:\n\n  * https://github.com/puppetlabs/puppet/blob/3.2.2/lib/puppet/parser/ast/resource_defaults.rb#L15\n\n  * https://github.com/puppetlabs/puppet/blob/3.2.2/lib/puppet/parser/collector.rb#L77\n\n  * https://github.com/puppetlabs/puppet/blob/3.2.2/lib/puppet/transaction/report.rb#L339\n\nThe same problem occurs when trying to generate a resource reference.\n\nWhen the catalog needs to look up a resource by title, it has to create a new resource to determine the resource reference that’s being used to index the actual resource. The Puppet::Resource itself has a method to look up an identical resource in the catalog.\n\nThis is tangentially related to #15106 because Puppet::Resource::Catalog#resource generates a new resource every time that method is invoked, and inspecting the resource triggers #15106 in certain conditions.","closed_at":"2016-09-13T11:33:05.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-144","labels":"","state":"Closed","updated_at":"2016-09-13T11:33:05.000-0700","timestamp":1652285103.988614,"priority":"Major","status_category":"Done","pull_request":2267},{"issue_id":"140719","title":"\"puppet resource user\", when run in Windows creates a login attempt. ","url":"https://tickets.puppetlabs.com/browse/PUP-6483","created_at":"2016-07-08T15:39:40.000-0700","number":"PUP-6483","body":"When running \"puppet resource user\" in Windows, the action results in a log entry in the Windows security log:\r\n\r\nLog Name:      Security\r\nSource:        Microsoft-Windows-Security-Auditing\r\nDate:          7/8/2016 10:26:11 PM\r\nEvent ID:      4625\r\nTask Category: Logon\r\nLevel:         Information\r\nKeywords:      Audit Failure\r\nUser:          N/A\r\nComputer:      pe-201612-agent-win2008\r\nDescription:\r\nAn account failed to log on.\r\n\r\nSubject:\r\n\tSecurity ID:\t\tPE-201612-AGENT\\vagrant\r\n\tAccount Name:\t\tvagrant\r\n\tAccount Domain:\t\tPE-201612-AGENT\r\n\tLogon ID:\t\t0xf07a\r\n\r\nLogon Type:\t\t\t3\r\n\r\nAccount For Which Logon Failed:\r\n\tSecurity ID:\t\tNULL SID\r\n\tAccount Name:\t\tvagrant\r\n\tAccount Domain:\t\tPE-201612-AGENT\r\n\r\nFailure Information:\r\n\tFailure Reason:\t\tUnknown user name or bad password.\r\n\tStatus:\t\t\t0xc000006d\r\n\tSub Status:\t\t0xc000006a\r\n\r\nProcess Information:\r\n\tCaller Process ID:\t0x538\r\n\tCaller Process Name:\tC:\\Program Files\\Puppet Labs\\Puppet\\sys\\ruby\\bin\\ruby.exe\r\n\r\nNetwork Information:\r\n\tWorkstation Name:\tPE-201612-AGENT\r\n\tSource Network Address:\t-\r\n\tSource Port:\t\t-\r\n\r\nDetailed Authentication Information:\r\n\tLogon Process:\t\tAdvapi  \r\n\tAuthentication Package:\tNegotiate\r\n\tTransited Services:\t-\r\n\tPackage Name (NTLM only):\t-\r\n\tKey Length:\t\t0\r\n\r\nThis event is generated when a logon request fails. It is generated on the computer where access was attempted.\r\n\r\nThe Subject fields indicate the account on the local system which requested the logon. This is most commonly a service such as the Server service, or a local process such as Winlogon.exe or Services.exe.\r\n\r\nThe Logon Type field indicates the kind of logon that was requested. The most common types are 2 (interactive) and 3 (network).\r\n\r\nThe Process Information fields indicate which account and process on the system requested the logon.\r\n\r\nThe Network Information fields indicate where a remote logon request originated. Workstation name is not always available and may be left blank in some cases.\r\n\r\nThe authentication information fields provide detailed information about this specific logon request.\r\n\t- Transited services indicate which intermediate services have participated in this logon request.\r\n\t- Package name indicates which sub-protocol was used among the NTLM protocols.\r\n\t- Key length indicates the length of the generated session key. This will be 0 if no session key was requested.\r\nEvent Xml:\r\n<Event xmlns=\"http://schemas.microsoft.com/win/2004/08/events/event\">\r\n  <System>\r\n    <Provider Name=\"Microsoft-Windows-Security-Auditing\" Guid=\"{54849625-5478-4994-A5BA-3E3B0328C30D}\" />\r\n    <EventID>4625</EventID>\r\n    <Version>0</Version>\r\n    <Level>0</Level>\r\n    <Task>12544</Task>\r\n    <Opcode>0</Opcode>\r\n    <Keywords>0x8010000000000000</Keywords>\r\n    <TimeCreated SystemTime=\"2016-07-08T22:26:11.765645000Z\" />\r\n    <EventRecordID>1682</EventRecordID>\r\n    <Correlation />\r\n    <Execution ProcessID=\"468\" ThreadID=\"532\" />\r\n    <Channel>Security</Channel>\r\n    <Computer>pe-201612-agent-win2008</Computer>\r\n    <Security />\r\n  </System>\r\n  <EventData>\r\n    <Data Name=\"SubjectUserSid\">S-1-5-21-1860036329-3057280495-287023118-500</Data>\r\n    <Data Name=\"SubjectUserName\">vagrant</Data>\r\n    <Data Name=\"SubjectDomainName\">PE-201612-AGENT</Data>\r\n    <Data Name=\"SubjectLogonId\">0xf07a</Data>\r\n    <Data Name=\"TargetUserSid\">S-1-0-0</Data>\r\n    <Data Name=\"TargetUserName\">vagrant</Data>\r\n    <Data Name=\"TargetDomainName\">PE-201612-AGENT</Data>\r\n    <Data Name=\"Status\">0xc000006d</Data>\r\n    <Data Name=\"FailureReason\">%%2313</Data>\r\n    <Data Name=\"SubStatus\">0xc000006a</Data>\r\n    <Data Name=\"LogonType\">3</Data>\r\n    <Data Name=\"LogonProcessName\">Advapi  </Data>\r\n    <Data Name=\"AuthenticationPackageName\">Negotiate</Data>\r\n    <Data Name=\"WorkstationName\">PE-201612-AGENT</Data>\r\n    <Data Name=\"TransmittedServices\">-</Data>\r\n    <Data Name=\"LmPackageName\">-</Data>\r\n    <Data Name=\"KeyLength\">0</Data>\r\n    <Data Name=\"ProcessId\">0x538</Data>\r\n    <Data Name=\"ProcessName\">C:\\Program Files\\Puppet Labs\\Puppet\\sys\\ruby\\bin\\ruby.exe</Data>\r\n    <Data Name=\"IpAddress\">-</Data>\r\n    <Data Name=\"IpPort\">-</Data>\r\n  </EventData>\r\n</Event>\r\n\r\nThis can result in inadvertent user lockouts.","closed_at":"2016-09-20T23:11:11.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6483","labels":"customer-escalation","state":"Closed","updated_at":"2016-09-20T23:11:11.000-0700","timestamp":1652285104.517617,"priority":"Normal","status_category":"Done","pull_request":5103},{"issue_id":"151938","title":"Minor improvement to agent failover test (originally PUP-6383)","url":"https://tickets.puppetlabs.com/browse/PUP-6703","created_at":"2016-09-14T16:11:15.000-0700","number":"PUP-6703","body":"On 9/14 we had a failed cell (spurious failure) in the matrix run for test {{acceptance/tests/reports/failover_master.rb}} due to a timeout sending the report to the master for the test 'master_field should not appear when no master could be contacted'. \r\n\r\nThat test currently uses two nonexistent servers in a server list and specifies a timeout of 3 seconds, and checks that the master does not show up in the report for the value `master_used`. \r\n\r\nThis ticket is to update that test to increase the timeout, but only check with one nonexistent master as a way to diminish the impact on overall test time of increasing the timeout. The fact that two masters are specified isn't actually intrinsic to the test. ","closed_at":"2016-09-21T11:27:52.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6703","labels":"ci","state":"Resolved","updated_at":"2016-09-21T11:27:52.000-0700","timestamp":1652285104.619502,"priority":"Normal","status_category":"Done","pull_request":5280},{"issue_id":"22949","title":"yum provider doesn't respect items provided by a package, only the package name","url":"https://tickets.puppetlabs.com/browse/PUP-1366","created_at":"2014-01-03T14:48:31.000-0800","number":"PUP-1366","body":"A simple use case:\r\n\r\nIn EL5 and earlier, the curl development headers were included in a package called curl-devel.  In EL6 and later that package was renamed to libcurl-devel.  However, the libcurl-devel package still provides curl-devel.  \r\n\r\nWhen using something like \r\n\r\n    package { \"curl-devel\":\r\n      ensure => installed\r\n    }\r\n\r\npuppet looks for this package every time. \r\n\r\n    [root@centos6-32 ~]# puppet resource package libcurl-devel\r\n    warning: Package kernel found in both yum and yum; skipping the yum version\r\n    warning: Package gpg-pubkey found in both yum and yum; skipping the yum version\r\n    package { 'libcurl-devel':\r\n      ensure => '7.19.7-26.el6_1.2',\r\n    }\r\n    [root@centos6-32 ~]# puppet resource package curl-devel\r\n    warning: Package kernel found in both yum and yum; skipping the yum version\r\n    warning: Package gpg-pubkey found in both yum and yum; skipping the yum version\r\n    package { 'curl-devel':\r\n        ensure => 'absent',\r\n    }\r\n    [root@centos6-32 ~]# rpm -q --whatprovides curl-devel\r\n    libcurl-devel-7.19.7-26.el6_1.2.i686\r\n    [root@centos6-32 ~]# \r\n\r\nThe yum provider should basically use the way yum work to make this happen.  If I do \"yum install curl-devel\" on EL6, it pulls in libcurl-devel.  If I then do an rpm -q --whatprovides curl-devel it shows that libcurl-devel provides that, and thus something does not need to be installed.  \r\n\r\nFixing this would likely have the side-benefit of being able to use the file installation methods on yum as well.  Such as\r\n    yum install /usr/bin/foo\r\n\r\nPuppet would be like\r\n  package { \"/usr/bin/foo\": \r\n     ensure => installed,\r\n  }\r\n\r\nThat would then install whatever package contains the file /usr/bin/foo, as yum from the CLI does.  \r\n\r\n","closed_at":"2016-09-22T15:17:31.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1366","labels":"redmine;yum","state":"Closed","updated_at":"2016-09-22T15:17:31.000-0700","timestamp":1652285118.768316,"priority":"Normal","status_category":"Done","pull_request":2364},{"issue_id":"108831","title":"No error on duplicate parameters on classes and resources","url":"https://tickets.puppetlabs.com/browse/PUP-5590","created_at":"2015-12-09T07:38:04.000-0800","number":"PUP-5590","body":"I think that the following is a bug:\r\n\r\n{code:java}\r\nclass test (\r\n  $a = 'first',\r\n  $a = 'second',\r\n) {\r\n  notice($a)\r\n}\r\n\r\ninclude test\r\n{code}\r\n\r\nresults in:\r\n\r\n{code:java}\r\nNotice: Scope(Class[Test]): second\r\n{code}\r\n\r\nIf two parameters with the same name are added to a class or resource an error should be thrown in my opinion. This would also solve the problem, that this looks like it violates the no reassignment rule.","closed_at":"2016-09-26T05:26:18.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5590","labels":"puppethack","state":"Closed","updated_at":"2016-09-26T05:26:18.000-0700","timestamp":1652285119.273977,"priority":"Normal","status_category":"Done","pull_request":4497},{"issue_id":"147927","title":"Puppet's fileserver seems to be unable to handle a path containing a directory called \"environment\"","url":"https://tickets.puppetlabs.com/browse/PUP-6636","created_at":"2016-08-18T09:42:25.000-0700","number":"PUP-6636","body":"I have the following in one of my manifest files (using the logstash module provided by elasticsearch):\r\n{code}  logstash::configfile { 'environment_filters':\r\n    source => \"puppet:///modules/zedcore/logstash/filters/environment/${::environment}.conf\",\r\n    order  => 500,\r\n  }{code}\r\nThis boils down to a request for {{puppet:///modules/zedcore/logstash/filters/environment/${::environment}.conf}} from the fileserver.\r\n\r\nI was trying to apply this manifest in my environment \"dev_chrisb\", which I do have checked out to {{/etc/puppetlabs/code/environments/dev_chrisb}}. However, despite the file existing in the location {{modules/zedcore/files/logstash/filters/environment/dev_chrisb.conf}}, I am getting an error from the puppet agent:\r\n\r\n{code}Error: /Stage[main]/Logstash::Config/File_concat[ls-config]: Failed to generate additional resources using 'eval_generate': Could not retrieve source(s) puppet:///modules/zedcore/logstash/filters/environment/dev_chrisb.conf{code}\r\n\r\nOn the puppet server the following is logged:\r\n{code}2016-08-18 16:55:27,924 INFO  [qtp955127719-13340] [puppetserver] Puppet Not Found: dev_chrisb.conf is not a known environment{code}\r\n\r\nand the access log:\r\n{code}192.168.0.113 - - [18/Aug/2016:16:55:27 +0100] \"GET /puppet/v3/file_metadata/modules/zedcore/logstash/filters/environment/dev_chrisb.conf?environment=dev_chrisb& HTTP/1.1\" 404 101 \"-\" \"Ruby\" 6{code}\r\n\r\nIt looks like Puppet is failing to parse the URL correctly because of the directory called {{environment}}. If I rename that directory to {{env}}, with no other changes to my manifests, it works perfectly fine.\r\n\r\nThis manifest worked in Puppet 3.7.2 before we upgraded to 4.","closed_at":"2016-09-28T05:24:51.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6636","labels":"","state":"Closed","updated_at":"2016-09-28T05:24:51.000-0700","timestamp":1652285119.981727,"priority":"Normal","status_category":"Done","pull_request":5275},{"issue_id":"18018","title":"Solaris pkg package provider does not handle expiring certificates","url":"https://tickets.puppetlabs.com/browse/PUP-643","created_at":"2013-10-31T09:17:00.000-0700","number":"PUP-643","body":"When the {{pkg}} command issues a warning like\r\n\r\n{noformat}\r\nCertificate '/var/pkg/ssl/21c5ab9143663d2d698f6f3a7d41a81603cd1a6f' for publisher 'solarisstudio', needed to access 'https://pkg.oracle.com/solarisstudio/release/', will expire in '28' days.\r\n{noformat}\r\n\r\nThe pkg provider, when doing {{ensure => latest}} does not handle that response while determining the latest version and issues:\r\n\r\n{noformat}\r\nError: /Stage[main]//Package[mypkg]: Could not evaluate: Could not get latest version: Unknown line format pkg: Certificate '/var/pkg/ssl/21c5ab9143663d2d698f6f3a7d41a81603cd1a6f' for publisher 'solarisstudio', needed to access 'https://pkg.oracle.com/solarisstudio/release/', will expire in '28' days.\r\n{noformat}\r\n\r\nI expect that the provider handles the warning, issues a warning of its own so that the information is not lost, and then proceeds as normal.","closed_at":"2016-09-30T09:56:56.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-643","labels":"","state":"Closed","updated_at":"2016-09-30T09:56:56.000-0700","timestamp":1652285120.287139,"priority":"Normal","status_category":"Done","pull_request":5149},{"issue_id":"18829","title":"Encoding mis-matches cause package prefetching to fail","url":"https://tickets.puppetlabs.com/browse/PUP-736","created_at":"2013-11-13T11:28:58.000-0800","number":"PUP-736","body":"One of our RPM packages has some UTF-8 characters in its description, leading to an exception (\"Error: Could not prefetch package provider 'yum': invalid byte sequence in US-ASCII\")  in rpm.rb, causing no packages to be upgraded as the yumhelper.py invocation code raises that error.\r\n\r\nPriority=High because it breaks file { ensure => latest; }.","closed_at":"2016-09-30T14:42:31.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-736","labels":"customer;encoding;i18n;redmine;utf-8","state":"Closed","updated_at":"2016-09-30T14:42:31.000-0700","timestamp":1652285120.495041,"priority":"Normal","status_category":"Done","pull_request":8783},{"issue_id":"21356","title":"puppet fails if template contains invalid utf-8","url":"https://tickets.puppetlabs.com/browse/PUP-1038","created_at":"2013-12-16T03:00:44.000-0800","number":"PUP-1038","body":"If you attempt to use a file resource with a 'content' parameter pointing at a template, and the template contains binary content, you may get an error like this:\r\n\r\n{code}\r\n    Error: Failed to apply catalog: Parameter content failed: Munging failed for value ...\r\n    invalid byte sequence in UTF-8\r\n{code}\r\n\r\nI've reproduced the failure in 2.7.16 and 3.x, though the error messages differ slightly between the two (and also depending on whether you repro via 'apply' or via master/agent run).\r\n\r\nI'm attaching the binary file that I'm using to repro.  Save it into a directory structure like this:\r\n\r\n{code}\r\n    modules/mymod/templates/mytemplate.erb\r\n{code}\r\n\r\nAdd the \"modules\" directory to your module path and then you can repro with the following manifest:\r\n\r\n{code}\r\n    file { \"/tmp/myfile\":\r\n        mode => 755,\r\n        content => template(\"mymod/mytemplate.erb\"),\r\n    }\r\n{code}\r\n\r\nNote that if you use the 'source' parameter rather than the 'content' parameter (and avoid calling the template function), the manifest can be applied successfully; so the issue is when bringing in binary data as a string.","closed_at":"2016-09-30T15:34:18.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1038","labels":"i18n;redmine;utf-8","state":"Closed","updated_at":"2016-09-30T15:34:18.000-0700","timestamp":1652285120.700386,"priority":"Normal","status_category":"Done","pull_request":8303},{"issue_id":"80929","title":"User resource fails with UTF-8 comment on 2nd run","url":"https://tickets.puppetlabs.com/browse/PUP-4633","created_at":"2015-05-20T03:59:56.000-0700","number":"PUP-4633","body":"I'm seeing something similar to PUP-1473 but only on the 2nd and subsequent runs :\r\n\r\n{code}\r\n[root@marionette tmp]# cat pup-1473.pp \r\n# pup-1473.pp\r\n\r\nuser { 'bubba' :\r\n  comment => '™',\r\n  ensure => present,\r\n}\r\n[root@marionette tmp]# puppet apply pup-1473.pp \r\nNotice: Compiled catalog for marionette.example.com in environment production in 0.40 seconds\r\nNotice: /Stage[main]/Main/User[bubba]/ensure: created\r\nNotice: Applied catalog in 0.05 seconds\r\n[root@marionette tmp]# grep bubba /etc/passwd\r\nbubba:x:1029:1029:™:/home/bubba:/bin/bash\r\n[root@marionette tmp]# puppet apply pup-1473.pp \r\nNotice: Compiled catalog for marionette.example.com in environment production in 0.39 seconds\r\nError: Could not convert change 'comment' to string: incompatible character encodings: UTF-8 and ASCII-8BIT\r\nError: Could not convert change 'comment' to string: incompatible character encodings: UTF-8 and ASCII-8BIT\r\nError: /Stage[main]/Main/User[bubba]: Could not evaluate: Puppet::Util::Log requires a message\r\nNotice: Applied catalog in 0.03 seconds\r\n[root@marionette tmp]# rpm -qa '*puppet*'\r\npuppet-agent-1.0.1-1.el7.x86_64\r\npuppetlabs-release-pc1-0.9.2-1.el7.noarch\r\npuppetserver-2.0.0-1.el7.noarch\r\npuppetdb-terminus-2.3.4-1.el7.noarch\r\npuppetdb-2.3.4-1.el7.noarch\r\n{code}","closed_at":"2016-10-04T13:28:49.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4633","labels":"","state":"Closed","updated_at":"2016-10-04T13:28:49.000-0700","timestamp":1652285121.116089,"priority":"Normal","status_category":"Done","pull_request":3977},{"issue_id":"135139","title":"Cumulus Linux 3.0 default service provider should be systemd","url":"https://tickets.puppetlabs.com/browse/PUP-6381","created_at":"2016-06-02T11:26:16.000-0700","number":"PUP-6381","body":"With Cumulus Linux 3.0, the default service provider uses the debian default of init instead of systemd that ships with CL 3.0","closed_at":"2016-10-05T11:43:58.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6381","labels":"","state":"Closed","updated_at":"2016-10-05T11:43:58.000-0700","timestamp":1652285121.523515,"priority":"Normal","status_category":"Done","pull_request":5003},{"issue_id":"132637","title":"DNF provider cannot update packages (install command will not update)","url":"https://tickets.puppetlabs.com/browse/PUP-6324","created_at":"2016-05-19T07:12:04.000-0700","number":"PUP-6324","body":"tl;dr *dnf install* will not install a newer version of a package if it's already installed:\r\n\r\n{code}\r\n[root@fedora-22-x64 vagrant]# /bin/dnf -y install cockpit\r\nLast metadata expiration check performed 0:18:07 ago on Thu May 19 13:40:06 2016.\r\nPackage cockpit-0.67-2.fc22.x86_64 is already installed, skipping.\r\nDependencies resolved.\r\nNothing to do.\r\nComplete!\r\n{code}\r\n\r\nFull log of proof:\r\n\r\n{code}\r\n[root@fedora-22-x64 vagrant]# rpm -qa cockpit\r\ncockpit-0.67-2.fc22.x86_64\r\n[root@fedora-22-x64 vagrant]# dnf list cockpit\r\nLast metadata expiration check performed 0:17:14 ago on Thu May 19 13:40:06 2016.\r\nInstalled Packages\r\ncockpit.x86_64                                     0.67-2.fc22                                       @System\r\nAvailable Packages\r\ncockpit.src                                        0.106-1.fc22                                      group_cockpit-cockpit-preview\r\ncockpit.x86_64                                     0.106-1.fc22                                      group_cockpit-cockpit-preview\r\n[root@fedora-22-x64 vagrant]# puppet resource package cockpit\r\npackage { 'cockpit':\r\n  ensure => '0.67-2.fc22',\r\n}\r\n[root@fedora-22-x64 vagrant]# puppet resource package cockpit ensure=latest --debug\r\nDebug: Prefetching dnf resources for package\r\nDebug: Executing: '/bin/rpm --version'\r\nDebug: Executing '/bin/rpm -qa --nosignature --nodigest --qf '%{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\\n''\r\nDebug: Executing: '/bin/dnf check-update'\r\nDebug: /Package[cockpit]/ensure: cockpit \"0.67-2.fc22\" is installed, latest is \"0:0.94-1.fc22\"\r\nDebug: Package[cockpit](provider=dnf): Ensuring => latest\r\nDebug: Executing: '/bin/dnf -d 0 -e 1 -y install cockpit'\r\nNotice: /Package[cockpit]/ensure: ensure changed '0.67-2.fc22' to '0:0.94-1.fc22'\r\nDebug: Finishing transaction 36208880\r\nDebug: Storing state\r\nDebug: Stored state in 0.01 seconds\r\nDebug: Executing: '/bin/rpm -q cockpit --nosignature --nodigest --qf %{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\\n'\r\npackage { 'cockpit':\r\n  ensure => '0.67-2.fc22',\r\n}\r\n[root@fedora-22-x64 vagrant]# /bin/dnf -y install cockpit\r\nLast metadata expiration check performed 0:18:07 ago on Thu May 19 13:40:06 2016.\r\nPackage cockpit-0.67-2.fc22.x86_64 is already installed, skipping.\r\nDependencies resolved.\r\nNothing to do.\r\nComplete!\r\n[root@fedora-22-x64 vagrant]# /bin/dnf -y upgrade cockpit\r\nLast metadata expiration check performed 0:18:26 ago on Thu May 19 13:40:06 2016.\r\nDependencies resolved.\r\n==================================================================================================================================\r\n Package                              Arch         Version                              Repository                           Size\r\n==================================================================================================================================\r\nInstalling:\r\n cockpit-networkmanager               noarch       0.106-1.fc22                         group_cockpit-cockpit-preview        42 k\r\n cockpit-storaged                     noarch       0.106-1.fc22                         group_cockpit-cockpit-preview        52 k\r\n device-mapper-multipath              x86_64       0.4.9-73.fc22                        fedora                              116 k\r\n device-mapper-multipath-libs         x86_64       0.4.9-73.fc22                        fedora                              215 k\r\n iscsi-initiator-utils                x86_64       6.2.0.873-25.gitc9d830b.fc22         fedora                              423 k\r\n iscsi-initiator-utils-iscsiuio       x86_64       6.2.0.873-25.gitc9d830b.fc22         fedora                               83 k\r\n libstoraged                          x86_64       2.1.2-1.fc22                         group_cockpit-cockpit-preview       119 k\r\n python3                              x86_64       3.4.2-6.fc22                         updates                              53 k\r\n python3-libs                         x86_64       3.4.2-6.fc22                         updates                             6.6 M\r\n python3-pip                          noarch       6.0.8-1.fc22                         fedora                              1.7 M\r\n python3-setuptools                   noarch       17.1.1-3.fc22                        updates                             406 k\r\n storaged                             x86_64       2.1.2-1.fc22                         group_cockpit-cockpit-preview       360 k\r\n storaged-lvm2                        x86_64       2.1.2-1.fc22                         group_cockpit-cockpit-preview        64 k\r\nUpgrading:\r\n cockpit                              x86_64       0.106-1.fc22                         group_cockpit-cockpit-preview        43 k\r\n cockpit-bridge                       x86_64       0.106-1.fc22                         group_cockpit-cockpit-preview       184 k\r\n cockpit-docker                       x86_64       0.106-1.fc22                         group_cockpit-cockpit-preview        51 k\r\n cockpit-shell                        noarch       0.106-1.fc22                         group_cockpit-cockpit-preview       727 k\r\n cockpit-ws                           x86_64       0.106-1.fc22                         group_cockpit-cockpit-preview       487 k\r\n\r\nTransaction Summary\r\n==========================================================================e\r\n{code}","closed_at":"2016-10-05T14:47:57.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6324","labels":"","state":"Resolved","updated_at":"2016-10-05T14:47:57.000-0700","timestamp":1652285121.830858,"priority":"Normal","status_category":"Done","pull_request":4973},{"issue_id":"156905","title":"Running beaker tests locally on Windows fails due to missing rubygems cert","url":"https://tickets.puppetlabs.com/browse/PUP-6819","created_at":"2016-10-14T10:04:15.000-0700","number":"PUP-6819","body":"On Windows, when adding the rubygems source to the vendored rubygems in puppet-agent, the gem command will fail with: \r\n\r\n{code}\r\nError fetching https://rubygems.org:\r\n                SSL_connect returned=1 errno=0 state=error: certificate verify failed (https://api.rubygems.org/specs.4.8.gz)>\r\n{code}\r\n\r\nWe can fix this by pointing the gem command helper at our packaged SSL cert file.","closed_at":"2016-10-17T10:03:48.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6819","labels":"","state":"Closed","updated_at":"2016-10-17T10:03:48.000-0700","timestamp":1652285123.728019,"priority":"Normal","status_category":"Done","pull_request":5331},{"issue_id":"126195","title":"OSX Passwords not setting under Puppet 4.4.1","url":"https://tickets.puppetlabs.com/browse/PUP-6159","created_at":"2016-04-12T03:07:56.000-0700","number":"PUP-6159","body":"Managing the passwords for local users under OSX 10.9, 10.10 and 10.11 under puppet 4.4.1 fails when setting the salt, iterations and password. \r\n\r\nSteps to re-create:\r\n\r\nUsed the following command to generate a user definition and saved it to test.pp\r\n\r\n{code}\r\npuppet resource user test >> test.pp\r\n{code}\r\n\r\n{code:puppet}\r\nuser { 'test':\r\n  ensure     => 'present',\r\n  comment    => 'test',\r\n  gid        => '20',\r\n  groups     => ['com.apple.sharepoint.group.2'],\r\n  home       => '/Users/test',\r\n  iterations => '46948',\r\n  password   => '9690da8dd8f90f6e3fed4f267c86110e29d75e8448efdacdee9bd5cc20f81a563c9e6c6c328694fac80910ba99508cc373525ac592b87fbec0ac1a1e26a51f01873c25f2450aa78e09c8498df0f11fa930c3f655e7aeed6bc61e8475ca84297b3a2273d31974ddd232e872d9b66be82d0246d094d60155c93c6b7a27ba1aa390',\r\n  salt       => '62133b77a7aeecf506ffe99d064b3f8c068344de0a619a573a871f2fd6fe9eaf',\r\n  shell      => '/bin/bash',\r\n  uid        => '503',\r\n}\r\n{code}\r\n\r\n\r\nWhen running puppet apply on the above definition I get the following errors:\r\n\r\n{code}\r\nError: \"\\x96\" on UTF-8\r\nError: /Stage[main]/Main/User[test]/password: change from [old password hash redacted] to [new password hash redacted] failed: \"\\x96\" on UTF-8\r\n\r\nError: \"\\xA7\" on UTF-8\r\nError: /Stage[main]/Main/User[test]/salt: change from 6f13b4510093e89a0098eff8ee5d4bae3e1314ebf31064c101cd886ad8c2fab6 to 62133b77a7aeecf506ffe99d064b3f8c068344de0a619a573a871f2fd6fe9eaf failed: \"\\xA7\" on UTF-8\r\n\r\nError: \"\\xD2\" followed by \"\\x01\" on UTF-8\r\nError: /Stage[main]/Main/User[test]/iterations: change from 43290 to 46948 failed: \"\\xD2\" followed by \"\\x01\" on UTF-8\r\n{code}","closed_at":"2016-10-17T14:17:37.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6159","labels":"","state":"Closed","updated_at":"2016-10-17T14:17:37.000-0700","timestamp":1652285123.829426,"priority":"Normal","status_category":"Done","pull_request":4996},{"issue_id":"19010","title":"FFI native windows root certs code","url":"https://tickets.puppetlabs.com/browse/PUP-766","created_at":"2013-11-15T14:04:05.000-0800","number":"PUP-766","body":"We've gotten reports of the windows agent crashing, and found a few issues with how we are calling native Win32 APIs, effectively using pointers encoded as ascii-8bit strings. We need to move to using FFI, which provides a number of \"type-safe\" benefits, e.g. pointer sizes on x86 vs x64 platforms, etc.\r\n","closed_at":"2016-10-19T10:46:58.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-766","labels":"redmine","state":"Closed","updated_at":"2016-10-19T10:46:58.000-0700","timestamp":1652285124.444646,"priority":"Normal","status_category":"Done","pull_request":8110},{"issue_id":"37610","title":"Puppet specs on windows triggers \"Excluding C from search path. Fact file paths must be an absolute directory\"","url":"https://tickets.puppetlabs.com/browse/PUP-2699","created_at":"2014-05-29T13:29:10.000-0700","number":"PUP-2699","body":"Per Josh in HipChat:\r\n\r\nwhen using as_platform => 'posix' and running on windows\r\nwe switch File::PATH_SEPARATOR to ':', which confuses facter\r\non windows","closed_at":"2016-10-19T10:46:59.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2699","labels":"windows","state":"Closed","updated_at":"2016-10-19T10:46:59.000-0700","timestamp":1652285124.855228,"priority":"Normal","status_category":"Done","pull_request":3498},{"issue_id":"24344","title":"scheduled_task won't update command","url":"https://tickets.puppetlabs.com/browse/PUP-1498","created_at":"2014-01-23T07:24:57.000-0800","number":"PUP-1498","body":"if you update a scheduled_task's command, Puppet does not make the change in the task scheduler. Other changes, e.g. the trigger, appear to work, but not the command.\r\n\r\nI've had to work around by deleting the old task and creating a new one with a different name.\r\n","closed_at":"2016-10-19T10:47:01.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1498","labels":"scheduled_task;windows","state":"Closed","updated_at":"2016-10-19T10:47:01.000-0700","timestamp":1652285126.81451,"priority":"Normal","status_category":"Done","pull_request":5042},{"issue_id":"22314","title":"puppet module tool on windows will (sometimes) create a PaxHeader directory","url":"https://tickets.puppetlabs.com/browse/PUP-1186","created_at":"2013-12-19T07:33:31.000-0800","number":"PUP-1186","body":"In Puppet 3.2 the module tool started using minitar when the tar executable is not present. It turns out that minitar does not understand the [PAX|http://en.wikipedia.org/wiki/Pax_(Unix)] format.\r\n\r\nAn example of a module that was created with this is [liamjbennet/win_facts v0.0.1|https://forge.puppetlabs.com/liamjbennett/win_facts/0.0.1]. When that module is installed the problem appears as follows.\r\n\r\n{noformat}\r\nC:\\Program Files (x86)\\Puppet Labs\\Puppet\\bin>puppet module install liamjbennett\r\n-win_facts\r\nNotice: Preparing to install into C:/ProgramData/PuppetLabs/puppet/etc/modules .\r\n..\r\nNotice: Downloading from https://forge.puppetlabs.com ...\r\nNotice: Installing -- do not interrupt ...\r\nC:/ProgramData/PuppetLabs/puppet/etc/modules\r\n└── liamjbennett-win_facts (v0.0.1)\r\n\r\nC:\\Program Files (x86)\\Puppet Labs\\Puppet\\bin>puppet apply -e 'notice hello'\r\nError loading fact C:/ProgramData/PuppetLabs/puppet/etc/modules/win_facts/lib/fa\r\ncter/PaxHeader/operatingsystemversion.rb C:/ProgramData/PuppetLabs/puppet/etc/mo\r\ndules/win_facts/lib/facter/PaxHeader/operatingsystemversion.rb:1: syntax error,\r\nunexpected tIDENTIFIER, expecting $end\r\n17 gid=790807719\r\n      ^\r\nError loading fact C:/ProgramData/PuppetLabs/puppet/etc/modules/win_facts/lib/fa\r\ncter/PaxHeader/windows_productkey.rb C:/ProgramData/PuppetLabs/puppet/etc/module\r\ns/win_facts/lib/facter/PaxHeader/windows_productkey.rb:1: syntax error, unexpect\r\ned tIDENTIFIER, expecting $end\r\n17 gid=790807719\r\n      ^\r\nError loading fact C:/ProgramData/PuppetLabs/puppet/etc/modules/win_facts/lib/fa\r\ncter/PaxHeader/windows_sid.rb C:/ProgramData/PuppetLabs/puppet/etc/modules/win_f\r\nacts/lib/facter/PaxHeader/windows_sid.rb:1: syntax error, unexpected tIDENTIFIER\r\n, expecting $end\r\n17 gid=790807719\r\n      ^\r\n\r\n........\r\n{noformat}\r\n\r\nThe error is because those files are not ruby files:\r\n\r\n{noformat}\r\nC:\\Program Files (x86)\\Puppet Labs\\Puppet\\bin>type  C:\\ProgramData\\PuppetLabs\\puppet\\etc\\modules\\win_facts\\lib\\facter\\PaxHeader\\windows_systemtype.rb\r\n17 gid=790807719\r\n18 uid=2140070515\r\n20 ctime=1366908908\r\n20 atime=1366908908\r\n24 SCHILY.dev=234881026\r\n23 SCHILY.ino=78693886\r\n18 SCHILY.nlink=1\r\n{noformat}\r\n\r\nThere is a very good write up on the PaxHeader and problems of mixing tools that can be found at http://tickets.opscode.com/browse/CHEF-4107.\r\n\r\nIt doesn't appear that these warnings actually cause problems, but they do clutter up the output and cause fright.","closed_at":"2016-10-19T10:47:02.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1186","labels":"redmine;windows","state":"Closed","updated_at":"2016-10-19T10:47:02.000-0700","timestamp":1652285127.022585,"priority":"Major","status_category":"Done","pull_request":2872},{"issue_id":"41810","title":"Puppet searches disk for whit classes","url":"https://tickets.puppetlabs.com/browse/PUP-2924","created_at":"2014-07-10T17:12:17.000-0700","number":"PUP-2924","body":"Our Puppet instance has been pretty slow lately so we traced a puppet agent run to see what it was doing. In the trace we see a bunch of lines like this:\r\n\r\nstat(\"/opt/local/lib/ruby/site_ruby/2.0.0/puppet/vendor/semantic/lib/puppet/type/completed_stage.rb\", 0xFFFFFD7FFFDFE4A0) Err#2 ENOENT\r\nstat(\"/etc/puppet/modules/admin/lib/puppet/type/completed_stage.rb\", 0xFFFFFD7FFFDFE4A0) Err#2 ENOENT\r\nstat(\"/etc/puppet/modules/percona/lib/puppet/type/completed_stage.rb\", 0xFFFFFD7FFFDFE4A0) Err#2 ENOENT\r\nstat(\"/etc/puppet/shared/modules/apt/lib/puppet/type/completed_stage.rb\", 0xFFFFFD7FFFDFE4A0) Err#2 ENOENT\r\nstat(\"/etc/puppet/shared/modules/puppetlabs-stdlib/lib/puppet/type/completed_stage.rb\", 0xFFFFFD7FFFDFE4A0) Err#2 ENOENT\r\nstat(\"/etc/puppet/external/modules/python/lib/puppet/type/completed_stage.rb\", 0xFFFFFD7FFFDFE4A0) Err#2 ENOENT\r\nstat(\"/etc/puppet/external/modules/yum_puppet_plugin/lib/puppet/type/completed_stage.rb\", 0xFFFFFD7FFFDFE4A0) Err#2 ENOENT\r\nstat(\"/var/lib/puppet/lib/puppet/type/completed_stage.rb\", 0xFFFFFD7FFFDFE4A0) Err#2 ENOENT\r\nstat(\"/opt/local/lib/ruby/gems/2.0.0/gems/bigdecimal-1.2.0/lib/puppet/type/completed_stage.rb\", 0xFFFFFD7FFFDFE4A0) Err#2 ENOENT\r\nstat(\"/opt/local/lib/ruby/gems/2.0.0/gems/bundler-1.5.3/lib/puppet/type/completed_stage.rb\", 0xFFFFFD7FFFDFE4A0) Err#2 ENOENT\r\nstat(\"/opt/local/lib/ruby/gems/2.0.0/gems/byebug-3.1.2/lib/puppet/type/completed_stage.rb\", 0xFFFFFD7FFFDFE4A0) Err#2 ENOENT\r\nstat(\"/opt/local/lib/ruby/gems/2.0.0/gems/columnize-0.8.9/lib/puppet/type/completed_stage.rb\", 0xFFFFFD7FFFDFE4A0) Err#2 ENOENT\r\nstat(\"/opt/local/lib/ruby/gems/2.0.0/gems/daemons-1.1.9/lib/puppet/type/completed_stage.rb\", 0xFFFFFD7FFFDFE4A0) Err#2 ENOENT\r\n\r\nWhich means that Puppet is attempting to find a file in a bunch of different locations, which we believe is part of a process Puppet goes through when trying to find and load a class or function. In total, we see around 20,000 attempts to open files that fit the completed_ or admissible_ pattern.\r\n\r\nI dug in to what it was trying to find and found this: https://github.com/puppetlabs/puppet/blob/2350ed0db1264040864ad4dfc9908429d6298eb1/lib/puppet/type/whit.rb. My understanding is that a Whit is essentially a virtual graph node which appears before or after a regular graph node. I don't find any cases of us calling these in our Puppet repo, so I'm assuming that its internal Puppet code of some kind that is asking for these.\r\n\r\nSo it appears to me that Puppet is defining a virtual class type then searching disk for it through some set of directories including every gem it sees, every time it is accessed, on every run of Puppet. Am I totally misunderstanding this or Is there something we as users could be doing to create this situation? Is this the default behavior? If so, it seems broken or insane to me. Please talk me off this ledge!","closed_at":"2016-10-19T10:47:04.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2924","labels":"","state":"Closed","updated_at":"2016-10-19T10:47:04.000-0700","timestamp":1652285127.441566,"priority":"Normal","status_category":"Done","pull_request":2979},{"issue_id":"14948","title":"Manage hidden windows packages","url":"https://tickets.puppetlabs.com/browse/PUP-400","created_at":"2013-09-19T00:24:47.000-0700","number":"PUP-400","body":"Currently, the windows package provider excludes hidden applications (those whose SystemComponent registry value is set to 1) from its {{instances}} method (both exe and msi). This is done so that puppet has parity with what is displayed in Add/Remove Programs, e.g. {{SQL Server 2008 R2 SP2 Common Files}} .\r\n\r\nBut it means if you install a hidden application, then puppet won't know it's installed, and try to reinstall it next time. For example, https://groups.google.com/d/topic/puppet-users/ftvvO51bX1U/discussion","closed_at":"2016-10-19T10:47:04.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-400","labels":"windows","state":"Closed","updated_at":"2016-10-19T10:47:04.000-0700","timestamp":1652285127.556866,"priority":"Normal","status_category":"Done","pull_request":3704},{"issue_id":"39921","title":"Solaris Zone properties ip, dataset and inherit are not set upon zone creation","url":"https://tickets.puppetlabs.com/browse/PUP-2817","created_at":"2014-06-20T14:59:13.000-0700","number":"PUP-2817","body":"The {{ip}}, {{dataset}} and {{inherit}} properties of the Zone type each have [insync methods|https://github.com/puppetlabs/puppet/blob/3.6.2/lib/puppet/type/zone.rb#L252-L253] that respond with {{true}} when passed a {{nil}} property value. When a zone resource is first created, the property hash looks like:\r\n\r\n{code}\r\n{\r\n  ensure => :absent\r\n}\r\n{code}\r\n\r\nThis means that every property value aside from {{ensure}} is {{nil}} which causes ip, dataset and inherit to be skipped during zone creation. After creation, {{:absent}} is used in the hash instead of {{nil}}.\r\n\r\nHowever, in the case of {{inherit}}, the inherited directories of a Solaris 10 zone cannot be changed after creation:\r\n\r\n{noformat}\r\necho \"add inherit-pkg-dir\r\nset dir=/opt/puppet\r\nend\r\ncommit\" | /usr/sbin/zonecfg -z test -f -\r\n\r\nOn line 1:\r\nZone test already installed; add inherit-pkg-dir not allowed.\r\nOn line 2:\r\nCannot set a resource-specific property from the global scope.\r\nOn line 3:\r\nThe end command only makes sense in the resource scope.\r\n{noformat}\r\n\r\nTo quote the official [Solaris 10 documentation|http://docs.oracle.com/cd/E19044-01/sol.containers/817-1592/z.conf.start-29/index.html]:\r\n\r\n{quote}\r\nThese resources cannot be modified or removed after the zone has been installed using zoneadm.\r\n{quote}\r\n\r\nSo, eventual consistency does no good for the {{inherit}} property.","closed_at":"2016-10-19T10:47:06.000-0700","comments":24,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2817","labels":"customer;solaris;support;type_zone","state":"Closed","updated_at":"2016-10-19T10:47:06.000-0700","timestamp":1652285128.59251,"priority":"Major","status_category":"Done","pull_request":2973},{"issue_id":"41062","title":"`puppet resource service` not working for `cryptdisks-udev`","url":"https://tickets.puppetlabs.com/browse/PUP-2879","created_at":"2014-07-02T10:43:06.000-0700","number":"PUP-2879","body":"Issuing _puppet resource service cryptdisks-udev_ outputs \r\nbq. Error: Could not run: Execution of '/sbin/status cryptdisks-udev' returned 1: status: Unknown parameter: DEVNAME\r\n\r\nSince puppet stops there _puppet resource service_ won't work as well.","closed_at":"2016-10-19T10:47:07.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2879","labels":"","state":"Closed","updated_at":"2016-10-19T10:47:07.000-0700","timestamp":1652285129.331231,"priority":"Normal","status_category":"Done","pull_request":2960},{"issue_id":"41514","title":"Regression when pluginsyncing external facts on Windows","url":"https://tickets.puppetlabs.com/browse/PUP-2907","created_at":"2014-07-08T09:50:00.000-0700","number":"PUP-2907","body":"Ticket PUP-2705 restored the ability for pluginsync to preserve permissions for external facts synced to {{facts.d}}. However, on Windows, it generates a deprecation warning, which users cannot fix:\r\n\r\n{noformat}\r\nC:\\work\\puppet> bundle exec puppet agent -t\r\n...\r\nInfo: Retrieving pluginfacts\r\nWarning: Copying owner/mode/group from the source file on Windows is deprecated; use source_permissions => ignore.\r\n   (at C:/cygwin64/lib/ruby/site_ruby/1.9.1/puppet/type/file/source.rb:133:in `block in copy_source_values')\r\nNotice: /File[C:/ProgramData/PuppetLabs/puppet/var/facts.d]/mode: mode changed '0700' to '0755'\r\nInfo: Retrieving plugin\r\nInfo: Loading external facts from C:/ProgramData/PuppetLabs/puppet/var/facts.d\r\n{noformat}\r\n\r\nThe plugin_handler should specify {{:use}} on posix, and {{:ignore}} on windows.","closed_at":"2016-10-19T10:47:10.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2907","labels":"customer;support","state":"Closed","updated_at":"2016-10-19T10:47:10.000-0700","timestamp":1652285144.239583,"priority":"Normal","status_category":"Done","pull_request":2955},{"issue_id":"47592","title":"Fix cfacter integration to match recent cfacter changes","url":"https://tickets.puppetlabs.com/browse/PUP-3050","created_at":"2014-08-12T17:25:29.000-0700","number":"PUP-3050","body":"cfacter has changed its gem so that most of the implementation now lies in the C++ source.  This means we can entirely remove lib/facts.rb and change the cfacter option implementation to simply call a single method in the gem.","closed_at":"2016-10-19T10:47:11.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3050","labels":"","state":"Closed","updated_at":"2016-10-19T10:47:11.000-0700","timestamp":1652285144.442328,"priority":"Normal","status_category":"Done","pull_request":2965},{"issue_id":"47740","title":"Restore constants / deprecated call sites changed during x64 upgrade that impact ACL module","url":"https://tickets.puppetlabs.com/browse/PUP-3056","created_at":"2014-08-13T14:24:34.000-0700","number":"PUP-3056","body":"When {{Puppet::Util::Windows::File}} and {{Puppet::Util::Windows::Security}} were refactored, mixins from older versions of the {{windows-pr]} gem were removed.\r\n\r\nAt the time, we didn't check downstream modules to see if they were consuming any of the mixed in methods or constants.\r\n\r\nA scan through the ACL module has revealed that some methods were not properly redirected with deprecation messages.  Furthermore, a few necessary constants were either moved, or not restored to the classes that were originally mixed into.\r\n\r\nConstants that need to be restored are\r\n\r\n{code}\r\nGENERIC_WRITE\r\nGENERIC_EXECUTE\r\nGENERIC_ALL\r\n\r\nDELETE\r\n{code}\r\n\r\nThe list of redirections includes\r\n\r\n{code}\r\n  Puppet::Util::ADSI::User -> Puppet::Util::Windows::ADSI::User\r\n\r\n  Windows::File::FILE_ALL_ACCESS -> Puppet::Util::Windows::File::FILE_ALL_ACCESS\r\n  Windows::File::FILE_EXECUTE -> Puppet::Util::Windows::File::FILE_EXECUTE\r\n  Windows::File::FILE_GENERIC_WRITE -> Puppet::Util::Windows::File::FILE_GENERIC_WRITE\r\n  Windows::File::FILE_GENERIC_READ -> Puppet::Util::Windows::File::FILE_GENERIC_READ\r\n  Windows::File::FILE_GENERIC_EXECUTE -> ?? Puppet::Util::Windows::File::FILE_GENERIC_EXECUTE\r\n  Windows::File::FILE_WRITE_DATA -> Puppet::Util::Windows::File::FILE_WRITE_DATA\r\n  Windows::File::FILE_WRITE_ATTRIBUTES -> Puppet::Util::Windows::File::FILE_WRITE_ATTRIBUTES\r\n  Windows::File::FILE_READ_DATA  -> Puppet::Util::Windows::File::FILE_READ_DATA\r\n  Windows::File::FILE_APPEND_DATA -> Puppet::Util::Windows::File::FILE_APPEND_DATA\r\n\r\n  Windows::File::GENERIC_ALL -> Puppet::Util::Windows::File::GENERIC_ALL\r\n  Windows::File::GENERIC_WRITE -> Puppet::Util::Windows::File::GENERIC_WRITE\r\n  Windows::File::GENERIC_READ -> Puppet::Util::Windows::File::GENERIC_READ\r\n  Windows::File::GENERIC_EXECUTE -> Puppet::Util::Windows::File::GENERIC_EXECUTE\r\n  \r\n  Windows::File::READ_CONTROL -> Puppet::Util::Windows::Security::READ_CONTROL\r\n  \r\n  Windows::File::DELETE -> Puppet::Util::Windows::Security::DELETE\r\n\r\n  Windows::Security::GENERIC_ALL -> Puppet::Util::Windows::File::GENERIC_ALL\r\n  \r\n  Puppet::Util::Windows::Security.valid_sid?() -> Puppet::Util::Windows::SID.valid_sid?()\r\n  Puppet::Util::Windows::Security.name_to_sid() -> Puppet::Util::Windows::SID.name_to_sid()\r\n  Puppet::Util::Windows::Security.sid_to_name() -> Puppet::Util::Windows::SID.sid_to_name()\r\n{code}\r\n\r\n","closed_at":"2016-10-19T10:47:11.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3056","labels":"windows","state":"Closed","updated_at":"2016-10-19T10:47:11.000-0700","timestamp":1652285144.543527,"priority":"Major","status_category":"Done","pull_request":2967},{"issue_id":"48386","title":"reported catalog run time is wildly inaccurate","url":"https://tickets.puppetlabs.com/browse/PUP-3081","created_at":"2014-08-19T08:07:51.000-0700","number":"PUP-3081","body":"The puppet client clearly does not actually use wallclock time to calculate how long a puppet run takes.\r\n\r\nHere are a few examples of puppet runs with the time command:\r\n\r\n# time puppet agent -t\r\n....\r\nNotice: Finished catalog run in 131.19 seconds\r\n\r\nreal    3m32.015s\r\nuser    1m48.207s\r\nsys     0m18.101s\r\n\r\n\r\n# time puppet agent -t\r\n....\r\n\r\nNotice: Finished catalog run in 89.43 seconds\r\n\r\nreal    2m52.423s\r\nuser    1m42.438s\r\nsys     0m15.805s\r\n\r\nOn a box that is much less busy:\r\n\r\n# time puppet agent -t\r\n....\r\nNotice: Finished catalog run in 8.97 seconds\r\n\r\nreal\t0m14.911s\r\nuser\t0m3.896s\r\nsys\t0m1.640s\r\n\r\n","closed_at":"2016-10-19T10:47:12.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3081","labels":"","state":"Closed","updated_at":"2016-10-19T10:47:12.000-0700","timestamp":1652285144.748796,"priority":"Normal","status_category":"Done","pull_request":3121},{"issue_id":"27602","title":"Puppet should execute ruby.exe not cmd.exe when running as a windows service","url":"https://tickets.puppetlabs.com/browse/PUP-1802","created_at":"2014-02-27T15:52:42.000-0800","number":"PUP-1802","body":"Currently, when puppet runs as a service on windows, it executes a batch script (in a cmd.exe process), which then invokes ruby.exe. The child process then calls back into the service control manager, and that causes the service control manager to issue a warning in the application event log that a different process registered as a service than the one it launched.\r\n\r\nIdeally, the service control manager should launch ruby.exe directly along with whatever arguments are necessary to do so.\r\n\r\nIf the puppet service is running when a new version is installed, or existing version repaired, Windows Installer may issue the warning, \"The setup must update files or services that cannot be updated while the system is running. If you choose to continue, a reboot will be required to complete the setup.\" I believe this occurs because ruby.exe is not the executable associated with the service, so the installer just thinks the file is in use. This issue can be triggered easily by setting runinterval=5, e.g. run puppet every 5 seconds, and then trying to upgrade/repair.","closed_at":"2016-10-19T10:47:13.000-0700","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1802","labels":"windows","state":"Closed","updated_at":"2016-10-19T10:47:13.000-0700","timestamp":1652285145.362577,"priority":"Major","status_category":"Done","pull_request":3755},{"issue_id":"35358","title":"Remove 1.8.7 support in the ruby code base","url":"https://tickets.puppetlabs.com/browse/PUP-2563","created_at":"2014-05-13T12:05:49.000-0700","number":"PUP-2563","body":"Starting with any reference to \"1.8\" in the codebase should be a decent guide to what to remove / purge. Don't forget .travis.yml!\r\n\r\nAnd remove from the puppet-4 specs matrix when done.","closed_at":"2016-10-19T10:47:16.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2563","labels":"","state":"Closed","updated_at":"2016-10-19T10:47:16.000-0700","timestamp":1652285146.396343,"priority":"Normal","status_category":"Done","pull_request":3379},{"issue_id":"22646","title":"Tidy causes 'Cannot alias' ArgumentError exception on Windows","url":"https://tickets.puppetlabs.com/browse/PUP-1276","created_at":"2013-12-30T10:24:13.000-0800","number":"PUP-1276","body":"This example:\r\n<pre>\r\nclass puppet-bug {\r\n\r\n  file { 'C:\\bug':\r\n    ensure => directory,\r\n  }\r\n\r\n  tidy { 'C:\\bug':\r\n    recurse => true,\r\n    backup  => false\r\n  }\r\n\r\n  file { 'C:\\bug\\test.txt':\r\n    content => 'Look, a bug!'\r\n  }\r\n\r\n}\r\n</pre>\r\n\r\nCauses this error:\r\n\r\n<pre>\r\nerr: Got an uncaught exception of type ArgumentError: Cannot alias File[C:\\bug/test.txt] to [\"C:/bug/test.txt\"]; resource [\"File\", \"C:/bug/test.txt\"] already declared at /etc/puppet/modules/puppet-bug/manifests/init.pp:14\r\n</pre>\r\n\r\nIt appears to be due to the way slashes are handled on Windows. If you change the tidy to 'C:/bug' it all works just fine and the duplicate resource is detected and excluded from the tidy as expected.  \r\n\r\nThat might be an acceptable fix, except when you're using variables for File resources that are also used as msiexec parameters and thus can't have Unix slashes. :)\r\n\r\n","closed_at":"2016-10-19T10:47:18.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1276","labels":"redmine;windows","state":"Closed","updated_at":"2016-10-19T10:47:18.000-0700","timestamp":1652285147.110366,"priority":"Normal","status_category":"Done","pull_request":3525},{"issue_id":"54190","title":"Remove defunct code from Puppet::Util::Autoload","url":"https://tickets.puppetlabs.com/browse/PUP-3433","created_at":"2014-10-09T15:33:32.000-0700","number":"PUP-3433","body":"The Autoload class has quite a bit of code that serves no purpose and may falsely indicate functionality that does no longer exist. Once instance is the ability to wrap autoloaded code; Autoload instances can be created with {{:wrap => true}}, but that option is never passed to the code that actually performs the loading. In addition there is logic for storing and retrieving Autoload instances which has zero callers. This should all be torn out.","closed_at":"2016-10-19T10:47:20.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3433","labels":"","state":"Closed","updated_at":"2016-10-19T10:47:20.000-0700","timestamp":1652285147.517034,"priority":"Normal","status_category":"Done","pull_request":3174},{"issue_id":"53001","title":"Remove serialization of indirector requests","url":"https://tickets.puppetlabs.com/browse/PUP-3370","created_at":"2014-09-30T09:52:27.000-0700","number":"PUP-3370","body":"Commit https://github.com/puppetlabs/puppet/commit/1cbe2ad7 added the ability to serialize an indirector request so that requests could be transported over mcollective. This functionality was never implemented, and never will be. We need to remove this code.","closed_at":"2016-10-19T10:47:21.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3370","labels":"","state":"Closed","updated_at":"2016-10-19T10:47:21.000-0700","timestamp":1652285147.822751,"priority":"Normal","status_category":"Done","pull_request":3230},{"issue_id":"20010","title":"expanded_relationship.dot should not have both containment and relationship edges","url":"https://tickets.puppetlabs.com/browse/PUP-914","created_at":"2013-12-03T08:59:22.000-0800","number":"PUP-914","body":"# Overview #\r\n\r\nRunning against master (2.7.0rc3-135-g520cbc0) I notice that using --graph has obvious cycles in the graph when the catalog itself does not actually have cycles and applies cleanly.\r\n\r\nPlease see the attached screenshot.\r\n\r\nTalking with Daniel, the suspicion is that the graphing output is not drawing a distinction between containment edges and relationship edges and is displaying both in the graph output.\r\n\r\n# Desired Behavior #\r\n\r\nThe graph output should only display relationship edges between resources as it does with Puppet 2.6 and earlier.\r\n\r\n# Actual Behavior #\r\n\r\nVisible cycles are displayed in the graph output when there are no relationship edge cycles.\r\n\r\n# Steps to reproduce #\r\n\r\nA simple catalog should show some resources looping against themselves.  I can provide example manifests upon request.\r\n\r\n","closed_at":"2016-10-19T10:47:23.000-0700","comments":18,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-914","labels":"redmine","state":"Closed","updated_at":"2016-10-19T10:47:23.000-0700","timestamp":1652285148.65549,"priority":"Normal","status_category":"Done","pull_request":7102},{"issue_id":"19495","title":"upstart service operating system confine should include redhat and centos","url":"https://tickets.puppetlabs.com/browse/PUP-876","created_at":"2013-11-22T08:12:19.000-0800","number":"PUP-876","body":"RedHat EL 6 and Centos 6 both use upstart for init.  The upstart service type should be able to be used on those systems as well.\r\n\r\nI have done some very minor testing to make sure it at least works to ensure services are running and stopped.","closed_at":"2016-10-19T10:47:25.000-0700","comments":17,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-876","labels":"customer;redmine","state":"Closed","updated_at":"2016-10-19T10:47:25.000-0700","timestamp":1652285149.816968,"priority":"Normal","status_category":"Done","pull_request":7428},{"issue_id":"13656","title":"Mode is required when specifying the file owner & group","url":"https://tickets.puppetlabs.com/browse/PUP-264","created_at":"2013-08-26T15:28:21.000-0700","number":"PUP-264","body":null,"closed_at":"2016-10-19T10:47:26.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-264","labels":"windows","state":"Closed","updated_at":"2016-10-19T10:47:26.000-0700","timestamp":1652285150.025579,"priority":"Major","status_category":"Done","pull_request":7993},{"issue_id":"13655","title":"Don't remove access control entries for LocalSystem","url":"https://tickets.puppetlabs.com/browse/PUP-263","created_at":"2013-08-26T15:25:45.000-0700","number":"PUP-263","body":"The current windows file provider will remove access control entries for file/dir for the SYSTEM account unless explicitly specified as the user or group. This can cause problems. See https://projects.puppetlabs.com/issues/15559 for more info.","closed_at":"2016-10-19T10:47:27.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-263","labels":"windows","state":"Closed","updated_at":"2016-10-19T10:47:27.000-0700","timestamp":1652285150.342277,"priority":"Major","status_category":"Done","pull_request":3996},{"issue_id":"13657","title":"Don't set owner/group/mode if none are specified","url":"https://tickets.puppetlabs.com/browse/PUP-265","created_at":"2013-08-26T15:36:21.000-0700","number":"PUP-265","body":null,"closed_at":"2016-10-19T10:47:27.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-265","labels":"windows","state":"Closed","updated_at":"2016-10-19T10:47:27.000-0700","timestamp":1652285150.65372,"priority":"Major","status_category":"Done","pull_request":2745},{"issue_id":"20946","title":"Update ACL armature","url":"https://tickets.puppetlabs.com/browse/PUP-995","created_at":"2013-12-11T13:51:56.000-0800","number":"PUP-995","body":"Review jcbollinger's feedback and update armature, taking into account hiera, and the discussion about \"data\" objects.","closed_at":"2016-10-19T10:47:28.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-995","labels":"","state":"Resolved","updated_at":"2016-10-19T10:47:28.000-0700","timestamp":1652285150.755664,"priority":"Normal","status_category":"Done","pull_request":7691},{"issue_id":"39118","title":"Support Bundler workflow on x64","url":"https://tickets.puppetlabs.com/browse/PUP-2777","created_at":"2014-06-13T13:52:34.000-0700","number":"PUP-2777","body":"Puppet expresses Windows gem dependencies, but it only applies to ruby x86. When running on x64, the gem dependencies do not apply, so you can't use bundler to install gems, and run specs.\r\n\r\nCurrently, puppet's Gemfile uses the bundler `mingw` platform identifier, effectively:\r\n\r\n{noformat}\r\nplatform :mingw do\r\n  gem 'ffi'\r\n  ...\r\nend\r\n{noformat}\r\n\r\n{{Bundler::Dependency::PLATFORM_MAP}} maps that to the rubygems platform {{MINGW}}:\r\n\r\n{noformat}\r\n      :mingw    => Gem::Platform::MINGW,\r\n{noformat}\r\n\r\nWhen run on ruby 1.9.3 x86, the {{MINGW}} gem platform is a match:\r\n\r\n{noformat}\r\nirb(main):010:0> Gem::Platform.local.to_s\r\n=> \"x86-mingw32\"\r\nirb(main):011:0> Gem::Platform.match(Gem::Platform::MINGW)\r\n=> true\r\n{noformat}\r\n\r\nBut on ruby 2 x64, it is not:\r\n\r\n{noformat}\r\nirb(main):011:0> Gem::Platform.local.to_s\r\n=> \"x64-mingw32\"\r\nirb(main):012:0> Gem::Platform.match(Gem::Platform::MINGW)\r\n=> false\r\n{noformat}\r\n\r\nAs a result, dependencies that are currently expressed for x86-mingw, do not apply when run on ruby 2 x64.","closed_at":"2016-10-19T10:47:29.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2777","labels":"windows","state":"Closed","updated_at":"2016-10-19T10:47:29.000-0700","timestamp":1652285152.069876,"priority":"Normal","status_category":"Done","pull_request":2825},{"issue_id":"30569","title":"Allow Inheritance when setting Deny ACEs","url":"https://tickets.puppetlabs.com/browse/PUP-2100","created_at":"2014-03-31T09:54:46.000-0700","number":"PUP-2100","body":"With Access Control Entries (ACEs) on Windows, we currently use [AddAccessDeniedAce|http://msdn.microsoft.com/en-us/library/windows/desktop/aa374962(v=vs.85).aspx] which does not include inheritance and/or propagation to child objects, but [AddAccessDeniedAceEx|http://msdn.microsoft.com/en-us/library/windows/desktop/aa374964(v=vs.85).aspx] does. We are already using AddAccessAllowedAceEx when setting access allowed ACEs and we should use the same behavior for denied ACEs.","closed_at":"2016-10-19T10:47:32.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2100","labels":"windows","state":"Closed","updated_at":"2016-10-19T10:47:32.000-0700","timestamp":1652285153.548408,"priority":"Normal","status_category":"Done","pull_request":2490},{"issue_id":"22832","title":"Service provider in RedHat will not create K?? stop scripts","url":"https://tickets.puppetlabs.com/browse/PUP-1343","created_at":"2014-01-02T15:03:05.000-0800","number":"PUP-1343","body":"When a service is set to be enabled the provider/service/redhat.rb provider will run \"/sbin/chkconfig $name on\" which will only create the links for starting the service but will not for stopping it. The correct command is \"/sbin/chkconfig --add $name\".\r\n\r\nThis is important for those services that require stopping cleanly before other services.\r\n\r\n","closed_at":"2016-10-19T10:47:34.000-0700","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1343","labels":"redmine","state":"Closed","updated_at":"2016-10-19T10:47:34.000-0700","timestamp":1652285164.328576,"priority":"Normal","status_category":"Done","pull_request":3451},{"issue_id":"58433","title":"Replace 'configtimeout' with separate HTTP connect and read timeout settings","url":"https://tickets.puppetlabs.com/browse/PUP-3666","created_at":"2014-11-12T13:27:57.000-0800","number":"PUP-3666","body":"There's an agent setting 'configtimeout' which purports to:\r\n\r\n{noformat}\r\n    :configtimeout => {\r\n      :default  => 120,\r\n      :desc     => \"How long the client should wait for the configuration to be retrieved\r\n      before considering it a failure.  This can help reduce flapping if too\r\n      many clients contact the server at one time.\",\r\n    },\r\n{noformat}\r\n\r\nThis is not correct though, as it's actually used for all http connections.  The option should be renamed to reflect reality (perhaps to `httptimeout`?) and docs updated accordingly.\r\n\r\n----\r\n\r\nFinal decision:\r\n\r\n* New setting: {{http_connect_timeout}} — controls how long Puppet should attempt to make a connection. Normal to have a small value for this. \r\n* New setting: {{http_read_timeout}} — controls how long Puppet should allow transfers to continue. Normal to let this last a long time or be infinite, since some things just take a while to compile or download. \r\n* {{configtimeout}} is deprecated, and logs a warning if it's set. \r\n","closed_at":"2016-10-19T10:47:34.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3666","labels":"docs_reviewed;redmine","state":"Closed","updated_at":"2016-10-19T10:47:34.000-0700","timestamp":1652285164.853361,"priority":"Normal","status_category":"Done","pull_request":3305},{"issue_id":"59795","title":"zone provider should inherit /sbin on solaris10","url":"https://tickets.puppetlabs.com/browse/PUP-3702","created_at":"2014-11-25T16:09:04.000-0800","number":"PUP-3702","body":null,"closed_at":"2016-10-19T10:47:35.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3702","labels":"","state":"Closed","updated_at":"2016-10-19T10:47:35.000-0700","timestamp":1652285165.279106,"priority":"Normal","status_category":"Done","pull_request":3351},{"issue_id":"61486","title":"scheduled_task keeps reapplying","url":"https://tickets.puppetlabs.com/browse/PUP-3768","created_at":"2014-12-15T13:26:21.000-0800","number":"PUP-3768","body":"Every puppet run I have a scheduled task that gets re-applied even though there was no change.  After doing some digging, it looks like it applies correctly, but on the next run, it is only comparing a part of the argument string instead of the full string.\r\n\r\nIt looks like when doing the comparison, it is only reading in the first 256 characters instead of the entire string.\r\n\r\n\r\n    scheduled_task { 'cloud_backup':\r\n      ensure    => present,\r\n      command   => 'C:\\Program Files\\Duplicati\\Duplicati.CommandLine.exe',\r\n      arguments => template('fdlic/duplicati/backup.erb'),\r\n      trigger   => {\r\n        schedule   => weekly,\r\n        start_time => '08:00:00',\r\n        start_date => '2014-05-08'\r\n      }\r\n      \r\n    }\r\n\r\n\r\narguments changed 'backup --ftp-username=empty --ftp-password=empty --max-upload-pr-second=500kb --thread-priority=BelowNormal --use-ssl --passphrase=empty --aes-encryption-dont-allow-fallback=true --full-if-older-than=1M --exclude=*.wma --exclude=*.mp3 --exclu' to 'backup --ftp-username=empty --ftp-password=empty --max-upload-pr-second=500kb --thread-priority=BelowNormal --use-ssl --passphrase=empty --aes-encryption-dont-allow-fallback=true --full-if-older-than=1M --exclude=*.wma --exclude=*.mp3 --exclude=*.acc' --exclude=*.mp4 --exclude=*.avi --exclude=*.3gp --exclude=*.mpg --exclude=*.mov ","closed_at":"2016-10-19T10:47:37.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3768","labels":"customer-escalation;scheduled_task;windows","state":"Closed","updated_at":"2016-10-19T10:47:37.000-0700","timestamp":1652285165.489387,"priority":"Normal","status_category":"Done","pull_request":5035},{"issue_id":"66182","title":"(Regression) Redhat service provider is being used on systemd-based Fedora systems","url":"https://tickets.puppetlabs.com/browse/PUP-3927","created_at":"2015-01-29T14:48:57.000-0800","number":"PUP-3927","body":"In 3.7.4 we made changes to the Redhat service provider (PUP-1343) which cannot be run for systemd based services. The systemd provider is the default for redhat v7, but hasn't been enabled for Fedora. This means that enabling services on Fedora will fail.\r\n\r\nThe fix for this should just be to enable the systemd provider for the relevant releases of Fedora. ","closed_at":"2016-10-19T10:47:39.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3927","labels":"","state":"Closed","updated_at":"2016-10-19T10:47:39.000-0700","timestamp":1652285166.118658,"priority":"Major","status_category":"Done","pull_request":3544},{"issue_id":"71518","title":"agent command line options ignored running under systemd","url":"https://tickets.puppetlabs.com/browse/PUP-4196","created_at":"2015-03-13T04:37:20.000-0700","number":"PUP-4196","body":"Command line options can be added to systemd start agent within \r\n*/etc/sysconfig/puppet* and it seemingly works however when \r\nthe agent starts all the options are silently ignored.\r\n\r\n{code}\r\nPUPPET_EXTRA_OPTS=\"--masterport=8150\"\r\n{code}\r\n\r\nResults in systemd showing in the process table:\r\n\r\n{code}\r\n /usr/bin/ruby /usr/bin/puppet agent  --masterport=8150 --no-daemonize\r\n{code}\r\n\r\nHowever once running the --masterport (or any other option) is ignored.\r\n\r\n{quote}\r\npuppet-agent[15763]: Using cached connection for https://it-puppet-masters-public-b.cern.ch:8140\r\npuppet-agent[15763]: Caching connection for https://it-puppet-masters-public-b.cern.ch:8140\r\n{quote}\r\n\r\nThe port number above is wrong and was taken from puppet.conf file.\r\n\r\nThis seems to be related to environment. If \r\n\r\n{code}\r\n /usr/bin/ruby /usr/bin/puppet agent  --masterport=8150 --no-daemonize\r\n{code}\r\n\r\nis executed on the command line then everything works as expected\r\nand the puppet agent correctly talks to port 8150.\r\n\r\npuppet is so called simple service in systemd speak and systemd basically runs the above command as is.\r\n\r\n\r\nEnvironment of puppet agent running under systemd\r\n{code}\r\nPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin\r\nLANG=en_US.UTF-8\r\nPUPPET_EXTRA_OPTS=--ca_port=8140 --masterport=8150\r\n{code}\r\n\r\nRunning on the CLI.\r\n\r\n{code}\r\nBASH_FUNC_module()=() {  eval `/usr/bin/modulecmd bash $*`\r\nCVS_RSH=ssh\r\nGT_PROXY_MODE=old\r\nHISTCONTROL=ignoredups\r\nHISTSIZE=1000\r\nHOME=/root\r\nHOSTNAME=lxplus302.cern.ch\r\nKDEDIRS=/usr\r\nKRB5CCNAME=FILE:/tmp/krb5cc_0_brrMbMkoqi\r\nLANG=en_US.UTF-8\r\nLCG_GFAL_INFOSYS=lcg-bdii.cern.ch:2170\r\nLESSOPEN=||/usr/bin/lesspipe.sh %s\r\nLOADEDMODULES=\r\nLOGNAME=root\r\nMAIL=/var/spool/mail/root\r\nMODULEPATH=/usr/share/Modules/modulefiles:/etc/modulefiles\r\nMODULESHOME=/usr/share/Modules\r\nMYPROXY_SERVER=myproxy.cern.ch\r\nPATH=/usr/sue/sbin:/usr/sue/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin\r\nPWD=/root\r\nQT_GRAPHICSSYSTEM_CHECKED=1\r\nQT_GRAPHICSSYSTEM=native\r\nQT_PLUGIN_PATH=/usr/lib64/kde4/plugins:/usr/lib/kde4/plugins\r\nSELINUX_LEVEL_REQUESTED=\r\nSHELL=/bin/bash\r\nSHLVL=1\r\nSSH_ASKPASS=/usr/libexec/openssh/gnome-ssh-askpass\r\nSSH_AUTH_SOCK=/tmp/ssh-oUvgH7Tp7L/agent.26480\r\nSSH_CLIENT=188.184.66.232 52945 22\r\nSSH_CONNECTION=188.184.66.232 52945 188.184.68.74 22\r\nSSH_TTY=/dev/pts/0\r\nTERM=screen-256color\r\nUSER=root\r\n_=/usr/bin/ruby\r\nVIRTUALENVWRAPPER_HOOK_DIR=/root/.virtualenvs\r\nVIRTUALENVWRAPPER_PROJECT_FILENAME=.project\r\nVIRTUALENVWRAPPER_SCRIPT=/etc/profile.d/virtualenvwrapper.sh\r\nWORKON_HOME=/root/.virtualenvs\r\nXDG_RUNTIME_DIR=/run/user/0\r\nXDG_SESSION_ID=131\r\nXMODIFIERS=@im=ibus\r\n{code}\r\n\r\n\r\n\r\n\r\n\r\n","closed_at":"2016-10-19T10:47:40.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4196","labels":"systemd","state":"Closed","updated_at":"2016-10-19T10:47:40.000-0700","timestamp":1652285166.744818,"priority":"Normal","status_category":"Done","pull_request":4114},{"issue_id":"74794","title":"Test to retrieve version of latest of pkgng package is broken","url":"https://tickets.puppetlabs.com/browse/PUP-4382","created_at":"2015-04-07T06:34:55.000-0700","number":"PUP-4382","body":"When changing the rspec syntax from {{should}} syntax into {{expect().to}} syntax in spec/unit/provider/package/pkgng_spec.rb I discovered that one of the tests were broken. The code for the broken test was:\n{code}\n     it \"should retrieve the correct version of the latest package\" do\n      provider.latest.should_not nil\n    end\n{code}\nIt's missing {{==}} after {{should_not}} and when adding that (or when changing to expect syntax) the test fails. It's currently commented out.","closed_at":"2016-10-19T10:47:41.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4382","labels":"","state":"Closed","updated_at":"2016-10-19T10:47:41.000-0700","timestamp":1652285166.849848,"priority":"Normal","status_category":"Done","pull_request":3792},{"issue_id":"80043","title":"External facts no longer load from pluginsync'ed directory","url":"https://tickets.puppetlabs.com/browse/PUP-4607","created_at":"2015-05-13T14:42:29.000-0700","number":"PUP-4607","body":"PUP-4359 broke loading external facts from puppet's pluginsync directories.\r\n\r\n","closed_at":"2016-10-19T10:47:43.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4607","labels":"","state":"Closed","updated_at":"2016-10-19T10:47:43.000-0700","timestamp":1652285167.373447,"priority":"Normal","status_category":"Done","pull_request":3933},{"issue_id":"81167","title":"Refreshing a LaunchDaemon leaves it disabled","url":"https://tickets.puppetlabs.com/browse/PUP-4639","created_at":"2015-05-21T10:47:58.000-0700","number":"PUP-4639","body":"If a LanchDaemon is refreshed, it will end up disabled due to the way the refresh is being run.\r\n\r\nPuppet runs 'launchctl unload -w' and then just 'launchctl load' when it should be running 'launchctl load -w'.\r\n\r\nBecause it has the -w when it stops it, the service becomes disabled.  The -w flag is required to reenable the service.\r\n\r\nExample is below.\r\n\r\nThe current workaround is to do a refreshonly exec after the service to ensure it is actually running with a 'launchctl load -w' command.\r\n---\r\n```\r\nInfo: /Stage[main]/example/File[example]: Scheduling refresh of Service[com.example.daemon]\r\nDebug: /Stage[main]/example/File[example]: The container Class[example] will propagate my refresh event\r\nDebug: Executing '/usr/bin/plutil -convert xml1 -o /dev/stdout /Library/LaunchDaemons/com.example.daemon.plist'\r\nDebug: A restart has been triggered for the com.example.daemon service\r\nDebug: Stopping the com.example.daemon service\r\nDebug: Executing '/usr/bin/plutil -convert xml1 -o /dev/stdout /Library/LaunchDaemons/com.example.daemon.plist'\r\nDebug: Executing '/usr/bin/plutil -convert xml1 -o /dev/stdout /Library/LaunchDaemons/com.example.daemon.plist'\r\nDebug: Executing 'launchctl unload -w /Library/LaunchDaemons/com.example.daemon.plist'\r\nDebug: Executing '/usr/bin/plutil -convert xml1 -o /dev/stdout /Library/LaunchDaemons/com.example.daemon.plist'\r\nDebug: Executing '/usr/bin/plutil -convert xml1 -o /dev/stdout /Library/LaunchDaemons/com.example.daemon.plist'\r\nDebug: Starting the com.example.daemon service\r\nDebug: Executing '/usr/bin/plutil -convert xml1 -o /dev/stdout /Library/LaunchDaemons/com.example.daemon.plist'\r\nDebug: Executing '/usr/bin/plutil -convert xml1 -o /dev/stdout /Library/LaunchDaemons/com.example.daemon.plist'\r\nDebug: Executing 'launchctl load /Library/LaunchDaemons/com.example.daemon.plist'\r\nNotice: /Stage[main]/example/Service[com.example.daemon]: Triggered 'refresh' from 1 events\r\n```","closed_at":"2016-10-19T10:47:43.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4639","labels":"","state":"Closed","updated_at":"2016-10-19T10:47:43.000-0700","timestamp":1652285167.477828,"priority":"Major","status_category":"Done","pull_request":4171},{"issue_id":"81511","title":"4420_pluginfacts test fails with multiple agent nodes","url":"https://tickets.puppetlabs.com/browse/PUP-4652","created_at":"2015-05-26T11:08:11.000-0700","number":"PUP-4652","body":"The new \"4420_pluginfacts_should_be_resolvable_on_agent.rb\" test references \"agent\" without extracting it from iterating over \"agents\" here:\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/c7b1fdb63497015f0ebf7b894a33a08ef3a96d0d/acceptance/tests/pluginsync/4420_pluginfacts_should_be_resolvable_on_agent.rb#L29\r\n\r\nThis looks like a bug in the test and fails on the Puppet Server pipeline.  For example, see:\r\n\r\nhttps://jenkins.puppetlabs.com/view/Puppet%20Server/view/All/job/platform_puppet-server_integration-system_no-conditional_full-master/59/LAYOUT=redhat6-64ma-64a,LDAP_TYPE=,PLATFORM=,label=beaker/testReport/junit/(root)/ruby_puppet_acceptance_tests_pluginsync/4420_pluginfacts_should_be_resolvable_on_agent_rb/\r\n\r\nNot sure why this appears to be passing iun the Puppet AIO acceptance test pipeline.","closed_at":"2016-10-19T10:47:43.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4652","labels":"","state":"Closed","updated_at":"2016-10-19T10:47:43.000-0700","timestamp":1652285167.5848,"priority":"Normal","status_category":"Done","pull_request":3964},{"issue_id":"83149","title":"The pw provider for users and groups should be confined to freeBSD","url":"https://tickets.puppetlabs.com/browse/PUP-4693","created_at":"2015-06-03T18:15:21.000-0700","number":"PUP-4693","body":"If the {{pw}} provider is only intended for use on BSD operating systems, then it should use {{confine}} to prevent accidental activation on non-BSD systems. Linux is particularly susceptible to this as there are no default providers declared for that platform (PUP-4692).\r\n\r\nSee PUP-4491 for similar reasoning in the case of OpenBSD providers.","closed_at":"2016-10-19T10:47:43.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4693","labels":"customer;support","state":"Closed","updated_at":"2016-10-19T10:47:43.000-0700","timestamp":1652285167.687822,"priority":"Normal","status_category":"Done","pull_request":4004},{"issue_id":"84286","title":"Yumrepo doesn't recognize whitespace delimited reposdir settings in /etc/yum.conf","url":"https://tickets.puppetlabs.com/browse/PUP-4744","created_at":"2015-06-11T13:24:56.000-0700","number":"PUP-4744","body":"The {{inifile}} provider for the Yumrepo type searches various directories when deciding where to create repository definitions. One source of directories is the {{reposdir}} setting of {{/etc/yum.conf}}. Yum allows this setting to contain a list of directories [delimited by either commas or whitespace|http://yum.baseurl.org/gitweb?p=yum.git;a=blob;f=yum/config.py;h=97e5e3d3b063294a96227a67cce43a9655cd3aa6;hb=30c993c19b8b85f44e7cec436484862ab55a6961#l171], however Puppet [only uses commas|https://github.com/puppetlabs/puppet/blob/3.8.1/lib/puppet/provider/yumrepo/inifile.rb#L77] when parsing the setting.\r\n\r\nIf the {{reposdir}} setting contains a whitespace delimited list of directories, then Puppet will almost silently (a DEBUG level message is logged) fall back to creating definitions directly in {{/etc/yum.conf}}.\r\n\r\nh2. Reproduction Case\r\n\r\n*  Install Puppet on a Red Hat system.\r\n*  Add a {{reposdir}} setting to {{/etc/yum.conf}} which contains a whitespace-delimited list:\r\n\r\n{code:bash}\r\n  echo 'reposdir=/etc/yum.conf.d /tmp' >> /etc/yum.conf\r\n{code}\r\n\r\n\r\n*  Attempt to create a new repo definition.\r\n\r\nh3. Outcome\r\n\r\nThe definition is added to {{/etc/yum.conf}} instead of a new file under {{/tmp/}}:\r\n\r\n{noformat}\r\n# /opt/puppet/bin/puppet resource yumrepo foo ensure=present descr='foo repo'\r\nNotice: /Yumrepo[foo]/ensure: created\r\nyumrepo { 'foo':\r\n  ensure => 'present',\r\n  descr  => 'foo repo',\r\n}\r\n\r\n# ls /etc/yum.repos.d/foo.repo\r\nls: cannot access /etc/yum.repos.d/foo.repo: No such file or directory\r\n{noformat}\r\n\r\nh3. Expected Outcome\r\n\r\nThe definition is created under {{/tmp/}} as it's the last {{reposdir}} specified\r\n\r\n{noformat}\r\n# /opt/puppet/bin/puppet resource yumrepo foo ensure=present descr='foo repo'\r\nNotice: /Yumrepo[foo]/ensure: created\r\nyumrepo { 'foo':\r\n  ensure => 'present',\r\n  descr  => 'foo repo',\r\n}\r\n\r\n# ls /tmp/foo.repo \r\n/tmp/foo.repo\r\n{noformat}","closed_at":"2016-10-19T10:47:44.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4744","labels":"customer;puppethack;support","state":"Closed","updated_at":"2016-10-19T10:47:44.000-0700","timestamp":1652285167.793684,"priority":"Normal","status_category":"Done","pull_request":4517},{"issue_id":"101085","title":"Tag fields in reports accidentally changed to Puppet::Util::TagSet objects","url":"https://tickets.puppetlabs.com/browse/PUP-5341","created_at":"2015-10-07T14:55:18.000-0700","number":"PUP-5341","body":"Puppet reports contain `tags` fields in each Puppet::Util::Log and Puppet::Resource::Status object; these fields are supposed to be arrays of strings. \r\n\r\nIn Puppet 4.0.0, the tags fields in a YAML-dumped Puppet::Transaction::Report object changed from arrays to Puppet::Util::TagSets, as described in DOCUMENT-436. This was a side-effect of:\r\n\r\n{code}\r\ncommit 7b0eed2b52bad0d5c3fc3a9fbe37d097eabc9fc2\r\nAuthor: Britt Gresham <britt@puppetlabs.com>\r\nDate:   Wed Nov 12 09:17:30 2014 -0800\r\n\r\n    (PUP-1019) Remove ZAML\r\n\r\n    Before this commit we were using ZAML by monkey patching the `to_yaml`\r\n    function to use ZAML.dump instead of YAML.dump. After removing `zaml.rb`\r\n    tests started failing because of the way that ZAML serialized YAML so\r\n    assertions in those tests were changed.\r\n\r\n    This commit also adds in a patch to YAML.Psych to handle the cases where\r\n    ruby objects were being encoded improperly.\r\n\r\n    This commit removes the use of ZAML in puppet as part of the Puppet 4.x\r\n    code removal efforts.\r\n{code}\r\n\r\n{code}\r\ndiff --git a/lib/puppet/util/tag_set.rb b/lib/puppet/util/tag_set.rb\r\nindex e74f228..613859d 100644\r\n--- a/lib/puppet/util/tag_set.rb\r\n+++ b/lib/puppet/util/tag_set.rb\r\n@@ -24,12 +24,6 @@ class Puppet::Util::TagSet < Set\r\n     to_data_hash.to_pson\r\n   end\r\n\r\n-  # this makes puppet serialize it as an array for backwards\r\n-  # compatibility\r\n-  def to_zaml(z)\r\n-    to_data_hash.to_zaml(z)\r\n-  end\r\n-\r\n   def join(*args)\r\n     to_a.join(*args)\r\n   end\r\n{code}","closed_at":"2016-10-19T10:47:47.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5341","labels":"","state":"Closed","updated_at":"2016-10-19T10:47:47.000-0700","timestamp":1652285168.421859,"priority":"Normal","status_category":"Done","pull_request":4720},{"issue_id":"106285","title":"blank line in ssh_known_hosts file causes error","url":"https://tickets.puppetlabs.com/browse/PUP-5513","created_at":"2015-11-18T11:46:34.000-0800","number":"PUP-5513","body":"If there is a blank line in an existing /etc/ssh/ssh_known_hosts file, \"puppet agent -t\" fails with:\r\n\r\nError: Failed to apply catalog: undefined method `split' for :absent:Symbol\r\n\r\nExample /etc/ssh/ssh_known_hosts that triggers this issue:\r\n{code:none}\r\n# Comment 1\r\n\r\n# Comment 2\r\n{code}","closed_at":"2016-10-19T10:47:48.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5513","labels":"","state":"Closed","updated_at":"2016-10-19T10:47:48.000-0700","timestamp":1652285168.52719,"priority":"Normal","status_category":"Done","pull_request":4460},{"issue_id":"115355","title":"systemd service provider always enables service in chroot","url":"https://tickets.puppetlabs.com/browse/PUP-5825","created_at":"2016-02-05T09:10:13.000-0800","number":"PUP-5825","body":"The systemd service provider is using the following command to determine its enabled state\r\n\r\n{code:sh}\r\nsystemctl show autofs --property LoadState --property UnitFileState\r\n{code}\r\n\r\nNormally this returns\r\n{code}\r\n# systemctl show autofs --property LoadState --property UnitFileState\r\nLoadState=loaded\r\nUnitFileState=enabled\r\n{code}\r\n\r\nIn a chroot\r\n{code}\r\n# systemctl show autofs --property LoadState --property UnitFileState\r\nRunning in a chroot, ignoring request.\r\n{code}\r\n\r\nTherefore, the provider always enables the autofs service.\r\n\r\nThis can be overcome by using 'systemctl is-enabled'\r\n\r\nIn a chroot\r\n{code}\r\n# systemctl is-enabled autofs\r\nenabled\r\n{code}\r\n","closed_at":"2016-10-19T10:47:49.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5825","labels":"","state":"Closed","updated_at":"2016-10-19T10:47:49.000-0700","timestamp":1652285168.738103,"priority":"Normal","status_category":"Done","pull_request":4770},{"issue_id":"122121","title":"LaunchDaemons/LaunchAgents with line continuations break puppet","url":"https://tickets.puppetlabs.com/browse/PUP-6073","created_at":"2016-03-18T09:10:52.000-0700","number":"PUP-6073","body":"When puppet encounters a valid (if rare) plist with a backslash line continuation, it will fail:\r\n{{Error: Could not prefetch service provider 'launchd': undefined method `to_ruby' for nil:NilClass}}\r\n\r\nI expect this is due to the plist-handling code in 3.8; if you catch {{NoMethodError}} and have the provider fall through to {{plutil -convert}}, it works.","closed_at":"2016-10-19T10:47:50.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6073","labels":"","state":"Closed","updated_at":"2016-10-19T10:47:50.000-0700","timestamp":1652285168.949859,"priority":"Normal","status_category":"Done","pull_request":4804},{"issue_id":"117701","title":"windows, user to groupassign to local administrators failed","url":"https://tickets.puppetlabs.com/browse/PUP-5938","created_at":"2016-02-20T13:54:14.000-0800","number":"PUP-5938","body":"Trying to add an user to local Administrator Group fails with an error message\r\n\r\n{code}\r\nC:\\Temp>puppet apply  --verbose -e \"user { 'bla': ensure  => 'present', comment\r\n=> 'bla', groups  => ['S-1-5-32-544',], }\"\r\n{code}\r\n\r\nor also following version\r\n\r\n{code}\r\nC:\\Temp>puppet apply  --verbose -e \"user { 'bla': ensure  => 'present', comment\r\n=> 'bla', groups  => ['VORDEFINIERT\\Administratoren',], }\"\r\nInfo: Loading facts\r\nNotice: Compiled catalog for xxxx in environment production in 0.14 seconds\r\nInfo: Applying configuration version '1456004269'\r\nError: ADSI connection error: failed to parse display name of moniker `WinNT://VORDEFINIERT/Administratoren,group'\r\n    HRESULT error code:0x80070035\r\n      Der Netzwerkpfad wurde nicht gefunden.\r\nWrapped exception:\r\nfailed to parse display name of moniker `WinNT://VORDEFINIERT/Administratoren,group'\r\n    HRESULT error code:0x80070035\r\n      Der Netzwerkpfad wurde nicht gefunden.\r\nError: /Stage[main]/Main/User[bla]/ensure: change from absent to present failed:\r\n ADSI connection error: failed to parse display name of moniker `WinNT://VORDEFINIERT/Administratoren,group'\r\n    HRESULT error code:0x80070035\r\n      Der Netzwerkpfad wurde nicht gefunden.\r\n{code}\r\n\r\nI've also tried following names Administratoren and hostname\\Administratoren\r\nYes I've to use the german group names, BUILTIN\\Administrators and the other english names are not found.","closed_at":"2016-10-19T10:47:50.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5938","labels":"user;windows","state":"Closed","updated_at":"2016-10-19T10:47:50.000-0700","timestamp":1652285169.060008,"priority":"Normal","status_category":"Done","pull_request":5137},{"issue_id":"103820","title":"undef not usable in collector search","url":"https://tickets.puppetlabs.com/browse/PUP-5463","created_at":"2015-11-02T07:36:55.000-0800","number":"PUP-5463","body":"The documentation for collector search expressions states that, for the equality search {{==}}, *undef* is a valid right operand.\r\n\r\nHowever, when I try to use it, I get an *Error: Evaluation Error: Error while evaluating a Virtual Query, Cannot transform object of class Puppet::Pops::Model::LiteralUndef* error.\r\n\r\nSample code:\r\n\r\n{code:puppet}\r\ndefine foo (\r\n  $x = undef ,\r\n  $y = undef ,\r\n) {\r\n  notify { \"foo::${x}::${y}\": }\r\n}\r\n\r\nfoo { 'bar': y => 'quux' }\r\nFoo <| x == undef |> { x => 'baz' }\r\n{code}\r\n\r\nThis is the result:\r\n{noformat}\r\n$ puppet apply -t test.pp\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nError: Evaluation Error: Error while evaluating a Virtual Query, Cannot transform object of class Puppet::Pops::Model::LiteralUndef at …/test.pp:9:1 on node …\r\n{noformat}","closed_at":"2016-10-27T14:09:51.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5463","labels":"","state":"Closed","updated_at":"2016-10-27T14:09:51.000-0700","timestamp":1652285169.591373,"priority":"Normal","status_category":"Done","pull_request":5128},{"issue_id":"18322","title":"Puppet yum provider for package resource does not appear to use 'release' tag to ensure latest","url":"https://tickets.puppetlabs.com/browse/PUP-683","created_at":"2013-11-06T11:41:04.000-0800","number":"PUP-683","body":"Puppet's yum provider for the package resource does not appear to offer complete support for RPM naming/versioning.\r\n\r\nYum compares RPMs using the RPM naming convention (e.g name-version-release.arch.rpm).  Our snapshot RPMs make use of this convention and rely upon the fact that yum can distinguish between RPMs based on the release components.  \r\n\r\nFor example, in our yum snapshot repo we have;\r\n\r\n<pre>\r\nmds-2.0.1-SNAPSHOT20120418213747.noarch.rpm\r\nmds-2.0.1-SNAPSHOT20120418220425.noarch.rpm\r\nmds-2.0.1-SNAPSHOT20120418221358.noarch.rpm\r\nmds-2.0.1-SNAPSHOT20120418223400.noarch.rpm\r\n</pre>\r\n\r\nWhen we run 'yum install mds-2.0.1', yum will select the rpm with release = SNAPSHOT20120418223400 as the latest version of mds-2.0.1.  \r\n\r\nWhen we attempt to use Puppet's package resource to perform the same operation with\r\n\r\n<pre>\r\npackage { 'mds-2.0.1':\r\n    ensure => latest\r\n}\r\n</pre>\r\n\r\nPuppet appears to use rpm to gather information about the local install but then does not compare the result to what the yum repo can provide (.i.e. compare release tags).  Instead it simply ensures that an rpm with a matching name-version has been installed.\r\n\r\nTo workaround this issue we're currently calling yum directly using,\r\n\r\n<pre>\r\nexec { \"install mds-${meter_data_service_version}\":\r\n    command => \"yum -d 1 -e 1 install mds-${meter_data_service_version} -y\",\r\n    path    => \"/usr/bin/\",\r\n}\r\n</pre>\r\n\r\nThis is functional but couples us to yum and is not recommended practice in Puppet.","closed_at":"2016-10-31T13:06:24.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-683","labels":"customer;redmine;yum","state":"Closed","updated_at":"2016-10-31T13:06:24.000-0700","timestamp":1652285169.798655,"priority":"Normal","status_category":"Done","pull_request":5406},{"issue_id":"21485","title":"Puppet --version calls external facts","url":"https://tickets.puppetlabs.com/browse/PUP-1111","created_at":"2013-12-16T12:57:56.000-0800","number":"PUP-1111","body":"** Reproduction **\r\n\r\n* Drop script /etc/facter/facts.d/test.sh:\r\n<pre><code class=\"bash\">\r\n#!/bin/bash\r\necho \"SCRIPT CALLED\" >&2\r\necho \"test=value\"\r\n</code></pre>\r\n* Make script executeable\r\n<pre><code class=\"bash\">\r\nchmod +x /etc/facter/facts.d/test.sh\r\n</code></pre>\r\n* Call 'puppet --version', the following output is shown:\r\n<pre><code class=\"bash\">\r\nroot@puppet:~# puppet --version\r\nSCRIPT CALLED\r\nSCRIPT CALLED\r\nSCRIPT CALLED\r\nSCRIPT CALLED\r\nSCRIPT CALLED\r\n3.3.1\r\n</code></pre>\r\n\r\nAs far as i'm aware, there is no reason for calling the external facts when i'm just requesting the puppet version.\r\n\r\n** System information **\r\n\r\n* Ubuntu 12.04.3\r\n* Facter 1.7.3","closed_at":"2016-10-31T13:31:20.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1111","labels":"redmine","state":"Closed","updated_at":"2016-10-31T13:31:20.000-0700","timestamp":1652285170.00554,"priority":"Normal","status_category":"Done","pull_request":8678},{"issue_id":"21463","title":"Class inheritance and stages act weirdly","url":"https://tickets.puppetlabs.com/browse/PUP-1108","created_at":"2013-12-16T11:51:39.000-0800","number":"PUP-1108","body":"Given the code:\r\n\r\n{code}\r\nstage { \"first\": before => Stage[main] }\r\n\r\nclass foo { \r\n   package{\"zsh\": \r\n      ensure => present\r\n   } \r\n}\r\n\r\nclass bar inherits foo { \r\n   notify{\"/usr/bin/cowsay 'hello world'\": \r\n      require => Package[\"zsh\"] \r\n   } \r\n}\r\n\r\nclass{\"bar\": stage => \"first\"}\r\n{code}\r\n\r\nThis produce\r\n\r\n{code}\r\nerr: Could not apply complete catalog: Found dependency cycles in the following relationships: Package[zsh] => Notify[/usr/bin/cowsay 'hello world'], Notify[/usr/bin/cowsay 'hello world'] => Package[zsh], Notify[/usr/bin/cowsay 'hello world'] => Class[main]; try using the '--graph' option and open the '.dot' files in OmniGraffle or GraphViz\r\n{code}\r\n\r\nIf I add:\r\n\r\n{code}\r\nclass{\"foo\": stage => \"first\"}\r\n{code}\r\n\r\nIt sorts itself out.  \r\n\r\nI am not sure what the correct behavior would be, at first I think we should just pull the inherited class into the 'first' stage as well but I can imagine that causing weird issues too?\r\n\r\n","closed_at":"2016-10-31T13:31:22.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1108","labels":"redmine","state":"Closed","updated_at":"2016-10-31T13:31:22.000-0700","timestamp":1652285171.049664,"priority":"Normal","status_category":"Done","pull_request":8662},{"issue_id":"21457","title":"Confusing logging when onlyif prevents an exec from running","url":"https://tickets.puppetlabs.com/browse/PUP-1104","created_at":"2013-12-16T11:48:50.000-0800","number":"PUP-1104","body":"Given the code in:\r\n\r\n{code}\r\nexec{\"/bin/true\": }\r\n\r\nexec{\"/usr/bin/cowthink meh\":\r\n    logoutput => true,\r\n    onlyif    => \"/bin/true\",\r\n    subscribe => Exec[\"/bin/true\"],\r\n    refreshonly => true\r\n}\r\n{code}\r\n\r\nI get the output \r\n\r\n{noformat}\r\nnotice: /Stage[main]//Exec[/bin/true]/returns: executed successfully\r\nnotice: /Stage[main]//Exec[/usr/bin/cowthink meh]/returns:  _____ \r\nnotice: /Stage[main]//Exec[/usr/bin/cowthink meh]/returns: ( meh )\r\nnotice: /Stage[main]//Exec[/usr/bin/cowthink meh]/returns:  ----- \r\nnotice: /Stage[main]//Exec[/usr/bin/cowthink meh]/returns:         o   ^__^\r\nnotice: /Stage[main]//Exec[/usr/bin/cowthink meh]/returns:          o  (oo)\\_______\r\nnotice: /Stage[main]//Exec[/usr/bin/cowthink meh]/returns:             (__)\\       )\\/\\\r\nnotice: /Stage[main]//Exec[/usr/bin/cowthink meh]/returns:                 ||----w |\r\nnotice: /Stage[main]//Exec[/usr/bin/cowthink meh]/returns:                 ||     ||\r\nnotice: /Stage[main]//Exec[/usr/bin/cowthink meh]: Triggered 'refresh' from 1 events\r\nnotice: Finished catalog run in 0.21 seconds\r\n{noformat}\r\n\r\nwhich is all fine,\r\n\r\nif I change the onlyif to:\r\n\r\n{code}\r\nonlyif    => \"/bin/false\",\r\n{code}\r\n\r\nThis prevents the exec from actually running but the logging I would get is:\r\n\r\n{noformat}\r\nnotice: /Stage[main]//Exec[/bin/true]/returns: executed successfully\r\nnotice: /Stage[main]//Exec[/usr/bin/cowthink meh]: Triggered 'refresh' from 1 events\r\n{noformat}\r\n\r\nThe \"Triggered 'refresh' from 1 events' suggests that the exec is being run, when actually its being skipped due to the onlyif condition.\r\n\r\nIf I removed the logoutput from the first bit of code here the output from both runs would be identical:\r\n\r\nWith onlyif => \"/bin/true\" and no logoutput:\r\n\r\n{noformat}\r\nnotice: /Stage[main]//Exec[/bin/true]/returns: executed successfully\r\nnotice: /Stage[main]//Exec[/usr/bin/cowthink meh]: Triggered 'refresh' from 1 events\r\n{noformat}\r\n\r\nWith onlyif => \"/bin/false\" and no logoutput:\r\n\r\n{noformat}\r\nnotice: /Stage[main]//Exec[/bin/true]/returns: executed successfully\r\nnotice: /Stage[main]//Exec[/usr/bin/cowthink meh]: Triggered 'refresh' from 1 events\r\n{noformat}\r\n\r\nThey're identical and don't actually tell the user what is happening","closed_at":"2016-10-31T13:31:23.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1104","labels":"redmine","state":"Closed","updated_at":"2016-10-31T13:31:23.000-0700","timestamp":1652285171.256545,"priority":"Normal","status_category":"Done","pull_request":8626},{"issue_id":"15829","title":"reportdir gets permissions of root owner when running puppet apply","url":"https://tickets.puppetlabs.com/browse/PUP-438","created_at":"2013-09-30T15:22:13.000-0700","number":"PUP-438","body":"If you enable the `store` report handler, then run `puppet apply <file>`, then the reportdir gets created as root, meaning that subsequent puppet runs fail to write out reports.","closed_at":"2016-10-31T13:31:23.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-438","labels":"","state":"Closed","updated_at":"2016-10-31T13:31:23.000-0700","timestamp":1652285171.359946,"priority":"Normal","status_category":"Done","pull_request":4010},{"issue_id":"21421","title":"Puppet not building proper Nagios configs with Exported Resources","url":"https://tickets.puppetlabs.com/browse/PUP-1086","created_at":"2013-12-16T11:19:49.000-0800","number":"PUP-1086","body":"I'm trying to get Puppet set up to build our nagios configs using Exported Resources. This seems to be one of the very test cases that Exported Resources was developed for (it's in the documentation), so I don't feel I've stepped too far outside of Puppet's intended operation parameters here. Yet, I can't seem to have any luck at all getting proper configs generated. \r\n\r\nI have two issues, and I'm uncertain whether or not they're related. I suspect they are, but I could very well be wrong. If they are separate, I apologize, and will be willing to split out a separate ticket. \r\n\r\nHere's my setup, which is almost directly ported from the documentation. \r\n\r\nIn my base class, I have the following: \r\n\r\n    @@nagios_host { $fqdn:\r\n        ensure => present,\r\n        alias => $hostname,\r\n        address => $ipaddress,\r\n        use => \"default\",\r\n        tag => \"site${sitecode}\",\r\n    }\r\n\r\nLater, in my nagios server class, I have: \r\n\r\n    Nagios_host <<| tag == \"site${sitecode}\" |>> {\r\n      target => \"/etc/nagios/puppet/dynamic/host.cfg\",\r\n      notify => Service['nagios'],\r\n      require => File['/etc/nagios/puppet/dynamic'],\r\n    }\r\n\r\nSo far, so good.\r\n\r\nNow, this is in my testing environment, so right now I have a limited number of nodes. They are: \r\n\r\nxxdnstest01, xxdnstest02, xxdnstest03, lvpuppetdev01, xxis5, xxnagios01. \r\n\r\nThe only one of note right now is xxnagios01, which is our nagios server. \r\n\r\nWhen I run puppet for the first time, the following host config is generated: \r\n\r\n\r\n    # HEADER: This file was autogenerated at 2012-01-12 11:20:01 -0600\r\n    # HEADER: by puppet.  While it can still be managed manually, it\r\n    # HEADER: is definitely not recommended.\r\n    define host {\r\n    use                            default\r\n    alias                          xxdnstest02\r\n    address                        172.24.29.68\r\n    host_name                      xxdnstest02.lightningsource.com\r\n    }\r\n    define host {\r\n    use                            default\r\n    alias                          xxdnstest01\r\n    address                        172.24.29.67\r\n    host_name                      xxdnstest01.lightningsource.com\r\n    }\r\n    define host {\r\n    use                            default\r\n    alias                          xxdnstest03\r\n    address                        172.24.29.69\r\n    host_name                      xxdnstest03.lightningsource.com\r\n    }\r\n    define host {\r\n    use                            default\r\n    alias                          lvpuppetdev01\r\n    address                        172.24.20.56\r\n    host_name                      lvpuppetdev01.lightningsource.com\r\n    }\r\n    define host {\r\n    use                            default\r\n    alias                          xxis5\r\n    address                        172.24.29.66\r\n    host_name                      xxis5.lightningsource.com\r\n    }\r\n    \r\n\r\n\r\nThis is almost right... but for some reason xxnagios01 isn't making an appearance! This isn't just happening for the host entry itself, but I can't get any services for xxnagios01 to show up, either. \r\n\r\nI don't know if this is specific to naginator, or if it's generally a bug in Exported Resources. I suspect the latter. It seems like maybe a node can't import resources that it *itself* exports. \r\n\r\nI have verified that the entry does in fact appear in the database: \r\n\r\n\r\n    mysql> select * from resources where restype = \"Nagios_host\";                                                                                                                                                                          \r\n    +----+-----------------------------------+-------------+---------+----------------+----------+------+---------------------+---------------------+                                                                                            \r\n    | id | title                             | restype     | host_id | source_file_id | exported | line | updated_at          | created_at          |                                                                                            \r\n    +----+-----------------------------------+-------------+---------+----------------+----------+------+---------------------+---------------------+                                                                                            \r\n    |  5 | lvpuppetdev01.lightningsource.com | Nagios_host |       3 |              1 |        1 |   64 | 2012-01-12 10:50:12 | 2012-01-12 00:50:13 |                                                                                            \r\n    |  9 | xxdnstest01.lightningsource.com   | Nagios_host |       5 |              1 |        1 |   64 | 2012-01-12 10:50:17 | 2012-01-12 00:50:19 |\r\n    | 13 | xxdnstest02.lightningsource.com   | Nagios_host |       7 |              1 |        1 |   64 | 2012-01-12 10:50:21 | 2012-01-12 00:50:30 |\r\n    | 17 | xxdnstest03.lightningsource.com   | Nagios_host |       9 |              1 |        1 |   64 | 2012-01-12 10:50:33 | 2012-01-12 00:50:40 |\r\n    |  1 | xxnagios01.lightningsource.com    | Nagios_host |       1 |              1 |        1 |   64 | 2012-01-12 10:39:56 | 2012-01-12 00:45:56 |\r\n    | 21 | xxis5.lightningsource.com         | Nagios_host |      11 |              1 |        1 |   64 | 2012-01-12 10:50:50 | 2012-01-12 00:51:02 |\r\n    +----+-----------------------------------+-------------+---------+----------------+----------+------+---------------------+---------------------+\r\n    6 rows in set (0.00 sec)\r\n    \r\n\r\nSo I've got 6 resource entries here in the database, but only five are making it into the file. I'm one short. \r\n\r\nSo now, it gets really weird. \r\n\r\nWhen I run Puppet *again*, I get the following config file: \r\n\r\n    # HEADER: This file was autogenerated at 2012-01-12 11:20:01 -0600\r\n    # HEADER: by puppet.  While it can still be managed manually, it\r\n    # HEADER: is definitely not recommended.\r\n    define host {\r\n    use                            default\r\n    alias                          xxdnstest02\r\n    address                        172.24.29.68\r\n    host_name                      xxdnstest02.lightningsource.com\r\n    }\r\n    define host {\r\n    use                            default\r\n    alias                          xxdnstest01\r\n    address                        172.24.29.67\r\n    host_name                      xxdnstest01.lightningsource.com\r\n    }\r\n    define host {\r\n    use                            default\r\n    alias                          xxdnstest03\r\n    address                        172.24.29.69\r\n    host_name                      xxdnstest03.lightningsource.com\r\n    }\r\n    define host {\r\n    use                            default\r\n    alias                          lvpuppetdev01\r\n    address                        172.24.20.56\r\n    host_name                      lvpuppetdev01.lightningsource.com\r\n    }\r\n    define host {\r\n    use                            default\r\n    alias                          xxis5\r\n    address                        172.24.29.66\r\n    host_name                      xxis5.lightningsource.com\r\n    }\r\n    define host {\r\n    use                            default\r\n    alias                          xxdnstest02\r\n    address                        172.24.29.68\r\n    host_name                      xxdnstest02.lightningsource.com\r\n    }\r\n\r\nNotice that the first entry of the file, xxdnstest02, has now been duplicated to the bottom of the file inexplicably. No matter what I do, Puppet wants to enforce this. I did some tracing back through Puppet's internals, and inserted some debug statements, and it appears that Puppet is *parsing* the file correctly. My first suspicion was that the comments at the top were causing it to be unable to see the first entry, but that's not the case. It's in the @records variable correctly before it tries to insert the new node. \r\n\r\nThis is the issue that I suspect is related, but may not be. My current suspicion is that Puppet is somehow \"noticing\" that xxnagios01 is absent, and so it then attempts to add xxnagios01 to the file. However, due to whatever the first bug is, it fails to do so, and somehow just winds up copying the first node. \r\n\r\nHowever... on the third run, the config file is unchanged. This is somewhat surprising to me. If Puppet *was* trying to add xxnagios01, and failed, I would expect it to add it again every time, and for the first entry to be reproduced on each subsequent run. As it is, Puppet seems to be happy once the first entry and the last entry are the same, and then it stops trying to add more. \r\n\r\nThis leaves me with a couple of fairly major problems. \r\n\r\n1. I cannot get resources exported from my nagios server to show up in my nagios configs\r\n2. Puppet is ultimately generating *broken* configs. Nagios will not start up when there are duplicate definitions like this, so overall... the feature is failing me. =/ \r\n\r\nI'm running Puppet 2.7.9, with Ruby 1.9.2p290. If I can provide any additional information, please don't hesitate to ask.","closed_at":"2016-10-31T13:31:24.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1086","labels":"nagios;redmine","state":"Closed","updated_at":"2016-10-31T13:31:24.000-0700","timestamp":1652285172.164592,"priority":"Normal","status_category":"Done","pull_request":8500},{"issue_id":"15647","title":"httplog and masterhttplog can be created with incorrect permissions when using WEBrick","url":"https://tickets.puppetlabs.com/browse/PUP-436","created_at":"2013-09-30T10:42:03.000-0700","number":"PUP-436","body":"When setting up logging for the WEBrick server (either running a master on WEBrick or an agent with `\\--listen`), the log file is created with default permissions. This happens because the sections that define those settings are \"used\" immediately before the files are created, so if the files don't exist, their permissions don't get managed until the next time Puppet starts. This also causes the master to fail to start if the agent has run with `\\--listen` once but hasn't run again (because the mode of httplog is wrong, but the master running as puppet isn't allowed to fix it).","closed_at":"2016-10-31T13:31:25.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-436","labels":"","state":"Closed","updated_at":"2016-10-31T13:31:25.000-0700","timestamp":1652285172.690144,"priority":"Normal","status_category":"Done","pull_request":3780},{"issue_id":"21434","title":"puppet agent spawns a shell that gets defunc/zombie","url":"https://tickets.puppetlabs.com/browse/PUP-1094","created_at":"2013-12-16T11:26:01.000-0800","number":"PUP-1094","body":"puppet agent spawns a shell that gets defunc/zombie and gets stuck there.\r\n\r\nIssue exists in both 2.7.6 and 2.7.11.\r\n\r\nI have activated debug.\r\n\r\nA successful run looks like this:\r\n    Mar  6 01:27:02 srzarnsas007 puppet-agent[492]: Retrieving plugin\r\n    Mar  6 01:27:03 srzarnsas007 puppet-agent[492]: Loading facts in /var/lib/puppet/lib/facter/facter_dot_d.rb\r\n    Mar  6 01:27:04 srzarnsas007 puppet-agent[492]: Loading facts in /var/lib/puppet/lib/facter/root_home.rb\r\n    Mar  6 01:27:04 srzarnsas007 puppet-agent[492]: Loading facts in /var/lib/puppet/lib/facter/operatingsystemmajor.rb\r\n    Mar  6 01:27:04 srzarnsas007 puppet-agent[492]: Loading facts in /var/lib/puppet/lib/facter/hpov.rb\r\n    Mar  6 01:27:11 srzarnsas007 puppet-agent[492]: Caching catalog for srzarnsas007.srz.se.tconet.net\r\n    Mar  6 01:27:12 srzarnsas007 puppet-agent[492]: Applying configuration version '1330976728'\r\n    Mar  6 01:27:24 srzarnsas007 puppet-agent[492]: Finished catalog run in 12.18 seconds\r\n    \r\nA unsuccessful run looks like this:\r\n    Mar  6 01:57:27 srzarnsas007 puppet-agent[492]: Retrieving plugin\r\n\r\n# ps aux --forest\r\n    root       492  0.1  3.6 236172 142776 ?       Ss   Mar05   4:27 /opt/tc-puppet/bin/ruby /opt/tc-puppet/sbin/puppetd --verbose\r\n    root     29210  0.0  0.0      0     0 ?        Z    Mar06   0:00  \\_ [sh] <defunct>\r\n\r\n\r\n# /opt/tc-puppet/bin/ruby --version\r\nruby 1.8.7 (2011-06-30 patchlevel 352) [x86_64-linux]\r\n","closed_at":"2016-10-31T13:31:26.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1094","labels":"redmine","state":"Closed","updated_at":"2016-10-31T13:31:26.000-0700","timestamp":1652285172.902617,"priority":"Normal","status_category":"Done","pull_request":8710},{"issue_id":"140732","title":"Windows gem install requires quotes around versions with ~> while linux does not","url":"https://tickets.puppetlabs.com/browse/PUP-6563","created_at":"2016-07-08T18:00:30.000-0700","number":"PUP-6563","body":"If I pass ensure => '~>0.7.0' to gem (or in this case, puppet_gem) provider on windows I'll get this:\r\n\r\nError: Could not update: Execution of 'C:/Program Files/Puppet Labs/Puppet/sys/ruby/bin/gem.bat install -v ~>0.7.0 --no-rdoc --no-ri azure' returned 1: ERROR:  While executing gem ... (Gem::Requirement::BadRequirementError)\r\n    Illformed requirement [\"~\"]\r\n\r\nTo work I need to pass ensure => '\"~0.7.0\"'.  However if I do that, on linux I get: Illformed requirement [\"\\\"~>1.0.0\\\"\"]\r\n\r\nI could put logic in my puppet code to deal with this, but seems like logic in the gem provider would be better.  I've created a pull request for this:\r\nhttps://github.com/puppetlabs/puppet/pull/5104","closed_at":"2016-11-02T06:32:53.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6563","labels":"","state":"Closed","updated_at":"2016-11-02T06:32:53.000-0700","timestamp":1652285186.347163,"priority":"Normal","status_category":"Done","pull_request":5104},{"issue_id":"150171","title":"Puppet should return better errors for Enum mismatches","url":"https://tickets.puppetlabs.com/browse/PUP-6669","created_at":"2016-09-01T05:47:42.000-0700","number":"PUP-6669","body":"given the following code:\r\n\r\n{code}\r\ndefine foo (\r\n  Optional[Enum['foo', 'bar']] $x\r\n){\r\n  notify { $x: }\r\n}\r\nfoo { 'lolnope':\r\n  x => 'baz',\r\n}\r\n{code}\r\n\r\nPuppet will return this Error:\r\n\r\n{code}\r\nError: Evaluation Error: Error while evaluating a Resource Statement, Foo[lolnope]:\r\n  parameter 'x' expects a match for Enum['bar', 'baz'], got String  at /tmp/foo.pp:6 on node levix\r\n{code}\r\n\r\n(note the suspicious additional blank)\r\n\r\nmy naïve patch:\r\n{code}\r\ndiff --git a/lib/puppet/pops/types/type_mismatch_describer.rb b/lib/puppet/pops/types/type_mismatch_describer.rb\r\nindex 98763ad..3f11e96 100644\r\n--- a/lib/puppet/pops/types/type_mismatch_describer.rb\r\n+++ b/lib/puppet/pops/types/type_mismatch_describer.rb\r\n@@ -578,7 +578,7 @@ module Types\r\n         value = param_hash[name]\r\n         value_type = elem.value_type\r\n         if param_hash.include?(name)\r\n-          result << describe(value_type, TypeCalculator.singleton.infer_set(value).generalize, [ParameterPathElement.new(name)]) unless value_type.instance?(value)\r\n+          result << describe(value_type, TypeCalculator.singleton.infer_set(value), [ParameterPathElement.new(name)]) unless value_type.instance?(value)\r\n         else\r\n           result << MissingParameter.new(nil, name) unless elem.key_type.assignable?(PUndefType::DEFAULT) unless missing_ok\r\n         end\r\n{code}\r\n\r\nworks for this case:\r\n\r\n{code}\r\nError: Evaluation Error: Error while evaluating a Resource Statement, Foo[lolnope]:\r\n  parameter 'x' expects a match for Enum['bar', 'baz'], got String 'baz' at /tmp/foo.pp:6 on node levix\r\n{code}\r\n\r\n but breaks other types — in particular the new Sensitive type.\r\n","closed_at":"2016-11-02T06:32:53.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6669","labels":"","state":"Closed","updated_at":"2016-11-02T06:32:53.000-0700","timestamp":1652285186.769157,"priority":"Normal","status_category":"Done","pull_request":5253},{"issue_id":"154565","title":"calling_all_functions test fails on master","url":"https://tickets.puppetlabs.com/browse/PUP-6766","created_at":"2016-09-30T16:57:43.000-0700","number":"PUP-6766","body":"The full error output:\r\n\r\n{code}\r\n16:49:29 Failed Tests Cases:\r\n16:49:29   Test Case tests/parser_functions/calling_all_functions.rb reported: #<Minitest::Assertion: map output didn't match expected value.\r\n16:49:29 Expected /Map:\\ Scope\\(Class\\[main\\]\\):\\ \\[7,\\ 8,\\ 9\\]/ to match \"\\e[mNotice: Scope(Class[main]): sayeth Assert_type: Scope(Class[main]): Valar morghulis\\e[0m\\n\\e[mNotice: Scope(Class[main]): 1\\e[0m\\n\\e[mNotice: Scope(Class[main]): 2\\e[0m\\n\\e[mNotice: Scope(Class[main]): 3\\e[0m\\n\\e[mNotice: Scope(Class[main]): sayeth Each: Scope(Class[main]): [1, 2, 3]\\e[0m\\n\\e[mNotice: Scope(Class[main]): sayeth Epp: Scope(Class[main]): This is the droid you are looking for!\\e[0m\\n\\e[mNotice: Scope(Class[main]): sayeth Filter: Scope(Class[main]): [4, 5, 6]\\e[0m\\n\\e[mNotice: Scope(Class[main]): sayeth Inline_epp: Scope(Class[main]): 10\\e[0m\\n\\e[mNotice: Scope(Class[main]): 7\\e[0m\\n\\e[mNotice: Scope(Class[main]): 8\\e[0m\\n\\e[mNotice: Scope(Class[main]): 9\\e[0m\\n\\e[mNotice: Scope(Class[main]): sayeth Map: Scope(Class[main]): [, , ]\\e[0m\\n\\e[mNotice: Scope(Class[main]): sayeth Match: Scope(Class[main]): [b]\\e[0m\\n\\e[mNotice: Scope(Class[main]): sayeth Reduce: Scope(Class[main]): 15\\e[0m\\n\\e[mNotice: Scope(Class[main]): sayeth Slice: Scope(Class[main]): [[1, 2], [3, 4], [5, 6]]\\e[0m\\n\\e[mNotice: Scope(Class[main]): sayeth Strftime: Scope(Class[main]): 42\\e[0m\\n\\e[mNotice: Scope(Class[main]): [1, Catelyn]\\e[0m\\n\\e[mNotice: Scope(Class[main]): sayeth With: Scope(Class[main]): \\e[0m\\n\\e[mNotice: Compiled catalog for j98z11kw650x3fl.delivery.puppetlabs.net in environment production in 0.11 seconds\\e[0m\\n\\e[0;32mInfo: Applying configuration version '1475278825'\\e[0m\\n\\e[mNotice: Applied catalog in 0.02 seconds\\e[0m\\n\".>\r\n16:49:29     Test line: tests/parser_functions/calling_all_functions.rb:176:in `block (4 levels) in run_test'\r\n{code}\r\n\r\nThe specific bit that failed was:\r\nhttps://github.com/puppetlabs/puppet/blob/832d27d4d745bbc8e65b2433020f3c2e15acedf2/acceptance/tests/parser_functions/calling_all_functions.rb#L95\r\n\r\n{code}\r\nExpected /Map:\\ Scope\\(Class\\[main\\]\\):\\ \\[7,\\ 8,\\ 9\\]/ to match sayeth Map: Scope(Class[main]): [, , ]\\e[0m\\n\\e[mNotice: Scope(Class[main]):\r\n{code}","closed_at":"2016-11-02T06:32:53.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6766","labels":"","state":"Closed","updated_at":"2016-11-02T06:32:53.000-0700","timestamp":1652285186.981309,"priority":"Normal","status_category":"Done","pull_request":5311},{"issue_id":"137716","title":"Regex of ssh_authorized_keys can't match lines with multi spaces as field separator","url":"https://tickets.puppetlabs.com/browse/PUP-6417","created_at":"2016-06-18T07:47:33.000-0700","number":"PUP-6417","body":"Regex for authorized_keys can't match lines with multi spaces as field separator. The regex in type ssh_authorized_keys is:\r\n\r\n{code:ruby}\r\nREGEX = /^(?:(.+) )?(ssh-dss|ssh-ed25519|ssh-rsa|ecdsa-sha2-nistp256|ecdsa-sha2-nistp384|ecdsa-sha2-nistp521) ([^ ]+) ?(.*)$/\r\n{code}\r\n\r\nThis regext can't match lines with multi spaces as field separator like:\r\n\r\n{code:bash}\r\n$ cat ~/.ssh/authorized_keys\r\nssh-rsa    PUBLIC_KEY_CONTENT    COMMENT    # This line is separated by multi spaces\r\n{code}","closed_at":"2016-11-02T06:32:54.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6417","labels":"","state":"Closed","updated_at":"2016-11-02T06:32:54.000-0700","timestamp":1652285187.296027,"priority":"Normal","status_category":"Done","pull_request":5032},{"issue_id":"153807","title":"race condition smf and manifest-import","url":"https://tickets.puppetlabs.com/browse/PUP-6749","created_at":"2016-09-27T16:32:51.000-0700","number":"PUP-6749","body":"by default pkg install/update does not wait for smf actuators to finish before continuing \r\n\r\nReported Problem:\r\n\r\nI've observed several instances of puppet installing a package and then \r\ntrying to start a service or modify service properties, resulting in failures \r\nnoting that the service doesn't exist.\r\n\r\nFor example:\r\n\r\nsvcadm enable -rs nova-conductor:default claims that nova-conductor:upgrade \r\ndoesn't exist as s service.\r\n\r\nsvccfg -s keystone:default setprop claims that keystone:default doesn't \r\nexist.\r\n\r\nIf you go look at the system later, they do exist.\r\n\r\nI've caught it in action several times and this is the problem:\r\n{code}\r\nroot@lilcloud-controller:~# svcs -x\r\nsvc:/system/manifest-import:default (service manifest import)\r\n State: offline* transitioning to online since Thu Apr 14 13:07:43 2016\r\nReason: Start method is running.\r\n   See: http://support.oracle.com/msg/SMF-8000-C4\r\n   See: smf_bootstrap(7)\r\n   See: /var/svc/log/system-manifest-import:default.log\r\nImpact: This service is not running.\r\n{code}\r\n\r\nThe system is restarting and sometimes it has 15-20 manifests to import, so \r\nit is taking some time.\r\n\r\nThe puppet provider needs to wait for this service to quiesce before it \r\nconsiders the package actually installed.\r\n","closed_at":"2016-11-02T06:32:55.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6749","labels":"maintenance","state":"Closed","updated_at":"2016-11-02T06:32:55.000-0700","timestamp":1652285187.612767,"priority":"Normal","status_category":"Done","pull_request":5301},{"issue_id":"155327","title":"Ensuring latest does not use upgrade command in DNF","url":"https://tickets.puppetlabs.com/browse/PUP-6798","created_at":"2016-10-05T14:47:15.000-0700","number":"PUP-6798","body":"tl;dr using ensure latest with a previous install will use the install command in dnf, which does not upgrade the package:\r\n\r\n{code}\r\nDebug: /Stage[main]/Main/Package[cockpit]/ensure: cockpit \"0.55-1.fc22\" is installed, latest is \"0:0.67-2.fc22\"\r\n  Debug: Package[cockpit](provider=dnf_update): Ensuring => latest\r\n  Debug: Executing: '/usr/bin/dnf -d 0 -e 1 -y install cockpit'\r\n  Notice: /Stage[main]/Main/Package[cockpit]/ensure: ensure changed '0.55-1.fc22' to '0:0.67-2.fc22'\r\n  Debug: /Stage[main]/Main/Package[cockpit]: The container Class[Main] will propagate my refresh event\r\n{code}\r\n\r\nThe original issue of failing to update when a new version is specified was fixed in https://tickets.puppetlabs.com/browse/PUP-6324, but the code doesn't cover the case of a package that is installed, then later attempted to update with ensure => latest. ","closed_at":"2016-11-02T06:32:55.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6798","labels":"maintenance","state":"Closed","updated_at":"2016-11-02T06:32:55.000-0700","timestamp":1652285187.71628,"priority":"Normal","status_category":"Done","pull_request":5318},{"issue_id":"144326","title":"launchd service provider crashes if a non-text or binary plist file in {System,}/Library/Launch{Daemons,Agents} directory exists","url":"https://tickets.puppetlabs.com/browse/PUP-6568","created_at":"2016-08-01T12:25:23.000-0700","number":"PUP-6568","body":"If a file in the LaunchAgents or LaunchDaemons paths is encountered that's not:\r\n* a plain text file (plist or not)\r\n* a binary plist file (magic 'bplist00')\r\n\r\nthen Puppet will crash with an error.\r\n\r\nTo reproduce:\r\n{code}\r\n# cp /bin/ls /Library/LaunchDaemons\r\n# puppet resource service\r\nError: Could not run: invalid byte sequence in UTF-8\r\n{code}\r\n\r\nIn [plist.rb line 34|https://github.com/puppetlabs/puppet/blob/ed209118fceb6433b51c88c10883cb7415b36adb/lib/puppet/util/plist.rb#L34] there's a check if it’s a binary plist or not.\r\n\r\nIn the case of a binary blob that's on a binary plist, this will fail, and fall through to [parse_plist on line 55|https://github.com/puppetlabs/puppet/blob/ed209118fceb6433b51c88c10883cb7415b36adb/lib/puppet/util/plist.rb#L55], which tries to check the file's contents against the {{bad_xml_doctype]} regex.\r\n\r\nThis fails because of the encoding.\r\n\r\nI expect the correct course of action is to handle the {{ArgumentError}} and return {{nil}}","closed_at":"2016-11-02T06:32:55.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6568","labels":"","state":"Closed","updated_at":"2016-11-02T06:32:55.000-0700","timestamp":1652285187.820771,"priority":"Normal","status_category":"Done","pull_request":5162},{"issue_id":"141775","title":"Multiple tidy resources with same path but different matches causes an error","url":"https://tickets.puppetlabs.com/browse/PUP-6508","created_at":"2016-07-15T07:53:57.000-0700","number":"PUP-6508","body":"Having multiple {{tidy}} resources with the same {{path}} but different {{matches}} parameters causes an error:\r\n{code}\r\n$ puppet apply -e '\r\n> tidy { \"test1\":\r\n>   path => \"/tmp/tidy\",\r\n>   matches => \"some-regex.*\",\r\n>   recurse => true,\r\n> }\r\n> tidy { \"test2\":\r\n>   path => \"/tmp/tidy\",\r\n>   matches => \"some-other-regex.*\",\r\n>   recurse => true,\r\n> }\r\n> '\r\nNotice: Compiled catalog for derezzed.roam.corp.google.com in environment production in 0.05 seconds\r\nError: Cannot alias Tidy[test2] to [\"/tmp/tidy\"]; resource [\"Tidy\", \"/tmp/tidy\"] already declared\r\n{code}\r\n\r\nThe error is thrown during [catalog generation|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/resource/catalog.rb#L189], the key passed into that alias method comes from the resource's [{{uniqueness_key}}|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/resource/catalog.rb#L161] and class. The {{uniqueness_key}} is [generated|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/type.rb#L436] from the type's {{key_attributes}} which are all parameters that are [marked \"isnamevar\" or are called name|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/type.rb#L377]. The parameter Tidy declares {{isnamevar}} is [{{path}}|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/type/tidy.rb#L22], so having multiple Tidy resources with the same {{path}} will fail even if they have different {{matches}} parameters.","closed_at":"2016-11-02T06:32:55.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6508","labels":"","state":"Closed","updated_at":"2016-11-02T06:32:55.000-0700","timestamp":1652285187.925172,"priority":"Normal","status_category":"Done","pull_request":5121},{"issue_id":"148349","title":"Puppet::Agent class accepts Report but no way to use correct transaction_uuid","url":"https://tickets.puppetlabs.com/browse/PUP-6642","created_at":"2016-08-22T09:13:06.000-0700","number":"PUP-6642","body":"The {{Puppet::Agent}} class provides a way to pass client options, that can be used to pass in a Report and then access the Report after the Agent run has finished. However, if the Report is initialized outside of Configurer, it can't have the correct transaction_uuid.\r\n\r\nProvide a way to access the Report after an Agent run, with the correct data in the Report.","closed_at":"2016-11-02T06:32:56.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6642","labels":"","state":"Closed","updated_at":"2016-11-02T06:32:56.000-0700","timestamp":1652285188.029623,"priority":"Normal","status_category":"Done","pull_request":5213},{"issue_id":"151091","title":"Warn/error if $trusted_server_data is assigned if not in --trusted_server_facts mode and --strict is on","url":"https://tickets.puppetlabs.com/browse/PUP-6693","created_at":"2016-09-09T05:20:24.000-0700","number":"PUP-6693","body":"We are planning to throw the switch on {{\\--trusted_server_data}} in Puppet 5.0.0 (PUP-6612). The current implementation does however not issue a deprecation warning for an assignment to {{$server_facts}} and it would then simply error on 5.0.0.\r\n\r\nTo make that better, we can use {{\\--strict}} to control if assignment to {{$server_facts}} should be a warning, error, or be ignored. That gives users a chance to fix this before they upgrade.","closed_at":"2016-11-02T06:32:56.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6693","labels":"","state":"Closed","updated_at":"2016-11-02T06:32:56.000-0700","timestamp":1652285188.238032,"priority":"Normal","status_category":"Done","pull_request":5268},{"issue_id":"150545","title":"$settings leaks symbols into manifests","url":"https://tickets.puppetlabs.com/browse/PUP-6682","created_at":"2016-09-06T06:49:40.000-0700","number":"PUP-6682","body":"{code}\r\n% puppet apply -e '$be = $settings::storeconfigs_backend notice(inline_template(\"<%= @be.class %>\"))'\r\nNotice: Scope(Class[main]): Symbol\r\n{code}\r\n\r\nand therefore\r\n\r\n{code}\r\n% puppet apply -e 'notice($settings::storeconfigs_backend == \"puppetdb\")'\r\nNotice: Scope(Class[main]): false\r\n{code}\r\n\r\nThis stuff should be stringified I guess, and in general $settings is just horrible and should be a hash.","closed_at":"2016-11-02T06:32:56.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6682","labels":"","state":"Closed","updated_at":"2016-11-02T06:32:56.000-0700","timestamp":1652285188.462598,"priority":"Normal","status_category":"Done","pull_request":5265},{"issue_id":"153936","title":"Puppet log functions should return Undef rather than a Puppet::Util::Log object","url":"https://tickets.puppetlabs.com/browse/PUP-6753","created_at":"2016-09-28T09:57:12.000-0700","number":"PUP-6753","body":"Currently, the log functions (like {{lib/puppet/functions/alert.rb}}) return an instance of a {{Puppet::Util::Log}} object. Some context from Henrik:\r\n\r\n[9:26 AM] Henrik Lindberg: so, it returns some kind of Log object, which is not good when these functions are called from puppet as that object leaks into the puppet world\r\n[9:27 AM] Henrik Lindberg: when they were 3x functions there is a general mechanism where all \"non r-value\" type functions always are made to return nil to puppet\r\n[9:27 AM] Henrik Lindberg: there is no such thing in 4.x, all functions are rvalue functions, only that they return nil if they have nothing meaningful to return\r\n[9:29 AM] Henrik Lindberg: now, we may not be able to change the return to Undef actually - because people may call the puppet functions from Ruby and expect to get a Log object\r\n[9:33 AM] Henrik Lindberg: Problem: if we document it as Undef, it is correct from a spec standoint, and thus it is a bug that it actually returns Log sometimes\r\n[9:34 AM] Henrik Lindberg: if we document it what it really is {{Optional[Runtime['ruby', 'Puppet::Util::Log']]}}, that is really confusing, and you cannot really do much with that value\r\n[9:34 AM] Henrik Lindberg: I think it is best to document it as Undef, and add a ticket that logging functions should return undef and never the log object instance.\r\nThose that code in ruby and need the Util::Log object should instead do the logging themselves and not call the puppet functions\r\n\r\nThese functions now use a log helper in {{lib/puppet/util/log.rb}}. They end up returning:\r\n\r\n{code}\r\nPuppet::Util::Log.create({:level => level, :source => scope, :message => vals.join(\" \")})\r\n{code}","closed_at":"2016-11-02T06:32:56.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6753","labels":"","state":"Closed","updated_at":"2016-11-02T06:32:56.000-0700","timestamp":1652285188.567197,"priority":"Normal","status_category":"Done","pull_request":5307},{"issue_id":"155561","title":"PEZ 2016.5.x mono smoke integration fails with Unable to serialize non-Data type parameters unless a serializer is provided","url":"https://tickets.puppetlabs.com/browse/PUP-6799","created_at":"2016-10-06T13:22:53.000-0700","number":"PUP-6799","body":"https://jenkins.puppetlabs.com/job/enterprise_pe-acceptance-tests-feature-branch_integration-system_pe_fb_smoke-monolithic_2016.5.x/LAYOUT=64mcd,LEGACY_AGENT_VERSION=NONE,PLATFORM=redhat7,UPGRADE_FROM=NONE,label=beaker/7/console\r\n\r\nPEZ fails with the following in setup:\r\n\r\n{code}\r\n19:50:16     \tError: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Unable to serialize non-Data type parameters unless a serializer is provided\r\n{code}\r\n\r\nThis was likely caused by this series of commits (part of PUP-5834): https://github.com/puppetlabs/puppet/commit/375bdeefef79e3984f1d53db04e14c94e5a3d30c","closed_at":"2016-11-02T06:32:57.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6799","labels":"","state":"Closed","updated_at":"2016-11-02T06:32:57.000-0700","timestamp":1652285188.67123,"priority":"Blocker","status_category":"Done","pull_request":5319},{"issue_id":"141582","title":"puppet calls dscl pathologically often","url":"https://tickets.puppetlabs.com/browse/PUP-6502","created_at":"2016-07-13T14:45:54.000-0700","number":"PUP-6502","body":"A typical macOS puppet run triggers around 125 executions of {{/usr/bin/dscl}}; most of these are the user directoryservices provider calling {{/usr/bin/dscl -plist . read /Users/<username> ShadowHashData}} for every user on the system.\r\n\r\nThe provider already calls {{/usr/bin/dscl -plist . -readall /Users}}, however, and this plist contains the {{ShadowHashData}} for all the users.\r\n\r\nI think with some better memoization we can reduce the number of execs dramatically.","closed_at":"2016-11-02T06:32:57.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6502","labels":"","state":"Closed","updated_at":"2016-11-02T06:32:57.000-0700","timestamp":1652285188.993301,"priority":"Normal","status_category":"Done","pull_request":5217},{"issue_id":"150928","title":"Timespan and Timestamp should inherit from Scalar, not from Numeric","url":"https://tickets.puppetlabs.com/browse/PUP-6689","created_at":"2016-09-08T06:15:35.000-0700","number":"PUP-6689","body":"Timespan and Timestamp currently inherits from Numeric. This is incorrect since they break the Numeric contract. They should instead inherit directly from Scalar.","closed_at":"2016-11-02T06:32:57.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6689","labels":"","state":"Closed","updated_at":"2016-11-02T06:32:57.000-0700","timestamp":1652285189.097824,"priority":"Normal","status_category":"Done","pull_request":5263},{"issue_id":"154526","title":"Using produce/consume results in 'Attempt to redefine entity' errors","url":"https://tickets.puppetlabs.com/browse/PUP-6765","created_at":"2016-09-30T15:45:14.000-0700","number":"PUP-6765","body":"Using generated pcore resource types in combination with app management produce/consume\r\ndeclarations fails with 'Attempt to redefine entity' errors.","closed_at":"2016-11-02T06:32:57.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6765","labels":"","state":"Closed","updated_at":"2016-11-02T06:32:57.000-0700","timestamp":1652285189.203363,"priority":"Normal","status_category":"Done","pull_request":5310},{"issue_id":"152535","title":"PCore generation omits information about capability types","url":"https://tickets.puppetlabs.com/browse/PUP-6714","created_at":"2016-09-19T13:42:52.000-0700","number":"PUP-6714","body":"Given a capability resource type definition:\r\n\r\n{code}\r\nPuppet::Type.newtype :cap, :is_capability => true do\r\n  newparam :name, :is_namevar => true\r\n  newparam :value\r\nend\r\n{code}\r\n\r\nthe generated PCore looks something like:\r\n\r\n{code}\r\n# This file was automatically generated on 2016-09-19 13:38:35 -0700.\r\n# Use the 'puppet generate types' command to regenerate this file.\r\n\r\nPuppet::Resource::ResourceType3.new(\r\n  'cap',\r\n  [\r\n\r\n  ],\r\n  [\r\n    Puppet::Resource::Param(Any, 'name'),\r\n\r\n    Puppet::Resource::Param(Any, 'value')\r\n  ],\r\n  {\r\n    /(.*)/ => ['name']\r\n  },\r\n  true)\r\n{code}\r\n\r\nThe PCore version has lost the {{:is_capability => true}} flag, causing the resource type to behave like any other type. Since there's special handling of capabilities with regard to how/when they're validated and looked up from PuppetDB, this effectively breaks the app management features when using {{puppet generate}}.","closed_at":"2016-11-02T06:32:58.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6714","labels":"","state":"Closed","updated_at":"2016-11-02T06:32:58.000-0700","timestamp":1652285189.623243,"priority":"Major","status_category":"Done","pull_request":5298},{"issue_id":"153124","title":"The new strftime function is not compatible with the strftime function in stdlib.","url":"https://tickets.puppetlabs.com/browse/PUP-6724","created_at":"2016-09-22T02:10:37.000-0700","number":"PUP-6724","body":"The {{strftime}} function in [puppetlabs-stdlib|https://github.com/puppetlabs/puppetlabs-stdlib/blob/72f6e379a647396c276d7f216b307361ac76f376/lib/puppet/parser/functions/strftime.rb] and the new {{strftime}} function added as part of PUP-5871 are not compatible. The one from stdlib has the following API:\r\n{code:puppet}\r\nString strftime(String format, String timezone = undef)\r\n{code}\r\nwhereas the API of the new function is:\r\n{code:puppet}\r\nString strftime(Variant[Timespan,Timestamp], String format)\r\n{code}\r\n\r\nAs part of this change, a third optional timezone argument should also be added, to allow the given time to be formatted in accordance with that timezone.","closed_at":"2016-11-02T19:15:58.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6724","labels":"","state":"Closed","updated_at":"2016-11-02T19:15:58.000-0700","timestamp":1652285190.258674,"priority":"Blocker","status_category":"Done","pull_request":5292},{"issue_id":"126561","title":"Mount resources could handle invalid options better","url":"https://tickets.puppetlabs.com/browse/PUP-6457","created_at":"2016-04-13T17:27:41.000-0700","number":"PUP-6457","body":"If I specify in a manifest:\r\n\r\n{code:java}\r\nmount { '/var/tmp':\r\n      ensure      => 'mounted',\r\n      device      => '/dev/sdb1',\r\n      fstype      => 'ext4',\r\n      options     => 'ro,nosuid,noexec,foo,bar',\r\n      atboot      => true,\r\n      dump        => '0',\r\n      pass        => '0',\r\n      remounts => true,\r\n    }\r\n{code}\r\n\r\n...puppet will add an entry to /etc/fstab:\r\n\r\n{code:java}\r\n# cat /etc/fstab | grep /var/tmp\r\n/dev/sdb1\t/var/tmp\text4\tro,nosuid,noexec,foo,bar\t  0\t0\r\n{code}\r\n\r\n...and the remount attempt will spawn an error:\r\n\r\n{code:java}\r\nError: /Stage[main]/Mounts/Mount[/var/tmp]: Execution of '/bin/mount -o remount /var/tmp' returned 32: mount: /var/tmp not mounted already, or bad option\r\n{code}\r\n\r\n...however subsequent runs will not reattempt the remount and will ignore the discrepancy between /etc/fstab and the actual mounted volume.\r\n\r\nCould there be output in subsequent puppet runs that points out the discrepancy?","closed_at":"2016-11-04T00:16:18.000-0700","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6457","labels":"","state":"Closed","updated_at":"2016-11-04T00:16:18.000-0700","timestamp":1652285190.372317,"priority":"Normal","status_category":"Done","pull_request":5379},{"issue_id":"119284","title":"Stray UTF-8 character in manifest corrupts parsed parameters","url":"https://tickets.puppetlabs.com/browse/PUP-5995","created_at":"2016-03-01T10:38:42.000-0800","number":"PUP-5995","body":"If I have the {{Puppet::InfoService::ClassInformationService}} or {{resource_types}} endpoint parse a manifest which includes a special UTF-8 character, the resulting default values parsed for parameters appear to be corrupted.\r\n\r\nHere is the manifest file I used for this test, also attached as \"parse.pp\":\r\n\r\n{code:puppet}\r\nclass myclass (\r\n   String $a_string = \"this is a Ѐ string\",\r\n   Integer $an_integer = 3,\r\n) {}\r\n{code}\r\n\r\nNote that the character at the end of the comment line is a Cyrillic Capital letter Ye with grave, Unicode code point of U+0400, hex representation of 0xD080 in UTF-8 in the file.\r\n \r\nRunning the following code...\r\n\r\n{code:ruby}\r\nrequire 'puppet'\r\nrequire 'puppet/info_service'\r\n\r\nfiles_to_parse = { \"production\" => [ \"./parse.pp\" ] }\r\n\r\nputs Puppet::InfoService::ClassInformationService.new.classes_per_environment(files_to_parse)\r\n{code}\r\n\r\n... produces the following output:\r\n\r\n{noformat}\r\n{\"production\"=>{\"./parse.pp\"=>{:classes=>[{:name=>\"myclass\", :params=>[{:name=>\"a_string\", :type=>\"String\", :default_literal=>\"this is a Ѐ string\", :default_source=>\"\\\"this is a Ѐ string\\\",\"}, {:name=>\"an_integer\", :type=>\"Integer\", :default_literal=>3, :default_source=>\",\"}]}]}}}\r\n{noformat}\r\n\r\nThe `:default_literal` values for each parameter appear to be correct but the `:default_source` values do not.  Instead of \"\\\"this is a Ѐ string\\\",\", I would have expected \"\\\"this is a Ѐ string\\\"\".  Instead of \",\", I would have expected \"3\".\r\n\r\nThis problem does not appear to be unique to the {{ClassInformationService}}.  I get the same error when I use the \"resource_types\" endpoint to query for this data.  For a query to \"https://localhost:8140/puppet/v3/resource_types/*?kind=class&environment=production\" where the \"parse.pp\" file is stored under the \"<code-dir>/environments/production/modules/mymodule/manifests\" directory, I get the following response (pretty-printed for display):\r\n\r\n{noformat}\r\n[\r\n    {\r\n        \"kind\": \"class\",\r\n        \"line\": 2,\r\n        \"name\": \"myclass\",\r\n        \"parameters\": {\r\n            \"a_string\": \"\\\"this is a Ѐ string\\\",\",\r\n            \"an_integer\": \",\"\r\n        }\r\n    }\r\n]\r\n{noformat}","closed_at":"2016-11-04T15:11:20.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5995","labels":"utf-8","state":"Closed","updated_at":"2016-11-04T15:11:20.000-0700","timestamp":1652285190.584366,"priority":"Major","status_category":"Done","pull_request":4745},{"issue_id":"160528","title":"Spec tests fail when run on a windows host whose name exceeds 15 characters","url":"https://tickets.puppetlabs.com/browse/PUP-6913","created_at":"2016-11-10T13:57:28.000-0800","number":"PUP-6913","body":"Our windows jenkins agents in CI.Next have hostnames (not fqdn) longer than 15 characters. As a result {{Socket.gethostname}} and Win32 {{GetComputerName}} return different results (the former is a truncated version of the latter), e.g. {{jenkins-slave-w}}  vs {{jenkins-slave-win2012r2-...}}\r\n\r\nTwo tests in {{spec/integration/util/windows/principal_spec.rb}} fail because they are using {{Socket.gethostname}} when they instead need to use {{GetComputerName}} in subsequent calls to {{LookupAccountNameW}}.\r\n\r\n{noformat}\r\n07:11:29   1) Puppet::Util::Windows::SID::Principal.lookup_account_name should create an instance from a local account prefixed with hostname\r\n07:11:29      Failure/Error: Puppet::Util::Windows::SID.sid_to_name(computer_sid.sid + '-500').split('\\\\').last :\r\n07:11:29      NoMethodError:\r\n07:11:29        undefined method `sid' for nil:NilClass\r\n07:11:29      # ./spec/integration/util/windows/principal_spec.rb:58:in `block (3 levels) in <top (required)>'\r\n07:11:29 \r\n07:11:29   2) Puppet::Util::Windows::SID::Principal.lookup_account_sid should create an instance from a user SID\r\n07:11:29      Failure/Error: bytes = (computer_sid.sid_bytes + [245, 1, 0, 0])\r\n07:11:29      NoMethodError:\r\n07:11:29        undefined method `sid_bytes' for nil:NilClass\r\n07:11:29      # ./spec/integration/util/windows/principal_spec.rb:125:in `block (3 levels) in <top (required)>'\r\n07:11:32 \r\n07:11:32 Finished in 22 minutes 37 seconds\r\n07:11:32 21740 examples, 2 failures, 67 pending\r\n{noformat}","closed_at":"2016-11-22T14:58:50.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6913","labels":"","state":"Closed","updated_at":"2016-11-22T14:58:50.000-0800","timestamp":1652285192.002651,"priority":"Normal","status_category":"Done","pull_request":5373},{"issue_id":"159671","title":"Puppet::Settings::IniFile doesn't handle Unicode keys / sections properly - can cause `config set` / `config print` failures","url":"https://tickets.puppetlabs.com/browse/PUP-6876","created_at":"2016-11-03T14:43:19.000-0700","number":"PUP-6876","body":"While working on PUP-6188, it was discovered that {{puppet config set}} and {{puppet config print}} did not behave properly when using UTF-8 characters in the {{puppet.conf}} INI file.\r\n\r\nThis was traced back to a problem in {{Puppet::Settings::IniFile}} and it's ability to properly parse key / value pairs.  In particular, RegEx {{\\w}} character class doesn't work for Unicode, but {{[[:word:]]}} does - see more details in PUP-6875\r\n\r\nNote that there might be 2 separate INI file parsers inside Puppet itself, and another in the INI module that might be worth investigating here.","closed_at":"2016-11-22T14:58:51.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6876","labels":"","state":"Closed","updated_at":"2016-11-22T14:58:51.000-0800","timestamp":1652285192.104401,"priority":"Normal","status_category":"Done","pull_request":5361},{"issue_id":"142789","title":"Windows parallel specs fail","url":"https://tickets.puppetlabs.com/browse/PUP-6534","created_at":"2016-07-21T16:23:06.000-0700","number":"PUP-6534","body":"PUP-5938 added some spec tests which fail when using the parallel spec runner on windows\r\n\r\n{code}\r\nFailures:\r\n\r\n  1) Puppet::Type::Group::ProviderWindows_adsi should be able to test whether a group exists\r\n     Failure/Error: expect(provider).to be_exists\r\n       expected `Group[testers](provider=windows_adsi).exists?` to return true, got false\r\n     # ./spec/unit/provider/group/windows_adsi_spec.rb:250:in `block (2 levels) in <top (required)>'\r\n     # util/rspec_runner:39:in `run'\r\n     # util/rspec_runner:53:in `<main>'\r\n  2) Puppet::Type::User::ProviderWindows_adsi should be able to test whether a user exists\r\n     Failure/Error: expect(provider).to be_exists\r\n       expected `User[testuser](provider=windows_adsi).exists?` to return true, got false\r\n     # ./spec/unit/provider/user/windows_adsi_spec.rb:253:in `block (2 levels) in <top (required)>'\r\n     # util/rspec_runner:39:in `run'\r\n     # util/rspec_runner:53:in `<main>'\r\nFinished in 33.82 seconds (files took 5.88 seconds to load)\r\n\r\nFinished in 5 minutes 57 seconds\r\n21401 examples, 2 failures, 62 pending\r\n\r\nFailed examples:\r\nrspec ./spec/unit/provider/group/windows_adsi_spec.rb:247 # Puppet::Type::Group::ProviderWindows_adsi should be able to test whether a group exists\r\nrspec ./spec/unit/provider/user/windows_adsi_spec.rb:250 # Puppet::Type::User::ProviderWindows_adsi should be able to test whether a user exists\r\n{code}\r\n\r\nThis is occuring in local dev environment and on Appveyor","closed_at":"2016-11-22T14:58:51.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6534","labels":"","state":"Closed","updated_at":"2016-11-22T14:58:51.000-0800","timestamp":1652285192.208483,"priority":"Normal","status_category":"Done","pull_request":5359},{"issue_id":"159344","title":"[regression] Mount options not idempotent","url":"https://tickets.puppetlabs.com/browse/PUP-6861","created_at":"2016-11-02T02:01:27.000-0700","number":"PUP-6861","body":"After upgrading to Puppet 4.8.0, I keep seeing Puppet reports along the following lines:\r\n\r\n{noformat}\r\n2016-11-02 09:32:16 +0100 /Stage[main]/Mount[/]/options (notice): options changed 'defaults,acl,user_xattr' to 'defaults,acl,user_xattr'\r\n2016-11-02 09:32:16 +0100 /Stage[main]/Mount[/] (notice): Triggered 'refresh' from 1 events\r\n2016-11-02 09:32:17 +0100 /Stage[main]/Mount[/var/redacted]/options (notice): options changed 'rw,bind,acl' to 'rw,bind,acl'\r\n2016-11-02 09:32:17 +0100 /Stage[main]/Mount[/var/redacted] (notice): Triggered 'refresh' from 1 events\r\n{noformat}\r\n\r\nEven though the actual mount options are identical to the desired state, Puppet keeps thinking they are out-of-sync and re-mounting the mount point. This worked fine with Puppet 4.7.x.","closed_at":"2016-11-22T14:58:52.000-0800","comments":27,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6861","labels":"regression","state":"Closed","updated_at":"2016-11-22T14:58:52.000-0800","timestamp":1652285192.421833,"priority":"Major","status_category":"Done","pull_request":5379},{"issue_id":"108376","title":"confine :exists => \"/run/systemd/system\" breaks chroot installation","url":"https://tickets.puppetlabs.com/browse/PUP-5577","created_at":"2015-12-03T18:12:09.000-0800","number":"PUP-5577","body":"The line\r\n\r\n{code:puppet}\r\nconfine :exists => \"/run/systemd/system\" \r\n{code}\r\n\r\nwas added with [1] but breaks running puppet within a chroot environment that doesn't have /run mounted.  When puppet doesn't see this directory, it assumes systemd isn't there and ends up falling back to \"chkconfig\" for service enablement which is quite confusing\r\n\r\n[1] https://github.com/puppetlabs/puppet/commit/7fe61647f23650fc4c93cd6b54c654a20ff7c9f9","closed_at":"2016-11-23T11:09:54.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5577","labels":"","state":"Closed","updated_at":"2016-11-23T11:09:54.000-0800","timestamp":1652285192.631243,"priority":"Normal","status_category":"Done","pull_request":4481},{"issue_id":"147668","title":"Corrective change should use property values directly, bypassing any munging","url":"https://tickets.puppetlabs.com/browse/PUP-6628","created_at":"2016-08-17T11:23:06.000-0700","number":"PUP-6628","body":"Currently, corrective change uses the \"correct\" should readers/writers for property values. Unfortunately, properties may have {{munge}} and {{unmunge}} implementations that are not symmetrical, and in some cases this can cause both {{should=}} and {{validate}} to fail for those types.\r\n\r\nIf we update corrective_change to be a bit more aggressive when inspecting property values, we can avoid the entire munge/unmunge/validate dance, and simply inject data directly into the property in exactly the same form that we pull it out.\r\n\r\nThis may causes issues if internal representations of data change between versions of properties, but corrective change reporting is already likely to be flaky in those cases.","closed_at":"2016-11-30T21:30:37.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6628","labels":"","state":"Closed","updated_at":"2016-11-30T21:30:37.000-0800","timestamp":1652285206.156664,"priority":"Normal","status_category":"Done","pull_request":5208},{"issue_id":"139455","title":"puppet resource service fails on Windows 10 Pro (x64)","url":"https://tickets.puppetlabs.com/browse/PUP-6459","created_at":"2016-06-29T16:44:05.000-0700","number":"PUP-6459","body":"Running {{puppet resource service}} on Windows 10 fails with\r\n{code}\r\nWARNING: Failed to retreive description for the pvhdparser service.\r\nError: Could not run: No such device or address - QueryServiceConfig2: The handle is invalid.\r\n{code}\r\n\r\nThis seems to originate in the win32/service gem:\r\n{code}\r\nirb(main):001:0> require 'win32/service'\r\n=> true\r\nirb(main):002:0> Win32::Service.services\r\nWARNING: Failed to retreive description for the pvhdparser service.\r\nErrno::ENXIO: No such device or address - QueryServiceConfig2: The handle is invalid.{code}\r\n","closed_at":"2016-12-05T04:26:02.000-0800","comments":17,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6459","labels":"","state":"Closed","updated_at":"2016-12-05T04:26:02.000-0800","timestamp":1652285206.26486,"priority":"Blocker","status_category":"Done","pull_request":5159},{"issue_id":"92995","title":"Package resource showing notice when ensure attribute contains Epoch tag","url":"https://tickets.puppetlabs.com/browse/PUP-5025","created_at":"2015-08-11T15:20:45.000-0700","number":"PUP-5025","body":"{{package}} resources do not behave properly when their {{ensure}} attribute is set to a version number containing an Epoch tag.\r\n\r\n+Example+:\r\n\r\nOn Fedora 22, the current version of the {{tomcat}} package is \"1:7.0.59-4.fc22\".\r\n\r\n* With {{ensure => \"7.0.59-4.fc22\"}} yum/dnf exits with error \"package not found\" and Puppet fails\r\n* With {{ensure => \"1:7.0.59-4.fc22\"}} Puppet runs but shows a notice {{package tomcat changed from version 7.0.59-4.fc22 to 1:7.0.59-4.fc22}} on every run","closed_at":"2016-12-08T11:58:01.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5025","labels":"","state":"Closed","updated_at":"2016-12-08T11:58:01.000-0800","timestamp":1652285206.887415,"priority":"Normal","status_category":"Done","pull_request":4940},{"issue_id":"18797","title":"Masters cannot reliably distinguish between multiple versions of a type/function/plugin used in different environments","url":"https://tickets.puppetlabs.com/browse/PUP-731","created_at":"2013-11-13T07:56:42.000-0800","number":"PUP-731","body":"Quoted from a previous ticket, #4409\r\n\r\nThe key problem is that a master can’t reliably distinguish between two versions of the same native type that are used in different environments (or between an environment which uses a native type and an environment which doesn’t). This is due to the fact that native types are defined using ruby code, which the master loads into Ruby classes via “require”. Since there can only be one Ruby class with a given name at a time, this prevents the master from being able to have two different versions of the same type in two different environments. This makes life difficult for people who are trying to use a “test” environment to try out a new version of a native type on a limited set of nodes before deploying it to all nodes.\r\n\r\nA secondary problem is that the location where the master looks for the definition of native types is not the same as the location of plug-in files that the master distributes to agents. This leads to confusion even for people who are not using a “test” environment, because it means that they have to put their type definitions in two places, one where they can be picked up by the master and one where they can be sent as plug-ins to agents.","closed_at":"2016-12-12T13:41:10.000-0800","comments":35,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-731","labels":"customer;redmine","state":"Closed","updated_at":"2016-12-12T13:41:10.000-0800","timestamp":1652285207.104295,"priority":"Normal","status_category":"Done","pull_request":8628},{"issue_id":"158713","title":"Remove \"commit\" check task from travis ci","url":"https://tickets.puppetlabs.com/browse/PUP-6849","created_at":"2016-10-28T09:37:36.000-0700","number":"PUP-6849","body":"CI now routinely fails against pull requests, because we haven't figured out a fully accurate way to only get the commit listing in a PR and check the commit format.\r\n\r\nStrictly speaking, having this check hasn't prevented commits that are incorrectly formatted from being added to the repo anyway, ie:\r\n{code}\r\n6e79498 Delete file commited to wrong repo\r\n80af5ac ;lkajsd\r\n35dd8ef Update MAINTAINERS\r\n{code}\r\n\r\nIMO we should back out the check until we figure out how to do it with complete accuracy, rather than have it consistently cause PR CI failures","closed_at":"2016-12-12T22:17:23.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6849","labels":"maintenance","state":"Closed","updated_at":"2016-12-12T22:17:23.000-0800","timestamp":1652285207.208809,"priority":"Normal","status_category":"Done","pull_request":5351},{"issue_id":"29632","title":"`puppet certificate generate` Generates Two CSRs in One Run","url":"https://tickets.puppetlabs.com/browse/PUP-2018","created_at":"2014-03-22T18:31:12.000-0700","number":"PUP-2018","body":"When I run the following on my Puppet Master:\r\n\r\n`puppet certificate generate --verbose --ca-location remote HOSTNAME`\r\n\r\nI receive the following:\r\n\r\nhttp://pastie.org/private/ackais1tdrc0lyjyekozxq\r\n\r\nThe remote Puppet CA does successfully sign the request (autosign is configured), but the command will always exit 1 because of the second CSR creation (which is unnecessary).\r\n\r\nI have noticed that if the Puppet Master already has a CSR in its '*/ssl/certificate_requests/' directory, the command runs as expected:\r\n\r\nhttp://pastie.org/private/iueobgf93b8q0k4edmi56q","closed_at":"2016-12-16T11:38:08.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2018","labels":"support","state":"Closed","updated_at":"2016-12-16T11:38:08.000-0800","timestamp":1652285207.523291,"priority":"Normal","status_category":"Done","pull_request":5222},{"issue_id":"141397","title":"`puppet resource user` does not work on Windows French edition","url":"https://tickets.puppetlabs.com/browse/PUP-6499","created_at":"2016-07-13T07:13:35.000-0700","number":"PUP-6499","body":"Some basic functionality appears to be broken on a default French Windows that uses code page 850 by default.   This uncovered two errors within Puppets logging and output emission at the console - Puppet is trying to use / combine incompatible strings in CP850 and UTF-8.\r\n\r\nNote that the problem only impacts {{puppet resource user}} and not {{puppet resource group}} - so some investigation should be done to fully understand the problem since those should behave similarly.  Note also that no other {{puppet resource}} commands have been tested.  \r\n\r\nThis was discovered while attempting to replicate PUP-5938 - the first attempt to use {{puppet resource user}} also failed on Puppet 4.3.0, but with a different error.  Not sure if it's worth investing any time in understanding that issue as well.","closed_at":"2016-12-21T16:20:03.000-0800","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6499","labels":"i18n;utf-8","state":"Closed","updated_at":"2016-12-21T16:20:03.000-0800","timestamp":1652285207.630709,"priority":"Critical","status_category":"Done","pull_request":5113},{"issue_id":"150188","title":"Newlines break Puppet tag validation","url":"https://tickets.puppetlabs.com/browse/PUP-6670","created_at":"2016-09-01T09:03:19.000-0700","number":"PUP-6670","body":"The Puppet compiler uses the following regex to determine whether or not a tag\\\r\nis valid:\r\n\r\n{code}\r\n^[0-9A-Za-z_][0-9A-Za-z_:.-]*$\r\n{code}\r\n\r\nThis regex has an issue in that validation will stop at the first newline character in a tag. PuppetDB uses a stricter regex that will reject any tag containing newlines:\r\n\r\n{code}\r\n\\A[a-z0-9_][a-z0-9_:\\-.]*\\Z\r\n{code}\r\n\r\nThis rejection causes PuppetDB to discard catalogs containing resources tagged with strings containing newlines.\r\n\r\nh2. Reproduction Case\r\n\r\nInstall PE 2016.2.1 and add the following resource to the default node declaration in {{/etc/puppetlabs/code/environments/production/manifests/site.pp}}:\r\n\r\n{code:puppet}\r\nnotify {\"two\\nlines\": }\r\n{code}\r\n\r\nRun {{puppet agent -t}}.\r\n\r\nh3. Outcome\r\n\r\nThe catalog compiles and applies just fine:\r\n\r\n{noformat}\r\n# puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for pe-201621-master.puppetdebug.vlan\r\nInfo: Applying configuration version '1472744920'\r\nNotice: two\r\nlines\r\n{noformat}\r\n\r\nHowever, errors are present in the PuppetDB log:\r\n\r\n{noformat}\r\n2016-09-01 08:48:49,635 ERROR [p.p.mq-listener] [a7244661-f9cd-469c-bfac-ca35be92db5c] [replace catalog] Fatal error on attempt 0 for pe-201621-master.puppetdebug.vlan\r\njava.lang.IllegalArgumentException: Resource '{:type \"Notify\", :title \"two\\nlines\"}' has an invalid tag 'two\r\nlines'. Tags must match the pattern /\\A[a-z0-9_][a-z0-9_:\\-.]*\\Z/.\r\n  at puppetlabs.puppetdb.catalogs$validate_resources.invokeStatic(catalogs.clj:303) ~[na:na]\r\n  at puppetlabs.puppetdb.catalogs$validate_resources.invoke(catalogs.clj:294) ~[na:na]\r\n  ...\r\n{noformat}\r\n\r\nAnd a query to the PuppetDB node endpoint shows that a new set of facts was stored along with a new report, but the catlog is out of date:\r\n\r\n{noformat}\r\n# curl http://127.0.0.1:8080/pdb/query/v4/nodes/$(hostname -f)f)\r\n{\r\n  \"deactivated\" : null,\r\n  \"latest_report_hash\" : \"221e50f615f0320d22c276dd4c4cc01634ba0841\",\r\n  \"facts_environment\" : \"production\",\r\n  \"cached_catalog_status\" : \"not_used\",\r\n  \"report_environment\" : \"production\",\r\n  \"catalog_environment\" : \"production\",\r\n  \"facts_timestamp\" : \"2016-09-01T15:56:58.329Z\",\r\n  \"latest_report_noop\" : false,\r\n  \"expired\" : null,\r\n  \"report_timestamp\" : \"2016-09-01T15:57:14.151Z\",\r\n  \"certname\" : \"pe-201621-master.puppetdebug.vlan\",\r\n  \"catalog_timestamp\" : \"2016-09-01T01:57:03.472Z\",\r\n  \"latest_report_status\" : \"changed\"\r\n}\r\n{noformat}\r\n\r\nh3. Expected Outcome\r\n\r\nThe Puppet compiler uses {{/A}} and {{/Z}} to validate tags so that newlines don't break validation.","closed_at":"2017-01-11T22:14:49.000-0800","comments":20,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6670","labels":"compiler","state":"Closed","updated_at":"2017-01-11T22:14:49.000-0800","timestamp":1652285209.845751,"priority":"Major","status_category":"Done","pull_request":5293},{"issue_id":"157228","title":"Address puppet acceptance test failures on windows server 2016","url":"https://tickets.puppetlabs.com/browse/PUP-6827","created_at":"2016-10-17T13:34:52.000-0700","number":"PUP-6827","body":"When running the puppet aio test suite there were two failures during the run.\r\n\r\nThe first is during tests/ticket_13948_lib_dir_hook_should_be_called_on_initialization.rb. It appears there was a connection failure during the test:\r\n\r\n{code}\r\n* verify that the application shows up in help\r\n  \r\n  pyjb322f9rtg4lp.delivery.puppetlabs.net (windows2016-64-1) 10:07:00$ cmd.exe /c puppet help --vardir=\"C:/cygwin64/tmp/ticket_13948_lib_dir_hook_should_be_called_on_initialization.SB3COc/agent_var\"\r\n    Warning: ssh channel on windows2016-64-1 received exception post command execution Errno::ETIMEDOUT - Operation timed out - recvfrom(2)\r\n    Warning: Attemped ssh.close, (caught Net::SSH::Disconnect - connection closed by remote host).\r\n    ssh connection to windows2016-64-1 has been terminated\r\n  \r\n  pyjb322f9rtg4lp.delivery.puppetlabs.net (windows2016-64-1) executed in 318.63 seconds\r\n  Beaker::Host::CommandFailure: Host 'pyjb322f9rtg4lp.delivery.puppetlabs.net' connection failure running:\r\n   cmd.exe /c puppet help --vardir=\"C:/cygwin64/tmp/ticket_13948_lib_dir_hook_should_be_called_on_initialization.SB3COc/agent_var\"\r\n  Last 10 lines of output were:\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/host.rb:348\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/dsl/helpers/host_helpers.rb:83\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/shared/host_manager.rb:127\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/dsl/patterns.rb:37\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/dsl/helpers/host_helpers.rb:63\r\n  /Users/aileen/puppet/acceptance/tests/ticket_13948_lib_dir_hook_should_be_called_on_initialization.rb:137\r\n  /Users/aileen/puppet/acceptance/tests/ticket_13948_lib_dir_hook_should_be_called_on_initialization.rb:136\r\n  /Users/aileen/puppet/acceptance/tests/ticket_13948_lib_dir_hook_should_be_called_on_initialization.rb:136\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/dsl/structure.rb:43\r\n  /Users/aileen/puppet/acceptance/tests/ticket_13948_lib_dir_hook_should_be_called_on_initialization.rb:135\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/test_case.rb:133\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/test_case.rb:133\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/2.3.0/benchmark.rb:308\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/test_case.rb:130\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/test_suite.rb:325\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/test_suite.rb:322\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/test_suite.rb:322\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/test_suite.rb:371\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/cli.rb:174\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/cli.rb:100\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/bin/beaker:6\r\n  /Users/aileen/.rbenv/versions/2.3.0/bin/beaker:23\r\n  /Users/aileen/.rbenv/versions/2.3.0/bin/beaker:23\r\n  Begin teardown\r\n  End teardown\r\n  Warning: tests/ticket_13948_lib_dir_hook_should_be_called_on_initialization.rb errored in 371.72 seconds\r\n{code}\r\n\r\n\r\nThe second is tests/ticket_6857_password-disclosure-when-changing-a-users-password.rb. On initial review it appears the test is failing because the setup of a user that is tested against fails, causing a later test step to fail.\r\n{code}\r\n  Begin tests/ticket_6857_password-disclosure-when-changing-a-users-password.rb\r\n  \r\n  #6857: redact password hashes when applying in noop mode\r\n  \r\n  pyjb322f9rtg4lp.delivery.puppetlabs.net (windows2016-64-1) 10:18:41$ cygpath -m $(mktemp -t apply_manifest.pp.XXXXXX)\r\n    C:/cygwin64/tmp/apply_manifest.pp.sWZPmc\r\n  \r\n  pyjb322f9rtg4lp.delivery.puppetlabs.net (windows2016-64-1) executed in 0.11 seconds\r\n  localhost $ scp /var/folders/3r/k7hzxdmn0ps9bdqd623lpcmh0000gq/T/beaker20161014-60474-y0k87n windows2016-64-1:C:/cygwin64/tmp/apply_manifest.pp.sWZPmc {:ignore => }\r\n  \r\n  pyjb322f9rtg4lp.delivery.puppetlabs.net (windows2016-64-1) 10:18:42$ cmd.exe /c puppet apply --verbose C:/cygwin64/tmp/apply_manifest.pp.sWZPmc\r\n    Notice: Compiled catalog for pyjb322f9rtg4lp.delivery.puppetlabs.net in environment production in 0.12 seconds\r\n    Info: Applying configuration version '1476465524'\r\n    Error: User update failed: (in OLE method `SetInfo': )\r\n        OLE error code:800708C5 in Active Directory\r\n          The password does not meet the password policy requirements. Check the minimum password length, password complexity and password history requirements.\r\n    \r\n        HRESULT error code:0x80020009\r\n          Exception occurred.\r\n    Wrapped exception:\r\n    (in OLE method `SetInfo': )\r\n        OLE error code:800708C5 in Active Directory\r\n          The password does not meet the password policy requirements. Check the minimum password length, password complexity and password history requirements.\r\n    \r\n        HRESULT error code:0x80020009\r\n          Exception occurred.\r\n    Error: /Stage[main]/Main/User[pl49160]/ensure: change from absent to present failed: User update failed: (in OLE method `SetInfo': )\r\n        OLE error code:800708C5 in Active Directory\r\n          The password does not meet the password policy requirements. Check the minimum password length, password complexity and password history requirements.\r\n    \r\n        HRESULT error code:0x80020009\r\n          Exception occurred.\r\n    Notice: Applied catalog in 0.10 seconds\r\n  \r\n  pyjb322f9rtg4lp.delivery.puppetlabs.net (windows2016-64-1) executed in 10.27 seconds\r\n  \r\n  pyjb322f9rtg4lp.delivery.puppetlabs.net (windows2016-64-1) 10:18:52$ cygpath -m $(mktemp -t apply_manifest.pp.XXXXXX)\r\n    C:/cygwin64/tmp/apply_manifest.pp.QJxNOj\r\n  \r\n  pyjb322f9rtg4lp.delivery.puppetlabs.net (windows2016-64-1) executed in 0.11 seconds\r\n  localhost $ scp /var/folders/3r/k7hzxdmn0ps9bdqd623lpcmh0000gq/T/beaker20161014-60474-1oaqlmv windows2016-64-1:C:/cygwin64/tmp/apply_manifest.pp.QJxNOj {:ignore => }\r\n  \r\n  pyjb322f9rtg4lp.delivery.puppetlabs.net (windows2016-64-1) 10:18:52$ cmd.exe /c puppet apply --verbose C:/cygwin64/tmp/apply_manifest.pp.QJxNOj\r\n    Notice: Compiled catalog for pyjb322f9rtg4lp.delivery.puppetlabs.net in environment production in 0.11 seconds\r\n    Info: Applying configuration version '1476465535'\r\n    Notice: /Stage[main]/Main/User[pl49160]/ensure: current_value absent, should be present (noop)\r\n    Notice: Class[Main]: Would have triggered 'refresh' from 1 events\r\n    Notice: Stage[main]: Would have triggered 'refresh' from 1 events\r\n    Notice: Applied catalog in 0.07 seconds\r\n  \r\n  pyjb322f9rtg4lp.delivery.puppetlabs.net (windows2016-64-1) executed in 10.69 seconds\r\n  Minitest::Assertion: Expected /current_value \\[old password hash redacted\\], should be \\[new password hash redacted\\]/ to match \"windows2016-64-1: \\e[mNotice: Compiled catalog for pyjb322f9rtg4lp.delivery.puppetlabs.net in environment production in 0.11 seconds\\e[0m\\n\\e[0;32mInfo: Applying configuration version '1476465535'\\e[0m\\n\\e[mNotice: /Stage[main]/Main/User[pl49160]/ensure: current_value absent, should be present (noop)\\e[0m\\n\\e[mNotice: Class[Main]: Would have triggered 'refresh' from 1 events\\e[0m\\n\\e[mNotice: Stage[main]: Would have triggered 'refresh' from 1 events\\e[0m\\n\\e[mNotice: Applied catalog in 0.07 seconds\\e[0m\\n\".\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/minitest-5.9.1/lib/minitest/assertions.rb:139\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/minitest-5.9.1/lib/minitest/assertions.rb:238\r\n  /Users/aileen/puppet/acceptance/tests/ticket_6857_password-disclosure-when-changing-a-users-password.rb:45\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/dsl/helpers/host_helpers.rb:93\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/shared/host_manager.rb:127\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/dsl/patterns.rb:37\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/dsl/helpers/host_helpers.rb:63\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/dsl/helpers/puppet_helpers.rb:481\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/shared/host_manager.rb:127\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/shared/host_manager.rb:115\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/shared/host_manager.rb:114\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/shared/host_manager.rb:114\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/dsl/patterns.rb:37\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/dsl/helpers/puppet_helpers.rb:410\r\n  /Users/aileen/puppet/acceptance/tests/ticket_6857_password-disclosure-when-changing-a-users-password.rb:44\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/test_case.rb:133\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/test_case.rb:133\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/2.3.0/benchmark.rb:308\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/test_case.rb:130\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/test_suite.rb:325\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/test_suite.rb:322\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/test_suite.rb:322\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/test_suite.rb:371\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/cli.rb:174\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/lib/beaker/cli.rb:100\r\n  /Users/aileen/.rbenv/versions/2.3.0/lib/ruby/gems/2.3.0/gems/beaker-3.1.0/bin/beaker:6\r\n  /Users/aileen/.rbenv/versions/2.3.0/bin/beaker:23\r\n  /Users/aileen/.rbenv/versions/2.3.0/bin/beaker:23\r\n  Begin teardown\r\n  \r\n  * Teardown: Ensure test user is removed\r\n{code}\r\n\r\nh2: In scope for Agent team\r\n* Reproduce issue\r\n* Solve the problem","closed_at":"2017-01-11T22:24:16.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6827","labels":"","state":"Closed","updated_at":"2017-01-11T22:24:16.000-0800","timestamp":1652285210.160197,"priority":"Normal","status_category":"Done","pull_request":5341},{"issue_id":"159651","title":"spec/unit/transaction/persistence_spec.rb includes a spec test that fails on non-US English Windows platforms","url":"https://tickets.puppetlabs.com/browse/PUP-6871","created_at":"2016-11-03T13:32:48.000-0700","number":"PUP-6871","body":"https://github.com/puppetlabs/puppet/commit/277c90871c6870b689f40e535c0c6d2063176a95 introduced a test at https://github.com/puppetlabs/puppet/blob/master/spec/unit/transaction/persistence_spec.rb#L151 which uses English to detect and Access Denied error.  However on localised versions of Windows this error text is different, e.g. on French Windows it is {{Accès refusé}}\r\n\r\nThe unit test should be modified to not depend on English","closed_at":"2017-01-11T22:25:38.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6871","labels":"","state":"Closed","updated_at":"2017-01-11T22:25:38.000-0800","timestamp":1652285210.265854,"priority":"Normal","status_category":"Done","pull_request":5360},{"issue_id":"122564","title":"Remove support for --unpack-arrays option from lookup function and CLI","url":"https://tickets.puppetlabs.com/browse/PUP-6074","created_at":"2016-03-18T16:19:57.000-0700","number":"PUP-6074","body":"Remove the {{\\--unpack-array}} option from lookup function and lookup command line.\n\nThis option did not work at all when it was first introduced. While fixed to \"work\" in 4.4.1, its functionality is so odd that no one really can explain what it is supposed to do. It also unexpectedly behaves differently in different data configurations.\n\nIt was therefore decided IN PUP-6050 that support for it should be removed.\n\nACCEPTANCE CRITERA\n----\n* An error is raised if the option --unpack-arrays or --unpack_arrays is given to the lookup CLI\n* An error is raised if the option 'unpack_arrays' is given to the lookup function\n* The documentation does not mention 'unpack arrays' in any form.","closed_at":"2017-01-11T23:57:16.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6074","labels":"","state":"Closed","updated_at":"2017-01-11T23:57:16.000-0800","timestamp":1652285210.475779,"priority":"Normal","status_category":"Done","pull_request":4825},{"issue_id":"168800","title":"Intermittent Windows registry spec failure with parallel runs","url":"https://tickets.puppetlabs.com/browse/PUP-7064","created_at":"2017-01-04T14:11:03.000-0800","number":"PUP-7064","body":"https://jenkins-master-prod-1.delivery.puppetlabs.net/job/platform_puppet_unit-ruby-win_master/86/ failed with\r\n{code}\r\n12:57:42   1) Puppet::Util::Windows::Registry#values when reading values should return REG_DWORD values\r\n12:57:42      Failure/Error: subject.delete_key(reg, subkey_name)\r\n12:57:42      Puppet::Util::Windows::Error:\r\n12:57:42        Failed to delete registry key PuppetRegistryTest at SOFTWARE\\Puppet Labs:  The system cannot find the file specified. \r\n12:57:42      # ./lib/puppet/util/windows/registry.rb:284:in `block in reg_delete_key_ex'\r\n12:57:42      # ./lib/puppet/util/windows/api_types.rb:29:in `block in from_string_to_wide_string'\r\n12:57:42      # ./lib/puppet/util/windows/api_types.rb:25:in `initialize'\r\n12:57:42      # ./lib/puppet/util/windows/api_types.rb:25:in `new'\r\n12:57:42      # ./lib/puppet/util/windows/api_types.rb:25:in `from_string_to_wide_string'\r\n12:57:42      # ./lib/puppet/util/windows/registry.rb:279:in `reg_delete_key_ex'\r\n12:57:42      # ./lib/puppet/util/windows/registry.rb:59:in `delete_key'\r\n12:57:42      # ./spec/integration/util/windows/registry_spec.rb:195:in `block (5 levels) in <top (required)>'\r\n12:57:42      # ./spec/integration/util/windows/registry_spec.rb:194:in `block (4 levels) in <top (required)>'\r\n{code}\r\n\r\nThis is likely due to poor isolation in those specs, like https://github.com/puppetlabs/puppet/blob/master/spec/integration/util/windows/registry_spec.rb#L136-L145, https://github.com/puppetlabs/puppet/blob/master/spec/integration/util/windows/registry_spec.rb#L193-L197, and https://github.com/puppetlabs/puppet/blob/master/spec/integration/util/windows/registry_spec.rb#L240-L244.\r\n\r\nThis can likely be fixed easily by using a unique subkey_name for each test.","closed_at":"2017-01-18T07:46:59.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7064","labels":"","state":"Closed","updated_at":"2017-01-18T07:46:59.000-0800","timestamp":1652285210.792995,"priority":"Normal","status_category":"Done","pull_request":5464},{"issue_id":"158727","title":"Make commit formatting check robust","url":"https://tickets.puppetlabs.com/browse/PUP-6850","created_at":"2016-10-28T09:50:37.000-0700","number":"PUP-6850","body":"PUP-6849 proposes removal of the commit format check, as it is failing consistently on PRs due to commits unrelated to those PRs.\r\n\r\nUnfortunately, despite a range of attempts to make this work\r\ncorrectly/completely, including:\r\n\r\ne1efdebf\r\n4d5afd57\r\n1ed7c7ce\r\n\r\n...we still haven't gotten it quite right. The most challenging aspect is to accurately get a list of commits that exist _only_ in the pull request and check those. Failure to do so was causing consistent CI failures for many PRs, as commits unrelated to this PR would trigger failure. This then meant lost time investigating and spurious red in hipchat rooms - more effort than the check is worth in IMO.\r\n\r\nWe need to make the check more robust so that it can correctly detect only the commits in a PR.\r\n","closed_at":"2017-01-18T07:46:59.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6850","labels":"maintenance","state":"Closed","updated_at":"2017-01-18T07:46:59.000-0800","timestamp":1652285210.898898,"priority":"Normal","status_category":"Done","pull_request":5405},{"issue_id":"164807","title":"Reload puppetserver in puppet acceptance tests","url":"https://tickets.puppetlabs.com/browse/PUP-6967","created_at":"2016-12-01T16:52:26.000-0800","number":"PUP-6967","body":"We spend ~30 mins starting puppetserver across the full acceptance test suite. Now that BKR-703 is fixed, we should update our beaker dependency and use reload.","closed_at":"2017-01-18T07:47:01.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6967","labels":"maintenance","state":"Closed","updated_at":"2017-01-18T07:47:01.000-0800","timestamp":1652285211.589519,"priority":"Normal","status_category":"Done","pull_request":5448},{"issue_id":"165846","title":"Puppet acceptance test failures for Japanese Windows","url":"https://tickets.puppetlabs.com/browse/PUP-6993","created_at":"2016-12-09T11:23:32.000-0800","number":"PUP-6993","body":"Noted in IMAGES-390 at https://tickets.puppetlabs.com/browse/IMAGES-390?focusedCommentId=374916&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-374916 there were issues running the full acceptance suite for Puppet against the Japanese Windows 2012R2 template {{win-2012r2-ja-x86_64}}\r\n\r\nThis ticket tracks failures in the Puppet suite that do not properly accommodate non-ASCII output during tests (where https://gist.github.com/Iristyle/771b6ec052570e34f02009da531aed4a has all the test failures in detail).  The identified problems are:\r\n\r\n* BKR-1008 - user_get failure - https://github.com/puppetlabs/puppet/blob/master/acceptance/tests/resource/user/should_modify.rb\r\n* BKR-1008 - user_get failure - https://github.com/puppetlabs/puppet/blob/master/acceptance/tests/resource/user/should_create.rb\r\n* BKR-1011 - group_get failure - https://github.com/puppetlabs/puppet/blob/master/acceptance/tests/resource/group/should_create.rb\r\n* This ticket - failure in test code - https://github.com/puppetlabs/puppet/blob/master/acceptance/tests/windows/eventlog.rb\r\n* This ticket - failure in test heleprs -  https://github.com/puppetlabs/puppet/blob/master/acceptance/tests/modules/install/with_version.rb\r\n* This ticket - failure in test heleprs - https://github.com/puppetlabs/puppet/blob/master/acceptance/tests/modules/install/basic_install.rb\r\n* Likely a point in time failure - unrelated to UTF-8 work -  https://github.com/puppetlabs/puppet/blob/master/acceptance/tests/parser_functions/puppet_lookup_cmd.rb#L2385-L2389\r\n\r\n\r\nTo reproduce the failures, using the following {{hosts.yaml}}:\r\n\r\n{code}\r\n---\r\nHOSTS:\r\n  centos6-64-1:\r\n    pe_dir:\r\n    pe_ver:\r\n    pe_upgrade_dir:\r\n    pe_upgrade_ver:\r\n    hypervisor: vmpooler\r\n    platform: el-6-x86_64\r\n    template: centos-6-x86_64\r\n    roles:\r\n    - agent\r\n    - master\r\n    - database\r\n    - dashboard\r\n  windows2012r2-64-1:\r\n    pe_dir:\r\n    pe_ver:\r\n    pe_upgrade_dir:\r\n    pe_upgrade_ver:\r\n    hypervisor: vmpooler\r\n    platform: windows-2012r2-64\r\n    ruby_arch: x64\r\n    template: win-2012r2-ja-x86_64\r\n    # template: win-2012r2-x86_64\r\n    roles:\r\n    - agent\r\nCONFIG:\r\n  nfs_server: none\r\n  consoleport: 443\r\n  pooling_api: http://vmpooler.delivery.puppetlabs.net/\r\n{code}\r\n\r\nAnd execute:\r\n\r\n{code}\r\nGEM_SOURCE=http://rubygems.delivery.puppetlabs.net/ bundle exec rake ci:test:aio BEAKER_HOSTS=hosts.yaml SHA='1.8.1' SERVER_VERSION='2.7.1'\r\n{code}\r\n\r\n","closed_at":"2017-01-20T07:02:22.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6993","labels":"i18n;utf-8","state":"Closed","updated_at":"2017-01-20T07:02:22.000-0800","timestamp":1652285211.800391,"priority":"Blocker","status_category":"Done","pull_request":5418},{"issue_id":"165040","title":"Looking up a 'false' value in hiera.yaml when using data in modules does not return a result.","url":"https://tickets.puppetlabs.com/browse/PUP-6974","created_at":"2016-12-05T07:45:27.000-0800","number":"PUP-6974","body":"Using the following {{hiera.yaml}} with data in modules, the resolution of a {{false}} value does not allow us to look up materials in a {{false.yaml}} file. Instead, the entry is non-existent. This requires us to use a hack to have a file that can be found with the {{false}} value returning as an empty string.\r\n\r\n{code}\r\n---\r\nversion: 4\r\ndatadir: data\r\nhierarchy:\r\n  - name: \"my_fact\"\r\n    backend: yaml\r\n    path: \"my_fact/is_%{facts.my_fact}\"\r\n{code}\r\n\r\nWe should be able to have {{my_fact/is_true.yaml}} and {{my_fact/is_false.yaml}}. However, with this bug, we have to have {{my_fact/is_.yaml}} and symlink that to {{my_facts/is_false.yaml}} for when this issue gets fixed.","closed_at":"2017-01-20T07:02:23.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6974","labels":"","state":"Closed","updated_at":"2017-01-20T07:02:23.000-0800","timestamp":1652285211.904464,"priority":"Normal","status_category":"Done","pull_request":5409},{"issue_id":"168612","title":"Multiple hiera functions in one string does not work with hiera v4","url":"https://tickets.puppetlabs.com/browse/PUP-7061","created_at":"2017-01-03T18:53:18.000-0800","number":"PUP-7061","body":"After moving to hiera v4 and per environment hiera config files, I got this error  while running puppet:\r\n\r\n{code:java}\r\nError: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Function Call, undefined method `pop' for nil:NilClass at /etc/puppetlabs/code/environments/production/site.pp:37:11 on node \r\n{code}\r\n\r\npuppet server:\r\n\r\n\r\n{code:java}\r\n2017-01-04 03:48:07,181 ERROR [qtp870122728-64] [puppetserver] Puppet Evaluation Error: Error while evaluating a Function Call, undefined method `pop' for nil:NilClass at /etc/puppetlabs/code/environments/production/site.pp:37:11 on node \r\n2017-01-04 03:48:07,182 ERROR [qtp870122728-64] [puppetserver] Puppet Server Error: Evaluation Error: Error while evaluating a Function Call, undefined method `pop' for nil:NilClass at /etc/puppetlabs/code/environments/production/site.pp:37:11 on node \r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:79:in `with'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/data_providers/lookup_adapter.rb:149:in `do_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/data_providers/lookup_adapter.rb:72:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:77:in `search_and_merge'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:32:in `lookup'\r\norg/jruby/RubyKernel.java:1242:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:32:in `lookup'\r\norg/jruby/RubyArray.java:1613:in `each'\r\norg/jruby/RubyEnumerable.java:852:in `inject'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:30:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/../../../puppet/functions/lookup.rb:209:in `do_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/../../../puppet/functions/lookup.rb:193:in `lookup_2'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatch.rb:47:in `invoke'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:36:in `dispatch'\r\norg/jruby/RubyKernel.java:1242:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:35:in `dispatch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:46:in `call'\r\norg/jruby/RubyKernel.java:1242:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:45:in `call'\r\n/etc/puppetlabs/code/environments/production/site.pp:37:in `call_function'\r\norg/jruby/RubyKernel.java:1079:in `eval'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:284:in `call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:282:in `call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:941:in `call_function_with_block'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:910:in `eval_CallNamedFunctionExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:69:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:82:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:359:in `eval_AssignmentExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:69:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:82:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:638:in `eval_BlockExpression'\r\norg/jruby/RubyArray.java:1613:in `each'\r\norg/jruby/RubyEnumerable.java:852:in `inject'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:638:in `eval_BlockExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:69:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:82:in `evaluate'\r\n/etc/puppetlabs/code/environments/production/site.pp:0:in `stack'\r\norg/jruby/RubyKernel.java:1079:in `eval'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/puppet_stack.rb:30:in `stack'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:715:in `eval_Program'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:69:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:82:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/evaluating_parser.rb:63:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:132:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast.rb:31:in `safeevaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:184:in `evaluate_code'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:81:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:73:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:639:in `evaluate_main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:174:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:174:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:241:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:162:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:33:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:266:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:264:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:223:in `benchmark'\r\n/opt/puppetlabs/server/apps/puppetserver/puppet-server-release.jar!/META-INF/jruby.home/lib/ruby/1.9/benchmark.rb:295:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:222:in `benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:262:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:53:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:194:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:121:in `do_find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:48:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:241:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:47:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:82:in `process'\r\norg/jruby/RubyArray.java:1613:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:81:in `process'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:87:in `process'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:87:in `process'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/handler.rb:60:in `process'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/handler.rb:58:in `process'\r\nfile:/opt/puppetlabs/server/apps/puppetserver/puppet-server-release.jar!/puppetserver-lib/puppet/server/master.rb:42:in `handleRequest'\r\nPuppet$$Server$$Master_1866731659.gen:13:in `handleRequest'\r\nrequest_handler_core.clj:273:in `invoke'\r\njruby_request.clj:46:in `invoke'\r\njruby_request.clj:31:in `invoke'\r\nrequest_handler_service.clj:34:in `handle_request'\r\nrequest_handler.clj:3:in `invoke'\r\nrequest_handler.clj:3:in `invoke'\r\ncore.clj:2515:in `invoke'\r\nring_middleware.clj:284:in `invoke'\r\ncore.clj:168:in `invoke'\r\ncore.clj:211:in `invoke'\r\ncore.clj:45:in `invoke'\r\ncore.clj:343:in `invoke'\r\ncore.clj:51:in `invoke'\r\nringutils.clj:83:in `invoke'\r\nmaster_core.clj:428:in `invoke'\r\nring.clj:21:in `invoke'\r\nring.clj:12:in `invoke'\r\ncomidi.clj:249:in `invoke'\r\njetty9_core.clj:424:in `invoke'\r\nnormalized_uri_helpers.clj:80:in `invoke'\r\n{code}\r\n\r\nRemoving this line in my common.yaml \r\n\r\n{code:java}\r\nprofile::proxy::url: \"http://%{hiera('profile::proxy::host')}:%{hiera('profile::proxy::port')}\"\r\n{code}\r\n\r\nthe error does not appears anymore.","closed_at":"2017-01-20T07:02:23.000-0800","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7061","labels":"","state":"Closed","updated_at":"2017-01-20T07:02:23.000-0800","timestamp":1652285212.014928,"priority":"Normal","status_category":"Done","pull_request":5469},{"issue_id":"105544","title":"basic_install.rb and with_version.rb module tests fail in AIX","url":"https://tickets.puppetlabs.com/browse/PUP-5501","created_at":"2015-11-12T15:06:27.000-0800","number":"PUP-5501","body":"With the puppet-ca-bundle, the module acceptance tests should all now pass in Solaris and AIX. While they do for Solaris, two are still failing in AIX:\r\n\r\n{noformat}\r\n  Test Case ./tests/modules/install/basic_install.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-71-acceptance' exited with 1 running:\r\n puppet module install pmtacceptance-nginx\r\nLast 10 lines of output were:\r\n\tNotice: Preparing to install into /etc/puppetlabs/code/environments/production/modules ...\r\n\tNotice: Downloading from https://forgeapi.puppetlabs.com ...\r\n\tError: Could not install 'pmtacceptance-nginx' (latest)\r\n\t  No releases are available from https://forgeapi.puppetlabs.com\r\n\t    Does 'pmtacceptance-nginx' have at least one published release?>\r\n  Test Case ./tests/modules/install/with_version.rb reported: #<Beaker::Host::CommandFailure: Host 'pe-aix-71-acceptance' exited with 1 running:\r\n puppet module install --version '< 1.7.0' pmtacceptance-java\r\nLast 10 lines of output were:\r\n\tNotice: Preparing to install into /etc/puppetlabs/code/environments/production/modules ...\r\n\tNotice: Downloading from https://forgeapi.puppetlabs.com ...\r\n\tError: Could not install 'pmtacceptance-java' (< 1.7.0)\r\n\t  No releases matching '< 1.7.0' are available from https://forgeapi.puppetlabs.com>\r\nSkipped Tests Cases:\r\n  Test Case ./tests/modules/upgrade/that_was_installed_twice.rb skip\r\n  Test Case ./tests/modules/upgrade/with_scattered_dependencies.rb skip\r\nPending Tests Cases:\r\n{noformat}","closed_at":"2017-01-30T11:47:55.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5501","labels":"","state":"Resolved","updated_at":"2017-01-30T11:47:55.000-0800","timestamp":1652285212.951555,"priority":"Normal","status_category":"Done","pull_request":5148},{"issue_id":"134253","title":"systemd provider does not honor documented enabled states","url":"https://tickets.puppetlabs.com/browse/PUP-6370","created_at":"2016-05-27T13:32:04.000-0700","number":"PUP-6370","body":"The systemd provider considers too many states as \"disabled\" and should probably just simply track the return value of \"is-enabled\" instead of capturing stdout and comparing it to a static list of knows states.  This has the added benefit of us not having to externally track new states added to systemd over time.\r\n\r\nThis issue was found in puppet-nova's CI where we found that the virtlockd and virtlogd services attempt to be enabled on every run; their \"is-enabled\" state is \"indirect\".\r\n\r\nhttps://www.freedesktop.org/software/systemd/man/systemctl.html\r\nhttp://logs.openstack.org/30/308530/24/experimental/gate-puppet-openstack-integration-4-scenario001-tempest-ubuntu-xenial/e209217/console.html#_2016-05-26_22_48_06_290","closed_at":"2017-02-01T20:04:12.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6370","labels":"","state":"Closed","updated_at":"2017-02-01T20:04:12.000-0800","timestamp":1652285224.215614,"priority":"Major","status_category":"Done","pull_request":5019},{"issue_id":"165806","title":"Fix inconsistent autoload of environment functions and pcore types.","url":"https://tickets.puppetlabs.com/browse/PUP-6992","created_at":"2016-12-09T03:12:38.000-0800","number":"PUP-6992","body":"When a *ruby* function is declared in a _func_name.rb_ file under the directory _<env_root>/lib/puppet/functions_, the auto-loader makes it accessible using the global name \"func_name\". Declaring a *puppet* function in _func_name.pp_ under _<env_root>/functions_ does, however, not work. The function is not found unless the name of the function is prefixed with \"environment::\". In contrast, if the *ruby* function is prefixed the same way, the function is no longer found unless it is also moved to _<env_root>/lib/puppet/functions/environment_.\r\n\r\nFor the sake of consistency, functions using global names should reside under:\r\n_<env_root>/lib/puppet/functions_ # ruby\r\n_<env_root>/functions_ # puppet\r\n\r\nand functions prefixed with \"environment::\" should reside under:\r\n_<env_root>/lib/puppet/functions/environment_ # ruby\r\n_<env_root>/functions/environment_ # puppet\r\n\r\nThe same scheme should be used for auto-loading pcore types that are declared in the environment (but beneath the _types_ directory instead of _functions_).","closed_at":"2017-02-02T06:19:45.000-0800","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6992","labels":"","state":"Closed","updated_at":"2017-02-02T06:19:45.000-0800","timestamp":1652285224.537152,"priority":"Normal","status_category":"Done","pull_request":5455},{"issue_id":"166099","title":"Lookup recursion guard should use different namespace for scope and normal lookups","url":"https://tickets.puppetlabs.com/browse/PUP-7003","created_at":"2016-12-13T06:34:32.000-0800","number":"PUP-7003","body":"A lookup of a key that results in a value that contains an interpolation expression with the same key (this time referring to the global scope) should not result in a recursion error. The lookup namespace is different from the global scope namespace.","closed_at":"2017-02-02T06:19:45.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7003","labels":"","state":"Closed","updated_at":"2017-02-02T06:19:45.000-0800","timestamp":1652285224.958251,"priority":"Normal","status_category":"Done","pull_request":5425},{"issue_id":"166982","title":"dnf provider does not support Fedora 25","url":"https://tickets.puppetlabs.com/browse/PUP-7029","created_at":"2016-12-16T13:43:44.000-0800","number":"PUP-7029","body":"The dnf provider uses a static list of release numbers and must be updated for each Fedora release.\r\n","closed_at":"2017-02-02T06:19:46.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7029","labels":"","state":"Closed","updated_at":"2017-02-02T06:19:46.000-0800","timestamp":1652285225.17631,"priority":"Normal","status_category":"Done","pull_request":5947},{"issue_id":"164673","title":"Puppet doesn't detect systemd as default service provider on CoreOS","url":"https://tickets.puppetlabs.com/browse/PUP-6963","created_at":"2016-12-01T10:44:21.000-0800","number":"PUP-6963","body":"CoreOS is correctly identified by facter (https://github.com/puppetlabs/facter/blob/11288d2a33caec577fe696bd02e4bed12e5ac12d/lib/inc/internal/facts/linux/os_coreos.hpp) but when trying to manage services Puppet detects both init.d and systemd and defaults to init.d. In reality CoreOS uses systemd for all service management.\r\n\r\nExpected behaviour: The service provider should use systemd as the default provider for CoreOS","closed_at":"2017-02-02T06:19:47.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6963","labels":"maintenance","state":"Closed","updated_at":"2017-02-02T06:19:47.000-0800","timestamp":1652285225.386636,"priority":"Normal","status_category":"Done","pull_request":5402},{"issue_id":"167104","title":"Unicode characters in 'comment' don't round-trip on Windows","url":"https://tickets.puppetlabs.com/browse/PUP-7031","created_at":"2016-12-18T14:39:20.000-0800","number":"PUP-7031","body":"Given `puppet apply` this manifest:\r\n{code}\r\n  user { 'foo' :\r\n    comment => \"\\u2603\",\r\n    ensure => present,\r\n  }\r\n{code}\r\n\r\nThe following change happens on every puppet run:\r\n{code}\r\nNotice: /Stage[main]/Main/User[foo]/comment: comment changed '?' to '☃'\r\n{code}\r\n\r\nDifferent unicode characters have the same result:\r\n{code}\r\n...\r\ncomment => \"\\u{2070E}\"\r\n...\r\n{code}\r\n\r\nresults in:\r\n{code}\r\nNotice: /Stage[main]/Main/User[foo]/comment: comment changed '??' to '𠜎'\r\n{code}\r\n\r\nA quick investigation makes it appear we're failing to correctly round-trip the unicode to/from Windows in https://github.com/puppetlabs/puppet/blob/master/lib/puppet/util/windows/adsi.rb#L197-L206:\r\n\r\n{code}\r\nFrom: C:/Users/moses/development/puppet/lib/puppet/util/windows/adsi.rb @ line 207 Puppet::Util::Windows::ADSI::User#[]=:\r\n\r\n    205: def []=(attribute, value)\r\n    206:   require 'pry';binding.pry\r\n => 207:   native_user.Put(attribute, value)\r\n    208: end\r\n\r\n[18] pry(#<Puppet::Util::Windows::ADSI::User>)> attribute\r\n=> \"Description\"\r\n[19] pry(#<Puppet::Util::Windows::ADSI::User>)> value\r\n=> \"\\u{2070E}\"\r\n[20] pry(#<Puppet::Util::Windows::ADSI::User>)> value.bytes\r\n=> [240, 160, 156, 142]\r\n[21] pry(#<Puppet::Util::Windows::ADSI::User>)> native_user.Put(attribute, value)\r\n=> nil\r\n[22] pry(#<Puppet::Util::Windows::ADSI::User>)> is = native_user.Get(attribute)\r\n=> \"??\"\r\n[23] pry(#<Puppet::Util::Windows::ADSI::User>)> is.bytes\r\n=> [63, 63]\r\n[24] pry(#<Puppet::Util::Windows::ADSI::User>)> Encoding.default_external\r\n=> #<Encoding:IBM437>\r\n[25] pry(#<Puppet::Util::Windows::ADSI::User>)> value.encoding\r\n=> #<Encoding:UTF-8>\r\n[26] pry(#<Puppet::Util::Windows::ADSI::User>)> is.encoding\r\n=> #<Encoding:IBM437>\r\n{code}\r\n\r\nNote that the bytes read back via `Get` are not the same as the value we `Put`","closed_at":"2017-02-02T06:19:47.000-0800","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7031","labels":"","state":"Closed","updated_at":"2017-02-02T06:19:47.000-0800","timestamp":1652285225.601816,"priority":"Major","status_category":"Done","pull_request":5419},{"issue_id":"167102","title":"Parser - Illegal Unicode warning and extra escape on legal string?","url":"https://tickets.puppetlabs.com/browse/PUP-7030","created_at":"2016-12-18T14:17:23.000-0800","number":"PUP-7030","body":"In working on support for unicode characters in the value of the \"comment\" property, I noticed this warning in the output:\r\n{code}\r\n...\r\nWarning: Unicode escape '\\u' was not followed by 4 hex digits or 1-6 hex digits in {} or was > 10ffff at /Users/moses/foo/unicode_comment.pp:3:38\r\n...\r\n{code}\r\n\r\nThe manifest in question is:\r\n{code}\r\nuser { 'foo' :\r\n  ensure => present,\r\n  comment => \"A\\u06FF\\u16A0\\u{2070E}\",\r\n}\r\n{code}\r\n\r\nI.e., the value of the comment field is made up of these characters:\r\n\"A\" : http://www.fileformat.info/info/unicode/char/0041/index.htm\r\n\"\\u06FF\" : http://www.fileformat.info/info/unicode/char/06FF/index.htm\r\n\"\\u16A0\": http://www.fileformat.info/info/unicode/char/16a0/index.htm\r\n\"\\u{2070E}\" : http://www.fileformat.info/info/unicode/char/2070e/index.htm\r\n\r\nI believe this string is legal unicode - is it misrepresented in the manifest in some way?\r\n\r\nGiven a user with name \"foo\" and comment \"bar\", if I apply this manifest, (in addition to the warning above) this is the change notice:\r\n{code}\r\nNotice: /Stage[main]/Main/User[foo]/comment: comment changed 'bar' to 'Aۿ\\u16A0𠜎'\r\n{code}\r\n\r\nIt appears that \"\\u16A0\" has been escaped and subsequently treated literally?\r\nThe error is being raised here: https://github.com/puppetlabs/puppet/blob/master/lib/puppet/pops/parser/slurp_support.rb#L94-L95","closed_at":"2017-02-02T06:19:47.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7030","labels":"","state":"Closed","updated_at":"2017-02-02T06:19:47.000-0800","timestamp":1652285225.708186,"priority":"Normal","status_category":"Done","pull_request":5446},{"issue_id":"165599","title":"Acceptance testing using TYPE=git and preserved hosts is broken","url":"https://tickets.puppetlabs.com/browse/PUP-6989","created_at":"2016-12-08T08:00:30.000-0800","number":"PUP-6989","body":"I tried to use the acceptance tests with TYPE=git today and ran into several problems.\r\n* All tests using the latest master fails on missing _semantic_puppet_. This is because it is missing from the _config/git/options.rb_ and also from the _install.rb_.\r\n* Adding _semantic_puppet_ to _install.rb_ doesn't work because it lacks an _install.rb_ of its own.\r\n* The Rake command {{ci:list_preserved}} is broken. It looks for files directly under the _log_ directory. The files however, resides one level down, under _log_/<config>.\r\n* Once I got {{ci:list_preserved working}}, I found that the {{ci:test_against_preserved_hosts}} is also broken. It does not propagate preserved hosts correctly (a variable named {{config}} is assumed to be present at line 123, but it isn't and instead a method is called that picks a host seemingly at random). I used the temporary fix of setting {{config = final_options\\[:hosts_file\\]}} to get around this but then it breaks with other commands.\r\n \r\nWithout this functionality working, it's very hard to assert that changes made to the code will not break once the reach the CI-pipeline.","closed_at":"2017-02-02T06:19:49.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6989","labels":"maintenance","state":"Closed","updated_at":"2017-02-02T06:19:49.000-0800","timestamp":1652285226.137013,"priority":"Normal","status_category":"Done","pull_request":5420},{"issue_id":"166314","title":"Type error in function parameter is reported on wrong parameter","url":"https://tickets.puppetlabs.com/browse/PUP-7012","created_at":"2016-12-14T04:27:47.000-0800","number":"PUP-7012","body":"While writing a new puppet language function I ran into a wrong type error.\r\n\r\nThe error\r\n\r\n{noformat}\r\n Error while evaluating a Function Call, 'saltnetwork::iptables::is_builtin_chain' parameter 'table' expects a match for SaltNetwork::IPTables::Table = Enum['filter', 'mangle', 'nat', 'raw', 'security'], got 'filter'\r\n{noformat}\r\n\r\noccurred when calling\r\n\r\n{code:puppet}\r\nsaltnetwork::iptables::is_builtin_chain('filter', 'INPUT')\r\n{code}\r\n\r\nwith the function in this form (parameter type of the second parameter is wrong and does not match INPUT, see type aliases below). I would expect an error about the second parameter, not the perfectly fine first one.\r\n\r\n{code:puppet}\r\nfunction saltnetwork::iptables::is_builtin_chain(\r\n    SaltNetwork::IPTables::Table $table\r\n  , SaltNetwork::IPTables::Custom_Chain_Name $chain\r\n  ) {\r\n\r\n  $chain in saltnetwork::iptables::builtin_chains_for_table($table)\r\n}\r\n{code}\r\n\r\nwith the type aliases\r\n\r\n{code:puppet}\r\ntype SaltNetwork::IPTables::Table = Enum['filter','nat','mangle','raw','security']\r\n{code}\r\n\r\n{code:puppet}\r\ntype SaltNetwork::IPTables::Custom_Chain_Name = Pattern[/^(?!(PREROUTING|INPUT|FORWARD|OUTPUT|POSTROUTING))[a-zA-Z][a-zA-Z0-9-]{0,31}$/]\r\n{code}\r\n\r\nand the function used in the body\r\n\r\n{code:puppet}\r\nfunction saltnetwork::iptables::builtin_chains_for_table(\r\n    SaltNetwork::IPTables::Table $table\r\n  ) {\r\n  case($table) {\r\n  \"filter\": {\r\n    ['INPUT','FORWARD','OUTPUT']\r\n  }\r\n  \"nat\": {\r\n    ['PREROUTING','INPUT','OUTPUT','POSTROUTING']\r\n  }\r\n  \"mangle\": {\r\n    ['PREROUTING','INPUT','FORWARD','OUTPUT','POSTROUTING']\r\n  }\r\n  \"raw\": {\r\n    ['PREROUTING','OUTPUT']\r\n  }\r\n  \"security\": {\r\n    ['INPUT','FORWARD','OUTPUT']\r\n  }\r\n  default: {\r\n    fail(\"Unknown table ${table}, you need to adjust SaltNetwork::IPTables::Table and this function\")\r\n  }\r\n  }\r\n}\r\n{code}\r\n","closed_at":"2017-02-02T06:19:50.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7012","labels":"","state":"Closed","updated_at":"2017-02-02T06:19:50.000-0800","timestamp":1652285226.453319,"priority":"Normal","status_category":"Done","pull_request":5436},{"issue_id":"170101","title":"Hiera lookup_key functions crash when using a location","url":"https://tickets.puppetlabs.com/browse/PUP-7099","created_at":"2017-01-13T03:31:29.000-0800","number":"PUP-7099","body":"A typo in the {{LookupKeyFunctionProvider}} makes it impossible to write a lookup_key function that uses a path.","closed_at":"2017-02-02T06:19:50.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7099","labels":"","state":"Closed","updated_at":"2017-02-02T06:19:50.000-0800","timestamp":1652285226.557273,"priority":"Normal","status_category":"Done","pull_request":5503},{"issue_id":"169602","title":"deep merge options in hiera v3 config not honored","url":"https://tickets.puppetlabs.com/browse/PUP-7088","created_at":"2017-01-10T16:44:29.000-0800","number":"PUP-7088","body":"it appears deep_merge_options are being picked up in the config file, but somehow not understood or honored:\r\n{code}\r\n[root@tcqscrr9nhig5nu v3_config_and_data_jmfzk9h3]# pwd\r\n/etc/puppetlabs/code/environments/v3_config_and_data_jmfzk9h3\r\n[root@tcqscrr9nhig5nu v3_config_and_data_jmfzk9h3]# cat hieradata/somesuch.*\r\n{\r\n  \"environment_key4\" : [\"jsonval\", \"4\"]\r\n}\r\n---\r\nenvironment_key4:\r\n  - val\r\n  - 4\r\n[root@tcqscrr9nhig5nu v3_config_and_data_jmfzk9h3]# cat /etc/puppetlabs/puppet/hiera.yaml\r\n---\r\n:backends:\r\n  - \"yaml\"\r\n  - \"json\"\r\n:hierarchy:\r\n  - \"somesuch\"\r\n  - \"common\"\r\n:merge_behavior: deeper\r\n:deep_merge_options:\r\n  :overwrite_arrays: true\r\n[root@tcqscrr9nhig5nu v3_config_and_data_jmfzk9h3]# puppet lookup --environment v3_config_and_data_jmfzk9h3 environment_key4 --explain\r\nWarning: /etc/puppetlabs/puppet/hiera.yaml: Use of 'hiera.yaml' version 3 is deprecated. It should be converted to version 5\r\n   (in /etc/puppetlabs/puppet/hiera.yaml)\r\nWarning: /etc/puppetlabs/puppet/hiera.yaml: merge_option 'overwrite_arrays' is not recognized. Option is ignored\r\nSearching for \"lookup_options\"\r\n  Global Data Provider (hiera configuration version 3)\r\n    Using configuration \"/etc/puppetlabs/puppet/hiera.yaml\"\r\n    Merge strategy hash\r\n      Hierarchy entry \"yaml\"\r\n        Merge strategy hash\r\n          Path \"/etc/puppetlabs/code/environments/v3_config_and_data_jmfzk9h3/hieradata/somesuch.yaml\"\r\n            Original path: \"somesuch\"\r\n            No such key: \"lookup_options\"\r\n          Path \"/etc/puppetlabs/code/environments/v3_config_and_data_jmfzk9h3/hieradata/common.yaml\"\r\n            Original path: \"common\"\r\n            Path not found\r\n      Hierarchy entry \"json\"\r\n        Merge strategy hash\r\n          Path \"/etc/puppetlabs/code/environments/v3_config_and_data_jmfzk9h3/hieradata/somesuch.json\"\r\n            Original path: \"somesuch\"\r\n            No such key: \"lookup_options\"\r\n          Path \"/etc/puppetlabs/code/environments/v3_config_and_data_jmfzk9h3/hieradata/common.json\"\r\n            Original path: \"common\"\r\n            Path not found\r\nSearching for \"environment_key4\"\r\n  Global Data Provider (hiera configuration version 3)\r\n    Using configuration \"/etc/puppetlabs/puppet/hiera.yaml\"\r\n    Merge strategy deep\r\n      Hierarchy entry \"yaml\"\r\n        Merge strategy deep\r\n          Path \"/etc/puppetlabs/code/environments/v3_config_and_data_jmfzk9h3/hieradata/somesuch.yaml\"\r\n            Original path: \"somesuch\"\r\n            Found key: \"environment_key4\" value: [\r\n              \"val\",\r\n              4\r\n            ]\r\n          Path \"/etc/puppetlabs/code/environments/v3_config_and_data_jmfzk9h3/hieradata/common.yaml\"\r\n            Original path: \"common\"\r\n            Path not found\r\n          Merged result: [\r\n            \"val\",\r\n            4\r\n          ]\r\n      Hierarchy entry \"json\"\r\n        Merge strategy deep\r\n          Path \"/etc/puppetlabs/code/environments/v3_config_and_data_jmfzk9h3/hieradata/somesuch.json\"\r\n            Original path: \"somesuch\"\r\n            Found key: \"environment_key4\" value: [\r\n              \"jsonval\",\r\n              \"4\"\r\n            ]\r\n          Path \"/etc/puppetlabs/code/environments/v3_config_and_data_jmfzk9h3/hieradata/common.json\"\r\n            Original path: \"common\"\r\n            Path not found\r\n          Merged result: [\r\n            \"jsonval\",\r\n            \"4\"\r\n          ]\r\n      Merged result: [\r\n        \"jsonval\",\r\n        \"4\",\r\n        \"val\",\r\n        4\r\n      ]\r\n[root@tcqscrr9nhig5nu v3_config_and_data_jmfzk9h3]# puppet lookup --environment v3_config_and_data_jmfzk9h3 environment_key4\r\nWarning: /etc/puppetlabs/puppet/hiera.yaml: Use of 'hiera.yaml' version 3 is deprecated. It should be converted to version 5\r\n   (in /etc/puppetlabs/puppet/hiera.yaml)\r\nWarning: /etc/puppetlabs/puppet/hiera.yaml: merge_option 'overwrite_arrays' is not recognized. Option is ignored\r\n---\r\n- jsonval\r\n- '4'\r\n- val\r\n- 4\r\n{code}\r\n\r\nalso when using --explain the value doesn't pop out in the same format.  maybe this is ok.\r\ni also find it somewhat strange that the value is presented in yaml, in particular because i'm not only using a yaml backend here.\r\ni kinda expect it in puppet pp format","closed_at":"2017-02-02T06:19:50.000-0800","comments":16,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7088","labels":"","state":"Closed","updated_at":"2017-02-02T06:19:50.000-0800","timestamp":1652285226.664889,"priority":"Normal","status_category":"Done","pull_request":5496},{"issue_id":"166102","title":"Remove the 'verbatim' option (added in PUP-6781)","url":"https://tickets.puppetlabs.com/browse/PUP-7004","created_at":"2016-12-13T06:42:10.000-0800","number":"PUP-7004","body":"After additional discussion the 'verbatim' feature did not turn out to be so great as it just introduces complexity and it we may block having a different interpolation format in the future. For that reason, we will remove the 'verbatim' feature. \r\n\r\nThus, the {{data_hash}} function always interpolates the values at the point in time when the value is produced. The other functions does not provide automatic interpolation but can opt in to interpolation the hiera way via the context object given to them. It is therefore up to the implementors of data providing functions to decide how they work.\r\n\r\nIn this ticket, the added 'verbatim' option should be removed. (The PUP-6781 cannot simply be reverted as it does not contain all of the implementation, but what it does contain may be).","closed_at":"2017-02-02T06:19:50.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7004","labels":"","state":"Closed","updated_at":"2017-02-02T06:19:50.000-0800","timestamp":1652285226.770343,"priority":"Normal","status_category":"Done","pull_request":5434},{"issue_id":"168854","title":"hiera: YAML.load_file('/dev/null') returns `false`, instead of a hash","url":"https://tickets.puppetlabs.com/browse/PUP-7067","created_at":"2017-01-05T02:38:52.000-0800","number":"PUP-7067","body":"331778e from  PUP-6980 caused hiera to call YAML.load_file('/dev/null') in some situations, which returns `false`, instead of a hash, leading to failures. This e.g. breaks rspec-puppet's setup shenanigans: https://github.com/rodjek/rspec-puppet/issues/434\r\n\r\nThat link also has a stack-trace and travis log showing the problem.","closed_at":"2017-02-02T06:19:50.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7067","labels":"","state":"Closed","updated_at":"2017-02-02T06:19:50.000-0800","timestamp":1652285226.874826,"priority":"Normal","status_category":"Done","pull_request":5466},{"issue_id":"170203","title":"Serialization of Sensitive with rich data is incorrect","url":"https://tickets.puppetlabs.com/browse/PUP-7104","created_at":"2017-01-14T16:01:14.000-0800","number":"PUP-7104","body":"The current implementation of {{Sensitive}} serialization is broken. It assumes that the same packer can be used for both normal data and extension data. As a consequence, it attempts to write rich data directly into the extension buffer. While fine for JSON, this approach doesn't work at all for MessagePack.\r\n\r\nThe fix for this was originally included in a PR for PUP-5908. That ticket is however stalled and since the fix changes the actual format, it's important that it gets included in the next release.","closed_at":"2017-02-02T06:19:50.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7104","labels":"","state":"Closed","updated_at":"2017-02-02T06:19:50.000-0800","timestamp":1652285226.981601,"priority":"Normal","status_category":"Done","pull_request":5507},{"issue_id":"171650","title":"hiera.yaml version 5 format must reserve the built in options","url":"https://tickets.puppetlabs.com/browse/PUP-7128","created_at":"2017-01-24T07:23:56.000-0800","number":"PUP-7128","body":"The built in options \"path\" and \"uri\" are reserved, users should not be able to set them as an option since they are set by the hiera 5 feature if paths/globs or uri/uris are used in the level configuration.\r\n\r\nIf user sets path or uri as an option in the options hash an error should be raised.","closed_at":"2017-02-02T06:19:50.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7128","labels":"","state":"Closed","updated_at":"2017-02-02T06:19:50.000-0800","timestamp":1652285227.086796,"priority":"Normal","status_category":"Done","pull_request":5534},{"issue_id":"161910","title":"Puppet tests fail with 'environment env2 enviroment_key lookup failed'","url":"https://tickets.puppetlabs.com/browse/PUP-6933","created_at":"2016-11-18T13:47:45.000-0800","number":"PUP-6933","body":"All cells in the puppet acceptance tests (from the puppet agent pipeline) are failing with:\r\n\r\n{code}\r\n11:57:37   jr2mzdotr1mti5b.delivery.puppetlabs.net (redhat7-64-1) executed in 1.50 seconds\r\n11:57:37   Beaker::DSL::Outcomes::FailTest: \r\n11:57:37   environment env2 enviroment_key lookup failed, expected /FunctionEnvDataProvider.* *.*env-env2-ruby-function/.\r\n11:57:37   Expected /FunctionEnvDataProvider.*\\s*.*env-env2-ruby-function/ to match \"Searching for \\\"lookup_options\\\"\\n  Data Binding \\\"hiera\\\"\\n    No such key: \\\"lookup_options\\\"\\n  Environment Data Provider (lookup version 5)\\n    deprecated API function \\\"environment::data\\\"\\n      No such key: \\\"lookup_options\\\"\\nSearching for \\\"environment_key\\\"\\n  Data Binding \\\"hiera\\\"\\n    No such key: \\\"environment_key\\\"\\n  Environment Data Provider (lookup version 5)\\n    deprecated API function \\\"environment::data\\\"\\n      Found key: \\\"environment_key\\\" value: \\\"env-env2-ruby-function data() provided value\\\"\\n\".\r\n11:57:37   /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-daily-puppet-master/SLAVE_LABEL/beaker/TEST_TARGET/redhat5-64a/puppet/acceptance/.bundle/gems/gems/beaker-3.1.0/lib/beaker/dsl/outcomes.rb:44\r\n11:57:37   /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-daily-puppet-master/SLAVE_LABEL/beaker/TEST_TARGET/redhat5-64a/puppet/acceptance/.bundle/gems/gems/beaker-3.1.0/lib/beaker/dsl/helpers/puppet_helpers.rb:184\r\n11:57:37   /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-daily-puppet-master/SLAVE_LABEL/beaker/TEST_TARGET/redhat5-64a/puppet/acceptance/.bundle/gems/gems/beaker-3.1.0/lib/beaker/dsl/helpers/puppet_helpers.rb:224\r\n11:57:37   /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-daily-puppet-master/SLAVE_LABEL/beaker/TEST_TARGET/redhat5-64a/puppet/acceptance/tests/parser_functions/puppet_lookup_cmd.rb:2159\r\n11:57:37   /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-daily-puppet-master/SLAVE_LABEL/beaker/TEST_TARGET/redhat5-64a/puppet/acceptance/.bundle/gems/gems/beaker-3.1.0/lib/beaker/test_case.rb:133\r\n11:57:37   /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-daily-puppet-master/SLAVE_LABEL/beaker/TEST_TARGET/redhat5-64a/puppet/acceptance/.bundle/gems/gems/beaker-3.1.0/lib/beaker/test_case.rb:133\r\n11:57:37   /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/2.3.0/benchmark.rb:308\r\n11:57:37   /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-daily-puppet-master/SLAVE_LABEL/beaker/TEST_TARGET/redhat5-64a/puppet/acceptance/.bundle/gems/gems/beaker-3.1.0/lib/beaker/test_case.rb:130\r\n11:57:37   /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-daily-puppet-master/SLAVE_LABEL/beaker/TEST_TARGET/redhat5-64a/puppet/acceptance/.bundle/gems/gems/beaker-3.1.0/lib/beaker/test_suite.rb:325\r\n11:57:37   /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-daily-puppet-master/SLAVE_LABEL/beaker/TEST_TARGET/redhat5-64a/puppet/acceptance/.bundle/gems/gems/beaker-3.1.0/lib/beaker/test_suite.rb:322\r\n11:57:37   /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-daily-puppet-master/SLAVE_LABEL/beaker/TEST_TARGET/redhat5-64a/puppet/acceptance/.bundle/gems/gems/beaker-3.1.0/lib/beaker/test_suite.rb:322\r\n11:57:37   /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-daily-puppet-master/SLAVE_LABEL/beaker/TEST_TARGET/redhat5-64a/puppet/acceptance/.bundle/gems/gems/beaker-3.1.0/lib/beaker/test_suite.rb:371\r\n11:57:37   /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-daily-puppet-master/SLAVE_LABEL/beaker/TEST_TARGET/redhat5-64a/puppet/acceptance/.bundle/gems/gems/beaker-3.1.0/lib/beaker/cli.rb:174\r\n11:57:37   /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-daily-puppet-master/SLAVE_LABEL/beaker/TEST_TARGET/redhat5-64a/puppet/acceptance/.bundle/gems/gems/beaker-3.1.0/lib/beaker/cli.rb:100\r\n11:57:37   /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-daily-puppet-master/SLAVE_LABEL/beaker/TEST_TARGET/redhat5-64a/puppet/acceptance/.bundle/gems/gems/beaker-3.1.0/bin/beaker:6\r\n11:57:37   /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-daily-puppet-master/SLAVE_LABEL/beaker/TEST_TARGET/redhat5-64a/puppet/acceptance/.bundle/gems/bin/beaker:23\r\n11:57:37   /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-daily-puppet-master/SLAVE_LABEL/beaker/TEST_TARGET/redhat5-64a/puppet/acceptance/.bundle/gems/bin/beaker:23\r\n11:57:37   Begin teardown\r\n11:57:37   End teardown\r\n11:57:37   tests/parser_functions/puppet_lookup_cmd.rb failed in 100.23 seconds\r\n{code}\r\n\r\nLink to full failing output: https://jenkins.puppetlabs.com/view/puppet-agent/view/master/view/puppet-agent/job/platform_puppet-agent_intn-van-sys_suite-daily-puppet-master/lastCompletedBuild/SLAVE_LABEL=beaker,TEST_TARGET=redhat5-64a/consoleFull\r\n\r\nNote that the puppet acceptance tests..\r\n(https://jenkins.puppetlabs.com/view/puppet-agent/view/master/view/puppet-agent/job/platform_puppet-agent_intn-van-sys_suite-daily-puppet-master)\r\n\r\n..have not had a passing run since November 10th so perhaps we should get a green run before further merges?","closed_at":"2017-02-02T06:19:51.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6933","labels":"","state":"Closed","updated_at":"2017-02-02T06:19:51.000-0800","timestamp":1652285227.191947,"priority":"Critical","status_category":"Done","pull_request":5391},{"issue_id":"157639","title":"lookup explain shows found data incorrectly","url":"https://tickets.puppetlabs.com/browse/PUP-6834","created_at":"2016-10-19T15:25:27.000-0700","number":"PUP-6834","body":"{code}\r\n# data/nodes/dev3.devco.net.yaml\r\nusers::local:\r\n  rip:\r\n    email: \"arri.pienaar@example.net\"\r\n{code}\r\n\r\n{code}\r\n# data/common.yaml\r\nusers::local:\r\n  rip:\r\n    email: \"rip@devco.net\"\r\n    comment: \"R.I.Pienaar\"\r\n    sudoer: true\r\n    shell: \"/bin/zsh\"\r\n{code}\r\n\r\nWhen I run explain with a hash merge above I see the following:\r\n\r\n{code}\r\n$ puppet lookup --environmentpath `pwd` users::local --merge deep --explain\r\nMerge strategy deep\r\n  Options: {\r\n    \"sort_merge_arrays\" => false,\r\n    \"merge_hash_arrays\" => false\r\n  }\r\n  Data Binding \"hiera\"\r\n    No such key: \"users::local\"\r\n  Data Provider \"Hiera Data Provider, version 4\"\r\n    ConfigurationPath \"/home/rip/temp/preso/environments/production/hiera.yaml\"\r\n    Merge strategy deep\r\n      Options: {\r\n        \"sort_merge_arrays\" => false,\r\n        \"merge_hash_arrays\" => false\r\n      }\r\n      Interpolation on \"nodes/%{trusted.certname}\"\r\n        Global Scope\r\n          Found key: \"trusted\" value: {\r\n            \"authenticated\" => \"local\",\r\n            \"certname\" => \"dev3.devco.net\",\r\n            \"extensions\" => {},\r\n            \"hostname\" => \"dev3\",\r\n            \"domain\" => \"devco.net\"\r\n          }\r\n        Sub key: \"certname\"\r\n          Found key: \"certname\" value: \"dev3.devco.net\"\r\n      Data Provider \"Nodes\"\r\n        Path \"/home/rip/temp/preso/environments/production/data/nodes/dev3.devco.net.yaml\"\r\n          Original path: \"nodes/%{trusted.certname}\"\r\n          Found key: \"users::local\" value: {\r\n            \"rip\" => {\r\n              \"email\" => \"arri.pienaar@example.net\"\r\n            }\r\n          }\r\n      Data Provider \"common\"\r\n        Path \"/home/rip/temp/preso/environments/production/data/common.yaml\"\r\n          Original path: \"common\"\r\n          Found key: \"users::local\" value: {\r\n            \"rip\" => {\r\n              \"email\" => \"arri.pienaar@example.net\",\r\n              \"comment\" => \"R.I.Pienaar\",\r\n              \"sudoer\" => true,\r\n              \"shell\" => \"/bin/zsh\"\r\n            }\r\n          }\r\n      Merged result: {\r\n        \"rip\" => {\r\n          \"email\" => \"arri.pienaar@example.net\",\r\n          \"comment\" => \"R.I.Pienaar\",\r\n          \"sudoer\" => true,\r\n          \"shell\" => \"/bin/zsh\"\r\n        }\r\n      }\r\n  Module \"users\"\r\n    Module not found\r\n  Merged result: {\r\n    \"rip\" => {\r\n      \"email\" => \"arri.pienaar@example.net\",\r\n      \"comment\" => \"R.I.Pienaar\",\r\n      \"sudoer\" => true,\r\n      \"shell\" => \"/bin/zsh\"\r\n    }\r\n  }\r\n{code}\r\n\r\nThe end result is correct, but note the following:\r\n\r\n{code}\r\n      Data Provider \"common\"\r\n        Path \"/home/rip/temp/preso/environments/production/data/common.yaml\"\r\n          Original path: \"common\"\r\n          Found key: \"users::local\" value: {\r\n            \"rip\" => {\r\n              \"email\" => \"arri.pienaar@example.net\",\r\n              \"comment\" => \"R.I.Pienaar\",\r\n              \"sudoer\" => true,\r\n              \"shell\" => \"/bin/zsh\"\r\n            }\r\n          }\r\n      Merged result: {\r\n        \"rip\" => {\r\n          \"email\" => \"arri.pienaar@example.net\",\r\n          \"comment\" => \"R.I.Pienaar\",\r\n          \"sudoer\" => true,\r\n          \"shell\" => \"/bin/zsh\"\r\n        }\r\n      }\r\n{code}\r\n\r\nI would expect the _Found key: \"users::local\" value_ to show email _rip@devco.net_ and the Merged Result to show _arri.pienaar@example.net_\r\n","closed_at":"2017-02-02T06:20:50.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6834","labels":"","state":"Closed","updated_at":"2017-02-02T06:20:50.000-0800","timestamp":1652285227.402504,"priority":"Normal","status_category":"Done","pull_request":5368},{"issue_id":"157011","title":"binary_file() file not found: error message unclear","url":"https://tickets.puppetlabs.com/browse/PUP-6821","created_at":"2016-10-14T16:31:36.000-0700","number":"PUP-6821","body":"{code}\r\n[root@veba8457upz4cbq ~]# puppet apply -e '$urlsafe = Binary(binary_file(\"motd/README.md\")) notify{ \"$urlsafe\": }'\r\nError: Evaluation Error: Error while evaluating a Function Call, binary_file(): The given file '' does not exist  at line 1:19 on node veba8457upz4cbq.delivery.puppetlabs.net\r\n{code}","closed_at":"2017-02-02T06:20:53.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6821","labels":"maintenance","state":"Closed","updated_at":"2017-02-02T06:20:53.000-0800","timestamp":1652285228.038803,"priority":"Normal","status_category":"Done","pull_request":5386},{"issue_id":"161253","title":"Fix issues with bad separation of concern between Array, Hash and Collection types","url":"https://tickets.puppetlabs.com/browse/PUP-6924","created_at":"2016-11-16T07:08:00.000-0800","number":"PUP-6924","body":"This ticket is about Puppet Type internals and what's proposed here does not affect how the types are declared or represented.\r\n\r\nIn the current implementation, the {{Collection}} type has both a _size_type_ and an _element_type_ attribute. This, despite the fact that only the _size_type_ is present in the specification. The _element_type_ cannot be declared as a parameter and it is also never included in the string representation of the type. The only reason for it being present in the {{Collection}} is to provide some common functionality shared between the {{Array}} _element_type_ and the {{Hash}} _value_type_.\r\n\r\nThe current design has several negative consequences.\r\n# The code is unclean. It's hard to understand why and when the _element_type_ is significant in the {{Collection}} type logic.\r\n# It makes the {{Collection}} type carry an unnecessary attribute.\r\n# It imposes the name _element_type_ on the {{Hash}} type although the name there really should be _value_type_ (to correspond with _key_type_).\r\n# It has a negative impact on serialization of the {{Collection}} type since special logic must be added to understand that the _element_type_ shouldn't be included. This must be fixed (hence the bug status rather than improvement in this ticket).\r\n","closed_at":"2017-02-02T06:20:54.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6924","labels":"maintenance","state":"Closed","updated_at":"2017-02-02T06:20:54.000-0800","timestamp":1652285228.354583,"priority":"Normal","status_category":"Done","pull_request":5383},{"issue_id":"159181","title":"data-in-modules: missing facts during building of the hierarchy fails the lookup completely and silently","url":"https://tickets.puppetlabs.com/browse/PUP-6856","created_at":"2016-11-01T09:14:36.000-0700","number":"PUP-6856","body":"When building the hierarchy for looking up data in modules, {{lib/puppet/data_providers/hiera_config.rb}} the interpolation around https://github.com/puppetlabs/puppet/blob/4.7.0/lib/puppet/data_providers/hiera_config.rb#L101 does weird things causing the whole lookup to fail, instead of\r\n\r\n* ignoring that hierarchy level\r\n* reporting a specific error\r\n\r\nThis can easily be reproduced by adding the following code to {{spec/classes/test_spec.rb}} into https://github.com/puppetlabs/puppetlabs-ntp/tree/c4f586c8eabc879837942febbb70d30dc4d614ac and running\r\n{code}\r\nbundle install --without system_tests\r\nbundle exec rake spec_prep\r\nbundle exec rspec spec/classes/test_spec.rb\r\n{code}\r\n\r\n{code}\r\nrequire 'spec_helper'\r\n\r\ndescribe 'ntp' do\r\n  before :each do\r\n    Puppet[:trace]= true\r\n  end\r\n  context \"false negatives\" do\r\n    context 'without facts' do\r\n      # \"restrict\" is the only reqired parameter with only OS defaults.\r\n      it { is_expected.to compile.and_raise_error(/expects a value for parameter 'restrict' at line 1/) }\r\n    end\r\n\r\n    context 'with only the required fact' do\r\n      # hiera.yaml uses os.family to locate data/Debian.yaml,\r\n      # which contains a ntp::restrict value\r\n      let :facts do\r\n        {\r\n          os: {\r\n            family: 'Debian',\r\n          }\r\n        }\r\n      end\r\n\r\n      it { is_expected.to compile }\r\n    end\r\n  end\r\n\r\n  context \"passing tests\" do\r\n    context 'with any facts' do\r\n      # these facts do not match any of the existing data files\r\n      # only common.yaml is used\r\n      let :facts do\r\n        {\r\n          os: {\r\n            name: 'foo',\r\n            family: 'foo',\r\n            release: { major: 'foo', full: 'foo' }\r\n          },\r\n          operatingsystem: 'foo'\r\n        }\r\n      end\r\n\r\n      it { is_expected.to compile.and_raise_error(/expects a value for parameter 'restrict' at line 1/) }\r\n    end\r\n\r\n    context 'with full facts' do\r\n      # all facts provided\r\n      let :facts do\r\n        {\r\n          os: {\r\n            name: 'Debian',\r\n            family: 'Debian',\r\n            release: { major: 'stretch/sid', full: 'stretch/sid' }\r\n          },\r\n          operatingsystem: 'foo'\r\n        }\r\n      end\r\n\r\n      it { is_expected.to compile }\r\n    end\r\n  end\r\nend\r\n{code}\r\n\r\nExpected Outcome: all these tests pass.\r\n\r\nActual outcome:\r\n\r\n{code}\r\ndavid@zion:~/git/puppetlabs-ntp$ bundle exec rspec spec/classes/test_spec.rb \r\n\r\nntp\r\n  false negatives\r\n    without facts\r\n      should fail to compile and raise an error matching /expects a value for parameter 'restrict' at line 1/ (FAILED - 1)\r\n    with only the required fact\r\n      should compile into a catalogue without dependency cycles (FAILED - 2)\r\n  passing tests\r\n    with any facts\r\n      should fail to compile and raise an error matching /expects a value for parameter 'restrict' at line 1/\r\n    with full facts\r\n      should compile into a catalogue without dependency cycles\r\n\r\nFailures:\r\n\r\n  1) ntp false negatives without facts should fail to compile and raise an error matching /expects a value for parameter 'restrict' at line 1/\r\n     Failure/Error: it { is_expected.to compile.and_raise_error(/expects a value for parameter 'restrict' at line 1/) }\r\n     \r\n       error during compilation: Evaluation Error: Error while evaluating a Function Call, Class[Ntp]:\r\n         expects a value for parameter 'broadcastclient'\r\n         expects a value for parameter 'config'\r\n         expects a value for parameter 'config_dir'\r\n         expects a value for parameter 'config_file_mode'\r\n         expects a value for parameter 'config_epp'\r\n         expects a value for parameter 'config_template'\r\n         expects a value for parameter 'disable_auth'\r\n         expects a value for parameter 'disable_dhclient'\r\n         expects a value for parameter 'disable_kernel'\r\n         expects a value for parameter 'disable_monitor'\r\n         expects a value for parameter 'fudge'\r\n         expects a value for parameter 'driftfile'\r\n         expects a value for parameter 'leapfile'\r\n         expects a value for parameter 'logfile'\r\n         expects a value for parameter 'iburst_enable'\r\n         expects a value for parameter 'keys'\r\n         expects a value for parameter 'keys_enable'\r\n         expects a value for parameter 'keys_file'\r\n         expects a value for parameter 'keys_controlkey'\r\n         expects a value for parameter 'keys_requestkey'\r\n         expects a value for parameter 'keys_trusted'\r\n         expects a value for parameter 'minpoll'\r\n         expects a value for parameter 'maxpoll'\r\n         expects a value for parameter 'package_ensure'\r\n         expects a value for parameter 'package_manage'\r\n         expects a value for parameter 'package_name'\r\n         expects a value for parameter 'panic'\r\n         expects a value for parameter 'peers'\r\n         expects a value for parameter 'preferred_servers'\r\n         expects a value for parameter 'restrict'\r\n         expects a value for parameter 'interfaces'\r\n         expects a value for parameter 'interfaces_ignore'\r\n         expects a value for parameter 'servers'\r\n         expects a value for parameter 'service_enable'\r\n         expects a value for parameter 'service_ensure'\r\n         expects a value for parameter 'service_manage'\r\n         expects a value for parameter 'service_name'\r\n         expects a value for parameter 'service_provider'\r\n         expects a value for parameter 'stepout'\r\n         expects a value for parameter 'step_tickers_file'\r\n         expects a value for parameter 'step_tickers_epp'\r\n         expects a value for parameter 'step_tickers_template'\r\n         expects a value for parameter 'tinker'\r\n         expects a value for parameter 'tos'\r\n         expects a value for parameter 'tos_minclock'\r\n         expects a value for parameter 'tos_minsane'\r\n         expects a value for parameter 'tos_floor'\r\n         expects a value for parameter 'tos_ceiling'\r\n         expects a value for parameter 'tos_cohort'\r\n         expects a value for parameter 'udlc'\r\n         expects a value for parameter 'udlc_stratum'\r\n         expects a value for parameter 'ntpsigndsocket'\r\n         expects a value for parameter 'authprov' at line 1:1 on node zion.black.co.at\r\n     # ./spec/classes/test_spec.rb:10:in `block (4 levels) in <top (required)>'\r\n\r\n  2) ntp false negatives with only the required fact should compile into a catalogue without dependency cycles\r\n     Failure/Error: it { is_expected.to compile }\r\n     \r\n       error during compilation: Evaluation Error: Error while evaluating a Function Call, Class[Ntp]:\r\n         expects a value for parameter 'broadcastclient'\r\n         expects a value for parameter 'config'\r\n         expects a value for parameter 'config_dir'\r\n         expects a value for parameter 'config_file_mode'\r\n         expects a value for parameter 'config_epp'\r\n         expects a value for parameter 'config_template'\r\n         expects a value for parameter 'disable_auth'\r\n         expects a value for parameter 'disable_dhclient'\r\n         expects a value for parameter 'disable_kernel'\r\n         expects a value for parameter 'disable_monitor'\r\n         expects a value for parameter 'fudge'\r\n         expects a value for parameter 'driftfile'\r\n         expects a value for parameter 'leapfile'\r\n         expects a value for parameter 'logfile'\r\n         expects a value for parameter 'iburst_enable'\r\n         expects a value for parameter 'keys'\r\n         expects a value for parameter 'keys_enable'\r\n         expects a value for parameter 'keys_file'\r\n         expects a value for parameter 'keys_controlkey'\r\n         expects a value for parameter 'keys_requestkey'\r\n         expects a value for parameter 'keys_trusted'\r\n         expects a value for parameter 'minpoll'\r\n         expects a value for parameter 'maxpoll'\r\n         expects a value for parameter 'package_ensure'\r\n         expects a value for parameter 'package_manage'\r\n         expects a value for parameter 'package_name'\r\n         expects a value for parameter 'panic'\r\n         expects a value for parameter 'peers'\r\n         expects a value for parameter 'preferred_servers'\r\n         expects a value for parameter 'restrict'\r\n         expects a value for parameter 'interfaces'\r\n         expects a value for parameter 'interfaces_ignore'\r\n         expects a value for parameter 'servers'\r\n         expects a value for parameter 'service_enable'\r\n         expects a value for parameter 'service_ensure'\r\n         expects a value for parameter 'service_manage'\r\n         expects a value for parameter 'service_name'\r\n         expects a value for parameter 'service_provider'\r\n         expects a value for parameter 'stepout'\r\n         expects a value for parameter 'step_tickers_file'\r\n         expects a value for parameter 'step_tickers_epp'\r\n         expects a value for parameter 'step_tickers_template'\r\n         expects a value for parameter 'tinker'\r\n         expects a value for parameter 'tos'\r\n         expects a value for parameter 'tos_minclock'\r\n         expects a value for parameter 'tos_minsane'\r\n         expects a value for parameter 'tos_floor'\r\n         expects a value for parameter 'tos_ceiling'\r\n         expects a value for parameter 'tos_cohort'\r\n         expects a value for parameter 'udlc'\r\n         expects a value for parameter 'udlc_stratum'\r\n         expects a value for parameter 'ntpsigndsocket'\r\n         expects a value for parameter 'authprov' at line 1:1 on node zion.black.co.at\r\n     # ./spec/classes/test_spec.rb:24:in `block (4 levels) in <top (required)>'\r\n\r\nFinished in 2.14 seconds (files took 0.719 seconds to load)\r\n4 examples, 2 failures\r\n\r\nFailed examples:\r\n\r\nrspec ./spec/classes/test_spec.rb:10 # ntp false negatives without facts should fail to compile and raise an error matching /expects a value for parameter 'restrict' at line 1/\r\nrspec ./spec/classes/test_spec.rb:24 # ntp false negatives with only the required fact should compile into a catalogue without dependency cycles\r\n\r\ndavid@zion:~/git/puppetlabs-ntp$ \r\n{code}\r\n\r\nThe first two tests (\"without facts\", and \"with only the required fact\") fail with none of the values with default values in common.yaml being applied. The \"with full facts\" one has all the facts for the hierarchy and suddenly works, although only the os.family should be required. The last one (\"with any facts\") shows that even specifying nonsensical values is sufficient to make the tests pass.\r\n","closed_at":"2017-02-02T06:20:54.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6856","labels":"","state":"Closed","updated_at":"2017-02-02T06:20:54.000-0800","timestamp":1652285228.459307,"priority":"Normal","status_category":"Done","pull_request":5367},{"issue_id":"155262","title":"Support setting/checking shell in user_role_add ","url":"https://tickets.puppetlabs.com/browse/PUP-6796","created_at":"2016-10-05T12:24:38.000-0700","number":"PUP-6796","body":"Support setting/checking shell in user_role_add ","closed_at":"2017-02-02T06:20:55.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6796","labels":"maintenance","state":"Closed","updated_at":"2017-02-02T06:20:55.000-0800","timestamp":1652285228.564697,"priority":"Normal","status_category":"Done","pull_request":5413},{"issue_id":"155258","title":"SMF should recursively enable services","url":"https://tickets.puppetlabs.com/browse/PUP-6792","created_at":"2016-10-05T12:08:46.000-0700","number":"PUP-6792","body":"SMF should recursively enable services by passing the -r flag to svcadm enable","closed_at":"2017-02-02T06:20:56.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6792","labels":"maintenance","state":"Closed","updated_at":"2017-02-02T06:20:56.000-0800","timestamp":1652285228.989183,"priority":"Normal","status_category":"Done","pull_request":5322},{"issue_id":"154948","title":"regression: incompatible character encodings: UTF-8 and ASCII-8BIT","url":"https://tickets.puppetlabs.com/browse/PUP-6777","created_at":"2016-10-04T12:21:13.000-0700","number":"PUP-6777","body":"This bug - seemingly fixed in https://github.com/puppetlabs/puppet/pull/3977#issuecomment-251466761 seems to have cropped up again:\r\nhttps://bugs.debian.org/cgi-bin/bugreport.cgi?bug=782494\r\n\r\nThis bug has cropped up again in puppet-4.6.1 (puppet-agent 1.6.1) - since we upgraded from puppet-3.7.1 on an agent. it only happens when we run puppet in cron - and the workaround LANG=en_US.utf8 in front of puppet agent -t - works.","closed_at":"2017-02-02T06:20:57.000-0800","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6777","labels":"i18n;utf-8","state":"Closed","updated_at":"2017-02-02T06:20:57.000-0800","timestamp":1652285229.303809,"priority":"Normal","status_category":"Done","pull_request":5453},{"issue_id":"154177","title":"Fix pkgng provider","url":"https://tickets.puppetlabs.com/browse/PUP-6758","created_at":"2016-09-29T11:38:11.000-0700","number":"PUP-6758","body":"The pkgng package provider fails badly if calls to pkg(8) fails such a way as to prevent Puppet from fixing the issue.\r\n\r\nLink to the PR is here: https://github.com/puppetlabs/puppet/pull/5285\r\n\r\nThe fix here is to return an empty array of package instances in the event of a non-zero exit call to pkg(8) during instances enumeration of the existing packages.  This might happen for a variety of reasons, one of which would be an empty list of repositories.","closed_at":"2017-02-02T06:20:58.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6758","labels":"","state":"Closed","updated_at":"2017-02-02T06:20:58.000-0800","timestamp":1652285229.409742,"priority":"Normal","status_category":"Done","pull_request":5285},{"issue_id":"161020","title":"the 'site' keyword cannot be used as an attribute name when app_management is on","url":"https://tickets.puppetlabs.com/browse/PUP-6917","created_at":"2016-11-14T15:14:44.000-0800","number":"PUP-6917","body":"The attribute name 'site' cannot be used as an attribute name when app_management is turned on. It works when app_management is turned off.\r\n\r\nThis is because the grammar does not list 'SITE' as a {{keyword}}, while handling the 'SITE_R' (app managment is off) token.\r\n\r\nThis affects some existing modules as they cannot be used with application managment (or PE where app_management is on by default).","closed_at":"2017-02-02T06:20:58.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6917","labels":"DSL;maintenance","state":"Closed","updated_at":"2017-02-02T06:20:58.000-0800","timestamp":1652285229.5143,"priority":"Normal","status_category":"Done","pull_request":5390},{"issue_id":"161233","title":"SSL - Improve CSR to local public key mismatch handling","url":"https://tickets.puppetlabs.com/browse/PUP-6918","created_at":"2016-11-15T21:41:10.000-0800","number":"PUP-6918","body":"Assume the following sequence of events:\r\n\r\n* Agent has generated public / private key pair and a CSR\r\n* Agent has sent a CSR to the master (by way of a `puppet agent` run)\r\n* Master has not yet signed the CSR\r\n\r\nNote that the agents CSR includes the agents public key.  Now perform the following:\r\n\r\n* Delete the agents entire SSL directory - including the public / private key pair, CA and CSR\r\n* Re-run `puppet agent -t`\r\n\r\nThe agent will regenerate all the SSL files.\r\n\r\nHowever, instead of using the new CSR that has been created locally (that matches the newly generated public / private key pair), the agent will download the previously submitted CSR from the master.  Despite there being no way of using the previously submitted CSR since the local agent no longer has a matching public key, Puppet will proceed without an error describing the circumstances.\r\n\r\nThe agent should perform a comparison of the local public key to the downloaded CSR to ensure they are a match.  When they are not a match, an error should be presented to the user advising them that their master has a mismatched CSR that must be cleaned.","closed_at":"2017-02-02T06:20:59.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6918","labels":"maintenance;ssl","state":"Closed","updated_at":"2017-02-02T06:20:59.000-0800","timestamp":1652285229.726371,"priority":"Normal","status_category":"Done","pull_request":5381},{"issue_id":"159701","title":"Incorrect handling of escape sequence precedence","url":"https://tickets.puppetlabs.com/browse/PUP-6882","created_at":"2016-11-04T00:48:26.000-0700","number":"PUP-6882","body":"Since Puppet 4 one can use Unicode escape sequences, which work fine:\r\n\r\n{noformat}\r\n$ puppet apply -e 'notify { \"\\uFFFF\": }'\r\nNotice: Compiled catalog for example.com in environment production in 0.11 seconds\r\nNotice: ￿\r\nNotice: /Stage[main]/Main/Notify[￿]/message: defined 'message' as '￿'\r\nNotice: Applied catalog in 0.10 seconds\r\n{noformat}\r\n\r\nHowever, if I now want to escape the unicode escape sequence by doubling the backslash and print the literal string {{\\uFFFF}} it seems like Puppet applies the {{\\u}} escape before the double backslash escape:\r\n\r\n{noformat}\r\n$ puppet apply -e 'notify { \"\\\\uFFFF\": }'\r\nWarning: Unrecognized escape sequence '\\￿'  at line 1:21\r\nNotice: Compiled catalog for example.com in environment production in 0.13 seconds\r\nNotice: \\￿\r\nNotice: /Stage[main]/Main/Notify[\\￿]/message: defined 'message' as '\\￿'\r\nNotice: Applied catalog in 0.10 seconds\r\n{noformat}\r\n\r\nI think this is the wrong way around, and certainly not what one would expect from other languages.","closed_at":"2017-02-02T06:20:59.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6882","labels":"maintenance","state":"Closed","updated_at":"2017-02-02T06:20:59.000-0800","timestamp":1652285229.831714,"priority":"Normal","status_category":"Done","pull_request":5389},{"issue_id":"171348","title":"Options should be passed to hiera 3 backend when declared in Hiera v5 config","url":"https://tickets.puppetlabs.com/browse/PUP-7124","created_at":"2017-01-20T14:04:29.000-0800","number":"PUP-7124","body":"Hiera 5 must ensure that a newly added {{hiera3_backend}} entry in the Hiera 5 configuration takes declared options into account and propagates them to the backend.","closed_at":"2017-02-06T07:14:43.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7124","labels":"","state":"Closed","updated_at":"2017-02-06T07:14:43.000-0800","timestamp":1652285230.260522,"priority":"Critical","status_category":"Done","pull_request":5526},{"issue_id":"155090","title":"http_proxy specs fail if proxy is defined in test env","url":"https://tickets.puppetlabs.com/browse/PUP-6784","created_at":"2016-10-05T06:52:04.000-0700","number":"PUP-6784","body":"If http_proxy is defined in the test environment specs fail due to precedence of http_proxy over HTTP_PROXY. \r\n\r\n...\r\n\r\n{code:java}\r\n  16) Puppet::Util::HttpProxy.http_proxy_password should use environment variable before puppet settings\r\n      Failure/Error: expect(subject.http_proxy_password).to eq(password)\r\n\r\n        expected: \"pAssw0rd\"\r\n             got: nil\r\n\r\n        (compared using ==)\r\n      # ./spec/unit/util/http_proxy_spec.rb:120:in `block (4 levels) in <top (required)>'\r\n      # ./lib/puppet/util.rb:128:in `withenv'\r\n      # ./spec/unit/util/http_proxy_spec.rb:118:in `block (3 levels) in <top (required)>'\r\n      # ./spec/spec_helper.rb:211:in `block (2 levels) in <top (required)>'\r\n\r\nFinished in 0.08603 seconds (files took 1.21 seconds to load)\r\n30 examples, 16 failures\r\n\r\n....\r\nrspec spec/unit/forge/repository_spec.rb\r\nRun options: exclude {:broken=>true, :benchmark=>true}\r\n..FFFF...FFFFF.F\r\n  1) Puppet::Forge::Repository making a request returns the result object from the request\r\n     Failure/Error: proxy_class = Net::HTTP::Proxy(self.http_proxy_host, self.http_proxy_port, self.http_proxy_user, self.http_proxy_password)\r\n\r\n     Mocha::ExpectationError:\r\n       unexpected invocation: Net::HTTP.Proxy('...\r\n{code}\r\n\r\n","closed_at":"2017-02-08T13:38:12.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6784","labels":"maintenance","state":"Resolved","updated_at":"2017-02-08T13:38:12.000-0800","timestamp":1652285231.106319,"priority":"Minor","status_category":"Done","pull_request":5316},{"issue_id":"173933","title":"Undefined Variable trusted.certname","url":"https://tickets.puppetlabs.com/browse/PUP-7171","created_at":"2017-02-03T08:29:37.000-0800","number":"PUP-7171","body":"After the update to 4.9.0 and a restart of the Puppet Server all nodes produce errors\r\n\r\n{noformat}\r\n Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Resource Statement, Undefined variable 'trusted.certname';  at /etc/puppetlabs/code/environments/production/modules20/saltmail/manifests/init.pp:676:5 on node ...\r\n{noformat}\r\n\r\nThe trusted hash is not used in any of our manifests. In all our environments the first time the error occurs is the \"include sudo\" line in our global manifest. If this is commented out another random location shows the error (depicted above), in this case the error message is right in the middle of an else line.\r\n\r\nThe error occurs on one Puppet Master on Debian wheezy and an independent Puppet Master (sharing some but not all manifest code) on Debian jessie.\r\n\r\nThe string 'trusted' never appears in our manifests or Ruby code in any modules.\r\nThe string certname appears twice as parameter name in certificate related modules but nowhere near the source location indicated.\r\n\r\nThe line 676 in the error above looks like this\r\n\r\n{code:puppet}\r\n  } else {\r\n{code}\r\n\r\nThe error with the sudo module occurs once on a simple \"include sudo\" line and once on the first line of a\r\n\r\n{code:puppet}\r\nclass { 'sudo':\r\n    autoupgrade => false\r\n}\r\n{code}\r\n\r\nThe puppetserver.log contains errors like this one\r\n\r\n\r\n{noformat}\r\n2017-02-03 17:01:20,335 ERROR [qtp1680176683-3570] [puppetserver] Puppet Evaluation Error: Error while evaluating a Resource Statement, Undefined variable 'trusted.certname';  at /etc/puppetlabs/code/environments\r\n/production/modules20/saltmail/manifests/init.pp:676:5 on node ...\r\n2017-02-03 17:01:20,335 ERROR [qtp1680176683-3570] [puppetserver] Puppet Server Error: Evaluation Error: Error while evaluating a Resource Statement, Undefined variable 'trusted.certname';  at /etc/puppetlabs/cod\r\ne/environments/production/modules20/saltmail/manifests/init.pp:676:5 on node...\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/scope.rb:531:in `variable_not_found'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/scope.rb:504:in `lookupvar'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/scope.rb:607:in `lookup_qualified_variable'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/scope.rb:493:in `lookupvar'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/hiera/scope.rb:25:in `[]'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/hiera_config.rb:171:in `scope_interpolations_stable?'\r\norg/jruby/RubyHash.java:1342:in `each'\r\norg/jruby/RubyEnumerable.java:1414:in `all?'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/hiera_config.rb:171:in `scope_interpolations_stable?'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/configured_data_provider.rb:83:in `data_providers'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/configured_data_provider.rb:49:in `unchecked_key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:116:in `with'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/configured_data_provider.rb:42:in `unchecked_key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/global_data_provider.rb:26:in `unchecked_key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/data_provider.rb:45:in `key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:73:in `check'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/data_provider.rb:45:in `key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:72:in `lookup_global'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:263:in `global_lookup_options'\r\norg/jruby/RubyKernel.java:1242:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:263:in `global_lookup_options'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:272:in `env_lookup_options'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:242:in `retrieve_lookup_options'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:116:in `with'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:238:in `retrieve_lookup_options'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:58:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:237:in `retrieve_lookup_options'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:139:in `lookup_lookup_options'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:124:in `lookup_merge_options'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:58:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:58:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:50:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:76:in `search_and_merge'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:401:in `inject_external_parameters'\r\norg/jruby/RubyKernel.java:1242:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:400:in `inject_external_parameters'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:396:in `inject_external_parameters'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:363:in `set_resource_parameters'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:171:in `evaluate_code'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:81:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:73:in `evaluate'\r\norg/jruby/RubyArray.java:1613:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:395:in `evaluate_classes'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_resource_support.rb:61:in `create_resources'\r\norg/jruby/RubyArray.java:2414:in `map'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_resource_support.rb:37:in `create_resources'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:321:in `create_resources'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:842:in `eval_ResourceExpression'\r\norg/jruby/RubyArray.java:2414:in `map'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:839:in `eval_ResourceExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:69:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:82:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:1007:in `eval_IfExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/scope.rb:938:in `with_guarded_scope'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:1003:in `eval_IfExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:69:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:82:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:638:in `eval_BlockExpression'\r\norg/jruby/RubyArray.java:1613:in `each'\r\norg/jruby/RubyEnumerable.java:852:in `inject'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:638:in `eval_BlockExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:69:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:82:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/evaluating_parser.rb:63:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:32:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:72:in `evaluate'\r\norg/jruby/RubyKernel.java:1242:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:71:in `evaluate'\r\norg/jruby/RubyKernel.java:1242:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:70:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast.rb:31:in `safeevaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:184:in `evaluate_code'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:81:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:73:in `evaluate'\r\norg/jruby/RubyArray.java:1613:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:395:in `evaluate_classes'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/../../../puppet/functions/include.rb:16:in `include'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatch.rb:47:in `invoke'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:36:in `dispatch'\r\norg/jruby/RubyKernel.java:1242:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:35:in `dispatch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:46:in `call'\r\norg/jruby/RubyKernel.java:1242:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:45:in `call'\r\n/etc/puppetlabs/code/environments/production/manifests/10_global.pp:60:in `call_function'\r\norg/jruby/RubyKernel.java:1079:in `eval'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:284:in `call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:282:in `call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:941:in `call_function_with_block'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:910:in `eval_CallNamedFunctionExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:69:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:82:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:1005:in `eval_IfExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/scope.rb:938:in `with_guarded_scope'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:1003:in `eval_IfExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:69:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:82:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:638:in `eval_BlockExpression'\r\norg/jruby/RubyArray.java:1613:in `each'\r\norg/jruby/RubyEnumerable.java:852:in `inject'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:638:in `eval_BlockExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:69:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:82:in `evaluate'\r\n/etc/puppetlabs/code/environments/production/manifests/10_global.pp:0:in `stack'\r\norg/jruby/RubyKernel.java:1079:in `eval'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/puppet_stack.rb:30:in `stack'\r\n{noformat}\r\n\r\nWe do not make any use of Hiera.\r\n\r\n(node names in errors and log omitted on purpose)","closed_at":"2017-02-10T14:41:56.000-0800","comments":24,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7171","labels":"","state":"Closed","updated_at":"2017-02-10T14:41:56.000-0800","timestamp":1652285231.608889,"priority":"Blocker","status_category":"Done","pull_request":5612},{"issue_id":"145505","title":"Allow context path in http_proxy","url":"https://tickets.puppetlabs.com/browse/PUP-6588","created_at":"2016-08-05T14:39:58.000-0700","number":"PUP-6588","body":"tried `export http_proxy=http://10.60.1.94:8080/artifactory/Puppet`\r\n\r\nThen \r\n`puppet module --debug search apache`\r\nDebug: Runtime environment: puppet_version=4.5.2, ruby_version=2.1.9, run_mode=user, default_encoding=UTF-8\r\nNotice: Searching https://forgeapi.puppetlabs.com ...\r\nDebug: HTTP GET https://forgeapi.puppetlabs.com/v3/modules?query=apache&module_groups=base+pe_only\r\nDebug: Evicting cache entry for environment 'production'\r\nDebug: Caching environment 'production' (ttl = 0 sec)\r\nError: Could not connect to https://forgeapi.puppetlabs.com\r\n  There was a network communications problem\r\n    The error we caught said '404 \"Not Found\"'\r\n    Check your network connection and try again\r\nError: Try 'puppet help module search' for usage\r\n\r\n\r\nIt tries to search module only from http://Host:Port  it ignores context path\r\n","closed_at":"2017-02-10T14:41:56.000-0800","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6588","labels":"","state":"Closed","updated_at":"2017-02-10T14:41:56.000-0800","timestamp":1652285231.718429,"priority":"Major","status_category":"Done","pull_request":5600},{"issue_id":"173761","title":"Hiera interpolation on key changed","url":"https://tickets.puppetlabs.com/browse/PUP-7167","created_at":"2017-02-02T07:43:23.000-0800","number":"PUP-7167","body":"On the latest puppet agent, with the new Hiera the a (yaml) key is not interpolated to its name.\r\nYaml snippet:\r\n\r\n{code}\r\nsssd::config:\r\n  'sssd':\r\n    'domains': '%{profile::defaults::krb5realm}'\r\n<snip>\r\n  \"domain/%{profile::defaults::krb5realm}\":\r\n    'cache_credentials': true\r\n<snip>\r\n{code}\r\n\r\nPrevious release this compiled to sssd.conf:\r\n{code}\r\n[sssd]\r\ndomains = FULL_KRB5_REALM\r\n<snip>\r\n[domain/FULL_KRB5_REALM]\r\ncache_credentials = true\r\n<snip>\r\n{code}\r\n\r\nHowever, since puppet agent 1.9.0 this happens:\r\n{code}\r\n[sssd]\r\ndomains = FULL_KRB5_REALM\r\n<snip>\r\n[domain/%{profile::defaults::krb5realm}]\r\ncache_credentials = true\r\n<snip>\r\n{code}\r\n\r\nThe variable is available, since it is used before, but it is not interpolated.","closed_at":"2017-02-10T14:41:57.000-0800","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7167","labels":"","state":"Closed","updated_at":"2017-02-10T14:41:57.000-0800","timestamp":1652285231.827934,"priority":"Major","status_category":"Done","pull_request":5607},{"issue_id":"173865","title":"Automatic parameter lookup expects Array/Hash instead of String with deeper merging","url":"https://tickets.puppetlabs.com/browse/PUP-7176","created_at":"2017-02-02T13:02:17.000-0800","number":"PUP-7176","body":"Automatic parameter lookup stopped working after updating Puppet Server. Now I get:\r\n{code}\r\nInfo: Using configured environment 'local'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nWarning: Found multiple default providers for service: debian, runit; using debian\r\nError: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Function Call, Lookup of key 'zabbix::server' failed: The first element of the merge has wrong type, expects a value of type Array or Hash, got String in The first element of the merge has wrong type, expects a value of type Array or Hash, got String at /etc/puppetlabs/code/environments/local/site.pp:1:1 on node puppet2.example.net\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\n{code}\r\n\r\nIn my Hiera hierarchy, I have set 'zabbix::server' to string in 2 layers. It should pick only one string. Instead, it tries to merge it as a hash and fails.\r\n\r\nhiera.yaml: http://pastebin.com/raw/N8NCTG6i\r\npuppet.conf: http://pastebin.com/raw/iuEN99na \r\nzabbix/manifests/init.pp: http://pastebin.com/raw/D5dA4T0t\r\n'zabbix::server' lines in hiera datadir: http://pastebin.com/raw/ri5fUtGa\r\nthe error and site.pp: http://pastebin.com/raw/24F3YhZa","closed_at":"2017-02-10T14:41:57.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7176","labels":"","state":"Closed","updated_at":"2017-02-10T14:41:57.000-0800","timestamp":1652285231.937444,"priority":"Major","status_category":"Done","pull_request":5611},{"issue_id":"173850","title":"a hiera.yaml v3 in the root of an env should be under control of --strict","url":"https://tickets.puppetlabs.com/browse/PUP-7165","created_at":"2017-02-02T11:21:16.000-0800","number":"PUP-7165","body":"Many people use a pattern of having a hiera.yaml (v3) in the root of their control repo for the purpose of symlinking it to the global hiera.yaml location setting path.\r\n\r\nPuppet 4.9.0 takes a hiera.yaml in an environment root as an error if the file is of version 3.\r\nThis means that users upgrading to puppet 4.9.0 may have a large number of environments to clean up before they can run puppet 4.9.0.\r\n\r\nWe should fix this problem by letting the {{\\--strict}} flag control the behavior. When it is set to {{error}} it should behave as it is currently doing in 4.9.0. When set to {{warning}} it should log a warning, and continue as if the file was not there.","closed_at":"2017-02-10T14:41:58.000-0800","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7165","labels":"","state":"Closed","updated_at":"2017-02-10T14:41:58.000-0800","timestamp":1652285232.156396,"priority":"Major","status_category":"Done","pull_request":5605},{"issue_id":"174050","title":"Hiera custom backends cannot find data in other backends using 'hiera' interpolation function","url":"https://tickets.puppetlabs.com/browse/PUP-7178","created_at":"2017-02-04T03:06:17.000-0800","number":"PUP-7178","body":"A hiera custom backend will run under control of classic Hiera. That Hiera is however not fully configured to handled nested lookups using the {{hiera}} interpolation function.\r\n\r\nWhile such nested lookups should be confined to the global layer (since classic Hiera is unaware of environment and module data providers), it must still find all other \"backends\" in that layer, even if they no longer are classic Hiera backends. This doesn't happen today, which means that a\r\n{code}\r\n%{hiera('some_key')}\r\n{code}\r\nwhere _'some_key'_ appoints something from another data provider will fail.","closed_at":"2017-02-10T14:41:58.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7178","labels":"","state":"Closed","updated_at":"2017-02-10T14:41:58.000-0800","timestamp":1652285232.265763,"priority":"Major","status_category":"Done","pull_request":5613},{"issue_id":"174564","title":"CI failure: tests/utf8.utf8-in-function-args.rb","url":"https://tickets.puppetlabs.com/browse/PUP-7190","created_at":"2017-02-08T08:30:33.000-0800","number":"PUP-7190","body":"This tested failed on multiple platforms:\r\n\r\nhttps://jenkins.puppetlabs.com/view/puppet-agent/view/manual/view/stable/job/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/107/testReport/\r\n\r\naix-53-power:\r\nhttps://jenkins.puppetlabs.com/view/puppet-agent/view/manual/view/stable/job/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/107/SLAVE_LABEL=beaker,TEST_TARGET=aix-53-power/testReport/junit/(root)/tests_utf8/utf8_in_function_args_rb/\r\n\r\nzpbw2rxembwqls.delivery.puppetlabs.net (master) 00:44:06$ service puppetserver reload\r\n          Redirecting to /bin/systemctl reload  puppetserver.service\r\n        \r\n        jzpbw2rxembwqls.delivery.puppetlabs.net (master) executed in 5.27 seconds\r\n        RuntimeError: PuppetAcceptance::DSL::Helpers.with_puppet_running_on failed (check backtrace for location) because: Host 'pe-aix-53-acceptance.delivery.puppetlabs.net' exited with 1 running:\r\n         env LANG=\"en_US.UTF-8\" puppet apply -e 'notice(hiera(\"array_key_with_utf8_€‰ㄘ万竹ÜÖ\"))'\r\n        Last 10 lines of output were:\r\n        \tWarning: The function 'hiera' is deprecated in favor of using 'lookup'. See https://docs.puppet.com/puppet/4.9.1/reference/deprecated_language.html\r\n        \t   (file & line not available)\r\n        \tWarning: /tmp/lookup_test_dir.28779/hiera.yaml: Use of 'hiera.yaml' version 3 is deprecated. It should be converted to version 5\r\n        \t   (in /tmp/lookup_test_dir.28779/hiera.yaml)\r\n        \tError: Function lookup() did not find a value for the name 'array_key_with_utf8_€‰ㄘ万竹ÜÖ'\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/host.rb:373:in `exec'\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/dsl/helpers/host_helpers.rb:83:in `block in on'\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/shared/host_manager.rb:127:in `run_block_on'\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/dsl/patterns.rb:37:in `block_on'\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/dsl/helpers/host_helpers.rb:63:in `on'\r\n        tests/utf8/utf8-in-function-args.rb:213:in `block (5 levels) in run_test'\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/dsl/structure.rb:43:in `step'\r\n        tests/utf8/utf8-in-function-args.rb:212:in `block (4 levels) in run_test'\r\n        tests/utf8/utf8-in-function-args.rb:18:in `each'\r\n        tests/utf8/utf8-in-function-args.rb:18:in `block (3 levels) in run_test'\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/dsl/helpers/puppet_helpers.rb:188:in `with_puppet_running_on'\r\n        tests/utf8/utf8-in-function-args.rb:17:in `block (2 levels) in run_test'\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/dsl/structure.rb:58:in `test_name'\r\n        tests/utf8/utf8-in-function-args.rb:1:in `block in run_test'\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/test_case.rb:133:in `eval'\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/test_case.rb:133:in `block in run_test'\r\n        /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/2.3.0/benchmark.rb:308:in `realtime'\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/test_case.rb:130:in `run_test'\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/test_suite.rb:325:in `block in run'\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/test_suite.rb:322:in `each'\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/test_suite.rb:322:in `run'\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/test_suite.rb:371:in `run_and_raise_on_failure'\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/cli.rb:178:in `run_suite'\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/cli.rb:104:in `execute!'\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/bin/beaker:9:in `<top (required)>'\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/bin/beaker:23:in `load'\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/bin/beaker:23:in `<main>'\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/dsl/helpers/puppet_helpers.rb:204\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/dsl/helpers/puppet_helpers.rb:241\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/tests/utf8/utf8-in-function-args.rb:17\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/dsl/structure.rb:58\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/tests/utf8/utf8-in-function-args.rb:1\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/test_case.rb:133\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/test_case.rb:133\r\n        /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/2.3.0/benchmark.rb:308\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/test_case.rb:130\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/test_suite.rb:325\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/test_suite.rb:322\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/test_suite.rb:322\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/test_suite.rb:371\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/cli.rb:178\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/lib/beaker/cli.rb:104\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/gems/beaker-3.10.0/bin/beaker:9\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/bin/beaker:23\r\n        /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/aix-53-power/puppet/acceptance/.bundle/gems/bin/beaker:23\r\n        Begin teardown\r\n        End teardown\r\n        Warning: tests/utf8/utf8-in-function-args.rb errored in 82.55 seconds\r\n\r\n\r\nThe failures are basically the same on the other systems as well.","closed_at":"2017-02-10T14:41:59.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7190","labels":"","state":"Closed","updated_at":"2017-02-10T14:41:59.000-0800","timestamp":1652285232.586298,"priority":"Blocker","status_category":"Done","pull_request":5627},{"issue_id":"138985","title":"UTF-8 source files for File resource cause failures","url":"https://tickets.puppetlabs.com/browse/PUP-6448","created_at":"2016-06-27T16:29:38.000-0700","number":"PUP-6448","body":"h1. Background\r\nThis ticket is raise in relation to UTF-8 support in Puppet and Puppet Enterprise.\r\n\r\nh1. Environment\r\n\r\nPE2016.2.0 for all nodes\r\nThe environment used for this test was https://github.com/beergeek/utf_8_env\r\nControl repo was https://github.com/beergeek/utf_8_test\r\nThe component module was https://github.com/beergeek/utf_8\r\nThe nodes were Windows 2012r2, CentOS 6 & 7, and Ubuntu 16.04 with locale set to {ja_JP.ut8}}, Ubu the master's locale was en_US.utf8\r\n\r\nh1. Test\r\nAll non-master nodes belong to the ウェブ・グループ Node Group, which has the class of {{role::base}}.  This calls a component module {{https://github.com/beergeek/utf_8}} instantiating several resources with UTF-8 characters.\r\n\r\nWhen using a file resource with the {{source}} attribute set to a UTF-8 filename the Puppet run will fail.\r\n\r\n{code}\r\nfile { \"${dir0}${file_name}\":\r\n  ensure => file,\r\n  source => 'puppet://modules/utf_8/静的',\r\n}\r\n{code}\r\n\r\nPuppet run:\r\n{code}\r\nError: /Stage[main]/Utf_8/File[/メインディレクトリ/ファイル＿3]: Could not evaluate: Could not retrieve file metadata for puppet://modules/utf_8/静的: invalid byte sequence in US-ASCII\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:302:in `=~'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:302:in `absolute_path?'\r\n{code}\r\n\r\nThis appears to be related to PUP-6426","closed_at":"2017-02-10T14:48:29.000-0800","comments":20,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6448","labels":"","state":"Closed","updated_at":"2017-02-10T14:48:29.000-0800","timestamp":1652285232.806513,"priority":"Major","status_category":"Done","pull_request":5176},{"issue_id":"121944","title":"Pip3 provider does not include features from Pip","url":"https://tickets.puppetlabs.com/browse/PUP-6067","created_at":"2016-03-17T12:05:54.000-0700","number":"PUP-6067","body":"The Pip3 provider was introduced in Puppet 4.2.0. The implementation was incomplete, as it doesn't specify the features provided by Pip, and using {{:parent}} doesn't inherit features.\r\n\r\nThat should only be a problem for people trying to use the Pip3 provider, but due to chance that provider is selected when no more appropriate providers are available (which happens often in module spec testing). The result is module spec tests trying to use many package features start failing in Puppet 4.2.0. See https://github.com/cdenneen/puppet-test/ for a simple example instantiating {{*package {'foo': ensure => '1.0.0-1'\\}*}}.","closed_at":"2017-02-13T09:54:45.000-0800","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6067","labels":"","state":"Closed","updated_at":"2017-02-13T09:54:45.000-0800","timestamp":1652285233.234798,"priority":"Normal","status_category":"Done","pull_request":4795},{"issue_id":"173920","title":"puppet 4.9.0 breaks hiera-eyaml ","url":"https://tickets.puppetlabs.com/browse/PUP-7169","created_at":"2017-02-03T01:04:10.000-0800","number":"PUP-7169","body":"Hello, \r\nwhen having hiera-eyaml installed and enabled (encrypted datastore), puppet 4.8.1 works like a charm on puppet 4.9.0 I get this error: \r\n\r\nError message: \r\n{noformat}\r\nError: Evaluation Error: Error while evaluating a Resource Statement, Lookup of key 'puppetserver::version' failed: Unrecognized value for request 'merge' parameter: 'unconstrained_deep' at /tmp/muh.pp:1:1 on node SERVER\r\n{noformat}\r\n\r\nNote: alreay opened a bug in HIERA https://tickets.puppetlabs.com/browse/HI-552\r\n\r\nEnvironment: \r\n\r\n{noformat}\r\n[root@server]# puppet -V\r\n4.9.0\r\n[root@server]# hiera -v\r\n3.3.0\r\n{noformat}\r\n\r\nHiera config:\r\n{noformat}\r\n---\r\n:backends:\r\n  - eyaml\r\n  - yaml\r\n\r\n:hierarchy:\r\n  - \"certname/%{::clientcert}\"\r\n  - \"cluster/%{::cluster}\"\r\n  - \"role/%{::role}\"\r\n  - \"topic/%{::topic}\"\r\n  - \"location/%{::location}\"\r\n  - \"common\"\r\n\r\n:yaml:\r\n  :datadir: /opt/provision/hiera\r\n\r\n:eyaml:\r\n  :datadir: /opt/provision/hiera\r\n  :pkcs7_private_key: /opt/provision/hiera_keys/private_key.pkcs7.pem\r\n  :pkcs7_public_key: /opt/provision/hiera_keys/public_key.pkcs7.pem\r\n  :extension: 'yaml'\r\n\r\n# options are native, deep, deeper\r\n:merge_behavior: deeper\r\n:deep_merge_options:\r\n  :knockout_prefix: '--'\r\n{noformat}\r\n\r\nGems: \r\n{noformat}\r\n[root@SERVER]# /opt/puppetlabs/puppet/bin/gem list\r\n\r\n*** LOCAL GEMS ***\r\n\r\nbigdecimal (1.2.4)\r\ndeep_merge (1.0.1)\r\nfacter (3.6.0)\r\nfast_gettext (1.1.0)\r\ngettext (3.2.2)\r\ngettext-setup (0.10)\r\nhiera (3.3.0)\r\nhiera-eyaml (2.1.0)\r\nhighline (1.6.21)\r\nhocon (1.1.3)\r\nio-console (0.4.3)\r\njson (1.8.1)\r\nlocale (2.1.2)\r\nminitest (4.7.5)\r\nnet-ssh (2.9.2)\r\npsych (2.0.5)\r\npuppet (4.9.0)\r\nrake (10.1.0)\r\nrdoc (4.1.0)\r\nsemantic_puppet (0.1.2)\r\nstomp (1.3.3)\r\ntest-unit (2.1.9.0)\r\ntext (1.3.1)\r\ntrollop (2.1.2)\r\n{noformat}\r\n\r\n","closed_at":"2017-02-15T04:51:41.000-0800","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7169","labels":"","state":"Closed","updated_at":"2017-02-15T04:51:41.000-0800","timestamp":1652285233.451519,"priority":"Major","status_category":"Done","pull_request":5608},{"issue_id":"16444","title":"RPM provider query method returns leading quote in package names","url":"https://tickets.puppetlabs.com/browse/PUP-535","created_at":"2013-10-08T16:16:06.000-0700","number":"PUP-535","body":"Due to the change in e96ac6b6abb9f387e9b8cd097b024aaa4bc656ee, the query method of the RPM provider now includes single quotes in the format passed to rpm. This causes the name of packages to be determined to have the leading quote (such as `'pe-puppet`). In particular, this causes strange output from the MCollective package agent (and thus Live Management).\r\n\r\nThe instances method (and thus `puppet resource`) works correctly. The difference seems to be the use of `execpipe` (which takes a verbatim string, where the quotes are assumed to be a grouping) vs. the `rpm` command helper (which takes an array, where the quotes are used as part of the format string). ","closed_at":"2017-02-21T10:23:56.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-535","labels":"regression","state":"Closed","updated_at":"2017-02-21T10:23:56.000-0800","timestamp":1652285233.98769,"priority":"Major","status_category":"Done","pull_request":5049},{"issue_id":"149854","title":"Large volumes of RPM queries leave stale locks on the rpm database","url":"https://tickets.puppetlabs.com/browse/PUP-6663","created_at":"2016-08-30T14:21:23.000-0700","number":"PUP-6663","body":"When running large volumes of rpm queries as the root user to determine package state, locks are placed on the rpm database that can become stale and prevent package installation/removal through either the rpm or yum providers. \r\n\r\nWorking directly with Red Hat, it was determined that this isn't an issue when executed as non-root users since no attempt is made to access the /var/lib/rpm/__db.[nnn] files. Obviously this isn't the normal scenario as typically puppet is run as root.\r\n\r\nExample:\r\n\r\n// Non-root user strace of an \"rpm -qa\"\r\n# grep db.00 /tmp/rpm.non-root.strace \r\n#\r\n\r\n\r\n// root user strace of an \"rpm -qa\"\r\n# grep db.00 /tmp/rpm.root.strace \r\naccess(\"/var/lib/rpm/__db.001\", F_OK)   = 0\r\nopen(\"/var/lib/rpm/__db.001\", O_RDWR)   = 3\r\nopen(\"/var/lib/rpm/__db.001\", O_RDWR)   = 3\r\nopen(\"/var/lib/rpm/__db.002\", O_RDWR)   = 3\r\nopen(\"/var/lib/rpm/__db.003\", O_RDWR)   = 3\r\nopen(\"/var/lib/rpm/__db.004\", O_RDWR)   = 3\r\naccess(\"/var/lib/rpm/__db.001\", F_OK)   = 0\r\n\r\nThe fix to prevent stale locks from occurring in situations of large query volumes appears to be properly quoting the query format string (represented as NEVRA_FORMAT) in the rpm provider.\r\n","closed_at":"2017-02-21T10:24:12.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6663","labels":"maintenance","state":"Closed","updated_at":"2017-02-21T10:24:12.000-0800","timestamp":1652285234.09483,"priority":"Normal","status_category":"Done","pull_request":5639},{"issue_id":"64021","title":"Two User provider spec tests fail on RedHat systems","url":"https://tickets.puppetlabs.com/browse/PUP-3850","created_at":"2015-01-14T14:04:38.000-0800","number":"PUP-3850","body":"The command line option -M is added when executing the useradd command on RedHat systems. Two provider tests for the User resource does not take this into account:\r\n\r\nspec/unit/provider/user/openbsd_spec.rb (#addcmd at line 50)\r\nspec/unit/provider/user/useradd_spec.rb (#creaete at line 57)\r\n","closed_at":"2017-02-23T14:15:12.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3850","labels":"","state":"Closed","updated_at":"2017-02-23T14:15:12.000-0800","timestamp":1652285234.533681,"priority":"Normal","status_category":"Done","pull_request":3488},{"issue_id":"174054","title":"Type aliases defined across multiple levels of modules","url":"https://tickets.puppetlabs.com/browse/PUP-7179","created_at":"2017-02-04T09:56:41.000-0800","number":"PUP-7179","body":"I have three modules; A, B and C.\r\n\r\n# Module C defines some type aliases.\r\n# Module B lists module C in `metadata.json` and defines some type aliases in terms of the ones in C, (`Variant`, `Array`, etc.).\r\n# Module A lists module B in `metadata.json` and uses the type aliases defined in B for parameter types.\r\n\r\nWhen I try and use module A I get errors similar to:\r\n\r\n{noformat}\r\nClass[A]: parameter 'myparam' references an unresolved type 'C::MyType'\r\n{noformat}\r\n\r\n`myparam` is defined in the class of type 'B::SomeType'.\r\n\r\nThe workaround is to also add module C to module A's `metadata.json` even though it is installed on the host by virtue of installing module B. I would argue it should just work without this as I'm not explicitly using any of C's resources; it's a dependency of B's and that module is free to change it's dependencies as it sees fit.","closed_at":"2017-02-24T14:07:36.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7179","labels":"","state":"Closed","updated_at":"2017-02-24T14:07:36.000-0800","timestamp":1652285234.852368,"priority":"Normal","status_category":"Done","pull_request":5614},{"issue_id":"120492","title":"Windows GetFileAttributes calls fail / symlink? may return false for a valid symlink","url":"https://tickets.puppetlabs.com/browse/PUP-6025","created_at":"2016-03-08T20:42:10.000-0800","number":"PUP-6025","body":"While using windbg to debug PUP-5768, I triggered an issue in Puppet affecting Windows that has flown under the radar based on how the code paths are exercised, but that is certainly causing performance degradations on Windows.\r\n\r\nThe problematic code was introduced in https://github.com/puppetlabs/puppet/commit/c64fa0749f673cc75c09b986f3e50a80c7237314 with the addition of calls to the Windows API {{GetFileAttributes}}.  These calls were added as they were necessary to implement symlink support on Windows.  When this code was introduced, we were unfortunately in the position of monkey patching broken file stats in Ruby on Windows or else write a whole new File class, replace all the calls across the codebase and hope to use it everywhere rather than the core Ruby file system.  Since that was turtles all the way down, we opted to make a tiny patch to Ruby itself.\r\n\r\nOf course, that decision had a penalty that is a bit more clear now, given the implementation of {{get_file_attributes}} has been discovered as errant.  Whether this was an initial testing oversight, or a change in Ruby behavior, I'm not certain just yet.\r\n\r\nAny time a file is stat'd, the {{symlink?}} detection codepath is triggered.  Unfortunately, it would appear that paths are being fed to {{get_file_attributes}} that have forward slashes / instead of the backslashes \\ that the Windows API expects.  Because the {{symlink?}} code eats exceptions and returns {{false}} when the {{GetFileAttributes}} API is called at https://github.com/puppetlabs/puppet/commit/c64fa0749f673cc75c09b986f3e50a80c7237314#diff-a91b066f285a8fe7ccfa4162399d458fR162, improperly setup calls to {{GetFileAttributes}} are silently / expensively swallowed.\r\n\r\nThe net result here is that for a trivial puppet apply, I logged 925 exceptions silently swallowed (mostly Puppet looking through subdirs for code):\r\n\r\n{code}\r\npuppet apply -e 'notify { 'hi': }'\r\n{code}\r\n\r\nA couple of ideas come to mind on how to fix this:\r\n\r\n* See if Ruby itself has fixed the underlying stats to support symlinks properly - re-examine if the Puppet implementation is necessary anymore on 2.1.x\r\n* Canonicalize all paths entering the {{get_file_attributes}} code path\r\n* Attempt to delay load the resolution if possible\r\n\r\nThe method is now called {{get_attributes}} and logging of the exceptions can be trivially added for demonstrative purposes by adding the following code at https://github.com/puppetlabs/puppet/blob/0c32e9d5e7aa87f2bcd9f8a5002c2400b6076456/lib/puppet/util/windows/file.rb#L97\r\n\r\n{code}\r\nopen('c:/attrib-fail.txt', 'a') { |f| f << \"#{file_name}\\n\" }}\r\n{code}\r\n\r\n\r\nAn excerpt of the complete output is:\r\n\r\n{noformat}\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/gems/2.1.0/gems/bigdecimal-1.2.4/lib/puppet/indirector/resource/ral.rb\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/gems/2.1.0/gems/deep_merge-1.0.1/lib/puppet/indirector/resource/ral.rb\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/gems/2.1.0/gems/ffi-1.9.6-x64-mingw32/lib/puppet/indirector/resource/ral.rb\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/gems/2.1.0/gems/io-console-0.4.3/lib/puppet/indirector/resource/ral.rb\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/gems/2.1.0/gems/json-1.8.1/lib/puppet/indirector/resource/ral.rb\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/gems/2.1.0/gems/minitar-0.5.4/lib/puppet/indirector/resource/ral.rb\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/gems/2.1.0/gems/minitest-4.7.5/lib/puppet/indirector/resource/ral.rb\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/gems/2.1.0/gems/psych-2.0.5/lib/puppet/indirector/resource/ral.rb\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/gems/2.1.0/gems/rake-10.1.0/lib/puppet/indirector/resource/ral.rb\r\n\r\n...\r\n\r\nC:/ProgramData/PuppetLabs/puppet/cache/lib/puppet/type/filebucket.rb\r\nC:/ProgramData/PuppetLabs/puppet/etc/csr_attributes.yaml\r\nC:/ProgramData/PuppetLabs/puppet/etc/ssl/private/password\r\nC:/ProgramData/PuppetLabs/puppet/etc/ssl/csr_vagrant-2008r2.pem\r\nC:/ProgramData/PuppetLabs/puppet/etc/ssl/certs/vagrant-2008r2.pem\r\nC:/ProgramData/PuppetLabs/puppet/etc/ssl/private_keys/vagrant-2008r2.pem\r\nC:/ProgramData/PuppetLabs/puppet/etc/ssl/public_keys/vagrant-2008r2.pem\r\nC:/ProgramData/PuppetLabs/puppet/cache/lib/puppet/reports/store.rb\r\nC:/ProgramData/PuppetLabs/puppet/cache/reports/vagrant-2008r2/201603090411.yaml\r\n{noformat}\r\n\r\nComplete Log: [^GetFileAttributes-fails.txt]\r\n\r\n","closed_at":"2017-02-24T15:58:23.000-0800","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6025","labels":"windows","state":"Closed","updated_at":"2017-02-24T15:58:23.000-0800","timestamp":1652285243.395084,"priority":"Major","status_category":"Done","pull_request":4895},{"issue_id":"84382","title":"cannot call 4.x functions from 3.x function ERB templates","url":"https://tickets.puppetlabs.com/browse/PUP-4753","created_at":"2015-06-12T08:31:19.000-0700","number":"PUP-4753","body":"It is not possible to call a 4.x function from a 3.x function or ERB template because that logic does not have ready access to a mechanism to perform such a call correctly.\r\n\r\nWe should add a new method of scope that works the same way as how the puppet language evaluator performs the call. i.e.:\r\n* The call is made with arguments using ruby/4.x semantics (no funny undef stuff)\r\n* If a 4.x function is found it wins\r\n* If a 3.x function is found the arguments are transformed to the 3.x convention (i.e. undef funny stuff).\r\n* in a 3.x version, 4.x. functions are only found if parser==future.\r\n\r\nThe solution is to add a method {{call_function}} on Scope. It accepts the name of a function as its first argument, followed by all arguments in an Array. It also accepts a Ruby block (as a lambda).\r\n\r\nORIGINAL REPORT\r\n----\r\nescaped and reported from outside:\r\nhttps://groups.google.com/forum/#!msg/puppet-users/Ht_5d2Wb6VA/v1lVtw031DkJ\r\n\r\n","closed_at":"2017-02-28T14:06:12.000-0800","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4753","labels":"","state":"Closed","updated_at":"2017-02-28T14:06:12.000-0800","timestamp":1652285244.692022,"priority":"Normal","status_category":"Done","pull_request":4033},{"issue_id":"88926","title":"Overriding attributes of defined types doesn't work through the ENC","url":"https://tickets.puppetlabs.com/browse/PUP-4856","created_at":"2015-07-13T18:58:32.000-0700","number":"PUP-4856","body":"Consider the following setup, with a defined type and two classes:\r\n\r\n{noformat}\r\ndefine defined_type_test($value) {\r\n  notify { \"message_${title}\":\r\n    message => $value,\r\n  }\r\n}\r\n\r\nclass base {\r\n  defined_type_test { 'foo':\r\n    value => 'Original Message',\r\n  }\r\n}\r\n\r\nclass override {\r\n  Defined_type_test <| title == 'foo' |> {\r\n    value => 'Overridden Message',\r\n  }\r\n}\r\n{noformat}\r\n\r\nWhen both classes are called via 'node default', it works as expected -- The 'message_foo' notify emits 'Overridden Message'.\r\n\r\nHowever, when the class 'base' is called via 'node default', and the class 'override' is called via the ENC, 'message_foo' emits 'Original Message'.  The 'override' class is definitely being executed; other resources added to the class are applied without issues.\r\n\r\nLikewise, only resources that are instances of defined types are affected.  Overriding an attribute of a 'real' type works fine from a class called via the ENC.\r\n\r\nAs best I can tell, this only occurs when all of the following are true:\r\n* You're attempting to override an attribute on a resource that is an instance of a defined type\r\n* The resource is created in a class that is called via manifests/site.pp\r\n* The collector to override the attribute is in a class that is called via the ENC (not necessarily directly; this also holds if an intermediate class is called from the ENC, which in turn calls the class containing the override)","closed_at":"2017-03-01T16:19:19.000-0800","comments":18,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4856","labels":"","state":"Closed","updated_at":"2017-03-01T16:19:19.000-0800","timestamp":1652285248.443504,"priority":"Normal","status_category":"Done","pull_request":4953},{"issue_id":"176004","title":"fix configuration_interpolation test","url":"https://tickets.puppetlabs.com/browse/PUP-7245","created_at":"2017-02-21T19:35:56.000-0800","number":"PUP-7245","body":"the configuration_interpolation test removes the global hiera.yaml. \r\n\r\nThis is bad, because other tests must use that file. we need to fix the test to no longer remove the global file.","closed_at":"2017-03-01T19:50:20.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7245","labels":"","state":"Resolved","updated_at":"2017-03-01T19:50:20.000-0800","timestamp":1652285249.724643,"priority":"Normal","status_category":"Done","pull_request":5657},{"issue_id":"175270","title":"PUP-6663 causes a regression of PUP-535","url":"https://tickets.puppetlabs.com/browse/PUP-7214","created_at":"2017-02-13T10:25:16.000-0800","number":"PUP-7214","body":"As exemplified in the output of the two beaker runs here: [https://gitlab.com/simp/pupmod-simp-rsync/pipelines/6452666], one with agent 1.7.1 and one with agent 1.9.1, when attempting to execute the following manifest:\r\n\r\n{noformat}\r\npackage { 'rsyslog.x86_64': ensure => absent, provider => rpm }\r\n{noformat}\r\n\r\nwhen you attempt to run on a rhel7 vm:\r\n\r\n{noformat}\r\nError: Execution of '/bin/rpm -e --nodeps 'rsyslog-5.8.10-10.el6_6.x86_64' returned 1: error: package 'rsyslog-5.8.10-10.el6_6.x86_64 is not installed\r\n  Error: /Stage[main]/Rsyslog::Install/Package[rsyslog.x86_64]/ensure: change from 5.8.10-10.el6_6 to absent failed: Execution of '/bin/rpm -e --nodeps 'rsyslog-5.8.10-10.el6_6.x86_64' returned 1: error: package 'rsyslog-5.8.10-10.el6_6.x86_64 is not installed\r\n  Notice: /Stage[main]/Rsyslog::Install/Package[rsyslog7.x86_64]: Dependency Package[rsyslog.x86_64] has failures: true\r\n{noformat}\r\n\r\nwhen running a debugging session, I can confirm the error is during the self.class.nevra_to_hash(output) on line 124:\r\n{noformat}\r\n[2] pry(#<Puppet::Type::Package::ProviderYum>)> output\r\n=> \"'rsyslog 0 7.4.7 16.el7 x86_64\\n'\"\r\n[3] pry(#<Puppet::Type::Package::ProviderYum>)> self.class.nevra_to_hash(output)\r\n=> {:name=>\"'rsyslog\", :epoch=>\"0\", :version=>\"7.4.7\", :release=>\"16.el7\", :arch=>\"x86_64\", :provider=>:yum, :ensure=>\"7.4.7-16.el7\"}\r\n[4] pry(#<Puppet::Type::Package::ProviderYum>)>\r\n{noformat}\r\n\r\nThis seems to have been introduced in PUP-6663 where single quotes were added around the version.","closed_at":"2017-03-02T17:21:45.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7214","labels":"flanders-ss","state":"Closed","updated_at":"2017-03-02T17:21:45.000-0800","timestamp":1652285249.941647,"priority":"Blocker","status_category":"Done","pull_request":5639},{"issue_id":"175738","title":"glob/globs in hiera 5 does not work (no implicit conversion of String into Integer)","url":"https://tickets.puppetlabs.com/browse/PUP-7235","created_at":"2017-02-20T10:51:55.000-0800","number":"PUP-7235","body":"Hi,\r\n\r\ni'm currently migrate from hiera 3 to hiera 5. I want to use new features like glob/globs. hiere is my test hiera config:\r\n\r\n\r\n{code:java}\r\n---\r\nversion: 5\r\n\r\ndefaults:\r\n  datadir: \"/etc/puppetlabs/code/environments/\"\r\n  data_hash: yaml_data\r\n\r\nhierarchy:\r\n  - name: \"Puppet Common\"\r\n    globs:\r\n      - \"%{environment}/hiera/common/*.yaml\"\r\n\r\n  - name: \"Puppet Common\"\r\n    paths:\r\n      - \"%{environment}/hiera/common.yaml\"\r\n{code}\r\n\r\nAny lookup related calls will result into an error:\r\n\r\n\r\n{code:java}\r\npuppet lookup --hiera_config /etc/puppetlabs/puppet/hiera.yaml.glob profile::yumrepo::groups --environment fix_puppet --merge unique  --trace\r\nError: Could not run: no implicit conversion of String into Integer\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/location_resolver.rb:39:in `glob'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/location_resolver.rb:39:in `glob'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/location_resolver.rb:39:in `block in expand_globs'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/location_resolver.rb:37:in `map'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/location_resolver.rb:37:in `expand_globs'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/hiera_config.rb:518:in `block in create_configured_data_providers'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/hiera_config.rb:499:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/hiera_config.rb:499:in `create_configured_data_providers'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/hiera_config.rb:163:in `configured_data_providers'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/configured_data_provider.rb:83:in `data_providers'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/configured_data_provider.rb:44:in `block in unchecked_key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:112:in `with'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/configured_data_provider.rb:42:in `unchecked_key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/global_data_provider.rb:26:in `unchecked_key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/data_provider.rb:45:in `block in key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:73:in `check'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/data_provider.rb:45:in `key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:72:in `lookup_global'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:227:in `block in do_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/merge_strategy.rb:129:in `block (3 levels) in lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/merge_strategy.rb:128:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/merge_strategy.rb:128:in `block (2 levels) in lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/merge_strategy.rb:126:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/merge_strategy.rb:126:in `reduce'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/merge_strategy.rb:126:in `block in lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:112:in `with'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/merge_strategy.rb:125:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:227:in `do_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:61:in `block (2 levels) in lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:112:in `with'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:61:in `block in lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:58:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:50:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:76:in `search_and_merge'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:31:in `block (2 levels) in lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:31:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:31:in `block in lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:29:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:29:in `reduce'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:29:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/lookup.rb:298:in `block in main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/lookup.rb:342:in `block in generate_scope'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:204:in `block in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:293:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:162:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/lookup.rb:342:in `generate_scope'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/lookup.rb:294:in `main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:352:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:541:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:132:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\n{code}\r\n\r\n--compile does not matter here. If I remove the glob setting, the lookup will work again.","closed_at":"2017-03-03T10:36:24.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7235","labels":"flanders-ss","state":"Closed","updated_at":"2017-03-03T10:36:24.000-0800","timestamp":1652285250.383316,"priority":"Blocker","status_category":"Done","pull_request":5652},{"issue_id":"153533","title":"When `recurse => true` is used in a file resource, tags are not applied to all recursive objects.","url":"https://tickets.puppetlabs.com/browse/PUP-6741","created_at":"2016-09-26T07:39:39.000-0700","number":"PUP-6741","body":"In the case where `recurse => true' is added to a file resource which is actually a directory with a whole bunch of files in it, it appears that not all these files get tagged with either the default tags for the class/resource or with custom tags specified in the resource declaration.\n\nIf these tags are then used later in a puppet run using --tags, the resource is not included.\n\nAs an example, the following code will create a number of files in a directory, where the directory is marked as {{recurse => true}} and the resource is tagged with a tag {{sometag}}:\n\n{code} \nclass abc::component::ao { \ntag 'sometag' \nfile { '/tmp/somefiles': \ntag => 'sometag', \nensure => directory, \nsource => \"puppet:///static/somefiles\", \nrecurse => true, \npurge => true, \nowner => 'root', \ngroup => 'root', \n} \nexec { 'do something': \ntag => 'sometag', \ncommand => '/bin/echo do something', # 20 lines script \nrefreshonly => true, \nsubscribe => [ \nFile['/tmp/somefiles'], \n], \n} \n} \n{code}\n\nHowever, when {{puppet agent -t --tags sometag}} is run, the following is noted in the output:\n\n{code}\nNotice: /Stage[main]/Abc::Component::Ao/File[/ao/basescripts/su_stop.ksh]/ensure: defined content as '{md5}1fd97a2fc03e639946d960ebd13bebd8'\nDebug: /Stage[main]/Abc::Component::Ao/File[/ao/basescripts/su_stop.ksh]: The container /ao/basescripts will propagate my refresh event\nDebug: /ao/basescripts: Not tagged with sometag\nDebug: /ao/basescripts: Resource is being skipped, unscheduling all events\nInfo: /ao/basescripts: Unscheduling all events on /ao/basescripts\n{code}\n\nThis suggests that the tag was not set correctly on all files when the recurse was set and so the Exec is not refreshed.\n\nThe exact same code without the `recurse => true` works exactly as expected.\n\nIs this a bug, and is there a workaround for this issue?\n\nStefan","closed_at":"2017-03-07T14:27:25.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6741","labels":"","state":"Closed","updated_at":"2017-03-07T14:27:25.000-0800","timestamp":1652285251.100779,"priority":"Critical","status_category":"Done","pull_request":5394},{"issue_id":"175422","title":"hiera_hash doesn't use deeper merge","url":"https://tickets.puppetlabs.com/browse/PUP-7216","created_at":"2017-02-14T02:21:50.000-0800","number":"PUP-7216","body":"Apache modules which shall be used are defined with hiera files.\r\n\r\nModules which shall be used by all webservers are defined in the file Ubuntu.yaml.\r\nIn addition modules which are in the individual server configs (hostxyz.yaml) shall be used.\r\n\r\nUntil upgrade to 4.9.x everything worked fine.\r\nSince the upgrade the infomation from Ubuntu.yaml gets ignored if modules in a node.yaml are defined.\r\nThis causes that puppet removes the default modules and the webserver stops working.\r\n\r\nI could confirm, that deeper merge is basically working, but since the upgrade it seems it cannot handle this structured data.\r\n\r\n{code:java}\r\nprofiles:\r\n  webserver:\r\n    apache:\r\n      httpd:\r\n        modules:\r\n          - mpm_prefork\r\n          - php\r\n          - ssl\r\n{code}\r\n\r\nIf no modules are defined in nodexyz.yaml I get in this basic demonstrator class (init.pp):\r\n{code:java}\r\nsudo puppet agent -t -v\r\nNotice: Apache mod: auth_kerb\r\nNotice: /Stage[main]/Testmodule/Notify[Apache mod: auth_kerb]/message: defined 'message' as 'Apache mod: auth_kerb'\r\nNotice: Apache mod: authnz_ldap\r\nNotice: /Stage[main]/Testmodule/Notify[Apache mod: authnz_ldap]/message: defined 'message' as 'Apache mod: authnz_ldap'\r\nNotice: Apache mod: cgid\r\nNotice: /Stage[main]/Testmodule/Notify[Apache mod: cgid]/message: defined 'message' as 'Apache mod: cgid'\r\nNotice: Apache mod: status\r\nNotice: /Stage[main]/Testmodule/Notify[Apache mod: status]/message: defined 'message' as 'Apache mod: status'\r\nNotice: Applied catalog in 3.65 seconds\r\n{code}\r\n\r\nAs soon as I enable a module in nodexyz.yaml I get:\r\n\r\n{code:java}\r\nNotice: Apache mod: mpm_prefork\r\nNotice: /Stage[main]/Testmodule/Notify[Apache mod: mpm_prefork]/message: defined 'message' as 'Apache mod: mpm_prefork'\r\nNotice: Apache mod: php\r\nNotice: /Stage[main]/Testmodule/Notify[Apache mod: php]/message: defined 'message' as 'Apache mod: php'\r\nNotice: Apache mod: ssl\r\nNotice: /Stage[main]/Testmodule/Notify[Apache mod: ssl]/message: defined 'message' as 'Apache mod: ssl'\r\nNotice: Applied catalog in 3.46 seconds\r\n{code}\r\n","closed_at":"2017-03-08T07:22:36.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7216","labels":"flanders-ss","state":"Closed","updated_at":"2017-03-08T07:22:36.000-0800","timestamp":1652285251.313811,"priority":"Critical","status_category":"Done","pull_request":5644},{"issue_id":"115228","title":"Lexer should raise a better error when loading manifest files containing a UTF-8 BOM (Byte Order Mark)","url":"https://tickets.puppetlabs.com/browse/PUP-5819","created_at":"2016-02-04T09:42:45.000-0800","number":"PUP-5819","body":"The current error message that Puppet propagates when lexing files that contain a leading UTF-8 BOM ({{0xFEFF}}) is {{Syntax error at '' at line 1:1}}.\r\n\r\nSaving a file with a UTF-8 BOM is rather common on Windows, and Puppet should be able to report a better error during the parsing phase that helps inform users of the appropriate action to take, given the parser cannot handle a BOM.  {{spec/unit/face/parser_spec.rb}} currently contains a test documenting the current behavior as part of https://github.com/puppetlabs/puppet/pull/4585/files\r\n\r\n\r\nNote - this does not impact loading of Ruby code from puppet modules.  Such loading uses the Ruby {{eval}} method after reading files from disk, and even if the content contains a leading BOM, Ruby does not have a problem parsing / executing the code.","closed_at":"2017-03-08T11:14:56.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5819","labels":"i18n;parser;utf-8;windows","state":"Closed","updated_at":"2017-03-08T11:14:56.000-0800","timestamp":1652285251.531863,"priority":"Normal","status_category":"Done","pull_request":4635},{"issue_id":"89917","title":"puppet describe -s ssh_authorized_key output is really bad","url":"https://tickets.puppetlabs.com/browse/PUP-4904","created_at":"2015-07-20T10:00:13.000-0700","number":"PUP-4904","body":"{code}\r\nroot@master:~ # puppet describe -s ssh_authorized_key\r\n\r\nssh_authorized_key\r\n==================\r\nManages SSH authorized keys. Currently only type 2 keys are supported.\r\nIn their native habitat, SSH keys usually appear as a single long line. This\r\nresource type requires you to split that line into several attributes. Thus,\r\na\r\nkey that appears in your `~/.ssh/id_rsa.pub` file like this...\r\n    ssh-rsa\r\n...would translate to the following resource:\r\n...would translate to the following resource:\r\n...would translate to the following resource:\r\n...would translate to the following resource:\r\n...would translate to the following resource:\r\n...would translate to the following resource:\r\n...would translate to the following resource:\r\neMue6b3FtUdTDeyAYoTxrsRo/WnDkS6Pa3YhrFwjtUqXfdaQ==\r\nnick@magpie.puppetlabs.lan\r\n...would translate to the following resource:\r\n    ssh_authorized_key { 'nick@magpie.puppetlabs.lan':\r\n      user => 'nick',\r\n      type => 'ssh-rsa',\r\n      key  =>\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\n    }\r\nBmuvPF1Mn3FwaFLjVsMT3GQeMue6b3FtUdTDeyAYoTxrsRo/WnDkS6Pa3YhrFwjtUqXfdaQ==',\r\n    }\r\nTo ensure that only the currently approved keys are present, you can purge\r\nunmanaged SSH keys on a per-user basis. Do this with the `user` resource\r\ntype's `purge_ssh_keys` attribute:\r\n    user { 'nick':\r\n      ensure         => present,\r\n      purge_ssh_keys => true,\r\n    }\r\nThis will remove any keys in `~/.ssh/authorized_keys` that aren't being\r\nmanaged with `ssh_authorized_key` resources. See the documentation of the\r\n`user` type for more details.\r\n**Autorequires:** If Puppet is managing the user account in which this\r\nSSH key should be installed, the `ssh_authorized_key` resource will\r\nautorequire\r\nthat user.\r\n\r\n\r\nParameters\r\n----------\r\n    ensure, key, name, options, target, type, user\r\n\r\nProviders\r\n---------\r\n    parsed\r\n{code}","closed_at":"2017-03-09T08:59:22.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4904","labels":"","state":"Closed","updated_at":"2017-03-09T08:59:22.000-0800","timestamp":1652285251.833406,"priority":"Normal","status_category":"Done","pull_request":5067},{"issue_id":"178229","title":"The eyaml lookup_key function does not evaluate interpolated hash keys","url":"https://tickets.puppetlabs.com/browse/PUP-7296","created_at":"2017-03-02T20:51:19.000-0800","number":"PUP-7296","body":"The eyaml backend, when finding an unencrypted hash, will only evaluate interpolations in the values of that hash. The keys are not evaluated. This is wrong. Both keys and values must be evaluated.","closed_at":"2017-03-10T06:29:49.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7296","labels":"","state":"Closed","updated_at":"2017-03-10T06:29:49.000-0800","timestamp":1652285252.258652,"priority":"Major","status_category":"Done","pull_request":5682},{"issue_id":"178005","title":"no hiera class parameter lookup debug information","url":"https://tickets.puppetlabs.com/browse/PUP-7291","created_at":"2017-03-02T02:16:05.000-0800","number":"PUP-7291","body":"With puppet 4.9.x hiera class parameter lookups are no longer explained when debug is enabled. Explicit lookup calls are explained still.","closed_at":"2017-03-10T06:29:50.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7291","labels":"","state":"Closed","updated_at":"2017-03-10T06:29:50.000-0800","timestamp":1652285252.364985,"priority":"Normal","status_category":"Done","pull_request":5684},{"issue_id":"177802","title":"Mute explain output during check for stable Hiera configuration","url":"https://tickets.puppetlabs.com/browse/PUP-7287","created_at":"2017-03-01T09:17:51.000-0800","number":"PUP-7287","body":"The internal scope lookups, made by the logic that checks if a Hiera configuration is stable, generates unwanted explain output if explain or debug logging is enabled. It only happens for interpolations using dotted keys.","closed_at":"2017-03-10T06:29:50.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7287","labels":"","state":"Closed","updated_at":"2017-03-10T06:29:50.000-0800","timestamp":1652285252.782187,"priority":"Normal","status_category":"Done","pull_request":5672},{"issue_id":"178019","title":"hiera 5 regression in puppet 4.9.0 causes interpolation in options to stop working","url":"https://tickets.puppetlabs.com/browse/PUP-7293","created_at":"2017-03-02T05:48:53.000-0800","number":"PUP-7293","body":"Hiera 5 in Puppet 4.9.0-4.9.3 has a regression for hiera.yaml (all versions) where interpolation of values into options stopped working.","closed_at":"2017-03-10T06:29:51.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7293","labels":"regression","state":"Closed","updated_at":"2017-03-10T06:29:51.000-0800","timestamp":1652285252.887745,"priority":"Major","status_category":"Done","pull_request":5679},{"issue_id":"177653","title":"hiera-eyaml option 'extension' is ignored","url":"https://tickets.puppetlabs.com/browse/PUP-7284","created_at":"2017-02-28T13:32:19.000-0800","number":"PUP-7284","body":"The option _:extension: 'yaml'_ from the hiera eyaml backend is ignored with puppet 4.9.x and files with the extension 'eyaml' are searched during key lookups. Worked without problems with puppet 4.8.x","closed_at":"2017-03-10T06:29:51.000-0800","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7284","labels":"","state":"Closed","updated_at":"2017-03-10T06:29:51.000-0800","timestamp":1652285252.996583,"priority":"Major","status_category":"Done","pull_request":5669},{"issue_id":"177773","title":"hiera array merge behaviour changed","url":"https://tickets.puppetlabs.com/browse/PUP-7286","created_at":"2017-03-01T08:03:25.000-0800","number":"PUP-7286","body":"We still use the hiera version 3 (i.e. unversioned/classic) hiera.yaml format.\r\n\r\nWith puppet 4.8.x and older versions class parameter lookups in hiera had the default merge behavior 'first', even if the option 'merge_behavior' 'deep' was active. With puppet 4.9.x class parameters of type array are now merged if the option 'merge_behavior' 'deep' is active.\r\n\r\nA simple reproducer:\r\n\r\n{code:title=hiera.yaml}\r\n---\r\n:backends:\r\n  - yaml\r\n:hierarchy:\r\n  - lvl1\r\n  - lvl2\r\n\r\n:yaml:\r\n  :datadir: \".\"\r\n\r\n:merge_behavior: deep\r\n{code}\r\n\r\n{code:title=lvl1.yaml}\r\ntclass::test:\r\n  - lvl1\r\n{code}\r\n\r\n{code:title=lvl2.yaml}\r\ntclass::test:\r\n  - lvl2\r\n{code}\r\n\r\n{code:title=test.pp}\r\nclass tclass (\r\n  $test = false,\r\n) {\r\n  notice($test)\r\n}\r\n\r\ninclude tclass\r\n{code}\r\n\r\nwith puppet 4.9.3:\r\n{noformat}\r\npuppet apply --hiera_config=hiera.yaml test.pp\r\nNotice: Scope(Class[Tclass]): [lvl1, lvl2]\r\n{noformat}\r\n\r\nwith puppet 4.8.0:\r\n{noformat}\r\npuppet apply --hiera_config=hiera.yaml test.pp\r\nNotice: Scope(Class[Tclass]): [lvl1]\r\n{noformat}\r\n\r\nif merge_behavior deep is removed from hiera.yaml, then puppet 4.9.3 behaves like puppet 4.8.0.","closed_at":"2017-03-10T06:29:51.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7286","labels":"","state":"Closed","updated_at":"2017-03-10T06:29:51.000-0800","timestamp":1652285253.104973,"priority":"Major","status_category":"Done","pull_request":5677},{"issue_id":"127903","title":"Acceptance: netconsole symlink validation fails on Scientific 6","url":"https://tickets.puppetlabs.com/browse/PUP-6228","created_at":"2016-04-22T10:55:31.000-0700","number":"PUP-6228","body":"On Scientific Linux 6, the following test fails because the test assumes that the generated run order number will be '50'.\r\n\r\nThe test needs to be refactored to accommodate other run orders than '50'.\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/3.x/acceptance/tests/resource/service/ticket_1343_should_add_and_remove_symlinks.rb\r\n","closed_at":"2017-03-10T06:50:09.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6228","labels":"","state":"Closed","updated_at":"2017-03-10T06:50:09.000-0800","timestamp":1652285253.317408,"priority":"Normal","status_category":"Done","pull_request":4907},{"issue_id":"24035","title":"user resource fails on UTF-8 comment","url":"https://tickets.puppetlabs.com/browse/PUP-1473","created_at":"2014-01-20T00:31:08.000-0800","number":"PUP-1473","body":"Setting the gecos/comment field in a local user on debian wheezy with puppet 3.4.2-1puppetlabs1 fails with an ugly error about utf-8 encodings.\r\n\r\nAs this system is completely utf-8 there is no reason that this should be an invalid value, as can be seen by \"puppet resource\" and \"getent passwd\" displaying the value without problems.\r\n\r\n{code}\r\nroot@puppetmaster:~# echo ü | od -ab\r\n0000000   C   <  nl\r\n        303 274 012\r\n0000003\r\nroot@puppetmaster:~# getent passwd david | od -ab\r\n0000000   d   a   v   i   d   :   x   :   1   0   0   1   :   1   0   0\r\n        144 141 166 151 144 072 170 072 061 060 060 061 072 061 060 060\r\n0000020   2   :   D   a   v   i   d  sp   S   c   h   m   i   t   t  sp\r\n        062 072 104 141 166 151 144 040 123 143 150 155 151 164 164 040\r\n0000040   w   i   t   h  sp   C   <   :   /   h   o   m   e   /   d   a\r\n        167 151 164 150 040 303 274 072 057 150 157 155 145 057 144 141\r\n0000060   v   i   d   :   /   b   i   n   /   b   a   s   h  nl\r\n        166 151 144 072 057 142 151 156 057 142 141 163 150 012\r\n0000076\r\nroot@puppetmaster:~# puppet resource user david | grep comment | od -ab\r\n0000000  sp  sp   c   o   m   m   e   n   t  sp  sp  sp  sp  sp  sp  sp\r\n        040 040 143 157 155 155 145 156 164 040 040 040 040 040 040 040\r\n0000020  sp  sp  sp   =   >  sp   '   D   a   v   i   d  sp   S   c   h\r\n        040 040 040 075 076 040 047 104 141 166 151 144 040 123 143 150\r\n0000040   m   i   t   t  sp   w   i   t   h  sp   C   <   '   ,  nl\r\n        155 151 164 164 040 167 151 164 150 040 303 274 047 054 012\r\n0000057\r\nroot@puppetmaster:~# echo 'user {foo: comment => \"ü\"}' | od -ab\r\n0000000   u   s   e   r  sp   {   f   o   o   :  sp   c   o   m   m   e\r\n        165 163 145 162 040 173 146 157 157 072 040 143 157 155 155 145\r\n0000020   n   t  sp   =   >  sp   \"   C   <   \"   }  nl\r\n        156 164 040 075 076 040 042 303 274 042 175 012\r\n0000034\r\nroot@puppetmaster:~# echo 'user {foo: comment => \"ü\"}' | puppet apply\r\nNotice: Compiled catalog for puppetmaster.example.org in environment production in 0.07 seconds\r\nError: Parameter comment failed on User[foo]: Munging failed for value \"ü\" in class comment: U+00FC from UTF-8 to ASCII-8BIT at line 1\r\nWrapped exception:\r\nMunging failed for value \"ü\" in class comment: U+00FC from UTF-8 to ASCII-8BIT\r\nroot@puppetmaster:~# locale\r\nLANG=en_US.UTF-8\r\nLANGUAGE=en_US:en\r\nLC_CTYPE=\"en_US.UTF-8\"\r\nLC_NUMERIC=\"en_US.UTF-8\"\r\nLC_TIME=\"en_US.UTF-8\"\r\nLC_COLLATE=\"en_US.UTF-8\"\r\nLC_MONETARY=\"en_US.UTF-8\"\r\nLC_MESSAGES=\"en_US.UTF-8\"\r\nLC_PAPER=\"en_US.UTF-8\"\r\nLC_NAME=\"en_US.UTF-8\"\r\nLC_ADDRESS=\"en_US.UTF-8\"\r\nLC_TELEPHONE=\"en_US.UTF-8\"\r\nLC_MEASUREMENT=\"en_US.UTF-8\"\r\nLC_IDENTIFICATION=\"en_US.UTF-8\"\r\nLC_ALL=\r\nroot@puppetmaster:~#\r\n{code}","closed_at":"2017-03-13T11:07:37.000-0700","comments":18,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1473","labels":"","state":"Closed","updated_at":"2017-03-13T11:07:37.000-0700","timestamp":1652285254.169853,"priority":"Normal","status_category":"Done","pull_request":2360},{"issue_id":"177829","title":"PUP 4.9.3 interpolation in hiera.yaml datadir stopped working","url":"https://tickets.puppetlabs.com/browse/PUP-7289","created_at":"2017-03-01T10:24:39.000-0800","number":"PUP-7289","body":"After the latest upgrade Hiera support does NOT work at all. \r\n\r\nConfigured as follows: \r\n{{/etc/puppetlabs/puppet/hiera.yaml}} (v3):\r\n{code:java}\r\n---\r\n:backends:\r\n  - yaml\r\n:hierarchy:\r\n  - \"nodes/%{::trusted.certname}\"\r\n  - \"roles/%{::role}\"\r\n  - \"virtual_%{::is_virtual}\"\r\n  - \"os_%{::operatingsystem}\"\r\n  - \"env_%{environment}\"\r\n  - common\r\n\r\n:logger: console\r\n# options are native, deep, deeper\r\n:merge_behavior: deeper\r\n:deep_merge_options:\r\n  :merge_hash_arrays: true\r\n  :unpack_arrays: true\r\n#  :preserve_unmergeables: true\r\n#  :knockout_prefix: '--'\r\n\r\n:yaml:\r\n# datadir is empty here, so hiera uses its defaults:\r\n# - /etc/puppetlabs/code/environments/%{environment}/hieradata on *nix\r\n# - %CommonAppData%\\PuppetLabs\\code\\environments\\%{environment}\\hieradata on Windows\r\n# When specifying a datadir, make sure the directory exists.\r\n  :datadir: /etc/puppetlabs/code/environments/%{environment}/hieradata\r\n{code}\r\n\r\n{{/etc/puppetlabs/code/hiera.yaml}} (v5):\r\n{code:java}\r\n---\r\nversion: 5\r\n\r\ndefaults:\r\n  #  datadir: /etc/puppetlabs/code/environments/%{environment}/hieradata\r\n  datadir: data\r\n  data_hash: yaml_data\r\n\r\nhierarchy:\r\n  - name: \"Nodes\"\r\n    path: \"nodes/%{::trusted.certname}.yaml\"\r\n  - name: \"Roles\"\r\n    path: \"roles/%{::role}.yaml\"\r\n  - name: \"Vurtual\"\r\n    path: \"virtual_%{::is_virtual}.yaml\"\r\n  - name: \"OS\"\r\n    path: \"os_%{::operatingsystem}.yaml\"\r\n  - name: \"Environment\"\r\n    path: \"env_%{environment}.yaml\"\r\n  - name: \"Common Defaults\"\r\n    path: \"common.yaml\"\r\n{code}\r\n\r\n\r\n{{/etc/puppetlabs/code/environments/corporate/manifests/site.pp}}:\r\n\r\nBefore the upgrade it had only one line and everything was fine:\r\n{code:java}\r\nhiera_include('classes')\r\n{code}\r\n\r\nAs per documentation, tried the following after the upgrade (\"either or\" and both blocks):\r\n{code:java}\r\ninclude lookup('classes', { 'merge' => 'deep' })\r\n{code}\r\n\r\n{code}\r\nlookup('classes', Array[String], 'deep').include\r\nlookup({ 'name'  => 'classes',\r\n         'merge' => {\r\n            'strategy'          => 'deep',\r\n            'merge_hash_arrays' => true,\r\n        },\r\n})\r\n{code}\r\n\r\n\r\nWhen running agent getting:\r\n\r\n{code:java}\r\n> sudo puppet agent -t\r\nInfo: Using configured environment 'corporate'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nError: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Function lookup() did not find a value for the name 'classes' on node <host>\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\n{code}\r\n\r\nand more in {{/var/log/puppetlabs/puppetserver/puppetserver.log}}:\r\n{code:java}\r\n2017-03-01 11:01:42,365 ERROR [qtp1371536656-79] [puppetserver] Puppet Function lookup() did not find a value for the name 'classes'\r\n2017-03-01 11:01:42,365 ERROR [qtp1371536656-79] [puppetserver] Puppet Function lookup() did not find a value for the name 'classes' on node <host>\r\n2017-03-01 11:01:42,365 ERROR [qtp1371536656-79] [puppetserver] Puppet Server Error: Function lookup() did not find a value for the name 'classes' on node <host>\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:86:in `fail_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:57:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/../../../puppet/functions/lookup.rb:209:in `do_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/../../../puppet/functions/lookup.rb:205:in `lookup_5'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatch.rb:47:in `invoke'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:36:in `dispatch'\r\norg/jruby/RubyKernel.java:1242:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:35:in `dispatch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:46:in `call'\r\norg/jruby/RubyKernel.java:1242:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:45:in `call'\r\n/etc/puppetlabs/code/environments/corporate/manifests/site.pp:1:in `call_function'\r\n{code}\r\n\r\n\r\nPlease advise. ","closed_at":"2017-03-14T10:53:23.000-0700","comments":34,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7289","labels":"flanders-ss;regression","state":"Closed","updated_at":"2017-03-14T10:53:23.000-0700","timestamp":1652285254.28677,"priority":"Critical","status_category":"Done","pull_request":5674},{"issue_id":"180216","title":"Create acceptance test for PUP-5058","url":"https://tickets.puppetlabs.com/browse/PUP-7342","created_at":"2017-03-13T09:33:13.000-0700","number":"PUP-7342","body":"Create an acceptance test confirming that Puppet can manage SSH keys on OS X 10.9, 10.10, and 10.11 -- the location of ssh_known_hosts moved from /etc/ to /etc/ssh in OS X 10.11.","closed_at":"2017-03-16T09:26:44.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7342","labels":"","state":"Closed","updated_at":"2017-03-16T09:26:44.000-0700","timestamp":1652285264.531081,"priority":"Normal","status_category":"Done","pull_request":5715},{"issue_id":"168203","title":"Test utf8_user_comments.rb fails to create user with UTF-8 comment on AIX","url":"https://tickets.puppetlabs.com/browse/PUP-7053","created_at":"2016-12-30T06:05:37.000-0800","number":"PUP-7053","body":"The user provider on AIX (5.3 at least) fails to create user with a UTF-8 GECOS string. The complaint is that the user name is too long. From tests/resource/user/utf8_user_comments.rb:\r\n{code}\r\n            pe-aix-53-acceptance.delivery.puppetlabs.net (pe-aix-53-acceptance) 02:48:42$ env LANG=\"POSIX\" puppet apply --verbose --detailed-exitcodes /tmp/apply_manifest.pp.7956\r\n              Notice: Compiled catalog for pe-aix-53-acceptance.delivery.puppetlabs.net in environment production in 0.11 seconds\r\n              Info: Applying configuration version '1483094925'\r\n              Error: Could not create user quux94122: Execution of '/usr/bin/mkuser gecos=Aۿ quux94122' returned 86: Error adding \"quux94122\" : Name is too long.\r\n              Error: /Stage[main]/Main/User[quux94122]/ensure: change from absent to present failed: Could not create user quux94122: Execution of '/usr/bin/mkuser gecos=Aۿ quux94122' returned 86: Error adding \"quux94122\" : Name is too long.\r\n              Notice: Applied catalog in 0.48 seconds\r\n            \r\n            pe-aix-53-acceptance.delivery.puppetlabs.net (pe-aix-53-acceptance) executed in 4.13 seconds\r\n            Exited: 4\r\n            Beaker::Host::CommandFailure: Host 'pe-aix-53-acceptance.delivery.puppetlabs.net' exited with 4 running:\r\n             env LANG=\"POSIX\" puppet apply --verbose --detailed-exitcodes /tmp/apply_manifest.pp.7956\r\n{code}\r\nSee\r\n* https://jenkins.puppetlabs.com/user/kurt.wall/my-views/view/puppet-agent%20master%20Manual%20Pipeline/job/platform_puppet-agent_intn-van-sys_suite-manual-puppet-master/SLAVE_LABEL=beaker,TEST_TARGET=aix-53-power/66/ \r\n* https://jenkins.puppetlabs.com/user/kurt.wall/my-views/view/puppet-agent%20master%20Manual%20Pipeline/job/platform_puppet-agent_intn-van-sys_suite-manual-puppet-master/SLAVE_LABEL=beaker,TEST_TARGET=aix-71-power/66/","closed_at":"2017-03-22T10:58:22.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7053","labels":"","state":"Closed","updated_at":"2017-03-22T10:58:22.000-0700","timestamp":1652285265.381402,"priority":"Normal","status_category":"Done","pull_request":5454},{"issue_id":"45732","title":"Puppet service hangs when attempting to stop on Windows","url":"https://tickets.puppetlabs.com/browse/PUP-2987","created_at":"2014-07-29T10:55:54.000-0700","number":"PUP-2987","body":"There is a race condition in the Puppet service code that prevents it from properly stopping.\r\n\r\nGenerally speaking this can be reproduced by installing from the MSI, then attempting to upgrade / remove the MSI shortly thereafter.\r\n\r\nIn the wild, we've noticed it can be either {{puppet}} / {{pe-puppet}} or {{mcollective}} / {{pe-mcollective}}, so the service code for puppet and mcollective should both be addressed.\r\n\r\nThis has also been experienced in the Azure environment, where the Azure extension handler code addresses this by force stopping the service process by PID if the service doesn't exit gracefully.\r\nhttps://github.com/puppetlabs/azure-extension-handler/blob/master/installer/windows.ps1#L137-L149","closed_at":"2017-03-24T13:47:19.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2987","labels":"windows","state":"Closed","updated_at":"2017-03-24T13:47:19.000-0700","timestamp":1652285267.383487,"priority":"Critical","status_category":"Done","pull_request":2936},{"issue_id":"182310","title":"Acceptance: Create test verifying that stopping the puppet service on Windows does","url":"https://tickets.puppetlabs.com/browse/PUP-7392","created_at":"2017-03-23T11:32:41.000-0700","number":"PUP-7392","body":"PUP-2987 fixed a set of corner cases in the puppet service on Windows in which the service would hang instead of stopping. This ticket tracks creating an acceptance test to verify this behavior.","closed_at":"2017-03-24T14:07:12.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7392","labels":"","state":"Closed","updated_at":"2017-03-24T14:07:12.000-0700","timestamp":1652285267.490578,"priority":"Normal","status_category":"Done","pull_request":5759},{"issue_id":"42858","title":"OS X package is broken on Ruby 1.8","url":"https://tickets.puppetlabs.com/browse/PUP-2956","created_at":"2014-07-18T14:59:13.000-0700","number":"PUP-2956","body":"This is an issue in the PUP project to track an issue currently residing in the Community Package Repository project. See the linked ticket.","closed_at":"2017-03-30T23:16:26.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2956","labels":"","state":"Closed","updated_at":"2017-03-30T23:16:26.000-0700","timestamp":1652285268.65672,"priority":"Normal","status_category":"Done","pull_request":2890},{"issue_id":"27566","title":"File resource fails for root(/) directory.","url":"https://tickets.puppetlabs.com/browse/PUP-1796","created_at":"2014-02-27T14:30:04.000-0800","number":"PUP-1796","body":"I know this is probably an extreme edge case, but I recently noticed that this fails:\r\n\r\n{code}\r\nfile { '/': ensure => directory }\r\n\r\nwith the error:  Parameter path failed: File paths must be fully qualified, not '' at /tmp/test.pp:1\r\n{code}\r\n\r\nA little background, This comes from a larger module that I have which uses the lvm module to create additional or grow existing filesystems on a server. The file resource is used to make sure the mount point exists before using the mount resource to manage /etc/fstab and mount the filesystem. I noticed that if I tried to use my custom module to grow the root\\(/) filesystem that I got the error above. Is the / being removed to make it an empty path as a result of some code to try and remove trailing slashes from paths?","closed_at":"2017-03-31T15:20:38.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1796","labels":"puppethack;redmine;type_file","state":"Closed","updated_at":"2017-03-31T15:20:38.000-0700","timestamp":1652285269.084808,"priority":"Normal","status_category":"Done","pull_request":5126},{"issue_id":"120580","title":"Recursive file resource in static catalog creates empty directory when source has trailing \"/\"","url":"https://tickets.puppetlabs.com/browse/PUP-6033","created_at":"2016-03-09T12:14:56.000-0800","number":"PUP-6033","body":"The agent strips trailing slashes when normalizing the source parameter, which causes it to not find the metadata in the catalog. ","closed_at":"2017-03-31T15:20:39.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6033","labels":"burnside-ss","state":"Closed","updated_at":"2017-03-31T15:20:39.000-0700","timestamp":1652285269.190806,"priority":"Normal","status_category":"Done","pull_request":4771},{"issue_id":"153877","title":"regression: Code that doesn't compile with app_management=false does with app_management=true","url":"https://tickets.puppetlabs.com/browse/PUP-6752","created_at":"2016-09-28T08:26:36.000-0700","number":"PUP-6752","body":"[app_management|https://docs.puppet.com/puppet/latest/reference/configuration.html#appmanagement] defaults to false, but when set to true, code that didn't compile previously now does.\r\n\r\ntest.pp\r\n{code:puppet}\r\n$dir='/tmp/test'\r\n$same_dir='/tmp/test/'\r\n\r\nfile {$dir:\r\n  ensure => directory\r\n}\r\n\r\nif !defined(File[\"${same_dir}\"]) {\r\n  file { $same_dir:\r\n    ensure => directory\r\n  }\r\n}\r\n{code}\r\n\r\n{code}\r\nalex@alex-VirtualBox:~$ puppet --version\r\n4.7.0\r\n{code}\r\n\r\nRuns as expected:\r\n{code}\r\nalex@alex-VirtualBox:~$ puppet apply test.pp --noop\r\nNotice: Compiled catalog for alex-virtualbox.example.com in environment production in 0.09 seconds\r\nError: Cannot alias File[/tmp/test/] to [\"/tmp/test\"] at /home/alex/test.pp:9; resource [\"File\", \"/tmp/test\"] already declared at /home/alex/test.pp:4\r\n{code}\r\n\r\nRuns as expected:\r\n{code}\r\nalex@alex-VirtualBox:~$ puppet apply --no-app_management test.pp --noop\r\nNotice: Compiled catalog for alex-virtualbox.example.com in environment production in 0.09 seconds\r\nError: Cannot alias File[/tmp/test/] to [\"/tmp/test\"] at /home/alex/test.pp:9; resource [\"File\", \"/tmp/test\"] already declared at /home/alex/test.pp:4\r\n{code}\r\n\r\nFails by not flagging the error:\r\n{code}\r\nalex@alex-VirtualBox:~$ puppet apply --app_management test.pp --noop\r\nNotice: Compiled catalog for alex-virtualbox.example.com in environment production in 0.09 seconds\r\nNotice: /Stage[main]/Main/File[/tmp/test]/ensure: current_value absent, should be directory (noop)\r\nNotice: Class[Main]: Would have triggered 'refresh' from 1 events\r\nNotice: Stage[main]: Would have triggered 'refresh' from 1 events\r\n{code}\r\n\r\nThis is problematic as rspec-puppet now turns on this option even though most users will have it turned off.  Code that should fail for most users passes spec testing.\r\n\r\nSee https://github.com/rodjek/rspec-puppet/issues/417 and https://github.com/voxpupuli/puppet-staging/pull/113\r\n","closed_at":"2017-03-31T15:20:39.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6752","labels":"maintenance","state":"Closed","updated_at":"2017-03-31T15:20:39.000-0700","timestamp":1652285269.298096,"priority":"Normal","status_category":"Done","pull_request":5312},{"issue_id":"173904","title":"PCore object default equality not working","url":"https://tickets.puppetlabs.com/browse/PUP-7168","created_at":"2017-02-02T15:45:06.000-0800","number":"PUP-7168","body":"When using [~thomas.hallgren]'s rich-data-wip [branch|https://github.com/thallgren/puppet/tree/rich-data-wip] PCore objects are not being properly checked for default equality:\r\n\r\n{noformat}\r\n17:43 $ DEVICE_IP=10.32.166.100 DEVICE_USER=root DEVICE_PASSWORD=lab bundle exec puppet apply 28.pp --modulepath ~/workspace/\r\nNotice: Compiled catalog for w541.shermdog.local in environment production in 0.20 seconds\r\nNotice: /Stage[main]/Main/Xe_ietf_diffserv_policy_pcore[prm-DSCP#QUEUING_O_1]/policy_entry: policy_entry changed 'Vanilla_ice::Diffserv_policy::Policy_entry({\r\n  'policy_name' => 'prm-DSCP#QUEUING_O_1',\r\n  'classifier_entry' => [\r\n    Vanilla_ice::Diffserv_policy::Classifier_entry({\r\n      'classifier_entry_name' => 'class-default',\r\n      'classifier_action_entry_cfg' => [\r\n        Vanilla_ice::Diffserv_policy::Classifier_action_entry_cfg({\r\n          'action_type' => 'action:min-rate',\r\n          'min_rate_cfg' => Vanilla_ice::Diffserv_policy::Min_rate_cfg({\r\n            'absolute_rate_metric' => 'none',\r\n            'absolute_rate_units' => 'bps',\r\n            'bw_excess_share_cfg' => Vanilla_ice::Diffserv_policy::Bw_excess_share_cfg({\r\n              'value' => 28,\r\n              'absolute_rate_metric' => 'none',\r\n              'absolute_rate_units' => 'perc'\r\n            })\r\n          })\r\n        })\r\n      ]\r\n    })\r\n  ]\r\n})' to 'Vanilla_ice::Diffserv_policy::Policy_entry({\r\n  'policy_name' => 'prm-DSCP#QUEUING_O_1',\r\n  'classifier_entry' => [\r\n    Vanilla_ice::Diffserv_policy::Classifier_entry({\r\n      'classifier_entry_name' => 'class-default',\r\n      'classifier_action_entry_cfg' => [\r\n        Vanilla_ice::Diffserv_policy::Classifier_action_entry_cfg({\r\n          'action_type' => 'action:min-rate',\r\n          'min_rate_cfg' => Vanilla_ice::Diffserv_policy::Min_rate_cfg({\r\n            'absolute_rate_metric' => 'none',\r\n            'absolute_rate_units' => 'bps',\r\n            'bw_excess_share_cfg' => Vanilla_ice::Diffserv_policy::Bw_excess_share_cfg({\r\n              'value' => 28,\r\n              'absolute_rate_metric' => 'none',\r\n              'absolute_rate_units' => 'perc'\r\n            })\r\n          })\r\n        })\r\n      ]\r\n    })\r\n  ]\r\n})'\r\nNotice: Applied catalog in 9.34 seconds\r\n{noformat}\r\n\r\nSample manifest and branch https://github.com/puppetlabs/vanilla_ice/blob/pcore/28.pp","closed_at":"2017-04-06T07:11:47.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7168","labels":"","state":"Closed","updated_at":"2017-04-06T07:11:47.000-0700","timestamp":1652285270.161152,"priority":"Normal","status_category":"Done","pull_request":5615},{"issue_id":"179398","title":"Duplication errors on Puppet Class \"settings\".","url":"https://tickets.puppetlabs.com/browse/PUP-7328","created_at":"2017-03-09T06:20:03.000-0800","number":"PUP-7328","body":"A user reports strange duplication errors for the \"settings\" class in PUP-6339. An investigation reveals that the errors stem from when the compiler initializes its scope. The fact that the actual scope is created from scratch during this initialization, combined with that several conflicts occur within milliseconds, seems to suggest that several threads are executing in in the same ruby runtime.\r\n\r\nThe conflicts go away if environment_timeout is set to 0.\r\n\r\nFrom the log:\r\n{code}\r\n2017-03-09 13:29:39,720 ERROR [qtp182348184-67 - /puppet/v3/catalog/lxserv940.smhi.se?environment=production] [puppetserver] Puppet Class 'settings' is already defined; cannot redefine on node lxserv940.smhi.se\r\n2017-03-09 13:29:39,733 ERROR [qtp182348184-67 - /puppet/v3/catalog/lxserv940.smhi.se?environment=production] [puppetserver] Puppet Class 'settings' is already defined; cannot redefine on node lxserv940.smhi.se\r\n2017-03-09 13:29:39,734 ERROR [qtp182348184-67 - /puppet/v3/catalog/lxserv940.smhi.se?environment=production] [puppetserver] Puppet Server Error: Class 'settings' is already defined; cannot redefine on node lxserv940.smhi.se\r\n{code}\r\nHere is a stack backgrace (generated with {{strict=error}}).\r\n{code}\r\n2017-03-09 13:29:39,720 ERROR [qtp182348184-67 - /puppet/v3/catalog/lxserv940.smhi.se?environment=production] [puppetserver] Puppet Class 'settings' is already defined; cannot redefine on node lxserv940.smhi.se\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/errors.rb:106:in `fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type_collection.rb:248:in `dupe_check'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type_collection.rb:68:in `add_hostclass'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type_collection.rb:60:in `add'\r\norg/jruby/RubyKernel.java:1242:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type_collection.rb:59:in `add'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:857:in `create_settings_scope'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:168:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:168:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:293:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:162:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:33:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:266:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:264:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:223:in `benchmark'\r\n/opt/puppetlabs/server/apps/puppetserver/puppet-server-release.jar!/META-INF/jruby.home/lib/ruby/1.9/benchmark.rb:295:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:222:in `benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:262:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:53:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:194:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:121:in `do_find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:48:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:293:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:47:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:82:in `process'\r\norg/jruby/RubyArray.java:1613:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:81:in `process'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:87:in `process'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:87:in `process'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/handler.rb:60:in `process'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/handler.rb:58:in `process'\r\nfile:/opt/puppetlabs/server/apps/puppetserver/puppet-server-release.jar!/puppetserver-lib/puppet/server/master.rb:42:in `handleRequest'\r\nPuppet$$Server$$Master_2107036556.gen:13:in `handleRequest'\r\nrequest_handler_core.clj:273:in `invoke'\r\njruby_request.clj:46:in `invoke'\r\njruby_request.clj:31:in `invoke'\r\nrequest_handler_service.clj:34:in `handle_request'\r\nrequest_handler.clj:3:in `invoke'\r\nrequest_handler.clj:3:in `invoke'\r\ncore.clj:2515:in `invoke'\r\nring_middleware.clj:284:in `invoke'\r\ncore.clj:168:in `invoke'\r\ncore.clj:211:in `invoke'\r\ncore.clj:45:in `invoke'\r\ncore.clj:343:in `invoke'\r\ncore.clj:51:in `invoke'\r\nringutils.clj:83:in `invoke'\r\nmaster_core.clj:428:in `invoke'\r\nring.clj:21:in `invoke'\r\nring.clj:12:in `invoke'\r\ncomidi.clj:249:in `invoke'\r\njetty9_core.clj:424:in `invoke'\r\nnormalized_uri_helpers.clj:80:in `invoke'\r\n{code}\r\n","closed_at":"2017-04-06T07:11:48.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7328","labels":"","state":"Closed","updated_at":"2017-04-06T07:11:48.000-0700","timestamp":1652285270.267362,"priority":"Normal","status_category":"Done","pull_request":5752},{"issue_id":"174574","title":"Puppet errors when managing non-existent service on AIX","url":"https://tickets.puppetlabs.com/browse/PUP-7191","created_at":"2017-02-08T09:07:42.000-0800","number":"PUP-7191","body":"Related to support escalation PE-19526\r\n\r\nWhen managing a non-existent service on AIX, get something like:\r\n{code}\r\nError: /Stage[main]/Main/Service[nothere]: Could not evaluate: Cannot get status of nothere, error was: Execution of '/usr/bin/lssrc -s nothere' returned 1: 0513-085 The nothere Subsystem is not on file.\r\nWrapped exception:\r\nExecution of '/usr/bin/lssrc -s nothere' returned 1: 0513-085 The nothere Subsystem is not on file.\r\n{code}\r\n\r\nThe behavior of puppet with respect to managing non-existent services is non-standard across various OSes.\r\n\r\nOn Ubuntu (systemd), a non-existent service raises no error, and does not even report its non-existence via ral:\r\n{code}\r\n☂ : puppet apply -e \" service { 'foo' : ensure => stopped } \"\r\nNotice: Compiled catalog for ubuntu16.localdomain in environment production in 0.06 seconds\r\nNotice: Applied catalog in 0.05 seconds\r\n☂ : puppet resource service foobar ensure=stopped\r\nservice { 'foobar':\r\n  ensure => 'stopped',\r\n}\r\n{code}\r\n\r\nOn OSX (launchctl), it reports an error:\r\n{code}\r\n☂ : be puppet apply -e \" service { 'foo' : ensure => stopped } \"\r\nNotice: Compiled catalog for macbook-pro-2.local in environment production in 0.34 seconds\r\nError: Unable to find launchd plist for job: foo\r\nError: /Stage[main]/Main/Service[foo]/ensure: change from absent to stopped failed: Unable to find launchd plist for job: foo\r\nNotice: Applied catalog in 2.14 seconds\r\n☂ : be puppet resource service foo ensure=stopped\r\nError: Unable to find launchd plist for job: foo\r\nError: /Service[foo]/ensure: change from absent to stopped failed: Unable to find launchd plist for job: foo\r\nservice { 'foo':\r\n  ensure => 'absent',\r\n}\r\n{code}\r\n\r\nOn Centos 7 (also systemd), same as ubuntu - no errors:\r\n{code}\r\n[root@centos7 ~]# puppet apply -e \" service { 'foo' : ensure => stopped } \"\r\nNotice: Compiled catalog for centos7.localdomain in environment production in 0.07 seconds\r\nNotice: Applied catalog in 0.35 seconds\r\n[root@centos7 ~]# puppet resource service foo ensure=stopped\r\nservice { 'foo':\r\n  ensure => 'stopped',\r\n}\r\n{code}\r\n\r\nSince AIX is primarily an RPM based system, it seems to make sense to go the route of not erroring when a service is not present (perhaps issuing a debug message if this is the case).","closed_at":"2017-04-06T07:11:49.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7191","labels":"","state":"Closed","updated_at":"2017-04-06T07:11:49.000-0700","timestamp":1652285270.6007,"priority":"Major","status_category":"Done","pull_request":5632},{"issue_id":"180111","title":"Regex Lookup isn't working with Puppet 4.9","url":"https://tickets.puppetlabs.com/browse/PUP-7341","created_at":"2017-03-13T02:39:59.000-0700","number":"PUP-7341","body":"UPDATE\r\n-----\r\nWhen regular expression keys are using in lookup_options an error is raised if all of the lookup_option keys are regular expression.\r\nA work around until this is fixed is to add a dummy, non regular expression key.\r\n\r\nORIGINAL\r\n----\r\n{code:java}\r\nroot@mbaur-hieradebug:/etc/puppetlabs/code/environments/production# cat hiera.yaml\r\nversion: 5\r\ndefaults:\r\n  datadir: hieradata\r\n  data_hash: yaml_data\r\nhierarchy:\r\n  - name: \"Per-node data (yaml version)\"\r\n    path: \"nodes/%{trusted.certname}.yaml\" # Add file extension.\r\n    # Omitting datadir and data_hash to use defaults.\r\n\r\n  - name: \"Other YAML hierarchy levels\"\r\n    paths: # Can specify an array of paths instead of one.\r\n      - \"location/%{facts.whereami}/%{facts.group}.yaml\"\r\n      - \"groups/%{facts.group}.yaml\"\r\n      - \"os/%{facts.os.family}.yaml\"\r\n      - \"common.yaml\"\r\nroot@mbaur-hieradebug:/etc/puppetlabs/code/environments/production# cat hieradata/common.yaml\r\n---\r\nclasses:\r\n  - foobar\r\nlookup_options:\r\n  \"^profile::(.*)::users$\": # Regexp: `$users` parameter of any profile class\r\n    merge:          # Merge behavior as a hash\r\n      strategy: deep\r\n      merge_hash_arrays: true\r\nroot@mbaur-hieradebug:/etc/puppetlabs/code/environments/production# puppet lookup classes\r\nError: Could not run: undefined method `[]' for nil:NilClass\r\n{code}\r\n\r\n\r\nThe following things has been changed compared to an pure puppet-agent installation:\r\n- /etc/puppetlabs/puppet/hiera.yaml deleted\r\n- /etc/puppetlabs/code/environments/production/hiera.yaml created with code from https://docs.puppet.com/puppet/4.9/hiera_migrate_v3_yaml.html#translating-built-in-backends . Only the datadir was changed to hieradata\r\n- /etc/puppetlabs/code/environments/production/hieradata/common.yaml was created. For code see above.","closed_at":"2017-04-06T07:11:49.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7341","labels":"","state":"Closed","updated_at":"2017-04-06T07:11:49.000-0700","timestamp":1652285270.708638,"priority":"Normal","status_category":"Done","pull_request":5709},{"issue_id":"179490","title":"Puppet::LookupKey and Puppet::LookupValue types are unavailable to Hiera backend functions","url":"https://tickets.puppetlabs.com/browse/PUP-7330","created_at":"2017-03-09T13:45:58.000-0800","number":"PUP-7330","body":"Pre-docs for hiera 5 stated that backend functions can use Puppet::LookupKey and Puppet::LookupValue to validate arguments and return types. This is false. If you try to use them in a function signature, you get:\r\n\r\n{code}\r\nError: Could not run: Lookup of key 'lookup_options' failed: value returned from function 'yaml_data' has wrong type, references an unresolved type 'Puppet::LookupKey'\r\n{code}\r\n\r\nPer the pre-docs, these types should be available for use. Alternately, maybe they aren't needed? ","closed_at":"2017-04-06T07:11:50.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7330","labels":"docs_reviewed","state":"Closed","updated_at":"2017-04-06T07:11:50.000-0700","timestamp":1652285270.921889,"priority":"Normal","status_category":"Done","pull_request":5742},{"issue_id":"179396","title":"Hiera 5 doesn't call lookup_with_segments method on hiera3_backend","url":"https://tickets.puppetlabs.com/browse/PUP-7327","created_at":"2017-03-09T06:08:01.000-0800","number":"PUP-7327","body":"We use a custom Hiera backend we call {{file_eyaml}}. It is based on the {{hiera-file}} backend from https://github.com/voxpupuli/hiera-file, which allows looking up file contents with Hiera. Our backend goes one step further and allows for the file contents to be Eyaml encrypted. Looking up a file this way decrypts the contents if they are encrypted or just returns them if they are not. The backend code is not really public but I've created a gist here (please don't judge, it is rather hackish and not that pretty): https://gist.github.com/antaflos/f4cb8844efa27d60d5179c77ad5b83ce\r\n\r\nThe problem here is that the files in question (and thus the lookup keys) very often have periods in their filenames, so we implemented the {{lookup_with_segments}} method in our backend as discussed in https://tickets.puppetlabs.com/browse/HI-496. This works fine in Hiera 3 and Puppet 4.8.x (and Hiera 1 and Puppet 3.8.x)\r\n\r\nIn Puppet 4.9.3 and Hiera 5 the {{lookup_with_segments}} method doesn't seem to get called at all.\r\n\r\nSee below for the {{hiera.yaml}} file used and the defined hierarchy.\r\n\r\nIn this example I have a file {{/etc/puppetlabs/code/environments/production/hierafiles/ssldata/common.d/example_ca.crt.pem}} that contains an unencrypted, regular base64-encoded X509 certificate.\r\n\r\nRunning {{/opt/puppetlabs/bin/puppet lookup --debug --explain example_ca.crt.pem}} fails to get the contents of this file, saying it cannot find a value for the name, which is understandable since it seems to only look for {{example_ca}} (no such file exists), instead of {{example_ca.crt.pem}}.\r\n\r\nThe full output is here: https://gist.github.com/antaflos/d4553a3a0a46b9a0514266d2f1244090\r\n\r\nI have added {{Hiera.debug()}} statements to the {{lookup}} and {{lookup_with_segments}} methods in our file_eyaml backend and can see from the debug output of the above command that {{lookup_with_segments}} is never called.\r\n\r\nhiera.yaml:\r\n\r\n{code:yaml}\r\n---\r\nversion: 5\r\n\r\nhierarchy:\r\n  - name: Eyaml encrypted data\r\n    hiera3_backend: eyaml\r\n    datadir: \"/etc/puppetlabs/code/environments/%{::environment}/hieradata\"\r\n    options:\r\n      extension: yaml\r\n      encrypt_method: gpg\r\n      gpg_gnupghome: \"/etc/puppetlabs/puppet/keys/gpg\"\r\n      gpg_always_trust: true\r\n    paths:\r\n      - \"nodes/%{::trusted.certname}\"\r\n      - \"os/%{::facts.os.name}/%{::facts.os.distro.codename}\"\r\n      - common\r\n      - users\r\n      - repos\r\n      - ssldata/common\r\n\r\n  - name: File_eyaml encrypted data\r\n    hiera3_backend: file_eyaml\r\n    datadir: \"/etc/puppetlabs/code/environments/%{::environment}/hierafiles\"\r\n    options:\r\n      interpolate: false\r\n    paths:\r\n      - \"nodes/%{::trusted.certname}\"\r\n      - \"os/%{::facts.os.name}/%{::facts.os.distro.codename}\"\r\n      - common\r\n      - users\r\n      - repos\r\n      - ssldata/common\r\n{code}\r\n","closed_at":"2017-04-06T07:11:50.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7327","labels":"","state":"Closed","updated_at":"2017-04-06T07:11:50.000-0700","timestamp":1652285271.028844,"priority":"Normal","status_category":"Done","pull_request":5700},{"issue_id":"181870","title":"Acceptance: Cisco eXR 6.1.3 VM fails to run augeus test successfully","url":"https://tickets.puppetlabs.com/browse/PUP-7380","created_at":"2017-03-21T16:41:37.000-0700","number":"PUP-7380","body":"The new Cisco eXR VM is significantly faster that the previous version due to it no longer emulating the backplane.   This \"Control Plane only\" version provides a significant improvement to test execution time and a nice reduction to VMpooler CPU resource usage.  Testing has shown that we have one issue with this VM.  While running puppet acceptance, one of augeus test fails.\r\n\r\nWe have decided it's worth skipping this test to take advantage of the performance increase.","closed_at":"2017-04-06T07:11:50.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7380","labels":"","state":"Closed","updated_at":"2017-04-06T07:11:50.000-0700","timestamp":1652285271.134763,"priority":"Normal","status_category":"Done","pull_request":5755},{"issue_id":"173436","title":"CI acceptance: solaris 11 tests/resource/zfs/basic_tests.rb tests/resource/zfs/should_be_idempotent.rb failures","url":"https://tickets.puppetlabs.com/browse/PUP-7159","created_at":"2017-02-01T13:59:56.000-0800","number":"PUP-7159","body":"While running stable SHA e32d6bf85e912c78a8b4f4d3266710666b972aba on the manual CI acceptance pipeline 2 tests failed in what appears to be the same way on the Solaris 11 Sparc system.\r\n\r\nhttps://jenkins.puppetlabs.com/view/puppet-agent/view/manual/view/stable/job/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/lastCompletedBuild/SLAVE_LABEL=beaker,TEST_TARGET=solaris-11-sparc/testReport/\r\n\r\ntests/resource/zfs.basic_tests.rb\r\ntests/resource/zfs.should_be_idempotent.rb\r\n\r\nHere is the test failure:\r\n\r\n{noformat}\r\nBegin tests/resource/zfs/basic_tests.rb\r\n      \r\n      ZFS: configuration\r\n      \r\n      * ZFS: cleanup\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:05:12$ zfs destroy -r tstpool/tstfs ||:\r\n        cannot open 'tstpool/tstfs': filesystem does not exist\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 0.75 seconds\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:05:13$ zpool destroy tstpool ||:\r\n        cannot open 'tstpool': no such pool\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 0.63 seconds\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:05:13$ rm -rf /ztstpool ||:\r\n        rm: Unable to remove directory /ztstpool/mnt: Device busy\r\n        rm: Unable to remove directory /ztstpool: Directory not empty\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 0.70 seconds\r\n      \r\n      * ZFS: setup\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:05:14$ mkdir -p /ztstpool/mnt\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 0.67 seconds\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:05:15$ mkdir -p /ztstpool/mnt2\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 0.66 seconds\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:05:15$ mkfile 64m /ztstpool/dsk\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 1.30 seconds\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:05:17$ zpool create tstpool /ztstpool/dsk\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 1.67 seconds\r\n      \r\n      * ZFS: ensure clean slate\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:05:18$ mktemp -t apply_manifest.pp.XXXXXX\r\n        /tmp/apply_manifest.pp.GMaWzN\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 0.67 seconds\r\n      localhost $ scp /tmp/beaker20170201-15269-rkag8e solaris-11-sparc:/tmp/apply_manifest.pp.GMaWzN {:ignore => }\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:05:21$ puppet apply --verbose /tmp/apply_manifest.pp.GMaWzN\r\n        Notice: Compiled catalog for sol11a.delivery.puppetlabs.net in environment production in 0.88 seconds\r\n        Info: Applying configuration version '1485939945'\r\n        Notice: Applied catalog in 1.02 seconds\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 27.77 seconds\r\n      \r\n      * ZFS: basic - ensure it is created\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:05:48$ mktemp -t apply_manifest.pp.XXXXXX\r\n        /tmp/apply_manifest.pp.c8aWDN\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 0.77 seconds\r\n      localhost $ scp /tmp/beaker20170201-15269-7zhwfv solaris-11-sparc:/tmp/apply_manifest.pp.c8aWDN {:ignore => }\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:05:51$ puppet apply --verbose /tmp/apply_manifest.pp.c8aWDN\r\n        Notice: Compiled catalog for sol11a.delivery.puppetlabs.net in environment production in 0.90 seconds\r\n        Info: Applying configuration version '1485939976'\r\n        Notice: /Stage[main]/Main/Zfs[tstpool/tstfs]/ensure: created\r\n        Notice: Applied catalog in 1.40 seconds\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 28.55 seconds\r\n      \r\n      * ZFS: idempotence - create\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:06:19$ mktemp -t apply_manifest.pp.XXXXXX\r\n        /tmp/apply_manifest.pp.eDaiIN\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 0.42 seconds\r\n      localhost $ scp /tmp/beaker20170201-15269-n1ov41 solaris-11-sparc:/tmp/apply_manifest.pp.eDaiIN {:ignore => }\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:06:21$ puppet apply --verbose /tmp/apply_manifest.pp.eDaiIN\r\n        Notice: Compiled catalog for sol11a.delivery.puppetlabs.net in environment production in 0.89 seconds\r\n        Info: Applying configuration version '1485940005'\r\n        Notice: Applied catalog in 1.03 seconds\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 27.81 seconds\r\n      \r\n      * ZFS: cleanup for next test\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:06:49$ mktemp -t apply_manifest.pp.XXXXXX\r\n        /tmp/apply_manifest.pp.vOaiMN\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 0.48 seconds\r\n      localhost $ scp /tmp/beaker20170201-15269-10v96tb solaris-11-sparc:/tmp/apply_manifest.pp.vOaiMN {:ignore => }\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:06:50$ puppet apply --verbose /tmp/apply_manifest.pp.vOaiMN\r\n        Notice: Compiled catalog for sol11a.delivery.puppetlabs.net in environment production in 0.89 seconds\r\n        Info: Applying configuration version '1485940035'\r\n        Notice: /Stage[main]/Main/Zfs[tstpool/tstfs]/ensure: removed\r\n        Notice: Applied catalog in 1.48 seconds\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 28.16 seconds\r\n      \r\n      * ZFS: create with a mount point\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:07:18$ mktemp -t apply_manifest.pp.XXXXXX\r\n        /tmp/apply_manifest.pp.c3aqQN\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 0.42 seconds\r\n      localhost $ scp /tmp/beaker20170201-15269-1qlki5h solaris-11-sparc:/tmp/apply_manifest.pp.c3aqQN {:ignore => }\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:07:20$ puppet apply --verbose /tmp/apply_manifest.pp.c3aqQN\r\n        Notice: Compiled catalog for sol11a.delivery.puppetlabs.net in environment production in 0.95 seconds\r\n        Info: Applying configuration version '1485940064'\r\n        Error: Execution of '/usr/sbin/zfs create -o mountpoint=/ztstpool/mnt tstpool/tstfs' returned 1: cannot mount 'tstpool/tstfs' on '/ztstpool/mnt': mountpoint or dataset is busy\r\n        filesystem successfully created, but not mounted\r\n        Error: /Stage[main]/Main/Zfs[tstpool/tstfs]/ensure: change from absent to present failed: Execution of '/usr/sbin/zfs create -o mountpoint=/ztstpool/mnt tstpool/tstfs' returned 1: cannot mount 'tstpool/tstfs' on '/ztstpool/mnt': mountpoint or dataset is busy\r\n        filesystem successfully created, but not mounted\r\n        Notice: Applied catalog in 1.29 seconds\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 27.69 seconds\r\n      Minitest::Assertion: err: sol11a.delivery.puppetlabs.net.\r\n      Expected /ensure: created/ to match \"\\e[mNotice: Compiled catalog for sol11a.delivery.puppetlabs.net in environment production in 0.95 seconds\\e[0m\\n\\e[0;32mInfo: Applying configuration version '1485940064'\\e[0m\\n\\e[mNotice: Applied catalog in 1.29 seconds\\e[0m\\n\".\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/minitest-5.10.1/lib/minitest/assertions.rb:139\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/minitest-5.10.1/lib/minitest/assertions.rb:248\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/tests/resource/zfs/basic_tests.rb:42\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/dsl/helpers/host_helpers.rb:90\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/shared/host_manager.rb:127\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/dsl/patterns.rb:37\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/dsl/helpers/host_helpers.rb:63\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/dsl/helpers/puppet_helpers.rb:487\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/shared/host_manager.rb:127\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/dsl/patterns.rb:37\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/dsl/helpers/puppet_helpers.rb:416\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/tests/resource/zfs/basic_tests.rb:41\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/tests/resource/zfs/basic_tests.rb:15\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/tests/resource/zfs/basic_tests.rb:15\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/test_case.rb:133\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/test_case.rb:133\r\n      /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/2.3.0/benchmark.rb:308\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/test_case.rb:130\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/test_suite.rb:325\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/test_suite.rb:322\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/test_suite.rb:322\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/test_suite.rb:371\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/cli.rb:180\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/cli.rb:106\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/bin/beaker:6\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/bin/beaker:23\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/bin/beaker:23\r\n      Begin teardown\r\n      \r\n      * ZFS: cleanup\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:07:47$ zfs destroy -r tstpool/tstfs ||:\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 0.79 seconds\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:07:48$ zpool destroy tstpool ||:\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 0.75 seconds\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:07:49$ rm -rf /ztstpool ||:\r\n        rm: Unable to remove directory /ztstpool/mnt: Device busy\r\n        rm: Unable to remove directory /ztstpool:         Directory not empty\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 0.45 seconds\r\n      End teardown\r\ntests/resource/zfs/basic_tests.rb failed in 157.50 seconds\r\n      Begin tests/resource/zfs/should_be_idempotent.rb\r\n      \r\n      ZFS: configuration\r\n      \r\n      * ZFS: setup\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:07:49$ mkdir -p /ztstpool/mnt\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 0.49 seconds\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:07:50$ mkdir -p /ztstpool/mnt2\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 0.52 seconds\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:07:50$ mkfile 64m /ztstpool/dsk\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 0.61 seconds\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:07:51$ zpool create tstpool /ztstpool/dsk\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 1.98 seconds\r\n      \r\n      * ZFS: create with a mount point\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:07:53$ mktemp -t apply_manifest.pp.XXXXXX\r\n        /tmp/apply_manifest.pp.9uaWVN\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 0.45 seconds\r\n      localhost $ scp /tmp/beaker20170201-15269-1xgzywl solaris-11-sparc:/tmp/apply_manifest.pp.9uaWVN {:ignore => }\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:07:54$ puppet apply --verbose /tmp/apply_manifest.pp.9uaWVN\r\n        Notice: Compiled catalog for sol11a.delivery.puppetlabs.net in environment production in 0.90 seconds\r\n        Info: Applying configuration version '1485940099'\r\n        Error: Execution of '/usr/sbin/zfs create -o mountpoint=/ztstpool/mnt tstpool/tstfs' returned 1: cannot mount 'tstpool/tstfs' on '/ztstpool/mnt': mountpoint or dataset is busy\r\n        filesystem successfully created, but not mounted\r\n        Error: /Stage[main]/Main/Zfs[tstpool/tstfs]/ensure: change from absent to present failed: Execution of '/usr/sbin/zfs create -o mountpoint=/ztstpool/mnt tstpool/tstfs' returned 1: cannot mount 'tstpool/tstfs' on '/ztstpool/mnt': mountpoint or dataset is busy\r\n        filesystem successfully created, but not mounted\r\n        Notice: Applied catalog in 1.29 seconds\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 28.05 seconds\r\n      Minitest::Assertion: err: sol11a.delivery.puppetlabs.net.\r\n      Expected /ensure: created/ to match \"\\e[mNotice: Compiled catalog for sol11a.delivery.puppetlabs.net in environment production in 0.90 seconds\\e[0m\\n\\e[0;32mInfo: Applying configuration version '1485940099'\\e[0m\\n\\e[mNotice: Applied catalog in 1.29 seconds\\e[0m\\n\".\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/minitest-5.10.1/lib/minitest/assertions.rb:139\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/minitest-5.10.1/lib/minitest/assertions.rb:248\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/tests/resource/zfs/should_be_idempotent.rb:20\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/dsl/helpers/host_helpers.rb:90\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/shared/host_manager.rb:127\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/dsl/patterns.rb:37\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/dsl/helpers/host_helpers.rb:63\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/dsl/helpers/puppet_helpers.rb:487\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/shared/host_manager.rb:127\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/dsl/patterns.rb:37\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/dsl/helpers/puppet_helpers.rb:416\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/tests/resource/zfs/should_be_idempotent.rb:19\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/tests/resource/zfs/should_be_idempotent.rb:15\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/tests/resource/zfs/should_be_idempotent.rb:15\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/test_case.rb:133\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/test_case.rb:133\r\n      /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/2.3.0/benchmark.rb:308\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/test_case.rb:130\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/test_suite.rb:325\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/test_suite.rb:322\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/test_suite.rb:322\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/test_suite.rb:371\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/cli.rb:180\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/lib/beaker/cli.rb:106\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/gems/beaker-3.5.0/bin/beaker:6\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/bin/beaker:23\r\n      /var/lib/jenkins/workspace/platform_puppet-agent_intn-van-sys_suite-manual-puppet-stable/SLAVE_LABEL/beaker/TEST_TARGET/solaris-11-sparc/puppet/acceptance/.bundle/gems/bin/beaker:23\r\n      Begin teardown\r\n      \r\n      * ZFS: cleanup\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:08:23$ zfs destroy -r tstpool/tstfs ||:\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 0.72 seconds\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:08:23$ zpool destroy tstpool ||:\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 0.72 seconds\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) 01:08:24$ rm -rf /ztstpool ||:\r\n        rm: Unable to remove directory /ztstpool/mnt: Device busy\r\n        rm: Unable to remove directory /ztstpool:         Directory not empty\r\n      \r\n      sol11a.delivery.puppetlabs.net (solaris-11-sparc) executed in 0.49 seconds\r\n      End teardown\r\n      tests/resource/zfs/should_be_idempotent.rb failed in 35.11 seconds\r\n{noformat}\r\n\r\nIt looks like it was mounted before the test run, maybe we're not handling clean up somewhere?\r\n\r\n\"/ztstpool/mnt\"=>{\"available\"=>\"13.23 GiB\", \"available_bytes\"=>1315864576, \"capacity\"=>\"0.00%\", \"device\"=>\"rpool/tstfs\", \"filesystem\"=>\"zfs\", \"options\"=>[\"rw\", \"devices\", \"setuid\", \"nonbmand\", \"exec\", \"rstchown\", \"xattr\", \"atime\", \"dev=4950009\"], \"size\"=>\"13.23 GiB\", \"size_bytes\"=>1316175872, \"used\"=>\"304.00 KiB\", \"used_bytes\"=>311296}}' ","closed_at":"2017-04-06T07:11:50.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7159","labels":"","state":"Closed","updated_at":"2017-04-06T07:11:50.000-0700","timestamp":1652285271.515592,"priority":"Normal","status_category":"Done","pull_request":5630},{"issue_id":"169376","title":"Puppet::Util::Windows::File.replace_file fails on UNC paths","url":"https://tickets.puppetlabs.com/browse/PUP-7077","created_at":"2017-01-09T14:06:32.000-0800","number":"PUP-7077","body":"A user report was received that {{Puppet::Util::Windows::File.replace_file}} was traced as a problem in file writes to UNC paths. The original code lives at https://github.com/puppetlabs/puppet/blob/master/lib/puppet/util/windows/file.rb#L51-L69\r\n\r\nNote that the current code calls [ReplaceFile|https://msdn.microsoft.com/en-us/library/windows/desktop/aa365512(v=vs.85).aspx] and specifies {{REPLACEFILE_WRITE_THROUGH}} (0x01) as the {{dwReplaceFlags}} despite MSDN documentation listing that value as unsupported.\r\n\r\nThe original code dates back to 2012 and probably wasn't sufficiently tested in UNC path scenarios - https://github.com/puppetlabs/puppet/commit/73e302bbf5ab4a6c5513a39070e2c907542775ae#diff-a91b066f285a8fe7ccfa4162399d458fR11\r\n\r\n\r\nFrom the user report, given a manifest:\r\n\r\n{code}\r\n file { 'puppettestfile':\r\n    path    => '\\\\\\\\server\\path\\Puppet_Test_File.txt',\r\n    ensure  => 'file',\r\n    content => 'This is a puppet test file with content loaded from manifest',\r\n}\r\n{code}\r\n\r\nDifferent errors propagated depending on different circumstances:\r\n\r\nh4. When the file does not exist\r\n\r\n{code}\r\nError: ReplaceFile(//server/path/Puppet_Test_File.txt, //server/path/Puppet_Test_File.txt20170106-6416-1fqt5cr):  Access is denied.\r\nError: /Stage[main]/Acurityconfig/File[puppettestfile]/ensure: change from absent to file failed: ReplaceFile(//sacuts16/TS16/TS16/Puppet_Test_File.txt, //sacuts16/TS16/TS16/Puppet_Test_File.txt20170106-6416-1fqt5cr):  Access is denied.\r\n{code}\r\n\r\n*NOTE*: This results in a 0 byte file being created\r\n\r\nh4. When the content of the file does not match\r\n\r\n{code}\r\nError: ReplaceFile(//server/path/Puppet_Test_File.txt, //server/path/Puppet_Test_File.txt20170106-11576-wsevbb):  Access is denied.\r\nNotice: /Stage[main]/ModuleName/File[puppettestfile]/content:\r\n \r\nError: /Stage[main]/ModuleName/File[puppettestfile]/content: change from {md5}058755754b4ac17664d\r\n7a8eba995a8d1 to {md5}3568af3a5598f2998d60a5e92af55fd6 failed: ReplaceFile(//server/path/Puppet_Test_File.txt, //server/path/Puppet_Test_File.txt20170106-11576-wsevbb):  Access is denied\r\n{code}\r\n\r\nThe user was able to use an {{exec}} coupled with {{cmd.exe /c echo}} to successfully write files to the destination UNC path - so clearly the account Puppet running under has appropriate permission to do so.\r\n\r\nThe user ultimately was able to work around the issue by passing {{REPLACEFILE_IGNORE_MERGE_ERRORS}} (0x02) as the value for {{dwReplaceFlags}}.  It's possible the Puppet code can have that change made right away given the current value being passed is allegedly unsupported.  Some additional tests may need to be written.\r\n\r\nThe only concern here is whether or not the ACL can be set as desired.  It may be necessary to add some documentation that managing files on UNC paths may not result in the expected {{mode}} being set.\r\n\r\nCallers of {{replace_file}} should also be audited to understand its current use in the Puppet codebase - https://github.com/puppetlabs/puppet/search?p=1&q=replace_file&utf8=%E2%9C%93\r\n","closed_at":"2017-04-06T07:11:51.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7077","labels":"acl;windows","state":"Closed","updated_at":"2017-04-06T07:11:51.000-0700","timestamp":1652285271.73152,"priority":"Normal","status_category":"Done","pull_request":5751},{"issue_id":"177104","title":"Hiera 5: strange error unless path is defined","url":"https://tickets.puppetlabs.com/browse/PUP-7273","created_at":"2017-02-27T02:23:34.000-0800","number":"PUP-7273","body":"Potential bug filed as requested by [~henrik.lindberg] on slack. \r\n\r\nPlease consider following snippet:\r\n\r\n{code:java}\r\n---\r\nversion: 5\r\n\r\ndefaults:\r\n  datadir: hieradata\r\n  data_hash: yaml_data\r\n\r\nhierarchy:\r\n  - name: 'Nodes'\r\n    data_hash: yaml_data\r\n    path: \"nodes/%{::trusted.certname}\"\r\n\r\n  - name: 'Common'\r\n    data_hash: yaml_data\r\n    path: common.yaml\r\n{code}\r\n\r\nUnless \"data_hash: yaml_data\" is provided for each level I get the following error:\r\n\r\n{code:java}\r\nError while evaluating a Function Call, 'yaml_data' parameter 'options' expects size to be 1, got 0\r\n{code}\r\n","closed_at":"2017-04-06T07:11:51.000-0700","comments":24,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7273","labels":"docs_reviewed","state":"Closed","updated_at":"2017-04-06T07:11:51.000-0700","timestamp":1652285271.844298,"priority":"Normal","status_category":"Done","pull_request":5729},{"issue_id":"181364","title":"Type mismatches for variants with undef are incorrectly reported","url":"https://tickets.puppetlabs.com/browse/PUP-7371","created_at":"2017-03-20T06:24:38.000-0700","number":"PUP-7371","body":"A reported mismatch for a type that does not conform to a {{Variant}} where one of the types is {{Undef}} is incorrectly reported. The {{Undef}} is missing from the description.","closed_at":"2017-04-06T07:11:53.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7371","labels":"","state":"Closed","updated_at":"2017-04-06T07:11:53.000-0700","timestamp":1652285272.158682,"priority":"Normal","status_category":"Done","pull_request":5734},{"issue_id":"175924","title":"A custom LookupAdapter provided to a Puppet::Pops::Lookup::Invocation is ignored if a parent_invocation exists.","url":"https://tickets.puppetlabs.com/browse/PUP-7240","created_at":"2017-02-21T14:55:12.000-0800","number":"PUP-7240","body":"This is blocking meep in pe-modules-next using Thomas's patch: https://github.com/puppetlabs/puppetlabs-pe_infrastructure/pull/24.  (Using Puppet 4.9.0-135-gb78a4cc in puppet-agent 1.9.0.111.g0089107 in glisan, 2017.2.0-rc1-15-g5d7b7a1)\r\n\r\nIf the master is compiling an agent catalog, then the compiler has registered a Puppet::Pops::Lookup::LookupAdapter pointing to the standard hiera config as soon as it begins looking up parameter defaults.  But the pe_infrastructure module has a data function: [pe_infrastructure::data|https://github.com/puppetlabs/puppetlabs-pe_infrastructure/blob/next/lib/puppet/functions/pe_infrastructure/data.rb] which makes use of meep library functions to determine defaults from pe.conf.  In this case, the lookup invocation comes from here: https://github.com/thallgren/puppetlabs-pe_infrastructure/blob/2451b8d67bb621ecc37d88d1ba07ee75babb813d/lib/puppet_x/puppetlabs/meep/config.rb#L131-L136. However, there is a previous lookup invocation cached in Puppet::Pops::Lookup::Invocation@current from looking up 'lookup_options' which invokes the pe_infrastructure::data() function.\r\n\r\nIt appears that https://github.com/thallgren/puppetlabs-pe_infrastructure/blob/2451b8d67bb621ecc37d88d1ba07ee75babb813d/lib/puppet_x/puppetlabs/meep/config.rb#L131-L136 causes the lookup seeking pe.conf data to ignore the MeepLookupAdapter in preference to the Adapter in the cached @current invocation.\r\n\r\nExpectation for meep, at least, would be that the pe_* functions are able to read data from pe.conf.  I'm not entirely certain yet if this is an artifact of my use of the meep functions in a module data_hash function, or if it would also occur just as part of the process of looking up defaults regardless.","closed_at":"2017-04-06T07:11:54.000-0700","comments":19,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7240","labels":"","state":"Closed","updated_at":"2017-04-06T07:11:54.000-0700","timestamp":1652285272.372031,"priority":"Blocker","status_category":"Done","pull_request":5670},{"issue_id":"173405","title":"pkg_spec.rb failure on individual execution starting c5d97e ","url":"https://tickets.puppetlabs.com/browse/PUP-7158","created_at":"2017-02-01T13:30:02.000-0800","number":"PUP-7158","body":"Reproduced by [~matthaus] on master.\r\n\r\nProblem is not present when all specs are run or even if limited to all of spec/unit/provider/package/\r\n\r\n{noformat}\r\nrspec ./spec/unit/provider/package/pkg_spec.rb\r\nRun options: exclude {:broken=>true, :benchmark=>true}\r\n.....................FFFFFFFFFFFFFFFFFFFFFFFFFFFF\r\n\r\nFailures:\r\n\r\n  1) Puppet::Type::Package::ProviderPkg#methods :latest should work correctly for ensure latest on solaris 11(known UFOXI)\r\n     Got 0 failures and 2 other errors:\r\n\r\n     1.1) Failure/Error: $CHILD_STATUS.stubs(:exitstatus).returns 0\r\n\r\n          RuntimeError:\r\n            can't modify frozen NilClass\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:16:in `mocha'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:102:in `block in stubs'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `call'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `each'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:97:in `stubs'\r\n          # ./spec/unit/provider/package/pkg_spec.rb:114:in `block (4 levels) in <top (required)>'\r\n\r\n     1.2) Failure/Error: @mocha ||= Mocha::Mockery.instance.mock_impersonating(self)\r\n\r\n          RuntimeError:\r\n            can't modify frozen NilClass\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:16:in `mocha'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:29:in `mock'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:22:in `unstub'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  2) Puppet::Type::Package::ProviderPkg#methods :latest should work correctly for ensure latest on solaris 11 (IFO)\r\n     Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n     NameError:\r\n       method `exitstatus' not defined in NilClass\r\n     # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n     # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n     # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n     # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n     # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n     # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n     # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  3) Puppet::Type::Package::ProviderPkg#methods :latest should work correctly for ensure latest on solaris 11(known IFO)\r\n     Got 0 failures and 2 other errors:\r\n\r\n     3.1) Failure/Error: $CHILD_STATUS.stubs(:exitstatus).returns 0\r\n\r\n          RuntimeError:\r\n            can't modify frozen NilClass\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:16:in `mocha'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:102:in `block in stubs'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `call'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `each'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:97:in `stubs'\r\n          # ./spec/unit/provider/package/pkg_spec.rb:127:in `block (4 levels) in <top (required)>'\r\n\r\n     3.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n          NameError:\r\n            method `exitstatus' not defined in NilClass\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  4) Puppet::Type::Package::ProviderPkg#methods :latest issues a warning when the certificate has expired\r\n     Got 0 failures and 2 other errors:\r\n\r\n     4.1) Failure/Error: Puppet::Util::Execution.expects(:execute).with(['/bin/pkg', 'update', '-n', 'dummy'], {:failonfail => false, :combine => true}).returns ''\r\n\r\n          Mocha::ExpectationError:\r\n            not all expectations were satisfied\r\n            unsatisfied expectations:\r\n            - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '-n', 'dummy'], {:failonfail => false, :combine => true})\r\n            satisfied expectations:\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - expected exactly once, invoked once: Puppet.warning('pkg warning: Certificate '/var/pkg/ssl/871b4ed0ade09926e6adf95f86bf17535f987684' for publisher 'solarisstudio', needed to access 'https://pkg.oracle.com/solarisstudio/release/', will expire in '29' days.')\r\n          # ./spec/unit/provider/package/pkg_spec.rb:126:in `block (4 levels) in <top (required)>'\r\n\r\n     4.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n          NameError:\r\n            method `exitstatus' not defined in NilClass\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  5) Puppet::Type::Package::ProviderPkg#methods :latest doesn't issue a warning when the certificate hasn't expired\r\n     Got 0 failures and 2 other errors:\r\n\r\n     5.1) Failure/Error: Puppet::Util::Execution.expects(:execute).with(['/bin/pkg', 'update', '-n', 'dummy'], {:failonfail => false, :combine => true}).returns ''\r\n\r\n          Mocha::ExpectationError:\r\n            not all expectations were satisfied\r\n            unsatisfied expectations:\r\n            - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '-n', 'dummy'], {:failonfail => false, :combine => true})\r\n            satisfied expectations:\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - expected never, not yet invoked: Puppet.warning(/pkg warning/)\r\n            - expected exactly once, invoked once: Puppet.warning('pkg warning: Certificate '/var/pkg/ssl/871b4ed0ade09926e6adf95f86bf17535f987684' for publisher 'solarisstudio', needed to access 'https://pkg.oracle.com/solarisstudio/release/', will expire in '29' days.')\r\n          # ./spec/unit/provider/package/pkg_spec.rb:126:in `block (4 levels) in <top (required)>'\r\n\r\n     5.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n          NameError:\r\n            method `exitstatus' not defined in NilClass\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  6) Puppet::Type::Package::ProviderPkg#methods :instances should correctly parse lines on solaris 11\r\n     Got 0 failures and 2 other errors:\r\n\r\n     6.1) Failure/Error: Puppet::Util::Execution.expects(:execute).with(['/bin/pkg', 'update', '-n', 'dummy'], {:failonfail => false, :combine => true}).returns ''\r\n\r\n          Mocha::ExpectationError:\r\n            not all expectations were satisfied\r\n            unsatisfied expectations:\r\n            - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '-n', 'dummy'], {:failonfail => false, :combine => true})\r\n            satisfied expectations:\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - expected never, not yet invoked: Puppet::Type::Package::ProviderPkg.warning(any_parameters)\r\n            - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hv')\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - expected never, not yet invoked: Puppet.warning(/pkg warning/)\r\n            - expected exactly once, invoked once: Puppet.warning('pkg warning: Certificate '/var/pkg/ssl/871b4ed0ade09926e6adf95f86bf17535f987684' for publisher 'solarisstudio', needed to access 'https://pkg.oracle.com/solarisstudio/release/', will expire in '29' days.')\r\n          # ./spec/unit/provider/package/pkg_spec.rb:126:in `block (4 levels) in <top (required)>'\r\n\r\n     6.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n          NameError:\r\n            method `exitstatus' not defined in NilClass\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  7) Puppet::Type::Package::ProviderPkg#methods :instances should fail on incorrect lines\r\n     Got 0 failures and 2 other errors:\r\n\r\n     7.1) Failure/Error: Puppet::Util::Execution.expects(:execute).with(['/bin/pkg', 'update', '-n', 'dummy'], {:failonfail => false, :combine => true}).returns ''\r\n\r\n          Mocha::ExpectationError:\r\n            not all expectations were satisfied\r\n            unsatisfied expectations:\r\n            - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '-n', 'dummy'], {:failonfail => false, :combine => true})\r\n            satisfied expectations:\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hv')\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - expected never, not yet invoked: Puppet::Type::Package::ProviderPkg.warning(any_parameters)\r\n            - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hv')\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - expected never, not yet invoked: Puppet.warning(/pkg warning/)\r\n            - expected exactly once, invoked once: Puppet.warning('pkg warning: Certificate '/var/pkg/ssl/871b4ed0ade09926e6adf95f86bf17535f987684' for publisher 'solarisstudio', needed to access 'https://pkg.oracle.com/solarisstudio/release/', will expire in '29' days.')\r\n          # ./spec/unit/provider/package/pkg_spec.rb:126:in `block (4 levels) in <top (required)>'\r\n\r\n     7.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n          NameError:\r\n            method `exitstatus' not defined in NilClass\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  8) Puppet::Type::Package::ProviderPkg#methods :instances should fail on unknown package status\r\n     Got 0 failures and 2 other errors:\r\n\r\n     8.1) Failure/Error: Puppet::Util::Execution.expects(:execute).with(['/bin/pkg', 'update', '-n', 'dummy'], {:failonfail => false, :combine => true}).returns ''\r\n\r\n          Mocha::ExpectationError:\r\n            not all expectations were satisfied\r\n            unsatisfied expectations:\r\n            - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '-n', 'dummy'], {:failonfail => false, :combine => true})\r\n            satisfied expectations:\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n            - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hv')\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hv')\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - expected never, not yet invoked: Puppet::Type::Package::ProviderPkg.warning(any_parameters)\r\n            - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hv')\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n            - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n            - expected never, not yet invoked: Puppet.warning(/pkg warning/)\r\n            - expected exactly once, invoked once: Puppet.warning('pkg warning: Certificate '/var/pkg/ssl/871b4ed0ade09926e6adf95f86bf17535f987684' for publisher 'solarisstudio', needed to access 'https://pkg.oracle.com/solarisstudio/release/', will expire in '29' days.')\r\n          # ./spec/unit/provider/package/pkg_spec.rb:126:in `block (4 levels) in <top (required)>'\r\n\r\n     8.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n          NameError:\r\n            method `exitstatus' not defined in NilClass\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  9) Puppet::Type::Package::ProviderPkg#methods :query should return fail when the packageline cannot be parsed\r\n     Got 0 failures and 2 other errors:\r\n\r\n     9.1) Failure/Error: $CHILD_STATUS.stubs(:exitstatus).returns 0\r\n\r\n          RuntimeError:\r\n            can't modify frozen NilClass\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:16:in `mocha'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:102:in `block in stubs'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `call'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `each'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:97:in `stubs'\r\n          # ./spec/unit/provider/package/pkg_spec.rb:218:in `block (4 levels) in <top (required)>'\r\n\r\n     9.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n          NameError:\r\n            method `exitstatus' not defined in NilClass\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n          # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  10) Puppet::Type::Package::ProviderPkg#methods :query on solaris 10 should find the package\r\n      Got 0 failures and 2 other errors:\r\n\r\n      10.1) Failure/Error: $CHILD_STATUS.stubs(:exitstatus).returns 0\r\n\r\n            RuntimeError:\r\n              can't modify frozen NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:16:in `mocha'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:102:in `block in stubs'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `call'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `each'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:97:in `stubs'\r\n            # ./spec/unit/provider/package/pkg_spec.rb:179:in `block (5 levels) in <top (required)>'\r\n\r\n      10.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n            NameError:\r\n              method `exitstatus' not defined in NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  11) Puppet::Type::Package::ProviderPkg#methods :query on solaris 10 should return :absent when the package is not found\r\n      Got 0 failures and 2 other errors:\r\n\r\n      11.1) Failure/Error: $CHILD_STATUS.stubs(:exitstatus).returns 1\r\n\r\n            RuntimeError:\r\n              can't modify frozen NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:16:in `mocha'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:102:in `block in stubs'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `call'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `each'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:97:in `stubs'\r\n            # ./spec/unit/provider/package/pkg_spec.rb:191:in `block (5 levels) in <top (required)>'\r\n\r\n      11.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n            NameError:\r\n              method `exitstatus' not defined in NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  12) Puppet::Type::Package::ProviderPkg#methods :query on solaris 11 should find the package\r\n      Got 0 failures and 2 other errors:\r\n\r\n      12.1) Failure/Error: $CHILD_STATUS.stubs(:exitstatus).returns 0\r\n\r\n            RuntimeError:\r\n              can't modify frozen NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:16:in `mocha'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:102:in `block in stubs'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `call'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `each'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:97:in `stubs'\r\n            # ./spec/unit/provider/package/pkg_spec.rb:198:in `block (5 levels) in <top (required)>'\r\n\r\n      12.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n            NameError:\r\n              method `exitstatus' not defined in NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  13) Puppet::Type::Package::ProviderPkg#methods :query on solaris 11 should return :absent when the package is not found\r\n      Got 0 failures and 2 other errors:\r\n\r\n      13.1) Failure/Error: $CHILD_STATUS.stubs(:exitstatus).returns 1\r\n\r\n            RuntimeError:\r\n              can't modify frozen NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:16:in `mocha'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:102:in `block in stubs'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `call'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `each'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:97:in `stubs'\r\n            # ./spec/unit/provider/package/pkg_spec.rb:211:in `block (5 levels) in <top (required)>'\r\n\r\n      13.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n            NameError:\r\n              method `exitstatus' not defined in NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  14) Puppet::Type::Package::ProviderPkg#methods :install should accept all licenses\r\n      Got 0 failures and 2 other errors:\r\n\r\n      14.1) Failure/Error: $CHILD_STATUS.stubs(:exitstatus).returns 0\r\n\r\n            RuntimeError:\r\n              can't modify frozen NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:16:in `mocha'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:102:in `block in stubs'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `call'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `each'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:97:in `stubs'\r\n            # ./spec/unit/provider/package/pkg_spec.rb:230:in `block (4 levels) in <top (required)>'\r\n\r\n      14.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n            NameError:\r\n              method `exitstatus' not defined in NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  15) Puppet::Type::Package::ProviderPkg#methods :install should install specific version(1)\r\n      Got 0 failures and 2 other errors:\r\n\r\n      15.1) Failure/Error: $CHILD_STATUS.stubs(:exitstatus).returns 0\r\n\r\n            RuntimeError:\r\n              can't modify frozen NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:16:in `mocha'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:102:in `block in stubs'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `call'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `each'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:97:in `stubs'\r\n            # ./spec/unit/provider/package/pkg_spec.rb:237:in `block (4 levels) in <top (required)>'\r\n\r\n      15.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n            NameError:\r\n              method `exitstatus' not defined in NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  16) Puppet::Type::Package::ProviderPkg#methods :install should install specific version(2)\r\n      Got 0 failures and 2 other errors:\r\n\r\n      16.1) Failure/Error: $CHILD_STATUS.stubs(:exitstatus).returns 0\r\n\r\n            RuntimeError:\r\n              can't modify frozen NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:16:in `mocha'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:102:in `block in stubs'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `call'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `each'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:97:in `stubs'\r\n            # ./spec/unit/provider/package/pkg_spec.rb:249:in `block (4 levels) in <top (required)>'\r\n\r\n      16.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n            NameError:\r\n              method `exitstatus' not defined in NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  17) Puppet::Type::Package::ProviderPkg#methods :install should downgrade to specific version\r\n      Got 0 failures and 2 other errors:\r\n\r\n      17.1) Failure/Error: $CHILD_STATUS.stubs(:exitstatus).returns 0\r\n\r\n            RuntimeError:\r\n              can't modify frozen NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:16:in `mocha'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:102:in `block in stubs'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `call'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `each'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:97:in `stubs'\r\n            # ./spec/unit/provider/package/pkg_spec.rb:256:in `block (4 levels) in <top (required)>'\r\n\r\n      17.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n            NameError:\r\n              method `exitstatus' not defined in NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  18) Puppet::Type::Package::ProviderPkg#methods :install should install any if version is not specified\r\n      Got 0 failures and 2 other errors:\r\n\r\n      18.1) Failure/Error: $CHILD_STATUS.stubs(:exitstatus).returns 0\r\n\r\n            RuntimeError:\r\n              can't modify frozen NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:16:in `mocha'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:102:in `block in stubs'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `call'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `each'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:97:in `stubs'\r\n            # ./spec/unit/provider/package/pkg_spec.rb:267:in `block (4 levels) in <top (required)>'\r\n\r\n      18.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n            NameError:\r\n              method `exitstatus' not defined in NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  19) Puppet::Type::Package::ProviderPkg#methods :install should install if no version was previously installed, and a specific version was requested\r\n      Got 0 failures and 2 other errors:\r\n\r\n      19.1) Failure/Error: $CHILD_STATUS.stubs(:exitstatus).returns 0\r\n\r\n            RuntimeError:\r\n              can't modify frozen NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:16:in `mocha'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:102:in `block in stubs'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `call'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `each'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:97:in `stubs'\r\n            # ./spec/unit/provider/package/pkg_spec.rb:276:in `block (4 levels) in <top (required)>'\r\n\r\n      19.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n            NameError:\r\n              method `exitstatus' not defined in NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  20) Puppet::Type::Package::ProviderPkg#methods :install installs the latest matching version when given implicit version, and none are installed\r\n      Got 0 failures and 2 other errors:\r\n\r\n      20.1) Failure/Error: $CHILD_STATUS.stubs(:exitstatus).returns 0\r\n\r\n            RuntimeError:\r\n              can't modify frozen NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:16:in `mocha'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:102:in `block in stubs'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `call'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `each'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:97:in `stubs'\r\n            # ./spec/unit/provider/package/pkg_spec.rb:288:in `block (4 levels) in <top (required)>'\r\n\r\n      20.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n            NameError:\r\n              method `exitstatus' not defined in NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  21) Puppet::Type::Package::ProviderPkg#methods :install updates to the latest matching version when given implicit version\r\n      Got 0 failures and 2 other errors:\r\n\r\n      21.1) Failure/Error: $CHILD_STATUS.stubs(:exitstatus).returns 0\r\n\r\n            RuntimeError:\r\n              can't modify frozen NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:16:in `mocha'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:102:in `block in stubs'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `call'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `each'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:97:in `stubs'\r\n            # ./spec/unit/provider/package/pkg_spec.rb:301:in `block (4 levels) in <top (required)>'\r\n\r\n      21.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n            NameError:\r\n              method `exitstatus' not defined in NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  22) Puppet::Type::Package::ProviderPkg#methods :install issues a warning when an implicit version number is used, and in sync\r\n      Got 0 failures and 2 other errors:\r\n\r\n      22.1) Failure/Error: $CHILD_STATUS.stubs(:exitstatus).returns 4\r\n\r\n            RuntimeError:\r\n              can't modify frozen NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:16:in `mocha'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:102:in `block in stubs'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `call'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `each'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:97:in `stubs'\r\n            # ./spec/unit/provider/package/pkg_spec.rb:312:in `block (4 levels) in <top (required)>'\r\n\r\n      22.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n            NameError:\r\n              method `exitstatus' not defined in NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  23) Puppet::Type::Package::ProviderPkg#methods :install issues a warning when choosing a version number for an implicit match\r\n      Got 0 failures and 2 other errors:\r\n\r\n      23.1) Failure/Error: $CHILD_STATUS.stubs(:exitstatus).returns 0\r\n\r\n            RuntimeError:\r\n              can't modify frozen NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:16:in `mocha'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:102:in `block in stubs'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `call'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/argument_iterator.rb:15:in `each'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/object.rb:97:in `stubs'\r\n            # ./spec/unit/provider/package/pkg_spec.rb:323:in `block (4 levels) in <top (required)>'\r\n\r\n      23.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n            NameError:\r\n              method `exitstatus' not defined in NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  24) Puppet::Type::Package::ProviderPkg#methods :update should not raise error if not necessary\r\n      Got 0 failures and 2 other errors:\r\n\r\n      24.1) Failure/Error: described_class.expects(:pkg).with(:list, '-Hvfa', 'dummy@1.0-0.151006').returns File.read(my_fixture('dummy_implicit_version'))\r\n\r\n            Mocha::ExpectationError:\r\n              not all expectations were satisfied\r\n              unsatisfied expectations:\r\n              - expected exactly once, not yet invoked: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvfa', 'dummy@1.0-0.151006')\r\n              - expected exactly once, not yet invoked: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvfa', 'dummy@1.0-0.151006')\r\n              - expected exactly once, not yet invoked: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvfa', 'dummy@1.0-0.151006')\r\n              - expected exactly once, not yet invoked: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvfa', 'dummy@1.0-0.151006')\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '-n', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '-n', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '--accept', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '-n', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '--accept', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '-n', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '--accept', 'dummy@0.0.7'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'unfreeze', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'unfreeze', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '--accept', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '--accept', 'dummy@0.0.8'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'unfreeze', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'unfreeze', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '--accept', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '-n', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).unhold()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).unhold()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).warning('Implicit version 1.0-0.151006 has 3 possible matches')\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).warning('Selecting version '1.0,5.11-0.151006:20140220T084443Z' for implicit '1.0-0.151006'')\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).warning('Implicit version 1.0-0.151006 has 3 possible matches')\r\n              satisfied expectations:\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hv')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hv')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected never, not yet invoked: Puppet::Type::Package::ProviderPkg.warning(any_parameters)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hv')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected never, not yet invoked: Puppet.warning(/pkg warning/)\r\n              - expected exactly once, invoked once: Puppet.warning('pkg warning: Certificate '/var/pkg/ssl/871b4ed0ade09926e6adf95f86bf17535f987684' for publisher 'solarisstudio', needed to access 'https://pkg.oracle.com/solarisstudio/release/', will expire in '29' days.')\r\n              - expected exactly once, invoked once: Package[dummy](provider=pkg).install(true)\r\n            # ./spec/unit/provider/package/pkg_spec.rb:321:in `block (4 levels) in <top (required)>'\r\n\r\n      24.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n            NameError:\r\n              method `exitstatus' not defined in NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  25) Puppet::Type::Package::ProviderPkg#methods :update should not raise error if not necessary (2)\r\n      Got 0 failures and 2 other errors:\r\n\r\n      25.1) Failure/Error: described_class.expects(:pkg).with(:list, '-Hvfa', 'dummy@1.0-0.151006').returns File.read(my_fixture('dummy_implicit_version'))\r\n\r\n            Mocha::ExpectationError:\r\n              not all expectations were satisfied\r\n              unsatisfied expectations:\r\n              - expected exactly once, not yet invoked: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvfa', 'dummy@1.0-0.151006')\r\n              - expected exactly once, not yet invoked: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvfa', 'dummy@1.0-0.151006')\r\n              - expected exactly once, not yet invoked: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvfa', 'dummy@1.0-0.151006')\r\n              - expected exactly once, not yet invoked: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvfa', 'dummy@1.0-0.151006')\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '-n', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '-n', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '--accept', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '-n', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '--accept', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '-n', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '--accept', 'dummy@0.0.7'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'unfreeze', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'unfreeze', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '--accept', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '--accept', 'dummy@0.0.8'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'unfreeze', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'unfreeze', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '--accept', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '-n', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).unhold()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).unhold()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).warning('Implicit version 1.0-0.151006 has 3 possible matches')\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).warning('Selecting version '1.0,5.11-0.151006:20140220T084443Z' for implicit '1.0-0.151006'')\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).warning('Implicit version 1.0-0.151006 has 3 possible matches')\r\n              satisfied expectations:\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hv')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hv')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected never, not yet invoked: Puppet::Type::Package::ProviderPkg.warning(any_parameters)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hv')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected never, not yet invoked: Puppet.warning(/pkg warning/)\r\n              - expected exactly once, invoked once: Puppet.warning('pkg warning: Certificate '/var/pkg/ssl/871b4ed0ade09926e6adf95f86bf17535f987684' for publisher 'solarisstudio', needed to access 'https://pkg.oracle.com/solarisstudio/release/', will expire in '29' days.')\r\n              - expected exactly once, invoked once: Package[dummy](provider=pkg).install(true)\r\n              - expected exactly once, invoked once: Package[dummy](provider=pkg).install(true)\r\n            # ./spec/unit/provider/package/pkg_spec.rb:321:in `block (4 levels) in <top (required)>'\r\n\r\n      25.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n            NameError:\r\n              method `exitstatus' not defined in NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  26) Puppet::Type::Package::ProviderPkg#methods :update should raise error if necessary\r\n      Got 0 failures and 2 other errors:\r\n\r\n      26.1) Failure/Error: described_class.expects(:pkg).with(:list, '-Hvfa', 'dummy@1.0-0.151006').returns File.read(my_fixture('dummy_implicit_version'))\r\n\r\n            Mocha::ExpectationError:\r\n              not all expectations were satisfied\r\n              unsatisfied expectations:\r\n              - expected exactly once, not yet invoked: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvfa', 'dummy@1.0-0.151006')\r\n              - expected exactly once, not yet invoked: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvfa', 'dummy@1.0-0.151006')\r\n              - expected exactly once, not yet invoked: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvfa', 'dummy@1.0-0.151006')\r\n              - expected exactly once, not yet invoked: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvfa', 'dummy@1.0-0.151006')\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '-n', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '-n', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '--accept', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '-n', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '--accept', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '-n', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '--accept', 'dummy@0.0.7'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'unfreeze', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'unfreeze', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '--accept', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '--accept', 'dummy@0.0.8'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'unfreeze', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'unfreeze', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '--accept', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '-n', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).unhold()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).unhold()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).warning('Implicit version 1.0-0.151006 has 3 possible matches')\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).warning('Selecting version '1.0,5.11-0.151006:20140220T084443Z' for implicit '1.0-0.151006'')\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).warning('Implicit version 1.0-0.151006 has 3 possible matches')\r\n              satisfied expectations:\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hv')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hv')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected never, not yet invoked: Puppet::Type::Package::ProviderPkg.warning(any_parameters)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hv')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected never, not yet invoked: Puppet.warning(/pkg warning/)\r\n              - expected exactly once, invoked once: Puppet.warning('pkg warning: Certificate '/var/pkg/ssl/871b4ed0ade09926e6adf95f86bf17535f987684' for publisher 'solarisstudio', needed to access 'https://pkg.oracle.com/solarisstudio/release/', will expire in '29' days.')\r\n              - expected exactly once, invoked once: Package[dummy](provider=pkg).install(true)\r\n              - expected exactly once, invoked once: Package[dummy](provider=pkg).install(true)\r\n              - expected exactly once, invoked once: Package[dummy](provider=pkg).install(true)\r\n            # ./spec/unit/provider/package/pkg_spec.rb:321:in `block (4 levels) in <top (required)>'\r\n\r\n      26.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n            NameError:\r\n              method `exitstatus' not defined in NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  27) Puppet::Type::Package::ProviderPkg#methods :uninstall should support current pkg version\r\n      Got 0 failures and 2 other errors:\r\n\r\n      27.1) Failure/Error: described_class.expects(:pkg).with(:list, '-Hvfa', 'dummy@1.0-0.151006').returns File.read(my_fixture('dummy_implicit_version'))\r\n\r\n            Mocha::ExpectationError:\r\n              not all expectations were satisfied\r\n              unsatisfied expectations:\r\n              - expected exactly once, not yet invoked: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvfa', 'dummy@1.0-0.151006')\r\n              - expected exactly once, not yet invoked: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvfa', 'dummy@1.0-0.151006')\r\n              - expected exactly once, not yet invoked: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvfa', 'dummy@1.0-0.151006')\r\n              - expected exactly once, not yet invoked: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvfa', 'dummy@1.0-0.151006')\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '-n', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '-n', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '--accept', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '-n', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '--accept', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '-n', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '--accept', 'dummy@0.0.7'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'unfreeze', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'unfreeze', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '--accept', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '--accept', 'dummy@0.0.8'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'unfreeze', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'unfreeze', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '--accept', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '-n', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).unhold()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).unhold()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).warning('Implicit version 1.0-0.151006 has 3 possible matches')\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).warning('Selecting version '1.0,5.11-0.151006:20140220T084443Z' for implicit '1.0-0.151006'')\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).warning('Implicit version 1.0-0.151006 has 3 possible matches')\r\n              satisfied expectations:\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg([:uninstall, 'dummy'])\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:version)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hv')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hv')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected never, not yet invoked: Puppet::Type::Package::ProviderPkg.warning(any_parameters)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hv')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected never, not yet invoked: Puppet.warning(/pkg warning/)\r\n              - expected exactly once, invoked once: Puppet.warning('pkg warning: Certificate '/var/pkg/ssl/871b4ed0ade09926e6adf95f86bf17535f987684' for publisher 'solarisstudio', needed to access 'https://pkg.oracle.com/solarisstudio/release/', will expire in '29' days.')\r\n              - expected exactly once, invoked once: Package[dummy](provider=pkg).install(true)\r\n              - expected exactly once, invoked once: Package[dummy](provider=pkg).install(true)\r\n              - expected exactly once, invoked once: Package[dummy](provider=pkg).install(true)\r\n            # ./spec/unit/provider/package/pkg_spec.rb:321:in `block (4 levels) in <top (required)>'\r\n\r\n      27.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n            NameError:\r\n              method `exitstatus' not defined in NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\n  28) Puppet::Type::Package::ProviderPkg#methods :uninstall should support original pkg commands\r\n      Got 0 failures and 2 other errors:\r\n\r\n      28.1) Failure/Error: described_class.expects(:pkg).with(:list, '-Hvfa', 'dummy@1.0-0.151006').returns File.read(my_fixture('dummy_implicit_version'))\r\n\r\n            Mocha::ExpectationError:\r\n              not all expectations were satisfied\r\n              unsatisfied expectations:\r\n              - expected exactly once, not yet invoked: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvfa', 'dummy@1.0-0.151006')\r\n              - expected exactly once, not yet invoked: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvfa', 'dummy@1.0-0.151006')\r\n              - expected exactly once, not yet invoked: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvfa', 'dummy@1.0-0.151006')\r\n              - expected exactly once, not yet invoked: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvfa', 'dummy@1.0-0.151006')\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '-n', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '-n', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '--accept', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '-n', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '--accept', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '-n', 'dummy@1.0,5.11-0.151006:20140220T084443Z'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '--accept', 'dummy@0.0.7'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'unfreeze', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'unfreeze', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '--accept', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '--accept', 'dummy@0.0.8'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'unfreeze', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'unfreeze', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'install', '--accept', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'list', '-Hv', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Puppet::Util::Execution.execute(['/bin/pkg', 'update', '-n', 'dummy'], {:failonfail => false, :combine => true})\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).unhold()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).unhold()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).query()\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).warning('Implicit version 1.0-0.151006 has 3 possible matches')\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).warning('Selecting version '1.0,5.11-0.151006:20140220T084443Z' for implicit '1.0-0.151006'')\r\n              - expected exactly once, not yet invoked: Package[dummy](provider=pkg).warning('Implicit version 1.0-0.151006 has 3 possible matches')\r\n              satisfied expectations:\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - allowed any number of times, not yet invoked: Signal.trap(any_parameters)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg([:uninstall, '-r', 'dummy'])\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:version)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg([:uninstall, 'dummy'])\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:version)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hv')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hv')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected never, not yet invoked: Puppet::Type::Package::ProviderPkg.warning(any_parameters)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hv')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected exactly once, invoked once: Puppet::Type::Package::ProviderPkg.pkg(:list, '-Hvn', 'dummy')\r\n              - allowed any number of times, not yet invoked: Puppet::Type::Package::ProviderPkg.command(:pkg)\r\n              - expected never, not yet invoked: Puppet.warning(/pkg warning/)\r\n              - expected exactly once, invoked once: Puppet.warning('pkg warning: Certificate '/var/pkg/ssl/871b4ed0ade09926e6adf95f86bf17535f987684' for publisher 'solarisstudio', needed to access 'https://pkg.oracle.com/solarisstudio/release/', will expire in '29' days.')\r\n              - expected exactly once, invoked once: Package[dummy](provider=pkg).install(true)\r\n              - expected exactly once, invoked once: Package[dummy](provider=pkg).install(true)\r\n              - expected exactly once, invoked once: Package[dummy](provider=pkg).install(true)\r\n            # ./spec/unit/provider/package/pkg_spec.rb:321:in `block (4 levels) in <top (required)>'\r\n\r\n      28.2) Failure/Error: stubbee.__metaclass__.send(:remove_method, method)\r\n\r\n            NameError:\r\n              method `exitstatus' not defined in NilClass\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:55:in `remove_new_method'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/class_method.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:20:in `unstub'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/central.rb:27:in `unstub_all'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/mockery.rb:65:in `teardown'\r\n            # /usr/local/opt/rbenv/versions/2.2.3/gemsets/puppet-45/gems/mocha-0.10.5/lib/mocha/api.rb:160:in `mocha_teardown'\r\n\r\nFinished in 0.21246 seconds (files took 2.5 seconds to load)\r\n49 examples, 28 failures\r\n\r\nFailed examples:\r\n\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:112 # Puppet::Type::Package::ProviderPkg#methods :latest should work correctly for ensure latest on solaris 11(known UFOXI)\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:120 # Puppet::Type::Package::ProviderPkg#methods :latest should work correctly for ensure latest on solaris 11 (IFO)\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:125 # Puppet::Type::Package::ProviderPkg#methods :latest should work correctly for ensure latest on solaris 11(known IFO)\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:133 # Puppet::Type::Package::ProviderPkg#methods :latest issues a warning when the certificate has expired\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:141 # Puppet::Type::Package::ProviderPkg#methods :latest doesn't issue a warning when the certificate hasn't expired\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:150 # Puppet::Type::Package::ProviderPkg#methods :instances should correctly parse lines on solaris 11\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:159 # Puppet::Type::Package::ProviderPkg#methods :instances should fail on incorrect lines\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:167 # Puppet::Type::Package::ProviderPkg#methods :instances should fail on unknown package status\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:216 # Puppet::Type::Package::ProviderPkg#methods :query should return fail when the packageline cannot be parsed\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:177 # Puppet::Type::Package::ProviderPkg#methods :query on solaris 10 should find the package\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:189 # Puppet::Type::Package::ProviderPkg#methods :query on solaris 10 should return :absent when the package is not found\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:197 # Puppet::Type::Package::ProviderPkg#methods :query on solaris 11 should find the package\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:209 # Puppet::Type::Package::ProviderPkg#methods :query on solaris 11 should return :absent when the package is not found\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:226 # Puppet::Type::Package::ProviderPkg#methods :install should accept all licenses\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:234 # Puppet::Type::Package::ProviderPkg#methods :install should install specific version(1)\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:244 # Puppet::Type::Package::ProviderPkg#methods :install should install specific version(2)\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:253 # Puppet::Type::Package::ProviderPkg#methods :install should downgrade to specific version\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:262 # Puppet::Type::Package::ProviderPkg#methods :install should install any if version is not specified\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:271 # Puppet::Type::Package::ProviderPkg#methods :install should install if no version was previously installed, and a specific version was requested\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:280 # Puppet::Type::Package::ProviderPkg#methods :install installs the latest matching version when given implicit version, and none are installed\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:293 # Puppet::Type::Package::ProviderPkg#methods :install updates to the latest matching version when given implicit version\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:306 # Puppet::Type::Package::ProviderPkg#methods :install issues a warning when an implicit version number is used, and in sync\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:316 # Puppet::Type::Package::ProviderPkg#methods :install issues a warning when choosing a version number for an implicit match\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:329 # Puppet::Type::Package::ProviderPkg#methods :update should not raise error if not necessary\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:334 # Puppet::Type::Package::ProviderPkg#methods :update should not raise error if not necessary (2)\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:339 # Puppet::Type::Package::ProviderPkg#methods :update should raise error if necessary\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:348 # Puppet::Type::Package::ProviderPkg#methods :uninstall should support current pkg version\r\nrspec ./spec/unit/provider/package/pkg_spec.rb:354 # Puppet::Type::Package::ProviderPkg#methods :uninstall should support original pkg commands\r\n{noformat}\r\n","closed_at":"2017-04-06T07:11:54.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7158","labels":"maintenance","state":"Closed","updated_at":"2017-04-06T07:11:54.000-0700","timestamp":1652285272.588474,"priority":"Normal","status_category":"Done","pull_request":5601},{"issue_id":"180778","title":"Apparently a Puppet Hiera error message points to a 404","url":"https://tickets.puppetlabs.com/browse/PUP-7360","created_at":"2017-03-15T22:01:03.000-0700","number":"PUP-7360","body":"The new Puppet version is pointing Hiera users to a 404 page.\r\n\r\n{quote}\r\n[21:58:28]  <golgy>\tThis is an upgrade of PE 2016.5.1 -> 2017.1 \r\n[21:58:31]  <golgy>\tif it matters\r\n[21:58:53]  <golgy>\t2017-03-16 04:01:12,660 - [Warning]: /etc/puppetlabs/enterprise/hiera.yaml: Use of 'hiera.yaml' version 3 is deprecated. It should be converted to version 5\r\n[21:58:55]  <golgy>\t   (in /etc/puppetlabs/enterprise/hiera.yaml)\r\n[21:58:57]  <golgy>\t2017-03-16 04:01:12,833 - [Warning]: The function 'hiera' is deprecated in favor of using 'lookup'. See https://docs.puppet.com/puppet/4.9.4/reference/deprecated_language.html\r\n[21:58:59]  <golgy>\t   (file & line not available)\r\n[21:59:02]  <golgy>\tAnd puppet 4.9.4\r\n{quote}","closed_at":"2017-04-06T07:11:54.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7360","labels":"","state":"Closed","updated_at":"2017-04-06T07:11:54.000-0700","timestamp":1652285272.698469,"priority":"Normal","status_category":"Done","pull_request":5720},{"issue_id":"179716","title":"context_spec.rb fails when run in isolation","url":"https://tickets.puppetlabs.com/browse/PUP-7340","created_at":"2017-03-10T15:43:25.000-0800","number":"PUP-7340","body":"Getting an error when running context_spec.rb in isolation on 4.9.4 and later:\r\n\r\n{noformat}\r\n$ bundle exec rspec spec/unit/pops/lookup/context_spec.rb\r\nRun options: exclude {:broken=>true, :benchmark=>true}\r\n.................F...\r\n\r\nFailures:\r\n\r\n  1) Puppet::Pops::Lookup::Context an instance with cached_file_data and multiple compilations will invalidate cache if file changes\r\n     Failure/Error: expect(logs).to eql([\"{parsed => a: value a\\n}\", \"{parsed => b: value b\\n}\"])\r\n\r\n       expected: [\"{parsed => a: value a\\n}\", \"{parsed => b: value b\\n}\"]\r\n            got: [\"{parsed => a: value a\\n}\", \"{parsed => a: value a\\n}\"]\r\n\r\n       (compared using eql?)\r\n\r\n       Diff:\r\n       @@ -1,3 +1,3 @@\r\n        {parsed => a: value a\\n}\r\n       -{parsed => b: value b\\n}\r\n       +{parsed => a: value a\\n}\r\n\r\n     # ./spec/unit/pops/lookup/context_spec.rb:228:in `block (5 levels) in <module:Lookup>'\r\n{noformat}\r\n\r\nThe error doesn't show up in travis/appveyor, so guessing it's order dependent failure.\r\n\r\nSee c150f76f540b89b8eeef27aee36caf7564e829de and PUP-7305,","closed_at":"2017-04-06T07:11:55.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7340","labels":"","state":"Closed","updated_at":"2017-04-06T07:11:55.000-0700","timestamp":1652285273.0174,"priority":"Normal","status_category":"Done","pull_request":5718},{"issue_id":"181027","title":"Hashes with dots in hiera will no longer fail a puppetrun","url":"https://tickets.puppetlabs.com/browse/PUP-7366","created_at":"2017-03-17T01:06:41.000-0700","number":"PUP-7366","body":"We are in tihe process of moving to puppet 4. One of the issues we encountered with puppet 4.8.2 (puppet-agent 1.8.3) was that when trying to read a hash from hiera that contained a dot in the name. We used 4.8.2 first as 4.9.3 was giving us a lot of issues. However, with the release of 4.9.4, most were fixed so we switched to that. However, I noticed a regression has slipped in where hashes with dots in the name are no longer failing a puppetrun. In fact, they are silently ignored (leaving your resources unmanaged!). The puppetserver also doesn't print any warning about using illegal hash names.\r\n\r\nExample hash that should fail:\r\n{code}\r\nmy.hash:\r\n  some: value\r\n  another: value\r\n{code}\r\n\r\nWith puppet 4.8.x, reading this hash with hiera_hash fails the run with:\r\n{quote}\r\nEvaluation Error: Error while evaluating a Function Call, Resolution type :hash is illegal when accessing values using dotted keys. Offending key was ....\r\n{quote}\r\n","closed_at":"2017-04-06T07:11:55.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7366","labels":"","state":"Closed","updated_at":"2017-04-06T07:11:55.000-0700","timestamp":1652285273.120999,"priority":"Major","status_category":"Done","pull_request":5728},{"issue_id":"181306","title":"Ensure that returned value from data provider is type checked only once.","url":"https://tickets.puppetlabs.com/browse/PUP-7370","created_at":"2017-03-20T01:28:37.000-0700","number":"PUP-7370","body":"The values returned from a data provider are type checked by the lookup framework. Currently, this means that if the function that is backing the provider has a declared return type, then the value will be checked twice. This needs to change so that the lookup framework relies on the type check performed by the function when it is known to always check its returned value.\r\n\r\nWe need a mechanism that checks if all dispatchers of a function are declared with a return type, and if so, checks that they are all assignable to the {{Puppet::LookupValue}}, or if it is a {{data_hash}}, to the type {{Hash[Puppet::LookupKey,Puppet::LookupValue]}}. If it isn't assignable, an error should be raised.\r\n","closed_at":"2017-04-06T07:11:55.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7370","labels":"","state":"Closed","updated_at":"2017-04-06T07:11:55.000-0700","timestamp":1652285273.224221,"priority":"Normal","status_category":"Done","pull_request":5733},{"issue_id":"182261","title":"Fix problem with \"Attempt to redefine entity\" when using type aliases as class parameter","url":"https://tickets.puppetlabs.com/browse/PUP-7391","created_at":"2017-03-23T07:16:38.000-0700","number":"PUP-7391","body":"If a function parameter declaration or return type, references a type that has not yet been loaded, and that type is prefixed with the name of a module that has not yet been loaded, then the loaders will first make an attempt to load the files in the modules manifests directory. If such a file, in turn, also references the same type, then that triggers a recursive load. When the recursive call returns, the loader will still try to add the type, which results in an \"Attempt to redefine entity\" error.","closed_at":"2017-04-06T07:11:55.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7391","labels":"","state":"Closed","updated_at":"2017-04-06T07:11:55.000-0700","timestamp":1652285273.330376,"priority":"Normal","status_category":"Done","pull_request":5758},{"issue_id":"179607","title":"Interpolation behavior in hiera.yaml changed between Puppet version 4.9.3 and 4.9.4","url":"https://tickets.puppetlabs.com/browse/PUP-7336","created_at":"2017-03-10T08:19:14.000-0800","number":"PUP-7336","body":"When using an array in hiera.yaml changes of global variables are ignored in puppet 4.9.4.\r\nExample environments/development/hiera.yaml:\r\n{code:yaml}\r\n---\r\nversion: 5\r\n\r\ndefaults:\r\n  datadir: 'data'\r\n  data_hash: yaml_data\r\n\r\nhierarchy:\r\n  - name: \"Global settings\"\r\n    path: \"global.yaml\"\r\n  - name: \"Role specific settings\"\r\n    paths:\r\n      - \"roles/%{::roles.0}.yaml\"\r\n{code}\r\nExample test.pp:\r\n{code:puppet}\r\n$roles = lookup('roles')\r\n$data = lookup('data', Array[String], 'unique')\r\nnotify{\"data: ${data}\":}\r\n{code}\r\nExample environments/development/data/global.yaml:\r\n{code:yaml}\r\nroles:\r\n        - test1\r\n\r\ndata:\r\n        - \"from global\"\r\n{code}\r\nExample environments/development/data/roles/test1.yaml:\r\n{code:yaml}\r\ndata:\r\n        - 'from test1'\r\n{code}\r\nWhen running \"puppet apply --environment=development test.pp\" this results in:\r\n{code}\r\nWarning: Undefined variable '::roles'; \r\n   (file & line not available)\r\nNotice: Compiled catalog for hostname in environment development in 0.07 seconds\r\nNotice: data: [from global]\r\nNotice: /Stage[main]/Main/Notify[data: [from global]]/message: defined 'message' as 'data: [from global]'\r\nNotice: Applied catalog in 0.17 seconds\r\n\r\n{code}\r\nWhen changing \r\n{code}\r\n\"roles/%{::roles.0}.yaml\"\r\n{code}\r\n to \r\n{code}\r\n\"roles/%{roles.0}.yaml\"\r\n{code}\r\n puppet apply returns:\r\n{code}\r\nWarning: Undefined variable 'roles'; \r\n   (file & line not available)\r\nNotice: Compiled catalog for hostname in environment development in 0.07 seconds\r\nNotice: data: [from global, from test1]\r\nNotice: /Stage[main]/Main/Notify[data: [from global, from test1]]/message: defined 'message' as 'data: [from global, from test1]'\r\nNotice: Applied catalog in 0.17 seconds\r\n{code}\r\nIn Puppet 4.9.3 both versions return the same result. This bug is probably related to PUP-7303.","closed_at":"2017-04-07T02:17:00.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7336","labels":"regression","state":"Closed","updated_at":"2017-04-07T02:17:00.000-0700","timestamp":1652285274.071623,"priority":"Normal","status_category":"Done","pull_request":5706},{"issue_id":"128101","title":"Data in modules interpret nil as {}","url":"https://tickets.puppetlabs.com/browse/PUP-6230","created_at":"2016-04-24T01:13:20.000-0700","number":"PUP-6230","body":"Given data in a module class:\r\n\r\n{code}\r\nclass ntp (\r\n  Optional[String] $ticker_file\r\n) {\r\n...\r\n}\r\n{code}\r\n\r\nand hiera data in the module:\r\n\r\n{code}\r\nntp::ticker_file: ~\r\n{code}\r\n\r\nThe nil is interpreted as a hash:\r\n\r\n{code}\r\n% puppet lookup --explain --modulepath `pwd` ntp::ticker_file\r\nMerge strategy first\r\n  Data Binding \"hiera\"\r\n    No such key: \"ntp::ticker_file\"\r\n  Data Provider \"EnvironmentDataProvider\"\r\n    No such key: \"ntp::ticker_file\"\r\n  Module \"ntp\" using Data Provider \"Hiera Data Provider, version 4\"\r\n    ConfigurationPath \"/example/ntp/hiera.yaml\"\r\n    Merge strategy first\r\n      Data Provider \"OS family\"\r\n        Path \"/example/ntp/data/os/RedHat.yaml\"\r\n          Original path: \"os/%{facts.os.family}\"\r\n          Path not found\r\n      Data Provider \"defaults\"\r\n        Path \"/example/ntp/data/defaults.yaml\"\r\n          Original path: \"defaults\"\r\n          Found key: \"ntp::ticker_file\" value: {}\r\n      Merged result: {}\r\n  Merged result: {}\r\n{code}\r\n\r\nWhile the YAML is correctly interpreted by ruby as a nil:\r\n\r\n{code}\r\n% /opt/puppetlabs/puppet/bin/ruby -r yaml -e 'p YAML.load(File.read(\"ntp/data/defaults.yaml\"))[\"ntp::ticker_file\"]'\r\nnil\r\n{code}\r\n\r\nAnd to be clear its puppet the error is:\r\n\r\n{code}\r\nError: Evaluation Error: Error while evaluating a Function Call, Class[Ntp]: parameter 'ticker_file' expects a String value, got Hash\r\n{code}\r\n\r\n","closed_at":"2017-04-07T11:45:01.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6230","labels":"","state":"Closed","updated_at":"2017-04-07T11:45:01.000-0700","timestamp":1652285274.180254,"priority":"Normal","status_category":"Done","pull_request":4911},{"issue_id":"180770","title":"hiera5 doesn't interpolate in encrypted eyaml data","url":"https://tickets.puppetlabs.com/browse/PUP-7359","created_at":"2017-03-15T17:07:57.000-0700","number":"PUP-7359","body":"{code}\r\n[root@vi3cckc8ez3nwsu environments]# cat eyaml_backend2_1jvdmn6q/hieradata/common.yaml\r\n---\r\nenclair: \"i see you\"\r\ntest_hiera: ENC[PKCS7,MIIBmQYJKoZIhvcNAQcDoIIBijCCAYYCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEAhv8GjtqL4qmKoLp7QMuc6gdLaDa44rbedyiS+2WPfjG2c9rJ5tQBVmfCHw/Q/gSLCiKSwU9N5XfJ7o8iPAU9MciB5ZraZ90lbbTA8N+7ooor+DabwHEPyd6FfohndSmnphUfriDv9UWpoK9dAX0VULOUEA/t3j7GrXpiskNlzHaYyM/eKmbAgu4CSF5EyNLFf4Erj/Qxmn+lb0EkWPebIzfFZQzIm4BVhwOjww9/eJ4ydWW76GgTJTOGqmp/YM3eS8QJ6TzXAGBKQV3P4FSvDWFyZbBAnqBZPc6C00gxBNAgqEa64+1PVAtFaDqx/LTZmKdprGOjoLWut9WSlkngmjBcBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBDCJwtT7eIr5Z0ESO8wfIYmgDBoP+U3GbwDlc38aHfFKiAEZDUX0pde8xlZOhmBZGoj7ds9nvhtGD6x1b90HwTBGh4=]\r\ntest_lookup: ENC[PKCS7,MIIBqQYJKoZIhvcNAQcDoIIBmjCCAZYCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEAlNuG340KhfR4SODMIztaMUH9BF7a44KTboiNugYNWhesdGRDwc0Hj4Au+YZa0EnNpG70MmIEjdAOqMijGudv6cRR2sixI0NGdryVv2Hc8b9yQtNYKCTwHp5I2k2sTyJF+Eppjmy6h268rYERrQpIEqP8Ia1/4dDo/M7sWsKfyP/BUTzgjBEcrjRGFUgsGKKJEr6gQId32KS3dWH8/+/L+WXrVp979Fp0TrdvYCEKJgFIuWSMXrxyE+RWQ2qt4+y03npbcgoBpVUTSWfeJlAhao5N3Z7va9/uOc/oEqZdv3TDQK6fsaixJsKwo+1UV0LUiKy+f1FX2w1Jn6Z76y0L6DBsBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBDC33gi3AidF28icqddIiVFgECtXrSPeJKV7LcSGP4NH6RDqCAGYKBjCySD46SJuo4BszlQeWCayLj8cJXvshHXOBB9WtkQZ2bdJ0e9sCG2+t6Y]\r\na: ENC[PKCS7,MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEACimJBAyaj5U4p759lk3ue8hVznTER71LvGxW/BANhXJYpp2WpEPmPU1btVnpL4LrB91gajnDbX9CxR+W3kIUzJfbhnTmJug+oiOwZMtiTVxNx/NEslTbWSthue8WoVe56xQqbA7t9JZK3GHmui7yRKYMzUc7gs9zX6cSizmIsqt8qn8RaRmzMTF2BDYbZ0hlBjWqM/7/g8Ci0PsyKJcDdJRov7bQWZVZDbrUqs9oQqUiter0oHVyG7Y35N8gek8bOnKEXkr9KhsQhCTV2UQckehWj0vBZRAkFElHU61b+mABT1VtoF/62ke0ao0xREN+CINBaskD1cU+qMOl75s81jA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBAWHhUsXVnc+3xsjgcbMoi6gBBe/zpK1VWLh4AGOa7hqLGs]\r\n[root@vi3cckc8ez3nwsu environments]# puppet lookup a --environment eyaml_backend2_1jvdmn6q\r\n--- a_value\r\n...\r\n[root@vi3cckc8ez3nwsu environments]# puppet lookup test_hiera --environment eyaml_backend2_1jvdmn6q\r\n--- test value with hiera interpolation %{hiera(a)}\r\n...\r\n[root@vi3cckc8ez3nwsu environments]# ls /tmp/keys/private_key.pkcs7.pem\r\nls: cannot access /tmp/keys/private_key.pkcs7.pem: No such file or directory\r\n[root@vi3cckc8ez3nwsu environments]# cat eyaml_backend2_hzxytfvi/hieradata/common.yaml\r\n---\r\nenclair: \"i see you\"\r\ntest_hiera: ENC[PKCS7,MIIBqQYJKoZIhvcNAQcDoIIBmjCCAZYCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEAob9W0b/BMfa2JYZhXrTxHXsM++YgvCqungx7nlqxY+2WtnVnpSZf6UaNAOrWD+etXGGVqO7cLBlkEEOU7mfNGbE6eu6uIu6hTdX6w9NtY3rEKT8Wjbgzs+Ig7FP1/5KR4rrCv6nEkhlmopK2fxKJZ8H5fZDZvl4Y1y7ozWN/YwRjWNx2dJjpjsM8/COsWkQykclvsTTgUQwFFkP/NWph8+0umV/UhbEBrYtcWLdEHyQ+gCNlGJFQ1eeB9EZd0bnr46vD49Icb6HpP3u5MofxTS6HbbmJPCjYW4hfzXTs6lrMiuggeFI2M3jSLZpsfcghf6OmVPb3EHlVEuKb7ohosTBsBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBApsllLIrkTZPJaEcQ+vsXkgEDhHvGIJXk+Wy4Ie0HkBCF6XukUY+zUY9f4JTXucCT2AP2aMAP71t464sz/SRQR2F1dTii/OBtgpF17E9xfajM3]\r\ntest_lookup: ENC[PKCS7,MIIBqQYJKoZIhvcNAQcDoIIBmjCCAZYCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEAAqJSNWSGlC/nFUU+gZIylGjF2QWrFYnxv7wJAugp0CBULaCyuoE5jhFpSyxq51BuM7ZP+LM4noeLDOycl7LbmMpBWR7YPKNmuTb4Tn7eQyfgVOW4gn2HbJWWidZgGTjRl+hNGrlOGvFOJdwqZ9c7J5eZfs3xkkJUFclVHYylr9nbIEtCW0VynxWB5pCwNnvBz4iYRclbIq2Rr1kq7qngagahavQ9oHrVFHaA5ndcVHPZzuNo8KwY+cXhYmmxDe25odkPSfIVJTJlFNarckxroaYhdNhozEktllnQ9F8vuDQfmhjjbiD0r8+a2QqdGkafToLALrigAA2lqUE3+heStzBsBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBCpsGEnaV6kS8fEfOW5R+2xgECgXyVAMVvOdtqKX15SHjZADzTOxx7ZC2GEx0r6OtEEDASc2ys8iMAJbRZEL0tRW5auWVGV2BhTgBnEYh79f+wV]\r\na: ENC[PKCS7,MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEATrH/t1PCki/fRmncjSP1ZIEWORtfAVDGfKyRfBb30Y0TpVbGWDW1bOz0N9aHDKSf5EuaPQiL47BjBLZhSFiL0xWHltT7ttXO0hTwuCAq8uu397MrnI2WvNkFVE5f3QGb8+Wt45yWiGUYrp3YWIRo9C04FeJNtqxCnJC6pr43GTAJxHz+NRZTwZQNMCb6TAB6FDJJSzfgNGZqxoTTFmERzajZ2wIG4D1g2qBXHSmASUYHP6KLDBajVlZQUkQGTGo3mOP9LDi1Ui7WPTRslQXfyPcCNRRzLxEb0aU/mUVXzPoxFjg9UaMa8ej+lHRtROfHEz6BV6WOvJpML5N0+rt2+DA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBBZD2lwDoR6ohoBSorOnzr0gBB+cgnAJ6RQTXZ4nuIh5PEU]\r\n[root@vi3cckc8ez3nwsu environments]#\r\n[root@vi3cckc8ez3nwsu environments]# cat eyaml_backend2_kvc8fyx4/hiera.yaml\r\n---\r\nversion: 5\r\nhierarchy:\r\n  - name: \"common\"\r\n    lookup_key: eyaml_lookup_key\r\n    datadir: hieradata\r\n    path: \"common.yaml\"\r\n    options:\r\n      pkcs7_private_key: \"/tmp/keys/private_key.pkcs7.pem\"\r\n      pkcs7_public_key: \"/tmp/keys/public_key.pkcs7.pem\"\r\n[root@vi3cckc8ez3nwsu environments]# cat eyaml_backend2_kvc8fyx4/hieradata/common.yaml\r\n---\r\nenclair: \"i see you\"\r\ntest_hiera: ENC[PKCS7,MIIBqQYJKoZIhvcNAQcDoIIBmjCCAZYCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEAVAvZnONpBjO1PeLEeoGBvnHgHqeaBau7IINXjpSSbMIBFzBUmHGChVxl6NIfnxJeZSf3c6sgUhphh67cPFQSXOreuWyWoxutD71++yP1rQlg8SEgTKbRtm9OeFfzXP4abAnIodmbVM2tvrcp9YtVJIoj4cEtbeI5kCgAaZc88eQt9oG8H3HxkvmJkkn/BG/BXQMIOWPXL23DMfTMfpdyS2naIcVC7IP2bUkXrA/gwjSDo5L5n+xmszmgW67Jvdj5oac9Aj3MdsP15x5xt7pyyFFgp9n78cqeZuW4jqRJKtIrQojiOY1cCAQxHboomjdUzksBDF8eVxIB4mhRWdhbLjBsBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBDI3EXpPE7LvjxTKbbQH4NZgEDxumxiA6Rh/AjccpmQ+FG2aw6GBMd2HKV7n2Z1hX+L9l9/mjNlSgBL5SjiUzcp8izSb57dJ70lilyJZQsjyXMl]\r\ntest_lookup: ENC[PKCS7,MIIBqQYJKoZIhvcNAQcDoIIBmjCCAZYCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEAZSShL7CtKW0fLbRDvM74EB0FOmdV4YNDzq8U7tHm5YGPLQn+5ZLfhe0BvHZSUW95DCgSiJiwSMq9kBe6mBxx2U70Jbu87w7Kv3QzbN1c6GW8BavJitATs6dYYY3byfmrvvPv7MC5TswNJvhPx1Os3jE+R4z0gWTgOF+QwXOua4Z1no4bpGOHjrtxWowLwdktDmGESvs/g/H8rpA3CO873bjzRj33NaKRFNraA2by9K2/nkfRNHCeMP5K/z0t8OBZXoqR9HtVVvwcIeM5HUMfmAg1hjsuAXrwY+I3Q9M2PgebzX4orC8XOMIp9n3e4bpkimSP211+ot++FJiiUzB4GTBsBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBAt5SN7oOgZRaFWbIdRohungED3mpE5hvHd+2nECGMXlJxPjp2730ip+mcrMA271rWEHIeBvQMzmWPLIDHhQDVYAN+f4ZXomUPfxTw/Z6ItUMVl]\r\na: ENC[PKCS7,MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEAGAYLe28feCFW8z8IdYyU3aws0S7caZgKP9xw47bOnETEmTLAyEbSRgz/c9WKmDVGb66l10wiVT4reCcENPHTQBgDLhRmLqFdcNIRWhkZIuCV2lddJbnsc/r33lIwJ8y88hfnGWJOhHPIoT6foucdId8oS/40qlGaZAY0ylz2hvQHxk+vmCMVOnk59DXCToMqdBM8YFKGiHzqJx9+HR+gE/A6zTDBQo8WD4W7D/SBWdNc6p2VRLamXWlphifp9xIr11vvWrwq5IdZblKzKLa762zcN3YYTvyfPAQwFC++KCm8TpKFjCP9VLNKTZrBY75TTvFpA5XeVr33XPXwwOBrwzA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBAXv3L3YJj57cyLPcAylQiUgBBhGu5F0uJbrYByZ7PdiMiE]\r\n[root@vi3cckc8ez3nwsu environments]# puppet lookup a --environment eyaml_backend2_kvc8fyx4\r\n--- a_value\r\n...\r\n[root@vi3cckc8ez3nwsu environments]# puppet lookup test_hiera --environment eyaml_backend2_kvc8fyx4\r\n--- test value with hiera interpolation %{hiera(\"a\")}\r\n...\r\n[root@vi3cckc8ez3nwsu environments]# puppet lookup test_lookup --environment eyaml_backend2_kvc8fyx4\r\n--- test value with hiera interpolation %{lookup(\"a\")}\r\n...\r\n[root@vi3cckc8ez3nwsu environments]# cat eyaml_backend2_kvc8fyx4/manifests/site.pp\r\nnotify { \"lookup_clair2: ${lookup('enclair')}\": }\r\nnotify { \"a2: ${lookup('a')}\": }\r\nnotify { \"lookup2: ${lookup('test_lookup')}\": }\r\nnotify { \"hiera2: ${hiera('test_hiera')}\": }\r\nnotify { \"lookup_hiera2: ${lookup('test_hiera')}\": }\r\nnotify { \"hiera_lookup2: ${hiera('test_lookup')}\": }\r\n[root@vi3cckc8ez3nwsu environments]# puppet agent -t --environment eyaml_backend2_kvc8fyx4 --server $(hostname -f)\r\nInfo: Using configured environment 'eyaml_backend2_kvc8fyx4'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Caching catalog for vi3cckc8ez3nwsu.delivery.puppetlabs.net\r\nInfo: Applying configuration version '1489622729'\r\nNotice: lookup_clair2: i see you\r\nNotice: /Stage[main]/Main/Notify[lookup_clair2: i see you]/message: defined 'message' as 'lookup_clair2: i see you'\r\nNotice: a2: a_value\r\nNotice: /Stage[main]/Main/Notify[a2: a_value]/message: defined 'message' as 'a2: a_value'\r\nNotice: lookup2: test value with hiera interpolation %{lookup(\"a\")}\r\nNotice: /Stage[main]/Main/Notify[lookup2: test value with hiera interpolation %{lookup(\"a\")}]/message: defined 'message' as 'lookup2: test value with hiera interpolation %{lookup(\"a\")}'\r\nNotice: hiera2: test value with hiera interpolation %{hiera(\"a\")}\r\nNotice: /Stage[main]/Main/Notify[hiera2: test value with hiera interpolation %{hiera(\"a\")}]/message: defined 'message' as 'hiera2: test value with hiera interpolation %{hiera(\"a\")}'\r\nNotice: lookup_hiera2: test value with hiera interpolation %{hiera(\"a\")}\r\nNotice: /Stage[main]/Main/Notify[lookup_hiera2: test value with hiera interpolation %{hiera(\"a\")}]/message: defined 'message' as 'lookup_hiera2: test value with hiera interpolation %{hiera(\"a\")}'\r\nNotice: hiera_lookup2: test value with hiera interpolation %{lookup(\"a\")}\r\nNotice: /Stage[main]/Main/Notify[hiera_lookup2: test value with hiera interpolation %{lookup(\"a\")}]/message: defined 'message' as 'hiera_lookup2: test value with hiera interpolation %{lookup(\"a\")}'\r\nNotice: Applied catalog in 0.02 seconds\r\n{code}\r\n\r\n","closed_at":"2017-04-13T00:21:05.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7359","labels":"docs_reviewed","state":"Closed","updated_at":"2017-04-13T00:21:05.000-0700","timestamp":1652285286.831423,"priority":"Normal","status_category":"Done","pull_request":5721},{"issue_id":"183700","title":"Lookups are logged as both lookup and APL when using log-level debug","url":"https://tickets.puppetlabs.com/browse/PUP-7420","created_at":"2017-04-02T03:31:08.000-0700","number":"PUP-7420","body":"When using log-level debug, a call to lookup will output the information from the lookup explainer.  This happens twice when the lookup originates from a call to the lookup function. The second time, the lookup appears to be an APL (Automatic Parameter Lookup).\r\n","closed_at":"2017-05-11T07:04:45.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7420","labels":"","state":"Closed","updated_at":"2017-05-11T07:04:45.000-0700","timestamp":1652285290.432998,"priority":"Normal","status_category":"Done","pull_request":5774},{"issue_id":"184369","title":"Fix inconsistent Regexp to String conversion in StringConverter","url":"https://tickets.puppetlabs.com/browse/PUP-7429","created_at":"2017-04-05T13:25:14.000-0700","number":"PUP-7429","body":"The StringConverter currently converts a Regexp to a string that starts and end with a slash by default. This is inconsistent with how a Regexp is created from a string. The constructor does not expect the slashes.\r\n\r\nThe default format (denoted by '%s') should produce a string without the slash delimiters. The alternate format (denoted with '%#s') should remain as is, and produce a string that is quoted.\r\n\r\nThe output with slash delimiters can be still be achieved (as before) using the '%p' format.\r\n\r\n","closed_at":"2017-05-11T07:04:46.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7429","labels":"","state":"Closed","updated_at":"2017-05-11T07:04:46.000-0700","timestamp":1652285290.749624,"priority":"Normal","status_category":"Done","pull_request":5783},{"issue_id":"183528","title":"Deep merge regression when a value of subkey is an alias or an hiera interpolation","url":"https://tickets.puppetlabs.com/browse/PUP-7418","created_at":"2017-03-31T12:21:11.000-0700","number":"PUP-7418","body":"Hi,\r\n\r\nHere is the function which provides default data of my {{test}} module:\r\n\r\n{code:puppet}\r\nfunction test::data (\r\n  Hash                  $options,\r\n  Puppet::LookupContext $context,\r\n) {\r\n\r\n  {\r\n    test::param => { 'a' => 'a', 'b' => 'b' },\r\n\r\n    lookup_options => {\r\n       test::param => { merge => 'deep', },\r\n    },\r\n\r\n  }\r\n\r\n}\r\n{code}\r\n\r\nHere is the my {{common.yaml}} file:\r\n\r\n{code:yaml}\r\n---\r\nfoo: '123456'\r\n{code}\r\n\r\nand here is my {{fqdn/$fqdn.yaml}} file:\r\n\r\n{code:yaml}\r\n---\r\ntest::param:\r\n  a: 'specific-a'\r\n  c: 'specific-c'\r\n{code}\r\n\r\nI'm using Hiera 5 with Puppet 4.9.4.\r\n\r\nWith this config, I have the expected behavior:\r\n\r\n{code:bash}\r\n~# puppet lookup 'test::param' \r\n---\r\na: specific-a\r\nb: b\r\nc: specific-c\r\n{code}\r\n\r\nNow I change my {{fqdn/$fqdn.yaml}} file to:\r\n\r\n{code:yaml}\r\n---\r\n# I insert an alias() interpolation in the value of the subkey \"c\".\r\ntest::param:\r\n  a: 'specific-a'\r\n  c: '%{alias(\"foo\")}'\r\n{code}\r\n\r\nAnd now the deep merge works no longer:\r\n\r\n{code:bash}\r\n~# puppet lookup 'test::param' \r\n---\r\na: specific-a\r\nc: '123456'\r\n{code}\r\n\r\nIt seems to be the result with the {{first}} merge policy, not {{deep}}.\r\n\r\n1. If I insert a {{hiera()}} interpolation, I have the same problem.\r\n2. I have tested with the eyaml backend _and_ the standard yaml_data backend, same problem.\r\n3. I'm sure it worked with puppet-agent 1.8.2 ie Puppet version 4.8.1 because it was the case in my production server.\r\n\r\nRegards.\r\n\r\n\r\n","closed_at":"2017-05-11T07:04:47.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7418","labels":"regression","state":"Closed","updated_at":"2017-05-11T07:04:47.000-0700","timestamp":1652285290.858861,"priority":"Critical","status_category":"Done","pull_request":5773},{"issue_id":"93953","title":"launchd enable/disable on OS X 10.10","url":"https://tickets.puppetlabs.com/browse/PUP-5044","created_at":"2015-08-17T16:43:19.000-0700","number":"PUP-5044","body":"Similar to PUP-4738, the proper overrides plist is not used on 10.10.  This prevents services from being properly enabled or disabled on 10.10.","closed_at":"2017-05-15T11:22:55.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5044","labels":"","state":"Closed","updated_at":"2017-05-15T11:22:55.000-0700","timestamp":1652285291.493091,"priority":"Critical","status_category":"Done","pull_request":4190},{"issue_id":"120880","title":"improve getting nested keys from hash","url":"https://tickets.puppetlabs.com/browse/PUP-6046","created_at":"2016-03-11T08:25:10.000-0800","number":"PUP-6046","body":"In a blog post, [~ripienaar] writes:\r\n{quote}\r\nThis \\[structured facts] makes everything better. It’s also structured data but this is still a bit awkward in Puppet:\r\n\r\n{code:puppet}\r\n$x = $facts[\"foo\"][\"bar\"][\"baz\"]\r\n{code}\r\n\r\nThere seems to be no elegant way to handle a missing ‘foo’ or ‘bar’ key, things just fail badly in ways you can’t catch or recover from. On the CLI you can do facter foo.bar.baz so we’re already careful to not have “.” in a key. \r\n{quote}\r\n\r\nWe can actually use multiple keys in an access operator (you can directly slice an array with two arguments (from, to). We could use this for hash as well to mean a progression of key lookups producing undef if one key produces undef.\r\n\r\nThe example would then be written:\r\n{quote:puppet}\r\n$x = $facts[foo, bar, baz]\r\n{quote}\r\nit would also allow getting a value from an array in by using a numeric key. Slicing can also be supported if the key is an array. Example, 'baz' is an array and we want the last 2 elements.\r\n{quote:puppet}\r\n$x = $facts[foo, bar, baz, [-2, 2]]\r\n{quote}\r\n\r\nUPDATE\r\n----\r\nThe original proposal would only work for hashes, as the access operator for array (and string) performs a slicing operation.\r\nA better solution is therefore to add a 'dig' function that performs a series of access operations and that stops with {{undef}} result if one access in the chain produces {{undef}}.\r\n\r\nTo complete the support for \"chain of operations\" the accompanying functions 'then' and 'lest' round out the functionality. \r\nThe PR for this ticket therefore contains the three functions 'dig', 'then' and 'lest'.\r\n\r\nThe *dig* function performs a sequence of access operations on a complex collection similar to the 'dot-notation' used in hiera and facter.\r\nFor example:\r\n{code:puppet}\r\n$some_data.dig(somekey, 1, otherkey)\r\n{code}\r\n\r\nIf, at any point, the intermediate result is {{undef}} the operation stops and returns {{undef}}. It is an error to attempt to access something in a value that is neither Array nor Hash.\r\n\r\nThe *then* function, accepts a single argument, and if it is not {{undef}} if calls a given block with the value. If given {{undef}} the block is not called and {{undef}} is returned.\r\n\r\nThe *lest* function is the reverse of *then*. If given {{undef}} it calls the given block (without arguments), and returns what the block produced. If given something that is not {{undef}} it returns that value.\r\n\r\nExample:\r\n{code:puppet}\r\n$some_structure.process()\r\n  .then |$x| { $x.process_some_more() }\r\n  .then |$x| { $x.process_further() }\r\n  .lest || { fail(\"processing of structure resulted in undef value\") }\r\n{code}\r\n\r\nOr if a default value is wanted - in the middle of the chain if {{undef}} was the temporary result:\r\n{code:puppet}\r\n$some_structure.process()\r\n  .then |$x| { $x. process_some_more() }\r\n  .lest || { 42 }\r\n  .then |$x| { $x.process_further() }\r\n{code}\r\n\r\nNaturally, for simple cases, a regular if/then/else expression or case expression is clearer - but for any chain of lookups, transformations, etc. where intermediate results are obtained and those can be {{undef}} the functional composition chain is a valuable tool as it results in more readable logic.\r\n\r\nIn practice, the 'dig' function can produce the entire chain of access operations unless something needs to be done to a value in the middle of the chain (such as using it to lookup in hiera) before continuing. These are the cases when 'then' and 'lest' come into play.\r\n","closed_at":"2017-05-15T15:11:53.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6046","labels":"DSL","state":"Closed","updated_at":"2017-05-15T15:11:53.000-0700","timestamp":1652285291.705628,"priority":"Normal","status_category":"Done","pull_request":4941},{"issue_id":"74750","title":"Resource collectors can be assigned to variables by abusing chaining statements","url":"https://tickets.puppetlabs.com/browse/PUP-4378","created_at":"2015-04-06T15:53:51.000-0700","number":"PUP-4378","body":"The 4x parser generally refuses to produce values from resource collectors, and errors if you put one where a value is expected. But since the value of a chaining statement is just the final term of the statement (regardless of arrow direction) and _they_ accept collectors as operands:\r\n\r\n{code}\r\nnotify {\"I go last.\":}\r\n$myweirdchain = (file {\"/tmp/thing\": ensure => file,} -> Notify <| |>)\r\nnotice( $myweirdchain )\r\n{code}\r\n\r\n{code}\r\nNotice: Scope(Class[main]): [#<Puppet::Pops::Evaluator::Collectors::CatalogCollector:0x007fe33da72c90>]\r\n{code}\r\n\r\nI don't really have anything to add, and probably no one will ever try to do that. But it does seem unintended. \r\n\r\nrisk: medium (manual validate only for now)\r\nprobability: low\r\nseverity: medium (confusion, possible abuse?)\r\ntest layer: unit (no unit tests added in PR. [~henrik.lindberg] can you comment on if you think this needs testing, and at what layer?)","closed_at":"2017-05-15T16:40:50.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4378","labels":"","state":"Closed","updated_at":"2017-05-15T16:40:50.000-0700","timestamp":1652285291.918012,"priority":"Minor","status_category":"Done","pull_request":3798},{"issue_id":"21407","title":"Support common package name in two different providers","url":"https://tickets.puppetlabs.com/browse/PUP-1073","created_at":"2013-12-16T10:51:34.000-0800","number":"PUP-1073","body":"I have a common package name, that's in two different package managers\r\n(one with yum the other with gem)\r\n\r\n{code}\r\n        package { \"remove-mysql\":\r\n                name     => \"mysql\",\r\n                provider => \"yum\",\r\n                ensure   => absent,\r\n        }\r\n{code}\r\n---------------------------------------------------------\r\n{code}\r\n        package { \"gem-mysql\":\r\n                name    => \"mysql\",\r\n                ensure   => \"2.7\",\r\n                provider => gem,\r\n        }\r\n{code}\r\n---------------------------------------------------------\r\n\r\nI get this error.\r\n\r\n{noformat}\r\nJul  3 08:43:34 puppetd[11872]: Could not retrieve catalog:\r\nPuppet::Parser::AST::Resource failed with error ArgumentError: Cannot\r\nalias Package[gem-mysql] to mysql; resource Package[mysql] already\r\nexists at /etc/puppet/modules/ruby-mysql/manifests/init.pp:11 on node \r\n{noformat}\r\n\r\n----\r\n\r\nThe solution to this was to generate a uniqueness key based on {{\\[name, provider\\]}}, as mentioned by [~andy]. That allows the example above to work, but doesn't resolve when multiple providers manage the same package. Several changes were needed:\r\n# Set {{paramclass(:provider).isnamevar}} on the Package type, so the {{:provider}} parameter is recognized as part of the namevar.\r\n# Overloaded the {{title_patterns}} method on the Package type, so the {{title}} could be parsed into namevars (it only sets {{:name}}, not {{:provider}}).\r\n# The {{catalog}} assumed that isomorphic resources only needed to be aliased if the {{title}} and {{name}} didn't match. An alias is automatically created for a resource's {{title}}; if {{titles}} don't match but the {{namevar}} does they should still refer to the same thing. However, {{name}} is not equivalent to {{namevar}} for a {{composite namevar}}, so the test for whether to create an alias uses the {{uniqueness_key}} (an array containing all {{namevars}}). The impact of this change is to correctly identify when a resource with a {{composite namevar}} has already been created, as in\r\n{code}\r\npackage { \"add-mysql\":\r\n  name   => \"mysql\",\r\n  ensure => present,\r\n}\r\n\r\npackage { \"mysql\":\r\n  ensure => present,\r\n}\r\n{code}\r\n# The change to {{catalog}} means that creating aliases now depends on the {{uniqueness_key}}. That implementation in {{resource}} type could end up returning an array without the name specified if the {{:name}} parameter wasn't specifically specified. This change was made so conflicts between implicit and explicit default provider are detected at catalog compilation instead of trying to apply the manifest.\r\n\r\nChanges (1) and (2) are required for any provider that uses a composite namevar.\r\n\r\nImpact of this change:\r\n* Querying resources by name on the command-line when multiple packages from different providers are specified only returns the package with the default provider (PUP-3721).\r\n* Referring to Package resources by {{Package[$namevar]}} in Puppet code doesn't work for a {{composite namevar}}, so it no longer works for Package. Querying by {{Package[$title]}} still works. This is a breaking change in Puppet 4.","closed_at":"2017-05-17T10:39:46.000-0700","comments":30,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1073","labels":"redmine","state":"Closed","updated_at":"2017-05-17T10:39:46.000-0700","timestamp":1652285292.138286,"priority":"Normal","status_category":"Done","pull_request":8425},{"issue_id":"92434","title":"Fix acceptance tests for ubuntu-1504","url":"https://tickets.puppetlabs.com/browse/PUP-5010","created_at":"2015-08-06T17:33:47.000-0700","number":"PUP-5010","body":"Running the acceptance test suite from a git installation of puppet stable at SHA 7b8372d624 on ubuntu-1504-x86_64.yaml results in failing tests.\r\n\r\nh3. Method of test execution\r\n{code}\r\ncd acceptance\r\nbundle install\r\nSHA='7b8372d624' CONFIG=config/nodes/ubuntu-1504-x86_64.yaml TESTS=tests  bundle exec rake ci:test:git\r\n{code}\r\n\r\nh3. Tests with errors or failures\r\n{code}\r\ntests/config/puppet_manages_own_configuration_in_robust_manner.rb errored in 22.92 seconds    # exits with 1 rather than 74\r\n\r\ntests/ensure_puppet-agent_paths.rb failed in 1.49 seconds    # fails due to non-aio environment\r\n\r\ntests/resource/service/ticket_14297_handle_upstart.rb errored in 3.04 seconds\r\n\r\ntests/modules/uninstall/using_directory_name.rb errored in 2.45 seconds     # PMT failure\r\ntests/modules/uninstall/using_version_filter.rb errored in 4.87 seconds     # PMT failure\r\ntests/modules/uninstall/with_module_installed.rb errored in 2.51 seconds     # PMT failure\r\ntests/modules/upgrade/in_a_secondary_directory.rb errored in 6.88 seconds     # PMT failure\r\ntests/modules/install/already_installed_elsewhere.rb failed in 10.49 seconds     # PMT failure\r\ntests/modules/list/with_circular_dependencies.rb failed in 2.46 seconds     # PMT failure\r\ntests/modules/list/with_invalid_dependencies.rb failed in 2.70 seconds     # PMT failure\r\ntests/modules/list/with_missing_dependencies.rb failed in 2.71 seconds     # PMT failure\r\ntests/modules/list/with_repeated_dependencies.rb failed in 3.95 seconds     # PMT failure\r\ntests/modules/uninstall/with_active_dependency.rb failed in 2.58 seconds     # PMT failure\r\n{code}\r\n\r\nh3. Common failures using ubuntu-1404-x86_64\r\nSuspecting that the environment rather than the code or tests may be the issue, I ran the same suite using the ubuntu-1404-x86_64 node configuration. The following tests resulted in errors or failures\r\n{code}\r\ntests/config/puppet_manages_own_configuration_in_robust_manner.rb\r\n\r\ntests/ensure_puppet-agent_paths.rb\r\n\r\ntests/modules/install/already_installed_elsewhere.rb\r\ntests/modules/list/with_circular_dependencies.rb\r\ntests/modules/list/with_invalid_dependencies.rb\r\ntests/modules/list/with_missing_dependencies.rb\r\ntests/modules/list/with_repeated_dependencies.rb\r\ntests/modules/uninstall/with_active_dependency.rb\r\ntests/modules/uninstall/using_directory_name.rb\r\ntests/modules/uninstall/using_version_filter.rb\r\ntests/modules/uninstall/with_module_installed.rb\r\ntests/modules/upgrade/in_a_secondary_directory.rb\r\n{code}","closed_at":"2017-05-17T16:13:12.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5010","labels":"","state":"Closed","updated_at":"2017-05-17T16:13:12.000-0700","timestamp":1652285295.784704,"priority":"Normal","status_category":"Done","pull_request":4142},{"issue_id":"92433","title":"Fix \"git\" acceptance tests","url":"https://tickets.puppetlabs.com/browse/PUP-5009","created_at":"2015-08-06T17:27:09.000-0700","number":"PUP-5009","body":"Running the acceptance test suite from a git installation of puppet stable at SHA 7b8372d624 on fedora-22-x86_64.yaml results in failing tests.\r\n\r\nh3. Method of test execution\r\n{code}\r\ncd acceptance\r\nbundle install\r\nSHA='7b8372d624' CONFIG=config/nodes/fedora-22-x86_64.yaml TESTS=tests  bundle exec rake ci:test:git\r\n{code}\r\n\r\nh3. Tests with errors or failures\r\n{code}\r\ntests/config/puppet_manages_own_configuration_in_robust_manner.rb errored in 22.68 seconds    # exits with 1 rather than 74\r\n\r\ntests/ensure_puppet-agent_paths.rb failed in 1.56 seconds    # fails due to non-aio environment\r\n\r\ntests/resource/package/common_package_name_in_different_providers.rb failed in 48.36 seconds   # PUP-4055\r\ntests/resource/package/yum.rb failed in 6.44 seconds  # PUP-4055\r\n\r\ntests/modules/uninstall/using_directory_name.rb errored in 2.50 seconds    # PMT Failure\r\ntests/modules/uninstall/using_version_filter.rb errored in 4.61 seconds    # PMT Failure\r\ntests/modules/uninstall/with_module_installed.rb errored in 2.55 seconds    # PMT Failure\r\ntests/modules/upgrade/in_a_secondary_directory.rb errored in 7.26 seconds    # PMT Failure\r\ntests/modules/install/already_installed_elsewhere.rb failed in 8.09 seconds    # PMT Failure\r\ntests/modules/list/with_circular_dependencies.rb failed in 2.46 seconds    # PMT Failure\r\ntests/modules/list/with_invalid_dependencies.rb failed in 2.59 seconds    # PMT Failure\r\ntests/modules/list/with_missing_dependencies.rb failed in 2.56 seconds    # PMT Failure\r\ntests/modules/list/with_repeated_dependencies.rb failed in 3.51 seconds    # PMT Failure\r\ntests/modules/uninstall/with_active_dependency.rb failed in 2.55 seconds    # PMT Failure\r\n{code}\r\n\r\nh3. Common failures using ubuntu-1404-x86_64\r\nSuspecting that the environment rather than the code or tests may be the issue, I ran the same suite using the ubuntu-1404-x86_64 node configuration. The following tests resulted in errors or failures\r\n{code}\r\ntests/config/puppet_manages_own_configuration_in_robust_manner.rb\r\n\r\ntests/ensure_puppet-agent_paths.rb\r\n\r\ntests/modules/install/already_installed_elsewhere.rb\r\ntests/modules/list/with_circular_dependencies.rb\r\ntests/modules/list/with_invalid_dependencies.rb\r\ntests/modules/list/with_missing_dependencies.rb\r\ntests/modules/list/with_repeated_dependencies.rb\r\ntests/modules/uninstall/with_active_dependency.rb\r\ntests/modules/uninstall/using_directory_name.rb\r\ntests/modules/uninstall/using_version_filter.rb\r\ntests/modules/uninstall/with_module_installed.rb\r\ntests/modules/upgrade/in_a_secondary_directory.rb\r\n{code}","closed_at":"2017-05-17T16:13:12.000-0700","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5009","labels":"","state":"Closed","updated_at":"2017-05-17T16:13:12.000-0700","timestamp":1652285295.889781,"priority":"Normal","status_category":"Done","pull_request":4143},{"issue_id":"51983","title":"Puppet prints warning when \"environment\" is set using classifier rather than local puppet.conf ","url":"https://tickets.puppetlabs.com/browse/PUP-3318","created_at":"2014-09-19T11:24:06.000-0700","number":"PUP-3318","body":"We set the environment in the external node classifier and don't have one set locally.\r\n\r\nPuppet seems to default to the 'production' environment in case you don't have one set and it turns into:\r\n\r\n{noformat}\r\nWarning: Local environment: \"production\" doesn't match server specified node environment \"devel\", switching agent to \"devel\".\r\n{noformat}\r\n\r\n\"devel\" is the environment currently set for this node.\r\nWe didn't specify \"production\" anywhere manually.\r\n\r\nI think that when a user DOESN'T specify any environment in the puppet.conf file but sets it in the classifier, this warning seems superfluous.\r\n\r\nThis is the local puppet.conf:\r\n{noformat}\r\n[main]\r\nlogdir=/var/log/puppet\r\nvardir=/var/lib/puppet\r\nssldir=/var/lib/puppet/ssl\r\nrundir=/var/run/puppet\r\n\r\nhttp_compression = true\r\n\r\n[agent]\r\n server = master.e.some.thing.com\r\n certname = srv-13.some.thing.com\r\n{noformat}","closed_at":"2017-05-17T16:13:12.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3318","labels":"","state":"Closed","updated_at":"2017-05-17T16:13:12.000-0700","timestamp":1652285295.993037,"priority":"Normal","status_category":"Done","pull_request":4177},{"issue_id":"16556","title":"bad permissions on autosign.conf blow up the master","url":"https://tickets.puppetlabs.com/browse/PUP-545","created_at":"2013-10-10T11:33:28.000-0700","number":"PUP-545","body":"If the ownership of autosign.conf doesn't allow the master to fix permissions, it blows up and returns a passenger HTML stack trace to the agent. And a DB migration??\r\n\r\n{code}\r\n# /var/log/messages:\r\nOct  4 18:02:17 classroom puppet-master[7204]: Could not prepare for execution: Got 2 failure(s) while initializing: failed to set mode 666 on /etc/puppetlabs/puppet/autosign.conf: Operation not permitted - /etc/puppetlabs/puppet/autosign.conf; change from 0666 to 0644 failed: failed to set mode 666 on /etc/puppetlabs/puppet/autosign.conf: Operation not permitted - /etc/puppetlabs/puppet/autosign.conf\r\n{code}\r\n\r\n{code}\r\n# /var/log/pe-httpd/error.log\r\n[ 2013-10-04 17:53:48.6164 4304/b62beb70 Pool2/Spawner.h:738 ]: [App 6070 stdout]\r\n[ 2013-10-04 17:53:50.3167 4304/b62beb70 Pool2/Implementation.cpp:777 ]: Could not spawn process for group /var/opt/lib/pe-puppetmaster#default: An error occured while starting up the preloader.\r\n     in 'void Passenger::ApplicationPool2::SmartSpawner::handleErrorResponse(Passenger::ApplicationPool2::SmartSpawner::StartupDetails&)' (SmartSpawner.h:455)\r\n     in 'std::string Passenger::ApplicationPool2::SmartSpawner::negotiatePreloaderStartup(Passenger::ApplicationPool2::SmartSpawner::StartupDetails&)' (SmartSpawner.h:558)\r\n     in 'void Passenger::ApplicationPool2::SmartSpawner::startPreloader()' (SmartSpawner.h:206)\r\n     in 'virtual Passenger::ApplicationPool2::ProcessPtr Passenger::ApplicationPool2::SmartSpawner::spawn(const Passenger::ApplicationPool2::Options&)' (SmartSpawner.h:744)\r\n     in 'void Passenger::ApplicationPool2::Group::spawnThreadRealMain(const Passenger::ApplicationPool2::SpawnerPtr&, const Passenger::ApplicationPool2::Options&, unsigned int)' (Implementation.cpp:710)\r\n\r\n[ 2013-10-04 17:53:50.3169 4304/b60ffb70 agents/HelperAgent/RequestHandler.h:1892 ]: [Client 20] Cannot checkout session. An error occured while starting up the preloader.\r\nError page:\r\nexit (SystemExit)\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:518:in `exit'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:518:in `rescue in exit_on_fail'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:504:in `exit_on_fail'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application.rb:362:in `run'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/command_line.rb:132:in `run'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/command_line.rb:86:in `execute'\r\n  config.ru:28:in `block in <main>'\r\n  /opt/puppet/lib/ruby/gems/1.9.1/gems/rack-1.4.5/lib/rack/builder.rb:51:in `instance_eval'\r\n  /opt/puppet/lib/ruby/gems/1.9.1/gems/rack-1.4.5/lib/rack/builder.rb:51:in `initialize'\r\n  config.ru:1:in `new'\r\n  config.ru:1:in `<main>'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:82:in `eval'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:82:in `preload_app'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:127:in `<module:App>'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:6:in `<module:PhusionPassenger>'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:5:in `<main>'\r\n\r\n[ 2013-10-04 17:53:51.0771 4304/b62beb70 Pool2/Spawner.h:738 ]: [App 6109 stdout]\r\n[ 2013-10-04 17:53:52.4259 4304/b62beb70 Pool2/Implementation.cpp:777 ]: Could not spawn process for group /var/opt/lib/pe-puppetmaster#default: An error occured while starting up the preloader.\r\n     in 'void Passenger::ApplicationPool2::SmartSpawner::handleErrorResponse(Passenger::ApplicationPool2::SmartSpawner::StartupDetails&)' (SmartSpawner.h:455)\r\n     in 'std::string Passenger::ApplicationPool2::SmartSpawner::negotiatePreloaderStartup(Passenger::ApplicationPool2::SmartSpawner::StartupDetails&)' (SmartSpawner.h:558)\r\n     in 'void Passenger::ApplicationPool2::SmartSpawner::startPreloader()' (SmartSpawner.h:206)\r\n     in 'virtual Passenger::ApplicationPool2::ProcessPtr Passenger::ApplicationPool2::SmartSpawner::spawn(const Passenger::ApplicationPool2::Options&)' (SmartSpawner.h:744)\r\n     in 'void Passenger::ApplicationPool2::Group::spawnThreadRealMain(const Passenger::ApplicationPool2::SpawnerPtr&, const Passenger::ApplicationPool2::Options&, unsigned int)' (Implementation.cpp:710)\r\n\r\n[ 2013-10-04 17:53:52.4260 4304/b60ffb70 agents/HelperAgent/RequestHandler.h:1892 ]: [Client 20] Cannot checkout session. An error occured while starting up the preloader.\r\nError page:\r\nexit (SystemExit)\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:518:in `exit'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:518:in `rescue in exit_on_fail'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:504:in `exit_on_fail'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application.rb:362:in `run'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/command_line.rb:132:in `run'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/command_line.rb:86:in `execute'\r\n  config.ru:28:in `block in <main>'\r\n  /opt/puppet/lib/ruby/gems/1.9.1/gems/rack-1.4.5/lib/rack/builder.rb:51:in `instance_eval'\r\n  /opt/puppet/lib/ruby/gems/1.9.1/gems/rack-1.4.5/lib/rack/builder.rb:51:in `initialize'\r\n  config.ru:1:in `new'\r\n  config.ru:1:in `<main>'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:82:in `eval'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:82:in `preload_app'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:127:in `<module:App>'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:6:in `<module:PhusionPassenger>'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:5:in `<main>'\r\n\r\n[ 2013-10-04 17:53:52.4335 4322/b22f8b70 apache2/Hooks.cpp:758 ]: Unexpected error in mod_passenger: write() failed: Broken pipe (errno=32)\r\n  Backtrace:\r\n     (empty)\r\n[ 2013-10-04 17:55:47.4024 4304/b62beb70 Pool2/Spawner.h:738 ]: [App 6208 stdout]\r\n[ 2013-10-04 17:55:48.6929 4304/b62beb70 Pool2/Implementation.cpp:777 ]: Could not spawn process for group /var/opt/lib/pe-puppetmaster#default: An error occured while starting up the preloader.\r\n     in 'void Passenger::ApplicationPool2::SmartSpawner::handleErrorResponse(Passenger::ApplicationPool2::SmartSpawner::StartupDetails&)' (SmartSpawner.h:455)\r\n     in 'std::string Passenger::ApplicationPool2::SmartSpawner::negotiatePreloaderStartup(Passenger::ApplicationPool2::SmartSpawner::StartupDetails&)' (SmartSpawner.h:558)\r\n     in 'void Passenger::ApplicationPool2::SmartSpawner::startPreloader()' (SmartSpawner.h:206)\r\n     in 'virtual Passenger::ApplicationPool2::ProcessPtr Passenger::ApplicationPool2::SmartSpawner::spawn(const Passenger::ApplicationPool2::Options&)' (SmartSpawner.h:744)\r\n     in 'void Passenger::ApplicationPool2::Group::spawnThreadRealMain(const Passenger::ApplicationPool2::SpawnerPtr&, const Passenger::ApplicationPool2::Options&, unsigned int)' (Implementation.cpp:710)\r\n\r\n[ 2013-10-04 17:55:48.6931 4304/b60ffb70 agents/HelperAgent/RequestHandler.h:1892 ]: [Client 20] Cannot checkout session. An error occured while starting up the preloader.\r\nError page:\r\nexit (SystemExit)\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:518:in `exit'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:518:in `rescue in exit_on_fail'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:504:in `exit_on_fail'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application.rb:362:in `run'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/command_line.rb:132:in `run'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/command_line.rb:86:in `execute'\r\n  config.ru:28:in `block in <main>'\r\n  /opt/puppet/lib/ruby/gems/1.9.1/gems/rack-1.4.5/lib/rack/builder.rb:51:in `instance_eval'\r\n  /opt/puppet/lib/ruby/gems/1.9.1/gems/rack-1.4.5/lib/rack/builder.rb:51:in `initialize'\r\n  config.ru:1:in `new'\r\n  config.ru:1:in `<main>'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:82:in `eval'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:82:in `preload_app'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:127:in `<module:App>'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:6:in `<module:PhusionPassenger>'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:5:in `<main>'\r\n\r\n[ 2013-10-04 17:55:49.1003 4304/b62beb70 Pool2/Spawner.h:738 ]: [App 6232 stdout]\r\n[ 2013-10-04 17:55:50.3623 4304/b62beb70 Pool2/Implementation.cpp:777 ]: Could not spawn process for group /var/opt/lib/pe-puppetmaster#default: An error occured while starting up the preloader.\r\n     in 'void Passenger::ApplicationPool2::SmartSpawner::handleErrorResponse(Passenger::ApplicationPool2::SmartSpawner::StartupDetails&)' (SmartSpawner.h:455)\r\n     in 'std::string Passenger::ApplicationPool2::SmartSpawner::negotiatePreloaderStartup(Passenger::ApplicationPool2::SmartSpawner::StartupDetails&)' (SmartSpawner.h:558)\r\n     in 'void Passenger::ApplicationPool2::SmartSpawner::startPreloader()' (SmartSpawner.h:206)\r\n     in 'virtual Passenger::ApplicationPool2::ProcessPtr Passenger::ApplicationPool2::SmartSpawner::spawn(const Passenger::ApplicationPool2::Options&)' (SmartSpawner.h:744)\r\n     in 'void Passenger::ApplicationPool2::Group::spawnThreadRealMain(const Passenger::ApplicationPool2::SpawnerPtr&, const Passenger::ApplicationPool2::Options&, unsigned int)' (Implementation.cpp:710)\r\n\r\n[ 2013-10-04 17:55:50.3625 4304/b60ffb70 agents/HelperAgent/RequestHandler.h:1892 ]: [Client 20] Cannot checkout session. An error occured while starting up the preloader.\r\nError page:\r\nexit (SystemExit)\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:518:in `exit'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:518:in `rescue in exit_on_fail'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:504:in `exit_on_fail'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application.rb:362:in `run'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/command_line.rb:132:in `run'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/command_line.rb:86:in `execute'\r\n  config.ru:28:in `block in <main>'\r\n  /opt/puppet/lib/ruby/gems/1.9.1/gems/rack-1.4.5/lib/rack/builder.rb:51:in `instance_eval'\r\n  /opt/puppet/lib/ruby/gems/1.9.1/gems/rack-1.4.5/lib/rack/builder.rb:51:in `initialize'\r\n  config.ru:1:in `new'\r\n  config.ru:1:in `<main>'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:82:in `eval'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:82:in `preload_app'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:127:in `<module:App>'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:6:in `<module:PhusionPassenger>'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:5:in `<main>'\r\n\r\n[ 2013-10-04 17:55:50.5541 4304/b62beb70 Pool2/Spawner.h:738 ]: [App 6255 stdout]\r\n[ 2013-10-04 17:55:51.8690 4304/b62beb70 Pool2/Implementation.cpp:777 ]: Could not spawn process for group /var/opt/lib/pe-puppetmaster#default: An error occured while starting up the preloader.\r\n     in 'void Passenger::ApplicationPool2::SmartSpawner::handleErrorResponse(Passenger::ApplicationPool2::SmartSpawner::StartupDetails&)' (SmartSpawner.h:455)\r\n     in 'std::string Passenger::ApplicationPool2::SmartSpawner::negotiatePreloaderStartup(Passenger::ApplicationPool2::SmartSpawner::StartupDetails&)' (SmartSpawner.h:558)\r\n     in 'void Passenger::ApplicationPool2::SmartSpawner::startPreloader()' (SmartSpawner.h:206)\r\n     in 'virtual Passenger::ApplicationPool2::ProcessPtr Passenger::ApplicationPool2::SmartSpawner::spawn(const Passenger::ApplicationPool2::Options&)' (SmartSpawner.h:744)\r\n     in 'void Passenger::ApplicationPool2::Group::spawnThreadRealMain(const Passenger::ApplicationPool2::SpawnerPtr&, const Passenger::ApplicationPool2::Options&, unsigned int)' (Implementation.cpp:710)\r\n\r\n[ 2013-10-04 17:55:51.8693 4304/b60ffb70 agents/HelperAgent/RequestHandler.h:1892 ]: [Client 20] Cannot checkout session. An error occured while starting up the preloader.\r\nError page:\r\nexit (SystemExit)\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:518:in `exit'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:518:in `rescue in exit_on_fail'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:504:in `exit_on_fail'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application.rb:362:in `run'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/command_line.rb:132:in `run'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/command_line.rb:86:in `execute'\r\n  config.ru:28:in `block in <main>'\r\n  /opt/puppet/lib/ruby/gems/1.9.1/gems/rack-1.4.5/lib/rack/builder.rb:51:in `instance_eval'\r\n  /opt/puppet/lib/ruby/gems/1.9.1/gems/rack-1.4.5/lib/rack/builder.rb:51:in `initialize'\r\n  config.ru:1:in `new'\r\n  config.ru:1:in `<main>'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:82:in `eval'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:82:in `preload_app'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:127:in `<module:App>'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:6:in `<module:PhusionPassenger>'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:5:in `<main>'\r\n\r\n[ 2013-10-04 17:55:53.0011 4304/b62beb70 Pool2/Spawner.h:738 ]: [App 6457 stdout]\r\n[ 2013-10-04 17:55:54.3904 4304/b62beb70 Pool2/Implementation.cpp:777 ]: Could not spawn process for group /var/opt/lib/pe-puppetmaster#default: An error occured while starting up the preloader.\r\n     in 'void Passenger::ApplicationPool2::SmartSpawner::handleErrorResponse(Passenger::ApplicationPool2::SmartSpawner::StartupDetails&)' (SmartSpawner.h:455)\r\n     in 'std::string Passenger::ApplicationPool2::SmartSpawner::negotiatePreloaderStartup(Passenger::ApplicationPool2::SmartSpawner::StartupDetails&)' (SmartSpawner.h:558)\r\n     in 'void Passenger::ApplicationPool2::SmartSpawner::startPreloader()' (SmartSpawner.h:206)\r\n     in 'virtual Passenger::ApplicationPool2::ProcessPtr Passenger::ApplicationPool2::SmartSpawner::spawn(const Passenger::ApplicationPool2::Options&)' (SmartSpawner.h:744)\r\n     in 'void Passenger::ApplicationPool2::Group::spawnThreadRealMain(const Passenger::ApplicationPool2::SpawnerPtr&, const Passenger::ApplicationPool2::Options&, unsigned int)' (Implementation.cpp:710)\r\n\r\n[ 2013-10-04 17:55:54.3906 4304/b60ffb70 agents/HelperAgent/RequestHandler.h:1892 ]: [Client 20] Cannot checkout session. An error occured while starting up the preloader.\r\nError page:\r\nexit (SystemExit)\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:518:in `exit'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:518:in `rescue in exit_on_fail'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:504:in `exit_on_fail'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application.rb:362:in `run'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/command_line.rb:132:in `run'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/command_line.rb:86:in `execute'\r\n  config.ru:28:in `block in <main>'\r\n  /opt/puppet/lib/ruby/gems/1.9.1/gems/rack-1.4.5/lib/rack/builder.rb:51:in `instance_eval'\r\n  /opt/puppet/lib/ruby/gems/1.9.1/gems/rack-1.4.5/lib/rack/builder.rb:51:in `initialize'\r\n  config.ru:1:in `new'\r\n  config.ru:1:in `<main>'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:82:in `eval'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:82:in `preload_app'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:127:in `<module:App>'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:6:in `<module:PhusionPassenger>'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:5:in `<main>'\r\n\r\n[ 2013-10-04 17:55:54.7162 4304/b62beb70 Pool2/Spawner.h:738 ]: [App 6480 stdout]\r\n[ 2013-10-04 17:55:56.1644 4304/b62beb70 Pool2/Implementation.cpp:777 ]: Could not spawn process for group /var/opt/lib/pe-puppetmaster#default: An error occured while starting up the preloader.\r\n     in 'void Passenger::ApplicationPool2::SmartSpawner::handleErrorResponse(Passenger::ApplicationPool2::SmartSpawner::StartupDetails&)' (SmartSpawner.h:455)\r\n     in 'std::string Passenger::ApplicationPool2::SmartSpawner::negotiatePreloaderStartup(Passenger::ApplicationPool2::SmartSpawner::StartupDetails&)' (SmartSpawner.h:558)\r\n     in 'void Passenger::ApplicationPool2::SmartSpawner::startPreloader()' (SmartSpawner.h:206)\r\n     in 'virtual Passenger::ApplicationPool2::ProcessPtr Passenger::ApplicationPool2::SmartSpawner::spawn(const Passenger::ApplicationPool2::Options&)' (SmartSpawner.h:744)\r\n     in 'void Passenger::ApplicationPool2::Group::spawnThreadRealMain(const Passenger::ApplicationPool2::SpawnerPtr&, const Passenger::ApplicationPool2::Options&, unsigned int)' (Implementation.cpp:710)\r\n\r\n[ 2013-10-04 17:55:56.1646 4304/b60ffb70 agents/HelperAgent/RequestHandler.h:1892 ]: [Client 20] Cannot checkout session. An error occured while starting up the preloader.\r\nError page:\r\nexit (SystemExit)\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:518:in `exit'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:518:in `rescue in exit_on_fail'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:504:in `exit_on_fail'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application.rb:362:in `run'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/command_line.rb:132:in `run'\r\n  /opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/command_line.rb:86:in `execute'\r\n  config.ru:28:in `block in <main>'\r\n  /opt/puppet/lib/ruby/gems/1.9.1/gems/rack-1.4.5/lib/rack/builder.rb:51:in `instance_eval'\r\n  /opt/puppet/lib/ruby/gems/1.9.1/gems/rack-1.4.5/lib/rack/builder.rb:51:in `initialize'\r\n  config.ru:1:in `new'\r\n  config.ru:1:in `<main>'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:82:in `eval'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:82:in `preload_app'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:127:in `<module:App>'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:6:in `<module:PhusionPassenger>'\r\n  /opt/puppet/share/phusion_passenger/helper-scripts/rack-preloader.rb:5:in `<main>'\r\n\r\n[ 2013-10-04 17:55:56.1662 4323/b0ef6b70 apache2/Hooks.cpp:758 ]: Unexpected error in mod_passenger: write() failed: Broken pipe (errno=32)\r\n  Backtrace:\r\n     (empty)\r\n[ 2013-10-04 17:56:31.4204 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]\r\n[ 2013-10-04 17:56:32.9585 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]\r\n[ 2013-10-04 17:56:32.9586 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] >>> Redirecting RubyCAS-Server log to /var/log/pe-console-auth/cas.log\r\n[ 2013-10-04 17:56:32.9586 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]\r\n[ 2013-10-04 17:56:33.0011 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]\r\n[ 2013-10-04 17:56:33.0012 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] >>> Running migrations to make sure your database schema is up to date...\r\n[ 2013-10-04 17:56:33.0012 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]\r\n[ 2013-10-04 17:56:33.0614 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (1.0ms)  SELECT \"schema_migrations\".\"version\" FROM \"schema_migrations\"\r\n[ 2013-10-04 17:56:33.0615 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] Migrating to CreateInitialStructure (1)\r\n[ 2013-10-04 17:56:33.0621 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (0.2ms)  BEGIN\r\n[ 2013-10-04 17:56:33.0691 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] ==  CreateInitialStructure: migrating =========================================\r\n[ 2013-10-04 17:56:33.0692 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] -- create_table(\"casserver_lt\", {:force=>true})\r\n[ 2013-10-04 17:56:33.0712 4304/b6413b70 Pool2/Spawner.h:159 ]: [App 6528 stderr] NOTICE:  CREATE TABLE will create implicit sequence \"casserver_lt_id_seq\" for serial column \"casserver_lt.id\"\r\n[ 2013-10-04 17:56:33.0977 4304/b6413b70 Pool2/Spawner.h:159 ]: [App 6528 stderr] NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index \"casserver_lt_pkey\" for table \"casserver_lt\"\r\n[ 2013-10-04 17:56:33.1040 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (32.7ms)  CREATE TABLE \"casserver_lt\" (\"id\" serial primary key, \"ticket\" character varying(255) NOT NULL, \"created_on\" timestamp NOT NULL, \"consumed\" timestamp, \"client_hostname\" character varying(255) NOT NULL)\r\n[ 2013-10-04 17:56:33.1041 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    -> 0.0341s\r\n[ 2013-10-04 17:56:33.1041 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] -- create_table(\"casserver_st\", {:force=>true})\r\n[ 2013-10-04 17:56:33.1050 4304/b6413b70 Pool2/Spawner.h:159 ]: [App 6528 stderr] NOTICE:  CREATE TABLE will create implicit sequence \"casserver_st_id_seq\" for serial column \"casserver_st.id\"\r\n[ 2013-10-04 17:56:33.1090 4304/b6413b70 Pool2/Spawner.h:159 ]: [App 6528 stderr] NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index \"casserver_st_pkey\" for table \"casserver_st\"\r\n[ 2013-10-04 17:56:33.1121 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (6.1ms)  CREATE TABLE \"casserver_st\" (\"id\" serial primary key, \"ticket\" character varying(255) NOT NULL, \"service\" text NOT NULL, \"created_on\" timestamp NOT NULL, \"consumed\" timestamp, \"client_hostname\" character varying(255) NOT NULL, \"username\" character varying(255) NOT NULL, \"type\" character varying(255) NOT NULL, \"granted_by_pgt_id\" integer, \"granted_by_tgt_id\" integer)\r\n[ 2013-10-04 17:56:33.1122 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    -> 0.0077s\r\n[ 2013-10-04 17:56:33.1122 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] -- create_table(\"casserver_tgt\", {:force=>true})\r\n[ 2013-10-04 17:56:33.1134 4304/b6413b70 Pool2/Spawner.h:159 ]: [App 6528 stderr] NOTICE:  CREATE TABLE will create implicit sequence \"casserver_tgt_id_seq\" for serial column \"casserver_tgt.id\"\r\n[ 2013-10-04 17:56:33.1178 4304/b6413b70 Pool2/Spawner.h:159 ]: [App 6528 stderr] NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index \"casserver_tgt_pkey\" for table \"casserver_tgt\"\r\n[ 2013-10-04 17:56:33.1200 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (6.0ms)  CREATE TABLE \"casserver_tgt\" (\"id\" serial primary key, \"ticket\" character varying(255) NOT NULL, \"created_on\" timestamp NOT NULL, \"client_hostname\" character varying(255) NOT NULL, \"username\" character varying(255) NOT NULL, \"extra_attributes\" text)\r\n[ 2013-10-04 17:56:33.1200 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    -> 0.0081s\r\n[ 2013-10-04 17:56:33.1201 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] -- create_table(\"casserver_pgt\", {:force=>true})\r\n[ 2013-10-04 17:56:33.1210 4304/b6413b70 Pool2/Spawner.h:159 ]: [App 6528 stderr] NOTICE:  CREATE TABLE will create implicit sequence \"casserver_pgt_id_seq\" for serial column \"casserver_pgt.id\"\r\n[ 2013-10-04 17:56:33.1269 4304/b6413b70 Pool2/Spawner.h:159 ]: [App 6528 stderr] NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index \"casserver_pgt_pkey\" for table \"casserver_pgt\"\r\n[ 2013-10-04 17:56:33.1292 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (7.6ms)  CREATE TABLE \"casserver_pgt\" (\"id\" serial primary key, \"ticket\" character varying(255) NOT NULL, \"created_on\" timestamp NOT NULL, \"client_hostname\" character varying(255) NOT NULL, \"iou\" character varying(255) NOT NULL, \"service_ticket_id\" integer NOT NULL)\r\n[ 2013-10-04 17:56:33.1292 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    -> 0.0092s\r\n[ 2013-10-04 17:56:33.1292 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] ==  CreateInitialStructure: migrated (0.0595s) ================================\r\n[ 2013-10-04 17:56:33.1292 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]\r\n[ 2013-10-04 17:56:33.1320 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (1.6ms)  INSERT INTO \"schema_migrations\" (\"version\") VALUES ('1')\r\n[ 2013-10-04 17:56:33.1370 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (4.8ms)  COMMIT\r\n[ 2013-10-04 17:56:33.1371 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] Migrating to TrackAuthenticatorInTgt (2)\r\n[ 2013-10-04 17:56:33.1378 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (0.3ms)  BEGIN\r\n[ 2013-10-04 17:56:33.1388 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] ==  TrackAuthenticatorInTgt: migrating ========================================\r\n[ 2013-10-04 17:56:33.1388 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] -- add_column(\"casserver_tgt\", \"authenticator\", :string, {:limit=>64, :null=>false, :default=>\"\"})\r\n[ 2013-10-04 17:56:33.1533 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (13.9ms)  ALTER TABLE \"casserver_tgt\" ADD COLUMN \"authenticator\" character varying(64) DEFAULT '' NOT NULL\r\n[ 2013-10-04 17:56:33.1533 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    -> 0.0144s\r\n[ 2013-10-04 17:56:33.1533 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] ==  TrackAuthenticatorInTgt: migrated (0.0145s) ===============================\r\n[ 2013-10-04 17:56:33.1533 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]\r\n[ 2013-10-04 17:56:33.1542 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (0.1ms)  INSERT INTO \"schema_migrations\" (\"version\") VALUES ('2')\r\n[ 2013-10-04 17:56:33.1575 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (3.0ms)  COMMIT\r\n[ 2013-10-04 17:56:33.1576 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] Migrating to SetDefaultAuthenticatorInTgt (3)\r\n[ 2013-10-04 17:56:33.1586 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (0.2ms)  BEGIN\r\n[ 2013-10-04 17:56:33.1590 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] ==  SetDefaultAuthenticatorInTgt: migrating ===================================\r\n[ 2013-10-04 17:56:33.1592 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] -- change_column(\"casserver_tgt\", \"authenticator\", :string, {:limit=>64, :null=>false, :default=>\"CASServer::Authenticators::SQLEncrypted\"})\r\n[ 2013-10-04 17:56:33.1600 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (0.5ms)  ALTER TABLE \"casserver_tgt\" ALTER COLUMN \"authenticator\" TYPE character varying(64)\r\n[ 2013-10-04 17:56:33.1604 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (0.2ms)  ALTER TABLE \"casserver_tgt\" ALTER COLUMN \"authenticator\" SET DEFAULT 'CASServer::Authenticators::SQLEncrypted'\r\n[ 2013-10-04 17:56:33.1609 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (0.3ms)  UPDATE \"casserver_tgt\" SET \"authenticator\"='CASServer::Authenticators::SQLEncrypted' WHERE \"authenticator\" IS NULL\r\n[ 2013-10-04 17:56:33.1611 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (0.1ms)  ALTER TABLE \"casserver_tgt\" ALTER \"authenticator\" SET NOT NULL\r\n[ 2013-10-04 17:56:33.1612 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    -> 0.0019s\r\n[ 2013-10-04 17:56:33.1613 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] -- execute(\"UPDATE \\\"casserver_tgt\\\" SET \\\"authenticator\\\" =  'CASServer::Authenticators::SQLEncrypted' WHERE \\\"authenticator\\\" = '';\")\r\n[ 2013-10-04 17:56:33.1628 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (1.1ms)  UPDATE \"casserver_tgt\" SET \"authenticator\" = 'CASServer::Authenticators::SQLEncrypted' WHERE \"authenticator\" = '';\r\n[ 2013-10-04 17:56:33.1629 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    -> 0.0012s\r\n[ 2013-10-04 17:56:33.1629 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] ==  SetDefaultAuthenticatorInTgt: migrated (0.0034s) ==========================\r\n[ 2013-10-04 17:56:33.1629 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]\r\n[ 2013-10-04 17:56:33.1635 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (0.1ms)  INSERT INTO \"schema_migrations\" (\"version\") VALUES ('3')\r\n[ 2013-10-04 17:56:33.1642 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (0.4ms)  COMMIT\r\n[ 2013-10-04 17:56:33.1642 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] Migrating to AddIndexesForPerformance (4)\r\n[ 2013-10-04 17:56:33.1643 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (0.1ms)  BEGIN\r\n[ 2013-10-04 17:56:33.1655 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] ==  AddIndexesForPerformance: migrating =======================================\r\n[ 2013-10-04 17:56:33.1656 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] -- add_index(:casserver_lt, :ticket)\r\n[ 2013-10-04 17:56:33.1718 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (2.4ms)  CREATE INDEX \"index_casserver_lt_on_ticket\" ON \"casserver_lt\" (\"ticket\")\r\n[ 2013-10-04 17:56:33.1718 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    -> 0.0059s\r\n[ 2013-10-04 17:56:33.1718 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] -- add_index(:casserver_st, :ticket)\r\n[ 2013-10-04 17:56:33.1747 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (1.7ms)  CREATE INDEX \"index_casserver_st_on_ticket\" ON \"casserver_st\" (\"ticket\")\r\n[ 2013-10-04 17:56:33.1748 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    -> 0.0029s\r\n[ 2013-10-04 17:56:33.1748 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] -- add_index(:casserver_tgt, :ticket)\r\n[ 2013-10-04 17:56:33.1779 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (1.8ms)  CREATE INDEX \"index_casserver_tgt_on_ticket\" ON \"casserver_tgt\" (\"ticket\")\r\n[ 2013-10-04 17:56:33.1779 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    -> 0.0031s\r\n[ 2013-10-04 17:56:33.1779 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] -- add_index(:casserver_pgt, :ticket)\r\n[ 2013-10-04 17:56:33.1815 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (2.0ms)  CREATE INDEX \"index_casserver_pgt_on_ticket\" ON \"casserver_pgt\" (\"ticket\")\r\n[ 2013-10-04 17:56:33.1816 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    -> 0.0035s\r\n[ 2013-10-04 17:56:33.1816 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] ==  AddIndexesForPerformance: migrated (0.0157s) ==============================\r\n[ 2013-10-04 17:56:33.1816 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]\r\n[ 2013-10-04 17:56:33.1823 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (0.1ms)  INSERT INTO \"schema_migrations\" (\"version\") VALUES ('4')\r\n[ 2013-10-04 17:56:33.1851 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]    (0.6ms)  COMMIT\r\n[ 2013-10-04 17:56:33.1851 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]\r\n[ 2013-10-04 17:56:33.1851 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout] >>> Your database is now up to date.\r\n[ 2013-10-04 17:56:33.1851 4304/b62ffb70 Pool2/Spawner.h:738 ]: [App 6528 stdout]\r\n[ 2013-10-04 17:56:33.2737 4304/b62ffb70 Pool2/SmartSpawner.h:301 ]: Preloader for /opt/puppet/share/puppet-dashboard/public/../../rubycas-server started on PID 6528, listening on unix:/tmp/passenger.1.0.4289/generation-0/backends/preloader.6528\r\n{code}","closed_at":"2017-05-17T16:13:13.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-545","labels":"","state":"Closed","updated_at":"2017-05-17T16:13:13.000-0700","timestamp":1652285296.199218,"priority":"Normal","status_category":"Done","pull_request":4385},{"issue_id":"15343","title":"Puppet does not accurately capture exit codes from exec resources on Windows","url":"https://tickets.puppetlabs.com/browse/PUP-434","created_at":"2013-09-26T19:28:38.000-0700","number":"PUP-434","body":"The exit code from a windows program is not returned correctly to due to a ruby bug which can be seen here:\r\n\r\nhttps://bugs.ruby-lang.org/issues/8083\r\n\r\nSo, the exitcode that is returned follows the formula: exitcode % 256 \r\n\r\n   exitcode = 255 and puppet returns 255\r\n   exitcode = 256 and puppet returns 0\r\n   exitcode =257 and puppet returns 1\r\n   ...\r\n\r\nThe issue can be reproduced by making a bat file that contains just the following `exit %1` and using the following puppet code:\r\n\r\n    exec { 'testBat':\r\n      command => 'c:\\Windows\\System32\\cmd.exe /c c:\\users\\nick\\documents\\test.bat 257',\r\n      logoutput => true,\r\n      returns => [0,2000,3010],\r\n    }\r\n\r\n[~josh] helped track down some of the issue and said the following.\r\n\r\n\"we actually go through the trouble of capturing the exit code, but due some craziness we end up returning the exit status from ruby's CHILD_STATUS, we could fix the windows exec provider to not do that. Please file a ticket, so we can track this.\r\nhttps://github.com/puppetlabs/puppet/blob/master/lib/puppet/util/windows/process.rb#L22-L24\r\nis where we capture the real 32-bit value, but then we end up returning\r\nhttps://github.com/puppetlabs/puppet/blob/master/lib/puppet/util/suidmanager.rb#L195\r\nas the exit code\r\nso due to the ruby bug, the value is truncated\"","closed_at":"2017-05-17T16:13:14.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-434","labels":"customer;support","state":"Closed","updated_at":"2017-05-17T16:13:14.000-0700","timestamp":1652285296.521936,"priority":"Normal","status_category":"Done","pull_request":3917},{"issue_id":"23085","title":"cron type and provider only return resources for ENV[\"USER\"] or \"root\", not all users","url":"https://tickets.puppetlabs.com/browse/PUP-1381","created_at":"2014-01-06T18:15:59.000-0800","number":"PUP-1381","body":"*NOTE*: This ticket now only tracks the adding of a warning about the upcoming fix. There will be a separate ticket to track the fix itself.\r\n\r\nOriginal report below.\r\n----\r\n\r\nWhen using \r\n\r\n{code}resources { cron: purge => true }{code} \r\n\r\nonly the root users crontab is purged. This works:\r\n{code}\r\ncron {\"foo\":\r\n        command => \"ls\",\r\n        ensure => present,\r\n        user => root,\r\n}\r\n{code}\r\n\r\n(and then proceed to comment the above out):\r\n{code}\r\nnotice: /Cron[foo]/ensure: removed\r\n{code}\r\n\r\nThis does not work:\r\n{code}\r\ncron {\"bar\":\r\n        command => \"ls\",\r\n        ensure => present,\r\n        user => nick,\r\n}\r\n{code}\r\n\r\nThis crontab will still exist if commented out.\r\n\r\nBroken in 2.6 and latest stable.","closed_at":"2017-05-17T16:13:14.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1381","labels":"redmine","state":"Closed","updated_at":"2017-05-17T16:13:14.000-0700","timestamp":1652285296.625644,"priority":"Normal","status_category":"Done","pull_request":2492},{"issue_id":"25484","title":"Cron endlessly makes futile attempts to create empty crontab entries","url":"https://tickets.puppetlabs.com/browse/PUP-1587","created_at":"2014-02-05T00:37:28.000-0800","number":"PUP-1587","body":"When applying this manifest {code} puppet apply -e 'cron { \"simple\": minute => \"5\"; \"complex\": minute => 0, hour => 3, command => \"/bin/huge-script\" }' {code} puppet fails to write the crontab because the \"simple\" task is invalid due to the lack of a command. The incomplete resource should fail gracefully and allow puppt to write a partial crontab to the system.","closed_at":"2017-05-17T16:13:15.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1587","labels":"","state":"Closed","updated_at":"2017-05-17T16:13:15.000-0700","timestamp":1652285296.729635,"priority":"Normal","status_category":"Done","pull_request":2331},{"issue_id":"25468","title":"PR (2331) Cron Type sanity check for the command parameter is broken","url":"https://tickets.puppetlabs.com/browse/PUP-1586","created_at":"2014-02-04T16:49:06.000-0800","number":"PUP-1586","body":"When there is a crontab like this\r\n\r\n{code}\r\n2 4 * * * /sbin/foobar\r\n# Puppet Name: hourlytask\r\n7 * * * * /usr/local/bin/kick-idlers\r\n{code}\r\nand I apply this manifest:\r\n{code}\r\ncron { \"hourlytask\": minute => 4 }\r\n{code}\r\npuppet should change the minute field of the 'hourlytask' to 4 and do nothing else.\r\n\r\nInstead, it fails to identify the existing job and tries to create a new one:\r\n{code}\r\nRUBYLIB=lib puppet apply -e'cron { \"hourlytask\": minute => 4 }' \r\n\r\nNotice: Compiled catalog for geras.localdomain in environment production in 0.13 seconds\r\nError: Could not prefetch cron provider 'crontab': No command, somehow at line 1\r\nNotice: /Stage[main]/Main/Cron[hourlytask]/ensure: created\r\n{code}","closed_at":"2017-05-17T16:13:15.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1586","labels":"type_cron","state":"Closed","updated_at":"2017-05-17T16:13:15.000-0700","timestamp":1652285297.043068,"priority":"Normal","status_category":"Done","pull_request":2327},{"issue_id":"21377","title":"puppet apply loading facts twice","url":"https://tickets.puppetlabs.com/browse/PUP-1058","created_at":"2013-12-16T07:52:10.000-0800","number":"PUP-1058","body":"given the site.pp with:\r\n\r\n{code}\r\nnode default {\r\n  notice(\"Busy compiling catalog\")\r\n}\r\n{code}\r\n\r\nand a module dir setup like:\r\n\r\n{code}\r\n% mkdir modules\r\n% puppet module install ripienaar-concat --modulepath=`pwd`/modules\r\n{code}\r\n\r\nI have no config so its all defaults:\r\n\r\n{code}\r\n% puppet apply --configprint config\r\n/home/rip/.puppet/puppet.conf\r\n% cat /home/rip/.puppet/puppet.conf\r\ncat: /home/rip/.puppet/puppet.conf: No such file or directory\r\n{code}\r\n\r\nRunning puppet 3.0.0rc7 will load facts twice:\r\n\r\n{code}\r\n% puppet apply --modulepath=`pwd`/modules `pwd`/site.pp --verbose\r\nInfo: Loading facts in /home/rip/temp/modules/concat/lib/facter/concat_basedir.rb\r\nScope(Node[dev1.devco.net]): Compiling catalog\r\nInfo: Loading facts in /home/rip/temp/modules/concat/lib/facter/concat_basedir.rb\r\nInfo: Applying configuration version '1348574505'\r\nFinished catalog run in 0.17 seconds\r\n{code}\r\n\r\nBut puppet 2.7.17 with the same code does:\r\n\r\n{code}\r\ninfo: Loading facts in /home/rip/temp/modules/concat/lib/facter/concat_basedir.rb\r\nnotice: Scope(Node[default]): Compiling catalog\r\ninfo: Applying configuration version '1348574599'\r\ninfo: Creating state file /home/rip/.puppet/var/state/state.yaml\r\nnotice: Finished catalog run in 0.05 seconds\r\n{code}\r\n","closed_at":"2017-05-17T16:13:16.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1058","labels":"redmine","state":"Closed","updated_at":"2017-05-17T16:13:16.000-0700","timestamp":1652285297.250054,"priority":"Normal","status_category":"Done","pull_request":8325},{"issue_id":"16607","title":"(#22847): Windows Puppet::Util::ADSI::User and Puppet::Util::ADSI::Group issues WMI queries that hang Puppet in a domain environment","url":"https://tickets.puppetlabs.com/browse/PUP-555","created_at":"2013-10-11T12:18:30.000-0700","number":"PUP-555","body":null,"closed_at":"2017-05-17T16:13:17.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-555","labels":"","state":"Resolved","updated_at":"2017-05-17T16:13:17.000-0700","timestamp":1652285304.159766,"priority":"Normal","status_category":"Done","pull_request":4504},{"issue_id":"121201","title":"error running puppet with non existing and non default environment ","url":"https://tickets.puppetlabs.com/browse/PUP-6048","created_at":"2016-03-13T03:26:34.000-0700","number":"PUP-6048","body":"Running:\r\n\r\n{noformat}\r\npuppet facts --environment=test\r\n{noformat}\r\n\r\nthrows the following error if the environment directory don't exists:\r\n\r\n{noformat}\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:38:in `get!': Could not find a directory environment named 'test' anywhere in the path: /etc/puppetlabs/code/environments. Does the directory exist? (Puppet::Environments::EnvironmentNotFound)\r\n{noformat}\r\n\r\nBut if you remove /etc/puppetlabs/code/environments/production it still works for production because in puppet.rb a basic default environment is only created if the environment is named production:\r\n \r\n{code:java}\r\n      # in case the configured environment (used for the default sometimes)\r\n      # doesn't exist\r\n      default_environment = Puppet[:environment].to_sym\r\n      if default_environment == :production\r\n        loaders << Puppet::Environments::StaticPrivate.new(\r\n          Puppet::Node::Environment.create(default_environment,\r\n                                           basemodulepath,\r\n                                           Puppet::Node::Environment::NO_MANIFEST))\r\n      end\r\n{code}\r\n\r\nI'm no expert on the puppet code, so I could miss something, but in my opinion a basic default environment should be created in every case.","closed_at":"2017-05-18T10:39:55.000-0700","comments":28,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6048","labels":"","state":"Closed","updated_at":"2017-05-18T10:39:55.000-0700","timestamp":1652285305.913616,"priority":"Normal","status_category":"Done","pull_request":4788},{"issue_id":"136540","title":"package resource does not install packages on OpenBSD if bare hostname is used as installpath in pkg.conf","url":"https://tickets.puppetlabs.com/browse/PUP-6402","created_at":"2016-06-11T01:43:36.000-0700","number":"PUP-6402","body":"{code}\r\n# # puppet --version\r\n4.5.1\r\n\r\n# uname -a\r\nOpenBSD bsd1.lan 5.9 GENERIC#1761 amd64\r\n\r\n# cat pkg_test.pp                                                                                          \r\npackage {'vim-7.4.900-no_x11':\r\n  ensure => present\r\n}\r\n\r\n# puppet apply --debug pkg_test.pp                                                                         \r\nDebug: Runtime environment: puppet_version=4.5.1, ruby_version=2.3.0, run_mode=user, default_encoding=US-ASCII\r\nDebug: Evicting cache entry for environment 'production'\r\nDebug: Caching environment 'production' (ttl = 0 sec)\r\nDebug: Evicting cache entry for environment 'production'\r\nDebug: Caching environment 'production' (ttl = 0 sec)\r\nDebug: Loading external facts from /opt/puppetlabs/puppet/cache/facts.d\r\nInfo: Loading facts\r\nDebug: Loading facts from /etc/puppetlabs/code/modules/stdlib/lib/facter/facter_dot_d.rb\r\nDebug: Loading facts from /etc/puppetlabs/code/modules/stdlib/lib/facter/package_provider.rb\r\nDebug: Loading facts from /etc/puppetlabs/code/modules/stdlib/lib/facter/pe_version.rb\r\nDebug: Loading facts from /etc/puppetlabs/code/modules/stdlib/lib/facter/puppet_vardir.rb\r\nDebug: Loading facts from /etc/puppetlabs/code/modules/stdlib/lib/facter/root_home.rb\r\nDebug: Loading facts from /etc/puppetlabs/code/modules/stdlib/lib/facter/service_provider.rb\r\nDebug: Facter: Found no suitable resolves of 1 for ec2_metadata\r\nDebug: Facter: value for ec2_metadata is still nil\r\nDebug: Evicting cache entry for environment 'production'\r\nDebug: Caching environment 'production' (ttl = 0 sec)\r\nDebug: Evicting cache entry for environment 'production'\r\nDebug: Caching environment 'production' (ttl = 0 sec)\r\nDebug: Evicting cache entry for environment 'production'\r\nDebug: Caching environment 'production' (ttl = 0 sec)\r\nDebug: Evicting cache entry for environment 'production'\r\nDebug: Caching environment 'production' (ttl = 0 sec)\r\nDebug: Evicting cache entry for environment 'production'\r\nDebug: Caching environment 'production' (ttl = 0 sec)\r\nDebug: Failed to load library 'cfpropertylist' for feature 'cfpropertylist'\r\nDebug: Failed to load library 'cfpropertylist' for feature 'cfpropertylist'\r\nDebug: Evicting cache entry for environment 'production'\r\nDebug: Caching environment 'production' (ttl = 0 sec)\r\nDebug: Evicting cache entry for environment 'production'\r\nDebug: Caching environment 'production' (ttl = 0 sec)\r\nDebug: Failed to load library 'cfpropertylist' for feature 'cfpropertylist'\r\nDebug: Evicting cache entry for environment 'production'\r\nDebug: Caching environment 'production' (ttl = 0 sec)\r\nDebug: Facter: value for agent_specified_environment is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for lsbmajdistrelease\r\nDebug: Facter: value for lsbmajdistrelease is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for dhcp_servers\r\nDebug: Facter: value for dhcp_servers is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for system32\r\nDebug: Facter: value for system32 is still nil\r\nDebug: Facter: ruby-augeas not available\r\nDebug: Facter: value for augeasversion is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for lsbdistrelease\r\nDebug: Facter: value for lsbdistrelease is still nil\r\nDebug: Facter: value for zfs_version is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for lsbdistdescription\r\nDebug: Facter: value for lsbdistdescription is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for lsbrelease\r\nDebug: Facter: value for lsbrelease is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for selinux\r\nDebug: Facter: value for selinux is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for selinux\r\nDebug: Facter: value for selinux is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for selinux_enforced\r\nDebug: Facter: value for selinux_enforced is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for selinux\r\nDebug: Facter: value for selinux is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for selinux_policyversion\r\nDebug: Facter: value for selinux_policyversion is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for selinux\r\nDebug: Facter: value for selinux is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for selinux_current_mode\r\nDebug: Facter: value for selinux_current_mode is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for selinux\r\nDebug: Facter: value for selinux is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for selinux_config_mode\r\nDebug: Facter: value for selinux_config_mode is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for selinux\r\nDebug: Facter: value for selinux is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for selinux_config_policy\r\nDebug: Facter: value for selinux_config_policy is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for gce\r\nDebug: Facter: value for gce is still nil\r\nDebug: Facter: value for ipaddress6_lo0 is still nil\r\nDebug: Facter: value for macaddress_lo0 is still nil\r\nDebug: Facter: value for ipaddress6_em0 is still nil\r\nDebug: Facter: value for ipaddress_enc0 is still nil\r\nDebug: Facter: value for ipaddress6_enc0 is still nil\r\nDebug: Facter: value for macaddress_enc0 is still nil\r\nDebug: Facter: value for netmask_enc0 is still nil\r\nDebug: Facter: value for ipaddress_pflog0 is still nil\r\nDebug: Facter: value for ipaddress6_pflog0 is still nil\r\nDebug: Facter: value for macaddress_pflog0 is still nil\r\nDebug: Facter: value for netmask_pflog0 is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for vlans\r\nDebug: Facter: value for vlans is still nil\r\nDebug: Facter: value for cfkey is still nil\r\nDebug: Facter: value for ipaddress6 is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for lsbdistcodename\r\nDebug: Facter: value for lsbdistcodename is still nil\r\nDebug: Facter: value for zpool_version is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for xendomains\r\nDebug: Facter: value for xendomains is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for zonename\r\nDebug: Facter: value for zonename is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for lsbdistid\r\nDebug: Facter: value for lsbdistid is still nil\r\nDebug: Facter: value for network_enc0 is still nil\r\nDebug: Facter: value for network_pflog0 is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for lsbminordistrelease\r\nDebug: Facter: value for lsbminordistrelease is still nil\r\nDebug: Facter: Found no suitable resolves of 2 for iphostnumber\r\nDebug: Facter: value for iphostnumber is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for filesystems\r\nDebug: Facter: value for filesystems is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for uniqueid\r\nDebug: Facter: value for uniqueid is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for ec2_metadata\r\nDebug: Facter: value for ec2_metadata is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for ec2_userdata\r\nDebug: Facter: value for ec2_userdata is still nil\r\nDebug: Facter: value for is_rsc is still nil\r\nDebug: Facter: value for is_rsc is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for rsc_region\r\nDebug: Facter: value for rsc_region is still nil\r\nDebug: Facter: value for is_rsc is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for rsc_instance_id\r\nDebug: Facter: value for rsc_instance_id is still nil\r\nDebug: Puppet::Type::Package::ProviderOpkg: file opkg does not exist\r\nDebug: Puppet::Type::Package::ProviderDpkg: file /usr/bin/dpkg does not exist\r\nDebug: Puppet::Type::Package::ProviderApt: file /usr/bin/apt-get does not exist\r\nDebug: Puppet::Type::Package::ProviderAptitude: file /usr/bin/aptitude does not exist\r\nDebug: Puppet::Type::Package::ProviderSun: file /usr/bin/pkginfo does not exist\r\nDebug: Puppet::Type::Package::ProviderSunfreeware: file pkg-get does not exist\r\nDebug: Puppet::Type::Package::ProviderPkg: file /usr/bin/pkg does not exist\r\nDebug: Puppet::Type::Package::ProviderPortage: file /usr/bin/emerge does not exist\r\nDebug: Puppet::Type::Package::ProviderHpux: file /usr/sbin/swinstall does not exist\r\nDebug: Puppet::Type::Package::ProviderRpm: file rpm does not exist\r\nDebug: Puppet::Type::Package::ProviderAptrpm: file apt-get does not exist\r\nDebug: Puppet::Type::Package::ProviderPuppet_gem: file /opt/puppetlabs/puppet/bin/gem does not exist\r\nDebug: Puppet::Type::Package::ProviderAix: file /usr/bin/lslpp does not exist\r\nDebug: Puppet::Type::Package::ProviderYum: file yum does not exist\r\nDebug: Puppet::Type::Package::ProviderPkgng: file /usr/local/sbin/pkg does not exist\r\nDebug: Puppet::Type::Package::ProviderPkgin: file pkgin does not exist\r\nDebug: Puppet::Type::Package::ProviderZypper: file /usr/bin/zypper does not exist\r\nDebug: Puppet::Type::Package::ProviderDnf: file dnf does not exist\r\nDebug: Puppet::Type::Package::ProviderPortupgrade: file /usr/local/sbin/portupgrade does not exist\r\nDebug: Puppet::Type::Package::ProviderFink: file /sw/bin/fink does not exist\r\nDebug: Puppet::Type::Package::ProviderUp2date: file /usr/sbin/up2date-nox does not exist\r\nDebug: Puppet::Type::Package::ProviderPacman: file /usr/bin/pacman does not exist\r\nDebug: Puppet::Type::Package::ProviderNim: file /usr/sbin/nimclient does not exist\r\nDebug: Puppet::Type::Package::ProviderPorts: file /usr/local/sbin/portupgrade does not exist\r\nDebug: Puppet::Type::Package::ProviderUrpmi: file urpmi does not exist\r\nDebug: Puppet::Type::Package::ProviderRug: file /usr/bin/rug does not exist\r\nDebug: /Package[dummy]: Provider openbsd does not support features virtual_packages; not managing attribute allow_virtual\r\nDebug: Facter: value for pe_version is still nil\r\nDebug: Facter: value for pe_version is still nil\r\nDebug: Facter: value for pe_version is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for pe_major_version\r\nDebug: Facter: value for pe_major_version is still nil\r\nDebug: Facter: value for pe_version is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for pe_minor_version\r\nDebug: Facter: value for pe_minor_version is still nil\r\nDebug: Facter: value for pe_version is still nil\r\nDebug: Facter: Found no suitable resolves of 1 for pe_patch_version\r\nDebug: Facter: value for pe_patch_version is still nil\r\nDebug: Puppet::Type::Service::ProviderSystemd: file systemctl does not exist\r\nDebug: Puppet::Type::Service::ProviderRedhat: file /sbin/chkconfig does not exist\r\nDebug: Puppet::Type::Service::ProviderDaemontools: file /usr/bin/svc does not exist\r\nDebug: Puppet::Type::Service::ProviderLaunchd: file /bin/launchctl does not exist\r\nDebug: Puppet::Type::Service::ProviderOpenrc: file /bin/rc-status does not exist\r\nDebug: Puppet::Type::Service::ProviderRunit: file /usr/bin/sv does not exist\r\nDebug: Puppet::Type::Service::ProviderGentoo: file /sbin/rc-update does not exist\r\nDebug: Puppet::Type::Service::ProviderDebian: file /usr/sbin/update-rc.d does not exist\r\nDebug: Puppet::Type::Service::ProviderUpstart: 0 confines (of 4) were true\r\nDebug: Evicting cache entry for environment 'production'\r\nDebug: Caching environment 'production' (ttl = 0 sec)\r\nNotice: Compiled catalog for bsd1.lan in environment production in 0.05 seconds\r\nDebug: /Package[vim-7.4.900-no_x11]: Provider openbsd does not support features virtual_packages; not managing attribute allow_virtual\r\nDebug: Creating default schedules\r\nDebug: Loaded state in 0.00 seconds\r\nDebug: Loaded state in 0.00 seconds\r\nInfo: Applying configuration version '1465634392'\r\nDebug: Prefetching openbsd resources for package\r\nDebug: Executing '/usr/sbin/pkg_info -a'\r\nDebug: Executing: '/usr/sbin/pkg_info vim-7.4.900-no_x11'\r\nDebug: Executing: '/usr/sbin/pkg_add ftp.aso.ee'\r\nNotice: /Stage[main]/Main/Package[vim-7.4.900-no_x11]/ensure: created\r\nDebug: /Package[vim-7.4.900-no_x11]: The container Class[Main] will propagate my refresh event\r\nDebug: Class[Main]: The container Stage[main] will propagate my refresh event\r\nDebug: Finishing transaction 4767578812320\r\nDebug: Storing state\r\nDebug: Stored state in 0.01 seconds\r\nNotice: Applied catalog in 2.99 seconds\r\nDebug: Applying settings catalog for sections reporting, metrics\r\nDebug: Finishing transaction 4767530408360\r\nDebug: Received report to process from bsd1.lan\r\nDebug: Evicting cache entry for environment 'production'\r\nDebug: Caching environment 'production' (ttl = 0 sec)\r\nDebug: Processing report from bsd1.lan with processor Puppet::Reports::Store\r\n\r\n# pkg_info |grep vim\r\n(no output, since the package is not actually installed.)\r\n{code}\r\n\r\n\r\nNote this part:\r\n\r\nMirror address is passed to pkg_add as a parameter, instead of package name:\r\n\r\nDebug: Executing: '/usr/sbin/pkg_add ftp.aso.ee'\r\n\r\nInstallation is reported as successful:\r\nNotice: /Stage[main]/Main/Package[vim-7.4.900-no_x11]/ensure: created","closed_at":"2017-05-18T10:40:31.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6402","labels":"","state":"Closed","updated_at":"2017-05-18T10:40:31.000-0700","timestamp":1652285322.714898,"priority":"Normal","status_category":"Done","pull_request":5196},{"issue_id":"133523","title":"Configuration reference reports wacky default for hiera_config setting","url":"https://tickets.puppetlabs.com/browse/PUP-6345","created_at":"2016-05-23T17:42:02.000-0700","number":"PUP-6345","body":"Docs team relies on {{puppet doc -r configuration}} to build the [configuration reference|https://docs.puppet.com/puppet/latest/reference/configuration.html]. If you run that command with Puppet 4.5, it reports the default location of hiera_config as something like {{/Users/nick/.puppetlabs/etc/code/hiera.yaml}}. \r\n\r\na. It should be reporting the default in terms of variables like $confdir, not printing a user-specific path.\r\nb. Even $confdir/hiera.yaml isn't the whole story, because of the try-codedir-first behavior to preserve backward compatibility. That kind of dynamic behavior is really hard to introspect, and we rely on being able to introspect. \r\n\r\nI think I know how to fix this, but I'm filing it as a real ticket to raise awareness: \r\n\r\n* When we add dynamic behaviors for auto-documented objects, we also need to make sure we don't break the docs. \r\n* Plain old introspection is brittle, and it would be really nice to have a way, in the settings themselves, to provide a _descriptive_ default value. We probably won't get this for oldskool puppet settings, but it'd be nice to take into account for whatever's next. We've been burned by this sort of thing before, in several places. ","closed_at":"2017-05-18T10:40:53.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6345","labels":"","state":"Closed","updated_at":"2017-05-18T10:40:53.000-0700","timestamp":1652285327.932252,"priority":"Normal","status_category":"Done","pull_request":4988},{"issue_id":"129635","title":"File resource no_proxy behavior is ignored","url":"https://tickets.puppetlabs.com/browse/PUP-6259","created_at":"2016-05-03T13:45:43.000-0700","number":"PUP-6259","body":"I have a file resource:\r\n{code:puppet}\r\nfile {'/var/opt/foo/client.config':\r\n  ensure  => present,\r\n  mode    => '0644',\r\n  owner   => 'root',\r\n  group   => 'root',\r\n  source  => 'https://files.internal/client.config',\r\n  require => File['/var/opt/foo'],\r\n  replace => false\r\n}\r\n{code}\r\n\r\nIn my machine environment, I have the following env vars set globally:\r\n{code}\r\nhttp_proxy=\"http://172.22.252.1:8080\r\nhttps_proxy=\"http://172.22.252.1:8080\r\nno_proxy=127.0.0.1,localhost,.internal\r\n{code}\r\n\r\nWhen Puppet tries to reach out to https://files.internal/client.config, I get:\r\n{code}\r\nError: /Stage[main]/Module::Blah/File[/var/opt/foo/client.config]: Could not evaluate: Could not retrieve file metadata for https://files.internal/client.config: SSL_connect returned=1 errno=0 state=error: certificate verify failed\r\n{code}\r\n\r\nAfter enabling http_debug, I noticed that despite {{no_proxy}} having {{.internal}} in it, Net::HTTP wanted to toss it through the proxy anyways, so my internal proxy was getting in the way (and presenting its untrusted MITM cert so that it could tell me that internal hosts cant be proxied). According to the Ruby 2.1.8 Docs, Net::HTTP::Proxy has been deprecated and proxy settings just specified in Net::HTTP.new. Updating {{lib/puppet/util/http_proxy.rb}} with the new initializer seemed to fix the issue.","closed_at":"2017-05-18T10:41:00.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6259","labels":"","state":"Closed","updated_at":"2017-05-18T10:41:00.000-0700","timestamp":1652285329.940886,"priority":"Normal","status_category":"Done","pull_request":4938},{"issue_id":"166266","title":"Git acceptance broken on Windows","url":"https://tickets.puppetlabs.com/browse/PUP-7009","created_at":"2016-12-13T16:57:51.000-0800","number":"PUP-7009","body":"Git acceptance will be restored in PUP-6989, however, additional work is needed to support Windows agents.\r\n\r\n* Need Git on Windows installed on the VM, see IMAGES-431\r\n* The {{ci:test:git}} task clones {{puppet-win32-ruby}} which can't connect to rubygems due to its new SSL cert. We should install our vanagon built ruby instead.\r\n* Bundler on Windows does not create binstubs correctly, see https://github.com/bundler/bundler/issues/4512. We could work-around that by creating our own *.bat wrapper.","closed_at":"2017-05-18T10:41:14.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7009","labels":"","state":"Resolved","updated_at":"2017-05-18T10:41:14.000-0700","timestamp":1652285341.020755,"priority":"Normal","status_category":"Done","pull_request":5781},{"issue_id":"21557","title":"Zypper package provider needs $HOME set to access username/password-protected repos","url":"https://tickets.puppetlabs.com/browse/PUP-1124","created_at":"2013-12-17T00:48:16.000-0800","number":"PUP-1124","body":"zypper, the command used to install packages on SUSE distributions, supports package repositories that requires a username and a password to be accessed. Unlike other comparable utilities for other distributions, zypper stores such credentials information in a file in {{$HOME, $HOME/.zypp/credentials.cat}} to be precise. However, this requires the environment variable $HOME to be set, which is currently not the case, rendering the zypper package provider unable to access a required password.\r\n\r\nThe attached patch fixes this by explicitly defining a HOME environment variable set to \"/root\". This is correct, because the zypper command requires root permissions for both configuring software repositories and installing software.\r\n\r\n","closed_at":"2017-05-18T10:43:43.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1124","labels":"help_wanted;manage-package;redmine","state":"Closed","updated_at":"2017-05-18T10:43:43.000-0700","timestamp":1652285343.178297,"priority":"Normal","status_category":"Done","pull_request":8767},{"issue_id":"75837","title":"Vim indentation: chaining arrows","url":"https://tickets.puppetlabs.com/browse/PUP-4407","created_at":"2015-04-14T03:07:31.000-0700","number":"PUP-4407","body":"{{ext/vim/indent/puppet.vim}} doesn't recognize the chaining arrows syntax","closed_at":"2017-05-18T10:43:58.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4407","labels":"","state":"Closed","updated_at":"2017-05-18T10:43:58.000-0700","timestamp":1652285346.36563,"priority":"Normal","status_category":"Done","pull_request":3818},{"issue_id":"35226","title":"Redhat service enable does not honour chkconfig or LSB Headers.","url":"https://tickets.puppetlabs.com/browse/PUP-2553","created_at":"2014-05-13T09:08:08.000-0700","number":"PUP-2553","body":"Using chkconfig <service> on blindly sets the service on in runlevel 2,3,4,5. puppet should use chkconfig <service> resetpriorities. when enabling services so that it honours the settings in the chkconfig and LSB Headers.","closed_at":"2017-05-18T10:44:00.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2553","labels":"","state":"Closed","updated_at":"2017-05-18T10:44:00.000-0700","timestamp":1652285347.502755,"priority":"Normal","status_category":"Done","pull_request":2643},{"issue_id":"30203","title":"resourses type attribute unless_uid depends on unless_system_user","url":"https://tickets.puppetlabs.com/browse/PUP-2074","created_at":"2014-03-26T18:04:14.000-0700","number":"PUP-2074","body":"PUP-594 implemented 'unless_uid' as an attribute to resources however it looks as though its use is dependant on 'unless_system_user' being true.","closed_at":"2017-05-18T10:44:04.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2074","labels":"","state":"Closed","updated_at":"2017-05-18T10:44:04.000-0700","timestamp":1652285348.446469,"priority":"Normal","status_category":"Done","pull_request":2478},{"issue_id":"48008","title":"Services are started before flags are set","url":"https://tickets.puppetlabs.com/browse/PUP-3066","created_at":"2014-08-15T06:09:23.000-0700","number":"PUP-3066","body":"The OpenBSD service provider is marked `flaggable` which means that `flags` may be passed which are written into `/etc/rc.conf.local`. These flags control the behaviour of the service when they're started.\r\n\r\nHowever it seems there's an issue in the ordering, the flags are written out to disk (flushed) _after_ the service is started. This means that the service is started without the flags that have been set:\r\n\r\n$ ps ax | grep apmd\r\n26569 p6  R+      0:00.00 grep apmd\r\n$ grep apmd /etc/rc.conf.local\r\n$ sudo puppet apply -e 'service {\"apmd\": ensure => running, enable => true, flags => \"-C\"}'\r\nNotice: Compiled catalog for obsidian.office.jasper.la in environment production in 0.81 seconds\r\nNotice: /Stage[main]/Main/Service[apmd]/ensure: ensure changed 'stopped' to 'running'\r\nNotice: Finished catalog run in 1.31 seconds\r\n$ grep apmd /etc/rc.conf.local\r\napmd_flags=-C\r\n$ ps ax | grep apmd\r\n25277 ??  Ss      0:00.01 /usr/sbin/apmd\r\n27678 p6  R+      0:00.00 grep apmd\r\n$\r\n\r\nThe expected behaviour would be:\r\n$ grep apmd /etc/rc.conf.local\r\napmd_flags=-C\r\n$ ps ax | grep apmd\r\n25277 ??  Ss      0:00.01 /usr/sbin/apmd -C\r\n27678 p6  R+      0:00.00 grep apmd\r\n$","closed_at":"2017-05-18T10:44:21.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3066","labels":"","state":"Closed","updated_at":"2017-05-18T10:44:21.000-0700","timestamp":1652285361.341664,"priority":"Normal","status_category":"Done","pull_request":2978},{"issue_id":"14947","title":"Warn if DisplayName or DisplayVersion is wrong","url":"https://tickets.puppetlabs.com/browse/PUP-399","created_at":"2013-09-19T00:23:34.000-0700","number":"PUP-399","body":"Perhaps puppet should compare the list of installed package “displaynames” before and after each package install – so it can figure out what the Displayname of the just installed package is – and then compare that against the “name” given in the manifest – and complain to the user, if it’s wrong – as to catch these problems ? (which I got caught by myself)","closed_at":"2017-05-18T10:44:24.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-399","labels":"windows","state":"Closed","updated_at":"2017-05-18T10:44:24.000-0700","timestamp":1652285361.965789,"priority":"Normal","status_category":"Done","pull_request":8627},{"issue_id":"69154","title":"The user type should autorequire the home directory","url":"https://tickets.puppetlabs.com/browse/PUP-4036","created_at":"2015-02-24T08:34:53.000-0800","number":"PUP-4036","body":null,"closed_at":"2017-05-18T10:44:40.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4036","labels":"","state":"Closed","updated_at":"2017-05-18T10:44:40.000-0700","timestamp":1652285366.827725,"priority":"Normal","status_category":"Done","pull_request":3645},{"issue_id":"39372","title":"if initctl --version doesn't list a matching string, upstart service provider fails badly.","url":"https://tickets.puppetlabs.com/browse/PUP-2790","created_at":"2014-06-17T09:26:56.000-0700","number":"PUP-2790","body":"We are running puppet during the installation process, using Debian installers late_command option.\r\nAt this point, calling \"status avahi-daemon\" returns:\r\n----- cut here -----\r\n\r\nWarning: Fake initctl called, doing nothing.\r\n----- cut here -----\r\n(As does any other call to initctl, such as \"initctl list\")\r\nUnfortunately, I was unable to determine if this was on STDOUT or (partially) on STDERR, because it was replaced in the meantime by the standard initctl from upstart.\r\n\r\nHowever, that output causes this:\r\n\r\n17 Jun 2014 14:32:00 puppet.py:1289 DEBUG    PUPPET: Debug: Executing '/sbin/status avahi-daemon'\r\n17 Jun 2014 14:32:00 puppet.py:1289 DEBUG    PUPPET: Error: /Stage[main]/Avahi_daemon/Service[avahi-daemon]: Could not evaluate: undefined method `[]' for nil:NilClass\r\n\r\nHere is the backtrace (from simulating the error on my machine):\r\n\r\nError: /Stage[main]/Avahi_daemon/Service[avahi-daemon]: Could not evaluate: undefined method `[]' for nil:NilClass\r\n/usr/lib/ruby/vendor_ruby/puppet/provider/service/upstart.rb:60:in `upstart_version'\r\n/usr/lib/ruby/vendor_ruby/puppet/provider/service/upstart.rb:155:in `version_is_pre_0_6_7'\r\n/usr/lib/ruby/vendor_ruby/puppet/provider/service/upstart.rb:89:in `enabled?'\r\n/usr/lib/ruby/vendor_ruby/puppet/type/service.rb:56:in `retrieve'\r\n/usr/lib/ruby/vendor_ruby/puppet/type.rb:1045:in `block in retrieve'\r\n/usr/lib/ruby/vendor_ruby/puppet/type.rb:1040:in `each'\r\n/usr/lib/ruby/vendor_ruby/puppet/type.rb:1040:in `retrieve'\r\n/usr/lib/ruby/vendor_ruby/puppet/type.rb:1063:in `retrieve_resource'\r\n/usr/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:223:in `from_resource'\r\n/usr/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:17:in `evaluate'\r\n/usr/lib/ruby/vendor_ruby/puppet/transaction.rb:174:in `apply'\r\n/usr/lib/ruby/vendor_ruby/puppet/transaction.rb:187:in `eval_resource'\r\n/usr/lib/ruby/vendor_ruby/puppet/transaction.rb:117:in `call'\r\n/usr/lib/ruby/vendor_ruby/puppet/transaction.rb:117:in `block (2 levels) in evaluate'\r\n/usr/lib/ruby/vendor_ruby/puppet/util.rb:327:in `block in thinmark'\r\n","closed_at":"2017-05-18T10:44:57.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2790","labels":"manage-service","state":"Closed","updated_at":"2017-05-18T10:44:57.000-0700","timestamp":1652285380.537178,"priority":"Normal","status_category":"Done","pull_request":2961},{"issue_id":"21587","title":"mailalias doesn't run newalias","url":"https://tickets.puppetlabs.com/browse/PUP-1143","created_at":"2013-12-17T09:21:22.000-0800","number":"PUP-1143","body":"This is probably actually a bug in the alias provider, at least on Centos/Redhat - when adding aliases, the alias database is not regenerated by running newaliases.  The workaround is to notify Exec['newaliases'], but that seems to get run every time puppet runs.  Even if I'm doing that part wrong, it still seems like the provider should be smart enough to do it right without the notify hack...  This was the case in 2.7.9 and is still so in 3.2.3.","closed_at":"2017-05-18T10:45:03.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1143","labels":"redmine","state":"Closed","updated_at":"2017-05-18T10:45:03.000-0700","timestamp":1652285381.941787,"priority":"Normal","status_category":"Done","pull_request":8892},{"issue_id":"21412","title":"Exported resources are hard to collect by environment","url":"https://tickets.puppetlabs.com/browse/PUP-1078","created_at":"2013-12-16T11:02:23.000-0800","number":"PUP-1078","body":"I noticed today that {{Foo <<| |>>}} collects all Foo resources regardless of environment. Doing {{Foo <<| environment == ... |>>}} would be cool, but I don't think that works.\r\n\r\nWhy was this a problem? I have multiple deployments; some of which cannot see each other on the network (outside of the storeconfigs db). As a result of this behavior (collect all resources in all environments), I have nagios instances that try to monitor machines they can't see and thus all checks fail and pager goes beep beep. ;)\r\n\r\nI found a work around using tags.\r\n\r\n{code}\r\nnode default {\r\n  # Globally apply an environment-based tag to all resources on each node.\r\n  tag(\"deployment::$environment\")\r\n  ...\r\n}\r\n\r\n# And later ...\r\n\r\nSomeResource <<| tag == \"deployment::$environment\" |>> \r\n{code}\r\n\r\nThe above workaround is sufficient for me to continue deploying exported resources (not a blocker).\r\n\r\nI was expecting collectors of exported resources would only, by default, get resources from the same environment. Barring that, I think a query of {{<<| environment == ... |>>}} would be quite useful rather than resorting to tagging.","closed_at":"2017-05-18T10:45:04.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1078","labels":"customer;needs_decision;redmine","state":"Needs Information","updated_at":"2017-05-18T10:45:04.000-0700","timestamp":1652285382.2636,"priority":"Normal","status_category":"To Do","pull_request":8445},{"issue_id":"113143","title":"Change default parsing of manifest files to UTF-8","url":"https://tickets.puppetlabs.com/browse/PUP-5728","created_at":"2016-01-20T16:08:54.000-0800","number":"PUP-5728","body":"As part of PUP-2564, we changed our language to state that manifest files must be in UTF-8.  However, this is not enforced when we actually lex files with the parser, and it causes a host of issues on Windows in particular.\r\n\r\nhttps://docs.puppetlabs.com/puppet/latest/reference/lang_summary.html#files\r\n\r\nAs [~josh] alluded to, Windows will read the file then treat it as whatever the current codepage is, and this carries a number of issues.\r\n\r\nFor instance, take the manifest \r\n\r\n{code}\r\nuser { 'Umlautä':\r\n  ensure => present,\r\n  password => 'password'\r\n}\r\n{code}\r\n\r\nIf running with the codepage 437, the string produced by {{Puppet::FileSystem.read}} is incorrect for subsequent usage as {{ä}} gets turned into {{\\xC3\\xA4}}:\r\n\r\n{code}\r\n\"user { 'Umlaut\\xC3\\xA4':\\n  ensure => present,\\n  password => 'password'\\n}\\n\"\r\n{code}\r\n\r\nSo while the user is created, the name is {{Umlaut├ñ}} instead of {{Umlautä}} due to the way the converted bytes are represented when making the appropriate conversions (i.e calling {{.encode('utf-8')}} on the above string produces:\r\n\r\n{code}\r\n\"user { 'Umlaut\\u251C\\u00F1':\\n  ensure => present,\\n  password => 'password'\\n}\\n\"\r\n{code}\r\n\r\nIf instead the local codepage is set to {{65001}}, which is Unicode... then the behavior is correct.  However, this is not something we should expect users to do, and we should treat the incoming file as UTF-8 as that's what our documentation specifies / and what we claim to expect.\r\n\r\nThe prior PUP-2564 ticket mentioned the inability of specifying an encoding during file reading at https://tickets.puppetlabs.com/browse/PUP-2564?focusedCommentId=125526&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-125526.  I think that's a problem that can be easily fixed, at least in this narrow use case to start.\r\n\r\n\r\n\r\nI spiked a very quick solution to this problem for the sake of discussion.  With the change, the parsed string is now represents {{ä}} correct as {{\\u00E4}}:\r\n\r\n{code}\r\n\"user { 'Umlaut\\u00E4':\\n  ensure => present,\\n  password => 'password'\\n}\\n\"\r\n{code}\r\n\r\nI know that it fixes the problem with the manifest above (i.e. you can run any local codepage and the correct user name is used during creation based on the UTF8 file contents).  However, there could be some additional fallout, and there are certainly other places where files are read that could take similar tacts.","closed_at":"2017-05-24T11:01:17.000-0700","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5728","labels":"i18n;utf-8","state":"Closed","updated_at":"2017-05-24T11:01:17.000-0700","timestamp":1652285399.996736,"priority":"Normal","status_category":"Done","pull_request":4585},{"issue_id":"158631","title":"The network_device configuration parser should not accept trailing whitespace","url":"https://tickets.puppetlabs.com/browse/PUP-6847","created_at":"2016-10-27T14:30:20.000-0700","number":"PUP-6847","body":"If one inadvertently adds an additional space or carriage return to the end of their device configuration file (for example, for the f5 module), the `puppet device` command will fail with a somewhat cryptic message:\r\n\r\n{noformat}\r\n# puppet device -v --user=root\r\nInfo: starting applying configuration to some.hostname.com at https://myipaddress:443/\r\n/deviceCould not run: cannot load such file -- puppet/util/network_device/f5\r\n{noformat}\r\n\r\nThe problem is that the whitespace at the end of the line is included in the provider name when parsing the configuration file at https://github.com/puppetlabs/puppet/blob/master/lib/puppet/util/network_device/config.rb#L62, which then gets included in a require statement at https://github.com/puppetlabs/puppet/blob/master/lib/puppet/util/network_device.rb#L7.  \r\n\r\nThe regex needs to be updated to leave out any trailing whitespace to avoid this issue.","closed_at":"2017-05-25T15:53:07.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6847","labels":"","state":"Resolved","updated_at":"2017-05-25T15:53:07.000-0700","timestamp":1652285400.30735,"priority":"Normal","status_category":"Done","pull_request":5350},{"issue_id":"138264","title":"Package resource gem provider should preserve HOME env var","url":"https://tickets.puppetlabs.com/browse/PUP-6428","created_at":"2016-06-22T11:39:47.000-0700","number":"PUP-6428","body":"When the gem provider for the package resource is used, it will automatically look for its gemrc file in \"/.gemrc\" rather than the expected \"/root/.gemrc\" because the HOME environment variable is automatically cleared during the execution of the command at https://github.com/puppetlabs/puppet/blob/98d22be27447bcb34c33aa4a44610ab8768390f5/lib/puppet/util/execution.rb#L289-L294.  \r\n\r\nThe gem command uses the HOME environment variable in order to locate the user's gemrc file, so clearing that variable forces it to fall back to the root of the filesystem.  This is not intuitive considering Puppet runs as root on the system.","closed_at":"2017-05-25T15:56:29.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6428","labels":"cspapercuts","state":"Closed","updated_at":"2017-05-25T15:56:29.000-0700","timestamp":1652285400.411043,"priority":"Normal","status_category":"Done","pull_request":5051},{"issue_id":"193445","title":"catalog.resource() doesn't accept \"main\" as a title parameter","url":"https://tickets.puppetlabs.com/browse/PUP-7605","created_at":"2017-05-30T12:10:44.000-0700","number":"PUP-7605","body":"When calling catalog.resource(type, title) with the string \"main\" as the title parameter, it doesn't return a resource in the catalog with that title. It appears that title is getting passed through resource.munge_type_name(), which had a special case for :main that doesn't kick in now we're using the stringified data from to_hash. \r\n\r\nThis is triggered by PUP commit 7bbe36774; this returns title as a string in to_data_hash, where it used to be a symbol somtimes. The PDB terminus in turns calls catalog_resource with this, which then returns nil.","closed_at":"2017-06-07T14:59:15.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7605","labels":"","state":"Closed","updated_at":"2017-06-07T14:59:15.000-0700","timestamp":1652285403.712859,"priority":"Normal","status_category":"Done","pull_request":5929},{"issue_id":"194815","title":"CreateSymbolicLinkW returns the wrong data type","url":"https://tickets.puppetlabs.com/browse/PUP-7627","created_at":"2017-06-07T01:52:43.000-0700","number":"PUP-7627","body":"I was investigating why [~david.schmitt] and I were getting different results from `Puppet::FileSystem.symlink` on Windows. His VM was correctly reporting an error and mine was silently failing.\r\n\r\nWhen run as a non-administrator user on my VM, `CreateSymbolicLinkW` would return non-zero (success for this function) when it should have failed. Going through the MSDN docs, I noticed that it returns a 1 byte `BOOLEAN` rather than the 4 byte `BOOL` that it is currently prototyped for with FFI (so I was getting a value with random data in the 3 upper bytes).\r\n\r\nChanging the FFI prototype for the function over to returning an `int8` resolved the problem for me (see linked PR).","closed_at":"2017-06-14T06:18:42.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7627","labels":"resolved-issue-added;windows","state":"Closed","updated_at":"2017-06-14T06:18:42.000-0700","timestamp":1652285404.597781,"priority":"Normal","status_category":"Done","pull_request":5958},{"issue_id":"188601","title":"Top-scope Puppet function behavior is inconsistent with documentation","url":"https://tickets.puppetlabs.com/browse/PUP-7485","created_at":"2017-04-30T06:48:06.000-0700","number":"PUP-7485","body":"Per https://docs.puppet.com/puppet/4.10/lang_write_functions_in_puppet.html it is possible to write Puppet-language functions in the main manifest (top-scope). The warning in the documentation indicates that the behavior, as with other top-scope items, would be to have the function accessible to all modules.\r\n\r\nHowever, if you define a function in the main manifest and then try to call it from a module you will receive an error such as: \"Error: Evaluation Error: Unknown function: 'testfunc'\". It works fine when called from the main manifest. Calling it with the leading \"::\" indicating top-scope has no change in behavior.\r\n\r\nThe expected behavior is that top-scope Puppet language functions would work per the documentation and similarly to their Ruby counterparts.\r\n","closed_at":"2017-06-14T06:18:42.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7485","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-14T06:18:42.000-0700","timestamp":1652285404.700981,"priority":"Normal","status_category":"Done","pull_request":5837},{"issue_id":"187835","title":"Add tests for StringConverter#string_PRuntimeType","url":"https://tickets.puppetlabs.com/browse/PUP-7469","created_at":"2017-04-25T14:12:31.000-0700","number":"PUP-7469","body":"Commit [3107b59|https://github.com/puppetlabs/puppet/commit/3107b59] landed in puppet#stable, but the ticket PUP-7224 is marked as fixed in 5.0.\r\n\r\n*Updated*\r\n\r\nWe need to add tests for {{string_PRuntimeType}}. Commit 3107b59 was intentionally cherry-picked back to stable, but due to the ticket number fixVersion mismatch, it is flagged during ticket reconciliation. The important thing is that the old code in stable was broken, and the cherry-pick was correct. So now we just need tests, which the linked PR does.\r\n\r\n*Original*\r\n\r\nIt appears the {{StringConverter#string_PRuntimeType}} method is dead code, or at least is supposed to be called, but isn't. I commented the method out, and all of the rspec tests pass.\r\n\r\nIf I enter a bogus format string, then the error is raised in {{string_PType}}, not {{string_PRuntimeType}}:\r\n\r\n{noformat}\r\nirb(main):012:0> Puppet::Pops::Types::StringConverter.convert(Puppet::Pops::Types::PRuntimeType::RUBY, \"%s\")\r\n=> \"Runtime[ruby, ?]\"\r\nirb(main):013:0> Puppet::Pops::Types::StringConverter.convert(Puppet::Pops::Types::PRuntimeType::RUBY, \"%bogus\")\r\nPuppet::Pops::Types::StringConverter::FormatError: Illegal format 'b' specified for value of Type type - expected one of the characters 'sp'\r\n        from /Users/josh/work/puppet/lib/puppet/pops/types/string_converter.rb:1025:in `string_PType' \r\n{noformat}\r\n\r\nSo this ticket is to:\r\n\r\n# Verify commit 3107b59 was supposed to land in stable, and revert it if not\r\n# Add tests\r\n# Ensure string_PRuntimeType gets called when it's supposed to, or delete the method if it's not needed\r\n\r\n/cc [~henrik.lindberg], [~kenn], [~geoff.nichols]","closed_at":"2017-06-14T06:18:42.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7469","labels":"","state":"Closed","updated_at":"2017-06-14T06:18:42.000-0700","timestamp":1652285404.806086,"priority":"Normal","status_category":"Done","pull_request":5823},{"issue_id":"192932","title":"Hiera hash keys are being converted to strings recursively","url":"https://tickets.puppetlabs.com/browse/PUP-7594","created_at":"2017-05-24T18:09:40.000-0700","number":"PUP-7594","body":"Puppet 4.9+ currently converts hiera hash elements into strings unconditiionally. YAML.load_file() will deserialize say an Integer to a ruby Fixnum, but the function symkeys_to_string converts every key to a string, regardless of whether it is a symbol.\r\n\r\nHere is a simple example:\r\n{code}\r\n$ports = lookup(\"ports\")\r\n\r\n$ports.each |$port, $options | {\r\n\t$port_type = type(Integer.new($port), 'generalized')\r\n\tnotify { \"${port} = ${port_type}\":}\r\n}\r\n{code}\r\ncommon.yaml:\r\n{code}\r\nports:\r\n  80:\r\n    test: test\r\n  443:\r\n    test: test\r\n{code}\r\nAnd the output:\r\n{code}\r\nNotice: 80 = String\r\nNotice: /Stage[main]/Main/Notify[80 = String]/message: defined 'message' as '80 = String'\r\nNotice: 443 = String\r\nNotice: /Stage[main]/Main/Notify[443 = String]/message: defined 'message' as '443 = String'\r\nNotice: Applied catalog in 0.02 seconds\r\n{code}\r\n\r\nThis is also a regression in functionality from Puppet <4.8. PR uploaded to https://github.com/puppetlabs/puppet/pull/5912","closed_at":"2017-06-14T06:18:43.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7594","labels":"regression;resolved-issue-added","state":"Closed","updated_at":"2017-06-14T06:18:43.000-0700","timestamp":1652285404.908692,"priority":"Normal","status_category":"Done","pull_request":5934},{"issue_id":"191347","title":"Puppet runs fail when hiera.yaml version 3 detected in a module","url":"https://tickets.puppetlabs.com/browse/PUP-7554","created_at":"2017-05-16T15:21:50.000-0700","number":"PUP-7554","body":"This is a regression when upgrading from the 2016.4.x LTS to 2016.4.5. Puppet version 4.10.1 runs fail when an hiera.yaml version 3 file is found in the module. For a number of reasons, customers may have hiera.yaml files in modules and the environment. There should be a warning about the version and it should be ignores instead of causing a failure. \r\n\r\n*Impact*\r\nCustomers that upgrade to the latest LTS which have hiera.yaml 3 files in their modules will have failures. The upgrade should allow for customers to migrate into a hiera 5 type environment without failures. \r\n","closed_at":"2017-06-14T06:18:43.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7554","labels":"regression;resolved-issue-added","state":"Closed","updated_at":"2017-06-14T06:18:43.000-0700","timestamp":1652285405.012318,"priority":"Blocker","status_category":"Done","pull_request":5887},{"issue_id":"181892","title":"Puppet with openssl 1.1 fails","url":"https://tickets.puppetlabs.com/browse/PUP-7383","created_at":"2017-03-22T02:29:03.000-0700","number":"PUP-7383","body":"Updating from openssl 1.0 to 1.1 breaks puppet:\r\n\r\n# puppet --version\r\n/usr/lib/ruby/vendor_ruby/2.4.0/puppet/util/monkey_patches.rb:104:in `<class:SSLContext>': undefined method `<<' for nil:NilClass (NoMethodError)\r\n\tfrom /usr/lib/ruby/vendor_ruby/2.4.0/puppet/util/monkey_patches.rb:98:in `<top (required)>'\r\n\tfrom /usr/lib/ruby/2.4.0/rubygems/core_ext/kernel_require.rb:55:in `require'\r\n\tfrom /usr/lib/ruby/2.4.0/rubygems/core_ext/kernel_require.rb:55:in `require'\r\n\tfrom /usr/lib/ruby/vendor_ruby/2.4.0/puppet/util.rb:16:in `<module:Util>'\r\n\tfrom /usr/lib/ruby/vendor_ruby/2.4.0/puppet/util.rb:15:in `<module:Puppet>'\r\n\tfrom /usr/lib/ruby/vendor_ruby/2.4.0/puppet/util.rb:14:in `<top (required)>'\r\n\tfrom /usr/lib/ruby/2.4.0/rubygems/core_ext/kernel_require.rb:55:in `require'\r\n\tfrom /usr/lib/ruby/2.4.0/rubygems/core_ext/kernel_require.rb:55:in `require'\r\n\tfrom /usr/lib/ruby/vendor_ruby/2.4.0/puppet.rb:14:in `<top (required)>'\r\n\tfrom /usr/lib/ruby/2.4.0/rubygems/core_ext/kernel_require.rb:55:in `require'\r\n\tfrom /usr/lib/ruby/2.4.0/rubygems/core_ext/kernel_require.rb:55:in `require'\r\n\tfrom /usr/lib/ruby/vendor_ruby/2.4.0/puppet/util/command_line.rb:12:in `<top (required)>'\r\n\tfrom /usr/lib/ruby/2.4.0/rubygems/core_ext/kernel_require.rb:55:in `require'\r\n\tfrom /usr/lib/ruby/2.4.0/rubygems/core_ext/kernel_require.rb:55:in `require'\r\n\tfrom /usr/bin/puppet:4:in `<main>'\r\n","closed_at":"2017-06-14T06:18:43.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7383","labels":"needs_epic;resolved-issue-added","state":"Closed","updated_at":"2017-06-14T06:18:43.000-0700","timestamp":1652285405.217657,"priority":"Normal","status_category":"Done","pull_request":5877},{"issue_id":"187714","title":"Pcore ResourceType cannot handle title pattern with multiple entries","url":"https://tickets.puppetlabs.com/browse/PUP-7465","created_at":"2017-04-25T01:30:24.000-0700","number":"PUP-7465","body":"The Puppet generator, when generating a .pp file that contains a definition of a {{Puppet::Resource::ResourceType3}}, will emit a hash that corresponds to the {{title_patterns}} of the original {{ResourceType}}. Each value in this hash is an array of strings. In the original type, it was an array of one element arrays (a two element array where the second element is a Proc is possible but it is not supported by the generator, hence the simplification).\r\n\r\nThe problem is that when the generated resource is instantiated. Instead of wrapping each string into an array, the whole array of strings is mapped into an array. This entry:\r\n{code:ruby}\r\n/^((.+)\\/(.*))$/ => ['name', 'top_level', 'lower_level']\r\n{code}\r\nbecomes\r\n{code:ruby}\r\n/^((.+)\\/(.*))$/ => [ ['name', 'top_level', 'lower_level'] ]\r\n{code}\r\ninstead of\r\n{code:ruby}\r\n/^((.+)\\/(.*))$/ => [ ['name'], ['top_level'], ['lower_level'] ]\r\n{code}\r\nSubsequent attemtps to use this resource type crashes with:\r\n{code}\r\nError: undefined method `call' for :top_level:Symbol\r\n{code}\r\nsince it things that an array with more than one element contains a {{Proc}}.\r\n","closed_at":"2017-06-14T06:18:44.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7465","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-14T06:18:44.000-0700","timestamp":1652285405.420028,"priority":"Major","status_category":"Done","pull_request":5819},{"issue_id":"190628","title":"Can't gem install puppet with some versions of bundler and ruby 1.9.3","url":"https://tickets.puppetlabs.com/browse/PUP-7523","created_at":"2017-05-11T16:37:51.000-0700","number":"PUP-7523","body":"Running {{puppet --version}} on ruby 1.9.3 and ubuntu 14.04 fails due to https://github.com/bundler/bundler/issues/3187\r\n\r\n{noformat}\r\nroot@cb37bnfmc142c5l:~# puppet --version\r\n/usr/lib/ruby/1.9.1/rubygems/version.rb:191:in `strip!': can't modify frozen String (RuntimeError)\r\n\tfrom /usr/lib/ruby/1.9.1/rubygems/version.rb:191:in `initialize'\r\n\tfrom /var/lib/gems/1.9.1/gems/puppet-4.10.1/lib/puppet.rb:3:in `new'\r\n\tfrom /var/lib/gems/1.9.1/gems/puppet-4.10.1/lib/puppet.rb:3:in `<top (required)>'\r\n\tfrom /usr/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\r\n\tfrom /usr/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'\r\n\tfrom /var/lib/gems/1.9.1/gems/puppet-4.10.1/lib/puppet/util/command_line.rb:12:in `<top (required)>'\r\n{noformat}\r\n\r\nThe problem is {{Gem::Version.new(RUBY_VERSION)}}, which apparently tries to {{strip!}} a frozen string.\r\n\r\nA common pattern is to {{dup}} the string.","closed_at":"2017-06-14T06:18:44.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7523","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-14T06:18:44.000-0700","timestamp":1652285405.520614,"priority":"Normal","status_category":"Done","pull_request":5863},{"issue_id":"188174","title":"A regex literal for matching backslashes causes a lexer error","url":"https://tickets.puppetlabs.com/browse/PUP-7475","created_at":"2017-04-26T18:50:53.000-0700","number":"PUP-7475","body":"Attempting to declare a regex literal for matching a single backslash results in a lexer error when the manifest is parsed.\r\n\r\n\r\nh2. Reproduction Case\r\n\r\nApply the following manifest which multiplies backslashes within a windows path:\r\n\r\n{code:puppet}\r\n$win_path = \"c:\\\\some\\\\path\"\r\n$backslash = /\\\\/\r\n\r\n$escaped_path = regsubst($win_path, $backslash, '\\\\\\\\\\\\\\\\', 'G')\r\n\r\n\r\nnotice(\"Escaped path is: ${escaped_path}\")\r\n{code}\r\n\r\n\r\nh3. Outcome\r\n\r\nApplying the manifest results in a parser error coming from the lexer code.\r\n\r\n{noformat}\r\n# puppet apply regex_test.pp --trace\r\nError: Could not parse for environment production: no implicit conversion of nil into String on node pe-201643-master.puppetdebug.vlan\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/lexer2.rb:380:in `+'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/lexer2.rb:380:in `block in initialize'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/lexer2.rb:710:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/lexer2.rb:710:in `scan'\r\n/opt/puppetlabs/puppet/lib/ruby/2.1.0/racc/parser.rb:319:in `_racc_yyparse_c'\r\n/opt/puppetlabs/puppet/lib/ruby/2.1.0/racc/parser.rb:319:in `yyparse'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/parser_support.rb:240:in `_parse'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/parser_support.rb:84:in `parse_file'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/evaluating_parser.rb:41:in `parse_file'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/e4_parser_adapter.rb:31:in `parse'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/node/environment.rb:512:in `perform_initial_import'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/node/environment.rb:236:in `known_resource_types'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:762:in `block in initvars'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:241:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:760:in `initvars'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:422:in `initialize'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:33:in `new'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:33:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:266:in `block (2 levels) in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:264:in `block in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:223:in `block in benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/2.1.0/benchmark.rb:294:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:222:in `benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:262:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:53:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:194:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:256:in `block in main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:241:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:225:in `main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:170:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:540:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:132:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\n{noformat}\r\n\r\nh3. Expected Outcome\r\n\r\n{noformat}\r\nNotice: Scope(Class[main]): Escaped path is: c:\\\\some\\\\path\r\n{noformat}\r\n\r\nh3. Recommended Workaround\r\n\r\nEnclosing the backslashes in a capture group allows a regex literal to be constructed:\r\n\r\n{code:puppet}\r\n$backslash = /(\\\\)/\r\n{code}","closed_at":"2017-06-14T06:18:45.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7475","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-14T06:18:45.000-0700","timestamp":1652285405.622168,"priority":"Normal","status_category":"Done","pull_request":5832},{"issue_id":"184802","title":"regression: epp parameter with default expression = undef  does not take","url":"https://tickets.puppetlabs.com/browse/PUP-7436","created_at":"2017-04-07T08:34:34.000-0700","number":"PUP-7436","body":"with puppet 4.8.3 and older versions the following code generated an empty notice:\r\n\r\n{code:java}\r\nnotice(inline_epp('<%- | Optional[String] $path = undef, | -%><%= $path %>', {}))\r\n{code}\r\n\r\nwith 4.10.0 and at least 4.9.4 the value of the fact 'path' is returned.","closed_at":"2017-06-14T06:18:45.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7436","labels":"regression;resolved-issue-added","state":"Closed","updated_at":"2017-06-14T06:18:45.000-0700","timestamp":1652285405.725865,"priority":"Normal","status_category":"Done","pull_request":5816},{"issue_id":"149231","title":"ensure => latest doesn't work with enablerepo install_options for package resource","url":"https://tickets.puppetlabs.com/browse/PUP-6656","created_at":"2016-08-25T18:22:48.000-0700","number":"PUP-6656","body":"Consider the following situation:\r\n\r\nI want to update nodejs package to the latest version with Puppet. I have two repos - {{epel}} and {{nodesource}} - that contain the package. I want it to update using the {{nodesource}} repo.\r\n\r\nThis is the manifest that I used:\r\n\r\n{code}\r\npackage { 'nodejs':\r\n  ensure          => 'latest',\r\n  install_options => [ {'--disablerepo' => '*', '--enablerepo' => 'nodesource'}],\r\n}\r\n{code} \r\n\r\nI ran this manifest and it did nothing - doesn't work. The package was not updated. It works if I just do {{yum --disablerepo=* --enablerepo=nodesource update nodejs}}\r\n\r\n{code}\r\n\r\n========================================================================================\r\n Package        Arch           Version                         Repository          Size\r\n========================================================================================\r\nUpdating:\r\n nodejs         x86_64         1:4.5.0-1nodesource.el6         nodesource         8.7 M\r\n\r\nTransaction Summary\r\n========================================================================================\r\nUpgrade       1 Package(s)\r\n\r\nTotal download size: 8.7 M\r\nIs this ok [y/N]:\r\n\r\n\r\n{code}\r\n\r\nIs this a normal behavior when using {{enablerepo}} with {{ensure => latest}} or is this a bug?\r\n\r\nThanks.","closed_at":"2017-06-14T06:18:45.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6656","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-14T06:18:45.000-0700","timestamp":1652285405.830242,"priority":"Normal","status_category":"Done","pull_request":5643},{"issue_id":"193934","title":"It is impossible to navigate an integer keyed Hiera hash using dotted keys","url":"https://tickets.puppetlabs.com/browse/PUP-7612","created_at":"2017-06-01T00:45:37.000-0700","number":"PUP-7612","body":"With the fix of PUP-7594, it is now possible to use hashes with integer keys in Hiera. Those keys can however not be navigated using a dotted key with integer numbers in it. I.e.\r\n{code:yaml}\r\nports:\r\n  80:\r\n    test: test\r\n{code}\r\ncannot be navigated using the key 'ports.80'. This is because integers in dotted keys are presumed to be positional indexes in arrays, not keys in hashes.\r\n\r\nIt should be possible to navigate a hash containing integer keys. A hash containing strings that represent integers should also be possible to navigate, but then, the integer in the dotted key must be quoted. E.g.\r\n{code:yaml}\r\nports:\r\n  \"80\":\r\n    test: test\r\n{code}\r\nshould not be found by key {{ports.80}}. Instead, {{ports.'80'}} must be used.\r\n","closed_at":"2017-06-14T06:18:46.000-0700","comments":18,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7612","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-14T06:18:46.000-0700","timestamp":1652285406.045005,"priority":"Normal","status_category":"Done","pull_request":5936},{"issue_id":"194232","title":"Leftover /opt/puppet contents cause upgrades to fail on locale/config.yaml","url":"https://tickets.puppetlabs.com/browse/PUP-7617","created_at":"2017-06-02T14:25:00.000-0700","number":"PUP-7617","body":"If there happens to be any leftover files from older PE installations, it will cause the PE 2017.2.1 installation to fail because Puppet will end up pulling the wrong locale path:\r\n\r\n\r\n{code:java}\r\n2017-05-29 14:42:51,320 Running command: /opt/puppetlabs/puppet/bin/puppet infrastructure configure  --detailed-exitcodes --modulepath /opt/puppetlabs/server/data/enterprise/modules \r\n/opt/puppetlabs/puppet/lib/ruby/2.1.0/psych.rb:464:in `initialize': No such file or directory @ rb_sysopen - /opt/puppet/share/locale/config.yaml (Errno::ENOENT)\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/2.1.0/psych.rb:464:in `open'\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/2.1.0/psych.rb:464:in `load_file'\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/gems/2.1.0/gems/gettext-setup-0.20/lib/gettext-setup/gettext_setup.rb:21:in `initialize'\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:80:in `singleton class'\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:55:in `<module:Puppet>'\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:49:in `<top (required)>'\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require'\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require'\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:12:in `<top (required)>'\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require'\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/2.1.0/rubygems/core_ext/kernel_require.rb:55:in `require'\r\n\tfrom /opt/puppetlabs/puppet/bin/puppet:4:in `<main>'\r\n* /opt/puppetlabs/puppet/bin/puppet infrastructure configure  --detailed-exitcodes --modulepath /opt/puppetlabs/server/data/enterprise/modules \r\n* returned: 1\r\n{code}\r\n\r\nThis appears to be due to how Puppet searches for the locale directory in https://github.com/puppetlabs/puppet/blob/4.10.1/lib/puppet.rb#L56-L73.  https://github.com/puppetlabs/puppet/blob/4.10.1/lib/puppet.rb#L60 will set {{posix_system_locale_path}} to {{/opt/puppetlabs/puppet/share/locale}}, which is the correct path.  The problem is that https://github.com/puppetlabs/puppet/blob/4.10.1/lib/puppet.rb#L62 runs regardless of the Puppet master not being a Windows machine and sets {{win32_system_locale_path}} to {{/opt/puppet/share/locale/config.yaml}} (because that would be /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/../../../../../puppet/share/locale).\r\n\r\nSince {{win32_system_locale_path}} is checked before {{posix_system_locale_path}} in the if/else block at https://github.com/puppetlabs/puppet/blob/4.10.1/lib/puppet.rb#L64-L73, the \"windows\" path will be used.  If the old directory still exists, this path gets passed to GettextSetup, which leads to the failure.\r\n\r\nI'd think the fix would be to add logic to https://github.com/puppetlabs/puppet/blob/4.10.1/lib/puppet.rb#L68 to check if we are actually on a Windows system \r\n\r\nor\r\n\r\nMove the {{posix_system_locale_path}} check above the {{win32_system_locale_path}} one in the if/else block.","closed_at":"2017-06-14T06:18:46.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7617","labels":"maintenance;triage","state":"Closed","updated_at":"2017-06-14T06:18:46.000-0700","timestamp":1652285406.150531,"priority":"Normal","status_category":"Done","pull_request":5941},{"issue_id":"187950","title":"lookups within hiera data values break %{literal('%')}","url":"https://tickets.puppetlabs.com/browse/PUP-7492","created_at":"2017-04-26T08:15:06.000-0700","number":"PUP-7492","body":"consider the hiera data fragment:\r\n{code}\r\n---\r\nsome_text: \"%{alias('label_format')}\"\r\nlabel_format: \"%{literal('%')}{vpc}_pub%{literal('%')}{az}\"\r\n{code}\r\n---\r\nWhen you lookup the value 'label_format' you correctly obtain the string\r\n{code}\r\n\"%{vpc}_pub%{az}\"\r\n{code}\r\nas the value.  However, if you lookup the value 'some_text' then the result depends on whether\r\n{code}\r\n%{vpc}\r\n{code}\r\nand\r\n{code}\r\n%{az}\r\n{code}\r\nhave valid substitutions.  Without facts or variables, the current result from the lookup is the string \"_pub\"\r\n \r\nUntil this bug is fixed, the utility of the %{literal('%')} function is limited to being used in values that are only directly requested.","closed_at":"2017-06-14T06:18:46.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7492","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-14T06:18:46.000-0700","timestamp":1652285406.256147,"priority":"Normal","status_category":"Done","pull_request":5843},{"issue_id":"191244","title":"Hiera 5 eyaml_lookup_key options gets overwritten when multiple entries are used.","url":"https://tickets.puppetlabs.com/browse/PUP-7543","created_at":"2017-05-16T09:28:44.000-0700","number":"PUP-7543","body":"When using Hiera 5 with the same Hierarchy file name at the global and environment level, lookups fail to use the options associated with the global level It appears that the global file path is used, but the environment options are used. When using eyaml, this results in using the wrong keys on the eyaml file.\r\n\r\n*Example*\r\n\r\nGlobal hiera.yaml\r\n{code}\r\n---\r\nversion: 5\r\ndefaults:\r\n  datadir: data\r\n\r\nhierarchy:\r\n  - name: \"Global secrets\"\r\n    lookup_key: eyaml_lookup_key\r\n    path: \"secrets.eyaml\"\r\n    options:\r\n      pkcs7_private_key: /etc/puppetlabs/puppet/keys/private_key.pkcs7.pem\r\n      pkcs7_public_key: /etc/puppetlabs/puppet/keys/public_key.pkcs7.pem\r\n{code}\r\n\r\nEnvironment hiera.yaml\r\n{code}\r\n---\r\nversion: 5\r\ndefaults:\r\n  datadir: data\r\n\r\nhierarchy:\r\n  - name: \"Environment secrets\"\r\n    lookup_key: eyaml_lookup_key\r\n    path: \"secrets.eyaml\"\r\n    options:\r\n      pkcs7_private_key: /etc/puppetlabs/code/environments/production/keys/private_key.pkcs7.pem\r\n      pkcs7_public_key: /etc/puppetlabs/code/environments/production/keys/public_key.pkcs7.pem\r\n{code}\r\n\r\nLooking up a key which is both the environment and global secrets.eyaml\r\n{code}\r\n# puppet lookup secret --explain\r\nError: Could not run: bad decrypt\r\n{code}\r\n\r\nLooking up a nonexistent key\r\n{code}\r\n# puppet lookup doesnotexist --explain\r\nSearching for \"doesnotexist\"\r\n  Global Data Provider (hiera configuration version 5)\r\n    Using configuration \"/etc/puppetlabs/puppet/hiera.yaml\"\r\n    Hierarchy entry \"Global secrets\"\r\n      Path \"/etc/puppetlabs/puppet/data/secrets.eyaml\"\r\n        Original path: \"secrets.eyaml\"\r\n        No such key: \"doesnotexist\"\r\n  Environment Data Provider (hiera configuration version 5)\r\n    Using configuration \"/etc/puppetlabs/code/environments/production/hiera.yaml\"\r\n    Hierarchy entry \"Environment secrets\"\r\n      Path \"/etc/puppetlabs/code/environments/production/data/secrets.eyaml\"\r\n        Original path: \"secrets.eyaml\"\r\n        No such key: \"doesnotexist\"\r\nFunction lookup() did not find a value for the name 'doesnotexist'\r\n{code}\r\n\r\nAn environment specific key works when not defined in the global eyaml file. \r\n{code}\r\n# puppet lookup envsecret --explain\r\nWarning: Unknown variable: 'creates_path'. at /opt/puppetlabs/puppet/modules/pe_staging/manifests/extract.pp:56:22\r\nSearching for \"envsecret\"\r\n  Global Data Provider (hiera configuration version 5)\r\n    Using configuration \"/etc/puppetlabs/puppet/hiera.yaml\"\r\n    Hierarchy entry \"Global secrets\"\r\n      Path \"/etc/puppetlabs/puppet/data/secrets.eyaml\"\r\n        Original path: \"secrets.eyaml\"\r\n        No such key: \"envsecret\"\r\n  Environment Data Provider (hiera configuration version 5)\r\n    Using configuration \"/etc/puppetlabs/code/environments/production/hiera.yaml\"\r\n    Hierarchy entry \"Environment secrets\"\r\n      Path \"/etc/puppetlabs/code/environments/production/data/secrets.eyaml\"\r\n        Original path: \"secrets.eyaml\"\r\n        Found key: \"envsecret\" value: \"environmentsecret\"\r\n{code}\r\n\r\nA global specific key fails\r\n{code}\r\n# puppet lookup globalsecret --explain\r\nError: Could not run: bad decrypt\r\n{code}\r\n\r\n\r\n*Steps to Reproduce*\r\n# Install 2017.2.1\r\n# Install eyaml\r\n# Configure the global hiera.yaml as above\r\n# Create eyaml keys for the global eyaml\r\n# Create encrypted keys in the global data/secrets.eyaml\r\n# Configure the environment hiera.yaml as above\r\n# Create eyaml keys for the environment eyaml\r\n# Create encrypted keys in the environment data/secrets.eyaml\r\n# Lookup keys defined in the global secrets.eyaml\r\n\r\n\r\n","closed_at":"2017-06-14T06:18:46.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7543","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-14T06:18:46.000-0700","timestamp":1652285406.360998,"priority":"Normal","status_category":"Done","pull_request":5933},{"issue_id":"74031","title":"Port PUP-3388 \"Issue Creating Multiple Mirrors in Zpool Resource\" to PUP 3.8","url":"https://tickets.puppetlabs.com/browse/PUP-4345","created_at":"2015-03-31T09:44:14.000-0700","number":"PUP-4345","body":"This is a new ticket to port the fixes done for PUP-3388 to release PUP 3.8.0\r\n\r\nBug in the mirror property under zpool resource\r\n\r\nhttps://docs.puppetlabs.com/references/latest/type.html#zpool-attribute-mirror\r\n\r\nmirror => [\"disk1 disk2\", \"disk3 disk4\"],\r\n\r\nIn the Previous version It took that string value as a single array and tried to find a drive named \"disk1 disk2\" and also wouldn't attach the word mirror to \"disk3 disk4\"\r\n\r\nrisk: medium\r\nprobability: medium (zpool mirror array)\r\nseverity: low (work arounds are fairly obvious)\r\ntest layer: acceptance","closed_at":"2017-06-19T16:35:00.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4345","labels":"","state":"Resolved","updated_at":"2017-06-19T16:35:00.000-0700","timestamp":1652285420.207956,"priority":"Normal","status_category":"Done","pull_request":3782},{"issue_id":"94494","title":"The sshkey Type's Default Target for Mac OS X 10.11 (El Capitan) is Incorrect","url":"https://tickets.puppetlabs.com/browse/PUP-5058","created_at":"2015-08-20T15:16:58.000-0700","number":"PUP-5058","body":"I'm using exported resources to manage the ssh_known_hosts file on a mixed network of Mac OS X and RHEL systems. Previously, Mac OS X stored SSH files at the top level of /etc/, so the previous default target value of /etc/ssh_known_hosts was correct. However, in El Capitan, SSH configuration files are now stored in /etc/ssh. It seems unlikely that this will change in the final release. The workaround is to specify the value \"/etc/ssh/ssh_known_hosts\" as the target attribute for the sshkey type on each host. This is a little awkward, since I have to set it differently for my existing Yosemite systems that still use /etc/ssh_known_hosts. I'm using something that looks a little like this right now in my test environment, which is propagating through my system as we speak:\r\n\r\n{noformat}\r\n        @@sshkey {\r\n                $fqdn:\r\n                        type => ssh-rsa,\r\n                        host_aliases => $fqdn ? {\r\n                                default                     => [$hostname, $ipaddress]\r\n                        },\r\n                        target => \"/etc/ssh/ssh_known_hosts\",\r\n                        key => $sshrsakey\r\n        }\r\n\r\n        Sshkey <<| |>>\r\n{noformat}","closed_at":"2017-06-20T10:49:10.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5058","labels":"","state":"Closed","updated_at":"2017-06-20T10:49:10.000-0700","timestamp":1652285420.313746,"priority":"Normal","status_category":"Done","pull_request":5715},{"issue_id":"119837","title":"Make error message for multiple validation errors actionable","url":"https://tickets.puppetlabs.com/browse/PUP-6006","created_at":"2016-03-03T15:45:03.000-0800","number":"PUP-6006","body":"During rspec tests while migrating from Puppet 3 to Puppet 4, I encountered an error that was non-obvious to me.\r\n{code}\r\n24) wiki Set common params should contain Firewall[105 searchd]\r\n     Failure/Error: it { is_expected.to contain_firewall('105 searchd') }\r\n     Puppet::ParseErrorWithIssue:\r\n       Found 2 errors. Giving up in <PATH>/puppet/controlrepo/dist/wiki/spec/fixtures/modules/wiki/manifests/init.pp on node chi-build04.mss.local\r\n{code}\r\nThe error message that I focused on was \"Found 2 errors. Giving up in ...\" It doesn't say, or show, the errors. Eventually I determined this came from https://github.com/puppetlabs/puppet/blob/master/lib/puppet/pops/issue_reporter.rb#L72 due to some help from Henrik on IRC, at which point I realized I was running \"puppet parser validate\" against the file instead of \"bundle exec puppet parser validate\" (the node is still on v3.7 as we're not migrating yet).\r\n\r\nI feel an error message such as \"Found # errors during parser validation\" would be an improvement here. If the actual errors can be floated up to rspec-puppet even better.","closed_at":"2017-06-20T11:58:51.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6006","labels":"","state":"Closed","updated_at":"2017-06-20T11:58:51.000-0700","timestamp":1652285420.521693,"priority":"Normal","status_category":"Done","pull_request":5557},{"issue_id":"21689","title":"metadata.json is parsed twice","url":"https://tickets.puppetlabs.com/browse/PUP-5027","created_at":"2013-12-18T01:50:08.000-0800","number":"PUP-5027","body":"When an instance of class Puppet::Module is created, the initialize method will first call has_metadata? to check if the metadata.json file is present and valid. This method will do a full parse of the file to check its validity. Next, the initializer will call the method load_metadata. It parses the same file once again.\r\n\r\nSuggestion:\r\n# Add a validity check to the load_metadata method by adding a begin/rescue around its PSON.parse\r\n# Remove the call to has_metadata? from the initialize method","closed_at":"2017-06-20T11:59:51.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5027","labels":"","state":"Closed","updated_at":"2017-06-20T11:59:51.000-0700","timestamp":1652285420.624121,"priority":"Normal","status_category":"Done","pull_request":5505},{"issue_id":"166569","title":"Prevent incompatible encodings reaching Puppet::Parameter#format from ruby Etc module","url":"https://tickets.puppetlabs.com/browse/PUP-7021","created_at":"2016-12-15T15:13:28.000-0800","number":"PUP-7021","body":"[Puppet::Parameter#format|https://github.com/puppetlabs/puppet/blob/83909490a047b15f7fd4ca4f72490112740a7aec/lib/puppet/parameter.rb#L541-L543] currently does not check if the strings it is interpolating are of incompatible encodings.\r\n\r\nThis method is used, among other places, in the resource harness when [setting the message for failed change events|https://github.com/puppetlabs/puppet/blob/83909490a047b15f7fd4ca4f72490112740a7aec/lib/puppet/transaction/resource_harness.rb#L147-L149]. If the strings contain incompatible encodings (i.e., they cannot be concatenated) the format method will fail, the event will not contain a message, and then it will fail to be logged.\r\n\r\nThis also results in error messages that look like this:\r\n{code}\r\nError: /Stage[main]/Main/Node[ubuntu16.localdomain]/User[foo]: Could not evaluate: Puppet::Util::Log requires a message\r\n{code}\r\n\r\n*Notes*\r\n* After diving further into this, this form of problem is scattered all through puppet - the concatenation of strings without regard to encoding. The deeper problem is that strings are entering the system in incompatible encodings to begin with. The problem-area that gave rise to this specific bug is the nameservice provider, and specifically it's reliance on the {{Etc}} module in ruby, which can return strings in default external encoding which are then sent around puppet to be compared and munged with utf-8 strings. Thus this ticket is now re-scoped from it's original (smaller context) to include a broader fix of setting strings incoming from {{Etc}} to utf-8.\r\n\r\n*In Scope*\r\n* Anywhere we take strings in the from the {{Etc}} module in a provider, these strings should have UTF-8 encoding\r\n","closed_at":"2017-06-20T14:47:24.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7021","labels":"","state":"Closed","updated_at":"2017-06-20T14:47:24.000-0700","timestamp":1652285420.830058,"priority":"Major","status_category":"Done","pull_request":5634},{"issue_id":"189770","title":"Remove Puppet::Log alias to Puppet::Util::Log","url":"https://tickets.puppetlabs.com/browse/PUP-7502","created_at":"2017-05-08T10:42:08.000-0700","number":"PUP-7502","body":"At the bottom of Puppet::Util::Log:\r\n{code}\r\n# This is for backward compatibility from when we changed the constant to Puppet::Util::Log\r\n# because the reports include the constant name.  Apparently the alias was created in\r\n# March 2007, should could probably be removed soon.\r\nPuppet::Log = Puppet::Util::Log\r\n{code}\r\n\r\nThat is from https://github.com/puppetlabs/puppet/commit/1c6d57e94196c8238a1609858bad5e5db15d1f0e, added in 0.26.\r\n\r\nWe have a few places in the code where we reference Puppet::Log, and many many more that reference Puppet::Util::Log\r\n\r\nBefore Puppet::Log proliferates further lets remove it and do the cleanup in the code?","closed_at":"2017-06-20T18:17:52.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7502","labels":"","state":"Closed","updated_at":"2017-06-20T18:17:52.000-0700","timestamp":1652285421.032959,"priority":"Normal","status_category":"Done","pull_request":5918},{"issue_id":"22649","title":"Windows Group and User fail during deletion even though it is successful","url":"https://tickets.puppetlabs.com/browse/PUP-1279","created_at":"2013-12-30T10:26:52.000-0800","number":"PUP-1279","body":"This is due to commit being called in the flush method when it should not be.\r\n\r\nSteps to reproduce:\r\n\r\n 1. Create a user `puppet apply -e \"user{'FakeTestUser': ensure => present, password => 'nobodyknowssupersecret', }\"\r\n 2. Delete a user - `puppet apply -e \"user{'FakeTestUser': ensure => absent, }\"\r\n\r\n{noformat}\r\nNotice: /User[FakeTestUser]/ensure: removed\r\nError: /User[FakeTestUser]: Could not evaluate: User update failed: ADSI connection error: failed to parse display name of moniker `WinNT://./FakeTestUser,user'\r\n    HRESULT error code:0x800708ad\r\n      The user name could not be found.\r\nC:/code/puppetlabs/puppet/lib/puppet/util/adsi.rb:101:in `rescue in commit'\r\nC:/code/puppetlabs/puppet/lib/puppet/util/adsi.rb:98:in `commit'\r\nC:/code/puppetlabs/puppet/lib/puppet/provider/user/windows_adsi.rb:54:in `flush'\r\n\r\nC:/code/puppetlabs/puppet/lib/puppet/type.rb:963:in `flush'\r\nC:/code/puppetlabs/puppet/lib/puppet/transaction/resource_harness.rb:144:in `evaluate'\r\nC:/code/puppetlabs/puppet/lib/puppet/transaction.rb:161:in `apply'\r\nC:/code/puppetlabs/puppet/lib/puppet/transaction.rb:174:in `eval_resource'\r\nC:/code/puppetlabs/puppet/lib/puppet/transaction.rb:104:in `call'\r\nC:/code/puppetlabs/puppet/lib/puppet/transaction.rb:104:in `block (2 levels) in evaluate'\r\nC:/code/puppetlabs/puppet/lib/puppet/util.rb:354:in `block in thinmark'\r\nC:/ruby193/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\nC:/code/puppetlabs/puppet/lib/puppet/util.rb:353:in `thinmark'\r\nC:/code/puppetlabs/puppet/lib/puppet/transaction.rb:104:in `block in evaluate'\r\nC:/code/puppetlabs/puppet/lib/puppet/graph/relationship_graph.rb:118:in `traverse'\r\nC:/code/puppetlabs/puppet/lib/puppet/transaction.rb:95:in `evaluate'\r\nC:/code/puppetlabs/puppet/lib/puppet/resource/catalog.rb:164:in `block in apply'\r\n\r\nC:/code/puppetlabs/puppet/lib/puppet/util/log.rb:147:in `with_destination'\r\nC:/code/puppetlabs/puppet/lib/puppet/transaction/report.rb:108:in `as_logging_destination'\r\nC:/code/puppetlabs/puppet/lib/puppet/resource/catalog.rb:163:in `apply'\r\nC:/code/puppetlabs/puppet/lib/puppet/configurer.rb:125:in `block in apply_catalog'\r\nC:/code/puppetlabs/puppet/lib/puppet/util.rb:182:in `block in benchmark'\r\nC:/ruby193/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\nC:/code/puppetlabs/puppet/lib/puppet/util.rb:181:in `benchmark'\r\nC:/code/puppetlabs/puppet/lib/puppet/configurer.rb:124:in `apply_catalog'\r\nC:/code/puppetlabs/puppet/lib/puppet/configurer.rb:190:in `run'\r\nC:/code/puppetlabs/puppet/lib/puppet/application/apply.rb:273:in `apply_catalog'\r\n\r\nC:/code/puppetlabs/puppet/lib/puppet/application/apply.rb:223:in `main'\r\nC:/code/puppetlabs/puppet/lib/puppet/application/apply.rb:151:in `run_command'\r\nC:/code/puppetlabs/puppet/lib/puppet/application.rb:364:in `block (2 levels) in run'\r\nC:/code/puppetlabs/puppet/lib/puppet/application.rb:457:in `plugin_hook'\r\nC:/code/puppetlabs/puppet/lib/puppet/application.rb:364:in `block in run'\r\nC:/code/puppetlabs/puppet/lib/puppet/util.rb:511:in `exit_on_fail'\r\nC:/code/puppetlabs/puppet/lib/puppet/application.rb:364:in `run'\r\nC:/code/puppetlabs/puppet/lib/puppet/util/command_line.rb:132:in `run'\r\nC:/code/puppetlabs/puppet/lib/puppet/util/command_line.rb:86:in `execute'\r\nC:/code/puppetlabs/puppet/bin/puppet:4:in `&lt;top (required)&gt;'\r\nC:/ruby193/lib/ruby/gems/1.9.1/bin/puppet:23:in `load'\r\nC:/ruby193/lib/ruby/gems/1.9.1/bin/puppet:23:in `&lt;main&gt;'\r\n{noformat}\r\n","closed_at":"2017-06-27T11:16:06.000-0700","comments":20,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1279","labels":"redmine;windows","state":"Closed","updated_at":"2017-06-27T11:16:06.000-0700","timestamp":1652285421.946395,"priority":"Normal","status_category":"Done","pull_request":3770},{"issue_id":"191929","title":"Add CLI flag to pass job-id to puppet agent","url":"https://tickets.puppetlabs.com/browse/PUP-7575","created_at":"2017-05-18T14:31:19.000-0700","number":"PUP-7575","body":"In order to actually thread job-id from orchestrator through the agent to PuppetDB, we need to have a facility to provide the job-id to the agent. As of PUP-7149, the code exists internally in puppet to handle job-id, but there's no way to pass it in from the outside. That ticket was contingent on a refactor of the way pxp-agent interfaces with puppet to start using the API instead of the command line. That work is deferred due to complexity, so the revised solution is to just provide a flag to set job-id on the command line.","closed_at":"2017-06-28T12:20:40.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7575","labels":"","state":"Closed","updated_at":"2017-06-28T12:20:40.000-0700","timestamp":1652285422.254464,"priority":"Normal","status_category":"Done","pull_request":5888},{"issue_id":"192705","title":"\"Classes are not virtualizable\" warning with resource-type non-virtual class declaration","url":"https://tickets.puppetlabs.com/browse/PUP-7590","created_at":"2017-05-24T04:33:55.000-0700","number":"PUP-7590","body":"On master, a basic manifest triggers a warning for virtualizable classes, which I think is incorrect:\r\n\r\ntest.pp:\r\n\r\n{noformat}\r\nclass a { }\r\nclass { 'a': }\r\n{noformat}\r\n\r\n{noformat}\r\n$ be puppet parser validate test.pp\r\nWarning: Classes are not virtualizable at test.pp:2:1\r\n{noformat}\r\n\r\nPrior to PUP-1606 being merged into master, this didn't occur. This warning does not appear to occur on the stable branch with PUP-1606, only on master with PUP-1606, so may only affect Puppet 5.","closed_at":"2017-06-28T12:20:40.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7590","labels":"","state":"Closed","updated_at":"2017-06-28T12:20:40.000-0700","timestamp":1652285422.355091,"priority":"Major","status_category":"Done","pull_request":5909},{"issue_id":"193310","title":"StringConverter should be more diligent about using single quotes ","url":"https://tickets.puppetlabs.com/browse/PUP-7603","created_at":"2017-05-29T06:42:30.000-0700","number":"PUP-7603","body":"The `StringConverter`, when converting strings to their '%p' format, will currently use double quotes in many cases where it is unnecessary. In essence, the only time that double qoutes are needed when producing a string, is when the string contains control characters (codepoint < 0x20) or non-ascii characters (codepoint > 0x7f). In all other cases, it's desirable to use single quotes since the representation gets more compact and is more efficient to parse.","closed_at":"2017-06-28T12:20:40.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7603","labels":"","state":"Closed","updated_at":"2017-06-28T12:20:40.000-0700","timestamp":1652285422.560075,"priority":"Normal","status_category":"Done","pull_request":5924},{"issue_id":"193883","title":"Can't turn off deprecation warnings","url":"https://tickets.puppetlabs.com/browse/PUP-7611","created_at":"2017-05-31T14:52:13.000-0700","number":"PUP-7611","body":"There are a few different issues with how {{warn_once}} is implemented that prevent deprecation warnings from being silenced.\r\n\r\n# There are typos, e.g. {{deprecatation}}\r\n# We use both symbols and strings:\r\n{noformat}\r\nPuppet.warn_once('deprecation', 'AST::ResourceParam', _('Use of Puppet::Parser::AST::ResourceParam is deprecated and not fully functional'))\r\nPuppet.warn_once(:deprecation, \"metadata.json#data_provider-#{module_name}\",\r\n{noformat}\r\n# The {{warn_once}} logic doesn't account for string vs symbol, which probably wasn't a problem before we removed the symbol string monkey_patch:\r\n{code:ruby}\r\n    return if Puppet[:disable_warnings].include?(kind)\r\n{code}\r\n# The {{disable_warnings}} setting only accepts plural {{deprecations}}, but all of the {{warn_once}} call sites use singular {{deprecation}}, so the {{include?}} check never matches\r\n# There is another {{warnonce}} method defined in {{Puppet::Util::Warnings}}.\r\n\r\nBut the main issue is that you can't turn deprecations off:\r\n\r\n{code:puppet}\r\nnotify { '1':\r\n  message => strftime(\"%s\")\r\n}\r\nnotify { '2':\r\n  message => strftime(\"%s\")\r\n}\r\n{code}\r\n\r\n{noformat}\r\n$ bundle exec puppet apply warnings.pp --disable_warnings deprecations\r\n/Users/josh/work/puppet/.bundle/ruby/2.4.0/gems/CFPropertyList-2.2.8/lib/cfpropertylist/rbCFTypes.rb:24: warning: constant ::Fixnum is deprecated\r\nWarning: The argument signature (String format, [String timezone]) is deprecated for #strfime. See #strftime documentation and Timespan type for more info\r\n   (file & line not available)\r\nNotice: Compiled catalog for chara.corp.puppetlabs.net in environment production in 0.02 seconds\r\nNotice: 1496267306\r\nNotice: /Stage[main]/Main/Notify[1]/message: defined 'message' as '1496267306'\r\nNotice: 1496267306\r\nNotice: /Stage[main]/Main/Notify[2]/message: defined 'message' as '1496267306'\r\nNotice: 1496267306\r\n{noformat}\r\n\r\n\r\n","closed_at":"2017-06-28T12:20:40.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7611","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-28T12:20:40.000-0700","timestamp":1652285422.659506,"priority":"Normal","status_category":"Done","pull_request":5959},{"issue_id":"183104","title":"handle trailing slashes in references between file resources","url":"https://tickets.puppetlabs.com/browse/PUP-7402","created_at":"2017-03-28T14:51:39.000-0700","number":"PUP-7402","body":"This change:\r\nhttps://github.com/puppetlabs/puppet/commit/3577fc913373f05b6c58fd7389e097ba7271c147/lib/puppet/parser/compiler/catalog_validator/relationship_validator.rb#diff-0\r\n\r\nchanged the legal relationships between file resources with trailing slashes. Specifically, this manifest\r\n\r\n{code}\r\nfile {\"/home/wyatt/foo\":\r\n  ensure => directory,\r\n  require => File[\"/home/wyatt/foo/\"],\r\n}\r\n{code}\r\n\r\nwill compile on Puppet < 5, and store a catalog in PuppetDB, while presenting an error to the user about a circular dependency. On Puppet 5, the same catalog will fail compilation because it is considering the path with the trailing slash to be different than the one in the resource title, meaning the referenced resource is considered missing. Consequently, the catalog is not stored in PuppetDB.\r\n\r\nThis issue was caught by the PuppetDB spec tests around this case here:\r\nhttps://github.com/puppetlabs/puppetdb/blob/master/puppet/spec/unit/indirector/catalog/puppetdb_spec.rb#L623\r\n\r\nAfter talking it over with [~henrik.lindberg], we determined that the tests should probably be ported to Puppet and that Puppet compilation needs to handle the trailing slash in a backwards compatible way.","closed_at":"2017-06-28T12:20:41.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7402","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-28T12:20:41.000-0700","timestamp":1652285422.761314,"priority":"Normal","status_category":"Done","pull_request":5788},{"issue_id":"187930","title":"misleading error message with classname errors ","url":"https://tickets.puppetlabs.com/browse/PUP-7471","created_at":"2017-04-26T07:06:36.000-0700","number":"PUP-7471","body":"{code}\r\n$ bundle exec puppet --version\r\n4.10.0\r\n$ bundle exec puppet apply -e \"class 'foo' {}\" --trace\r\nError: Could not parse for environment production: 'class' is not a valid classname at line 1:1 on node davids\r\n/home/david/gems/ruby/2.3.0/gems/puppet-4.10.0/lib/puppet/pops/parser/parser_support.rb:73:in `error'\r\negrammar.ra:659:in `_reduce_190'\r\n/home/david/gems/ruby/2.3.0/gems/puppet-4.10.0/lib/puppet/pops/parser/lexer2.rb:712:in `scan'\r\n/usr/lib/ruby/2.3.0/racc/parser.rb:320:in `_racc_yyparse_c'\r\n/usr/lib/ruby/2.3.0/racc/parser.rb:320:in `yyparse'\r\n/home/david/gems/ruby/2.3.0/gems/puppet-4.10.0/lib/puppet/pops/parser/parser_support.rb:240:in `_parse'\r\n/home/david/gems/ruby/2.3.0/gems/puppet-4.10.0/lib/puppet/pops/parser/parser_support.rb:134:in `parse_string'\r\n/home/david/gems/ruby/2.3.0/gems/puppet-4.10.0/lib/puppet/pops/parser/evaluating_parser.rb:28:in `parse_string'\r\n/home/david/gems/ruby/2.3.0/gems/puppet-4.10.0/lib/puppet/parser/e4_parser_adapter.rb:29:in `parse'\r\n/home/david/gems/ruby/2.3.0/gems/puppet-4.10.0/lib/puppet/node/environment.rb:507:in `perform_initial_import'\r\n/home/david/gems/ruby/2.3.0/gems/puppet-4.10.0/lib/puppet/node/environment.rb:247:in `known_resource_types'\r\n/home/david/gems/ruby/2.3.0/gems/puppet-4.10.0/lib/puppet/parser/compiler.rb:766:in `block in initvars'\r\n/home/david/gems/ruby/2.3.0/gems/puppet-4.10.0/lib/puppet/context.rb:65:in `override'\r\n/home/david/gems/ruby/2.3.0/gems/puppet-4.10.0/lib/puppet.rb:294:in `override'\r\n/home/david/gems/ruby/2.3.0/gems/puppet-4.10.0/lib/puppet/parser/compiler.rb:764:in `initvars'\r\n/home/david/gems/ruby/2.3.0/gems/puppet-4.10.0/lib/puppet/parser/compiler.rb:422:in `initialize'\r\n/home/david/gems/ruby/2.3.0/gems/puppet-4.10.0/lib/puppet/parser/compiler.rb:33:in `new'\r\n/home/david/gems/ruby/2.3.0/gems/puppet-4.10.0/lib/puppet/parser/compiler.rb:33:in `compile'\r\n/home/david/gems/ruby/2.3.0/gems/puppet-4.10.0/lib/puppet/indirector/catalog/compiler.rb:266:in `block (2 levels) in compile'\r\n/home/david/gems/ruby/2.3.0/gems/puppet-4.10.0/lib/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/home/david/gems/ruby/2.3.0/gems/puppet-4.10.0/lib/puppet/util/profiler.rb:51:in `profile'\r\n/home/david/gems/ruby/2.3.0/gems/puppet-4.10.0/lib/puppet/indirector/catalog/compiler.rb:264:in `block in compile'\r\n[...]\r\n$ bundle exec puppet apply -e \"class foo {}\"\r\nNotice: Compiled catalog for davids in environment production in 0.06 seconds\r\nNotice: Applied catalog in 0.03 seconds\r\n$ \r\n{code}\r\n\r\nPutting a String, instead of a Classname into the manifest produces the misleading error message \" 'class' is not a valid classname\". Emitting \" 'foo' is a String, not a class name\", would be much more informative, and help the user to figure out what's going wrong.\r\n\r\nInterestingly, a {{define}} with the same mistake, will complain \"Syntax error at 'foo'  at line 1:8 on node davids\", which is much more useful.","closed_at":"2017-06-28T12:20:41.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7471","labels":"","state":"Closed","updated_at":"2017-06-28T12:20:41.000-0700","timestamp":1652285422.965007,"priority":"Normal","status_category":"Done","pull_request":5892},{"issue_id":"192509","title":"TypeCalculator#infer should consider Hash and Array subclasses to be Runtime types.","url":"https://tickets.puppetlabs.com/browse/PUP-7587","created_at":"2017-05-22T23:26:39.000-0700","number":"PUP-7587","body":"The {{TypeCalcuclator}}, when inferring the type of an arbitrary value, will traverse the class inheritance chain when resolving types. The traversal stops when a class is recognized and when all else fails (and class {{Object}} is reached), the type is considered to be a {{Runtime}} type.\r\n\r\nThis works for most cases, but if someone would derive from a known class, such as {{Hash}} or {{Array}}, then the type of such instances will be inferred to {{Hash}} or {{Array}}, which is wrong. Since they are unkown classes, the inferred type must be {{Runtime}}.","closed_at":"2017-06-28T12:20:41.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7587","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-28T12:20:41.000-0700","timestamp":1652285423.066018,"priority":"Normal","status_category":"Done","pull_request":5900},{"issue_id":"194662","title":" puppet-master logcheck rule needs adjustment","url":"https://tickets.puppetlabs.com/browse/PUP-7625","created_at":"2017-06-06T08:03:41.000-0700","number":"PUP-7625","body":"Hi together, \r\n\r\nit seems the problem described in https://projects.puppetlabs.com/issues/5405 , which sadly has been closed without any change to the sources, is still valid for 4.10.1. \r\n\r\nIn short, ext/logcheck/puppet should be changed like: \r\n{noformat}\r\n-^\\w{3} [ :0-9]{11} [._[:alnum:]-]+ puppet-master\\[[0-9]+\\]: Compiled catalog for [._[:alnum:]-]+ in [.0-9]+ seconds$\r\n+^\\w{3} [ :0-9]{11} [._[:alnum:]-]+ puppet-master\\[[0-9]+\\]: Compiled catalog for [._[:alnum:]-]+ in environment [._[:alnum:]-]+ in [.[:digit:]]+ seconds$\r\n{noformat}\r\nDebian downstream is still patching the package accordingly. Sadly, this patch did not make it upstream (i.e. \"here\"). \r\n\r\nCheers, Oliver","closed_at":"2017-06-28T12:20:41.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7625","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-28T12:20:41.000-0700","timestamp":1652285423.1668,"priority":"Minor","status_category":"Done","pull_request":5965},{"issue_id":"194579","title":"Resource defaults and resource overrides can lead to incorrect parameter conflicts","url":"https://tickets.puppetlabs.com/browse/PUP-7623","created_at":"2017-06-05T15:02:19.000-0700","number":"PUP-7623","body":"The error message is:\r\n\r\n{noformat}\r\nError: Parameter 'require' is already set on Package[pip] by #<Puppet::Resource::Type:0x005570c96bc260> at /home/branan/.puppetlabs/etc/code/environments/production/modules/foo/manifests/init.pp:4; cannot redefine at /home/branan/.puppetlabs/etc/code/environments/production/site.pp:1 on node rycon.delivery.puppetlabs.net\r\n{noformat}\r\n\r\nThis was discovered while Ops was trying to upgrade to a pre-release hoyt build.\r\n\r\nSee the attached tarball for a minimal reproduction. This is an environment that can be untarred into a code dir and verified with {{puppet apply --debug --noop $CODEDIR/environments/repro/site.pp}}. The error only occurs when the resource override is in place. If the overridden parameters are inlined into the resource declaration, it works as expected.\r\n\r\nThis was apparently introduced as part of PUP-7484, and is in general related to the PUP-25 work.\r\n\r\nAccording to a bisect, the breaking commit is 38413cd78c61fe34d2ee343ef773a07b4786f65a","closed_at":"2017-06-28T12:20:42.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7623","labels":"","state":"Closed","updated_at":"2017-06-28T12:20:42.000-0700","timestamp":1652285423.372719,"priority":"Critical","status_category":"Done","pull_request":5949},{"issue_id":"191975","title":"Minor error in arity error in face_base.rb","url":"https://tickets.puppetlabs.com/browse/PUP-7576","created_at":"2017-05-18T20:18:32.000-0700","number":"PUP-7576","body":"The exception raised when the wrong number of arguments is supplied to a face command has an incorrect externalization that references an undefined variable, s.","closed_at":"2017-06-28T12:20:42.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7576","labels":"","state":"Closed","updated_at":"2017-06-28T12:20:42.000-0700","timestamp":1652285423.473259,"priority":"Minor","status_category":"Done","pull_request":5890},{"issue_id":"192126","title":"Tags do not support UTF-8 characters","url":"https://tickets.puppetlabs.com/browse/PUP-7579","created_at":"2017-05-19T15:55:27.000-0700","number":"PUP-7579","body":"The Regex for tag validation (at https://github.com/puppetlabs/puppet/blob/master/lib/puppet/util/tagging.rb#L4) is strictly ASCII:\r\n\r\n{code}\r\nValidTagRegex = /\\A[0-9A-Za-z_][0-9A-Za-z_:.-]*\\Z/\r\n{code}\r\n\r\nThis prevents the usage of tags in the following case:\r\n\r\n{code}\r\npuppet apply -e 'notify { \"hi\": tag => \"_メインディレクトリ_醸造所\" }'\r\n{code}\r\n\r\nWith a stack like:\r\n\r\n{noformat}\r\nError: Invalid tag '_メインディレクトリ_醸造所' at /root/foo.pp:1 on node h3a12zjzc6608rh.delivery.puppetlabs.net\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/errors.rb:106:in `fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/tagging.rb:27:in `block in tag'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/tagging.rb:13:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/tagging.rb:13:in `tag'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:185:in `set_parameter'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:385:in `block in extract_parameters'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:381:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:381:in `extract_parameters'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource.rb:368:in `initialize'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:130:in `initialize'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_resource_support.rb:38:in `new'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_resource_support.rb:38:in `block in create_resources'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_resource_support.rb:37:in `map'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_resource_support.rb:37:in `create_resources'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:321:in `create_resources'\r\n\r\n▽\r\nrequire 'puppet/util/tag_set'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:842:in `block in eval_ResourceExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:839:in `map'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:839:in `eval_ResourceExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:48:in `block in visit_this'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:42:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:42:in `visit_this'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:71:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:82:in `evaluate'\r\n/root/foo.pp:in `stack'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/puppet_stack.rb:30:in `eval'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/puppet_stack.rb:30:in `stack'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:715:in `eval_Program'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:48:in `block in visit_this'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:42:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:42:in `visit_this'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:71:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:82:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/evaluating_parser.rb:63:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:132:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast.rb:31:in `safeevaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:184:in `evaluate_code'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:81:in `block in evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:73:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:635:in `evaluate_main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:174:in `block (2 levels) in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:174:in `block in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:294:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:162:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:33:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:268:in `block (2 levels) in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:266:in `block in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:224:in `block in benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/2.1.0/benchmark.rb:294:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:223:in `benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:264:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:55:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:194:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:256:in `block in main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:294:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:225:in `main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:170:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:358:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:542:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:358:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:132:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\n{noformat}\r\n\r\n\r\nA more lenient and Unicode friendly approach is to use the Unicode friendly word regex like:\r\n\r\n{code}\r\nValidTagRegex = /\\A[[:word:]][[[:word:]]:.-]*\\Z/\r\n{code}\r\n\r\nThis appears necessary to fix the concat module issue reported at MODULES-4684\r\n\r\nThe open question around this is whether or not tags are restricted in this fashion due to some important underlying reason.\r\n\r\n[~thomas.hallgren] spent some time optimizing regular expressions for tags in https://github.com/puppetlabs/puppet/commit/0badfce72bafc767bf3099718c63324f51108996 and the original check (based on words) goes back 10 years to https://github.com/puppetlabs/puppet/commit/f98be4a7198326b26f1072c401b3e337f340db40#diff-ac9d5450f67274b038705194387c3907R31","closed_at":"2017-06-28T12:20:42.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7579","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-28T12:20:42.000-0700","timestamp":1652285423.57463,"priority":"Normal","status_category":"Done","pull_request":6016},{"issue_id":"188356","title":"gettext-setup isn't stubbed enough","url":"https://tickets.puppetlabs.com/browse/PUP-7480","created_at":"2017-04-27T22:57:47.000-0700","number":"PUP-7480","body":"In PUP-7116, the gettext-setup is made optional by trapping a failed {{require 'gettext-setup'}} and stubbing the {{\\_()}} method. That is however not enough since the method {{n\\_()}} is referenced in several places in the code-base.","closed_at":"2017-06-28T12:20:43.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7480","labels":"","state":"Closed","updated_at":"2017-06-28T12:20:43.000-0700","timestamp":1652285424.28568,"priority":"Major","status_category":"Done","pull_request":5833},{"issue_id":"187960","title":"remove dead code in Puppet::Type::instances","url":"https://tickets.puppetlabs.com/browse/PUP-7473","created_at":"2017-04-26T08:51:42.000-0700","number":"PUP-7473","body":"This block in Puppet::Type: https://github.com/puppetlabs/puppet/blob/master/lib/puppet/type.rb#L1163-L1168 iterates over all of the properties of the type, checks if the given provider supports the property, and returns an array of all the supported property names.\r\n\r\nExcept we don't do anything with the result.\r\n\r\nBefore commit http://github.com/puppetlabs/puppet/commit/53241a91, which was a maint commit to remove superfluous variables we never used, the result of this block was assigned to the variable `all_properties` - which was never used. The commit removed the variable, but not the associated block.\r\n\r\nI believe the intention was to filter out properties that weren't supported by the provider before we called `newattr` on them, except `newattr` https://github.com/puppetlabs/puppet/blob/master/lib/puppet/type.rb#L769-L773 already does this filtering, and provides helpful debug output that a provider doesn't support a property so we're not managing it.\r\n\r\nThe block can be removed.","closed_at":"2017-06-28T12:20:44.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7473","labels":"","state":"Closed","updated_at":"2017-06-28T12:20:44.000-0700","timestamp":1652285424.487445,"priority":"Normal","status_category":"Done","pull_request":5826},{"issue_id":"195205","title":"A Report containing rich-data should allow presence of unresolved custom types.","url":"https://tickets.puppetlabs.com/browse/PUP-7642","created_at":"2017-06-09T06:49:27.000-0700","number":"PUP-7642","body":"When an agent that deals with custom rich-data types (Objects) sends a report to the server, the server will not have a correct environment/loaders configured to instantiate the values that are contained in the report events. It currently does, which results in an error.\r\n\r\nThe desired behavior is to retain the hash that is the result of serializing such objects.\r\n","closed_at":"2017-06-28T12:20:44.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7642","labels":"","state":"Closed","updated_at":"2017-06-28T12:20:44.000-0700","timestamp":1652285424.587381,"priority":"Normal","status_category":"Done","pull_request":5966},{"issue_id":"191351","title":"Update default fileserver.conf that allow/deny are no longer allowed","url":"https://tickets.puppetlabs.com/browse/PUP-7555","created_at":"2017-05-16T15:31:01.000-0700","number":"PUP-7555","body":"We are removing allow/deny directives from fileserver.conf. See PUP-6359. This ticket is about updating the {{Permissions}} section in the default fileserver.conf to explain that {{allow}} and {{deny}} directives should be set in the ruby {{auth.conf}} if using legacy auth.conf, or in trapperkeeper's tk-auth.","closed_at":"2017-06-28T12:20:44.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7555","labels":"","state":"Closed","updated_at":"2017-06-28T12:20:44.000-0700","timestamp":1652285424.689625,"priority":"Normal","status_category":"Done","pull_request":5948},{"issue_id":"188685","title":"Default to JSON when sending facts and reports","url":"https://tickets.puppetlabs.com/browse/PUP-7487","created_at":"2017-05-01T12:55:26.000-0700","number":"PUP-7487","body":"In PUP-7259, we modified the agent to requests catalogs and file_metadata from the server in one of the agent's supported formats, i.e. {{Accept: application/json, pson, etc}}. The server will select the first format from the list that it also supports.\r\n\r\nHowever, puppet still sends facts and reports in PSON. \r\n\r\nPUP-7259 enabled the server to start accepting reports in JSON and has already been resolved.\r\n\r\nPUP-7257 will enable the server to start accepting facts in JSON. Once that lands --and is promoted into puppetserver--, we can modify the agent to start sending facts and reports as JSON (this ticket).","closed_at":"2017-06-28T12:20:44.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7487","labels":"","state":"Closed","updated_at":"2017-06-28T12:20:44.000-0700","timestamp":1652285424.892142,"priority":"Major","status_category":"Done","pull_request":5923},{"issue_id":"195996","title":"Puppet 5 fails when facter facts contain ampersands","url":"https://tickets.puppetlabs.com/browse/PUP-7665","created_at":"2017-06-14T13:03:11.000-0700","number":"PUP-7665","body":"This is related to PUP-7658, except that it applies to when the agent sends the catalog request in JSON, as we do not currently escape the fact values. So the {{&}} is interpreted as a query parameter delimiter instead of a fact value.\r\n\r\nTo repro. Create external facts with the following in either {{/etc/puppetlabs/facter/facts.d}} if running as root, or {{~/.facter/facts.d}}:\r\n\r\n{code:yaml}\r\n---\r\nspace: \"foo bar\"\r\nplus: \"foo+bar\"\r\nstar: \"foo*bar\"\r\nhash: \"foo#bar\"\r\npercent: \"foo%bar\"\r\nampersand: \"foo & bar\"\r\n{code}\r\n\r\nDo an agent run, and it will fail with:\r\n\r\n{noformat}\r\n<- \"POST /puppet/v3/catalog/chara.corp.puppetlabs.net?environment=production HTTP/1.1\\r\\nAccept: application/json, application/x-msgpack, text/pson\\r\\nX-Puppet-Version: 5.0.0\\r\\nAccept-Encoding: gzip;q=1.0,deflate;q=0.6,identity;q=0.3\\r\\nUser-Agent: Puppet/5.0.0 Ruby/2.4.1-p111 (x86_64-darwin15)\\r\\nHost: chara.corp.puppetlabs.net:8140\\r\\nContent-Length: 5599\\r\\nContent-Type: application/x-www-form-urlencoded\\r\\n\\r\\n\"\r\n<- \"environment=production&facts_format=application%2Fjson&facts=%7B%22name%22%3A%22XXX.corp.puppetlabs.net%22%2C%22values%22%3A%7B%22puppetversion%22%3A%225.0.0%22%2C%22architecture%22%3A%22x86_64%22%2C%22kernel%22%3A%22Darwin%22%2C%22space%22%3A%22foo%20bar%22%2C%22plus%22%3A%22foo%2Bbar%22%2C%22star%22%3A%22foo%2Abar%22%2C%22hash%22%3A%22foo%23bar%22%2C%22percent%22%3A%22foo%25bar%22%2C%22ampersand%22%3A%22foo%20&%20bar%22%2C...\r\nError: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Could not intern from json: 743: unexpected token at '{\"name\":\"chara.corp.puppetlabs.net\",\"values\":{\"puppetversion\":\"5.0.0\",\"architecture\":\"x86_64\",\"kernel\":\"Darwin\",\"space\":\"foo bar\",\"plus\":\"foo+bar\",\"star\":\"foo*bar\",\"hash\":\"foo#bar\",\"percent\":\"foo%bar\",\"ampersand\":\"foo '\r\n{noformat}","closed_at":"2017-06-28T12:20:45.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7665","labels":"","state":"Closed","updated_at":"2017-06-28T12:20:45.000-0700","timestamp":1652285425.415125,"priority":"Critical","status_category":"Done","pull_request":5996},{"issue_id":"181888","title":"Consistently use encode_with for YAML serialization","url":"https://tickets.puppetlabs.com/browse/PUP-7381","created_at":"2017-03-21T22:20:25.000-0700","number":"PUP-7381","body":"Puppet serializes objects to YAML using both {{to_yaml_properties}}:\r\n\r\n{noformat}\r\nlib/puppet/graph/simple_graph.rb\r\nlib/puppet/parser/yaml_trimmer.rb\r\nlib/puppet/resource/status.rb\r\nlib/puppet/resource.rb\r\nlib/puppet/transaction/event.rb\r\nlib/puppet/transaction/report.rb\r\n{noformat}\r\n\r\nand {{encode_with}} (provided by PsychSupport):\r\n\r\n{noformat}\r\nlib/puppet/indirector/request.rb\r\nlib/puppet/node/facts.rb\r\nlib/puppet/node.rb\r\nlib/puppet/resource/status.rb\r\nlib/puppet/util/log.rb\r\n{noformat}\r\n\r\nThis is bad for a few reasons:\r\n\r\n1. Relying on {{YAML#to_yaml_properties}} has been deprecated since ruby 1.9.3\r\n2. Note that {{Puppet::Resource::Status}} defines both {{to_yaml_properties}} and uses {{encode_with}}. As a result the serialization behavior depends on the ruby version and YAML engines (Syck vs Psych) and the 2 serialization methods could serialize different instance variables.\r\n3. Ruby 2.1 changed how Array subclasses are serialized, and Ruby 2.3 does the same for \r\nHash subclasses. Note the {{ivars}} and the {{hash-with-ivars}} tag:\r\n\r\n{code:yaml}\r\n--- !ruby/array:MyArrayObject\r\ninternal:\r\n- 1\r\nivars:\r\n  :@foo: 2\r\n{code}\r\n\r\n{code:yaml}\r\n--- !ruby/hash-with-ivars:MyHashObject\r\nelements:\r\n  1: 2\r\nivars:\r\n  :@bar: 3\r\n{code}\r\n\r\nThis means YAML data written by an agent running ruby 2.3 may not be readable by puppetserver using JRuby 1.7 (which is compatible with MRI ruby 1.9.3).\r\n\r\nPuppet should consistently use {{PsychSupport}} and its {{encode_with}} methods. Similarly, we should be using {{init_with}} and leveraging the {{from_data_hash}} methods to deserialize instances. This ensures that objects explicitly state which data to serialize, and ensures that object initializers and setters are called during deserialization, instead of using bypassing that with {{instance_variable_set}}.\r\n\r\nSee discussion in https://github.com/puppetlabs/puppet/pull/4214#issuecomment-138691121\r\n\r\n/cc [~henrik.lindberg], [~geoff.nichols], [~ethan]","closed_at":"2017-06-28T12:21:34.000-0700","comments":16,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7381","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-28T12:21:34.000-0700","timestamp":1652285425.727279,"priority":"Normal","status_category":"Done","pull_request":5928},{"issue_id":"172628","title":"Make autoloader recognize types declared in TypeSets.","url":"https://tickets.puppetlabs.com/browse/PUP-7142","created_at":"2017-01-30T07:05:49.000-0800","number":"PUP-7142","body":"A Pcore {{TypeSet}} can, as it name suggests, declare a set of types. All types in such a set have names that are prefixed with the name of the {{TypeSet}}. At present, the auto-loader will find a {{TypeSet}} by name (since it's a type in its own right), but it will not find the types that it declare.\r\n\r\nA {{TypeSet}} should be able to declare types that live in the module namespace, i.e. where the name of the {{TypeSet}} is actually the name of the module. Example:\r\n{code:puppet}\r\ntype Mod = TypeSet[{\r\n  pcore_version => '1.0.0',\r\n  version => '1.0.0',\r\n  types => { Xyz => String[1] }\r\n}]\r\n{code}\r\ndefines the type {{Mod::Xyz}} (when found in module 'mod').\r\n\r\nQuestions that need answers are:\r\n1. Where would the _.pp_ file containing this {{TypeSet}} reside and what should it be named?\r\n2. Can the _version_ in such a {{TypeSet}} be optional (given that what it declares is in the module root)?\r\n3. Is the module root {{TypeSet}} mutually exclusive to other types declared under the _types_ directory?\r\n4. Should it be possible for a module to declare several typesets? If so, how do we differ the \"root\" set that uses the module name as it's name, from other sets? Can we simply decide that the set using that name automatically gets propagated and thereby forbid namespaces that start with the module name twice, i.e. Mod::Mod::Xyz?\r\n","closed_at":"2017-06-28T12:21:34.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7142","labels":"","state":"Closed","updated_at":"2017-06-28T12:21:34.000-0700","timestamp":1652285426.110077,"priority":"Normal","status_category":"Done","pull_request":5619},{"issue_id":"169082","title":"Comparisons between SELinux file categories should always translate to the numeric version","url":"https://tickets.puppetlabs.com/browse/PUP-7073","created_at":"2017-01-06T11:20:39.000-0800","number":"PUP-7073","body":"SELinux file contexts have a category that is assigned to every file on the system.\r\n\r\nIf the system is using {{mcstransd}} (which most higher security systems will be for user convenience) changes to the system at runtime can cause issues with category translation until {{mcstransd}} is restarted.\r\n\r\nThese conditions cannot be clearly enumerated and may happen at any time. When this occurs, Puppet will try to reset the context on *every* managed file as well as triggering service restarts based on those files.\r\n\r\nThis can cause your systems to restart *every* service each time Puppet runs.\r\n\r\nPuppet should, instead, use the output of {{chcat -L}} to obtain the list of mappings from the system and translate any categories on files back to their numeric form in all cases.\r\n\r\nTo do this, simply discard any right hand side values that contain a hyphen ({{-}}) and then use the left hand corresponding value for all context comparisons.\r\n\r\nSetting a context via either method is equivalent so that code should not need to change.","closed_at":"2017-06-28T12:21:34.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7073","labels":"resolved-issue-added;selinux","state":"Closed","updated_at":"2017-06-28T12:21:34.000-0700","timestamp":1652285426.429394,"priority":"Critical","status_category":"Done","pull_request":5513},{"issue_id":"179422","title":"'puppet describe' garbles description when there a long lines with no spaces.","url":"https://tickets.puppetlabs.com/browse/PUP-7329","created_at":"2017-03-09T08:59:22.000-0800","number":"PUP-7329","body":"When a description of a Puppet type, <type>, has long lines with no\r\nspaces, the output from 'puppet describe <type>' is garbled.  The\r\ncause of this is an error in a regular expression in\r\nlib/puppet/application/describe.rb.","closed_at":"2017-06-28T12:21:36.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7329","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-28T12:21:36.000-0700","timestamp":1652285427.158003,"priority":"Normal","status_category":"Done","pull_request":5701},{"issue_id":"171875","title":"Fix problems with Puppet running on Ruby 2.4","url":"https://tickets.puppetlabs.com/browse/PUP-7130","created_at":"2017-01-25T07:35:34.000-0800","number":"PUP-7130","body":"Ruby 2.4 introduces a couple of subtle differences that breaks puppet.\r\n\r\n1. It [unifies the Fixnum and Bignum into Integer|http://blog.bigbinary.com/2016/11/18/ruby-2-4-unifies-fixnum-and-bignum-into-integer.html]. This causes problems in several places.\r\n\r\n2. Prior to 2.4.0, the following code would raise an exception \"couldn't find HOME\" but in 2.4.0, the resolution works even when HOME is nil.\r\n{code:ruby}\r\nENV['HOME'] = nil\r\npath = File.expand_path('~/tmp')\r\n{code}\r\n\r\n3. The handling of DateTime.to_time has changed. Prior to 2.4:\r\n{code:puppet}\r\nx = DateTime.httpdate('Sat, 03 Feb 2001 04:05:06 GMT').to_time.to_s\r\n{code}\r\nwould produce a local time such as \"2001-02-03 05:05:06 +0100\". In 2.4.0, it retains its timezone and produces \"2001-02-03 04:05:06 +0000\".\r\n","closed_at":"2017-06-28T12:21:36.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7130","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-28T12:21:36.000-0700","timestamp":1652285427.260235,"priority":"Normal","status_category":"Done","pull_request":5653},{"issue_id":"181889","title":"Ensure current values are YAML serializable","url":"https://tickets.puppetlabs.com/browse/PUP-7382","created_at":"2017-03-21T22:30:09.000-0700","number":"PUP-7382","body":"As described in MODULES-4275, a provider may return arbitrary objects as the {{current}} value. This value is written (as YAML) in the corrective change file and in the report (if there is a change). The assumption has always been that the {{current}} value is primitive (string, integer, etc), but the ACL module returns Hash subclasses. Since we rely on {{to_yaml_properties}} for report serialization (see PUP-7381), Ruby 2.3 will serialize instance variables of our subclasses, which causes puppet to try to serialize the provider instance. This wasn't a problem previously, because Ruby 2.2 and below just serialize the hash key/value pairs. (The commit changing the Ruby behavior is https://github.com/ruby/ruby/commit/fe0414b5473b5332706126d2a017a9bf235c8146#diff-aed2624c7e8f254dd7356f2a32d8358fR471)\r\n\r\nPuppet needs to be more defensive about how {{current}} values are handled. Presumably this could be done by always writing out the {{to_s}} version of the object.\r\n\r\n/cc [~geoff.nichols], [~ethan], [~henrik.lindberg]","closed_at":"2017-06-28T12:21:37.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7382","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-28T12:21:37.000-0700","timestamp":1652285428.309339,"priority":"Major","status_category":"Done","pull_request":5951},{"issue_id":"173267","title":"PCore resource output improperly quoted","url":"https://tickets.puppetlabs.com/browse/PUP-7155","created_at":"2017-02-01T09:36:53.000-0800","number":"PUP-7155","body":"When using [~thomas.hallgren] rich-data-wip [branch|https://github.com/thallgren/puppet/tree/rich-data-wip] PCore resources are output with incorrect top level quoting:\r\n\r\n{noformat}\r\n$ puppet resource xe_ietf_ospf\r\nxe_ietf_ospf { '100':\r\n  routing_instance => 'Vanilla_ice::Ospf::Routing_instance({ #<-This value should not be quoted\r\n  'name' => 'default',\r\n  'description' => 'default-vrf [read-only]',\r\n  'routing_protocols' => Vanilla_ice::Ospf::Routing_protocols({\r\n...\r\n{noformat}\r\n\r\n[~thomas.hallgren]'s best guess is \"Resource #to_s just quotes everything that it doesn't recognize in single qoutes\"\r\n\r\nThis prevents users from directly copying the output of a PCore resource into a manifest.","closed_at":"2017-06-28T12:21:38.000-0700","comments":21,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7155","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-28T12:21:38.000-0700","timestamp":1652285428.627882,"priority":"Normal","status_category":"Done","pull_request":5922},{"issue_id":"172151","title":"Remove always_cache_features setting","url":"https://tickets.puppetlabs.com/browse/PUP-7133","created_at":"2017-01-25T15:16:52.000-0800","number":"PUP-7133","body":"The setting has been deprecated for awhile (in favor of {{always_retry_plugins}}). See also PUP-6947","closed_at":"2017-06-28T12:21:39.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7133","labels":"","state":"Closed","updated_at":"2017-06-28T12:21:39.000-0700","timestamp":1652285429.248543,"priority":"Minor","status_category":"Done","pull_request":5932},{"issue_id":"136182","title":"file type documentation does not have quotes around modes in doc comments","url":"https://tickets.puppetlabs.com/browse/PUP-6395","created_at":"2016-06-08T15:23:21.000-0700","number":"PUP-6395","body":"The file resource type has several mentions of various modes without showing them as quoted strings. This is a source of confusion/error for users who take the information literally.\r\n\r\nThis needs to be fixed in the file resource type source code. The end result is shown here: https://docs.puppet.com/puppet/latest/reference/type.html#file","closed_at":"2017-06-28T12:22:31.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6395","labels":"DOCS","state":"Closed","updated_at":"2017-06-28T12:22:31.000-0700","timestamp":1652285430.081669,"priority":"Normal","status_category":"Done","pull_request":5962},{"issue_id":"127141","title":"Application declarations don't properly validate component mappings","url":"https://tickets.puppetlabs.com/browse/PUP-6182","created_at":"2016-04-18T14:50:46.000-0700","number":"PUP-6182","body":"This ticket captures a set of bugs in component mapping for application declarations.\r\n\r\n1) Non-existent components are ignored when compiling environment catalog or agent catalog\r\n\r\n{code}\r\nsite {\r\n  my_app { \"foo\":\r\n    nodes => {\r\n      Node['node.example.com'] => [ Imaginary[component] ],\r\n    }\r\n  }\r\n}\r\n{code}\r\n\r\nThis will compile without issue, even if my_app doesn't declare such a component. Indeed, even if the component type doesn't exist.\r\n\r\n2) Missing {{nodes}} param causes an exception when compiling environment catalog, is ignored when compiling agent catalog\r\n\r\n3) Nodes not mapped to any component are ignored when compiling environment catalog or agent catalog\r\n\r\n{code}\r\nsite {\r\n  my_app { \"foo\":\r\n    nodes => {\r\n      Node['node.example.com'] => [ ],\r\n    }\r\n  }\r\n}\r\n{code}\r\n\r\nThe node mentioned here is completely irrelevant to the application, but is just ignored rather than causing an error or warning. There may be a use case for this behavior with components that are being dynamically generated/mapped.","closed_at":"2017-06-28T12:22:31.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6182","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-28T12:22:31.000-0700","timestamp":1652285430.185828,"priority":"Normal","status_category":"Done","pull_request":5178},{"issue_id":"111456","title":"Puppet master does not fail catalog on unexisting resource in resource parameter","url":"https://tickets.puppetlabs.com/browse/PUP-5659","created_at":"2016-01-07T07:15:02.000-0800","number":"PUP-5659","body":"The behavior of Resources in require => parameter and in relations is different.\r\n\r\nWhen compiling the catalog of the two following nodes, the first one fails on the _client_ side, and the second one on the _server_ side. This is very annoying because you think that the catalog can be applied successfully (e.g if you test using puppet master compile).\r\n\r\n\r\n{code:puppet}\r\nnode missing1 {\r\n  notify {'a':\r\n    require => Notify['b'],\r\n  }\r\n}\r\n\r\nnode missing2 {\r\n  notify {'a': }\r\n  Notify['b'] -> Notify['a']\r\n}\r\n{code}\r\n\r\nWhen validation is added it must:\r\n* Allow the value to be a resource reference tree\r\n* Update the language specification and documentation and clearly state that trailing punctuation makes two type references not considered equal. (i.e. File[/tmp/foo/], and File[/tmp//foo]) as this knowledge is implementation specific and may even depend on the provider and underlying target system state). i.e. this will *not* be supported:\r\n{code:puppet}\r\nfile { '/tmp/': } ... notify { 'a': require => File['/tmp'] } (note the trailing forward slash).\r\n{code}\r\n* Support Aliases (the relationship operators do not do that correctly).\r\n{code:puppet}\r\nnotify { 'a': alias => 'b'} ... notify { 'c': require => Notify['b'] }\r\n{code}\r\n\r\nNote that this ticket was originally added to Puppet 4.4.0, but was reverted before release in PUP-5850 as that implementation caused too much downstream breakage.","closed_at":"2017-06-28T12:22:32.000-0700","comments":28,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5659","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-28T12:22:32.000-0700","timestamp":1652285443.23381,"priority":"Normal","status_category":"Done","pull_request":4620},{"issue_id":"117812","title":"Change deprecation from PUP-2695 (merge class) to error","url":"https://tickets.puppetlabs.com/browse/PUP-5954","created_at":"2016-02-21T16:22:25.000-0800","number":"PUP-5954","body":null,"closed_at":"2017-06-28T12:22:32.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5954","labels":"","state":"Closed","updated_at":"2017-06-28T12:22:32.000-0700","timestamp":1652285443.340646,"priority":"Normal","status_category":"Done","pull_request":5511},{"issue_id":"72791","title":"Update PMT to use only semantic_puppet versions (not SemVer)","url":"https://tickets.puppetlabs.com/browse/PUP-4283","created_at":"2015-03-23T22:40:23.000-0700","number":"PUP-4283","body":"Currently, PMT uses both the vendored Semantic library and the Puppet::SemVer module to check version numbers for modules. PMT should be only using the vendored Semantic library.","closed_at":"2017-06-28T12:22:32.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4283","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-28T12:22:32.000-0700","timestamp":1652285443.445741,"priority":"Normal","status_category":"Done","pull_request":5472},{"issue_id":"151093","title":"Fix various type system glitches, Puppet Data type should be limited to JSON types.","url":"https://tickets.puppetlabs.com/browse/PUP-6694","created_at":"2016-09-09T05:45:37.000-0700","number":"PUP-6694","body":"The motivation behind the Data type is that instances of this type can be represented as JSON without conversion. As such, it must only represent the following:\r\n{code}\r\nData\r\n|- Boolean\r\n|- Integer\r\n|- Float\r\n|- String\r\n|- Undef\r\n|- Array[Data]\r\n|- Hash[String,Data]\r\n{code}\r\n","closed_at":"2017-06-28T12:22:33.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6694","labels":"","state":"Closed","updated_at":"2017-06-28T12:22:33.000-0700","timestamp":1652285443.760099,"priority":"Normal","status_category":"Done","pull_request":5829},{"issue_id":"49776","title":"Cap integer and float sizes","url":"https://tickets.puppetlabs.com/browse/PUP-3170","created_at":"2014-09-02T09:33:47.000-0700","number":"PUP-3170","body":"The language specification now (PUP-3133) says that Integer and Float are capped to signed 64 bit integer, and 64 bit double precision floats (IEEE 754). This used to be unspecified, and \"just work the way Ruby works\". There was also a misconception in how Ruby transitions between the available fixed types and Big representations (it simply does not do widening to Big for floating point). The cap is needed because neither serialization formats nor Puppet DB can work efficiently (if at all) with values outside of the now specified range.\r\n\r\nWe should cap the runtime size of Integers (error on under/overflow).\r\n\r\nWe should also update / verify that the type system does not accept Integer values that are BigInteger, and that Float should not accept BigDecimal, except possibly if those data types hold values that fit 64 bit signed and IEEE 754 binary64 respectively and can be transformed to the 64 bit variants.\r\n\r\nThis also means that we should type check attribute and variable assignments since {{Any}} does not mean \"any ruby type\". This last step may have performance implications.","closed_at":"2017-06-28T12:22:33.000-0700","comments":16,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3170","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-28T12:22:33.000-0700","timestamp":1652285443.972794,"priority":"Normal","status_category":"Done","pull_request":5556},{"issue_id":"118524","title":"Remove IO#binwrite monkey patch","url":"https://tickets.puppetlabs.com/browse/PUP-5974","created_at":"2016-02-24T21:08:42.000-0800","number":"PUP-5974","body":"Remove IO#binwrite monkey patch. The method has been present since ruby 1.9.3, no need to monkey patch it.","closed_at":"2017-06-28T12:22:33.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5974","labels":"","state":"Closed","updated_at":"2017-06-28T12:22:33.000-0700","timestamp":1652285444.077768,"priority":"Normal","status_category":"Done","pull_request":5807},{"issue_id":"134308","title":"Puppet::Transaction#failed? is unused - remove it","url":"https://tickets.puppetlabs.com/browse/PUP-6372","created_at":"2016-05-27T16:06:02.000-0700","number":"PUP-6372","body":"The one use of Puppet::Transaction#failed? was removed in https://github.com/puppetlabs/puppet/commit/84be695ddee004d7e358d9256f7929e1a2c400a3, so we can now remove the method itself.\r\n\r\nNote that the entire class is marked as {{api private}}.","closed_at":"2017-06-28T12:22:34.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6372","labels":"","state":"Closed","updated_at":"2017-06-28T12:22:34.000-0700","timestamp":1652285444.285733,"priority":"Normal","status_category":"Done","pull_request":4999},{"issue_id":"35214","title":"Certname must be lowercase error not helpful","url":"https://tickets.puppetlabs.com/browse/PUP-2551","created_at":"2014-05-12T22:19:38.000-0700","number":"PUP-2551","body":"Currently if you set a non lowercase certname you get this error:\r\n{code}\r\nError: Could not initialize global default settings: Certificate names must be lower case; see #1168\r\n{code}\r\n\r\nIts not terribly helpful for a couple reasons.\r\n# We've moved away from RedMine. Only seasoned puppet veterans will see #1168 and say \"oh right, redmine, duh.\"\r\n# #1168 is an ancient thread that represents a dark time in puppet's history we'd all rather forget. Who cares about these comments? We need a succinct snippet for why we require lowercase names. Not force new users to read the insane old days. Especially since there really isn't any resolution on that thread.\r\n\r\nI seem to recall there was a better resource somewhere that had a more definitive explanation. I've helped numerous people get past this.\r\n","closed_at":"2017-06-28T12:22:34.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2551","labels":"beginner;help_wanted","state":"Closed","updated_at":"2017-06-28T12:22:34.000-0700","timestamp":1652285444.392332,"priority":"Normal","status_category":"Done","pull_request":5902},{"issue_id":"134008","title":"Completely remove allow/deny rules from fileserver.conf syntax","url":"https://tickets.puppetlabs.com/browse/PUP-6359","created_at":"2016-05-25T17:01:47.000-0700","number":"PUP-6359","body":"fileserver.conf is useful for defining custom mount points, but it predates a unified authorization system in Puppet, so it has its own redundant syntax for access controls. If a request passes auth.conf, fileserver.conf can apply an extra layer of restrictions... but why didn't you just write those in auth.conf??? Yeah, exactly, you did. \r\n\r\nFurthermore, I believe fileserver.conf's auth rules use the same code paths as auth.conf (legacy edition), which is slated for demolition in 5.0. (This is the reason IP-based fileserver.conf auth rules broke in 3.0, because we changed the auth.conf code paths to separate them from certname rules.) So it'll break at the 5.0 boundary anyway, without heroic efforts. \r\n\r\nWe probably should have deleted this feature in 4.0, so let's kill it now. \r\n\r\nSpecifically, I suggest:\r\n\r\n* Today, start logging warnings if fileserver.conf contains any auth rules other than {{allow \\*}}.\r\n* At 5.0, start disregarding all auth rules in fileserver.conf (behaving like every mount point has allow \\*), and log warnings if any are present. ","closed_at":"2017-06-28T12:22:34.000-0700","comments":21,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6359","labels":"deprecation","state":"Closed","updated_at":"2017-06-28T12:22:34.000-0700","timestamp":1652285444.50194,"priority":"Normal","status_category":"Done","pull_request":5940},{"issue_id":"118523","title":"Remove Symbol monkey patch","url":"https://tickets.puppetlabs.com/browse/PUP-5973","created_at":"2016-02-24T21:05:47.000-0800","number":"PUP-5973","body":"Remove Symbol#<=> monkey patch. See PUP-5968","closed_at":"2017-06-28T12:22:34.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5973","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-28T12:22:34.000-0700","timestamp":1652285444.607863,"priority":"Normal","status_category":"Done","pull_request":5642},{"issue_id":"118525","title":"Remove Range#intersection monkey patch","url":"https://tickets.puppetlabs.com/browse/PUP-5975","created_at":"2016-02-24T21:14:46.000-0800","number":"PUP-5975","body":"Range#intersection was monkey patched in b6d052e7 so that semver ranges could be compared for the PMT.... This should be removed and handled in the code that actually cares about comparing semver strings.","closed_at":"2017-06-28T12:22:35.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5975","labels":"","state":"Closed","updated_at":"2017-06-28T12:22:35.000-0700","timestamp":1652285444.713784,"priority":"Normal","status_category":"Done","pull_request":5842},{"issue_id":"146109","title":"Update CFPropertyList gem to 2.3.5 and add plain format to puppet/util/plist","url":"https://tickets.puppetlabs.com/browse/PUP-6596","created_at":"2016-08-09T15:10:05.000-0700","number":"PUP-6596","body":"Puppet currently bundles version 2.2.7 of the CFPropertyList gem.  This works fine, but the newest version 2.3.3 has a couple of bug fixes and also adds support for the rare plain ASCII format.   Having support for this format would be very useful in certain situations, as Xcode and System Profiler still use it.\r\n\r\nWe've also recently discovered a serious bug in string handling, see PUP-6696.","closed_at":"2017-06-28T12:22:35.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6596","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-28T12:22:35.000-0700","timestamp":1652285444.818246,"priority":"Normal","status_category":"Done","pull_request":5904},{"issue_id":"144200","title":"Face based application help should say (c) Puppet Inc. not Puppet Labs.","url":"https://tickets.puppetlabs.com/browse/PUP-6566","created_at":"2016-07-31T11:50:01.000-0700","number":"PUP-6566","body":"There is a spec test that asserts that all help texts have \"(c) Puppet Labs\" when it should be \"(c) Puppet Inc.\". The test was updated in the PR for PUP-5948 to allow both. All faces should be updated and the test changed.","closed_at":"2017-06-28T12:22:35.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6566","labels":"","state":"Closed","updated_at":"2017-06-28T12:22:35.000-0700","timestamp":1652285444.922508,"priority":"Minor","status_category":"Done","pull_request":5875},{"issue_id":"149339","title":"cached catalogs setting not respected when --test is specified","url":"https://tickets.puppetlabs.com/browse/PUP-6660","created_at":"2016-08-27T05:43:34.000-0700","number":"PUP-6660","body":"h1. Description\r\n\r\nDuring UTF-8 testing for upgrades we discovered that the {{use_cached_catalog}} setting is not being respected in {{gf12ba81}} or {{ga7c5f6b}} versions of Davis (we have not tested other versions).  The impact of this is that customers will not be able to use cached catalogs.\r\n\r\nPE2015.2.0 (cached catalogs enabled on CentOS6):\r\n{code}\r\n[root@node0 ~]# puppet agent -t\r\nInfo: Using cached catalog from environment 'production'\r\nInfo: Loading facts\r\nInfo: Applying configuration version '1472295113'\r\nNotice: こんにちは\r\nNotice: /Stage[main]/Utf_8/Notify[こんにちは]/message: defined 'message' as 'こんにちは'\r\nNotice: ブランク\r\nNotice: /Utf_8::App[ブランク]/Utf_8::Component_one[ブランク_first]/Notify[ブランク]/message: defined 'message' as 'ブランク'\r\nNotice: English\r\nNotice: /Utf_8::App[English]/Utf_8::Component_one[English_first]/Notify[English]/message: defined 'message' as 'English'\r\nNotice: Applied catalog in 1.66 seconds\r\n[root@node0 ~]# puppet agent -t\r\nInfo: Using cached catalog from environment 'production'\r\nInfo: Loading facts\r\nInfo: Applying configuration version '1472295113'\r\nNotice: こんにちは\r\nNotice: /Stage[main]/Utf_8/Notify[こんにちは]/message: defined 'message' as 'こんにちは'\r\nNotice: ブランク\r\nNotice: /Utf_8::App[ブランク]/Utf_8::Component_one[ブランク_first]/Notify[ブランク]/message: defined 'message' as 'ブランク'\r\nNotice: English\r\nNotice: /Utf_8::App[English]/Utf_8::Component_one[English_first]/Notify[English]/message: defined 'message' as 'English'\r\nNotice: Applied catalog in 1.95 seconds\r\n{code}\r\n\r\nDavis (on CentOS7 and Ubuntu 16.04):\r\n{code}\r\n[root@node1 ~]# cat /etc/puppetlabs/puppet/puppet.conf\r\n# This file can be used to override the default puppet settings.\r\n# See the following links for more details on what settings are available:\r\n# - https://docs.puppetlabs.com/puppet/latest/reference/config_important_settings.html\r\n# - https://docs.puppetlabs.com/puppet/latest/reference/config_about_settings.html\r\n# - https://docs.puppetlabs.com/puppet/latest/reference/config_file_main.html\r\n# - https://docs.puppetlabs.com/puppet/latest/reference/configuration.html\r\n[main]\r\nserver = master.puppet.vm\r\n[agent]\r\ncertname = node1.puppet.vm\r\nuse_cached_catalog = true\r\n[root@node1 ~]# systemctl restart puppet\r\n[root@node1 ~]# puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for node1.puppet.vm\r\nInfo: Applying configuration version '1472300511'\r\nNotice: こんにちは\r\nNotice: /Stage[main]/Utf_8/Notify[こんにちは]/message: defined 'message' as 'こんにちは'\r\nNotice: ブランク\r\nNotice: /Utf_8::App[ブランク]/Utf_8::Component_one[ブランク_second]/Notify[ブランク]/message: defined 'message' as 'ブランク'\r\nNotice: English\r\nNotice: /Utf_8::App[English]/Utf_8::Component_one[English_second]/Notify[English]/message: defined 'message' as 'English'\r\nNotice: Applied catalog in 0.89 seconds\r\n[root@node1 ~]# puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for node1.puppet.vm\r\nInfo: Applying configuration version '1472300535'\r\nNotice: こんにちは\r\nNotice: /Stage[main]/Utf_8/Notify[こんにちは]/message: defined 'message' as 'こんにちは'\r\nNotice: ブランク\r\nNotice: /Utf_8::App[ブランク]/Utf_8::Component_one[ブランク_second]/Notify[ブランク]/message: defined 'message' as 'ブランク'\r\nNotice: English\r\nNotice: /Utf_8::App[English]/Utf_8::Component_one[English_second]/Notify[English]/message: defined 'message' as 'English'\r\nNotice: Applied catalog in 0.83 seconds\r\n[root@node1 ~]# puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for node1.puppet.vm\r\nInfo: Applying configuration version '1472300560'\r\nNotice: こんにちは\r\nNotice: /Stage[main]/Utf_8/Notify[こんにちは]/message: defined 'message' as 'こんにちは'\r\nNotice: ブランク\r\nNotice: /Utf_8::App[ブランク]/Utf_8::Component_one[ブランク_second]/Notify[ブランク]/message: defined 'message' as 'ブランク'\r\nNotice: English\r\nNotice: /Utf_8::App[English]/Utf_8::Component_one[English_second]/Notify[English]/message: defined 'message' as 'English'\r\nNotice: Applied catalog in 0.98 seconds\r\n{code}","closed_at":"2017-06-28T12:22:35.000-0700","comments":23,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6660","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-28T12:22:35.000-0700","timestamp":1652285445.13503,"priority":"Critical","status_category":"Done","pull_request":5853},{"issue_id":"124182","title":"trusted_server_facts should be on by default","url":"https://tickets.puppetlabs.com/browse/PUP-6112","created_at":"2016-03-30T03:48:07.000-0700","number":"PUP-6112","body":"Not sure why this is off by default but this is super valuable and if people are to use it in shared modules it should be on by default\r\n\r\n{code}\r\n% puppet --version;puppet apply --configprint trusted_server_facts\r\n4.4.1\r\nfalse\r\n{code}","closed_at":"2017-06-28T12:22:36.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6112","labels":"","state":"Closed","updated_at":"2017-06-28T12:22:36.000-0700","timestamp":1652285445.240938,"priority":"Normal","status_category":"Done","pull_request":5480},{"issue_id":"142014","title":"undefined method `backtrace' for Puppet::Error:Class with package with unresolvable source","url":"https://tickets.puppetlabs.com/browse/PUP-6517","created_at":"2016-07-18T04:36:29.000-0700","number":"PUP-6517","body":"Puppet throws an ugly error that crashes the catalog application, when the source of the package cannot be resolved by dns.\r\n\r\nThe error should be caught correctly and just this resource should fail.\r\n\r\nPuppet Code to trigger the issue:\r\n{code:puppet}\r\n# /root/package-test.pp\r\n  package { foo:\r\n    ensure   => 'latest',\r\n    provider => 'rpm',\r\n    source   =>\r\n  \"http://cannotresolve.foo/foo.rpm\",\r\n  }\r\n{code}\r\n\r\n\r\n\r\n{code:java}\r\n# puppet apply --debug --trace --evaltrace /root/package-test.pp\r\n ...\r\nInfo: /Stage[main]/Main/Package[foo]: Starting to evaluate the resource\r\nDebug: Executing: '/usr/bin/rpm -q foo --nosignature --nodigest --qf %{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\\n'\r\nDebug: Executing: '/usr/bin/rpm -q foo --nosignature --nodigest --qf %{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\\n --whatprovides'\r\nDebug: Executing: '/usr/bin/rpm -q --qf %{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\\n -p http://cannotresolve.foo/foo.rpm'\r\nError: Could not update: undefined method `backtrace' for Puppet::Error:Class\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/execution.rb:105:in `rescue in execfail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/execution.rb:102:in `execfail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider.rb:126:in `execfail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/package/rpm.rb:135:in `latest'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/package/rpm.rb:147:in `install'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/package/rpm.rb:181:in `update'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/package.rb:112:in `block (3 levels) in <module:Puppet>'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/property.rb:427:in `set'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/property.rb:501:in `sync'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:189:in `sync'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:114:in `sync_if_needed'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:79:in `perform_changes'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:20:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:212:in `apply'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:228:in `eval_resource'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:151:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:151:in `block (2 levels) in evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:386:in `block in thinmark'\r\n/opt/puppetlabs/puppet/lib/ruby/2.1.0/benchmark.rb:294:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:385:in `thinmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:151:in `block in evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:118:in `traverse'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:142:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:222:in `block in apply'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:155:in `with_destination'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/report.rb:118:in `as_logging_destination'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:221:in `apply'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:171:in `block in apply_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:223:in `block in benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/2.1.0/benchmark.rb:294:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:222:in `benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:170:in `apply_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:315:in `run_internal'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:186:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:240:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:185:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:350:in `apply_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:274:in `block in main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:240:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:225:in `main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:170:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:540:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:128:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\nError: /Stage[main]/Main/Package[foo]/ensure: change from absent to latest failed: Could not update: undefined method `backtrace' for Puppet::Error:Class\r\nInfo: /Stage[main]/Main/Package[foo]: Evaluated in 0.14 seconds\r\nInfo: Class[Main]: Starting to evaluate the resource\r\nDebug: Class[Main]: Resource is being skipped, unscheduling all events\r\n...\r\n{code}\r\n\r\n\r\n{noformat}\r\n# /usr/bin/rpm -q --qf \"%{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\\n\" -p http://cannotresolve.foo/foo.rpm\r\ncurl: (6) Could not resolve host: cannotresolve.foo; Name or service not known\r\nerror: open of http://cannotresolve.foo/foo.rpm failed: No such file or directory\r\n{noformat}\r\n\r\n","closed_at":"2017-06-28T12:22:36.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6517","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-28T12:22:36.000-0700","timestamp":1652285445.556586,"priority":"Normal","status_category":"Done","pull_request":5891},{"issue_id":"47152","title":"If a catalog has a dependency cycle, it does not count as failed","url":"https://tickets.puppetlabs.com/browse/PUP-3042","created_at":"2014-08-11T09:09:07.000-0700","number":"PUP-3042","body":"If a catalog has a dependency cycle in it, the catalog fails to apply, but it counts it as a successful run.\r\n\r\n{noformat}\r\n# puppet agent -t\r\nInfo: Retrieving plugin\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/postgresql/lib/facter/postgres_default_version.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/stdlib/lib/facter/root_home.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/stdlib/lib/facter/facter_dot_d.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/stdlib/lib/facter/puppet_vardir.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/stdlib/lib/facter/pe_version.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/pe_staging/lib/facter/staging_http_get.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/puppet_enterprise/lib/facter/pe_build.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/puppet_enterprise/lib/facter/windows.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/puppet_enterprise/lib/facter/platform_tag.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/firewall/lib/facter/iptables_version.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/firewall/lib/facter/iptables_persistent_version.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/firewall/lib/facter/ip6tables_version.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/pe_puppetdb/lib/facter/pe_puppetdb_server_status.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/pe_postgresql/lib/facter/pe_postgres_default_version.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/auth_conf/lib/facter/custom_auth_conf.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/concat/lib/facter/concat_basedir.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/pe_puppetdb_server_status.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/custom_auth_conf.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/root_home.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/pe_build.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/windows.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/staging_http_get.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/facter_dot_d.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/puppet_vardir.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/iptables_version.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/iptables_persistent_version.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/ip6tables_version.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/platform_tag.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/pe_postgres_default_version.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/pe_version.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/concat_basedir.rb\r\nInfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/postgres_default_version.rb\r\nInfo: Caching catalog for pe-330-master.puppetdebug.vlan\r\nInfo: Applying configuration version '1407772716'\r\nError: Could not apply complete catalog: Found 1 dependency cycle:\r\n(Exec[step1] => Exec[step2] => Exec[step1])\r\nCycle graph written to /var/opt/lib/pe-puppet/state/graphs/cycles.dot.\r\nNotice: Finished catalog run in 0.35 seconds\r\n# echo $?\r\n0\r\n{noformat}\r\n\r\nThis in turn causes the node to show up as unchanged in the PE Console, and thus bury problems.\r\n","closed_at":"2017-06-28T12:22:36.000-0700","comments":29,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3042","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-28T12:22:36.000-0700","timestamp":1652285445.667465,"priority":"Normal","status_category":"Done","pull_request":5950},{"issue_id":"110427","title":"accessing facts via another scope","url":"https://tickets.puppetlabs.com/browse/PUP-5635","created_at":"2015-12-22T13:36:14.000-0800","number":"PUP-5635","body":"It's possible to access a fact via another scope other then the currently active or top scope:\r\n\r\n{code:java}\r\nclass test::params {}\r\n\r\nclass test  (\r\n  timezone = $test::params::timezone,\r\n) inherits params {\r\n  notice($timezone)\r\n}\r\n\r\ninclude ::test\r\n{code}\r\n\r\nI would expect with strict_variables active that this would generate an error because timezone isn't declared in test::params. But instead the value of the fact timezone is returned. Accessing facts and other automatically imported variables via top scope for historical reasons I can understand. But for any other scopes, then the currently active, I can see no valid reasons to access a fact or other automatically imported variables via them. Also the behavior is unexpected, at least for me. So I think this can be classified as a bug and not a feature. But I'm not sure so if you think this is a feature you can close this bug report.\r\n","closed_at":"2017-06-28T12:22:37.000-0700","comments":19,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5635","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-28T12:22:37.000-0700","timestamp":1652285445.881383,"priority":"Minor","status_category":"Done","pull_request":5848},{"issue_id":"126289","title":"Update links.puppetlabs.com links to links.puppet.com","url":"https://tickets.puppetlabs.com/browse/PUP-6164","created_at":"2016-04-12T11:40:42.000-0700","number":"PUP-6164","body":"This will need to be done in facter, hiera, puppet-agent, mco and possibly other projects as well. Setting this ticket in the PUP project for now, and we can just use (docs) for the commit message.","closed_at":"2017-06-28T12:22:37.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6164","labels":"help_wanted;tech-debt","state":"Closed","updated_at":"2017-06-28T12:22:37.000-0700","timestamp":1652285445.986825,"priority":"Normal","status_category":"Done","pull_request":5901},{"issue_id":"10967","title":"Resource defaults aren't completely evaluated by the compiler ","url":"https://tickets.puppetlabs.com/browse/PUP-25","created_at":"2013-06-17T17:40:21.000-0700","number":"PUP-25","body":"Resource defaults are merged in when [finish is called on resources|https://github.com/puppetlabs/puppet/blob/3.2.0/lib/puppet/parser/compiler.rb#L358] by the compiler [which leads to|https://github.com/puppetlabs/puppet/blob/3.2.0/lib/puppet/parser/resource.rb#L107] the [add_defaults method|https://github.com/puppetlabs/puppet/blob/3.2.0/lib/puppet/parser/resource.rb#L236-L244] in parser/resource.rb:\r\n\r\n{code}\r\n    def add_defaults\r\n      scope.lookupdefaults(self.type).each do |name, param|\r\n        unless @parameters.include?(name)\r\n          self.debug \"Adding default for #{name}\"\r\n\r\n          @parameters[name] = param.dup\r\n        end\r\n      end\r\n    end\r\n{code}\r\n\r\nThis method loops over each default and adds values to the @parameters hash if they are unset. No more, no less. The problem is that simply altering the @parameters hash isn't sufficient to trigger the full effect of a resource parameter---the value must be present in the hash when the resource is evaluated by the compiler.\r\n","closed_at":"2017-06-28T12:23:40.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-25","labels":"redmine;resolved-issue-added","state":"Closed","updated_at":"2017-06-28T12:23:40.000-0700","timestamp":1652285446.519737,"priority":"Major","status_category":"Done","pull_request":3379},{"issue_id":"193234","title":"If the catalog contains binary content, the server should downgrade to pson","url":"https://tickets.puppetlabs.com/browse/PUP-7602","created_at":"2017-05-26T15:46:57.000-0700","number":"PUP-7602","body":"If the catalog contains binary content, then the master won't be able to serialize it to json, generating an HTTP 500 error. To make it easy to migrate to Puppet 5, the master should detect when there is an encoding error when serializing the catalog, and downgrade to {{pson}}. It should also emit the correct mime-type.\r\n\r\nThe agent should still be able to cache the catalog (as PSON), and later load the catalog and apply, e.g. {{puppet agent -t --use_cached_catalog}}.\r\n\r\nThis issue is blocking puppetdb tests because they verify binary file content transfer from agent to server to puppetdb.","closed_at":"2017-06-28T13:15:40.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7602","labels":"","state":"Closed","updated_at":"2017-06-28T13:15:40.000-0700","timestamp":1652285446.624584,"priority":"Normal","status_category":"Done","pull_request":5979},{"issue_id":"196739","title":"Resource collectors fails to load generated resource types.","url":"https://tickets.puppetlabs.com/browse/PUP-7674","created_at":"2017-06-19T07:40:24.000-0700","number":"PUP-7674","body":"A resource collector will always load the ruby resource, even if resources has been generated using {{puppet generate types}}.","closed_at":"2017-06-28T13:18:14.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7674","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-28T13:18:14.000-0700","timestamp":1652285446.728012,"priority":"Major","status_category":"Done","pull_request":5997},{"issue_id":"195902","title":"Metaparameters are validated on unrealized resources","url":"https://tickets.puppetlabs.com/browse/PUP-7660","created_at":"2017-06-14T09:31:04.000-0700","number":"PUP-7660","body":"I would not expect these to be validated unless the resource is actually realized, since an unrealized resource could indicate that other related resources are missing.\r\n\r\n{noformat}\r\nbranan@rycon:~/proj/pl/puppet$ bundle exec puppet apply foo.pp\r\nError: Could not find resource 'Package[aptitude]' in parameter 'require' at /home/branan/proj/pl/puppet/foo.pp:2 on node rycon\r\nbranan@rycon:~/proj/pl/puppet$ cat foo.pp\r\n@package { 'apt':\r\n  require => Package['aptitude']\r\n}\r\n{noformat}","closed_at":"2017-06-29T13:20:18.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7660","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-06-29T13:20:18.000-0700","timestamp":1652285447.04198,"priority":"Normal","status_category":"Done","pull_request":5981},{"issue_id":"192817","title":"utf8_user_comments test fails on AIX","url":"https://tickets.puppetlabs.com/browse/PUP-7592","created_at":"2017-05-24T13:25:22.000-0700","number":"PUP-7592","body":"We have been seeing the following failure on AIX for over two weeks now:\r\n\r\n{code}\r\nfailed to modify UTF-8 user comment in UTF-8 environment.\r\nExpected /changed 'Aۿ' to 'ᚠ𠜎'/ to match \"\\e[mNotice: Compiled catalog for pe-aix-61-spec.delivery.puppetlabs.net in environment production in 0.03 seconds\\e[0m\\n\\e[0;32mInfo: Applying configuration version '1495597093'\\e[0m\\n\\e[mNotice: /Stage[main]/Main/User[foo1347]/comment: comment changed 'AÛ¿' to 'á\\u009A ð \\u009C\\u008E'\\e[0m\\n\\e[mNotice: Applied catalog in 0.43 seconds\\e[0m\\n\".\r\n{code}\r\n\r\nLast passing SHA of puppet through these tests was a207e6ec2ba1d662510de3b438a21476643a45e0.\r\n\r\n[~josh] and [~ethan] believe this might be related to work that has been going on around Etc.","closed_at":"2017-07-06T15:25:46.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7592","labels":"","state":"Closed","updated_at":"2017-07-06T15:25:46.000-0700","timestamp":1652285447.764465,"priority":"Normal","status_category":"Done","pull_request":5910},{"issue_id":"189398","title":"Puppet merges two users in different encodings into one","url":"https://tickets.puppetlabs.com/browse/PUP-7498","created_at":"2017-05-04T15:25:30.000-0700","number":"PUP-7498","body":"If the user José bytes [74, 111, 115, 233] LATIN-1 and the user José bytes [74, 111, 115, 195, 169] UTF-8 both exist on the system, Puppet will pick whichever one is read in from the system first and ignore the other one silently without warning the user which is getting managed.\r\n\r\nAdditionally, if two resources in different encodings do make it through the system when gathered by `puppet resource`, that application can explode because of incompatible encodings \r\n\r\nFinally, if we get resources in binary encoding we may not be able to convert them to UTF-8 without first expecting them as encoding.default_external, so we might as well do that. \r\n\r\nThis, among other issues and potential improvements need addressed. ","closed_at":"2017-07-12T17:32:53.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7498","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-07-12T17:32:53.000-0700","timestamp":1652285449.283257,"priority":"Critical","status_category":"Done","pull_request":5846},{"issue_id":"200588","title":"execpipe raises method error if the command fails with no output","url":"https://tickets.puppetlabs.com/browse/PUP-7782","created_at":"2017-07-15T16:22:05.000-0700","number":"PUP-7782","body":"I'm trying to install a package as followed:\r\n\r\n{code}\r\n  package { 'unifi':\r\n    ensure => latest\r\n  }\r\n{code}\r\n\r\nThe error I get with --debug:\r\n\r\n{code}\r\nDebug: Prefetching pacman resources for package\r\nDebug: Executing '/usr/bin/pacman -Q'\r\nDebug: Executing '/usr/bin/pacman -Sgg'\r\nDebug: Executing '/usr/bin/pacman -Q'\r\nDebug: Executing '/usr/bin/pacman -Sgg unifi'\r\nError: /Stage[main]/Unifi/Package[unifi]: Could not evaluate: undefined method `encoding' for #<IO:(closed)>\r\nDid you mean?  set_encoding\r\nNotice: /Stage[main]/Unifi/Service[unifi]: Dependency Package[unifi] has failures: true\r\n{code}\r\n\r\nDid some digging, and the command it's failing on is where it checks for package groups: https://github.com/puppetlabs/puppet/blob/5.0.0/lib/puppet/provider/package/pacman.rb#L102\r\n\r\nSo it calls execpipe with the command, and the command returns 1 because the group doesn't exist, but otherwise returns no output. This lands us here: https://github.com/puppetlabs/puppet/blob/5.0.0/lib/puppet/util/execution.rb#L86\r\n\r\nThe act of returning \"output\" as part of the exception attempts to stringify it. It's a closed IO pipe, so that fails when trying to call \".encoding\". I confirmed this by replacing \"output\" on the raise line with an empty string, which fixed the error.","closed_at":"2017-07-17T13:49:08.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7782","labels":"","state":"Closed","updated_at":"2017-07-17T13:49:08.000-0700","timestamp":1652285449.491811,"priority":"Normal","status_category":"Done","pull_request":6077},{"issue_id":"200002","title":"Pip provider cannot manage any system python packages","url":"https://tickets.puppetlabs.com/browse/PUP-7770","created_at":"2017-07-11T15:17:44.000-0700","number":"PUP-7770","body":"The pip package provider cannot manage the installation of setuptools, distribute, or wheel as they are excluded from the output of \"pip freeze\".  What happens is that puppet tries to install them on every run because it does not know they are installed.  In versions of pip newer than 8.0.3 there is an \"--all\" flag that can be passed to pip to list them.  PR is incoming to fix this, just wanted to have a jira ticket to reference :).","closed_at":"2017-07-18T08:29:14.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7770","labels":"","state":"Closed","updated_at":"2017-07-18T08:29:14.000-0700","timestamp":1652285449.597858,"priority":"Normal","status_category":"Done","pull_request":6059},{"issue_id":"170944","title":"Unable to halt Puppet service on Solaris using Puppet","url":"https://tickets.puppetlabs.com/browse/PUP-7110","created_at":"2017-01-18T15:32:27.000-0800","number":"PUP-7110","body":"The way Puppet works when run as a service is that it forks off a child process to perform the agent run; on most platforms, the service can be halted and the child process will continue to completion, which allows Puppet to manage its own service.\r\n\r\nOn Solaris, this doesn't work because service handling uses contracts, and the child process is still part of the same contract that the service runs in. Attempting to stop the Puppet service during an agent run triggered by that service will send SIGTERM/SIGKILL to the service, stopping the agent run.","closed_at":"2017-07-19T11:01:46.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7110","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-07-19T11:01:46.000-0700","timestamp":1652285449.902982,"priority":"Major","status_category":"Done","pull_request":5847},{"issue_id":"198117","title":"\"bundle exec puppet module install\" fails on Puppet 5.0.0","url":"https://tickets.puppetlabs.com/browse/PUP-7738","created_at":"2017-06-28T03:30:50.000-0700","number":"PUP-7738","body":"We have a Puppet 4.10.x pipeline running librarian puppet to install modules from Puppetfile. \r\n\r\nThis now failes on Puppet 5.0 with: \r\n\r\n{noformat}\r\n10:51:05 10:51:05 Error executing puppet module install. Check that this command succeeds:\r\n10:51:05 10:51:05 puppet module install --version 4.17.1 --target-dir /xxxx/.tmp/librarian/cache/source/puppet/forge/forgeapi_puppetlabs_com/puppetlabs-stdlib/4.17.1 --module_repository https://forgeapi.puppetlabs.com --modulepath /xxxx/.tmp/librarian/cache/source/puppet/forge/forgeapi_puppetlabs_com/puppetlabs-stdlib/4.17.1 --module_working_dir /xxxx/.tmp/librarian/cache/source/puppet/forge/forgeapi_puppetlabs_com/puppetlabs-stdlib/4.17.1 --ignore-dependencies puppetlabs-stdlib\r\n10:51:05 10:51:05 Error:\r\n10:51:05 10:51:05 Warning: Support for ruby version 2.0.0 is deprecated and will be removed in a future release. See https://docs.puppet.com/puppet/latest/system_requirements.html#ruby for a list of supported ruby versions.\r\n10:51:05 10:51:05    (at /yyyyy/gems/ruby/gems/puppet-5.0.0/lib/puppet.rb:181:in `<module:Puppet>')\r\n10:51:05 10:51:05 Error: wrong number of arguments (2 for 1)\r\n10:51:05 10:51:05 Error: Try 'puppet help module install' for usage\r\n{noformat}","closed_at":"2017-07-19T14:22:47.000-0700","comments":28,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7738","labels":"","state":"Closed","updated_at":"2017-07-19T14:22:47.000-0700","timestamp":1652285450.120453,"priority":"Normal","status_category":"Done","pull_request":6030},{"issue_id":"198912","title":"Acceptance test tests/resource/service/service_enable_linux.rb fails on Amazon Linux","url":"https://tickets.puppetlabs.com/browse/PUP-7752","created_at":"2017-07-05T01:08:41.000-0700","number":"PUP-7752","body":"{{tests/resource/service/service_enable_linux.rb}} fails because the test interprets the {{majrelease}} version of {{2017}} to be greater than {{6}} and assumes that it is using {{systemd}} to manage services. Since Amazon Linux verison {{2017.03}} is built upon Redhat 6, it uses SysV and cannot find the systemd files referenced in the test.","closed_at":"2017-07-19T14:22:48.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7752","labels":"","state":"Closed","updated_at":"2017-07-19T14:22:48.000-0700","timestamp":1652285450.226268,"priority":"Normal","status_category":"Done","pull_request":6037},{"issue_id":"198964","title":"Timestamp doesn't provide a default format for date and time separated by space","url":"https://tickets.puppetlabs.com/browse/PUP-7753","created_at":"2017-07-05T09:01:41.000-0700","number":"PUP-7753","body":"When you have Timestamp process a time stamp, it can choose to only process some of the string without providing any feedback on it. For example:\r\n\r\nnotice(Timestamp('1970-01-01 01:02:03 UTC'))\r\n\r\nWill result in a timestamp of \"1970-01-01T00:00:00.000000000 UTC\"","closed_at":"2017-07-19T14:22:49.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7753","labels":"","state":"Closed","updated_at":"2017-07-19T14:22:49.000-0700","timestamp":1652285450.330206,"priority":"Normal","status_category":"Done","pull_request":6044},{"issue_id":"197094","title":"Puppet acceptance tests failures on Power 8 Ubuntu 16.04 and Rhel 7","url":"https://tickets.puppetlabs.com/browse/PUP-7684","created_at":"2017-06-20T13:12:31.000-0700","number":"PUP-7684","body":"Ubuntu on Power 8\r\n\r\nThe following tests are failing they're all test issues as the fqdn and the agent.hostname are not the same and the test is expects them to be.\r\n\r\nTest Case tests/reports/corrective_change_new_resource.rb\r\nTest Case tests/reports/corrective_change_outside_puppet.rb\r\nTest Case tests/reports/corrective_change_via_puppet.rb\r\nTest Case tests/resource/file/ticket_6448_file_with_utf8_source.rb","closed_at":"2017-07-19T14:22:49.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7684","labels":"","state":"Closed","updated_at":"2017-07-19T14:22:49.000-0700","timestamp":1652285450.432839,"priority":"Normal","status_category":"Done","pull_request":6031},{"issue_id":"199823","title":"Puppet 5.0 Regression: puppet resource with --modulepath no longer loads expected code","url":"https://tickets.puppetlabs.com/browse/PUP-7766","created_at":"2017-07-10T16:58:25.000-0700","number":"PUP-7766","body":"Previously, when calling {{puppet resource}}, a {{--modulepath}} could be specified to load additional type / provider code.\r\n\r\nFor instance, with Puppet 4.10.4 / Ruby 2.3 running against a Windows node:\r\n\r\n{code}\r\nbundle exec puppet resource acl c:\\windows --modulepath C:\\source\\puppetlabs-acl-master\\spec\\fixtures\\modules\r\nacl { 'c:\\windows':\r\n  group                      => 'S-1-5-80-956008885-3418522649-1831038044-1853292631-2271478464',\r\n  inherit_parent_permissions => 'false',\r\n  owner                      => 'S-1-5-80-956008885-3418522649-1831038044-1853292631-2271478464',\r\n  permissions                => [{'affects' => 'self_only', 'identity' => 'NT SERVICE\\TrustedInstaller', 'rights' => ['full']}, {'affects' => 'children_only', 'child_types' => 'containers', 'identity' => 'NT SERVICE\\TrustedInstaller', 'rights' => ['full']}, {'affects' => 'self_only', 'identity' => 'NT AUTHORITY\\SYSTEM', 'rights' => ['modify']}, {'affects' => 'children_only', 'identity' => 'NT AUTHORITY\\SYSTEM', 'rights' => ['full']}, {'affects' => 'self_only', 'identity' => 'BUILTIN\\Administrators', 'rights' => ['modify']}, {'affects' => 'children_only', 'identity' => 'BUILTIN\\Administrators', 'rights' => ['full']}, {'affects' => 'self_only', 'identity' => 'BUILTIN\\Users', 'rights' => ['read', 'execute']}, {'affects' => 'children_only', 'identity' => 'BUILTIN\\Users', 'rights' => ['read', 'execute']}, {'affects' => 'children_only', 'identity' => 'CREATOR OWNER', 'rights' => ['full']}, {'affects' => 'self_only', 'identity' => 'APPLICATION PACKAGE AUTHORITY\\ALL APPLICATION PACKAGES', 'rights' => ['read', 'execute']}, {'affects' => 'children_only', 'identity' => 'APPLICATION PACKAGE AUTHORITY\\ALL APPLICATION PACKAGES', 'rights' => ['read', 'execute']}],\r\n}\r\n{code}\r\n\r\nHowever, on Puppet 5:\r\n\r\n{code}\r\n bundle exec puppet resource acl c:\\windows --modulepath C:\\source\\puppetlabs-acl-master\\spec\\fixtures\\modules --trace --debug --verbose\r\nDebug: Runtime environment: puppet_version=5.0.0, ruby_version=2.4.1, run_mode=user, default_encoding=IBM437\r\nDebug: Evicting cache entry for environment 'production'\r\nDebug: Caching environment 'production' (ttl = 0 sec)\r\nError: Could not run: Could not find type acl\r\nC:/source/puppet/lib/puppet/application/resource.rb:193:in `parse_args'\r\nC:/source/puppet/lib/puppet/application/resource.rb:134:in `block in main'\r\nC:/source/puppet/lib/puppet/context.rb:65:in `override'\r\nC:/source/puppet/lib/puppet.rb:308:in `override'\r\nC:/source/puppet/lib/puppet/application/resource.rb:133:in `main'\r\nC:/source/puppet/lib/puppet/application.rb:366:in `run_command'\r\nC:/source/puppet/lib/puppet/application.rb:358:in `block in run'\r\nC:/source/puppet/lib/puppet/util.rb:666:in `exit_on_fail'\r\nC:/source/puppet/lib/puppet/application.rb:358:in `run'\r\nC:/source/puppet/lib/puppet/util/command_line.rb:132:in `run'\r\nC:/source/puppet/lib/puppet/util/command_line.rb:72:in `execute'\r\nC:/source/puppet/bin/puppet:5:in `<top (required)>'\r\nC:/source/puppet/.bundle/gems/ruby/2.4.0/bin/puppet:22:in `load'\r\nC:/source/puppet/.bundle/gems/ruby/2.4.0/bin/puppet:22:in `<main>'\r\n{code}\r\n\r\nI was able to git bisect to determine the source of the problem in https://github.com/puppetlabs/puppet/commit/72ecbe429ce5136ffe4ab628672d6dc9faabfcdc\r\n\r\nIt seems that only code in the extended environment directory will now be loaded, which is a regression from previous behavior.  I believe that {{--modulepath}} is commonly in use for module development workflows.  For instance, I have been using the below for several years:\r\n\r\n{code}\r\nbundle exec rake spec_prep\r\n\r\n# work on code\r\n\r\n# run unit tests\r\nbundle exec rake spec_standalone\r\n\r\n# run interactive tests with apply or resource\r\nbundle exec puppet apply foo.pp --modulepath ./spec/fixtures/modules\r\n{code}","closed_at":"2017-07-19T14:22:49.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7766","labels":"regression","state":"Closed","updated_at":"2017-07-19T14:22:49.000-0700","timestamp":1652285450.538532,"priority":"Critical","status_category":"Done","pull_request":6072},{"issue_id":"198741","title":"Update vendored version of the semantic_puppet gem to version 1.0.1","url":"https://tickets.puppetlabs.com/browse/PUP-7747","created_at":"2017-06-30T23:58:26.000-0700","number":"PUP-7747","body":"The bug detected in MODULES-5159 was fixed in [PR-26 for semantic_puppet|https://github.com/puppetlabs/semantic_puppet/pull/26] and subsequently released in version 1.0.1 of the gem. This fix must be propagated to the gem that is vendored in the puppet code-base.","closed_at":"2017-07-19T14:22:49.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7747","labels":"","state":"Closed","updated_at":"2017-07-19T14:22:49.000-0700","timestamp":1652285450.641155,"priority":"Normal","status_category":"Done","pull_request":6034},{"issue_id":"200253","title":"Acceptance tests/resource/package/common_package_name_in_different_providers.rb fails in Amazon Linux","url":"https://tickets.puppetlabs.com/browse/PUP-7774","created_at":"2017-07-12T16:21:19.000-0700","number":"PUP-7774","body":"The test installs a {{guid}} gem and package, but the package cannot be installed in the Amazon Linux environment:\r\n\r\n{noformat}\r\n14:43:31       ec2-35-166-77-127.us-west-2.compute.amazonaws.com (redhat6-64-2) 14:43:31$ puppet apply --verbose /tmp/apply_manifest.pp.xrEZ1D\r\n14:43:31         Notice: Compiled catalog for ec2-35-166-77-127.us-west-2.compute.amazonaws.com in environment production in 0.62 seconds\r\n14:43:33         Info: Applying configuration version '1499895812'\r\n14:43:33         Error: Execution of '/usr/bin/yum -d 0 -e 0 -y install guid' returned 1: Error: Nothing to do\r\n14:43:34         Error: /Stage[main]/Main/Package[guid]/ensure: change from purged to present failed: Execution of '/usr/bin/yum -d 0 -e 0 -y install guid' returned 1: Error: Nothing to do\r\n14:43:34         Notice: /Stage[main]/Main/Package[gem-guid]/ensure: created\r\n14:43:36         Info: Class[Main]: Unscheduling all events on Class[Main]\r\n14:43:36         Notice: Applied catalog in 2.66 seconds\r\n{noformat}","closed_at":"2017-07-19T14:22:50.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7774","labels":"","state":"Closed","updated_at":"2017-07-19T14:22:50.000-0700","timestamp":1652285450.743957,"priority":"Normal","status_category":"Done","pull_request":6065},{"issue_id":"198012","title":"Puppet 5 adds generate_ast_model rake task which breaks gem/tarball creatio","url":"https://tickets.puppetlabs.com/browse/PUP-7736","created_at":"2017-06-27T12:20:57.000-0700","number":"PUP-7736","body":"Most of the machines we use at build-time do not have puppet/facter installed as gems. The generate_ast_model rake task requires puppet (which in turn requires facter), which causes gem and tarball generation to fail since the build environment can't load facter and the Rakefile loads all rake files under tasks.\r\n\r\nThe generate_ast_model tasks are not required at build time and as such should be conditionally enabled, if we are able to successfully load puppet.\r\n\r\n","closed_at":"2017-07-19T14:22:50.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7736","labels":"","state":"Closed","updated_at":"2017-07-19T14:22:50.000-0700","timestamp":1652285450.955605,"priority":"Normal","status_category":"Done","pull_request":6023},{"issue_id":"197035","title":"Create acceptance test for PUP-7671","url":"https://tickets.puppetlabs.com/browse/PUP-7680","created_at":"2017-06-20T10:11:32.000-0700","number":"PUP-7680","body":null,"closed_at":"2017-07-19T14:22:50.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7680","labels":"","state":"Closed","updated_at":"2017-07-19T14:22:50.000-0700","timestamp":1652285451.058795,"priority":"Normal","status_category":"Done","pull_request":6041},{"issue_id":"198347","title":"Regression: cannot set file owner to new user when purging unmanaged users","url":"https://tickets.puppetlabs.com/browse/PUP-7742","created_at":"2017-06-29T06:34:24.000-0700","number":"PUP-7742","body":"When using \"resources { 'user': purge => true }\", a file owned by a puppet-managed user cannot be created when that user is being created in the same run.\r\n\r\nSimple test case:\r\n\r\n{code:title=test.pp}\r\ngroup { 'test':\r\n  ensure => 'present',\r\n  system => true,\r\n}\r\n\r\nuser { 'test':\r\n  ensure => 'present',\r\n  system => true,\r\n  groups => [],\r\n}\r\n\r\nfile { '/tmp/test':\r\n  ensure => 'file',\r\n  owner  => 'test',\r\n  group  => 'test',\r\n  mode   => '0644',\r\n}\r\n\r\nresources { 'user':\r\n  purge => true,\r\n}\r\n{code}\r\n\r\nUnder CentOS 7.3, this successfully creates the user and group, and creates the /tmp/test file with ownership root:root (should be test:test), and errors:\r\n\r\n{code}\r\n[vagrant@hashiserver-1 vagrant]$ sudo puppet apply test.pp \r\nNotice: Compiled catalog for hashiserver-1.node.vagrant.consul in environment production in 0.12 seconds\r\nNotice: /Stage[main]/Main/Group[test]/ensure: created\r\nNotice: /Stage[main]/Main/User[test]/ensure: created\r\nError: Could not set 'file' on ensure: Could not find user test at /vagrant/test.pp:12\r\nError: Could not set 'file' on ensure: Could not find user test at /vagrant/test.pp:12\r\nWrapped exception:\r\nCould not find user test\r\nError: /Stage[main]/Main/File[/tmp/test]/ensure: change from absent to file failed: Could not set 'file' on ensure: Could not find user test at /vagrant/test.pp:12\r\nNotice: Applied catalog in 0.29 seconds\r\n{code}\r\n\r\nA subsequent \"sudo puppet apply test.pp\" completes successfully.\r\n\r\nThis problem was introduced in puppet-agent 4.10.2.","closed_at":"2017-07-19T14:22:51.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7742","labels":"","state":"Closed","updated_at":"2017-07-19T14:22:51.000-0700","timestamp":1652285451.267653,"priority":"Normal","status_category":"Done","pull_request":6060},{"issue_id":"25797","title":"symbolic_modes.rb acceptance test is really slow","url":"https://tickets.puppetlabs.com/browse/PUP-1607","created_at":"2014-02-06T22:04:38.000-0800","number":"PUP-1607","body":"[~ethan] added performance data to Jenkins which pointed out that the symbolic_modes.rb test is really slow. It would be nice to speed this test up so that acceptance runs are quicker.","closed_at":"2017-07-19T14:22:51.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1607","labels":"maintenance","state":"Closed","updated_at":"2017-07-19T14:22:51.000-0700","timestamp":1652285451.477825,"priority":"Normal","status_category":"Done","pull_request":6020},{"issue_id":"198911","title":"Lookup sort_merged_arrays vs. sort_merge_arrays","url":"https://tickets.puppetlabs.com/browse/PUP-7751","created_at":"2017-07-05T00:55:02.000-0700","number":"PUP-7751","body":"When specifying sort_merged_arrays in hiera data as shown here:\r\n\r\n{noformat}\r\nlookup_options:\r\n  classifier::extra_classes:\r\n    merge:\r\n      strategy: deep\r\n      knockout_prefix: --\r\n      sort_merged_arrays: true\r\n  classifier::rules:\r\n    merge:\r\n      strategy: deep\r\n      knockout_prefix: --\r\n{noformat}\r\n\r\nthe compiler fails:\r\n\r\n{noformat}\r\nError: Evaluation Error: Error while evaluating a Function Call, The merge options has wrong type, unrecognized key 'sort_merged_arrays' at /home/user/.puppetlabs/etc/code/environments/production/manifests/site.pp:4:3 on node notebook.local\r\n{noformat}\r\n\r\nspelling it {{sort_merge_arrays}}  fixes the problem.\r\n\r\nalso this snippet fails: \r\n\r\n{noformat}\r\n  lookup({\r\n    'name' => 'classifier::rules',\r\n    'merge' => {\r\n      'strategy' => 'deep',\r\n      'sort_merged_arrays' => true,\r\n     },\r\n  })\r\n{noformat}\r\n\r\noutput:\r\n\r\n{noformat}\r\nError: Evaluation Error: Error while evaluating a Function Call, The merge options has wrong type, unrecognized key 'sort_merged_arrays' at /home/user/.puppetlabs/etc/code/environments/production/manifests/site.pp:4:3 on node notebook.local\r\n{noformat}\r\n\r\nGrepping the puppet git repo there are different places where sort_merge_arrays and sort_merged_arrays is used.\r\n\r\nsort_merged_arrays is documented here: https://docs.puppet.com/puppet/5.0/hiera_use_function.html","closed_at":"2017-07-19T14:22:51.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7751","labels":"","state":"Closed","updated_at":"2017-07-19T14:22:51.000-0700","timestamp":1652285451.584128,"priority":"Normal","status_category":"Done","pull_request":6038},{"issue_id":"200243","title":"Puppet fails to create error message when an exec fails","url":"https://tickets.puppetlabs.com/browse/PUP-7772","created_at":"2017-07-12T15:59:52.000-0700","number":"PUP-7772","body":"The chocolatey module was failing spec tests on Ruby 2.4.0 and Puppet 5.  example output\r\nhttps://ci.appveyor.com/project/puppetlabs/puppetlabs-chocolatey/build/1.1.x.379/job/8k8kvkt9moka317t\r\n{code}\r\n...\r\nFailures:\r\n  1) Puppet::Type::Package::ProviderChocolatey when fetching a package list should invoke provider listcmd\r\n     Failure/Error:\r\n       execpipe(listcmd) do |process|\r\n         process.each_line do |line|\r\n           line.chomp!\r\n           if line.empty? or line.match(/Reading environment variables.*/); next; end\r\n           raise Puppet::Error, \"At least one source must be enabled.\" if line.match(/Unable to search for packages.*/)\r\n           if choco_exe\r\n             values = line.split('|')\r\n           else\r\n             values = line.split(' ')\r\n           end\r\n     NoMethodError:\r\n       undefined method `encoding' for #<IO:(closed)>\r\n       Did you mean?  set_encoding\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/puppet-5.0.0-x86-mingw32/lib/puppet/util/character_encoding.rb:93:in `scrub'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/puppet-5.0.0-x86-mingw32/lib/puppet/error.rb:6:in `initialize'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/puppet-5.0.0-x86-mingw32/lib/puppet/util/execution.rb:86:in `exception'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/puppet-5.0.0-x86-mingw32/lib/puppet/util/execution.rb:86:in `raise'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/puppet-5.0.0-x86-mingw32/lib/puppet/util/execution.rb:86:in `execpipe'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/puppet-5.0.0-x86-mingw32/lib/puppet/provider.rb:117:in `execpipe'\r\n     # ./lib/puppet/provider/package/chocolatey.rb:198:in `instances'\r\n     # ./spec/unit/puppet/provider/package/chocolatey_spec.rb:432:in `block (3 levels) in <top (required)>'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example.rb:254:in `instance_exec'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example.rb:254:in `block in run'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example.rb:500:in `block in with_around_and_singleton_context_hooks'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example.rb:457:in `block in with_around_example_hooks'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/hooks.rb:464:in `block in run'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/hooks.rb:602:in `run_around_example_hooks_for'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/hooks.rb:464:in `run'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example.rb:457:in `with_around_example_hooks'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example.rb:500:in `with_around_and_singleton_context_hooks'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example.rb:251:in `run'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example_group.rb:627:in `block in run_examples'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example_group.rb:623:in `map'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example_group.rb:623:in `run_examples'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example_group.rb:589:in `run'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example_group.rb:590:in `block in run'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example_group.rb:590:in `map'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/example_group.rb:590:in `run'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/runner.rb:118:in `block (3 levels) in run_specs'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/runner.rb:118:in `map'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/runner.rb:118:in `block (2 levels) in run_specs'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/configuration.rb:1894:in `with_suite_hooks'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/runner.rb:113:in `block in run_specs'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/reporter.rb:79:in `report'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/runner.rb:112:in `run_specs'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/runner.rb:87:in `run'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/runner.rb:71:in `run'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/lib/rspec/core/runner.rb:45:in `invoke'\r\n     # C:/Ruby24/lib/ruby/gems/2.4.0/gems/rspec-core-3.6.0/exe/rspec:4:in `<top (required)>'\r\n     # C:/Ruby24/bin/rspec:23:in `load'\r\n     # C:/Ruby24/bin/rspec:23:in `<main>'\r\nFinished in 2.06 seconds (files took 2.91 seconds to load)\r\n194 examples, 1 failure\r\nFailed examples:\r\n{code}\r\n\r\nFurther digging found:\r\n1.  The spec test is ending up with a nil value for the command_str which causes the open command to error\r\nhttps://github.com/puppetlabs/puppet/blame/master/lib/puppet/util/execution.rb#L80\r\n\r\n2. This error is then caught however instead of {{output}} having the output of the command, it has the output of the failed open state, i.e. an IO<closed> object\r\n\r\n3. This is then raised as an error at\r\nhttps://github.com/puppetlabs/puppet/blame/master/lib/puppet/util/execution.rb#L86\r\n\r\n4. The error class  is then initialized and the new scrub function called at;\r\nhttps://github.com/puppetlabs/puppet/blame/master/lib/puppet/error.rb#L6\r\n\r\n5. The scrub function at;\r\nhttps://github.com/puppetlabs/puppet/blame/master/lib/puppet/util/character_encoding.rb#L89-L96\r\n\r\nThen tries to scrub the object, however it assumes that it's a string, but what's passed in is an IO object.  This then fails on (https://github.com/puppetlabs/puppet/blame/master/lib/puppet/util/character_encoding.rb#L89-L96) because it does not have an encoding method.\r\n\r\nThis only appears to have started in Puppet 5.\r\n\r\nPossible resolutions:\r\n1. Scrub function should not assume it's a string coming in.  If it's not a string, just spit the original value out.\r\n\r\n2. The execpipe should not assume the output is a string and should cast output to a string prior to raising the error message","closed_at":"2017-07-28T14:12:23.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7772","labels":"","state":"Closed","updated_at":"2017-07-28T14:12:23.000-0700","timestamp":1652285464.931434,"priority":"Critical","status_category":"Done","pull_request":6066},{"issue_id":"202310","title":"Disabling automatic class parameter lookup in Hiera 5 also disables the global hierarchy layer","url":"https://tickets.puppetlabs.com/browse/PUP-7802","created_at":"2017-07-24T16:28:17.000-0700","number":"PUP-7802","body":"Disabling automatic class parameter lookup in Hiera 5 also disables the global hierarchy layer\r\n\r\nPrior to Puppet 4.9.0 and the integration of Hiera 5, setting the {{data_binding_terminus}} to {{none}} would disable automatic lookup of class parameters while keeping explicit lookups via the {{hiera()}} functions enabled. Starting with Puppet 4.9.0, setting {{data_binding_terminus}} to {{none}} disables {{hiera()}} entirely.\r\n\r\nh2. Reproduction Case\r\n\r\n*  Install PE 2016.4.6.\r\n*  Replace ` /etc/puppetlabs/code/environments/production/manifests/site.pp` with the following content:\r\n\r\n{code:puppet}\r\nclass testclass (\r\n  $param1 = 'default',\r\n  $param2 = 'default',\r\n) {\r\n\r\n  notify {\"param1: ${param1}\": }\r\n  notify {\"param2: ${param2}\": }\r\n\r\n}\r\n\r\nnode default {\r\n  class {'testclass':\r\n    param1 => hiera('param1'),\r\n  }\r\n}\r\n{code}\r\n\r\n*  Add the following data to {{/etc/puppetlabs/code/environments/production/hieradata/common.yaml}}:\r\n\r\n{code}\r\nparam1: hiera_override\r\ntestclass::param2: hiera_override\r\n{code}\r\n\r\n*  Disable the data_binding_terminus:\r\n\r\n{code}\r\npuppet config set --section master data_binding_terminus none\r\n{code}\r\n\r\n*  Re-start {{pe-puppetserver}}\r\n*  Run {{puppet agent -t}}\r\n\r\nh3. Outcome\r\n\r\nThe puppet run fails with a {{lookup()}} error:\r\n\r\n{noformat}\r\n[root@pe-201646-master production]# puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nError: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Function lookup() did not find a value for the name 'param1' on node pe-201646-master.puppetdebug.vlan\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\n{noformat}\r\n\r\nh3. Expected Outcome\r\n\r\nThe run succeeds, and only param1 of testclass is overridden via Hiera data:\r\n\r\n{noformat}\r\n[root@pe-201643-master manifests]# puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for pe-201643-master.puppetdebug.vlan\r\nInfo: Applying configuration version '1500938483'\r\nNotice: param1: hiera_override\r\nNotice: /Stage[main]/Testclass/Notify[param1: hiera_override]/message: defined 'message' as 'param1: hiera_override'\r\nNotice: param2: default\r\nNotice: /Stage[main]/Testclass/Notify[param2: default]/message: defined 'message' as 'param2: default'\r\nNotice: Applied catalog in 11.76 seconds\r\n{noformat}\r\n\r\nThis was the behavior prior to Puppet 4.9.","closed_at":"2017-08-10T10:46:10.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7802","labels":"","state":"Closed","updated_at":"2017-08-10T10:46:10.000-0700","timestamp":1652285465.917966,"priority":"Critical","status_category":"Done","pull_request":6087},{"issue_id":"177470","title":"Acceptance:  Modified test to add tstpool & pointed manifest to available interface","url":"https://tickets.puppetlabs.com/browse/PUP-7282","created_at":"2017-02-28T09:50:47.000-0800","number":"PUP-7282","body":"This test currently fails because the manifest does not create the /ztstpool directory before trying to create the /ztstpool/mnt directory","closed_at":"2017-08-16T08:20:39.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7282","labels":"","state":"Closed","updated_at":"2017-08-16T08:20:39.000-0700","timestamp":1652285466.54255,"priority":"Normal","status_category":"Done","pull_request":5668},{"issue_id":"190046","title":"reduce does not work with break()","url":"https://tickets.puppetlabs.com/browse/PUP-7514","created_at":"2017-05-10T02:25:37.000-0700","number":"PUP-7514","body":"It is not possible to call {{break()}} from within a {{reduce}} function. The result is an error stating that\r\n{code}\r\nError: break() from context where this is illegal\r\n{code}\r\n\r\nThis is because the handling of the {{StopIteration}} required is missing in the implementation of {{reduce}}.","closed_at":"2017-08-16T12:19:36.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7514","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-08-16T12:19:36.000-0700","timestamp":1652285466.756417,"priority":"Normal","status_category":"Done","pull_request":5857},{"issue_id":"159905","title":"Puppet package provider for Python's pip fails when Perl's pip is installed","url":"https://tickets.puppetlabs.com/browse/PUP-6895","created_at":"2016-11-06T19:23:03.000-0800","number":"PUP-6895","body":"pip provider does not work with perl pip (pip.bat) installed on windows\r\nworkaround is to add \"pip.exe\"\r\n\r\nunder \r\n\r\n{code}\r\ndef self.cmd\r\n    [\"pip\", \"pip-python\"]\r\nend\r\n{code}\r\n\r\nat https://github.com/puppetlabs/puppet/blob/484623eda09d8e8b9857f5279ebb891a423588dc/lib/puppet/provider/package/pip.rb#L51\r\n\r\nother links for reference:\r\nhttp://www.penwatch.net/cms/?p=561\r\nhttps://codedump.io/share/cdbKgmH5wJvW/1/pip-on-windows-giving-the-error---unknown-or-unsupported-command-39install39\r\nhttp://stackoverflow.com/questions/7469361/pip-on-windows-giving-the-error-unknown-or-unsupported-command-install\r\n\r\n","closed_at":"2017-08-18T07:13:45.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6895","labels":"help_wanted;maintenance;windows","state":"Closed","updated_at":"2017-08-18T07:13:45.000-0700","timestamp":1652285467.072339,"priority":"Normal","status_category":"Done","pull_request":5903},{"issue_id":"136960","title":"Pip package provider runs every time when updating setuptools","url":"https://tickets.puppetlabs.com/browse/PUP-6405","created_at":"2016-06-14T10:24:02.000-0700","number":"PUP-6405","body":"Similar to PUP-6120, I see a problem with 'setuptools' (which also doesn't show up in pip output). The current workaround seems kind of cumbersome. While this is with 3.8.7, I imagine the setuptools problem might be reproducible in newer puppet.\r\n\r\nHow common is pip < 1.2.2? Seems like \"pip freeze --all\" would also work, but appears to also not be implemented in 1.0.x.\r\n\r\nMaybe pip could just update itself first (or require a minimum version), then use 'pip list' or 'pip freeze \\-\\-all' for determining versions of everything else? Or determine pip version first, then add the '--all' flag in cases where it's supported? Then at least it would \"see\" pip and setuptools if the version of pip is recent enough.\r\n\r\nThis is with older Puppet (3.8) without the fix for 6120, but same \r\n\r\n{noformat}\r\nDebug: Executing '/bin/pip freeze'\r\nDebug: Executing '/bin/pip install -q --upgrade setuptools'\r\nNotice: /Stage[main]/Role::Dp/Package[setuptools]/ensure: created\r\n{noformat}\r\n\r\n{noformat}\r\n  package { 'pip':\r\n              ensure   => latest,\r\n              install_options => '--upgrade',\r\n              provider => 'pip' } ->\r\n  package { 'setuptools':\r\n              ensure   => latest,\r\n              install_options => '--upgrade',\r\n              provider => 'pip' } ->\r\n{noformat}\r\n\r\n{noformat}\r\n# pip --version\r\npip 8.1.2 from /usr/lib/python2.7/site-packages (python 2.7)\r\n# pip freeze | grep ^setuptools\r\n# pip freeze --all | grep ^setuptools\r\nsetuptools==23.0.0\r\n# pip list | grep ^setuptools\r\nsetuptools (23.0.0)\r\n{noformat}","closed_at":"2017-08-18T07:13:45.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6405","labels":"","state":"Closed","updated_at":"2017-08-18T07:13:45.000-0700","timestamp":1652285467.17791,"priority":"Normal","status_category":"Done","pull_request":5702},{"issue_id":"93963","title":"POSIX Exec throws error when group has no name","url":"https://tickets.puppetlabs.com/browse/PUP-5047","created_at":"2015-08-17T18:13:17.000-0700","number":"PUP-5047","body":"If trying to execute with the group set to a group that has no name (just number), an error will be thrown:\r\n\r\nBad file descriptor (Errno::EBADF)\r\n\r\nThis occurs even if the group ID is passed in.\r\n\r\nDigging in, seems to be a failure in Puppet::Util::POSIX#gid. If I add a check to see if the group ID is an integer and skip this call, it skips this check and the exec works fine [1]\r\n\r\nThis is reproducible with Etc.getgrgid, so not sure if it's an issue elsewhere. Overall though, if an integer is passed in as the group seems like we can just skip this altogether. It will remove intentional verification, but we will end up with an error regardless so I'm not sure that's a big issue.\r\n\r\nIf it's agreed this is an issue, I'm happy to work up a proper PR.\r\n\r\n[1]: https://github.com/lstoll/puppet/commit/53efaffcb45fc165b12685f2085c1f732e4bfb9b","closed_at":"2017-08-18T07:13:46.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5047","labels":"","state":"Closed","updated_at":"2017-08-18T07:13:46.000-0700","timestamp":1652285467.286651,"priority":"Normal","status_category":"Done","pull_request":6083},{"issue_id":"110901","title":"Can't install gems on Arch Linux","url":"https://tickets.puppetlabs.com/browse/PUP-5645","created_at":"2016-01-03T05:03:22.000-0800","number":"PUP-5645","body":"Update: This might be a [gem issue|https://bugs.ruby-lang.org/issues/12070] rather than a Puppet issue. Keeping this open since it's not clear yet what the issue is, and since I can only reproduce when the gem command is run with Puppet.\r\n\r\nFrom [unix.stackexchange.com post|https://unix.stackexchange.com/q/252937/3645]:\r\n\r\nI've got [the following|https://github.com/l0b0/root/blob/cf94a48397bb2323bbecfd657b43d6fd748818c8/modules/travis_linter/manifests/init.pp]:\r\n\r\n{code:puppet}\r\nclass travis_linter {\r\n  include shell\r\n\r\n  package { 'travis-lint':\r\n    ensure   => latest,\r\n    provider => gem,\r\n  }\r\n}\r\n{code}\r\n\r\nWhen I try to [test it|https://github.com/l0b0/root/tree/cf94a48397bb2323bbecfd657b43d6fd748818c8#test], however, I get the following Puppet output:\r\n\r\n{noformat}\r\n==> default: Debug: Executing: '/usr/bin/gem install --no-rdoc --no-ri travis-lint'\r\n==> default: Error: Could not update: Execution of '/usr/bin/gem install --no-rdoc --no-ri travis-lint' returned 1: ERROR:  While executing gem ... (TypeError)\r\n==> default:     wrong argument type nil (expected Regexp)\r\n==> default: Error: /Stage[main]/Travis_linter/Package[travis-lint]/ensure: change from absent to latest failed: Could not update: Execution of '/usr/bin/gem install --no-rdoc --no-ri travis-lint' returned 1: ERROR:  While executing gem ... (TypeError)\r\n==> default:     wrong argument type nil (expected Regexp)\r\n{noformat}\r\n\r\nOther possibly relevant output from the [full log file|http://pastebin.com/GgT3Vy1E]:\r\n\r\n\r\n{noformat}\r\nDebug: Puppet::Type::Package::ProviderPuppet_gem: file /opt/puppetlabs/puppet/bin/gem does not exist\r\nDebug: /Package[puppet-lint]: Provider gem does not support features virtual_packages; not managing attribute allow_virtual\r\nDebug: /Package[reek]: Provider gem does not support features virtual_packages; not managing attribute allow_virtual\r\nDebug: /Package[travis-lint]: Provider gem does not support features virtual_packages; not managing attribute allow_virtual\r\n{noformat}\r\n\r\nSetting `ensure` to `2.0.0` didn't help, so it's not related to the `latest` keyword:\r\n\r\n{noformat}\r\nError: Could not update: Execution of '/usr/bin/gem install -v 2.0.0 --no-rdoc --no-ri travis-lint' returned 1: ERROR:  While executing gem ... (TypeError)\r\n    wrong argument type nil (expected Regexp)\r\n{noformat}\r\n\r\nI am able to run the exact same command manually:\r\n\r\n{noformat}\r\n[vagrant@archlinux ~]$ /usr/bin/gem install --no-rdoc --no-ri travis-lint\r\nFetching: travis-lint-2.0.0.gem (100%)\r\nWARNING:  You don't have /home/vagrant/.gem/ruby/2.3.0/bin in your PATH,\r\n          gem executables will not run.\r\nSuccessfully installed travis-lint-2.0.0\r\n1 gem installed\r\n{noformat}\r\n\r\nIs my Puppet manifest wrong, or is something broken about Puppet/Gem? Is it possible that `latest` is not a valid value for gems?\r\n\r\nIt works fine on [Travis CI (Ubuntu 12.04)|https://travis-ci.org/l0b0/root/builds/99846406#L1153-L1156]:\r\n\r\n{noformat}\r\nDebug: Executing: '/home/travis/.rvm/rubies/ruby-2.2.3/bin/gem list --local ^travis-lint$'\r\nDebug: Executing: '/home/travis/.rvm/rubies/ruby-2.2.3/bin/gem install --no-rdoc --no-ri travis-lint'\r\nNotice: /Stage[main]/Travis_linter/Package[travis-lint]/ensure: created\r\nDebug: /Package[travis-lint]: The container Class[Travis_linter] will propagate my refresh event\r\n{noformat}","closed_at":"2017-08-18T07:13:47.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5645","labels":"gem;manage-package;non-root","state":"Closed","updated_at":"2017-08-18T07:13:47.000-0700","timestamp":1652285467.392201,"priority":"Blocker","status_category":"Done","pull_request":6099},{"issue_id":"154008","title":"Puppet::FileBucket::Dipper specs fail silently","url":"https://tickets.puppetlabs.com/browse/PUP-6756","created_at":"2016-09-28T13:13:12.000-0700","number":"PUP-6756","body":"dipper_spec assumes gnu diff AND executes diff via ``s notably this fails on Solaris but may also fail on other platforms\r\n\r\nCurrent\r\n----\r\n{code:ruby}\r\nrspec spec/unit/file_bucket/dipper_spec.rb\r\nRun options: exclude {:broken=>true, :benchmark=>true}\r\n....diff: illegal option -- N\r\nusage: diff [-bitw] [-c | -e | -f | -h | -n | -u] file1 file2\r\n       diff [-bitw] [-C number | -U number] file1 file2\r\n       diff [-bitw] [-D string] file1 file2\r\n       diff [-bitw] [-c | -e | -f | -h | -n | -u] [-l] [-r] [-s] [-S name] directory1 directory2\r\ndiff: illegal option -- N\r\nusage: diff [-bitw] [-c | -e | -f | -h | -n | -u] file1 file2\r\n       diff [-bitw] [-C number | -U number] file1 file2\r\n       diff [-bitw] [-D string] file1 file2\r\n       diff [-bitw] [-c | -e | -f | -h | -n | -u] [-l] [-r] [-s] [-S name] directory1 directory2\r\n..diff: illegal option -- N\r\nusage: diff [-bitw] [-c | -e | -f | -h | -n | -u] file1 file2\r\n       diff [-bitw] [-C number | -U number] file1 file2\r\n       diff [-bitw] [-D string] file1 file2\r\n       diff [-bitw] [-c | -e | -f | -h | -n | -u] [-l] [-r] [-s] [-S name] directory1 directory2\r\ndiff: illegal option -- N\r\nusage: diff [-bitw] [-c | -e | -f | -h | -n | -u] file1 file2\r\n       diff [-bitw] [-C number | -U number] file1 file2\r\n       diff [-bitw] [-D string] file1 file2\r\n       diff [-bitw] [-c | -e | -f | -h | -n | -u] [-l] [-r] [-s] [-S name] directory1 directory2\r\n................................\r\n\r\nFinished in 1.6 seconds (files took 2.47 seconds to load)\r\n38 examples, 0 failures\r\n{code}\r\n\r\n\r\nWith Puppet::Util::Execution.execute\r\n----\r\n{code:java}\r\nrspec spec/unit/file_bucket/dipper_spec.rb\r\nRun options: exclude {:broken=>true, :benchmark=>true}\r\n....F.F...............................\r\n\r\nFailures:\r\n\r\n  1) Puppet::FileBucket::Dipper when diffing on a local filebucket in non-windows environments when digest_algorithm is md5 should properly diff files on the filebucket\r\n     Failure/Error: expect(@dipper.diff(checksum1, checksum2, nil, nil)).to include(diff12)\r\n\r\n       expected \"--- /tmp/rspecrun20160928-29191-mm3g5/bucket20160928-29191-ucq5dv/a/a/e/e/8/e/f/2/aaee8ef2aebce5861b...e7/contents\\t2016-09-28 13:05:52.245200560 -0700\\n@@ -1 +1 @@\\n-OriginalContent\\n+ModifiedContent\\n\" to include \"diff: illegal option -- N\\nusage: diff [-bitw] [-c | -e | -f | -h | -n | -u] file1 file2\\n       dif...n       diff [-bitw] [-c | -e | -f | -h | -n | -u] [-l] [-r] [-s] [-S name] directory1 directory2\\n\"\r\n       Diff:\r\n       @@ -1,2 +1,6 @@\r\n       -diff: illegal option -- N\\nusage: diff [-bitw] [-c | -e | -f | -h | -n | -u] file1 file2\\n       diff [-bitw] [-C number | -U number] file1 file2\\n       diff [-bitw] [-D string] file1 file2\\n       diff [-bitw] [-c | -e | -f | -h | -n | -u] [-l] [-r] [-s] [-S name] directory1 directory2\\n\r\n       +--- /tmp/rspecrun20160928-29191-mm3g5/bucket20160928-29191-ucq5dv/a/a/e/e/8/e/f/2/aaee8ef2aebce5861bddd2c59afdf3f1/contents     2016-09-28 13:05:52.244125030 -0700\r\n       ++++ /tmp/rspecrun20160928-29191-mm3g5/bucket20160928-29191-ucq5dv/7/c/3/0/c/6/c/4/7c30c6c414286afdd1ad6b78cf6c75e7/contents     2016-09-28 13:05:52.245200560 -0700\r\n       +@@ -1 +1 @@\r\n       +-OriginalContent\r\n       ++ModifiedContent\r\n     # ./spec/unit/file_bucket/dipper_spec.rb:111:in `block (5 levels) in <top (required)>'\r\n\r\n  ...\r\n\r\nFinished in 1.15 seconds (files took 3.46 seconds to load)\r\n38 examples, 2 failures\r\n\r\nFailed examples:\r\n\r\nrspec ./spec/unit/file_bucket/dipper_spec.rb[1:3:1:1:2] # Puppet::FileBucket::Dipper when diffing on a local filebucket in non-windows environments when digest_algorithm is md5 should properly diff files on the filebucket\r\nrspec ./spec/unit/file_bucket/dipper_spec.rb[1:3:1:2:2] # Puppet::FileBucket::Dipper when diffing on a local filebucket in non-windows environments when digest_algorithm is sha256 should properly diff files on the filebucket\r\n\r\n{code}\r\n\r\n\r\nAfter\r\n----\r\n{code:java}\r\nrspec spec/unit/file_bucket/dipper_spec.rb\r\nRun options: exclude {:broken=>true, :benchmark=>true}\r\n......................................\r\n\r\nFinished in 2.24 seconds (files took 3.6 seconds to load)\r\n38 examples, 0 failures\r\n{code}\r\n","closed_at":"2017-08-18T07:13:48.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6756","labels":"maintenance","state":"Closed","updated_at":"2017-08-18T07:13:48.000-0700","timestamp":1652285467.706443,"priority":"Normal","status_category":"Done","pull_request":5306},{"issue_id":"165856","title":"acceptance: no_exception_in_reduce_with_bignum doesn't test anything","url":"https://tickets.puppetlabs.com/browse/PUP-6994","created_at":"2016-12-09T12:24:48.000-0800","number":"PUP-6994","body":"The acceptance test defines a function which relies on a {{merge}} function:\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/9dda0a424b5067cabdfd70f72b286fa7f29f604a/acceptance/tests/parser_functions/no_exception_in_reduce_with_bignum.rb#L51\r\n\r\nThe merge function is defined by stdlib, but isn't in puppet. If you try to run webrick against the {{site.pp}} manifest from the test, you'll get two problems.\r\n\r\nFirst, the quotes in site.pp are not escaped (they're escaped in beaker, but it needs an additional set of escapes).\r\n\r\n{code:puppet}\r\n\"keyname1\"=>{\r\n  \"key\"=>\"ABCDEF\",\r\n  \"options\"=>[\"from=\"10.0.0.0/8\"\"]\r\n},\r\n{code}\r\n\r\nIf you change that to {{\"from=\\\"10.0.0.0/8\\\"\"}} along with the others, and try to run puppet, you get:\r\n\r\n{noformat}\r\nError: Evaluation Error: Unknown function: 'merge'. at /etc/puppetlabs/code/environments/production/manifests/site.pp:40:7 on node wu5mldrtuv6zfap.delivery.puppetlabs.net\r\nError: Evaluation Error: Unknown function: 'merge'. at /etc/puppetlabs/code/environments/production/manifests/site.pp:40:7 on node wu5mldrtuv6zfap.delivery.puppetlabs.net\r\nError: Server Error: Evaluation Error: Unknown function: 'merge'. at /etc/puppetlabs/code/environments/production/manifests/site.pp:40:7 on node wu5mldrtuv6zfap.delivery.puppetlabs.net\r\n/tmp/bundle/ruby/bundler/gems/puppet-9dda0a424b50/lib/puppet/pops/evaluator/runtime3_support.rb:39:in `optionally_fail'\r\n{noformat}\r\n\r\nWhen running in CI against puppetserver packages, the test passes, e.g. https://jenkins.puppetlabs.com/view/puppet-agent/view/stable/view/puppet-agent/job/platform_puppet-agent_intn-van-sys_suite-daily-puppet-stable/248/SLAVE_LABEL=beaker,TEST_TARGET=redhat6-64a/consoleFull\r\n\r\nI think it's \"passing\" because the test sets the directory permissions to 666:\r\n\r\n{code:ruby}\r\non(master, \"chmod -R 666 #{File.join(environmentpath,tmp_environment)}\")\r\n{code}\r\n\r\nSo the environment isn't traversible by puppetserver running as the {{puppet}} user, which causes the test to never try to parse {{site.pp}}.\r\n\r\nInterestingly, puppetserver doesn't complain about that, but puppet webrick does. /cc [~jeremy.barlow]","closed_at":"2017-08-18T07:13:48.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6994","labels":"","state":"Closed","updated_at":"2017-08-18T07:13:48.000-0700","timestamp":1652285468.028798,"priority":"Normal","status_category":"Done","pull_request":6082},{"issue_id":"180947","title":"Parser result no longer contains current method","url":"https://tickets.puppetlabs.com/browse/PUP-7364","created_at":"2017-03-16T09:59:05.000-0700","number":"PUP-7364","body":"The puppet debugger uses the AST model to get a model object in order to import itself into the known resource types.  In order to make this work with puppet 5 I had to refactor my code slightly to account for the missing method.  Not a huge deal but this might break other third party code.\r\n\r\nPreviously I was calling parse_result.current to get the model.  However, with puppet 5 I actually don't need to do that anymore since the model object is the parsed result.\r\n\r\nBut because puppet-debugger supports puppet 3-5 I had to write the following code to work around the issue.  Puppet 5 should add a current method to the parsed_result object that points to itself, thus keeping third party integrations working.\r\n\r\nExample:\r\n\r\n\r\n{code:ruby}\r\n# adds backward compatible call so we don't break third party programs.\r\ndef current\r\n  self\r\nend\r\n{code}\r\n\r\n\r\nPuppet debugger code that was modified\r\n{code:ruby}\r\nparse_result = parser.parse_string(string, '')\r\nmodel = parse_result.respond_to?(:current) ? parse_result.current : parse_result\r\n{code}\r\n\r\n\r\n\r\nBigger Code snippet from puppet-debugger\r\n\r\n{code:ruby}\r\n# @param String - any valid puppet language code\r\n    # @return Hostclass - a puppet Program object which is considered the main class\r\n    def generate_ast(string = nil)\r\n      parse_result = parser.parse_string(string, '')\r\n      # the parse_result may be\r\n      # * empty / nil (no input)\r\n      # * a Model::Program\r\n      # * a Model::Expression\r\n      #\r\n      # should return nil or Puppet::Pops::Model::Program\r\n      # puppet 5 does not have the method current\r\n      model = parse_result.respond_to?(:current) ? parse_result.current : parse_result\r\n      args = {}\r\n      ::Puppet::Pops::Model::AstTransformer.new('').merge_location(args, model)\r\n\r\n      ast_code =\r\n        if model.is_a? ::Puppet::Pops::Model::Program\r\n          ::Puppet::Parser::AST::PopsBridge::Program.new(model, args)\r\n        else\r\n          args[:value] = model\r\n          ::Puppet::Parser::AST::PopsBridge::Expression.new(args)\r\n        end\r\n      # Create the \"main\" class for the content - this content will get merged with all other \"main\" content\r\n      ::Puppet::Parser::AST::Hostclass.new('', code: ast_code)\r\n    end\r\n\r\n    # @param String - any valid puppet language code\r\n    # @return Object - returns either a string of the result or object from puppet evaulation\r\n    def puppet_eval(input)\r\n      # in order to add functions to the scope the loaders must be created\r\n      # in order to call native functions we need to set the global_scope\r\n      ast = generate_ast(input)\r\n      # record the input for puppet to retrieve and reference later\r\n      file = Tempfile.new(['puppet_debugger_input', '.pp'])\r\n      File.open(file, 'w') do |f|\r\n        f.write(input)\r\n      end\r\n      Puppet.override({ code: input, global_scope: scope, loaders: scope.compiler.loaders }, 'For puppet-debugger') do\r\n        # because the repl is not a module we leave the modname blank\r\n        scope.environment.known_resource_types.import_ast(ast, '')\r\n        parser.evaluate_string(scope, input, File.expand_path(file))\r\n      end\r\n    end\r\n{code}\r\n\r\n\r\nhttps://github.com/nwops/puppet-debugger","closed_at":"2017-08-18T07:13:49.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7364","labels":"","state":"Closed","updated_at":"2017-08-18T07:13:49.000-0700","timestamp":1652285468.239052,"priority":"Normal","status_category":"Done","pull_request":6017},{"issue_id":"164748","title":"Tidy and File cannot remove fifo or socket files","url":"https://tickets.puppetlabs.com/browse/PUP-6966","created_at":"2016-12-01T14:35:09.000-0800","number":"PUP-6966","body":"h4. Problem:\r\n\r\n(Reported to Customer Support)\r\n\r\nThe Tidy resource throws an error: \"Error: Could not back up files of type socket.\" when managing /tmp and it encounters a socket file. Tidy then fails to remove anything else after it errors. However, Tidy should not be backing up any files given the backup attribute. \r\n\r\nThat kind of defeats the purpose of using the Tidy resource, doesn't it? I understand about not being able to ensure special file existence (creation), but I would think special file absence should be easy. I was hoping Tidy would be the answer (it sure seems like it should) especially since I'm telling Puppet to not backup anything it's deleting.\r\n\r\nWord.\r\n\r\nh4. Example:\r\n\r\nCreate a test file:\r\n\r\n{code}\r\npython -c \"import socket as s; sock = s.socket(s.AF_UNIX); sock.bind('/tmp/testsocket')\"\r\n{code}\r\n\r\nCreate a test:\r\n\r\n{code}\r\nclass test_tidy_tmp {\r\n  tidy {'/tmp':\r\n    age => '1w',\r\n    size => '1m',\r\n    backup => false,\r\n  }\r\n}\r\n\r\nnode default {\r\n  include test_tidy_tmp\r\n}\r\n{code}\r\n\r\nExecute the test:\r\n\r\n{code}\r\n[root@pe-201642-master ~]# puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for pe-201642-master.puppetdebug.vlan\r\nNotice: /Stage[main]/Test_tidy_tmp/Tidy[/tmp]: Tidying 1 file\r\nInfo: Applying configuration version '1480552981'\r\nError: Could not back up files of type socket\r\nError: /Stage[main]/Test_tidy_tmp/File[/tmp/testsocket]/ensure: change from socket to absent failed: Could not back up files of type socket\r\nNotice: /Stage[main]/Test_tidy_tmp/Tidy[/tmp]: Dependency File[/tmp/testsocket] has failures: true\r\nWarning: /Stage[main]/Test_tidy_tmp/Tidy[/tmp]: Skipping because of failed dependencies\r\nNotice: Applied catalog in 9.99 seconds\r\n{code}\r\n\r\nh4. Solutions:\r\n\r\nHere are two solutions, either solves the problem, I propose implementing both. \r\n\r\nh5. Modify Tidy to ignore/skip files it cannot manage via File resources\r\n\r\n{code}\r\ntom:puppet tom.kishel$ diff /tmp/tidy.rb  lib/puppet/type/tidy.rb\r\n259,263c259\r\n<\r\n<     # Exclude files that cannot be made into a file resource in mkfile.\r\n<     valid_file_resource_files = files.find_all { |f| ['directory', 'file', 'symlink'].include? File.ftype(f) }\r\n<\r\n<     found_files = valid_file_resource_files.find_all { |path| tidy?(path) }.collect { |path| mkfile(path) }\r\n---\r\n>     found_files = files.find_all { |path| tidy?(path) }.collect { |path| mkfile(path) }\r\n{code}\r\n\r\nExecute the solution test for Tidy:\r\n\r\n{code}\r\n[root@pe-201642-master ~]# puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for pe-201642-master.puppetdebug.vlan\r\nNotice: /Stage[main]/Test_tidy_tmp/Tidy[/tmp]: Tidying 0 files\r\nInfo: Applying configuration version '1480555895'\r\nNotice: Applied catalog in 9.99 seconds\r\n{code}\r\n\r\nResult: Success\r\n\r\nh5. Modify File to allow ensure => absent for (fifo and) socket\r\n\r\n{code}\r\ntom:puppet tom.kishel$ diff /tmp/file.rb  lib/puppet/type/file.rb  \r\n717c717\r\n<   # @raises [fail???] If the current file is one of %w{blockSpecial characterSpecial unknown} and can't be removed.\r\n---\r\n>   # @raises [fail???] If the current file isn't one of %w{file link directory} and can't be removed.\r\n737c737\r\n<     when \"link\", \"file\", \"fifo\", \"socket\"\r\n---\r\n>     when \"link\", \"file\"\r\n740,741c740\r\n<       # Potentially: \"blockSpecial\", \"characterSpecial\", \"unknown\"\r\n<       self.fail \"Could not remove file of type #{current_type}\"\r\n---\r\n>       self.fail \"Could not back up files of type #{current_type}\"\r\n938,945c937,939\r\n<     if type == \"directory\" and force?\r\n<       # (#18110) Directories cannot be removed without :force, \r\n<       # so it doesn't make sense to back them up unless using :force.\r\n<       true\r\n<     elsif type == \"file\" or type == \"link\"\r\n<       true\r\n<     else\r\n<       # Potentially: \"blockSpecial\", \"characterSpecial\", \"fifo\", \"socket\", \"unknown\"\r\n---\r\n>     if type == \"directory\" and not force?\r\n>       # (#18110) Directories cannot be removed without :force, so it doesn't\r\n>       # make sense to back them up.\r\n946a941,942\r\n>     else\r\n>       true\r\n{code}\r\n\r\nCreate test files for File via Tidy:\r\n\r\n{code}\r\nmkfifo /tmo/testfifo\r\npython -c \"import socket as s; sock = s.socket(s.AF_UNIX); sock.bind('/tmp/testsocket')\"\r\n{code}\r\n\r\nExecute the solution test for File via Tidy:\r\n\r\n{code}\r\n[root@pe-201642-master tmp]# puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for pe-201642-master.puppetdebug.vlan\r\nNotice: /Stage[main]/Tmp_tidy/Tidy[/tmp]: Tidying 2 files\r\nInfo: Applying configuration version '1480616019'\r\nNotice: /Stage[main]/Tmp_tidy/File[/tmp/testfifo]/ensure: removed\r\nNotice: /Stage[main]/Tmp_tidy/File[/tmp/testsocket]/ensure: removed\r\nNotice: Applied catalog in 9.99 seconds\r\n{code}\r\n\r\nResult: Success\r\n\r\nCreate a test for just File:\r\n\r\n{code}\r\nnode default {\r\n  file {'/tmp/testfifo':\r\n    ensure => absent,\r\n    backup => false,\r\n  }\r\n\r\n  file {'/tmp/testsocket':\r\n    ensure => absent,\r\n    backup => false,\r\n  }\r\n}\r\n{code}\r\n\r\nExecute the solution test for just File:\r\n\r\n{code}\r\n[root@pe-201642-master ~]# puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for pe-201642-master.puppetdebug.vlan\r\nInfo: Applying configuration version '1480555713'\r\nNotice: /Stage[main]/Main/Node[default]/File[/tmp/testfifo]/ensure: removed\r\nNotice: /Stage[main]/Main/Node[default]/File[/tmp/testsocket]/ensure: removed\r\nNotice: Applied catalog in 9.99 seconds\r\n{code}\r\n\r\nResult: Success","closed_at":"2017-08-21T07:17:24.000-0700","comments":16,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6966","labels":"maintenance","state":"Closed","updated_at":"2017-08-21T07:17:24.000-0700","timestamp":1652285468.666596,"priority":"Normal","status_category":"Done","pull_request":5423},{"issue_id":"204703","title":"regexp's with flags and slashes is incorrectly presented using %s and %p","url":"https://tickets.puppetlabs.com/browse/PUP-7825","created_at":"2017-08-09T08:51:23.000-0700","number":"PUP-7825","body":"The puppet {{StringFormatter}} relies on the ruby {{#inspect}} method when a regexp has flags. This is bad because a) the output is not consistent between different ruby versions, and b) the '/' character is incorrectly escaped. This leads to problems in other implementations where '/' isn't used as a regexp delimiter at all.\r\n\r\nThe problem is minor because such regexps cannot be created from Puppet code (puppet doesn't support flags).","closed_at":"2017-09-07T06:55:51.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7825","labels":"","state":"Closed","updated_at":"2017-09-07T06:55:51.000-0700","timestamp":1652285470.252242,"priority":"Critical","status_category":"Done","pull_request":6166},{"issue_id":"202635","title":"Should not fall back to 'server' for requesting file resources when 'server_list' is specified","url":"https://tickets.puppetlabs.com/browse/PUP-7804","created_at":"2017-07-26T11:28:15.000-0700","number":"PUP-7804","body":"In general the server setting should be ignored when server_list is present.\r\n\r\nIn the case of PE HA, both 'server' and 'server_list' are present on a promoted replica, however the 'server' is incorrectly the old master certname rather than the current master (the promoted replica) certname.\r\n\r\nThis is causing an issue on rebooted masters where the automatic puppet agent run on reboot fails, and each file resource request times out individually - currently causing the reboot test in CI to take 30+ minutes for the puppet agent run to complete and fail.","closed_at":"2017-09-07T13:26:19.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7804","labels":"","state":"Closed","updated_at":"2017-09-07T13:26:19.000-0700","timestamp":1652285470.359887,"priority":"Major","status_category":"Done","pull_request":6089},{"issue_id":"200387","title":"tests/loader.autoload_from_resource_type_decl.rb fails when the test crosses into a new day","url":"https://tickets.puppetlabs.com/browse/PUP-7776","created_at":"2017-07-13T11:34:24.000-0700","number":"PUP-7776","body":"If the test is running at just the right time, it can fail because the first check of the puppetserver log is in one days log file, and then if we cross into the next day, a check of the log file fails because the log has rotated into the next day.","closed_at":"2017-09-08T08:08:45.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7776","labels":"","state":"Closed","updated_at":"2017-09-08T08:08:45.000-0700","timestamp":1652285470.472689,"priority":"Normal","status_category":"Done","pull_request":6071},{"issue_id":"208437","title":"AIX 5.3 tests/resource/mount/mounted.rb failure","url":"https://tickets.puppetlabs.com/browse/PUP-7893","created_at":"2017-08-30T11:09:14.000-0700","number":"PUP-7893","body":"Aix 5.3 mount tests are failing.\r\n\r\nWe found the root cause: New 5.3 images are up and they use jfs2, not jfs. Updating the test suite should fix the issue","closed_at":"2017-09-12T08:52:22.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7893","labels":"","state":"Closed","updated_at":"2017-09-12T08:52:22.000-0700","timestamp":1652285470.94271,"priority":"Blocker","status_category":"Done","pull_request":6164},{"issue_id":"205220","title":"undefined method `from' for #<Puppet::Pops::Types::PStructType:0x6d4ca435>","url":"https://tickets.puppetlabs.com/browse/PUP-7835","created_at":"2017-08-11T04:00:31.000-0700","number":"PUP-7835","body":"The problem occurs when including a class that might look like the following:\r\n\r\n{code:puppet}\r\nclass test (\r\n  String $var,\r\n  Test::Options $opts\r\n) {\r\n}\r\n{code}\r\n\r\nLet's assume that Test::Options is defined as:\r\n\r\n{code:puppet}\r\ntype Test::Options = Struct[{\r\n  var => String\r\n}]\r\n{code}\r\n\r\nIf the 'var' parameter doesn't get passed to the test class, an evaluation error would be generated as expected. This works indeed.\r\n\r\nHowever, one would expected to see the same evaluation error popping up if var is not specified in the 'opts' hash, since it is required. Instead, the following error occurs:\r\n\r\n{noformat}\r\nError: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Method call, undefined method `from' for #<Puppet::Pops::Types::PStructType:0x6d4ca435>\r\n{noformat}\r\n\r\nThis problem does not occur when using puppet apply (masterless).","closed_at":"2017-09-14T10:39:44.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7835","labels":"","state":"Closed","updated_at":"2017-09-14T10:39:44.000-0700","timestamp":1652285471.191576,"priority":"Normal","status_category":"Done","pull_request":6119},{"issue_id":"196111","title":"ResourceExpression has incorrect offset when inside of an else block","url":"https://tickets.puppetlabs.com/browse/PUP-7668","created_at":"2017-06-15T08:50:17.000-0700","number":"PUP-7668","body":"The example used to create this failure is below. The service resource has an offset of 34, which is actually the start of the else keyword. It should be 45.\r\n\r\n{code}\r\nclass firewall {\r\n  if(true) {\r\n  } else {\r\n    service { 'service':\r\n      ensure    => running\r\n    }\r\n  }\r\n}\r\n{code}","closed_at":"2017-09-14T10:39:46.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7668","labels":"","state":"Closed","updated_at":"2017-09-14T10:39:46.000-0700","timestamp":1652285471.652859,"priority":"Normal","status_category":"Done","pull_request":5987},{"issue_id":"206857","title":"Module initialization code attempts to use GettextSetup before it has been required","url":"https://tickets.puppetlabs.com/browse/PUP-7857","created_at":"2017-08-22T08:59:12.000-0700","number":"PUP-7857","body":"In the recent refactor of the GettextSetup initialization code, a reference to the GettextSetup gem in the module initialization code was left unguarded, which means that sometimes (e.g. in Puppet Server unit tests), the method is called before GettextSetup has been required. This would also fail if GettextSetup had failed to load. We need to refactor this to behave correctly if GettextSetup is not present.","closed_at":"2017-09-14T10:39:49.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7857","labels":"","state":"Closed","updated_at":"2017-09-14T10:39:49.000-0700","timestamp":1652285472.000581,"priority":"Normal","status_category":"Done","pull_request":6138},{"issue_id":"204698","title":"Regexp for String format specifier is not anchored at the end","url":"https://tickets.puppetlabs.com/browse/PUP-7824","created_at":"2017-08-09T08:08:57.000-0700","number":"PUP-7824","body":"When formatting strings in puppet and providing a format specifier such as \"%s\" or \"%p\", the regexp for validating that specifier is not anchored. Consequently, passing a specifier like \"%strange\" will succeed since the \"%s\" at the beginning fulfills the match.","closed_at":"2017-09-14T10:39:50.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7824","labels":"","state":"Closed","updated_at":"2017-09-14T10:39:50.000-0700","timestamp":1652285472.331611,"priority":"Normal","status_category":"Done","pull_request":6109},{"issue_id":"209447","title":"Puppet PRs failing travis against ruby 1.9.3 with `undefined method spec for nil:NilClass`","url":"https://tickets.puppetlabs.com/browse/PUP-7920","created_at":"2017-09-06T14:44:24.000-0700","number":"PUP-7920","body":"Travis is currently failing for all puppet PRs, regardless of branch, against ruby 1.9.3.\r\n\r\n{code}\r\nNoMethodError: undefined method `spec' for nil:NilClass\r\nAn error occurred while installing puppet (5.1.0), and Bundler cannot continue.\r\nMake sure that `gem install puppet -v '5.1.0'` succeeds before bundling.\r\n{code}\r\n\r\nThe failure looks like the following:\r\n{code}\r\n44.67s$ rvm use 1.9.3 --install --binary --fuzzy\r\nruby-1.9.3-p551 is not installed - installing.\r\nSearching for binary rubies, this might take some time.\r\nFound remote file https://rvm_io.global.ssl.fastly.net/binaries/ubuntu/14.04/x86_64/ruby-1.9.3-p551.tar.bz2\r\nChecking requirements for ubuntu.\r\nRequirements installation successful.\r\nruby-1.9.3-p551 - #configure\r\nruby-1.9.3-p551 - #download\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n100 13.3M  100 13.3M    0     0  45.9M      0 --:--:-- --:--:-- --:--:-- 46.1M\r\nruby-1.9.3-p551 - #validate archive\r\nruby-1.9.3-p551 - #extract\r\nruby-1.9.3-p551 - #validate binary\r\nruby-1.9.3-p551 - #setup\r\nruby-1.9.3-p551 - #gemset created /home/travis/.rvm/gems/ruby-1.9.3-p551@global\r\nUpdating rubygems-update\r\nFetching: rubygems-update-2.6.13.gem (100%)\r\nSuccessfully installed rubygems-update-2.6.13\r\nInstalling RubyGems 2.6.13\r\nRubyGems 2.6.13 installed\r\n=== 2.6.13 / 2017-08-27\r\nSecurity fixes:\r\n* Fix a DNS request hijacking vulnerability.\r\n  Fix by Samuel Giddins.\r\n* Fix an ANSI escape sequence vulnerability.\r\n  Fix by Evan Phoenix.\r\n* Fix a DOS vulernerability in the `query` command.\r\n  Fix by Samuel Giddins.\r\n* Fix a vulnerability in the gem installer that allowed\r\n  a malicious gem to overwrite arbitrary files.\r\n  Fix by Samuel Giddins.\r\n=== 2.6.12 / 2017-04-30\r\nBug fixes:\r\n* Fix test_self_find_files_with_gemfile to sort expected files. Pull\r\n  request #1880 by Kazuaki Matsuo.\r\n* Fix issue for MinGW / MSYS2 builds and testing. Pull request #1879 by\r\n  MSP-Greg.\r\n* Fix gem open to open highest version number rather than lowest. Pull\r\n  request #1877 by Tim Pope.\r\n* Add a test for requiring a default spec as installed by the ruby\r\n  installer. Pull request #1899 by Samuel Giddins.\r\n* Fix broken --exact parameter to gem command. Pull request #1873 by Jason\r\n  Frey.\r\n* [Installer] Generate backwards-compatible binstubs. Pull request #1904\r\n  by Samuel Giddins.\r\n* Fix pre-existing source recognition on add action. Pull request #1883 by\r\n  Jonathan Claudius.\r\n* Prevent negative IDs in output of #inspect. Pull request #1908 by Vít\r\n  Ondruch.\r\n* Allow Gem.finish_resolve to respect already-activated specs. Pull\r\n  request #1910 by Samuel Giddins.\r\n=== 2.6.11 / 2017-03-16\r\nBug fixes:\r\n* Fixed broken tests on ruby-head. Pull request #1841 by\r\n  SHIBATA Hiroshi.\r\n* Update vendored Molinillo to 0.5.7. Pull request #1859 by Samuel\r\n  Giddins.\r\n* Avoid activating Ruby 2.5 default gems when possible. Pull request #1843\r\n  by Samuel Giddins.\r\n* Use improved resolver sorting algorithm. Pull request #1856 by\r\n  Samuel Giddins.\r\n=== 2.6.10 / 2017-01-23\r\nBug fixes:\r\n* Fix `require` calling the wrong `gem` method when it is overridden.\r\n  Pull request #1822 by Samuel Giddins.\r\n=== 2.6.9 / 2017-01-20\r\nBug fixes:\r\n* Allow initializing versions with empty strings. Pull request #1767 by\r\n  Luis Sagastume.\r\n* Fix TypeError on 2.4. Pull request #1788 by Nobuyoshi Nakada.\r\n* Don't output mkmf.log message if compilation didn't fail. Pull request\r\n  #1808 by Jeremy Evans.\r\n* Fixed broken links and overzealous URL encoding in gem server. Pull\r\n  request #1809 by Nicole Orchard.\r\n* Update vendored Molinillo to 0.5.5. Pull request #1812 by Samuel\r\n  Giddins.\r\n* RakeBuilder: avoid frozen string issue. Pull request #1819 by Olle\r\n  Jonsson.\r\n=== 2.6.8 / 2016-10-29\r\nBug fixes:\r\n* Improve SSL verification failure message. Pull request #1751\r\n  by Eric Hodel.\r\n* Ensure `to_spec` falls back on prerelease specs. Pull request\r\n  #1755 by André Arko.\r\n* Update vendored Molinillo to 0.5.3. Pull request #1763 by\r\n  Samuel Giddins.\r\n=== 2.6.7 / 2016-09-26\r\nBug fixes:\r\n* Install native extensions in the correct location when using the\r\n  `--user-install` flag. Pull request #1683 by Noah Kantrowitz.\r\n* When calling `Gem.sources`, load sources from `configuration`\r\n  if present, else use the default sources. Pull request #1699\r\n  by Luis Sagastume.\r\n* Fail gracefully when attempting to redirect without a Location.\r\n  Pull request #1711 by Samuel Giddins.\r\n* Update vendored Molinillo to 0.5.1. Pull request #1714 by\r\n  Samuel Giddins.\r\n=== 2.6.6 / 2016-06-22\r\nBug fixes:\r\n* Sort installed versions to make sure we install the latest version when\r\n  running `gem update --system`. As a one-time fix, run\r\n  `gem update --system=2.6.6`. Pull request #1601 by David Radcliffe.\r\n=== 2.6.5 / 2016-06-21\r\nMinor enhancements:\r\n* Support for unified Integer in Ruby 2.4. Pull request #1618\r\n  by SHIBATA Hiroshi.\r\n* Update vendored Molinillo to 0.5.0 for performance improvements.\r\n  Pull request #1638 by Samuel Giddins.\r\nBug fixes:\r\n* Raise an explicit error if Signer#sign is called with no certs. Pull\r\n  request #1605 by Daniel Berger.\r\n* Update `update_bundled_ca_certificates` utility script for directory\r\n  nesting. Pull request #1583 by James Wen.\r\n* Fix broken symlink support in tar writer (+ fix broken test). Pull\r\n  request #1578 by Cezary Baginski.\r\n* Remove extension directory before (re-)installing. Pull request #1576\r\n  by Jeremy Hinegardner.\r\n* Regenerate test CA certificates with appropriate extensions. Pull\r\n  request #1611 by rhenium.\r\n* Rubygems does not terminate on failed file lock when not superuser. Pull\r\n  request #1582 by Ellen Marie Dash.\r\n* Fix tar headers with a 101 character name. Pull request #1612 by Paweł\r\n  Tomulik.\r\n* Add Gem.platform_defaults to allow implementations to override defaults.\r\n  Pull request #1644 by Charles Oliver Nutter.\r\n* Run Bundler tests on TravisCI. Pull request #1650 by Samuel Giddins.\r\n=== 2.6.4 / 2016-04-26\r\nMinor enhancements:\r\n* Use Gem::Util::NULL_DEVICE instead of hard coded strings. Pull request #1588\r\n  by Chris Charabaruk.\r\n* Use File.symlink on MS Windows if supported. Pull request #1418\r\n  by Nobuyoshi Nakada.\r\nBug fixes:\r\n* Redact uri password from error output when gem fetch fails. Pull request\r\n  #1565 by Brian Fletcher.\r\n* Suppress warnings. Pull request #1594 by Nobuyoshi Nakada.\r\n* Escape user-supplied content served on web pages by `gem server` to avoid\r\n  potential XSS vulnerabilities. Samuel Giddins.\r\n=== 2.6.3 / 2016-04-05\r\nMinor enhancements:\r\n* Lazily calculate Gem::LoadError exception messages. Pull request #1550\r\n  by Aaron Patterson.\r\n* New fastly cert. Pull request #1548 by David Radcliffe.\r\n* Organize and cleanup SSL certs. Pull request #1555 by James Wen.\r\n* [RubyGems] Make deprecation message for paths= more helpful. Pull\r\n  request #1562 by Samuel Giddins.\r\n* Show default gems when using \"gem list\". Pull request #1570 by Luis\r\n  Sagastume.\r\nBug fixes:\r\n* Stub ordering should be consistent regardless of how cache is populated.\r\n  Pull request #1552 by Aaron Patterson.\r\n* Handle cases when the @@stubs variable contains non-stubs. Pull request\r\n  #1558 by Per Lundberg.\r\n* Fix test on Windows for inconsistent temp path. Pull request #1554 by\r\n  Hiroshi Shirosaki.\r\n* Fix `Gem.find_spec_for_exe` picks oldest gem. Pull request #1566 by\r\n  Shinichi Maeshima.\r\n* [Owner] Fallback to email and userid when owner email is missing. Pull\r\n  request #1569 by Samuel Giddins.\r\n* [Installer] Handle nil existing executable. Pull request #1561 by Samuel\r\n  Giddins.\r\n* Allow two digit version numbers in the tests. Pull request #1575 by unak.\r\n=== 2.6.2 / 2016-03-12\r\nBug fixes:\r\n* Fix wrong version of gem activation for bin stub. Pull request #1527 by\r\n  Aaron Patterson.\r\n* Speed up gem activation failures. Pull request #1539 by Aaron Patterson.\r\n* Fix platform sorting in the resolver. Pull request #1542 by Samuel E.\r\n  Giddins.\r\n* Ensure we unlock the monitor even if try_activate throws. Pull request\r\n  #1538 by Charles Oliver Nutter.\r\n=== 2.6.1 / 2016-02-28\r\nBug fixes:\r\n* Ensure `default_path` and `home` are set for paths. Pull request #1513\r\n  by Aaron Patterson.\r\n* Restore but deprecate support for Array values on `Gem.paths=`. Pull\r\n  request #1514 by Aaron Patterson.\r\n* Fix invalid gem file preventing gem install from working. Pull request\r\n  #1499 by Luis Sagastume.\r\n=== 2.6.0 / 2016-02-26\r\nMinor enhancements:\r\n* RubyGems now defaults the `gem push` to the gem's \"allowed_push_host\"\r\n  metadata setting.  Pull request #1486 by Josh Lane.\r\n* Update bundled Molinillo to 0.4.3. Pull request #1493 by Samuel E. Giddins.\r\n* Add version option to gem open command. Pull request #1483 by Hrvoje\r\n  Šimić.\r\n* Feature/add silent flag. Pull request #1455 by Luis Sagastume.\r\n* Allow specifying gem requirements via env variables. Pull request #1472\r\n  by Samuel E. Giddins.\r\nBug fixes:\r\n* RubyGems now stores `gem push` credentials under the host you signed-in for.\r\n  Pull request #1485 by Josh Lane.\r\n* Move `coding` location to first line. Pull request #1471 by SHIBATA\r\n  Hiroshi.\r\n* [PathSupport] Handle a regexp path separator. Pull request #1469 by\r\n  Samuel E. Giddins.\r\n* Clean up the PathSupport object. Pull request #1094 by Aaron Patterson.\r\n* Join with File::PATH_SEPARATOR in Gem.use_paths. Pull request #1476 by\r\n  Samuel E. Giddins.\r\n* Handle when the gem home and gem path arent set in the config file. Pull\r\n  request #1478 by Samuel E. Giddins.\r\n* Terminate TimeoutHandler. Pull request #1479 by Nobuyoshi Nakada.\r\n* Remove redundant cache. Pull request #1482 by Eileen M. Uchitelle.\r\n* Freeze `Gem::Version@segments` instance variable. Pull request #1487 by\r\n  Ben Dean.\r\n* Gem cleanup is trying to uninstall gems outside GEM_HOME and reporting\r\n  an error after it tries. Pull request #1353 by Luis Sagastume.\r\n* Avoid duplicated sources. Pull request #1489 by Luis Sagastume.\r\n* Better description for quiet flag. Pull request #1491 by Luis Sagastume.\r\n* Raise error if find_by_name returns with nil. Pull request #1494 by\r\n  Zoltán Hegedüs.\r\n* Find_files only from loaded_gems when using gemdeps. Pull request #1277\r\n  by Michal Papis.\r\n=== 2.5.2 / 2016-01-31\r\nBug fixes:\r\n* Fix memoization of Gem::Version#prerelease? Pull request #1125 by Matijs van\r\n  Zuijlen.\r\n* Handle trailing colons in GEM_PATH, by Damien Robert.\r\n* Improve the Gemfile `gemspec` method, fixing #1204 and #1033. Pull request\r\n  #1276 by Michael Papis.\r\n* Warn only once when a gemspec license is invalid. Pull request #1414 by Samuel\r\n  E. Giddins.\r\n* Check for exact constants before using them, fixing Ruby bug #11940. Pull\r\n  request #1438 by Nobuyoshi Nakada.\r\n* Fix building C extensions on Ruby 1.9.x on Windows. Pull request #1453 by Marie\r\n  Markwell.\r\n* Handle symlinks containing \"..\" correctly. Pull request #1457 by Samuel E.\r\n  Giddins.\r\nMinor enhancements:\r\n* Add `--no-rc` flag, which skips loading `.gemrc`. Pull request #1329 by Luis\r\n  Sagastume.\r\n* Allow basic auth to be excluded from `allowed_push_host`. By Josh Lane.\r\n* Add `gem list --exact`, which finds gems by string match instead of regex. Pull\r\n  request #1344 by Luis Sagastume.\r\n* Suggest alternatives when gem license is unknown. Pull request #1443 by Samuel\r\n  E. Giddins.\r\n* Print a useful error if a binstub expects a newer version of a gem than is\r\n  installed. Pull request #1407 by Samuel E. Giddins.\r\n* Allow the (supported) s3:// scheme to be used with `--source`. Pull request\r\n  #1416 by Dave Adams.\r\n* Add `--[no-]post-install-message` to `install` and `update`. Pull request #1162\r\n  by Josef Šimánek.\r\n* Add `--host` option to `yank`, providing symmetry with `pull`. Pull request\r\n  #1361 by Mike Virata-Stone.\r\n* Update bundled Molinillo to 0.4.1. Pull request #1452 by Samuel E. Giddins.\r\n* Allow calling `build` without '.gemspec'. Pull request #1454 by Stephen\r\n  Blackstone.\r\n* Add support for `source` option on gems in Gemfile. Pull request #1355 by\r\n  Michael Papis.\r\n* Function correctly when string literals are frozen on Ruby 2.3. Pull request\r\n  #1408 by Samuel E. Giddins.\r\n=== 2.5.1 / 2015-12-10\r\nBug fixes:\r\n* Ensure platform sorting only uses strings. Affected binary installs on Windows.\r\n  Issue #1369 reported by Ryan Atball (among others).\r\n  Pull request #1375 by Samuel E. Giddins.\r\n* Revert PR #1332. Unable to reproduce, and nil should be impossible.\r\n* Gem::Specification#to_fullpath now returns .rb extensions when such a file\r\n  exists.  Pull request #1114 by y-yagi.\r\n* RubyGems now handles Net::HTTPFatalError instead of crashing.  Pull\r\n  request #1314 by Samuel E. Giddins.\r\n* Updated bundled Molinillo to 0.4.0.  Pull request #1322, #1396 by Samuel E.\r\n  Giddins.\r\n* Improved performance of spec loading by reducing likelihood of loading the\r\n  complete specification.  Pull request #1373 by Aaron Patterson.\r\n* Improved caching of requirable files  Pull request #1377 by Aaron Patterson.\r\n* Fixed activation of gems with development dependencies.  Pull request #1388\r\n  by Samuel E. Giddins.\r\n* RubyGems now uses the same Molinillo vendoring strategy as Bundler.  Pull\r\n  request #1397 by Samuel E. Giddins.\r\n* Fixed documentation of Gem::Requirement.parse.  Pull request #1398 by\r\n  Juanito Fatas.\r\n* RubyGems no longer warns when a prerelease gem has prerelease dependencies.\r\n  Pull request #1399 by Samuel E. Giddins.\r\n* Fixed Gem::Version documentation example.  Pull request #1401 by Guilherme\r\n  Goettems Schneider.\r\n* Updated documentation links to https://.  Pull request #1404 by Suriyaa\r\n  Kudo.\r\n* Fixed double word typo.  Pull request #1411 by Jake Worth.\r\n=== 2.5.0 / 2015-11-03\r\nMajor enhancements:\r\n* Added the Gem::Licenses class which provides a set of standard license\r\n  identifiers as set by spdx.org. This is now used by the\r\n  Gem::Specification#license attribute to try to standardize (though not\r\n  enforce) licenses set by gem authors.\r\n  Pull request #1249 by Kyle Mitchell.\r\nMinor enhancements:\r\n* Use Molinillo as the resolver library.  This is the same resolver as used by\r\n  Bundler.  Pull request #1189 by Samuel E. Giddins.\r\n* Add `--skip=gem_name` to Pristine command.  Pull request #1018 by windwiny.\r\n* The parsed gem dependencies file is now available via Gem.gemdeps following\r\n  Gem.use_gemdeps.  Pull request #1224 by Hsing-Hui Hsu, issue #1213 by\r\n  Michal Papis.\r\n* Moved description attribute to recommended for Gem::Specification.\r\n  Pull request #1046 by Michal Papis\r\n* Moved `Gem::Indexer#abbreviate` and `#sanitize` to `Gem::Specification`.\r\n  Pull request #1145 by Arthur Nogueira Neves\r\n* Cache Gem::Version segments for `#bump` and `#release`.\r\n  Pull request #1131 by Matijs van Zuijlen\r\n* Fix edge case in `levenshtein_distance` for comparing longer strings.\r\n  Pull request #1173 by Richard Schneeman\r\n* Remove duplication from List#to_a, improving from O(n^2) to O(n) time.\r\n  Pull request #1200 by Marc Siegel.\r\n* Gem::Specification.add_specs is deprecated and will be removed from version\r\n  3.0 with no replacement.  To add specs, install the gem, then reset the\r\n  cache.\r\n* Gem::Specification.add_spec is deprecated and will be removed from version\r\n  3.0 with no replacement.  To add specs, install the gem, then reset the\r\n  cache.\r\n* Gem::Specification.remove_spec is deprecated and will be removed from version\r\n  3.0 with no replacement.  To remove specs, uninstall the gem, then reset the\r\n  cache by calling Gem::Specification.reset.\r\n* Call Array#compact before calling Array#uniq for minor speed improvement in\r\n  the Gem::Specification#files method.\r\n  Pull request #1253 by Marat Amerov.\r\n* Use stringio instead of custom String classes.\r\n  Pull request #1250 by Petr Skocik.\r\n* Use URI#host instead of URI#hostname to retain backwards compatibility with\r\n  Ruby 1.9.2 and earlier in util library.\r\n  Pull request #1288 by Joe Rafaniello.\r\n* Documentation update for gem sources.\r\n  Pull request #1324 by Ilya Vassilevsky.\r\n* Documentation update for required_ruby_version.\r\n  Pull request #1321 by Matt Patterson.\r\n* Documentation update for gem update.\r\n  Pull request #1306 by Tim Blair.\r\n* Emit a warning on SRV resolve failure.\r\n  Pull request #1023 by Ivan Kuchin.\r\n* Allow duplicate dependencies between runtime and development.\r\n  Pull request #1032 by Murray Steele.\r\n* The gem env command now shows the user installation directory.\r\n  Pull request #1343 by Luis Sagastume.\r\n* The Gem::Platform#=== method now treats a nil cpu arch the same as 'universal'.\r\n  Pull request #1356 by Daniel Berger.\r\n* Improved memory performance in Gem::Specification.traverse.  Pull request\r\n  #1188 by Aaron Patterson.\r\n* RubyGems packages now support symlinks.  Pull request #1209 by Samuel E.\r\n  Giddins.\r\n* RubyGems no longer outputs mkmf.log if it does not exist.  Pull request\r\n  #1222 by Andrew Hooker.\r\n* Added Bitrig platform.  Pull request #1233 by John C. Vernaleo.\r\n* Improved error message for first-time RubyGems developers.  Pull request\r\n  #1241 by André Arko\r\n* Improved performance of Gem::Specification#load with cached specs.  Pull\r\n  request #1297 by Samuel E. Giddins.\r\n* Gem::RemoteFetcher allows users to set HTTP headers.  Pull request #1363 by\r\n  Agis Anastasopoulos.\r\nBug fixes:\r\n* Fixed Rake homepage url in example for Gem::Specification#homepage.\r\n  Pull request #1171 by Arthur Nogueira Neves\r\n* Don't crash if partially uninstalled gem can't be found.\r\n  Pull request #1283 by Cezary Baginski.\r\n* Test warning cleanup.\r\n  Pull request #1298 by Samuel E. Giddins.\r\n* Documentation fix for GemDependencyAPI.\r\n  Pull request #1308 by Michael Papis.\r\n* Fetcher now ignores ENOLCK errors in single threaded environments. This\r\n  handles an issue with gem installation on NFS as best we can. Addresses\r\n  issue #1176 by Ryan Moore.\r\n  Pull request #1327 by Daniel Berger.\r\n* Fix some path quoting issues in the test suite.\r\n  Pull request #1328 by Gavin Miller.\r\n* Fix NoMethodError in running ruby processes when gems are uninstalled.\r\n  Pull request #1332 by Peter Drake.\r\n* Fixed a potential NoMethodError for gem cleanup.\r\n  Pull request #1333 by Peter Drake.\r\n* Fixed gem help bug.\r\n  Issue #1352 reported by bogem, pull request #1357 by Luis Sagastume.\r\n* Remove temporary directories after tests finish.  Pull request #1181 by\r\n  Nobuyoshi Nokada.\r\n* Update links in RubyGems documentation.  Pull request #1185 by Darío Hereñú.\r\n* Prerelease gem executables can now be run.  Pull request #1186 by Samuel E.\r\n  Giddins.\r\n* Updated RubyGems travis-ci ruby versions.  Pull request #1187 by Samuel E.\r\n  Giddins.\r\n* Fixed release date of RubyGems 2.4.6.  Pull request #1190 by Frieder\r\n  Bluemle.\r\n* Fixed bugs in gem activation.  Pull request #1202 by Miklós Fazekas.\r\n* Fixed documentation for `gem list`.  Pull request #1228 by Godfrey Chan.\r\n* Fixed #1200 history entry.  Pull request #1234 by Marc Siegel.\r\n* Fixed synchronization issue when resetting the Gem::Specification gem list.\r\n  Pull request #1239 by Samuel E. Giddins.\r\n* Fixed running tests in parallel.  Pull request #1257 by SHIBATA Hiroshi.\r\n* Fixed running tests with `--program-prefix` or `--program-suffix` for ruby.\r\n  Pull request #1258 by Shane Gibbs.\r\n* Fixed Gem::Specification#to_yaml.  Pull request #1262 by Hiroaki Izu.\r\n* Fixed taintedness of Gem::Specification#raw_require_paths.  Pull request\r\n  #1268 by Sam Ruby.\r\n* Fixed sorting of platforms when installing gems.  Pull request #1271 by\r\n  nonsequitur.\r\n* Use `--no-document` over deprecated documentation options when installing\r\n  dependencies on travis.  Pull request #1272 by takiy33.\r\n* Improved support for IPv6 addresses in URIs.  Pull request #1275 by Joe\r\n  Rafaniello.\r\n* Spec validation no longer crashes if a file does not exist.  Pull request\r\n  #1278 by Samuel E. Giddins.\r\n* Gems can now be installed within `rescue`.  Pull request #1282 by Samuel E.\r\n  Giddins.\r\n* Increased Diffie-Hellman key size for tests for modern OpenSSL.  Pull\r\n  request #1290 by Vít Ondruch.\r\n* RubyGems handles invalid config files better.  Pull request #1367 by Agis\r\n  Anastasopoulos.\r\n=== 2.4.8 / 2015-06-08\r\nBug fixes:\r\n* Tightened API endpoint checks for CVE-2015-3900\r\n=== 2.4.7 / 2015-05-14\r\nBug fixes:\r\n* Limit API endpoint to original security domain for CVE-2015-3900.\r\n  Fix by claudijd\r\n=== 2.4.6 / 2015-02-05\r\nBug fixes:\r\n* Fixed resolving gems with both upper and lower requirement boundaries.\r\n  Issue #1141 by Jakub Jirutka.\r\n* Moved extension directory after require_paths to fix missing constant bugs\r\n  in some gems with C extensions.  Issue #784 by André Arko, pull request\r\n  #1137 by Barry Allard.\r\n* Use Gem::Dependency#requirement when adding a dependency to an existing\r\n  dependency instance.  Pull request #1101 by Josh Cheek.\r\n* Fixed warning of shadowed local variable in Gem::Specification.  Pull request\r\n  #1109 by Rohit Arondekar\r\n* Gem::Requirement should always sort requirements before coercion to Hash.\r\n  Pull request #1139 by Eito Katagiri.\r\n* The `gem open` command should change the current working directory before\r\n  opening the editor.  Pull request #1142 by Alex Wood.\r\n* Ensure quotes are stripped from the Windows launcher script used to install\r\n  gems.  Pull request #1115 by Youngjun Song.\r\n* Fixed errors when writing to NFS to to 0444 files.  Issue #1161 by Emmanuel\r\n  Hadoux.\r\n* Removed dead code in Gem::StreamUI.  Pull request #1117 by mediaslave24.\r\n* Fixed typos.  Pull request #1096 by hakeda.\r\n* Relaxed CMake dependency for RHEL 6 and CentOS 6.  Pull request #1124 by Vít\r\n  Ondruch.\r\n* Relaxed Psych dependency.  Pull request #1128 by Vít Ondruch.\r\n=== 2.4.5 / 2014-12-03\r\nBug fixes:\r\n* Improved speed of requiring gems.  (Around 25% for a 60 gem test).  Pull\r\n  request #1060 by unak.\r\n* RubyGems no longer attempts to look up gems remotely with the --local flag.\r\n  Pull request #1084 by Jeremy Evans.\r\n* Executable stubs use the correct gem version when RUBYGEMS_GEMDEPS is\r\n  active.  Issue #1072 by Michael Kaiser-Nyman.\r\n* Fixed handling of pinned gems in lockfiles with versions.  Issue #1078 by\r\n  Ian Ker-Seymer.\r\n* Fixed handling of git@example:gem.git URIs.  Issue #1054 by Mogutan Mogu.\r\n* Fixed handling of platforms retrieved from the dependencies API.  Issue\r\n  #1058 and patch suggestion by tux-mind.\r\n* RubyGems now suggests a copy-pasteable `gem pristine` command when\r\n  extensions are missing.  Pull request #1057 by Shannon Skipper.\r\n* Improved errors for long file names when packaging.  Pull request #1016 by\r\n  Piotrek Bator.\r\n* `gem pristine` now skips gems cannot be found remotely.  Pull request #1064\r\n  by Tuomas Kareinen.\r\n* `gem pristine` now caches gems to the proper directory.  Pull request #1064\r\n  by Tuomas Kareinen.\r\n* `gem pristine` now skips bundled gems properly.  Pull request #1064 by\r\n  Tuomas Kareinen.\r\n* Improved interoperability of Vagrant with RubyGems.  Pull request #1057 by\r\n  Vít Ondruch.\r\n* Renamed CONTRIBUTING to CONTRIBUTING.rdoc to allow markup.  Pull request\r\n  #1090 by Roberto Miranda.\r\n* Switched from #partition to #reject as only one collection is used.  Pull\r\n  request #1074 by Tuomas Kareinen.\r\n* Fixed installation of gems on systems using memory-mapped files.  Pull\r\n  request #1038 by Justin Li.\r\n* Fixed bug in Gem::Text#min3 where `a == b < c`.  Pull request #1026 by\r\n  fortissimo1997.\r\n* Fixed uninitialized variable warning in BasicSpecification.  Pull request\r\n  #1019 by Piotr Szotkowski.\r\n* Removed unneeded exception handling for cyclic dependencies.  Pull request\r\n  #1043 by Jens Wille.\r\n* Fixed grouped expression warning.  Pull request #1081 by André Arko.\r\n* Fixed handling of platforms when writing lockfiles.\r\n=== 2.4.4 / 2014-11-12\r\nBug fixes:\r\n* Add alternate Root CA for upcoming certificate change. Fixes #1050 by\r\n  Protosac\r\n=== 2.4.3 / 2014-11-10\r\nBug fixes:\r\n* Fix redefine MirrorCommand issue. Pull request #1044 by @akr.\r\n* Fix typo in platform= docs.  Pull request #1048 by @jasonrclark\r\n* Add root SSL certificates for upcoming certificate change.  Fixes #1050 by\r\n  Protosac\r\n------------------------------------------------------------------------------\r\nRubyGems installed the following executables:\r\n\t/home/travis/.rvm/rubies/ruby-1.9.3-p551/bin/gem\r\nRubyGems system software updated\r\nruby-1.9.3-p551 - #importing gemset /home/travis/.rvm/gemsets/global.gems.....................................\r\nruby-1.9.3-p551 - #generating global wrappers........\r\nLatest version currently installed. Aborting.\r\nruby-1.9.3-p551 - #uninstalling gem rubygems-bundler-1.4.4.\r\nruby-1.9.3-p551 - #gemset created /home/travis/.rvm/gems/ruby-1.9.3-p551\r\nLatest version currently installed. Aborting.\r\nruby-1.9.3-p551 - #importing gemset /home/travis/.rvm/gemsets/default.gems...............\r\nruby-1.9.3-p551 - #generating default wrappers........\r\nUsing /home/travis/.rvm/gems/ruby-1.9.3-p551\r\nLatest version currently installed. Aborting.\r\n$ export BUNDLE_GEMFILE=$PWD/Gemfile\r\n$ ruby --version\r\nruby 1.9.3p551 (2014-11-13 revision 48407) [x86_64-linux]\r\n$ rvm --version\r\nrvm 1.29.2 (latest) by Michal Papis, Piotr Kuczynski, Wayne E. Seguin [https://rvm.io/]\r\n$ bundle --version\r\nBundler version 1.7.6\r\n$ gem --version\r\n2.6.13\r\n28.27s$ bundle install --without development extra\r\nFetching gem metadata from https://rubygems.org/............\r\nResolving dependencies...\r\nInstalling rake 10.1.1\r\nInstalling CFPropertyList 2.3.5\r\nInstalling addressable 2.4.0\r\nInstalling ast 2.3.0\r\nInstalling builder 3.2.3\r\nInstalling safe_yaml 1.0.4\r\nInstalling crack 0.4.3\r\nInstalling diff-lcs 1.3\r\nInstalling facter 2.5.1\r\nInstalling fast_gettext 1.1.0\r\nInstalling locale 2.1.2\r\nInstalling text 1.3.1\r\nInstalling gettext 3.2.4\r\nInstalling gettext-setup 0.28\r\nInstalling hashdiff 0.3.6\r\nInstalling hiera 3.4.0\r\nInstalling highline 1.6.21\r\nInstalling trollop 2.1.2\r\nInstalling hiera-eyaml 2.1.0\r\nInstalling hocon 1.2.5\r\nInstalling json-schema 2.1.1\r\nInstalling metaclass 0.0.4\r\nInstalling mocha 0.10.5\r\nInstalling multi_json 1.7.7\r\nInstalling parser 2.4.0.0\r\nInstalling powerpack 0.1.1\r\nNoMethodError: undefined method `spec' for nil:NilClass\r\nAn error occurred while installing puppet (5.1.0), and Bundler cannot continue.\r\nMake sure that `gem install puppet -v '5.1.0'` succeeds before bundling.\r\n{code}\r\n\r\nA previous successful run looked like this:\r\n{code}\r\n$ rvm use 1.9.3 --install --binary --fuzzy\r\nruby-1.9.3-p551 is not installed - installing.\r\nSearching for binary rubies, this might take some time.\r\nFound remote file https://rvm_io.global.ssl.fastly.net/binaries/ubuntu/14.04/x86_64/ruby-1.9.3-p551.tar.bz2\r\nChecking requirements for ubuntu.\r\nRequirements installation successful.\r\nruby-1.9.3-p551 - #configure\r\nruby-1.9.3-p551 - #download\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n100 13.3M  100 13.3M    0     0  74.1M      0 --:--:-- --:--:-- --:--:-- 74.5M\r\nruby-1.9.3-p551 - #validate archive\r\nruby-1.9.3-p551 - #extract\r\nruby-1.9.3-p551 - #validate binary\r\nruby-1.9.3-p551 - #setup\r\nruby-1.9.3-p551 - #gemset created /home/travis/.rvm/gems/ruby-1.9.3-p551@global\r\nruby-1.9.3-p551 - #importing gemset /home/travis/.rvm/gemsets/global.gems.....................................\r\nruby-1.9.3-p551 - #generating global wrappers........\r\nruby-1.9.3-p551 - #uninstalling gem rubygems-bundler-1.4.4.\r\nruby-1.9.3-p551 - #gemset created /home/travis/.rvm/gems/ruby-1.9.3-p551\r\nruby-1.9.3-p551 - #importing gemset /home/travis/.rvm/gemsets/default.gems...............\r\nruby-1.9.3-p551 - #generating default wrappers........\r\nUsing /home/travis/.rvm/gems/ruby-1.9.3-p551\r\n$ export BUNDLE_GEMFILE=$PWD/Gemfile\r\n$ ruby --version\r\nruby 1.9.3p551 (2014-11-13 revision 48407) [x86_64-linux]\r\n$ rvm --version\r\nrvm 1.29.2 (latest) by Michal Papis, Piotr Kuczynski, Wayne E. Seguin [https://rvm.io/]\r\n$ bundle --version\r\nBundler version 1.7.6\r\n$ gem --version\r\n2.4.3\r\ninstall.bundler\r\n18.57s$ bundle install --without development extra\r\nFetching gem metadata from https://rubygems.org/............\r\nResolving dependencies...\r\nInstalling rake 10.1.1\r\nInstalling CFPropertyList 2.3.5\r\nInstalling addressable 2.4.0\r\nInstalling ast 2.3.0\r\nInstalling builder 3.2.3\r\nInstalling safe_yaml 1.0.4\r\nInstalling crack 0.4.3\r\nInstalling diff-lcs 1.3\r\nInstalling facter 2.5.0\r\nInstalling fast_gettext 1.1.0\r\nInstalling locale 2.1.2\r\nInstalling text 1.3.1\r\nInstalling gettext 3.2.4\r\nInstalling gettext-setup 0.26\r\nInstalling hashdiff 0.3.5\r\nInstalling hiera 3.4.0\r\nInstalling highline 1.6.21\r\nInstalling trollop 2.1.2\r\nInstalling hiera-eyaml 2.1.0\r\nInstalling hocon 1.2.5\r\nInstalling json-schema 2.1.1\r\nInstalling metaclass 0.0.4\r\nInstalling mocha 0.10.5\r\nInstalling multi_json 1.7.7\r\nInstalling parser 2.4.0.0\r\nInstalling powerpack 0.1.1\r\nUsing puppet 5.0.1 from source at /home/travis/build/puppetlabs/puppet\r\nInstalling rainbow 2.1.0\r\nInstalling rdoc 4.3.0\r\nInstalling rspec-support 3.6.0\r\nInstalling rspec-core 3.6.0\r\nInstalling rspec-expectations 3.6.0\r\nInstalling rspec-mocks 3.6.0\r\nInstalling rspec 3.6.0\r\nInstalling rspec-collection_matchers 1.1.3\r\nInstalling rspec-its 1.2.0\r\nInstalling rspec-legacy_formatters 1.0.1\r\nInstalling ruby-progressbar 1.8.1\r\nInstalling unicode-display_width 1.3.0\r\nInstalling rubocop 0.39.0\r\nInstalling vcr 2.9.3\r\nInstalling webmock 1.24.6\r\nInstalling yard 0.9.9\r\nInstalling yarjuf 2.0.0\r\nUsing bundler 1.7.6\r\nYour bundle is complete!\r\n{code}","closed_at":"2017-09-14T10:39:51.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7920","labels":"","state":"Closed","updated_at":"2017-09-14T10:39:51.000-0700","timestamp":1652285472.549787,"priority":"Blocker","status_category":"Done","pull_request":6183},{"issue_id":"206953","title":"`puppet help` output contains untranslated subcommand summaries","url":"https://tickets.puppetlabs.com/browse/PUP-7858","created_at":"2017-08-22T14:13:09.000-0700","number":"PUP-7858","body":"Currently only some of the subcommands listed when running `puppet help` are translated. This is because only Puppet Faces pulled these summaries into standalone strings. Applications extract the summary from a large heredoc that provides the full help text for the subcommand. The full subcommand text should not be translated, but the summary messages should be, since `puppet help` is such a visible entry point for the software. We need to isolate the summary strings from the full subcommand help text.","closed_at":"2017-09-14T10:39:51.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7858","labels":"","state":"Closed","updated_at":"2017-09-14T10:39:51.000-0700","timestamp":1652285472.658987,"priority":"Normal","status_category":"Done","pull_request":6140},{"issue_id":"134149","title":"On AIX, an already installed package is not updated when using \"ensure => latest\"","url":"https://tickets.puppetlabs.com/browse/PUP-6364","created_at":"2016-05-26T16:04:27.000-0700","number":"PUP-6364","body":"{quote}\r\nOn AIX (reported on 7.1 TL3 SP5), when using \"ensure => latest\" on a package, puppet does not install the latest version available if the package (in this case, an older version) is already installed. If specifying a version number (i.e. 6.0.0.5), the package is updated to this version.\r\n\r\nBelow is a sample output of the command puppet uses to produce a list of packages and their version numbers:\r\n\r\n{code}\r\n#/usr/sbin/installp -L -d .\r\nEMC:EMC.CELERRA.aix.rte:6.0.0.5::I:C:::::b:EMC CELERRA AIX Support Software::::0::\r\nEMC:EMC.CELERRA.iscsi.rte:6.0.0.5::I:C:::::b:EMC CELERRA iSCSI Support Software::::0::\r\nEMC:EMC.CLARiiON.aix.rte:6.0.0.5::I:C:::::b:EMC CLARiiON AIX Support Software::::0::\r\nEMC:EMC.CLARiiON.fcp.MPIO.rte:6.0.0.5::I:C:::::b:EMC CLARiiON FCP MPIO Support Software::::0::\r\nEMC:EMC.CLARiiON.fcp.rte:6.0.0.5::I:T:::::b:EMC CLARiiON FCP Support Software::::0::\r\nEMC:EMC.CLARiiON.iscsi.rte:6.0.0.5::I:C:::::b:EMC CLARiiON iSCSI Support Software::::0::\r\nEMC:EMC.INVISTA.aix.rte:6.0.0.5::I:C:::::b:EMC INVISTA AIX Support Software::::0::\r\nEMC:EMC.INVISTA.fcp.MPIO.rte:6.0.0.5::I:C:::::b:EMC INVISTA FCP MPIO Support Software::::0::\r\nEMC:EMC.INVISTA.fcp.rte:6.0.0.5::I:T:::::b:EMC INVISTA FCP Support Software::::0::\r\nEMC:EMC.Symmetrix.aix.rte:6.0.0.5::I:C:::::b:EMC Symmetrix AIX Support Software::::0::\r\nEMC:EMC.Symmetrix.fcp.MPIO.rte:6.0.0.5::I:T:::::b:EMC Symmetrix FCP MPIO Support Software::::0::\r\nEMC:EMC.Symmetrix.fcp.rte:6.0.0.5::I:T:::::b:EMC Symmetrix FCP Support Software::::0::\r\nEMC:EMC.Symmetrix.iscsi.rte:6.0.0.5::I:T:::::b:EMC Symmetrix iSCSI Support Software::::0::\r\nEMC:EMC.XtremIO.aix.rte:6.0.0.5::I:T:::::b:EMC XtremIO AIX Support Software::::0::\r\nEMC:EMC.XtremIO.fcp.MPIO.rte:6.0.0.5::I:T:::::b:EMC XtremIO FCP MPIO Support Software::::0::\r\nEMC:EMC.XtremIO.fcp.rte:6.0.0.5::I:T:::::b:EMC XtremIO FCP Support Software::::0::\r\n{code}\r\n\r\nSo the version available to install is 6.0.0.5, version 6.0.0.3 is currently installed, but the newer version is not installed when using ensure => latest. When specifying 6.0.0.5 as the version, the package is updated.\r\n\r\n{quote}","closed_at":"2017-09-14T10:39:53.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6364","labels":"aix-parity;client-onboarding;manage-package","state":"Closed","updated_at":"2017-09-14T10:39:53.000-0700","timestamp":1652285472.766347,"priority":"Major","status_category":"Done","pull_request":6150},{"issue_id":"204514","title":"error string needs update for I18N support","url":"https://tickets.puppetlabs.com/browse/PUP-7820","created_at":"2017-08-08T08:52:23.000-0700","number":"PUP-7820","body":"While doing I18N testing I noticed this error message in the puppet.po file which should be updated for I18N\r\n\r\n#: ../lib/puppet/pops/issues.rb:755\r\nmsgid \"\\\"#{label.a_an_uc(semantic)} resulted in a value outside of Puppet Integer #{range_end} range, got '#{\\\"%#+x\\\" % value}'\\\"\"\r\nmsgstr \"\"\r\n\"\\\"#{ŀȧƀḗŀ.ȧ_ȧƞ_ŭƈ(şḗḿȧƞŧīƈ)} řḗşŭŀŧḗḓ īƞ ȧ ṽȧŀŭḗ ǿŭŧşīḓḗ ǿƒ Ƥŭƥƥḗŧ Īƞŧḗɠḗř \"\r\n\"#{řȧƞɠḗ_ḗƞḓ} řȧƞɠḗ, ɠǿŧ '#{\\\"%#+ẋ\\\" % ṽȧŀŭḗ}'\\\"\"\r\n\r\nAnd another\r\n\r\n#: ../lib/puppet/pops/issues.rb:444\r\nmsgid \"\\\"#{label.article(actual_type)} #{actual_type}\\\"\"\r\nmsgstr \"\"\r\n\r\nAnd another\r\n\r\n\"The string '#{before}' was automatically coerced to the numerical value #{after}\"","closed_at":"2017-09-14T10:39:54.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7820","labels":"","state":"Closed","updated_at":"2017-09-14T10:39:54.000-0700","timestamp":1652285473.086641,"priority":"Normal","status_category":"Done","pull_request":6108},{"issue_id":"207528","title":"Enum accepts arguments that are not strings","url":"https://tickets.puppetlabs.com/browse/PUP-7885","created_at":"2017-08-25T10:44:33.000-0700","number":"PUP-7885","body":"\"Enum[foo, 1]\" parses in ruby but not in java\r\ncom.puppet.pcore.TypeResolverException: Invalid parameter type specified: 'Enum' requires parameter 1 to be a 'String', Long provided\r\n\r\nI don't how important this is.","closed_at":"2017-09-14T10:39:55.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7885","labels":"","state":"Closed","updated_at":"2017-09-14T10:39:55.000-0700","timestamp":1652285473.194586,"priority":"Normal","status_category":"Done","pull_request":6160},{"issue_id":"206763","title":"Rich data is used for serializing symbols even when rich_data is not enabled.","url":"https://tickets.puppetlabs.com/browse/PUP-7855","created_at":"2017-08-22T02:43:34.000-0700","number":"PUP-7855","body":"When serializing the {{default}} value using the {{ToDataConverter}}/{{FromDataConverter}} pair, the value is serialized as:\r\n{code:json}\r\n{\"key\":{\"__pcore_type__\":\"Default\"}}\r\n{code}\r\neven when {{rich_data}} is not enabled.","closed_at":"2017-09-14T10:39:58.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7855","labels":"","state":"Closed","updated_at":"2017-09-14T10:39:58.000-0700","timestamp":1652285473.408903,"priority":"Normal","status_category":"Done","pull_request":6137},{"issue_id":"199845","title":"Heredoc is not accepted by the Puppet TypeParser","url":"https://tickets.puppetlabs.com/browse/PUP-7768","created_at":"2017-07-11T06:18:52.000-0700","number":"PUP-7768","body":"The following type definition results in an exception when parsed.\r\n{code:puppet}\r\nnotice(Type(@(TYPESPEC)))\r\nObject[{\r\n  attributes => {\r\n    text => {\r\n      type => String,\r\n      value => @(TEXT)\r\n        Some text\r\n        |TEXT\r\n    }\r\n  }\r\n}]\r\nTYPESPEC\r\n{code}\r\nThe following works OK though, since it is parsed by the evaluating parser.\r\n{code:puppet}\r\nnotice(Object[{\r\n  attributes => {\r\n    text => {\r\n      type => String,\r\n      value => @(TEXT)\r\n        Some text\r\n        |TEXT\r\n    }\r\n  }\r\n}])\r\n{code}","closed_at":"2017-09-14T10:39:59.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7768","labels":"","state":"Closed","updated_at":"2017-09-14T10:39:59.000-0700","timestamp":1652285473.623747,"priority":"Normal","status_category":"Done","pull_request":6117},{"issue_id":"206993","title":"The Default type is not considered RichData","url":"https://tickets.puppetlabs.com/browse/PUP-7863","created_at":"2017-08-23T01:42:22.000-0700","number":"PUP-7863","body":"The {{Default}} type, which maps to the {{default}} keyword in the puppet language is not part of the {{RichData}} variant. This is wrong. It must be possible to pass the {{default}} as {{RichData}}.","closed_at":"2017-09-20T13:06:18.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7863","labels":"","state":"Closed","updated_at":"2017-09-20T13:06:18.000-0700","timestamp":1652285474.053816,"priority":"Normal","status_category":"Done","pull_request":6142},{"issue_id":"206989","title":"Optional types are not assignable to Data and RichData","url":"https://tickets.puppetlabs.com/browse/PUP-7862","created_at":"2017-08-22T23:52:40.000-0700","number":"PUP-7862","body":"The implementation assumes that all values assignable to {{ScalarData}} also inherits from {{ScalarData}}. This means that an {{Optional}}, {{NotUndef}}, or {{Variant}} type that is limited to contain {{ScalarData}} types still isn't assignable to {{ScalarData}}.\r\n\r\nThe same problem applies to {{Scalar}}.\r\n","closed_at":"2017-09-20T13:07:05.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7862","labels":"","state":"Closed","updated_at":"2017-09-20T13:07:05.000-0700","timestamp":1652285474.159421,"priority":"Normal","status_category":"Done","pull_request":6141},{"issue_id":"196290","title":"Resource definition via Resource[\"string\"] { \"title\": ... } fails in Puppet 4.10.3","url":"https://tickets.puppetlabs.com/browse/PUP-7671","created_at":"2017-06-16T01:29:12.000-0700","number":"PUP-7671","body":"We have been using the following snippet to generate a number of resources dynamically in an each loop for a while now without problems. After the upgrade to 4.10.3 this morning (including a restart of the Puppetserver) we get this error on multiple nodes\r\n\r\n{noformat}\r\nCould not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Resource Statement, Unknown resource type: 'Saltnetwork::Iptables::Service_chain::Icmp' at <location of Resource in snippet below>\r\n{noformat}\r\n\r\nThe files are still in the\r\n\r\n{code:puppet}\r\n  each([ \"icmp\"\r\n       , \"ssh\"\r\n       , \"http\"\r\n       , \"http81\"\r\n       , \"https\"\r\n       , \"dhcp_client\"\r\n       , \"smtp\"       \r\n       , \"nrpe\"\r\n       ]) |$service_chain| {\r\n    $service_chain_dashes = regsubst($service_chain, '_', '-', 'G')\r\n    Resource[\"saltnetwork::iptables::service_chain::${service_chain}\"] { \"allow_${service_chain}\":\r\n      rule_set_name => 'common'\r\n    , rule_target  => { table => 'filter', chain => \"allow-${service_chain_dashes}\", target => 'ACCEPT' }\r\n    }                          \r\n  } \r\n\r\n{code}\r\n\r\nFor reference, the definition of the resource is in one of our module paths in saltnetwork/manifests/iptables/service_chain/icmp.pp\r\n\r\n\r\n{code:puppet}\r\ndefine saltnetwork::iptables::service_chain::icmp(\r\n    SaltNetwork::IPTables::Rule_Set_Name $rule_set_name\r\n  , SaltNetwork::IPTables::Rule_Target_Both $rule_target\r\n  , Boolean $return = true\r\n  ) {\r\n\r\n  $chain_name = $rule_target['chain']\r\n\r\n  $table = saltnetwork::iptables::table_for_target($rule_target)\r\n\r\n  saltnetwork::iptables::custom_chain_both { \"${rule_set_name}_${table}_${chain_name}\":\r\n      rule_set_name => $rule_set_name\r\n    , table      => $table\r\n    , chain_name => $chain_name\r\n    , return     => $return\r\n  }\r\n\r\n  saltnetwork::iptables::rule_both { \"${rule_set_name}_${table}_${chain_name}_icmp\":\r\n      rule_set_name => $rule_set_name\r\n    , rule_order => 10\r\n    , rule_matches => [ { match => 'iana_protocol', protocol => 'icmp' } ]\r\n    , rule_target => $rule_target\r\n    , rule_comment => \"ICMP\"\r\n  }\r\n\r\n}\r\n\r\n{code}\r\n\r\n","closed_at":"2017-09-28T09:54:54.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7671","labels":"regression;resolved-issue-added","state":"Closed","updated_at":"2017-09-28T09:54:54.000-0700","timestamp":1652285484.532728,"priority":"Blocker","status_category":"Done","pull_request":5993},{"issue_id":"195438","title":"\"Attempt to redefine entity\" caused by upper/lower case name confusion in Loader","url":"https://tickets.puppetlabs.com/browse/PUP-7650","created_at":"2017-06-12T07:02:24.000-0700","number":"PUP-7650","body":"A load of a resource type will _sometimes_ create a {{Puppet::Pops::Loader::TypedName}} that starts with an uppercase letter. When this name is used in order to find a type generated with {{puppet generate types}}, it isn't found. Since it's not found, a load of the Ruby type is performed instead, which results in an \"Attempt to redefine entity\" error when that a successful load of the generated type has been performed earlier (with a {{TypedName}} that didn't start with an uppercase letter).","closed_at":"2017-09-28T09:59:09.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7650","labels":"","state":"Closed","updated_at":"2017-09-28T09:59:09.000-0700","timestamp":1652285484.641518,"priority":"Critical","status_category":"Done","pull_request":5980},{"issue_id":"204789","title":"TypeParser accepts Variant parameters that are not types.","url":"https://tickets.puppetlabs.com/browse/PUP-7829","created_at":"2017-08-09T22:52:44.000-0700","number":"PUP-7829","body":"The {{TypeParser}} class, used for parsing parameter types in Ruby dispatchers, allows parameters that are not types. The Puppet evaluator does however check that all parameters\r\nare types.\r\n\r\nThe behavior should be the same for both. It does not make sense for a Variant to accept parameters that are not types.","closed_at":"2017-10-02T06:14:12.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7829","labels":"","state":"Closed","updated_at":"2017-10-02T06:14:12.000-0700","timestamp":1652285484.85358,"priority":"Normal","status_category":"Done","pull_request":6113},{"issue_id":"203673","title":"Yum package provider: ensure => latest fails when packages update available","url":"https://tickets.puppetlabs.com/browse/PUP-7813","created_at":"2017-08-02T10:24:00.000-0700","number":"PUP-7813","body":"If one package is listed in the output of 'yum check-update', any package update fails.\r\n\r\n{noformat}\r\n# puppet resource package kernel ensure=latest\r\nError: Could not get latest version: undefined method `[]' for nil:NilClass\r\nError: /Package[kernel]/ensure: change from 3.10.0-514.26.2.el7 to latest failed: Could not get latest version: undefined method `[]' for nil:NilClass\r\npackage { 'kernel':\r\n  ensure => '3.10.0-514.26.2.el7',\r\n}\r\n{noformat}\r\n\r\n{noformat}\r\n\r\n# /bin/yum check-update\r\nLoaded plugins: enabled_repos_upload, fastestmirror, package_upload, product-id, search-disabled-repos, subscription-\r\n              : manager, tracer_upload\r\nKS_Centos_Centos_7_Base                                                                       | 2.1 kB  00:00:00     \r\nKS_Centos_Centos_7_Updates                                                                    | 2.5 kB  00:00:00     \r\nKS_Katello_Server_3_4                                                                         | 2.1 kB  00:00:00     \r\nLoading mirror speeds from cached hostfile\r\n\r\nforeman-installer-katello.noarch                          3.4.4-1.el7                           KS_Katello_Server_3_4\r\nkatello-debug.noarch                                      3.4.4-2.el7                           KS_Katello_Server_3_4\r\nkatello-installer-base.noarch                             3.4.4-1.el7                           KS_Katello_Server_3_4\r\nkatello-service.noarch                                    3.4.4-2.el7                           KS_Katello_Server_3_4\r\nUploading Enabled Reposistories Report\r\nLoaded plugins: fastestmirror, product-id\r\n\r\n{noformat}\r\n\r\n\r\n{noformat}\r\n# yum-config-manager --disable KS_Katello_Server_3_4\r\n{noformat}\r\n\r\n\r\n{noformat}\r\n# puppet resource  package kernel ensure=latest\r\npackage { 'kernel':\r\n  ensure => '3.10.0-514.26.2.el7',\r\n}\r\n{noformat}\r\n\r\n\r\n","closed_at":"2017-10-02T08:27:34.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7813","labels":"puppet-agent","state":"Closed","updated_at":"2017-10-02T08:27:34.000-0700","timestamp":1652285485.069534,"priority":"Major","status_category":"Done","pull_request":6128},{"issue_id":"209323","title":"An Object Data Type with an unresolved parent causes an undefined method error","url":"https://tickets.puppetlabs.com/browse/PUP-7916","created_at":"2017-09-06T04:25:43.000-0700","number":"PUP-7916","body":"If an Object type is created with an unresolved parent type, this causes an unnamed anonymous class to be created which in turn results in the error an undefined error.\r\n\r\nThis error should normally never happen since the fact that the parent type is unresolved will be trapped by the evaluator. In order to this to happen, the unresolved parent must first be cloaked by having a string resolved into a {{TypeReference}}. Example:\r\n{code}$ bundle exec puppet apply -e 'notice(Object[{name => \"Bar\", parent => Type(\"Foo\")}].new)'\r\nError: Evaluation Error: Error while evaluating a Method call, undefined method `sub' for nil:NilClass  at line 1:54 on node localhost\r\n{code}\r\nThis however (which would be the common case) correctly reports the unresolved parent:\r\n{code}\r\n$ bundle exec puppet apply -e 'notice(Object[{name => \"Bar\", parent => Foo}].new)'\r\nError: Evaluation Error: Resource type not found: Foo  at line 1:41 on node localhost\r\n{code}\r\n\r\n","closed_at":"2017-10-03T06:17:55.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7916","labels":"","state":"Closed","updated_at":"2017-10-03T06:17:55.000-0700","timestamp":1652285485.17723,"priority":"Minor","status_category":"Done","pull_request":6177},{"issue_id":"210150","title":"Remove documentation about 'last' in scheduledtasks type","url":"https://tickets.puppetlabs.com/browse/PUP-7933","created_at":"2017-09-11T08:54:41.000-0700","number":"PUP-7933","body":"When trying to set a scheduled_task trigger I get the following error:\r\n\r\n{code}\r\nC:/Program Files/Puppet Labs/Puppet/puppet/bin/puppet:8:in `<main>'\r\nError: /Stage[main]/Adoberum::Service/Scheduled_task[Adobe Remote Update Manager\r\n]/ensure: change from absent to present failed: Failed to call #<Win32::TaskSche\r\nduler::COM::TaskTrigger:0x0000000872bd18>::SetTrigger with HRESULT: -2147024809.\r\n:  The parameter is incorrect.\r\n{code}\r\n\r\nThis happens for both month-by-date and month-by-weekday.\r\n\r\nMy scheduled_task resource is as follows:\r\n{code}\r\nscheduled_task { 'Adobe Remote Update Manager':\r\n      ensure    => present,\r\n      command   => $adoberum::command_source,\r\n      enabled   => true,\r\n      trigger   => {schedule => monthly, on => [1,3,last,17], start_time => '08:00', months => [1, 3, 5]},\r\n    }\r\n{code}\r\n\r\nI've tried quoting and unquoting the parameter in the triggers hash. Works completely fine for daily and weekly triggers.\r\n\r\nThis has been tested on two different windows 7 machines with two different puppet version and the error is the same.\r\n\r\nFull Trace(from 3.7.4 Puppet):\r\n{code}\r\nError: Failed to call #<Win32::TaskScheduler::COM::TaskTrigger:0x0000000872bd18>\r\n::SetTrigger with HRESULT: -2147024809.:  The parameter is incorrect.\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:142:in\r\n `block (3 levels) in []'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler\r\n.rb:966:in `block (2 levels) in populate_trigger'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler\r\n.rb:918:in `initialize'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler\r\n.rb:918:in `new'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler\r\n.rb:918:in `block in populate_trigger'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler\r\n.rb:917:in `initialize'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler\r\n.rb:917:in `new'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler\r\n.rb:917:in `populate_trigger'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler\r\n.rb:621:in `block (2 levels) in trigger='\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:117:in\r\n `block in UseInstance'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:114:in\r\n `initialize'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:114:in\r\n `new'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/com.rb:114:in\r\n `UseInstance'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler\r\n.rb:620:in `block in trigger='\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler\r\n.rb:615:in `initialize'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler\r\n.rb:615:in `new'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/taskscheduler\r\n.rb:615:in `trigger='\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/provider/scheduled_task/wi\r\nn32_taskscheduler.rb:193:in `block in trigger='\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/provider/scheduled_task/wi\r\nn32_taskscheduler.rb:188:in `each'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/provider/scheduled_task/wi\r\nn32_taskscheduler.rb:188:in `trigger='\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/provider/scheduled_task/wi\r\nn32_taskscheduler.rb:216:in `block in create'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/provider/scheduled_task/wi\r\nn32_taskscheduler.rb:215:in `each'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/provider/scheduled_task/wi\r\nn32_taskscheduler.rb:215:in `create'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/property/ensure.rb:16:in `\r\nblock in defaultvalues'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/property.rb:197:in `call_v\r\naluemethod'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/property.rb:498:in `set'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/property.rb:581:in `sync'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harne\r\nss.rb:204:in `sync'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harne\r\nss.rb:128:in `sync_if_needed'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harne\r\nss.rb:81:in `perform_changes'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harne\r\nss.rb:20:in `evaluate'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:204:in `app\r\nly'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:217:in `eva\r\nl_resource'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:147:in `cal\r\nl'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:147:in `blo\r\nck (2 levels) in evaluate'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:327:in `block in t\r\nhinmark'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/2.0.0/benchmark.rb:296:in\r\n`realtime'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:326:in `thinmark'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:147:in `blo\r\nck in evaluate'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/graph/relationship_graph.r\r\nb:118:in `traverse'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:138:in `eva\r\nluate'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/resource/catalog.rb:169:in\r\n `block in apply'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/log.rb:149:in `with_d\r\nestination'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/transaction/report.rb:112:\r\nin `as_logging_destination'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/resource/catalog.rb:168:in\r\n `apply'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:120:in `bloc\r\nk in apply_catalog'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:161:in `block in b\r\nenchmark'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/2.0.0/benchmark.rb:296:in\r\n`realtime'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:160:in `benchmark'\r\n\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:119:in `appl\r\ny_catalog'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:227:in `run_\r\ninternal'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:134:in `bloc\r\nk in run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/context.rb:64:in `override\r\n'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet.rb:244:in `override'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:133:in `run'\r\n\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/agent.rb:47:in `block (4 l\r\nevels) in run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/agent/locker.rb:20:in `loc\r\nk'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/agent.rb:47:in `block (3 l\r\nevels) in run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/agent.rb:117:in `with_clie\r\nnt'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/agent.rb:44:in `block (2 l\r\nevels) in run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/agent.rb:82:in `run_in_for\r\nk'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/agent.rb:43:in `block in r\r\nun'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:179:in `cal\r\nl'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:179:in `con\r\ntrolled_run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/agent.rb:41:in `run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application/agent.rb:356:i\r\nn `onetime'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application/agent.rb:322:i\r\nn `run_command'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:381:in `blo\r\nck (2 levels) in run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:507:in `plu\r\ngin_hook'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:381:in `blo\r\nck in run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:488:in `exit_on_fa\r\nil'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:381:in `run\r\n'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/command_line.rb:146:i\r\nn `run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/command_line.rb:92:in\r\n `execute'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/bin/puppet:8:in `<main>'\r\nError: /Stage[main]/Adoberum::Service/Scheduled_task[Adobe Remote Update Manager\r\n]/ensure: change from absent to present failed: Failed to call #<Win32::TaskSche\r\nduler::COM::TaskTrigger:0x0000000872bd18>::SetTrigger with HRESULT: -2147024809.\r\n:  The parameter is incorrect.\r\n{code}","closed_at":"2017-10-03T06:17:59.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7933","labels":"hresult;monthly;scheduled_task;settrigger;windows","state":"Closed","updated_at":"2017-10-03T06:17:59.000-0700","timestamp":1652285485.283643,"priority":"Normal","status_category":"Done","pull_request":6194},{"issue_id":"209793","title":"vendored pathspec library has an over-reaching regexp","url":"https://tickets.puppetlabs.com/browse/PUP-7926","created_at":"2017-09-08T09:08:27.000-0700","number":"PUP-7926","body":"pathspec has a regular expression to match for Windows drive letters.\r\nIt is contains [a-zA-z] - which unintentionally also matches _, ^ and other non-letter characters between Z and a.\r\nSee https://github.com/highb/pathspec-ruby/pull/16 for the pull request for upstream pathspec-ruby.","closed_at":"2017-10-03T06:18:02.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7926","labels":"","state":"Closed","updated_at":"2017-10-03T06:18:02.000-0700","timestamp":1652285485.603219,"priority":"Trivial","status_category":"Done","pull_request":6208},{"issue_id":"213182","title":"Puppetserver errors reading pcore objects with non-english locale","url":"https://tickets.puppetlabs.com/browse/PUP-7992","created_at":"2017-09-26T00:37:04.000-0700","number":"PUP-7992","body":"{code}\r\n$ puppet agent -t\r\nInfo: 設定された環境'production'を使用しています。\r\nInfo: pluginfactsを取得しています。\r\nInfo: pluginを取得しています。\r\nInfo: Loading facts\r\nError: リモートサーバからカタログを取得できませんでした: SERVERのエラー500 : サーバエラー: Evaluation Error: a Resource Statementの検証中にエラーが生じました。Evaluation Error: a Resource Statementの検証中にエラーが生じました。/etc/puppetlabs/code/environments/production/.resource_types/pe_anchor.ppからロードしたコードでは、リソースタイプ'pe_anchor'は作成されません - Puppet::Resource::ResourceType3.newに対するコールが見つかりませんでした。 at /opt/puppetlabs/puppet/modules/puppet_enterprise/manifests/init.pp:228:3 on node mom.puppet.vm\r\nWarning: 失敗したカタログではキャッシュを使用できません。\r\nError: カタログを取得できませんでした; 実行をスキップしています。\r\n{code}","closed_at":"2017-10-03T06:18:02.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7992","labels":"","state":"Closed","updated_at":"2017-10-03T06:18:02.000-0700","timestamp":1652285485.70835,"priority":"Major","status_category":"Done","pull_request":6234},{"issue_id":"211153","title":"Types with a trailing comma fail on 5.2.0","url":"https://tickets.puppetlabs.com/browse/PUP-7952","created_at":"2017-09-15T06:46:21.000-0700","number":"PUP-7952","body":"Type Aliases are broken if they include a trailing comma during testing on 5.2.0.\r\n\r\nI created a demo repository with a Travis hook right here: https://github.com/pegasd/puppet-broken_type\r\n\r\nAs you can see from the latest build, both types work fine under 5.1.0, but one of them (with a trailing comma) fails:\r\nhttps://travis-ci.org/pegasd/puppet-broken_type","closed_at":"2017-10-03T06:18:04.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7952","labels":"","state":"Closed","updated_at":"2017-10-03T06:18:04.000-0700","timestamp":1652285485.922772,"priority":"Normal","status_category":"Done","pull_request":6213},{"issue_id":"205933","title":"A Puppet report from an interrupted run can cause exit_status to throw an exception","url":"https://tickets.puppetlabs.com/browse/PUP-7844","created_at":"2017-08-15T11:43:24.000-0700","number":"PUP-7844","body":"Recently when playing around with reports in irb, I discovered that the exit_status method raises an exception when called against a report from an interrupted (ctrl + c or other) puppet run.\r\n\r\n{code}\r\nirb(main):007:0> a.exit_status\r\nNoMethodError: undefined method `[]' for nil:NilClass\r\n        from /Users/matthaus/src/puppet/lib/puppet/transaction/report.rb:380:in `exit_status'\r\n        from (irb):7\r\n        from /usr/local/opt/ruby/bin/irb:11:in `<main>'\r\n{code}\r\n\r\nThe metrics instance variable is not fully populated for that report and the lookups performed in the exit_status method are not safe with respect to metrics being an empty hash.","closed_at":"2017-10-03T06:18:05.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7844","labels":"","state":"Closed","updated_at":"2017-10-03T06:18:05.000-0700","timestamp":1652285486.030196,"priority":"Normal","status_category":"Done","pull_request":6124},{"issue_id":"209004","title":"Heredoc with hyphen strips extra newlines","url":"https://tickets.puppetlabs.com/browse/PUP-7902","created_at":"2017-09-03T22:56:07.000-0700","number":"PUP-7902","body":"A heredoc set to [suppress the final line break|https://docs.puppet.com/puppet/5.1/lang_data_string.html#suppressing-the-final-line-break] also converts double line breaks into single line breaks.\r\n\r\n{code:title=Without suppression (END)}\r\n❯ cat test.pp \r\nnotice(@(END))\r\nline1\r\nline2\r\n\r\nline4\r\nEND\r\n❯ puppet apply test.pp \r\nNotice: Scope(Class[main]): line1\r\nline2\r\n\r\nline4\r\n\r\nNotice: Compiled catalog for marla.local in environment production in 0.03 seconds\r\nNotice: Applied catalog in 0.01 seconds\r\n{code}\r\n\r\n{code:title=With suppression (-END)}\r\n❯ cat test.pp \r\nnotice(@(END))\r\nline1\r\nline2\r\n\r\nline4\r\n-END\r\n❯ puppet apply test.pp\r\nNotice: Scope(Class[main]): line1\r\nline2\r\nline4\r\nNotice: Compiled catalog for marla.local in environment production in 0.03 seconds\r\nNotice: Applied catalog in 0.01 seconds\r\n{code}\r\n\r\n{{-END}} should only supress the final line break.","closed_at":"2017-10-03T11:24:21.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7902","labels":"","state":"Closed","updated_at":"2017-10-03T11:24:21.000-0700","timestamp":1652285486.139769,"priority":"Normal","status_category":"Done","pull_request":6171},{"issue_id":"214086","title":"Performance regression with lots of modules and gettext","url":"https://tickets.puppetlabs.com/browse/PUP-8009","created_at":"2017-10-02T10:16:24.000-0700","number":"PUP-8009","body":"We've seen a ~30% reduction in compilation capacity with Puppet 5.3 (over Puppet 4.10). It appears to be related to gettext setup at https://github.com/puppetlabs/puppet/blob/master/lib/puppet/gettext/config.rb#L37-L69.\r\n\r\nWe haven't fully isolated why, but the best guess is that code related to accessing modules during compilation is being called too frequently, and resulting in lots of disk-related activity.","closed_at":"2017-10-06T06:39:57.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8009","labels":"","state":"Closed","updated_at":"2017-10-06T06:39:57.000-0700","timestamp":1652285486.571163,"priority":"Critical","status_category":"Done","pull_request":6252},{"issue_id":"215883","title":"Tasks with an ensure parameter cause plan failure","url":"https://tickets.puppetlabs.com/browse/PUP-8046","created_at":"2017-10-11T15:16:44.000-0700","number":"PUP-8046","body":"When tasks that have an ensure parameter are used in a plan, they cause a stack trace.\r\n\r\nI am seeing this when using gcompute::instance in a plan on bolt 0.5.0","closed_at":"2017-10-27T16:03:39.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8046","labels":"","state":"Closed","updated_at":"2017-10-27T16:03:39.000-0700","timestamp":1652285488.186013,"priority":"Critical","status_category":"Done","pull_request":6281},{"issue_id":"18858","title":"Windows does not support :links :follow on symlinks","url":"https://tickets.puppetlabs.com/browse/PUP-745","created_at":"2013-11-13T14:29:25.000-0800","number":"PUP-745","body":"With the addition of Windows symlink support, interesting behavior was discovered with respect to setting `:link` to `:follow` instead of the default `:manage` behavior.\r\n\r\nThere is one test that verifies the existing behavior that was last active in 2010, and was re-enabled during the work on symlinks.  However, this test has been set to pending as Windows doesn't have this support.\r\nhttps://github.com/puppetlabs/puppet/pull/1997/files#diff-dc02733a866500a00802c3dff20797c6R1342","closed_at":"2017-10-30T14:49:28.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-745","labels":"","state":"Closed","updated_at":"2017-10-30T14:49:28.000-0700","timestamp":1652285488.293878,"priority":"Normal","status_category":"Done","pull_request":6086},{"issue_id":"19720","title":"Deprecate puppet inspect and the audit metaparameter","url":"https://tickets.puppetlabs.com/browse/PUP-893","created_at":"2013-11-26T11:47:29.000-0800","number":"PUP-893","body":"This was added for one customer and is no longer used or supported in PE.  We should deprecate it.  Per Eric0:\r\n\r\nRe: inspect/audit reports – no resistance, i put it out to sales, SE, support, PS and got no push-back. Please add it to the chopping block.","closed_at":"2017-11-01T15:39:00.000-0700","comments":21,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-893","labels":"","state":"Closed","updated_at":"2017-11-01T15:39:00.000-0700","timestamp":1652285488.61708,"priority":"Normal","status_category":"Done","pull_request":8107},{"issue_id":"212701","title":"Enable testing puppet-agent built against system openssl on RHEL in PA CI pipes","url":"https://tickets.puppetlabs.com/browse/PUP-7983","created_at":"2017-09-22T13:43:00.000-0700","number":"PUP-7983","body":"Testing PA built against system openssl thru CI has turned into quite a non-trivial exercise. First attempt resulted in some tests failing on the master host that CI sets up. Ironically, such agents have been able to get their certificate signed by the master fine when setup manually. \r\nThat led to reproducing the failure using beaker locally. Testing using beaker led to a different failure during the pre-suite/setup step of PA acceptance tests.\r\nManaged to overcome that by customizing pre-suite scripts in puppet. Now need to use this custom version of puppet when launching CI. Lets see how long this goes on... \r\nAll to get a PA CI test passing certificate to be able to submit PR in puppet to enable building against system openssl. ","closed_at":"2017-11-06T22:17:25.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7983","labels":"","state":"Closed","updated_at":"2017-11-06T22:17:25.000-0800","timestamp":1652285489.163009,"priority":"Normal","status_category":"Done","pull_request":6271},{"issue_id":"217917","title":"NTFS reparse points return invalid path data strings for mount points (like those in a DFS share)","url":"https://tickets.puppetlabs.com/browse/PUP-8083","created_at":"2017-10-23T16:43:01.000-0700","number":"PUP-8083","body":"While investigating MODULES-4934, it was realized that NTFS reparse points inside of DFS mounts were using an inappropriate data structure.\r\n\r\nThis would result in {{Puppet::Util::Windows::File.resolve_symlink}} returning a path string missing the first 4 bytes (and reading an extra 4 bytes of junk data off the end of the buffer).\r\n\r\nIn short, DFS shares with reparse points never work in Puppet properly.  A simple repro scenario is to use a file resource in Puppet to recursively copy from a DFS path (that contains the default hidden reparse point to the host drives {{C:\\\\Volume Information}}) like:\r\n\r\n{code}\r\nfile { 'c:/Share1-test':\r\n     ensure  => directory,\r\n     recurse => true,\r\n     source  => '//dfsdemo.local/Puppet/TestShare',\r\n     source_permissions => 'ignore'\r\n }\r\n{code}","closed_at":"2017-11-07T07:18:52.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8083","labels":"","state":"Closed","updated_at":"2017-11-07T07:18:52.000-0800","timestamp":1652285489.375486,"priority":"Normal","status_category":"Done","pull_request":6300},{"issue_id":"211143","title":"agent - server setup - file bucketing for binary files fails in case same file is bucketed for 2 different paths","url":"https://tickets.puppetlabs.com/browse/PUP-7951","created_at":"2017-09-15T00:42:04.000-0700","number":"PUP-7951","body":"Scenario: Puppet Agent is bucketing file to Puppetserver\r\n\r\nFollowing scenario (but in agent-server) configuration should show the error:\r\npuppet apply -e 'file { \"/tmp/d1/file1\": source => \"/usr/bin/at\" }'\r\n\r\npuppet apply -e 'file { \"/tmp/d1/file1\": source => \"/usr/bin/bash\" }'\r\n# file1 already exists, so it is bucketed before rewritten by contents of 'bash'\r\n\r\npuppet apply -e 'file { \"/tmp/d2/file2\": source => \"/usr/bin/at\" }'\r\n\r\npuppet apply -e 'file { \"/tmp/d2/file2\": source => \"/usr/bin/bash\" }'\r\n# file2 already exists, so it is bucketed before rewritten by contents of 'bash'. It is bucketed to same directory on server because md5 hash of file2 is same as md5 hash of bucketed file1. And bucketing fails.\r\n\r\n\r\nIn theory this should work. And for local bucketing it works. \r\nThere are 2 artefacts on server for each bucketed file - contents and paths. Paths contains all paths where contents was stored on origin system.\r\n\r\nWhen file is bucketed there are multiple checks - size, md5 hash and file to be bucketed is byte-to-byte compared with already bucketed file.\r\n\r\nIn case that given file is bucketed (file with md5sum hash exists on server) and path on origin system is different to path stored in 'paths' than there are 2 checks - size of bucketed file and checksum. Size is compared between data of file received over network from agent and existing 'contents' on server.\r\n\r\nThe problem is, that this comparison usually fails because encoding of data received over network are 'UTF-8' encoded and contents is \"like\" plain bytes. So size doesn't match and it is considered error and processing of file resource fails.\r\n\r\nFor puppet-agent-1.10.4-1.el7.x86_64 rpm:\r\nComparison is in: method Puppet::FileBucketFile::File.verify_identical_file()\r\nbucket_file is: Puppet::FileBucket::File::StringContents\r\n\r\nSolution should be to ensure size of data received over network to be converted to something like \"ASCII-8BIT\" encoding even for 'size' operation.","closed_at":"2017-11-07T07:18:55.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7951","labels":"","state":"Closed","updated_at":"2017-11-07T07:18:55.000-0800","timestamp":1652285490.022014,"priority":"Major","status_category":"Done","pull_request":6261},{"issue_id":"217192","title":"Class documentation for PBinaryType is copy/pasted and incorrect","url":"https://tickets.puppetlabs.com/browse/PUP-8071","created_at":"2017-10-19T03:31:05.000-0700","number":"PUP-8071","body":"The [class documentation|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/pops/types/p_binary_type.rb#L5-L6] for the {{PBinaryType}} is copied verbatim from the {{PVersionType}}. It should be changed to describe the {{Binary}} data type.","closed_at":"2017-11-07T07:18:56.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8071","labels":"","state":"Closed","updated_at":"2017-11-07T07:18:56.000-0800","timestamp":1652285490.234106,"priority":"Normal","status_category":"Done","pull_request":6290},{"issue_id":"52980","title":"nagios_contact no longer is able to parse utf-8 from nagios config files","url":"https://tickets.puppetlabs.com/browse/PUP-3368","created_at":"2014-09-30T03:35:04.000-0700","number":"PUP-3368","body":"Our manifest used to work with Ubuntu precise 12.04 amd64. I upgraded ubuntu, which upgraded ruby. That should be the limit of the changes to the environment.\r\n\r\nRepeatedly applying the attached manifest results in the output below:\r\n{quote}\r\n# puppet apply test.pp \r\nNotice: Compiled catalog for monitor.corp.zenrobotics.com in environment production in 0.04 seconds\r\nError: Could not convert change 'alias' to string: incompatible character encodings: ASCII-8BIT and UTF-8\r\nError: Could not convert change 'alias' to string: incompatible character encodings: ASCII-8BIT and UTF-8\r\nError: /Stage[main]/Main/Nagios_contact[ptman]: Could not evaluate: Puppet::Util::Log requires a message\r\nNotice: Finished catalog run in 0.34 seconds\r\nError: Could not write report for monitor.corp.zenrobotics.com at /var/lib/puppet/reports/monitor.corp.zenrobotics.com/201409301029.yaml: incompatible character encodings: ASCII-8BIT and UTF-8\r\nError: Could not send report: incompatible character encodings: ASCII-8BIT and UTF-8\r\n{quote}\r\n\r\nIf the accented character are removed or replaced, the errors go away. But trying to apply the manifest with utf-8 again results in no errors on the first run, and the same error on subsequent runs, which leads me to believe that the problem is in the provider parsing the current state of the config files.","closed_at":"2017-11-07T07:18:56.000-0800","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3368","labels":"encoding;naginator;nagios;utf-8","state":"Closed","updated_at":"2017-11-07T07:18:56.000-0800","timestamp":1652285490.342624,"priority":"Normal","status_category":"Done","pull_request":6258},{"issue_id":"178810","title":"classes do not honor refresh events when running with tags ","url":"https://tickets.puppetlabs.com/browse/PUP-7308","created_at":"2017-03-06T12:30:30.000-0800","number":"PUP-7308","body":"It appears that classes are not inheriting tags properly when included, but their resources are. This breaks notifying a class when running with --tags, and results in the relevant resources not getting the notify.\r\n\r\ntagsbug.pp:\r\n\r\n\r\n{noformat}\r\nclass foo {\r\n  exec { 'notify test':\r\n    command     => '/bin/true',\r\n    refreshonly => true,\r\n  }\r\n}\r\n\r\nclass test {\r\n  include foo\r\n\r\n  exec { 'test':\r\n    command => '/bin/true',\r\n    #notify  => Class['foo'],\r\n    notify  => Exec['notify test'],\r\n  }\r\n}\r\n\r\ninclude test\r\n\r\n\r\n{noformat}\r\n\r\nRunning: puppet apply --test --tags test tagsbug.pp\r\n\r\nWith Exec['test'] notifying Exec['notify test']:\r\n\r\n\r\n{noformat}\r\nInfo: Applying configuration version '1488579119'\r\nNotice: /Stage[main]/Test/Exec[test]/returns: executed successfully\r\nInfo: /Stage[main]/Test/Exec[test]: Scheduling refresh of Exec[notify test]\r\nNotice: /Stage[main]/Foo/Exec[notify test]: Triggered 'refresh' from 1 events\r\nInfo: Class[Foo]: Unscheduling all events on Class[Foo]\r\nInfo: Stage[main]: Unscheduling all events on Stage[main]\r\n{noformat}\r\n\r\nWith Exec['test'] notifying Class['foo']:\r\n\r\n\r\n{noformat}\r\nInfo: Applying configuration version '1488579147'\r\nNotice: /Stage[main]/Test/Exec[test]/returns: executed successfully\r\nInfo: /Stage[main]/Test/Exec[test]: Scheduling refresh of Class[Foo]\r\nInfo: Class[Foo]: Unscheduling all events on Class[Foo]\r\nInfo: Stage[main]: Unscheduling all events on Stage[main]\r\n{noformat}\r\n\r\nExec['notify test'] does not get notified/run. Looking at the --debug output:\r\n\r\n\r\n{noformat}\r\nDebug: Class[Foo]: Not tagged with test\r\nDebug: Class[Foo]: Resource is being skipped, unscheduling all events\r\n{noformat}\r\n\r\n\r\nIs this expected behavior?  I even tried replacing 'include foo' with:\r\n\r\n{noformat}\r\n class { 'foo':\r\n   tag => 'test',\r\n }\r\n{noformat}\r\n\r\nbut the behavior of sending a notify to Class['foo'] is the same (it\r\ndoes not trigger Exec['notify test']).\r\n\r\n*Notes*\r\n* Initial guess was that this was due to use of `include` instead of `contain` but it was determined that `contain`ed classes also fail to properly refresh events\r\n* Internally, classes (containers) are replaced in the graph with whit \"resources\" (see https://github.com/puppetlabs/puppet/blob/ebd96213cab43bb2a8071b7ac0206c3ed0be8e58/lib/puppet/graph/relationship_graph.rb#L230-L273)\r\n* it's possible tags are not correctly being propagated or evaluated to these resources ","closed_at":"2017-11-07T07:18:57.000-0800","comments":20,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7308","labels":"tags;the-goods","state":"Closed","updated_at":"2017-11-07T07:18:57.000-0800","timestamp":1652285490.724562,"priority":"Major","status_category":"Done","pull_request":6214},{"issue_id":"206127","title":"Capitals in variable names in EPP templates hang threads forever","url":"https://tickets.puppetlabs.com/browse/PUP-7848","created_at":"2017-08-16T05:55:51.000-0700","number":"PUP-7848","body":"Hi,\r\n\r\nThe following EPP snippet compiles with no issues and in a timely manner\r\n\r\n{noformat}\r\nUSER='<%= $hg_oais::archivematica::requirements::automation_tools::user %>'\r\n{noformat}\r\n\r\nhowever this one (note the capitals) ends up in a catalog request that never finishes, indefinitely consuming 100% CPU in the thread where the jRuby instance assigned to compile is running.\r\n\r\n{noformat}\r\nUSER='<%= $hg_oais::archivematica::requirements::automation_tools::USER %>'\r\n{noformat}\r\n\r\nNo timeouts/errors master-side, nothing, just huge CPU usage forever.\r\n\r\nThe variable name ought have no capitals indeed but the master should either fail or resolve to empty, but never hang.\r\n\r\nWe're using Puppet agent 1.9.3 (Puppet 4.9.4) and Puppetserver 2.7.2. No attempts to hit the bug using Puppetserver5 were made so far.\r\n\r\n!2.png|thumbnail! shows how two threads that had to compile that code have been consuming a large amount of CPU hours. That time roughly matches the time lapsed between the moment when the compilation request was issued and the time when the screenshot was taken. We don't see that pattern on masters that never saw that snippet.\r\n\r\nCould you please try to reproduce the issue?\r\n\r\nThanks.\r\n\r\n(CERN internal reference: AI-4900)","closed_at":"2017-11-07T19:42:15.000-0800","comments":25,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7848","labels":"","state":"Closed","updated_at":"2017-11-07T19:42:15.000-0800","timestamp":1652285491.252844,"priority":"Major","status_category":"Done","pull_request":6189},{"issue_id":"155267","title":"service should check for smf service first","url":"https://tickets.puppetlabs.com/browse/PUP-6797","created_at":"2016-10-05T12:45:06.000-0700","number":"PUP-6797","body":"The service provider should check for the smf service first and exit with a more informative message if it does not exist. ","closed_at":"2017-11-12T19:06:14.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6797","labels":"maintenance","state":"Closed","updated_at":"2017-11-12T19:06:14.000-0800","timestamp":1652285492.33583,"priority":"Normal","status_category":"Done","pull_request":5413},{"issue_id":"219740","title":"puppet device cannot create certs when run as root (5.3.x backport)","url":"https://tickets.puppetlabs.com/browse/PUP-8109","created_at":"2017-10-31T10:47:02.000-0700","number":"PUP-8109","body":"Backport fix into 5.3.x\r\n\r\nbroken -- output of `puppet device --debug` when ran as root:\r\n{noformat}\r\ninfo: Creating a new SSL key for 10.0.1.3\r\nerr: Could not request certificate: Could not write /var/opt/lib/pe-puppet/devices/10.0.1.3/ssl/private_keys/10.0.1.3.pem to privatekeydir: Permission denied - /var/opt/lib/pe-puppet/devices/10.0.1.3/ssl/private_keys/10.0.1.3.pem\r\n{noformat}\r\n\r\nsuccess -- output of `puppet device --debug` when ran as a normal user:\r\n{noformat}\r\nwarning: peer certificate won't be verified in this SSL session\r\ninfo: Caching certificate for ca\r\nwarning: peer certificate won't be verified in this SSL session\r\nwarning: peer certificate won't be verified in this SSL session\r\ninfo: Creating a new SSL certificate request for 10.0.1.3\r\ninfo: Certificate Request fingerprint (md5): 6C:1C:4C:37:A7:1D:B3:6E:F3:94:25:67:55:27:89:4C\r\nwarning: peer certificate won't be verified in this SSL session\r\ndebug: Using cached certificate for ca\r\nwarning: peer certificate won't be verified in this SSL session\r\ninfo: Caching certificate for 10.0.1.3\r\n{noformat}\r\n\r\nNote, that you have to copy `/etc/puppetlabs/puppet/device.conf` to `~/.puppet/`","closed_at":"2017-11-16T16:05:18.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8109","labels":"redmine","state":"Closed","updated_at":"2017-11-16T16:05:18.000-0800","timestamp":1652285493.192046,"priority":"Normal","status_category":"Done","pull_request":6328},{"issue_id":"46677","title":"PMT fails to download modules with The HTTP response we received was '200 OK'","url":"https://tickets.puppetlabs.com/browse/PUP-3019","created_at":"2014-08-06T09:29:35.000-0700","number":"PUP-3019","body":"When download a module from forge PMT fails with \r\n\r\n{noformat}\r\nError: Request to Puppet Forge failed.\r\n  The server being queried was /v3/files/puppetlabs-apache-1.1.1.tar.gz\r\n  The HTTP response we received was '200 OK'\r\n{noformat}","closed_at":"2017-11-27T11:39:43.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3019","labels":"","state":"Closed","updated_at":"2017-11-27T11:39:43.000-0800","timestamp":1652285494.991435,"priority":"Normal","status_category":"Done","pull_request":2945},{"issue_id":"77996","title":"Puppet 3.5.0 introduced a regression in tag filtering for catalog runs","url":"https://tickets.puppetlabs.com/browse/PUP-4495","created_at":"2015-04-29T14:07:27.000-0700","number":"PUP-4495","body":"Puppet 3.5.0 introduced a regression to agent tag filtering where a single tag, {{--tag foo::bar}} would be split on the namespace separator {{::}} and expanded to a set of {{['foo::bar', 'foo', 'bar']}}.\r\n\r\nThis causes the agent to sync more resources than the user intended when tag filtering is in effect.\r\n\r\nh2. Reproduction Case\r\n\r\nApply the following test manifest with a tag filter of {{--tag test::step1}}:\r\n\r\n{code:puppet}\r\n# tag_test.pp\r\n\r\nclass test {\r\n  include test::step1\r\n  include test::step2\r\n}\r\n\r\nclass test::step1 {\r\n  file { '/tmp/test1.txt':\r\n    ensure => 'file',\r\n  }\r\n}\r\n\r\nclass test::step2 {\r\n  file { '/tmp/test2.txt':\r\n    ensure => 'file',\r\n  }\r\n}\r\n\r\ninclude test\r\n{code}\r\n\r\nh3. Outcome\r\n\r\nBoth file resources from from the {{Step1}} and {{Step2}} classes are applied:\r\n\r\n{noformat}\r\n# puppet --version\r\n3.8.0\r\n# puppet apply tag_test.pp --tags test::step1\r\n\r\nNotice: Compiled catalog for poss-head-centos.puppetdebug.vlan in environment production in 0.37 seconds\r\nNotice: Finished catalog run in 0.01 seconds\r\n[root@poss-head-centos ZEN-11318]# rm -f /tmp/test*\r\n[root@poss-head-centos ZEN-11318]# puppet apply tag_test.pp --tags test::step1\r\nNotice: Compiled catalog for poss-head-centos.puppetdebug.vlan in environment production in 0.41 seconds\r\nNotice: /Stage[main]/Test::Step2/File[/tmp/test2.txt]/ensure: created\r\nNotice: /Stage[main]/Test::Step1/File[/tmp/test1.txt]/ensure: created\r\nNotice: Finished catalog run in 0.02 seconds\r\n{noformat}\r\n\r\nh3. Expected Outcome\r\n\r\nOnly file resources from the {{Step1}} class are applied. This was the behavior prior to Puppet 3.5:\r\n\r\n{noformat}\r\n# puppet --version\r\n3.4.3\r\n# puppet apply tag_test.pp --tags test::step1\r\n\r\nNotice: Compiled catalog for poss-head-centos.puppetdebug.vlan in environment production in 0.38 seconds\r\nNotice: /Stage[main]/Test::Step1/File[/tmp/test1.txt]/ensure: created\r\nNotice: Finished catalog run in 0.20 seconds\r\n{noformat}\r\n","closed_at":"2017-11-29T10:24:24.000-0800","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4495","labels":"customer;support","state":"Closed","updated_at":"2017-11-29T10:24:24.000-0800","timestamp":1652285505.341393,"priority":"Normal","status_category":"Done","pull_request":4286},{"issue_id":"216304","title":"Ruby Rational data type matches Numeric when it should not","url":"https://tickets.puppetlabs.com/browse/PUP-8057","created_at":"2017-10-16T06:52:48.000-0700","number":"PUP-8057","body":"The {{Numeric}} type returns {{true}} for a ruby {{Rational}} value when it should return {{false}}. This is probably because it blindly accepts subtypes of ruby numeric.","closed_at":"2017-12-01T10:18:25.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8057","labels":"","state":"Resolved","updated_at":"2017-12-01T10:18:25.000-0800","timestamp":1652285505.957809,"priority":"Normal","status_category":"Done","pull_request":6313},{"issue_id":"187953","title":"unable to have puppet master listen on both IPv4 and IPv6","url":"https://tickets.puppetlabs.com/browse/PUP-7472","created_at":"2017-04-26T08:36:25.000-0700","number":"PUP-7472","body":"I'd like have Puppet being dual-stacked, so I did set {{bindaddress = ::}} in my {{puppet.conf}}, as suggested in \"Learning Puppet 4: A Guide to Configuration Management and Automation\"/ \"IPv6 Dual-Stack Puppet Master\" (Page 309 in Google Books), also described [here|https://projects.puppetlabs.com/issues/6370].\r\n\r\nThis should make the puppet master listen on both IPv4 and IPv6.\r\n\r\nWhen running the puppet master, {{netstat -anl|grep 8140}} shows the following:\r\n{{tcp6       0      0 :::8140                 :::*                    LISTEN}}\r\n\r\nI can connect via IPv6:\r\ncurl -k 'https://[::]:8140/puppet/v3/'\r\n{\"message\":\"Bad Request: The indirection name must be purely alphanumeric, not ''\",\"issue_kind\":\"RUNTIME_ERROR\"}\r\n\r\nBut connecting via IPv4 fails:\r\ncurl -k 'https://127.0.0.1:8140/puppet/v3/' \r\ncurl: (7) Failed to connect to 127.0.0.1 port 8140: Connection refused\r\n\r\nSo the socket does not seem to be listening under IPv4, contrary to the docs.\r\n\r\nAdditionally, it's not possible to bind to two different addresses (:: and 0.0.0.0), so it currently simply isn't possible to start puppet listening both on IPv4 and Ipv6.","closed_at":"2017-12-11T06:17:59.000-0800","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7472","labels":"","state":"Closed","updated_at":"2017-12-11T06:17:59.000-0800","timestamp":1652285506.503875,"priority":"Major","status_category":"Done","pull_request":6123},{"issue_id":"187405","title":"Warning when trying to JSON-serialise undef value (\"hash will be converted to string\")","url":"https://tickets.puppetlabs.com/browse/PUP-7464","created_at":"2017-04-23T09:07:48.000-0700","number":"PUP-7464","body":"A warning message like the following appears in Puppetserver's logs (line breaks added for readability):\r\n\r\n{code}\r\n2017-04-23 16:12:15,935 WARN  [qtp2095795815-27357] [puppetserver] Puppet Resource 'Icinga2::Object::Host[dns01.prod.example.com]'\r\ncontains a Hash value. It will be converted to the String \r\n'{\"distro\"=>\"Ubuntu\", \"is_virtual\"=>true, \"manufacturer\"=>\"QEMU\", \"os\"=>\"Linux\", \r\n\"parent\"=>:undef, \"project\"=>\"dns\", \"fqdn\"=>\"dns01.prod.example.com\", \"service\"=>\"dns-cluster\",\r\n\"stage\"=>\"prod\", \"virtual\"=>\"kvm\",\r\n\"notification\"=>{\"mail\"=>{\"groups\"=>[\"admins\"]}, \"sms\"=>{\"groups\"=>[\"admins\"]}}}'\r\n{code}\r\n\r\nThe resource in question looks like this:\r\n\r\n{code}\r\n...\r\nif getvar('::virtualisation_host') {\r\n  $_parent = $::virtualisation_host\r\n} else {\r\n  $_parent = undef\r\n}\r\n...\r\n@@icinga2::object::host { $::fqdn:\r\n  import       => $_import,\r\n  display_name => $::fqdn,\r\n  address      => $::fqdn,\r\n  target       => '/etc/icinga2/objects/hosts.conf',\r\n  tag          => $::stage,\r\n  vars         => {\r\n    applications => $_applications,\r\n    distro       => $::operatingsystem,\r\n    fqdn         => $::fqdn,\r\n    is_virtual   => $::is_virtual,\r\n    manufacturer => $::manufacturer,\r\n    os           => $::kernel,\r\n    parent       => $_parent,\r\n    project      => $::project,\r\n    service      => $_service,\r\n    stage        => $::stage,\r\n    virtual      => $::virtual,\r\n    notification => {\r\n      mail => {\r\n        groups => $mail_groups,\r\n      },\r\n      sms  => {\r\n        groups => $sms_groups,\r\n      },\r\n    },\r\n  },\r\n}\r\n{code}\r\n\r\nIn this case {{$_parent}} (and therefore the {{parent}} value in the {{vars}} hash) is set to {{undef}} explicitly. This seems to trip up something in Puppet related to JSON-serialisation.\r\n\r\nI'll update this ticket with some reproducible code in the coming days.","closed_at":"2017-12-12T07:01:38.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7464","labels":"resolved-issue-added","state":"Closed","updated_at":"2017-12-12T07:01:38.000-0800","timestamp":1652285506.949062,"priority":"Normal","status_category":"Done","pull_request":5841},{"issue_id":"214744","title":"Concatenated strings causing breakages with Japanese","url":"https://tickets.puppetlabs.com/browse/PUP-8029","created_at":"2017-10-05T11:22:41.000-0700","number":"PUP-8029","body":"There are some concatenated strings in Puppet that are resulting in mistranslations because the translator doesn't have the full context of what the complete sentence is supposed to be, and cannot change the sentence order,\r\n\r\nExample:\r\nhttps://github.com/puppetlabs/puppet/blob/master/lib/puppet/indirector/catalog/compiler.rb#L273-L276\r\nhttps://github.com/puppetlabs/puppet/blob/master/lib/puppet/indirector/catalog/compiler.rb#L291-L292\r\n\r\nThese might be the only two occurrences [~eric.delaney]","closed_at":"2017-12-14T10:09:59.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8029","labels":"i18n","state":"Closed","updated_at":"2017-12-14T10:09:59.000-0800","timestamp":1652285507.829181,"priority":"Normal","status_category":"Done","pull_request":6337},{"issue_id":"63365","title":"Use of cfacter on Windows causes error","url":"https://tickets.puppetlabs.com/browse/PUP-3821","created_at":"2015-01-08T15:44:46.000-0800","number":"PUP-3821","body":"Using puppet's --cfacter option on Windows results in {{Error: Could not initialize global default settings: facter has already evaluated facts.}}\r\n\r\nAn example is \r\n\r\n{code}\r\npuppet apply --cfacter -e 'notify { \"a\": message => \"$facterversion\" }'\r\n{code}\r\n\r\n[~peter.huene] suggested trying \"if your winver > 6, you could try commenting out the version check logic in admin? in lib/puppet/util/windows/user.rb to see if my guess is correct that Puppet.features.root? uses facts on Windows but not POSIX\"","closed_at":"2018-01-08T10:24:11.000-0800","comments":20,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3821","labels":"","state":"Closed","updated_at":"2018-01-08T10:24:11.000-0800","timestamp":1652285508.7756,"priority":"Normal","status_category":"Done","pull_request":3579},{"issue_id":"215525","title":"Puppet 4.10.x: Only warn once when gettext cannot be found","url":"https://tickets.puppetlabs.com/browse/PUP-8039","created_at":"2017-10-09T16:53:49.000-0700","number":"PUP-8039","body":"Currently in Puppet >4.10.5, if the gettext-setup gem cannot be found we will issue a warning for every single module that is loaded, each time that module is loaded. This causes a huge amount of log spam in environments that load a lot of modules, all with nearly the same message:\r\n{{2017-09-26 00:05:19,103 WARN  [qtp1394837016-64] [puppetserver] Puppet GettextSetup is not available, skipping GettextSetup initialization for <module_name>.}}\r\n\r\nWe should only issue this warning once.","closed_at":"2018-01-11T13:27:23.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8039","labels":"","state":"Closed","updated_at":"2018-01-11T13:27:23.000-0800","timestamp":1652285509.423733,"priority":"Normal","status_category":"Done","pull_request":6272},{"issue_id":"204150","title":"AIX provider prefetch will fail if any package does not have a source","url":"https://tickets.puppetlabs.com/browse/PUP-7818","created_at":"2017-08-04T11:51:14.000-0700","number":"PUP-7818","body":"Prefetching in AIX assumes that all packages have a valid {{source}} attribute. This is not always the case, as {{ensure => absent}} does not require such a source. Thus the following manifest will cause prefetch to fail:\r\n\r\n{noformat}\r\npackage { 'sudo.rte':\r\n    ensure => latest,\r\n    source => \"/mnt/my-packages\"\r\n}\r\n\r\npackage { 'curl.rte':\r\n    ensure => absent,\r\n}\r\n{noformat}\r\n\r\n","closed_at":"2018-01-19T15:51:40.000-0800","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7818","labels":"","state":"Closed","updated_at":"2018-01-19T15:51:40.000-0800","timestamp":1652285510.554879,"priority":"Normal","status_category":"Done","pull_request":6181},{"issue_id":"193629","title":"Lookup unique merge doesn't deduplicate with a single layer","url":"https://tickets.puppetlabs.com/browse/PUP-7608","created_at":"2017-05-30T22:28:38.000-0700","number":"PUP-7608","body":"The {{lookup}} function with a unique merge doesn't seem to deduplicate when there is only one layer of Hiera that the key appears in.\r\n\r\nFor example, when I run this:\r\n{noformat}\r\npuppet lookup people::tags --merge unique\r\n---\r\n- syseng\r\n- syseng-identity_dev\r\n- identity\r\n- identity-dev\r\n- identity\r\n- identity-identity_dev\r\n{noformat}\r\n\r\nIf I add the key with {{identity}} to another layer I get\r\n{noformat}\r\n---\r\n- identity\r\n- syseng\r\n- syseng-identity_dev\r\n- identity-dev\r\n- identity-identity_dev\r\n{noformat}","closed_at":"2018-01-23T15:52:23.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7608","labels":"resolved-issue-added","state":"Closed","updated_at":"2018-01-23T15:52:23.000-0800","timestamp":1652285510.980762,"priority":"Normal","status_category":"Done","pull_request":6368},{"issue_id":"165475","title":"resource references to aliased resources does not always work","url":"https://tickets.puppetlabs.com/browse/PUP-6984","created_at":"2016-12-07T10:24:10.000-0800","number":"PUP-6984","body":"An alias on (at least) package and exec resources that worked fine to resolve a dependency at least in Puppet 3.4 doesn't work anymore in Puppet 4.8.0.\r\nI would expect that the manifest below would not create the Warning it gives. \r\n(I'm surprised by a warning that the dependency isn't found, but then getting a \"dependency failed\" on just that resource, though referenced by the title, not the alias, which in turn is OK)\r\n\r\nAlmost minimal reproduction case:\r\n\r\n{noformat}\r\n$ cat /tmp/t.pp; sudo puppet apply --detailed-exitcodes /tmp/t.pp; echo $?\r\n# $Id$\r\npackage{'postfix':\r\n  alias  => 'mta',\r\n  ensure => latest,\r\n}\r\n\r\nexec{'/bin/false':\r\n  alias => 'something',\r\n}\r\n\r\nnotify{'Depended on mta':\r\n  require => [Exec['something'], Package['mta']],\r\n}\r\n{noformat}\r\n\r\n{noformat}\r\nWarning: Could not find resource 'Exec[something]' in parameter 'require'\r\n   (at /tmp/t.pp:12)\r\nWarning: Could not find resource 'Package[mta]' in parameter 'require'\r\n   (at /tmp/t.pp:12)\r\nNotice: Compiled catalog for 90cdc197-bd0d-4ee2-8e22-cf4962548eb1 in environment standalone_puppet in 0.49 seconds\r\nError: /bin/false returned 1 instead of one of [0]\r\nError: /Stage[main]/Main/Exec[/bin/false]/returns: change from notrun to 0 failed: /bin/false returned 1 instead of one of [0]\r\nNotice: /Stage[main]/Main/Notify[Depended on mta]: Dependency Exec[/bin/false] has failures: true\r\nWarning: /Stage[main]/Main/Notify[Depended on mta]: Skipping because of failed dependencies\r\nNotice: Applied catalog in 0.62 seconds\r\n{noformat}\r\n","closed_at":"2018-02-05T11:22:50.000-0800","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6984","labels":"resolved-issue-added","state":"Closed","updated_at":"2018-02-05T11:22:50.000-0800","timestamp":1652285512.137663,"priority":"Normal","status_category":"Done","pull_request":5760},{"issue_id":"222322","title":"Lookup unique merge doesn't deduplicate with a single layer - backport PUP 7608 to 4.10.z","url":"https://tickets.puppetlabs.com/browse/PUP-8182","created_at":"2017-11-15T18:37:10.000-0800","number":"PUP-8182","body":"Ticket PUP-7608 was created against Puppet 5.0.  This same issue also affects Puppet 4, and is a behavioral change from earlier Puppet 4 versions.\r\n\r\nGiven a single hiera file containing\r\n{noformat}\r\n---\r\nfoo:\r\n  - this is a test\r\n  - this is another test\r\n  - this is a test\r\n{noformat}\r\n\r\nIn Puppet 4.2.3, {{hiera_array(\"foo\")}} will return a two-element array:\r\n{noformat}\r\n$ puppet apply -t --noop -e '$foo = hiera_array(\"foo\"); notice(\"${::clientversion}: ${foo}\")'\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nNotice: Scope(Class[main]): 4.2.3: [this is a test, this is another test]\r\nNotice: Compiled catalog for foo.example.com in environment production in 0.32 seconds\r\nInfo: Applying configuration version '1510798433'\r\nNotice: Applied catalog in 0.02 seconds\r\n{noformat}\r\nHowever, in Puppet 4.10.8, it returns all three elements, including the duplicated element:\r\n{noformat}\r\n$ puppet apply --strict=off -t --noop -e '$foo = hiera_array(\"foo\"); notice(\"${::clientversion}: ${foo}\")'\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nNotice: Scope(Class[main]): 4.10.8: [this is a test, this is another test, this is a test]\r\nNotice: Compiled catalog for foo.example.com in environment production in 0.13 seconds\r\nInfo: Applying configuration version '1510798413'\r\nNotice: Applied catalog in 0.04 seconds\r\n{noformat}","closed_at":"2018-02-05T12:47:47.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8182","labels":"","state":"Closed","updated_at":"2018-02-05T12:47:47.000-0800","timestamp":1652285512.459613,"priority":"Normal","status_category":"Done","pull_request":6368},{"issue_id":"107262","title":"sprintf fails when using named format parameters","url":"https://tickets.puppetlabs.com/browse/PUP-5556","created_at":"2015-11-27T06:45:36.000-0800","number":"PUP-5556","body":"Puppet's documentation indicates that *sprintf * is using the same capabilities as ruby's one.\r\n\r\nBut when I use in puppet the following call:\r\n{code:puppet}\r\nsprintf(\"-o %{logdir}/stdout\", { logdir => '/var/log/'})\r\n{code}\r\nI end up with the following message:\r\n{code}\r\nError: Evaluation Error: Error while evaluating a Function Call, key{logdir} not found at /...\r\n{code}","closed_at":"2018-02-05T12:47:49.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5556","labels":"","state":"Closed","updated_at":"2018-02-05T12:47:49.000-0800","timestamp":1652285512.670373,"priority":"Normal","status_category":"Done","pull_request":6377},{"issue_id":"224656","title":"Hiera 5 \"uris\" hierarchy parameter inappropriately type-checked","url":"https://tickets.puppetlabs.com/browse/PUP-8216","created_at":"2017-11-29T10:53:24.000-0800","number":"PUP-8216","body":"The documentation for configuring a Hiera 5 hierarchy level can be found [here|https://puppet.com/docs/puppet/5.2/hiera_config_yaml_5.html#configuring-a-hierarchy-level-general-format]. In these docs, the {{uris}} key is described as appropriate for _\"\\[...\\] any kind of data source. Hiera doesn’t ensure URIs are resolvable before calling the backend, and doesn’t need to understand any given URI schema.\"_\r\n\r\nHowever, in implementation the {{uris}} key is not implemented this way, and seems to require that values match a preconception of what a URI is.\r\n\r\n{code}\r\n---\r\nversion: 5\r\n\r\ndefaults:\r\n  datadir: \"data\"\r\n\r\nhierarchy:\r\n  - name: 'Consul backend'\r\n    lookup_key: consul_lookup_key\r\n    uris:\r\n      - \"/v1/kv/configuration/%{fqdn}\"\r\n      - \"/v1/kv/configuration/common\"\r\n{code}\r\n\r\n{code}\r\n[cloud-user@master-of-puppets-aws-1 work]$ puppet lookup --hiera_config=hiera.yaml --modulepath=modules test --explain\r\nError: Could not run: Lookup of key 'lookup_options' failed: The Lookup Configuration at '/home/cloud-user/work/hiera.yaml' has wrong type, entry 'hierarchy' index 0 entry 'uri' exp\r\nects a match for Pcore::URI = Pattern[/(?x-mi:\r\n        ([a-zA-Z][\\-+.a-zA-Z\\d]*):                           (?# 1: scheme)\r\n        (?:\r\n           ((?:[\\-_.!~*'()a-zA-Z\\d;?:@&=+$,]|%[a-fA-F\\d]{2})(?:[\\-_.!~*'()a-zA-Z\\d;\\/?:@&=+$,\\[\\]]|%[a-fA-F\\d]{2})*)                    (?# 2: opaque)\r\n        |\r\n           (?:(?:\r\n             \\/\\/(?:\r\n                 (?:(?:((?:[\\-_.!~*'()a-zA-Z\\d;:&=+$,]|%[a-fA-F\\d]{2})*)@)?        (?# 3: userinfo)\r\n                   (?:((?:(?:[a-zA-Z0-9\\-.]|%\\h\\h)+|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}|\\[(?:(?:[a-fA-F\\d]{1,4}:)*(?:[a-fA-F\\d]{1,4}|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})|(?:(?:[a-fA-F\\d]{1,4}:)*[a-fA-F\\d]{1,4})?::(?:(?:[a-fA-F\\d]{1,4}:)*(?:[a-fA-F\\d]{1,4}|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}))?)\\]))(?::(\\d*))?))? (?# 4: host, 5: port)\r\n               |\r\n                 ((?:[\\-_.!~*'()a-zA-Z\\d$,;:@&=+]|%[a-fA-F\\d]{2})+)                 (?# 6: registry)\r\n               )\r\n             |\r\n             (?!\\/\\/))                           (?# XXX: '\\/\\/' is the mark for hostport)\r\n             (\\/(?:[\\-_.!~*'()a-zA-Z\\d:@&=+$,]|%[a-fA-F\\d]{2})*(?:;(?:[\\-_.!~*'()a-zA-Z\\d:@&=+$,]|%[a-fA-F\\d]{2})*)*(?:\\/(?:[\\-_.!~*'()a-zA-Z\\d:@&=+$,]|%[a-fA-F\\d]{2})*(?:;(?:[\\-_.!~*'()a-zA-Z\\d:@&=+$,]|%[a-fA-F\\d]{2})*)*)*)?                    (?# 7: path)\r\n           )(?:\\?((?:[\\-_.!~*'()a-zA-Z\\d;\\/?:@&=+$,\\[\\]]|%[a-fA-F\\d]{2})*))?                 (?# 8: query)\r\n        )\r\n        (?:\\#((?:[\\-_.!~*'()a-zA-Z\\d;\\/?:@&=+$,\\[\\]]|%[a-fA-F\\d]{2})*))?                  (?# 9: fragment)\r\n      )/], got '/v1/kv/configuration/common'\r\n{code}\r\n\r\nAs a custom backend author, I read the documentation for {{uris}} as a standardized key that I can use to specify \"levels\" for my backend, where the format and validation of strings representing levels is left to me. However, the implementation prevents this.\r\n\r\nThere should be a standard key that can be used to describe levels, for which format and validation of entries is left to the backend. If {{uris}} is already this key, the undocumented type checking is a bug that needs to be removed before it can be effectively used. ","closed_at":"2018-02-05T12:47:50.000-0800","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8216","labels":"","state":"Closed","updated_at":"2018-02-05T12:47:50.000-0800","timestamp":1652285512.779158,"priority":"Normal","status_category":"Done","pull_request":6407},{"issue_id":"69910","title":"errors/warnings in environment.conf should not be duplicated","url":"https://tickets.puppetlabs.com/browse/PUP-4065","created_at":"2015-03-02T15:47:22.000-0800","number":"PUP-4065","body":"warnings in an environment.conf can produce three or more repeated messages:\r\non master (4x) with parser as a setting in production's environment.conf\r\n{code}\r\n[root@fe3bsczu8tto8hg puppet]# puppet apply -e 'notify{\"yep\":}'\r\nWarning: Invalid settings in environment.conf at '/etc/puppetlabs/code/environments/production/environment.conf'. The following unknown setting(s) are being ignored: parser\r\nWarning: Invalid settings in environment.conf at '/etc/puppetlabs/code/environments/production/environment.conf'. The following unknown setting(s) are being ignored: parser\r\nWarning: Invalid settings in environment.conf at '/etc/puppetlabs/code/environments/production/environment.conf'. The following unknown setting(s) are being ignored: parser\r\n{code}","closed_at":"2018-02-05T12:47:50.000-0800","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4065","labels":"beginner;this_issue_is_bad_and_you_should_feel_bad","state":"Closed","updated_at":"2018-02-05T12:47:50.000-0800","timestamp":1652285512.890957,"priority":"Normal","status_category":"Done","pull_request":6397},{"issue_id":"219989","title":"Remove incorrect deprecation warning for `audit` metaparam","url":"https://tickets.puppetlabs.com/browse/PUP-8113","created_at":"2017-11-01T15:38:05.000-0700","number":"PUP-8113","body":"When we decided not to remove the audit metaparameter, we forgot to remove the corresponding deprecation warning stating the metaparam would be removed. We should get rid of the deprecation warning.\r\n\r\nFor details on the audit metaparameter can be found here: https://puppet.com/docs/puppet/5.3/metaparameter.html#audit (and there also appears to be a stray deprecation warning in the docs for it that should also be removed).\r\n\r\nThis should be merged first to the 4.10.x stream and then merged up.","closed_at":"2018-02-05T12:47:51.000-0800","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8113","labels":"","state":"Closed","updated_at":"2018-02-05T12:47:51.000-0800","timestamp":1652285513.102083,"priority":"Normal","status_category":"Done","pull_request":6361},{"issue_id":"182889","title":"Aliased types are not indistinguishable from the original type","url":"https://tickets.puppetlabs.com/browse/PUP-7401","created_at":"2017-03-28T05:58:24.000-0700","number":"PUP-7401","body":"I stumbled across a behavior relating to aliased data types which seems inconsistent with the documentation / specification. Per https://github.com/puppetlabs/puppet-specifications/blob/master/language/types_values_variables.md#type-aliases \"An aliased type is indistinguishable from the original type.\" I believe I have found at least one instance where that is not so.\r\n\r\nExample 1:\r\n{code:title=enum.pp}\r\n$a = Enum['a','b']\r\n$a.each |$x| { notice($x) }\r\n{code}\r\n\r\n{noformat}\r\n$ puppet apply enum.pp \r\nNotice: Scope(Class[main]): a\r\nNotice: Scope(Class[main]): b\r\nNotice: Compiled catalog for localhost.localdomain in environment production in 0.02 seconds\r\nNotice: Applied catalog in 0.09 seconds\r\n{noformat}\r\n\r\nExample 2 (with aliased type):\r\n{code:title=custom.pp}\r\ntype Custom = Enum['a','b']\r\n$a = Custom\r\n$a.each |$x| { notice($x) }\r\n{code}\r\n\r\n{noformat}\r\n$ puppet apply custom.pp \r\nError: Evaluation Error: Error while evaluating a Method call, 'each' expects one of:\r\n  (Hash[Any, Any] hash, Callable[2, 2] block)\r\n    rejected: parameter 'hash' expects a Hash value, got Type\r\n  (Hash[Any, Any] hash, Callable[1, 1] block)\r\n    rejected: parameter 'hash' expects a Hash value, got Type\r\n  (Iterable enumerable, Callable[2, 2] block)\r\n    rejected: parameter 'enumerable' expects an Iterable value, got Type\r\n  (Iterable enumerable, Callable[1, 1] block)\r\n    rejected: parameter 'enumerable' expects an Iterable value, got Type at custom.pp:4:3 on node localhost.localdomain\r\n{noformat}\r\n\r\nI would have expected that the Iterable behavior would have transitioned with the custom type.\r\n\r\nI have seen this behavior on 4.7.0 as well as a current master branch (4.9.4-488-gcef0271).\r\n\r\nThank you.","closed_at":"2018-02-05T12:47:52.000-0800","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7401","labels":"","state":"Closed","updated_at":"2018-02-05T12:47:52.000-0800","timestamp":1652285513.31377,"priority":"Normal","status_category":"Done","pull_request":6357},{"issue_id":"119008","title":"Documentation for logdest is confusing ","url":"https://tickets.puppetlabs.com/browse/PUP-5987","created_at":"2016-02-28T12:11:09.000-0800","number":"PUP-5987","body":"The logdest option is described as such in puppet apply :\r\n[-l|--logdest syslog|eventlog|<FILE>|console] [--noop]\r\n\r\nBut it would more accurately be described as: \r\n[-l|--logdest syslog|eventlog|<ABS FILEPATH>|console] [--noop]\r\n\r\nThe logdest does not accept a file, only an absolute path, which is misleading.\r\n","closed_at":"2018-02-05T12:47:53.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5987","labels":"beginner;the-goods","state":"Closed","updated_at":"2018-02-05T12:47:53.000-0800","timestamp":1652285513.422411,"priority":"Normal","status_category":"Done","pull_request":6345},{"issue_id":"221245","title":"NoMethodErrors involving Puppet::Face instances do not have a useful error message","url":"https://tickets.puppetlabs.com/browse/PUP-8140","created_at":"2017-11-09T10:18:45.000-0800","number":"PUP-8140","body":"The Puppet::Face class does not define a useful text representation for use in some error messages --- I.E. {{NoMethodError}}. This makes errors involving missing methods on Puppet Faces especially difficult to track down. Puppet Faces allow multiple versions, so these errors are easy to create by third-party modules defining a new Face version that other Puppet components don't expect.\r\n\r\nh2. Reproduction Case.\r\n\r\n  - Install the latest puppet-agent 4.10.x on CentOS 7:\r\n\r\n{code:bash}\r\nrpm -Uvh http://yum.puppetlabs.com/puppetlabs-release-pc1-el-7.noarch.rpm\r\nyum install -y puppet-agent\r\n{code}\r\n\r\n  - Create a module containing a Puppet Face that can fail due to multiple versions:\r\n\r\n{code:bash}\r\nmkdir -p /etc/puppetlabs/code/environments/production/modules/test_face/lib/puppet/application\r\ncat <<EOF > /etc/puppetlabs/code/environments/production/modules/test_face/lib/puppet/application/foo.rb\r\nrequire 'puppet/application/face_base'\r\n\r\nclass Puppet::Application::Foo < Puppet::Application::FaceBase\r\nend\r\nEOF\r\n\r\nmkdir -p /etc/puppetlabs/code/environments/production/modules/test_face/lib/puppet/face\r\ncat <<EOF > /etc/puppetlabs/code/environments/production/modules/test_face/lib/puppet/face/foo.rb\r\nPuppet::Face.define(:foo, '0.0.1') do\r\n  action :bar do\r\n    when_invoked do |*args|\r\n      puts \"Bar action called!\"\r\n    end\r\n  end\r\n\r\n  action :baz do\r\n    when_invoked do |*args|\r\n      puts \"Baz action called!\"\r\n      Puppet::Face[:foo, :current].bar\r\n    end\r\n  end\r\nend\r\n\r\nPuppet::Face.define(:foo, '0.0.2') do\r\n  action :bim do\r\n    when_invoked do |*args|\r\n      puts \"Bim action called!\"\r\n    end\r\n  end\r\nend\r\nEOF\r\n{code}\r\n\r\n  - Run the face to generate a failure: {{/opt/puppetlabs/puppet/bin/puppet foo baz}}\r\n\r\nh3. Outcome\r\n\r\nThe error message indicates no {{baz}} method is avaiailble, but provides no clue that Face versions are coming into play:\r\n\r\n{noformat}\r\n# /opt/puppetlabs/puppet/bin/puppet foo baz\r\nBaz action called!\r\nError: undefined method `bar' for #<Puppet::Interface:0x00000004668948>\r\nError: Try 'puppet help foo baz' for usage\r\n{noformat}\r\n\r\nh3. Expected Outcome\r\n\r\nThe error message should include the face name and version number, as provided by the {{to_s}} method of the Puppet::Interface class:\r\n\r\n{noformat}\r\n# /opt/puppetlabs/puppet/bin/puppet foo baz\r\nBaz action called!\r\nError: undefined method `bar' for Puppet::Face[:foo, v0.0.2]:Puppet::Interface\r\nError: Try 'puppet help foo baz' for usage\r\n{noformat}","closed_at":"2018-02-05T12:47:54.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8140","labels":"cs_pr_review","state":"Closed","updated_at":"2018-02-05T12:47:54.000-0800","timestamp":1652285513.63433,"priority":"Normal","status_category":"Done","pull_request":6350},{"issue_id":"219738","title":"puppet device cannot create certs when run as root (4.10.x backport)","url":"https://tickets.puppetlabs.com/browse/PUP-8108","created_at":"2017-10-31T10:46:01.000-0700","number":"PUP-8108","body":"Back port fix from 5.4.0 to 4.10.x\r\n\r\n\r\nbroken -- output of `puppet device --debug` when ran as root:\r\n{noformat}\r\ninfo: Creating a new SSL key for 10.0.1.3\r\nerr: Could not request certificate: Could not write /var/opt/lib/pe-puppet/devices/10.0.1.3/ssl/private_keys/10.0.1.3.pem to privatekeydir: Permission denied - /var/opt/lib/pe-puppet/devices/10.0.1.3/ssl/private_keys/10.0.1.3.pem\r\n{noformat}\r\n\r\nsuccess -- output of `puppet device --debug` when ran as a normal user:\r\n{noformat}\r\nwarning: peer certificate won't be verified in this SSL session\r\ninfo: Caching certificate for ca\r\nwarning: peer certificate won't be verified in this SSL session\r\nwarning: peer certificate won't be verified in this SSL session\r\ninfo: Creating a new SSL certificate request for 10.0.1.3\r\ninfo: Certificate Request fingerprint (md5): 6C:1C:4C:37:A7:1D:B3:6E:F3:94:25:67:55:27:89:4C\r\nwarning: peer certificate won't be verified in this SSL session\r\ndebug: Using cached certificate for ca\r\nwarning: peer certificate won't be verified in this SSL session\r\ninfo: Caching certificate for 10.0.1.3\r\n{noformat}\r\n\r\nNote, that you have to copy `/etc/puppetlabs/puppet/device.conf` to `~/.puppet/`","closed_at":"2018-02-05T12:47:54.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8108","labels":"redmine","state":"Closed","updated_at":"2018-02-05T12:47:54.000-0800","timestamp":1652285513.738852,"priority":"Normal","status_category":"Done","pull_request":6327},{"issue_id":"221872","title":"Older server version errors when an agent tries to download from the locales mountpoint","url":"https://tickets.puppetlabs.com/browse/PUP-8177","created_at":"2017-11-13T16:12:23.000-0800","number":"PUP-8177","body":"As part of supporting module translations, we added a default mountpoint to Puppet for serving module translation files. However, this mountpoint will not be available on older versions of Puppetserver, so when an agent tries to query it, Puppetserver throws an error:\r\n{code}\r\nError: /File[/Users/josh/.puppetlabs/opt/puppet/cache/locales]: Failed to generate additional resources using 'eval_generate': Error 500 on SERVER: Server Error: Not authorized to call search on /file_metadata/locales with {:rest=>\"locales\", :links=>\"follow\", :recurse=>true, :source_permissions=>\"ignore\", :ignore=>[\".svn\", \"CVS\", \".git\", \".hg\", \"*.pot\", \"config.yaml\"], :checksum_type=>\"sha256\"}\r\n{code}\r\n\r\nWe need to handle this gracefully, since it is not really an error (it just means module translations won't be available agent-side). We cannot simply catch the exception, since at the [downloader level|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/configurer/plugin_handler.rb] the error has already been caught and logged as part of the [HTTP handler|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/indirector/rest.rb#L309]. So ideally we should prevent the query from being made in the first place, dependent on the version of Puppetserver being queried.\r\n\r\nThe server version is currently not available [beyond the HTTP layer|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/indirector/rest.rb#L264]. Two options to explore for making it available include:\r\n1) adding something to Puppet's [context object|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/context.rb]\r\n2) creating a setting to skip downloading locale files\r\n\r\nThe context gives us a lifecycle for the data and tight control over it (no user can enable translation downloading by accident). However, a setting would give us the option to support people turning off translation downloads if they should prove problematic in certain use cases.","closed_at":"2018-02-05T14:18:24.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8177","labels":"i18n","state":"Closed","updated_at":"2018-02-05T14:18:24.000-0800","timestamp":1652285514.263461,"priority":"Normal","status_category":"Done","pull_request":6444},{"issue_id":"220820","title":"Refactor error location strings to not use words for better I18n support","url":"https://tickets.puppetlabs.com/browse/PUP-8127","created_at":"2017-11-07T08:29:49.000-0800","number":"PUP-8127","body":"For better translations we should look at how we add the location information to an error in 'ExternalFileError'. Instead of using words like 'at', 'at line', and 'in' we should change to something like '(file:line:pos)'. Then we have no words to translate while still providing the location information.\r\n\r\nI think replacing the output with the below. Based on which variables are set the names on the left, would cause the output on the right:\r\n{code}\r\nfile line pos -> (file:line:pos)\r\nfile line -> (file:line)\r\nline pos -> (line:pos)\r\nline -> (line)\r\n{code}\r\n\r\nAn example with all location information set\r\n{code}\r\nError: Something went wrong (/Users/eric.delaney/work/my_repos/puppet/foo.pp:1:9)\r\nError: Something went wrong (/Users/eric.delaney/work/my_repos/puppet/foo.pp:1)\r\nError: Something went wrong (1:9)\r\nError: Something went wrong (1)\r\n{code}\r\n\r\nPlaces that need to be updated:\r\n./puppet/error.rb - ExternalFileError -> to_s\r\n./puppet/parser/resource.rb - def merge(resource)\r\n./puppet/pops/validation.rb - DiagnosticFormatterPuppetStyle\r\n./puppet/util/errors.rb - Puppet::Util::Errors -> def error_context\r\n./puppet/util/log.rb - Puppet::Util::Log -> to_s line 403\r\n\r\nSome of the code that needs to be updated:\r\n{code}\r\n  module ExternalFileError\r\n    # This module implements logging with a filename and line number. Use this\r\n    # for errors that need to report a location in a non-ruby file that we\r\n    # parse.\r\n    attr_accessor :line, :file, :pos\r\n\r\n    # May be called with 3 arguments for message, file, line, and exception, or\r\n    # 4 args including the position on the line.\r\n    #\r\n    def initialize(message, file=nil, line=nil, pos=nil, original=nil)\r\n      if pos.kind_of? Exception\r\n        original = pos\r\n        pos = nil\r\n      end\r\n      super(message, original)\r\n      @file = file unless (file.is_a?(String) && file.empty?)\r\n      @line = line\r\n      @pos = pos\r\n    end\r\n    def to_s\r\n      msg = super\r\n      @file = nil if (@file.is_a?(String) && @file.empty?)\r\n      if @file and @line and @pos\r\n        \"#{msg} at #{@file}:#{@line}:#{@pos}\"\r\n      elsif @file and @line\r\n        \"#{msg} at #{@file}:#{@line}\"\r\n      elsif @line and @pos\r\n          \"#{msg} at line #{@line}:#{@pos}\"\r\n      elsif @line\r\n        \"#{msg} at line #{@line}\"\r\n      elsif @file\r\n        \"#{msg} in #{@file}\"\r\n      else\r\n        msg\r\n      end\r\n    end\r\n  end\r\n{code}","closed_at":"2018-02-05T14:18:24.000-0800","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8127","labels":"","state":"Closed","updated_at":"2018-02-05T14:18:24.000-0800","timestamp":1652285514.371347,"priority":"Normal","status_category":"Done","pull_request":6481},{"issue_id":"221361","title":"Some Solaris Init services are not functional with Puppet 5","url":"https://tickets.puppetlabs.com/browse/PUP-8143","created_at":"2017-11-10T00:11:02.000-0800","number":"PUP-8143","body":"The service resource with the init provider in puppet 5.3.3 does not work for all services in Solaris. The service start is called, however the service is never started. This is a regression from 4.10.8. The following is always seen, however the script is never fully called and the service does not start. \r\n\r\n{code}\r\nDebug: Executing: '/etc/init.d/splunk status'\r\nDebug: Executing: '/usr/bin/ctrun -l none /etc/init.d/splunk start'\r\nNotice: /Stage[main]/Main/Service[splunk]/ensure: ensure changed 'stopped' to 'running'\r\n{code}\r\n\r\nCalling the init script manually will successfully start the service and produce an exit code of 0. \r\n\r\nInit based services on Solaris 10 use `ctrun` to create a new contract. It looks like the ctrun contract lifetime may be the issue as it is configured to immediately orphan the contract. When the contract is immediately orphaned and the service takes several seconds to start the service may be aborted. I am not sure why this behavior changed from 4.10.8 to 5.3.3 as the code is the same, so it may have to do with the new ruby version. \r\n\r\nI did some basic testing on this and found that if we switch the lifetime to {{child}} instead of {{none}} in the [init provider|https://github.com/puppetlabs/puppet/blob/5.3.3/lib/puppet/provider/service/init.rb#L174], the init script is successfully run and services is started in it's own contract. \r\n\r\n{code}\r\n[process contract 137]\r\n  3955  splunkd -p 8089 start\r\n    3956  splunkd -p 8089 start\r\n      3996  /opt/splunk/bin/splunkd instrument-resource-usage -p 8089\r\n      3997  /opt/splunk/bin/python -O /opt/splunk/lib/python2.7/site-packages/splunk/appser\r\n{code}\r\n\r\nSince we expect that the init script return, it would make sense to utilize the {{child}}, but I am uncertain of the overall impact of this change. From the man page:\r\n\r\n\r\n{noformat}\r\nchild\r\n   ctrun exits when the command exits, regardless of whether the contract is empty.\r\ncontract\r\n   ctrun exits only when the contract exits. This is the default.\r\nnone\r\n   ctrun exits immediately, orphaning the contract.\r\n{noformat}\r\n","closed_at":"2018-02-05T14:18:25.000-0800","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8143","labels":"","state":"Closed","updated_at":"2018-02-05T14:18:25.000-0800","timestamp":1652285514.792212,"priority":"Major","status_category":"Done","pull_request":6367},{"issue_id":"220408","title":"Class parameter scope is not used when resolving qualified names","url":"https://tickets.puppetlabs.com/browse/PUP-8124","created_at":"2017-11-03T10:27:02.000-0700","number":"PUP-8124","body":"Looking at https://puppet.com/docs/puppet/5.0/release_notes.html there was a language deprecation that was missed.\r\n\r\nIn Puppet 4, the following code works as expected and prints '{{does it work yes}}'\r\n\r\n{code}\r\nclass foo ( \r\n  $var1 = 'does it work',\r\n  $var2 = \"${foo::var1} yes\"\r\n) { \r\n  notice($var2)\r\n}\r\n\r\ninclude 'foo'\r\n{code}\r\n\r\nIn Puppet 5, the same code only prints ' {{yes}}'\r\n\r\nApparently, there was a change in the parser that means that local names can only be used when referencing earlier parameters.\r\n\r\nThe corrected code would be:\r\n\r\n{code}\r\nclass foo ( \r\n  $var1 = 'does it work',\r\n  $var2 = \"${var1} yes\"\r\n) { \r\n  notice($var2)\r\n}\r\n\r\ninclude 'foo'\r\n{code}\r\n\r\nCCing [~henrik.lindberg] for validation that this is not a regression instead of a documentation bug","closed_at":"2018-02-05T14:18:25.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8124","labels":"regression","state":"Closed","updated_at":"2018-02-05T14:18:25.000-0800","timestamp":1652285514.8966,"priority":"Normal","status_category":"Done","pull_request":6404},{"issue_id":"62834","title":"'puppet config print' should sort the output","url":"https://tickets.puppetlabs.com/browse/PUP-3807","created_at":"2015-01-04T22:54:52.000-0800","number":"PUP-3807","body":"It's pretty simple, and the output with all options is basically unreadable otherwise.","closed_at":"2018-02-05T14:18:26.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3807","labels":"puppethack;the-goods","state":"Closed","updated_at":"2018-02-05T14:18:26.000-0800","timestamp":1652285525.115305,"priority":"Normal","status_category":"Done","pull_request":6372},{"issue_id":"175481","title":"puppet type schedule: weekday parameters: should accept integers","url":"https://tickets.puppetlabs.com/browse/PUP-7221","created_at":"2017-02-15T17:09:19.000-0800","number":"PUP-7221","body":"See https://github.com/puppetlabs/puppet/blame/master/lib/puppet/type/schedule.rb#L373\r\n\r\nDocumentation says numbers may be used for day-of-week, but code clearly expects strings.\r\n","closed_at":"2018-02-05T14:18:27.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7221","labels":"","state":"Closed","updated_at":"2018-02-05T14:18:27.000-0800","timestamp":1652285525.221559,"priority":"Normal","status_category":"Done","pull_request":6402},{"issue_id":"231445","title":"Non-English windows puppet agent run fails with 'incompatible character encodings' when run against non-existent server","url":"https://tickets.puppetlabs.com/browse/PUP-8368","created_at":"2018-01-18T16:07:49.000-0800","number":"PUP-8368","body":"On a Windows Japanese box if you run 'puppet agent -t  --server no_such_host' the agent prints errors about incompatible encodings:\r\n\r\n{code}\r\n$ puppet.bat agent -t --server no_such_host\r\nWarning: ノード定義を取得できませんが、agent実行を続行します:\r\nWarning: Failed to open TCP connection to no_such_host:8140 (getaddrinfo: そのようなホストは不明です。 )\r\nInfo: pluginfactsを取得しています。\r\nWarning: detail.class: SocketError\r\nWarning: detail.to_s.encoding: ASCII-8BIT\r\nError: カタログ適用に失敗しました: incompatible character encodings: UTF-8 and ASCII-8BIT\r\nError: Puppet設定クライアントを実行できません: incompatible character encodings: UTF-8 and ASCII-8BIT\r\n{code}\r\n\r\n\r\nThe underlying issue appears to be when an error has be rescued, and as the error string is ASCII-8BIT and the formatting of the string blows up:\r\n\r\n{code}\r\n  def eval_generate(resource)\r\n    return false unless resource.respond_to?(:eval_generate)\r\n    raise Puppet::DevError, _(\"Depthfirst resources are not supported by eval_generate\") if resource.depthfirst?\r\n    begin\r\n      generated = replace_duplicates_with_catalog_resources(resource.eval_generate)\r\n      return false if generated.empty?\r\n    rescue => detail\r\n      @resources_failed_to_generate = true\r\n      #TRANSLATORS eval_generate is a method name and should be left untranslated\r\n      resource.log_exception(detail, _(\"Failed to generate additional resources using 'eval_generate': %{detail}\") % { detail: detail })\r\n{code}\r\n\r\nIf you print out the class and string encoding value:\r\n{code}\r\nWarning: detail.class: SocketError\r\nWarning: detail.to_s: Failed to open TCP connection to no_such_host:8140 (getaddrinfo: そのようなホストは不明です。 )\r\nWarning: detail.to_s.encoding: ASCII-8BIT\r\n{code}\r\n\r\nHere is the stack trace:\r\n{code}\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/gems/2.4.0/gems/fast_gettext-1.1.1/lib/fast_gettext/vendor/string.rb:70:in `%'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/gems/2.4.0/gems/fast_gettext-1.1.1/lib/fast_gettext/vendor/string.rb:70:in `%'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction/additional_resource_generator.rb:64:in `rescue in eval_generate'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction/additional_resource_generator.rb:55:in `eval_generate'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction.rb:112:in `block in evaluate'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:119:in `traverse'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction.rb:169:in `evaluate'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:231:in `block in apply'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/log.rb:160:in `with_destination'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction/report.rb:144:in `as_logging_destination'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:230:in `apply'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/configurer/downloader.rb:13:in `evaluate'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/configurer/plugin_handler.rb:19:in `download_plugins'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/configurer.rb:450:in `download_plugins'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/configurer.rb:118:in `get_facts'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/configurer.rb:312:in `run_internal'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/configurer.rb:225:in `block in run'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet.rb:260:in `override'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/configurer.rb:199:in `run'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/agent.rb:59:in `block (5 levels) in run'\r\n{code}","closed_at":"2018-02-05T14:18:27.000-0800","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8368","labels":"","state":"Closed","updated_at":"2018-02-05T14:18:27.000-0800","timestamp":1652285525.435567,"priority":"Normal","status_category":"Done","pull_request":6567},{"issue_id":"220333","title":"I18n strings that include repeated lists of sentence fragments can be hard to translate","url":"https://tickets.puppetlabs.com/browse/PUP-8122","created_at":"2017-11-02T16:08:55.000-0700","number":"PUP-8122","body":"We need to review the PO file and source code of puppet looking for strings where we build up a list of things where we include  sentence fragment in the repeated list and determine if this should be change to allow for better translations\r\n\r\nFor example the below code includes a sentence fragment \"which depends on\" which will be hard to translate into Japanese, We should create a list of cases, review them and determine which ones we want to change string in.\r\n\r\nlib/puppet/module_tool/errors/shared.rb\r\n\r\n{code}_(\"    which depends on '%{name}' (%{version})\") % { name: m[:name], version: v(m[:version]) }{code}\r\n{code}\r\n      dependency_list = @source[1..-1].map do |m|\r\n        #TRANSLATORS This message repeats as separate lines as a list under the heading \"You specified '%{name}' (%{version})\\n\"\r\n        _(\"    which depends on '%{name}' (%{version})\") % { name: m[:name], version: v(m[:version]) }\r\n      end.join(\",\\n\")\r\n\r\n      msg_variables = { requested_module: @requested_module, version: v(@requested_version), module_name: @module_name,\r\n                        name: @source.first[:name], dependency_list: dependency_list }\r\n      _(<<-EOM).chomp % msg_variables\r\nCould not install module '%{requested_module}' (%{version})\r\n  No version of '%{module_name}' will satisfy dependencies\r\n    You specified '%{name}' (%{version})\r\n%{dependency_list}\r\n    Use `puppet module install --force` to install this module anyway\r\n      EOM\r\n{code}\r\n\r\nWe should look to update the repeated list text to be (and remove the TRANSLATOR comment)\r\n{code}\r\n        _(\"    This depends on '%{name}' (%{version})\") % { name: m[:name], version: v(m[:version]) }\r\n{code}\r\n\r\n\r\n        ","closed_at":"2018-02-05T14:18:29.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8122","labels":"","state":"Closed","updated_at":"2018-02-05T14:18:29.000-0800","timestamp":1652285525.751051,"priority":"Normal","status_category":"Done","pull_request":6470},{"issue_id":"210745","title":"selmodversion_loaded lines variable broken","url":"https://tickets.puppetlabs.com/browse/PUP-7948","created_at":"2017-09-13T14:31:55.000-0700","number":"PUP-7948","body":"I was playing with rubocop when it complained about:\r\n\r\n{code}\r\n== lib/puppet/provider/selmodule/semodule.rb ==\r\nW:121: 13: Lint/EmptyExpression: Avoid empty expressions.\r\n{code}\r\n\r\nLooking at the code its complaining about the \"lines = ()\" assignment:\r\n\r\n{code}\r\n  def selmodversion_loaded\r\n    lines = ()\r\n    begin\r\n      execpipe(\"#{command(:semodule)} --list\") do |output|\r\n        output.each_line do |line|\r\n          line.chomp!\r\n          bits = line.split\r\n          if bits[0] == @resource[:name]\r\n            self.debug \"load version #{bits[1]}\"\r\n            return bits[1]\r\n          end\r\n        end\r\n      end\r\n    rescue Puppet::ExecutionFailure\r\n      raise Puppet::ExecutionFailure, \"Could not list policy modules: #{lines.join(' ').chomp!}\", $!.backtrace\r\n    end\r\n    nil\r\n  end\r\n{code}\r\n\r\nLooking at the code, lines will be assigned \"nil\" which doesn't have a .join method. So the exception will fail. We also fail to do anything with the lines variable in the method so if it was intended to be an array, it never gets changed from an empty array which is kind of pointless.\r\n\r\nWe should enable \"Lint/EmptyExpression\" in the .robocop.yml if when this is fixed and we're on 0.49 or greater.\r\n\r\nBranch off of 5.3.x","closed_at":"2018-02-05T14:18:29.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7948","labels":"","state":"Closed","updated_at":"2018-02-05T14:18:29.000-0800","timestamp":1652285525.959928,"priority":"Normal","status_category":"Done","pull_request":6408},{"issue_id":"218731","title":"Concatenated strings causing breakages with Japanese group 2","url":"https://tickets.puppetlabs.com/browse/PUP-8092","created_at":"2017-10-25T16:01:31.000-0700","number":"PUP-8092","body":"There are some concatenated strings in Puppet that are resulting in mistranslations because the translator doesn't have the full context of what the complete sentence is supposed to be, and cannot change the sentence order,\r\n\r\n{code} [centos@ericdelaney lib]$ find . -type f -print | xargs grep '+= _'\r\n./puppet/graph/simple_graph.rb:      message += _(\"Cycle graph written to %{filename}.\") % { filename: filename }\r\n./puppet/graph/simple_graph.rb:      message += _(\"Try the '--graph' option and opening the resulting '.dot' file in OmniGraffle or GraphViz\")\r\n./puppet/parameter/value_collection.rb:      str += _(\"Valid values are %{value_list}. \") % { value_list: values.join(\", \") } unless values.empty?\r\n./puppet/parameter/value_collection.rb:      str += _(\"Valid values match %{pattern}.\") % { pattern: regexes.join(\", \") } unless regexes.empty?\r\n./puppet/pops/lookup/lookup_adapter.rb:        msg += _(\". A '%{config}' file should be used instead\") % { config: HieraConfig::CONFIG_FILE_NAME } if mp.nil?\r\n./puppet/pops/lookup/lookup_adapter.rb:        msg += _(\". A '%{config}' file should be used instead\") % { config: HieraConfig::CONFIG_FILE_NAME } if ep.nil?\r\n[centos@ericdelaney lib]$\r\n{code}\r\n\r\n{code}\r\n[centos@ericdelaney puppet]$ find lib -type f -print | xargs grep '_(' | grep '+'\r\nlib/puppet/face/epp.rb:        raise Puppet::Error, _(\"One or more file(s) specified did not exist:\\n\") + missing_files.map { |f| \"   #{f}\" }.join(\"\\n\")\r\nlib/puppet/face/epp.rb:          raise Puppet::Error, _(\"One or more file(s) specified did not exist:\\n\") + missing_files.collect { |f| \"   #{f}\" }.join(\"\\n\")\r\nlib/puppet/face/help.rb:          summary = face.deprecated? ? face.summary + _(\" (Deprecated)\") : face.summary\r\nlib/puppet/face/module/build.rb:      _(\"Module built: \") + return_value.expand_path.to_s\r\nlib/puppet/face/module/list.rb:        str << '  ' + colorize(:red, _('invalid'))\r\nlib/puppet/face/module/list.rb:          str << '  ' + colorize(:red, _('invalid'))\r\nlib/puppet/face/parser.rb:        raise Puppet::Error, _(\"One or more file(s) specified did not exist:\\n%{files}\") % { files: missing_files.collect {|f| \" \" * 3 + f + \"\\n\"} }\r\nlib/puppet/face/parser.rb:          dumps + _(\"One or more file(s) specified did not exist:\\n\") + missing_files.collect { |f| \"   #{f}\" }.join(\"\\n\")\r\nlib/puppet/functions/slice.rb:      raise ArgumentError, _(\"slice(): block must define one parameter, or \") +\r\nlib/puppet/functions/slice.rb:        _(\"the same number of parameters as the given size of the slice (%{slice_size}). Block has %{serving_size}; \") % { slice_size: slice_size, serving_size: serving_size }+\r\nlib/puppet/graph/simple_graph.rb:      message += _(\"Cycle graph written to %{filename}.\") % { filename: filename }\r\nlib/puppet/graph/simple_graph.rb:      message += _(\"Try the '--graph' option and opening the resulting '.dot' file in OmniGraffle or GraphViz\")\r\nlib/puppet/module_tool/errors/shared.rb:      trace += @source[1..-1].map { |m| _(\"which depends on '%{name}' (%{version})\") % { name: m[:name], version: v(m[:version]) } }\r\nlib/puppet/network/http/error.rb:      super(_(\"Not Acceptable: \") + message, CODE, issue_kind)\r\nlib/puppet/network/http/error.rb:      super(_(\"Not Found: \") + message, CODE, issue_kind)\r\nlib/puppet/network/http/error.rb:      super(_(\"Not Authorized: \") + message, CODE, issue_kind)\r\nlib/puppet/network/http/error.rb:      super(_(\"Bad Request: \") + message, CODE, issue_kind)\r\nlib/puppet/network/http/error.rb:      super(_(\"Method Not Allowed: \") + message, CODE, issue_kind)\r\nlib/puppet/network/http/error.rb:      super(_(\"Unsupported Media Type: \") + message, CODE, issue_kind)\r\nlib/puppet/network/http/error.rb:      super(_(\"Server Error: \") + original_error.message, CODE, issue_kind)\r\nlib/puppet/parameter/value_collection.rb:      str += _(\"Valid values are %{value_list}. \") % { value_list: values.join(\", \") } unless values.empty?\r\nlib/puppet/parameter/value_collection.rb:      str += _(\"Valid values match %{pattern}.\") % { pattern: regexes.join(\", \") } unless regexes.empty?\r\nlib/puppet/pops/lookup/lookup_adapter.rb:        msg += _(\". A '%{config}' file should be used instead\") % { config: HieraConfig::CONFIG_FILE_NAME } if mp.nil?\r\nlib/puppet/pops/lookup/lookup_adapter.rb:            _(\"Defining environment_data_provider='%{provider_name}' in environment.conf is deprecated\") % { provider_name: provider_name }, env_path + 'environment.conf')\r\nlib/puppet/pops/lookup/lookup_adapter.rb:              _(\"The environment_data_provider='%{provider_name}' setting is ignored since '%{config_path}' version >= 5\") % { provider_name: provider_name, config_path: config_path }, env_path + 'environment.conf')\r\nlib/puppet/pops/lookup/lookup_adapter.rb:        msg += _(\". A '%{config}' file should be used instead\") % { config: HieraConfig::CONFIG_FILE_NAME } if ep.nil?\r\nlib/puppet/pops/model/ast_transformer.rb:    raise _(\"Not a valid expression in a collection query: \")+o.class.name\r\nlib/puppet/util/plist.rb:          Puppet.warning(_(\"Cannot read file %{file_path}; Puppet is skipping it.\\n\") % { file_path: file_path } + _(\"Details: %{detail}\") % { detail: detail })\r\nlib/puppet/util/reference.rb:    \"\\n\\n----------------\\n\\n*\" + _(\"This page autogenerated on \") + \"#{Time.now}*\\n\"\r\nlib/puppet/util/reference.rb:    text << _(\"\\n\\n**This page is autogenerated; any changes will get overwritten** *(last generated on \") + \"#{Time.now.to_s})*\\n\\n\"\r\n{code}\r\n\r\n{code}\r\n/puppet/syntax_checkers/base64.rb\r\n      if (cleaned_text.bytes.to_a.size * 8) % 6 != 0\r\n        msg2 = _(\"padding is not correct\")\r\n      else\r\n        msg2 = _(\"contains letters outside strict base 64 range (or whitespace)\")\r\n      end\r\n      msg = _(\"Base64 syntax checker: Cannot parse invalid Base64 string - %{msg2}\") % { msg2: msg2 }\r\n{code}\r\n\r\n{code}\r\n[centos@ericdelaney puppet]$ find lib -type f -print | xargs grep '_(' | grep '<<'\r\nlib/puppet/face/module/uninstall.rb:      Puppet.notice _(\"Preparing to uninstall '%{name}'\") % { name: name } << (options[:version] ? \" (#{colorize(:cyan, options[:version].sub(/^(?=\\d)/, 'v'))})\" : '') << \" ...\"\r\nlib/puppet/face/module/list.rb:        str << '  ' + colorize(:red, _('invalid'))\r\nlib/puppet/face/module/list.rb:          str << '  ' + colorize(:red, _('invalid'))\r\nlib/puppet/forge/errors.rb:      message = _(<<-EOS).chomp % { uri: @uri, response: @response }\r\nlib/puppet/forge/errors.rb:      message << _(\"\\n  The message we received said '%{message}'\") % { message: @message } if @message\r\nlib/puppet/module_tool/errors/installer.rb:      message << _(\"Could not install module '%{module_name}' (%{version})\") % { module_name: @module_name, version: @requested_version }\r\nlib/puppet/module_tool/errors/installer.rb:      message << _(\"  Module '%{module_name}' (%{version}) is already installed\") % { module_name: @module_name, version: @installed_version }\r\nlib/puppet/module_tool/errors/installer.rb:      message << _(\"    Installed module has had changes made locally\") unless @local_changes.empty?\r\nlib/puppet/module_tool/errors/installer.rb:      message << _(\"    Use `puppet module upgrade` to install a different version\")\r\nlib/puppet/module_tool/errors/installer.rb:      message << _(\"    Use `puppet module install --force` to re-install only this module\")\r\nlib/puppet/module_tool/errors/installer.rb:      message << _(\"Could not install '%{requested_package}'\") % { requested_package: @requested_package }\r\nlib/puppet/module_tool/errors/installer.rb:      message << _(\"  No releases are available from %{source}\") % { source: @source }\r\nlib/puppet/module_tool/errors/installer.rb:      message << _(\"    Does '%{requested_package}' have at least one published release?\") % { requested_package: @requested_package }\r\nlib/puppet/module_tool/errors/shared.rb:      message << _(\"Could not %{action} module '%{module_name}' (%{version})\") % { action: @action, module_name: @requested_name, version: vstring }\r\nlib/puppet/module_tool/errors/shared.rb:      message << _(\"  No version of '%{module_name}' can satisfy all dependencies\") % { module_name: @requested_name }\r\nlib/puppet/module_tool/errors/shared.rb:      message << _(\"    Use `puppet module %{action} --ignore-dependencies` to %{action} only this module\") % { action: @action }\r\nlib/puppet/module_tool/errors/shared.rb:      message << _(\"Could not %{action} '%{module_name}' (%{version})\") % { action: @action, module_name: @module_name, version: vstring }\r\nlib/puppet/module_tool/errors/shared.rb:        message << _(\"  No releases are available from %{source}\") % { source: @source }\r\nlib/puppet/module_tool/errors/shared.rb:        message << _(\"    Does '%{module_name}' have at least one published release?\") % { module_name: @module_name }\r\nlib/puppet/module_tool/errors/shared.rb:        message << _(\"  No releases matching '%{version}' are available from %{source}\") % { version: @requested_version, source: @source }\r\nlib/puppet/module_tool/errors/shared.rb:      message << _(\"Could not install module '%{module_name}' (%{version})\") % { module_name: @requested_module, version: @requested_version }\r\nlib/puppet/module_tool/errors/shared.rb:        message << _(\"  Dependency '%{name}' (%{version}) would overwrite %{dir}\") % { name: @dependency[:name], version: v(@dependency[:version]), dir: @directory }\r\nlib/puppet/module_tool/errors/shared.rb:        message << _(\"  Installation would overwrite %{dir}\") % { dir: @directory }\r\nlib/puppet/module_tool/errors/shared.rb:        message << _(\"    Currently, '%{name}' (%{version}) is installed to that directory\") % { name: @metadata[\"name\"], version: v(@metadata[\"version\"]) }\r\nlib/puppet/module_tool/errors/shared.rb:        message << _(\"    Use `puppet module install --ignore-dependencies` to install only this module\")\r\nlib/puppet/module_tool/errors/shared.rb:        message << _(\"    Use `puppet module install --force` to install this module anyway\")\r\nlib/puppet/module_tool/errors/shared.rb:      trace << _(\"You specified '%{name}' (%{version})\") % { name: @source.first[:name], version: v(@requested_version) }\r\nlib/puppet/module_tool/errors/shared.rb:      message << _(\"Could not install module '%{module_name}' (%{version})\") % { module_name: @requested_module, version: v(@requested_version) }\r\nlib/puppet/module_tool/errors/shared.rb:      message << _(\"  No version of '%{module_name}' will satisfy dependencies\") % { module_name: @module_name }\r\nlib/puppet/module_tool/errors/shared.rb:      message << _(\"    Use `puppet module install --force` to install this module anyway\")\r\nlib/puppet/module_tool/errors/shared.rb:      message << _(\"Could not %{action} module '%{module_name}'\") % { action: @action, module_name: @module_name }\r\nlib/puppet/module_tool/errors/shared.rb:      message << _(\"  Module '%{module_name}' is not installed\") % { module_name: @module_name }\r\nlib/puppet/module_tool/errors/shared.rb:      message << _(\"    Use `puppet module install` to install this module\") if @action == :upgrade\r\nlib/puppet/module_tool/errors/shared.rb:      message << _(\"Could not %{action} module '%{module_name}'\") % { action: @action, module_name: @module_name }\r\nlib/puppet/module_tool/errors/shared.rb:      message << _(\"  Module '%{module_name}' appears multiple places in the module path\") % { module_name: @module_name }\r\nlib/puppet/module_tool/errors/shared.rb:      message << _(\"    Use the `--modulepath` option to limit the search to specific directories\")\r\nlib/puppet/module_tool/errors/shared.rb:      message << _(\"Could not %{action} module '%{module_name}' (%{version})\") % { action: @action, module_name: @module_name, version: vstring }\r\nlib/puppet/module_tool/errors/shared.rb:      message << _(\"  Installed module has had changes made locally\")\r\nlib/puppet/module_tool/errors/shared.rb:      message << _(\"    Use `puppet module %{action} --ignore-changes` to %{action} this module anyway\") % { action: @action }\r\nlib/puppet/module_tool/errors/shared.rb:      message << _(\"Could not %{action} module '%{module_name}'\") % { action: @action, module_name: @name }\r\nlib/puppet/module_tool/errors/shared.rb:      message << _(\"  Failure trying to parse metadata\")\r\nlib/puppet/module_tool/errors/shared.rb:      message << _(\"    Original message was: %{message}\") % { message: @error.message }\r\nlib/puppet/module_tool/errors/uninstaller.rb:      message << _(\"Could not uninstall module '%{module_name}' (%{version})\") % { module_name: @module_name, version: v(@version) }\r\nlib/puppet/module_tool/errors/uninstaller.rb:      message << _(\"  No installed version of '%{module_name}' matches (%{version})\") % { module_name: @module_name, version: v(@version) }\r\nlib/puppet/module_tool/errors/uninstaller.rb:        message << _(\"Could not uninstall module '%{module_name}' (v%{requested_version})\") % { module_name: @module_name, requested_version: @requested_version }\r\nlib/puppet/module_tool/errors/uninstaller.rb:        message << _(\"Could not uninstall module '%{module_name}'\") % { module_name: @module_name }\r\nlib/puppet/module_tool/errors/uninstaller.rb:      message << _(\"  Other installed modules have dependencies on '%{module_name}' (%{version})\") % { module_name: @module_name, version: v(@installed_version) }\r\nlib/puppet/module_tool/errors/uninstaller.rb:      message << _(\"    Use `puppet module uninstall --force` to uninstall this module anyway\")\r\nlib/puppet/module_tool/errors/upgrader.rb:      message << _(\"Could not upgrade module '%{module_name}' (%{version})\") % { module_name: @module_name, version: vstring }\r\nlib/puppet/module_tool/errors/upgrader.rb:        message << _(\"  The installed version is already the latest version matching %{version}\") % { version: vstring }\r\nlib/puppet/module_tool/errors/upgrader.rb:        message << _(\"  There are %{count} newer versions\") % { count: @newer_versions.length }\r\nlib/puppet/module_tool/errors/upgrader.rb:        message << _(\"    No combination of dependency upgrades would satisfy all dependencies\")\r\nlib/puppet/module_tool/errors/upgrader.rb:          message << _(\"    Dependencies will not be automatically upgraded across major versions\")\r\nlib/puppet/module_tool/errors/upgrader.rb:          message << _(\"    Upgrading one or more of these modules may permit the upgrade to succeed:\")\r\nlib/puppet/module_tool/errors/upgrader.rb:      message << _(\"    Use `puppet module upgrade --force` to upgrade only this module\")\r\nlib/puppet/module_tool/errors/upgrader.rb:      message << _(\"Could not %{action} module '%{module_name}' (%{version})\") % { action: @action, module_name: @module_name, version: vstring }\r\nlib/puppet/module_tool/errors/upgrader.rb:      message << _(\"  Downgrading is not allowed.\")\r\nlib/puppet/node/environment.rb:      errors << _(\"The 'disable_per_environment_manifest' setting is true, and the '%{env_name}' environment has an environment.conf manifest that conflicts with the 'default_manifest' setting.\") % { env_name: name }\r\nlib/puppet/parser/resource.rb:      msg << _(' by %{source}') % { source: current.source.to_s } unless current.source.to_s == ''\r\nlib/puppet/parser/resource.rb:      msg << _('; cannot redefine')\r\nlib/puppet/provider/package/nim.rb:        errmsg << _(\"with version '%{version}' \") % { version: version }\r\nlib/puppet/reference/providers.rb:            details << _(\"  - Missing files %{files}\\n\") % { files: values.join(\", \") }\r\nlib/puppet/reference/providers.rb:                details << _(\"  - Setting %{name} (currently %{value}) not in list %{facts}\\n\") % { name: name, value: Puppet.settings.value(name).inspect, facts: facts.join(\", \") }\r\nlib/puppet/reference/providers.rb:                details << _(\"  - Fact %{name} (currently %{value}) not in list %{facts}\\n\") % { name: name, value: Facter.value(name).inspect, facts: facts.join(\", \") }\r\nlib/puppet/reference/providers.rb:            details << _(\"  - Got %{values} true tests that should have been false\\n\") % { values: values }\r\nlib/puppet/reference/providers.rb:            details << _(\"  - Got %{values} false tests that should have been true\\n\") % { values: values }\r\nlib/puppet/reference/providers.rb:            details << _(\"  - Missing features %{values}\\n\") % { values: values.collect { |f| f.to_s }.join(\",\") }\r\nlib/puppet/util/log.rb:    annotated_string << _(\"Backtrace:\") << \"\\n\" << caller[0..10].join(\"\\n\")\r\nlib/puppet/util/logging.rb:        arr << _('Wrapped exception:')\r\nlib/puppet/util/logging.rb:      arr << _(\"Wrapped exception:\")\r\nlib/puppet/util/reference.rb:    text << _(\"\\n\\n**This page is autogenerated; any changes will get overwritten** *(last generated on \") + \"#{Time.now.to_s})*\\n\\n\"\r\n{code}","closed_at":"2018-02-05T14:18:31.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8092","labels":"i18n","state":"Closed","updated_at":"2018-02-05T14:18:31.000-0800","timestamp":1652285526.816564,"priority":"Normal","status_category":"Done","pull_request":6359},{"issue_id":"221334","title":"Certain environments return \"invalid byte sequence in <locale>\" when parsing module PO files","url":"https://tickets.puppetlabs.com/browse/PUP-8249","created_at":"2017-11-09T15:17:52.000-0800","number":"PUP-8249","body":"If you load the eputnam-i18ndemo module which has a fact that causes and error that has a Japanese translation, when its run on OSX the error is replaced by \"invalid byte sequence in US-ASCII\"\r\n\r\n{code}\r\nxh734nh8owpuouo:~ root# puppet module install eputnam-i18ndemo\r\nNotice: Preparing to install into /etc/puppetlabs/code/environments/production/modules ...\r\nNotice: Downloading from https://forgeapi.puppet.com ...\r\nNotice: Installing -- do not interrupt ...\r\n/etc/puppetlabs/code/environments/production/modules\r\n└─┬ eputnam-i18ndemo (v0.2.0)\r\n  ├── puppetlabs-stdlib (v4.21.0)\r\n  └── puppetlabs-translate (v1.1.0)\r\nxh734nh8owpuouo:~ root# LANGUAGE=ja_JP puppet facts\r\nError: Facter: error while resolving custom fact \"i18ndemo_fact\": invalid byte sequence in US-ASCII\r\n{code}\r\n\r\nInstead of the expected Japanese string (which should look like this pattern)\r\n\r\n{code}\r\n        assert_match(/Error:.*eputnam-i18ndemo fact: これはeputnam-i18ndemoからのカスタムファクトからのレイズです/, result.stderr, 'missing translation for raise from ruby fact')\r\n{code}\r\n\r\nThis also appears, for example, on the Japanese Windows pooler image. If you install the module, then attempt to uninstall it, the uninstall will fail with a similar error, and a trace like the one in the comments.","closed_at":"2018-02-05T14:18:34.000-0800","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8249","labels":"","state":"Closed","updated_at":"2018-02-05T14:18:34.000-0800","timestamp":1652285527.770889,"priority":"Normal","status_category":"Done","pull_request":6506},{"issue_id":"228185","title":"filebucket backup with an alternate bucket may not backup","url":"https://tickets.puppetlabs.com/browse/PUP-8285","created_at":"2017-12-21T12:28:25.000-0800","number":"PUP-8285","body":"*Puppet Version:* 5.3.3\r\n*Puppet Server Version:* N/A, running agent only\r\n*OS Name/Version:* Ubuntu 16.04\r\n\r\nWhile trying to document what {{puppet filebucket --bucket}}/{{-b}} does, I've noticed some unexpected or inconsistent behavior. If this behavior is by design, it isn't sufficiently explained in any user-facing documentation.\r\n\r\n*Steps to reproduce:*\r\n\r\n1. Create a test file: {{touch /tmp/testfile}}\r\n2. Back up the file to the local filebucket: {{puppet filebucket -l backup /tmp/testfile}}\r\n3. Back up the same file to a filebucket on a specific path: {{puppet filebucket -b /tmp/testbucket backup /tmp/testfile}}\r\n4. Back up a new file to that same new filebucket: {{touch /tmp/testfile2; puppet filebucket -b /tmp/testbucket backup /tmp/testfile2}}\r\n\r\n*Desired Behavior:*\r\n\r\nThe default local filebucket at /opt/puppetlabs/puppet/cache/bucket contains /tmp/testfile.\r\n\r\nPuppet creates a filebucket at /tmp/testbucket, and that filebucket contains /tmp/testfile and /tmp/testfile2.\r\n\r\nThe documentation explains what --bucket is expected to do.\r\n\r\n*Actual Behavior:*\r\n\r\nThe function and behavior of {{--bucket}} are not documented, so I don't know what the true expected behavior is. It is listed with the flags in the command's help text and man page, but with no context explaining what it does or is expected to do. See also PUP-5206 and PUP-5392.\r\n\r\n{code}\r\nroot@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# touch /tmp/testfile\r\nroot@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# puppet filebucket -l backup /tmp/testfile\r\n/tmp/testfile: d41d8cd98f00b204e9800998ecf8427e\r\nroot@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# ls bucket\r\nd\r\nroot@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# puppet filebucket -l list\r\nd41d8cd98f00b204e9800998ecf8427e 2017-12-21 11:55:44 /tmp/testfile\r\n{code}\r\n\r\nThis is as expected. After backing up the file to the default local filebucket, however, I can't back up the same file to a bucket at a different path, and puppet produces no output suggesting that the file wasn't backed up to the specified bucket path, or why.\r\n\r\nThe new bucket isn't created, but Puppet doesn't state this, so subsequently running {{puppet filebucket -b /tmp/testbucket list}} fails unexpected with a file not found error:\r\n\r\n{code}\r\nroot@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# puppet filebucket -b /tmp/testbucket backup /tmp/testfile\r\n/tmp/testfile: d41d8cd98f00b204e9800998ecf8427e\r\nroot@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# echo $?\r\n0\r\nroot@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# puppet filebucket -b /tmp/testbucket list\r\nError: Could not run: File not found\r\nroot@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# ls -la /tmp/testbucket\r\nls: cannot access '/tmp/testbucket': No such file or directory\r\nroot@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# puppet filebucket -l list\r\nd41d8cd98f00b204e9800998ecf8427e 2017-12-21 11:55:44 /tmp/testfile\r\n{code}\r\n\r\nBut if I back up a file not already in the local filebucket to the specified path, it creates a new filebucket at that path and backs up the file to that filebucket instead of the default local filebucket, which is what I expect would happen:\r\n\r\n{code}\r\nroot@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# touch /tmp/testfile2\r\nroot@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# puppet filebucket -b /tmp/testbucket backup /tmp/testfile2\r\n/tmp/testfile2: d41d8cd98f00b204e9800998ecf8427e\r\nroot@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# puppet filebucket -b /tmp/testbucket list\r\nd41d8cd98f00b204e9800998ecf8427e 2017-12-21 12:00:41 /tmp/testfile2\r\nroot@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# puppet filebucket -l list\r\nd41d8cd98f00b204e9800998ecf8427e 2017-12-21 11:55:44 /tmp/testfile\r\n{code}\r\n\r\nFurthermore, even when /tmp/testbucket exists, I still can't backup the first /tmp/testfile to it. and Puppet returns a successful result without reporting which bucket received the file. So for all I get back from Puppet, I'd expect /tmp/testfile to be in /tmp/testbucket, but it isn't:\r\n\r\n{code}\r\nroot@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# puppet filebucket -b /tmp/testbucket backup /tmp/testfile\r\n/tmp/testfile: d41d8cd98f00b204e9800998ecf8427e\r\nroot@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# echo $?\r\n0\r\nroot@mtwdsw7jqqaoq8c:/opt/puppetlabs/puppet/cache# puppet filebucket -b /tmp/testbucket list\r\nd41d8cd98f00b204e9800998ecf8427e 2017-12-21 12:00:41 /tmp/testfile2\r\n{code}\r\n\r\nThe above commands produce the same output using {{-b}} or {{--bucket}}.\r\n\r\nNone of the documentation explains that a new local filebucket can be created by using the {{--bucket}}/{{-b}} flag, a path, and a file not already backed up to the local filebucket.\r\n\r\nAlso, if the above behavior is not a bug, none of the documentation explains a file already backed up to the default local filebucket can't be backed up to a bucket specified by {{--bucket}}, and the command output doesn't explain that {{--bucket}} was ignored or why, making it difficult to figure out why the file isn't backed up to the specified filebucket.\r\n\r\nAdding this ticket as a blocker to PUP-5392 because the suggested fix is to explain how to manage puppetserver's filebucket using {{--bucket}}, but I'm not sure how using {{--bucket}} would consistently work in that context.","closed_at":"2018-02-06T09:13:45.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8285","labels":"","state":"Closed","updated_at":"2018-02-06T09:13:45.000-0800","timestamp":1652285527.986796,"priority":"Normal","status_category":"Done","pull_request":6500},{"issue_id":"136291","title":"File autorequire in Mount causes dependency loops","url":"https://tickets.puppetlabs.com/browse/PUP-6397","created_at":"2016-06-09T10:05:52.000-0700","number":"PUP-6397","body":"One of the autorequires added to Mount in 4.5.0 causes dependency loops in our install. See Acceptance Criteria first for a sample use case.\r\n\r\nThe root cause is the File type assuming that the path is a unique identifier (namevar), while that's not true when Mounts are involved. PUP-6099 broke the workaround for that situation.\r\n\r\nWhen /x is a mountpoint, there are actually two /x directories: the *mountpoint* on the parent filesystem (/x in the / filesystem, invisible once mounted) and the *mounted directory* (the root of the mounted /x filesystem). These two directories are different system objects and may have different owners/modes/etc.\r\n\r\nThe mountpoint is just a technical prerequisite to make mount work. What we usually want to manage in depth is the mounted directory. However, PUP-6099 makes Puppet only manage the mountpoint:\r\n{noformat}\r\nFile[/x] -> Mount[/x]                    # Forced by PUP-6099\r\nMountpoint[/x] -> Mount[/x] -> File[/x]  # What we would want to do\r\n{noformat}\r\n\r\nWith Mountpoint a (not yet written) lightweight File clone that just ensures directory existence and root-ownership. So far I used an Exec hack as a quick workaround.\r\n\r\nWhy it is important that File manages the mounted directory and not the mountpoint:\r\n* This is where the content lives and where we want the full power of the File type.\r\n* Doing otherwise breaks modules which manage the mounted directory as a File (see Acceptance Criteria).\r\n\r\nSuggested course of action: roll back the autorequire (lib/puppet/type/mount.rb:301) until a resolution for the more general issue described above is available. At the very least, please make it optional.","closed_at":"2018-02-06T11:44:51.000-0800","comments":17,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6397","labels":"","state":"Closed","updated_at":"2018-02-06T11:44:51.000-0800","timestamp":1652285528.208047,"priority":"Major","status_category":"Done","pull_request":5197},{"issue_id":"179345","title":"Filtering resources by tag interferes with corrective vs. intentional change determination","url":"https://tickets.puppetlabs.com/browse/PUP-8096","created_at":"2017-03-08T14:41:52.000-0800","number":"PUP-8096","body":"Reproduction steps:\r\n• Add a _new_ resource to site.pp\r\n• Run {{puppet agent -t}} on the node\r\n• Observe that the change is properly marked as intentional\r\n• Modify the resource on disk\r\n• Run {{puppet agent -t}} on the node\r\n• Observe that the change is properly marked as corrective\r\n• Modify the resource on disk\r\n• Run {{puppet agent -t --tags faketag}} on the node (this can be done before or after the previous step)\r\n• Observe that no change is made\r\n• Run {{puppet agent -t}} on the node\r\n• Observe that the change is _wrongly_ marked as intentional\r\n\r\nThe agent uses a transaction persistence file to store the previous desired state (or actual state? unclear) which it can compare to the current state on the next run. That file seems to only include resources that are actually managed on a given run, so any resource that is skipped due to tags is omitted. That causes the agent to think that every change is intentional the next time around.\r\n\r\nI expect this is also broken for resources which are skipped due to failed dependencies, though I haven't tested that.","closed_at":"2018-02-06T13:56:34.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8096","labels":"scr-candidate-irving","state":"Closed","updated_at":"2018-02-06T13:56:34.000-0800","timestamp":1652285528.637891,"priority":"Normal","status_category":"Done","pull_request":6320},{"issue_id":"176372","title":"gzip decompression mangles utf-8 content in catalog","url":"https://tickets.puppetlabs.com/browse/PUP-7251","created_at":"2017-02-23T10:29:32.000-0800","number":"PUP-7251","body":"It appears a regression in UTF-8 handling by Puppet was introduced when gzip compression was fixed in trapperkeeper / puppet server via https://tickets.puppetlabs.com/browse/TK-429\r\n\r\nThis was discovered in investigating a local failure of the agent 1.9 series against https://github.com/puppetlabs/puppet/blob/master/acceptance/tests/resource/file/ticket_6448_file_with_utf8_source.rb against puppet server 2.7.2.master-0.1SNAPSHOT.2017.02.22T1106. We are not seeing this failure in CI presumably because CI is pinned to a released version of puppet server without this change.\r\n\r\nThe catalog returned by the server in this test contains a UTF-8 named file resource,\r\n{code}\"\\u9759\\u7864\"{code}\r\n\r\nPrior to the change, the catalog received by the agent was uncompressed and contained:\r\n{code}\r\n[5] pry(#<Puppet::Resource::Catalog::Rest>)> response.body\r\n=> \"{\\\"tags\\\":[\\\"settings\\\"],\\\"name\\\":\\\"cpq55y0vuphp44u.delivery.puppetlabs.net\\\",\\\"version\\\":1487871618,\\\"code_id\\\":null,\\\"catalog_uuid\\\":\\\"cf89d5fd-ebdf-426a-832b-68812066c165\\\",\\\"catalog_format\\\":1,\\\"environment\\\":\\\"ticket_6448_file_with_utf8_source_j9w3rhmk\\\",\\\"resources\\\":[{\\\"type\\\":\\\"Stage\\\",\\\"title\\\":\\\"main\\\",\\\"tags\\\":[\\\"stage\\\"],\\\"exported\\\":false,\\\"parameters\\\":{\\\"name\\\":\\\"main\\\"}},{\\\"type\\\":\\\"Class\\\",\\\"title\\\":\\\"Settings\\\",\\\"tags\\\":[\\\"class\\\",\\\"settings\\\"],\\\"exported\\\":false},{\\\"type\\\":\\\"Class\\\",\\\"title\\\":\\\"main\\\",\\\"tags\\\":[\\\"class\\\"],\\\"exported\\\":false,\\\"parameters\\\":{\\\"name\\\":\\\"main\\\"}},{\\\"type\\\":\\\"File\\\",\\\"title\\\":\\\"/tmp/ticket_6448_file_with_utf8_source_j9w3rhmk.7EeVuV/\\xEF\\xBD\\xB2\\xEF\\xBD\\xA7\\xE3\\x83\\x95\\xE3\\x83\\xAB\\\",\\\"tags\\\":[\\\"file\\\",\\\"class\\\"],\\\"file\\\":\\\"/etc/puppetlabs/code/environments/ticket_6448_file_with_utf8_source_j9w3rhmk/manifests/site.pp\\\",\\\"line\\\":2,\\\"exported\\\":false,\\\"parameters\\\":{\\\"ensure\\\":\\\"present\\\",\\\"source\\\":\\\"puppet:///modules/utf8_file_module/\\xE9\\x9D\\x99\\xE7\\x9A\\x84\\\"}}],\\\"edges\\\":[{\\\"source\\\":\\\"Stage[main]\\\",\\\"target\\\":\\\"Class[Settings]\\\"},{\\\"source\\\":\\\"Stage[main]\\\",\\\"target\\\":\\\"Class[main]\\\"},{\\\"source\\\":\\\"Class[main]\\\",\\\"target\\\":\\\"File[/tmp/ticket_6448_file_with_utf8_source_j9w3rhmk.7EeVuV/\\xEF\\xBD\\xB2\\xEF\\xBD\\xA7\\xE3\\x83\\x95\\xE3\\x83\\xAB]\\\"}],\\\"classes\\\":[\\\"settings\\\"]}\"\r\n{code}\r\n\r\nIt thus did not go through gzip decompression, here:\r\nhttps://github.com/puppetlabs/puppet/blob/master/lib/puppet/network/http/compression.rb#L23\r\n\r\nAfter the change, the catalog requires decompression - and the decompressed result is mangled UTF-8:\r\n{code}\r\n[4] pry(#<Puppet::Resource::Catalog::Rest>)> Zlib::GzipReader.new(StringIO.new(response.body)).read\r\n=> \"{\\\"tags\\\":[\\\"settings\\\"],\\\"name\\\":\\\"cpq55y0vuphp44u.delivery.puppetlabs.net\\\",\\\"version\\\":1487871046,\\\"code_id\\\":null,\\\"catalog_uuid\\\":\\\"413cbbbb-9035-4ffd-84bd-d792a7cf7976\\\",\\\"catalog_format\\\":1,\\\"environment\\\":\\\"ticket_6448_file_with_utf8_source_j9w3rhmk\\\",\\\"resources\\\":[{\\\"type\\\":\\\"Stage\\\",\\\"title\\\":\\\"main\\\",\\\"tags\\\":[\\\"stage\\\"],\\\"exported\\\":false,\\\"parameters\\\":{\\\"name\\\":\\\"main\\\"}},{\\\"type\\\":\\\"Class\\\",\\\"title\\\":\\\"Settings\\\",\\\"tags\\\":[\\\"class\\\",\\\"settings\\\"],\\\"exported\\\":false},{\\\"type\\\":\\\"Class\\\",\\\"title\\\":\\\"main\\\",\\\"tags\\\":[\\\"class\\\"],\\\"exported\\\":false,\\\"parameters\\\":{\\\"name\\\":\\\"main\\\"}},{\\\"type\\\":\\\"File\\\",\\\"title\\\":\\\"/tmp/ticket_6448_file_with_utf8_source_j9w3rhmk.7EeVuV/ï½²ï½§ã\\x83\\x95ã\\x83«\\\",\\\"tags\\\":[\\\"file\\\",\\\"class\\\"],\\\"file\\\":\\\"/etc/puppetlabs/code/environments/ticket_6448_file_with_utf8_source_j9w3rhmk/manifests/site.pp\\\",\\\"line\\\":2,\\\"exported\\\":false,\\\"parameters\\\":{\\\"ensure\\\":\\\"present\\\",\\\"source\\\":\\\"puppet:///modules/utf8_file_module/é\\x9D\\x99ç\\x9A\\x84\\\"}}],\\\"edges\\\":[{\\\"source\\\":\\\"Stage[main]\\\",\\\"target\\\":\\\"Class[Settings]\\\"},{\\\"source\\\":\\\"Stage[main]\\\",\\\"target\\\":\\\"Class[main]\\\"},{\\\"source\\\":\\\"Class[main]\\\",\\\"target\\\":\\\"File[/tmp/ticket_6448_file_with_utf8_source_j9w3rhmk.7EeVuV/ï½²ï½§ã\\x83\\x95ã\\x83«]\\\"}],\\\"classes\\\":[\\\"settings\\\"]}\"\r\n{code}\r\n\r\nThis is because ruby's {{Zlib::GzipReader}} will default to decompressing as {{Encoding.default_external}} - in our environment this is not always UTF-8.\r\n\r\nThe solution is to specify -UTF\\-8- BINARY encoding as part of the decompression, ie at:\r\nhttps://github.com/puppetlabs/puppet/blob/master/lib/puppet/network/http/compression.rb#L23:\r\n{code}\r\n-Zlib::GzipReader.new(StringIO.new(response.body), :encoding => Encoding::UTF_8).read-\r\nZlib::GzipReader.new(StringIO.new(response.body), :encoding => Encoding::BINARY)\r\n{code}\r\n\r\nNote - originally it was thought that we should coerce the decompressed body to UTF-8, but per https://docs.puppet.com/puppet/latest/http_api/pson.html#differences-from-json it was determined that PSON specifies ASCII-8BIT (binary). Thus we need to encode the decompressed result as binary. This is confirmed by analyzing the body returned when puppet server's webserver is run with decompression disabled. In this case we fall through to the final statement in the compression determination, here: https://github.com/puppetlabs/puppet/blob/master/lib/puppet/network/http/compression.rb#L27, which simply returns {{response.body}}. With compression disabled, the encoding of {{response.body}} is binary:\r\n{code}\r\n[1] pry(#<Puppet::Resource::Catalog::Rest>)> response.body\r\n=> \"{\\\"tags\\\":[\\\"settings\\\"],\\\"name\\\":\\\"beth2uuaz9mwtt3.delivery.puppetlabs.net\\\",\\\"version\\\":1487877686,\\\"code_id\\\":null,\\\"catalog_uuid\\\":\\\"f2cb0993-b259-4c77-8776-7df5500caace\\\",\\\"catalog_format\\\":1,\\\"environment\\\":\\\"ticket_6448_file_with_utf8_source_w1h8my9a\\\",\\\"resources\\\":[{\\\"type\\\":\\\"Stage\\\",\\\"title\\\":\\\"main\\\",\\\"tags\\\":[\\\"stage\\\"],\\\"exported\\\":false,\\\"parameters\\\":{\\\"name\\\":\\\"main\\\"}},{\\\"type\\\":\\\"Class\\\",\\\"title\\\":\\\"Settings\\\",\\\"tags\\\":[\\\"class\\\",\\\"settings\\\"],\\\"exported\\\":false},{\\\"type\\\":\\\"Class\\\",\\\"title\\\":\\\"main\\\",\\\"tags\\\":[\\\"class\\\"],\\\"exported\\\":false,\\\"parameters\\\":{\\\"name\\\":\\\"main\\\"}},{\\\"type\\\":\\\"File\\\",\\\"title\\\":\\\"/tmp/ticket_6448_file_with_utf8_source_w1h8my9a.4Nw2GO/\\xEF\\xBD\\xB2\\xEF\\xBD\\xA7\\xE3\\x83\\x95\\xE3\\x83\\xAB\\\",\\\"tags\\\":[\\\"file\\\",\\\"class\\\"],\\\"file\\\":\\\"/etc/puppetlabs/code/environments/ticket_6448_file_with_utf8_source_w1h8my9a/manifests/site.pp\\\",\\\"line\\\":2,\\\"exported\\\":false,\\\"parameters\\\":{\\\"ensure\\\":\\\"present\\\",\\\"source\\\":\\\"puppet:///modules/utf8_file_module/\\xE9\\x9D\\x99\\xE7\\x9A\\x84\\\"}}],\\\"edges\\\":[{\\\"source\\\":\\\"Stage[main]\\\",\\\"target\\\":\\\"Class[Settings]\\\"},{\\\"source\\\":\\\"Stage[main]\\\",\\\"target\\\":\\\"Class[main]\\\"},{\\\"source\\\":\\\"Class[main]\\\",\\\"target\\\":\\\"File[/tmp/ticket_6448_file_with_utf8_source_w1h8my9a.4Nw2GO/\\xEF\\xBD\\xB2\\xEF\\xBD\\xA7\\xE3\\x83\\x95\\xE3\\x83\\xAB]\\\"}],\\\"classes\\\":[\\\"settings\\\"]}\"\r\n[2] pry(#<Puppet::Resource::Catalog::Rest>)> response.body.encoding\r\n=> #<Encoding:ASCII-8BIT>\r\n{code}\r\n\r\nNote - we also rely on Zlib::Inflate but this defaults to decompressing as ASCII-8BIT rather than default-external, which may be appropriate for our purposes.","closed_at":"2018-02-07T00:59:41.000-0800","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7251","labels":"utf-8","state":"Closed","updated_at":"2018-02-07T00:59:41.000-0800","timestamp":1652285528.746519,"priority":"Major","status_category":"Done","pull_request":5660},{"issue_id":"223214","title":"Package source on Windows errors out on deduped installation files","url":"https://tickets.puppetlabs.com/browse/PUP-8337","created_at":"2017-11-21T08:27:39.000-0800","number":"PUP-8337","body":"We just swapped out a Windows Server 2008 R2 with a Windows Server 2016. We have deduplication enabled on the 2016 server. We have a few Windows machines with Puppet Agent installed. Since swapping to the new server, any module that uses the package resource type errors out with this:\r\n\r\n{code:java}\r\nError: DeviceIoControl(940, FSCTL_GET_REPARSE_POINT) returned unknown tag 0x80000013:  The operation completed successfully.\r\nError: /Stage[main]/Sophos::Install/Package[Sophos Anti-Virus]/ensure: change from 'absent' to 'present' failed: DeviceIoControl(940, FSCTL_GET_REPARSE_POINT) returned unknown tag 0x80000013:  The operation completed successfully.\r\n{code}\r\n\r\nThe only thing I can find about that error is it has something to do with deduplication. I replaced an installation file with a newer one and ran the agent again. The application installed like it did before swapping servers.\r\nIt's not a big deal if this gets fixed for me or not. I'm fine excluding the folder with all my installations from being deduped. I just thought I'd bring it to your attention if this isn't known yet.\r\n\r\nThis is the code for the package resource type:\r\n{code:java}\r\npackage { 'Sophos Anti-Virus':\r\n  ensure => installed,\r\n  source => \"//server.domain.com/installations/SophosInstallFull.exe\"\r\n}\r\n{code}\r\n\r\n","closed_at":"2018-02-07T09:54:07.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8337","labels":"","state":"Closed","updated_at":"2018-02-07T09:54:07.000-0800","timestamp":1652285528.852556,"priority":"Minor","status_category":"Done","pull_request":6513},{"issue_id":"108731","title":"Monkey patch attempts to load same certs into OpenSSL::X509::Store objects multiple times","url":"https://tickets.puppetlabs.com/browse/PUP-5588","created_at":"2015-12-08T12:23:42.000-0800","number":"PUP-5588","body":"We monkey patch OpenSSL::X509::Store#set_default_paths to load our own additional certs. Specifically in the case of code that uses Net::HTTP, however, the monkey patch can be invoked multiple times, and on the second and subsequent invocations the cert(s) are already loaded into the object. This causes a warning to print very verbosely, obscuring useful output.\r\n\r\nPuppet faces or extensions that use Net::HTTP or open-uri can trigger these superfluous warnings.","closed_at":"2018-02-08T17:42:01.000-0800","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5588","labels":"","state":"Closed","updated_at":"2018-02-08T17:42:01.000-0800","timestamp":1652285529.483416,"priority":"Normal","status_category":"Done","pull_request":4879},{"issue_id":"232352","title":"solaris 10 doesn't show raise from custom fact because module expects openssl in the path","url":"https://tickets.puppetlabs.com/browse/PUP-8377","created_at":"2018-01-23T09:01:38.000-0800","number":"PUP-8377","body":"The test tests/i18n/modules/puppet_apply_unsupported_lang.rb is intended to verify that we can get all warning and error messages when we ask for an unsupported language on the system. In this case even if you don't ask for a different language then the default, we don't see the 'raise' message we're expecting from the custom fact:\r\n\r\n{code}\r\n      pfuqyhk1tw6udul.delivery.puppetlabs.net (solaris10-64-1) 08:49:51$ puppet apply -e \"class { 'i18ndemo': filename => '/tmp/provider.LpaqLb' }\"\r\n        Warning: This method is deprecated, please use the stdlib validate_legacy function,\r\n                            with Stdlib::Compat::Absolute_Path. There is further documentation for validate_legacy function in the README. at [\"/etc/puppetlabs/code/environments/production/modules/i18ndemo/manifests/init.pp\", 15]:\r\n           (at /etc/puppetlabs/code/environments/production/modules/stdlib/lib/puppet/functions/deprecation.rb:28:in `deprecation')\r\n        Warning: Scope(Class[I18ndemo]): Creating an i18ndemo file\r\n        Notice: Compiled catalog for pfuqyhk1tw6udul.delivery.puppetlabs.net in environment production in 0.06 seconds\r\n        Warning: /Stage[main]/I18ndemo/File[/tmp/provider.LpaqLb]: Ensure set to :present but file type is directory so no content will be synced\r\n        Notice: Applied catalog in 0.02 seconds\r\n{code}\r\n\r\nThe problem is that module is getting the openssl version available (which there isn't one in the path on the solaris 10 boxes). Since its its not set we don't raise.\r\n\r\n{code}\r\nopensslv = Facter::Util::Resolution.exec('openssl version')\r\n    raise _('i18ndemo_fact: this is a raise from a custom fact from eputnam-i18ndemo') if opensslv\r\n{code}\r\n\r\nWe should change the module to always raise an error and re-enable the test on solaris10\r\n","closed_at":"2018-02-14T06:33:59.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8377","labels":"","state":"Closed","updated_at":"2018-02-14T06:33:59.000-0800","timestamp":1652285530.74256,"priority":"Normal","status_category":"Done","pull_request":6595},{"issue_id":"234347","title":"types generated by puppet generate types with title patterns are handled the wrong way","url":"https://tickets.puppetlabs.com/browse/PUP-8411","created_at":"2018-02-01T02:00:58.000-0800","number":"PUP-8411","body":"If a resource type has title patterns, it would end up using the default regular expression instead of the specified pattern. For most resource types this is the default and no problem would be noticed.\r\n\r\nWe found this problem in code review as there was a typo in the implementation.","closed_at":"2018-02-14T06:33:59.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8411","labels":"","state":"Closed","updated_at":"2018-02-14T06:33:59.000-0800","timestamp":1652285531.125829,"priority":"Normal","status_category":"Done","pull_request":6599},{"issue_id":"226711","title":"gem package provider broken with Rubygems 2.7.x","url":"https://tickets.puppetlabs.com/browse/PUP-8255","created_at":"2017-12-14T12:33:58.000-0800","number":"PUP-8255","body":"The format of {{gem list --local}} changed with the recent Rubygems 2.7.0 release. It now indicates default Gems, which looks like this:\r\n\r\n{noformat}\r\n$ gem list --local\r\n\r\n*** LOCAL GEMS ***\r\n\r\nbigdecimal (default: 1.2.8)\r\nbundler (default: 1.16.0, 1.15.1)\r\ndeep_merge (1.0.1)\r\ndid_you_mean (1.0.0)\r\n...\r\n{noformat}\r\n\r\nThis confuses the {{gem}} package provider as it now views the string {{default:}} as part of the version number. Puppet then tries to install the desired version on every Puppet agent run (for example when using the puppetlabs-ruby module):\r\n\r\n{noformat}\r\nNotice: /Stage[main]/Ruby::Dev/Package[bundler]/ensure: ensure changed ['default:', '1.15.1'] to '1.16.0'\r\n{noformat}\r\n\r\nI have implemented a naive fix for this in https://github.com/antaflos/puppet/commit/4edfeeb9a8f2546539b1c9f544440a5d30d9f55a but I am not sure if this change in Rubygems has any other implications and if my fix for this is good enough.\r\n\r\nFor reference, this is the output of {{gem env}} on an affected node:\r\n\r\n{noformat}\r\nRubyGems Environment:\r\n  - RUBYGEMS VERSION: 2.7.3\r\n  - RUBY VERSION: 2.3.1 (2016-04-26 patchlevel 112) [x86_64-linux-gnu]\r\n  - INSTALLATION DIRECTORY: /var/lib/gems/2.3.0\r\n  - USER INSTALLATION DIRECTORY: /home/ant/.gem/ruby/2.3.0\r\n  - RUBY EXECUTABLE: /usr/bin/ruby2.3\r\n  - EXECUTABLE DIRECTORY: /usr/local/bin\r\n  - SPEC CACHE DIRECTORY: /home/ant/.gem/specs\r\n  - SYSTEM CONFIGURATION DIRECTORY: /etc\r\n  - RUBYGEMS PLATFORMS:\r\n    - ruby\r\n    - x86_64-linux\r\n  - GEM PATHS:\r\n     - /var/lib/gems/2.3.0\r\n     - /home/ant/.gem/ruby/2.3.0\r\n     - /usr/lib/x86_64-linux-gnu/rubygems-integration/2.3.0\r\n     - /usr/share/rubygems-integration/2.3.0\r\n     - /usr/share/rubygems-integration/all\r\n  - GEM CONFIGURATION:\r\n     - :update_sources => true\r\n     - :verbose => true\r\n     - :backtrace => false\r\n     - :bulk_threshold => 1000\r\n  - SHELL PATH:\r\n     - /usr/local/sbin\r\n     - /usr/local/bin\r\n     - /usr/sbin\r\n     - /usr/bin\r\n     - /sbin\r\n     - /bin\r\n     - /snap/bin\r\n{noformat}","closed_at":"2018-02-14T06:33:59.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8255","labels":"","state":"Closed","updated_at":"2018-02-14T06:33:59.000-0800","timestamp":1652285531.439597,"priority":"Normal","status_category":"Done","pull_request":6620},{"issue_id":"235355","title":"Regression: puppet apply does not decompress response bodies for http file sources","url":"https://tickets.puppetlabs.com/browse/PUP-8420","created_at":"2018-02-06T05:57:09.000-0800","number":"PUP-8420","body":"The following file resource behaves incorrectly and results in a corrupt file:\r\n\r\n{code}\r\n   file { \"service installer\":\r\n        path => '/usr/local/bin/cleo-service',\r\n        ensure => 'present',\r\n        mode => '0700',\r\n        source => \"https://raw.githubusercontent.com/jthielens/versalex-ops/master/service/cleo-service\",\r\n   }\r\n{code}","closed_at":"2018-02-14T06:34:00.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8420","labels":"regression","state":"Closed","updated_at":"2018-02-14T06:34:00.000-0800","timestamp":1652285531.546303,"priority":"Blocker","status_category":"Done","pull_request":6610},{"issue_id":"235558","title":"Remove gettext-setup as a runtime gem dependency","url":"https://tickets.puppetlabs.com/browse/PUP-8432","created_at":"2018-02-06T17:25:57.000-0800","number":"PUP-8432","body":"Puppet version: 5.3.4\r\n\r\nWe meant to remove {{gettext-setup}} as a puppet runtime dependency, but we store gem dependencies in 3 different places for different use cases, so it was missed. See https://github.com/puppetlabs/puppet/commit/53aa50aaf6347ac166620f08224d072552e57dc3#diff-8b7db4d5cc4b8f6dc8feb7030baa2478.\r\n\r\nThis is a problem because it increases the chances of running into PUP-8418 (if gettext-setup is ever required).","closed_at":"2018-02-14T06:34:00.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8432","labels":"","state":"Closed","updated_at":"2018-02-14T06:34:00.000-0800","timestamp":1652285531.652519,"priority":"Normal","status_category":"Done","pull_request":6613},{"issue_id":"180466","title":"resource type tidy does not honor metaparameter noop","url":"https://tickets.puppetlabs.com/browse/PUP-7349","created_at":"2017-03-14T10:02:35.000-0700","number":"PUP-7349","body":"The resource type tidy ignores the noop parameter. The code below removes the matching files where it should noop that operation.\r\n\r\n{code:puppet}\r\ntidy { 'remove_dot_files':\r\n      path    => '/home',\r\n      matches => [ '.rhost', '.netrc', '.forward' ],\r\n      recurse => true,\r\n      noop    => true,\r\n}\r\n{code}\r\n","closed_at":"2018-02-14T06:34:02.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7349","labels":"","state":"Closed","updated_at":"2018-02-14T06:34:02.000-0800","timestamp":1652285531.756813,"priority":"Normal","status_category":"Done","pull_request":6551},{"issue_id":"168858","title":"Relative paths in a hiera v3 config must not be resolved against parent of hiera.yaml","url":"https://tickets.puppetlabs.com/browse/PUP-7068","created_at":"2017-01-05T03:39:54.000-0800","number":"PUP-7068","body":"A datadir that is defined as a _relative path_ in a Hiera version 3 configuration must be treated as relative to the current working directory and not, as it is now, relative to the directory where the hiera.yaml file resides.","closed_at":"2018-02-15T04:43:49.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7068","labels":"","state":"Closed","updated_at":"2018-02-15T04:43:49.000-0800","timestamp":1652285532.282439,"priority":"Normal","status_category":"Done","pull_request":5465},{"issue_id":"227641","title":"init plans in bolt do not load correctly from 'bolt plan show'","url":"https://tickets.puppetlabs.com/browse/PUP-8271","created_at":"2017-12-20T11:36:07.000-0800","number":"PUP-8271","body":"*Puppet Version: vendored \r\nbranch = feature_puppet-tasks\r\n\r\nDescribe your issue in as much detail as possible…\r\nDescribe steps to reproduce…\r\n\r\n*Desired Behavior:*\r\n\r\n\r\n*Actual Behavior:\r\nGiven the following plan\r\n{code:title=modules/foo/plans/init.pp}\r\nplan foo() {\r\n  notice 'I am the init plan for the foo module'\r\n}\r\n{code}\r\n\r\nAnd I use 'bolt plan show', I get the following.\r\n{code}\r\n[root@p0dv972ia1yz1v1 ~]# bolt plan show --modulepath ~/modules\r\n   (at /usr/local/share/gems/gems/bolt-9.9.afe6bdc/vendored/puppet/lib/puppet.rb:130:in `<module:Puppet>')\r\nError: The code loaded from /root/modules/foo/plans/init.pp produced plan with the wrong name, expected foo::init, actual foo on node p0dv972ia1yz1v1.delivery.puppetlabs.net\r\nFailure while reading plans\r\n{code}\r\n\r\nIf I attempt to run this plan it works correctly.  \r\n{code}\r\n[root@p0dv972ia1yz1v1 ~]# bolt plan run foo --modulepath ~/modules\r\nNotice: Scope(<module>/foo/plans/init.pp, 2): I am the init plan\r\n{code}\r\n\r\nThere is a second related issue where both list_task and list_plan methods return objects that don't remove the {{init}} part of the task and plan names.\r\n\r\n","closed_at":"2018-02-15T06:49:12.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8271","labels":"","state":"Closed","updated_at":"2018-02-15T06:49:12.000-0800","timestamp":1652285532.49166,"priority":"Normal","status_category":"Done","pull_request":6468},{"issue_id":"225538","title":"Regression in Puppet system loader","url":"https://tickets.puppetlabs.com/browse/PUP-8229","created_at":"2017-12-06T05:09:51.000-0800","number":"PUP-8229","body":"One of the [commits for PUP-7864|https://github.com/puppetlabs/puppet/commit/2bc0bb869914cb33aa0078c3f9fe1fddaaefe16c] caused a regression in the puppet system loader because it assumed that 'puppet/lib' would always be reachable using 'lib'. The regression was caught in acceptance tests where the 'puppet/lib' folder is renamed to 'site_ruby'.\r\n","closed_at":"2018-02-15T06:49:12.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8229","labels":"","state":"Closed","updated_at":"2018-02-15T06:49:12.000-0800","timestamp":1652285532.59854,"priority":"Normal","status_category":"Done","pull_request":6420},{"issue_id":"224773","title":"TaskSignature#runnable_with? should yield type mismatch error","url":"https://tickets.puppetlabs.com/browse/PUP-8221","created_at":"2017-11-30T03:22:33.000-0800","number":"PUP-8221","body":"When the PAL API TaskSignature#runnable_with? was implemented the feature found in the similar {{callable_with?}} methods for other signatures that yields a type mismatch error to a given block was forgotten.\r\n\r\nThis should be implemented so that a user of the API does not have to construct that error message manually.","closed_at":"2018-02-15T06:49:13.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8221","labels":"","state":"Closed","updated_at":"2018-02-15T06:49:13.000-0800","timestamp":1652285532.808094,"priority":"Normal","status_category":"Done","pull_request":6406},{"issue_id":"226937","title":"PAL list_tasks doesn't return useful results unless all task metadata is valid","url":"https://tickets.puppetlabs.com/browse/PUP-8259","created_at":"2017-12-15T15:11:44.000-0800","number":"PUP-8259","body":"If invalid metadata is found, {{list_tasks}} will throw an exception. We'd like to be able to log tasks that have invalid metadata (in a more controlled method, i.e. catch the exception and print a summary) while still presenting a list of valid tasks. With the current implementation of {{list_tasks}} we can't do that.","closed_at":"2018-02-15T06:49:15.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8259","labels":"","state":"Closed","updated_at":"2018-02-15T06:49:15.000-0800","timestamp":1652285533.019624,"priority":"Normal","status_category":"Done","pull_request":6489},{"issue_id":"232563","title":"modifycmd does not correctly catch and handle the `password_warn_days` option","url":"https://tickets.puppetlabs.com/browse/PUP-8381","created_at":"2018-01-23T15:12:22.000-0800","number":"PUP-8381","body":"*Puppet Version:4.10.x\r\n\r\nWhen modifying users and passing in `--warndays` (a feature introduced in https://github.com/puppetlabs/puppet/commit/31089218e84e898e4b2388bf1ed98e08bf892968), the useradd module does not correctly handle this flag. It is supposed to use either `usermod` or `chage` depending on which aspect it is modifying, but the regex set up to catch this misses the warn days scenario (https://github.com/puppetlabs/puppet/blob/4d96086ac88b34f3ed78d61a14e246016db22b17/lib/puppet/provider/nameservice/objectadd.rb#L16). Currently, it only catches and properly handles those flags that deal with password age.\r\n\r\n*Desired Behavior: When specifying option `:password_warn_days`, use command defined for `:password' or `:localpassword`.\r\n\r\n\r\n*Actual Behavior: When passing in `:password_warn_days`, command is set to `:modify` or `:localmodify`.","closed_at":"2018-02-15T06:49:15.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8381","labels":"","state":"Closed","updated_at":"2018-02-15T06:49:15.000-0800","timestamp":1652285533.336882,"priority":"Normal","status_category":"Done","pull_request":6569},{"issue_id":"226542","title":"Parser locator doesn't cache anything and doesn't appear to work.","url":"https://tickets.puppetlabs.com/browse/PUP-8247","created_at":"2017-12-13T13:29:06.000-0800","number":"PUP-8247","body":"The Puppet::Pops::Parser::Locator attempts to cache line location information, but it ends up calling local variables {{prev_line}} etc that shadow the accessor methods of the same name.\r\n\r\nEven after fixing the code, e.g.\r\n\r\n{code:ruby}\r\n        self.prev_offset = offset\r\n        self.prev_line = line_nbr\r\n{code}\r\n\r\nThe caching mechanism does not appear to work even when using unlimited environment timeouts. Given a manifest:\r\n\r\n{code:puppet}\r\nfile { '/tmp/testing':\r\n  ensure => present,\r\n}\r\n{code}\r\n\r\nI get the following instrumented output which shows it keeps getting cache misses:\r\n\r\n{noformat}\r\nDebug: Evaluating match for Route /.*/\r\nNotice: Locator cache miss offset=25 => line number=2\r\nNotice: Locator cache miss offset=0 => line number=1\r\nNotice: Compiled catalog for localhost in environment production in 0.00 seconds\r\n{noformat}\r\n\r\nThis ticket is to fix the cache implementation and add tests that it works. Currently the Locator unit tests only show that it can handle multibyte input.\r\n\r\nSecond issue is we seem to collect locator information for puppet data types on every request. Since those are immutable, why not do that once and freeze the results for the lifetime of the process?\r\n\r\n{noformat}\r\nNotice: Locator string=Annotation, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Any, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::CatalogEntryType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::ScalarDataType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::ScalarType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::NumericType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::ScalarDataType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::ScalarDataType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::NumericType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::ScalarDataType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::CollectionType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::ScalarType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::ScalarType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::ScalarType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::StructElement, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::ScalarDataType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::ScalarType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::CollectionType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::CatalogEntryType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Pcore::AnyType, file=, index=, char_offsets=false\r\nNotice: Locator string=Puppet::Resource::Param, file=, index=, char_offsets=false\r\nNotice: Locator string=Puppet::Resource::Param, file=, index=, char_offsets=false\r\nNotice: Locator string=Any, file=, index=, char_offsets=false\r\nNotice: Locator string=RichDataKey, file=, index=, char_offsets=false\r\nNotice: Locator string=RichData, file=, index=, char_offsets=false\r\n{noformat}","closed_at":"2018-02-15T06:49:16.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8247","labels":"","state":"Closed","updated_at":"2018-02-15T06:49:16.000-0800","timestamp":1652285533.440783,"priority":"Normal","status_category":"Done","pull_request":6450},{"issue_id":"222712","title":"The PAL API evaluation methods does not instantiate definitions","url":"https://tickets.puppetlabs.com/browse/PUP-8185","created_at":"2017-11-18T03:27:02.000-0800","number":"PUP-8185","body":"When using Puppet::Pal to evaluate string, file, or parsed model, the methods does not instantiate the definitions (functions, plans, etc). The only way to get definitions is to define the environment with a main manifest.\r\n\r\nThe evaluating methods should also instantiate the definitions.","closed_at":"2018-02-15T06:49:16.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8185","labels":"","state":"Closed","updated_at":"2018-02-15T06:49:16.000-0800","timestamp":1652285533.544394,"priority":"Major","status_category":"Done","pull_request":6373},{"issue_id":"231987","title":"NameService inconsistent with setting the environment in which commands are executed","url":"https://tickets.puppetlabs.com/browse/PUP-8374","created_at":"2018-01-19T15:57:15.000-0800","number":"PUP-8374","body":"When we execute commands to create, set, and modify something on the system, we should be maintaining a consistent environment. Currently, when we create that thing, we're passing in a custom environment (as defined in {{lib/puppet/provider/nameservice.rb}})\r\n\r\n{code}\r\n167   def create\r\n168     if exists?\r\n169       info _(\"already exists\")\r\n170       # The object already exists\r\n171       return nil\r\n172     end\r\n173\r\n174     begin\r\n175       execute(self.addcmd, {:failonfail => true, :combine => true, :custom_environment => @custom_environment})\r\n176       if feature?(:manages_password_age) && (cmd = passcmd)\r\n177         execute(cmd)\r\n178       end\r\n179     rescue Puppet::ExecutionFailure => detail\r\n180       raise Puppet::Error, _(\"Could not create %{resource} %{name}: %{detail}\") % { resource: @resource.class.name, name: @resource.name, detail: detail }, detail.backtrace\r\n181     end\r\n182   end\r\n{code}\r\n\r\nbut not when we set or delete with the same command\r\n{code}\r\n184   def delete\r\n185     unless exists?\r\n186       info _(\"already absent\")\r\n187       # the object already doesn't exist\r\n188       return nil\r\n189     end\r\n190\r\n191     begin\r\n192       execute(self.deletecmd)\r\n193     rescue Puppet::ExecutionFailure => detail\r\n194       raise Puppet::Error, _(\"Could not delete %{resource} %{name}: %{detail}\") % { resource: @resource.class.name, name: @resource.name, detail: detail }, detail.backtrace\r\n195     end\r\n196   end\r\n.\r\n.\r\n.\r\n299   def set(param, value)\r\n300     self.class.validate(param, value)\r\n301     cmd = modifycmd(param, munge(param, value))\r\n302     raise Puppet::DevError, _(\"Nameservice command must be an array\") unless cmd.is_a?(Array)\r\n303     begin\r\n304       execute(cmd)\r\n305     rescue Puppet::ExecutionFailure => detail\r\n306       raise Puppet::Error, _(\"Could not set %{param} on %{resource}[%{name}]: %{detail}\") % { param: param, resource: @resource.class.name, name: @resource.name, detail: detail },     detail.backtrace\r\n307     end\r\n308   end\r\n{code}\r\n\r\nAll of these execution environments should be consistent, if that is the desired behavior defined in the provider.","closed_at":"2018-02-15T06:49:17.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8374","labels":"","state":"Closed","updated_at":"2018-02-15T06:49:17.000-0800","timestamp":1652285533.958467,"priority":"Normal","status_category":"Done","pull_request":6619},{"issue_id":"221191","title":"run_script function does not accept arguments","url":"https://tickets.puppetlabs.com/browse/PUP-8137","created_at":"2017-11-09T01:26:33.000-0800","number":"PUP-8137","body":"The run_script function does not accept arguments and does not pass anything on to the Bolt executor. As a result, any attempt to use run_script fails.\r\n\r\nThe run_script function should accept a variable number of {{String}} arguments. The data type is {{String}} because the arguments are basically arguments as given on a command line and such can only be strings.","closed_at":"2018-02-15T06:49:17.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8137","labels":"","state":"Closed","updated_at":"2018-02-15T06:49:17.000-0800","timestamp":1652285534.063675,"priority":"Normal","status_category":"Done","pull_request":6347},{"issue_id":"224761","title":"Tidy should only log a notice if there are changes to be made","url":"https://tickets.puppetlabs.com/browse/PUP-8219","created_at":"2017-11-29T17:37:17.000-0800","number":"PUP-8219","body":"If there are 0 files to delete, we still emit a notice message: {{Tidying 0 files}}. The resource should be \"insync\" if there aren't any files to delete.","closed_at":"2018-02-15T06:49:17.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8219","labels":"","state":"Closed","updated_at":"2018-02-15T06:49:17.000-0800","timestamp":1652285534.167517,"priority":"Normal","status_category":"Done","pull_request":6389},{"issue_id":"228129","title":"Puppet rejects tasks with valid non-Data types like 'Hash'","url":"https://tickets.puppetlabs.com/browse/PUP-8283","created_at":"2017-12-21T09:28:17.000-0800","number":"PUP-8283","body":"*Puppet Version:* Bolt\r\n\r\nPuppet Tasks can only accept parameters as JSON. However it should be valid in task metadata to use puppet types that *may* be assignable to JSON like bare {{Hash}}. Puppet seems to be rejecting these\r\n\r\n{code}\r\nError: Failed to load metadata for task example_tasks::hash_get: Task initializer has wrong type, entry 'parameters' entry 'data' entry 'type' expects a Type[Data] value, got Type[Hash] in /Users/adreyer/src/puppetlabs/puppetconf_modules/example_tasks/tasks/hash_get.json\r\n{code}\r\n\r\n\r\n*Desired Behavior:*\r\n\r\nTask metadata that gives parameters types that may be assignable to {{Data}} should be considered valid.\r\n\r\n*Actual Behavior:*\r\n\r\nPuppet refuses to load tasks that use types which are not assignable to {{Data}} like {{Hash}}\r\n","closed_at":"2018-02-15T06:49:18.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8283","labels":"","state":"Closed","updated_at":"2018-02-15T06:49:18.000-0800","timestamp":1652285534.483896,"priority":"Normal","status_category":"Done","pull_request":6479},{"issue_id":"221194","title":"Ruby true and false should be inferred to corresponding parameterized Boolean data type","url":"https://tickets.puppetlabs.com/browse/PUP-8138","created_at":"2017-11-09T01:48:43.000-0800","number":"PUP-8138","body":"This ticket addresses an oversight in the implementation of PUP-8117. The {{TypeCalculator}} should of course infer {{true}} to {{Boolean\\[true]}} and false to {{Boolean\\[false]}}. They are presently just inferred as {{Boolean}}","closed_at":"2018-02-15T06:49:18.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8138","labels":"","state":"Closed","updated_at":"2018-02-15T06:49:18.000-0800","timestamp":1652285534.589642,"priority":"Normal","status_category":"Done","pull_request":6346},{"issue_id":"223845","title":"loader.discover(:type) with --tasks on crashes because it tries to load rake tasks in puppet","url":"https://tickets.puppetlabs.com/browse/PUP-8204","created_at":"2017-11-22T15:26:17.000-0800","number":"PUP-8204","body":"The puppet code base has a directory named \"tasks\" that contains rake tasks.\r\nWhen trying to discover all data types and --tasks is on, the loader will try to load those as if they were instances of Task.\r\n\r\nThis fails miserably in task_instantiator with the following stack trace:\r\n{code}\r\n     Failure/Error: constants['executable'] = Pathname(task_source).relative_path_from(Pathname(loader.path) + 'tasks').to_s\r\n\r\n     Puppet::Error:\r\n       no implicit conversion of nil into String on node henrik2\r\n     # ./lib/puppet/pops/loader/task_instantiator.rb:95:in `initialize'\r\n     # ./lib/puppet/pops/loader/task_instantiator.rb:95:in `Pathname'\r\n     # ./lib/puppet/pops/loader/task_instantiator.rb:95:in `create_task_type_from_hash'\r\n     # ./lib/puppet/pops/loader/task_instantiator.rb:31:in `create_task_type'\r\n     # ./lib/puppet/pops/loader/task_instantiator.rb:26:in `create'\r\n     # ./lib/puppet/pops/loader/module_loaders.rb:222:in `instantiate'\r\n     # ./lib/puppet/pops/loader/module_loaders.rb:198:in `find'\r\n     # ./lib/puppet/pops/loader/base_loader.rb:161:in `internal_load'\r\n     # ./lib/puppet/pops/loader/base_loader.rb:42:in `load_typed'\r\n     # ./lib/puppet/pops/loader/module_loaders.rb:117:in `block (2 levels) in discover'\r\n     # ./lib/puppet/pops/loader/module_loaders.rb:114:in `each'\r\n     # ./lib/puppet/pops/loader/module_loaders.rb:114:in `block in discover'\r\n     # ./lib/puppet/pops/loader/module_loaders.rb:113:in `each'\r\n     # ./lib/puppet/pops/loader/module_loaders.rb:113:in `discover'\r\n     # ./lib/puppet/pops/loader/base_loader.rb:28:in `discover'\r\n     # ./lib/puppet/pops/loader/module_loaders.rb:121:in `discover'\r\n     # ./lib/puppet/pops/loader/dependency_loader.rb:28:in `block in discover'\r\n     # ./lib/puppet/pops/loader/dependency_loader.rb:28:in `each'\r\n     # ./lib/puppet/pops/loader/dependency_loader.rb:28:in `discover'\r\n     # ./lib/puppet_pal.rb:213:in `list_loadable_kind'\r\n     # ./lib/puppet_pal.rb:265:in `list_tasks'\r\n     # ./spec/unit/puppet_pal_2pec.rb:674:in `block (7 levels) in <top (required)>'\r\n     # ./lib/puppet_pal.rb:611:in `call'\r\n     # ./lib/puppet_pal.rb:611:in `block (2 levels) in main'\r\n     # ./lib/puppet/parser/script_compiler.rb:47:in `block in compile'\r\n     # ./lib/puppet/context.rb:65:in `override'\r\n     # ./lib/puppet.rb:263:in `override'\r\n     # ./lib/puppet/parser/script_compiler.rb:42:in `compile'\r\n     # ./lib/puppet_pal.rb:609:in `block in main'\r\n     # ./lib/puppet/context.rb:65:in `override'\r\n     # ./lib/puppet.rb:263:in `override'\r\n     # ./lib/puppet_pal.rb:578:in `main'\r\n     # ./lib/puppet_pal.rb:341:in `block in with_script_compiler'\r\n     # ./lib/puppet/context.rb:65:in `override'\r\n     # ./lib/puppet.rb:263:in `override'\r\n     # ./lib/puppet_pal.rb:338:in `with_script_compiler'\r\n     # ./spec/unit/puppet_pal_2pec.rb:674:in `block (6 levels) in <top (required)>'\r\n     # ./lib/puppet_pal.rb:506:in `call'\r\n     # ./lib/puppet_pal.rb:506:in `block in in_environment_context'\r\n     # ./lib/puppet/context.rb:65:in `override'\r\n     # ./lib/puppet.rb:263:in `override'\r\n     # ./lib/puppet_pal.rb:498:in `in_environment_context'\r\n     # ./lib/puppet_pal.rb:398:in `in_tmp_environment'\r\n     # ./spec/unit/puppet_pal_2pec.rb:673:in `block (5 levels) in <top (required)>'\r\n{code}\r\n\r\nIt fails because loader.path is nil. The real problem is that it should not try to load tasks from puppet in that location.","closed_at":"2018-02-15T06:49:19.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8204","labels":"","state":"Closed","updated_at":"2018-02-15T06:49:19.000-0800","timestamp":1652285534.693464,"priority":"Major","status_category":"Done","pull_request":6391},{"issue_id":"220050","title":"Init[T] close to unusuable due to relaxed signatures in several core data types","url":"https://tickets.puppetlabs.com/browse/PUP-8121","created_at":"2017-11-02T09:18:15.000-0700","number":"PUP-8121","body":"A total \"WAT\" feast occurs when trying to use {{Init}} data type with several of the core data types.\r\n{code:puppet}\r\n\"blue\" =~ Init[Boolean]  # true - WAT\r\n\"sock\" =~ Init[Integer] # true - WAT\r\n\"salami\" =~ Init[Float] # true - WAT\r\n{code}\r\n...this because the {{new}} method is typed to accept {{String}} instead of an appropriately constrained string.\r\n\r\nReview all new operator signatures for the core type to ensure that only acceptable initialization values match an Init. ","closed_at":"2018-02-15T06:49:19.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8121","labels":"","state":"Closed","updated_at":"2018-02-15T06:49:19.000-0800","timestamp":1652285534.798736,"priority":"Major","status_category":"Done","pull_request":6336},{"issue_id":"212189","title":"gem package provider doesn't match exact on windows","url":"https://tickets.puppetlabs.com/browse/PUP-7973","created_at":"2017-09-21T11:40:38.000-0700","number":"PUP-7973","body":"When calling the gemlist and gemsplit commands (https://github.com/puppetlabs/puppet/blob/5.2.0/lib/puppet/provider/package/gem.rb#L22-L71) the provider attempts an exact match with {{^}} and {{$}} however on windows only the {{$}} is honored:\r\n{noformat}\r\nC:\\Program Files\\Puppet Labs\\Puppet\\sys\\ruby\\bin>gem.bat list --remote ^pry$\r\n\r\n*** REMOTE GEMS ***\r\n\r\nawesome-pry (0.0.4)\r\nawesome_pry (0.0.1)\r\nbetter_errors-pry (1.0.2)\r\ndebugger-pry (0.1.1)\r\ndontkillmypry (0.0.1)\r\nfog-pry (0.0.1)\r\nlemme-pry (0.5.0)\r\nmiddleman-pry (1.0.1)\r\npry (0.11.0 ruby java, 0.10.2 i386-mingw32 i386-mswin32 x64-mingw32)\r\nrack-webconsole-pry (0.1.9)\r\nrails-console-pry (0.0.5)\r\nrails-pry (0.0.1)\r\nruby-debug-pry (0.0.3)\r\nspry (0.0.2)\r\nsuper-pry (0.1.1)\r\nweb-console-pry (0.2.1)\r\n{noformat}\r\n\r\nIf instead we use {{\\A}} and {{\\z}} then it functions as expected:\r\n\r\n{noformat}\r\nC:\\Program Files\\Puppet Labs\\Puppet\\sys\\ruby\\bin>gem.bat list --remote \\Apry\\z\r\n\r\n*** REMOTE GEMS ***\r\n\r\npry (0.11.0 ruby java, 0.10.2 i386-mingw32 i386-mswin32 x64-mingw32)\r\n{noformat}","closed_at":"2018-02-15T06:50:14.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7973","labels":"","state":"Closed","updated_at":"2018-02-15T06:50:14.000-0800","timestamp":1652285535.020219,"priority":"Normal","status_category":"Done","pull_request":6227},{"issue_id":"210505","title":"Scope.to_s fails if there is no source and no path to env in Environment obj","url":"https://tickets.puppetlabs.com/browse/PUP-7945","created_at":"2017-09-12T13:34:02.000-0700","number":"PUP-7945","body":"If the environment does not refer to an actual environment directory the {{Scope.to_s}} method will fail when running {{puppet script}} since the {{Environment}} instance has a {{nil}} path.","closed_at":"2018-02-15T06:50:16.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7945","labels":"","state":"Closed","updated_at":"2018-02-15T06:50:16.000-0800","timestamp":1652285535.650033,"priority":"Normal","status_category":"Done","pull_request":6199},{"issue_id":"213226","title":"run_task crashes with bad message when passed a string that doesn't represent a task","url":"https://tickets.puppetlabs.com/browse/PUP-7994","created_at":"2017-09-26T08:41:55.000-0700","number":"PUP-7994","body":"When the first argument to run_task is a string that doesn't resolve to a {{Task}}, an attempt is till made to call to #new using the {{nil}} value returned from the loader and errors with \"'new' parameter 'type' expects a Type value, got Undef\".","closed_at":"2018-02-15T06:50:16.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7994","labels":"","state":"Closed","updated_at":"2018-02-15T06:50:16.000-0800","timestamp":1652285535.754308,"priority":"Normal","status_category":"Done","pull_request":6235},{"issue_id":"215714","title":"Add test to assert that task metadata type is validated according to spec.","url":"https://tickets.puppetlabs.com/browse/PUP-8043","created_at":"2017-10-11T00:45:35.000-0700","number":"PUP-8043","body":"The {{Puppet::Pops::Loader::TaskInstantiator}} performs rigid type checking of the task metadata and since the specification for this metadata has changed (\"puppet_task_version\" is now an {{Integer}} rather than a {{String}}), a maint release has been merged to also change the actual type used when performing the check.\r\n\r\nAdditional tests are needed that verifies that the declared type used for the check has 100% conformance to the specification.","closed_at":"2018-02-15T06:50:16.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8043","labels":"","state":"Closed","updated_at":"2018-02-15T06:50:16.000-0800","timestamp":1652285545.770044,"priority":"Normal","status_category":"Done","pull_request":6277},{"issue_id":"217191","title":"cannot extract partial result from errors in plans","url":"https://tickets.puppetlabs.com/browse/PUP-8070","created_at":"2017-10-19T03:24:30.000-0700","number":"PUP-8070","body":"Given a simple task:\r\n\r\n{code}\r\n#!/opt/puppetlabs/puppet/bin/ruby\r\n\r\nrequire 'json'\r\n\r\nputs Time.now\r\nexit 1\r\n{code}\r\n\r\nAnd a plan:\r\n\r\n{code}\r\nplan mymod () {\r\n  $r = run_task(\"mymod::sample\", [\"dev1\"])\r\n  $r.error_nodes.each |$node, $error| {\r\n    notice($node)\r\n    notice($error)\r\n    if $error =~ Error {\r\n      notice($error.partial_result())\r\n    }\r\n  }\r\n}\r\n{code}\r\n\r\nI expect to get the data out of partial result, but:\r\n\r\n{code}\r\nbolt plan run mymod --modules .\r\nWarning: Support for ruby version 2.0.0 is deprecated and will be removed in a future release. See https://docs.puppet.com/puppet/latest/system_requirements.html#ruby for a list of supported ruby versions.\r\n   (at /home/rip/.gem/ruby/gems/bolt-0.5.1/vendored/puppet/lib/puppet.rb:134:in `<module:Puppet>')\r\nNotice: Scope(/home/rip/temp/bolts/mymod/plans/init.pp, 4): dev1\r\nNotice: Scope(/home/rip/temp/bolts/mymod/plans/init.pp, 5): Error({'message' => 'The task failed with exit code 1', 'kind' => 'puppetlabs.tasks/task-error', 'issue_code' => 'TASK_ERROR', 'partial_result' => \"2017-10-19 12:23:59 +0200\\n\", 'details' => {'exit_code' => 1}})\r\nError: Evaluation Error: Unknown function: 'partial_result'. at /home/rip/temp/bolts/mymod/plans/init.pp:6:34 on node dev2.devco.net\r\nExiting because of an error in Puppet code\r\n{code}\r\n","closed_at":"2018-02-15T06:50:16.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8070","labels":"","state":"Closed","updated_at":"2018-02-15T06:50:16.000-0800","timestamp":1652285545.982669,"priority":"Normal","status_category":"Done","pull_request":6291},{"issue_id":"212092","title":"debug message for notify relationship is inaccurate - should be 'notifies' not 'subscribes'","url":"https://tickets.puppetlabs.com/browse/PUP-7969","created_at":"2017-09-20T15:08:43.000-0700","number":"PUP-7969","body":"When a resource subscribes to another resource, the debug output is as you might expect. Given:\r\n\r\n{code}\r\nclass foo {\r\n  exec { 'notify test':\r\n    command => '/usr/bin/true',\r\n    refreshonly => true,\r\n  }\r\n}\r\n\r\nclass test {\r\n  include foo\r\n  exec { 'test':\r\n    command => '/usr/bin/true',\r\n    subscribe => Class['foo'],\r\n  }\r\n}\r\n\r\ninclude test\r\n{code}\r\n\r\nThis debug line is logged:\r\n{code}\r\nDebug: /Stage[main]/Test/Exec[test]/subscribe: subscribes to Class[Foo]\r\n{code}\r\n\r\nAll good so far. But if I have a notify, I get the _same_ line. I.e., given:\r\n{code}\r\n    notify => Class['foo'],\r\n{code}\r\n\r\nI get:\r\n{code}\r\nDebug: /Stage[main]/Test/Exec[test]/notify: subscribes to Class[Foo]\r\n{code}\r\n\r\nThis line should read \"*notifies* Class\\[Foo\\]\", not \"*subscribes* to Class\\[Foo]\".\r\n\r\nThis is important because this aspect of puppet is already hard enough to understand without inaccurate relationship reporting between resources. In puppet it is a very different thing to say something subscribes to another thing vs notifies it.","closed_at":"2018-02-15T06:50:17.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7969","labels":"beginner;the-goods","state":"Closed","updated_at":"2018-02-15T06:50:17.000-0800","timestamp":1652285546.086701,"priority":"Normal","status_category":"Done","pull_request":6427},{"issue_id":"217384","title":"Make it possible to create parameterized Object data types","url":"https://tickets.puppetlabs.com/browse/PUP-8078","created_at":"2017-10-20T02:00:54.000-0700","number":"PUP-8078","body":"It is currently not possible to create an {{Object}} data type that is parameterized. The type itself can thus only be used to filter instances based on their type, not on contents. This is highly desirable in some cases.\r\n\r\nA first implementation should allow parameterized types to be created with filtering logic implemented in Ruby. Later, we might add predefined filters such as using {{Pattern}}, {{String}}, or {{Enum}} to match string attributes, min/max filters for magnitudes, or {{Boolean}} filters to match if attributes have a value or not.\r\n\r\nThe parameters for an {{Object}} type can be added using a new top level property named {{type_parameters}}. The value of this property is a hash similar to {{attributes}} where a parameter declaration is a subset of an attribute declaration. The parameter can have a {{type}} and a {{value}} but is different from an attribute in that a parameter is always optional (a required parameter would break the current pattern where a fully generalized type exists for each parameterized type).\r\n\r\nA parameterized `Object` type, when serialized, must retain the values of its parameters.\r\n\r\nExample:\r\n{code:puppet}\r\ntype Error = Object[\r\n  type_parameters => {\r\n    kind => Variant[String, Regexp, Type[Enum], Type[Pattern]],\r\n    issue_code => Variant[String, Regexp, Type[Enum], Type[Pattern]]\r\n  },\r\n  attributes => {\r\n    message => String[1],\r\n    kind => { type => Optional[String[1]], value => undef },\r\n    issue_code => { type => Optional[String[1]], value => 'ERROR' },\r\n    partial_result => { type => Data, value => undef },\r\n    details => { type => Optional[Hash[String[1],Data]], value => undef },\r\n  }]\r\n{code}\r\n\r\nThe above declaration makes it possible to create a parameterized {{Error}} by either providing no parameters at all, one {{Hash}} parameter with named arguments, or one or two anonymous (positional) arguments.","closed_at":"2018-02-15T06:50:17.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8078","labels":"","state":"Closed","updated_at":"2018-02-15T06:50:17.000-0800","timestamp":1652285546.19112,"priority":"Normal","status_category":"Done","pull_request":6355},{"issue_id":"218980","title":"Add 'acltype' to list of supported ZFS properties","url":"https://tickets.puppetlabs.com/browse/PUP-8098","created_at":"2017-10-27T05:55:24.000-0700","number":"PUP-8098","body":"The property 'acltype' is a valid ZFS property:\r\n\r\n\r\n{noformat}\r\n[root@host ~]# zfs get all zpool1/files | grep acltype\r\nzpool1/files  acltype               posixacl               inherited from zpool1\r\n{noformat}\r\n\r\n","closed_at":"2018-02-15T06:50:18.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8098","labels":"community","state":"Closed","updated_at":"2018-02-15T06:50:18.000-0800","timestamp":1652285546.717639,"priority":"Normal","status_category":"Done","pull_request":6317},{"issue_id":"211477","title":"Puppet uses SHA1 when revoking certificates","url":"https://tickets.puppetlabs.com/browse/PUP-7957","created_at":"2017-09-18T09:22:23.000-0700","number":"PUP-7957","body":"When Puppet revokes a certificate and updates the corresponding CRL, it uses SHA1 for generating the [CRL signature|https://github.com/puppetlabs/puppet/blob/5.2.0/lib/puppet/ssl/certificate_revocation_list.rb#L108]. SHA1 is being deprecated and should be replaced by SHA256 or better.","closed_at":"2018-02-15T06:50:19.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7957","labels":"","state":"Closed","updated_at":"2018-02-15T06:50:19.000-0800","timestamp":1652285547.035517,"priority":"Major","status_category":"Done","pull_request":6210},{"issue_id":"210293","title":"extra \".\" or missing \".\" in csr message","url":"https://tickets.puppetlabs.com/browse/PUP-7937","created_at":"2017-09-11T13:54:57.000-0700","number":"PUP-7937","body":"I was reviewing the puppet.po file for Japanese when I noticed these 2 messages which are very similar. We appear to end a sentence of the message on line 2, but in the 2nd case there is no \".\" before we start the next sentence: \"  To continue\"...\r\n\r\n{code}\r\n#: ../lib/puppet/ssl/certificate_authority.rb:397\r\nmsgid \"\"\r\n\"CSR '%{csr}' contains a subjectAltName outside the DNS label space: \"\r\n\"%{alt_names}.  To continue, this CSR needs to be cleaned.\"\r\nmsgstr \"\"\r\n\"CSR '%{csr}'にDNSラベルスペース外のsubjectAltNameが含まれています: \"\r\n\"%{alt_names}。続行するには、このCSRを削除する必要があります。\"\r\n\r\n#: ../lib/puppet/ssl/certificate_authority.rb:402\r\nmsgid \"\"\r\n\"CSR '%{csr}' subjectAltName contains a wildcard, which is not allowed: \"\r\n\"%{alt_names}  To continue, this CSR needs to be cleaned.\"\r\nmsgstr \"\"\r\n\"CSR '%{csr}' subjectAltNameに、許可されていないワイルドカードが含まれています: \"\r\n\"%{alt_names}。続行するには、このCSRを削除する必要があります。 \"\r\n{code}","closed_at":"2018-02-15T06:50:20.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7937","labels":"","state":"Closed","updated_at":"2018-02-15T06:50:20.000-0800","timestamp":1652285547.562878,"priority":"Normal","status_category":"Done","pull_request":6375},{"issue_id":"216664","title":"Failing acceptance tests in FIPS mode","url":"https://tickets.puppetlabs.com/browse/PUP-8066","created_at":"2017-10-17T15:19:26.000-0700","number":"PUP-8066","body":"Following acceptance tests fail when running in FIPS mode using PA linked against system openssl. \r\n\r\n* acceptance/tests/face/loadable_from_modules.rb\r\n* acceptance/tests/loader/func4x_loadable_from_modules.rb\r\n* acceptance/tests/modules/build/build_agent.rb\r\n* acceptance/tests/modules/build/build_should_not_create_changes.rb\r\n* acceptance/tests/modules/install/basic_install.rb\r\n* acceptance/tests/modules/install/with_version.rb\r\n* acceptance/tests/parser_functions/calling_all_functions.rb\r\n* acceptance/tests/puppet_apply_a_file_should_create_a_file_and_report_the_md5.rb\r\n* acceptance/tests/resource/file/content_attribute.rb\r\n* acceptance/tests/ticket_1334_clientbucket_corrupted.rb\r\n* acceptance/tests/ticket_6541_invalid_filebucket_files.rb\r\n\r\nThey need to be investigated and adjusted appropriately.","closed_at":"2018-02-15T06:50:21.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8066","labels":"","state":"Closed","updated_at":"2018-02-15T06:50:21.000-0800","timestamp":1652285548.303134,"priority":"Normal","status_category":"Done","pull_request":6580},{"issue_id":"216292","title":"Error type docs show new from hash - does not work as intended","url":"https://tickets.puppetlabs.com/browse/PUP-8056","created_at":"2017-10-16T04:41:20.000-0700","number":"PUP-8056","body":"The plan error docs https://puppet.com/docs/bolt/0.5/writing_plans.html#returning-errors-in-plans suggest this would work:\r\n\r\n{code}\r\nplan mymodule::myplan {\r\n  Error(\r\n    message    => \"Sorry, this plan does not work yet.\",\r\n    kind       => 'mymodule/error',\r\n    issue_code => 'NOT_IMPLEMENTED'\r\n    )\r\n  }\r\n{code}\r\n\r\nThis gives:\r\n\r\n{code}\r\nError: Evaluation Error: Error while evaluating a Function Call, 'new_error' parameter 'message' expects a String value, got Struct at /home/rip/temp/bolts/mymod/plans/discover.pp:2:3 on node dev2.devco.net\r\n{code}\r\n\r\nAppears the code does not support that syntax it wants params of strings https://github.com/puppetlabs/puppet/blob/7fce55c2395df4c9547220169f82c97bb92b4574/lib/puppet/pops/types/p_error_type.rb#L59\r\n\r\nHenrik points out and I seem to recall that there's something that should allow a hash to be passed in and mapped to param names - this might be the actual thing thats broken (Henrik: yes this is an implementation bug).","closed_at":"2018-02-15T06:50:22.000-0800","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8056","labels":"","state":"Closed","updated_at":"2018-02-15T06:50:22.000-0800","timestamp":1652285548.618605,"priority":"Normal","status_category":"Done","pull_request":6285},{"issue_id":"23162","title":"puppet device cannot create certs when run as root","url":"https://tickets.puppetlabs.com/browse/PUP-1391","created_at":"2014-01-08T02:37:50.000-0800","number":"PUP-1391","body":"broken -- output of `puppet device --debug` when ran as root:\r\n{noformat}\r\ninfo: Creating a new SSL key for 10.0.1.3\r\nerr: Could not request certificate: Could not write /var/opt/lib/pe-puppet/devices/10.0.1.3/ssl/private_keys/10.0.1.3.pem to privatekeydir: Permission denied - /var/opt/lib/pe-puppet/devices/10.0.1.3/ssl/private_keys/10.0.1.3.pem\r\n{noformat}\r\n\r\nsuccess -- output of `puppet device --debug` when ran as a normal user:\r\n{noformat}\r\nwarning: peer certificate won't be verified in this SSL session\r\ninfo: Caching certificate for ca\r\nwarning: peer certificate won't be verified in this SSL session\r\nwarning: peer certificate won't be verified in this SSL session\r\ninfo: Creating a new SSL certificate request for 10.0.1.3\r\ninfo: Certificate Request fingerprint (md5): 6C:1C:4C:37:A7:1D:B3:6E:F3:94:25:67:55:27:89:4C\r\nwarning: peer certificate won't be verified in this SSL session\r\ndebug: Using cached certificate for ca\r\nwarning: peer certificate won't be verified in this SSL session\r\ninfo: Caching certificate for 10.0.1.3\r\n{noformat}\r\n\r\nNote, that you have to copy `/etc/puppetlabs/puppet/device.conf` to `~/.puppet/`","closed_at":"2018-02-15T06:51:34.000-0800","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1391","labels":"redmine","state":"Closed","updated_at":"2018-02-15T06:51:34.000-0800","timestamp":1652285549.459498,"priority":"Normal","status_category":"Done","pull_request":6026},{"issue_id":"207700","title":"Make node_terminus=ldap working with jruby/puppetserver","url":"https://tickets.puppetlabs.com/browse/PUP-7883","created_at":"2017-08-27T00:31:50.000-0700","number":"PUP-7883","body":"* jruby-ldap does not provide a to_hash method - add a ldap_entry_to_hash() method based on jruby-ldap PR#5\r\n* the environment parameter from ldap was accessed with a string instead of a symbol (or the PR#5 in jruby-ldap did not replicate ruby-ldap's behaviour correctly)\r\n* remove environment from parameters hash to prevent duplicate declaration error\r\n* downcase key in ldap_entry_to_hash for consistent key names and to ensure acceptable puppet variable names (first char needs to be lowercase in any case)\r\n\r\nSee also: SERVER-711, https://github.com/jruby/jruby-ldap/pull/5, https://groups.google.com/forum/#!topic/puppet-users/DKu4e7dzhvE","closed_at":"2018-02-15T06:51:34.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7883","labels":"","state":"Closed","updated_at":"2018-02-15T06:51:34.000-0800","timestamp":1652285549.56626,"priority":"Normal","status_category":"Done","pull_request":6154},{"issue_id":"196301","title":"The ZFS zoned property is not portable","url":"https://tickets.puppetlabs.com/browse/PUP-7672","created_at":"2017-06-16T05:16:25.000-0700","number":"PUP-7672","body":"On Solaris ZFS has a 'zoned' property. On Linux it's a noop, on FreeBSD it is called 'jailed'.  \r\n\r\nExemple :\r\n\r\n{noformat}\r\n$ bundle exec puppet resource zfs\r\nError: Could not run: Execution of '/sbin/zfs get -H -o value zoned SSD' returned 2: bad property list: invalid property 'zoned'\r\n{noformat}\r\n\r\n{{/sbin/zfs get -H -o value zoned SSD}} should be {{/sbin/zfs get -H -o value jailed SSD}} on FreeBSD","closed_at":"2018-02-15T06:51:36.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7672","labels":"","state":"Closed","updated_at":"2018-02-15T06:51:36.000-0800","timestamp":1652285549.881923,"priority":"Normal","status_category":"Done","pull_request":6282},{"issue_id":"66895","title":"Error message gives wrong advice for allowed module names","url":"https://tickets.puppetlabs.com/browse/PUP-3963","created_at":"2015-02-04T16:56:57.000-0800","number":"PUP-3963","body":"Under some conditions, Puppet will issue an error message like {{Error: Invalid module name .gitignore; module names must be alphanumeric (plus '-'), not '.gitignore'}}. \r\n\r\nThat's wrong! You should definitely never have hyphens in your module names, but underscores are encouraged. \r\n\r\nThe docs do not list hyphens as valid characters in module and class names, and we've publicly stated for years that it's a bug that it works and we'll make it stop working at our earliest convenience. \r\n\r\nHere's the relevant code:\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/master/lib/puppet/module.rb#L343","closed_at":"2018-02-15T06:51:37.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3963","labels":"beginner;community;puppethack;the-goods","state":"Closed","updated_at":"2018-02-15T06:51:37.000-0800","timestamp":1652285550.51255,"priority":"Normal","status_category":"Done","pull_request":6428},{"issue_id":"198699","title":"package latest method does not refresh metadata on Solaris","url":"https://tickets.puppetlabs.com/browse/PUP-7745","created_at":"2017-06-30T11:28:49.000-0700","number":"PUP-7745","body":"The current behavior from `latest` does not refresh package metadata. \r\n\r\nSimply adding `pkg(:refresh)` to `latest` addresses the minor issue. \r\n\r\nA refactor to use `pkg update -n res` will be undertaken at a later date.","closed_at":"2018-02-15T06:51:38.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7745","labels":"","state":"Closed","updated_at":"2018-02-15T06:51:38.000-0800","timestamp":1652285550.617546,"priority":"Normal","status_category":"Done","pull_request":6033},{"issue_id":"120825","title":"puppet apply -e states \"syntax error at end of file\" when there is no file","url":"https://tickets.puppetlabs.com/browse/PUP-6043","created_at":"2016-03-10T16:34:20.000-0800","number":"PUP-6043","body":"{code}\r\n$> puppet apply -e 'assert_type(type(Integer, \"yes. hello\")'\r\nError: Could not parse for environment production: Syntax error at end of file on node r794dzncqml7hgf.delivery.puppetlabs.net\r\n{code}\r\n\r\ni believe this is a regression, or duplicate ticket, but i could not find the older ticket (if it exists)","closed_at":"2018-02-15T06:51:38.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6043","labels":"","state":"Closed","updated_at":"2018-02-15T06:51:38.000-0800","timestamp":1652285550.940174,"priority":"Minor","status_category":"Done","pull_request":6419},{"issue_id":"91330","title":"\"puppet module build\" fails on FIPS-enabled system","url":"https://tickets.puppetlabs.com/browse/PUP-4963","created_at":"2015-07-30T15:39:47.000-0700","number":"PUP-4963","body":"When I try to run {{puppet module build .}} to package up my module, the following messages happen:\r\n\r\n{noformat}\r\nmd5_dgst.c(78): OpenSSL internal error, assertion failed: Digest MD5 forbidden in FIPS mode!\r\nAborted (core dumped)\r\n{noformat}\r\n\r\nAnd it doesn't make the tar.gz I wanted it to.\r\n\r\nThe Ruby code that causes the crash(*) is the checksum method of the Puppet::ModuleTool::Checksums module, in lib/puppet/module_tool/checksums.rb. I looked in the source of 3.7.4, in my oldest copy of Puppet (2.7.something), and in the trunk on GitHub, and found in all places that the module_tool/checksums.rb solely uses MD5, which does not work in FIPS mode.\r\n\r\nIn the case of Puppet itself (PUP-1840), the fix for the failure of MD5 under FIPS mode was to let FIPS users dictate the digest algorithm to be used at their own site. This issue, in contrast, appears to be a matter of the definition of a Puppet module, and therefore necessarily global. Does the definition of checksums.json allow solely for MD5 checksums? \r\n\r\nAside: My Ruby interpreter (1.8.7.374-4.el6_6), like all Ruby interpreters, has the bug reported at https://bugs.ruby-lang.org/issues/9659, which makes the Ruby interpreter crash when Digest::MD5 is used in FIPS mode, instead of raising an exception. You may note that the issue has languished, even though a patch has been provided. If anyone else, who worked for a company that uses Ruby a lot, were to want this rough edge of Ruby filed off, they may want to tell the Ruby folks.\r\n\r\n(*) To get the Ruby backtrace, I ran `puppet module build` inside gdb, and used the trick from http://weblog.jamisbuck.org/2006/9/22/inspecting-a-live-ruby-process to get the Ruby backtrace. On a 64-bit system, I had to use \"long\" instead of \"int\", 16 instead of 8, and 24 instead of 12.","closed_at":"2018-02-15T06:51:38.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4963","labels":"fips;help_wanted","state":"Closed","updated_at":"2018-02-15T06:51:38.000-0800","timestamp":1652285551.050617,"priority":"Normal","status_category":"Done","pull_request":6508},{"issue_id":"159155","title":"OSX: Warning output when using puppet resource service","url":"https://tickets.puppetlabs.com/browse/PUP-6854","created_at":"2016-11-01T03:47:47.000-0700","number":"PUP-6854","body":"_puppet resource service .*_ always seems to include some warning output.\r\npuppet seems to be able to query and modify services despite the warning.\r\n\r\n{code}rfoie66a86vs98y:~ root# puppet resource service puppet\r\nWarning: The /System/Library/LaunchDaemons/com.apple.jetsamproperties.Mac.plist plist does not contain a 'label' key; Puppet is skipping it\r\nservice { 'puppet':\r\n  ensure => 'stopped',\r\n  enable => 'false',\r\n}\r\nrfoie66a86vs98y:~ root# puppet resource service pxp-agent\r\nWarning: The /System/Library/LaunchDaemons/com.apple.jetsamproperties.Mac.plist plist does not contain a 'label' key; Puppet is skipping it\r\nservice { 'pxp-agent':\r\n  ensure => 'running',\r\n  enable => 'true',\r\n}\r\nrfoie66a86vs98y:~ root# puppet resource service dragons\r\nWarning: The /System/Library/LaunchDaemons/com.apple.jetsamproperties.Mac.plist plist does not contain a 'label' key; Puppet is skipping it\r\nservice { 'dragons':\r\n  ensure => 'absent',\r\n}{code}","closed_at":"2018-02-15T06:51:41.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6854","labels":"","state":"Closed","updated_at":"2018-02-15T06:51:41.000-0800","timestamp":1652285551.645188,"priority":"Normal","status_category":"Done","pull_request":5730},{"issue_id":"102773","title":"config set ignores --section and can insert duplicate settings if they are in [main]","url":"https://tickets.puppetlabs.com/browse/PUP-5426","created_at":"2015-10-23T14:27:02.000-0700","number":"PUP-5426","body":"{code}\r\n[root@qcpd7c0tnvnp4kd ~]# cat /etc/puppetlabs/puppet/puppet.conf\r\n# This file can be used to override the default puppet settings.\r\n# See the following links for more details on what settings are available:\r\n# - https://docs.puppetlabs.com/puppet/latest/reference/config_important_settings.html\r\n# - https://docs.puppetlabs.com/puppet/latest/reference/config_about_settings.html\r\n# - https://docs.puppetlabs.com/puppet/latest/reference/config_file_main.html\r\n# - https://docs.puppetlabs.com/references/latest/configuration.html\r\n[main]\r\nserver = exl7i0vi62ouagu.delivery.puppetlabs.net\r\nenvironment = production\r\n[agent]\r\ncertname = qcpd7c0tnvnp4kd.delivery.puppetlabs.net\r\nserver = exl7i0vi62ouagu.delivery.puppetlabs.net\r\n[root@qcpd7c0tnvnp4kd ~]# puppet config set environment node_ordering --section agent\r\n[root@qcpd7c0tnvnp4kd ~]# cat /etc/puppetlabs/puppet/puppet.conf\r\n# This file can be used to override the default puppet settings.\r\n# See the following links for more details on what settings are available:\r\n# - https://docs.puppetlabs.com/puppet/latest/reference/config_important_settings.html\r\n# - https://docs.puppetlabs.com/puppet/latest/reference/config_about_settings.html\r\n# - https://docs.puppetlabs.com/puppet/latest/reference/config_file_main.html\r\n# - https://docs.puppetlabs.com/references/latest/configuration.html\r\n[main]\r\nserver = exl7i0vi62ouagu.delivery.puppetlabs.net\r\nenvironment = node_ordering\r\nenvironment = production\r\n[agent]\r\ncertname = qcpd7c0tnvnp4kd.delivery.puppetlabs.net\r\nserver = exl7i0vi62ouagu.delivery.puppetlabs.net\r\n{code}","closed_at":"2018-02-15T06:51:42.000-0800","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5426","labels":"","state":"Closed","updated_at":"2018-02-15T06:51:42.000-0800","timestamp":1652285551.856315,"priority":"Normal","status_category":"Done","pull_request":6562},{"issue_id":"203364","title":"AIX mount resource remounts without options","url":"https://tickets.puppetlabs.com/browse/PUP-7807","created_at":"2017-08-01T08:49:35.000-0700","number":"PUP-7807","body":"When using NFS mounts on an AIX agent with the mount resource, the remount does not ensure the options persist. The `mount -o remount filesystem` does not read from `/etc/filesystems` on AIX so the options are not present in the remount.\r\n\r\nBelow is an example of a remount that strips the options from the mount on a remount. \r\n\r\n{code}\r\n0] [AIX] root@pe-aix-71-support:~ # mount\r\n  node       mounted        mounted over    vfs       date        options\r\n-------- ---------------  ---------------  ------ ------------ ---------------\r\n10.32.171.166 /tmp/test        /mnt/test        nfs3   Aug 01 08:47 rw,bg,hard,nointr,rsize=32768,wsize=32768,timeo=600\r\n[0] [AIX] root@pe-aix-71-support:~ # puppet apply mount.pp\r\nNotice: Compiled catalog for pe-aix-71-support.delivery.puppetlabs.net in environment production in 0.18 seconds\r\nNotice: /Stage[main]/Main/Mount[/mnt/test]/options: options changed 'rw,bg,hard,nointr,rsize=32768,wsize=32768,timeo=600,account=true,mount=true' to 'rw,bg,hard,nointr,rsize=32768,wsize=32768,timeo=600,mount=true,account=true,'\r\nNotice: /Stage[main]/Main/Mount[/mnt/test]: Triggered 'refresh' from 1 events\r\nNotice: Applied catalog in 0.22 seconds\r\n[0] [AIX] root@pe-aix-71-support:~ # mount\r\n  node       mounted        mounted over    vfs       date        options\r\n-------- ---------------  ---------------  ------ ------------ ---------------\r\n10.32.171.166 /tmp/test        /mnt/test        nfs3   Aug 01 08:47\r\n{code}","closed_at":"2018-02-15T06:51:42.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7807","labels":"","state":"Closed","updated_at":"2018-02-15T06:51:42.000-0800","timestamp":1652285551.963297,"priority":"Normal","status_category":"Done","pull_request":6283},{"issue_id":"200584","title":"yumrepo don't support payload_gpgcheck option","url":"https://tickets.puppetlabs.com/browse/PUP-7781","created_at":"2017-07-15T01:55:10.000-0700","number":"PUP-7781","body":"Since RHEL 7.4 an new yum repo option is available to verify the payload of an rpm package.\r\nSee [here|https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7-Beta/html/7.4_Release_Notes/new_features_system_and_subscription_management.html] for the description of it. ","closed_at":"2018-02-15T06:51:43.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7781","labels":"","state":"Closed","updated_at":"2018-02-15T06:51:43.000-0800","timestamp":1652285552.179428,"priority":"Normal","status_category":"Done","pull_request":6075},{"issue_id":"52027","title":"config set adds a preceding newline to value if previous value was empty","url":"https://tickets.puppetlabs.com/browse/PUP-3321","created_at":"2014-09-19T16:32:11.000-0700","number":"PUP-3321","body":"Using `puppet config set` to set a value if the value was previously present, puts the value on a separate line and makes the config file unparsable.\r\n\r\nSteps to reproduce\r\n1. Either add a config entry by hand or with config set with no value\r\n2. Use `puppet config set` to set the entry with a value\r\n\r\nResult: The value is placed on a separate line.\r\n\r\nExample session showing the error:\r\n{code}\r\n[root@centos6-64-ma environmentpath.6nQgZ4]# cat my.conf \r\n[main]\r\n    foo = bar\r\n    bar = baz\r\n[root@centos6-64-ma environmentpath.6nQgZ4]# puppet config  set foo '' --section main --config my.conf \r\n[root@centos6-64-ma environmentpath.6nQgZ4]# cat my.conf \r\n[main]\r\n    foo = \r\n    bar = baz\r\n[root@centos6-64-ma environmentpath.6nQgZ4]# puppet config  set foo 'bar' --section main --config my.conf \r\n[root@centos6-64-ma environmentpath.6nQgZ4]# cat my.conf \r\n[main]\r\n    foo = \r\nbar\r\n    bar = baz\r\n[root@centos6-64-ma environmentpath.6nQgZ4]# puppet config  set foo 'foo' --section main --config my.conf \r\nError: Could not parse /tmp/environmentpath.6nQgZ4/my.conf: Could not match line bar\r\n at /tmp/environmentpath.6nQgZ4/my.conf:3\r\n{code}","closed_at":"2018-02-15T06:51:43.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3321","labels":"","state":"Closed","updated_at":"2018-02-15T06:51:43.000-0800","timestamp":1652285552.487892,"priority":"Normal","status_category":"Done","pull_request":6592},{"issue_id":"212111","title":"In module ruby loading does not work in Pal API","url":"https://tickets.puppetlabs.com/browse/PUP-8007","created_at":"2017-09-20T16:56:22.000-0700","number":"PUP-8007","body":"I was hacking on some bolt plans today, specifically how I could re-use existing Puppet functions to augment plans.  I've ran into an issue where bolt isn't loading some code shipped in modules.\r\n\r\nWhen Google built the recent release of the GCP modules they added a lot of in ruby module code: {{https://github.com/GoogleCloudPlatform/puppet-google-auth/blob/master/lib/google/authorization.rb}}.  If I use a function that requires {{google/authorization}} then I get a failure in bolt but not when running a {{puppet apply}}.\r\n","closed_at":"2018-02-15T06:58:01.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8007","labels":"","state":"Closed","updated_at":"2018-02-15T06:58:01.000-0800","timestamp":1652285552.797416,"priority":"Normal","status_category":"Done","pull_request":6249},{"issue_id":"214732","title":"Puppet considers directories as tasks","url":"https://tickets.puppetlabs.com/browse/PUP-8028","created_at":"2017-10-05T10:39:44.000-0700","number":"PUP-8028","body":"When puppet loads tasks from a module it does not exclude directories this means that \r\n\r\nCurrently the following module has two tasks:\r\n<module>\r\n<module>::foo\r\nIt should only have a single task <module> and the directory should be ignore.\r\n{noformat}\r\n.\r\n└── tasks\r\n    ├── foo\r\n    │   └── bar.sh\r\n    ├── init.json\r\n    └── init.rb\r\n{noformat}","closed_at":"2018-02-15T06:58:01.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8028","labels":"","state":"Closed","updated_at":"2018-02-15T06:58:01.000-0800","timestamp":1652285552.900946,"priority":"Normal","status_category":"Done","pull_request":6279},{"issue_id":"226845","title":"Cached catalogs settings are ignored if noop is set to true","url":"https://tickets.puppetlabs.com/browse/PUP-8258","created_at":"2017-12-15T11:26:39.000-0800","number":"PUP-8258","body":"When using the following configuration options together:\r\n\r\n{code}\r\n[agent]\r\nuse_cached_catalog = true\r\nnoop = true\r\n{code}\r\n\r\nCached catalogs settings are ignored and a new catalog is compiled every run.  It is desirable to use both of these items together if you are controlling the rollout of changes (cached catalogs) and having to do so during change windows (noop); but still want the ability to remediate drift against the original catalog (cached catalogs; `puppet agent -t`).  \r\n\r\n","closed_at":"2018-02-15T11:28:25.000-0800","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8258","labels":"","state":"Closed","updated_at":"2018-02-15T11:28:25.000-0800","timestamp":1652285553.005555,"priority":"Major","status_category":"Done","pull_request":6600},{"issue_id":"216691","title":"Selector expression ignored in some scenarios","url":"https://tickets.puppetlabs.com/browse/PUP-8067","created_at":"2017-10-17T16:55:38.000-0700","number":"PUP-8067","body":"Hello,\r\n\r\nIn some situations, a selector expression will be ignored in favor of the statement that it's testing. This seems like an operator precedence problem.\r\n\r\nThe following manifest should notify two lines, \"I am an array\", and \"I am still an array\":\r\n{code:puppet}\r\n$value = 'nonsense'\r\n\r\n$test = [\r\n  'I am',\r\n  $value =~ Array ? {\r\n    default => 'not an array',\r\n    true    => 'an array',\r\n  },\r\n].join(' ')\r\n\r\n$test2 = [\r\n  'I am still',\r\n  ($value =~ Array) ? {\r\n    default => 'not an array',\r\n    true    => 'an array',\r\n  },\r\n].join(' ')\r\n\r\nnotify{ $test: }\r\nnotify{ $test2: }\r\n{code}\r\nInstead, the first notify becomes \"I am false\", because \"$value =~ Array\" resolves without consulting the selector.\r\nThe parentheses in $test2's assignment seem to workaround this behavior. \r\n\r\n\r\nAnd similarly in a function, the same occurs due to implicit returning:\r\n{code:puppet}\r\n$value = 'asdasd'\r\n\r\nfunction test_broken ($item) {\r\n  $value =~ /\\d/ ? {\r\n    default => 'non-numeric',\r\n    true    => 'numeric',\r\n  }\r\n}\r\n\r\nfunction test_works ($item) {\r\n  ($value =~ /\\d/) ? {\r\n    default => 'non-numeric',\r\n    true    => 'numeric',\r\n  }\r\n}\r\n$x = test_broken($value)\r\n$y = test_works($value)\r\nnotify{ \"$x\": }\r\nnotify{ \"$y\": }\r\n{code}\r\n\r\n\r\nThe following manifest should notify 'I am less than or equal to three'::\r\n{code:puppet}\r\n$value = 3\r\n\r\n$test = [\r\n  'I am',\r\n  $value > 3 ? {\r\n    default => 'less than or equal to three',\r\n    true    => 'larger than three',\r\n  },\r\n].join(' ')\r\n{code}\r\nThe parser instead errors with:\r\n\r\n{code}\r\nEvaluation Error: Comparison of: Integer > String, is not possible. Caused by 'A Numeric is not comparable to non Numeric'. at /test.pp:5:10\r\n{code}\r\n\r\nIf I can provide further information or help in any way with this issue, please let me know.","closed_at":"2018-02-17T09:19:35.000-0800","comments":17,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8067","labels":"parser;selector","state":"Closed","updated_at":"2018-02-17T09:19:35.000-0800","timestamp":1652285553.217183,"priority":"Normal","status_category":"Done","pull_request":6352},{"issue_id":"154391","title":"systemd provider does not understand \"indirect\" status / tries to turn off service on each run","url":"https://tickets.puppetlabs.com/browse/PUP-6759","created_at":"2016-09-30T04:37:00.000-0700","number":"PUP-6759","body":"Following occurs with each puppet run, which causes annoyance:\r\n_*Service[rpcbind]/enable: enable changed 'true' to 'false'*_\r\n\r\nThe rpcbind service returns \"indirect\" as a status to is-enabled\r\n_*/bin/systemctl is-enabled rpcbind\r\nindirect*_\r\n\r\nThis presumably causes puppet to constantly think it's not turned off (standard output should be enabled/disabled\r\n\r\nAdditional info from systemctl\r\n_*/bin/systemctl status  rpcbind.service\r\nâ rpcbind.service - RPC bind service\r\n   Loaded: loaded (/usr/lib/systemd/system/rpcbind.service; indirect; vendor preset: enabled)\r\n   Active: inactive (dead)*\r\n_\r\n\r\nNote that a workaround is to set enable to \"true\" and ensure to \"stopped\" to keep it stopped, BUT that requires the hosts to have rpcbind installed - if it is not then it produces an error in the puppet run.","closed_at":"2018-02-28T02:46:16.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6759","labels":"maintenance;provider;resolved-issue-added;systemd","state":"Resolved","updated_at":"2018-02-28T02:46:16.000-0800","timestamp":1652285554.257433,"priority":"Normal","status_category":"Done","pull_request":5387},{"issue_id":"111721","title":"yumrepo doesn't handle enabled => false correctly","url":"https://tickets.puppetlabs.com/browse/PUP-5682","created_at":"2016-01-09T02:08:25.000-0800","number":"PUP-5682","body":"This code:\r\n{code}\r\n  yumrepo { 'puppetlabs-pc1':\r\n    ensure   => present,\r\n    baseurl  => 'http://yum.puppetlabs.com/el/7/dependencies/$basearch',\r\n    descr    => 'Puppet Labs PC1 Repository el 7 - $basearch',\r\n    enabled  => false,\r\n    gpgkey   => 'file:///etc/pki/rpm-gpg/RPM-GPG-KEY-puppetlabs-PC1',\r\n    gpgcheck => false,\r\n  }\r\n{code}\r\n\r\nGenerates this repo file:\r\n{code}\r\n[puppetlabs-pc1]\r\nname=Puppet Labs PC1 Repository el 7 - $basearch\r\nbaseurl=http://yum.puppetlabs.com/el/7/dependencies/$basearch\r\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-puppetlabs-PC1\r\n{code}\r\n\r\n`enabled` and `gpgcheck` are now missing from the configuration, and the yum default seems to be to enable the repository:\r\n{code}\r\n[root@node1 vagrant]# yum repolist\r\nLoaded plugins: fastestmirror\r\nLoading mirror speeds from cached hostfile\r\n * base: ftp-stud.fht-esslingen.de\r\n * extras: mirror.ratiokontakt.de\r\n * updates: ftp-stud.fht-esslingen.de\r\nrepo id                                                   repo name                                                                    status\r\nbase/7/x86_64                                             CentOS-7 - Base                                                              9,007\r\nextras/7/x86_64                                           CentOS-7 - Extras                                                              191\r\npuppetlabs-pc1/x86_64                                     Puppet Labs PC1 Repository el 7 - x86_64                                        17\r\nupdates/7/x86_64                                          CentOS-7 - Updates                                                             458\r\nrepolist: 9,673\r\n{code}\r\n\r\nIt works when it's being used like this:\r\n{code}\r\n  yumrepo { 'puppetlabs-pc1':\r\n    ensure   => present,\r\n    baseurl  => 'http://yum.puppetlabs.com/el/7/dependencies/$basearch',\r\n    descr    => 'Puppet Labs PC1 Repository el 7 - $basearch',\r\n    enabled  => 'false',\r\n    gpgkey   => 'file:///etc/pki/rpm-gpg/RPM-GPG-KEY-puppetlabs-PC1',\r\n    gpgcheck => 'false',\r\n  }\r\n{code}\r\n\r\nTested this on the following systems and got the same behavior:\r\nPuppet 4.3.1 on CentOS 7.0.1406\r\nPuppet 3.8.4 on CentOS 6.6\r\n\r\nNote that if you previously set\r\n{code}\r\n  enabled => 'true',\r\n{code}\r\n\r\nand then switch this later to: \r\n{code}\r\n  enabled => false,\r\n{code}\r\nThe repo file will not get changed at all.\r\n\r\n\r\nAlso setting these to true/enabled/yes in the configuration file is undocumented behavior, quote `man yum.conf`:\r\n{quote}\r\nenabled Either `1' or `0'. This tells yum whether or not use this repository.\r\n{quote}","closed_at":"2018-03-08T11:42:27.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5682","labels":"","state":"Closed","updated_at":"2018-03-08T11:42:27.000-0800","timestamp":1652285567.501727,"priority":"Normal","status_category":"Done","pull_request":4450},{"issue_id":"233929","title":"Puppet benchmarks fail due to gettext-setup initialization","url":"https://tickets.puppetlabs.com/browse/PUP-8407","created_at":"2018-01-30T11:11:03.000-0800","number":"PUP-8407","body":"*Puppet Version:* 5.3.x\r\n*Puppet Server Version:* n/a\r\n\r\nRunning puppet benchmarks fails:\r\n\r\n{noformat}\r\n$ bx rake benchmark:many_modules:run\r\nmkdir -p /var/folders/8m/d6146zxd6bv_3h8y4ykvvxh40000gn/T/many_modules20180130-73932-2mw6bc\r\n                 user     system      total        real\r\nRun 1      rake aborted!\r\nno implicit conversion of nil into String\r\n/Users/josh/work/puppet/lib/puppet/module.rb:316:in `join'\r\n/Users/josh/work/puppet/lib/puppet/module.rb:316:in `has_translations?'\r\n/Users/josh/work/puppet/lib/puppet/gettext/module_translations.rb:12:in `block in load_from_modulepath'\r\n/Users/josh/work/puppet/lib/puppet/gettext/module_translations.rb:11:in `each'\r\n/Users/josh/work/puppet/lib/puppet/gettext/module_translations.rb:11:in `load_from_modulepath'\r\n/Users/josh/work/puppet/lib/puppet/node/environment.rb:444:in `use_text_domain'\r\n/Users/josh/work/puppet/lib/puppet/indirector/catalog/compiler.rb:52:in `find'\r\n{noformat}\r\n\r\nThe issue is that puppet sets FastGettext.default_available_locales to nil to prevent FastGettext from selecting the best available default locale. Later puppet's Rakefile loads the gettext-setup gem. It sets FastGettext.default_available_locales to empty string (instead of nil). This activates the \"available locales\" machinery in FastGettext. Then GettextSetup.initialize tries to set the default locale, which due to the empty array causes the default locale to be set to nil.\r\n\r\n{noformat}\r\n(byebug) best_locale_in(new_locale)\r\nnil\r\n(byebug) new_locale\r\n\"en\"\r\n{noformat}\r\n\r\nThis is only an issue when running puppet via the Rakefile, e.g. benchmarks and {{rake parallel:spec}}, not when puppet is running from source, e.g. {{bundle exec puppet agent}} or from packages.","closed_at":"2018-03-12T10:45:57.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8407","labels":"","state":"Closed","updated_at":"2018-03-12T10:45:57.000-0700","timestamp":1652285568.242911,"priority":"Normal","status_category":"Done","pull_request":6591},{"issue_id":"21413","title":"Exported resources is exporting to the database with --noop flag","url":"https://tickets.puppetlabs.com/browse/PUP-1079","created_at":"2013-12-16T11:03:02.000-0800","number":"PUP-1079","body":"When I run puppet with the noop flag resources are being exported to the\r\ndb.\r\n\r\nI would expect it to simulate the transaction with the db...\r\n\r\nThis is causing things like nagios host resources being created before the plugins get there, so I get invalid alerts.\r\n\r\n-Andrew","closed_at":"2018-03-14T02:04:17.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1079","labels":"customer;needs_decision;redmine","state":"Needs Information","updated_at":"2018-03-14T02:04:17.000-0700","timestamp":1652285568.552412,"priority":"Normal","status_category":"To Do","pull_request":8692},{"issue_id":"240442","title":"Validator incorrectly reports result of regexp match as being forgotten","url":"https://tickets.puppetlabs.com/browse/PUP-8537","created_at":"2018-03-08T23:05:28.000-0800","number":"PUP-8537","body":"The following manifest errors when evaluated using {{puppet apply}}:\r\n{code:puppet}\r\n'cdf' =~ /^([a-z])(.*)/\r\nnotice($2)\r\n{code}\r\nThe error is:\r\n{code}\r\nThis '=~' expression has no effect. A value was produced and then forgotten (one or more preceding expressions may have the wrong form)\r\n{code}\r\nThis is not correct since the result of the match is stored in numeric variables $1 ... $n and can be used.\r\n\r\nTurning the comparison into an assignment, i.e.:\r\n{code:puppet}\r\n$x = 'cdf' =~ /^([a-z])(.*)/\r\nnotice($2)\r\n{code}\r\nyields the correct result:\r\n{code}\r\nNotice: Scope(Class[main]): df\r\n{code}\r\n\r\n","closed_at":"2018-03-20T13:28:41.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8537","labels":"Language","state":"Closed","updated_at":"2018-03-20T13:28:41.000-0700","timestamp":1652285569.614107,"priority":"Normal","status_category":"Done","pull_request":6725},{"issue_id":"236090","title":"Topscope 'environment' can become nil when setting node parameters in a custom terminus","url":"https://tickets.puppetlabs.com/browse/PUP-8443","created_at":"2018-02-09T12:33:22.000-0800","number":"PUP-8443","body":"*Puppet Version:* 5.3.4\r\n *Puppet Server Version:* 5.1.4\r\n *OS Name/Version:* RHEL7.4\r\n\r\n*Summary:* Catalogs fail to compile on puppet-server 5.1.5 when using puppet-agent 5.3.4. When puppet-agent is downgraded on puppet-server 5.1.5 compiles are successful. ** \r\n\r\n \r\n\r\n*Baseline/Working Example*\r\n\r\nWith puppet-agent 5.3.3 and puppet-server 5.1.5, I can successfully compile a catalog for my client.\r\n{code:java}\r\n[root@puppet5 ~]# rpm -q puppet-agent puppetserver\r\npuppet-agent-5.3.3-1.el7.x86_64\r\npuppetserver-5.1.5-1.el7.noarch{code}\r\nClient:\r\n{code:java}\r\n[root@led ~]# rpm -q puppet-agent\r\npuppet-agent-5.3.4-1.el7.x86_64\r\n[root@led ~]# puppet agent -t --environment production --server puppet5.corp.com\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for led\r\nInfo: Unable to serialize catalog to json, retrying with pson\r\nInfo: Applying configuration version 'c30a9ad'\r\nNotice: Applied catalog in 9.63 seconds{code}\r\n \r\n\r\n*Broken Example*\r\n\r\nUpgrading the agent on the server will prevent the server from compiling a catalog.\r\n{code:java}\r\n[root@puppet5 ~]# yum -y update puppet-agent\r\n...\r\n[root@puppet5 ~]# rpm -q puppet-agent puppetserver\r\npuppet-agent-5.3.4-1.el7.x86_64\r\npuppetserver-5.1.5-1.el7.noarch\r\n[root@puppet5 ~]# systemctl restart puppetserver{code}\r\n \r\n\r\nClient:\r\n{code:java}\r\n[root@led ~]# puppet agent -t --environment production --server puppet5.corp.com\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Loading facts\r\nError: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Resource Statement, Evaluation Error: Error while evaluating a Function Call, Class[Eash::Client]: expects a value for parameter 'pem' (file: /etc/puppetlabs/code/environments/production/.site/profile/manifests/common.pp, line: 42, column: 21) on node led.corp.com\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run{code}\r\n \r\n\r\n*Why I think it's Hiera Related*\r\n\r\nMy hiera.yaml\r\n{code:java}\r\n[puppet5 ~]$ cat /etc/puppetlabs/code/hiera.yaml\r\n# managed by puppet: modules/puppet/files/etc/puppetlabs/code/hiera.yaml/common.erb, called by: Class[Role::Infra::Puppet_server]\r\n---\r\n:backends:\r\n  - modularfiles\r\n  - eyaml\r\n  - yaml\r\n\r\n:hierarchy:\r\n  - \"host/%{::fqdn}\"\r\n  - \"role/%{::role}\"\r\n  - \"hostgroup/%{::hostgroup}\"\r\n  - \"team/%{::team}\"\r\n  - \"enclave/%{::enclave}\"\r\n  - common\r\n\r\n:yaml:\r\n  :datadir: \"/etc/puppetlabs/code/environments/%{environment}/hieradata\"\r\n\r\n:eyaml:\r\n  :datadir: \"/etc/puppetlabs/code/environments/%{environment}/hieradata\"\r\n  :pkcs7_private_key: /etc/puppetlabs/keys/private_key.pkcs7.pem\r\n  :pkcs7_public_key:  /etc/puppetlabs/keys/public_key.pkcs7.pem\r\n  :extension: 'yaml'\r\n\r\n:merge_behavior: native{code}\r\nRunning puppet server in debug mode\r\n{code:java}\r\n[root@puppet5 ~]# puppetserver foreground --debug\r\n...\r\n2018-02-09 15:27:40,269 DEBUG [qtp194608888-66] [puppetserver] Puppet Lookup of 'telegraf::outputs'\r\n  Searching for \"telegraf::outputs\"\r\n    Global Data Provider (hiera configuration version 3)\r\n      Using configuration \"/etc/puppetlabs/code/hiera.yaml\"\r\n      Merge strategy hash\r\n...\r\n        Hierarchy entry \"yaml\"\r\n          Merge strategy hash\r\n            Path \"/etc/puppetlabs/code/environments//hieradata/host/led.corp.com.yaml\"\r\n              Original path: \"host/%{::fqdn}\"\r\n              Path not found\r\n            Path \"/etc/puppetlabs/code/environments//hieradata/role/infra::led.yaml\"\r\n              Original path: \"role/%{::role}\"\r\n              Path not found\r\n            Path \"/etc/puppetlabs/code/environments//hieradata/hostgroup/.yaml\"\r\n              Original path: \"hostgroup/%{::hostgroup}\"\r\n              Path not found\r\n            Path \"/etc/puppetlabs/code/environments//hieradata/team/infra.yaml\"\r\n              Original path: \"team/%{::team}\"\r\n              Path not found\r\n            Path \"/etc/puppetlabs/code/environments//hieradata/enclave/ccs.yaml\"\r\n              Original path: \"enclave/%{::enclave}\"\r\n              Path not found\r\n            Path \"/etc/puppetlabs/code/environments//hieradata/common.yaml\"\r\n              Original path: \"common\"\r\n              Path not found\r\n...\r\n2018-02-09 15:27:40,735 ERROR [qtp194608888-66] [puppetserver] Puppet Evaluation Error: Error while evaluating a Resource Statement, Evaluation Error: Error while evaluating a Function Call, Class[Dns::Client]: expects a value for parameter 'server' (file: /etc/puppetlabs/code/environments/production/.site/profile/manifests/common.pp, line: 42, column: 2\r\n1) on node led.corp.com\r\n...{code}\r\nAs you can see the %\\{environment} variable is not expanded\r\n\r\n \r\n\r\n ","closed_at":"2018-03-20T13:28:43.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8443","labels":"","state":"Closed","updated_at":"2018-03-20T13:28:43.000-0700","timestamp":1652285569.923626,"priority":"Normal","status_category":"Done","pull_request":6630},{"issue_id":"237457","title":"TypeSet loading of internal references is broken","url":"https://tickets.puppetlabs.com/browse/PUP-8471","created_at":"2018-02-20T03:28:50.000-0800","number":"PUP-8471","body":"A {{TypeSet}} that contains a type that references another type in the same set will not resolve correctly when loaded from disk using the module loader.\r\n\r\nThe reason is that the {{TypeParser}} prefers the loader associated with the loaded file over a loader passed as an argument. The {{TypeSet#resolve}} method is however counting on that the local loader that it provides (which enables unqualified access to the types contained in the {{TypeSet}}) is used.\r\n\r\n ","closed_at":"2018-03-20T13:28:44.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8471","labels":"","state":"Closed","updated_at":"2018-03-20T13:28:44.000-0700","timestamp":1652285570.12993,"priority":"Normal","status_category":"Done","pull_request":6663},{"issue_id":"241008","title":"puppet 5/ruby 2.4 can't handle invalid plists","url":"https://tickets.puppetlabs.com/browse/PUP-8545","created_at":"2018-03-13T11:57:58.000-0700","number":"PUP-8545","body":"*Puppet Version: 5.4.0*\r\n *Puppet Server Version: n/a*\r\n *OS Name/Version: macOS 10.13.3*\r\n\r\nPuppet 5.4.0 using ruby 2.4.3 can't handle invalid plists.\r\n\r\nIf a plist contains and invalid comment (e.g., a comment with '–' in the text), CFPropertyList will fail to parse it, passing it on to a shell out to `plutil -convert xml1 -o /dev/stdout`. However, it seems some subsystem (I believe it may be ruby 2.4) doesn't allow operations on `/dev/stdout`\r\n\r\n{{Warning: Cannot read file /Library/LaunchDaemons/badcomment.plist; Puppet is skipping it.\\nDetails: Execution of '/usr/bin/plutil -convert xml1 -o /dev/stdout /Library/LaunchDaemons/badcomment.plist' returned 1: <?xml version=\"1.0\" encoding=\"UTF-8\"?>Warning: Cannot read file /Library/LaunchDaemons/badcomment.plist; Puppet is skipping it.\\n}}\r\n\r\n{{[...]}}\r\n\r\n{{/dev/stdout: Operation not supported}}\r\n\r\nTo reproduce, add a comment containing '–' to any plist in /Library/LaunchDaemons, then run puppet.\r\n\r\n*Desired Behavior:*\r\n\r\nPuppet should handle the malformed plist and successfully call plutil.\r\n\r\n*Actual Behavior:*\r\n\r\nAfter CFPropertyList fails, the plutil call also fails.\r\n\r\n ","closed_at":"2018-03-20T13:28:45.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8545","labels":"","state":"Closed","updated_at":"2018-03-20T13:28:45.000-0700","timestamp":1652285570.447091,"priority":"Normal","status_category":"Done","pull_request":6733},{"issue_id":"237462","title":"ModelTreeDumper looses character casing when dumping QualifiedReference","url":"https://tickets.puppetlabs.com/browse/PUP-8474","created_at":"2018-02-20T04:04:27.000-0800","number":"PUP-8474","body":"A {{QualifiedName}} is indistinguishable from a {{QualifiedReference}} in the output from the ModelTreeDumper since the dumper simply dumps the {{value}} attribute in both cases. For a {{QualifiedReference}} it ought to dump the {{cased_value}}.","closed_at":"2018-03-20T13:28:47.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8474","labels":"","state":"Closed","updated_at":"2018-03-20T13:28:47.000-0700","timestamp":1652285570.765114,"priority":"Normal","status_category":"Done","pull_request":6657},{"issue_id":"237463","title":"Parser creates QNAME for capability component although it must start with upper case","url":"https://tickets.puppetlabs.com/browse/PUP-8475","created_at":"2018-02-20T04:28:14.000-0800","number":"PUP-8475","body":"The parser creates a {{QualifiedName}} instead of a {{QualifiedReference}} when for the {{component}} of a {{CapabilityExpression}}. The validator then checks if the {{component}} conforms to {{Patterns::CLASSREF_EXT}} (which it does). The pattern asserts that the string starts with an upper-case letter and this makes the {{component}} a {{QualifiedReference}} per definition.\r\n\r\nThe parser should change and instead create the expected {{QualifiedReference}}.","closed_at":"2018-03-20T13:28:49.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8475","labels":"","state":"Closed","updated_at":"2018-03-20T13:28:49.000-0700","timestamp":1652285570.971469,"priority":"Normal","status_category":"Done","pull_request":6656},{"issue_id":"41099","title":"yumrepo type includepkgs and exclude properties don't handle list as documented","url":"https://tickets.puppetlabs.com/browse/PUP-2884","created_at":"2014-07-02T13:58:33.000-0700","number":"PUP-2884","body":"The documentation for the yumrepo type's \"exclude\" and \"includepkgs\" properties say \"List of shell globs\". In fact, these properties seem to write out only the first item in a list to the file, not all of them.\r\n\r\n{code}\r\n[root@djaapafes50 yum.repos.d]# cd /etc/yum.repos.d/\r\n[root@djaapafes50 yum.repos.d]# rm -f ius-python.repo \r\n[root@djaapafes50 yum.repos.d]# cat /home/jantman/temp/rm_me/yum_ius.pp\r\nyumrepo { 'ius-python':\r\n  descr          => \"IUS Community Packages for Enterprise Linux ${::operatingsystemmajrelease} - ${::architecture}\",\r\n  mirrorlist     => \"http://dmirr.iuscommunity.org/mirrorlist/?repo=ius-centos${::operatingsystemmajrelease}&arch=${::architecture}\",\r\n  failovermethod => priority,\r\n  enabled        => true,\r\n  gpgcheck       => true,\r\n  gpgkey         => 'file:///etc/pki/rpm-gpg/IUS-COMMUNITY-GPG-KEY',\r\n  includepkgs    => ['python27-*', 'python32-*', 'python33-*', 'expat*'],\r\n  exclude        => ['foo', 'bar*', 'baz-*'],\r\n}\r\n[root@djaapafes50 yum.repos.d]# puppet apply /home/jantman/temp/rm_me/yum_ius.pp\r\nNotice: Compiled catalog for djaapafes50.ddtc.cmgdigital.com in environment production in 0.10 seconds\r\nNotice: /Stage[main]/Main/Yumrepo[ius-python]/ensure: created\r\nNotice: Finished catalog run in 0.18 seconds\r\n[root@djaapafes50 yum.repos.d]# cat ius-python.repo \r\n[ius-python]\r\nincludepkgs=python27-*\r\nname=IUS Community Packages for Enterprise Linux 5 - x86_64\r\nmirrorlist=http://dmirr.iuscommunity.org/mirrorlist/?repo=ius-centos5&arch=x86_64\r\nenabled=true\r\nfailovermethod=priority\r\ngpgcheck=true\r\nexclude=foo\r\ngpgkey=file:///etc/pki/rpm-gpg/IUS-COMMUNITY-GPG-KEY\r\n{code}\r\n\r\nI'm marking this as Major because the effect is that any packages/globs in the {{exclude}} list after the first one will be silently ignored. This behavior could very easily break many systems (especially in the RHEL/Cent world).","closed_at":"2018-03-20T13:30:43.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2884","labels":"docs;yumrepo","state":"Closed","updated_at":"2018-03-20T13:30:43.000-0700","timestamp":1652285571.497312,"priority":"Normal","status_category":"Done","pull_request":6713},{"issue_id":"18724","title":"Due to prefetching, Yumrepo clobbers any definition that it does not create","url":"https://tickets.puppetlabs.com/browse/PUP-723","created_at":"2013-11-12T11:54:21.000-0800","number":"PUP-723","body":"Yumrepo appears to be checking file existence before allowing the package command to complete, meaning that it creates a file containing only \"[remi]\" and \"enabled=1\", overwriting the file that the RPM installed.\r\n\r\nManifests, additional debug output, etc., available upon request.  Just tell me what you need to know.  Workarounds especially welcomed.  Puppet v. 0.24.4, running with --debug --test, on Ruby 1.8.6.114-1, compiled from source with default options.\r\n\r\n{code}\r\ndebug: //Node[default]/remi_enabled/Yumrepo[remi]/require: requires Package[remi-release-5-4.el5.remi]\r\n{code}\r\n...\r\n{code}\r\ndebug: Puppet::Type::Package::ProviderRpm: Not suitable: false value\r\ndebug: Puppet::Type::Package::ProviderRpm: Executing '/bin/rpm -q remi-release-5-4.el5.remi --nosignature --nodigest --qf %{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}'\r\ndebug: /Package[remi-release-5-4.el5.remi]: Changing ensure\r\ndebug: /Package[remi-release-5-4.el5.remi]: 1 change(s)\r\ndebug: Puppet::Type::Package::ProviderRpm: Executing '/bin/rpm -i --oldpackage http://rpms.famillecollet.com/el5.x86_64/remi-release-5-4.el5.remi.noarch.rpm'\r\nnotice: /Package[remi-release-5-4.el5.remi]/ensure: created\r\ninfo: create new repo remi in file /etc/yum.repos.d/remi.repo\r\ndebug: //Node[default]/remi_enabled/Yumrepo[remi]: Changing enabled\r\ndebug: //Node[default]/remi_enabled/Yumrepo[remi]: 1 change(s)\r\nnotice: //Node[default]/remi_enabled/Yumrepo[remi]/enabled: defined 'enabled' as '1'\r\ninfo: Filebucket[/var/lib/puppet/clientbucket]: Adding /etc/yum.repos.d/remi.repo(18f7009978e772c9c646b9410fa3a8b6)\r\n{code}","closed_at":"2018-03-20T13:30:44.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-723","labels":"redmine","state":"Closed","updated_at":"2018-03-20T13:30:44.000-0700","timestamp":1652285571.81339,"priority":"Normal","status_category":"Done","pull_request":6735},{"issue_id":"148117","title":"Yumrepo can't work with files using spaces in their INI format","url":"https://tickets.puppetlabs.com/browse/PUP-6639","created_at":"2016-08-19T00:13:12.000-0700","number":"PUP-6639","body":"Yumrepo seems to work fine with YUM repository defined in '.repo' files as long as the INI styled file doesn't use spaces around equal signs.\r\nBut if spaces around equal signs are used (and the 'redhat.repo' on RHEL does that), then the Yumrepo resource cannot manage settings for a repository.\r\n\r\nHow it fails to do so seems to have changed since PUP-5682, before 4.4.0 such repos were ignored, now Puppet tries to modify the value on every run like so:\r\n{code:bash}\r\n/Stage[main]/Main/Yumrepo[rhel-6-server-extras-rpms]/enabled: enabled changed ' 0' to 'False'\r\n{code}\r\nThat message clearly shows that spaces aren't trimmed and Puppet fails to convert the value to a boolean representing a state. Same happens if the catalogue tries to apply false.","closed_at":"2018-03-20T13:30:47.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6639","labels":"","state":"Closed","updated_at":"2018-03-20T13:30:47.000-0700","timestamp":1652285571.91899,"priority":"Normal","status_category":"Done","pull_request":6707},{"issue_id":"225741","title":"Managing an existing Windows Group resource may error when any of its members is a virtual account (like IIS AppPool\\DefaultAppPool or NT Service\\Dhcp)","url":"https://tickets.puppetlabs.com/browse/PUP-8231","created_at":"2017-12-06T17:38:46.000-0800","number":"PUP-8231","body":"Steps to reproduce\r\n\r\n1. Create Group \"TestGroup\" with \"IIS AppPool\\DefaultAppPool\" as a member\r\n{code}group { 'TestGroup':\r\n    name            => 'TestGroup',\r\n    ensure          => present,\r\n    members         => ['IIS AppPool\\DefaultAppPool'],\r\n    auth_membership => false,\r\n}\r\n{code}\r\n2. Re-run the same manifest\r\n{code}group { 'TestGroup':\r\n    name            => 'TestGroup',\r\n    ensure          => present,\r\n    members         => ['IIS AppPool\\DefaultAppPool'],\r\n    auth_membership => false,\r\n}\r\n{code}\r\n3. Once the group exists on the system, Puppet fails to resolve the virtual account properly and generates an error like:\r\n{code}\"Could not resolve name: DefaultAppPool\"{code}","closed_at":"2018-03-20T13:30:48.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8231","labels":"customer-escalation","state":"Closed","updated_at":"2018-03-20T13:30:48.000-0700","timestamp":1652285572.030063,"priority":"Major","status_category":"Done","pull_request":6625},{"issue_id":"215619","title":"Puppet does not initialize I18N locale per thread","url":"https://tickets.puppetlabs.com/browse/PUP-8040","created_at":"2017-10-10T06:01:38.000-0700","number":"PUP-8040","body":"From a few hours of investigation, the puppetserver appears to track translation repositories from compile to compile, but either \"forgets\" about the locale after each compile, or must have the locale initialized in EVERY thread individually.\r\n\r\nSome technical details:\r\n- {{Puppet::GettextConfig.initialize_i18n}} checks {{translation_repositories}} before initializing {{FastGettext.locale}}, and thus only initializes the locale once ever (see https://github.com/puppetlabs/puppet/blob/5.3.2/lib/puppet/module.rb#L427-L446).\r\n- {{FastGettext.translation_repositories}} are a class variable. According to the FastGettext readme, {{FastGettext.locale}} must be initialized once per thread: https://github.com/grosser/fast_gettext#3-choose-text-domain-and-locale-for-translation\r\n- The locale should be negotiated at every module load, contrary to what this says: https://github.com/puppetlabs/puppet/blob/5.3.2/lib/puppet/gettext/config.rb#L83-L84 (watch out for performance implications) but the translation repositories should only needed to be loaded once.\r\n\r\nWe are going to explore refactoring the gettext initialization code to skip the logic around {{available_locales}} and {{FastGettext.locale}} in favor of just setting {{FastGettext.default_locale}} to the system locale directly, since {{default_locale}} is not thread local, unlike {{FastGettext.locale}}. That library should already handle the fallback cases from this configuration (though we will be writing tests to verify this, see PUP-8080). In order to avoid breaking other users of GettextSetup, we will likely be implementing most of this directly in Puppet as gettext utils, and drop our runtime dependency on GettextSetup.\r\n\r\nIt looks like we might run into a similar issue when we start trying to use more text domains (see PUP-8013 and https://github.com/grosser/fast_gettext/blob/master/lib/fast_gettext/storage.rb#L54) as the current text domain also appears to be a thread-local variable. Currently we're avoiding issues here by only using one text domain which is both set as {{FastGettext.text_domain}} and {{FastGettext.default_text_domain}}, the latter of which is not thread local.\r\n\r\n----\r\n\r\nReproduction steps in a basic PE 2017.3.1 install\r\n- {{localectl set-locale LANG=ja_JP.UTF-8}}\r\n- add {{fail('trigger failure')}} to {{node default}} section of {{/etc/puppetlabs/code/environments/production/manifests/site.pp}}\r\n- set {{disable_i18n=false}} in {{/etc/puppetlabs/puppet/puppet.conf}}\r\n- {{systemctl restart pe-puppetserver}}\r\n- {{puppet agent -t --noop}} (several times)\r\n\r\nExpect to see\r\n{quote}\r\nError: Could not retrieve catalog from remote server: Error 500 on SERVER: サーバエラー: Evaluation Error: a Function Callの検証中にエラーが生じました。trigger failure at /etc/puppetlabs/code/environments/production/manifests/site.pp:31:3 on node hwcijw3gfrqxsiw.delivery.puppetlabs.net\r\n{quote}\r\nWill mostly see\r\n{quote}\r\nError: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Function Call, trigger failure at /etc/puppetlabs/code/environments/production/manifests/site.pp:31:3 on node hwcijw3gfrqxsiw.delivery.puppetlabs.net\r\n{quote}","closed_at":"2018-03-25T23:10:46.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8040","labels":"i18n","state":"Closed","updated_at":"2018-03-25T23:10:46.000-0700","timestamp":1652285574.294558,"priority":"Critical","status_category":"Done","pull_request":6299},{"issue_id":"102964","title":"solaris 10 sparc, acceptance/tests/reports/submission test fails","url":"https://tickets.puppetlabs.com/browse/PUP-5432","created_at":"2015-10-27T07:09:08.000-0700","number":"PUP-5432","body":"Using {{puppet-agent}} at SHA {{41de77924}}, the {{acceptance/tests/reports/submission.rb}} acceptance test fails to find the expected report.\r\n\r\n{code}\r\n#<RuntimeError: PuppetAcceptance::DSL::Helpers.with_puppet_running_on failed (check backtrace for location) because: Host 'ufzkt2bzifa2ycj.delivery.puppetlabs.net' exited with 1 running:\r\n grep -q sol10.delivery.puppetlabs.net /tmp/report_submission.ynlz9i/*/*\r\n{code}","closed_at":"2018-04-03T11:15:25.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5432","labels":"","state":"Closed","updated_at":"2018-04-03T11:15:25.000-0700","timestamp":1652285575.677363,"priority":"Normal","status_category":"Done","pull_request":4391},{"issue_id":"74099","title":"Update per-user directories to ~/.puppetlabs","url":"https://tickets.puppetlabs.com/browse/PUP-4355","created_at":"2015-03-31T13:46:53.000-0700","number":"PUP-4355","body":"When running as non-root, puppet should create its directories under {{\\~/.puppetlabs}} instead of {{\\~/.puppet}}.\r\n\r\nPreviously, puppet's {{confdir}} was {{\\~/.puppet}}, and since it's a setting, puppet would create it when first run. In the move to AIO, the {{confdir}} will be {{\\~/.puppetlabs/puppet}} and it will need to create the intermediate directories.\r\n\r\nrisk: medium\r\nseverity: medium (confusing to user, possible bugs)\r\nprobability: medium (only non-root users)\r\ntest layer: acceptance","closed_at":"2018-04-03T11:15:27.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4355","labels":"AIO","state":"Closed","updated_at":"2018-04-03T11:15:27.000-0700","timestamp":1652285575.9977,"priority":"Normal","status_category":"Done","pull_request":3781},{"issue_id":"145290","title":"User resource always reports password changed when account disabled","url":"https://tickets.puppetlabs.com/browse/PUP-6586","created_at":"2016-08-04T16:24:41.000-0700","number":"PUP-6586","body":"On Windows 2008R2, when managing a local user the password will always report as changed if the user's account is disabled.  This appears to be due to the provider not checking for the ERROR_ACCOUNT_DISABLED return code as outlined in PUP-6569.\r\n\r\nTo recreate:\r\n\r\n1.  Create a new local user, \"testuser\", on Win 2k8R2 (also seen on 2012) and set the account to disabled.\r\n2.  Run `puppet apply -e \"user {'testuser': ensure => present, password => 'Puppet11'}\"`.  Note that no matter how many times it is run, the output will report \"Notice: /Stage[main]/Main/User[testuser]/password: changed password\".\r\n3.  Re-enable the account\r\n4.  Run `puppet apply -e \"user {'testuser': ensure => present, password => 'Puppet11'}\"`.  Note that the notice is no longer shown.","closed_at":"2018-04-03T11:15:27.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6586","labels":"customer-escalation","state":"Closed","updated_at":"2018-04-03T11:15:27.000-0700","timestamp":1652285576.105377,"priority":"Normal","status_category":"Done","pull_request":5201},{"issue_id":"49695","title":"Fix /var/lib/puppet/reports permissions on debian/redhat","url":"https://tickets.puppetlabs.com/browse/PUP-3163","created_at":"2014-08-29T14:10:25.000-0700","number":"PUP-3163","body":"On deb/el platforms, we do not correctly set the permissions for /var/lib/puppet/reports, which prevents any applications from writing to this directory.","closed_at":"2018-04-03T11:16:10.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3163","labels":"","state":"Closed","updated_at":"2018-04-03T11:16:10.000-0700","timestamp":1652285576.646099,"priority":"Normal","status_category":"Done","pull_request":3036},{"issue_id":"46938","title":"Debian package does not create /var/run/puppet dir during install","url":"https://tickets.puppetlabs.com/browse/PUP-3035","created_at":"2014-08-07T14:37:17.000-0700","number":"PUP-3035","body":"It looks like `/var/run/puppet` has typically been created during by the debian init script if it didn't exist already: https://github.com/puppetlabs/puppet/blob/master/ext/debian/puppetmaster.init#L22\r\n\r\nThis should instead be handled by the `puppet-common.dirs` file in the `puppet-common` package. I say that it should be included in the `puppet-common` package because it is used by components other than the `puppetmaster` daemon (for example `jvm-puppet` which does not currently depend on `puppetmaster` being installed, just `puppet-common`)","closed_at":"2018-04-03T11:16:15.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3035","labels":"","state":"Closed","updated_at":"2018-04-03T11:16:15.000-0700","timestamp":1652285577.713394,"priority":"Critical","status_category":"Done","pull_request":3001},{"issue_id":"49549","title":"Need to guard against `nil` when calling `Uniquefile#close!` in `ensure` blocks","url":"https://tickets.puppetlabs.com/browse/PUP-3153","created_at":"2014-08-28T12:09:59.000-0700","number":"PUP-3153","body":"in `util.rb#replace_file`, there is an `ensure` block that calls `close!` on the `Uniquefile` object.  However, if an exception is thrown during the call to the constructor for `Uniquefile` (e.g., if the user does not have write permissions to the specified directory), then this attempt to call `close!` will result in a NilClass exception, which will mask the original exception.","closed_at":"2018-04-03T11:16:18.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3153","labels":"","state":"Closed","updated_at":"2018-04-03T11:16:18.000-0700","timestamp":1652285587.997367,"priority":"Normal","status_category":"Done","pull_request":3029},{"issue_id":"37629","title":"Puppet 3.6.1 File recurse improperly handles spaces in filenames","url":"https://tickets.puppetlabs.com/browse/PUP-2700","created_at":"2014-05-29T14:23:18.000-0700","number":"PUP-2700","body":"This one's new on me.\r\nWe're using file{ : recurse => remote} to pull a directory structure from a remote puppet fileserver. It would appear that there's a mismatch causing it to multiply urlencode resources it's recursing over, causing it to render a space ' ' as %2520 in the file_content call.\r\n\r\nHere's a convenient, if ugly, example:\r\n\r\nIn the Fileserver:\r\n\r\n{noformat}\r\n[29/May/2014:14:15:18 -0700] \"GET /production/file_content/puppet/python340/lib/python3.4/site-packages/setuptools/__pycache__/script%2520template%2520(dev).cpython-34.pyc HTTP/1.1\" 404 147 \"-\" \"-\"\r\n{noformat}\r\n\r\nin the client:\r\n\r\n{noformat}\r\nError 404 on SERVER: Not Found: Could not find file_content puppet/python340/lib/python3.4/site-packages/setuptools/__pycache__/script%20template%20(dev).cpython-34.pyc\r\nError: /Stage[main]/.../File[/opt/python340/lib/python3.4/site-packages/setuptools/__pycache__/script template (dev).cpython-34.pyc]/ensure: change from absent to file failed:\r\nCould not set 'file' on ensure: \r\nError 404 on SERVER: Not Found: \r\nCould not find file_content puppet/python340/lib/python3.4/site-packages/setuptools/__pycache__/script%20template%20(dev).cpython-34.pyc\r\n{noformat}","closed_at":"2018-04-03T11:16:18.000-0700","comments":20,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2700","labels":"","state":"Closed","updated_at":"2018-04-03T11:16:18.000-0700","timestamp":1652285588.214221,"priority":"Critical","status_category":"Done","pull_request":2772},{"issue_id":"40777","title":"`puppet config print` confusing for users","url":"https://tickets.puppetlabs.com/browse/PUP-2868","created_at":"2014-06-30T14:07:43.000-0700","number":"PUP-2868","body":"{{puppet config print}} doesn't require a {{\\-\\-section}} to be specified and doesn't inform the user what section of the config file it is showing the value for. Users then get unexpected information from the command.\r\n\r\nThe command needs to change in some way to make it clear what sections the information is coming from and provide a good way to request information from a specific section.  'main' is the default.\r\n\r\nAn example:  You may have a server setting that is already in the agent setting.  When you ran puppet config set server \"value\" - that will throw it in the \"main\" section.  There already exists a server setting in the \"agent\" section that is overriding this.  The next time you run puppet config print - you will get the one out of the main section (not the overriding agent setting)\r\n\r\n1. Always print section info to stderr:\r\n\r\n$ puppet config print server\r\nResolving settings from section 'main' in environment 'production'\r\npuppetserver.example.com\r\nAlso print any other settings found that may/will override this setting as in the example above - \"Setting is also defined in the following sections: X, Y, Z\"\r\n\r\n2. If section is omitted, also emit a warning to stderr:\r\n\r\n$ puppet config print server\r\nResolving settings from section 'main' in environment 'production'\r\nNo section specified, using 'user' section - settings will not affect agent execution!\r\npuppetserver.example.com\r\n\r\n3. Update \"config\" help to strongly recommend always specifying a section (should probably work with [~garrett.guillotte] on this):\r\n* what the list of commonly used sections are \r\n* guidance on naming sections\r\n* the output of the help command point to the sections documentation\r\n* Include a good solid example of sections (what settings go in what section)","closed_at":"2018-04-11T11:02:34.000-0700","comments":16,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2868","labels":"","state":"Closed","updated_at":"2018-04-11T11:02:34.000-0700","timestamp":1652285589.934441,"priority":"Normal","status_category":"Done","pull_request":6692},{"issue_id":"168318","title":"Update password property of User type to mention Sensitive data type","url":"https://tickets.puppetlabs.com/browse/PUP-7057","created_at":"2017-01-03T02:23:47.000-0800","number":"PUP-7057","body":"When the user provider changes a managed users password, the plaintext password is shown in the console even if the password is encrypted in hiera.\r\n\r\nTo reproduce: \r\n1) In PE Console go to report where the password was changed. \r\n2) Click on Events tab \r\n3) Under resource type click user \r\n4) The User resource will show the password in the Changed to column.\r\n\r\n*Notes*\r\n- Currently, Puppet will include password value(s) in the resource event logs when they change. This means passwords are written to the reports in plain text (though these reports are only root-readable).\r\n- The {{Sensitive}} type was recently added to Puppet, which obscures associated values where applicable. Ostensibly passwords are sensitive information and are applicable for this new type.\r\n\r\n*In Scope*\r\n- Plumb the {{Sensitive}} data type through the Puppet type system as needed, if at all, so that we can:\r\n- Set the {{password}} property of the {{user}} type to {{Sensitive}}. This will then apply to all {{user}} providers.\r\n","closed_at":"2018-04-18T06:21:33.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7057","labels":"generated-docs;product-security;security","state":"Closed","updated_at":"2018-04-18T06:21:33.000-0700","timestamp":1652285591.210982,"priority":"Normal","status_category":"Done","pull_request":6775},{"issue_id":"209079","title":"return() documentation incorrect regarding lambdas","url":"https://tickets.puppetlabs.com/browse/PUP-7904","created_at":"2017-09-04T13:06:59.000-0700","number":"PUP-7904","body":"So the documentation for {{return()}} says plainly that it will return from a lambda, ending evaluation of the function.\r\n\r\nhttps://docs.puppet.com/puppet/4.10/function.html#return:\r\n{quote}\r\nIf called from within a lambda the return will return from the function evaluating the lambda.\r\n{quote}\r\n\r\nSo let's build a short manifest and use a function that evaluates a lambda:\r\n{code}\r\nwith(1) |$num| {\r\n  return()\r\n}\r\n{code}\r\n\r\nThis creates an error:\r\n{code}\r\n$ puppet apply return_bug.pp\r\nError: return() from context where this is illegal at /tmp/return_bug.pp:2 on node \r\n{code}\r\n\r\nReading the spec test confirms that this is expected behavior?\r\nhttps://github.com/puppetlabs/puppet/blob/ebd96213cab43bb2a8071b7ac0206c3ed0be8e58/spec/unit/functions/return_spec.rb#L85-L94\r\n\r\nI thought of perhaps creating this as a documentation bug, but this is failing on documented (and desirable) functionality.","closed_at":"2018-04-18T06:21:34.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7904","labels":"generated-docs","state":"Closed","updated_at":"2018-04-18T06:21:34.000-0700","timestamp":1652285591.320116,"priority":"Normal","status_category":"Done","pull_request":6774},{"issue_id":"241813","title":"File performance nearly twice as slow after update","url":"https://tickets.puppetlabs.com/browse/PUP-8562","created_at":"2018-03-19T02:23:37.000-0700","number":"PUP-8562","body":"Hello,\r\n\r\nwe noticed that puppet runs take twice as long after updating to latest version. We did some research and noticed that \"time - file\" (–profile --summarize) doubled.\r\n\r\nThe puppetdb version had no effect on this.\r\n\r\nExample node with agent 5.4.0 and server 5.2 :\r\n\r\ntime file : 163,63\r\n\r\nSame node with agent 5.2 and server 5.1.4\r\n\r\ntime file : 80,54\r\n\r\n \r\n\r\nvisual:\r\n\r\n!image.png!\r\n\r\nPlease let me know if you need further data.\r\n\r\nalso avail on slack as \"betriebsrat\"","closed_at":"2018-04-18T19:03:19.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8562","labels":"","state":"Closed","updated_at":"2018-04-18T19:03:19.000-0700","timestamp":1652285591.645263,"priority":"Normal","status_category":"Done","pull_request":6762},{"issue_id":"241646","title":"Fix JrJackson serialization of numbers so we can use it","url":"https://tickets.puppetlabs.com/browse/PUP-8583","created_at":"2018-03-15T16:13:32.000-0700","number":"PUP-8583","body":"We're not entirely sure what causes this, but sometimes JrJackson seems to output numbers -> JSON strings. PuppetDB, at least, expects these to be numbers and will blow up on submitting reports. We probably need to add custom serialization logic after we figure out exactly what's going wrong.","closed_at":"2018-04-19T11:22:29.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8583","labels":"","state":"Closed","updated_at":"2018-04-19T11:22:29.000-0700","timestamp":1652285592.18191,"priority":"Normal","status_category":"Done","pull_request":6765},{"issue_id":"237928","title":"Reduce regular expression garbage in puppet","url":"https://tickets.puppetlabs.com/browse/PUP-8549","created_at":"2018-02-22T16:02:18.000-0800","number":"PUP-8549","body":"Lots of garbage is generated by the ValidTagRegex in tagging.rb, as on JRuby it's forced to rebuild the regular expression every time it is matched against a string of a different encoding.\r\n\r\n \r\n\r\nOne solution is to put a u on the end to force UTF-8 and not let it change. It will fail hard if it encounters something other than UTF-8 or ASCII. There is a test that fails when this change is applied and I'm not sure whether the test is wrong or the fix is wrong.\r\n\r\n \r\n\r\nAnother solution would be to make sure strings reaching that are almost always UTF-8 (an occasional cache invalidation won't hurt too much, but right now it seems to happen on every match).","closed_at":"2018-04-19T11:22:30.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8549","labels":"","state":"Closed","updated_at":"2018-04-19T11:22:30.000-0700","timestamp":1652285592.400053,"priority":"Normal","status_category":"Done","pull_request":6737},{"issue_id":"226134","title":"ERB and EPP templates handle CRLF line endings inconsistently","url":"https://tickets.puppetlabs.com/browse/PUP-8240","created_at":"2017-12-11T11:15:22.000-0800","number":"PUP-8240","body":"Via [~williams.geoff] on DOCUMENT-779:\r\n\r\n*expected result*\r\n\r\nWhen applying a puppet manifest and its EPP template using CRLF line endings to generate a file, the generated file should also use CRLF line endings.\r\n\r\nWhen using a CRLF escape sequence in ERB or EPP templates ({{\\r\\n}}), Puppet should replace the sequence with a CRLF line ending in the generated file.\r\n\r\nThis is documented at [Handling line endings on Resource tips and Examples: File on Windows|https://puppet.com/docs/puppet/5.3/resources_file_windows.html#handling-line-endings]:\r\n\r\n* If a file resource uses the content or source attributes, Puppet will write the file in “binary” mode, using whatever line endings are present in the content.\r\n** If the manifest, template, or source file is saved with CRLF line endings, Puppet will use those endings in the destination file.\r\n** If the manifest, template, or source file is saved with LF line endings, you can use the {{\\r\\n}} escape sequence to create literal CRLFs.\r\n\r\n*actual result*\r\n\r\nFollowing the instructions produces one long line of text instead of text with CRLF line breaks, and {{\\r\\n}} appears literally in the output instead of being replaced with a CRLF line break.\r\n\r\n*test case*\r\n\r\ntest.pp:\r\n\r\n{code}\r\nfile { \"c:/test.txt\":\r\n  content => epp(\"c:/test.epp\")\r\n}\r\n{code}\r\n\r\ntest.epp:\r\n\r\n{code}\r\nline 1\r\nline 2\r\n:P\r\n{code}\r\n\r\ntest.txt (result)\r\n\r\n{code}\r\nline 1line 2:P\r\n{code}\r\n\r\nFiles were created in notepad to get the line endings. See the attachment.\r\n\r\nEscape codes in the template:\r\n\r\ntest.epp:\r\n\r\n{code}\r\nline 1\\r\\n\r\nline 2\\r\\n\r\n:P\\r\\n\r\n{code}\r\n\r\ntest.txt output:\r\n\r\n{code}\r\nline 1\\r\\nline 2\\r\\n:P\\r\\n\r\n{code}\r\n\r\nHow to run testcase (save to c:\\):\r\n\r\n{code}\r\npuppet apply c:\\test.pp\r\n{code}\r\n\r\n*workaround*\r\nTraditional *erb* templates' {{template()}} handle CRLF line endings as documented and expected, although these also result in literal {{\\r\\n}} in the output, which still conflicts with the documentation.","closed_at":"2018-04-19T11:22:30.000-0700","comments":25,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8240","labels":"","state":"Closed","updated_at":"2018-04-19T11:22:30.000-0700","timestamp":1652285592.511997,"priority":"Normal","status_category":"Done","pull_request":6755},{"issue_id":"165938","title":"Puppet automatically creates the production environment with the incorrect permissions","url":"https://tickets.puppetlabs.com/browse/PUP-6996","created_at":"2016-12-12T09:14:59.000-0800","number":"PUP-6996","body":"If the production environment does not exist, Puppet will automatically create it as a result of PUP-2519.  Unfortunately, it creates the directory with ownership of root:root.  To be consistent with Code Manager and file sync, it should be owned by puppet user and group (pe-puppet:pe-puppet for PE installations).","closed_at":"2018-04-19T11:22:33.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6996","labels":"","state":"Closed","updated_at":"2018-04-19T11:22:33.000-0700","timestamp":1652285592.954886,"priority":"Normal","status_category":"Done","pull_request":6751},{"issue_id":"133483","title":"metrics.time.total does not correlate to time reported in log","url":"https://tickets.puppetlabs.com/browse/PUP-6344","created_at":"2016-05-23T16:16:01.000-0700","number":"PUP-6344","body":"The time reported by a `puppet agent -t` run for \"Applied catalog in\" does not appear to correlate to the times reported in the Puppet::Util::Metric \"time\" array.  The applied catalog time should be the time used to apply the resources in the catalog, and the times returned to the report processor in the Puppet::Util::Metric \"time\" array should be the amount of time spent applying each resource, yet the two do not add up.  Sometimes the applied catalog line is larger and sometimes the total time is larger.\r\n\r\n{code:java}\r\n# cat lib/puppet/reports/myreport.rb\r\nrequire 'puppet'\r\nPuppet::Reports.register_report(:myreport) do\r\n  desc \"Testing\"\r\n\r\n  def process\r\n    Puppet.notice \"METRICS: Process Puppet Report\"\r\n    Puppet.notice \"METRICS: self.logs.last.message: #{self.logs.last.message}\"\r\n    self.metrics['time'].values.each { |val|\r\n      Puppet.notice \"METRICS: #{val[1]} : #{val[2]}\"\r\n    }\r\n  end\r\n# puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for pe-201612-master.puppetdebug.vlan\r\nInfo: Applying configuration version '1464042693'\r\nNotice: Applied catalog in 9.18 seconds\r\n# tail -n 21 /var/log/puppetlabs/puppetserver/puppetserver.log\r\n2016-05-23 22:31:53,920 INFO  [qtp1308528397-63] [puppet-server] Puppet METRICS: Process Puppet Report\r\n2016-05-23 22:31:53,920 INFO  [qtp1308528397-63] [puppet-server] Puppet METRICS: self.logs.last.message: Applied catalog in 9.18 seconds\r\n2016-05-23 22:31:53,920 INFO  [qtp1308528397-63] [puppet-server] Puppet METRICS: Augeas : 1.017779943\r\n2016-05-23 22:31:53,920 INFO  [qtp1308528397-63] [puppet-server] Puppet METRICS: Config retrieval : 10.645895659\r\n2016-05-23 22:31:53,920 INFO  [qtp1308528397-63] [puppet-server] Puppet METRICS: Cron : 0.001115222\r\n2016-05-23 22:31:53,920 INFO  [qtp1308528397-63] [puppet-server] Puppet METRICS: Exec : 0.169413854\r\n2016-05-23 22:31:53,921 INFO  [qtp1308528397-63] [puppet-server] Puppet METRICS: File : 0.45819617799999984\r\n2016-05-23 22:31:53,921 INFO  [qtp1308528397-63] [puppet-server] Puppet METRICS: Filebucket : 0.000103239\r\n2016-05-23 22:31:53,921 INFO  [qtp1308528397-63] [puppet-server] Puppet METRICS: Group : 0.000411452\r\n2016-05-23 22:31:53,921 INFO  [qtp1308528397-63] [puppet-server] Puppet METRICS: Package : 0.7939065209999999\r\n2016-05-23 22:31:53,921 INFO  [qtp1308528397-63] [puppet-server] Puppet METRICS: Pe anchor : 7.1151e-05\r\n2016-05-23 22:31:53,921 INFO  [qtp1308528397-63] [puppet-server] Puppet METRICS: Pe file line : 0.0023166209999999996\r\n2016-05-23 22:31:53,921 INFO  [qtp1308528397-63] [puppet-server] Puppet METRICS: Pe hocon setting : 1.4407772629999998\r\n2016-05-23 22:31:53,921 INFO  [qtp1308528397-63] [puppet-server] Puppet METRICS: Pe ini setting : 0.020410037\r\n2016-05-23 22:31:53,921 INFO  [qtp1308528397-63] [puppet-server] Puppet METRICS: Pe ini subsetting : 0.0049442060000000005\r\n2016-05-23 22:31:53,922 INFO  [qtp1308528397-63] [puppet-server] Puppet METRICS: Pe java ks : 1.454764838\r\n2016-05-23 22:31:53,922 INFO  [qtp1308528397-63] [puppet-server] Puppet METRICS: Pe puppet authorization hocon rule : 1.8567533360000004\r\n2016-05-23 22:31:53,922 INFO  [qtp1308528397-63] [puppet-server] Puppet METRICS: Schedule : 0.00041616200000000003\r\n2016-05-23 22:31:53,922 INFO  [qtp1308528397-63] [puppet-server] Puppet METRICS: Service : 0.35225476499999997\r\n2016-05-23 22:31:53,923 INFO  [qtp1308528397-63] [puppet-server] Puppet METRICS: Total : 18.221604979000002\r\n2016-05-23 22:31:53,923 INFO  [qtp1308528397-63] [puppet-server] Puppet METRICS: User : 0.002074532\r\n{code}\r\n\r\nIn this case, the catalog applied in 9.18 seconds, but the (Total) - (Config retrieval) is 7.57 even though the documentation would seem to indicate they are measuring the same thing.","closed_at":"2018-04-23T07:50:40.000-0700","comments":21,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6344","labels":"","state":"Closed","updated_at":"2018-04-23T07:50:40.000-0700","timestamp":1652285593.875609,"priority":"Normal","status_category":"Done","pull_request":6787},{"issue_id":"84676","title":"Puppet config set --section main foo bar does not set or respect an empty [main] section","url":"https://tickets.puppetlabs.com/browse/PUP-4755","created_at":"2015-06-15T19:46:58.000-0700","number":"PUP-4755","body":"With a puppet.conf that does not have a [main] section, `puppet config set --section main foo bar` does not create a [main] section.\r\n\r\nWith a puppet.conf that has an empty [main] section, `puppet config set --section main foo bar` places the setting at the top of the file, outside of the [main] section.\r\n\r\nBoth cases I believe are because it the default section is treated as '[main]'\r\n\r\nThis only came up because we test for augeas functionality on puppet.conf in PE, and augeas does not like to parse a puppet.conf with settings that are not in a section, and the pe_repo adds settings to [main], but the default puppet.conf no longer has sections...","closed_at":"2018-05-02T15:44:04.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4755","labels":"cs_pr_review","state":"Closed","updated_at":"2018-05-02T15:44:04.000-0700","timestamp":1652285594.839678,"priority":"Normal","status_category":"Done","pull_request":6080},{"issue_id":"201487","title":"Downgrading a package with pkgin fails silents","url":"https://tickets.puppetlabs.com/browse/PUP-7790","created_at":"2017-07-20T03:29:34.000-0700","number":"PUP-7790","body":"Due to a bug in pkgsrc (https://github.com/NetBSDfr/pkgin/issues/73), the pkgin provider fails silently when trying to ensure a particular version of a package is installed when a newer one is already installed.","closed_at":"2018-05-21T13:14:59.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7790","labels":"","state":"Closed","updated_at":"2018-05-21T13:14:59.000-0700","timestamp":1652285597.223472,"priority":"Normal","status_category":"Done","pull_request":6081},{"issue_id":"183767","title":"Make Pcore loaders available to relevant CLI apps","url":"https://tickets.puppetlabs.com/browse/PUP-7423","created_at":"2017-04-03T07:43:16.000-0700","number":"PUP-7423","body":"The Pcore loader is normally initialized by the compiler. For CLI applications such as puppet apply, puppet resource, or puppet device, there might never be a compiler available. Those commands needs to initialize the loaders differently.\r\n\r\nExploratory work for this has already been made on a test branch used by netconf.\r\n\r\nLoading without compiler also relates to PUP-7197 since these commands are expected to function when executed on the agent.","closed_at":"2018-05-21T13:43:03.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7423","labels":"","state":"Closed","updated_at":"2018-05-21T13:43:03.000-0700","timestamp":1652285597.328021,"priority":"Normal","status_category":"Done","pull_request":5778},{"issue_id":"177590","title":"Instantiating Puppet::SSL::DefaultValidator shouldn't trigger client SSL initialization","url":"https://tickets.puppetlabs.com/browse/PUP-7283","created_at":"2017-02-28T11:56:18.000-0800","number":"PUP-7283","body":"The {{Puppet::SSL::DefaultValidator}} class is unsafe to call when the Puppet client SSL state isn't initialized. The {{#initialize}} method takes a {{Puppet::SSL::Host}} object which is reasonable(ish), but the default value calls {{Puppet::SSL::Host.localhost}} which has the side effect of trying to generate a certificate if no certificate exists. This is cause and symptom of the unholy thicket of implicit SSL initialization, and this behavior introduces a lot of weird behavior.\r\n\r\nTo add to the fun, the {{DefaultValidator}} also switches behavior at runtime depending on if the CA or client certificates are available. This is fairly magic behavior and can be replaced with a proper concept of an \"upgrading\" validator that uses the best validator available, and multiple validators that perform different validation (and connection setup) based on what sort of validation credentials are available.\r\n\r\nIn order to detangle this, we need to break up the {{DefaultValidator}}","closed_at":"2018-05-25T08:38:08.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7283","labels":"","state":"Closed","updated_at":"2018-05-25T08:38:08.000-0700","timestamp":1652285597.541631,"priority":"Normal","status_category":"Done","pull_request":5725},{"issue_id":"138873","title":"Win32-Service Windows Gem 0.8.9 causing CI PR failures in AppVeyor","url":"https://tickets.puppetlabs.com/browse/PUP-6445","created_at":"2016-06-27T09:45:07.000-0700","number":"PUP-6445","body":"During investigation into CI PR failures for Puppet [~daniel.lu] found that several gems had been updated and that all subsequent PRs in Appveyor were failing with the same error.\r\n\r\ne.g.\r\n{code}\r\nC:\\source\\puppet-pete>bundle exec rspec spec/unit\r\nDL is deprecated, please use Fiddle\r\nC:/source/puppet-pete/lib/puppet/defaults.rb:274:in `block in <module:Puppet>': undefined method `split' for nil:NilClass (NoMethodError)\r\n        from C:/source/puppet-pete/lib/puppet/settings.rb:919:in `block in define_settings'\r\n        from C:/source/puppet-pete/lib/puppet/settings.rb:918:in `each'\r\n        from C:/source/puppet-pete/lib/puppet/settings.rb:918:in `define_settings'\r\n        from C:/source/puppet-pete/lib/puppet.rb:81:in `define_settings'\r\n        from C:/source/puppet-pete/lib/puppet/defaults.rb:151:in `<module:Puppet>'\r\n        from C:/source/puppet-pete/lib/puppet/defaults.rb:1:in `<top (required)>'\r\n        from C:/source/puppet-pete/lib/puppet.rb:116:in `require'\r\n        from C:/source/puppet-pete/lib/puppet.rb:116:in `<module:Puppet>'\r\n        from C:/source/puppet-pete/lib/puppet.rb:33:in `<top (required)>'\r\n{code}\r\n\r\nThis error could replicated locally on a Windows workstation as well.\r\n\r\n","closed_at":"2018-06-05T15:55:35.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6445","labels":"","state":"Closed","updated_at":"2018-06-05T15:55:35.000-0700","timestamp":1652285598.622333,"priority":"Blocker","status_category":"Done","pull_request":5153},{"issue_id":"18321","title":"Comparing package versions in puppet behaves differently to yum","url":"https://tickets.puppetlabs.com/browse/PUP-682","created_at":"2013-11-06T11:39:57.000-0800","number":"PUP-682","body":"I'm trying to make use of the yum downgrade functionality which is described in Issue #2866.\r\n\r\nOur build process creates packages with a typical rpm version say:\r\n\r\nfoo-2.2-405.noarch.rpm which compared with package foo-2.2-406.noarch.rpm works perfectly fine\r\n\r\nBut If I build a local version of my package there is no build number and the package is named for ex:\r\n\r\nfoo-2.2-SNAPSHOT20121119105647.noarch.rpm which compared with foo-2.2-405.noarch.rpm in puppet returns as a higher version.\r\n\r\nWith foo-2.2-405.noarch.rpm installed I can do yum downgrade foo-2.2-SNAPSHOT20121119105647 but the same thing in a puppet manifest fails at this stage in puppet/provider/package/yum.rb:\r\n\r\n<pre>if is && Puppet::Util::Package.versioncmp(should, is[:ensure]) < 0</pre>\r\n\r\nWhich leads me to:\r\npuppet/util/package.rb where the version compare is happening. Can this be updated to compare the versions in the same way yum does?\r\n\r\nFor completeness I want the puppet manifests to be the same in all environments, from LOCAL->DEV->QA->PROD and not have to add any extra exec's to uninstall packages.\r\n\r\nThanks,\r\nPierre","closed_at":"2018-06-07T13:30:28.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-682","labels":"customer;redmine;yum","state":"Closed","updated_at":"2018-06-07T13:30:28.000-0700","timestamp":1652285598.73933,"priority":"Normal","status_category":"Done","pull_request":6418},{"issue_id":"166323","title":"Raise errors if hiera.yaml version 4 is used globally","url":"https://tickets.puppetlabs.com/browse/PUP-7013","created_at":"2016-12-14T07:21:42.000-0800","number":"PUP-7013","body":"Since PUP-6980 (not yet released), it is possible to use a hiera.yaml version 4 in the global layer. It shouldn't be. Only version 3 and version 5 should be allowed in global scope.","closed_at":"2018-06-07T13:33:29.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7013","labels":"","state":"Closed","updated_at":"2018-06-07T13:33:29.000-0700","timestamp":1652285606.87282,"priority":"Normal","status_category":"Done","pull_request":5435},{"issue_id":"245717","title":"http_keepalive_timeout setting doesn't work correctly under Ruby 2.x","url":"https://tickets.puppetlabs.com/browse/PUP-8663","created_at":"2018-04-13T18:14:53.000-0700","number":"PUP-8663","body":"Back when the {{http_keepalive_timeout}} setting was introduced, Puppet ran under Ruby 1.9.3 and life was good:\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/5.5.0/lib/puppet/network/http/pool.rb\r\n\r\nThen Ruby 2.x descended from the mountains and brought with it a {{Net::HTTP#keep_alive_timeout}}:\r\n\r\nhttps://github.com/ruby/ruby/blob/v2_4_3/lib/net/http.rb#L664\r\n\r\nRuby's timeout defaults to 2 seconds and always overrides the timeout used by the Puppet agent. This causes HTTP connections to be closed early instead of being re-used which increases the TLS handshake load on Puppet Server along with the amount of connection state that network devices between the agent and server have to contend with.\r\n\r\n\r\nh2. Reproduction Case\r\n\r\n  - Install {{puppet-agent}} 5.5.0 and {{puppetserver}} 5.3.0 on a CentOS 7\r\n    node:\r\n\r\n{code:bash}\r\nrpm -Uvh http://yum.puppetlabs.com/puppet5/puppet5-release-el-7.noarch.rpm\r\nyum install -y puppet-agent-5.5.0 puppetserver-5.3.0\r\n{code}\r\n\r\n  - Configure the puppet agent to connect to the local host and start\r\n    puppetserver:\r\n\r\n{code:bash}\r\n/opt/puppetlabs/bin/puppet config set --section main server $(hostname -f)\r\nsystemctl start puppetserver\r\n{code}\r\n\r\n\r\n  - Run {{puppet agent -t}} to verify things work.\r\n\r\n  - Add a custom fact that will sleep for 4 seconds, which delays the\r\n    HTTP POST request for a catalog:\r\n\r\n{code:bash}\r\ncat <<-'EOF' > /etc/puppetlabs/code/modules/testmod/lib/facter/sleep_fact.rb\r\nFacter.add(:sleep_fact) do\r\n  setcode do\r\n    $stdout.puts(\"Sleeping for 4 seconds...\")\r\n    Kernel.sleep(4)\r\n    nil\r\n  end\r\nend\r\nEOF\r\n{code}\r\n\r\n  - Set Puppet's {{http_keepalive_timeout}} to 15 seconds:\r\n\r\n{code:bash}\r\n/opt/puppetlabs/bin/puppet config set --section main http_keepalive_timeout 15s\r\n{code}\r\n\r\n  - Run {{puppet agent -t}} and track HTTP connections:\r\n\r\n{code:bash}\r\n/opt/puppetlabs/bin/puppet agent -t --http_debug 2>&1|grep -v '^->\\|<-'\r\n{code}\r\n\r\n\r\nh3. Outcome\r\n\r\nThe Puppet Agent opens a new TCP connection after loading facts despite\r\n{{http_keepalive_timeout}} being set to 15 seconds:\r\n\r\n{noformat}\r\n# /opt/puppetlabs/bin/puppet agent -t --http_debug 2>&1|grep -v '^->\\|<-'\r\nopening connection to m4t83ynafhampi9.delivery.puppetlabs.net:8140...\r\nopened\r\nstarting SSL for m4t83ynafhampi9.delivery.puppetlabs.net:8140...\r\nSSL established\r\nreading 3339 bytes...\r\nread 3339 bytes\r\nConn keep-alive\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nreading 204 bytes...\r\nread 204 bytes\r\nConn keep-alive\r\nInfo: Retrieving plugin\r\nreading 259 bytes...\r\nread 259 bytes\r\nConn keep-alive\r\nInfo: Retrieving locales\r\nreading 204 bytes...\r\nread 204 bytes\r\nConn keep-alive\r\n\r\nInfo: Loading facts\r\nSleeping for 4 seconds...\r\nConn close because of keep_alive_timeout\r\nopening connection to m4t83ynafhampi9.delivery.puppetlabs.net:8140...\r\nopened\r\nstarting SSL for m4t83ynafhampi9.delivery.puppetlabs.net:8140...\r\nSSL established\r\n\r\nreading 310 bytes...\r\nread 310 bytes\r\nConn keep-alive\r\nInfo: Caching catalog for m4t83ynafhampi9.delivery.puppetlabs.net\r\nInfo: Applying configuration version '1523668333'\r\nNotice: Applied catalog in 0.11 seconds\r\nreading 9 bytes...\r\nread 9 bytes\r\nConn keep-alive\r\n{noformat}\r\n\r\n\r\nh3. Expected Outcome\r\n\r\nThe Puppet agent should re-use the connection opened at the beginning of the run.","closed_at":"2018-06-08T13:34:58.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8663","labels":"","state":"Closed","updated_at":"2018-06-08T13:34:58.000-0700","timestamp":1652285607.50409,"priority":"Normal","status_category":"Done","pull_request":6815},{"issue_id":"244650","title":"freeze_main setting breaks when used with type aliases","url":"https://tickets.puppetlabs.com/browse/PUP-8637","created_at":"2018-04-06T11:56:23.000-0700","number":"PUP-8637","body":"The {{freeze_main}} setting throws an error when used with code containing type aliases.\r\n\r\nReproduction:\r\n\r\n{code}\r\nmkdir -p test/modules test/manifests\r\npuppet module install --modulepath test/modules puppetlabs-stdlib\r\npuppet module install --modulepath test/modules puppetlabs-haproxy\r\necho 'include haproxy; notify { \"test\": }' > test/manifests/site.pp\r\npuppet apply --modulepath test/modules --freeze_main test/manifests/site.pp --noop\r\n{code}\r\n\r\nThis error will be thrown:\r\n\r\n{code}\r\nError: Evaluation Error: Error while evaluating a Type-Name, Cannot have code outside of a class/node/define because 'freeze_main' is enabled at /Users/reidmv/tmp/modules/haproxy/manifests/init.pp:123:3 on node halcyon.corp.puppetlabs.net\r\n{code}\r\n\r\nThe line number reported is [this one|https://github.com/puppetlabs/puppetlabs-haproxy/blob/2.1.0/manifests/init.pp#L123]:\r\n\r\n{code}\r\nclass haproxy (\r\n  ...\r\n  Stdlib::Absolutepath $config_dir                             = $haproxy::params::config_dir,\r\n  ...\r\n{code}","closed_at":"2018-06-08T13:40:35.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8637","labels":"","state":"Closed","updated_at":"2018-06-08T13:40:35.000-0700","timestamp":1652285607.610584,"priority":"Normal","status_category":"Done","pull_request":6786},{"issue_id":"230681","title":"Listing tasks incorrectly maps files to task names","url":"https://tickets.puppetlabs.com/browse/PUP-8357","created_at":"2018-01-16T11:06:35.000-0800","number":"PUP-8357","body":"Currently, puppet uses basic substring matching to determine which files are associated with a given task. That causes task files to be incorrectly associated with tasks in the case where the name of one task is a prefix of another task. For example:\r\n\r\n{code}\r\n$ ls tasks\r\nfoo.sh\r\nfoo.json\r\nfoobar.sh\r\nfoobar.json\r\n{code}\r\n\r\nIn this case, all four files will match for task \"foo\", which will cause an error when trying to load that task (because a task is only allowed one executable file).\r\n\r\nPuppet should ensure that it matches only at the file extension boundary, so {{foo.sh}} and {{foo.json}} are the only files associated with task \"foo\".","closed_at":"2018-06-18T12:12:08.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8357","labels":"","state":"Closed","updated_at":"2018-06-18T12:12:08.000-0700","timestamp":1652285610.868733,"priority":"Normal","status_category":"Done","pull_request":6533},{"issue_id":"227136","title":"Application management 'plan' not working","url":"https://tickets.puppetlabs.com/browse/PUP-8269","created_at":"2017-12-18T15:56:21.000-0800","number":"PUP-8269","body":"Acceptance test failure https://cinext-jenkinsmaster-enterprise-prod-1.delivery.puppetlabs.net/job/enterprise_pe-orchestrator-client_intn-van-sys_irving/97/SLAVE_LABEL=beaker,TEST_TARGET=centos7-64.mdc-osx1011-64client.a-redhat7-64af-64af-64af,UNEEDED=UNEEDED/testReport/junit/(root)/tests_job/plan_rb/\r\n\r\n{code:title=/etc/puppetlabs/code/environments/plan_dakgj3/manifests/site.pp}\r\n\r\nsite {\r\n  plan { \"plan_dakgj3\":\r\n    nodes       => {\r\n      Node[\"v5mxsg11vm4ogwc.delivery.puppetlabs.net\"] => Plan::Node_file[\"node_file_plan_dakgj3\"],\r\n    }\r\n  }\r\n{code}\r\n\r\n{code:title=Server_Error}\r\nndocka1xg1rqbk0.delivery.puppetlabs.net (redhat7-64-1) 15:31:12$ /opt/puppetlabs/client-tools/bin/puppet-job plan --environment plan_dakgj3 --nodes v5mxsg11vm4ogwc.delivery.puppetlabs.net\r\n  Failed to submit plan: puppetlabs.orchestrator/request-failure: Server Error: Evaluation Error: Illegal Resource Type expression, expected result to be a type name, or untitled Resource, got String at /etc/puppetlabs/code/environments/plan_dakgj3/manifests/site.pp:3:3 in environment plan_dakgj3\r\n{code}","closed_at":"2018-06-18T12:12:22.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8269","labels":"","state":"Closed","updated_at":"2018-06-18T12:12:22.000-0700","timestamp":1652285611.080942,"priority":"Normal","status_category":"Done","pull_request":6466},{"issue_id":"233892","title":"Puppet Error datatype uses 'message' not 'msg' as hash key","url":"https://tickets.puppetlabs.com/browse/PUP-8406","created_at":"2018-01-30T10:16:11.000-0800","number":"PUP-8406","body":"This means using it requires translation from bolt task output and does not align with our standard API data representation of hashes that use 'msg'. The error datatype should be updates to create data hashes that include {{msg}} not {{message}} keys and it should expect that key when it is instantiated from a hash.","closed_at":"2018-06-18T12:12:25.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8406","labels":"","state":"Closed","updated_at":"2018-06-18T12:12:25.000-0700","timestamp":1652285611.188699,"priority":"Normal","status_category":"Done","pull_request":6598},{"issue_id":"223709","title":"Parameters property in Task metadata should be optional","url":"https://tickets.puppetlabs.com/browse/PUP-8197","created_at":"2017-11-22T10:07:11.000-0800","number":"PUP-8197","body":"Tasks will run and accept any arguments if no metadata is provided. However, if a metadata file is present then it requires a parameters key; that violates the [specification|https://github.com/puppetlabs/puppet-specifications/tree/master/tasks#task-metadata].\r\n\r\nAn example of the error given (using BOLT-66) is\r\n{code}\r\n$ bolt task run echo message='{\"a\": 1}' foo=1 -n node1 --modulepath site\r\nError: The metadata for task echo has wrong type, expects a value for key 'parameters' in site/echo/tasks/init.json on node mylaptop\r\nTask parameters did not match\r\n{code}","closed_at":"2018-06-18T12:12:30.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8197","labels":"","state":"Closed","updated_at":"2018-06-18T12:12:30.000-0700","timestamp":1652285611.506674,"priority":"Normal","status_category":"Done","pull_request":6387},{"issue_id":"223715","title":"Parameters in Task metadata should not collide with metadata keys","url":"https://tickets.puppetlabs.com/browse/PUP-8199","created_at":"2017-11-22T10:24:56.000-0800","number":"PUP-8199","body":"If a task declares a parameter that is also a metadata key, such as {{description}}, Puppet will fail to load the task.\r\n\r\nWith BOLT-66:\r\n{code}\r\n$ bolt task run echo message='{\"a\": 1}' -n node --modulepath site\r\nError: attribute Echo[description] is defined as both a constant and an attribute on node mylaptop\r\n{code}","closed_at":"2018-06-18T12:13:03.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8199","labels":"docs_reviewed","state":"Closed","updated_at":"2018-06-18T12:13:03.000-0700","timestamp":1652285612.098048,"priority":"Normal","status_category":"Done","pull_request":6403},{"issue_id":"227063","title":"Non-existent Solaris SMF services are no longer defined as :stopped (LTS breaking change)","url":"https://tickets.puppetlabs.com/browse/PUP-8262","created_at":"2017-12-18T09:11:31.000-0800","number":"PUP-8262","body":"In Puppet 4.10.9, the behavior of non-existent Solaris SMF services changed, and at least one PE customer with a large Solaris install base has reported that this is preventing them from upgrading within the LTS series. \r\n\r\nPreviously, non-existent Solaris SMF services reported their state as :stopped, and could be defined as :stopped in Puppet code, to ensure that unwanted services were not running, even if they were not installed. \r\n\r\nIn Puppet 4.10.9, this behavior was changed to cause non-existent Solaris SMF services to report a state of :absent. A change like this should probably not be included in our LTS releases. Reverting the commits related to this change should be sufficient to resolve this issue for our customers.  ","closed_at":"2018-06-25T14:16:51.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8262","labels":"","state":"Closed","updated_at":"2018-06-25T14:16:51.000-0700","timestamp":1652285612.732469,"priority":"Normal","status_category":"Done","pull_request":6454},{"issue_id":"18234","title":"Remove broken macauthorization provider from core types","url":"https://tickets.puppetlabs.com/browse/PUP-661","created_at":"2013-11-05T09:31:53.000-0800","number":"PUP-661","body":"*Update 12/22*: Based on comments from Allister and Nigel this should be removed from core types. That may need to wait until Puppet 5 for semver reasons.\r\n\r\nIn OS X 10.9, `/etc/authorization` has been \"deprecated\"; as of the GM, the update will move `/etc/authorization` to `/etc/authorization.deprecated`.\r\n\r\nThere is now `/System/Library/Security/authorization.plist` but it seems to just be the defaults; changing a right with the `security authorizationdb` command doesn't change that file, but instead updates a sqlite db at `/var/db/auth.db`.\r\n\r\nI did some quick testing, and just changing `AuthDB` in `puppet/provider/macauthorization/macauthorization.rb` isn't enough because the provider reads the plist to determine current state, but in the 10.9 world the current state is reflected in the `auth.db` file (or the output of `security authorizationdb` commands) so even when a right change is applied, puppet doesn't know.","closed_at":"2018-07-03T14:58:43.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-661","labels":"breaking;macos;redmine;removal;type_and_provider","state":"Closed","updated_at":"2018-07-03T14:58:43.000-0700","timestamp":1652285626.779435,"priority":"Normal","status_category":"Done","pull_request":5244},{"issue_id":"13658","title":"Allow puppet to manage owner & group file settings (Redmine 18342)","url":"https://tickets.puppetlabs.com/browse/PUP-266","created_at":"2013-08-26T15:38:36.000-0700","number":"PUP-266","body":"From original Redmine ticket 18342 comment from [~josh], which this duplicates:\r\n\r\n{quote}I disabled the file settings code that manages owner and group on Windows, because at the time we didn’t yet have the ability to chown/chgrp. This has since been implemented, and so the ability to manage owner and group should be added.\r\n\r\nIn lib/puppet/settings/file_setting.rb\r\n\r\n# REMIND fails on Windows because chown/chgrp functionality not supported yet\r\nif Puppet.features.root? and !Puppet.features.microsoft_windows?\r\nWe also need to unconfine the acceptance test acceptance/tests/config/apply_file_metadata_specified_in_config.rb so that it runs on windows. See [#17371|https://projects.puppetlabs.com/issues/17371]{quote}","closed_at":"2018-07-12T14:18:25.000-0700","comments":21,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-266","labels":"windows","state":"Closed","updated_at":"2018-07-12T14:18:25.000-0700","timestamp":1652285630.693328,"priority":"Normal","status_category":"Done","pull_request":2700},{"issue_id":"217236","title":"Enforcement via 'puppet resource/apply' overwrites transactionstore.yaml","url":"https://tickets.puppetlabs.com/browse/PUP-8227","created_at":"2017-10-19T08:34:16.000-0700","number":"PUP-8227","body":"Enforcing change using \"puppet resource\" or \"puppet apply\" causes the transactionstore.yaml file to be overwritten. This is often done as part of our integrations plus is common puppet usage among customers. The loss of the tx store mans that corrective change is not correctly identified on the run immediately afterwards. The next run causes the agent to restore the tx store again.\r\n\r\nStep 1 - After a run the tx store looks as expected\r\n!step1-after-puppet-run-the-txstore-looks-good.png|thumbnail!\r\nStep 2 - Enforce a change with puppet resource and the tx store is overwritten\r\n!step2-puppet-resource-enforcement-overwrites-txstore.png|thumbnail!\r\nStep 3 - The next agent run restores the expected tx store\r\n!step3-agreen-run-restores-txstore.png|thumbnail!\r\nStep 4 - Same issue using puppet apply, also doesn't matter if the enforcement succeeds or fails\r\n!step4-puppet-apply-breaks-too.png|thumbnail!\r\n\r\nThe proposed fix is to modify the agent to load and store the transaction file only for agent runs, not puppet resource/apply, and consider making that behaviour configurable. We should also document that if you use \"puppet resource\" to modify a resource that is also managed by the agent, this is considered an out-of-band change and reported as corrective (e.g. agent creates file foo, user removes file foo using \"puppet resource\", agent recreates file foo and considers it a corrective change).\r\n\r\nHere's the original description explaining how this manifests in the wild.\r\n\r\n{quote}\r\nJust had this happen during demo of 2017.3.0. I have a simple apache role with profiles and demo drift remediation by removing the index.html and having puppet heal it.\r\n\r\nhttps://github.com/puppetlabs/puppet-vro-starter_content/blob/production/site/profile/manifests/sample_website/linux.pp#L36-L39\r\n\r\nBut on the first noop run, it shows that \"intentional changes\" would be needed, and then enforcement shows \"intentional changes\". When I did the same thing again, it showed \"corrective changes\". Baffling. Also, the node graph did not update with colors representing corrective or intentional change (separate ticket coming).\r\n\r\n!Screen Shot 2017-10-19 at 8.34.57 AM.png|thumbnail!\r\n\r\nexplanation of above:\r\n* first run (bottom) is initial provisioning (intentional change makes sense)\r\n* second run is green, (no changes makes sense)\r\n* third run is after I executed {{rm -f /var/www/sample_website/index.html}} in an ssh session on the target machine. Shows intentional noop changes needed! Should be corrective noop!\r\n* fourth run is intentional change, wrong, should be corrective.\r\n* fifth run is after I executed {{rm -f /var/www/sample_website/index.html}} again. Got corrective noop this time, which is correct.\r\n* sixth run is enforcement of corrective change, which is correct.\r\n{quote}","closed_at":"2018-07-16T17:11:45.000-0700","comments":16,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8227","labels":"","state":"Closed","updated_at":"2018-07-16T17:11:45.000-0700","timestamp":1652285632.008757,"priority":"Major","status_category":"Done","pull_request":6543},{"issue_id":"252295","title":"Logging as JSON broken","url":"https://tickets.puppetlabs.com/browse/PUP-8773","created_at":"2018-05-23T04:36:08.000-0700","number":"PUP-8773","body":"*Puppet Version: 5.5.1*\r\n *Puppet Server Version: n/a*\r\n *OS Name/Version: RHEL 7.x*\r\n\r\nRunning the puppet agent with the --logdest option pointing at a JSON target file causes a Ruby backtrace.\r\n\r\n*Desired Behavior:*\r\n\r\nPuppet should log as JSON.\r\n\r\n*Actual Behavior:*\r\n\r\n \r\n\r\nExample output:\r\n{noformat}# puppet agent -t --noop --logdest /tmp/foo.json\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_gems/gems/multi_json-1.13.1/lib/multi_json.rb:130:in `current_adapter': undefined method `[]' for #<File:/tmp/foo.json> (NoMethodError)\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_gems/gems/multi_json-1.13.1/lib/multi_json.rb:139:in `dump'\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/json.rb:70:in `dump'\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log/destinations.rb:112:in `handle'\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:191:in `block in newmessage'\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:190:in `each'\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:190:in `newmessage'\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:308:in `initialize'\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:88:in `new'\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:88:in `create'\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/logging.rb:11:in `send_log'\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/logging.rb:20:in `block (2 levels) in <module:Logging>'\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/logging.rb:69:in `log_exception'\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:673:in `rescue in exit_on_fail'\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:660:in `exit_on_fail'\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:366:in `run'\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:137:in `run'\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:73:in `execute'\r\n        from /opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\n{noformat}\r\nChange the log destination to /tmp/foo.txt and it doesn't error.\r\n\r\nIt looks like this bug was introduced in 5.5.0, 5.4.0 still works as expected, possibly related to PUP-8501.","closed_at":"2018-07-18T06:39:36.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8773","labels":"","state":"Closed","updated_at":"2018-07-18T06:39:36.000-0700","timestamp":1652285632.989166,"priority":"Normal","status_category":"Done","pull_request":6852},{"issue_id":"246866","title":"Memory leak in Puppet Server from loading translations","url":"https://tickets.puppetlabs.com/browse/PUP-8672","created_at":"2018-04-20T13:47:24.000-0700","number":"PUP-8672","body":"There is a memory leak introduced with i18n which is triggered when an environment is expired. If the environment was ephemeral and will never be used again, then the translation repository related to that environment will never be deleted.\r\n\r\nSpecifically https://github.com/puppetlabs/puppet/blob/master/lib/puppet/gettext/config.rb#L120 never successfully clears a translation repository. When we add a text domain, we always use a symbolized version of the environment name. When we delete the domain, it uses the environment name in the environment cache (which is almost always a string). Meaning we almost never actually delete a domain. When an environment is used again, it will overwrite the previous {{translation_repositories}} entry, so garbage collection will then cleanup the old translation repository.\r\n\r\nWhile digging into this, we also found that successfully deleting domains leads to a thread-local storage issue in Puppet Server that will need to be addressed:\r\n* thread A creates an environment as part of a request\r\n* thread B deletes it because it's expired (so A's {{text_domain}} now refers to an absent domain) and creates a different environment\r\n* thread A tries to handle a request and fails because it's configured for an unknown domain.","closed_at":"2018-07-18T06:39:43.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8672","labels":"","state":"Closed","updated_at":"2018-07-18T06:39:43.000-0700","timestamp":1652285633.323728,"priority":"Normal","status_category":"Done","pull_request":6796},{"issue_id":"242614","title":"puppet device --resource should fail if non-existent target is given","url":"https://tickets.puppetlabs.com/browse/PUP-8585","created_at":"2018-03-22T09:15:37.000-0700","number":"PUP-8585","body":"The error message is not displayed unless --debug is passed.","closed_at":"2018-07-18T06:39:46.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8585","labels":"","state":"Closed","updated_at":"2018-07-18T06:39:46.000-0700","timestamp":1652285633.429633,"priority":"Normal","status_category":"Done","pull_request":6826},{"issue_id":"82885","title":"windows file resource doesn't grant group full permissions","url":"https://tickets.puppetlabs.com/browse/PUP-4684","created_at":"2015-06-02T17:00:37.000-0700","number":"PUP-4684","body":"If you grant {{rwx}} permission to a file's group:\r\n\r\n{code:puppet}\r\nuser { 'foo':\r\n  ensure => present,\r\n  managehome => false,\r\n  password => 'foo1234!',\r\n  groups => ['Users'],\r\n}\r\nfile { 'C:\\foo':\r\n  ensure => directory,\r\n  owner => 'foo',\r\n  group => 'Administrators',\r\n  mode => '0770',\r\n}\r\nfile { 'C:\\foo\\foo.bat':\r\n  ensure => file,\r\n  content => 'echo \"hello\"'\r\n}\r\n{code}\r\n\r\nThe windows provider does not map that to full control. Instead the group receives a subset of permissions. More specifically, any file contained in the directory being managed is not executable:\r\n\r\n{noformat}\r\nC:\\> puppet apply foo.pp\r\nNotice: Compiled catalog for win-qp47voha2p4.solar.lan in environment production in 0.50 seconds\r\nNotice: /Stage[main]/Main/File[C:\\foo]/ensure: created\r\nNotice: /Stage[main]/Main/File[C:\\foo\\foo.bat]/ensure: defined content as '{md5}84b8f5c3577073eac07c9e9915e5b8c9'\r\nNotice: Applied catalog in 0.06 seconds\r\nC:\\> icacls c:\\foo\r\nc:\\foo WIN-QP47VOHA2P4\\foo:(F)\r\n       BUILTIN\\Administrators:(RX,W,DC)\r\n       Everyone:(Rc,S,RA)\r\n       NT AUTHORITY\\SYSTEM:(F)\r\n       CREATOR OWNER:(CI)(IO)(F)\r\n       CREATOR GROUP:(CI)(IO)(RX,W,DC)\r\n       CREATOR OWNER:(OI)(IO)(R,W,D,WDAC,WO,DC)\r\n       CREATOR GROUP:(OI)(IO)(R,W,DC)\r\n\r\nSuccessfully processed 1 files; Failed processing 0 files\r\nC:\\> icacls C:\\foo\\foo.bat\r\nC:\\foo\\foo.bat BUILTIN\\Administrators:(I)(R,W,D,WDAC,WO,DC)\r\n               WIN-QP47VOHA2P4\\None:(I)(R,W,DC)\r\n{noformat}","closed_at":"2018-07-18T06:39:47.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4684","labels":"windows","state":"Closed","updated_at":"2018-07-18T06:39:47.000-0700","timestamp":1652285633.536727,"priority":"Normal","status_category":"Done","pull_request":6859},{"issue_id":"221627","title":"Service SMF provider tries to stop absent service","url":"https://tickets.puppetlabs.com/browse/PUP-8167","created_at":"2017-11-12T19:06:14.000-0800","number":"PUP-8167","body":"A behavior change introduced in PUP-6797 for the SMF service provider breaks existing code for customers that are upgrading. The SMF provider now sets a service as _absent_ instead of _stopped_ when the service is not found on the system. The service provider does not check for the existence of the service when trying to stop the service. The result is that configuring an absent service to be stopped will error out, where as it previously succeeded. \r\n\r\nThe issue is not with the _absent_ change, but rather that the _stop_ is run against the _absent_ service. Below is an easy reproduction case. \r\n\r\nInstall any agent 4.9.0+ and apply the following manifest. \r\n\r\n{code}\r\n# cat test.pp\r\nservice {'svc:/system/console-login:terma':\r\nensure => stopped,\r\nenable => false,\r\nprovider => 'smf',\r\n}\r\n{code}\r\n\r\nThe resulting output is as follows.\r\n\r\n{code}\r\nDebug: Executing: '/usr/bin/svcs -H -o state,nstate svc:/system/console-login:terma'\r\nDebug: Service[svc:/system/console-login:terma](provider=smf): Could not get status on service svc:/system/console-login:terma Execution of '/usr/bin/svcs -H -o state,nstate svc:/system/console-login:terma' returned 1: svcs: Pattern 'svc:/system/console-login:terma' doesn't match any instances\r\nDebug: Executing: '/usr/sbin/svcadm disable -s svc:/system/console-login:terma'\r\nError: Could not stop Service[svc:/system/console-login:terma]: Execution of '/usr/sbin/svcadm disable -s svc:/system/console-login:terma' returned 1: svcadm: Pattern 'svc:/system/console-login:terma' doesn't match any instances\r\nError: /Stage[main]/Main/Service[svc:/system/console-login:terma]/ensure: change from absent to stopped failed: Could not stop Service[svc:/system/console-login:terma]: Execution of '/usr/sbin/svcadm disable -s svc:/system/console-login:terma' returned 1: svcadm: Pattern 'svc:/system/console-login:terma' doesn't match any instances\r\n{code}\r\n\r\nWhat I would expect is that since the service is marked as absent per [this commit|https://github.com/puppetlabs/puppet/commit/3d7a3c4c1c6697047ae356c8765928f68618bc69#diff-aacae589790e4f5cfb9e267afbffa294] and then the stop service should not be run since the service is absent. The service resource does not provide an _absent_ value to the _ensure_ parameter. ","closed_at":"2018-07-20T06:22:17.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8167","labels":"","state":"Closed","updated_at":"2018-07-20T06:22:17.000-0700","timestamp":1652285635.440236,"priority":"Normal","status_category":"Done","pull_request":6384},{"issue_id":"222298","title":"break() fails with illegal context error within hash iteration outside any function","url":"https://tickets.puppetlabs.com/browse/PUP-8181","created_at":"2017-11-15T16:11:24.000-0800","number":"PUP-8181","body":"break() fails with an illegal context error within hash iteration outside any function\r\n\r\nIt may be that I simply need to use a function and call it a day... I am, however, surprised that this doesn't work, and I wonder if this is by design or by accident.\r\n\r\n{code:puppet}\r\n# test2.pp\r\n\r\n$test_hash = {\r\n  'Linus'   => 'Torvalds',\r\n  'Richard' => 'Stallman',\r\n  'Dennis'  => 'Ritchie',\r\n}\r\n\r\n$test_hash.each |String $first, String $last| {\r\n  if $last == 'Stallman' {\r\n    notice(\"YES\")\r\n    break()\r\n  }\r\n  else {\r\n    notice(\"NO\")\r\n  }\r\n}\r\n{code}\r\n\r\n{code:bash}\r\n$ puppet apply test2.pp\r\nNotice: Scope(Class[main]): NO\r\nNotice: Scope(Class[main]): YES\r\nError: break() from context where this is illegal at /tmp/test2.pp:12 on node <node>\r\n{code}\r\n\r\n\r\nI've tried the same thing with {{return()}}:\r\n{code:bash}\r\n$ puppet apply test2.pp\r\nNotice: Scope(Class[main]): NO\r\nNotice: Scope(Class[main]): YES\r\nError: return() from context where this is illegal at /tmp/test2.pp:13 on node <node>\r\n{code}\r\n\r\nIf I run {{break()}} within a class, I get the same error.\r\n\r\nIf I run {{return()}} within a class, it breaks out of the entire class rather than just the lambda in the {{.each}} loop:\r\n{code:puppet}\r\n# test3.pp\r\n\r\nclass test_class {\r\n  $test_hash = {\r\n    'Linus'   => 'Torvalds',\r\n    'Richard' => 'Stallman',\r\n    'Dennis'  => 'Ritchie',\r\n  }\r\n\r\n  $test_hash.each |String $first, String $last| {\r\n    if $last == 'Stallman' {\r\n      notice(\"YES\")\r\n      return()\r\n    }\r\n    else {\r\n      notice(\"NO\")\r\n    }\r\n  }\r\n\r\n  notice(\"OUT OF THE LOOP\")\r\n}\r\n\r\ninclude ::test_class\r\n{code}\r\n\r\n{code:bash}\r\n$ puppet apply test3.pp\r\nNotice: Scope(Class[Test_class]): NO\r\nNotice: Scope(Class[Test_class]): YES\r\nNotice: Compiled catalog for <node> in environment production in 0.26 seconds\r\nNotice: Applied catalog in 0.45 seconds\r\n{code}\r\n\r\n\r\nEdit: Issue may be confined to hashes. I'm trying `map` like in the language doc's examples (https://puppet.com/docs/puppet/5.3/function.html#break). The array example works fine. The hash example breaks.\r\n{code:bash}\r\n# test4.pp\r\n\r\nclass test_class {\r\n  $data = [1,2,3]\r\n  notice $data.map |$x| {\r\n    if $x == 3 {\r\n      break()\r\n    }\r\n    $x*10\r\n  }\r\n\r\n  $data_hash = { 'a' => 1, 'b' => 2, 'c' => 3 }\r\n  notice $data_hash.map |$key, $value| {\r\n    if $value == 3 {\r\n      break()\r\n    }\r\n    $value*10\r\n  }\r\n\r\n  notice(\"OUT OF THE LOOP\")\r\n}\r\n\r\ninclude ::test_class\r\n{code}\r\n{code:bash}\r\n$ puppet apply test4.pp\r\nNotice: Scope(Class[Test_class]): [10, 20]\r\nError: break() from context where this is illegal at /tmp/test4.pp:15 on node <node>\r\n{code}\r\n\r\n\r\nExample of a workaround using a function and {{return()}}:\r\n{code:puppet}\r\n# test5.pp\r\nfunction has_two($data) {\r\n  $data.each |$key, $value| {\r\n    if $value == 2 {\r\n      return(true)\r\n    }\r\n  }\r\n\r\n  return(false)\r\n}\r\n\r\n$data = { 'a' => 1, 'b' => 2, 'c' => 3 }\r\nif has_two($data) {\r\n  notice \"YES\"\r\n}\r\nelse {\r\n  notice \"NO\"\r\n}\r\n{code}\r\n\r\n{code:bash}\r\n$ puppet apply test5.pp\r\nNotice: Scope(Class[main]): YES\r\nNotice: Compiled catalog for <node> in environment production in 0.16 seconds\r\nNotice: Applied catalog in 0.49 seconds\r\n{code}","closed_at":"2018-07-23T15:28:01.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8181","labels":"","state":"Closed","updated_at":"2018-07-23T15:28:01.000-0700","timestamp":1652285644.472999,"priority":"Major","status_category":"Done","pull_request":6374},{"issue_id":"233021","title":"Puppet Resource Service fails on Debian/Ubuntu when non systemd service is called","url":"https://tickets.puppetlabs.com/browse/PUP-8396","created_at":"2018-01-25T06:07:44.000-0800","number":"PUP-8396","body":"*Puppet Version:* 5.3.3\r\n*Puppet Server Version:* 5.3.3\r\n*OS Name/Version:* Ubuntu 16.04\r\n\r\nDescribe your issue in as much detail as possible…\r\n\r\nIn 16.04 when using puppet resource service, it bombs out if some of the services aren't using systemd, and trying to contact upstart, we should be handling this error better \r\n\r\nDescribe steps to reproduce…\r\n\r\nIt seems that a vanilla install of Ubuntu 16.x is OK, however when intalling additional Ubuntu packages such as the GUI, we se this error\r\n\r\nTo reproduce\r\n\r\nInstall Ubuntu 16.04\r\n\r\nInstall the desktop packages\r\n\r\n\r\n{code:java}\r\nsudo apt-get update\r\nsudo apt-get install ubuntu-desktop\r\nreboot\r\n{code}\r\n\r\nLogin via the GUI and open up a terminal or  SSH into the server\r\n\r\nrun puppet resource service \r\n\r\nand you will get the error \r\n\r\n\r\n{code:java}\r\nDebug: Executing '/sbin/initctl list'\r\nError: Could not run: #<IO:0x00000000017b6cf8>\r\n{code}\r\n\r\nDebug run attached\r\n\r\n\r\n*Desired Behavior:*\r\n\r\nWhen the service cannot connect to jumpstart/returns it shouldn't break the command, the error should be handled and the services are returned \r\n\r\n*Actual Behavior:*\r\n\r\nThe command errors out \r\n\r\n\r\nPlease take a moment and attach any relevant log output and/or manifests. This will help us immensely when troubleshooting the issue.\r\n\r\nAttached \r\n\r\n\r\n","closed_at":"2018-07-24T09:27:00.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8396","labels":"cs_pr_review;cspapercuts;linux;sadness;service;type_and_provider;ubuntu","state":"Closed","updated_at":"2018-07-24T09:27:00.000-0700","timestamp":1652285645.219941,"priority":"Major","status_category":"Done","pull_request":6766},{"issue_id":"212078","title":"group resource doesn't default to ensure=>present","url":"https://tickets.puppetlabs.com/browse/PUP-7968","created_at":"2017-09-20T13:23:18.000-0700","number":"PUP-7968","body":"{code:puppet}\r\ngroup { 'what':\r\n#ensure => present,\r\n#gid => 1234,\r\n}\r\n{code}\r\nIf I do a \"puppet apply --debug /tmp/x.pp\" the group will not be created with the manifest as above. The relevant line in the debug output appears to be:\r\n{code}\r\nDebug: /Stage[main]/Main/Group[what]: Nothing to manage: no ensure and the resource doesn't exist\r\n{code}\r\nIt will be created if I uncomment either of the ensure or gid parameters.\r\n\r\nWith only the gid uncommented the debug output includes:\r\n{code}\r\nDebug: Executing: '/sbin/groupadd -g 1234 what'\r\nNotice: /Stage[main]/Main/Group[what]/ensure: created\r\n{code}\r\nWith only the ensure uncommented the debug output includes:\r\n{code}\r\nDebug: Executing: '/sbin/groupadd what'\r\nNotice: /Stage[main]/Main/Group[what]/ensure: created\r\n{code}\r\nWith both uncommented the debug output includes:\r\n{code}\r\nDebug: Executing: '/sbin/groupadd -g 1234 what'\r\nNotice: /Stage[main]/Main/Group[what]/ensure: created\r\n{code}","closed_at":"2018-08-01T08:00:44.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7968","labels":"beginner","state":"Closed","updated_at":"2018-08-01T08:00:44.000-0700","timestamp":1652285646.95718,"priority":"Minor","status_category":"Done","pull_request":6433},{"issue_id":"267129","title":"tagged function should downcase arguments","url":"https://tickets.puppetlabs.com/browse/PUP-9024","created_at":"2018-07-30T01:27:17.000-0700","number":"PUP-9024","body":"*Puppet Version: 5.5.3*\r\n *Puppet Server Version: 5.3.4*\r\n *OS Name/Version: Ubuntu 18.04.1 LTS (Bionic Beaver)*\r\n\r\nAs Puppet always makes resource tags downcased and the same thing is doing PuppetDB while querying ([https://github.com/puppetlabs/puppetdb/pull/260),] tagged function should probably do the same.\r\n\r\n*Desired Behavior:*\r\n\r\nFollowing code should notify 'true':\r\n\r\n \r\n{code:java}# cat test.pp \r\nclass foo { }\r\ninclude foo\r\nif tagged(\"Class\") {\r\n\tnotify { 'true': }\r\n} else {\r\n\tnotify { 'false': }\r\n}\r\n# puppet apply -t test.pp\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nNotice: Compiled catalog for local.local in environment production in 0.06 seconds\r\nInfo: Applying configuration version '87c2c0fd052b62985e08e77716d9ee223c690c3d'\r\nNotice: false\r\nNotice: /Stage[main]/Main/Notify[false]/message: defined 'message' as 'false'\r\nNotice: Applied catalog in 0.87 seconds\r\n{code}\r\n \r\n\r\n*Actual Behavior:*\r\n\r\nMentioned code returns Notify[false], which is incorrect.","closed_at":"2018-08-22T13:14:10.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9024","labels":"docs_reviewed","state":"Closed","updated_at":"2018-08-22T13:14:10.000-0700","timestamp":1652285650.495885,"priority":"Normal","status_category":"Done","pull_request":6953},{"issue_id":"263153","title":"augeas provider calls eval to convert stringified arrays into ruby arrays","url":"https://tickets.puppetlabs.com/browse/PUP-8974","created_at":"2018-06-28T14:21:07.000-0700","number":"PUP-8974","body":"The augeas provider calls ruby's {{Kernel.eval}} to covert a stringified array, e.g. {{'[\"/etc/ssh/ssh_host_rsa_key\"]'}} into a ruby array {{[\"/etc/ssh/ssh_host_rsa_key\"]}}. The values always come from the manifest so are not typically arbitrary user-input.\r\n\r\nHowever, if a manifest were to rely on facts that an unprivileged user could write, then it would result in privilege escalation. I don't think this is really exploitable, but it would be good to fix the provider to not use {{eval}}.\r\n{noformat}[root@h9smfls1mfp5thy ~]# cat manifest.pp\r\n# $keys =  '[\"/etc/ssh/ssh_host_rsa_key\"]'\r\n\r\naugeas {\"sshd_config\":\r\n   context => \"/files/etc/ssh/sshd_config\",\r\n   changes => [\r\n      \"set PermitRootLogin yes\",\r\n   ],\r\n  onlyif => \"values HostKey == $keys\"\r\n}\r\n[root@h9smfls1mfp5thy ~]# cat /etc/ssh/sshd_config\r\n# File is managed by Puppet\r\n\r\nAcceptEnv LANG LC_*\r\nChallengeResponseAuthentication no\r\nGSSAPIAuthentication no\r\nPermitRootLogin no\r\nPrintMotd no\r\nSubsystem sftp /usr/libexec/openssh/sftp-server\r\nUseDNS no\r\nUsePAM yes\r\nX11Forwarding yes\r\n# HostKeys for protocol version 2\r\nHostKey /etc/ssh/ssh_host_rsa_key\r\n[root@h9smfls1mfp5thy ~]# FACTER_keys='puts \"hi\"' puppet apply --noop manifest.pp\r\nNotice: Compiled catalog for h9smfls1mfp5thy.delivery.puppetlabs.net in environment production in 0.03 seconds\r\nhi\r\nNotice: Applied catalog in 0.37 seconds\r\n{noformat}","closed_at":"2018-08-22T13:15:08.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8974","labels":"docs_reviewed","state":"Closed","updated_at":"2018-08-22T13:15:08.000-0700","timestamp":1652285650.595542,"priority":"Normal","status_category":"Done","pull_request":6903},{"issue_id":"265325","title":"The zypper and rpm providers have duplicate instance lists","url":"https://tickets.puppetlabs.com/browse/PUP-9009","created_at":"2018-07-18T11:55:11.000-0700","number":"PUP-9009","body":"*Problem*\r\nPE package inventory shows duplicate packages for the {{rpm}} and {{zypper}} providers on SLES.\r\n\r\n*Expected behavior*\r\nPE package inventory shows one copy of the package. This behavior is seen on EL, but not SLES. \r\n\r\n*What we think is happening*\r\nThe {{zypper}} provider for the package resource inherits from the {{rpm}} provider, but does not specify it as the {{:source}}. This results in both {{zypper}} and {{rpm}} being returned by the [providers_by_source |https://www.rubydoc.info/gems/puppet/Puppet/Type#providers_by_source-class_method] method. The result is that PE package inventory shows duplicate packages for these two providers on SLES.\r\n\r\nThe zypper provider: \r\nhttps://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/package/zypper.rb#L1\r\n\r\nThis behavior is not seen on RHEL as the {{yum}} provider has {{rpm}} as a {{:source}}. https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/package/yum.rb#L1 \r\n\r\n*Questions*\r\nWhat are risks of setting {{:source => :rpm}} in the {{zypper}} provider?","closed_at":"2018-08-30T22:31:31.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9009","labels":"cspapercuts;package;rpm;sles;type_and_provider;zypper","state":"Resolved","updated_at":"2018-08-30T22:31:31.000-0700","timestamp":1652285651.415957,"priority":"Normal","status_category":"Done","pull_request":7018},{"issue_id":"225926","title":"Starting to get broken pipe (HTTP 500) on certain manifest - gone after restarting puppetserver","url":"https://tickets.puppetlabs.com/browse/PUP-8467","created_at":"2017-12-08T10:02:16.000-0800","number":"PUP-8467","body":"After a while a certain manifest started firing HTTP 500 on the puppetserver side, though nothing had changed.\r\n\r\nclients were aborting catalog compilation with:\r\n\r\n{code}\r\nError: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Method call, Broken pipe - <STDERR> at /srv/puppet/code/environments/production/modules/amodule/manifests/init.pp:16:35 on node node1.example.com\r\n{code}\r\n\r\nServer logs were showing the following:\r\n\r\n{code}\r\n2017-12-08 18:29:02,277 ERROR [qtp526724218-38738] [puppetserver] Puppet Evaluation Error: Error while evaluating a Method call, Broken pipe - <STDERR> at /srv/puppet/code/environments/production/modules/amodule/manifests/init.pp:16:35 on node node1.example.com\r\norg/jruby/RubyIO.java:1457:in `write'\r\norg/jruby/RubyIO.java:1428:in `write'\r\norg/jruby/RubyKernel.java:1000:in `eval'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/ruby_function_instantiator.rb:22:in `create'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/module_loaders.rb:166:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:151:in `internal_load'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:32:in `load_typed'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:143:in `internal_load'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:32:in `load_typed'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:143:in `internal_load'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:32:in `load_typed'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:143:in `internal_load'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:32:in `load_typed'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:143:in `internal_load'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:32:in `load_typed'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/loader.rb:53:in `load'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:304:in `call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:951:in `call_function_with_block'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:944:in `eval_CallMethodExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:90:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:358:in `eval_AssignmentExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:90:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:646:in `block in eval_BlockExpression'\r\norg/jruby/RubyArray.java:1734:in `each'\r\norg/jruby/RubyEnumerable.java:936:in `inject'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:646:in `eval_BlockExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:90:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/evaluating_parser.rb:63:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:32:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:72:in `block in evaluate'\r\norg/jruby/RubyKernel.java:1120:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:71:in `block in evaluate'\r\norg/jruby/RubyKernel.java:1120:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:70:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast.rb:31:in `safeevaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:136:in `evaluate_code'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:79:in `block in evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:71:in `evaluate'\r\norg/jruby/RubyArray.java:1734:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:384:in `evaluate_classes'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/../../../puppet/functions/include.rb:16:in `include'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatch.rb:60:in `invoke'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:43:in `block in dispatch'\r\norg/jruby/RubyKernel.java:1120:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:42:in `dispatch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:46:in `block in call'\r\norg/jruby/RubyKernel.java:1120:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:45:in `call'\r\n/srv/puppet/code/environments/production/modules/site/configsets/manifests/types/immerx_10.pp:6:in `<eval>'\r\norg/jruby/RubyKernel.java:1000:in `eval'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:307:in `block in call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:305:in `call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:949:in `call_function_with_block'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:918:in `eval_CallNamedFunctionExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:90:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:646:in `block in eval_BlockExpression'\r\norg/jruby/RubyArray.java:1734:in `each'\r\norg/jruby/RubyEnumerable.java:936:in `inject'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:646:in `eval_BlockExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:90:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/evaluating_parser.rb:63:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:32:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:72:in `block in evaluate'\r\norg/jruby/RubyKernel.java:1120:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:71:in `block in evaluate'\r\norg/jruby/RubyKernel.java:1120:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:70:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast.rb:31:in `safeevaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:136:in `evaluate_code'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:79:in `block in evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:71:in `evaluate'\r\norg/jruby/RubyArray.java:1734:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:384:in `evaluate_classes'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/../../../puppet/functions/include.rb:16:in `include'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatch.rb:60:in `invoke'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:43:in `block in dispatch'\r\norg/jruby/RubyKernel.java:1120:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:42:in `dispatch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:46:in `block in call'\r\norg/jruby/RubyKernel.java:1120:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:45:in `call'\r\n/srv/puppet/code/environments/production/manifests/site.pp:121:in `<eval>'\r\norg/jruby/RubyKernel.java:1000:in `eval'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:307:in `block in call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:305:in `call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:949:in `call_function_with_block'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:918:in `eval_CallNamedFunctionExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:90:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:646:in `block in eval_BlockExpression'\r\norg/jruby/RubyArray.java:1734:in `each'\r\norg/jruby/RubyEnumerable.java:936:in `inject'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:646:in `eval_BlockExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:90:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/evaluating_parser.rb:63:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:32:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast.rb:31:in `safeevaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:133:in `block in evaluate_code'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/scope.rb:953:in `with_guarded_scope'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:131:in `evaluate_code'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:79:in `block in evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:71:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:505:in `evaluate_ast_node'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:168:in `block in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:168:in `block in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:263:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:153:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:33:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:297:in `block in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:295:in `block in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:224:in `block in benchmark'\r\nuri:classloader:/META-INF/jruby.home/lib/ruby/stdlib/benchmark.rb:308:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:223:in `benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:293:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:52:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:195:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:121:in `do_find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:48:in `block in call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:263:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:47:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:82:in `block in process'\r\n{code}\r\n\r\nRestarting the puppetserver made the problem go away.\r\n\r\nAll hosts using that module were affected.\r\n\r\nThe offending line in the manifest looks like:\r\n\r\n{code}\r\n   $dump_sources = $hosts.map |$h| { \"https://${acustomfcuntion('somevalue',$h)}.example.com\" }\r\n{code}","closed_at":"2018-09-12T01:36:38.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8467","labels":"","state":"Closed","updated_at":"2018-09-12T01:36:38.000-0700","timestamp":1652285653.69605,"priority":"Normal","status_category":"Done","pull_request":6636},{"issue_id":"260799","title":"Selmodule thinks foo exists if myfoo is loaded","url":"https://tickets.puppetlabs.com/browse/PUP-8943","created_at":"2018-06-13T10:00:33.000-0700","number":"PUP-8943","body":"The selmodule provider runs {{selmodule --list}} to check if a module is already loaded in the  exists? method.\r\n\r\nThe regex only checks {{modulename\\b}} and does not anchor to the beginning of line.\r\n\r\nIf I want to manage {{foo}} and a module {{myfoo}} isl aready loaded the provider thinks {{foo} is loaded and whereas it actually isn't.","closed_at":"2018-09-19T12:14:03.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8943","labels":"","state":"Closed","updated_at":"2018-09-19T12:14:03.000-0700","timestamp":1652285664.864303,"priority":"Normal","status_category":"Done","pull_request":6882},{"issue_id":"237925","title":"Require ruby 2.3 or greater","url":"https://tickets.puppetlabs.com/browse/PUP-8483","created_at":"2018-02-22T15:50:49.000-0800","number":"PUP-8483","body":"Update Gemfile, .gemspec, ext/project_data.yaml so that puppet requires ruby 2.3 or greater.\r\n\r\nAttempting to install puppet as a gem, running puppet via bundler, or running module tests using a local checkout of puppet should all fail when using ruby < 2.3.\r\n","closed_at":"2018-09-19T12:32:25.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8483","labels":"","state":"Closed","updated_at":"2018-09-19T12:32:25.000-0700","timestamp":1652285665.584816,"priority":"Normal","status_category":"Done","pull_request":6750},{"issue_id":"54238","title":"File type redefined when required in code","url":"https://tickets.puppetlabs.com/browse/PUP-8733","created_at":"2014-10-10T12:12:36.000-0700","number":"PUP-8733","body":"*NOTE*: If you have found your way to this issue based on troubleshooting an issue with the file_concat module, please see SERVER-40 for an easy workaround.\r\n\r\nThis issue was uncovered by SERVER-40.\r\n\r\nThere is a difference in how Kernel.load() and require interact when referencing the same Ruby file -- at least the file type -- under an MRI puppet master vs. Puppet Server, both running 3.7.1 core Ruby Puppet code and 1.9-based Ruby.\r\n\r\nDuring settings initialization, both masters will perform a:\r\n\r\n{code}\r\nKernel.load(\".../lib/puppet/type/file.rb\", nil)\r\n{code}\r\n\r\nThis causes the Puppet::Type::File type to be defined, as well as several related types, e.g., Puppet::Type::File::Owner, by virtue of \"file.rb\" doing _require 'puppet/type/file/*'_ calls.\r\n\r\nAssuming a custom module which includes a _require 'puppet/type/file'_ call in some Ruby code is in place, the behavior when that line is exercised under MRI Ruby Puppet vs. Puppet Server during a catalog request differs.\r\n\r\nUnder the MRI Ruby Puppet master, the file require call does not result in the \"file.rb\" file being re-executed.\r\n\r\nUnder Puppet Server, however, the file require call does result in the \"file.rb\" file being re-executed.  The Puppet::Type::File type is subsequently redefined, causing the subordinate types like Puppet::Type::File::Owner to no longer be defined.  The \"file.rb\" file executes the _require 'puppet/type/file/..._ calls again but because JRuby's loader interprets the associated files as already having been executed, the files are not executed again and the Puppet::Type::File::* types are not redefined.  Any subsequent attempts to reference these subordinate types in code would, therefore, result in an error.\r\n\r\nI suspect this may be showing a difference between how the caching behind Kernel.load() and Kernel.require() is linked under MRI Ruby vs. JRuby 1.9.  This will probably involve further research into the loaders for those respective runtimes.\r\n\r\nTo demonstrate this problem, I created the following custom function and placed it under \"<confdir>/<modules>/<modname>/lib/puppet/parser/functions/owner_defed_after_require.rb\" on the server:\r\n\r\n{code}\r\nrequire 'puppet/type/file'\r\n\r\nmodule Puppet::Parser::Functions\r\n  newfunction(:owner_defed_after_require, :type => :rvalue) do |args|\r\n    Puppet.info \"owner_defed_after_require: enter\"\r\n\r\n    klass_defined = false\r\n    if Object.const_defined?(\"Puppet\")\r\n      klass = Object.const_get(\"Puppet\")\r\n      if (klass.const_defined?(\"Type\"))\r\n        klass = klass.const_get(\"Type\")\r\n        if (klass.const_defined?(\"File\"))\r\n          klass_defined = klass.const_get(\"File\").const_defined?(\"Owner\")\r\n        end\r\n      end\r\n    end\r\n\r\n    Puppet.info \"owner_defed_after_require: exit (#{klass_defined})\"\r\n    klass_defined\r\n  end\r\nend\r\n{code}\r\n\r\nOn the same server, I stored the following at \"<confdir>/manifests/site.pp\":\r\n\r\n{code}\r\nnotify { 'owner_defed_after_require':\r\n  message  => owner_defed_after_require()\r\n}\r\n{code}\r\n\r\nWhen I performed a catalog request to the master, I saw \"true\" for the owner_defed_after_require message in the response for the MRI Ruby master vs. \"false\" for the same message in the response for the Puppet Server master.\r\n\r\n\r\n","closed_at":"2018-09-19T12:32:28.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8733","labels":"","state":"Closed","updated_at":"2018-09-19T12:32:28.000-0700","timestamp":1652285666.208069,"priority":"Normal","status_category":"Done","pull_request":6836},{"issue_id":"40322","title":"Puppet generates invalid .dot files due to missing escapes of quoted strings in resource names","url":"https://tickets.puppetlabs.com/browse/PUP-2838","created_at":"2014-06-25T05:30:49.000-0700","number":"PUP-2838","body":"Puppet generates invalid .dot files.\r\nIf a resource name contains a quoted string the name is not escaped in the .dot file.\r\n\r\nExample content generated by puppet:\r\n{code}\r\n    \"Postgresql_psql[GRANT ALL ON DATABASE \"puppetdb\" TO \"puppetdb\"]\" [\r\n        fontsize = 8,\r\n        label = \"Postgresql_psql[GRANT ALL ON DATABASE \"puppetdb\" TO \"puppetdb\"]\"\r\n    ]\r\n{code}\r\n\r\nresulting in something like this:\r\n!graph_fail.png|thumbnail!\r\n\r\n\r\nCorrectly escaped it would look like this:\r\n{code}\r\n    \"Postgresql_psql[GRANT ALL ON DATABASE \\\"puppetdb\\\" TO \\\"puppetdb\\\"]\" [\r\n        fontsize = 8,\r\n        label = \"Postgresql_psql[GRANT ALL ON DATABASE \\\"puppetdb\\\" TO \\\"puppetdb\\\"]\"\r\n    ]\r\n{code}\r\n\r\n\r\nThe behavior has been reproduced with Puppet 3.6.1 and 3.6.2","closed_at":"2018-09-19T12:32:30.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2838","labels":"community;puppethack;the-goods","state":"Closed","updated_at":"2018-09-19T12:32:30.000-0700","timestamp":1652285666.52007,"priority":"Normal","status_category":"Done","pull_request":6848},{"issue_id":"237926","title":"Update ruby 1.9.3 code paths","url":"https://tickets.puppetlabs.com/browse/PUP-8484","created_at":"2018-02-22T15:51:52.000-0800","number":"PUP-8484","body":"Search puppet's code base for all of the places where we branch based on {{RUBY_VERSION}}.\r\n\r\n1. Remove code paths for < 2.\r\n2. Trying to {{require 'puppet'}} should generate a {{LoadError}} if ruby < 2\r\n3. Update {{Puppet::OLDEST_RECOMMENDED_RUBY_VERSION}} to whatever minimum makes sense.\r\n4. Remove conditional logic for Puppet[:sourceaddress]","closed_at":"2018-09-19T12:32:31.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8484","labels":"","state":"Closed","updated_at":"2018-09-19T12:32:31.000-0700","timestamp":1652285666.928649,"priority":"Normal","status_category":"Done","pull_request":6868},{"issue_id":"261846","title":"The new Rest::Client does not respect the server_list setting","url":"https://tickets.puppetlabs.com/browse/PUP-8952","created_at":"2018-06-20T12:03:08.000-0700","number":"PUP-8952","body":"The way the new rest client is currently being used (see https://github.com/puppetlabs/puppet/blob/master/lib/puppet/rest/routes.rb) does not respect the server list setting, because we are always setting a default server, which skips server resolution (see https://github.com/puppetlabs/puppet/blob/master/lib/puppet/rest/route.rb#L66-L90). Assuming that HA expects the CA to fail over along with the rest of the master functions, we need to update this logic so that if {{server_list}} is specified, the values there are preferred over the {{ca_server}} setting that we would normally check (which itself defaults to the {{server}} setting).","closed_at":"2018-09-19T12:32:32.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8952","labels":"","state":"Closed","updated_at":"2018-09-19T12:32:32.000-0700","timestamp":1652285667.02948,"priority":"Normal","status_category":"Done","pull_request":6891},{"issue_id":"264049","title":"Don't pluginsync vendored modules","url":"https://tickets.puppetlabs.com/browse/PUP-8988","created_at":"2018-07-06T16:31:03.000-0700","number":"PUP-8988","body":"Currently in puppet#master, we treat vendored modules just like any another module in the environment-specific modulepath, just that they have the least preference.\r\n\r\nThis is desirable to ensure that the version of the type we're compiling for, is the same version that the agent uses during catalog application. This is important to ensure the code in the type (title patterns, munge, validate, auto relations) is consistent to prevent subtle and difficult to reproduce bugs. It would also prevent problems like PUP-2746.\r\n\r\nHowever, it causes a few problems:\r\n * it will cause additional pluginsync'ing of types and providers\r\n * we have to be careful about introducing changes to types that are not compatible with older agents. For example, the yumrepo type now marks the {{password}} and {{proxy_password}} properties as sensitive, but the {{Puppet::Parameter#sensitive}} method is not available in older puppet versions.\r\n * it is a departure from how puppet currently works\r\n\r\nThis ticket proposes we:\r\n * remove the vendored modules from the module path so that they are not pluginsync'ed automatically\r\n * add a puppet setting for vendored modulepath\r\n * add the path to the autoloader search path with least precedence\r\n\r\nThis way vendored types can be autoloaded locally, but we never pluginsync (types/providers/facts/files/etc) them.\r\n\r\n/cc [~ericsorenson], [~jacob.helwig], [~melissa], [~branan]","closed_at":"2018-09-19T12:33:58.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8988","labels":"","state":"Closed","updated_at":"2018-09-19T12:33:58.000-0700","timestamp":1652285669.033648,"priority":"Normal","status_category":"Done","pull_request":6939},{"issue_id":"249125","title":"Puppet loses track of the current environment","url":"https://tickets.puppetlabs.com/browse/PUP-8696","created_at":"2018-05-03T14:11:16.000-0700","number":"PUP-8696","body":"Puppet loses track of the current environment when calling the autoloader to load/find:\r\n\r\n* applications\r\n* features\r\n* parent providers that haven't been loaded yet, e.g. {{openbsd}} which is a parent of {{freebsd}}, where {{freebsd}} is loaded first because of its name.\r\n* termini\r\n\r\nPuppet then falls back to the configured environment ({{Puppet[:environment]}}), which may not match the current environment ({{Puppet.lookup(:current_environment)}}). For the agent specifically, it means we sometimes use the configured environment's modulepath which has a higher precedence than our {{libdir}} containing pluginsync'ed files. This is a problem, because when we include {{vendor_modules}} in the {{basemodulepath}} (see PUP-8582), we don't want that to have higher precedence that the {{libdir}} as the agent might load a type/provider that is incompatible with the type that the master used during compilation.\r\n\r\nTo reproduce, create the following files on the master:\r\n\r\n{noformat}\r\n[root@yhw77y0zn0j776u ~]# tree /etc/puppetlabs/code/environments/production/\r\n/etc/puppetlabs/code/environments/production/\r\n├── data\r\n├── environment.conf\r\n├── hiera.yaml\r\n├── manifests\r\n│   └── site.pp\r\n└── modules\r\n    └── foo\r\n        └── lib\r\n            └── puppet\r\n                ├── feature\r\n                │   └── foo.rb\r\n                ├── provider\r\n                │   └── foo\r\n                │       └── foo.rb\r\n                └── type\r\n                    └── foo.rb\r\n\r\n10 directories, 6 files\r\n[root@yhw77y0zn0j776u ~]# find /etc/puppetlabs/code/environments/production/{manifests,modules} -type f -print -exec cat {} \\;\r\n/etc/puppetlabs/code/environments/production/manifests/site.pp\r\nfoo { 'hi': }\r\n/etc/puppetlabs/code/environments/production/modules/foo/lib/puppet/type/foo.rb\r\nPuppet::Type.newtype(:foo) do\r\n  newparam(:name, namevar: true)\r\n  newproperty(:message)\r\nend\r\n/etc/puppetlabs/code/environments/production/modules/foo/lib/puppet/feature/foo.rb\r\nPuppet.features.add(:foo, libs: ['pp'])\r\n/etc/puppetlabs/code/environments/production/modules/foo/lib/puppet/provider/foo/foo.rb\r\nPuppet::Type.type(:foo).provide(:foo) do\r\n  confine :feature => :foo\r\n\r\n  def message=(value)\r\n    puts value\r\n  end\r\n\r\n  def message\r\n    :absent\r\n  end\r\nend\r\n{noformat}\r\n\r\nOn the agent which must be one a different host, create a bogus feature:\r\n\r\n{noformat}\r\n$ tree ~/.puppetlabs/etc/code/environments/production/modules\r\n/Users/josh/.puppetlabs/etc/code/environments/production/modules\r\n└── foo\r\n    └── lib\r\n        └── puppet\r\n            └── feature\r\n                └── foo.rb\r\n\r\n4 directories, 1 file\r\n$ cat ~/.puppetlabs/etc/code/environments/production/modules/foo/lib/puppet/feature/foo.rb\r\nBOOM!!\r\n{noformat}\r\n\r\nThe agent run will fail, with the path to the bogus feature:\r\n\r\n{noformat}\r\n$ bx puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Caching catalog for localhost\r\nError: Could not autoload puppet/feature/foo: /Users/josh/.puppetlabs/etc/code/environments/production/modules/foo/lib/puppet/feature/foo.rb:1: syntax error, unexpected end-of-input\r\nError: Failed to apply catalog: Could not autoload puppet/feature/foo: /Users/josh/.puppetlabs/etc/code/environments/production/modules/foo/lib/puppet/feature/foo.rb:1: syntax error, unexpected end-of-input\r\n{noformat}","closed_at":"2018-09-19T12:34:01.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8696","labels":"","state":"Closed","updated_at":"2018-09-19T12:34:01.000-0700","timestamp":1652285670.321459,"priority":"Normal","status_category":"Done","pull_request":6867},{"issue_id":"263245","title":"A hash containing the key __ptype cannot be serialized using the human readable JSON format","url":"https://tickets.puppetlabs.com/browse/PUP-8976","created_at":"2018-06-29T07:34:29.000-0700","number":"PUP-8976","body":"Using a Hash with the key {{__ptype}} will not serialize correctly as that is a reserved tag.\r\nThere is already a mechanism in place to use an alternative representation when a Hash contains non JSON string compliant keys so the fix is simply to treat a hash with the key in question as one that has non-string keys as that will use the alternative encoding.","closed_at":"2018-09-19T12:34:06.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8976","labels":"","state":"Closed","updated_at":"2018-09-19T12:34:06.000-0700","timestamp":1652285671.271037,"priority":"Normal","status_category":"Done","pull_request":6901},{"issue_id":"266122","title":"Can't puppet describe vendored modules if provider requires helper code","url":"https://tickets.puppetlabs.com/browse/PUP-9015","created_at":"2018-07-23T14:55:43.000-0700","number":"PUP-9015","body":"If a vendored modules' provider includes helper code within the same module, then running {{puppet describe}} will fail, because the module's lib directory is not on the ruby $LOAD_PATH. For example, the [{{mount}} provider calls|https://github.com/puppetlabs/puppetlabs-mount_core/blob/master/lib/puppet/provider/mount/parsed.rb#L2]\r\n\r\n{code:ruby}\r\nrequire 'puppet/provider/mount'\r\n{code}\r\n\r\nwhich is helper code in the same module, and results in:\r\n\r\n{noformat}\r\n# puppet describe -l\r\nError: Could not autoload puppet/provider/mount/parsed: cannot load such file -- puppet/provider/mount\r\nError: Could not autoload puppet/type/mount: Could not autoload puppet/provider/mount/parsed: cannot load such file -- puppet/provider/mount\r\nError: Could not run: Could not autoload puppet/type/mount: Could not autoload puppet/provider/mount/parsed: cannot load such file -- puppet/provider/mount\r\n{noformat}","closed_at":"2018-09-19T12:34:55.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9015","labels":"","state":"Closed","updated_at":"2018-09-19T12:34:55.000-0700","timestamp":1652285672.222772,"priority":"Normal","status_category":"Done","pull_request":6965},{"issue_id":"271041","title":"Puppet assumes all SSL certs it verifies have client purpose set","url":"https://tickets.puppetlabs.com/browse/PUP-9064","created_at":"2018-08-14T09:30:16.000-0700","number":"PUP-9064","body":"[This PR|https://github.com/puppetlabs/puppet/pull/6973] is open to update Travis & Appveyor to test puppet's master branch using ruby 2.5; The Appveyor tests have uncovered a legitimate puppet failure ([link to the full log here|https://ci.appveyor.com/project/puppetlabs/puppet/build/4.1.0.8733/job/bmcje50w2tvej3pw]):\r\n{code}Failures:\r\n  1) Puppet::Indirector::CertificateStatus::File when searching should return a list of all hosts with certificate requests, signed certs, or revoked certs\r\n     Failure/Error: expect(results).to eq([[\"ca\",\"signed\"],[\"requested_host\",\"requested\"],[\"revoked_host\",\"revoked\"],[\"signed_host\",\"signed\"]])\r\n       expected: [[\"ca\", \"signed\"], [\"requested_host\", \"requested\"], [\"revoked_host\", \"revoked\"], [\"signed_host\", \"signed\"]]\r\n            got: [[\"ca\", \"revoked\"], [\"requested_host\", \"requested\"], [\"revoked_host\", \"revoked\"], [\"signed_host\", \"signed\"]]\r\n       (compared using ==)\r\n     # ./spec/unit/indirector/certificate_status/file_spec.rb:188:in `block (3 levels) in <top (required)>'\r\n     # util/rspec_runner:44:in `run'\r\n     # util/rspec_runner:59:in `<main>'\r\nFinished in 49.26 seconds (files took 7.23 seconds to load)\r\n{code}\r\nA summary of some discussion we've had around this in PRs and chat so far:\r\n * This happens with Ruby 2.5.x and and OpenSSL 1.1.0. We suspect we're seeing this failure in Appveyor and not Travis because Travis may build their Ruby 2.5.x against an earlier version of OpenSSL\r\n * We set purpose to SSL_CLIENT, and OpenSSL 1.1.0, unlike earlier versions, will check the purpose of each certificate and fail verification if purpose does not match.\r\n * This failure only manifests when verifying the CA using itself:\r\n ** This normally works because the CA is a self-signed cert\r\n ** But the CA does not have the SSL_CLIENT purpose (and it should never set that), so it fails verification now\r\n * To fix this, we need to find some way not to set the purpose when verifying the CA cert using itself:\r\n ** We may add an optional purpose parameter to the [verify method|https://github.com/puppetlabs/puppet/blob/8ee569d00a3dd8664998ff89db75c7c16703e99e/lib/puppet/ssl/certificate_authority.rb#L495], and have it default to {{OpenSSL::X509::PURPOSE_SSL_CLIENT}}. Then, Host's state method could pass {{OpenSSL::PURPOSE_ANY}} [here|https://github.com/puppetlabs/puppet/blob/8ee569d00a3dd8664998ff89db75c7c16703e99e/lib/puppet/ssl/host.rb#L405].\r\n\r\n[~sean.mcdonald] provided [this script|https://gist.githubusercontent.com/McdonaldSeanp/3d92c654ee16acc37b590b3d5dac3fc2/raw/7c42eeffaebf391a38485a0b54911d7a021c1c5a/certificate_check.rb] to perform a test that creates a CA and attempts to verify it with and without the purpose set (requires system openssl installed).\r\n\r\nThis issue blocks PUP-8614 (adding ruby 2.5 to puppet's Travis/Appveyor config), which blocks the upgrade to ruby 2.5.1 in puppet-agent.","closed_at":"2018-09-19T12:34:56.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9064","labels":"","state":"Closed","updated_at":"2018-09-19T12:34:56.000-0700","timestamp":1652285672.329872,"priority":"Major","status_category":"Done","pull_request":7003},{"issue_id":"275331","title":"Namespaced pluginsync functions should be found by Loaders","url":"https://tickets.puppetlabs.com/browse/PUP-9133","created_at":"2018-09-12T00:52:28.000-0700","number":"PUP-9133","body":"*Puppet Version:*\r\n*Puppet Server Version:*\r\n*OS Name/Version:*\r\n\r\nDescribe your issue in as much detail as possible…\r\nDescribe steps to reproduce…\r\n\r\n*Desired Behavior:*\r\n\r\n\r\n*Actual Behavior:*\r\n\r\n\r\nPlease take a moment and attach any relevant log output and/or manifests. This will help us immensely when troubleshooting the issue.\r\n\r\nExamples:\r\nRun puppet agent with --test --trace --debug\r\n\r\nRelevant sections of {{/var/log/puppetlabs/puppetserver/puppetserver.log}} or any applicable logs from the same directory.\r\n\r\nFor more detailed information turn up the server logs by upping the log level in the server's logback.xml\r\n\r\nRelevant sections of configurations files (puppet.conf, hiera.conf, Server's conf.d, defaults/sysconfig)\r\n\r\nFor memory issues with server heap dumps are also helpful.\r\n","closed_at":"2018-09-19T12:34:58.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9133","labels":"","state":"Closed","updated_at":"2018-09-19T12:34:58.000-0700","timestamp":1652285672.645096,"priority":"Normal","status_category":"Done","pull_request":7075},{"issue_id":"272667","title":"Rich data tags __ptype and __pvalue must not be allowed as attribute names","url":"https://tickets.puppetlabs.com/browse/PUP-9079","created_at":"2018-08-24T00:08:45.000-0700","number":"PUP-9079","body":"An attempt to use the rich data tag '\\_\\_ptype' as the name of an attribute in an {{Object}} will cause a failure to serialize that object using the human readable Data format. An {{Object}} is represented as a {{Hash}} where '\\_\\_ptype' is supposed to be a {{String}} representation of the type and an attribute using the same name causes the type to be overwritten. Use of '\\_\\_pvalue' will cause a similar confusion when reading the `Object`.\r\n\r\nThe special rich data tags'\\_\\_ptype' and '\\_\\_pvalue' should not be permitted as names of attributes in an {{Object}}.","closed_at":"2018-09-19T12:37:12.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9079","labels":"","state":"Closed","updated_at":"2018-09-19T12:37:12.000-0700","timestamp":1652285673.172784,"priority":"Normal","status_category":"Done","pull_request":7062},{"issue_id":"275883","title":"Puppet device raises `undefined method` error","url":"https://tickets.puppetlabs.com/browse/PUP-9143","created_at":"2018-09-17T02:56:57.000-0700","number":"PUP-9143","body":"*Puppet Version: 6.0.0*\r\n *Puppet Server Version:*\r\n *OS Name/Version:* \r\n\r\nThe following behaviour was found in `master` and `6.0.x` branches\r\n\r\n*Desired Behavior:*\r\n\r\nRunning *`*puppet device --verbose --trace --strict=error --modulepath spec/fixtures --target the_node*`* should raise an error similar to:\r\n\r\n`Error: Target device / certificate 'the_node' not found in /Users/david.armstrong/.puppetlabs/etc/puppet/device.conf`\r\n\r\n*Actual Behavior:*\r\n\r\nInstead, the error received is:\r\n\r\n\"undefined method `ca_location=' for Puppet::SSL::Host:Class`\"\r\n\r\nThis can be observed in the Travis job: [https://travis-ci.org/puppetlabs/puppet-resource_api/builds/429478193?utm_source=github_status&utm_medium=notification]\r\n{code:java}\r\nError: Could not prepare for execution: undefined method `ca_location=' for Puppet::SSL::Host:Class\r\n/home/travis/build/puppetlabs/puppet-resource_api/vendor/bundle/ruby/2.5.0/bundler/gems/puppet-7a952fe11207/lib/puppet/application/device.rb:382:in `setup'\r\n/home/travis/build/puppetlabs/puppet-resource_api/vendor/bundle/ruby/2.5.0/bundler/gems/puppet-7a952fe11207/lib/puppet/application.rb:374:in `block in run'\r\n/home/travis/build/puppetlabs/puppet-resource_api/vendor/bundle/ruby/2.5.0/bundler/gems/puppet-7a952fe11207/lib/puppet/util.rb:667:in `exit_on_fail'\r\n/home/travis/build/puppetlabs/puppet-resource_api/vendor/bundle/ruby/2.5.0/bundler/gems/puppet-7a952fe11207/lib/puppet/application.rb:374:in `run'\r\n/home/travis/build/puppetlabs/puppet-resource_api/vendor/bundle/ruby/2.5.0/bundler/gems/puppet-7a952fe11207/lib/puppet/util/command_line.rb:136:in `run'\r\n/home/travis/build/puppetlabs/puppet-resource_api/vendor/bundle/ruby/2.5.0/bundler/gems/puppet-7a952fe11207/lib/puppet/util/command_line.rb:73:in `execute'\r\n/home/travis/build/puppetlabs/puppet-resource_api/vendor/bundle/ruby/2.5.0/bundler/gems/puppet-7a952fe11207/bin/puppet:5:in `<top (required)>'\r\n/home/travis/build/puppetlabs/puppet-resource_api/vendor/bundle/ruby/2.5.0/bin/puppet:23:in `load'\r\n/home/travis/build/puppetlabs/puppet-resource_api/vendor/bundle/ruby/2.5.0/bin/puppet:23:in `<main>'\r\n{code}\r\n \r\n\r\n ","closed_at":"2018-09-19T12:37:14.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9143","labels":"","state":"Closed","updated_at":"2018-09-19T12:37:14.000-0700","timestamp":1652285673.494133,"priority":"Blocker","status_category":"Done","pull_request":7097},{"issue_id":"275210","title":"tagging with undef should not add a tag","url":"https://tickets.puppetlabs.com/browse/PUP-9130","created_at":"2018-09-11T08:25:26.000-0700","number":"PUP-9130","body":"In PUP-9112 we stopped translating puppet's {{undef}} to Ruby symbol {{:undef}} in the resource API. As a consequence, if trying to tag with an {{undef}} value this ended up as an empty string (nil.to_s is an empty string). This was then correctly flagged as an error.\r\n\r\nThe change in PUP-9112 thus revealed a long standing bug, where tagging with {{undef}} actually tagged the resource with the string {{\"undef\"}}, which is completely useless since it cannot be used or queried using {{undef}}.\r\n\r\nAny undef/nil values should simply be dropped in the tagging process.","closed_at":"2018-09-19T12:37:15.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9130","labels":"","state":"Closed","updated_at":"2018-09-19T12:37:15.000-0700","timestamp":1652285673.709693,"priority":"Normal","status_category":"Done","pull_request":7070},{"issue_id":"275447","title":"FromDataHash should not crash if hash with __ptype key is not a type","url":"https://tickets.puppetlabs.com/browse/PUP-9134","created_at":"2018-09-12T11:58:56.000-0700","number":"PUP-9134","body":"In case FromDataHash is given a hash where a key is {{\"__ptype\"}}, and its value is not a type, it should then assume that what it is looking at is just a hash instead of crashing.\r\n\r\nThis is caused by the ToStringifiedConverter not converting to a safe form when seeing such a hash. The ToStringifyConverter should simply generate {{\"reserved-key: __ptype\"}} for such hashes since the result is for human consumption.","closed_at":"2018-09-19T12:37:16.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9134","labels":"","state":"Closed","updated_at":"2018-09-19T12:37:16.000-0700","timestamp":1652285673.922196,"priority":"Normal","status_category":"Done","pull_request":7080},{"issue_id":"275642","title":"Puppet should save cached catalogs with rich_data when rich_data is enabled","url":"https://tickets.puppetlabs.com/browse/PUP-9138","created_at":"2018-09-13T12:18:15.000-0700","number":"PUP-9138","body":null,"closed_at":"2018-09-19T12:37:18.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9138","labels":"","state":"Closed","updated_at":"2018-09-19T12:37:18.000-0700","timestamp":1652285674.348904,"priority":"Normal","status_category":"Done","pull_request":7085},{"issue_id":"274774","title":"Puppet PAL for catalog compilation cannot use resources in subsequent evaluations.","url":"https://tickets.puppetlabs.com/browse/PUP-9114","created_at":"2018-09-07T03:17:32.000-0700","number":"PUP-9114","body":"When using Puppet PAL to compile a catalog (new in Puppet 6.0.0) it is not possible to use any catalog related definitions in code evaluated after the initial evaluation. This is because the evaluate method is inherited from basic script compiler and it can only define non catalog related definitions.\r\n\r\nThis is a major issue with using the new API.","closed_at":"2018-09-19T12:37:19.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9114","labels":"","state":"Closed","updated_at":"2018-09-19T12:37:19.000-0700","timestamp":1652285674.664698,"priority":"Major","status_category":"Done","pull_request":7055},{"issue_id":"119006","title":"Features are not being re-evaluated when a block is used","url":"https://tickets.puppetlabs.com/browse/PUP-5985","created_at":"2016-02-28T07:17:26.000-0800","number":"PUP-5985","body":"When a block is passed to the add method of Puppet::Util::Feature, it will only get evaluated once. This makes the \"feature\" feature practically unusable for anything except ruby libraries.\r\n\r\n*Updated*:\r\n\r\nFeatures should behave consistently when passed a block or an explicit list of ruby libraries. By default, they should not cache misses. If {{always_retry_plugins}} is false, then both block and non-block forms should cache misses, so that puppetserver doesn't try to reevaluate features.","closed_at":"2018-09-19T12:37:25.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5985","labels":"","state":"Closed","updated_at":"2018-09-19T12:37:25.000-0700","timestamp":1652285685.064402,"priority":"Normal","status_category":"Done","pull_request":7008},{"issue_id":"274286","title":"YAML safe_load prevents aliases","url":"https://tickets.puppetlabs.com/browse/PUP-9104","created_at":"2018-09-05T05:35:27.000-0700","number":"PUP-9104","body":"*Puppet Version:* current master, e.g. ddd5610aa9ffb5eb9da13521f1fc68e562a2e0b3\r\n*Puppet Server Version:* n/a\r\n*OS Name/Version:* n/a\r\n\r\n*Actual Behavior:*\r\n\r\nIn some cases puppet creates a {{transactionstore.yaml}} that are not able to be read back, causing \r\n\r\n{code}\r\nError: Transaction store file /home/david/.puppetlabs/opt/puppet/cache/devices/pavm/state/transactionstore.yaml is corrupt (Unknown alias: 1); replacing\r\n{code}\r\n\r\n*Desired Behavior:*\r\n\r\nNo errors or stacktraces on regular puppet use.\r\n\r\n*Reproduction:*\r\n\r\n[~thomas.franklin] has put together a detailed description and a potential fix in https://github.com/Thomas-Franklin/puppet/commit/49b8e023c6c9bb551bd0ce21648a604042c490ff\r\n\r\nThe issue is also visible in the panos acceptance pipelines: https://jenkins-master-prod-1.delivery.puppetlabs.net/view/modules/view/networking/view/panos/view/master/job/forge-module_puppetlabs-panos_intn-sys_full-pe-future-master/8/\r\n","closed_at":"2018-09-19T22:46:17.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9104","labels":"","state":"Closed","updated_at":"2018-09-19T22:46:17.000-0700","timestamp":1652285686.020675,"priority":"Normal","status_category":"Done","pull_request":7048},{"issue_id":"277595","title":"nested :undef symbol transformed to empty string in 3x function calls","url":"https://tickets.puppetlabs.com/browse/PUP-9180","created_at":"2018-09-26T03:29:07.000-0700","number":"PUP-9180","body":"Nested :undef symbol is transformed to empty string in 3x function calls. This is a side effect of PUP-9112 as the language no longer uses :undef, and the return values of 3x functions are transformed to not contain :undef. There is however a problem in that there are many tests that test against :undef inside structures in the belief that this is how the language would present the value to the function (it once was).\r\n\r\nThus, it would be beneficial to allow these tests to continue working.","closed_at":"2018-10-02T12:45:10.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9180","labels":"","state":"Closed","updated_at":"2018-10-02T12:45:10.000-0700","timestamp":1652285688.972077,"priority":"Blocker","status_category":"Done","pull_request":7122},{"issue_id":"182318","title":"AIX Provider acts strange with user resource","url":"https://tickets.puppetlabs.com/browse/PUP-7393","created_at":"2017-03-23T12:44:08.000-0700","number":"PUP-7393","body":"When a user is in a group on a Linux server and a user resource is created for that user, if new groups are specified in the resource, the user is moved out of his previous groups into the groups specified. \r\n\r\nIn AIX the user stays in his old groups and gets added to his new groups. The AIX functionality should mimic the Linux functionality.","closed_at":"2018-10-02T12:45:11.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7393","labels":"aix;aix-parity;type_and_provider;user","state":"Closed","updated_at":"2018-10-02T12:45:11.000-0700","timestamp":1652285689.078027,"priority":"Normal","status_category":"Done","pull_request":7090},{"issue_id":"275893","title":"PAL for Catalog Compilation does not evaluate defines and classes","url":"https://tickets.puppetlabs.com/browse/PUP-9144","created_at":"2018-09-17T05:12:11.000-0700","number":"PUP-9144","body":"The PAL support for catalog compilation does not evaluate defines and classes if they are defined inside of the body of the PAL. Thus a catalog will only instances of classes and resources that were evaluated during the main part of the compilation (i.e. if given a manifest or initial code to evaluate). Three new methods were added to the API to control lazy evaluation and validation of the result.","closed_at":"2018-10-02T12:45:11.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9144","labels":"","state":"Closed","updated_at":"2018-10-02T12:45:11.000-0700","timestamp":1652285689.183085,"priority":"Major","status_category":"Done","pull_request":7102},{"issue_id":"269911","title":"Update puppet portage package provider for new output generated by qatom","url":"https://tickets.puppetlabs.com/browse/PUP-9044","created_at":"2018-08-06T22:58:21.000-0700","number":"PUP-9044","body":"*Puppet Version: puppet-agent-5.5.4*\r\n *Puppet Server Version: 5.3.4*\r\n *OS Name/Version: Gentoo*\r\n\r\nqatom output used to look like:\r\n\r\n# qatom app-admin/puppet\r\napp-admin puppet (null)\r\n\r\n...but now looks like...\r\n\r\n# qatom app-admin/puppet\r\napp-admin puppet <unset>\r\n\r\nin app-portage/portage-utils-0.72 and above.\r\n\r\n*Desired Behavior:* the qatom output to be parsed correctly\r\n\r\n*Actual Behavior:*\r\n\r\nError: Could not update: Execution of '/usr/bin/emerge --update app-admin/puppet-<unset>' returned 1: !!! 'app-admin/puppet-<unset>' is not a valid package atom.","closed_at":"2018-10-02T12:45:12.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9044","labels":"gentoo;package;portage;type_and_provider","state":"Closed","updated_at":"2018-10-02T12:45:12.000-0700","timestamp":1652285689.289083,"priority":"Normal","status_category":"Done","pull_request":7101},{"issue_id":"276783","title":"Request \"master\" server status ","url":"https://tickets.puppetlabs.com/browse/PUP-9159","created_at":"2018-09-20T15:42:17.000-0700","number":"PUP-9159","body":"When using {{server_list}} the agent will request server status from {{status/v1/services}}. It is possible for the compiler to be ready, but other trapperkeeper services unrelated to compilation to be unavailable such as the {{broker-service}}. For example:\r\n\r\n{noformat}\r\n<- \"GET /status/v1/simple HTTP/1.1\\r\\nAccept-Encoding: gzip;q=1.0,deflate;q=0.6,identity;q=0.3\\r\\nAccept: */*\\r\\nUser-Agent: Puppet/6.0.0 Ruby/2.5.1-p57 (x86_64-linux)\\r\\nHost: puppet:8140\\r\\n\\r\\n\"\r\n-> \"HTTP/1.1 503 Service Unavailable\\r\\n\"\r\n-> \"Date: Wed, 19 Sep 2018 22:50:52 GMT\\r\\n\"\r\n-> \"Content-Type: text/plain;charset=utf-8\\r\\n\"\r\n-> \"Content-Length: 5\\r\\n\"\r\n-> \"Server: Jetty(9.4.z-SNAPSHOT)\\r\\n\"\r\n-> \"\\r\\n\"\r\nreading 5 bytes...\r\n-> \"error\"\r\n{noformat}\r\n\r\nThe agent should request status from {{status/v1/services/master}} instead\r\n\r\n{noformat}\r\n$ curl -ks https://puppet:8140/status/v1/simple/master\r\nrunning\r\n{noformat}","closed_at":"2018-10-02T12:45:15.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9159","labels":"","state":"Closed","updated_at":"2018-10-02T12:45:15.000-0700","timestamp":1652285689.520242,"priority":"Normal","status_category":"Done","pull_request":7108},{"issue_id":"276326","title":"`puppet cert` does not output helpful error text when called with args","url":"https://tickets.puppetlabs.com/browse/PUP-9155","created_at":"2018-09-18T16:09:46.000-0700","number":"PUP-9155","body":"In Puppet 6, we disabled the {{puppet cert}} command, with the intention of making it print helpful error output in lieu of doing anything. However, the error text does not print when {{puppet cert}} is called with an action. We should update it to print the error output in all cases.","closed_at":"2018-10-02T12:45:16.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9155","labels":"","state":"Closed","updated_at":"2018-10-02T12:45:16.000-0700","timestamp":1652285689.732844,"priority":"Critical","status_category":"Done","pull_request":7103},{"issue_id":"274976","title":"puppet apply --catalog cat.json does not trigger resolution of Deferred values","url":"https://tickets.puppetlabs.com/browse/PUP-9121","created_at":"2018-09-10T03:39:55.000-0700","number":"PUP-9121","body":"As the summary says: puppet apply --catalog cat.json does not trigger resolution of Deferred values\r\n","closed_at":"2018-10-02T12:45:19.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9121","labels":"","state":"Closed","updated_at":"2018-10-02T12:45:19.000-0700","timestamp":1652285690.213623,"priority":"Normal","status_category":"Done","pull_request":7089},{"issue_id":"274715","title":"Restarting services using launchd service provider is flaky","url":"https://tickets.puppetlabs.com/browse/PUP-9111","created_at":"2018-09-06T14:44:37.000-0700","number":"PUP-9111","body":"*Puppet Version: 5.4.0*\r\n *OS Name/Version: macOS 10.13.6*\r\n\r\nRestarting jobs will frequently fail. When restarting a service, the {{launchd}} provider calls {{stop}} and then {{start}}. The {{stop}} method executes {{launchctl unload -w <plist path>}}, and then calls {{enable}} The {{enable}} method reads the disable overrides pilst ({{/var/db/com.apple.xpc.launchd/disabled.plist}}) and modifies it.\r\n\r\nHowever, there is a race. While the {{launchd}} process is changing states, the disables plist is sometimes zero-length. When this occurs, {{read_plist}} (which is just {{Puppet::Util::(Plist.read_plist_file}} fails:\r\n\r\n{noformat}\r\nInfo: /Stage[main]/Main/File[/tmp/foo]: Scheduling refresh of Service[keepalive]\r\nWarning: Cannot read file /var/db/com.apple.xpc.launchd/disabled.plist; Puppet is skipping it.\\nDetails: Execution of '/usr/bin/plutil -convert xml1 -o - /var/db/com.apple.xpc.launchd/disabled.plist' returned 1: /var/db/com.apple.xpc.launchd/disabled.plist: Property List error: Cannot parse a NULL or zero-length data / JSON error: No value.\r\nError: /Stage[main]/Main/Service[keepalive]: Failed to call refresh: undefined method `[]=' for nil:NilClass\r\nError: /Stage[main]/Main/Service[keepalive]: undefined method `[]=' for nil:NilClass \r\n{noformat}\r\n\r\nThis leaves the service stopped and disabled, and the puppet run is unsuccessful. A subsequent puppet run will restart and re-enable the job.\r\n\r\nA simple workaround would be to loop and sleep while reading the overrides plist. I have a small commit that does this.\r\n\r\nThere is a larger architectural issue with the {{launchd}} provider, however. We only get into this error state because the provider is trying to reconcile a service resource that should be {{ensure => running}} and {{enable => true}}. When it calls {{stop}}, the resource that should be running/enabled is now stopped/disabled, and the {{stop}} method helpfully tries to fix the disabled bit by calling {{enable}}. But the {{enable}} (and {{disable}}) methods use direct modification of the overrides plist to do their work, and this is not a supported method.\r\n\r\nFrom the {{launchctl}} man page:\r\nbq. Overrides the Disabled key and sets it to false or true for the load and unload subcommands respectively. In previous versions, this option would modify the configuration file. Now the state of the Disabled key is stored elsewhere on- disk in a location that *may not be directly manipulated by any process other than launchd.*\r\n\r\nI think a larger re-thinking of how to manage {{launchd}} services with this provider is needed.\r\n\r\n*Desired Behavior:*\r\n\r\nThe service successfully restarts.\r\n\r\n*Actual Behavior:*\r\n\r\nThe service is left stopped and disabled until a subsequent puppet run.\r\n\r\n*Steps to reproduce:*\r\nTrigger a refresh on a {{launchd service}}. This doesn't happen on every service restart, but if you do several in a row eventually this will crop up.\r\n\r\nI've attached a {{keepalive.sh}}. Put this in {{/tmp}} and make it executable. Put {{keepalive.plist}} in {{/Library/LaunchDaemons/}}. Run this repeatedly until puppet fails:\r\n{code}sudo rm -f /tmp/foo; sudo puppet apply --verbose --color=true --trace keepalive.pp{code}\r\n","closed_at":"2018-10-02T12:45:19.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9111","labels":"macos;service;type_and_provider","state":"Closed","updated_at":"2018-10-02T12:45:19.000-0700","timestamp":1652285690.317838,"priority":"Normal","status_category":"Done","pull_request":7105},{"issue_id":"58064","title":"Puppet stores files forever in state.yaml","url":"https://tickets.puppetlabs.com/browse/PUP-3647","created_at":"2014-11-07T15:34:19.000-0800","number":"PUP-3647","body":"We noticed the following today on one of our production clusters: https://cloudup.com/cgJm3eD4wu4. Essentially Puppet Agent has been using gradually more CPU and Memory over time and was taking longer and longer to execute. On some nodes its been using 2G during each run.\r\n\r\nDigging in, we discovered why. We have configuration like the following:\r\n\r\n{code}\r\nfile {\r\n\t\"/var/db/\":\r\n\t\tensure => directory,\r\n\t\tgroup => \"dbuser\",\r\n\t\towner => \"dbuser\",\r\n\t\trecurse => true;\r\n}\r\n{code}\r\n\r\nIt turns out that the /var/db directory on this machine sometimes includes temporary files, because of the data system using this directory. This means there are a few new files in /var/db every time we run puppet agent.\r\n\r\nWe discovered today that each time puppet sees a file, it writes a line to /var/lib/puppet/state/state.yaml. Since there were always new files each time puppet ran, this file grew and grew. Its about 125MB on some of our machines. With a state.yaml file of that size, puppet agent took this long:\r\n\r\nreal    6m31.792s \r\nuser    5m56.434s \r\nsys     0m33.867s \r\n\r\nAfter deleting /var/lib/puppet/state/state.yaml it dropped to:\r\n\r\nreal    0m25.232s \r\nuser    0m16.073s \r\nsys     0m4.112s  \r\n\r\nWe've removed our use of `recurse` for now, which wasn't really necessary in this case, but we consider this a dangerous situation and a bug in Puppet; it means that we need to be sure Puppet isn't touching new files over time. Happy to provide more details if its helpful.","closed_at":"2018-10-02T12:45:22.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3647","labels":"","state":"Closed","updated_at":"2018-10-02T12:45:22.000-0700","timestamp":1652285690.629106,"priority":"Major","status_category":"Done","pull_request":7104},{"issue_id":"157105","title":"Windows agents should be able to apply a 'stopped' service resource even if the service doesn't exist ","url":"https://tickets.puppetlabs.com/browse/PUP-6822","created_at":"2016-10-16T09:36:47.000-0700","number":"PUP-6822","body":"Linux agents don't seem to have this issue, for example:\r\n\r\n{code:java}\r\n]# puppet apply -e 'service {\"notaservice\": ensure => \"stopped\", enable => false,}'\r\nNotice: Compiled catalog for pe-201620-master.example.com in environment production in 0.12 seconds\r\nNotice: Applied catalog in 0.33 seconds\r\n{code}\r\n\r\nHowever, on Windows, an attempt to apply the same resource gives:\r\n\r\n{code:java}\r\nPS C:\\Users\\Administrator> puppet apply -e 'service {\"notaservice\": ensure => \"stopped\", enable => false,}'\r\nNotice: Compiled catalog for windows-agent1 in environment production in 0.03 seconds\r\nError: /Stage[main]/Main/Service[notaservice]: Could not evaluate: Cannot get status of notaservice, error was: The specified service does not exist as an installed service. - OpenService: The specified service does not exist as an installed service.\r\nWrapped exception:\r\nThe specified service does not exist as an installed service. - OpenService: The specified service does not exist as an installed service.\r\nNotice: Applied catalog in 0.14 seconds\r\n{code}","closed_at":"2018-10-09T12:18:18.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6822","labels":"service;the-goods;type_and_provider;windows;windows-parity","state":"Closed","updated_at":"2018-10-09T12:18:18.000-0700","timestamp":1652285691.56578,"priority":"Normal","status_category":"Done","pull_request":7123},{"issue_id":"28406","title":"puppet cert clean cannot remove signing requests","url":"https://tickets.puppetlabs.com/browse/PUP-1916","created_at":"2014-03-11T06:51:40.000-0700","number":"PUP-1916","body":"I have a certificate signing request that I would like to get rid of with \"puppet cert\". However, I can only list and sign CSRs.\r\n\r\nHere's my log:\r\n[root@operations ~]# puppet --version\r\n3.4.2\r\n[root@operations ~]# puppet cert  list | grep local\r\n  \"localhost.localdomain\" (MD5) 12:5E:40:6B:79:84:6F:9C:51:7B:40:81:30:30:8B:F5\r\n[root@operations ~]# puppet cert  clean localhost.localdomain\r\nError: Could not find a serial number for localhost.localdomain\r\n\r\nA thread at puppet-users suggests this worked before, but is now broken:\r\nhttps://groups.google.com/forum/#!topic/puppet-users/gmIFG108aw0 ","closed_at":"2018-10-09T12:54:49.000-0700","comments":19,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1916","labels":"cs_pr_review;cspapercuts","state":"Closed","updated_at":"2018-10-09T12:54:49.000-0700","timestamp":1652285692.195068,"priority":"Normal","status_category":"Done","pull_request":6570},{"issue_id":"197195","title":"puppet resource user may show double groups","url":"https://tickets.puppetlabs.com/browse/PUP-7685","created_at":"2017-06-21T09:22:24.000-0700","number":"PUP-7685","body":"Systems with complex, and overlapping, user lookups may double list a user's groups.\r\n\r\nFor example:\r\n\r\n{noformat}\r\n$ puppet resource user riehecky\r\n{noformat}\r\n\r\n{code:puppet}\r\nuser { 'riehecky':\r\n  ensure           => 'present',\r\n  comment          => 'Patrick Riehecky',\r\n  gid              => '100',\r\n  groups           => ['wheel', 'mock', 'staff', 'wheel', 'mock', 'staff'],\r\n  home             => '/home/r/riehecky',\r\n  shell            => '/bin/bash',\r\n  uid              => '10000',\r\n}\r\n{code}","closed_at":"2018-10-12T09:05:00.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7685","labels":"community","state":"Closed","updated_at":"2018-10-12T09:05:00.000-0700","timestamp":1652285692.712631,"priority":"Minor","status_category":"Done","pull_request":6003},{"issue_id":"275629","title":"Scope#function_xxx loaded 3x function will be overwritten by 4x load","url":"https://tickets.puppetlabs.com/browse/PUP-9137","created_at":"2018-09-13T11:27:58.000-0700","number":"PUP-9137","body":"if a 3.x function is first loaded from within another function (via a {{function_xxx()}} call), it is then reloaded if it is called from the puppet language or via {{Scope#call_function}}\r\n\r\nReported in PE-25136\r\n\r\nThis is a consequence of function loading being changed in 5.5.7 and 6.0.0 to allow any module to call a function in any other.","closed_at":"2018-10-24T06:15:47.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9137","labels":"","state":"Closed","updated_at":"2018-10-24T06:15:47.000-0700","timestamp":1652285693.430024,"priority":"Normal","status_category":"Done","pull_request":7086},{"issue_id":"278353","title":"Puppet should ignore empty init.pp","url":"https://tickets.puppetlabs.com/browse/PUP-9190","created_at":"2018-10-01T11:58:00.000-0700","number":"PUP-9190","body":"Puppet6 will error if a module contains an empty init.pp. The [module documentation|https://puppet.com/docs/puppet/5.3/modules_fundamentals.html] says, \"init.pp: Contains a class definition. The init.pp class, if used, is the main class of the module. This class's name must match the module's name.\"\r\n\r\nSo the init.pp file is optional, but we don't specify whether the file can exist, but be empty or if it only contains a defined type.\r\n\r\nWe discovered in MODULES-7854 that some people may have empty {{init.pp}} and puppet should be more lenient. For now, we removed the empty init.pp from the rspec-puppet's module fixtures.\r\n\r\n/cc [~henrik.lindberg], [~kris.bosland], [~ben.ford], [~chuck], [~eric.sorenson]","closed_at":"2018-10-24T10:18:39.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9190","labels":"","state":"Closed","updated_at":"2018-10-24T10:18:39.000-0700","timestamp":1652285693.638079,"priority":"Normal","status_category":"Done","pull_request":7154},{"issue_id":"250923","title":"File resource doesn't seem to parse UTF8 filenames when recursively copying directories","url":"https://tickets.puppetlabs.com/browse/PUP-8735","created_at":"2018-05-15T21:31:50.000-0700","number":"PUP-8735","body":"*Puppet Version:* 5.5.1 (Win x64)\r\n*Puppet Server Version:* N/A\r\n*OS Name/Version:* Windows 10 - 1803\r\n\r\n*Desired Behavior:*\r\n\r\nGiven a manifest saved as UTF8\r\n\r\n{code}\r\nfile { \"c:\\\\install\\\\test\\\\Testing-wordsé\":\r\n  ensure  => file,\r\n  content => 'Testing é',\r\n} ->\r\n\r\nfile { \"c:\\\\install\\\\test\\\\Testing-words-copyé\":\r\n  ensure => file,\r\n  source => \"c:\\\\install\\\\test\\\\Testing-wordsé\",\r\n} ->\r\n\r\nfile { \"c:\\\\install\\\\test2\":\r\n  ensure  => directory,\r\n  source  => \"c:\\\\install\\\\test\",\r\n    recurse => remote,\r\n    replace => true,\r\n}\r\n{code}\r\n\r\nIt should create the files in the C:\\install\\test directory\r\nIt should copy the C:\\install\\test directory to C:\\install\\test2\r\n\r\n\r\n*Actual Behavior:*\r\n\r\nPuppet apply errors with;\r\n\r\n{{Could not set 'file' on ensure: invalid byte sequence in UTF-8}}\r\n\r\n\r\nFull trace dump in comments","closed_at":"2018-10-24T10:18:41.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8735","labels":"customer;customer-escalation;file;i18n;type_and_provider;utf-8;windows","state":"Closed","updated_at":"2018-10-24T10:18:41.000-0700","timestamp":1652285693.743269,"priority":"Normal","status_category":"Done","pull_request":7130},{"issue_id":"279128","title":"Module paths with common root cause incorrect name location validation errors.","url":"https://tickets.puppetlabs.com/browse/PUP-9211","created_at":"2018-10-05T11:13:43.000-0700","number":"PUP-9211","body":"When one module path is a substring of another, users can get incorrect name location validation errors.\r\n{code:java}\r\nkris.bosland@kris:puppet % bx puppet apply --modulepath ../tmp/test/modules:../tmp/test/modules.common  -e 'class test { include bash }; include test'                             ±[5.5.6^0]\r\nWarning: Unacceptable location. The name 'bash' is unacceptable in file '/Users/kris.bosland/work/tmp/test/modules.common/bash/manifests/init.pp' (file: /Users/kris.bosland/work/tmp/test/modules.common/bash/manifests/init.pp, line: 1, column: 1)\r\nNotice: Compiled catalog for kris.bosland-c02kf9eafft1 in environment production in 0.57 seconds\r\nError: Mac OS X PKG DMGs must specify a package source.\r\nError: /Stage[main]/Bash/Package[shells/bash]/ensure: change from 'absent' to 'present' failed: Mac OS X PKG DMGs must specify a package source.\r\nNotice: Applied catalog in 0.02 seconds\r\nkris.bosland@kris:puppet % cat ../tmp/test/modules.common/bash/manifests/init.pp                                                                                                   ±[5.5.6^0]\r\nclass bash {\r\n    package { \"shells/bash\":\r\n        ensure => installed,\r\n    }\r\n}\r\nkris.bosland@kris:puppet %{code}\r\n ","closed_at":"2018-10-24T10:18:49.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9211","labels":"","state":"Closed","updated_at":"2018-10-24T10:18:49.000-0700","timestamp":1652285694.053907,"priority":"Normal","status_category":"Done","pull_request":7155},{"issue_id":"143096","title":"Group resource emits misleading change notification with auth_membership => false","url":"https://tickets.puppetlabs.com/browse/PUP-6542","created_at":"2016-07-22T18:08:32.000-0700","number":"PUP-6542","body":"When Puppet is adding users to an existing group, its change report is misleading.\r\n\r\nTake the following manifest (from French Windows):\r\n\r\n{code}\r\ngroup { 'Administrateurs': \r\n\tensure => 'present', \r\n\tauth_membership => false, \r\n\tmembers => ['AUTORITE NT\\\\Utilisateurs authentifiés']\r\n}\r\n{code}\r\n\r\n\r\nIt emits the following message\r\n\r\n{code}\r\n# $ bundle exec puppet apply utf8.pp\r\n# DL is deprecated, please use Fiddle\r\n# Notice: Compiled catalog for wbsk7zl860xwiqa.delivery.puppetlabs.net in environment production in 0.06 seconds\r\n# Notice: /Stage[main]/Main/Group[Administrateurs]/members: members changed 'WBSK7ZL860XWIQA\\Administrateur,WBSK7ZL860XWIQA\\tester,WBSK7ZL860XWIQA\\Administrator,WBSK7ZL860XWIQA\\cyg_server,WBSK7ZL860XWIQA\\bla' to 'AUTORITE NT\\Utilisateurs authentifiés'\r\n# Notice: Applied catalog in 0.11 seconds\r\n{code}\r\n\r\nHowever, the message is incorrect, given the actual group membership:\r\n\r\n{code}\r\n$ bundle exec puppet resource group Administrateurs\r\nDL is deprecated, please use Fiddle\r\ngroup { 'Administrateurs':\r\n  ensure  => 'present',\r\n  gid     => 'S-1-5-32-544',\r\n  members => ['Administrateur', 'tester', 'Administrator', 'cyg_server', 'bla', 'Utilisateurs authentifiés'],\r\n}\r\n{code}\r\n\r\n\r\nExpected behavior should be like what the user resource does:\r\n\r\n{code}\r\nuser { 'Invité': \r\n\tensure => 'present', \r\n\tauth_membership => minimum, \r\n\tgroups => ['BUILTIN\\\\Administrateurs']\r\n}\r\n{code}\r\n\r\nEmits the following message:\r\n\r\n{code}\r\nbundle exec puppet apply .\\user.pp\r\nDL is deprecated, please use Fiddle\r\nNotice: Compiled catalog for wbsk7zl860xwiqa.delivery.puppetlabs.net in environment production in 0.08 seconds\r\nNotice: /Stage[main]/Main/User[Invité]/groups: groups changed 'BUILTIN\\Invités' to ['BUILTIN\\Administrateurs', 'BUILTIN\\Invités']\r\nNotice: Applied catalog in 0.11 seconds\r\n{code}\r\n\r\nFor resource\r\n\r\n{code}\r\nbundle exec puppet resource user\r\n\r\n<snip/>\r\n\r\nuser { 'Invité':\r\n  ensure  => 'present',\r\n  comment => 'Compte d'utilisateur invité',\r\n  groups  => ['BUILTIN\\Invités', 'BUILTIN\\Administrateurs'],\r\n  uid     => 'S-1-5-21-441295449-3808246871-2843121223-501',\r\n}\r\n{code}","closed_at":"2018-10-24T11:58:05.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6542","labels":"group;type_and_provider;user;windows","state":"Closed","updated_at":"2018-10-24T11:58:05.000-0700","timestamp":1652285694.262175,"priority":"Normal","status_category":"Done","pull_request":7204},{"issue_id":"282350","title":"group resource: members parameter: array values broken","url":"https://tickets.puppetlabs.com/browse/PUP-9265","created_at":"2018-10-25T06:28:18.000-0700","number":"PUP-9265","body":"*Puppet Version: 5.5.7*\r\n *Puppet Server Version: 5.3.3*\r\n *OS Name/Version: CentOS 7.5*\r\n\r\nStarting with 5.5.7 (5.5.6 works) the members parameter of the group resource does not work with values of type Array anymore due to an evaluation error during catalog application.\r\n\r\n \r\n\r\n/opts/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/group.rb:136f:\r\n{code:java}\r\n# The members property should also accept a comma separated\r\n# list of members (a String parameter) for backwards\r\n# compatibility. Unfortunately, the List property would treat\r\n# our comma separated list of members as a single-element Array.\r\n# This override of should= ensures that a comma separated list of\r\n# members is munged to an array of members, which is what we want.\r\n# Note that we cannot use `munge` because that will pass in each\r\n# array element instead of the entire array if the members property\r\n# is specified as an array of members, which would cause each member\r\n# to be munged into an array for that case. This is undesirable\r\ndef should=(values)\r\n  super(values)  if @should.length == 1 && @should.first.include?(delimiter)\r\n    @should = @should.first.split(delimiter)\r\n  end  @should\r\nend\r\n{code}\r\nThis code was introduced with 5.5.7 and _seems_ to +break arrays completely+ instead of just adding backwards compatibility for strings.\r\n\r\n \r\n\r\n \r\n\r\n*Desired Behavior:*\r\n\r\nHandle arrays as before.\r\n\r\n*Actual Behavior:*\r\n\r\nGroup resources with members parameter values of type Array break puppet runs.\r\n\r\nmodules/module/manifests/init.pp:\r\n{code:java}\r\ngroup { 'foo':\r\n    ensure => 'present',\r\n    members => ['bar'],\r\n    auth_membership => true;\r\n}{code}\r\npuppet agent --test:\r\n{code:java}\r\nError: /Stage[main]/module/Group[foo]: Could not evaluate: undefined method `split' for [\"bar\"]:Array\r\n{code}\r\n \r\n\r\n ","closed_at":"2018-10-26T11:40:20.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9265","labels":"","state":"Closed","updated_at":"2018-10-26T11:40:20.000-0700","timestamp":1652285694.57254,"priority":"Major","status_category":"Done","pull_request":7204},{"issue_id":"277981","title":"Format Handler logs exceptions at too high a level","url":"https://tickets.puppetlabs.com/browse/PUP-9185","created_at":"2018-09-27T13:36:56.000-0700","number":"PUP-9185","body":"I made a [change|https://github.com/puppetlabs/puppet/commit/2dc6f510bf2313bbbc0013f08182918f3986355f] in Puppet 6 to log FormatError exceptions that were silently swallowed, but the interface to log at a debug level didn't work consistently so these are logged as errors even though they can be encountered in normal operation and may not be errors.\r\n","closed_at":"2018-10-29T06:51:01.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9185","labels":"","state":"Closed","updated_at":"2018-10-29T06:51:01.000-0700","timestamp":1652285694.873696,"priority":"Normal","status_category":"Done","pull_request":7150},{"issue_id":"278129","title":"Update error messages that still refer to `puppet cert`","url":"https://tickets.puppetlabs.com/browse/PUP-9187","created_at":"2018-09-28T11:40:45.000-0700","number":"PUP-9187","body":"A recent user report uncovered at least one place in Puppet's error output where we are still referring to the removed {{puppet cert}} commandL https://github.com/puppetlabs/puppet/blob/edc2d4c0ffb2b60879e61f232f62c7fd6927733d/lib/puppet/ssl/host.rb#L162. We should fix that, and also audit the code base for other bad references.","closed_at":"2018-10-29T06:51:05.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9187","labels":"","state":"Closed","updated_at":"2018-10-29T06:51:05.000-0700","timestamp":1652285694.974738,"priority":"Normal","status_category":"Done","pull_request":7129},{"issue_id":"82950","title":"Windows User resource managehome doesn't support custom directories","url":"https://tickets.puppetlabs.com/browse/PUP-4687","created_at":"2015-06-03T08:44:23.000-0700","number":"PUP-4687","body":"The Windows user resource will allow specifying a custom home directory\r\n\r\n{code}\r\npuppet resource user jenkins managehome=true home=c:\\jenkins password=Puppet123!\r\n{code}\r\n\r\nPuppet will claim that this has worked correctly:\r\n\r\n{code}\r\nNotice: /User[jenkins]/ensure: created\r\nuser { 'jenkins':\r\n  ensure   => 'present',\r\n  home     => 'c:\\jenkins',\r\n  password => 'Puppet123!',\r\n}\r\n{code}\r\n\r\nHowever, the home directory will not actually be created and the default directory will be created.","closed_at":"2018-10-29T06:51:05.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4687","labels":"type_and_provider;user;windows;windows-parity","state":"Closed","updated_at":"2018-10-29T06:51:05.000-0700","timestamp":1652285695.077891,"priority":"Normal","status_category":"Done","pull_request":7151},{"issue_id":"278361","title":"Don't manage CA file/directory permissions","url":"https://tickets.puppetlabs.com/browse/PUP-9192","created_at":"2018-10-01T12:30:40.000-0700","number":"PUP-9192","body":"Puppet6 no longer reads to or writes from the CA related files, but we weren't able to move the settings to puppetserver in time for 6. Several of the settings still define an {{owner}}, {{group}}, {{mode}} which means puppet could in theory attempt to manage the permissions on those files. This doesn't happen in practice, because puppet never calls {{Puppet.settings.use(:ca)}}, but an custom application could. To be sure that never happens, we should remove {{owner}}, {{group}}, {{mode}} from the settings in the {{:ca}} section.\r\n\r\n/cc [~maggie]. [~justin]","closed_at":"2018-10-29T06:51:11.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9192","labels":"","state":"Closed","updated_at":"2018-10-29T06:51:11.000-0700","timestamp":1652285695.181892,"priority":"Normal","status_category":"Done","pull_request":7152},{"issue_id":"192213","title":"Exec resource exposing Sensitive data","url":"https://tickets.puppetlabs.com/browse/PUP-7580","created_at":"2017-05-22T03:00:14.000-0700","number":"PUP-7580","body":"Currently the namvar attribute of the exec resource is assigned to the command attribute.\r\nmeaning the name of the resource when printed into resources.txt is the executed parameter.\r\n\r\nThis could be considered a security issue, but also makes it difficult to name resources uniquely.\r\nA request for a name attribute or the ability to use the title as the namevar.\r\n\r\nThis is an issue when running {{puppet agent}} or {{puppet apply --write-catalog-summary}}.\r\n\r\n","closed_at":"2018-10-31T08:09:01.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7580","labels":"","state":"Closed","updated_at":"2018-10-31T08:09:01.000-0700","timestamp":1652285706.188621,"priority":"Normal","status_category":"Done","pull_request":7170},{"issue_id":"280889","title":"suidmanager test fails on non-Windows when running as root","url":"https://tickets.puppetlabs.com/browse/PUP-9244","created_at":"2018-10-17T02:24:28.000-0700","number":"PUP-9244","body":"*Puppet Version: 6.0.1/6.0.2*\r\n *Puppet Server Version:* *6.0.1/6.0.2***\r\n *OS Name/Version: x86_64-Ubuntu 18.04*\r\n\r\nI have followed the steps mentioned in below file.\r\n\r\n[^X86_steps.sh]\r\n\r\n*Desired Behavior:*\r\nAll test cases should pass\r\n\r\n*Actual Behavior:*\r\n\r\nunit test case is failing with below message.\r\n Failures:\r\n\r\n    1) Puppet::Util::SUIDManager#asuser should not get or set euid/egid on Windows\r\n      Failure/Error: expect(xids).to be_empty\r\n        expected `\\{:egid=>42, :euid=>42}.empty?` to return true, got false\r\n       # ./spec/unit/util/suidmanager_spec.rb:129:in `block (3 levels) in <top (required)>'\r\n\r\n  Finished in 11.72 seconds (files took 1.75 seconds to load)\r\n  1222 examples, 1 failure\r\n \r\n\r\nThe same test case is passing for 5.x version, Please check the issue","closed_at":"2018-11-01T17:23:58.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9244","labels":"","state":"Closed","updated_at":"2018-11-01T17:23:58.000-0700","timestamp":1652285706.511379,"priority":"Normal","status_category":"Done","pull_request":7173},{"issue_id":"282441","title":"Only show deprecation of CA setting when it is set in the config file","url":"https://tickets.puppetlabs.com/browse/PUP-9266","created_at":"2018-10-25T10:30:50.000-0700","number":"PUP-9266","body":"When we fixed PUP-9158, we missed the {{:ca}} setting. Since it was actually removed in Puppet 6, we should keep the deprecation warning, but it should only be issued from a hook called when the setting is set in the file, not any time it is used in code.","closed_at":"2018-11-01T17:24:01.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9266","labels":"","state":"Closed","updated_at":"2018-11-01T17:24:01.000-0700","timestamp":1652285706.617652,"priority":"Normal","status_category":"Done","pull_request":7199},{"issue_id":"282553","title":"5.5.7 breaks custom function","url":"https://tickets.puppetlabs.com/browse/PUP-9268","created_at":"2018-10-26T04:21:10.000-0700","number":"PUP-9268","body":"*Puppet Version: 5.5.7*\r\n *Puppet Server Version: 5.3.6*\r\n *OS Name/Version: Debian 9*\r\n\r\nAfter upgrading Puppet from 5.5.6 to 5.5.7, certain custom functions do not work anymore. Specifically, camptocamp/accounts has a function strformat which doesn't work anymore.\r\n\r\nThe client shows:\r\n{code:java}\r\nError: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Resource Statement, Evaluation Error: Error while evaluating a Function Call, undefined method `strformat' for Scope(Accounts::Authorized_key[stefan-eris-on-root]):Puppet::Parser::Scope (file: /etc/puppetlabs/code/environments/production/modules/accounts/manifests/authorized_key.pp, line: 32, column: 36) (file: /etc/puppetlabs/code/environments/production/modules/accounts/manifests/account.pp, line: 98)\r\n{code}\r\nThe server log shows:\r\n{code:java}\r\nERROR [qtp2035689341-63] [puppetserver] Puppet Evaluation Error: Error while evaluating a Resource Statement, Evaluation Error: Error while evalu\r\nating a Function Call, undefined method `strformat' for Scope(Accounts::Authorized_key[stefan-eris-on-root]):Puppet::Parser::Scope (file: /etc/puppetlabs/code/environmen\r\nts/production/modules/accounts/manifests/authorized_key.pp, line: 32, column: 36) (file: /etc/puppetlabs/code/environments/production/modules/accounts/manifests/account.\r\npp, line: 98) on node node.example.com\r\norg/jruby/RubyBasicObject.java:1555:in `method_missing'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/scope.rb:1036:in `method_missing'\r\n/etc/puppetlabs/code/environments/production/modules/accounts/lib/puppet/parser/functions/strformat.rb:22:in `real_function_strformat'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/functions.rb:174:in `function_strformat'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/functions.rb:167:in `function_strformat'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions.rb:752:in `call'\r\norg/jruby/RubyKernel.java:1242:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions.rb:749:in `call'\r\n/etc/puppetlabs/code/environments/production/modules/accounts/manifests/authorized_key.pp:32:in `call_function'\r\norg/jruby/RubyKernel.java:1079:in `eval'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:305:in `call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:303:in `call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:964:in `call_function_with_block'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:933:in `eval_CallNamedFunctionExpression'\r\n\r\n{code}\r\nThe code in question reads (abbreviated):\r\n{code:java}\r\nPuppet::Parser::Functions.newfunction(:strformat, :type => :rvalue) do |args|\r\n  def strformat(format, arg)\r\n    new = format.gsub(/%\\{([^%\\[\\}]+)([^%\\}]*)\\}/) { eval(\"arg[$1]#{$2}\") }\r\n    (new =~ /%/) ? strformat(new, arg) : new\r\n  end\r\n\r\n  strformat(args[0], self.to_hash)\r\nend\r\n\r\n{code}","closed_at":"2018-11-06T10:39:53.000-0800","comments":21,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9268","labels":"resolved-issue-added","state":"Closed","updated_at":"2018-11-06T10:39:53.000-0800","timestamp":1652285708.267721,"priority":"Normal","status_category":"Done","pull_request":7206},{"issue_id":"282580","title":"puppet 5.5.7 and 6.0.3 cause a stacktrace with puppetlabs-mysql 5.x series","url":"https://tickets.puppetlabs.com/browse/PUP-9270","created_at":"2018-10-26T10:12:25.000-0700","number":"PUP-9270","body":"*Puppet Version: 5.5.7*\r\n *Puppet Server Version:*\r\n *OS Name/Version: CentOS 7*\r\n\r\nThe puppet-nova unit tests that consume puppetlabs-mysql 5.2.1 are failing with:\r\n\r\n{code}\r\nEvaluation Error: Error while evaluating a Function Call, undefined local variable or method `created' for Puppet::Pops::Loader::RubyLegacyFunctionInstantiator:Class (file: /home/zuul/workspace/spec/fixtures/modules/mysql/manifests/server.pp, line: 52, column: 14) on node centos-7-rax-ord-0000030381\r\n{code}\r\n \r\n\r\n*Desired Behavior:*\r\n\r\nNo failure from puppet.\r\n\r\n \r\n\r\n*Actual Behavior:*\r\n\r\n \r\n\r\n \r\n\r\nRunning the unit tests testing with puppetlabs-mysql 5.2.1 causes the following stack trace:\r\n\r\n{code}\r\nhttp://logs.openstack.org/46/613446/1/check/puppet-openstack-unit-5.5-centos-7/40e8913/job-output.txt.gz#_2018-10-26_03_45_55_003975\r\n\r\n2018-10-26 03:45:55.002558 | centos-7 | 1) nova::db::mysql_api on debian-8-x86_64 configures nova::db::mysql_api with only required params should contain Openstacklib::Db::Mysql[nova_api] with user => \"nova_api\", password_hash => \"*AA1420F182E88B9E5F874F6FBE7459291E8F4601\", charset => \"utf8\" and collate => \"utf8_general_ci\"\r\n2018-10-26 03:45:55.002632 | centos-7 | Failure/Error:\r\n2018-10-26 03:45:55.002790 | centos-7 | it { is_expected.to contain_openstacklib__db__mysql('nova_api').with(\r\n2018-10-26 03:45:55.002886 | centos-7 | :user => 'nova_api',\r\n2018-10-26 03:45:55.003035 | centos-7 | :password_hash => '*AA1420F182E88B9E5F874F6FBE7459291E8F4601',\r\n2018-10-26 03:45:55.003125 | centos-7 | :charset => 'utf8',\r\n2018-10-26 03:45:55.003246 | centos-7 | :collate => 'utf8_general_ci',\r\n2018-10-26 03:45:55.003316 | centos-7 | )}\r\n2018-10-26 03:45:55.003357 | centos-7 |\r\n2018-10-26 03:45:55.003442 | centos-7 | Puppet::PreformattedError:\r\n2018-10-26 03:45:55.003975 | centos-7 | Evaluation Error: Error while evaluating a Function Call, undefined local variable or method `created' for Puppet::Pops::Loader::RubyLegacyFunctionInstantiator:Class (file: /home/zuul/workspace/spec/fixtures/modules/mysql/manifests/server.pp, line: 52, column: 14) on node centos-7-rax-ord-0000030381\r\n2018-10-26 03:45:55.004198 | centos-7 | Shared Example Group: \"nova::db::mysql_api\" called from ./spec/classes/nova_db_mysql_api_spec.rb:81\r\n2018-10-26 03:45:55.004425 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/loader/ruby_legacy_function_instantiator.rb:36:in `create'\r\n2018-10-26 03:45:55.004629 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/loader/module_loaders.rb:263:in `instantiate'\r\n2018-10-26 03:45:55.004818 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/loader/module_loaders.rb:237:in `find'\r\n2018-10-26 03:45:55.005017 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/loader/base_loader.rb:161:in `internal_load'\r\n2018-10-26 03:45:55.005220 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/loader/base_loader.rb:42:in `load_typed'\r\n2018-10-26 03:45:55.005423 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/loader/base_loader.rb:153:in `internal_load'\r\n2018-10-26 03:45:55.005613 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/loader/base_loader.rb:42:in `load_typed'\r\n2018-10-26 03:45:55.005786 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/loader/loader.rb:72:in `load'\r\n2018-10-26 03:45:55.005997 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/runtime3_support.rb:302:in `call_function'\r\n2018-10-26 03:45:55.006234 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/evaluator_impl.rb:964:in `call_function_with_block'\r\n2018-10-26 03:45:55.006478 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/evaluator_impl.rb:933:in `eval_CallNamedFunctionExpression'\r\n2018-10-26 03:45:55.006655 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/visitor.rb:90:in `visit_this_1'\r\n2018-10-26 03:45:55.006853 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n2018-10-26 03:45:55.007079 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/evaluator_impl.rb:370:in `eval_AssignmentExpression'\r\n2018-10-26 03:45:55.007274 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/visitor.rb:90:in `visit_this_1'\r\n2018-10-26 03:45:55.007510 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n2018-10-26 03:45:55.007792 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/evaluator_impl.rb:660:in `block in eval_BlockExpression'\r\n2018-10-26 03:45:55.007989 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/evaluator_impl.rb:660:in `each'\r\n2018-10-26 03:45:55.008202 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/evaluator_impl.rb:660:in `reduce'\r\n2018-10-26 03:45:55.008425 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/evaluator_impl.rb:660:in `eval_BlockExpression'\r\n2018-10-26 03:45:55.008602 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/visitor.rb:90:in `visit_this_1'\r\n2018-10-26 03:45:55.008799 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n2018-10-26 03:45:55.008997 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/parser/evaluating_parser.rb:63:in `evaluate'\r\n2018-10-26 03:45:55.009196 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/parser/ast/pops_bridge.rb:32:in `evaluate'\r\n2018-10-26 03:45:55.009419 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/parser/ast/pops_bridge.rb:72:in `block (2 levels) in evaluate'\r\n2018-10-26 03:45:55.009617 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/parser/ast/pops_bridge.rb:71:in `catch'\r\n2018-10-26 03:45:55.009824 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/parser/ast/pops_bridge.rb:71:in `block in evaluate'\r\n2018-10-26 03:45:55.010005 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/parser/ast/pops_bridge.rb:70:in `catch'\r\n2018-10-26 03:45:55.010205 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/parser/ast/pops_bridge.rb:70:in `evaluate'\r\n2018-10-26 03:45:55.010387 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/parser/ast.rb:31:in `safeevaluate'\r\n2018-10-26 03:45:55.010571 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/resource/type.rb:136:in `evaluate_code'\r\n2018-10-26 03:45:55.010762 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/parser/resource.rb:79:in `block in evaluate'\r\n2018-10-26 03:45:55.010960 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n2018-10-26 03:45:55.011130 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/util/profiler.rb:51:in `profile'\r\n2018-10-26 03:45:55.011338 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/parser/resource.rb:71:in `evaluate'\r\n2018-10-26 03:45:55.011517 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/parser/compiler.rb:386:in `each'\r\n2018-10-26 03:45:55.011708 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/parser/compiler.rb:386:in `evaluate_classes'\r\n2018-10-26 03:45:55.011886 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/functions/include.rb:48:in `include'\r\n2018-10-26 03:45:55.012072 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/functions/dispatch.rb:60:in `invoke'\r\n2018-10-26 03:45:55.012303 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/functions/dispatcher.rb:43:in `block in dispatch'\r\n2018-10-26 03:45:55.012502 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/functions/dispatcher.rb:42:in `catch'\r\n2018-10-26 03:45:55.012699 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/functions/dispatcher.rb:42:in `dispatch'\r\n2018-10-26 03:45:55.012899 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/functions/function.rb:46:in `block in call'\r\n2018-10-26 03:45:55.013083 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/functions/function.rb:45:in `catch'\r\n2018-10-26 03:45:55.013279 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/functions/function.rb:45:in `call'\r\n2018-10-26 03:45:55.013381 | centos-7 | # :1:in `block in call_function'\r\n2018-10-26 03:45:55.013579 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/runtime3_support.rb:305:in `eval'\r\n2018-10-26 03:45:55.013807 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/runtime3_support.rb:305:in `block in call_function'\r\n2018-10-26 03:45:55.014018 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n2018-10-26 03:45:55.014204 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/util/profiler.rb:51:in `profile'\r\n2018-10-26 03:45:55.014422 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/runtime3_support.rb:303:in `call_function'\r\n2018-10-26 03:45:55.014654 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/evaluator_impl.rb:964:in `call_function_with_block'\r\n2018-10-26 03:45:55.014896 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/evaluator_impl.rb:933:in `eval_CallNamedFunctionExpression'\r\n2018-10-26 03:45:55.015073 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/visitor.rb:90:in `visit_this_1'\r\n2018-10-26 03:45:55.015296 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n2018-10-26 03:45:55.015538 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/evaluator_impl.rb:660:in `block in eval_BlockExpression'\r\n2018-10-26 03:45:55.015733 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/evaluator_impl.rb:660:in `each'\r\n2018-10-26 03:45:55.015931 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/evaluator_impl.rb:660:in `reduce'\r\n2018-10-26 03:45:55.016151 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/evaluator_impl.rb:660:in `eval_BlockExpression'\r\n2018-10-26 03:45:55.016343 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/visitor.rb:90:in `visit_this_1'\r\n2018-10-26 03:45:55.016546 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n2018-10-26 03:45:55.016612 | centos-7 | # :in `stack'\r\n2018-10-26 03:45:55.016784 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/puppet_stack.rb:33:in `eval'\r\n2018-10-26 03:45:55.016958 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/puppet_stack.rb:33:in `stack'\r\n2018-10-26 03:45:55.017199 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/evaluator_impl.rb:737:in `eval_Program'\r\n2018-10-26 03:45:55.017385 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/visitor.rb:90:in `visit_this_1'\r\n2018-10-26 03:45:55.017585 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n2018-10-26 03:45:55.017784 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/pops/parser/evaluating_parser.rb:63:in `evaluate'\r\n2018-10-26 03:45:55.017973 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/parser/ast/pops_bridge.rb:125:in `evaluate'\r\n2018-10-26 03:45:55.018148 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/parser/ast.rb:31:in `safeevaluate'\r\n2018-10-26 03:45:55.018345 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/resource/type.rb:136:in `evaluate_code'\r\n2018-10-26 03:45:55.018540 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/parser/resource.rb:79:in `block in evaluate'\r\n2018-10-26 03:45:55.018743 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n2018-10-26 03:45:55.018917 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/util/profiler.rb:51:in `profile'\r\n2018-10-26 03:45:55.019093 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/parser/resource.rb:71:in `evaluate'\r\n2018-10-26 03:45:55.019312 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/parser/compiler.rb:592:in `evaluate_main'\r\n2018-10-26 03:45:55.019532 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/parser/compiler.rb:166:in `block (2 levels) in compile'\r\n2018-10-26 03:45:55.019732 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n2018-10-26 03:45:55.019904 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/util/profiler.rb:51:in `profile'\r\n2018-10-26 03:45:55.020095 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/parser/compiler.rb:166:in `block in compile'\r\n2018-10-26 03:45:55.020281 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/context.rb:65:in `override'\r\n2018-10-26 03:45:55.020440 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet.rb:260:in `override'\r\n2018-10-26 03:45:55.020616 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/parser/compiler.rb:155:in `compile'\r\n2018-10-26 03:45:55.020790 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/parser/compiler.rb:35:in `compile'\r\n2018-10-26 03:45:55.021019 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/indirector/catalog/compiler.rb:303:in `block (2 levels) in compile'\r\n2018-10-26 03:45:55.021231 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n2018-10-26 03:45:55.021407 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/util/profiler.rb:51:in `profile'\r\n2018-10-26 03:45:55.021619 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/indirector/catalog/compiler.rb:301:in `block in compile'\r\n2018-10-26 03:45:55.021795 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/util.rb:232:in `block in benchmark'\r\n2018-10-26 03:45:55.021917 | centos-7 | # /usr/share/ruby/benchmark.rb:296:in `realtime'\r\n2018-10-26 03:45:55.022079 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/util.rb:231:in `benchmark'\r\n2018-10-26 03:45:55.022286 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/indirector/catalog/compiler.rb:299:in `compile'\r\n2018-10-26 03:45:55.022495 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/indirector/catalog/compiler.rb:54:in `block in find'\r\n2018-10-26 03:45:55.022693 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/node/environment.rb:450:in `with_text_domain'\r\n2018-10-26 03:45:55.022885 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/indirector/catalog/compiler.rb:53:in `find'\r\n2018-10-26 03:45:55.023068 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/indirector/indirection.rb:198:in `find'\r\n2018-10-26 03:45:55.023312 | centos-7 | # ./.bundled_gems/gems/rspec-puppet-2.3.2/lib/rspec-puppet/support.rb:218:in `block in build_catalog_without_cache'\r\n2018-10-26 03:45:55.023480 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet/context.rb:65:in `override'\r\n2018-10-26 03:45:55.023634 | centos-7 | # ./.bundled_gems/gems/puppet-5.5.7/lib/puppet.rb:260:in `override'\r\n2018-10-26 03:45:55.023850 | centos-7 | # ./.bundled_gems/gems/rspec-puppet-2.3.2/lib/rspec-puppet/support.rb:216:in `build_catalog_without_cache'\r\n2018-10-26 03:45:55.024066 | centos-7 | # ./.bundled_gems/gems/rspec-puppet-2.3.2/lib/rspec-puppet/support.rb:231:in `block in build_catalog'\r\n2018-10-26 03:45:55.024258 | centos-7 | # ./.bundled_gems/gems/rspec-puppet-2.3.2/lib/rspec-puppet/cache.rb:17:in `call'\r\n2018-10-26 03:45:55.024435 | centos-7 | # ./.bundled_gems/gems/rspec-puppet-2.3.2/lib/rspec-puppet/cache.rb:17:in `get'\r\n2018-10-26 03:45:55.024628 | centos-7 | # ./.bundled_gems/gems/rspec-puppet-2.3.2/lib/rspec-puppet/support.rb:230:in `build_catalog'\r\n2018-10-26 03:45:55.024821 | centos-7 | # ./.bundled_gems/gems/rspec-puppet-2.3.2/lib/rspec-puppet/support.rb:28:in `load_catalogue'\r\n2018-10-26 03:45:55.025041 | centos-7 | # ./.bundled_gems/gems/rspec-puppet-2.3.2/lib/rspec-puppet/example/class_example_group.rb:7:in `catalogue'\r\n2018-10-26 03:45:55.025249 | centos-7 | # ./.bundled_gems/gems/rspec-puppet-2.3.2/lib/rspec-puppet/support.rb:8:in `block in subject'\r\n2018-10-26 03:45:55.025458 | centos-7 | # ./.bundled_gems/gems/rspec-puppet-2.3.2/lib/rspec-puppet/matchers/create_generic.rb:82:in `call'\r\n2018-10-26 03:45:55.025669 | centos-7 | # ./.bundled_gems/gems/rspec-puppet-2.3.2/lib/rspec-puppet/matchers/create_generic.rb:82:in `matches?'\r\n2018-10-26 03:45:55.025854 | centos-7 | # ./spec/classes/nova_db_mysql_api_spec.rb:19:in `block (4 levels) in <top (required)>'\r\n2018-10-26 03:45:55.025891 | centos-7 |\r\n{code}","closed_at":"2018-11-06T10:45:28.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9270","labels":"resolved_issue_added","state":"Closed","updated_at":"2018-11-06T10:45:28.000-0800","timestamp":1652285708.373506,"priority":"Major","status_category":"Done","pull_request":7203},{"issue_id":"276983","title":"Lexer incorrectly identifying list starts inside heredocs","url":"https://tickets.puppetlabs.com/browse/PUP-9163","created_at":"2018-09-24T04:05:43.000-0700","number":"PUP-9163","body":"Square brackets that are:\r\n * Inside heredocs\r\n * Inside an interpolation\r\n\r\nAre sometimes being incorrectly lexed as TOKEN_LISTSTART.\r\nh3. Simplest example\r\n\r\nCreate test.pp:\r\n{code}$xxxxxxx = @(\"END\")\r\n${facts['os']['family']}\r\nXXXXXXX XXX\r\nEND\r\nnotice($xxxxxxx){code}\r\nPuppet apply it.\r\nh3. What I expect\r\n\r\nSome text to appear showing the OS family.\r\nh3. What I actually see\r\n{code:none}Error: Could not parse for environment production: Syntax error at '[' (file: /Users/alexharvey/git/home/puppet-test/test.pp, line: 2, column: 14)\r\n{code}\r\nh3. More info\r\n\r\nNote the space inside XXX XX. That space is matching in the lexer on this line [here|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/pops/parser/lexer2.rb#L192], leading to the '[' being lexed as TOKEN_LISTSTART.","closed_at":"2018-11-07T11:40:57.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9163","labels":"","state":"Closed","updated_at":"2018-11-07T11:40:57.000-0800","timestamp":1652285708.47872,"priority":"Normal","status_category":"Done","pull_request":7114},{"issue_id":"173233","title":"Puppet fails with inscrutable errors when logging large messages on Windows","url":"https://tickets.puppetlabs.com/browse/PUP-7153","created_at":"2017-02-01T06:28:14.000-0800","number":"PUP-7153","body":"The Windows event log has limits on the amount of data it will accept when logging a message:\r\n\r\nhttps://msdn.microsoft.com/en-us/library/windows/desktop/aa363679(v=vs.85).aspx\r\n\r\nThese limits can be exceeded by {{exec}} resources which log a large volume of data. For example, a verbose recursive copy of a deep directory tree.\r\n\r\n\r\nh2. Reproduction Case\r\n\r\n  1. Install the Puppet agent on Windows Server 2012 or newer.\r\n\r\n  2. Install the Powershell module:\r\n\r\n{code}\r\npuppet module install puppetlabs/powershell\r\n{code}\r\n\r\n  3. Create a manifest with the following content:\r\n\r\n{code:puppet}\r\n# large_output.pp\r\nexec{'log large output':\r\n  # Repeat a character 32,000 times. Should trigger the event log limit\r\n  command => 'Write-Output (\"x\" * 32000)',\r\n  provider => powershell,\r\n  logoutput => true,\r\n}\r\n{code}\r\n\r\n  4. Apply the manifest and send output to the event log:\r\n\r\n{code}\r\npuppet apply large_output.pp --logdest=eventlog --logdest=console\r\n{code}\r\n\r\nh3. Outcome\r\n\r\nThe command fails with a terse, cryptic message like:\r\n\r\n{noformat}\r\nPS C:\\Users\\Administrator> puppet apply test.pp --logdest=eventlog --logdest=console\r\nNotice: Compiled catalog for pe-201642-agent-win2012 in environment production in 0.27 seconds\r\nError: The parameter is incorrect. - ReportEvent\r\nError: /Stage[main]/Main/Exec[test log large output]/returns: change from notrun to 0 failed: The parameter is incorrect\r\n. - ReportEvent\r\nNotice: Applied catalog in 2.89 seconds\r\n{noformat}\r\n\r\nOr:\r\n\r\n{noformat}\r\nPS C:\\Users\\Administrator> puppet apply test.pp --logdest=eventlog --logdest=console\r\nNotice: Compiled catalog for pe-201642-agent-win2012 in environment production in 0.27 seconds\r\nError: The parameter is incorrect. - ReportEvent\r\nError: /Stage[main]/Main/Exec[test log large output]/returns: change from notrun to 0 failed: Too many links. - ReportEvent\r\nNotice: Applied catalog in 2.89 seconds\r\n{noformat}\r\n\r\nDetailed error trace:\r\n\r\n{noformat}\r\nPS C:\\Users\\Administrator> puppet apply test.pp --logdest=eventlog --logdest=console --trace\r\nNotice: Compiled catalog for pe-201642-agent-win2012 in environment production in 0.28 seconds\r\nError: The parameter is incorrect. - ReportEvent\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/gems/2.1.0/gems/win32-eventlog-0.6.2/lib/win32/eventlog.rb:717:in\r\n`report_event'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/log/destinations.rb:241:in `handle'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/log.rb:176:in `block in newmessage'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/log.rb:175:in `each'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/log.rb:175:in `newmessage'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/log.rb:268:in `initialize'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/log.rb:87:in `new'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/log.rb:87:in `create'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/logging.rb:12:in `send_log'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/util/logging.rb:21:in `block (2 levels) in <mod\r\nule:Logging>'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/type/exec.rb:154:in `block in sync'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/type/exec.rb:153:in `each'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/type/exec.rb:153:in `sync'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:236:in `sync'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:134:in `sync_if\r\n_needed'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:88:in `block in\r\n perform_changes'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:87:in `each'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:87:in `perform_\r\nchanges'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:21:in `evaluate\r\n'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction.rb:224:in `apply'\r\nC:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/transaction.rb:240:in `eval_resource'\r\n...\r\n{noformat}\r\n\r\nh3. Expected Outcome\r\n\r\nThe Puppet Agent should split, truncate or drop large messages and log a better error explaining what happened.","closed_at":"2018-11-13T08:56:00.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7153","labels":"","state":"Closed","updated_at":"2018-11-13T08:56:00.000-0800","timestamp":1652285708.582927,"priority":"Normal","status_category":"Done","pull_request":6295},{"issue_id":"150344","title":"Puppet::Util::Execution.execute 'hostname' returns nothing as daemon","url":"https://tickets.puppetlabs.com/browse/PUP-6675","created_at":"2016-09-02T10:22:24.000-0700","number":"PUP-6675","body":"When {{Puppet::Util::Execution.execute 'hostname'}} is invoked by Puppet running as a daemon, no output is written. This seems to be exclusive to {{hostname}}, and may be restricted to certain Linux versions. I've tried it on RedHat 7 (64-bit).\r\n\r\nThis can happen in a provider when using {{commands :hostname => 'hostname'}}, and then invoking {{hostname}}. The root appears to be how {{/usr/bin/hostname}} handles file handles.\r\n\r\nIt can be simplified to\r\n{code}\r\nexec { '/bin/hostname': logoutput => true }\r\n{code}\r\n\r\nThis is getting into some core Ruby weirdness:\r\n{code}\r\nruby -e \"Kernel.fork { \\$stdout.reopen('/tmp/foo', 'w+'); Kernel.exec 'hostname' }\"\r\n{code}\r\nprints hostname to {{/tmp/foo}} when run from the command-line. When run as a systemd script:\r\n{code:title=/usr/lib/systemd/system/print-hostname.service}\r\n[Unit]\r\nDescription=Print the hostname using Ruby\r\nWants=basic.target\r\nAfter=basic.target network.target\r\n\r\n[Service]\r\nExecStart=/usr/bin/ruby -e \"Kernel.fork { $stdout.reopen('/tmp/foo', 'w'); Kernel.exec 'hostname' }\"\r\nKillMode=process\r\n\r\n[Install]\r\nWantedBy=multi-user.target\r\n{code}\r\nsymlinked to {{/etc/systemd/system/multi-user.target.wants/print-hostname.service}} it creates an empty file.\r\n\r\nChanging the ruby script to\r\n{code}\r\nfoo = open('/tmp/foo', 'w'); pid = Kernel.fork { $stdout.reopen(foo); Kernel.exec 'hostname' }; Process.wait pid; foo.close\r\n{code}\r\nto ensure the file is closed doesn't seem to change the behavior.\r\n\r\nAlso, behavior is consistent with both system Ruby on Redhat 7 (2.0.0) and Ruby with a puppet-agent 1.6.2 build candidate.\r\n\r\nIf I use a simple fork/exec without trying to redirect stdout, it prints correctly as a service and from the command-line. It's only once I redirect stdout that things get weird. The above is essentially what Puppet::Util::Execution.execute does, which is what the type is calling to. Interestingly, Facter::Core::Execution.execute (with Facter 3) works fine.\r\n\r\nWith {{strace}}, I note that {{hostname}} calls {{write(1, ...)}} then immediately exits. Other examples will close fids 1 and 2 before exiting.","closed_at":"2018-11-19T14:02:32.000-0800","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6675","labels":"selinux","state":"Closed","updated_at":"2018-11-19T14:02:32.000-0800","timestamp":1652285708.794999,"priority":"Normal","status_category":"Done","pull_request":6028},{"issue_id":"274372","title":"Windows file system ACLs should always write SYSTEM: (F)","url":"https://tickets.puppetlabs.com/browse/PUP-9106","created_at":"2018-09-05T10:42:25.000-0700","number":"PUP-9106","body":"When creating Windows ACLs when writing file permissions, the current code allows for the SYSTEM ACE to be written as something other than F (Full Control). This can be problematic as it can result in files that cannot have permissions reset, or that may be inaccessible to Puppet itself (which typically runs as SYSTEM).\r\n\r\nIn practical terms, there is no good reason to set SYSTEM permissions to anything other than F and Puppet should disallow that. \r\n\r\nAt one point the Puppet code was modified as part of https://projects.puppetlabs.com/issues/15559 (related to PUP-5480) in https://github.com/puppetlabs/puppet/commit/b578ed48ac9585edb86b296e99f8aeeecc02fb4e#diff-a788175040b15f1e899dae62e4c1b8c6 to re-add a missing SYSTEM if it wasn't already specified.\r\n\r\nWe never took the additional step of making sure that SYSTEM can only be set to F, which in hindsight, seems like the right approach, given what is now known about permissions management and the work that was done as part of PA-2019 and PUP-5985.\r\n\r\nOne thing to note is that this will technically be a breaking change. This could cause idempotency issues under a few (highly unlikely) circumstances:\r\n\r\n* If SYSTEM is explicitly managed and set to an octal mode other than 7\r\n* If an octal mode is set inconsistently for a file where the user and group are both SYSTEM (this would have already been a problem)\r\n* On older Puppet versions with manage_internal_file_permissions set to true on Windows (this is not a concern now though given work in PUP-5985) where Puppet tried to manage its own files\r\n\r\nGiven the low likelihood of a manifest explicitly specifying SYSTEM other than F, but the Puppet code actually writing F as a result of this fix - this should be corrected.\r\n\r\nIn addition, a {{debug}} message should be emitted that an attempt to set SYSTEM other than F was intercepted and corrected (at the very least, this may help find some internal bugs that should be fixed as well)","closed_at":"2018-12-04T13:09:55.000-0800","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9106","labels":"acl;ntfs;windows","state":"Closed","updated_at":"2018-12-04T13:09:55.000-0800","timestamp":1652285710.856667,"priority":"Normal","status_category":"Done","pull_request":7088},{"issue_id":"272191","title":"Inconsistent undef value received by 4.x API Ruby functions after touched by 3.x Ruby function","url":"https://tickets.puppetlabs.com/browse/PUP-9077","created_at":"2018-08-21T07:31:40.000-0700","number":"PUP-9077","body":"While trying to use the Stdlib function to_yaml() I believe I have discovered a bug in how Puppet handles data returned from Ruby 3.x API functions versions when passed into 4.x Ruby functions.\r\n\r\nIt is easiest to explain with a reproducer. Give this code, where func3() and func4() are just Ruby API 3.x and 4.x functions respectively that each just return the value they were passed:\r\n{noformat}\r\n$orig_hash = {\r\n  'mykey'    => undef,\r\n  'otherkey' => 'test',\r\n}\r\n\r\n$func4_hash = func4($orig_hash)\r\nnotice(\"func4_hash: ${func4_hash}\")\r\nnotice(\"func4_hash_json: ${to_json($func4_hash)}\")\r\nnotice(\"func4_hash_yaml: ${to_yaml($func4_hash)}\")\r\n\r\n$func3_hash = func3($orig_hash)\r\nnotice(\"func3_hash: ${func3_hash}\")\r\nnotice(\"func3_hash_json: ${to_json($func3_hash)}\")\r\nnotice(\"func3_hash_yaml: ${to_yaml($func3_hash)}\")\r\n{noformat}\r\nI get this output:\r\n{noformat}\r\n$ puppet apply --modulepath=. test/test.pp \r\nNotice: Scope(Class[main]): func4_hash: {mykey => , otherkey => test}\r\nNotice: Scope(Class[main]): func4_hash_json: {\"mykey\":null,\"otherkey\":\"test\"}\r\nNotice: Scope(Class[main]): func4_hash_yaml: ---\r\nmykey: \r\notherkey: test\r\n\r\nNotice: Scope(Class[main]): func3_hash: {mykey => , otherkey => test}\r\nNotice: Scope(Class[main]): func3_hash_json: {\"mykey\":\"undef\",\"otherkey\":\"test\"}\r\nNotice: Scope(Class[main]): func3_hash_yaml: ---\r\nmykey: :undef\r\notherkey: test\r\n\r\nNotice: Compiled catalog for msp-pumtl31.msp.secure-24.net in environment production in 0.02 seconds\r\nNotice: Applied catalog in 0.01 seconds\r\n{noformat}\r\nNote how the original data structure is correctly passed to the 4.x function with a nil value the first time, but after passing through a 3.x function the 4.x function now receives :undef and not nil.\r\n\r\nThe expected behavior is that a 4.x Ruby function would always receive nil when passed a Puppet undef value, regardless of whether it has passed through a 3.x style function or not.\r\n\r\nThank you.","closed_at":"2018-12-06T02:42:28.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9077","labels":"","state":"Closed","updated_at":"2018-12-06T02:42:28.000-0800","timestamp":1652285711.384661,"priority":"Normal","status_category":"Done","pull_request":7012},{"issue_id":"288254","title":"PUP-9294 fails to load valid 3.x function when it contains call to constant","url":"https://tickets.puppetlabs.com/browse/PUP-9359","created_at":"2018-12-11T12:42:35.000-0800","number":"PUP-9359","body":"In PUP-9294 new checking for illegal constructs in 3.x functions was introduced. Before release it was found that it crashes if the 3.x function contains a call to a constant. The one that was detected contained the following:\r\n\r\n{code}\r\nFloat(a_string)\r\n{code}\r\n\r\nThe logic added in PUP-9294 was not expecting calls to constants and would produce a \"nil\" function name thus crashing when validating the loaded 3.x function.","closed_at":"2018-12-12T10:44:57.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9359","labels":"","state":"Closed","updated_at":"2018-12-12T10:44:57.000-0800","timestamp":1652285712.01405,"priority":"Blocker","status_category":"Done","pull_request":7284},{"issue_id":"281124","title":"Puppet String _(\"(<setting>\") has a typo ","url":"https://tickets.puppetlabs.com/browse/PUP-9245","created_at":"2018-10-17T15:18:15.000-0700","number":"PUP-9245","body":"While browsing the translation segments for Puppet Platform on Transifex I came across a text fragment which let me to the following link:\r\n\r\n[https://github.com/puppetlabs/puppet/blame/1707f2ca46867651095e01379bd01dab08076b8b/locales/puppet.pot#L757]\r\n\r\nAnd the source code reference near that line led me to the following line of code.\r\n\r\n> [https://github.com/puppetlabs/puppet/blame/1574c5a773d8d5d3ccd5979e4ab44c9274a2dd90/lib/puppet/face/config.rb#L213]\r\n\r\n \r\n\r\n_(\"(<setting>\") should be\r\n\r\n_(\"<setting>\") ?  ..... removing \"(\" in the string\r\n\r\n ","closed_at":"2018-12-17T19:25:12.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9245","labels":"i18n","state":"Closed","updated_at":"2018-12-17T19:25:12.000-0800","timestamp":1652285712.220474,"priority":"Normal","status_category":"Done","pull_request":7175},{"issue_id":"286146","title":"'puppet ssl clean' does not remove the certificate requests","url":"https://tickets.puppetlabs.com/browse/PUP-9327","created_at":"2018-11-22T02:32:57.000-0800","number":"PUP-9327","body":"*..Puppet Version: 6.0.4*\r\n *Puppet Server Version: 6.0.1*\r\n *OS Name/Version: Centos7*\r\n\r\nWhen I get \"Error: Could not request certificate: The certificate retrieved from the master does not match the agent's private key...\", I use the \"puppet ssl clean\" as suggested by the error message:\r\n\r\n \r\n{code:java}# puppet ssl clean\r\nNotice: Removed private key /etc/puppetlabs/puppet/ssl/private_keys/dbslave.example.com.pem\r\nNotice: Removed public key /etc/puppetlabs/puppet/ssl/public_keys/dbslave.example.com.pem\r\nNotice: Removed certificate /etc/puppetlabs/puppet/ssl/certs/dbslave.example.com.pem\r\n{code}\r\n \r\n\r\nBut then I have to clean the certificate request manually, otherwise I get the same error.\r\n{code:java}# rm /etc/puppetlabs/puppet/ssl/certificate_requests/dbslave.example.com.pem{code}\r\n*Desired Behavior:*\r\n\r\nAccording to the feature request ( PUP-9156)  it should be cleaned automatically along with the other files.\r\n\r\nPuppet configs are all default. I have not overridden any of them.\r\n\r\n ","closed_at":"2018-12-19T06:21:51.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9327","labels":"resolved-issue-added","state":"Closed","updated_at":"2018-12-19T06:21:51.000-0800","timestamp":1652285712.325248,"priority":"Normal","status_category":"Done","pull_request":7253},{"issue_id":"22411","title":"Exec provider should support environment variables with empty values","url":"https://tickets.puppetlabs.com/browse/PUP-1209","created_at":"2013-12-20T13:10:57.000-0800","number":"PUP-1209","body":"The exec provider takes an environment parameter that takes either a string or an array of variables. Each variable is expressed as a pair, like \"KEY=value\" for example. The problem is that the code that parses this string requires a value whereas this is not strictly necessary, like \"KEY=\" should be perfectly acceptable. The code in Puppet::Provider::Exec.run looks like this:\r\n\r\n{code:none}\r\nif setting =~ /^(\\w+)=((.|\\n)+)$/\r\n env_name = $1\r\n value = $2\r\n{code}\r\n\r\nSimply changing the regular expression to use \"*\" instread of \"+\" for the value should work just fine:\r\n\r\n{code:none}\r\nirb(main):001:0> setting = 'KEY='\r\n => \"KEY=\"\r\n irb(main):002:0> setting =~ /^(\\w+)=((.|\\n)+)$/\r\n => nil\r\n irb(main):003:0> setting =~ /^(\\w+)=((.|\\n)*)$/\r\n => 0\r\n irb(main):004:0> $1\r\n => \"KEY\"\r\n irb(main):005:0> $2\r\n => \"\" \r\n{code}\r\n\r\nSo, the value of empty string is exactly what was requested.","closed_at":"2018-12-19T06:21:53.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1209","labels":"community;redmine;resolved-issue-added","state":"Closed","updated_at":"2018-12-19T06:21:53.000-0800","timestamp":1652285712.430331,"priority":"Normal","status_category":"Done","pull_request":7146},{"issue_id":"281310","title":"add support for devices to puppet ssl","url":"https://tickets.puppetlabs.com/browse/PUP-9248","created_at":"2018-10-18T15:20:35.000-0700","number":"PUP-9248","body":"After PUP-9156 ...\r\n\r\nAn SSL error involving a device prompts the user to run the 'puppet ssl clean' command\r\nwhich cleans agent ssl files instead of the device ssl files,\r\nand prompts the user to run 'puppet agent' instead of 'puppet device'.","closed_at":"2018-12-19T06:21:53.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9248","labels":"resolved-issue-added","state":"Closed","updated_at":"2018-12-19T06:21:53.000-0800","timestamp":1652285712.534882,"priority":"Normal","status_category":"Done","pull_request":7194},{"issue_id":"288130","title":"`puppet device` does not load local plugins for --apply --facts and --resource","url":"https://tickets.puppetlabs.com/browse/PUP-9356","created_at":"2018-12-11T03:22:09.000-0800","number":"PUP-9356","body":"The changes in PUP-8766 (https://github.com/puppetlabs/puppet/pull/7242) removed plugin loading from a local environment for `puppet device`, even in the cases where local content is supposed to be used.\r\n\r\nThe issue was detected in Resource API acceptance testing yesterday after the merge-up from 5.5.x to 6.0.x. The fix should be trivially mergeable to 6.0.x and beyond.","closed_at":"2018-12-19T06:21:53.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9356","labels":"","state":"Closed","updated_at":"2018-12-19T06:21:53.000-0800","timestamp":1652285712.641042,"priority":"Blocker","status_category":"Done","pull_request":7282},{"issue_id":"283096","title":"use-after-free in windows service utils","url":"https://tickets.puppetlabs.com/browse/PUP-9292","created_at":"2018-10-30T11:22:26.000-0700","number":"PUP-9292","body":"The windows service utils have a use-after-free failure in the query functions","closed_at":"2018-12-20T07:40:28.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9292","labels":"","state":"Closed","updated_at":"2018-12-20T07:40:28.000-0800","timestamp":1652285712.849196,"priority":"Normal","status_category":"Done","pull_request":7214},{"issue_id":"279612","title":"Crontab gets erased after error during agent run","url":"https://tickets.puppetlabs.com/browse/PUP-9217","created_at":"2018-10-09T13:51:48.000-0700","number":"PUP-9217","body":"This is a duplicate of https://tickets.puppetlabs.com/browse/MODULES-7789. It is filed here so that we can track it in the 5.5.x release stream.","closed_at":"2018-12-20T07:40:29.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9217","labels":"","state":"Closed","updated_at":"2018-12-20T07:40:29.000-0800","timestamp":1652285713.058376,"priority":"Major","status_category":"Done","pull_request":7216},{"issue_id":"286192","title":"Array conversion to String using 'short-form' broken","url":"https://tickets.puppetlabs.com/browse/PUP-9329","created_at":"2018-11-22T09:41:43.000-0800","number":"PUP-9329","body":"[https://puppet.com/docs/puppet/5.3/function.html#conversion-to-string]\r\n\r\nand\r\n\r\n[http://puppet-on-the-edge.blogspot.com/2016/05/converting-and-formatting-data-like-pro.html] both have examples of how to get Puppet to format strings when converting from Arrays.\r\n\r\neg.\r\n{code}$str = String([10], \"%(a\") # produces '(\"10\")'\r\n{code}\r\n{code}# Formatting with indentation\r\nString([1, [2, 3], 4], \"%#a\")\r\n# produces:\r\n# [1,\r\n#  [2, 3],\r\n#  4]\r\n{code}\r\nIt appears these examples haven't worked since puppet 4.8 (they work in 4.7.1).\r\n\r\nThe long form still works.\r\n eg\r\n{code}String([1, [2, 3], 4], Array => { format => \"%#a\"})\r\n{code}","closed_at":"2018-12-20T07:40:30.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9329","labels":"resolved-issue-added","state":"Closed","updated_at":"2018-12-20T07:40:30.000-0800","timestamp":1652285713.266324,"priority":"Normal","status_category":"Done","pull_request":7274},{"issue_id":"284716","title":"Timespan and Timestamp types cannot be specified from integer or float","url":"https://tickets.puppetlabs.com/browse/PUP-9310","created_at":"2018-11-12T03:33:32.000-0800","number":"PUP-9310","body":"The data types Timestamp and Timespan are supposed to support specifying the range of time using integer and float values - but there are bugs in the implementation that raises errors for this.","closed_at":"2018-12-20T07:40:30.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9310","labels":"resolved-issue-added","state":"Closed","updated_at":"2018-12-20T07:40:30.000-0800","timestamp":1652285713.475517,"priority":"Normal","status_category":"Done","pull_request":7229},{"issue_id":"68161","title":"update documentation for generate function to clarify possible return values","url":"https://tickets.puppetlabs.com/browse/PUP-9320","created_at":"2015-02-17T08:54:20.000-0800","number":"PUP-9320","body":"the generate function returns the total command output of a command including any meta parameters current wording is not explicit enough, suggested update\r\n\r\nhttps://docs.puppetlabs.com/references/latest/function.html#generate\r\n\r\nCalls an external command on the Puppet master and returns the results of the command. Any arguments are passed to the external command as arguments. If the generator does not exit with return code of 0, the generator is considered to have failed and a parse error is thrown. Generators can only have file separators, alphanumerics, dashes, and periods in them. This function will attempt to protect you from malicious generator calls (e.g., those with ‘..’ in them), but it can never be entirely safe. No subshell is used to execute generators, so all shell metacharacters are passed directly to the generator, and all metacharacters are returned by the function, consider cleaning white space from any string generated.","closed_at":"2018-12-20T07:40:30.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9320","labels":"generated-docs","state":"Closed","updated_at":"2018-12-20T07:40:30.000-0800","timestamp":1652285713.580088,"priority":"Normal","status_category":"Done","pull_request":7245},{"issue_id":"284721","title":"Document auth_membership as being Solaris specific","url":"https://tickets.puppetlabs.com/browse/PUP-9311","created_at":"2018-11-12T04:55:14.000-0800","number":"PUP-9311","body":"Hi,\r\n\r\nWhen managing a user on a Windows 2016 I've used a resource like so:\r\n{noformat} define profiles::windows::account(\r\n  $account_name = $title,\r\n  $password,\r\n  $is_admin,\r\n){\r\n\r\n  if ($is_admin == true){\r\n    $groups = ['Users','Administrators']\r\n  }\r\n  else {\r\n    $groups = ['Users','Remote Desktop Users']\r\n  }\r\n\r\n  user { \"${title}\":\r\n    ensure          => present,\r\n    name            => $title,\r\n    password        => Sensitive($password),\r\n    managehome      => true,\r\n    groups          => $groups,\r\n    auth_membership => 'inclusive',\r\n  }\r\n\r\n} \r\n{noformat}\r\nHowever when I create a user with this and then switch is_admin to false puppet adds the remote desktop group but doesn't remove the administrators group.\r\n\r\nNotice: /Stage[main]/Profiles::Windows::Accounts/Profiles::Windows::Account[test_user]/User[test_user]/groups: groups changed BUILTIN\\Administrators,BUILTIN\\Users to ['BUILTIN\\Administrators', 'BUILTIN\\Users', 'BUILTIN\\Remote Desktop Users']\r\n\r\nFrom [the docs|https://puppet.com/docs/puppet/5.0/resources_user_group_windows.html] the inclusive auth_membership should remove the user from the group?\r\n\r\nPuppet agent version: 5.5.6\r\n\r\nPuppet server version: 5.3.1 running on CentOs 7.","closed_at":"2018-12-20T10:57:59.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9311","labels":"","state":"Closed","updated_at":"2018-12-20T10:57:59.000-0800","timestamp":1652285713.689299,"priority":"Normal","status_category":"Done","pull_request":7234},{"issue_id":"104823","title":"Puppet does not apply inheritable SYSTEM permissions to directories it manages on Windows under certain circumstances","url":"https://tickets.puppetlabs.com/browse/PUP-5480","created_at":"2015-11-06T16:55:38.000-0800","number":"PUP-5480","body":"To address https://projects.puppetlabs.com/issues/15559,  https://github.com/puppetlabs/puppet/commit/b578ed48ac9585edb86b296e99f8aeeecc02fb4e was added so that in the cases where an owner / group / mode were specified that did not include {{SYSTEM}}, Puppet would re-add {{SYSTEM}} permissions.  Since there is generally no reason to remove {{SYSTEM}} permissions, the previous behavior was problematic as it could prevent services (like Puppet itself) from accessing files and directories.\r\n\r\nThis was handled by setting {{NT AUTHORITY\\SYSTEM:(F)}} on files and directories.\r\n\r\nHowever, this approach was subtly flawed, when files or directories are written to a directory that had {{SYSTEM}} permissions re-added by Puppet.  Since inheritance is not set with the re-added permissions, these new children would no longer have an ACE for {{NT AUTHORITY\\SYSTEM:(F)}}.  The solution here is to ensure that the {{SYSTEM}} ace is instead set like {{NT AUTHORITY\\SYSTEM:(F)(CI)(OI)}}.  This allows the {{SYSTEM}} permission to propagate to any newly created files or directories within the parent managed directory, by turning on container inheritance (for directories) and object inheritance (for files).\r\n\r\nAs it turns out, Puppet itself is affected by this flaw on the first run that it writes an agent's private key, public key and the ca cert when the agent is not run as {{SYSTEM}} (which is the case during acceptance tests that run as {{cygsrv}} or {{Administrator}}). With debug logging on, the settings catalog, which explicitly sets permissions on these files (via    https://github.com/puppetlabs/puppet/blob/master/lib/puppet/defaults.rb#L709-L759), can be observed making changes to re-add missing {{SYSTEM}} permissions on the next Puppet run like:\r\n\r\n{code}\r\n[Debug: /File[C:/ProgramData/PuppetLabs/puppet/etc/ssl/private_keys/lmugyz1yds193au.delivery.puppetlabs.net.pem]/mode: mode changed '4000640' to '0640'\r\n[Debug: /File[C:/ProgramData/PuppetLabs/puppet/etc/ssl/public_keys/lmugyz1yds193au.delivery.puppetlabs.net.pem]/mode: mode changed '4000640' to '0644'\r\n[Debug: /File[C:/ProgramData/PuppetLabs/puppet/etc/ssl/certs/ca.pem]/mode: mode changed '4000640' to '0644'\r\n{code}\r\n\r\nAnother affected area is the {{cache/client_data/catalog dir}} (client_datadir).  Heavy-handed approaches have been employed like the one at https://github.com/puppetlabs/marionette-collective/blob/master/acceptance/tests/mco_puppet_powershell.rb#L77-L94 that remove the unmanaged directory written by {{cygsrv}} (and lacking {{SYSTEM}} permissions), so that a subsequent service run may recreate directories with appropriate permissions.","closed_at":"2018-12-26T11:27:10.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5480","labels":"","state":"Closed","updated_at":"2018-12-26T11:27:10.000-0800","timestamp":1652285714.737535,"priority":"Critical","status_category":"Done","pull_request":4423},{"issue_id":"283168","title":"read_wide_string hides errors if the string is nil","url":"https://tickets.puppetlabs.com/browse/PUP-9293","created_at":"2018-10-30T15:27:53.000-0700","number":"PUP-9293","body":"*Puppet Version:* 5.5.2 (PE 2018.1.2 Master & Agent)\r\n *Puppet Server Version:* N/A\r\n *OS Name/Version:* Windows Server 2012r2\r\n\r\nAs part of [https://puppetlabs.zendesk.com/agent/tickets/32364] it was found that there was a bug in the error handler in the read_wide_string method ([https://github.com/puppetlabs/puppet/blob/master/lib/puppet/util/windows/api_types.rb#L56-L63])\r\n\r\nWhere if {{str}} is nil then an error is raised during the debug statement and raises the wrong error. Instead the Puppet.debug statement should never error and raise the real error","closed_at":"2019-01-11T08:34:51.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9293","labels":"","state":"Closed","updated_at":"2019-01-11T08:34:51.000-0800","timestamp":1652285724.541084,"priority":"Normal","status_category":"Done","pull_request":7243},{"issue_id":"285382","title":"Backport PUP-8002 to 5.5.x (\"Attempt to redefine entity\")","url":"https://tickets.puppetlabs.com/browse/PUP-9317","created_at":"2018-11-16T02:44:46.000-0800","number":"PUP-9317","body":"In PUP-8002 a fix was provided for a problem where the error \"Attempt to redefine entity\" is raised in error.\r\n\r\nThis change is wanted for 5.5.x as well. This ticket is for backporting the fix for 6.1.0 to 5.5.x.","closed_at":"2019-01-11T08:35:44.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9317","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-01-11T08:35:44.000-0800","timestamp":1652285724.64573,"priority":"Normal","status_category":"Done","pull_request":7241},{"issue_id":"287496","title":"Failing spec test in puppet travis testing","url":"https://tickets.puppetlabs.com/browse/PUP-9340","created_at":"2018-12-05T10:19:56.000-0800","number":"PUP-9340","body":"example job: https://travis-ci.org/puppetlabs/puppet/jobs/463959473\r\n\r\nfailure:\r\n\r\n{code}\r\n  1) Puppet::Indirector::Yaml when searching should return an array of fact instances with one instance for each file when globbing *\r\n     Failure/Error: expect(terminus.search(request)).to eq([one, two])\r\n       expected: [{\"name\"=>\"one\", \"values\"=>{\"foo\"=>\"bar\"}}, {\"name\"=>\"two\", \"values\"=>{\"foo\"=>\"baz\"}}]\r\n            got: [{\"name\"=>\"two\", \"values\"=>{\"foo\"=>\"baz\"}}, {\"name\"=>\"one\", \"values\"=>{\"foo\"=>\"bar\"}}]\r\n       (compared using ==)\r\n       Diff:\r\n       @@ -1,3 +1,3 @@\r\n       -[{\"name\"=>\"one\", \"values\"=>{\"foo\"=>\"bar\"}},\r\n       - {\"name\"=>\"two\", \"values\"=>{\"foo\"=>\"baz\"}}]\r\n       +[{\"name\"=>\"two\", \"values\"=>{\"foo\"=>\"baz\"}},\r\n       + {\"name\"=>\"one\", \"values\"=>{\"foo\"=>\"bar\"}}]\r\n     # ./spec/unit/indirector/yaml_spec.rb:144:in `block (3 levels) in <top (required)>'\r\n     # util/rspec_runner:44:in `run'\r\n     # util/rspec_runner:59:in `<main>'\r\nFinished in 11.11 seconds (files took 3.28 seconds to load)\r\n{code}\r\n\r\nThe failure is unrelated to any changes in the PR that it was tested against, the test seems pretty fragile.","closed_at":"2019-01-11T08:36:39.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9340","labels":"","state":"Closed","updated_at":"2019-01-11T08:36:39.000-0800","timestamp":1652285724.95737,"priority":"Normal","status_category":"Done","pull_request":7273},{"issue_id":"24924","title":"Puppet::Util::Log requires a message","url":"https://tickets.puppetlabs.com/browse/PUP-1542","created_at":"2014-01-29T14:05:59.000-0800","number":"PUP-1542","body":"When trying to add holdable support to the yum package provider under PUP-958, the following error is being thrown when attempting to catch an exception invoking 'provider.hold'. \r\n\r\n{noformat}\r\n$ sudo bundle exec puppet resource package bash ensure=held --trace\r\nError: /Package[bash]: Could not evaluate: Puppet::Util::Log requires a message\r\n/mnt/data/Puppet/lib/puppet/util/log.rb:298:in `message='\r\n/mnt/data/Puppet/lib/puppet/util/log.rb:247:in `initialize'\r\n/mnt/data/Puppet/lib/puppet/util/log.rb:84:in `new'\r\n/mnt/data/Puppet/lib/puppet/util/log.rb:84:in `create'\r\n/mnt/data/Puppet/lib/puppet/util/logging.rb:8:in `send_log'\r\n/mnt/data/Puppet/lib/puppet/transaction/event.rb:78:in `send_log'\r\n/mnt/data/Puppet/lib/puppet/transaction/resource_harness.rb:154:in `ensure in sync_if_needed'\r\n/mnt/data/Puppet/lib/puppet/transaction/resource_harness.rb:155:in `sync_if_needed'\r\n/mnt/data/Puppet/lib/puppet/transaction/resource_harness.rb:107:in `manage_via_ensure_if_possible'\r\n/mnt/data/Puppet/lib/puppet/transaction/resource_harness.rb:77:in `perform_changes'\r\n/mnt/data/Puppet/lib/puppet/transaction/resource_harness.rb:18:in `evaluate'\r\n/mnt/data/Puppet/lib/puppet/transaction.rb:174:in `apply'\r\n/mnt/data/Puppet/lib/puppet/transaction.rb:187:in `eval_resource'\r\n/mnt/data/Puppet/lib/puppet/transaction.rb:117:in `call'\r\n/mnt/data/Puppet/lib/puppet/transaction.rb:117:in `block (2 levels) in evaluate'\r\n/mnt/data/Puppet/lib/puppet/util.rb:327:in `block in thinmark'\r\n/usr/share/ruby/benchmark.rb:296:in `realtime'\r\n/mnt/data/Puppet/lib/puppet/util.rb:326:in `thinmark'\r\n/mnt/data/Puppet/lib/puppet/transaction.rb:117:in `block in evaluate'\r\n/mnt/data/Puppet/lib/puppet/graph/relationship_graph.rb:118:in `traverse'\r\n/mnt/data/Puppet/lib/puppet/transaction.rb:108:in `evaluate'\r\n/mnt/data/Puppet/lib/puppet/resource/catalog.rb:164:in `block in apply'\r\n/mnt/data/Puppet/lib/puppet/util/log.rb:153:in `with_destination'\r\n/mnt/data/Puppet/lib/puppet/transaction/report.rb:107:in `as_logging_destination'\r\n/mnt/data/Puppet/lib/puppet/resource/catalog.rb:163:in `apply'\r\n/mnt/data/Puppet/lib/puppet/indirector/resource/ral.rb:41:in `save'\r\n/mnt/data/Puppet/lib/puppet/indirector/indirection.rb:283:in `save'\r\n/mnt/data/Puppet/lib/puppet/application/resource.rb:219:in `find_or_save_resources'\r\n/mnt/data/Puppet/lib/puppet/application/resource.rb:143:in `main'\r\n/mnt/data/Puppet/lib/puppet/application.rb:376:in `run_command'\r\n/mnt/data/Puppet/lib/puppet/application.rb:367:in `block (3 levels) in run'\r\n/mnt/data/Puppet/lib/puppet/application.rb:474:in `plugin_hook'\r\n/mnt/data/Puppet/lib/puppet/application.rb:367:in `block (2 levels) in run'\r\n/mnt/data/Puppet/lib/puppet/util.rb:479:in `exit_on_fail'\r\n/mnt/data/Puppet/lib/puppet/application.rb:367:in `block in run'\r\n/mnt/data/Puppet/lib/puppet/context.rb:51:in `override'\r\n/mnt/data/Puppet/lib/puppet.rb:224:in `override'\r\n/mnt/data/Puppet/lib/puppet/application.rb:357:in `run'\r\n/mnt/data/Puppet/lib/puppet/util/command_line.rb:137:in `run'\r\n/mnt/data/Puppet/lib/puppet/util/command_line.rb:91:in `execute'\r\n/mnt/data/Puppet/bin/puppet:4:in `<top (required)>'\r\n/usr/local/share/gems/bin/puppet:23:in `load'\r\n/usr/local/share/gems/bin/puppet:23:in `<main>'\r\npackage { 'bash':\r\n  ensure => '4.2.45-1.fc19',\r\n}\r\n{noformat}\r\n\r\nThis is with the following patch applied:\r\nEdit: Added patch as attachment as formatting was breaking it. ","closed_at":"2019-01-15T12:56:26.000-0800","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1542","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-01-15T12:56:26.000-0800","timestamp":1652285726.921909,"priority":"Normal","status_category":"Done","pull_request":7225},{"issue_id":"290583","title":"Puppet agent 6 ignores srv_domain config","url":"https://tickets.puppetlabs.com/browse/PUP-9399","created_at":"2019-01-05T00:20:26.000-0800","number":"PUP-9399","body":"*Puppet Version: 6.1* \r\n *Puppet Server Version: 6.1*\r\n *OS Name/Version: Debian Stretch*\r\n\r\n*Desired Behavior:* \r\n\r\npuppet agent uses _srv_domain_ to resolve master from the domains srv record\r\n\r\n*Actual Behavior:*\r\n\r\nthe puppet agent ignores the srv_domain config in /etc/puppetlabs/puppet/puppet.conf\r\n\r\nusing the same config file with 5.5.8-1stretch is working fine.\r\n\r\nconfig set via:\r\n{code:java}/opt/puppetlabs/bin/puppet config set use_srv_records true\r\n/opt/puppetlabs/bin/puppet config set srv_domain idling.host{code}\r\nDebug log (puppet 6.1) => full log attached\r\n{code:java}Debug: Finishing transaction 47206392905540\r\nDebug: Runtime environment: puppet_version=6.1.0, ruby_version=2.5.3, run_mode=agent, default_encoding=UTF-8\r\nDebug: Dynamically-bound server lookup failed, falling back to ca_server setting\r\nDebug: Dynamically-bound port lookup failed; falling back to ca_port setting\r\nDebug: Searching for SRV records for domain: ca\r\nDebug: Found 0 SRV records for: _x-puppet._tcp.ca\r\nDebug: No more servers in SRV record, falling back to puppet:8140\r\nDebug: Creating new connection for https://puppet:8140\r\n{code}\r\nDebug log (puppet 5.5) => full log attached \r\n{code:java}Debug: Dynamically-bound server lookup failed, falling back to ca_server setting\r\nDebug: Dynamically-bound port lookup failed; falling back to ca_port setting\r\nDebug: Searching for SRV records for domain: idling.host\r\nDebug: Found 1 SRV records for: _x-puppet-ca._tcp.idling.host\r\nDebug: Yielding next server of master-a.idling.host:8140\r\nDebug: Dynamically-bound server lookup failed, falling back to ca_server setting\r\nDebug: Dynamically-bound port lookup failed; falling back to ca_port setting\r\nDebug: Searching for SRV records for domain: idling.host\r\nDebug: Found 1 SRV records for: _x-puppet-ca._tcp.idling.host\r\nDebug: Yielding next server of master-a.idling.host:8140\r\nDebug: Creating new connection for https://master-a.idling.host:8140\r\n{code}\r\nConfig file:\r\n{code:java}cat /etc/puppetlabs/puppet/puppet.conf \r\n[main]\r\nuse_srv_records = true\r\nsrv_domain = idling.host\r\n[agent]\r\nenvironment = setupscript\r\n{code}","closed_at":"2019-01-15T13:19:06.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9399","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-01-15T13:19:06.000-0800","timestamp":1652285727.030214,"priority":"Critical","status_category":"Done","pull_request":7327},{"issue_id":"274401","title":"Text Fragmentation: Incomplete phrases in string resources","url":"https://tickets.puppetlabs.com/browse/PUP-9392","created_at":"2018-09-05T13:48:54.000-0700","number":"PUP-9392","body":"Each String Resource should contain a complete phrase so that it can be localized.\r\n\r\nReviewing `puppet.pot` in Transifex (Localization Tool) reveals the following Text Fragmentation:\r\n{noformat}one of %{expected) are{noformat}\r\n{noformat}%{expected} is{noformat}\r\n \r\n\r\n*BAD_SLICE_KEY_TYPE*\r\n\r\n \r\n\r\nContent Source:\r\n * [https://github.com/puppetlabs/puppet/blob/master/locales/puppet.pot#L5096]\r\n * [https://github.com/puppetlabs/puppet/blob/master/locales/puppet.pot#L5100]\r\n\r\nPoint of Usage:\r\n * [https://github.com/puppetlabs/puppet/blob/master/lib/puppet/pops/issues.rb#L433]\r\n\r\n ","closed_at":"2019-01-25T08:12:22.000-0800","comments":29,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9392","labels":"i18n;l10n","state":"Closed","updated_at":"2019-01-25T08:12:22.000-0800","timestamp":1652285728.796637,"priority":"Normal","status_category":"Done","pull_request":7336},{"issue_id":"271574","title":"portage package provider does not respect package versions","url":"https://tickets.puppetlabs.com/browse/PUP-9071","created_at":"2018-08-16T07:05:26.000-0700","number":"PUP-9071","body":"The portage package provider does not respect versioning of packages, so one can't define specific versions of packages to install via puppet agent.\r\n\r\nAs a result, on every run the puppet agent tries to install a specific version when another not defined version is installed, but effectively does only ensure that the package is installed via \r\n{code:java}\r\nemerge example/package\r\n{code}\r\nDesired should be that the agent installs the defined version via \r\n{code:java}\r\nemerge =example/package-1.2.3-r4{code}","closed_at":"2019-01-25T08:12:23.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9071","labels":"gentoo;linux;package;resolved-issue-added;type_and_provider","state":"Closed","updated_at":"2019-01-25T08:12:23.000-0800","timestamp":1652285728.900282,"priority":"Normal","status_category":"Done","pull_request":7005},{"issue_id":"274737","title":":undef still shows up in types and providers","url":"https://tickets.puppetlabs.com/browse/PUP-9112","created_at":"2018-09-06T16:16:34.000-0700","number":"PUP-9112","body":"*Puppet Version:* 5.5.6\r\n *Puppet Server Version:* N/A\r\n *OS Name/Version:* Centos 7, same on Windows 10\r\n\r\nPer the discussion in PUP-1467, all Ruby code in Types and Providers is supposed to receive {{undef}} values as {{nil}}. However, in at least some circumstances, I am receiving the Symbol {{:undef}} instead.\r\n\r\nFor example, given the following resource declaration:\r\n\r\n \r\n{code:java}foo { 'bar':\r\n  baz => {\r\n    quux => undef,\r\n  },\r\n}\r\n{code}\r\n \r\n\r\n*Desired Behavior:*\r\n\r\nInside the provider, {{resource[:baz]}} evaluates to {{\\{'quux' => nil\\}}}\r\n\r\n*Actual Behavior:*\r\n\r\nInside the provider, {{resource[:baz]}} evaluates to {{\\{'quux' => :undef\\}}}\r\n\r\n*Additional Context*\r\n\r\nBesides behaving contrary to the discussions in PUP-1467 (which is the closest I could find to documentation on {{:undef}} vs {{nil}}, this is also problematic when the provider is constructing JSON, perhaps to communicate with an API; the desired JSON string would be {{\\{\"quux\": null\\}}}, but instead you end up with {{\\{\"quux\": \"undef\"\\}}}.","closed_at":"2019-01-29T14:51:07.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9112","labels":"","state":"Closed","updated_at":"2019-01-29T14:51:07.000-0800","timestamp":1652285729.313259,"priority":"Minor","status_category":"Done","pull_request":7056},{"issue_id":"289056","title":"puppet module install is really slow","url":"https://tickets.puppetlabs.com/browse/PUP-9364","created_at":"2018-12-15T06:55:48.000-0800","number":"PUP-9364","body":"*Puppet Version: 6.0.4*\r\n *Puppet Server Version: -*\r\n *OS Name/Version: Mac OS 10.14.1 (Probably all?)*\r\n\r\nWhen running a lot of beaker tests, i realized that most time is used by `puppet module install ...` commands.\r\n\r\n*Desired Behavior:*\r\n\r\nFast installation of module by using puppet module install ...\r\n\r\n*Actual Behavior:*\r\n{code:java} $ ls -la modules/\r\ntotal 0\r\ndrwxr-xr-x   2 mbaur staff   64 Dec 15 15:37 .\r\ndrwxr-xr-x+ 76 mbaur staff 2432 Dec 15 15:37 ..\r\nmbaur(2018-12-15 15:37:26)  ~\r\n$ time puppet module install puppetlabs-firewall -v 1.14.0 --modulepath $HOME/modules/\r\nNotice: Preparing to install into /Users/mbaur/modules ...\r\nNotice: Downloading from https://forgeapi.puppet.com ...\r\nNotice: Installing -- do not interrupt ...\r\n/Users/mbaur/modules\r\n└─┬ puppetlabs-firewall (v1.14.0)\r\n  └── puppetlabs-stdlib (v5.1.0)real\t0m26.044s\r\nuser\t0m2.615s\r\nsys\t0m1.211s{code}\r\n \r\n\r\nI think the biggest problem is, that the command posted above makes 8 API calls to forgeapi.puppet.com which just take way to long:\r\n\r\n\r\n{code:java}\r\n$ puppet module install puppetlabs-firewall -v 1.14.0 --modulepath $HOME/modules/ --debug | grep forgeapi\r\nNotice: Downloading from https://forgeapi.puppet.com ...\r\nDebug: HTTP GET https://forgeapi.puppet.com/v3/releases?module=puppetlabs-firewall&sort_by=version\r\nDebug: HTTP GET https://forgeapi.puppet.com/v3/releases?module=puppetlabs-firewall&sort_by=version&limit=20&offset=20\r\nDebug: HTTP GET https://forgeapi.puppet.com/v3/releases?module=puppetlabs-stdlib&sort_by=version\r\nDebug: HTTP GET https://forgeapi.puppet.com/v3/releases?module=puppetlabs-stdlib&sort_by=version&limit=20&offset=20\r\nDebug: HTTP GET https://forgeapi.puppet.com/v3/releases?module=puppetlabs-stdlib&sort_by=version&limit=20&offset=40\r\nDebug: HTTP GET https://forgeapi.puppet.com/v3/releases?module=puppetlabs-stdlib&sort_by=version&limit=20&offset=60\r\nDebug: HTTP GET https://forgeapi.puppet.com/v3/files/puppetlabs-firewall-1.14.0.tar.gz\r\nDebug: HTTP GET https://forgeapi.puppet.com/v3/files/puppetlabs-stdlib-5.1.0.tar.gz\r\n{code}\r\nI tried to measure the data which gets transfer:\r\n{code:java}\r\nhttps://forgeapi.puppet.com/v3/releases?module=puppetlabs-firewall&sort_by=version -> 1.4M\r\nhttps://forgeapi.puppet.com/v3/releases?module=puppetlabs-firewall&sort_by=version&limit=20&offset=20 -> 621K\r\nhttps://forgeapi.puppet.com/v3/releases?module=puppetlabs-stdlib&sort_by=version -> 2.4M\r\nhttps://forgeapi.puppet.com/v3/releases?module=puppetlabs-stdlib&sort_by=version&limit=20&offset=20 -> 1.1M\r\nhttps://forgeapi.puppet.com/v3/releases?module=puppetlabs-stdlib&sort_by=version&limit=20&offset=40 -> 496K\r\nhttps://forgeapi.puppet.com/v3/releases?module=puppetlabs-stdlib&sort_by=version&limit=20&offset=60 -> 10K\r\nhttps://forgeapi.puppet.com/v3/files/puppetlabs-firewall-1.14.0.tar.gz -> 121K\r\nhttps://forgeapi.puppet.com/v3/files/puppetlabs-stdlib-5.1.0.tar.gz -> 242K\r\n\r\nComplete: 6.3M\r\n{code}\r\nI think there is just way to much data which we need to retrieve for every module.","closed_at":"2019-02-07T02:42:06.000-0800","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9364","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-02-07T02:42:06.000-0800","timestamp":1652285729.623272,"priority":"Normal","status_category":"Done","pull_request":7309},{"issue_id":"295084","title":"Unable to use call() on custom functions","url":"https://tickets.puppetlabs.com/browse/PUP-9477","created_at":"2019-02-06T02:35:45.000-0800","number":"PUP-9477","body":"Using custom functions, I'm unable to call them using the call() function.\r\n\r\nTest case:\r\n modules/call_me/functions/pfunction.pp\r\n{code:puppet}function call_me::pfunction(\r\n Optional[String] $args = undef\r\n) {\r\n \"returned from pfunction\"\r\n}\r\n{code}\r\ntest.pp;\r\n{code:puppet}  $message = call_me::pfunction()\r\n  notify {'direct function call': message => $message, }\r\n\r\n\r\n  $deferred = Deferred('call_me::pfunction')\r\n  $message3 = $deferred.call()\r\n  notify {'deferred, function name hardcoded': message => $message3, }  \r\n\r\n\r\n  $function_name = 'call_me::pfunction'\r\n  $deferred2 = Deferred($function_name)\r\n  $message4 = $deferred2.call()\r\n  notify {'deferred, function name in variable': message => $message4, }\r\n{code}\r\noutput:\r\n{code} Info: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Caching catalog for cyberflox.irken.org\r\nInfo: Applying configuration version '1549449374'\r\nNotice: returned from pfunction\r\nNotice: /Stage[main]/Main/Node[default]/Notify[direct function call]/message: defined 'message' as 'returned from pfunction'\r\nNotice: returned from pfunction\r\nNotice: /Stage[main]/Main/Node[default]/Notify[deferred, function name hardcoded]/message: defined 'message' as 'returned from pfunction'\r\nNotice: returned from pfunction\r\nNotice: /Stage[main]/Main/Node[default]/Notify[deferred, function name in variable]/message: defined 'message' as 'returned from pfunction'\r\nNotice: Applied catalog in 0.02 seconds\r\n{code}\r\n\r\ncode that fails:\r\n\r\n{code}\r\n# THIS BLOCK FAILS\r\n$message2 = call('call_me::pfunction')\r\nnotify{'call(call_me::pfunction)': message => $message2, }\r\n{code}\r\noutput:\r\n{code}\r\nError: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Function Call, Function call(): Unknown function: 'call_me::pfunction' (file: /etc/puppetlabs/code/environments/production/manifests/site.pp, line: 9, column: 15) on node cyberflox.irken.org\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\n{code}","closed_at":"2019-02-20T11:51:30.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9477","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-02-20T11:51:30.000-0800","timestamp":1652285732.766638,"priority":"Normal","status_category":"Done","pull_request":7383},{"issue_id":"278608","title":"REGRESSION exec cwd is not respected for unless or onlyif commands in 6.0.1","url":"https://tickets.puppetlabs.com/browse/PUP-9194","created_at":"2018-10-03T01:24:53.000-0700","number":"PUP-9194","body":"Since 6.0.1 there is a pretty severe regression which makes unless & onlyif of the exec resource not respecting the specified cwd.\r\n\r\nHere is the (shortened output of a run in 6.0.0:\r\n\r\n \r\n{code:java}\r\n$ puppet apply --debug <<EOF\r\nexec{'/usr/bin/pwd':\r\n  onlyif    => '/usr/bin/pwd',\r\n  cwd       => '/tmp',\r\n  logoutput => true,\r\n}\r\nEOF\r\nDebug: Runtime environment: puppet_version=6.0.0, ruby_version=2.5.1, run_mode=user, default_encoding=UTF-8\r\n\r\n[...]\r\n\r\nInfo: Applying configuration version '1538554714'\r\nDebug: Exec[/usr/bin/pwd](provider=posix): Executing check '/usr/bin/pwd'\r\nDebug: Executing: '/usr/bin/pwd'\r\nDebug: /Stage[main]/Main/Exec[/usr/bin/pwd]/onlyif: /tmp\r\nDebug: Exec[/usr/bin/pwd](provider=posix): Executing '/usr/bin/pwd'\r\nDebug: Executing: '/usr/bin/pwd'\r\nNotice: /Stage[main]/Main/Exec[/usr/bin/pwd]/returns: /tmp\r\nNotice: /Stage[main]/Main/Exec[/usr/bin/pwd]/returns: executed successfully\r\nDebug: /Stage[main]/Main/Exec[/usr/bin/pwd]: The container Class[Main] will propagate my refresh event{code}\r\n \r\n\r\nWhile this is the output from a 6.0.1 run:\r\n{code:java}\r\n\r\n $puppet apply --debug <<EOF\r\n> exec{'/usr/bin/pwd':\r\n>   onlyif    => '/usr/bin/pwd',\r\n>   cwd       => '/tmp',\r\n>   logoutput => true,\r\n> }\r\n> EOF\r\nDebug: Runtime environment: puppet_version=6.0.1, ruby_version=2.5.1, run_mode=user, default_encoding=UTF-8\r\n\r\n[...]\r\n\r\nDebug: Exec[/usr/bin/pwd](provider=posix): Executing check '/usr/bin/pwd'\r\nDebug: Executing: '/usr/bin/pwd'\r\nDebug: /Stage[main]/Main/Exec[/usr/bin/pwd]/onlyif: /root\r\nDebug: Exec[/usr/bin/pwd](provider=posix): Executing '/usr/bin/pwd'\r\nDebug: Executing: '/usr/bin/pwd'\r\nNotice: /Stage[main]/Main/Exec[/usr/bin/pwd]/returns: /tmp\r\nNotice: /Stage[main]/Main/Exec[/usr/bin/pwd]/returns: executed successfully\r\nDebug: /Stage[main]/Main/Exec[/usr/bin/pwd]: The container Class[Main] will propagate my refresh event\r\n{code}\r\n \r\n\r\nThis is a pretty severe Regression as it breaks tons of existing execs, which might even trigger unwanted commands, as the safeguards are not working anymore.","closed_at":"2019-02-22T10:31:55.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9194","labels":"regression","state":"Closed","updated_at":"2019-02-22T10:31:55.000-0800","timestamp":1652285733.284756,"priority":"Blocker","status_category":"Done","pull_request":7138},{"issue_id":"293659","title":"Type validation fails when there is no type - needs human-readable error message","url":"https://tickets.puppetlabs.com/browse/PUP-9467","created_at":"2019-01-28T10:35:47.000-0800","number":"PUP-9467","body":"A class with an optional parameter with no type that defaults to undef isn't handled well by /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/types/type_mismatch_describer.rb\r\n\r\nFor example if I have a class:\r\n{code:java}class test::validation (\r\n Optional $whatever = undef\r\n){\r\nnotice($whatever)\r\n \r\n}\r\n{code}\r\nand in hiera:\r\n{noformat}test::validation::whatever: 1234{noformat}\r\nApplying the class to an agent results in the stack trace I've attached here.\r\n\r\n ","closed_at":"2019-03-14T06:22:22.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9467","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-03-14T06:22:22.000-0700","timestamp":1652285734.106699,"priority":"Normal","status_category":"Done","pull_request":7379},{"issue_id":"267161","title":"Filebucket resources fail when using server_list","url":"https://tickets.puppetlabs.com/browse/PUP-9025","created_at":"2018-07-30T10:33:18.000-0700","number":"PUP-9025","body":"*Puppet Version:* \r\npuppet --version\r\n5.5.2\r\n\r\nFrom [~vchepkov]:\r\n\r\nIt (PUP-6823) might have fixed filebucket command, but not filebucket resource\r\nwith server setting removed as recommended here in step 4\r\nhttps://puppet.com/docs/pe/2018.1/configure_high_availability.html#enable-a-replica\r\n\r\n{noformat}\r\nError: Could not back up /etc/cron.d/yum-update: Failed to open TCP connection to puppet:8140 (getaddrinfo: Name or service not known)\r\nError: Could not back up /etc/cron.d/yum-update: Failed to open TCP connection to puppet:8140 (getaddrinfo: Name or service not known)\r\n{noformat}","closed_at":"2019-03-26T17:19:11.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9025","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-03-26T17:19:11.000-0700","timestamp":1652285745.705209,"priority":"Normal","status_category":"Done","pull_request":7384},{"issue_id":"206346","title":"Puppet agent should not fall back to puppet:0 when servers in server_list are unreachable","url":"https://tickets.puppetlabs.com/browse/PUP-9076","created_at":"2017-08-17T11:57:37.000-0700","number":"PUP-9076","body":"Repro steps:\r\n* Install a puppet master\r\n* Remove 'server' setting from puppet.conf\r\n* Add 'server_list' setting to 'puppet.conf' with the master hostname and a port that is unreachable - {hostname}:6666\r\n* Run puppet agent -t --debug\r\n\r\nResult:\r\n* You see the following in stdout:\r\n\r\n{code:java}\r\nDebug: Creating new connection for https://rjvrvpaz5nkmddc.delivery.puppetlabs.net:6666\r\nDebug: Using cached certificate_revocation_list for ca\r\nDebug: Starting connection for https://rjvrvpaz5nkmddc.delivery.puppetlabs.net:6666\r\nWarning: Could not select a functional puppet master\r\nDebug: Failed to load library 'msgpack' for feature 'msgpack': cannot load such file -- msgpack\r\nDebug: Puppet::Network::Format[msgpack]: feature msgpack is missing\r\nDebug: node supports formats: json pson yaml\r\nDebug: Creating new connection for *https://puppet:0*\r\nDebug: Starting connection for *https://puppet:0*\r\n{code}\r\n\r\nTrying to run against https://puppet:0 takes a while to time out due to TCP timeout (since DNS lookup fails).  Also, not sure of the impact but someone could potentially set up a server named puppet on the network and intercept all requests intended for the master in the case where the master is unavailable.\r\n\r\nExpected:\r\nWe should not be falling back to puppet:0","closed_at":"2019-03-26T17:19:11.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9076","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-03-26T17:19:11.000-0700","timestamp":1652285745.809473,"priority":"Normal","status_category":"Done","pull_request":7420},{"issue_id":"291639","title":"Windows - Group resource member parameter outputs an array of SID's instead of Names","url":"https://tickets.puppetlabs.com/browse/PUP-9435","created_at":"2019-01-11T11:52:30.000-0800","number":"PUP-9435","body":"*Puppet Version: 5.5.8 (PE 2018.1.5)*\r\n *Puppet Server Version: 5.3.6*\r\n *OS Name/Version: Windows 2019*\r\n\r\nThis ticket has arisen from a support case where the customer had noticed that a custom fact of theirs that used the group resource parameter member no longer worked after upgrading from PE 2018.1.3 to 2018.1.5.\r\n\r\nAfter a quick repro and speaking with some of the devs, this looks like a regression issue. In 2018.1.3, member outputs names and in 2018.1.5 SID's were outputted:\r\n\r\n2018.1.3 (Puppet 5.5.3) Group resource:\r\n{code:java}\r\ngroup { 'Users':\r\n  ensure  => 'present',\r\n  gid     => 'S-1-5-32-545',\r\n  members => ['NT AUTHORITY\\INTERACTIVE', 'NT AUTHORITY\\Authenticated Users', 'PL2U24SBREN5JPS\\sshd', 'PL2U24SBREN5JPS\\cyg_server'],\r\n{code}\r\n2018.1.5 (Puppet 5.5.8) Group resource:\r\n{code:java}\r\ngroup { 'Users':\r\n  ensure  => 'present',\r\n  gid     => 'S-1-5-32-545',\r\n  members => ['S-1-5-4', 'S-1-5-11', 'S-1-5-21-1925060020-2411252292-4197056437-1000', 'S-1-5-21-1925060020-2411252292-4197056437-1001'],\r\n{code}\r\n*Desired Behavior: Output of the Group Member parameter should be an array of Names and not SIDs.*\r\n\r\n*Actual Behavior: Currently an array of SID's is outputted*","closed_at":"2019-03-26T17:19:16.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9435","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-03-26T17:19:16.000-0700","timestamp":1652285746.014719,"priority":"Normal","status_category":"Done","pull_request":7334},{"issue_id":"296232","title":"Add Puppet::FileSystem#replace_file","url":"https://tickets.puppetlabs.com/browse/PUP-9499","created_at":"2019-02-14T13:39:09.000-0800","number":"PUP-9499","body":"Puppet's {{Puppet::Util.replace_file}} predates {{Puppet::FileSystem}}. Now that we have different filesystem implementations (windows, posix, jruby), we should add a {{replace_file}} method and respective implementations. The new version should raise standard Errno exceptions. On Windows specifically, it shouldn't leak Puppet::Util::Windows::Errors, as it forces the caller to have conditional logic as to which exceptions it may need to catch.","closed_at":"2019-03-26T17:24:34.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9499","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-03-26T17:24:34.000-0700","timestamp":1652285746.220489,"priority":"Normal","status_category":"Done","pull_request":7426},{"issue_id":"32897","title":"agent is confused about cert state","url":"https://tickets.puppetlabs.com/browse/PUP-2354","created_at":"2014-04-23T12:39:10.000-0700","number":"PUP-2354","body":"On my master, I set:\r\n\r\n{code}\r\n[main]\r\n  allow_duplicate_certs = true\r\n{code}\r\n\r\non the master, I regenerate a private key, I get the failure:\r\n\r\n{noformat}\r\nroot@cygnet-2:~# puppet agent -t --ssldir=/tmp/\r\ninfo: Creating a new SSL key for cygnet-2.cygnet.lab\r\nwarning: peer certificate won't be verified in this SSL session\r\ninfo: Caching certificate for ca\r\nwarning: peer certificate won't be verified in this SSL session\r\ninfo: Caching certificate for cygnet-2.cygnet.lab\r\nerr: Could not request certificate: The certificate retrieved from the master does not match the agent's private key.\r\nCertificate fingerprint: B5:FE:4C:B6:D8:75:2C:8D:FD:05:48:53:43:DC:B4:10\r\nTo fix this, remove the certificate from both the master and the agent and then start a puppet run, which will automatically regenerate a certficate.\r\nOn the master:\r\n  puppet cert clean cygnet-2.cygnet.lab\r\nOn the agent:\r\n  rm -f /tmp/certs/cygnet-2.cygnet.lab.pem\r\n  puppet agent -t\r\n{noformat}\r\n\r\nIt appears that the agent does not actually resend its cert req if one already exists, meaning that allow duplicate certs does not work with puppet agent.\r\n\r\nThis issue was observed with Puppet 2.7.12, but I do not believe it is a regression.","closed_at":"2019-03-26T17:24:35.000-0700","comments":30,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2354","labels":"redmine;resolved-issue-added","state":"Closed","updated_at":"2019-03-26T17:24:35.000-0700","timestamp":1652285746.637432,"priority":"Critical","status_category":"Done","pull_request":4897},{"issue_id":"259243","title":"Resource status of \"failed_to_restart\" is not included in reports for individual resources","url":"https://tickets.puppetlabs.com/browse/PUP-8908","created_at":"2018-06-06T07:51:51.000-0700","number":"PUP-8908","body":"If, for example, a service resource is notified that it should restart, and fails to do so, we do record this information in the resource status, but only partially expose it in the report.\r\n\r\nA {{failed_to_restart}} count is exposed in the metrics section:\r\n{noformat}\r\nmetrics:\r\n  resources:\r\n    name: resources\r\n    label: Resources\r\n    values:\r\n    - - total\r\n      - Total\r\n      - 10\r\n    - - skipped\r\n      - Skipped\r\n      - 0\r\n    - - failed\r\n      - Failed\r\n      - 0\r\n    - - failed_to_restart\r\n      - Failed to restart\r\n      - 1\r\n    - - restarted\r\n      - Restarted\r\n      - 0\r\n    - - changed\r\n      - Changed\r\n      - 1\r\n    - - out_of_sync\r\n      - Out of sync\r\n      - 1\r\n    - - scheduled\r\n      - Scheduled\r\n      - 0\r\n    - - corrective_change\r\n      - Corrective change\r\n      - 0\r\n{noformat}\r\n\r\nHowever, the individual resource that failed to restart does not have any information to indicate that it was the problem:\r\n{noformat}\r\n  Service[my_service]:\r\n    title: my_service\r\n    file: \"/root/service_restart_failure/manifests/init.pp\"\r\n    line: 30\r\n    resource: Service[my_service]\r\n    resource_type: Service\r\n    provider_used: init\r\n    containment_path:\r\n    - Stage[main]\r\n    - Service_restart_failure\r\n    - Service[my_service]\r\n    evaluation_time: 0.011004225\r\n    tags:\r\n    - service\r\n    - my_service\r\n    - class\r\n    - service_restart_failure\r\n    time: '2018-06-05T10:53:57.237817957-07:00'\r\n    failed: false\r\n    changed: false\r\n    out_of_sync: false\r\n    skipped: false\r\n    change_count: 0\r\n    out_of_sync_count: 0\r\n    events: []\r\n    corrective_change: false\r\n{noformat}","closed_at":"2019-03-28T14:00:06.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8908","labels":"","state":"Closed","updated_at":"2019-03-28T14:00:06.000-0700","timestamp":1652285748.947441,"priority":"Major","status_category":"Done","pull_request":6873},{"issue_id":"287384","title":"Refreshed resources do not get a status event in the report","url":"https://tickets.puppetlabs.com/browse/PUP-9339","created_at":"2018-12-04T15:45:37.000-0800","number":"PUP-9339","body":"Refreshed resources, like reboot or some execs, do not create a status event in the report.\r\n\r\n ","closed_at":"2019-03-28T20:14:47.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9339","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-03-28T20:14:47.000-0700","timestamp":1652285749.056004,"priority":"Normal","status_category":"Done","pull_request":7270},{"issue_id":"174784","title":"Puppet Server uses facts from the previous run (n-1) after agent switches masters","url":"https://tickets.puppetlabs.com/browse/PUP-7198","created_at":"2017-02-09T04:40:49.000-0800","number":"PUP-7198","body":"I couldn't believe that, but I could finally reliably reproduce the problem in minimal sample. I've observed that episodically and believe this is a long standing issue - the reason I do not put Critical to this.\r\n\r\nRuby fact plugin:\r\n{code:ruby}\r\nFacter.add('fact_cache_issue') do\r\n    setcode do\r\n        begin\r\n            File.read('/etc/fact_cache_issue')\r\n        rescue\r\n        end\r\n    end\r\nend\r\n{code}\r\n\r\nPuppet code:\r\n{code:puppet}\r\nclass factcacheissue {\r\n    $value = $::facts['fact_cache_issue'] ? {\r\n        undef   => generate('/usr/bin/openssl', 'rand', '-hex', '8'),\r\n        default => $::facts['fact_cache_issue']\r\n    }\r\n    \r\n    file { '/etc/fact_cache_issue':\r\n        content => $value,\r\n    }\r\n}\r\nnode cacheissue.example.com {\r\n    include factcacheissue\r\n    file {'/etc/puppetlabs/puppet/puppet.conf':\r\n        mode    => '0644',\r\n        content => '\r\n[main]\r\nclient = false\r\ncertname = cacheissue.example.com\r\nserver = puppetback.example.com\r\nca_server = puppet.example.com\r\nenvironment = production\r\nsrv_domain = example.com\r\nuse_srv_records = false\r\n',\r\n    }\r\n}\r\n{code}\r\n\r\n1. Setup puppet-agent 1.9.0 package\r\n2. Run against CA server puppet.example.com\r\n3. During the first initialization, openssl generator is called and puppet server is changed to secondary master (puppetback.example.com)\r\n4. Second run goes to secondary master. Master stores facts PuppetDB, but Master does not see new facts during catalog compilations => calls openssl generator again.\r\n5. Each next run uses fact set from run #n-1 - *that's very weird*, and produces resource value switch to previous run.\r\n6. If puppet server is not switched then everything is correct.\r\n\r\n\r\nCommand line output:\r\n{noformat}\r\nSetting up puppet-agent (1.9.0-1jessie) ...\r\n\r\nConfiguration file '/etc/puppetlabs/puppet/puppet.conf'\r\n ==> File on system created by you or by a script.\r\n ==> File also in package provided by package maintainer.\r\n ==> Using current old file as you requested.\r\nCreated symlink from /etc/systemd/system/multi-user.target.wants/puppet.service to /lib/systemd/system/puppet.service.\r\nCreated symlink from /etc/systemd/system/multi-user.target.wants/mcollective.service to /lib/systemd/system/mcollective.service.\r\nCreated symlink from /etc/systemd/system/multi-user.target.wants/pxp-agent.service to /lib/systemd/system/pxp-agent.service.\r\nRemoved symlink /etc/systemd/system/multi-user.target.wants/pxp-agent.service.\r\n+ PUPPET=/opt/puppetlabs/bin/puppet\r\n+ /opt/puppetlabs/bin/puppet resource service puppet ensure=false enable=false provider=systemd\r\nNotice: /Service[puppet]/enable: enable changed 'true' to 'false'\r\nservice { 'puppet':\r\n  ensure => 'stopped',\r\n  enable => 'false',\r\n}\r\n+ systemctl mask puppet\r\nCreated symlink from /etc/systemd/system/puppet.service to /dev/null.\r\n+ host maint.example.com\r\n+ /opt/puppetlabs/bin/puppet agent --test --trace\r\nInfo: Creating a new SSL key for cacheissue.example.com\r\nInfo: Caching certificate for ca\r\nInfo: csr_attributes file loading from /etc/puppetlabs/puppet/csr_attributes.yaml\r\nInfo: Creating a new SSL certificate request for cacheissue.example.com\r\nInfo: Certificate Request fingerprint (SHA256): DA:8A:E9:2C:01:A4:2B:B4:DA:28:66:89:8D:91:9B:4F:76:DF:62:4F:EA:A5:28:68:03:0B:20:92:03:01:70:01\r\nInfo: Caching certificate for cacheissue.example.com\r\nInfo: Caching certificate_revocation_list for ca\r\nInfo: Caching certificate for ca\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\n< output removed >\r\nNotice: /File[/opt/puppetlabs/puppet/cache/lib/facter/factcacheissue.rb]/ensure: defined content as '{md5}7f09896f9c273cf29c2bb4d0cf21df27'\r\n< output removed >\r\nInfo: Loading facts\r\nInfo: Caching catalog for cacheissue.example.com\r\nInfo: Applying configuration version '1486637068'\r\nNotice: /Stage[main]/Factcacheissue/File[/etc/fact_cache_issue]/ensure: defined content as '{md5}c3623b026f1e4ffaad7bc5f31dce5ddf'\r\nNotice: /Stage[main]/Main/Node[cacheissue.example.com]/File[/etc/puppetlabs/puppet/puppet.conf]/content: \r\n--- /etc/puppetlabs/puppet/puppet.conf  2017-02-09 10:44:08.044000000 +0000\r\n+++ /tmp/puppet-file20170209-954-g8w0cf 2017-02-09 10:44:28.616000000 +0000\r\n@@ -1,6 +1,9 @@\r\n+\r\n [main]\r\n client = false\r\n certname = cacheissue.example.com\r\n-server = puppet.example.com\r\n+server = puppetback.example.com\r\n ca_server = puppet.example.com\r\n environment = production\r\n+srv_domain = example.com\r\n+use_srv_records = false\r\n\r\nInfo: Computing checksum on file /etc/puppetlabs/puppet/puppet.conf\r\nInfo: /Stage[main]/Main/Node[cacheissue.example.com]/File[/etc/puppetlabs/puppet/puppet.conf]: Filebucketed /etc/puppetlabs/puppet/puppet.conf to puppet with sum 3f658fe9074501624c1ec8025cc03016\r\nNotice: /Stage[main]/Main/Node[cacheissue.example.com]/File[/etc/puppetlabs/puppet/puppet.conf]/content: content changed '{md5}3f658fe9074501624c1ec8025cc03016' to '{md5}f48d1f4f1bfcb3d2b2a0678d7433fa04'\r\nNotice: /Stage[main]/Main/Node[cacheissue.example.com]/Service[mcollective]/enable: enable changed 'true' to 'false'\r\nNotice: Applied catalog in 0.12 seconds\r\n+ echo 'Please go to puppetserver and exec the following command when we wait for key'\r\nPlease go to puppetserver and exec the following command when we wait for key\r\n+ echo '> puppet cert sign cacheissue.example.com'\r\n> puppet cert sign cacheissue.example.com\r\n+ echo 'Use CTRL+C to stop cycle, if fails due to different reasons'\r\nUse CTRL+C to stop cycle, if fails due to different reasons\r\n+ sleep 5\r\n+ test -n 1\r\n+ exit 0\r\nConnection to 127.0.0.1 closed.\r\n+ echo 'Provisioning DB VMs'\r\nProvisioning DB VMs\r\n++ seq 1 2\r\n+ for i in '$(seq 1 2)'\r\n+ for h in cacheissue\r\n+ puppet_deploy cacheissue\r\n+ local vm=cacheissue\r\n+ vagrant ssh cacheissue -- sudo /opt/puppetlabs/bin/puppet agent --test --trace\r\nsudo: unable to resolve host cacheissue.example.com\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for cacheissue.example.com\r\nInfo: Applying configuration version '1486636987'\r\nNotice: /Stage[main]/Factcacheissue/File[/etc/fact_cache_issue]/content: \r\n--- /etc/fact_cache_issue       2017-02-09 10:44:28.612000000 +0000\r\n+++ /tmp/puppet-file20170209-1058-3b631e        2017-02-09 10:44:40.932000000 +0000\r\n@@ -1 +1 @@\r\n-3069036cea991cba\r\n+f4956d526f3ea4b7\r\n\r\nInfo: Computing checksum on file /etc/fact_cache_issue\r\nInfo: /Stage[main]/Factcacheissue/File[/etc/fact_cache_issue]: Filebucketed /etc/fact_cache_issue to puppet with sum c3623b026f1e4ffaad7bc5f31dce5ddf\r\nNotice: /Stage[main]/Factcacheissue/File[/etc/fact_cache_issue]/content: content changed '{md5}c3623b026f1e4ffaad7bc5f31dce5ddf' to '{md5}965e17e84e855e7355c3145ce89af6aa'\r\nNotice: Applied catalog in 0.10 seconds\r\n+ test 1 = 1\r\n+ for i in '$(seq 1 2)'\r\n+ for h in cacheissue\r\n+ puppet_deploy cacheissue\r\n+ local vm=cacheissue\r\n+ vagrant ssh cacheissue -- sudo /opt/puppetlabs/bin/puppet agent --test --trace\r\nsudo: unable to resolve host cacheissue.example.com\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for cacheissue.example.com\r\nInfo: Applying configuration version '1486636987'\r\nNotice: /Stage[main]/Factcacheissue/File[/etc/fact_cache_issue]/content: \r\n--- /etc/fact_cache_issue       2017-02-09 10:44:40.980000000 +0000\r\n+++ /tmp/puppet-file20170209-1138-10kh2da       2017-02-09 10:44:46.904000000 +0000\r\n@@ -1 +1 @@\r\n-f4956d526f3ea4b7\r\n+3069036cea991cba\r\n\r\nInfo: Computing checksum on file /etc/fact_cache_issue\r\nInfo: /Stage[main]/Factcacheissue/File[/etc/fact_cache_issue]: Filebucketed /etc/fact_cache_issue to puppet with sum 965e17e84e855e7355c3145ce89af6aa\r\nNotice: /Stage[main]/Factcacheissue/File[/etc/fact_cache_issue]/content: content changed '{md5}965e17e84e855e7355c3145ce89af6aa' to '{md5}c3623b026f1e4ffaad7bc5f31dce5ddf'\r\nNotice: Applied catalog in 0.10 seconds\r\n\r\nroot@cacheissue:~# puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for cacheissue.example.com\r\nInfo: Applying configuration version '1486636987'\r\nNotice: /Stage[main]/Factcacheissue/File[/etc/fact_cache_issue]/content: \r\n--- /etc/fact_cache_issue       2017-02-09 10:44:46.948000000 +0000\r\n+++ /tmp/puppet-file20170209-1243-snbll1        2017-02-09 10:45:34.544000000 +0000\r\n@@ -1 +1 @@\r\n-3069036cea991cba\r\n+f4956d526f3ea4b7\r\n\r\nInfo: Computing checksum on file /etc/fact_cache_issue\r\nInfo: FileBucket got a duplicate file {md5}c3623b026f1e4ffaad7bc5f31dce5ddf\r\nInfo: /Stage[main]/Factcacheissue/File[/etc/fact_cache_issue]: Filebucketed /etc/fact_cache_issue to puppet with sum c3623b026f1e4ffaad7bc5f31dce5ddf\r\nNotice: /Stage[main]/Factcacheissue/File[/etc/fact_cache_issue]/content: content changed '{md5}c3623b026f1e4ffaad7bc5f31dce5ddf' to '{md5}965e17e84e855e7355c3145ce89af6aa'\r\nNotice: Applied catalog in 0.09 seconds\r\nroot@cacheissue:~# puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for cacheissue.example.com\r\nInfo: Applying configuration version '1486636987'\r\nNotice: /Stage[main]/Factcacheissue/File[/etc/fact_cache_issue]/content: \r\n--- /etc/fact_cache_issue       2017-02-09 10:45:34.580000000 +0000\r\n+++ /tmp/puppet-file20170209-1312-20p13j        2017-02-09 10:45:46.756000000 +0000\r\n@@ -1 +1 @@\r\n-f4956d526f3ea4b7\r\n+3069036cea991cba\r\n\r\nInfo: Computing checksum on file /etc/fact_cache_issue\r\nInfo: FileBucket got a duplicate file {md5}965e17e84e855e7355c3145ce89af6aa\r\nInfo: /Stage[main]/Factcacheissue/File[/etc/fact_cache_issue]: Filebucketed /etc/fact_cache_issue to puppet with sum 965e17e84e855e7355c3145ce89af6aa\r\nNotice: /Stage[main]/Factcacheissue/File[/etc/fact_cache_issue]/content: content changed '{md5}965e17e84e855e7355c3145ce89af6aa' to '{md5}c3623b026f1e4ffaad7bc5f31dce5ddf'\r\nNotice: Applied catalog in 0.09 seconds\r\n\r\n{noformat}\r\n\r\n\r\nPuppetServer log:\r\n{noformat}\r\n2017-02-09 10:43:04,412 INFO  [qtp1584394027-67] [puppetserver] Puppet Caching node for cacheissue.example.com\r\n2017-02-09 10:43:07,118 INFO  [qtp1584394027-64] [puppetserver] Puppet 'replace_facts' command for cacheissue.example.com submitted to PuppetDB with UUID 319bb70e-ef88-4c9b-82ee-1ed9828b107c\r\n2017-02-09 10:43:07,390 INFO  [qtp1584394027-64] [puppetserver] Puppet Caching node for cacheissue.example.com\r\n2017-02-09 10:43:08,167 INFO  [qtp1584394027-64] [puppetserver] Puppet Compiled catalog for cacheissue.example.com in environment production in 0.74 seconds\r\n2017-02-09 10:43:08,167 INFO  [qtp1584394027-64] [puppetserver] Puppet Caching catalog for cacheissue.example.com\r\n2017-02-09 10:43:08,197 INFO  [qtp1584394027-64] [puppetserver] Puppet 'replace_catalog' command for cacheissue.example.com submitted to PuppetDB with UUID b4d21d85-04ce-4c73-828c-348fab7869a5\r\n2017-02-09 10:43:08,415 INFO  [qtp1584394027-65] [puppetserver] Puppet 'store_report' command for cacheissue.example.com submitted to PuppetDB with UUID 6a80a4fc-e692-418a-8564-bbafe5eed76e\r\n2017-02-09 10:44:38,593 INFO  [qtp1584394027-69] [puppetserver] Puppet Caching node for cacheissue.example.com\r\n2017-02-09 10:44:41,399 INFO  [qtp1584394027-66] [puppetserver] Puppet 'replace_facts' command for cacheissue.example.com submitted to PuppetDB with UUID c412c520-aa29-49f8-b91c-f97382f6ac09\r\n2017-02-09 10:44:41,602 INFO  [qtp1584394027-66] [puppetserver] Puppet Caching node for cacheissue.example.com\r\n2017-02-09 10:44:41,688 WARN  [qtp1584394027-66] [puppetserver] Puppet Class 'settings' is already defined; cannot redefine at :\r\n2017-02-09 10:44:41,728 WARN  [qtp1584394027-66] [c.p.p.ShellUtils] Executed an external process which logged to STDERR: f4956d526f3ea4b7\r\n\r\n2017-02-09 10:44:41,773 INFO  [qtp1584394027-66] [puppetserver] Puppet Compiled catalog for cacheissue.example.com in environment production in 0.09 seconds\r\n2017-02-09 10:44:41,774 INFO  [qtp1584394027-66] [puppetserver] Puppet Caching catalog for cacheissue.example.com\r\n2017-02-09 10:44:41,856 INFO  [qtp1584394027-66] [puppetserver] Puppet 'replace_catalog' command for cacheissue.example.com submitted to PuppetDB with UUID 4bbea8ed-b9ed-442e-90a4-289aaf27c991\r\n2017-02-09 10:44:42,087 INFO  [qtp1584394027-67] [puppetserver] Puppet 'store_report' command for cacheissue.example.com submitted to PuppetDB with UUID 981f4e68-c97a-4c21-8c58-ad629ddf5ad0\r\n2017-02-09 10:44:45,460 INFO  [qtp1584394027-65] [puppetserver] Puppet Caching node for cacheissue.example.com\r\n2017-02-09 10:44:47,539 INFO  [qtp1584394027-68] [puppetserver] Puppet 'replace_facts' command for cacheissue.example.com submitted to PuppetDB with UUID dd30a8f1-cb79-4a5e-9bad-4b6fbb0286e9\r\n2017-02-09 10:44:47,692 INFO  [qtp1584394027-68] [puppetserver] Puppet Caching node for cacheissue.example.com\r\n2017-02-09 10:44:47,739 WARN  [qtp1584394027-68] [puppetserver] Puppet Class 'settings' is already defined; cannot redefine at :\r\n2017-02-09 10:44:47,790 INFO  [qtp1584394027-68] [puppetserver] Puppet Compiled catalog for cacheissue.example.com in environment production in 0.05 seconds\r\n2017-02-09 10:44:47,790 INFO  [qtp1584394027-68] [puppetserver] Puppet Caching catalog for cacheissue.example.com\r\n2017-02-09 10:44:47,825 INFO  [qtp1584394027-68] [puppetserver] Puppet 'replace_catalog' command for cacheissue.example.com submitted to PuppetDB with UUID 29abc7d5-738a-4da2-a452-3f94a39491f2\r\n2017-02-09 10:44:48,717 INFO  [qtp1584394027-69] [puppetserver] Puppet 'store_report' command for cacheissue.example.com submitted to PuppetDB with UUID 12cfc770-3e6f-47ff-bf19-909687ca0a1e\r\n2017-02-09 10:45:32,811 INFO  [qtp1584394027-67] [puppetserver] Puppet Caching node for cacheissue.example.com\r\n2017-02-09 10:45:35,168 INFO  [qtp1584394027-64] [puppetserver] Puppet 'replace_facts' command for cacheissue.example.com submitted to PuppetDB with UUID 9b0fbc3f-4c9a-48b3-a9ec-46717c332139\r\n2017-02-09 10:45:35,351 INFO  [qtp1584394027-64] [puppetserver] Puppet Caching node for cacheissue.example.com\r\n2017-02-09 10:45:35,398 WARN  [qtp1584394027-64] [puppetserver] Puppet Class 'settings' is already defined; cannot redefine at :\r\n2017-02-09 10:45:35,434 INFO  [qtp1584394027-64] [puppetserver] Puppet Compiled catalog for cacheissue.example.com in environment production in 0.04 seconds\r\n2017-02-09 10:45:35,435 INFO  [qtp1584394027-64] [puppetserver] Puppet Caching catalog for cacheissue.example.com\r\n2017-02-09 10:45:35,464 INFO  [qtp1584394027-64] [puppetserver] Puppet 'replace_catalog' command for cacheissue.example.com submitted to PuppetDB with UUID a73829e8-750a-4d97-ae3a-b4e4f9a6e358\r\n2017-02-09 10:45:35,687 INFO  [qtp1584394027-65] [puppetserver] Puppet 'store_report' command for cacheissue.example.com submitted to PuppetDB with UUID 45b2d1e3-a077-4f43-8ce0-73f26873f18b\r\n2017-02-09 10:45:45,053 INFO  [qtp1584394027-69] [puppetserver] Puppet Caching node for cacheissue.example.com\r\n2017-02-09 10:45:47,384 INFO  [qtp1584394027-66] [puppetserver] Puppet 'replace_facts' command for cacheissue.example.com submitted to PuppetDB with UUID 6c60b22b-86df-4850-85c2-555d898833b1\r\n2017-02-09 10:45:47,567 INFO  [qtp1584394027-66] [puppetserver] Puppet Caching node for cacheissue.example.com\r\n2017-02-09 10:45:47,619 WARN  [qtp1584394027-66] [puppetserver] Puppet Class 'settings' is already defined; cannot redefine at :\r\n2017-02-09 10:45:47,660 INFO  [qtp1584394027-66] [puppetserver] Puppet Compiled catalog for cacheissue.example.com in environment production in 0.04 seconds\r\n2017-02-09 10:45:47,660 INFO  [qtp1584394027-66] [puppetserver] Puppet Caching catalog for cacheissue.example.com\r\n2017-02-09 10:45:47,684 INFO  [qtp1584394027-66] [puppetserver] Puppet 'replace_catalog' command for cacheissue.example.com submitted to PuppetDB with UUID 35a46c71-b074-421a-99b6-405d1a718f65\r\n2017-02-09 10:45:47,950 INFO  [qtp1584394027-67] [puppetserver] Puppet 'store_report' command for cacheissue.example.com submitted to PuppetDB with UUID f7c2cb6a-5968-4c97-93bf-85d530cbb5f9\r\n{noformat}\r\n\r\n","closed_at":"2019-03-29T15:58:20.000-0700","comments":26,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7198","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-03-29T15:58:20.000-0700","timestamp":1652285752.853793,"priority":"Major","status_category":"Done","pull_request":5866},{"issue_id":"179394","title":"Group resource (with auth_membership) fails if local Windows group contains not resolvable Domain accounts","url":"https://tickets.puppetlabs.com/browse/PUP-7326","created_at":"2017-03-09T05:57:06.000-0800","number":"PUP-7326","body":"After leaving a Domain Windows systems may still contain not resolvable domain accounts inside local groups, i.e. in *Administrators* group: \r\n\r\n!local_administrators_group_with_former_domain_object.png|thumbnail!\r\n\r\nWhen trying to manage this group using *auth_membership => true* (to ensure all not resolvable domain user accounts are tidied to only have the local user *Administrator* inside the local *Administrators* group), Puppet will fail:\r\n\r\n{code:puppet}\r\ngroup {'Administrators': \r\n    members => ['Administrator'], \r\n    auth_membership => true \r\n}\r\n{code}\r\n\r\nTested with the following Puppet Apply command:\r\n\r\n\r\n{code}\r\npuppet apply -e \"group {'Administrators': members => ['Administrator'], auth_membership => true }\r\n{code}\r\n\r\n\r\n{code:puppet}\r\nError: Could not resolve name: S-1-5-21-776561741-1409082233-725345543-15784\r\nError: /Stage[main]/Main/Group[Administrators]/members: change from TEST-WIN2012\\Administrator,S-1-5-21-776561741-1409082233-725345543-15784 to TEST-WIN2012\\Administrator failed: Could not resolve name: S-1-5-21-776561741-1409082233-725345543-15784\r\n{code}\r\n\r\n\r\n!puppet_apply_example.png|thumbnail!\r\n\r\n","closed_at":"2019-04-04T19:42:52.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7326","labels":"windows","state":"Closed","updated_at":"2019-04-04T19:42:52.000-0700","timestamp":1652285753.073953,"priority":"Normal","status_category":"Done","pull_request":6695},{"issue_id":"142380","title":"hiera_include() fails when compiling an environment catalog","url":"https://tickets.puppetlabs.com/browse/PUP-6527","created_at":"2016-07-20T09:22:30.000-0700","number":"PUP-6527","body":"Currently, the hiera_include() function fails if called during environment catalog compilation. Because the suggested way to use hiera_include() is to place it at topscope outside any node/site blocks, it will always be called for environment compilation and will fail when the expected key isn't found. Since hiera_include() doesn't actually make sense for the environment catalog and is unlikely to be configured, it will basically _always_ fail. The function ought to noop during environment compilation, so as to allow users to adopt the direct change workflow without having to first modify how they classify their nodes.","closed_at":"2019-04-04T22:10:36.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6527","labels":"","state":"Closed","updated_at":"2019-04-04T22:10:36.000-0700","timestamp":1652285753.608406,"priority":"Normal","status_category":"Done","pull_request":5147},{"issue_id":"96722","title":"app_management feature switch has no effect when running under puppet-server","url":"https://tickets.puppetlabs.com/browse/PUP-5197","created_at":"2015-09-03T14:13:09.000-0700","number":"PUP-5197","body":"When running the master under puppet-server, setting {{app_management}} in {{puppet.conf}} has no effect, because {{Puppet::Pops::Parser::Lexer2}} is loaded before {{Puppet[:app_management]}} has been properly initialized. Therefore, the lexer always behaves as if app mgmt was turned off.\r\n\r\nThe proximate cause for this is that puppet-server's {{puppet/server/master.rb}}, which is loaded as one of the first things when a JRuby container is initialized, loads {{puppet/info_service}} before loading the Puppet config. The {{info_service}} in turn instantiates a compiler, and things go sideways from there.\r\n","closed_at":"2019-04-04T22:10:36.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5197","labels":"","state":"Closed","updated_at":"2019-04-04T22:10:36.000-0700","timestamp":1652285753.716345,"priority":"Normal","status_category":"Done","pull_request":4216},{"issue_id":"141339","title":"CapabilityFinder says a capability couldn't be found if there are multiple versions of it","url":"https://tickets.puppetlabs.com/browse/PUP-6497","created_at":"2016-07-12T16:34:55.000-0700","number":"PUP-6497","body":"If two versions of a capability resource exist and neither corresponds to the code-id being compiled, the CapabilityFinder will fail with an error saying the resource couldn't be found and might not have been produced yet. This is inaccurate, since it was in fact produced multiple times and the real problem is that it's not clear which one to use. This message should be updated to better reflect that reality.","closed_at":"2019-04-04T22:10:37.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6497","labels":"","state":"Closed","updated_at":"2019-04-04T22:10:37.000-0700","timestamp":1652285764.803367,"priority":"Normal","status_category":"Done","pull_request":5166},{"issue_id":"160489","title":"variables_refreshed_each_compilation test can fail uptime comparisons","url":"https://tickets.puppetlabs.com/browse/PUP-6911","created_at":"2016-11-10T09:35:13.000-0800","number":"PUP-6911","body":"The {{variables_refreshed_each_compilation}} acceptance test can fail when the uptime seconds that the test is comparing happen are for strings where the earlier uptime is lexicographically later than the later uptime.  For example, this test failed in the puppetserver pipeline [here|https://jenkins.puppetlabs.com/view/puppetserver/view/all/job/platform_puppetserver_integration-system_no-conditional_full-stable/LAYOUT=ubuntu1604-64ma-32a,LDAP_TYPE=default,label=beaker/263/testReport/junit/(root)/ruby_puppet_acceptance_tests_environment/variables_refreshed_each_compilation_rb/] with the following console output:\r\n\r\n{noformat}\r\n\r\njubzk4qxrpdh8r2.delivery.puppetlabs.net (ubuntu1604-32-2) 03:09:15$ puppet agent -t --server ks6npbjxt60nblz.delivery.puppetlabs.net --environment variables_refreshed_each_compilation_nmjw1l2b\r\n...\r\n        Notice: local_9999_local\r\n\r\njubzk4qxrpdh8r2.delivery.puppetlabs.net (ubuntu1604-32-2) 03:09:19$ puppet agent -t --server ks6npbjxt60nblz.delivery.puppetlabs.net --environment variables_refreshed_each_compilation_nmjw1l2b\r\n...\r\n        Notice: local_10002_local\r\n\r\nWarning: \r\n      uptime did not change\r\n{noformat}\r\n\r\nThe assertions are made from [here|https://github.com/puppetlabs/puppet/blob/52208ac4637f8b81a7e0d895be2cd9805647c70f/acceptance/tests/environment/variables_refreshed_each_compilation.rb#L65-L66].  The values of the variables being compared are strings.  In this case though a string value of \"9999\" would be lexicographically greater than a string value of \"10002\", so the test fails.  The test should be changed to do numeric comparisons of the uptimes in order to avoid the problem.","closed_at":"2019-04-04T22:12:15.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6911","labels":"","state":"Closed","updated_at":"2019-04-04T22:12:15.000-0700","timestamp":1652285765.017803,"priority":"Normal","status_category":"Done","pull_request":5371},{"issue_id":"72135","title":"add acceptance for hash and array lookup()","url":"https://tickets.puppetlabs.com/browse/PUP-4239","created_at":"2015-03-18T10:58:39.000-0700","number":"PUP-4239","body":"include the full stack of global hiera, environment, and module data. \r\n\r\nThe hiera_include function is simple, it looks up 'classes' and then loops over them to include those. If an acceptance test correctly looks up (global, env, module) then hiera_include should work (tested with an integration test). \r\n","closed_at":"2019-04-04T22:12:16.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4239","labels":"","state":"Closed","updated_at":"2019-04-04T22:12:16.000-0700","timestamp":1652285765.338486,"priority":"Normal","status_category":"Done","pull_request":3768},{"issue_id":"135615","title":"Acceptance: unpin run order for service_enable_linux test","url":"https://tickets.puppetlabs.com/browse/PUP-6390","created_at":"2016-06-06T11:56:42.000-0700","number":"PUP-6390","body":"Currently, the [service_enable_linux acceptance test|https://github.com/puppetlabs/puppet/blob/master/acceptance/tests/resource/service/service_enable_linux.rb] explicitly define the run order for start and kill scripts. At this point in time, this pinning is causing the test to fail on test instances of sles 11 and 12 running on s390x.\r\n\r\nThe run order should be unpinned in the test to ensure that differences in services on SUTs do not cause the test to fail.\r\n\r\nThis situation is similar to the failure seen on PUP-6228","closed_at":"2019-04-04T22:12:17.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6390","labels":"","state":"Closed","updated_at":"2019-04-04T22:12:17.000-0700","timestamp":1652285765.556124,"priority":"Normal","status_category":"Done","pull_request":5073},{"issue_id":"69476","title":"AIO acceptance tests copies multiple versions of repo configs to the SUT","url":"https://tickets.puppetlabs.com/browse/PUP-4044","created_at":"2015-02-25T21:58:27.000-0800","number":"PUP-4044","body":"Puppet has an install_repos_on method (separate from beaker) that scp's repo configs from builds.puppetlabs.lan to the coordinator node, and then scp's them to the SUT(s). The problem is that it copies more than the SHA being tested. For example, on an agent node:\r\n\r\n{noformat}\r\n# find /root/puppet-agent\r\n.\r\n./puppetlabs-release-el-7.noarch.rpm\r\n./pl-puppet-agent-71aa130dc8e2931d75b218abd1308386e462b24c-el-7-x86_64.repo\r\n./x86_64\r\n./x86_64/puppet-agent-0.3.2.27.g3a63b02-1.el7.x86_64.rpm\r\n./x86_64/puppet-agent-0.3.2.59.g7f9eb57-1.el7.x86_64.rpm\r\n./x86_64/puppet-agent-0.3.2.61.g4c11bc2-1.el7.x86_64.rpm\r\n./x86_64/puppet-agent-0.3.2.63.ge907309-1.el7.x86_64.rpm\r\n./x86_64/puppet-agent-0.3.2.65.gbc00b6e-1.el7.x86_64.rpm\r\n./x86_64/puppet-agent-0.3.2.78.g32bfbf9-1.el7.x86_64.rpm\r\n./x86_64/puppet-agent-0.3.2.89.g71aa130-1.el7.x86_64.rpm\r\n{noformat}\r\n\r\nIdeally, the method should not be transferring repo_configs to the coordinator, e.g. when trying to run acceptance tests over the VPN. If it transferred repo configs directly to the SUT then we wouldn't have multiple versions of repo configs.\r\n\r\nAt a minimum it should only transfer the repo configs for the SHA that is being tested.\r\n\r\nRisk assessment N/A for test framework\r\n","closed_at":"2019-04-04T22:12:26.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4044","labels":"AIO_TechDebt","state":"Closed","updated_at":"2019-04-04T22:12:26.000-0700","timestamp":1652285768.584769,"priority":"Normal","status_category":"Done","pull_request":3835},{"issue_id":"84364","title":"\"testdir\" incorrectly used in 'calling_all_functions' acceptance test","url":"https://tickets.puppetlabs.com/browse/PUP-4749","created_at":"2015-06-12T00:29:22.000-0700","number":"PUP-4749","body":"The {{.../parser_functions/calling_all_functions.rb}} test fails when run against the Puppet Server acceptance pipeline:\r\n\r\nhttp://jenkins-enterprise.delivery.puppetlabs.net/view/puppet-server/view/all/job/enterprise_puppet-server_integration-system_no-conditional_full-master/11/LAYOUT=redhat7-64ma-windows2008r2-64a,LDAP_TYPE=default,PLATFORM=default,label=beaker/testReport/junit/(root)/ruby_puppet_acceptance_tests_parser_functions/calling_all_functions_rb/\r\n\r\nHere is a snippet of a failure:\r\n\r\n{noformat}\r\n * Apply manifest containing all function calls\r\n\r\nepylfol3z8f3sp6.delivery.puppetlabs.net (redhat7-64-1) 18:12:51$ mktemp -t apply_manifest.pp.XXXXXX\r\n/tmp/apply_manifest.pp.JjmyR4\r\n\r\nepylfol3z8f3sp6.delivery.puppetlabs.net (redhat7-64-1) executed in 0.01 seconds\r\nlocalhost $ scp /tmp/beaker20150611-5801-2vsc7d redhat7-64-1:/tmp/apply_manifest.pp.JjmyR4 {:ignore => }\r\n\r\nepylfol3z8f3sp6.delivery.puppetlabs.net (redhat7-64-1) 18:12:51$ puppet apply --verbose --detailed-exitcodes /tmp/apply_manifest.pp.JjmyR4\r\nNotice: Compiled catalog for epylfol3z8f3sp6.delivery.puppetlabs.net in environment production in 0.43 seconds\r\nError: Parameter path failed on File[C:/cygwin64/tmp/calling_all_functions.bnPlZa]: File paths must be fully qualified, not 'C:/cygwin64/tmp/calling_all_functions.bnPlZa' at /tmp/apply_manifest.pp.JjmyR4:4\r\n\r\nepylfol3z8f3sp6.delivery.puppetlabs.net (redhat7-64-1) executed in 1.35 seconds\r\nExited: 1\r\n#<Beaker::Host::CommandFailure: Host 'epylfol3z8f3sp6.delivery.puppetlabs.net' exited with 1 running:\r\n puppet apply --verbose --detailed-exitcodes /tmp/apply_manifest.pp.JjmyR4\r\nLast 10 lines of output were:\r\n\tNotice: Compiled catalog for epylfol3z8f3sp6.delivery.puppetlabs.net in environment production in 0.43 seconds\r\n\tError: Parameter path failed on File[C:/cygwin64/tmp/calling_all_functions.bnPlZa]: File paths must be fully qualified, not 'C:/cygwin64/tmp/calling_all_functions.bnPlZa' at /tmp/apply_manifest.pp.JjmyR4:4>\r\n{noformat}\r\n\r\nIn this case, the SUT in which the puppet apply is being run is a redhat7 node but the file path being used in the manifest is for Windows - C:/cygwin64/...  I believe this is due to a problem with how {{testdir}} is defined in the test.  {{testdir}} is redefined as each agent is iterated over:\r\n\r\n{code:ruby}\r\ntestdir   = ''\r\ngenerator = ''\r\nagents.each do |agent|\r\n  testdir = agent.tmpdir('calling_all_functions')\r\n  if agent[\"platform\"] =~ /win/\r\n    generator = {:args => '\"c:/windows/system32/tasklist.exe\"', :expected => /\\nImage Name/}\r\n  else\r\n    generator = {:args => '\"/bin/date\"',                        :expected => /\\w\\w\\w.*?\\d\\d:\\d\\d\\:\\d\\d/}\r\n  end\r\nend\r\n{code}\r\n\r\n... and is then referenced in the {{module_manifest}} definition later:\r\n\r\n{code:ruby}\r\nmodule_manifest = <<PP\r\nFile {\r\n  ensure => directory,\r\n}\r\nfile {\r\n  '#{testdir}':;\r\n  '#{testdir}/environments':;\r\n...\r\n{code}\r\n\r\nThe manifest is then applied during a separate loop over the agents:\r\n\r\n{code:ruby}\r\nagents.each do |agent|\r\n  apply_manifest_on(agent, module_manifest, :catch_failures => true)\r\n...\r\n{code}\r\n\r\nThe {{testdir}} here would seem to no longer have the same value as would be appropriate for each agent under test per OS that may be exercised in the agent list.  It would seem that this test would need to be reworked to only loop over the agents once and use the same value derived for {{testdir}} throughout all of the steps exercised for each agent in turn.","closed_at":"2019-04-04T22:12:28.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4749","labels":"","state":"Closed","updated_at":"2019-04-04T22:12:28.000-0700","timestamp":1652285769.230792,"priority":"Normal","status_category":"Done","pull_request":4029},{"issue_id":"76026","title":"Add acceptance test that 3.x forbidden env names work in 4.x","url":"https://tickets.puppetlabs.com/browse/PUP-4413","created_at":"2015-04-14T23:02:55.000-0700","number":"PUP-4413","body":"In getting rid of setting the modulepath and manifest on our masters and setting up environmentpath, we didn't get the memo that 'master' was now a forbidden environment name (as documented here: https://docs.puppetlabs.com/puppet/latest/reference/environments_classic.html#setting-up-environments-on-a-puppet-master ). Figured it out eventually.\r\n\r\nIt would be great if puppet server/master error'd or warn'd when this happens as puppet will now ignore the master environment; but gives no indication that this is happening. In running the server and client with debug and verbose the only clue you get is:\r\n\r\nDebug: Warning: calling Plugins.search with empty module path.\r\n\r\nIt would also be good to error/warn if someone sets 'environment = master' in the puppet.conf as that is no longer going to work (or at least, won't work with environmentpath set).\r\n\r\nJust hoping to save someone else the troubleshooting effort.","closed_at":"2019-04-04T22:12:31.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4413","labels":"","state":"Closed","updated_at":"2019-04-04T22:12:31.000-0700","timestamp":1652285770.750109,"priority":"Normal","status_category":"Done","pull_request":3871},{"issue_id":"32379","title":"Solaris acceptance tests assume puppet is on the path","url":"https://tickets.puppetlabs.com/browse/PUP-2307","created_at":"2014-04-18T15:42:12.000-0700","number":"PUP-2307","body":"The solaris acceptance tests assume they can use {{on host, \"puppet ...\"}}. This fails when the test suite is run against puppet enterprise, since PE is not in the path on solaris. The tests should be updated to use Beaker's {{puppet()}} helper\r\n\r\n./acceptance/tests/resource/package/ips/basic_tests.rb\r\n./acceptance/tests/resource/package/ips/should_create.rb\r\n./acceptance/tests/resource/package/ips/should_query.rb\r\n./acceptance/tests/resource/service/smf_basic_tests.rb\r\n./acceptance/tests/resource/service/smf_should_query.rb\r\n./acceptance/tests/resource/zfs/should_query.rb\r\n./acceptance/tests/resource/zpool/basic_tests.rb\r\n./acceptance/tests/resource/zpool/should_query.rb\r\n./acceptance/tests/security/cve-2013-1640_facter_string.rb\r\n./acceptance/tests/ticket_3360_allow_duplicate_csr_with_option_set.rb\r\n","closed_at":"2019-04-04T22:12:32.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2307","labels":"","state":"Closed","updated_at":"2019-04-04T22:12:32.000-0700","timestamp":1652285771.16721,"priority":"Normal","status_category":"Done","pull_request":3438},{"issue_id":"87931","title":"user and group acceptance tests fail on OSX","url":"https://tickets.puppetlabs.com/browse/PUP-4824","created_at":"2015-07-07T14:14:47.000-0700","number":"PUP-4824","body":"Several user and group acceptance tests fail on OSX because the test uses {{getent}} to setup the preconditions for the test. The tests should be updated to work on OSX\r\n\r\nUsing beaker 2.15.0:\r\n\r\n{noformat}\r\n$ be rake ci:test:aio SUITE_VERSION=1.1.1.250.gb9e1783 SHA=b9e178350dd52c75ab98ffd05e9bc739d7609155 CONFIG=config/nodes/osx-1010-x86_64.yaml TESTS=tests/ticket_9862_puppet_runs_without_service_user_or_group_present.rb,tests/resource/group,tests/resource/user\r\n...\r\n  Test Case tests/ticket_9862_puppet_runs_without_service_user_or_group_present.rb reported: #<Beaker::Host::CommandFailure: Host 'sxmv4xxp7it66t6.delivery.puppetlabs.net' exited with 1 running:\r\n find \"/opt/puppetlabs/puppet/cache\" -user existinguser\r\nLast 10 lines of output were:\r\n\tfind: -user: existinguser: no such user>\r\n  Test Case tests/resource/group/should_modify_gid.rb reported: #<Beaker::Host::CommandFailure: Host 'sxmv4xxp7it66t6.delivery.puppetlabs.net' exited with 127 running:\r\n getent group pl391975\r\nLast 10 lines of output were:\r\n\tsh: getent: command not found>\r\n  Test Case tests/resource/user/should_create.rb reported: #<Minitest::Assertion: failed to get group pl588776>\r\n  Test Case tests/resource/user/should_create_with_gid.rb reported: #<Beaker::Host::CommandFailure: Host 'sxmv4xxp7it66t6.delivery.puppetlabs.net' exited with 127 running:\r\n getent group gp775423 || groupadd gp775423\r\nLast 10 lines of output were:\r\n\tsh: getent: command not found\r\n\tsh: groupadd: command not found>\r\n  Test Case tests/resource/user/should_modify_gid.rb reported: #<Beaker::Host::CommandFailure: Host 'sxmv4xxp7it66t6.delivery.puppetlabs.net' exited with 127 running:\r\n getent group pl51979old\r\nLast 10 lines of output were:\r\n\tsh: getent: command not found>\r\n{noformat}","closed_at":"2019-04-04T22:12:35.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4824","labels":"","state":"Closed","updated_at":"2019-04-04T22:12:35.000-0700","timestamp":1652285772.204636,"priority":"Normal","status_category":"Done","pull_request":4150},{"issue_id":"53098","title":"'mount' resource with list of mount options only applies the first option","url":"https://tickets.puppetlabs.com/browse/PUP-3373","created_at":"2014-09-30T15:37:32.000-0700","number":"PUP-3373","body":"When creating a mount resource with a list of mount option, puppet appears to only add the first option to /etc/fstab.\r\n\r\nUsing the attached manifest and iso file, asking for these options:\r\n{noformat}\r\noptions => ['loop', 'exec', 'nouser']\r\n{noformat}\r\nthe fstab entry looks like this:\r\n{noformat}/tmp/testimage.iso\t/tmp/mount_point\tiso9660\tloop\t0\t0{noformat}\r\nmissing the second 2 options.\r\n\r\nIf you move 'loop' into the second position,\r\n{noformat}options => ['exec', 'loop', 'nouser']{noformat}\r\nThe puppet run fails, complaining it wasn't able to mount the .iso, even suggesting that 'loop' be added as an option\r\n\r\n{noformat}\r\nExecution of '/bin/mount /tmp/mount_point' returned 32: mount: /tmp/testimage.iso is not a block device (maybe try `-o loop'?)\r\n{noformat}","closed_at":"2019-04-04T22:12:38.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3373","labels":"","state":"Closed","updated_at":"2019-04-04T22:12:38.000-0700","timestamp":1652285773.240367,"priority":"Normal","status_category":"Done","pull_request":3167},{"issue_id":"46593","title":"tests/modules/install/with_version.rb assumes `puppet` is on the path","url":"https://tickets.puppetlabs.com/browse/PUP-3016","created_at":"2014-08-05T14:24:25.000-0700","number":"PUP-3016","body":"{{tests/modules/install/with_version.rb}} assumes that the puppet command is on the default PATH. It is not when we are deploying puppet-enterprise (and would not be when we deploy Windows tests using MSIs)\r\n\r\nThis should use the beaker {{puppet}} helper, even though we probably need to fight with it a little to make it work right in this case","closed_at":"2019-04-04T22:12:40.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3016","labels":"tests;windows","state":"Closed","updated_at":"2019-04-04T22:12:40.000-0700","timestamp":1652285773.654653,"priority":"Normal","status_category":"Done","pull_request":3429},{"issue_id":"70626","title":"The environment_scenario-* acceptance tests aren't asserting their success/failure and are therefore always 'passing'","url":"https://tickets.puppetlabs.com/browse/PUP-4111","created_at":"2015-03-06T14:41:11.000-0800","number":"PUP-4111","body":"These tests were written to collect results rather than failing early, so that they could be reviewed at once.\r\n\r\nWhen we broke up the stable:acceptance/tests/environment/directory.rb into master:acceptance/tests/environment/environment_scenario-*.rb subtests, we forgot to ensure that the tests make a final assertion that the results are either all passing or all failing.\r\n\r\nThe final assertion call that is missing is an:\r\n\r\nassert_review(results) call at the end of the test (using the lib/puppet/acceptance/environment_utils.rb helper)\r\n\r\nThey are currently failures in these tests that are being masked by this.\r\n\r\n","closed_at":"2019-04-04T22:12:40.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4111","labels":"","state":"Closed","updated_at":"2019-04-04T22:12:40.000-0700","timestamp":1652285773.858761,"priority":"Normal","status_category":"Done","pull_request":3814},{"issue_id":"160026","title":"sensitive_data_type test errantly testing beaker log instead of syslog output","url":"https://tickets.puppetlabs.com/browse/PUP-6898","created_at":"2016-11-07T12:19:32.000-0800","number":"PUP-6898","body":"The sensitive_data_type test attempts to make some assertions that sensitive data is absent from the syslog file but instead makes those assertions agains the beaker log itself.  This causes the assertions to fail when the test matrix includes more than one agent node since the sensitive data is present in the beaker log itself after the first agent run is performed.\r\n\r\nThis is causing the sensitive_data_type test to fail in the puppetserver CI pipeline, where both an agent on the master and an agent in a separate node are run together - see https://jenkins.puppetlabs.com/job/platform_puppetserver_integration-system_no-conditional_full-stable/255/LAYOUT=debian8-64ma-32a,LDAP_TYPE=default,label=beaker/testReport/junit/(root)/ruby_puppet_acceptance_tests_language/sensitive_data_type_rb/.  The test is failing during the \"assert no redacted data in syslog\" step for the second agent. \r\n\r\n","closed_at":"2019-04-04T22:12:46.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6898","labels":"","state":"Closed","updated_at":"2019-04-04T22:12:46.000-0700","timestamp":1652285775.535138,"priority":"Normal","status_category":"Done","pull_request":5364},{"issue_id":"73986","title":"source_attribute acceptance test failing intermittently","url":"https://tickets.puppetlabs.com/browse/PUP-4340","created_at":"2015-03-30T16:28:04.000-0700","number":"PUP-4340","body":"The source_attribute test was modified (in PUP-3974) to wait for time to pass\r\nsufficient that touching source files on the master would cause puppet\r\nagent runs to resync the files. However, the test only checked\r\nmtime/ctime on the master - which is unrelated to ctime/mtime of the\r\ntarget files on the agents - and the agent target files are what will be\r\ncompared to the ctime/mtime of the source file to see if they need to be\r\nresynced.\r\n\r\nWe could fix this by iterating over the agents - or assuming they'll\r\nalways be done in order and only querying the last agent - to check the\r\nctime/mtime stats of the target files using puppet resource file <filename>, but that's more complicated and unlikely to be\r\nsignificantly less than the 1 second sleep we used to have.\r\n\r\nRevert to the previous behavior of waiting 1 second to touch the files\r\nand try resyncing.","closed_at":"2019-04-04T22:12:48.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4340","labels":"","state":"Closed","updated_at":"2019-04-04T22:12:48.000-0700","timestamp":1652285786.742088,"priority":"Normal","status_category":"Done","pull_request":3771},{"issue_id":"159952","title":"Agents mishandled in pcore_generate and corrective_change tests","url":"https://tickets.puppetlabs.com/browse/PUP-6897","created_at":"2016-11-07T09:16:11.000-0800","number":"PUP-6897","body":"The \"pcore_generate_env_isolation.rb\" and \"corrective_change_via_puppet.rb\" tests both fail when run in a CI matrix which includes two agents - e.g., an agent run on the master and an agent run against the master from a separate node.  In both cases, the failures appear to be due to the tests changing state in the middle of the test causing a second agent to see an unexpected result.\r\n\r\nThis failure was encountered when bumping to the latest Puppet stable commit on the puppetserver CI pipeline: https://jenkins.puppetlabs.com/view/puppetserver/view/all/job/platform_puppetserver_integration-system_no-conditional_full-stable/255/.  Some snippets of the failures for each test are below:\r\n\r\npcore_generate_env_isolation.rb:\r\n\r\n{noformat}\r\n* run agent in environment with type with an extra parameter. try to use this parameter\r\n      \r\n      yet7cniwbcy64sf.delivery.puppetlabs.net (debian8-32-2) 03:11:33$ puppet agent -t --server vjl5yrswgh4uoj9.delivery.puppetlabs.net --environment pcore_generate_env_isolation_to4sbyrx\r\n        Info: Using configured environment 'pcore_generate_env_isolation_to4sbyrx'\r\n        Info: Retrieving pluginfacts\r\n        Info: Retrieving plugin\r\n        Notice: /File[/opt/puppetlabs/puppet/cache/lib/puppet/type/conflicting.rb]/content: \r\n        --- /opt/puppetlabs/puppet/cache/lib/puppet/type/conflicting.rb\t2016-11-07 03:11:32.664804843 -0800\r\n        +++ /tmp/puppet-file20161107-23935-3e6p0b\t2016-11-07 03:11:35.780896287 -0800\r\n        @@ -1,3 +1,4 @@\r\n             Puppet::Type.newtype(:conflicting) do\r\n               newparam :name, :namevar => true\r\n        +      newparam :other\r\n             end\r\n        Notice: /File[/opt/puppetlabs/puppet/cache/lib/puppet/type/conflicting.rb]/content: content changed '{md5}a0c85d30454a7c39614e8c798da69769' to '{md5}d501df2ec6cba932d67ea737f6880d0b'\r\n        Info: Caching catalog for yet7cniwbcy64sf.delivery.puppetlabs.net\r\n        Info: Applying configuration version '1478517096'\r\n        Notice: pcore_generate_env_isolation_to4sbyrx\r\n        Notice: /Stage[main]/Main/Notify[pcore_generate_env_isolation_to4sbyrx]/message: defined 'message' as 'pcore_generate_env_isolation_to4sbyrx'\r\n        Notice: Applied catalog in 0.04 seconds\r\n      \r\n      yet7cniwbcy64sf.delivery.puppetlabs.net (debian8-32-2) executed in 3.08 seconds\r\n      Exited: 2\r\n      Warning: \r\ndid not produce environment isolation issue as expected.\r\nExpected /Error:\\ no\\ parameter\\ named\\ 'other'/ to match \"\\e[0;32mInfo: Using configured environment 'pcore_generate_env_isolation_to4sbyrx'\\e[0m\\n\\e[0;32mInfo: Retrieving pluginfacts\\e[0m\\n\\e[0;32mInfo: Retrieving plugin\\e[0m\\n\\e[mNotice: /File[/opt/puppetlabs/puppet/cache/lib/puppet/type/conflicting.rb]/content: \\n--- /opt/puppetlabs/puppet/cache/lib/puppet/type/conflicting.rb\\t2016-11-07 03:11:32.664804843 -0800\\n+++ /tmp/puppet-file20161107-23935-3e6p0b\\t2016-11-07 03:11:35.780896287 -0800\\n@@ -1,3 +1,4 @@\\n     Puppet::Type.newtype(:conflicting) do\\n       newparam :name, :namevar => true\\n+      newparam :other\\n     end\\n\\e[0m\\n\\e[mNotice: /File[/opt/puppetlabs/puppet/cache/lib/puppet/type/conflicting.rb]/content: content changed '{md5}a0c85d30454a7c39614e8c798da69769' to '{md5}d501df2ec6cba932d67ea737f6880d0b'\\e[0m\\n\\e[0;32mInfo: Caching catalog for yet7cniwbcy64sf.delivery.puppetlabs.net\\e[0m\\n\\e[0;32mInfo: Applying configuration version '1478517096'\\e[0m\\n\\e[mNotice: pcore_generate_env_isolation_to4sbyrx\\e[0m\\n\\e[mNotice: /Stage[main]/Main/Notify[pcore_generate_env_isolation_to4sbyrx]/message: defined 'message' as 'pcore_generate_env_isolation_to4sbyrx'\\e[0m\\n\\e[mNotice: Applied catalog in 0.04 seconds\\e[0m\\n\".\r\n{noformat}\r\n\r\ncorrective_change_via_puppet.rb:\r\n\r\n{noformat}\r\n* Run agent a 2nd time to change the File resource\r\n            \r\n            u8wdlpr8mrxu3fq.delivery.puppetlabs.net (sles12-64-2) 03:29:08$ puppet agent -t --environment corrective_change_via_puppet_6y5ldjwa --server ititl6tmmhh7999.delivery.puppetlabs.net\r\n              Info: Using configured environment 'corrective_change_via_puppet_6y5ldjwa'\r\n              Info: Retrieving pluginfacts\r\n              Info: Retrieving plugin\r\n              Info: Caching catalog for u8wdlpr8mrxu3fq.delivery.puppetlabs.net\r\n              Info: Applying configuration version '1478518148'\r\n              Notice: Applied catalog in 0.04 seconds\r\n            \r\n            u8wdlpr8mrxu3fq.delivery.puppetlabs.net (sles12-64-2) executed in 2.26 seconds\r\n            \r\n            ititl6tmmhh7999.delivery.puppetlabs.net (sles12-64-1) 03:29:10$ puppet master --configprint config\r\n              /etc/puppetlabs/puppet/puppet.conf\r\n            \r\n            ititl6tmmhh7999.delivery.puppetlabs.net (sles12-64-1) executed in 0.77 seconds\r\n            \r\n            ititl6tmmhh7999.delivery.puppetlabs.net (sles12-64-1) 03:29:11$ if [ -f '/tmp/corrective_change_via_puppet.rb.JGkHGE/puppet.conf.bak' ]; then cat '/tmp/corrective_change_via_puppet.rb.JGkHGE/puppet.conf.bak' > '/etc/puppetlabs/puppet/puppet.conf'; rm -f '/tmp/corrective_change_via_puppet.rb.JGkHGE/puppet.conf.bak'; fi\r\n            \r\n            ititl6tmmhh7999.delivery.puppetlabs.net (sles12-64-1) executed in 0.03 seconds\r\n            \r\n            ititl6tmmhh7999.delivery.puppetlabs.net (sles12-64-1) 03:29:11$ puppet resource service puppetserver ensure=stopped\r\n              Notice: /Service[puppetserver]/ensure: ensure changed 'running' to 'stopped'\r\n              service { 'puppetserver':\r\n                ensure => 'stopped',\r\n              }\r\n            \r\n            ititl6tmmhh7999.delivery.puppetlabs.net (sles12-64-1) executed in 1.35 seconds\r\n            \r\n            ititl6tmmhh7999.delivery.puppetlabs.net (sles12-64-1) 03:29:12$ puppet resource service puppetserver ensure=running\r\n              Notice: /Service[puppetserver]/ensure: ensure changed 'stopped' to 'running'\r\n              service { 'puppetserver':\r\n                ensure => 'running',\r\n              }\r\n            \r\n            ititl6tmmhh7999.delivery.puppetlabs.net (sles12-64-1) executed in 33.58 seconds\r\n            \r\n            ititl6tmmhh7999.delivery.puppetlabs.net (sles12-64-1) 03:29:46$ curl -m 1 https://localhost:8140\r\n              Trying command 60 times.\r\n            .            \r\n            ititl6tmmhh7999.delivery.puppetlabs.net (sles12-64-1) 03:29:46$ curl -m 1 https://localhost:8140 ostensibly successful.\r\n            RuntimeError: PuppetAcceptance::DSL::Helpers.with_puppet_running_on failed (check backtrace for location) because: Host 'u8wdlpr8mrxu3fq.delivery.puppetlabs.net' exited with 0 running:\r\n             puppet agent -t --environment corrective_change_via_puppet_6y5ldjwa --server ititl6tmmhh7999.delivery.puppetlabs.net\r\n            Last 10 lines of output were:\r\n            \tInfo: Using configured environment 'corrective_change_via_puppet_6y5ldjwa'\r\n            \tInfo: Retrieving pluginfacts\r\n            \tInfo: Retrieving plugin\r\n            \tInfo: Caching catalog for u8wdlpr8mrxu3fq.delivery.puppetlabs.net\r\n            \tInfo: Applying configuration version '1478518148'\r\n            \tNotice: Applied catalog in 0.04 seconds\r\n{noformat}","closed_at":"2019-04-04T22:12:54.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6897","labels":"","state":"Closed","updated_at":"2019-04-04T22:12:54.000-0700","timestamp":1652285788.248331,"priority":"Normal","status_category":"Done","pull_request":5363},{"issue_id":"81832","title":"environment_scenario test failures when master has agent role","url":"https://tickets.puppetlabs.com/browse/PUP-4659","created_at":"2015-05-27T12:22:56.000-0700","number":"PUP-4659","body":"When we upgraded the Puppet Server acceptance pipeline to using Puppet 4.1.0 / Puppet Agent 1.1.0, we started encountering some failures with the environment_scenario tests.  I believe these tests are not failing when run on the platform pipeline only because some of the test steps are only run when the agent under test resides on the master.  According to [~josh], the master has not been run with the agent role in the platform AIO pipeline for some time.\r\n\r\nAn example of one failing matrix is here:\r\n\r\nhttps://jenkins.puppetlabs.com/view/Puppet%20Server/view/All/job/platform_puppet-server_integration-system_no-conditional_full-master/64/#showFailuresLink\r\n\r\nNote that the same failures are occurring across all OSes under test.\r\n\r\nHere's a quick analysis of what it looks to me that may be going on with the failures:\r\n\r\nh4. environment_scenario-bad.rb\r\n\r\nSame pattern like the one below for “puppet_config”, “puppet_apply”, “puppet_module_install”, and “puppet_module_uninstall”:\r\n\r\n{noformat}\r\n-------------------------------------------------------------------------------\r\npuppet_config: *UNEXPECTED FAILURE*\r\n-------------------------------------------------------------------------------\r\nExpected the output:\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:38:in `get!': Could not find a directory environment named 'testing' anywhere in the path: /doesnotexist. Does the directory exist? (Puppet::Environments::EnvironmentNotFound)\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application_support.rb:29:in `push_application_context'\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:337:in `run'\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:124:in `run'\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute'\r\n\tfrom /opt/puppetlabs/bin/puppet:5:in `<main>'\r\n\r\nTo match: (?-mix:Could not find a directory environment named 'testing' anywhere in the path.*\\/etc\\/puppetlabs\\/code)\r\n{noformat} \r\n\r\nThe test sets the “environmentpath” in the “main” section of the puppet.conf file to “/doesnotexist” but the test appears to be failing because it expects the master’s “codedir” setting to appear in the message - “/etc/puppetlabs/code” - rather than the “environmentpath”.  The “environmentpath\" actually seems to me like the right value to include in the message here.  I can reproduce this locally by just running “puppet config … —environment testing” (with no master involved).\r\n\r\nh4. environment_scenario-default.rb\r\n\r\nSame pattern like the one below for “puppet_config”, “puppet_module_install”, and “puppet_module_uninstall”.\r\n\r\n{noformat}\r\n-------------------------------------------------------------------------------\r\npuppet_config: *UNEXPECTED FAILURE*\r\n-------------------------------------------------------------------------------\r\nExpected the output:\r\nbasemodulepath = /etc/puppetlabs/code/modules:/opt/puppetlabs/puppet/modules\r\nmodulepath = /etc/puppetlabs/code/environments/production/modules:/etc/puppetlabs/code/modules:/opt/puppetlabs/puppet/modules\r\nmanifest = /etc/puppetlabs/code/environments/production/manifests\r\nconfig_version = \r\n\r\nTo match: (?-mix:manifest.*\\/etc\\/puppetlabs\\/code\\/environments\\/\\/manifests$)\r\nAnd match: (?-mix:modulepath.*\\/etc\\/puppetlabs\\/code\\/environments\\/\\/modules:.+)\r\n{noformat}\r\n\r\nIn each case, it appears that the test is expecting the target directory to not include a directory environment name where the result of the test does - i.e., “production”.  Where directory environments are mandated by default in Puppet v4, I wonder if this is just a case where the default expectation needs to include the “production” directory environment name.\r\n\r\nh4. environment_scenario-master_environmentpath.rb\r\n\r\nFor the “puppet_apply” test, the following output appeared:\r\n\r\n{noformat}\r\n-------------------------------------------------------------------------------\r\npuppet_apply: *UNEXPECTED FAILURE*\r\n-------------------------------------------------------------------------------\r\nExpected the output:\r\nNotice: Compiled catalog for fd7ncmpi1suilmb.delivery.puppetlabs.net in environment testing in 0.33 seconds\r\nNotice: include directory testing environment testing_mod\r\nNotice: /Stage[main]/Testing_mod/Notify[include directory testing environment testing_mod]/message: defined 'message' as 'include directory testing environment testing_mod'\r\nNotice: Applied catalog in 0.08 seconds\r\n\r\nTo match: (?-mix:include default environment testing_mod)\r\n------\r\n{noformat}\r\n\r\nIt seems like the expectation that the output would use “default environment” is incorrect since the test is actually trying to use the “testing” directory environment.\r\n\r\n—\r\n\r\nFor the “puppet_module_install” test, the following output appeared:\r\n\r\n{noformat}\r\n-------------------------------------------------------------------------------\r\npuppet_module_install: *UNEXPECTED FAILURE*\r\n-------------------------------------------------------------------------------\r\nExpected the output:\r\nNotice: Preparing to install into /etc/puppetlabs/code/environments/testing/modules ...\r\nNotice: Downloading from https://forgeapi.puppetlabs.com ...\r\nNotice: Installing -- do not interrupt ...\r\n/etc/puppetlabs/code/environments/testing/modules\r\n└── pmtacceptance-nginx (v0.0.1)\r\n\r\nTo match: (?-mix:Preparing to install into \\/etc\\/puppetlabs\\/code\\/modules)\r\n------\r\nNotes: Runs in user mode and doesn't see the master environmenetpath setting.\r\n{noformat}\r\n\r\nAgain, the expectation that the message does not include “…environments/testing” in the path seems wrong since the test is specifying that the “testing” directory environment be used.\r\n\r\n—\r\n\r\nFor the “puppet_module_uninstall” test, the following output appeared:\r\n\r\n{noformat}\r\n-------------------------------------------------------------------------------\r\npuppet_module_uninstall: *UNEXPECTED FAILURE*\r\n-------------------------------------------------------------------------------\r\nExpected the output:\r\nNotice: Preparing to uninstall 'pmtacceptance-nginx' ...\r\nRemoved 'pmtacceptance-nginx' (v0.0.1) from /etc/puppetlabs/code/environments/testing/modules\r\n\r\nTo match: (?-mix:Removed.*pmtacceptance-nginx.*from \\/etc\\/puppetlabs\\/code\\/modules)\r\n------\r\n{noformat}\r\n\r\nSame comment as above for the “puppet_module_install” test.\r\n\r\nh4. all tests\r\n\r\nIt appears that across all of these tests that there’s a problem in the test cleanup where the occurrence of a failure is causing the test to abort with a stack trace:\r\n\r\n{noformat}\r\n#<NoMethodError: undefined method `empty?' for nil:NilClass>\r\n/var/lib/jenkins/workspace/platform_puppet-server_integration-system_no-conditional_full-master/LAYOUT/redhat6-64ma-64a/LDAP_TYPE/PLATFORM/label/beaker/ruby/puppet/acceptance/lib/puppet/acceptance/environment_utils.rb:355\r\n/var/lib/jenkins/workspace/platform_puppet-server_integration-system_no-conditional_full-master/LAYOUT/redhat6-64ma-64a/LDAP_TYPE/PLATFORM/label/beaker/ruby/puppet/acceptance/lib/puppet/acceptance/environment_utils.rb:354\r\n/var/lib/jenkins/workspace/platform_puppet-server_integration-system_no-conditional_full-master/LAYOUT/redhat6-64ma-64a/LDAP_TYPE/PLATFORM/label/beaker/ruby/puppet/acceptance/lib/puppet/acceptance/environment_utils.rb:354\r\n/var/lib/jenkins/workspace/platform_puppet-server_integration-system_no-conditional_full-master/LAYOUT/redhat6-64ma-64a/LDAP_TYPE/PLATFORM/label/beaker/ruby/puppet/acceptance/tests/environment/environment_scenario-bad.rb:53\r\n/var/lib/jenkins/workspace/platform_puppet-server_integration-system_no-conditional_full-master/LAYOUT/redhat6-64ma-64a/LDAP_TYPE/PLATFORM/label/beaker/vendor/bundler/ruby/1.9.1/gems/beaker-2.12.0/lib/beaker/test_case.rb:124\r\n/var/lib/jenkins/workspace/platform_puppet-server_integration-system_no-conditional_full-master/LAYOUT/redhat6-64ma-64a/LDAP_TYPE/PLATFORM/label/beaker/vendor/bundler/ruby/1.9.1/gems/beaker-2.12.0/lib/beaker/test_case.rb:124\r\n/usr/local/rvm/rubies/ruby-1.9.3-p484/lib/ruby/1.9.1/benchmark.rb:295\r\n/var/lib/jenkins/workspace/platform_puppet-server_integration-system_no-conditional_full-master/LAYOUT/redhat6-64ma-64a/LDAP_TYPE/PLATFORM/label/beaker/vendor/bundler/ruby/1.9.1/gems/beaker-2.12.0/lib/beaker/test_case.rb:121\r\n/var/lib/jenkins/workspace/platform_puppet-server_integration-system_no-conditional_full-master/LAYOUT/redhat6-64ma-64a/LDAP_TYPE/PLATFORM/label/beaker/vendor/bundler/ruby/1.9.1/gems/beaker-2.12.0/lib/beaker/test_suite.rb:286\r\n/var/lib/jenkins/workspace/platform_puppet-server_integration-system_no-conditional_full-master/LAYOUT/redhat6-64ma-64a/LDAP_TYPE/PLATFORM/label/beaker/vendor/bundler/ruby/1.9.1/gems/beaker-2.12.0/lib/beaker/test_suite.rb:283\r\n/var/lib/jenkins/workspace/platform_puppet-server_integration-system_no-conditional_full-master/LAYOUT/redhat6-64ma-64a/LDAP_TYPE/PLATFORM/label/beaker/vendor/bundler/ruby/1.9.1/gems/beaker-2.12.0/lib/beaker/test_suite.rb:283\r\n/var/lib/jenkins/workspace/platform_puppet-server_integration-system_no-conditional_full-master/LAYOUT/redhat6-64ma-64a/LDAP_TYPE/PLATFORM/label/beaker/vendor/bundler/ruby/1.9.1/gems/beaker-2.12.0/lib/beaker/test_suite.rb:325\r\n/var/lib/jenkins/workspace/platform_puppet-server_integration-system_no-conditional_full-master/LAYOUT/redhat6-64ma-64a/LDAP_TYPE/PLATFORM/label/beaker/vendor/bundler/ruby/1.9.1/gems/beaker-2.12.0/lib/beaker/cli.rb:151\r\n/var/lib/jenkins/workspace/platform_puppet-server_integration-system_no-conditional_full-master/LAYOUT/redhat6-64ma-64a/LDAP_TYPE/PLATFORM/label/beaker/vendor/bundler/ruby/1.9.1/gems/beaker-2.12.0/lib/beaker/cli.rb:93\r\n/var/lib/jenkins/workspace/platform_puppet-server_integration-system_no-conditional_full-master/LAYOUT/redhat6-64ma-64a/LDAP_TYPE/PLATFORM/label/beaker/vendor/bundler/ruby/1.9.1/gems/beaker-2.12.0/bin/beaker:6\r\n/var/lib/jenkins/workspace/platform_puppet-server_integration-system_no-conditional_full-master/LAYOUT/redhat6-64ma-64a/LDAP_TYPE/PLATFORM/label/beaker/vendor/bundler/ruby/1.9.1/bin/beaker:23\r\n/var/lib/jenkins/workspace/platform_puppet-server_integration-system_no-conditional_full-master/LAYOUT/redhat6-64ma-64a/LDAP_TYPE/PLATFORM/label/beaker/vendor/bundler/ruby/1.9.1/bin/beaker:23\r\nUnstubbing address forge.puppetlabs.com to IP 10.32.23.69 on machine fd7ncmpi1suilmb.delivery.puppetlabs.net\r\n{noformat}","closed_at":"2019-04-04T22:12:54.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4659","labels":"","state":"Closed","updated_at":"2019-04-04T22:12:54.000-0700","timestamp":1652285788.456258,"priority":"Normal","status_category":"Done","pull_request":4012},{"issue_id":"12697","title":"Signal traps are broken under ruby 2.0.0","url":"https://tickets.puppetlabs.com/browse/PUP-202","created_at":"2013-07-31T15:48:39.000-0700","number":"PUP-202","body":"Ruby 2.0.0 does not allow Puppet to call some signal handlers as we perform a lot of operations that are unsafe within the context of a signal trap. For example, anything that manipulates a mutex is off limits. This includes sending messages to Logger objects that are using mutexes internally:\n\n  http://www.mikeperham.com/2013/02/23/signal-handling-with-ruby/","closed_at":"2019-04-04T22:12:59.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-202","labels":"qa-reviewed","state":"Closed","updated_at":"2019-04-04T22:12:59.000-0700","timestamp":1652285790.118065,"priority":"Normal","status_category":"Done","pull_request":3932},{"issue_id":"125599","title":"Test can pick random GID that collides with existing GID","url":"https://tickets.puppetlabs.com/browse/PUP-6141","created_at":"2016-04-07T12:17:41.000-0700","number":"PUP-6141","body":"The test {{acceptance/tests/resource/group/should_modify_gid.rb}} picks two random GIDs when creating a group and changing its GID. If the generated GID already exists, the test will fail to create an new group with the same GID or will fail to change that a group's GID to a value already in use. To wit (from https://jenkins.puppetlabs.com/job/platform_puppet-server_integration-system_no-conditional_full-master/184/)\r\n{code}\r\nBegin ruby/puppet/acceptance/tests/resource/group/should_modify_gid.rb\r\n\r\nshould modify gid of existing group\r\n\r\n  * ensure that the group exists with gid 675492\r\n\r\nhem94kl8ueb74gd.delivery.puppetlabs.net (debian8-64-1) 07:30:42$ puppet resource group pl975867 ensure=present gid=675492\r\nNotice: /Group[pl975867]/ensure: created\r\ngroup { 'pl975867':\r\n  ensure => 'present',\r\n  gid    => '675492',\r\n}\r\n\r\nhem94kl8ueb74gd.delivery.puppetlabs.net (debian8-64-1) executed in 1.22 seconds\r\n\r\n  * ensure that we can modify the GID of the group to 34\r\n\r\nhem94kl8ueb74gd.delivery.puppetlabs.net (debian8-64-1) 07:30:44$ puppet resource group pl975867 ensure=present gid=34\r\nError: Could not set gid on group[pl975867]: Execution of '/usr/sbin/groupmod -g 34 pl975867' returned 4: groupmod: GID '34' already exists\r\nError: /Group[pl975867]/gid: change from 675492 to 34 failed: Could not set gid on group[pl975867]: Execution of '/usr/sbin/groupmod -g 34 pl975867' returned 4: groupmod: GID '34' already exists\r\ngroup { 'pl975867':\r\n  ensure => 'present',\r\n  gid    => '675492',\r\n}\r\n\r\nhem94kl8ueb74gd.delivery.puppetlabs.net (debian8-64-1) executed in 1.24 seconds\r\nWarning: \r\nmissing gid notice\r\n{code}","closed_at":"2019-04-04T22:13:00.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6141","labels":"","state":"Closed","updated_at":"2019-04-04T22:13:00.000-0700","timestamp":1652285790.22703,"priority":"Normal","status_category":"Done","pull_request":5223},{"issue_id":"110006","title":"Problems with the \"allow_duplicate_csr\" acceptance test","url":"https://tickets.puppetlabs.com/browse/PUP-5625","created_at":"2015-12-17T12:42:40.000-0800","number":"PUP-5625","body":"In running Puppet acceptance tests locally with Beaker, I encountered a couple of problems with the {{ticket_3360_allow_duplicate_csr_with_option_set.rb}} test:\r\n\r\n1) {{assert_not_equal}} not found.\r\n\r\nHere's a snippet of the failed output from one run:\r\n\r\n{noformat}\r\nTest Case ./ruby/puppet/acceptance/tests/ticket_3360_allow_duplicate_csr_with_option_set.rb reported: #<RuntimeError: PuppetAcceptance::DSL::Helpers.with_puppet_running_on failed (check backtrace for location) because: undefined method `assert_not_equal' for #<Beaker::TestCase:0x007f97945fd218>\r\n./ruby/puppet/acceptance/tests/ticket_3360_allow_duplicate_csr_with_option_set.rb:48:in `block (3 levels) in run_test'\r\n{noformat}\r\n\r\nI don't see a method called {{assert_not_equal}} in the version of minitest that we're pulling in from the Gemfile, 5.8.3.  I saw that some other gems alias {{refute_equal}}, which does exist in {{minitest}} to {{assert_not_equal}} - e.g., {{nokogiri}}.  This makes me think that this failure may not occur in full Jenkins CI runs because code that implicitly sources the alias is being run first.  This seems dangerous, though, and that it might be better to just use {{refute_equals}} directly from this test.  AFAICT, no other Puppet acceptance test uses {{assert_not_equal}}.\r\n\r\n2) The test appears to have been written with the expectation that it will iterate through all of the agents setup for the test run, submitting duplicate csrs for each.  It doesn't appear to take into account the pre-existence of other csrs in the ssldir, however, and could fail when those other csrs don't change.\r\n\r\n3) The test always skips over the master node.  So if a node is configured with both the master and agent roles, it will skip that node entirely - meaning that the test essentially does nothing for a pipeline configured to do just the master and agent on a single node.\r\n\r\n4) The regex that the test uses to locate certs in the cert list doesn't seem precise enough, leaving some csrs to be skipped over completely.\r\n","closed_at":"2019-04-04T22:13:02.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5625","labels":"qa-task","state":"Closed","updated_at":"2019-04-04T22:13:02.000-0700","timestamp":1652285791.237879,"priority":"Normal","status_category":"Done","pull_request":4516},{"issue_id":"76858","title":"Cannot load 'provider/network_route/routes.rb'","url":"https://tickets.puppetlabs.com/browse/PUP-4450","created_at":"2015-04-21T19:00:30.000-0700","number":"PUP-4450","body":"I have a Puppet codebase that runs fine with 3.7 + webrick. Under Puppet 4 it gives the following error:\r\n{code}\r\n# /opt/puppetlabs/bin/puppet agent -t --server `hostname` --noop\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nError: Could not retrieve catalog from remote server: Error 400 on SERVER: Evaluation Error: Error while evaluating a Virtual Query, Could not autoload puppet/type/network_route: Could not autoload puppet/provider/network_route/routes: no such file to load -- puppetx/filemapper at /var/puppet/environments/production/modules/dec/manifests/profiles/soe_network.pp:25:43 on node host.domain.com\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run{code}\r\n\r\nThe mentioned code is as follows:\r\n{code}create_resources(network_config, hiera_hash('network::interfaces', {}))\r\ncreate_resources(network_route, hiera_hash('network::routes', {}))\r\n{code}\r\n\r\nUsing the following Puppet Forge module: https://github.com/puppet-community/puppet-network (which depends on https://forge.puppetlabs.com/adrien/filemapper).\r\n\r\nRunning against `puppetserver foreground --debug` the error (and giant stack trace) appears multiple times in the file, here's the first occurrence:\r\n{code}2015-04-22 11:21:28,078 ERROR [qtp855067818-27] [puppet-server] Puppet Could not autoload puppet/provider/network_route/routes: no such file to load -- puppetx/filemapper\r\norg/jruby/RubyKernel.java:1071:in `require'\r\n/opt/puppetlabs/server/apps/puppetserver/puppet-server-release.jar!/META-INF/jruby.home/lib/ruby/shared/rubygems/core_ext/kernel_require.rb:55:in `require'\r\n/var/puppet/environments/production/modules/network/lib/puppet/provider/network_route/routes.rb:2:in `(root)'\r\norg/jruby/RubyKernel.java:1087:in `load'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:1:in `(root)'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:59:in `load_file'\r\norg/jruby/RubyArray.java:1613:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:74:in `loadall'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:72:in `loadall'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:203:in `loadall'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/metatype/manager.rb:116:in `newtype'\r\norg/jruby/RubyKernel.java:1087:in `load'\r\n/var/puppet/environments/production/modules/network/lib/puppet/type/network_route.rb:3:in `(root)'\r\n{code}\r\n\r\nI can post the full log if required.\r\n\r\nCommenting out all references to these types in my .pp files makes the problem go away.","closed_at":"2019-04-04T22:16:48.000-0700","comments":24,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4450","labels":"needs_decision","state":"Needs Information","updated_at":"2019-04-04T22:16:48.000-0700","timestamp":1652285792.618613,"priority":"Normal","status_category":"To Do","pull_request":4445},{"issue_id":"190058","title":"data-in-modules: lookup() and automatic class parameter lookup result in different values","url":"https://tickets.puppetlabs.com/browse/PUP-7515","created_at":"2017-05-10T03:28:42.000-0700","number":"PUP-7515","body":"When using the new \"data in modules\" feature we see a strange inconsistent behaviour in automatic class parameter lookup. We can not say if it is a bug in lookup() or in the class parameter lookup code. \r\n\r\nTo reproduce I created a simple test case: \r\n\r\n* I created a module \"mymodule\"\r\n\r\n{noformat}\r\nmymodule/\r\n├── data\r\n│   ├── common.yaml\r\n│   └── role\r\n│       ├── role1.yaml\r\n│       └── role2.yaml\r\n├── enc.sh\r\n├── hiera.yaml\r\n├── lib\r\n│   └── facter\r\n│       └── test.rb\r\n└── manifests\r\n    └── init.pp\r\n\r\n6 directories, 9 files\r\n{noformat}\r\n\r\nContent of the files. \r\n\r\nhiera.yaml:\r\n{noformat}\r\n---\r\nversion: 5\r\ndefaults:\r\n  datadir: data\r\n  data_hash: yaml_data\r\n\r\nhierarchy:\r\n\r\n  - name: \"Per-OS defaults\"\r\n    path: \"os/%{facts.os.family}.yaml\"\r\n\r\n  - name: \"Role Specific config\"\r\n    mapped_paths: [role, tmp, \"role/%{tmp}.yaml\"]\r\n\r\n  - name: \"Role Specific config (ENC)\"\r\n    mapped_paths: [enc_role, tmp, \"role/%{tmp}.yaml\"]\r\n\r\n  - name: \"Role Specific config (FACT)\"\r\n    mapped_paths: [fact_role, tmp, \"role/%{tmp}.yaml\"]\r\n\r\n  - name: \"Location Specific config\"\r\n    mapped_paths: [location, tmp, \"location/%{tmp}.yaml\"]\r\n\r\n  - name: \"Common data\"\r\n    path: \"common.yaml\"\r\n{noformat}\r\n\r\ndata/role/role1.yaml:\r\n{noformat}\r\n---\r\nmymodule::plugins:\r\n  plugin_role1:\r\n    ensure: present\r\n{noformat}\r\n\r\ndata/role/role2.yaml:\r\n{noformat}\r\n---\r\nmymodule::plugins:\r\n  plugin_role2:\r\n    ensure: present\r\n{noformat}\r\n\r\ndata/common.yaml:\r\n{noformat}\r\n---\r\nmymodule::version: '1.2.3-1'\r\nmymodule::plugins:\r\n  baseplugin1:\r\n    ensure: present\r\n    version: 1.2.3\r\n  baseplugin2:\r\n    ensure: present\r\n    version: 5.4.3\r\n{noformat}\r\n\r\nmanifests/init.pp:\r\n{noformat}\r\nclass mymodule (\r\n  Array $role     = [],\r\n  Array $location = [],\r\n  Hash $plugins   = {},\r\n  String $version = 'installed',\r\n) {\r\n\r\n  $pattern = \"%-30s: %s\"\r\n\r\n  notice(sprintf(\"======= Config ==========\"))\r\n  notice(sprintf($pattern,\"class param 'role'\", $role))\r\n  notice(sprintf($pattern,\"fact 'fact_role'\", $facts[fact_role]))\r\n  notice(sprintf($pattern,\"enc 'enc_role'\", $enc_role))\r\n  notice(sprintf($pattern,\"class param: 'version'\", $version))\r\n  notice(sprintf(\"======= Data ==========\"))\r\n  notice(sprintf($pattern,\"hiera\", hiera(\"mymodule::plugins\",{})))\r\n  notice(sprintf($pattern,\"hiera_hash\", hiera_hash(\"mymodule::plugins\",{})))\r\n  notice(sprintf($pattern,\"lookup\", lookup(\"mymodule::plugins\",Hash, 'deep',{})))\r\n  notice(sprintf($pattern,\"class param: 'plugins'\", $plugins))\r\n}\r\n{noformat}\r\n\r\nlib/facter/test.rb:\r\n{noformat}\r\nFacter.add(:fact_role) do\r\n  setcode do\r\n    distid = Facter.value(:role_txt)\r\n    if distid.nil?\r\n      []\r\n    else\r\n      distid.split(/\\s*,\\s*/)\r\n    end\r\n  end\r\nend\r\n{noformat}\r\n\r\n* Now I run the class with different setups:\r\n** with direct class parameters (class { mymodule: role => role1 })\r\n** with ENC provided roles\r\n** with facter provided roles\r\n\r\nResult is:\r\n\r\n* lookup() result is always the same\r\n* hiera_*() does not work at all\r\n* class parameter work totally diffent dependent of the way to call, which needs explaining\r\n\r\nNormal Lookup without and variables (looks ok and as expected):\r\n\r\n{noformat}\r\nmymodule # puppet apply --modulepath ../ -e 'include mymodule' --strict off\r\nNotice: Scope(Class[Mymodule]): ======= Config ==========\r\nNotice: Scope(Class[Mymodule]): class param 'role'            : []\r\nNotice: Scope(Class[Mymodule]): fact 'fact_role'              : []\r\nNotice: Scope(Class[Mymodule]): enc 'enc_role'                :\r\nNotice: Scope(Class[Mymodule]): class param: 'version'        : 1.2.3-1\r\nNotice: Scope(Class[Mymodule]): ======= Data ==========\r\nNotice: Scope(Class[Mymodule]): hiera                         : {}\r\nNotice: Scope(Class[Mymodule]): hiera_hash                    : {}\r\nNotice: Scope(Class[Mymodule]): lookup                        : {\"baseplugin1\"=>{\"ensure\"=>\"present\", \"version\"=>\"1.2.3\"}, \"baseplugin2\"=>{\"ensure\"=>\"present\", \"version\"=>\"5.4.3\"}}\r\nNotice: Scope(Class[Mymodule]): class param: 'plugins'        : {\"baseplugin1\"=>{\"ensure\"=>\"present\", \"version\"=>\"1.2.3\"}, \"baseplugin2\"=>{\"ensure\"=>\"present\", \"version\"=>\"5.4.3\"}}\r\n{noformat}\r\n\r\nNow with role selection in code (lookup OK, class parameter NOT):\r\n\r\n{noformat}\r\nmymodule # puppet apply --modulepath ../ -e 'class { mymodule: role => [\"role1\"] }' --strict off\r\nNotice: Scope(Class[Mymodule]): ======= Config ==========\r\nNotice: Scope(Class[Mymodule]): class param 'role'            : [\"role1\"]\r\nNotice: Scope(Class[Mymodule]): fact 'fact_role'              : []\r\nNotice: Scope(Class[Mymodule]): enc 'enc_role'                :\r\nNotice: Scope(Class[Mymodule]): class param: 'version'        : 1.2.3-1\r\nNotice: Scope(Class[Mymodule]): ======= Data ==========\r\nNotice: Scope(Class[Mymodule]): hiera                         : {}\r\nNotice: Scope(Class[Mymodule]): hiera_hash                    : {}\r\nNotice: Scope(Class[Mymodule]): lookup                        : {\"baseplugin1\"=>{\"ensure\"=>\"present\", \"version\"=>\"1.2.3\"}, \"baseplugin2\"=>{\"ensure\"=>\"present\", \"version\"=>\"5.4.3\"}, \"plugin_role1\"=>{\"ensure\"=>\"present\"}}\r\nNotice: Scope(Class[Mymodule]): class param: 'plugins'        : {\"baseplugin1\"=>{\"ensure\"=>\"present\", \"version\"=>\"1.2.3\"}, \"baseplugin2\"=>{\"ensure\"=>\"present\", \"version\"=>\"5.4.3\"}}\r\n{noformat}\r\n\r\nNow with two roles in code (lookup OK, class parameter NOT):\r\n\r\n{noformat}\r\nmymodule # puppet apply --modulepath ../ -e 'class { mymodule: role => [\"role1\", \"role2\"] }' --strict off\r\nNotice: Scope(Class[Mymodule]): ======= Config ==========\r\nNotice: Scope(Class[Mymodule]): class param 'role'            : [\"role1\", \"role2\"]\r\nNotice: Scope(Class[Mymodule]): fact 'fact_role'              : []\r\nNotice: Scope(Class[Mymodule]): enc 'enc_role'                :\r\nNotice: Scope(Class[Mymodule]): class param: 'version'        : 1.2.3-1\r\nNotice: Scope(Class[Mymodule]): ======= Data ==========\r\nNotice: Scope(Class[Mymodule]): hiera                         : {}\r\nNotice: Scope(Class[Mymodule]): hiera_hash                    : {}\r\nNotice: Scope(Class[Mymodule]): lookup                        : {\"baseplugin1\"=>{\"ensure\"=>\"present\", \"version\"=>\"1.2.3\"}, \"baseplugin2\"=>{\"ensure\"=>\"present\", \"version\"=>\"5.4.3\"}, \"plugin_role2\"=>{\"ensure\"=>\"present\"}, \"plugin_role1\"=>{\"ensure\"=>\"present\"}}\r\nNotice: Scope(Class[Mymodule]): class param: 'plugins'        : {\"baseplugin1\"=>{\"ensure\"=>\"present\", \"version\"=>\"1.2.3\"}, \"baseplugin2\"=>{\"ensure\"=>\"present\", \"version\"=>\"5.4.3\"}}\r\n{noformat}\r\n\r\nNow with ENC (lookup ok, class parameter again strange):\r\n\r\n{noformat}\r\nmymodule # ./enc.sh\r\n---\r\nparameters:\r\n  enc_role:\r\n    - role1\r\n    - role2\r\n\r\nshell # puppet apply --node_terminus=exec --external_nodes=$(pwd)/enc.sh --modulepath ../ -e 'include mymodule' --strict off\r\nNotice: Scope(Class[Mymodule]): ======= Config ==========\r\nNotice: Scope(Class[Mymodule]): class param 'role'            : []\r\nNotice: Scope(Class[Mymodule]): fact 'fact_role'              : []\r\nNotice: Scope(Class[Mymodule]): enc 'enc_role'                : [\"role1\", \"role2\"]\r\nNotice: Scope(Class[Mymodule]): class param: 'version'        : 1.2.3-1\r\nNotice: Scope(Class[Mymodule]): ======= Data ==========\r\nNotice: Scope(Class[Mymodule]): hiera                         : {}\r\nNotice: Scope(Class[Mymodule]): hiera_hash                    : {}\r\nNotice: Scope(Class[Mymodule]): lookup                        : {\"baseplugin1\"=>{\"ensure\"=>\"present\", \"version\"=>\"1.2.3\"}, \"baseplugin2\"=>{\"ensure\"=>\"present\", \"version\"=>\"5.4.3\"}, \"plugin_role2\"=>{\"ensure\"=>\"present\"}, \"plugin_role1\"=>{\"ensure\"=>\"present\"}}\r\nNotice: Scope(Class[Mymodule]): class param: 'plugins'        : {\"plugin_role1\"=>{\"ensure\"=>\"present\"}}\r\n{noformat}\r\n\r\nNow as FACT (lookup OK, class parameter STRANGE):\r\n\r\n{noformat}\r\nmymodule # FACTER_role_txt=role1,role2 puppet apply --modulepath ../ -e 'include mymodule' --strict off\r\nNotice: Scope(Class[Mymodule]): ======= Config ==========\r\nNotice: Scope(Class[Mymodule]): class param 'role'            : []\r\nNotice: Scope(Class[Mymodule]): fact 'fact_role'              : [\"role1\", \"role2\"]\r\nNotice: Scope(Class[Mymodule]): enc 'enc_role'                :\r\nNotice: Scope(Class[Mymodule]): class param: 'version'        : 1.2.3-1\r\nNotice: Scope(Class[Mymodule]): ======= Data ==========\r\nNotice: Scope(Class[Mymodule]): hiera                         : {}\r\nNotice: Scope(Class[Mymodule]): hiera_hash                    : {}\r\nNotice: Scope(Class[Mymodule]): lookup                        : {\"baseplugin1\"=>{\"ensure\"=>\"present\", \"version\"=>\"1.2.3\"}, \"baseplugin2\"=>{\"ensure\"=>\"present\", \"version\"=>\"5.4.3\"}, \"plugin_role2\"=>{\"ensure\"=>\"present\"}, \"plugin_role1\"=>{\"ensure\"=>\"present\"}}\r\nNotice: Scope(Class[Mymodule]): class param: 'plugins'        : {\"plugin_role1\"=>{\"ensure\"=>\"present\"}}\r\n{noformat}","closed_at":"2019-04-04T22:17:26.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7515","labels":"","state":"Closed","updated_at":"2019-04-04T22:17:26.000-0700","timestamp":1652285794.411678,"priority":"Normal","status_category":"Done","pull_request":5944},{"issue_id":"103812","title":"small improvements to module generator","url":"https://tickets.puppetlabs.com/browse/PUP-5462","created_at":"2015-11-01T18:29:21.000-0800","number":"PUP-5462","body":null,"closed_at":"2019-04-04T22:20:13.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5462","labels":"puppethack","state":"Closed","updated_at":"2019-04-04T22:20:13.000-0700","timestamp":1652285794.721596,"priority":"Normal","status_category":"Done","pull_request":4396},{"issue_id":"15954","title":"(#22699) set value_collection for boolean params","url":"https://tickets.puppetlabs.com/browse/PUP-446","created_at":"2013-10-01T12:14:33.000-0700","number":"PUP-446","body":"I'm not entirely confident that this is the right way to test things, since it involves calling initvars.\r\n","closed_at":"2019-04-04T22:20:13.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-446","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:13.000-0700","timestamp":1652285794.92673,"priority":"Normal","status_category":"Done","pull_request":3869},{"issue_id":"71800","title":"File resources with defined content don't output contents with ensure=>present","url":"https://tickets.puppetlabs.com/browse/PUP-4231","created_at":"2015-03-16T15:23:28.000-0700","number":"PUP-4231","body":"When creating a file resource with {{ensure=>present}} and specified contents, the specified contents aren't logged:\r\n{noformat}\r\n[root@puppet-eli file]# rm -f /root/somefile\r\n[root@puppet-eli file]# puppet apply -e 'file { \"/root/somefile\": ensure=>present, content=>\"hello\" }'\r\nNotice: Compiled catalog for puppet-eli.localdomain in environment production in 0.12 seconds\r\nNotice: /Stage[main]/Main/File[/root/somefile]/ensure: created\r\nNotice: Finished catalog run in 0.26 seconds\r\n{noformat}\r\nBy contrast, here's the log with {{ensure=>file}}:\r\n{noformat}\r\n[root@puppet-eli file]# rm -f /root/somefile\r\n[root@puppet-eli file]# puppet apply -e 'file { \"/root/somefile\": ensure=>file, content=>\"hello\" }'\r\nNotice: Compiled catalog for puppet-eli.localdomain in environment production in 0.11 seconds\r\nNotice: /Stage[main]/Main/File[/root/somefile]/ensure: defined content as '{md5}5d41402abc4b2a76b9719d911017c592'\r\nNotice: Finished catalog run in 0.26 seconds\r\n{noformat}","closed_at":"2019-04-04T22:20:15.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4231","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:15.000-0700","timestamp":1652285795.347122,"priority":"Normal","status_category":"Done","pull_request":3787},{"issue_id":"35510","title":"Puppet::Agent::Locker#lock doesn't return whether it acquired the lock or not","url":"https://tickets.puppetlabs.com/browse/PUP-2573","created_at":"2014-05-14T13:03:17.000-0700","number":"PUP-2573","body":"The [Puppet::Agent::Locker#lock|https://github.com/puppetlabs/puppet/blob/3.5.1/lib/puppet/agent/locker.rb] method documentation says {quote}Return true/false depending on whether we get the lock.{quote} But that's not actually what happens. Instead it returns whatever the yielded block returns. As a result, there's no way to know if the lock was successfully acquired:\r\n\r\n{code}\r\n  def lock\r\n    if lockfile.lock\r\n      begin\r\n        yield\r\n      ensure\r\n        lockfile.unlock\r\n      end\r\n    end\r\n  end\r\n{code}\r\n","closed_at":"2019-04-04T22:20:15.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2573","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:15.000-0700","timestamp":1652285795.451766,"priority":"Normal","status_category":"Done","pull_request":3934},{"issue_id":"59857","title":"console format should pretty print nested structures","url":"https://tickets.puppetlabs.com/browse/PUP-3706","created_at":"2014-11-26T07:35:53.000-0800","number":"PUP-3706","body":"The code for the console format says it should pretty print, but it doesn't in fact do that.\r\n\r\nQA\r\n--\r\nrisk: medium \r\nprobability: medium\r\nseverity: low\r\ntest layer: unit","closed_at":"2019-04-04T22:20:15.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3706","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:15.000-0700","timestamp":1652285795.557122,"priority":"Normal","status_category":"Done","pull_request":3672},{"issue_id":"42620","title":"FileUtils implementation broke compare_stream","url":"https://tickets.puppetlabs.com/browse/PUP-2946","created_at":"2014-07-17T07:37:45.000-0700","number":"PUP-2946","body":"{{FileUtils.compare_stream}} implementation in ruby 1.9.3 was doing something along the lines of\r\n\r\n{code:ruby}\r\n    a = b = nil\r\n    while something\r\n      a = as.read size\r\n      b = bs.read size\r\n      return false if a != b\r\n    end\r\n{code}\r\n\r\n{{FileUtils.compare_stream}} in 2.0 instead does this:\r\n\r\n{code:ruby}\r\n    a = \"\"\r\n    b = \"\"\r\n    while something\r\n      as.read size, a\r\n      bs.read size, b\r\n      return false if a != b\r\n    end\r\n{code}\r\n\r\nwhich is a problem since default encoding for strings is UTF-8 and when {{File#read}} reads into UTF-8 string it remains UTF-8 but when {{StringIO#read}} reads into UTF-8 string it becomes encoding of StringIO source string, which is ASCII for {{FileBucket::File}} contents.\r\n\r\nThis leads to problems with backing up files and under certain conditions gives errors like:\r\n\r\n{{Error: Could not back up /bin/whatever.pyc: Got passed new contents for sum \\{md5\\}ca60cf7b168557fb8c34be106b8c4ae8}}\r\n","closed_at":"2019-04-04T22:20:17.000-0700","comments":17,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2946","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:17.000-0700","timestamp":1652285795.976528,"priority":"Normal","status_category":"Done","pull_request":2938},{"issue_id":"42759","title":"\"masterlog\" setting is dead code","url":"https://tickets.puppetlabs.com/browse/PUP-2953","created_at":"2014-07-17T17:20:53.000-0700","number":"PUP-2953","body":"http://docs.puppetlabs.com/references/latest/configuration.html#masterlog\r\n\r\n\"Where puppet master logs. This is generally not used, since syslog is the default log destination.\"\r\n\r\nIf you ack the Puppet source, you'll see that this setting is never referenced by any other area of code. It's dead, Jim.\r\n\r\n(The similar puppetdlog setting -- http://docs.puppetlabs.com/references/latest/configuration.html#puppetdlog -- is apparently only used on systems that are neither POSIX nor Windows.)","closed_at":"2019-04-04T22:20:18.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2953","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:18.000-0700","timestamp":1652285796.410623,"priority":"Normal","status_category":"Done","pull_request":2912},{"issue_id":"26269","title":"\"incorrect header check\" using Ruby 2","url":"https://tickets.puppetlabs.com/browse/PUP-1680","created_at":"2014-02-12T15:48:16.000-0800","number":"PUP-1680","body":"I haven't found anything out there so far, so I thought I'd just document it while I'm at it.\r\n\r\nWe ran into some other problem with the changes in net/http Ruby 2.1.0 introduced around the handling of gzip/deflate encoded content. This MIGHT be related.\r\nSo far we haven't been able to fix it.\r\n\r\n{code}\r\nError: incorrect header check\r\nError: /Stage[main]/Nginx::Nginx/File[nginx-default-50x]/content: change from {md5}d74f9cdd604653c22c6752c46fffd587 to {md5}d45793c5a781c31eca1af96e394bfb84 failed: incorrect header check\r\n{code}\r\n\r\nThe code in question (probably not very relevant):\r\n{code}\r\n  file { \"nginx-default-50x\":\r\n    require => [ Package[\"nginx\"], Exec[\"nginx-default-dir\"], ],\r\n    path => \"/usr/share/nginx/html/50x.html\",\r\n    source => \"puppet:///modules/nginx/50x-plain.html\",\r\n    mode => 444,\r\n  }\r\n{code}","closed_at":"2019-04-04T22:20:20.000-0700","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1680","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:20.000-0700","timestamp":1652285796.83573,"priority":"Normal","status_category":"Done","pull_request":3057},{"issue_id":"51116","title":"There's no way the 'bsd' service provider will work on OpenBSD","url":"https://tickets.puppetlabs.com/browse/PUP-3243","created_at":"2014-09-15T01:12:13.000-0700","number":"PUP-3243","body":"OpenBSD has it's own service provider and the 'bsd' service provider will certainly not work on OpenBSD. Therefore remove 'OpenBSD' from the 'confine' list.","closed_at":"2019-04-04T22:20:22.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3243","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:22.000-0700","timestamp":1652285808.726211,"priority":"Normal","status_category":"Done","pull_request":3004},{"issue_id":"81609","title":"filebucket fails when environment is specified","url":"https://tickets.puppetlabs.com/browse/PUP-4653","created_at":"2015-05-26T14:03:09.000-0700","number":"PUP-4653","body":"Since the {{0.25}} days, the {{filebucket}} client in the form of {{Puppet::FileBucket::Dipper}} has interfaces with the indirector by constructing URLs in the following fashion:\r\n\r\n{code}\r\n@rest_path = \"https://#{server}:#{port}/#{environment}/file_bucket_file/\"\r\n# then\r\ndest_path = \"#{@rest_path}#{file_bucket_file.name}/#{files_original_path}\"\r\n{code}\r\n\r\nThe indirector breaks this down into its fields in {{Puppet::Indirector::Request#set_uri_key}}.\r\n\r\n{code}\r\nenv, indirector, @key = URI.unescape(uri.path.sub(/^\\//, '')).split('/',3)\r\n@key ||= ''\r\nself.environment = env unless env == ''\r\n{code}\r\n\r\nAll of this is quite unecessary because\r\n\r\n 1. the indirection implicitly follows from the indirected class\r\n 2. the environment is not significant for filebucket interactions\r\n\r\n(As an aside, the API does not construct URLs like this anymore, either - the environment is a parameter and not a part of the URI path. This is not important here, though, because these URLs never hit the wire. They are only for the benefit of the {{Indirector::Request}} class.)\r\n\r\nA consequence of this construct is that new indirector uses with URLs in keys will be misinterpreted by the {{Request}} class.\r\n\r\nIt would be beneficial to transform these internally used URLs into a form that\r\n\r\n 1. confers only the necessary information to the indirector\r\n 2. does not clash with other possible URLs\r\n\r\nh3. Summary\r\n\r\nAlthough this sounds like a network change, it's not. It only changes how the client internally manages the filebucket request, but doesn't affect how the client sends the request on the wire. It also doesn't change file manifests, e.g. filebucket resources, etc.","closed_at":"2019-04-04T22:20:23.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4653","labels":"community;indirector","state":"Closed","updated_at":"2019-04-04T22:20:23.000-0700","timestamp":1652285809.153688,"priority":"Normal","status_category":"Done","pull_request":3910},{"issue_id":"61116","title":"Don't try to chown log file destination when non-root","url":"https://tickets.puppetlabs.com/browse/PUP-3756","created_at":"2014-12-09T23:45:43.000-0800","number":"PUP-3756","body":"When puppet is using a log file destination, it will always try to chown owner and group to {{Puppet\\[:user\\]}} and {{Puppet\\[:group\\]}}, which will fail when running as non-root:\r\n\r\n{noformat}\r\n$ bundle exec puppet apply --logdest /tmp/log -e \"notify { 'hello': }\"\r\n$ less /tmp/log\r\n2014-12-09 23:42:44 -0800 Puppet (err): Unable to set ownership of log file\r\n...\r\n2014-12-09 23:42:45 -0800 Puppet (notice): hello\r\n{noformat}\r\n\r\nSee also https://github.com/puppetlabs/puppet/pull/3023#issuecomment-53752004","closed_at":"2019-04-04T22:20:24.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3756","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:24.000-0700","timestamp":1652285809.706606,"priority":"Normal","status_category":"Done","pull_request":3416},{"issue_id":"54933","title":"Puppet::Util::Execution.execute should not switch uid if it already matches the euid","url":"https://tickets.puppetlabs.com/browse/PUP-3457","created_at":"2014-10-14T07:54:46.000-0700","number":"PUP-3457","body":"we have a provider with the following getter and setter:\r\n\r\n{code}\r\nPuppet::Type.type(:git_config).provide(:git_config) do\r\n\r\n  mk_resource_methods\r\n\r\n  def value\r\n    require 'etc'\r\n    user    = @property_hash[:user]    = @resource[:user]\r\n    key     = @property_hash[:key]     = @resource[:key]\r\n    section = @property_hash[:section] = @resource[:section]\r\n    home    = Etc.getpwnam(user)[:dir]\r\n\r\n    current = Puppet::Util::Execution.execute(\r\n      \"git config --global --get #{section}.#{key}\",\r\n      :uid => user,\r\n      :failonfail => false,\r\n      :custom_environment => { 'HOME' => home }\r\n    )\r\n    @property_hash[:value] = current.strip\r\n    @property_hash[:value]\r\n  end\r\n\r\n  def value=(value)\r\n    require 'etc'\r\n    user    = @resource[:user]\r\n    key     = @resource[:key]\r\n    section = @resource[:section]\r\n    home    = Etc.getpwnam(user)[:dir]\r\n\r\n    Puppet::Util::Execution.execute(\r\n      \"git config --global #{section}.#{key} '#{value}'\",\r\n      :uid => user,\r\n      :failonfail => true,\r\n      :custom_environment => { 'HOME' => home }\r\n    )\r\n  end\r\nend\r\n{code}\r\n\r\nduring development, most unintuitively, the getter would \"work\" (we assumed because of {{:failonfail}}, but the setter wouldn't.\r\n\r\nit turns out the reason was that we supplied {{:uid}}, and puppet tries set it, even though the user executing puppet was the one provided in {{:uid}}\r\n\r\nso the question: should we try to switch to the provided uid, or should we first check if we aren't already there?","closed_at":"2019-04-04T22:20:26.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3457","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:26.000-0700","timestamp":1652285810.769611,"priority":"Normal","status_category":"Done","pull_request":3192},{"issue_id":"15963","title":"(PR) (#22703) Force encoding of comment value to ASCII-8BIT","url":"https://tickets.puppetlabs.com/browse/PUP-451","created_at":"2013-10-01T12:52:41.000-0700","number":"PUP-451","body":"The comment field for user resources can often contain non-ASCII characters. Unfortunately, Puppet retrieves the existing value (current_value) as ASCII-8BIT, but strings containing non-ASCII characters are automatically turned into UTF-8, resulting in a failure to concatenate the strings in change_to_s, with messages such as the following in Puppet 3.2.4 with Ruby 1.9.3:\r\n\r\nError: Could not convert change 'comment' to string: incompatible character encodings: ASCII-8BIT and UTF-8\r\nError: Could not convert change 'comment' to string: incompatible character encodings: ASCII-8BIT and UTF-8\r\nError: /User[rpinson]: Could not evaluate: Puppet::Util::Log requires a message\r\nwhich is due to the fact that current_value is encoded in ASCII-8BIT, but newvalue is in UTF-8 and not \"softly\" convertible when reaching change_to_s in property.rb.\r\n\r\nIn order to allow proper management of non-ASCII characters in the comment field, this PR forces an ASCII-8BIT encoding on the comment property value in the type.\r\n\r\nNote: trying to force the encoding in Puppet code (using e.g. inline_template) doesn't solve anything, and patching change_to_s to force the encoding results in the resource not being idempotent anymore, since comparison fails (but change_to_s doesn't crash anymore).","closed_at":"2019-04-04T22:20:28.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-451","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:28.000-0700","timestamp":1652285811.325994,"priority":"Normal","status_category":"Done","pull_request":4375},{"issue_id":"97225","title":"Pip package provider fails to honor HTTP proxy settings","url":"https://tickets.puppetlabs.com/browse/PUP-5212","created_at":"2015-09-09T02:55:30.000-0700","number":"PUP-5212","body":"Having some trouble getting the pip package provider to work behind a http proxy.\r\n\r\nI know that the {{install_options}} feature for pip hasn't been backported to puppet 3.8.x, which is unfortunate (will this happen btw?), but I've found a reasonable workaround by setting a global proxy option in /etc/pip.conf (on unixy systems) - see [https://pip.pypa.io/en/latest/user_guide.html#config-file]. I can confirm that, once this config file is in place, manually running {{pip install --upgrade $pkg}} works via the proxy, even without environment variables being set. Trying this via puppet's native pip provider fails with the following error:\r\n\r\n{code}\r\nError: Could not get latest version: Timeout while contacting pypi.python.org: execution expired\r\nError: /Package[$pkg]/ensure: change from 1.0.0 to latest failed: Could not get latest version: Timeout while contacting pypi.python.org: execution expired\r\n{code}\r\n\r\nHave tried a few variations, including:\r\n{code}\r\npuppet resource package $pkg ensure=latest provider=pip\r\npuppet resource --http_proxy_host=proxy.example.com --http_proxy_port=3128 package $pkg ensure=latest provider=pip\r\n{code}\r\n\r\nRuby is still new to me, but I think the problem is on this line: [https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/package/pip.rb#L63]\r\n\r\nWhich, according to [this reference on the XMLRPC::Client class|http://docs.ruby-lang.org/en/2.0.0/XMLRPC/Client.html#method-c-new2], might need to be modified to pass proxy details?\r\n\r\nIt would be good to get this fixed in 3.8.x - I'd like to avoid dumping the native pip package provider....","closed_at":"2019-04-04T22:20:29.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5212","labels":"package;pip;provider;proxy;puppethack","state":"Closed","updated_at":"2019-04-04T22:20:29.000-0700","timestamp":1652285811.757771,"priority":"Normal","status_category":"Done","pull_request":4503},{"issue_id":"66242","title":"Applying catalogs spends an inordinate amount of time checking for failed dependencies.","url":"https://tickets.puppetlabs.com/browse/PUP-3930","created_at":"2015-01-30T10:36:46.000-0800","number":"PUP-3930","body":"I profiled `puppet agent --test` on one of my servers using stackprof [1] on Ruby 2.1.\r\n\r\nSomething like 30% or more of the time was spent in `Puppet::Graph::SimpleGraph#upstream_from_vertex`, called from `Puppet::Transaction#failed_dependencies?`\r\n\r\nIt turns out that, while evaluating the resource graph, when considering a resource, we look at *the complete set of transitive dependencies* to evaluate whether any of them have failed. This is hugely expensive, and moreover, is completely wasted work in the success case where no resources have failures.\r\n","closed_at":"2019-04-04T22:20:34.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3930","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:34.000-0700","timestamp":1652285813.534262,"priority":"Normal","status_category":"Done","pull_request":3591},{"issue_id":"62335","title":"puppet resource file 'mode' parameter is 3-digit notation instead of 4-digit","url":"https://tickets.puppetlabs.com/browse/PUP-3787","created_at":"2014-12-22T10:04:48.000-0800","number":"PUP-3787","body":"Per https://docs.puppetlabs.com/references/latest/type.html#file-attribute-mode, numeric modes should use four-digit octal notation for files. However, the output of \"puppet resource file <filename>\" shows the mode in three-digit octal notation:\r\n\r\n{noformat}\r\n[rnelson0@build ~]$ puppet apply -e \"file {'/home/rnelson0/test': ensure => file, mode => '0644'}\"\r\nNotice: Compiled catalog for build.nelson.va in environment production in 0.06 seconds\r\nNotice: /Stage[main]/Main/File[/home/rnelson0/test]/ensure: created\r\nNotice: Finished catalog run in 0.02 seconds\r\n[rnelson0@build ~]$ puppet resource file /home/rnelson0/test\r\nfile { '/home/rnelson0/test':\r\n  ensure  => 'file',\r\n  content => '{md5}d41d8cd98f00b204e9800998ecf8427e',\r\n  ctime   => '2014-12-22 18:02:28 +0000',\r\n  group   => '501',\r\n  mode    => '644',\r\n  mtime   => '2014-12-22 18:02:28 +0000',\r\n  owner   => '501',\r\n  type    => 'file',\r\n}\r\n{noformat}\r\n\r\nThis makes it difficult to use puppet resource to discover and document existing files and preserve best practices for defining those resources. The 'mode' value should be four-digit octal notation as the documentation describes.","closed_at":"2019-04-04T22:20:34.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3787","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:34.000-0700","timestamp":1652285813.638022,"priority":"Normal","status_category":"Done","pull_request":3458},{"issue_id":"59914","title":"Allow zfs to create a zvol","url":"https://tickets.puppetlabs.com/browse/PUP-3713","created_at":"2014-11-26T14:23:03.000-0800","number":"PUP-3713","body":"The volsize property must be specified explicity when creating a zvol and can not be passed as a property. Detect this in zfs:create\r\n\r\n{code}\r\n--- puppet/provider/zfs/zfs.rb\t2014-06-10 09:08:19.000000000 +1200\r\n+++ puppet/provider/zfs/zfs.rb\t2014-11-27 10:39:05.286217988 +1300\r\n@@ -15,7 +15,11 @@\r\n     Puppet::Type.type(:zfs).validproperties.each do |property|\r\n       next if property == :ensure\r\n       if value = @resource[property] and value != \"\"\r\n-        properties << \"-o\" << \"#{property}=#{value}\"\r\n+\tif property == :volsize\r\n+\t  properties << \"-V\" << \"#{value}\"\r\n+\telse\r\n+          properties << \"-o\" << \"#{property}=#{value}\"\r\n+\tend\r\n       end\r\n     end\r\n     properties\r\n{code}\r\n","closed_at":"2019-04-04T22:20:35.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3713","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:35.000-0700","timestamp":1652285813.958871,"priority":"Normal","status_category":"Done","pull_request":6293},{"issue_id":"96635","title":"undefined method `[]' for Puppet::Transaction::Event with certain reports","url":"https://tickets.puppetlabs.com/browse/PUP-5192","created_at":"2015-09-03T06:33:59.000-0700","number":"PUP-5192","body":"When Calling the function {color:#205081}\"YAML.load_file(path)\"{color} with a yaml file where a {color:#59afe1}resource_statuses: member{color} has {color:#d04437}events:{color} non-empty, we get a {color:#d04437}\"undefined method `[]' for #<Puppet::Transaction::Event:0x0000000341e3f0>{color}\" error.\r\n\r\nSee attached files and gist.","closed_at":"2019-04-04T22:20:35.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5192","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:35.000-0700","timestamp":1652285814.173467,"priority":"Normal","status_category":"Done","pull_request":4262},{"issue_id":"55414","title":"Regex problem with an SELinux context type with a dash","url":"https://tickets.puppetlabs.com/browse/PUP-3481","created_at":"2014-10-16T15:27:36.000-0700","number":"PUP-3481","body":"I have a file on the system with the following SELinux context \r\n{code}\r\n[root@sut ~]# matchpathcon /etc/my-app/my-config.cfg\r\n/etc/my-app/my-config.cfg    system_u:object_r:my-app_config_t:s0\r\n{code}\r\n\r\nI also have a File\\[\"/etc/my-app/my-config.cfg\"\\] resource defined in my manifests, which doesn't call out the seltype attribute, so according [the documentation|https://docs.puppetlabs.com/references/stable/type.html#file-attribute-seltype] , it should get the type from matchpathcon, and set it to \"my-app_config_t\".\r\n\r\nHowever, it's setting it to \"my\" instead.\r\n{code}\r\nOct 16 13:13:43 src@sut puppet-agent[902]: (/File[/etc/my-app/my-config/cfg]/seltype) seltype changed 'etc_t' to 'my'\r\n{code}\r\n\r\nI think I've tracked this down to the regex in parse_selinux_context() in utils/selinux.rb, where the 'type' section of the regexp stops accepting characters at the dash in the \"my-app_config_t\"  \r\n\r\nI think it would be better if the regexp were something more lenient , like \r\n{code}\r\n/^([^:]+):([^:]+):([^:]+)(?::([a-zA-Z0-9:,._-]+))?/\r\n{code}","closed_at":"2019-04-04T22:20:37.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3481","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:37.000-0700","timestamp":1652285814.9063,"priority":"Normal","status_category":"Done","pull_request":3478},{"issue_id":"30178","title":"PR (2477) Multiple values for diff_args causes diff execution failure","url":"https://tickets.puppetlabs.com/browse/PUP-2073","created_at":"2014-03-26T16:01:23.000-0700","number":"PUP-2073","body":"Inserting multiple switches for diff_args in puppet.conf causes diff execution to fail.  I experienced this in both Windows and Linux.\r\n\r\nExample:\r\ndiff_args     = -u --strip-trailing-cr\r\n\r\nThis commit will fix the problem:\r\nhttps://github.com/mshean/puppet/commit/7972585779f3a12cfe62449df3c5e9d3b96c6136\r\n","closed_at":"2019-04-04T22:20:39.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2073","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:39.000-0700","timestamp":1652285815.437602,"priority":"Normal","status_category":"Done","pull_request":2477},{"issue_id":"42741","title":"Puppet should only log  facts in debug mode","url":"https://tickets.puppetlabs.com/browse/PUP-2952","created_at":"2014-07-17T16:22:37.000-0700","number":"PUP-2952","body":" In environments with lots of facts puppet agent can fill the screen and log files with loading fact messages. This is only useful when debugging and should thus be only enabled when in debug mode.\r\n\r\n{code}\r\nrickon:~# puppet agent --test\r\nInfo: Retrieving plugin\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/facter_dot_d.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/thunderbird_version.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/rabbitmq_erlang_cookie.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/is_lxc.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/collectd_version.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/puppet_vardir.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/staging_windir.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/root_home.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/sunray.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/concat_basedir.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/dns_ip_4.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/iptables_version.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/raidtype.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/staging_http_get.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/kernel_type.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/iptables_persistent_version.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/dns_ip_6.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/hardware_platform.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/pe_version.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/ganeti_cluster.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/dept.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/nvidia_graphics_device.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/os_maj_version.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/ip6tables_version.rb\r\nInfo: Loading facts in /var/lib/puppet/lib/facter/raid_devices.rb\r\nInfo: Caching catalog for rickon.cat.pdx.edu\r\nInfo: Applying configuration version '1405637813'\r\nNotice: Finished catalog run in 14.01 seconds\r\n{code}\r\n\r\nWith the patch applied\r\n\r\n{code}\r\nrickon:~# puppet agent -t\r\nInfo: Retrieving plugin\r\nInfo: Caching catalog for rickon.cat.pdx.edu\r\nInfo: Applying configuration version '1405637813'\r\nNotice: Finished catalog run in 14.01 seconds\r\n{code}\r\n","closed_at":"2019-04-04T22:20:40.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2952","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:40.000-0700","timestamp":1652285815.971567,"priority":"Normal","status_category":"Done","pull_request":2886},{"issue_id":"18815","title":"Status unchanged when \"Could not apply complete catalog\"","url":"https://tickets.puppetlabs.com/browse/PUP-735","created_at":"2013-11-13T10:00:30.000-0800","number":"PUP-735","body":"When puppet agent report:\r\n\r\n{noformat}\r\nCould not apply complete catalog: Found 1 dependency cycle: ... Try the '--graph' option and opening the resulting '.dot' file in OmniGraffle or GraphViz\r\n{noformat}\r\nthere is no failed nodes.\r\n\r\nRisk Assessment: Medium\r\nProbability: Medium\r\nImpact: Low\r\nTest Layer: acceptance","closed_at":"2019-04-04T22:20:41.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-735","labels":"redmine","state":"Closed","updated_at":"2019-04-04T22:20:41.000-0700","timestamp":1652285816.303174,"priority":"Normal","status_category":"Done","pull_request":5763},{"issue_id":"25461","title":"PR (2342) cron resources with target specified generate duplicate entries","url":"https://tickets.puppetlabs.com/browse/PUP-1585","created_at":"2014-02-04T15:55:08.000-0800","number":"PUP-1585","body":"The following resource results in duplicate cron entry added with each puppet run: \r\n{noformat}    cron { 'bacula_vacuumdb':\r\n      ensure   => present,\r\n      minute   => '00',\r\n      hour     => '12',\r\n      command  => 'vacuumdb --analyze -U postgres bacula',\r\n      target   => 'postgres',\r\n    }{noformat}\r\n\r\nExample of Cron: \r\n{noformat}~# crontab -l -u postgres \r\n# HEADER: This file was autogenerated at 2014-02-04 16:30:20 -0700 by puppet.\r\n# HEADER: While it can still be managed manually, it is definitely not recommended.\r\n# HEADER: Note particularly that the comments starting with 'Puppet Name' should\r\n# HEADER: not be deleted, as doing so could cause duplicate cron jobs.\r\n# Puppet Name: bacula_vacuumdb\r\n0 12 * * * vacuumdb --analyze -U postgres bacula\r\n# Puppet Name: bacula_vacuumdb\r\n0 12 * * * vacuumdb --analyze -U postgres bacula{noformat}\r\n","closed_at":"2019-04-04T22:20:42.000-0700","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1585","labels":"provider_crontab","state":"Closed","updated_at":"2019-04-04T22:20:42.000-0700","timestamp":1652285817.045284,"priority":"Normal","status_category":"Done","pull_request":2342},{"issue_id":"79701","title":"'bsd' service provider non-functional","url":"https://tickets.puppetlabs.com/browse/PUP-4562","created_at":"2015-05-12T03:58:22.000-0700","number":"PUP-4562","body":"The generic 'bsd' service provider was still using @model instead of @resource, therefore it was not working at all. There are currently no spec tests (or users?) for this provider which is probably why it went unnoticed for so long.\r\n\r\nCould that be backported to the 3.8 stable branches too?","closed_at":"2019-04-04T22:20:43.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4562","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:43.000-0700","timestamp":1652285817.14986,"priority":"Normal","status_category":"Done","pull_request":3918},{"issue_id":"35998","title":"expiry parameter definition in user resource documentation needs update","url":"https://tickets.puppetlabs.com/browse/PUP-3137","created_at":"2014-05-17T22:08:23.000-0700","number":"PUP-3137","body":"When running through the \"Resource\" quest and reading expiry parameter portion from the output of 'puppet describe user' one sees:\r\n<snipped>\r\n- **expiry**\r\n    The expiry date for this user. Must be provided in\r\n    a zero-padded YYYY-MM-DD format --- e.g. 2010-02-19.\r\n    If you want to make sure the user account does never\r\n    expire, you can pass the special value `absent`.\r\n    Valid values are `absent`. Values can match `/^\\d{4}-\\d{2}-\\d{2}$/`.\r\n    Requires features manages_expiry.\r\n\r\nIt would be clearer if phrased as, \"If you want to ensure the user account never expires, you can ...\"","closed_at":"2019-04-04T22:20:43.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3137","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:43.000-0700","timestamp":1652285817.253053,"priority":"Minor","status_category":"Done","pull_request":3013},{"issue_id":"62698","title":"HP-UX User Provider not resetting password expiration after changing password hash.","url":"https://tickets.puppetlabs.com/browse/PUP-3801","created_at":"2014-12-31T09:06:29.000-0800","number":"PUP-3801","body":"A previous update I made to the 2.7.3 code to handle changing passwords for HP-UX Trusted Computing was found to set the password change date, but not send the required additional command to force the Trusted Computing setup to reset the password age to 0. \r\n\r\nI have already modified the password provider code to address this issue and I am creating a ticket to have the code reviewed for modification into the existing puppet code base. ","closed_at":"2019-04-04T22:20:44.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3801","labels":"puppet-agent","state":"Closed","updated_at":"2019-04-04T22:20:44.000-0700","timestamp":1652285817.563861,"priority":"Minor","status_category":"Done","pull_request":3492},{"issue_id":"53148","title":"False positives in Puppet acceptance testing - should_not_change_the_system.rb","url":"https://tickets.puppetlabs.com/browse/PUP-3378","created_at":"2014-10-01T08:46:11.000-0700","number":"PUP-3378","body":"When running the Puppet acceptance suite, we're seeing some flakiness in {{acceptance/tests/resource/service/should_not_change_the_system.rb}}. This doesn't appear to be a problem with Puppet, but rather a problem with the test.\r\n\r\nThe test runs {{puppet resource service}} twice and compares the output. On Fedora 19, we're seeing the NetworkManager service changes state in between. It is not immediately apparent what causes this service's state to change.\r\n\r\nIdeally, we need to modify this test to be less fragile, and more directly test {{puppet resource service}}.","closed_at":"2019-04-04T22:20:44.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3378","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:44.000-0700","timestamp":1652285817.668353,"priority":"Normal","status_category":"Done","pull_request":3424},{"issue_id":"52664","title":"curl allows --insecure SSL connections ","url":"https://tickets.puppetlabs.com/browse/PUP-3346","created_at":"2014-09-25T18:26:00.000-0700","number":"PUP-3346","body":"The {{appdmg}} and {{pkgdmg}} providers were calling {{curl}} with {{\\-k}} (alias for {{--insecure}}) which allows curl'ing over insecure HTTPS connections. I can't see why this would ever be desired, and many connections will often fail when attempting establish a connection.\r\n\r\nI have a PR removing the insecure option: https://github.com/puppetlabs/puppet/pull/3124","closed_at":"2019-04-04T22:20:45.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3346","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:45.000-0700","timestamp":1652285817.774673,"priority":"Normal","status_category":"Done","pull_request":3124},{"issue_id":"71399","title":"Custom gem provider does not issue the right command to uninstall gem","url":"https://tickets.puppetlabs.com/browse/PUP-4191","created_at":"2015-03-12T07:43:30.000-0700","number":"PUP-4191","body":"Calling the uninstall method on a custom gem provider where a custom command has been defined, results in the wrong command being issued.\r\n\r\nFor example, sensu-puppet uses the sensu_gem provider in order to uninstall gems from the sensu embedded version of ruby.\r\n\r\nhttps://github.com/sensu/sensu-puppet/blob/master/lib/puppet/provider/package/sensu_gem.rb\r\n\r\nWhen 'ensure => absent' a given gem, '/usr/bin/gem uninstall [gem_name]' is executed rather than '/opt/sensu/embedded/bin/gem uninstall [gem_name]'.\r\n\r\nThe custom provider sensu_gem doesn't contain logic to overwrite the puppet gem provider behaviour, except from the :gemcmd to be issued.\r\n\r\n'ensure => present' a given gem results in the correct command to be issued.","closed_at":"2019-04-04T22:20:45.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4191","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:45.000-0700","timestamp":1652285818.090718,"priority":"Normal","status_category":"Done","pull_request":3708},{"issue_id":"103309","title":"Crontab environment variable space parsing ","url":"https://tickets.puppetlabs.com/browse/PUP-5452","created_at":"2015-10-28T12:22:57.000-0700","number":"PUP-5452","body":"Crontab parsing when there is a space between the variable name and the '=' causes a very obscure error of the form:\r\n\r\nError: Failed to apply catalog: Could not parse line \"VARIABLENAME = value\" at username:4\r\n\r\nThis appears to be due to unfortunate error propagation in the parsedfile utility class and is currently beyond the time I have to spend. \r\n\r\nHowever, it'd be nice to fix the immediate bug : Environment variables in crontab don't follow shell strictures and can have a space between the variable name and the value.","closed_at":"2019-04-04T22:20:46.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5452","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:46.000-0700","timestamp":1652285818.193685,"priority":"Normal","status_category":"Done","pull_request":4385},{"issue_id":"90338","title":"static compiler always sets ensure parameter to 'file' if a source is declared","url":"https://tickets.puppetlabs.com/browse/PUP-4919","created_at":"2015-07-23T05:19:23.000-0700","number":"PUP-4919","body":"The static_compiler catalog terminus always sets ensure to 'file' on file resources as long as the resource has a source parameter declared.\r\nIt does this even if the ensure parameter is explicitly declared.\r\n\r\nApplying a catalog, with the following file resource, compiled with static compiler, will create the file anyway.\r\n\r\n{code}\r\nfile { '/tmp/statically_compiled.txt':\r\n  ensure => absent,\r\n  mode   => 0755,\r\n  owner  => 'root',\r\n  group  => 'root',\r\n  source => 'puppet:///modules/foo/statically_compiled.txt',\r\n}\r\n{code}\r\n\r\n...\r\nNotice: /Stage[main]/Main/File[/tmp/statically_compiled.txt]/ensure: defined content as '{md5}8fea78c7e5ed0f5b3bd13565589a6f7c'\r\n...\r\n\r\n\r\nThe catalog confirms ensure is being set to \"file\" :\r\n\r\nirb(main):001:0> require 'json'\r\n=> true\r\nirb(main):002:0> JSON.load(File.read('foo.json'))['data']['resources'].find { |res| res['title'] == '/tmp/statically_compiled.txt' }\r\n=> {\"type\"=>\"File\", \"title\"=>\"/tmp/statically_compiled.txt\", \"tags\"=>[\"file\", \"class\"], \"file\"=>\"/etc/puppet/environments/tdevelioglu/puppet/manifests/site.pp\", \"line\"=>7, \"exported\"=>false, \"parameters\"=>{\"ensure\"=>\"file\", \"mode\"=>\"0755\", \"owner\"=>\"root\", \"group\"=>\"root\", \"ignore\"=>[\".svn\", \"CVS\", \".git\"], \"content\"=>\"{md5}8fea78c7e5ed0f5b3bd13565589a6f7c\", \"checksum\"=>\"md5\"}}\r\n\r\nThis is inconsistent with the behavior of the normal compiler, where a file's ensure parameter is enforced regardless of the value of the source parameter.\r\n","closed_at":"2019-04-04T22:20:47.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4919","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:47.000-0700","timestamp":1652285818.611849,"priority":"Normal","status_category":"Done","pull_request":4100},{"issue_id":"62461","title":"Exec resource's user validation should not block catalog compilation","url":"https://tickets.puppetlabs.com/browse/PUP-3793","created_at":"2014-12-26T01:25:41.000-0800","number":"PUP-3793","body":"Catalog compilation fails as non root user when using an exec resource with another user : `exec { 'foo': user => 'bar' }`. \r\nIssue alread reported here : https://github.com/puppetlabs/puppetlabs-postgresql/pull/394\r\n\r\nThis is quite annoying because unit tests are usually run as non root user and thus `it {should compile}` fails in that case. We could use fakeroot to workaround this issue, but this tool is not available on every platform : https://github.com/puppetlabs/modulesync_configs/pull/8","closed_at":"2019-04-04T22:20:47.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3793","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:47.000-0700","timestamp":1652285818.820964,"priority":"Normal","status_category":"Done","pull_request":3441},{"issue_id":"58793","title":"Invalid module name .DS_Store error running puppet apply","url":"https://tickets.puppetlabs.com/browse/PUP-3678","created_at":"2014-11-17T15:19:31.000-0800","number":"PUP-3678","body":"Running master at 3.7.3-619-g3c8fb24 I'm getting the following surprise when running a basic puppet apply -v foo.pp from a provider module I'm developing:\r\n\r\n{code}\r\n$ bundle exec puppet apply -v foo2.pp\r\nError: Invalid module name .DS_Store; module names must be alphanumeric (plus '-'), not '.DS_Store'\r\nError: Invalid module name .DS_Store; module names must be alphanumeric (plus '-'), not '.DS_Store'\r\nInfo: Loading facts\r\nNotice: Compiled catalog for mccune.corp.puppetlabs.net in environment production in 0.04 seconds\r\nInfo: Applying configuration version '1416266353'\r\nNotice: Applied catalog in 0.49 seconds\r\n{code}\r\n\r\nDoing a bisect traced the change to https://github.com/puppetlabs/puppet/commit/e86b3ab11adf0dce8f07373ce5aaa19ad410166c\r\n\r\n{code}\r\ncommit e86b3ab11adf0dce8f07373ce5aaa19ad410166c\r\nAuthor: Jim Radford <radford@blackbean.org>\r\nDate:   Fri Nov 7 16:31:18 2014 -0800\r\n\r\n    (maint) Log invalid modules\r\n\r\n    Give notice when a module on the modulepath is invalid, explaining why.\r\n    To do this cleanly, we stop trying to add \".\" and \"..\" as modules since\r\n    these are always invalid.\r\n\r\n{code}","closed_at":"2019-04-04T22:20:48.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3678","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:48.000-0700","timestamp":1652285830.626256,"priority":"Normal","status_category":"Done","pull_request":3543},{"issue_id":"99429","title":"Allow local of install of a gem on windows","url":"https://tickets.puppetlabs.com/browse/PUP-5282","created_at":"2015-09-25T06:27:50.000-0700","number":"PUP-5282","body":"Attempts to install a gem from a local source on windows using the package type fail because the provider eventually passes the path as a source argument:\r\n\r\n{code:title=puppet|borderStyle=solid}\r\npackage { 'diplomercy':\r\n   ensure => '1.0.0',\r\n   source => 'c:/diplomercy-1.0.0.gem',\r\n   provider => 'gem',\r\n   install_options => ['--local','--no-ri','--no-rdoc'],\r\n}\r\n\r\nNotice: Compiled catalog for windowsmeupscotty in environment production in 1.10 seconds\r\nError: Could not update: Execution of 'c:/Program Files/Puppet Labs/Puppet/sys/ruby/bin/gem.bat install -v 1.0.0 --source c:/diplomercy-1.0.0.gem diplomercy --local --no-ri --no-rdoc' returned 1: ERROR:  While executing gem ... (OptionParser::InvalidArgument)\r\n    invalid argument: --source c:/diplomercy-1.0.0.gem\r\nWrapped exception:\r\nExecution of 'c:/Program Files/Puppet Labs/Puppet/sys/ruby/bin/gem.bat install -v 1.0.0 --source c:/diplomercy-1.0.0.gem diplomercy --local --no-ri --no-rdoc' returned 1: ERROR:  While executing gem ... (OptionParser::InvalidArgument)\r\n    invalid argument: --source c:/diplomercy-1.0.0.gem\r\nError: /Stage[main]/Main/Package[diplomercy]/ensure: change from absent to 1.0.0 failed: Could not update: Execution of 'c:/Program Files/Puppet Labs/Puppet/sys/ruby/bin/gem.bat install -v 1.0.0 --source c:/diplomercy-1.0.0.gem diplomercy --local --no-ri --no-rdoc' returned 1: ERROR:  While executing gem ... (OptionParser::InvalidArgument)\r\n    invalid argument: --source c:/diplomercy-1.0.0.gem\r\nNotice: Finished catalog run in 3.19 seconds\r\n{code}","closed_at":"2019-04-04T22:20:49.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5282","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:49.000-0700","timestamp":1652285830.832567,"priority":"Normal","status_category":"Done","pull_request":4291},{"issue_id":"32519","title":"OpenBSD uninstall broken when multiple uninstall_options given","url":"https://tickets.puppetlabs.com/browse/PUP-2311","created_at":"2014-04-21T15:43:41.000-0700","number":"PUP-2311","body":"As I found out while working on :upgradeable today, the way we pass arguments to pkg_add/pkg_delete is slightly off.\r\n\r\nCurrently we pass it a single string, which confuses pkg_* as it sees \"-r -z\" (without quotes) as a single argument, the same applies to the #uninstall method in case multiple uninstall_options were passed.","closed_at":"2019-04-04T22:20:49.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2311","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:49.000-0700","timestamp":1652285830.93471,"priority":"Normal","status_category":"Done","pull_request":2563},{"issue_id":"82297","title":"Pip installs from behind proxy can't ensure=>latest","url":"https://tickets.puppetlabs.com/browse/PUP-4673","created_at":"2015-05-29T18:15:11.000-0700","number":"PUP-4673","body":"The pip package provider can ensure => version but can't ensure latest when using a proxy. \r\n\r\nhttps://github.com/puppetlabs/puppet/pull/3984\r\n\r\n(venv)krum@ftctstories01g:~$ env| grep proxy\r\nhttp_proxy=http://web-proxy.houston.hp.com:8080\r\nHTTPS_PROXY=http://web-proxy.houston.hp.com:8080\r\nhttps_proxy=http://web-proxy.houston.hp.com:8080\r\nHTTP_PROXY=http://web-proxy.houston.hp.com:8080\r\n\r\n\r\n(venv)krum@ftctstories01g:~$ puppet --version\r\n3.7.4\r\n(venv)krum@ftctstories01g:~$ ruby --version\r\nruby 1.8.7 (2011-06-30 patchlevel 352) [x86_64-linux]\r\n(venv)krum@ftctstories01g:~$ gem --version\r\n1.8.15\r\n\r\n$ puppet resource package gear provider=pip ensure=latest --debug --trace                       \r\nDebug: Runtime environment: ruby_version=1.8.7, run_mode=user, puppet_version=3.7.4\r\nDebug: Puppet::Type::Package::ProviderNim: file /usr/bin/lslpp does not exist\r\nDebug: Puppet::Type::Package::ProviderSunfreeware: file pkg-get does not exist\r\nDebug: Puppet::Type::Package::ProviderPortage: file /usr/bin/emerge does not exist\r\nDebug: Puppet::Type::Package::ProviderSun: file /usr/bin/pkginfo does not exist\r\nDebug: Puppet::Type::Package::ProviderOpenbsd: file pkg_info does not exist\r\nDebug: Puppet::Type::Package::ProviderPacman: file /usr/bin/pacman does not exist\r\nDebug: Puppet::Type::Package::ProviderZypper: file /usr/bin/zypper does not exist\r\nDebug: Puppet::Type::Package::ProviderRpm: file rpm does not exist\r\nDebug: Puppet::Type::Package::ProviderUrpmi: file rpm does not exist\r\nDebug: Puppet::Type::Package::ProviderHpux: file /usr/sbin/swinstall does not exist\r\nDebug: Puppet::Type::Package::ProviderOpkg: file opkg does not exist\r\nDebug: Puppet::Type::Package::ProviderPorts: file /usr/local/sbin/pkg_deinstall does not exist\r\nDebug: Puppet::Type::Package::ProviderYum: file rpm does not exist\r\nDebug: Puppet::Type::Package::ProviderUp2date: file /usr/sbin/up2date-nox does not exist\r\nDebug: Puppet::Type::Package::ProviderFreebsd: file /usr/sbin/pkg_info does not exist\r\nDebug: Puppet::Type::Package::ProviderFink: file /sw/bin/fink does not exist\r\nDebug: Puppet::Type::Package::ProviderRug: file /usr/bin/rug does not exist\r\nDebug: Puppet::Type::Package::ProviderPkgin: file pkgin does not exist\r\nDebug: Puppet::Type::Package::ProviderPortupgrade: file /usr/local/sbin/pkg_deinstall does not exist\r\nDebug: Puppet::Type::Package::ProviderPkg: file /usr/bin/pkg does not exist\r\nDebug: Puppet::Type::Package::ProviderAix: file /usr/bin/lslpp does not exist\r\nDebug: Puppet::Type::Package::ProviderAptrpm: file rpm does not exist\r\nDebug: /Package[gear]: Provider pip does not support features virtual_packages; not managing attribute allow_virtual\r\nDebug: Loaded state in 0.00 seconds\r\nDebug: Failed to load library 'selinux' for feature 'selinux'\r\nDebug: Prefetching pip resources for package\r\nDebug: Executing '/home/krum/venv/bin/pip freeze'\r\nError: Could not get latest version: Timeout while contacting pypi.python.org: execution expired\r\n/usr/lib/ruby/1.8/timeout.rb:64:in `open'\r\n/usr/lib/ruby/1.8/net/http.rb:560:in `connect'\r\n/usr/lib/ruby/1.8/net/http.rb:560:in `connect'\r\n/usr/lib/ruby/1.8/net/http.rb:553:in `do_start'\r\n/usr/lib/ruby/1.8/net/http.rb:548:in `start'\r\n/usr/lib/ruby/1.8/xmlrpc/client.rb:535:in `do_rpc'\r\n/usr/lib/ruby/1.8/xmlrpc/client.rb:420:in `call2'\r\n/usr/lib/ruby/1.8/xmlrpc/client.rb:410:in `call'\r\n/usr/lib/ruby/vendor_ruby/puppet/provider/package/pip.rb:63:in `latest'\r\n/usr/lib/ruby/vendor_ruby/puppet/type/package.rb:145:in `insync?'\r\n/usr/lib/ruby/vendor_ruby/puppet/type/package.rb:132:in `each'\r\n/usr/lib/ruby/vendor_ruby/puppet/type/package.rb:132:in `insync?'\r\n/usr/lib/ruby/vendor_ruby/puppet/property.rb:314:in `safe_insync?'\r\n/usr/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:117:in `sync_if_needed'\r\n/usr/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:81:in `perform_changes'\r\n/usr/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:20:in `evaluate'\r\n/usr/lib/ruby/vendor_ruby/puppet/transaction.rb:204:in `apply'\r\n/usr/lib/ruby/vendor_ruby/puppet/transaction.rb:217:in `eval_resource'\r\n/usr/lib/ruby/vendor_ruby/puppet/transaction.rb:147:in `call'\r\n/usr/lib/ruby/vendor_ruby/puppet/transaction.rb:147:in `evaluate'\r\n/usr/lib/ruby/vendor_ruby/puppet/util.rb:327:in `thinmark'\r\n/usr/lib/ruby/1.8/benchmark.rb:308:in `realtime'\r\n/usr/lib/ruby/vendor_ruby/puppet/util.rb:326:in `thinmark'\r\n/usr/lib/ruby/vendor_ruby/puppet/transaction.rb:147:in `evaluate'\r\n/usr/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:118:in `traverse'\r\n/usr/lib/ruby/vendor_ruby/puppet/transaction.rb:138:in `evaluate'\r\n/usr/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:169:in `apply'\r\n/usr/lib/ruby/vendor_ruby/puppet/util/log.rb:153:in `with_destination'\r\n/usr/lib/ruby/vendor_ruby/puppet/transaction/report.rb:112:in `as_logging_destination'\r\n/usr/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:168:in `apply'\r\n/usr/lib/ruby/vendor_ruby/puppet/indirector/resource/ral.rb:41:in `save'\r\n/usr/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:283:in `save'\r\n/usr/lib/ruby/vendor_ruby/puppet/application/resource.rb:218:in `find_or_save_resources'\r\n/usr/lib/ruby/vendor_ruby/puppet/application/resource.rb:142:in `main'\r\n/usr/lib/ruby/vendor_ruby/puppet/application.rb:389:in `run_command'\r\n/usr/lib/ruby/vendor_ruby/puppet/application.rb:381:in `run'\r\n/usr/lib/ruby/vendor_ruby/puppet/application.rb:507:in `plugin_hook'\r\n/usr/lib/ruby/vendor_ruby/puppet/application.rb:381:in `run'\r\n/usr/lib/ruby/vendor_ruby/puppet/util.rb:488:in `exit_on_fail'\r\n/usr/lib/ruby/vendor_ruby/puppet/application.rb:381:in `run'\r\n/usr/lib/ruby/vendor_ruby/puppet/util/command_line.rb:146:in `run'\r\n/usr/lib/ruby/vendor_ruby/puppet/util/command_line.rb:92:in `execute'\r\n/usr/bin/puppet:8\r\nError: /Package[gear]/ensure: change from 0.5.7 to latest failed: Could not get latest version: Timeout while contacting pypi.python.org: execution expired\r\nDebug: Finishing transaction 70036871426860\r\nDebug: Storing state\r\nDebug: Stored state in 0.01 seconds\r\npackage { 'gear':\r\n  ensure => '0.5.7',\r\n}\r\n\r\n","closed_at":"2019-04-04T22:20:50.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4673","labels":"puppethack","state":"Resolved","updated_at":"2019-04-04T22:20:50.000-0700","timestamp":1652285831.251594,"priority":"Normal","status_category":"Done","pull_request":3984},{"issue_id":"52824","title":"Unexpected error with multiple SSH keys without comments","url":"https://tickets.puppetlabs.com/browse/PUP-3357","created_at":"2014-09-28T04:27:17.000-0700","number":"PUP-3357","body":"Steps to reproduce:\r\n\r\n# Enter multple SSH authorized keys for a user without comments (just a key line by line, see example below).\r\n# Manage the user with Puppet with the {{purge_ssh_keys}} parameter set to true.\r\n# Have Puppet agent 3.7.0+\r\n# Puppet agent run fails completely with an error. (full denial of service of the agent effectively)\r\n\r\nExpected behaviour: Purging all other SSH keys, with or without comments and a successful Puppet agent run.\r\n\r\nNote: Because of an unprivileged user being able to block Puppet agent runs I consider this more than just a corner case.\r\n\r\nMore details:\r\n\r\nSince 3.7.0 (not with 3.6.2), I'm getting an unexpected error on the Puppet agent runs managing the {{user}}'s SSH authorized keys with {{purge_ssh_keys}} enabled. Some users enter multiple keys without comments in the files, e.g.:\r\n\r\n{noformat}\r\necdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBI/HHDwh6ccmX4BT5rpCEt7Z647v3WwmVCamWfxgUMCegYJliI7BjfAMX0HPdlaCfPd67oWQJaKg9qSNEuHBbKM= \r\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDYUv24oLUvh8Vr3g0XxocU2AYkc3RTunnrR8ChkWgjru9d3o5O1mdg7dzkQDyiQflHa3XGSbvly9LAxKOQhJtZEHJ6+Sn8iAo5edJR2yE6uX2O9DcYOgaoZO0Rg3PG5JsP3JdrS5lb3jwvsGfPFU+bC5egEypWDnIakLQksvkcldwMuzDVeExm11LakMd2MPig4gaje7HVoP++LVLxqxYUZQTiEGOZwTnysO/CywhGvD5V2n59T+1Hqhz9cgx+l2fdJxuJPXq9a7V+crxxLW22w/LIj70KvdDPh7jyfAzMk+k8tYg/6FbTz6sft2uQ043fCBso8iy2iTIAj8xqBKab\r\n{noformat}\r\n\r\nThis results in the following error in 3.7.0+:\r\n\r\n{noformat}\r\nError: Could not apply complete catalog: Duplicate declaration: Ssh_authorized_key[] is already declared; cannot redeclare\r\n{noformat}\r\n\r\nWith the agent downgraded to 3.6.2, it runs, but it does not remove the existing keys properly.\r\n{noformat}\r\nNotice: /Stage[main]/Localusers/Ssh_authorized_key[key0]/ensure: current_value absent, should be present (noop)\r\nNotice: /Stage[main]/Localusers/Ssh_authorized_key[key1]/ensure: current_value absent, should be present (noop)\r\nNotice: /Stage[main]/Localusers/Ssh_authorized_key[key2]/ensure: current_value absent, should be present (noop)\r\n{noformat}\r\n\r\nBack on 3.7.1, it works fine again after editing the user's {{authorized_keys}} file and add some comments:\r\n\r\n{noformat}\r\necdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBI/HHDwh6ccmX4BT5rpCEt7Z647v3WwmVCamWfxgUMCegYJliI7BjfAMX0HPdlaCfPd67oWQJaKg9qSNEuHBbKM= key0\r\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDYUv24oLUvh8Vr3g0XxocU2AYkc3RTunnrR8ChkWgjru9d3o5O1mdg7dzkQDyiQflHa3XGSbvly9LAxKOQhJtZEHJ6+Sn8iAo5edJR2yE6uX2O9DcYOgaoZO0Rg3PG5JsP3JdrS5lb3jwvsGfPFU+bC5egEypWDnIakLQksvkcldwMuzDVeExm11LakMd2MPig4gaje7HVoP++LVLxqxYUZQTiEGOZwTnysO/CywhGvD5V2n59T+1Hqhz9cgx+l2fdJxuJPXq9a7V+crxxLW22w/LIj70KvdDPh7jyfAzMk+k8tYg/6FbTz6sft2uQ043fCBso8iy2iTIAj8xqBKab key1\r\n{noformat}\r\n\r\n{noformat}\r\nNotice: /Stage[main]/Localusers/Ssh_authorized_key[key0]/ensure: current_value present, should be absent (noop)\r\nNotice: /Stage[main]/Localusers/Ssh_authorized_key[key1]/ensure: current_value present, should be absent (noop)\r\n{noformat}","closed_at":"2019-04-04T22:20:51.000-0700","comments":16,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3357","labels":"ssh_authorized_key","state":"Closed","updated_at":"2019-04-04T22:20:51.000-0700","timestamp":1652285831.566724,"priority":"Normal","status_category":"Done","pull_request":3164},{"issue_id":"49739","title":"Debian service provider on docker with insserv (dep boot sequencing)","url":"https://tickets.puppetlabs.com/browse/PUP-3166","created_at":"2014-09-01T06:52:06.000-0700","number":"PUP-3166","body":"I am trying to test a puppet module in docker. Starting /sbin/init as suggested ...\r\n\r\nEach run triggers \"reenabling\" the defined service, because invoke-rc.d returns 101 (not allowed). In this case puppet should check for the links in /etc/rc*.d manually, as it does for exit code 105.\r\n\r\nI attempted to fix this:\r\nhttps://github.com/puppetlabs/puppet/pull/3038","closed_at":"2019-04-04T22:20:51.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3166","labels":"AIO","state":"Closed","updated_at":"2019-04-04T22:20:51.000-0700","timestamp":1652285831.674916,"priority":"Normal","status_category":"Done","pull_request":3962},{"issue_id":"22525","title":"Yum provider using \"version-release\" to validate installation.","url":"https://tickets.puppetlabs.com/browse/PUP-1244","created_at":"2013-12-26T03:08:16.000-0800","number":"PUP-1244","body":"When using yum provider Puppet complains(error output) when using only the version(string) of the package to install or installed at the time of verification.\r\n\r\n{code}\r\n    $snmp_version = \"5.3.2.2\"\r\n    package { \"net-snmp\": ensure => \"${snmp_version}\"; }\r\n\r\nClient output:\r\n\r\ndebug: //Node[client.example.com]/snmp::base/Package[net-snmp]: Changing ensure\r\ndebug: //Node[client.example.com]/snmp::base/Package[net-snmp]: 1 change(s)\r\ndebug: Package[net-snmp](provider=yum): Ensuring => 5.3.2.2\r\n**(1)** debug: Puppet::Type::Package::ProviderYum: Executing '/usr/bin/yum -d 0 -e 0 -y install net-snmp-5.3.2.2'\r\n**(2)** debug: Puppet::Type::Package::ProviderYum: Executing '/bin/rpm -q net-snmp --nosignature --nodigest --qf %{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\r\n'\r\nerr: //Node[client.example.com]/snmp::base/Package[net-snmp]/ensure: change from 5.3.2.2-7.el5_4.2 to 5.3.2.2 failed: Could not update: Failed to update to version 5.3.2.2, got version 5.3.2.2-7.el5_4.2 instead at /opt/git/development/modules/snmp/manifests/init.pp:26\r\nnotice: //Node[client.example.com]/snmp::base/File[/etc/snmp/snmpd.conf]: Dependency package[net-snmp] has 1 failures\r\nwarning: //Node[labtest40-v3.ea-colo.ea.com]/snmp::base/File[/etc/snmp/snmpd.conf]: Skipping because of failed dependencies\r\n{code}\r\n\r\nThe package is installed **(1)** but the error is still shown at the time of validation **(2)**, same situation if package is already installed.\r\n\r\nin .../provider/package/yum.rb:\r\n\r\n{code}\r\ndef install\r\n    ---- chop lines ---\r\n    is = self.query\r\n    unless is\r\n        raise Puppet::Error, \"Could not find package %s\" % self.name\r\n    end\r\n    # FIXME: Should we raise an exception even if should == :latest\r\n    # and yum updated us to a version other than @param_hash[:ensure] ?\r\n    if should && should != is[:ensure]\r\n        raise Puppet::Error, \"Failed to update to version #{should}, got version #{is[:ensure]} instead\"\r\n    end\r\n{code}\r\n\r\nThe error arises as **should** is not equal to **is[:ensure]**\r\n\r\nin .../provider/package/rpm.rb the query define comment says it will provide the **\"version-release\"**\r\n\r\n{code}\r\n# Find the fully versioned package name and the version alone. Returns\r\n# a hash with entries :instance => fully versioned package name, and\r\n# :ensure => version-release\r\ndef query\r\n{code}\r\n\r\nThe validation is made in the ensure attribute($snmp_version) string against \"version-release\" installed.  It makes sense when somebody defines something like ensure => \"${snmp_version}-${snmp-release}\", but not in this use case.\r\n\r\nTested in 0.24.8 but reported also on 0.25.4.\r\n\r\nrpm.rb and yum.rb are not behaving in the same way as yum cli behaves.","closed_at":"2019-04-04T22:20:53.000-0700","comments":17,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1244","labels":"customer;redmine;yum","state":"Closed","updated_at":"2019-04-04T22:20:53.000-0700","timestamp":1652285832.223781,"priority":"Normal","status_category":"Done","pull_request":3078},{"issue_id":"94520","title":"static compiler fails to remove existing resources from children.","url":"https://tickets.puppetlabs.com/browse/PUP-5062","created_at":"2015-08-21T04:22:02.000-0700","number":"PUP-5062","body":"The static compiler fails to remove child resources that already exist in the catalog.\r\n\r\n{code}\r\n  file { '/tmp/statically_compiled':\r\n    ensure  => directory,\r\n    owner   => 'root',\r\n    group   => 'root',\r\n    recurse => true,\r\n    source  => 'puppet:///modules/role/statically_compiled',\r\n  }\r\n\r\n  file { '/tmp/statically_compiled/test.txt':\r\n    ensure  => file,\r\n    owner   => 'root',\r\n    source  => 'puppet:///modules/role/statically_compiled/test.txt',\r\n  }\r\n{code}\r\n\r\nroot@traveler:/usr/lib/ruby/vendor_ruby/puppet/indirector/file_metadata# service puppetmaster restart; puppet agent -t\r\n * Restarting puppet master                                                                                     [ OK ] \r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nError: Could not retrieve catalog from remote server: Error 400 on SERVER: Duplicate declaration: File[/tmp/statically_compiled/test.txt] is already declared in file /etc/puppet/environments/production/modules/role/manifests/traveler.pp:27; cannot redeclare\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\n\r\nthe culprit is remove_existing_resources\r\n{code}\r\n...\r\n  # Remove any file resources in the catalog that will be duplicated by the\r\n  # given file resources.\r\n  #\r\n  # @param children [Array<Puppet::Resource>]\r\n  # @param catalog [Puppet::Resource::Catalog]\r\n  def remove_existing_resources(children, catalog)\r\n    existing_names = catalog.resources.collect { |r| r.to_s }\r\n    both = (existing_names & children.keys).inject({}) { |hash, name| hash[name] = true; hash }\r\n    both.each { |name| children.delete(name) }\r\n  end\r\n...\r\n{code}\r\n\r\nThe intersection between existing_names and children.keys never matches anything because existing_names are stringified resource objects (e.g. File['/tmp/statically_compiled/test.txt']) and children.keys are relative path strings (e.g. 'test.txt.).\r\n\r\nThe result is that the 'both' list (hash actually, but that injection looks pretty unnecessary to me) is always empty.\r\n","closed_at":"2019-04-04T22:20:53.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5062","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:53.000-0700","timestamp":1652285832.32839,"priority":"Normal","status_category":"Done","pull_request":4185},{"issue_id":"86073","title":"filemode retrieved by static_compiler should be stringified","url":"https://tickets.puppetlabs.com/browse/PUP-4781","created_at":"2015-06-24T06:49:57.000-0700","number":"PUP-4781","body":"When a file resource is declared without an explicit mode, the mode retrieved from the metadata by the static_compiler catalog terminus is not stringified, resulting in file resources with integer file modes in the resultant catalog and a depreciation warning such as:\r\n\r\nWarning: Non-string values for the file mode property are deprecated. It must be a string, either a symbolic mode like 'o+w,a+r' or an octal representation like '0644' or '755'.\r\n   (at /usr/lib/ruby/vendor_ruby/puppet/type/file/mode.rb:69:in `block (2 levels) in <module:Puppet>')\r\n","closed_at":"2019-04-04T22:20:56.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4781","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:56.000-0700","timestamp":1652285833.356372,"priority":"Minor","status_category":"Done","pull_request":4052},{"issue_id":"32143","title":"Puppet will purge the /etc/hosts if it have some invalid lines","url":"https://tickets.puppetlabs.com/browse/PUP-2289","created_at":"2014-04-16T19:38:31.000-0700","number":"PUP-2289","body":"normally, i use puppet resource host puppet ip=xxx.xxx.xxx.xxx can add/set a domain name resolution into /etc/hosts. like this:\r\n{code:none}\r\n[root@puppet ~]# cat /etc/hosts\r\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\r\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\r\n[root@puppet ~]# puppet resource host puppet ip=172.16.94.128\r\nNotice: /Host[puppet]/ensure: created\r\nhost { 'puppet':\r\n  ensure => 'present',\r\n  ip     => '172.16.94.128',\r\n  target => '/etc/hosts',\r\n}\r\n[root@puppet ~]# cat /etc/hosts\r\n# HEADER: This file was autogenerated at Wed Apr 16 17:57:19 +0800 2014\r\n# HEADER: by puppet.  While it can still be managed manually, it\r\n# HEADER: is definitely not recommended.\r\n127.0.0.1\tlocalhost\tlocalhost.localdomain localhost4 localhost4.localdomain4\r\n::1\tlocalhost\tlocalhost.localdomain localhost6 localhost6.localdomain6\r\n172.16.94.128\tpuppet\r\n{code}\r\n\r\nbut if there have some invalid text in /etc/hosts, link '=' or ', ,', puppet will purge that file and create a new one.\r\n\r\n{code:none}\r\n[root@puppet ~]# cat /etc/hosts\r\n# HEADER: This file was autogenerated at Wed Apr 16 17:57:19 +0800 2014\r\n# HEADER: by puppet.  While it can still be managed manually, it\r\n# HEADER: is definitely not recommended.\r\n127.0.0.1\tlocalhost\tlocalhost.localdomain localhost4 localhost4.localdomain4\r\n::1\tlocalhost\tlocalhost.localdomain localhost6 localhost6.localdomain6\r\n==\r\n[root@puppet ~]# puppet resource host puppet ip=172.16.94.128\r\nError: Could not prefetch host provider 'parsed': Could not parse line \"==\" at /etc/hosts:4\r\nNotice: /Host[puppet]/ensure: created\r\nhost { 'puppet':\r\n  ensure => 'present',\r\n  ip     => '172.16.94.128',\r\n  target => '/etc/hosts',\r\n}\r\n[root@puppet ~]# cat /etc/hosts\r\n# HEADER: This file was autogenerated at Wed Apr 16 18:00:59 +0800 2014\r\n# HEADER: by puppet.  While it can still be managed manually, it\r\n# HEADER: is definitely not recommended.\r\n172.16.94.128\tpuppet\r\n{code}\r\n\r\ni checked the source code, it have three rules to check if the lines in /etc/hosts invalid.\r\n{code:none}\r\n/^#/\r\n/^\\s*$/\r\n/^(\\S+)\\s+(\\S+)\\s*(.*?)?(?:\\s*#\\s*(.*))?$/\r\n{code}\r\nbut i think if puppet checked out there is some invalid lines, it should report error and exit, not keep going and purge my hosts file","closed_at":"2019-04-04T22:20:59.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2289","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:59.000-0700","timestamp":1652285835.100638,"priority":"Normal","status_category":"Done","pull_request":4101},{"issue_id":"83227","title":"Puppet service provider for SuSE should default to systemd except for version 11","url":"https://tickets.puppetlabs.com/browse/PUP-4697","created_at":"2015-06-04T14:19:51.000-0700","number":"PUP-4697","body":"This is based on an issue report in the openSUSE bugzilla : [Puppet is unable to manage services since it does not use systemd for Tumbleweed|https://bugzilla.novell.com/show_bug.cgi?id=931703].\r\n\r\nWhen trying to enable a service on openSUSE Tumbleweed I get an error\r\n\r\n{code}$ sudo puppet apply -e 'service {\"apache2\" : enable => \"true\" }'\r\n/usr/lib64/ruby/gems/2.2.0/gems/puppet-3.7.5/lib/puppet/defaults.rb:488: warning: duplicated key at line 489 ignored: :queue_type\r\nNotice: Compiled catalog for bla.bla in environment production in 0.26 seconds\r\nError: Could not enable apache2: Execution of '/sbin/chkconfig --add apache2' returned 1: apache2: unknown service\r\n\r\nNote: This output shows SysV services only and does not include native\r\nsystemd services. SysV configuration data might be overridden by native\r\nsystemd configuration.\r\n\r\nIf you want to list systemd services use 'systemctl list-unit-files'.\r\nTo see services enabled on particular target use\r\n'systemctl list-dependencies [target]'.\r\nError: /Stage[main]/Main/Service[apache2]/enable: change from false to true failed: Could not enable apache2: Execution of '/sbin/chkconfig --add apache2' returned 1: apache2: unknown service\r\n\r\nNote: This output shows SysV services only and does not include native\r\nsystemd services. SysV configuration data might be overridden by native\r\nsystemd configuration.\r\n\r\nIf you want to list systemd services use 'systemctl list-unit-files'.\r\nTo see services enabled on particular target use\r\n'systemctl list-dependencies [target]'.\r\nNotice: Finished catalog run in 0.26 seconds\r\n{code}\r\n\r\nHowever, the service is already enabled for me\r\n{code}$ systemctl is-enabled apache2.service\r\nenabled{code}\r\n\r\nLooking at the code at in [service/systemd.rb|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/service/systemd.rb#L13], systemd is only enabled for suse when operatingsystemmajrelease is 12 or 13. But on openSUSE Tumbleweed the version is way off by design.\r\n\r\n{code}$ facter operatingsystemmajrelease\r\n20150518{code}\r\n\r\nThe only actively supported version of (open)SuSE old enough to not have systemd is SLE 11, so my suggestion is to make systemd the default for all versions except 11.","closed_at":"2019-04-04T22:20:59.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4697","labels":"","state":"Closed","updated_at":"2019-04-04T22:20:59.000-0700","timestamp":1652285835.209182,"priority":"Major","status_category":"Done","pull_request":4205},{"issue_id":"52270","title":"Puppet is inconsistent about :libdir setting when multiple paths provided","url":"https://tickets.puppetlabs.com/browse/PUP-3336","created_at":"2014-09-24T08:17:41.000-0700","number":"PUP-3336","body":"When attempting to rspec-puppet test one of my profiles modules, that has multiple module dependencies, an issue was identified whereby it wasn't auto-loading module fixture lib dirs. \r\n\r\nExample error that was seeing was: \r\n{code}\r\nError: Could not autoload puppet/provider/domain/asadmin: cannot load such file -- puppet/provider/asadmin\r\nError: Could not autoload puppet/type/domain: Could not autoload puppet/provider/domain/asadmin: cannot load such file -- puppet/provider/asadmin\r\nError: Could not autoload puppet/type/domain: Could not autoload puppet/provider/domain/asadmin: cannot load such file -- puppet/provider/asadmin on node scratch.dt0388.test\r\n{code}\r\n\r\nThanks to _rc on IRC, was able to track the issue down to the Ruby LOAD_PATH not being set correctly: \r\n{code}\r\n/home/vagrant/.rvm/rubies/ruby-1.9.3-p547/lib/ruby/1.9.1/x86_64-linux\r\n/home/vagrant/.rvm/gems/ruby-1.9.3-p547@depend-test/gems/puppet-3.7.1/lib/puppet/vendor/safe_yaml/lib\r\n/home/vagrant/.rvm/gems/ruby-1.9.3-p547@depend-test/gems/puppet-3.7.1/lib/puppet/vendor/rgen/lib\r\n/home/vagrant/.rvm/gems/ruby-1.9.3-p547@depend-test/gems/puppet-3.7.1/lib/puppet/vendor/semantic/lib\r\n/home/vagrant/.rvm/gems/ruby-1.9.3-p547@depend-test/gems/puppet-3.7.1/lib/puppet/vendor/pathspec/lib\r\n/home/vagrant/puppet-modules/rspec-deptest/spec/fixtures/modules/glassfish/lib:/home/vagrant/puppet-modules/rspec-deptest/spec/fixtures/modules/stdlib/lib\r\n{code}\r\n\r\nThe last line above is being set by rspec-puppet in: https://github.com/rodjek/rspec-puppet/blob/master/lib/rspec-puppet/support.rb#L140, using `File::PATH_SEPARATOR` to convert the array into a string to set as :libdir. \r\n\r\nThis then lead to: https://github.com/puppetlabs/puppet/blob/master/lib/puppet/defaults.rb#L223-L237, which is setting the LOAD_PATH to the value passed in as :libdir, without checking if the value should be split back into an array based on `File::PATH_SEPARATOR`. \r\n\r\nHowever elsewhere in the Puppet code, the libdir value is correctly being split: https://github.com/puppetlabs/puppet/blob/master/lib/puppet/util/autoload.rb#L145-L153\r\n\r\nA rather hacky work-around was to modify my *spec_helper.rb*, and add: \r\n{code}\r\ndiff --git a/spec/spec_helper.rb b/spec/spec_helper.rb\r\nindex 8b91323..be8e080 100644\r\n--- a/spec/spec_helper.rb\r\n+++ b/spec/spec_helper.rb\r\n@@ -3,6 +3,8 @@ require 'puppetlabs_spec_helper/module_spec_helper'\r\n require 'hiera'\r\n require 'rspec-puppet'\r\n \r\n+$: << \"spec/fixtures/modules/glassfish/lib\"\r\n+\r\n RSpec.configure do |c|\r\n   c.hiera_config = 'spec/fixtures/hiera/hiera.yaml'\r\n   c.manifest_dir = 'spec/fixtures/manifests'\r\n{code}\r\n\r\nThat results in the LOAD_PATH including the glassfish/lib folder, and Ruby being able to load `puppet/provider/asadmin`. ","closed_at":"2019-04-04T22:21:01.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3336","labels":"docs_reviewed","state":"Closed","updated_at":"2019-04-04T22:21:01.000-0700","timestamp":1652285835.849165,"priority":"Normal","status_category":"Done","pull_request":3373},{"issue_id":"107055","title":"Use rubocop in module generator","url":"https://tickets.puppetlabs.com/browse/PUP-5545","created_at":"2015-11-24T11:06:34.000-0800","number":"PUP-5545","body":"This is meant to enforce consistent style with ruby code and spec tests. Rubocop itself requires ruby >= 1.9.3. We still want to support ruby 1.8.7 and Puppet 3 and this code takes that into consideration.","closed_at":"2019-04-04T22:21:05.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5545","labels":"puppethack","state":"Closed","updated_at":"2019-04-04T22:21:05.000-0700","timestamp":1652285837.322952,"priority":"Normal","status_category":"Done","pull_request":4946},{"issue_id":"79276","title":"pkgin output incorrectly parsed","url":"https://tickets.puppetlabs.com/browse/PUP-4546","created_at":"2015-05-08T01:59:22.000-0700","number":"PUP-4546","body":"The pkgin tool adjusts it's output when run from an interactive or non-interactive terminal by replacing spaces with semicolons. The provider was not adjusted for this and thus exhibited odd behaviour such as 'puppet resource package virt-what' resulting in:\r\n\r\npackage { 'virt-what':\r\n  ensure => '1.15;Detect',\r\n}\r\n\r\nThe PR associated with the ticket switches the 'search' and 'list' commands to explicitly use '-p' (for parsable format) eventhough it's implied for non-interactive, and adjusts the regex accordingly.","closed_at":"2019-04-04T22:21:06.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4546","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:06.000-0700","timestamp":1652285837.428012,"priority":"Normal","status_category":"Done","pull_request":3905},{"issue_id":"37791","title":"Regression with external facts pluginsync not preserving executable bit","url":"https://tickets.puppetlabs.com/browse/PUP-2705","created_at":"2014-06-01T10:43:42.000-0700","number":"PUP-2705","body":"As per the subject, the external facts feature in puppet 3.6.1 is partially broken.\r\n\r\nI've tried to add a script into the <module>/facts.d path and given it executable permissions too.\r\n\r\nOnce the agent runs, it successfully syncs the plugin across in the external facts directory (/var/lib/puppet/facts.d). However, the script lacks the original permissions.","closed_at":"2019-04-04T22:21:06.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2705","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:06.000-0700","timestamp":1652285837.641119,"priority":"Blocker","status_category":"Done","pull_request":2715},{"issue_id":"56964","title":"Puppet doesn't remove users from groups on OpenBSD","url":"https://tickets.puppetlabs.com/browse/PUP-3605","created_at":"2014-11-02T12:09:21.000-0800","number":"PUP-3605","body":"The -G flag of the OpenBSD usermod command doesn't behave like most elsewhere. Instead of setting the groups, it appends the specified groups to the existing list of groups for a user. The analogue flag for Linux' -G flag is -S on OpenBSD.","closed_at":"2019-04-04T22:21:06.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3605","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:06.000-0700","timestamp":1652285837.74635,"priority":"Normal","status_category":"Done","pull_request":3267},{"issue_id":"18893","title":"PR (2067): Zypper provider install options - darix","url":"https://tickets.puppetlabs.com/browse/PUP-748","created_at":"2013-11-14T08:08:33.000-0800","number":"PUP-748","body":"h2. Zypper provider install options\n\n * Author:  <>\n * Company: \n * Github ID: [darix|https://github.com/darix]\n * [Pull Request 2067 Discussion|https://github.com/puppetlabs/puppet/pull/2067]\n * [Pull Request 2067 File Diff|https://github.com/puppetlabs/puppet/pull/2067/files]\n\nh2. Pull Request Description\n----\n\nThe old code would convert\r\ninstall_options => { '--from' => 'foobar' }\r\n\r\ninto a zypper call\r\n\r\nzypper install \"--from 'foobar'\"\r\n\r\nwhich doesnt work.\r\n\r\nnew code does\r\nzypper install --from=foobar\n\n----\n(webhooks-id: 9b0820d92f1e00eb8bf680777c22419b)\n","closed_at":"2019-04-04T22:21:08.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-748","labels":"github","state":"Closed","updated_at":"2019-04-04T22:21:08.000-0700","timestamp":1652285838.382131,"priority":"Normal","status_category":"Done","pull_request":6486},{"issue_id":"71367","title":"CLONE - Puppet device displays credentials in plain text when run manually","url":"https://tickets.puppetlabs.com/browse/PUP-4190","created_at":"2015-03-11T16:41:59.000-0700","number":"PUP-4190","body":"The device.conf format may only contain section headers (containing the certname as the section title) and type, url, and debug configuration entries (as per https://github.com/puppetlabs/puppet/blob/3.7.4/lib/puppet/util/network_device/config.rb#L62) which means that authentication credentials are and have always been added to the {{url}} setting.\r\n\r\nWhen running the puppet device command with verbose as {{puppet device -v}} the output prints {{Info: starting applying configuration to <device> at https://<username>:<password>@<address>}} because of https://github.com/puppetlabs/puppet/blob/3.7.4/lib/puppet/application/device.rb#L172\r\n\r\nThus the output shows the full login URL from the device.conf including the password in plain text with no way to suppress this output.","closed_at":"2019-04-04T22:21:10.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4190","labels":"product-security","state":"Closed","updated_at":"2019-04-04T22:21:10.000-0700","timestamp":1652285839.012803,"priority":"Normal","status_category":"Done","pull_request":3706},{"issue_id":"25933","title":"PR (2342) Cron handles crontab's equality of target and user strangely","url":"https://tickets.puppetlabs.com/browse/PUP-1624","created_at":"2014-02-09T12:27:43.000-0800","number":"PUP-1624","body":"When managing the target property of a cronjob, the user property uses its default instead (which is the user running puppet). To the crontab provider, these are basically the same, and there is code to handle them equally. Through the mixtures of defaults and actual supplied values, though, bizarre behaviors come up:\r\n\r\n{code}\r\n# HEADER: This file was autogenerated at 2014-02-09 20:31:59 +0100 by puppet.\r\n# HEADER: While it can still be managed manually, it is definitely not recommended.\r\n# HEADER: Note particularly that the comments starting with 'Puppet Name' should\r\n# HEADER: not be deleted, as doing so could cause duplicate cron jobs.\r\n# Puppet Name: bacula_vacuumdb\r\n0 12 * * * vacuumdb --analyze -U postgres bacula\r\n{code}\r\n\r\nRunning this manifest should not cause a sync:\r\n{code}\r\ncron { 'bacula_vacuumdb':\r\nensure => present,\r\nminute => '00',\r\nhour => '12',\r\ncommand => 'vacuumdb --analyze -U postgres bacula',\r\ntarget => 'ffrank',\r\n}\r\n{code}\r\n\r\nBut this happens:\r\n{code}\r\n# RUBYLIB=lib puppet apply /tmp/target.pp \r\n/Stage[main]//Cron[bacula_vacuumdb]/user: user changed 'ffrank' to 'root'\r\nFinished catalog run in 0.39 seconds\r\n{code}\r\n\r\nNote that this bug is currently masked by PUP-1585, which introduces an even worse misbehavior. Both will need to be fixed in unison.","closed_at":"2019-04-04T22:21:12.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1624","labels":"type_cron","state":"Closed","updated_at":"2019-04-04T22:21:12.000-0700","timestamp":1652285839.768136,"priority":"Normal","status_category":"Done","pull_request":2342},{"issue_id":"38425","title":"user purge_ssh_keys cannot remove keys with spaces in the comment","url":"https://tickets.puppetlabs.com/browse/PUP-2737","created_at":"2014-06-06T10:33:37.000-0700","number":"PUP-2737","body":"Given the following:\r\n\r\n{noformat}\r\n# /root/.ssh/authorized_keys\r\n# HEADER: This file was autogenerated at Fri Jun 06 16:59:39 +0000 2014\r\n# HEADER: by puppet.  While it can still be managed manually, it\r\n# HEADER: is definitely not recommended.\r\nssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ== vagrant insecure public key\r\n{noformat}\r\n\r\n{code}\r\nuser { 'root':\r\n  purge_ssh_keys => true,\r\n  home => '/root'\r\n}\r\n{code}\r\n\r\n{noformat}\r\n[root@default puppet]# bundle exec puppet apply ~/purge-ssh.pp --noop --debug\r\nWarning: Could not retrieve fact fqdn\r\nDebug: Failed to load library 'shadow' for feature 'libshadow'\r\nNotice: Compiled catalog for default in environment production in 0.13 seconds\r\n[snip]\r\nDebug: Finishing transaction -610461438\r\nDebug: Loaded state in 0.00 seconds\r\nDebug: Loaded state in 0.00 seconds\r\nInfo: Applying configuration version '1402075867'\r\nDebug: Prefetching parsed resources for ssh_authorized_key\r\nDebug: /Stage[main]/Main/Ssh_authorized_key[key]: Nothing to manage: no ensure and the resource doesn't exist\r\nDebug: Finishing transaction -611010748\r\nDebug: Storing state\r\nDebug: Stored state in 0.01 seconds\r\nNotice: Finished catalog run in 0.08 seconds\r\n{code}\r\n\r\nThe title for the vagrant insecure public key is not fetched correctly and thus cannot be removed.","closed_at":"2019-04-04T22:21:13.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2737","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:13.000-0700","timestamp":1652285840.509321,"priority":"Normal","status_category":"Done","pull_request":2753},{"issue_id":"74061","title":"Default service type and package provider not set on Cumulus Linux","url":"https://tickets.puppetlabs.com/browse/PUP-4351","created_at":"2015-03-31T11:28:20.000-0700","number":"PUP-4351","body":"The default package and service provider are set by the operatingsystem fact. Cumulus Linux uses \"CumulusLinux\" as this fact (it is derived from Debian Linux) and is not correctly detected.  \r\n\r\nA patch/pull request is forthcoming later today. ","closed_at":"2019-04-04T22:21:17.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4351","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:17.000-0700","timestamp":1652285852.10714,"priority":"Normal","status_category":"Done","pull_request":3807},{"issue_id":"56230","title":"Debian init script status and stop actions are unsafe","url":"https://tickets.puppetlabs.com/browse/PUP-3549","created_at":"2014-10-27T05:28:10.000-0700","number":"PUP-3549","body":"Calling {{/etc/init.d/puppet stop}} does not guarantee that the process being stopped is actually puppet agent process. {{start-stop-daemon}} will kill any process which PID happens to be the same as the one stored in {{/var/run/puppet/agent.pid}}.\r\n\r\nThe same applies to {{/etc/init.d/puppet status}}. It calls {{status_of_proc}} internally, but that does not verify if processes' exe is actually puppet. So if there is any other process with the same PID as in {{/var/run/puppet/agent.pid}} then {{/etc/init.d/puppet status}} will return true.\r\n\r\nAttached is a proposed patch to check in start-stop-daemon the exe name and to remove pid file after stopping the agent.","closed_at":"2019-04-04T22:21:18.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3549","labels":"puppet-agent","state":"Closed","updated_at":"2019-04-04T22:21:18.000-0700","timestamp":1652285852.635325,"priority":"Normal","status_category":"Done","pull_request":3239},{"issue_id":"265184","title":"puppet-agent-5.5.4-1.el6.x86_64 on Scientfic Linux 6 fails to use upstart","url":"https://tickets.puppetlabs.com/browse/PUP-9008","created_at":"2018-07-17T15:10:55.000-0700","number":"PUP-9008","body":"When running our Upstart Application 'gatekeeper' (or any other application). 5.5.4 claims ' Provider upstart is not functional on this host':\r\n{code:java}\r\n/opt/puppetlabs/puppet/bin/puppet apply --config /etc/puppetlabs/puppet/puppet.conf --execute \"service {'gatekeeper': ensure => 'running', provider => 'upstart'}\"\r\nNotice: Compiled catalog for zymevault.dev.zymeworks.com in environment production in 0.21 seconds\r\nError: /Stage[main]/Main/Service[gatekeeper]: Provider upstart is not functional on this host\r\nNotice: Applied catalog in 0.07 second{code}\r\nDowngrading to 5.5.3 fixes:\r\n\r\n\r\n\r\n \r\n{code:java}\r\nyum -y downgrade puppet-agent\r\nLoaded plugins: security, versionlock\r\nSetting up Downgrade Process\r\nResolving Dependencies\r\n--> Running transaction check\r\n---> Package puppet-agent.x86_64 0:5.5.3-1.el6 will be a downgrade\r\n---> Package puppet-agent.x86_64 0:5.5.4-1.el6 will be erased\r\n--> Finished Dependency Resolution\r\nDependencies Resolved\r\n===================================================================================================================================================================================================================================\r\n Package Arch Version Repository Size\r\n===================================================================================================================================================================================================================================\r\nDowngrading:\r\n puppet-agent x86_64 5.5.3-1.el6 puppet5 21 M\r\nTransaction Summary\r\n===================================================================================================================================================================================================================================\r\nDowngrade 1 Package(s)\r\nTotal download size: 21 M\r\nDownloading Packages:\r\npuppet-agent-5.5.3-1.el6.x86_64.rpm | 21 MB 00:02\r\nRunning rpm_check_debug\r\nRunning Transaction Test\r\nTransaction Test Succeeded\r\nRunning Transaction\r\n Installing : puppet-agent-5.5.3-1.el6.x86_64 1/2\r\n Cleanup : puppet-agent-5.5.4-1.el6.x86_64 2/2\r\n Verifying : puppet-agent-5.5.3-1.el6.x86_64 1/2\r\n Verifying : puppet-agent-5.5.4-1.el6.x86_64 2/2\r\nRemoved:\r\n puppet-agent.x86_64 0:5.5.4-1.el6\r\nInstalled:\r\n puppet-agent.x86_64 0:5.5.3-1.el6\r\nComplete!\r\n[root@zymevault ~]# /opt/puppetlabs/puppet/bin/puppet apply --config /etc/puppetlabs/puppet/puppet.conf --execute \"service {'gatekeeper': ensure => 'running', provider => 'upstart'}\"\r\nNotice: Compiled catalog for zymevault.dev.zymeworks.com in environment production in 0.21 seconds\r\nNotice: Applied catalog in 0.08 seconds\r\n \r\n{code}\r\n ","closed_at":"2019-04-04T22:21:18.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9008","labels":"docs_reviewed;linux;redhat;regression;service;upstart","state":"Closed","updated_at":"2019-04-04T22:21:18.000-0700","timestamp":1652285852.742237,"priority":"Blocker","status_category":"Done","pull_request":6950},{"issue_id":"22527","title":"Hiding error details in fileserver.conf parser  when this config is wrong","url":"https://tickets.puppetlabs.com/browse/PUP-1246","created_at":"2013-12-26T06:33:16.000-0800","number":"PUP-1246","body":"When I try to apply simple manifest  _test.pp_ which is just tries to copy file from puppet master using *puppet://* schema, I receive following error at client node:\r\n{code}\r\nError: /Stage[main]//File[/tmp/example-file.txt]: Could not evaluate: Error 403 on SERVER: Forbidden request: mel4102.melesta.local(10.32.32.111) access to /file_metadata/custom_files/example-file.txt [find] at :129 Could not retrieve file metadata for puppet://puppet/custom_files/example-file.txt: Error 403 on SERVER: Forbidden request: mel4102.melesta.local(10.32.32.111) access to /file_metadata/custom_files/example-file.txt [find] at :129\r\n{code}\r\n\r\n\r\nAt puppet master logs, when I run it in foreground with this command line\r\n{code}\r\nsudo puppet master --debug --no-daemonize\r\n{code}\r\n\r\nI've found following error:\r\n{code}\r\nError parsing fileserver configuration: wrong number of arguments (3 for 1); using old configuration\r\n{code}\r\n\r\nI've spend half of my working day for debugging this issue and I've discovered than this it happens when there is some invalid line in */etc/puppet/fileserver.conf*. In my case it was some strange symbols '\\xc2\\xa0\\xc2\\xa0' occured in this file, probably after copy-pasting from my browser window into *fileserver.conf*. \r\n\r\nMy next step was to look into *fileserver.conf* parser and I've found the bug  in *lib/puppet/file_serving/configuration/parser.rb*. Because of invalid raising an *ArgumentError* exception, actual useful information about mistakes in *fileserver.conf* is lost. \r\nI think this behaviour is wrong and should be fixed.\r\n\r\nHere is the simple patch with fixing of this mistake + 2 test-cases. \r\nI'll create a pull request after filling this bug ASAP.","closed_at":"2019-04-04T22:21:20.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1246","labels":"puppet-fileserver","state":"Closed","updated_at":"2019-04-04T22:21:20.000-0700","timestamp":1652285853.26854,"priority":"Normal","status_category":"Done","pull_request":2185},{"issue_id":"60562","title":"Puppet acceptance requires the master to have the agent role","url":"https://tickets.puppetlabs.com/browse/PUP-3739","created_at":"2014-12-04T10:04:56.000-0800","number":"PUP-3739","body":"Currently windows acceptance tests use a windows agent and a rhel master, and historically the rhel master also has the agent role. This roughly increases the test time x2 because most of the tests need to be tested against the windows and rhel agents. Since we test rhel agents as part of linux acceptance, including the case where the agent+master roles are on the same host, we don't need to duplicate that effort during windows acceptance.\r\n\r\nHowever, puppet acceptance setup currently fails if the agent role is removed from the master trying to backup /etc/puppet/puppet.conf which doesn't exist:\r\n\r\n{noformat}\r\n  * Grab version for puppetlabs-puppet\r\n\r\nmai9vmv1ujj75p2.delivery.puppetlabs.net (agent-2008r2-x86_64-rubyx86) 21:21:45$  cd /opt/puppet-git-repos/puppetlabs-puppet && git describe || true\r\n3.7.3-804-g00b38df\r\n\r\nmai9vmv1ujj75p2.delivery.puppetlabs.net (agent-2008r2-x86_64-rubyx86) executed in 0.14 seconds\r\n\r\n  * Agents: create basic puppet.conf\r\n\r\nmai9vmv1ujj75p2.delivery.puppetlabs.net (agent-2008r2-x86_64-rubyx86) 21:21:45$  echo '[agent]' > `cygpath -smF 35`/PuppetLabs/puppet/etc/puppet.conf && echo server=tf333gqn5ykgux7.delivery.puppetlabs.net >> `cygpath -smF 35`/PuppetLabs/puppet/etc/puppet.conf\r\ncygwin warning:\r\n  MS-DOS style path detected: C:/PROGRA~3/PuppetLabs/puppet/etc/puppet.conf\r\n  Preferred POSIX equivalent is: /cygdrive/c/PROGRA~3/PuppetLabs/puppet/etc/puppet.conf\r\n  CYGWIN environment variable option \"nodosfilewarning\" turns off this warning.\r\n  Consult the user's guide for more details about POSIX paths:\r\n    http://cygwin.com/cygwin-ug-net/using.html#using-pathnames\r\n\r\nmai9vmv1ujj75p2.delivery.puppetlabs.net (agent-2008r2-x86_64-rubyx86) executed in 0.10 seconds\r\nsetup/git/pre-suite/010_TestSetup.rb passed in 62.29 seconds\r\nBegin setup/git/pre-suite/020_PuppetUserAndGroup.rb\r\n\r\nPuppet User and Group\r\n\r\n  * ensure puppet user and group added to all nodes because this is what the packages do\r\n\r\ntf333gqn5ykgux7.delivery.puppetlabs.net (master) 21:21:45$  env PATH=\"/usr/bin:/opt/puppet-git-repos/hiera/bin:${PATH}\" RUBYLIB=\"/opt/puppet-git-repos/hiera/lib:/opt/puppet-git-repos/hiera-puppet/lib:${RUBYLIB}\" puppet resource user puppet ensure=present\r\nNotice: /User[puppet]/ensure: created\r\nuser { 'puppet':\r\n  ensure => 'present',\r\n}\r\n\r\ntf333gqn5ykgux7.delivery.puppetlabs.net (master) executed in 0.90 seconds\r\n\r\ntf333gqn5ykgux7.delivery.puppetlabs.net (master) 21:21:46$  env PATH=\"/usr/bin:/opt/puppet-git-repos/hiera/bin:${PATH}\" RUBYLIB=\"/opt/puppet-git-repos/hiera/lib:/opt/puppet-git-repos/hiera-puppet/lib:${RUBYLIB}\" puppet resource group puppet ensure=present\r\ngroup { 'puppet':\r\n  ensure => 'present',\r\n}\r\n\r\ntf333gqn5ykgux7.delivery.puppetlabs.net (master) executed in 0.59 seconds\r\n\r\n  * ensure puppet user and group added to all nodes because this is what the packages do\r\n\r\nmai9vmv1ujj75p2.delivery.puppetlabs.net (agent-2008r2-x86_64-rubyx86) 21:21:46$  env PATH=\"$( [ -d \"/cygdrive/c/Program Files (x86)/Puppet Labs/Puppet/bin\" ] && echo \"/cygdrive/c/Program Files (x86)\" || echo \"/cygdrive/c/Program Files\" )/Puppet Labs/Puppet/bin:/opt/puppet-git-repos/hiera/bin:${PATH}\" RUBYLIB=\"`cygpath -w /opt/puppet-git-repos/hiera/lib`;`cygpath -w /opt/puppet-git-repos/hiera-puppet/lib`;${RUBYLIB}\" cmd.exe /c puppet resource user puppet ensure=present\r\nNotice: /User[puppet]/ensure: created\r\nuser { 'puppet':\r\n  ensure => 'present',\r\n}\r\n\r\nmai9vmv1ujj75p2.delivery.puppetlabs.net (agent-2008r2-x86_64-rubyx86) executed in 1.73 seconds\r\n\r\nmai9vmv1ujj75p2.delivery.puppetlabs.net (agent-2008r2-x86_64-rubyx86) 21:21:48$  env PATH=\"$( [ -d \"/cygdrive/c/Program Files (x86)/Puppet Labs/Puppet/bin\" ] && echo \"/cygdrive/c/Program Files (x86)\" || echo \"/cygdrive/c/Program Files\" )/Puppet Labs/Puppet/bin:/opt/puppet-git-repos/hiera/bin:${PATH}\" RUBYLIB=\"`cygpath -w /opt/puppet-git-repos/hiera/lib`;`cygpath -w /opt/puppet-git-repos/hiera-puppet/lib`;${RUBYLIB}\" cmd.exe /c puppet resource group puppet ensure=present\r\nError: Cannot create group if user 'puppet' exists.\r\nError: /Group[puppet]/ensure: change from absent to present failed: Cannot create group if user 'puppet' exists.\r\ngroup { 'puppet':\r\n  ensure => 'absent',\r\n}\r\n\r\nmai9vmv1ujj75p2.delivery.puppetlabs.net (agent-2008r2-x86_64-rubyx86) executed in 1.21 seconds\r\nsetup/git/pre-suite/020_PuppetUserAndGroup.rb passed in 4.42 seconds\r\nBegin setup/common/pre-suite/025_StopFirewall.rb\r\n\r\nStop firewall\r\n\r\ntf333gqn5ykgux7.delivery.puppetlabs.net (master) 21:21:49$  env PATH=\"/usr/bin:/opt/puppet-git-repos/hiera/bin:${PATH}\" RUBYLIB=\"/opt/puppet-git-repos/hiera/lib:/opt/puppet-git-repos/hiera-puppet/lib:${RUBYLIB}\" puppet resource  service firewalld ensure=stopped\r\nservice { 'firewalld':\r\n  ensure => 'stopped',\r\n}\r\n\r\ntf333gqn5ykgux7.delivery.puppetlabs.net (master) executed in 0.63 seconds\r\nNot sure how to clear firewall on windows-2008r2-64\r\nsetup/common/pre-suite/025_StopFirewall.rb passed in 0.63 seconds\r\nBegin setup/git/pre-suite/030_PuppetMasterSanity.rb\r\n\r\nPuppet Master sanity checks: PID file and SSL dir creation\r\n\r\ntf333gqn5ykgux7.delivery.puppetlabs.net (master) 21:21:50$  facter hostname\r\ntf333gqn5ykgux7\r\n\r\ntf333gqn5ykgux7.delivery.puppetlabs.net (master) executed in 0.13 seconds\r\n\r\ntf333gqn5ykgux7.delivery.puppetlabs.net (master) 21:21:50$  facter fqdn\r\ntf333gqn5ykgux7.delivery.puppetlabs.net\r\n\r\ntf333gqn5ykgux7.delivery.puppetlabs.net (master) executed in 0.13 seconds\r\n\r\ntf333gqn5ykgux7.delivery.puppetlabs.net (master) 21:21:50$  mktemp -dt 030_PuppetMasterSanity.rb.XXXXXX\r\n/tmp/030_PuppetMasterSanity.rb.YI6UB2\r\n\r\ntf333gqn5ykgux7.delivery.puppetlabs.net (master) executed in 0.05 seconds\r\nSetting curl retries to 30\r\n\r\ntf333gqn5ykgux7.delivery.puppetlabs.net (master) 21:21:50$  test -e /etc/puppet/puppet.conf\r\n\r\ntf333gqn5ykgux7.delivery.puppetlabs.net (master) executed in 0.05 seconds\r\nExited: 1\r\nWarning: Could not backup file '/etc/puppet/puppet.conf': no such file\r\n\r\ntf333gqn5ykgux7.delivery.puppetlabs.net (master) 21:21:50$  cat /etc/puppet/puppet.conf\r\ncat: /etc/puppet/puppet.conf: No such file or directory\r\n\r\ntf333gqn5ykgux7.delivery.puppetlabs.net (master) executed in 0.05 seconds\r\nExited: 1\r\n{noformat}","closed_at":"2019-04-04T22:21:23.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3739","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:23.000-0700","timestamp":1652285854.635762,"priority":"Normal","status_category":"Done","pull_request":3387},{"issue_id":"122085","title":"Wrong selinux type for files in symlinked directories","url":"https://tickets.puppetlabs.com/browse/PUP-6071","created_at":"2016-03-18T00:04:59.000-0700","number":"PUP-6071","body":"matchpathcon does only act on the passed string and not resolve the real path problematic if puppet manages /etc/init.d/script on RHEL which symlinks /etc/init.d to /etc/rc.d/init.d. matchpathcon will return the wrong label.\r\n\r\nThis mimics restorecon behaviour.\r\n\r\nh3. Example restorecon vs. matchpathcon\r\n{noformat}\r\n[root@el6 util]# matchpathcon /etc/init.d/sshd\r\n/etc/init.d/sshd        system_u:object_r:initrc_exec_t:s0\r\n[root@el6 util]# matchpathcon /etc/rc.d/init.d/sshd\r\n/etc/rc.d/init.d/sshd   system_u:object_r:sshd_initrc_exec_t:s0\r\n\r\n[root@el6 util]# ls -lZ /etc/init.d/sshd\r\n-rwxr-xr-x. root root system_u:object_r:initrc_exec_t:s0 /etc/init.d/sshd\r\n[root@el6 util]# restorecon -v /etc/init.d/sshd\r\nrestorecon reset /etc/rc.d/init.d/sshd context system_u:object_r:initrc_exec_t:s0->system_u:object_r:sshd_initrc_exec_t:s0\r\n{noformat}\r\n\r\n\r\nh3. Possible problems fixing this\r\nusers maybe have added wrong selinux fcontext rules. If puppet now applies the new \"correct\" type it's maybe not wrongly configured one","closed_at":"2019-04-04T22:21:24.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6071","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:24.000-0700","timestamp":1652285854.842981,"priority":"Normal","status_category":"Done","pull_request":4797},{"issue_id":"14946","title":"Backslashify windows paths when appropriate","url":"https://tickets.puppetlabs.com/browse/PUP-398","created_at":"2013-09-19T00:21:29.000-0700","number":"PUP-398","body":"When installing an MSI, the windows package provider passes the package source parameter to msiexec.exe. Unfortunately, it <b>must</b> use backslashes, otherwise, msiexec thinks it's a command line argument and will fail with a cryptic error: <pre>Failed to install: Fail on INT 24.</pre>\r\nThe windows package provider should automatically convert the source to backslashes so that it just works.","closed_at":"2019-04-04T22:21:24.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-398","labels":"windows","state":"Closed","updated_at":"2019-04-04T22:21:24.000-0700","timestamp":1652285854.948956,"priority":"Normal","status_category":"Done","pull_request":3846},{"issue_id":"79934","title":"'bsd' service provider doesn't work with rcng","url":"https://tickets.puppetlabs.com/browse/PUP-4602","created_at":"2015-05-13T03:48:20.000-0700","number":"PUP-4602","body":"Enabling services with rcng (NetBSD's rc system) doesn't work with the 'bsd' service provider. It writes 'foo_enable=\"YES\"' but that returns an error with rcng.\r\n\r\nA new provider subclassing the 'bsd' provider should be added to fix this.","closed_at":"2019-04-04T22:21:24.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4602","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:24.000-0700","timestamp":1652285855.159227,"priority":"Normal","status_category":"Done","pull_request":3931},{"issue_id":"56645","title":"module skeleton should not require rubygems ","url":"https://tickets.puppetlabs.com/browse/PUP-3569","created_at":"2014-10-29T12:22:36.000-0700","number":"PUP-3569","body":"As per [~andy], we should not require rubygems. Currently this is added to all Rakefile's when generating modules.","closed_at":"2019-04-04T22:21:27.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3569","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:27.000-0700","timestamp":1652285856.385721,"priority":"Normal","status_category":"Done","pull_request":3256},{"issue_id":"51210","title":"Win32::TaskScheduler#trigger_string doesn't work","url":"https://tickets.puppetlabs.com/browse/PUP-3247","created_at":"2014-09-15T10:43:01.000-0700","number":"PUP-3247","body":"Our vendored `Win32::TaskScheduler#trigger_string` method doesn't define the `trigger` variable, so the reference to `trigger` on line 576 will cause the `#trigger` method to be invoked with 0 arguments, and that fails with:\r\n\r\n{noformat}\r\nin `trigger': wrong number of arguments (0 for 1) (ArgumentError)\r\n{noformat}\r\n\r\nThis code path doesn't occur in Puppet, just when using puppet as a library.","closed_at":"2019-04-04T22:21:28.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3247","labels":"windows","state":"Closed","updated_at":"2019-04-04T22:21:28.000-0700","timestamp":1652285856.805214,"priority":"Normal","status_category":"Done","pull_request":3246},{"issue_id":"63530","title":"pip package provider is broken on EL (where osfamily is RedHat)","url":"https://tickets.puppetlabs.com/browse/PUP-3829","created_at":"2015-01-10T12:06:30.000-0800","number":"PUP-3829","body":"https://groups.google.com/forum/#!topic/puppet-users/2wOLKZ2SokQ\r\n\r\nTo duplicate, on an EL system (I used EL7) install `python-pip` then run `puppet apply -d pip.pp` with the code below in pip.pp\r\n\r\n{code}\r\npackage { 's3cmd':\r\n  ensure   => present,\r\n  provider => pip,\r\n{code}\r\n\r\nError\r\n{code}\r\nError: Could not set 'present' on ensure: Could not locate the pip command.\r\n{code}\r\n\r\nFix:\r\nThe code is looking for `python-pip` as the binary when osfamily is 'RedHat' which is incorrect. Confirmed by symlinking /usr/bin/python-pip -> /usr/bin/pip and then it worked.\r\n","closed_at":"2019-04-04T22:21:29.000-0700","comments":34,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3829","labels":"","state":"Resolved","updated_at":"2019-04-04T22:21:29.000-0700","timestamp":1652285857.235222,"priority":"Normal","status_category":"Done","pull_request":3468},{"issue_id":"15942","title":"(PR) (22617) In Augeas onlyif, compare number strings numerically","url":"https://tickets.puppetlabs.com/browse/PUP-442","created_at":"2013-10-01T11:31:43.000-0700","number":"PUP-442","body":"Without this patch applied, onlyif comparitors <, >, <=, and >= always\r\ndo string comparisions, even when the strings are numbers. This\r\nmakes it impossible to enforce relative policy, such as:\r\n\r\nonlyif => 'get PASS_MAX_DAYS > 90',\r\nin login.defs, for example. If PASS_MAX_DAYS had the value 120, the\r\nonlyif would evaluate false (not need-to-run). See ticket for more details.\r\n\r\nWithout this patch, onlyif uses string comparison, such that 120 < 90.\r\n\r\nThis patch converts strings to integers and uses numeric comparison\r\nwhen both operands of the relative comparitor are valid numbers.\r\n\r\nThis patch also fixes another bug that isn't reported in a ticket, namely\r\nthat the parser erroneously converts \">=\" to \">\" and \"<=\" to \"<\".","closed_at":"2019-04-04T22:21:29.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-442","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:29.000-0700","timestamp":1652285857.340648,"priority":"Normal","status_category":"Done","pull_request":3841},{"issue_id":"92571","title":"Base class for JSON/msgpack indirection termini calls log_exception() wrong","url":"https://tickets.puppetlabs.com/browse/PUP-5014","created_at":"2015-08-10T05:02:40.000-0700","number":"PUP-5014","body":"In Puppet::Indirector::JSON, Puppet.log_exception() is called without the required exception as the first argument value, instead the message is passed.\r\n\r\n{code}\r\nPuppet.log_exception \"Could not save #{self.name} #{request.key}: #{detail}\"\r\n{code}\r\nWhile it should really be:\r\n{code}\r\nPuppet.log_exception(detail, \"Could not save #{self.name} #{request.key}: #{detail}\")\r\n{code}\r\n\r\nThis breaks further along in format_exception() as it attempts to get the exception message attribute but finds a string:\r\n\r\nError: Could not retrieve catalog from remote server: undefined method `message' for #<String:0x00000003efda28>\r\n/opt/ruby2.0/lib/vendor_ruby/2.0.0/puppet/util/logging.rb:70:in `format_exception'\r\n/opt/ruby2.0/lib/vendor_ruby/2.0.0/puppet/util/logging.rb:45:in `log_exception'\r\n/var/lib/puppet/lib/puppet/indirector/catalog/json_timestamped.rb:18:in `rescue in save'\r\n/var/lib/puppet/lib/puppet/indirector/catalog/json_timestamped.rb:13:in `save'\r\n/opt/ruby2.0/lib/vendor_ruby/2.0.0/puppet/indirector/indirection.rb:206:in `find'\r\n/opt/ruby2.0/lib/vendor_ruby/2.0.0/puppet/configurer.rb:294:in `block in retrieve_new_catalog'\r\n/opt/ruby2.0/lib/vendor_ruby/2.0.0/puppet/util.rb:335:in `block in thinmark'\r\n/opt/ruby2.0/lib/2.0.0/benchmark.rb:296:in `realtime'\r\n/opt/ruby2.0/lib/vendor_ruby/2.0.0/puppet/util.rb:334:in `thinmark'\r\n/opt/ruby2.0/lib/vendor_ruby/2.0.0/puppet/configurer.rb:293:in `retrieve_new_catalog'\r\n/opt/ruby2.0/lib/vendor_ruby/2.0.0/puppet/configurer.rb:61:in `retrieve_catalog'\r\n/opt/ruby2.0/lib/vendor_ruby/2.0.0/puppet/configurer.rb:106:in `prepare_and_retrieve_catalog'\r\n/opt/ruby2.0/lib/vendor_ruby/2.0.0/puppet/configurer.rb:202:in `run_internal'\r\n/opt/ruby2.0/lib/vendor_ruby/2.0.0/puppet/configurer.rb:134:in `block in run'\r\n...\r\n","closed_at":"2019-04-04T22:21:30.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5014","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:30.000-0700","timestamp":1652285857.555117,"priority":"Normal","status_category":"Done","pull_request":4145},{"issue_id":"15962","title":"(PR) (#22665) mounts should autorequire parent mounts","url":"https://tickets.puppetlabs.com/browse/PUP-450","created_at":"2013-10-01T12:48:41.000-0700","number":"PUP-450","body":"Given two mount points:\r\n\r\nmount { \"/var/log\":\r\n  # ...\r\n}\r\n\r\nmount { \"/var\":\r\n  # ...\r\n}\r\nThe mount '/var/log' should autorequire '/var' so that the child mount\r\nis not masked by the parent mount.","closed_at":"2019-04-04T22:21:31.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-450","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:31.000-0700","timestamp":1652285858.00673,"priority":"Normal","status_category":"Done","pull_request":3932},{"issue_id":"114855","title":"Yum provider incorrectly computes epoch for RPM package versions","url":"https://tickets.puppetlabs.com/browse/PUP-5802","created_at":"2016-02-02T09:46:36.000-0800","number":"PUP-5802","body":"There is a bug in the `yum_parse_evr` code that the yum package provider uses to parse version strings into epoch, version, release hashes:\r\n\r\n {code:ruby}\r\n def yum_parse_evr(s)\r\n    ei = s.index(':')\r\n    if ei\r\n      e = s[0,ei]\r\n      s = s[ei+1,s.length]\r\n    else\r\n      e = nil\r\n    end\r\n    e = String(Bignum(e)) rescue '0'\r\n   # ...\r\n{code}\r\n\r\n{{Bignum()}} is not a function. This causes all epochs to throw an error and be coerced into '0'.\r\n","closed_at":"2019-04-04T22:21:33.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5802","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:33.000-0700","timestamp":1652285858.638059,"priority":"Normal","status_category":"Done","pull_request":4616},{"issue_id":"109792","title":"agent stalls when connection with master is dropped","url":"https://tickets.puppetlabs.com/browse/PUP-5617","created_at":"2015-12-16T08:14:49.000-0800","number":"PUP-5617","body":"I noticed some agents stopped reporting suddenly. I logged in to one of the nodes and run \"ps\", and I noticed the agent process was in \"sleep\" state since several days, just doing nothing.\r\n\r\nHere's what I figured out: when the network socket opened with the master is dropped without getting properly closed (network issue, master died, etc) the agent waits for a response forever, which prevents further agent runs because of /opt/puppetlabs/puppet/cache/state/agent_catalog_run.lock.\r\n\r\nThe issue lies in ruby's net/http library, which doesn't set the keepalive bit on the socket it creates by default: https://github.com/ruby/ruby/blob/ruby_2_2/lib/net/http.rb#L881\r\n\r\nHere is what a connection from the agent to the master looks like, notice the \"off\" and all the timers set to 0:\r\n{code}\r\n$ netstat -nto | grep 8140\r\ntcp        0      0 10.27.70.16:45865       1.2.3.4:8140      ESTABLISHED off (0.00/0/0)\r\n{code}\r\nCompare this to an elasticsearch cluster connection for example:\r\n{code}\r\ntcp6       0      0 10.27.70.16:9300        10.27.70.132:54637      ESTABLISHED keepalive (1880.31/0/0)\r\n{code}\r\n\r\nstrace show well what misses:\r\n{code}\r\nstrace -fe setsockopt /opt/puppetlabs/bin/puppet agent -t --noop\r\n[...]\r\n23566 setsockopt(8, SOL_TCP, TCP_NODELAY, [1], 4) = 0\r\n[...]\r\n{code}\r\ncompare this with curl's default settings:\r\n{code}\r\nstrace -fe setsockopt /usr/bin/curl -k https://1.2.3.4:8140\r\nsetsockopt(3, SOL_SOCKET, SO_KEEPALIVE, [1], 4) = 0\r\nsetsockopt(3, SOL_TCP, TCP_KEEPIDLE, [60], 4) = 0\r\nsetsockopt(3, SOL_TCP, TCP_KEEPINTVL, [60], 4) = 0\r\n{code}\r\n\r\nI have a patch for this I'll submit to github in a moment. I'll also deploy it to our fleet and report back here in a couple of days.","closed_at":"2019-04-04T22:21:35.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5617","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:35.000-0700","timestamp":1652285859.583633,"priority":"Normal","status_category":"Done","pull_request":4508},{"issue_id":"27094","title":"PR (2383): Suse chkconfig --check boot.<service> always returns 1 whether the service is enabled/disabled. - m4ce","url":"https://tickets.puppetlabs.com/browse/PUP-1751","created_at":"2014-02-23T11:47:41.000-0800","number":"PUP-1751","body":"h2. Suse chkconfig --check boot.<service> always returns 1 whether the service is enabled/disabled.\n\n * Author: Matteo <>\n * Company: \n * Github ID: [m4ce|https://github.com/m4ce]\n * [Pull Request 2383 Discussion|https://github.com/puppetlabs/puppet/pull/2383]\n * [Pull Request 2383 File Diff|https://github.com/puppetlabs/puppet/pull/2383/files]\n\nh2. Pull Request Description\n----\n\nThe following changes fix this by checking the output of chkconfig boot.<service>. If it ends with off, the service is disabled.\r\n\r\nMind that chkconfig --check works as expected with all the other services that don't start with boot.\n\n----\n(webhooks-id: ae418bab39b72aeac5eb15a9c5cf9836)\n","closed_at":"2019-04-04T22:21:36.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1751","labels":"github","state":"Closed","updated_at":"2019-04-04T22:21:36.000-0700","timestamp":1652285859.689146,"priority":"Normal","status_category":"Done","pull_request":2447},{"issue_id":"25991","title":"\"current thread not owner\" after Puppet Agent receives USR1 signal","url":"https://tickets.puppetlabs.com/browse/PUP-1635","created_at":"2014-02-10T12:38:52.000-0800","number":"PUP-1635","body":"We're running the Puppet Agent daemonised, with {{splay}} enabled. We use the {{USR1}} signal to trigger an immediate reload and catalog run, bypassing the splay setting.\r\n\r\nThis works fine in our other Ruby environment (1.9.3, various patch levels), but when testing under Ruby 2.0.0 and 2.1.0, we noticed that the signal would cause the catalog run to fail due to the following errors:\r\n\r\n{quote}\r\nFailed to apply catalog: Could not autoload puppet/feature/external_facts: current thread not owner\r\nCould not autoload puppet/feature/external_facts: current thread not owner\r\nCould not autoload puppet/indirector/node/rest: current thread not owner\r\n{quote}\r\n\r\nA restart of the daemon is required to recover from this.","closed_at":"2019-04-04T22:21:36.000-0700","comments":22,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1635","labels":"ruby2.0.0;ruby2.1.0","state":"Closed","updated_at":"2019-04-04T22:21:36.000-0700","timestamp":1652285859.800878,"priority":"Normal","status_category":"Done","pull_request":3586},{"issue_id":"48391","title":"Error in puppet module skeleton","url":"https://tickets.puppetlabs.com/browse/PUP-3082","created_at":"2014-08-19T09:24:40.000-0700","number":"PUP-3082","body":"The puppet module skeleton specifies a Gemfile with the following line:\r\n\r\n{noformat}\r\npuppetversion = ENV.key?('PUPPET_VERSION') ? \"= #{ENV['PUPPET_VERSION']}\" : ['>= 3.3']\r\n{noformat}\r\n\r\nif you define an env var as PUPPET_VERSION=\"~> 3.6.0\" as most people do when testing with travis, bundler will complain stating it cannot meet the requirements.\r\n\r\nChanging the line to:\r\n{noformat}\r\npuppetversion = ENV.key?('PUPPET_VERSION') ? \"#{ENV['PUPPET_VERSION']}\" : ['>= 3.3']\r\n{noformat}\r\n\r\nFixes the issue.","closed_at":"2019-04-04T22:21:40.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3082","labels":"moduletool","state":"Closed","updated_at":"2019-04-04T22:21:40.000-0700","timestamp":1652285861.183327,"priority":"Normal","status_category":"Done","pull_request":2992},{"issue_id":"80697","title":"Augeas onlyif does not work when using arrays to match against","url":"https://tickets.puppetlabs.com/browse/PUP-4629","created_at":"2015-05-19T08:40:50.000-0700","number":"PUP-4629","body":"According to the type reference, you should be able to use the 'onlyif' metaparameter of the augeas type to check if the results from an augeas path equal an array. The augeas type does not return values, however, so it can never match the values in your array. Instead it returns an array of augeas paths.","closed_at":"2019-04-04T22:21:41.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4629","labels":"augeas","state":"Closed","updated_at":"2019-04-04T22:21:41.000-0700","timestamp":1652285861.395395,"priority":"Normal","status_category":"Done","pull_request":3952},{"issue_id":"21684","title":"PR (2061) Augeas provider warns on parse errors in other files handled by same lens","url":"https://tickets.puppetlabs.com/browse/PUP-1158","created_at":"2013-12-18T00:26:10.000-0800","number":"PUP-1158","body":"Greetings,\r\n\r\nwe are evaluating Puppet 3.0. At the moment we are getting errors from the augeas provider:\r\nWarning: Augeas[xxxxxx](provider=augeas): Loading failed for one or more files, see debug for /augeas//error output\r\n\r\n$ rpm -qa|grep puppet\r\npuppet-server-3.0.1-1.el6.noarch\r\npuppet-3.0.1-1.el6.noarch\r\npuppetdb-terminus-1.0.2-1.el6.noarch\r\npuppet-dashboard-1.2.12-1.el6.noarch\r\n$ rpm -qa|grep augeas\r\naugeas-libs-0.9.0-1.el6.x86_64\r\naugeas-0.9.0-1.el6.x86_64\r\naugeas-devel-0.9.0-1.el6.x86_64\r\nruby-augeas-0.4.1-1.el6.x86_64\r\n\r\nThe file manipulation of the files via augtool and the provider works fine but we always get the warning.\r\n\r\nSame modules works fine with puppet 2.7 without any warnings\r\n","closed_at":"2019-04-04T22:21:42.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1158","labels":"redmine","state":"Closed","updated_at":"2019-04-04T22:21:42.000-0700","timestamp":1652285861.931831,"priority":"Normal","status_category":"Done","pull_request":2061},{"issue_id":"22667","title":"service status is ignored ( puppet 3.2 + upstart provider )","url":"https://tickets.puppetlabs.com/browse/PUP-1293","created_at":"2013-12-30T10:50:22.000-0800","number":"PUP-1293","body":"<pre>\r\ncat > test.pp &lt;&lt;EOF\r\nnotice(\"os = $::operatingsystem, puppetversion = $::puppetversion\")\r\nexec { 'run':\r\n  command => \"/sbin/status network-interface INTERFACE=eth0\",\r\n  logoutput => true,\r\n}\r\n->\r\nservice { 'network-interface':\r\n  ensure   => running,\r\n  status   => '/sbin/status network-interface INTERFACE=eth0',\r\n}\r\nEOF\r\npuppet apply test.pp\r\n</pre>\r\nwill output the following\r\n<pre>\r\nNotice: Scope(Class[main]): os = Ubuntu, puppetversion = 3.2.4\r\nNotice: /Stage[main]//Exec[run]/returns: network-interface (eth0) start/running\r\nNotice: /Stage[main]//Exec[run]/returns: executed successfully\r\nError: /Stage[main]//Service[network-interface]: Could not evaluate: Execution of '/sbin/status network-interface' returned 1: status: Unknown parameter: INTERFACE\r\nNotice: Finished catalog run in 0.27 seconds\r\n</pre>\r\n","closed_at":"2019-04-04T22:21:42.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1293","labels":"redmine","state":"Closed","updated_at":"2019-04-04T22:21:42.000-0700","timestamp":1652285862.037884,"priority":"Normal","status_category":"Done","pull_request":4525},{"issue_id":"94406","title":"parent attributes are set from metadata too early in static_compiler","url":"https://tickets.puppetlabs.com/browse/PUP-5055","created_at":"2015-08-20T06:40:13.000-0700","number":"PUP-5055","body":"in get_child_resources() we are assigning mode, owner and group attributes to the parent too early.\r\n\r\n{code}\r\n   ...\r\n    total.each do |meta|\r\n      # This is the top-level parent directory\r\n      if meta.relative_path == \".\"\r\n        replace_metadata(request, resource, meta)\r\n        next\r\n      end\r\n      children[meta.relative_path] ||= Puppet::Resource.new(:file, File.join(file[:path], meta.relative_path))\r\n\r\n      # I think this is safe since it's a URL, not an actual file\r\n      children[meta.relative_path][:source] = source + \"/\" + meta.relative_path\r\n      resource.each do |param, value|\r\n        # These should never be passed to our children.\r\n        unless [:parent, :ensure, :recurse, :recurselimit, :target, :alias, :source].include? param\r\n          children[meta.relative_path][param] = value\r\n        end\r\n      end\r\n      replace_metadata(request, children[meta.relative_path], meta)\r\n    end\r\n\r\n    children\r\n  end\r\n  ...\r\n{code}\r\n\r\nThis sets the parent's owner, group and mode attributes from metadata, subsequently causing all child resources to inherit the same values when its their turn in the loop.\r\n\r\nChild resources should only inherit attribute values if they are explicitly set on the parent resource.\r\n\r\nIn other cases *source_permissions* should probably determine how the child attributes are set:\r\n\r\n*use*\r\n  Set owner, group, and mode from metadata, as done in calls to replace_metadata().\r\n*ignore*\r\n  Don't set them\r\n*use_when_creating*\r\n  We can't really tell if a file already exists while compiling a catalog remotely, so idk what to do here.\r\n\r\n","closed_at":"2019-04-04T22:21:44.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5055","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:44.000-0700","timestamp":1652285862.458869,"priority":"Normal","status_category":"Done","pull_request":4184},{"issue_id":"41617","title":"yumrepo fails to honour custom reposdir","url":"https://tickets.puppetlabs.com/browse/PUP-2916","created_at":"2014-07-09T02:53:24.000-0700","number":"PUP-2916","body":"With yum.conf containing reposdir=/etc/yum.repos.d/custom all was well with 3.4.3 and puppet managed the repo files correctly.  \r\n\r\nSince the 3.5 changes to yumrepo, it no longer uses the custom repodir, so writes the repo files to the wrong directory (/etc/yum.repos.d).  But then yum  isn't reading them from this directory, so none of them are picked up by yum.","closed_at":"2019-04-04T22:21:47.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2916","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:47.000-0700","timestamp":1652285875.040457,"priority":"Normal","status_category":"Done","pull_request":3585},{"issue_id":"36224","title":"Exit code 0 on wrong command","url":"https://tickets.puppetlabs.com/browse/PUP-2622","created_at":"2014-05-20T06:28:40.000-0700","number":"PUP-2622","body":"Running {code}puppet garbarge ; echo $?{code} generates\r\n{noformat}\r\nError: Unknown Puppet subcommand 'garbarge'\r\nSee 'puppet help' for help on available puppet subcommands\r\n0\r\n{noformat}\r\nThe exit code should not be 0. In my case I run {code}puppet --detailed-exitcodes apply ... {code} in automated way and the failure was not detected because of exit code 0\r\n","closed_at":"2019-04-04T22:21:48.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2622","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:48.000-0700","timestamp":1652285875.356893,"priority":"Normal","status_category":"Done","pull_request":2721},{"issue_id":"27900","title":"3.4.0 broke compatibility with plugins using the hiera indirector terminus","url":"https://tickets.puppetlabs.com/browse/PUP-1843","created_at":"2014-03-04T09:20:55.000-0800","number":"PUP-1843","body":"The hiera indirector terminus was removed in 3.4.0, this was a public API and used in for example https://github.com/dalen/puppet-hiera-node\r\n\r\nI think it makes sense to keep as it is easier to use than the DataBinding one (you just need to pass a hash instead of a scope object).\r\n\r\nBut either way it should have been marked as deprecated and possibly removed in 4.0 instead of in the middle of a series.","closed_at":"2019-04-04T22:21:49.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1843","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:49.000-0700","timestamp":1652285875.570948,"priority":"Normal","status_category":"Done","pull_request":2639},{"issue_id":"22627","title":"'pkg' package provider does not understand IPS package versions properly","url":"https://tickets.puppetlabs.com/browse/PUP-1270","created_at":"2013-12-30T02:37:03.000-0800","number":"PUP-1270","body":"It would seem the 'pkg' provider (for illumos/Solaris/OpenSolaris IPS) does not\r\ndo the right thing with IPS package versions. We're running OmniOS and seeing\r\nthis:\r\n\r\n{noformat}\r\n    kekkonen ~ % pfexec puppet apply -e 'package {\"mdb\": ensure => latest }'\r\n    Notice: Compiled catalog for kekkonen.niksula.hut.fi in environment production in 1.17 seconds\r\n    Notice: Finished catalog run in 6.39 seconds\r\n    kekkonen ~ % pfexec pkg update -nv mdb                                                  \r\n                Packages to update:        1\r\n         Estimated space available: 14.11 TB\r\n    Estimated space to be consumed: 24.61 MB\r\n           Create boot environment:       No\r\n    Create backup boot environment:      Yes\r\n              Rebuild boot archive:       No\r\n\r\n    Changed packages:\r\n    omnios\r\n      developer/debug/mdb\r\n        0.5.11,5.11-0.151006:20130731T194820Z -> 0.5.11,5.11-0.151006:20131019T183740Z\r\n{noformat}\r\n\r\nSo puppet thinks there are no updates, but pkg correctly notices that an update\r\nis available (only the timestamp has changed, not the version, build release,\r\nor branch numbers).\r\n\r\npuppet resource provides some insight into this:\r\n\r\n{noformat}\r\n    kekkonen ~ % puppet resource package mdb\r\n    package { 'mdb':\r\n      ensure => '0.5.11-0.151006',\r\n    }\r\n{noformat}\r\n\r\nThis version number is not correct, it's missing the build release (5.11) and\r\ntimestamp.\r\n","closed_at":"2019-04-04T22:21:52.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1270","labels":"redmine;solaris","state":"Closed","updated_at":"2019-04-04T22:21:52.000-0700","timestamp":1652285876.737438,"priority":"Normal","status_category":"Done","pull_request":3385},{"issue_id":"22230","title":"sshkey creates /etc/ssh/ssh_known_hosts with mode 600","url":"https://tickets.puppetlabs.com/browse/PUP-1177","created_at":"2013-12-18T20:27:28.000-0800","number":"PUP-1177","body":"Using the sshkey type /etc/ssh/ssh_known_hosts is created with mode 600 by default.  This seems undesirable in most situations.  I think the default should be 644.  I didn't see anything obvious in the sshkey code that set it strictly on purpose.  Does puppet default to 600 somewhere?  And is there a simple way to tweak a type to use a different mode?  This seems like a similar issue to #1538.  Of course, it's not an inifile, so the fix will be different.","closed_at":"2019-04-04T22:21:53.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1177","labels":"redmine","state":"Closed","updated_at":"2019-04-04T22:21:53.000-0700","timestamp":1652285876.843887,"priority":"Normal","status_category":"Done","pull_request":2756},{"issue_id":"92575","title":"SysV init script managed by 'init' provider instead of 'debian' provider on Debian8","url":"https://tickets.puppetlabs.com/browse/PUP-5016","created_at":"2015-08-10T07:44:32.000-0700","number":"PUP-5016","body":"Enable a service managed with a SysV init script instead of a systemd service file on Debian 8 does not work anymore since https://github.com/puppetlabs/puppet/commit/7fe6164 as it fallback to 'init' provider which does not support 'enable' feature instead of 'debian' provider.","closed_at":"2019-04-04T22:21:55.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5016","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:55.000-0700","timestamp":1652285877.789781,"priority":"Normal","status_category":"Done","pull_request":4146},{"issue_id":"33049","title":"Yumrepo type allows invalid values","url":"https://tickets.puppetlabs.com/browse/PUP-2360","created_at":"2014-04-24T10:18:18.000-0700","number":"PUP-2360","body":"The regexps that validate the values are not restricting the whole line, allowing values like \"whateverTrueIwant\" inside yumrepo boolean options.","closed_at":"2019-04-04T22:21:56.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2360","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:56.000-0700","timestamp":1652285878.277551,"priority":"Normal","status_category":"Done","pull_request":2575},{"issue_id":"70711","title":"Gem version specifiers are not idempotent","url":"https://tickets.puppetlabs.com/browse/PUP-4131","created_at":"2015-03-09T03:18:40.000-0700","number":"PUP-4131","body":"*Original*\r\n\r\nIt would be useful to support Gem version requirements in package resources, such as:\r\n\r\n{code:puppet}\r\n    package { 'hiera-eyaml-gpg':\r\n      ensure   => '>= 0.5.rc1',\r\n      provider => gem,\r\n    }\r\n{code}\r\n\r\nor\r\n\r\n{code:puppet}\r\n    package { 'ruby_gpg':\r\n      ensure   => '~> 0.3',\r\n      provider => gem,\r\n    }\r\n{code}\r\n\r\n*Updated*\r\n\r\nPreviously, if the manifest specified a gem version as a constraint, e.g. {{~> 0.3}}, as opposed to an explicit version {{1.2.3}} or {{latest}}, then the gem provider was not idempotent, and would attempt to reinstall the gem each time. With this fix, the gem provider is idempotent when using a gem version constraint.","closed_at":"2019-04-04T22:21:57.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4131","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:57.000-0700","timestamp":1652285878.913119,"priority":"Normal","status_category":"Done","pull_request":4017},{"issue_id":"24032","title":"Puppet Agent windows services accidentally comes of out Paused state","url":"https://tickets.puppetlabs.com/browse/PUP-1471","created_at":"2014-01-19T17:30:43.000-0800","number":"PUP-1471","body":"The Windows Puppet Agent service will not stay in a paused stated, instead it will go back into a running state after a short period of time.\r\n\r\nThis is an issue in the Win32-Service ruby code.  Raised bug https://github.com/djberg96/win32-service/issues/11 and is fixed in version 0.8.3.\r\n\r\nBecause the Pause feature is so rarely used, there is no point in creating a workaround until puppet uses 0.8.3.\r\n","closed_at":"2019-04-04T22:21:59.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1471","labels":"","state":"Closed","updated_at":"2019-04-04T22:21:59.000-0700","timestamp":1652285879.553876,"priority":"Normal","status_category":"Done","pull_request":2859},{"issue_id":"21359","title":"PR (2385) naginator not parsing blank parameters","url":"https://tickets.puppetlabs.com/browse/PUP-1041","created_at":"2013-12-16T03:01:23.000-0800","number":"PUP-1041","body":"Even though it wrote it, and is valid nagios syntax, The Naginator can not parse this:\r\n\r\n{code}\r\n    define host {\r\n            host_name                      gib-proxytest\r\n            parents\r\n            hostgroups                     gib\r\n            use                            linux-server\r\n            address                        10.3.100.72\r\n            alias                          proxytest\r\n    }\r\n{code}\r\n\r\nWhere the parents value is blank. It borks with:\r\n\r\n{code}\r\n    err: Could not prefetch nagios_host provider 'naginator': Could not parse configuration for nagios_host: line 62: syntax error at '\r\n    ' in /etc/nagios/nagios_host.cfg\r\n{code}\r\n\r\nAnd then rebuilds the file from scratch every time.","closed_at":"2019-04-04T22:22:01.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1041","labels":"nagios;redmine","state":"Closed","updated_at":"2019-04-04T22:22:01.000-0700","timestamp":1652285880.189123,"priority":"Normal","status_category":"Done","pull_request":8137},{"issue_id":"85569","title":"Static compiler only looks for file content in production environment","url":"https://tickets.puppetlabs.com/browse/PUP-4771","created_at":"2015-06-21T04:57:01.000-0700","number":"PUP-4771","body":"When using environments other than production with the static_compiler terminus, content for new files is retrieved from production instead of the request environment.\r\n\r\nSteps to reproduce:\r\n1. catalog_terminus = static_compiler\r\n2. create test environment with file that doesn't exist in production\r\n3. run puppet\r\n\r\nI picked 3.7.4 as affected version because that's when we switched to static_compiler, but as far as I can tell this has always been a bug and all versions of Puppet are affected.\r\n\r\nI'm submitting a patch that we've been using in production for a few months to fix this issue.","closed_at":"2019-04-04T22:22:02.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4771","labels":"","state":"Closed","updated_at":"2019-04-04T22:22:02.000-0700","timestamp":1652285880.714954,"priority":"Normal","status_category":"Done","pull_request":4041},{"issue_id":"27406","title":"yumhelper.py: Not respecting the yum lock leads to RPM database corruption","url":"https://tickets.puppetlabs.com/browse/PUP-1775","created_at":"2014-02-26T12:07:54.000-0800","number":"PUP-1775","body":"We're recently seeing frequent rpm database corruption on our systems and have narrowed it down to yumhelper.py not respecting Yum's lock. Not doing so means that a concurrently running yum, or any other application using the yum library,  will make yumhelper.py corrupt the rpm database.\r\n\r\nIn our case an ossec module which uses the yum library and does proper locking started taking longer and now there are frequent clashes between it and a puppet run. This doesn't always cause corruption, but we've been seeing it quite a bit. Making yumhelper.py respect Yum's lock fixed the corruption problem for us.\r\n\r\nA patch for this can be found on https://github.com/puppetlabs/puppet/pull/2387","closed_at":"2019-04-04T22:22:03.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1775","labels":"","state":"Closed","updated_at":"2019-04-04T22:22:03.000-0700","timestamp":1652285881.243895,"priority":"Normal","status_category":"Done","pull_request":2670},{"issue_id":"173025","title":"Puppet  ensure=>latest doesn't work in case of dots in package name","url":"https://tickets.puppetlabs.com/browse/PUP-7145","created_at":"2017-01-31T08:10:28.000-0800","number":"PUP-7145","body":"On Amazon linux  I tried to \r\n{noformat}\r\nclass test {\r\n  package { 'java':\r\n    ensure          => 'latest',\r\n    name            => 'java-1.8.0-openjdk',\r\n  }\r\n}\r\n\r\nclass {\"test\":}\r\n{noformat}\r\nAnd nothing is installed.\r\n{noformat}\r\n/opt/puppetlabs/puppet/bin/puppet apply ./test.pp --test\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nInfo: Loading facts\r\nNotice: Compiled catalog for host.test in environment production in 0.08 seconds\r\nInfo: Applying configuration version '1485878170'\r\nNotice: Applied catalog in 0.86 seconds\r\n\r\n{noformat}\r\n\r\nMeanwhile:\r\n{noformat}\r\n# /opt/puppetlabs/puppet/bin/puppet resource package java\r\npackage { 'java':\r\n  ensure => '1:1.7.0.121-2.6.8.1.69.amzn1',\r\n}\r\n\r\n# /opt/puppetlabs/puppet/bin/puppet resource package java-1.8.0-openjdk\r\npackage { 'java-1.8.0-openjdk':\r\n  ensure => '1:1.8.0.111-1.b15.25.amzn1',\r\n}\r\n\r\n # yum check-updates\r\nLoaded plugins: priorities, s3, update-motd, upgrade-helper\r\namzn-main/latest                                                                                                                                                                      | 2.1 kB     00:00     \r\namzn-updates/latest                                                                                                                                                                   | 2.3 kB     00:00     \r\n13 packages excluded due to repository priority protections\r\n\r\njava-1.8.0-openjdk.x86_64                                                                        1:1.8.0.121-0.b13.29.amzn1                                                               amzn-updates       \r\njava-1.8.0-openjdk-headless.x86_64                                                               1:1.8.0.121-0.b13.29.amzn1                                                               amzn-updates       \r\npuppet-bootstrap-test.noarch                                                                       1.0-29                                                                                   bootstrap-artifacts\r\nSecurity: kernel-4.4.41-36.55.amzn1.x86_64 is an installed security update\r\nSecurity: kernel-4.4.35-33.55.amzn1.x86_64 is the currently running version\r\n\r\n{noformat}\r\n\r\nTraced problem to:\r\nhttps://github.com/puppetlabs/puppet/blame/master/lib/puppet/provider/package/yum.rb#L109\r\n\r\n\r\nHere is a my  copy/paste of code for IRB:\r\n\r\ndataset for testing:\r\n{noformat}\r\na='''Loaded plugins: priorities, s3, update-motd, upgrade-helper\r\namzn-main/latest                                                                                                                                                                      | 2.1 kB     00:00     \r\namzn-main/latest/group                                                                                                                                                                |  35 kB     00:00     \r\namzn-main/latest/primary_db                                                                                                                                                           | 3.5 MB     00:00     \r\namzn-updates/latest                                                                                                                                                                   | 2.3 kB     00:00     \r\namzn-updates/latest/group                                                                                                                                                             |  35 kB     00:00     \r\namzn-updates/latest/updateinfo                                                                                                                                                        | 362 kB     00:00     \r\namzn-updates/latest/primary_db                                                                                                                                                        | 498 kB     00:00     \r\n13 packages excluded due to repository priority protections\r\n\r\njava-1.8.0-openjdk.x86_64                                                                        1:1.8.0.121-0.b13.29.amzn1                                                               amzn-updates       \r\njava-1.8.0-openjdk-headless.x86_64                                                               1:1.8.0.121-0.b13.29.amzn1                                                               amzn-updates       \r\npuppet-bootstrap-mq.noarch                                                                       1.0-29                                                                                   bootstrap-artifacts\r\nSecurity: kernel-4.4.41-36.55.amzn1.x86_64 is an installed security update\r\nSecurity: kernel-4.4.35-33.55.amzn1.x86_64 is the currently running version\r\n\r\n'''\r\n{noformat}\r\n\r\nparse_update method as func\r\n{noformat}\r\ndef parse_updates(str)\r\n    # Strip off all content before the first blank line\r\n    body = str.partition(/^\\s*\\n/m).last\r\n\r\n    updates = Hash.new { |h, k| h[k] = [] }\r\n    body.split.each_slice(3) do |tuple|\r\n      break if tuple[0] =~ /^(Obsoleting|Security:|Update)/\r\n      hash = update_to_hash(*tuple[0..1])\r\n      # Create entries for both the package name without a version and a\r\n      # version since yum considers those as mostly interchangeable.\r\n      short_name = hash[:name]\r\n      long_name  = \"#{hash[:name]}.#{hash[:arch]}\"\r\n\r\n      updates[short_name] << hash\r\n      updates[long_name] << hash\r\n    end\r\n\r\n    puts updates\r\nend\r\n{noformat}\r\n\r\n\r\nAdded some output for update_to_hash\r\n{noformat}\r\ndef update_to_hash(pkgname, pkgversion)\r\n    puts :pkgname\r\n    puts pkgname, pkgversion\r\n    name, arch = pkgname.split('.')\r\npkgname\r\n    match = pkgversion.match(/^(?:(\\d+):)?(\\S+)-(\\S+)$/)\r\n    epoch = match[1] || '0'\r\n    version = match[2]\r\n    release = match[3]\r\n    puts name, epoch,  version, release,arch    \r\n\r\n    {\r\n      :name => name,\r\n      :epoch => epoch,\r\n      :version => version,\r\n      :release => release,\r\n      :arch    => arch,\r\n    }\r\n  end\r\n{noformat}\r\n\r\nResult:\r\n{noformat}\r\nirb(main):367:0> parse_updates(a)\r\npkgname\r\njava-1.8.0-openjdk.x86_64\r\n1:1.8.0.121-0.b13.29.amzn1\r\njava-1\r\n1\r\n1.8.0.121\r\n0.b13.29.amzn1\r\n8\r\npkgname\r\njava-1.8.0-openjdk-headless.x86_64\r\n1:1.8.0.121-0.b13.29.amzn1\r\njava-1\r\n1\r\n1.8.0.121\r\n0.b13.29.amzn1\r\n8\r\npkgname\r\npuppet-bootstrap-mq.noarch\r\n1.0-29\r\npuppet-bootstrap-mq\r\n0\r\n1.0\r\n29\r\nnoarch\r\n{\"java-1\"=>[{:name=>\"java-1\", :epoch=>\"1\", :version=>\"1.8.0.121\", :release=>\"0.b13.29.amzn1\", :arch=>\"8\"}, {:name=>\"java-1\", :epoch=>\"1\", :version=>\"1.8.0.121\", :release=>\"0.b13.29.amzn1\", :arch=>\"8\"}], \"java-1.8\"=>[{:name=>\"java-1\", :epoch=>\"1\", :version=>\"1.8.0.121\", :release=>\"0.b13.29.amzn1\", :arch=>\"8\"}, {:name=>\"java-1\", :epoch=>\"1\", :version=>\"1.8.0.121\", :release=>\"0.b13.29.amzn1\", :arch=>\"8\"}], \"puppet-bootstrap-mq\"=>[{:name=>\"puppet-bootstrap-mq\", :epoch=>\"0\", :version=>\"1.0\", :release=>\"29\", :arch=>\"noarch\"}], \"puppet-bootstrap-mq.noarch\"=>[{:name=>\"puppet-bootstrap-mq\", :epoch=>\"0\", :version=>\"1.0\", :release=>\"29\", :arch=>\"noarch\"}]}\r\n\r\n{noformat}\r\n\r\nAs you can see \"java-1.8.0-openjdk.x86_64\" became an \"java-1\" in https://github.com/puppetlabs/puppet/blame/master/lib/puppet/provider/package/yum.rb#L109\r\n\r\nA bit more \r\n{noformat}\r\nirb(main):372:0> pkgname=\"java-1.8.0-openjdk.x86_64\"\r\n=> \"java-1.8.0-openjdk.x86_64\"\r\nirb(main):373:0> name, arch = pkgname.split('.')\r\n=> [\"java-1\", \"8\", \"0-openjdk\", \"x86_64\"]\r\n\r\nirb(main):375:0> name\r\n=> \"java-1\"\r\nirb(main):376:0> arch\r\n=> \"8\"\r\n\r\n{noformat}","closed_at":"2019-04-04T22:22:04.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7145","labels":"","state":"Closed","updated_at":"2019-04-04T22:22:04.000-0700","timestamp":1652285881.350284,"priority":"Normal","status_category":"Done","pull_request":5873},{"issue_id":"66684","title":"Puppet resource doesn't properly escape single quotes.","url":"https://tickets.puppetlabs.com/browse/PUP-3953","created_at":"2015-02-03T15:24:00.000-0800","number":"PUP-3953","body":"How to reproduce:\r\n\r\nklynton@plmbp:~ → puppet -V\r\n3.6.2\r\n\r\nI have also tested on Puppet 3.7.2.\r\n\r\nklynton@plmbp:~ → cat file.pp \r\nfile { \"/Users/klynton/o'brien\":\r\n  ensure => file,\r\n}\r\nklynton@plmbp:~ → puppet apply file.pp \r\n\r\nOR\r\n\r\nklynton@plmbp:~ → touch o\\'brien\r\n\r\nNotice: Compiled catalog for plmbp.corp.puppetlabs.net in environment production in 0.41 seconds\r\nNotice: Finished catalog run in 0.05 seconds\r\nklynton@plmbp:~ → puppet resource file \"/Users/klynton/o'brien\"\r\nfile { '/Users/klynton/o'brien':\r\n  ensure  => 'file',\r\n  content => '{md5}d41d8cd98f00b204e9800998ecf8427e',\r\n  ctime   => '2015-02-03 14:41:25 -0800',\r\n  group   => '20',\r\n  mode    => '644',\r\n  mtime   => '2015-02-03 14:41:25 -0800',\r\n  owner   => '503',\r\n  type    => 'file',\r\n}\r\nklynton@plmbp:~ → ","closed_at":"2019-04-04T22:22:06.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3953","labels":"","state":"Closed","updated_at":"2019-04-04T22:22:06.000-0700","timestamp":1652285882.219208,"priority":"Normal","status_category":"Done","pull_request":4324},{"issue_id":"60525","title":"Can't Install Puppet Gem on Windows64 Bit Ruby 1.9.3 and 2.0","url":"https://tickets.puppetlabs.com/browse/PUP-3737","created_at":"2014-12-04T01:40:52.000-0800","number":"PUP-3737","body":"Get the following dependency errors on windows\r\n\r\nD:\\Wng.IAC\\Modules\\wn-facts>gem install puppet\r\nERROR:  While executing gem ... (Gem::DependencyError)\r\n    Unable to resolve dependencies: puppet requires ffi (= 1.9.3); win32-service requires ffi (>= 0); win32-process requires ffi (>= 1.0.0); win32-eventlog requires ffi (>= 0); facter requires ffi (~> 1.9.5); win32-security requires ffi (>= 0); win32-dir requires ffi (>= 1.0.0)\r\n\r\nD:\\Wng.IAC\\Modules\\wn-facts>gem install puppet -v 3.7.2\r\nERROR:  While executing gem ... (Gem::DependencyError)\r\n    Unable to resolve dependencies: puppet requires ffi (= 1.9.3); win32-service requires ffi (>= 0); win32-process requires ffi (>= 1.0.0); win32-eventlog requires ffi (>= 0); facter requires ffi (~> 1.9.5); win32-security requires ffi (>= 0); win32-dir requires ffi (>= 1.0.0)","closed_at":"2019-04-04T22:22:06.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3737","labels":"windows","state":"Closed","updated_at":"2019-04-04T22:22:06.000-0700","timestamp":1652285882.439549,"priority":"Normal","status_category":"Done","pull_request":3378},{"issue_id":"56603","title":"pkg provider latest gives empty warnings","url":"https://tickets.puppetlabs.com/browse/PUP-3564","created_at":"2014-10-29T05:23:54.000-0700","number":"PUP-3564","body":"{noformat}\r\n% pfexec puppet apply --verbose -e 'package {\"puppet\": ensure => latest }' \r\nInfo: Loading facts\r\nNotice: Compiled catalog for kekkonen.niksula.hut.fi in environment production in 0.74 seconds\r\nInfo: Applying configuration version '1414585322'\r\nWarning: pkg warning: []\r\nNotice: Finished catalog run in 2.26 seconds\r\n{noformat}\r\n","closed_at":"2019-04-04T22:22:07.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3564","labels":"","state":"Closed","updated_at":"2019-04-04T22:22:07.000-0700","timestamp":1652285882.769579,"priority":"Normal","status_category":"Done","pull_request":3254},{"issue_id":"99705","title":"puppet device fails during SSH session closure","url":"https://tickets.puppetlabs.com/browse/PUP-5291","created_at":"2015-09-29T04:30:37.000-0700","number":"PUP-5291","body":"There is a widely reported problem with SSH sessions failing. Looking into this, closing the session causes the IO handles to error out\r\n\r\n* https://ask.puppetlabs.com/question/1389/puppet-device-fails-halfway-through-fact-discovery-on-cisco-catalyst-2960/\r\n* http://gadgetsytecnologia.com/56775b756283c83d7/could-not-retrieve-local-facts-closed-stream.html\r\n\r\n{code}\r\n$ puppet device switch01.example.com --verbose\r\nInfo: starting applying configuration to switch01.example.com at ssh://switch01.example.com/\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nError: Could not retrieve local facts: closed stream\r\nError: Failed to apply catalog: Could not retrieve local facts: closed stream\r\n{code}\r\n\r\nPoking around in the author's own code, he's trapping IOError when closing things. This makes perfect sense, as the SSH transport has open IO handles when it closes the session.","closed_at":"2019-04-04T22:22:08.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5291","labels":"puppethack","state":"Closed","updated_at":"2019-04-04T22:22:08.000-0700","timestamp":1652285883.405062,"priority":"Normal","status_category":"Done","pull_request":4304},{"issue_id":"66361","title":"Update OpenBSD service provider to support new syntax of rcctl","url":"https://tickets.puppetlabs.com/browse/PUP-3939","created_at":"2015-02-02T10:14:43.000-0800","number":"PUP-3939","body":"The rcctl service command recently changed its interface. For example, the \"enable\" argument has been replaced with \"set,\", the \"status\" argument has been replaced with \"get\", etc. So update the OpenBSD service provider to reflect these changes.","closed_at":"2019-04-04T22:22:09.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3939","labels":"","state":"Closed","updated_at":"2019-04-04T22:22:09.000-0700","timestamp":1652285883.953365,"priority":"Normal","status_category":"Done","pull_request":3663},{"issue_id":"35617","title":"ssh_authorized_key does not handle options with escaped double quotes","url":"https://tickets.puppetlabs.com/browse/PUP-2579","created_at":"2014-05-15T02:14:47.000-0700","number":"PUP-2579","body":"With the following declaration:\r\n{code}\r\nssh_authorized_key { 'title':\r\n    user    => 'root',\r\n    ensure  => 'present',\r\n    name    => 'mykey',\r\n    options => [ 'command=\"/usr/local/bin/mybin \\\"$SSH_ORIGINAL_COMMAND\\\"\"' ],\r\n    type    => 'ssh-rsa',\r\n    key     => 'xxx',\r\n}\r\n{code}\r\n\r\nIt creates the following entry:\r\n{code}command=\"/usr/local/bin/mybin \\\"$SSH_ORIGINAL_COMMAND\\\"\" ssh-rsa xxx mykey{code}\r\n\r\nIt's OK.\r\n\r\nBut at each run, puppet agent logs:\r\n{code}Notice: /Stage[main]/Module/Ssh_authorized_key[title]/options: options changed 'command=\"/usr/local/bin/mybin \\\"' to 'command=\"/usr/local/bin/mybin \\\"$SSH_ORIGINAL_COMMAND\\\"\"'{code}\r\n\r\n\r\nThe attached patch solves that issue. It fixes the regexp by checking that there is no backslash before the closing double quote.","closed_at":"2019-04-04T22:22:11.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2579","labels":"ssh_authorized_key","state":"Closed","updated_at":"2019-04-04T22:22:11.000-0700","timestamp":1652285884.476964,"priority":"Normal","status_category":"Done","pull_request":2734},{"issue_id":"286297","title":"Unable to enfource SELinux attributes for files in /dev/shm","url":"https://tickets.puppetlabs.com/browse/PUP-9330","created_at":"2018-11-26T09:38:28.000-0800","number":"PUP-9330","body":"Hi!\r\n\r\n \r\n\r\nCurrently on Puppet 5.5.1, I've created the following resource:\r\n\r\n{code}\r\n    file { '/dev/shm/ns-slapd-database-cache/':\r\n      ensure => 'directory',\r\n      owner  => 'dirsrv',\r\n      group  => 'dirsrv',\r\n      mode   => '0770',\r\n      seltype => dirsrv_var_lib_t'\r\n    }\r\n{code}\r\n\r\nHowever, Puppet never configures the {{seltype}} for this directory, in the Puppet Agent debug logs we see:\r\n{code}\r\nDebug: /Stage[main]/Pt_freeipa::Server::Config::Limits/File[/dev/shm/ns-slapd-database-cache/]/seltype: SELinux not available for this filesystem. Ignoring parameter.\r\n{code}\r\n\r\nI've tracked this down to the following:\r\n* https://github.com/puppetlabs/puppet/blob/5.5.1/lib/puppet/type/file/selcontext.rb#L26-L82 - this is all of the logic used to determine if selinux things should be enforced, comparing the state, and setting things\r\n* Within that we have https://github.com/puppetlabs/puppet/blob/5.5.1/lib/puppet/type/file/selcontext.rb#L58-L60 which checks to see if the filesystem type supports selinux\r\n* that is here: https://github.com/puppetlabs/puppet/blob/5.5.1/lib/puppet/util/selinux.rb#L186-L195 - notice that tmpfs is not in that list\r\n* https://github.com/puppetlabs/puppet/blob/5.5.1/lib/puppet/util/selinux.rb#L234-L253 is how it determines the filesystem type for a given directory, basically, take directory, grab all of the mounts from /proc/mounts walk up the directory hierarchy until we find a matching mount, grab that type.\r\n\r\nI'm going to open a pull request to propose adding {{tmpfs}} to https://github.com/puppetlabs/puppet/blob/5.5.1/lib/puppet/util/selinux.rb#L193 and as per the contributor guidelines, also opening this issue to track this change as well. ","closed_at":"2019-04-04T22:22:13.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9330","labels":"SELinux;resolved-issue-added","state":"Closed","updated_at":"2019-04-04T22:22:13.000-0700","timestamp":1652285895.798091,"priority":"Normal","status_category":"Done","pull_request":7279},{"issue_id":"49947","title":"Puppet 2.7.x still signs CSR with MD5","url":"https://tickets.puppetlabs.com/browse/PUP-3176","created_at":"2014-09-03T02:47:53.000-0700","number":"PUP-3176","body":"By default, Puppet 2.7 signs all CSR's with MD5. \r\n\r\nThis causes issues with newer puppetmasters who have a version of SSL that will not sign such a CSR (such as on RHEL 7 or Fedora 20)\r\n\r\n    # puppet cert sign <redacted hostname>\r\n    Error: unknown message digest algorithm","closed_at":"2019-04-04T22:22:14.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3176","labels":"","state":"Closed","updated_at":"2019-04-04T22:22:14.000-0700","timestamp":1652285896.117389,"priority":"Normal","status_category":"Done","pull_request":3046},{"issue_id":"74216","title":"Portage package provider does not list all installed packages","url":"https://tickets.puppetlabs.com/browse/PUP-4362","created_at":"2015-04-01T01:30:14.000-0700","number":"PUP-4362","body":"Running {{puppet resource package}} on Gentoo/Portage, currently only lists packages that were installed by puppet, but not those installed by hand.\r\n\r\nThis was introduced in https://github.com/puppetlabs/puppet/commit/9e7bf07580d79e5b68d28cc594162959cf2a8d7d.\r\nOld line 79 contains a '\\n'.\r\nBut, new line 123 does not.\r\n\r\nSo now, the result of eix is only a one liner, no matter how many packages are installed. Since further on, the provider reads eix output line by line, no \"by hand\"-installed package will be found.\r\n\r\nI already opened a PR for this issue.\r\nhttps://github.com/puppetlabs/puppet/pull/3765\r\n\r\nrisk: low\r\nprobability: low (gentoo)\r\nseverity: high","closed_at":"2019-04-04T22:22:15.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4362","labels":"","state":"Closed","updated_at":"2019-04-04T22:22:15.000-0700","timestamp":1652285896.434431,"priority":"Normal","status_category":"Done","pull_request":3765},{"issue_id":"23310","title":"PR (2238): puppet CA generates CRL that does not conform to RFC5280","url":"https://tickets.puppetlabs.com/browse/PUP-1407","created_at":"2014-01-09T03:36:15.000-0800","number":"PUP-1407","body":"according to http://tools.ietf.org/html/rfc5280#section-5.2.1 a conforming CA MUST provide the authorityKeyIdentifier extension in the CRL to identify the issuer of the CRL.\r\nI have a patch that adds that functionality and will submit a pull request.","closed_at":"2019-04-04T22:22:15.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1407","labels":"","state":"Closed","updated_at":"2019-04-04T22:22:15.000-0700","timestamp":1652285896.539934,"priority":"Normal","status_category":"Done","pull_request":2238},{"issue_id":"28796","title":"purge_ssh_keys causes stack trace when creating new users on redhat","url":"https://tickets.puppetlabs.com/browse/PUP-1955","created_at":"2014-03-14T15:18:31.000-0700","number":"PUP-1955","body":"The user is successfully created, but a stack trace is generated. This issue was not reproducible in Ubuntu 12.04.\r\n\r\n{code}\r\n[root@pe-rhel6 ~]# puppet resource user testuser ensure=present managehome=true password='$6$salt$IxDD3jeSOb5eB1CX5LBsqZFVkJdido3OUILO5Ifz5iwMuTS4XMS130MTSuDDl3aCI6WouIL9AjRbLCelDCy.g.' --trace\r\nError: /User[testuser]: Failed to generate additional resources using 'eval_generate': undefined method `empty?' for nil:NilClass\r\n/usr/lib/ruby/site_ruby/1.8/puppet/type/user.rb:573:in `eval_generate'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/transaction/additional_resource_generator.rb:38:in `eval_generate'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/transaction.rb:72:in `evaluate'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/graph/relationship_graph.rb:116:in `call'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/graph/relationship_graph.rb:116:in `traverse'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/transaction.rb:108:in `evaluate'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/resource/catalog.rb:164:in `apply'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util/log.rb:153:in `with_destination'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/transaction/report.rb:112:in `as_logging_destination'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/resource/catalog.rb:163:in `apply'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/indirector/resource/ral.rb:41:in `save'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/indirector/indirection.rb:283:in `save'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application/resource.rb:219:in `find_or_save_resources'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application/resource.rb:143:in `main'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application.rb:381:in `run_command'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application.rb:372:in `run'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application.rb:479:in `plugin_hook'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application.rb:372:in `run'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util.rb:479:in `exit_on_fail'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application.rb:372:in `run'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/context.rb:51:in `override'\r\n/usr/lib/ruby/site_ruby/1.8/puppet.rb:224:in `override'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/application.rb:362:in `run'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util/command_line.rb:137:in `run'\r\n/usr/lib/ruby/site_ruby/1.8/puppet/util/command_line.rb:91:in `execute'\r\n/usr/bin/puppet:4\r\nNotice: /User[testuser]/ensure: created\r\nuser { 'testuser':\r\n  ensure   => 'present',\r\n  password => '$6$salt$IxDD3jeSOb5eB1CX5LBsqZFVkJdido3OUILO5Ifz5iwMuTS4XMS130MTSuDDl3aCI6WouIL9AjRbLCelDCy.g.',\r\n}\r\n{code}","closed_at":"2019-04-04T22:22:19.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1955","labels":"","state":"Closed","updated_at":"2019-04-04T22:22:19.000-0700","timestamp":1652285897.809313,"priority":"Normal","status_category":"Done","pull_request":2449},{"issue_id":"31229","title":"PR (2494) Insecure shipped Cipher settings in Passenger example config ","url":"https://tickets.puppetlabs.com/browse/PUP-2177","created_at":"2014-04-08T08:37:55.000-0700","number":"PUP-2177","body":"https://github.com/puppetlabs/puppet/pull/2494","closed_at":"2019-04-04T22:22:21.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2177","labels":"github","state":"Closed","updated_at":"2019-04-04T22:22:21.000-0700","timestamp":1652285898.880157,"priority":"Major","status_category":"Done","pull_request":2840},{"issue_id":"57690","title":"Include pkgng provider for FreeBSD","url":"https://tickets.puppetlabs.com/browse/PUP-3618","created_at":"2014-11-04T16:36:46.000-0800","number":"PUP-3618","body":"Rather than require a module to implement this functionality, Puppet should ship with the new provider and update existing ones to deprecate functionality where no longer required.\r\n\r\nrisk: low","closed_at":"2019-04-04T22:22:22.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3618","labels":"","state":"Closed","updated_at":"2019-04-04T22:22:22.000-0700","timestamp":1652285899.208193,"priority":"Minor","status_category":"Done","pull_request":3276},{"issue_id":"64921","title":"Default license for module metadata does not match an identifier provided by SPDX","url":"https://tickets.puppetlabs.com/browse/PUP-3894","created_at":"2015-01-22T01:38:12.000-0800","number":"PUP-3894","body":"When using the puppet module tool to generate a module the default license string is not a valid identifier provided by [SPDX|http://spdx.org/licenses/].\r\n\r\nThe current default value is 'Apache 2.0'. This should be 'Apache-2.0'.\r\n\r\nThe current puppetlabs documentation already has the correct value\r\nhttps://docs.puppetlabs.com/puppet/latest/reference/modules_publishing.html#write-a-metadatajson-file\r\n\r\nCurrently anyone using default value for license when creating a module will fail metadata linting and be marked down by forge's scoring.","closed_at":"2019-04-04T22:22:23.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3894","labels":"","state":"Closed","updated_at":"2019-04-04T22:22:23.000-0700","timestamp":1652285899.694381,"priority":"Normal","status_category":"Done","pull_request":3519},{"issue_id":"33051","title":"Shellquote function includes words of 0 length","url":"https://tickets.puppetlabs.com/browse/PUP-2361","created_at":"2014-04-24T10:30:35.000-0700","number":"PUP-2361","body":"Given the following code in a puppet manifest:\r\n\r\n$foo = '--foo'\r\n$bar = ''\"\r\n$baz =\"--baz\"\r\n\r\n$command = shellquote('asdf',$foo,$bar,$baz)\r\n\r\nIt produces this value for $command:\r\n\r\nasdf --foo \\\"\\\" --baz\r\n\r\nWhereas I think it should produce:\r\n\r\nasdf --foo --baz\r\n","closed_at":"2019-04-04T22:22:23.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2361","labels":"","state":"Closed","updated_at":"2019-04-04T22:22:23.000-0700","timestamp":1652285899.909152,"priority":"Normal","status_category":"Done","pull_request":2576},{"issue_id":"57867","title":"Running with --test should run with at least info level","url":"https://tickets.puppetlabs.com/browse/PUP-3624","created_at":"2014-11-05T15:23:00.000-0800","number":"PUP-3624","body":"The change for PUP-2998 means if you have log_level=debug in your puppet.conf, then puppet agent --test will reduce the log level to info, because --test implies --verbose.\r\n\r\nPer [puppet-dev discussion|https://groups.google.com/d/topic/puppet-dev/oa8zGx8mAgg/discussion] the consensus is that \\--test/\\--verbose should use *at least* info level.","closed_at":"2019-04-04T22:22:24.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3624","labels":"","state":"Closed","updated_at":"2019-04-04T22:22:24.000-0700","timestamp":1652285900.0181,"priority":"Normal","status_category":"Done","pull_request":3367},{"issue_id":"24740","title":"After upgrade from 3.3.2-1 to 3.4.2-1 naginator fails to create config from exported resources taken from hiera","url":"https://tickets.puppetlabs.com/browse/PUP-1527","created_at":"2014-01-28T04:29:19.000-0800","number":"PUP-1527","body":"gtAfter upgrade from 3.3.2-1 to 3.4.2-1 naginator fails to create config from exported resources, data taken from hiera.\r\n\r\nWhen hiera has the following data:\r\n         \"check_apt_security\" : {\r\n             \"check_command\" : \"check_nrpe_1arg!check_apt_security\",\r\n             \"contact_groups\" : \"sladmins\",\r\n             \"normal_check_interval\" : 10,\r\n             \"retry_check_interval\"  : 30,\r\n             \"max_check_attempts\"    : 3, \r\n             \"notification_interval\" : 1440,\r\n             \"notifications_enabled\" : 1\r\n         }\r\n\r\nError: /Stage[main]/Nagios::Base/Nagios_service[xxxx]: Could not evaluate: private method `sub' called for 1:Fixnum\r\nWhich clearly indicates that variable is not a string.\r\n\r\nWhen I quote integers in the hiera json file everything works fine, not sure if this is hiera or puppet naginator problem.","closed_at":"2019-04-04T22:22:24.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1527","labels":"core;hiera;naginator","state":"Closed","updated_at":"2019-04-04T22:22:24.000-0700","timestamp":1652285900.129127,"priority":"Normal","status_category":"Done","pull_request":2933},{"issue_id":"50896","title":"User group membership duplication when group list created from multiple sources","url":"https://tickets.puppetlabs.com/browse/PUP-3232","created_at":"2014-09-10T18:52:52.000-0700","number":"PUP-3232","body":"n a Puppet node that has multiple group directories (e.g. /etc/group and LDAP) puppet may end up with groups listed multiple times in a user's group list. This leads to a state of constant change where puppet detects the muliple entries and tries to remove them (when nothing is wrong).\r\n\r\nThis change ensures that a user's group list only contains unique entries and no duplicates.\r\n\r\n(We have local groups as a fail-over when LDAP is unavailable as we use groups for sudo authentication)\r\n\r\nSolution provided with PR on GitHub: https://github.com/puppetlabs/puppet/pull/3027","closed_at":"2019-04-04T22:22:25.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3232","labels":"ldap;needs_decision;puppet;type_and_provider;user","state":"Closed","updated_at":"2019-04-04T22:22:25.000-0700","timestamp":1652285900.45031,"priority":"Normal","status_category":"Done","pull_request":3027},{"issue_id":"35540","title":"OS X group resource triggers spurious notice of a change","url":"https://tickets.puppetlabs.com/browse/PUP-2575","created_at":"2014-05-14T13:32:44.000-0700","number":"PUP-2575","body":"If I create a simple group resource on OS X:\r\n{code:puppet}\r\ngroup { \"admin\": members => [\"root\", \"clay\", \"localadmin\"] }\r\n{code}\r\n\r\nand apply it multiple times, each time it triggers a \"notice\" that the membership has changed, even though the group provider did not make any changes.\r\n\r\n{noformat}\r\n# puppet -d\r\ngroup { \"admin\": members => [\"root\", \"clay\", \"localadmin\"] }\r\ninfo: Loading facts in antivirus\r\ninfo: Loading facts in cached_ldap_data\r\ninfo: Loading facts in certname\r\ninfo: Loading facts in corp_in_searchpath\r\ninfo: Loading facts in debconf\r\ninfo: Loading facts in en0_macaddress\r\ninfo: Loading facts in encryption\r\ninfo: Loading facts in environment\r\ninfo: Loading facts in fstab_uuid\r\ninfo: Loading facts in goobuntu_sshconfig_version\r\ninfo: Loading facts in google_distro\r\ninfo: Loading facts in hardware\r\ninfo: Loading facts in in_china\r\ninfo: Loading facts in installing\r\ninfo: Loading facts in lobby\r\ninfo: Loading facts in locale\r\ninfo: Loading facts in macadmin_hash_path\r\ninfo: Loading facts in machine_customizations\r\ninfo: Loading facts in machine_in_ldap\r\ninfo: Loading facts in machine_type\r\ninfo: Loading facts in macos_info\r\ninfo: Loading facts in oel_info\r\ninfo: Loading facts in ops_owner\r\ninfo: Loading facts in primary_user\r\ninfo: Loading facts in region\r\ninfo: Loading facts in remote_access\r\ninfo: Loading facts in servicedb\r\ninfo: Loading facts in sh_node\r\ninfo: Loading facts in solaris_info\r\ninfo: Loading facts in ssh_disabled\r\ninfo: Loading facts in zone\r\ndebug: Puppet::Type::Group::ProviderPw: file /usr/sbin/pw does not exist\r\ndebug: Puppet::Type::Group::ProviderGroupadd: file groupdel does not exist\r\ndebug: Puppet::Type::Group::ProviderLdap: true value when expecting false\r\ndebug: Creating default schedules\r\ndebug: Failed to load library 'shadow' for feature 'libshadow'\r\ndebug: Puppet::Type::User::ProviderUseradd: file userdel does not exist\r\ndebug: Puppet::Type::User::ProviderPw: file pw does not exist\r\ndebug: Puppet::Type::User::ProviderUser_role_add: file roledel does not exist\r\ndebug: Puppet::Type::User::ProviderLdap: true value when expecting false\r\ndebug: Puppet::Type::User::ProviderDirectoryservice: Executing '/usr/bin/dscl -plist . -list /Users'\r\ndebug: Puppet::Type::User::ProviderDirectoryservice: Executing '/usr/bin/dscl -plist . -read /Users/root'\r\ndebug: Failed to load library 'selinux' for feature 'selinux'\r\ndebug: Puppet::Type::File::ProviderMicrosoft_windows: feature microsoft_windows is missing\r\ndebug: /File[/etc/puppet/ssl]: Autorequiring File[/etc/puppet]\r\ndebug: /File[/var/puppet/state/classes.txt]: Autorequiring File[/var/puppet/state]\r\ndebug: /File[/var/puppet/state]: Autorequiring File[/var/puppet]\r\ndebug: /File[/etc/puppet/ssl/certs]: Autorequiring File[/etc/puppet/ssl]\r\ndebug: /File[/var/puppet/facts]: Autorequiring File[/var/puppet]\r\ndebug: /File[/etc/puppet/ssl/certs/ca.pem]: Autorequiring File[/etc/puppet/ssl/certs]\r\ndebug: /File[/etc/puppet/ssl/crl.pem]: Autorequiring File[/etc/puppet/ssl]\r\ndebug: /File[/etc/puppet/ssl/public_keys]: Autorequiring File[/etc/puppet/ssl]\r\ndebug: /File[/etc/puppet/ssl/public_keys/c37b1476-214e-4897-824e-2dcd24c60543.pem]: Autorequiring File[/etc/puppet/ssl/public_keys]\r\ndebug: /File[/var/puppet/client_yaml]: Autorequiring File[/var/puppet]\r\ndebug: /File[/var/puppet/lib]: Autorequiring File[/var/puppet]\r\ndebug: /File[/var/puppet/run]: Autorequiring File[/var/puppet]\r\ndebug: /File[/etc/puppet/ssl/private_keys]: Autorequiring File[/etc/puppet/ssl]\r\ndebug: /File[/etc/puppet/ssl/certificate_requests]: Autorequiring File[/etc/puppet/ssl]\r\ndebug: /File[/var/puppet/client_data]: Autorequiring File[/var/puppet]\r\ndebug: /File[/var/puppet/log]: Autorequiring File[/var/puppet]\r\ndebug: /File[/var/puppet/state/state.yaml]: Autorequiring File[/var/puppet/state]\r\ndebug: /File[/etc/puppet/ssl/private_keys/c37b1476-214e-4897-824e-2dcd24c60543.pem]: Autorequiring File[/etc/puppet/ssl/private_keys]\r\ndebug: /File[/var/puppet/state/graphs]: Autorequiring File[/var/puppet/state]\r\ndebug: /File[/etc/puppet/ssl/certs/c37b1476-214e-4897-824e-2dcd24c60543.pem]: Autorequiring File[/etc/puppet/ssl/certs]\r\ndebug: /File[/var/puppet/clientbucket]: Autorequiring File[/var/puppet]\r\ndebug: /File[/etc/puppet/ssl/private]: Autorequiring File[/etc/puppet/ssl]\r\ndebug: Finishing transaction 2164043380\r\ndebug: Loaded state in 1.40 seconds\r\ninfo: Applying configuration version '1285271264'\r\ndebug: Puppet::Type::Group::ProviderDirectoryservice: Executing '/usr/bin/dscl -plist . -list /Groups'\r\ndebug: Puppet::Type::Group::ProviderDirectoryservice: Executing '/usr/bin/dscl -plist . -read /Groups/admin'\r\nnotice: /Stage[main]//Group[admin]/members: members changed 'clay,root,localadmin' to 'root,clay,localadmin'\r\ndebug: Finishing transaction 2189862280\r\ndebug: Storing state\r\ndebug: Stored state in 6.98 seconds\r\n{noformat}\r\n\r\nI'm running puppet 2.6.1 on OS X 10.6.4 with the stock ruby (1.8.7) installed.","closed_at":"2019-04-04T22:22:26.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2575","labels":"redmine","state":"Closed","updated_at":"2019-04-04T22:22:26.000-0700","timestamp":1652285900.768683,"priority":"Normal","status_category":"Done","pull_request":4246},{"issue_id":"90336","title":"Logrotate and init scripts permission and signal issues","url":"https://tickets.puppetlabs.com/browse/PUP-4918","created_at":"2015-07-23T01:45:14.000-0700","number":"PUP-4918","body":"This patch updates logrotate script and aligns it what is defined in\r\ndefaults.rb, specifically:\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/master/lib/puppet/defaults.rb#L1036-L1046\r\n\r\nand\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/master/lib/puppet/defaults.rb#L1258-L1274\r\n\r\nBecause of logrotate and puppet during restart were both \"fighting\" for correct\r\nfile permissions, this was causing issues with SELinux. Also fixed paths which\r\nhas been incorrect for Fedora/RHEL systems (/var/log/puppetlabs vs\r\n/var/log/puppet). It contains both now which seems to work just fine.\r\n\r\nI am not adding logrotate scriplet for master tho as I don't know if it\r\nsupports signals. When running master under webrick one should not expect fully\r\nworking log rotation tho. Open for discussion.\r\n\r\nAs part of this patch, I am also updating Red Hat startup scripts:\r\n\r\nRHEL6 traditional UNIX-like \"reload\" command was actually sending HUP signal and therefore restarting daemon instead correct USR1\r\nRHEL7 systemd unit was extended with \"reload\" command using USR1 signal\r\n\r\nhttps://github.com/puppetlabs/puppet/pull/4097","closed_at":"2019-04-04T22:22:27.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4918","labels":"","state":"Closed","updated_at":"2019-04-04T22:22:27.000-0700","timestamp":1652285901.193044,"priority":"Normal","status_category":"Done","pull_request":6301},{"issue_id":"60342","title":"Cron type uses incorrect month when month name is provided","url":"https://tickets.puppetlabs.com/browse/PUP-3728","created_at":"2014-12-03T04:59:30.000-0800","number":"PUP-3728","body":"{code:puppet} cron { 'demo cron job':\r\n    command  => 'echo test',\r\n    user     => 'root',\r\n    hour     => '1',\r\n    minute   => '0',\r\n    month    => 'December',\r\n    monthday => ['3-15'],\r\n} {code}\r\n\r\nThis should create a cronjob like this:\r\n{{0 1 3-15 12 * echo test}}\r\nInstead it creates a cronjob like this:\r\n{{0 1 3-15 11 * echo test}}\r\n\r\nNote that this creates a cronjob for the 11th month, November, rather than the 12th. Cron counts months from 1-12, rather than 0-11.\r\n\r\nPuppet appears to create cronjobs with a month 1 fewer than it should.\r\n\r\nIf you give it \"January\" as a month, you get an invalid cron entry which cannot be created.","closed_at":"2019-04-04T22:22:28.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3728","labels":"","state":"Closed","updated_at":"2019-04-04T22:22:28.000-0700","timestamp":1652285901.624107,"priority":"Normal","status_category":"Done","pull_request":3380},{"issue_id":"21353","title":"Default setting for pluginsource problematic for deployments using SRV records","url":"https://tickets.puppetlabs.com/browse/PUP-1035","created_at":"2013-12-16T03:00:32.000-0800","number":"PUP-1035","body":"The current default for the `pluginsource` setting is `puppet://$server/plugins`.  This works well with a `server` set, but in deployments that utilize 3.0's SRV record feature, the `server` setting is likely not utilized at all for communication with a master, and will often be unset.\r\n\r\nIf SRV records are in use the `pluginsource` still gets filled in with the contents of the `server` setting - and if it's unset, then the default is `puppet`.  This causes failure of the pluginsync process, which is a non-fatal error for the agent run:\r\n    \r\n    Error: /File[/var/lib/puppet/lib]: Failed to generate additional resources using 'eval_generate: getaddrinfo: Name or service not known\r\n    Error: /File[/var/lib/puppet/lib]: Could not evaluate: getaddrinfo: Name or service not known Could not retrieve file metadata for puppet://puppet/plugins: getaddrinfo: Name or service not known\r\n\r\nI believe that changing the default setting for `pluginsource` from `puppet://$server/plugins` to `puppet:///plugins` is functionally equivalent for 'normal' deployments not running `use_srv_records`, while it will cause the pluginsync process to find a working master in cases where `use_srv_records` is utilized.\r\n\r\nSimply setting `pluginsource = puppet:///plugins` is an effective workaround for SRV record deployments in the interim.\r\n","closed_at":"2019-04-04T22:22:28.000-0700","comments":16,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1035","labels":"redmine","state":"Closed","updated_at":"2019-04-04T22:22:28.000-0700","timestamp":1652285901.734363,"priority":"Normal","status_category":"Done","pull_request":8147},{"issue_id":"53580","title":"Issue Creating Multiple Mirrors in Zpool Resource","url":"https://tickets.puppetlabs.com/browse/PUP-3388","created_at":"2014-10-03T13:02:29.000-0700","number":"PUP-3388","body":"Bug in the mirror property under zpool resource\r\n\r\nhttps://docs.puppetlabs.com/references/latest/type.html#zpool-attribute-mirror\r\n\r\nmirror => [\"disk1 disk2\", \"disk3 disk4\"],\r\n\r\nIn the Previous version It took that string value as a single array and tried to find a drive named \"disk1 disk2\" and also wouldn't attach the word mirror to \"disk3 disk4\"","closed_at":"2019-04-04T22:24:13.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3388","labels":"","state":"Closed","updated_at":"2019-04-04T22:24:13.000-0700","timestamp":1652285903.756846,"priority":"Normal","status_category":"Done","pull_request":3299},{"issue_id":"84363","title":"Allow resources to be purged even when they have dependency relationships","url":"https://tickets.puppetlabs.com/browse/PUP-4748","created_at":"2015-06-11T19:57:36.000-0700","number":"PUP-4748","body":"Please see PUP-1963 for the original problem report and some detailed breakdown of these two issues. The fix for PUP-1963 will be the first part (of two) of the fix for the problem report, and this ticket will be the second part.","closed_at":"2019-04-04T22:24:14.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4748","labels":"","state":"Closed","updated_at":"2019-04-04T22:24:14.000-0700","timestamp":1652285903.968381,"priority":"Normal","status_category":"Done","pull_request":4694},{"issue_id":"60034","title":"Group resource non-authoritative by default (Breaking change)","url":"https://tickets.puppetlabs.com/browse/PUP-3719","created_at":"2014-12-01T11:22:31.000-0800","number":"PUP-3719","body":"The {{auth_membership}} group parameter controls whether puppet ensures the group contains *exactly* the members specified, and no more, or contains *at least* the members specified. By default, the group parameter defaults to the former, which is opposite to the {{auth_membership}} user parameter. This makes the group parameter difficult to use in practice, because you need to know what the complete set of group members should be. For example, on Windows the local {{Administrators}} group may contain a combination of local and domain user/group accounts, and that may vary across different types of machines.\r\n\r\nWe should change the {{auth_membership}} group parameter to default to false so that it is consistent with the user parameter.","closed_at":"2019-04-04T22:24:15.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3719","labels":"docs_reviewed","state":"Closed","updated_at":"2019-04-04T22:24:15.000-0700","timestamp":1652285904.400925,"priority":"Major","status_category":"Done","pull_request":3434},{"issue_id":"58302","title":"Prefetch eats most exceptions (those derived from StandardError), there is no way to fail out.","url":"https://tickets.puppetlabs.com/browse/PUP-3656","created_at":"2014-11-11T08:38:27.000-0800","number":"PUP-3656","body":"https://github.com/puppetlabs/puppet/blob/master/lib/puppet/transaction.rb#L306-L310\r\n\r\nThis bug still exists in the master branch as of today and was introduced in 2.7.8 with this commit:\r\n\r\nhttps://github.com/puppetlabs/puppet/commit/000a2d811c740f4179a0cd4ced38e886858cf01f\r\n\r\nThe rescue condition means that any exception raised by providers during prefetch gets logged but then swallowed by Puppet. As a result of this, any provider which relies *only* on prefetch to find all instances will end up running the resource creation regardless of whether the resource exists or not.\r\n\r\nIn order to negate this behaviour, provider authors would need to create checks for instance existence which run during the creation phase as well, which defeats the point of having prefetch in the first place.\r\n\r\n---\r\nNote to docs: module authors who use the {{prefetch}} method may want to be aware of the changes in this fix. Two things to consider:\r\n# previously, the prefetch method could throw *any* exception and puppet would carry on. As discussed above this is the wrong behavior in general, however some module authors may have stumbled across this, allowed/encouraged prefetch to throw exceptions, and let puppet runs succeed. So modules should be examined for this assumption.\r\n# the only two legitimate causes for prefetch to throw an exception now are {{LoadError}} and (added in this puppet 4.0) {{Puppet::MissingCommand}}\r\n\r\nThis is a breaking change in 4.0. ","closed_at":"2019-04-04T22:24:16.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3656","labels":"breaking;docs_reviewed","state":"Closed","updated_at":"2019-04-04T22:24:16.000-0700","timestamp":1652285904.934432,"priority":"Normal","status_category":"Done","pull_request":3428},{"issue_id":"32071","title":"If a resource is triggered by a refresh, and it fails, puppet doesn't treat it as a failure","url":"https://tickets.puppetlabs.com/browse/PUP-2280","created_at":"2014-04-16T13:12:37.000-0700","number":"PUP-2280","body":"This may be a dupe of #9237.\r\n\r\nI have a module (puppetlabs/postgresql) that has some resources that are only triggered via a refresh notification.  In my case the resource is a custom ruby type, but I stole some of its 'refreshonly' implementation from the Exec type, so this may be simply a problem with the exec type rather than a more general puppet problem.  Here's an example that shows the problem using exec:\r\n\r\n{noformat}\r\n    cprice@localhost ~/work/scratch $ puppet --version\r\n    3.0.2-rc2\r\n\r\n    cprice@localhost ~/work/scratch $ cat foo.pp \r\n    notify { \"hi\": } ~>\r\n    exec { \"/bin/this_command_does_not_exist\":\r\n       refreshonly => true,\r\n    }\r\n\r\n    cprice@localhost ~/work/scratch $ puppet apply ./foo.pp\r\n    No LSB modules are available.\r\n    No LSB modules are available.\r\n    Notice: hi\r\n    Notice: /Stage[main]//Notify[hi]/message: defined 'message' as 'hi'\r\n    Error: /Stage[main]//Exec[/bin/this_command_does_not_exist]: Failed to call refresh: Could not find command '/bin/this_command_does_not_exist'                                          \r\n    Error: /Stage[main]//Exec[/bin/this_command_does_not_exist]: Could not find command '/bin/this_command_does_not_exist'                                                                  \r\n    Notice: Finished catalog run in 0.18 seconds\r\n    cprice@localhost ~/work/scratch $ echo $?\r\n    0\r\n    cprice@localhost ~/work/scratch $\r\n{noformat}\r\n\r\nThis has apparently been masking a legitimate bug in my module for several months now.","closed_at":"2019-04-04T22:24:17.000-0700","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2280","labels":"customer;exec;redmine;resolved-issue-added","state":"Closed","updated_at":"2019-04-04T22:24:17.000-0700","timestamp":1652285905.258726,"priority":"Normal","status_category":"Done","pull_request":5956},{"issue_id":"82075","title":"cannot create a define named something that starts with 'class'","url":"https://tickets.puppetlabs.com/browse/PUP-4668","created_at":"2015-05-28T16:20:24.000-0700","number":"PUP-4668","body":"{code}\r\n[master /etc/puppetlabs/puppet/modules/classroom]# cat manifests/boo.pp\r\ndefine classroom::boo {\r\n  notify { $name: }\r\n}\r\n\r\n[master /etc/puppetlabs/puppet/modules/classroom]# cat tests/wtf.pp\r\nclassroom::boo { 'what the': }\r\n\r\nnotify { 'test':\r\n  require => Classroom::Boo['what the'],\r\n}\r\n\r\n[master /etc/puppetlabs/puppet/modules/classroom]# puppet apply tests/wtf.pp\r\nNotice: Compiled catalog for master.puppetlabs.vm in environment production in 0.47 seconds\r\nError: Could not find dependency Class[What the] for Notify[test] at /etc/puppetlabs/puppet/modules/classroom/tests/wtf.pp:3\r\n{code}\r\n\r\nWORD AROUND EXISTS\r\n---\r\nThis can be worked around by giving the reference as a string instead of as a type:\r\n{code:puppet}\r\n  require \"Classroom[what the]\"\r\n{code}\r\n","closed_at":"2019-04-04T22:24:18.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4668","labels":"future-parser","state":"Closed","updated_at":"2019-04-04T22:24:18.000-0700","timestamp":1652285905.490023,"priority":"Normal","status_category":"Done","pull_request":3976},{"issue_id":"178644","title":"puppet generate types for environment isolation generates invalid code","url":"https://tickets.puppetlabs.com/browse/PUP-7306","created_at":"2017-03-06T04:48:42.000-0800","number":"PUP-7306","body":"Ticket created based on comment from [~henrik.lindberg] ([SERVER-94?focusedCommentId=385558|https://tickets.puppetlabs.com/browse/SERVER-94?focusedCommentId=385558&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-385558]) and [~eric.sorenson] ([SERVER-94?focusedCommentId=388535|https://tickets.puppetlabs.com/browse/SERVER-94?focusedCommentId=388535&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-388535])\r\n\r\nI encountered the following problem with the https://github.com/theforeman/puppet-foreman module:\r\n{code}\r\npuppet parser validate /tmp/.resource_types/foreman_smartproxy.pp\r\n\r\nError: Could not parse for environment production: Syntax error at '/' at /tmp/.resource_types/foreman_smartproxy.pp:34:37\r\n{code}\r\nI attached the generated file to this ticket.\r\nWhat I can gather is that the ruby internal URI.regexp pattern from the foreman module (https://github.com/theforeman/puppet-foreman/blob/master/lib/puppet/type/foreman_smartproxy.rb#L33) does create a pattern which the Puppetserver then refuses to accept.\r\n\r\nNow I'm not sure if\r\n(a) the puppet generate did something wrong with the URI.regexp or\r\n(b) the guys from the foreman-puppet module should change something.\r\n\r\nGithub issue link to the puppet-foreman project: https://github.com/theforeman/puppet-foreman/issues/512\r\n","closed_at":"2019-04-04T22:25:14.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7306","labels":"","state":"Closed","updated_at":"2019-04-04T22:25:14.000-0700","timestamp":1652285905.702033,"priority":"Normal","status_category":"Done","pull_request":5695},{"issue_id":"56547","title":"Add support for properly signed trusted facts","url":"https://tickets.puppetlabs.com/browse/PUP-3560","created_at":"2014-10-28T16:51:00.000-0700","number":"PUP-3560","body":"Once trusted facts are properly signed as per SERVER-119 we will need to update the Ruby Puppet code to recognize the properly encoded trusted facts, as well as the older improperly encoded trusted facts. It may also be a good idea to `update the way Ruby Puppet signs trusted facts, and the Netscape Comment extension to match the RFC-5280 spec.\r\n","closed_at":"2019-04-04T22:28:47.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3560","labels":"","state":"Closed","updated_at":"2019-04-04T22:28:47.000-0700","timestamp":1652285906.44064,"priority":"Normal","status_category":"Done","pull_request":3607},{"issue_id":"64259","title":"auth.conf no longer restricting based on environment","url":"https://tickets.puppetlabs.com/browse/PUP-3855","created_at":"2015-01-15T13:32:50.000-0800","number":"PUP-3855","body":"Our documentation (https://docs.puppetlabs.com/guides/rest_auth_conf.html#environment) states that in auth.conf you can specify an environment or a list of environments allowed for an ACL.\r\n\r\nWith the move of environment from the first path fragment to a query parameter, this seems to no longer work.\r\n\r\nTest (on stable):\r\n Change auth.conf to have the following block, replacing the default block for {{path ~ ^/node/([^/]+)$}}\r\n\r\n{code}\r\npath ~ ^/node/([^/]+)$\r\nmethod find\r\nenvironment production\r\nauth any\r\nallow *\r\n{code}\r\n\r\nStart the puppet master. Make a request against the node endpoint with environment production:\r\n{code}\r\n$ curl -k https://localhost:8140/production/node/foo\r\n{\"document_type\":\"Node\",\"data\":{\"name\":\"foo\",\"environment\":\"production\"}}\r\n{code}\r\n\r\nThe request with environment production is authorized and returns information.\r\n\r\nCreate a {{test}} directory in the environmentpath.\r\n\r\nMake a request with the {{test}} environment. It will fail because the environment is not authorized.\r\n\r\n{code}\r\n$ curl -k https://localhost:8140/test/node/foo\r\nForbidden request: localhost(127.0.0.1) access to /node/foo [find] at :125\r\n{code}\r\n\r\nTrying this on master, with the following equivalent ACL (with prefix and version added)\r\n{code}\r\npath ~ ^/puppet/v3/node/([^/]+)$\r\nmethod find\r\nenvironment production\r\nauth any\r\nallow *\r\n{code}\r\n\r\nwhich should allow a request with environment=production. However, instead I get:\r\n{code}\r\n$ curl -k https://localhost:8140/puppet/v3/node/foo?environment=production\r\nForbidden request: localhost(127.0.0.1) access to /puppet/v3/node/foo [find] at :129\r\n{code}\r\n","closed_at":"2019-04-04T22:28:49.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3855","labels":"","state":"Closed","updated_at":"2019-04-04T22:28:49.000-0700","timestamp":1652285918.889322,"priority":"Normal","status_category":"Done","pull_request":3515},{"issue_id":"51204","title":"puppet incorrectly swallows some errors","url":"https://tickets.puppetlabs.com/browse/PUP-3521","created_at":"2014-09-15T10:06:12.000-0700","number":"PUP-3521","body":"puppet has a lot of places that do {{rescue Exception}} and then swallow the exception.  In some cases, the exception is not even logged.\r\n\r\nAt least, this code should be changed to handle {{StandardError}} instead, and the errors should always be logged.\r\n\r\nThis can be particularly problematic for certain errors - say, an {{OutOfMemoryError}} when running on JRuby, which ends up operating as a subclass of ruby's {{Exception}}.  (although we've now solved this particular issue in packaging)","closed_at":"2019-04-04T22:28:53.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3521","labels":"","state":"Closed","updated_at":"2019-04-04T22:28:53.000-0700","timestamp":1652285919.667499,"priority":"Normal","status_category":"Done","pull_request":3302},{"issue_id":"82453","title":"org.jruby.exceptions.RaiseException: (SystemStackError) stack level too deep","url":"https://tickets.puppetlabs.com/browse/PUP-4775","created_at":"2015-06-01T11:46:59.000-0700","number":"PUP-4775","body":"Release Note\r\n----\r\nSerialization of {{node}} objects could produce giant serializations than when later loaded would cause 'stack level too deep' errors. This was caused\r\nby logic missing in the node implementation that should have prevented serialization of the entire runtime state of the environment.\r\n\r\nSummary\r\n----\r\nSerialization/Deseerialization of Puppet::Node objects using yaml causes the entire environment associated with the node to be serialized in full - this is everything loaded and evaluated in the environment, and it goes very deep. As noted in comments, it is possible to work around the issue of hitting a stack overflow by increasing the stack and making more memory available.\r\n\r\nThe root cause is that objects (such as Puppet::Node) which requires asymmetric serialization (it only wants a serialization of the environment's name, and looks up the environment on deserialization) must include a module:\r\n\r\n{code:ruby}\r\ninclude Puppet::Util::PsychSupport\r\n{code}\r\n\r\nto get the expected behavior of using to/from datahash methods.\r\n\r\n\r\nORIGINAL\r\n---\r\nAfter running for a while Puppet agent runs start to fail due to server errors, the exception appears to indicate an issue with yaml encoding. This error was happening with 2.0.0 and I have also tried the latest package available in the nightly repo which is exhibiting the same behaviour.\r\n\r\n{noformat}\r\n2015-05-31 15:50:41,651 ERROR [p.p.ringutils] Exception while handling HTTP request\r\norg.jruby.exceptions.RaiseException: (SystemStackError) stack level too deep\r\n\tat org.jruby.RubyArray.each(org/jruby/RubyArray.java:1613) ~[puppet-server-release.jar:na]\r\n\r\n<repeated part omitted>\r\n\r\n\tat RUBY.accept(/opt/puppetlabs/server/apps/puppetserver/puppet-server-release.jar!/META-INF/jruby.home/lib/ruby/shared/psych/visitors/yaml_tree.rb:128) ~[na:na]\r\n\tat RUBY.dump_ivars(/opt/puppetlabs/server/apps/puppetserver/puppet-server-release.jar!/META-INF/jruby.home/lib/ruby/shared/psych/visitors/yaml_tree.rb:480) ~[na:na]\r\n\tat org.jruby.RubyArray.each(org/jruby/RubyArray.java:1613) ~[puppet-server-release.jar:na]\r\n\tat RUBY.dump_ivars(/opt/puppetlabs/server/apps/puppetserver/puppet-server-release.jar!/META-INF/jruby.home/lib/ruby/shared/psych/visitors/yaml_tree.rb:478) ~[na:na]\r\n\tat RUBY.visit_Object(/opt/puppetlabs/server/apps/puppetserver/puppet-server-release.jar!/META-INF/jruby.home/lib/ruby/shared/psych/visitors/yaml_tree.rb:150) ~[na:na]\r\n\tat RUBY.accept(/opt/puppetlabs/server/apps/puppetserver/puppet-server-release.jar!/META-INF/jruby.home/lib/ruby/shared/psych/visitors/yaml_tree.rb:128) ~[na:na]\r\n\tat RUBY.visit_Array(/opt/puppetlabs/server/apps/puppetserver/puppet-server-release.jar!/META-INF/jruby.home/lib/ruby/shared/psych/visitors/yaml_tree.rb:344) ~[na:na]\r\n\tat org.jruby.RubyArray.each(org/jruby/RubyArray.java:1613) ~[puppet-server-release.jar:na]\r\n{noformat}","closed_at":"2019-04-04T22:28:55.000-0700","comments":35,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4775","labels":"","state":"Closed","updated_at":"2019-04-04T22:28:55.000-0700","timestamp":1652285920.663923,"priority":"Major","status_category":"Done","pull_request":4056},{"issue_id":"69052","title":"Puppet Server 1.0.2 Could not find file file_metadata and file_bucket md5/<hash>","url":"https://tickets.puppetlabs.com/browse/PUP-6139","created_at":"2015-02-23T12:31:31.000-0800","number":"PUP-6139","body":"Hello,\r\n\r\nI've just switched from apache/passenger to puppet server 1.0.2 in our sandbox (after switching from hiera-gpg to hiera-eyaml).\r\nDoing some test runs shows the following in the pupppetserver.log file;\r\n\r\n015-02-23 20:32:55,505 INFO  [puppet-server] Puppet Not Found: Could not find file_metadata modules/mondo/3/tb/make_mondoarchive.sh..<hostname>\r\n2015-02-23 20:42:50,916 INFO  [puppet-server] Puppet Not Found: Could not find file_metadata modules/mondo/3/tb/make_mondoarchive.sh.<hostname>\r\n2015-02-23 20:43:07,700 INFO  [puppet-server] Puppet Not Found: Could not find file_metadata modules/mondo/3/tb/make_mondoarchive.sh..<hostname>\r\n2015-02-23 20:43:13,963 INFO  [puppet-server] Puppet Not Found: Could not find file_bucket_file md5/85b75b6e41c467513f4625947c84f1cc//etc/puppet/scripts/monthly_run.sh\r\n2015-02-23 20:43:18,173 INFO  [puppet-server] Puppet Not Found: Could not find file_metadata modules/mondo/3/tb/make_mondoarchive.sh.<hostname>\r\n2015-02-23 20:43:36,080 INFO  [puppet-server] Puppet Not Found: Could not find file_metadata modules/mondo/3/tb/make_mondoarchive.sh.<hostname>\r\n2015-02-23 20:48:16,747 INFO  [puppet-server] Puppet Not Found: Could not find file_metadata modules/mondo/3/tb/make_mondoarchive.sh.<hostname>\r\n2015-02-23 20:51:34,403 INFO  [puppet-server] Puppet Not Found: Could not find file_bucket_file md5/f4f7e01332717f3f591868a3dcd909ab//etc/sudoers\r\n\r\nThe file_metadata seems to happen on all resources with a sourceselect in the manifest.\r\nmake_mondoarchive.sh is done by a sourceselect (first) in the manifest like;\r\n  file { '/tb/jobs/system/make_mondoarchive.sh':\r\n    ensure       => present,\r\n    owner        => 'root',\r\n    group        => 'root',\r\n    mode         => '0700',\r\n    source       => [ \"puppet:///modules/mondo/${mondo::params::mondo_version}/tb/make_mondoarchive.sh.${::hostname}\",\r\n                      \"puppet:///modules/mondo/${mondo::params::mondo_version}/tb/make_mondoarchive.sh.${mondo::params::mondo_nfs_version}\",\r\n                      \"puppet:///modules/mondo/${mondo::params::mondo_version}/tb/make_mondoarchive.sh\"],\r\n    sourceselect => first,\r\n    require      => Class['mondo::install'],\r\n  }\r\n\r\nThat it cannot find those files is correct, as they don't exist on the filesystem.\r\n\r\nWith the apache/passenger setup we never had these messages, so we don't expect them with puppet server, correct?\r\n\r\nElse there will be a *load* of these message when we use puppet server in out production environment.\r\n","closed_at":"2019-04-04T22:28:56.000-0700","comments":25,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6139","labels":"","state":"Closed","updated_at":"2019-04-04T22:28:56.000-0700","timestamp":1652285921.20362,"priority":"Normal","status_category":"Done","pull_request":4847},{"issue_id":"122071","title":"Serious regression with exception in reduce() & others after change from Enumerable to Iterable","url":"https://tickets.puppetlabs.com/browse/PUP-6070","created_at":"2016-03-17T17:08:52.000-0700","number":"PUP-6070","body":"The behavior is not stable. +There is no exception with `puppet apply` & Ruby+, the exception is triggered only on JRuby when invoked through Puppet Server.\r\n\r\nIt may be one of already solved JRuby bugs => bundled JRuby update may be required.\r\n\r\nThe same data with small modifications work without issues, I tried to reduce example as possible until the exception is still triggered. *In the example below try to remove \"keyname4\" entry and no exception is triggered.*\r\n\r\nThis has worked on Puppet 4.3.2 and started to fail with upgrade to 4.4.0.\r\n\r\nAs with previous Hiera issue, I can expect that some third-party module may have polluted Puppet type system, but see no evidence so far.\r\n\r\nHere's example data in Puppet code:\r\n{code}\r\n$data = [\r\n{\r\n\"certname\"=>\"xxxxxxxxx.some.domain\",\r\n\"parameters\"=>{\r\n    \"admin_auth_keys\"=>{\r\n        \"keyname1\"=>{\r\n            \"key\"=>\"ABCDEF\",\r\n            \"options\"=>[\"from=\\\"10.0.0.0/8\\\"\"]\r\n        },\r\n        \"keyname2\"=>{\r\n            \"key\"=>\"ABCDEF\",\r\n        },\r\n        \"keyname3\"=>{\r\n            \"key\"=>\"ABCDEF\",\r\n            \"options\"=>[\"from=\\\"10.0.0.0/8\\\"\"],\r\n            \"type\"=>\"ssh-xxx\"\r\n        },\r\n        \"keyname4\"=>{\r\n            \"key\"=>\"ABCDEF\",\r\n            \"options\"=>[\"from=\\\"10.0.0.0/8\\\"\"]\r\n        }\r\n    },\r\n    \"admin_user\"=>\"ertxa\",\r\n    \"admin_hosts\"=>[\"1.2.3.4\",\r\n        \"1.2.3.4\",\r\n        \"1.2.3.4\"],\r\n    \"admin_password\"=>\"ABCDEF\",\r\n    \"sshd_ports\"=>[22,\r\n        22, 24],\r\n    \"sudo_no_password_all\"=>false,\r\n    \"sudo_no_password_commands\"=>[],\r\n    \"sshd_config_template\"=>\"cfauth/sshd_config.epp\",\r\n    \"sudo_env_keep\"=>[]\r\n},\r\n\"exported\"=>false},\r\n]\r\n\r\n$data_reduced = $data.reduce({}) |$m, $r|{\r\n    $cn = $r['certname']\r\n    merge($m, { $cn => $r['parameters'] })\r\n}\r\nfail($data_reduced)\r\n{code}\r\n\r\nException thrown:\r\n{noformat}\r\nError while evaluating a Method call, bignum too big to convert into `long'\r\n{noformat}\r\n\r\nTip of backtrace on exception:\r\n{noformat}\r\norg/jruby/RubyArray.java:689:in `hash'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/types/types.rb:1230:in `hash'\r\norg/jruby/RubyArray.java:3241:in `uniq'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/types/types.rb:1796:in `initialize'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/types/iterable.rb:57:in `on'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/types/iterable.rb:23:in `asserted_iterable'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/../../../puppet/functions/reduce.rb:118:in `reduce_with_memo'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatch.rb:45:in `invoke'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:35:in `dispatch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:44:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:272:in `call_function'\r\n...\r\n{noformat}\r\n\r\nString dump of \"types\" argument to PVariantType::initialize()\r\n\r\n{noformat}\r\n[#<Puppet::Pops::Types::PStructType:0x413f087e @elements=[#<Puppet::Pops::Types::PStructElement:0x362c9f1b @key_type=#<Puppet::Pops::Types::PStringType:0x2b81c166 @values=[\"certname\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PStringType:0x6bf5362a @values=[\"xxxxxxxxx.some.domain\"], @size_type=#<Puppet::Pops::Types::PIntegerType:0x256cd7fc @to=21, @from=21>>>, #<Puppet::Pops::Types::PStructElement:0xcd7f496 @key_type=#<Puppet::Pops::Types::PStringType:0x35faaa70 @values=[\"exported\"], @size_type=nil>, @value_type=Boolean>, #<Puppet::Pops::Types::PStructElement:0x1c5180ae @key_type=#<Puppet::Pops::Types::PStringType:0x2ad72e08 @values=[\"parameters\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PStructType:0x1552bec4 @elements=[#<Puppet::Pops::Types::PStructElement:0xcc40685 @key_type=#<Puppet::Pops::Types::PStringType:0x19880c4f @values=[\"admin_auth_keys\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PStructType:0x1943391f @elements=[#<Puppet::Pops::Types::PStructElement:0x36767b58 @key_type=#<Puppet::Pops::Types::PStringType:0x1c9bea57 @values=[\"keyname1\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PStructType:0x1a5cb10a @elements=[#<Puppet::Pops::Types::PStructElement:0x7332a3a6 @key_type=#<Puppet::Pops::Types::PStringType:0x1962260 @values=[\"key\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PStringType:0x3e958868 @values=[\"ABCDEF\"], @size_type=#<Puppet::Pops::Types::PIntegerType:0x5ad869c6 @to=6, @from=6>>>, #<Puppet::Pops::Types::PStructElement:0x360874c2 @key_type=#<Puppet::Pops::Types::PStringType:0x65298844 @values=[\"options\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PTupleType:0x5b1f3111 @size_type=nil, @types=[#<Puppet::Pops::Types::PStringType:0x79ad733e @values=[\"from=\\\"10.0.0.0/8\\\"\"], @size_type=#<Puppet::Pops::Types::PIntegerType:0x1e3addca @to=17, @from=17>>]>>]>>, #<Puppet::Pops::Types::PStructElement:0x2ab70847 @key_type=#<Puppet::Pops::Types::PStringType:0x56808339 @values=[\"keyname2\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PStructType:0x59bd49c0 @elements=[#<Puppet::Pops::Types::PStructElement:0x1035c8c2 @key_type=#<Puppet::Pops::Types::PStringType:0x3b0f40de @values=[\"key\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PStringType:0x2f671dcc @values=[\"ABCDEF\"], @size_type=#<Puppet::Pops::Types::PIntegerType:0x2b977eff @to=6, @from=6>>>]>>, #<Puppet::Pops::Types::PStructElement:0x6712adb4 @key_type=#<Puppet::Pops::Types::PStringType:0x7b4a3949 @values=[\"keyname3\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PStructType:0x651817bf @elements=[#<Puppet::Pops::Types::PStructElement:0x7805d69b @key_type=#<Puppet::Pops::Types::PStringType:0x474c97ac @values=[\"key\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PStringType:0xca0a8c4 @values=[\"ABCDEF\"], @size_type=#<Puppet::Pops::Types::PIntegerType:0x1efc8007 @to=6, @from=6>>>, #<Puppet::Pops::Types::PStructElement:0x53395b75 @key_type=#<Puppet::Pops::Types::PStringType:0x5aa38902 @values=[\"options\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PTupleType:0x14969328 @size_type=nil, @types=[#<Puppet::Pops::Types::PStringType:0x53ce046 @values=[\"from=\\\"10.0.0.0/8\\\"\"], @size_type=#<Puppet::Pops::Types::PIntegerType:0x14535e1f @to=17, @from=17>>]>>, #<Puppet::Pops::Types::PStructElement:0x6d484fa5 @key_type=#<Puppet::Pops::Types::PStringType:0x266511b0 @values=[\"type\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PStringType:0x59546b8d @values=[\"ssh-xxx\"], @size_type=#<Puppet::Pops::Types::PIntegerType:0x7c754174 @to=7, @from=7>>>]>>, #<Puppet::Pops::Types::PStructElement:0x761c6681 @key_type=#<Puppet::Pops::Types::PStringType:0x428ddbbb @values=[\"keyname4\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PStructType:0x32675853 @elements=[#<Puppet::Pops::Types::PStructElement:0x69503b2a @key_type=#<Puppet::Pops::Types::PStringType:0x125c786a @values=[\"key\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PStringType:0x75ba9e5 @values=[\"ABCDEF\"], @size_type=#<Puppet::Pops::Types::PIntegerType:0x82e9875 @to=6, @from=6>>>, #<Puppet::Pops::Types::PStructElement:0x2b1b2d85 @key_type=#<Puppet::Pops::Types::PStringType:0x5498cdf @values=[\"options\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PTupleType:0x57442ef1 @size_type=nil, @types=[#<Puppet::Pops::Types::PStringType:0x72c35eec @values=[\"from=\\\"10.0.0.0/8\\\"\"], @size_type=#<Puppet::Pops::Types::PIntegerType:0x75ce5384 @to=17, @from=17>>]>>]>>]>>, #<Puppet::Pops::Types::PStructElement:0x3ccd3b88 @key_type=#<Puppet::Pops::Types::PStringType:0x45ff7ce7 @values=[\"admin_hosts\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PTupleType:0x2a200274 @size_type=nil, @types=[#<Puppet::Pops::Types::PStringType:0x3b33186c @values=[\"1.2.3.4\"], @size_type=#<Puppet::Pops::Types::PIntegerType:0xb3ed69 @to=7, @from=7>>, #<Puppet::Pops::Types::PStringType:0x24a788db @values=[\"1.2.3.4\"], @size_type=#<Puppet::Pops::Types::PIntegerType:0x129dbe40 @to=7, @from=7>>, #<Puppet::Pops::Types::PStringType:0x3235654c @values=[\"1.2.3.4\"], @size_type=#<Puppet::Pops::Types::PIntegerType:0x515a4999 @to=7, @from=7>>]>>, #<Puppet::Pops::Types::PStructElement:0x7e960588 @key_type=#<Puppet::Pops::Types::PStringType:0x2b4564a5 @values=[\"admin_password\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PStringType:0x6cc039da @values=[\"ABCDEF\"], @size_type=#<Puppet::Pops::Types::PIntegerType:0x789be4e9 @to=6, @from=6>>>, #<Puppet::Pops::Types::PStructElement:0x42d1badb @key_type=#<Puppet::Pops::Types::PStringType:0x5742a222 @values=[\"admin_user\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PStringType:0x725cb5db @values=[\"ertxa\"], @size_type=#<Puppet::Pops::Types::PIntegerType:0x6e97cf8f @to=5, @from=5>>>, #<Puppet::Pops::Types::PStructElement:0x30bbee02 @key_type=#<Puppet::Pops::Types::PStringType:0x206de4d @values=[\"sshd_config_template\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PStringType:0x1b76f8b1 @values=[\"cfauth/sshd_config.epp\"], @size_type=#<Puppet::Pops::Types::PIntegerType:0x46eb0f44 @to=22, @from=22>>>, #<Puppet::Pops::Types::PStructElement:0x72375dbb @key_type=#<Puppet::Pops::Types::PStringType:0x10eada92 @values=[\"sshd_ports\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PTupleType:0x7ae28333 @size_type=nil, @types=[#<Puppet::Pops::Types::PIntegerType:0x6dc30cb2 @to=22, @from=22>, #<Puppet::Pops::Types::PIntegerType:0x2076b26a @to=22, @from=22>, #<Puppet::Pops::Types::PIntegerType:0x50bb5dcc @to=24, @from=24>]>>, #<Puppet::Pops::Types::PStructElement:0x3d0b257c @key_type=#<Puppet::Pops::Types::PStringType:0x26ca0f33 @values=[\"sudo_env_keep\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PArrayType:0x2784d73d @element_type=Unit, @size_type=#<Puppet::Pops::Types::PIntegerType:0x24efa10 @to=0, @from=0>>>, #<Puppet::Pops::Types::PStructElement:0x35660a97 @key_type=#<Puppet::Pops::Types::PStringType:0x3e415ae4 @values=[\"sudo_no_password_all\"], @size_type=nil>, @value_type=Boolean>, #<Puppet::Pops::Types::PStructElement:0x2ce695ef @key_type=#<Puppet::Pops::Types::PStringType:0x567d94f0 @values=[\"sudo_no_password_commands\"], @size_type=nil>, @value_type=#<Puppet::Pops::Types::PArrayType:0x2784d73d @element_type=Unit, @size_type=#<Puppet::Pops::Types::PIntegerType:0x24efa10 @to=0, @from=0>>>]>>]>]\r\n{noformat}\r\n\r\n","closed_at":"2019-04-04T22:29:00.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6070","labels":"burnside-ss","state":"Closed","updated_at":"2019-04-04T22:29:00.000-0700","timestamp":1652285922.662499,"priority":"Major","status_category":"Done","pull_request":4798},{"issue_id":"31300","title":"The CRL can get corrupted if two workers revoke certs at same time","url":"https://tickets.puppetlabs.com/browse/PUP-2189","created_at":"2014-04-09T07:33:49.000-0700","number":"PUP-2189","body":"The CRL file (and many other SSL related files) are missing locking, so concurrent access can lead to corruptions.\r\n\r\n*In Scope*\r\n* -Confirm that PE in the Cloud etc will be leveraging puppet cert command line tools (as opposed to modifying CRL directly or revoking certs via server http api)- confirmed\r\n* Investigate filesystem-based locking of CRL file in ruby puppet on update\r\n* Limited to updates to CRL via the puppet cert CLI\r\n\r\n*Out of Scope*\r\n* Changes to puppet server CRL handling / API  - PUP-7991","closed_at":"2019-04-04T22:29:03.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2189","labels":"AWS1","state":"Closed","updated_at":"2019-04-04T22:29:03.000-0700","timestamp":1652285923.312972,"priority":"Major","status_category":"Done","pull_request":2522},{"issue_id":"133119","title":"Hiera Data in Module give bad results when environment_timeout is unlimited","url":"https://tickets.puppetlabs.com/browse/PUP-6339","created_at":"2016-05-21T18:28:30.000-0700","number":"PUP-6339","body":"1) Set environment_timeout to unlimited  (this does not occur if set to 0)\r\n2) Setup hiera data in a module that use a FACT to determine what it should do.\r\n3) Set the fact differently on two or more clients\r\n4) Run puppet from each of the clients at the same time\r\n\r\nAfter a few puppet runs they will stop getting the correct hiera data in module values from the PuppetServer.\r\n\r\neg.  server1 could see the server2 value   or server2 could see the server1 value.\r\n\r\nSAMPLE module:\r\n{code:java}\r\n./test_module\r\n./test_module/hieradata\r\n./test_module/hieradata/common.yaml\r\n./test_module/hieradata/server1.yaml\r\n./test_module/hieradata/server2.yaml\r\n./test_module/manifests\r\n./test_module/manifests/init.pp\r\n./test_module/metadata.json\r\n./test_module/hiera.yaml\r\n{code}\r\n\r\n*init.pp*\r\n{code:java}\r\nclass test_module (\r\n  $my_var = 'not from hiera',\r\n){\r\n  notify{\"The variable is $my_var\":}\r\n}\r\n{code}\r\n\r\nhiera.yaml\r\n\r\n{code:java}\r\n---\r\nversion: 4\r\ndatadir: hieradata\r\nhierarchy:\r\n  - name: \"%{my_fact}\"\r\n    backend: yaml\r\n\r\n  - name: \"common\"\r\n    backend: yaml\r\n{code}\r\n\r\n./test_module/hieradata/common.yaml\r\n{code:java}\r\n---\r\ntest_module::my_var: 'In common.yaml'\r\n{code}\r\n\r\n./test_module/hieradata/server1.yaml\r\n{code:java}\r\n---\r\ntest_module::my_var: 'server1'\r\n{code}\r\n\r\n\r\n./test_module/hieradata/server2.yaml\r\n{code:java}\r\n---\r\ntest_module::my_var: 'server2'\r\n{code}\r\n\r\nSERVER1\r\n/etc/puppetlabs/facter/facts.d/my_fact.txt \r\nmy_fact=server1\r\n\r\nSERVER2\r\n/etc/puppetlabs/facter/facts.d/my_fact.txt \r\nmy_fact=server2\r\n\r\nError seen in Puppetserver logs\r\n{code:java}\r\n[puppetserver] Puppet Caching node for server1.mydomain\r\n[puppetserver] Puppet Class 'settings' is already defined; cannot redefine at :\r\n[puppetserver] Puppet Compiled catalog for server1.mydomain in environment production in 0.04 seconds\r\n{code}\r\n\r\n","closed_at":"2019-04-04T22:29:04.000-0700","comments":29,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6339","labels":"","state":"Closed","updated_at":"2019-04-04T22:29:04.000-0700","timestamp":1652285923.749033,"priority":"Major","status_category":"Done","pull_request":4984},{"issue_id":"152415","title":"referencing non-existant variable in custom function crashes puppetserver","url":"https://tickets.puppetlabs.com/browse/PUP-6807","created_at":"2016-09-19T04:57:12.000-0700","number":"PUP-6807","body":"h2. Overview\r\nUsing a function that references an undefined variable (ie by typo) in a function crashes puppetserver with an out of memory error\r\n\r\nh2. Expected result\r\nPuppet should warn the user if an undefined variable is encountered.  Ideally in the output of {{puppet agent -t}} \r\n\r\nh2. Actual result\r\nPuppet runs take a long time and then fail with one of the following messages:\r\n{noformat}\r\nError: Could not retrieve catalog from remote server: end of file reached\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\nError: Could not send report: Connection refused - connect(2) for \"puppet.demo.internal\" port 8140\r\n{noformat}\r\n\r\n_or_\r\n\r\n{noformat}\r\nError: Could not retrieve catalog from remote server: Error 500 on SERVER: <html>\r\n<head>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html;charset=ISO-8859-1\"/>\r\n<title>Error 500 </title>\r\n</head>\r\n<body>\r\n<h2>HTTP ERROR: 500</h2>\r\n<p>Problem accessing /puppet/v3/catalog/pe-puppet.localdomain. Reason:\r\n<pre>    Java heap space</pre></p>\r\n<hr /><i><small>Powered by Jetty://</small></i>\r\n</body>\r\n</html>\r\n\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\n{noformat}\r\n\r\n_Also, please see attached puppetserver.log_\r\n\r\nh2. Steps to reproduce\r\nh3.  Testcase module\r\n+/etc/puppetlabs/code/environments/production/modules/testcase/lib/puppet/functions/testfunc.rb+\r\n{noformat}\r\nPuppet::Functions.create_function(:testfunc) do\r\n  def testfunc\r\n    nothere\r\n  end\r\nend\r\n{noformat}\r\n\r\nh3. Reference the function\r\n+/etc/puppetlabs/code/environments/production/manifests/site.pp+\r\n{noformat}\r\n$uhoh=testfunc()\r\n{noformat}\r\n\r\nh3.  Run puppet\r\n{noformat}\r\npuppet agent -t\r\n{noformat}\r\n\r\nh2. Workaround\r\nMake sure you don't reference any undeclared variables(!)\r\n","closed_at":"2019-04-04T22:29:06.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6807","labels":"maintenance","state":"Closed","updated_at":"2019-04-04T22:29:06.000-0700","timestamp":1652285924.292285,"priority":"Normal","status_category":"Done","pull_request":5324},{"issue_id":"126042","title":"Don't include IP address in returned error messages","url":"https://tickets.puppetlabs.com/browse/PUP-6150","created_at":"2016-04-11T11:56:13.000-0700","number":"PUP-6150","body":"This is set in https://github.com/puppetlabs/puppet/blob/master/lib/puppet/network/rights.rb#L56-L58\r\n\r\nReturning the requestor IP address could include the internal IP address for a proxy server.\r\n\r\nThis information can be logged server-side but should not be returned to clients.\r\n","closed_at":"2019-04-04T22:29:09.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6150","labels":"","state":"Closed","updated_at":"2019-04-04T22:29:09.000-0700","timestamp":1652285925.279398,"priority":"Normal","status_category":"Done","pull_request":5010},{"issue_id":"116706","title":"Empty hiera data in modules causes whole lookup to fail","url":"https://tickets.puppetlabs.com/browse/PUP-5899","created_at":"2016-02-14T16:04:09.000-0800","number":"PUP-5899","body":"Situation:\r\n1. Module has \"data_provider: 'hiera'\" in metadata.json\r\n2. Module has simple hiera.yaml version 4 pointing to 'data/common.yaml'\r\n2. Module's data/common.yaml is empty with only three dashes:\r\n{code:yaml}\r\n---\r\n\r\n{code}\r\n4. \"puppet lookup\" or \"puppet agent -t\" leads to error below.\r\n5. The error is easily fixed by changing common.yaml content to:\r\n{code:yaml}\r\n---\r\n{}\r\n{code}\r\n\r\n{code}\r\nrror: Could not retrieve catalog from remote server: Error 400 on SERVER: Evaluation Error: Error while evaluating a Function Call, undefined method `[]' for nil:NilClass at /etc/puppetlabs/code/environments/production/modules/cffirehol/manifests/init.pp:12:5 on node ...\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/rest.rb:207:in `is_http_200?'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/rest.rb:105:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:194:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:299:in `block in retrieve_new_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:292:in `block in thinmark'\r\n/opt/puppetlabs/puppet/lib/ruby/2.1.0/benchmark.rb:294:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:291:in `thinmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:298:in `retrieve_new_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:59:in `retrieve_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:104:in `prepare_and_retrieve_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:206:in `run_internal'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:134:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:240:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:133:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:45:in `block (4 levels) in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent/locker.rb:21:in `lock'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:45:in `block (3 levels) in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:98:in `with_client'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:42:in `block (2 levels) in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:65:in `run_in_fork'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:41:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:179:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:179:in `controlled_run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:39:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:353:in `onetime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:331:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:446:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:128:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\n{code}","closed_at":"2019-04-04T22:29:12.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5899","labels":"","state":"Closed","updated_at":"2019-04-04T22:29:12.000-0700","timestamp":1652285926.777869,"priority":"Normal","status_category":"Done","pull_request":4672},{"issue_id":"93418","title":"RedHat puppetmaster service status report is invalid when it's stopped and client is running","url":"https://tickets.puppetlabs.com/browse/PUP-5037","created_at":"2015-08-14T04:10:46.000-0700","number":"PUP-5037","body":"I initially ran into this issue on Amazon Linux.\r\n\r\nWhen {{puppetmaster}} service is stopped and {{puppet}} service is running, {{service puppetserver status}} returns false info, \"puppet dead but subsys locked\" to be exact.\r\n\r\n{code}\r\n[vagrant@localhost ~]$ cat /etc/issue\r\nCentOS release 6.5 (Final)\r\nKernel \\r on an \\m\r\n\r\n[vagrant@localhost ~]$ sudo service puppetmaster status\r\npuppet is stopped\r\n[vagrant@localhost ~]$ sudo service puppet status\r\npuppet is stopped\r\n[vagrant@localhost ~]$ sudo service puppet start\r\nStarting puppet agent:                                     [  OK  ]\r\n[vagrant@localhost ~]$ sudo service puppetmaster status\r\npuppet dead but subsys locked\r\n{code}\r\n\r\nWhat I expected was \"puppet is stopped\".","closed_at":"2019-04-04T22:29:13.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5037","labels":"","state":"Closed","updated_at":"2019-04-04T22:29:13.000-0700","timestamp":1652285927.207688,"priority":"Minor","status_category":"Done","pull_request":4157},{"issue_id":"265513","title":"Puppetserver fails to compile catalog when disable_i18n = true","url":"https://tickets.puppetlabs.com/browse/PUP-9010","created_at":"2018-07-19T00:14:44.000-0700","number":"PUP-9010","body":"*Puppet Version: 5.5.3*\r\n*Puppet Server Version: 5.3.3, 5.3.4*\r\n*OS Name/Version: Ubuntu 16.04.4 LTS (Xenial Xerus)*\r\n\r\nIt seems that there is a regression in https://github.com/puppetlabs/puppet/commit/52ddd9cc1943b796b58665589dd38ecce1541ae1, as with *disable_i18n = true* in main section in *puppet.conf*, catalog fails to compile with following error:\r\n- on agent side:\r\n{noformat}\r\nError: Could not retrieve catalog from remote server: Find /puppet/v3/catalog/<fqdn>?environment=production&facts_format=application%2Fjson&... resulted in 404 with the message: {\"message\":\"Not Found: Could not find catalog <fqdn>\",\"issue_kind\":\"RESOURCE_NOT_FOUND\"}\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\n{noformat}\r\n\r\n- on server side:\r\n{noformat}\r\n2018-07-19 06:31:07,746 INFO  [qtp2083050975-76] [puppetserver] Puppet Not Found: Could not find catalog <fqdn>\r\n{noformat}\r\n\r\n\r\n*Desired Behavior:*\r\nCatalog should compile and be served to agent.\r\n","closed_at":"2019-04-04T22:29:15.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9010","labels":"docs_reviewed","state":"Closed","updated_at":"2019-04-04T22:29:15.000-0700","timestamp":1652285927.641362,"priority":"Major","status_category":"Done","pull_request":6932},{"issue_id":"35666","title":"Interpolated variables with leading underscore regression","url":"https://tickets.puppetlabs.com/browse/PUP-2581","created_at":"2014-05-15T12:08:48.000-0700","number":"PUP-2581","body":"\r\n{code}\r\nroot@puppetmaster:~# cat test.pp \r\n$_foo = \"1\"\r\nnotify { \"${_foo}\": }\r\n\r\n# With current parser\r\n\r\nroot@puppetmaster:~# puppet apply --parser=current test.pp \r\nWarning: Setting templatedir is deprecated. See http://links.puppetlabs.com/env-settings-deprecations\r\n   (at /usr/lib/ruby/vendor_ruby/puppet/settings.rb:1071:in `each')\r\nNotice: Compiled catalog for puppetmaster.local in environment production in 0.04 seconds\r\nNotice: 1\r\nNotice: /Stage[main]/Main/Notify[1]/message: defined 'message' as '1'\r\nNotice: Finished catalog run in 0.04 seconds\r\n\r\n# With future parser\r\n\r\nroot@puppetmaster:~# puppet apply --parser=future test.pp \r\nWarning: Setting templatedir is deprecated. See http://links.puppetlabs.com/env-settings-deprecations\r\n   (at /usr/lib/ruby/vendor_ruby/puppet/settings.rb:1071:in `each')\r\nError: Could not parse for environment production: Syntax error at '_' at /root/test.pp:5:13 on node puppetmaster.local\r\nError: Could not parse for environment production: Syntax error at '_' at /root/test.pp:5:13 on node puppetmaster.local\r\n{code}\r\n","closed_at":"2019-04-04T22:29:55.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2581","labels":"","state":"Closed","updated_at":"2019-04-04T22:29:55.000-0700","timestamp":1652285928.412509,"priority":"Normal","status_category":"Done","pull_request":2661},{"issue_id":"31542","title":"The environmentpath setting is ignored by puppet faces unless set in [main]","url":"https://tickets.puppetlabs.com/browse/PUP-2213","created_at":"2014-04-10T17:48:56.000-0700","number":"PUP-2213","body":"[~nick.fagerlund] noticed:\r\n\r\n1) with environmentpath set in [main], \r\n\r\n{code}\r\npuppet config print manifest modulepath --environment doesnotexist\r\nmanifest = no_manifest\r\nmodulepath =\r\n{code}\r\n\r\nis picking up the default configured environment I believe.\r\n\r\n2) with environmentpath set in [master]\r\n\r\n{code}\r\npuppet config print manifest modulepath --environment doesnotexist\r\nmanifest = /etc/puppet/manifests/site.pp\r\nmodulepath = /etc/puppet/modules:/usr/share/puppet/modules\r\n{code}\r\n\r\nenvironmentpath seems to be ignored and you get the default settings.\r\n","closed_at":"2019-04-04T22:29:56.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2213","labels":"","state":"Closed","updated_at":"2019-04-04T22:29:56.000-0700","timestamp":1652285928.741266,"priority":"Critical","status_category":"Done","pull_request":2554},{"issue_id":"51126","title":"ENC returned environment ignored when using directory environments","url":"https://tickets.puppetlabs.com/browse/PUP-3244","created_at":"2014-09-15T08:04:39.000-0700","number":"PUP-3244","body":"Where a puppet agent is configured to use the default environment (production) and one relies on an ENC to assign the environment correctly (puppet 3.x where the ENC should win), when using directory environments to match an environment that doesn't exist, the default configured environment wins and the node is given a catalog from 'production' rather than failing (which is the behaviour I think I am expecting).\r\n\r\n","closed_at":"2019-04-04T22:29:57.000-0700","comments":19,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3244","labels":"","state":"Closed","updated_at":"2019-04-04T22:29:57.000-0700","timestamp":1652285929.284321,"priority":"Normal","status_category":"Done","pull_request":3187},{"issue_id":"32141","title":"Lambda with default valued parameter cannot be overridden","url":"https://tickets.puppetlabs.com/browse/PUP-2287","created_at":"2014-04-16T19:12:10.000-0700","number":"PUP-2287","body":"If a default value is given for a lambdas parameter it will not be overridden by a given value.\n\nThe logic in evaluator_impl L 209-217\n{code}\n      given_argument = m[1]\n      argument_name = m[0].name\n      default_expression = m[0].value\n\n      value = if default_expression\n        evaluate(default_expression, scope)\n      else\n        given_argument\n      end\n{code}\n\nis where it goes wrong.\n\nIt should check if a value was given, and if that value is nil or undef, or no value given before using the default expression. m.size == 2 indicates that value was given.\n\nThe impact of this is minimal since all current functions that use lambdas would typically not use default values. Once lambdas spread beyond the current handful of function this will naturally bite people badly.\n\nSuggest fixing this for 3.6.","closed_at":"2019-04-04T22:30:00.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2287","labels":"docs_reviewed","state":"Closed","updated_at":"2019-04-04T22:30:00.000-0700","timestamp":1652285944.545741,"priority":"Normal","status_category":"Done","pull_request":2588},{"issue_id":"10949","title":"(6112) Puppet cert generate clashes with autosigning","url":"https://tickets.puppetlabs.com/browse/PUP-11","created_at":"2013-06-17T17:19:14.000-0700","number":"PUP-11","body":"When using `puppet cert generate`, Puppet first [generates a certificate request](https://github.com/puppetlabs/puppet/blob/3.1.1/lib/puppet/ssl/certificate_authority.rb#L139) and then [signs it](https://github.com/puppetlabs/puppet/blob/3.1.1/lib/puppet/ssl/certificate_authority.rb#L140). During the generation step, the save method of the CertificateRequest class is called which [triggers autosigning](https://github.com/puppetlabs/puppet/blob/3.1.1/lib/puppet/ssl/certificate_request.rb#L12-L19).\n\nTo summarize:\n\n  * Certificate generation should take auto signing into account.\n\n  * It appears autosigning doesn't consult the dns_alt_names parameter.\n\n  * We should probably log an info or debug message whenever a cert is autosigned so this behavior is easier to detect in the future.\n\n_NOTE: the code `host = Puppet::SSL::Host.new(name)` also appears twice in the generate method of ssl/certificate\\_authority.rb. Hopefully this is an accidental duplicate._\n\n[6112]: https://projects.puppetlabs.com/issues/6112","closed_at":"2019-04-04T22:30:00.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11","labels":"redmine","state":"Resolved","updated_at":"2019-04-04T22:30:00.000-0700","timestamp":1652285944.652531,"priority":"Major","status_category":"Done","pull_request":8905},{"issue_id":"28832","title":"realizing an empty array of resources fails in future evaluator","url":"https://tickets.puppetlabs.com/browse/PUP-1960","created_at":"2014-03-17T07:03:51.000-0700","number":"PUP-1960","body":"The following code runs fine without deprecation warning in old evaluator but fails in 3.5-rc1:\r\n\r\n{code}\r\nrealize(File[[]])\r\n{code}\r\n\r\n{noformat}\r\nError: Evaluation Error: File[] accepts 1 argument. Got 0 on node test.dalen.cloud.spotify.net\r\nError: Evaluation Error: File[] accepts 1 argument. Got 0 on node test.dalen.cloud.spotify.net\r\n{noformat}","closed_at":"2019-04-04T22:30:01.000-0700","comments":17,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1960","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:01.000-0700","timestamp":1652285944.8688,"priority":"Normal","status_category":"Done","pull_request":2505},{"issue_id":"52965","title":"consider not doing deep undef to empty string map in 3x function API","url":"https://tickets.puppetlabs.com/browse/PUP-3365","created_at":"2014-09-29T16:43:08.000-0700","number":"PUP-3365","body":"With the future parser in 3.7, all arguments to 3x functions are deeply mapped to translate undef to empty strings. This is different than how the 3x runtime does this, where only the surface undefs are mapped (not if they are in arrays or hashes).\r\n\r\nThis causes problems in existing functions such as {{ensure_resource}}.\r\n\r\nWhile we should move functions to the new function API (for other reasons), we cannot do this for all functions out in the wild. We should therefore consider not doing deep mapping of undef to empty string to preserve the semantics of the 3x function API (even if it is sad).","closed_at":"2019-04-04T22:30:03.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3365","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:03.000-0700","timestamp":1652285945.404806,"priority":"Normal","status_category":"Done","pull_request":3142},{"issue_id":"11377","title":"(PR puppet/1710) (#21252) Fix problems with false/nil args and returns in lambda","url":"https://tickets.puppetlabs.com/browse/PUP-93","created_at":"2013-06-24T23:29:40.000-0700","number":"PUP-93","body":"\n * Author: **Henrik Lindberg** <>\n * Company: Cloudsmith Inc.\n * Github ID: [hlindberg](https://github.com/hlindberg)\n * [Pull Request 1710 Discussion](https://github.com/puppetlabs/puppet/pull/1710)\n * [File Diff](https://github.com/puppetlabs/puppet/pull/1710/files)\n\nPull Request\n====\nThe issue 21252 was triggered by a documentation error but should\nhave produced a different result than the error that was presented.\n\nThis was caused by a series of problems. It was not possible to\npass `false` as a parameter value as this was taken as missing parameter\nvalue.\n\nAlso, it was not possible to return the value `false` as this was\ntranslated to `nil` due to defective work around for missing initialized\nvariable on return.\n\nThe fix changes the handling of making sure that the variable that is\nreturned exists (by setting value explicelty to `nil` before the start\nof the exception handling block.\n\nThis commit also modifies how a lambda call matches arguments to\nparameters and checks what is missing (now with `false` as a valid value\nin mind).\n\nA test is added to `collect` that checks that a value of `false` can\nboth be passed and returned.","closed_at":"2019-04-04T22:30:04.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-93","labels":"future-parser","state":"Closed","updated_at":"2019-04-04T22:30:04.000-0700","timestamp":1652285945.511548,"priority":"Major","status_category":"Done","pull_request":8634},{"issue_id":"48489","title":"heredoc should trim left margin before joining lines","url":"https://tickets.puppetlabs.com/browse/PUP-3091","created_at":"2014-08-19T15:52:10.000-0700","number":"PUP-3091","body":"This:\r\n{code}\r\nnotice  @(END/L)     \r\n      I am a very long line of text that is difficult to work\\\r\n      with. The escaped end of line joins the long line into one.\r\n     | - END\r\n{code}\r\nshould produce output without 6 spaces between the words {{work}} and\r\n{{with}}.","closed_at":"2019-04-04T22:30:05.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3091","labels":"future","state":"Closed","updated_at":"2019-04-04T22:30:05.000-0700","timestamp":1652285945.833441,"priority":"Normal","status_category":"Done","pull_request":3327},{"issue_id":"52963","title":"future parser give weird error in trailing comma after assignment","url":"https://tickets.puppetlabs.com/browse/PUP-3363","created_at":"2014-09-29T16:29:31.000-0700","number":"PUP-3363","body":"If an assignment is made with a trailing comma, and there is an expression following the comma, the result is surprisingly a literal array followed by an expression. This in turn leads to an error of \"This Array Expression\" is not productive.\r\n\r\n{code}\r\n$a = \"hello\",\r\nnotice $a\r\n{code}\r\n\r\nMarked as major as this means that there are conditions where the problem will not be caught (when the array constructed in error is last in a block).","closed_at":"2019-04-04T22:30:05.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3363","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:05.000-0700","timestamp":1652285945.9411,"priority":"Major","status_category":"Done","pull_request":3154},{"issue_id":"47693","title":"Class inheritance behaving incorrectly in the future parser","url":"https://tickets.puppetlabs.com/browse/PUP-3054","created_at":"2014-08-13T11:42:51.000-0700","number":"PUP-3054","body":"[~dalen] commented on PUP-121 with a problem that he uncovered. It looks like class inheritance is encountering problems in the future parser.\r\n\r\n{quote}\r\nWhen I'm testing master atm with future parser:\r\n{noformat}\r\nclass bar { notice(\"This is class $name\") }\r\nclass foo::bar { notice(\"This is class $name\") }\r\nclass foo inherits bar { notice(\"This is class $name\") }\r\n\r\ninclude foo\r\n\r\n$ puppet apply --parser=future test.pp\r\nNotice: Scope(Class[Foo::Bar]): This is class foo::bar\r\nNotice: Scope(Class[Foo]): This is class foo\r\nError: Could not find class foo on node valentina.local\r\nError: Could not find class foo on node valentina.local\r\n{noformat}\r\nSo, you get both two of the three classes and then it complains it couldn't find a third class (that it already included) \r\n{quote}","closed_at":"2019-04-04T22:30:05.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3054","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:05.000-0700","timestamp":1652285946.048057,"priority":"Blocker","status_category":"Done","pull_request":2981},{"issue_id":"17328","title":":rvalue functions require argument handling","url":"https://tickets.puppetlabs.com/browse/PUP-592","created_at":"2013-10-28T14:46:47.000-0700","number":"PUP-592","body":"What I mean by this is that the function has to handle the args parameter, even it doesn't do anything with it. This is not true for :statement functions.\r\n\r\nThis function blows up\r\n\r\n{code}\r\n# mastername.rb\r\nrequire 'socket'\r\n\r\nPuppet::Parser::Functions.newfunction(:mastername, :type => :rvalue ) do\r\n  Socket.gethostname.chomp\r\nend\r\n{code}\r\n\r\nOutput:\r\n\r\n{code}\r\n[root@classroom test]# puppet apply -e 'notice(mastername())'\r\nError: wrong number of arguments (1 for 0) at line 1 on node classroom.puppetlabs.vm\r\nWrapped exception:\r\nwrong number of arguments (1 for 0)\r\nError: wrong number of arguments (1 for 0) at line 1 on node classroom.puppetlabs.vm\r\n{code}\r\n\r\nWhile this one works:\r\n\r\n{code}\r\n# mastername.rb\r\nrequire 'socket'\r\n\r\nPuppet::Parser::Functions.newfunction(:mastername, :type => :rvalue ) do |args|\r\n  Socket.gethostname.chomp\r\nend\r\n{code}\r\n","closed_at":"2019-04-04T22:30:07.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-592","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:07.000-0700","timestamp":1652285946.583487,"priority":"Normal","status_category":"Done","pull_request":6956},{"issue_id":"14862","title":"Merge redmine 22593 - } interpolation","url":"https://tickets.puppetlabs.com/browse/PUP-352","created_at":"2013-09-18T10:01:49.000-0700","number":"PUP-352","body":"The redmine issue #22593 makes it difficult to do more advanced interpolation in data.\n(The bug is about lexer doing the wrong thing with right brace and keywords).\n\nOnly affects future parser.","closed_at":"2019-04-04T22:30:10.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-352","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:10.000-0700","timestamp":1652285947.447622,"priority":"Major","status_category":"Done","pull_request":3319},{"issue_id":"29372","title":"TupleType applies size constraint to last element only","url":"https://tickets.puppetlabs.com/browse/PUP-2017","created_at":"2014-03-21T07:37:23.000-0700","number":"PUP-2017","body":"The TupleType allows a size constraint to be made. This was implemented as constraining the last type in the tuple (with the idea that this would be the most common use-case). In practice however, it is far more valuable to let the size constraint apply to the given types as this gives the opportunity to make types in the tuple optional (i.e. not present as opposed to being undef).\r\n\r\nProposed change will make these three matches true:\r\n\r\n{code}\r\n$t = Tuple[Integer, Integer, String, 1,3]\r\n[1, 2, hello]  =~ $t\r\n[1, 2]         =~ $t\r\n[1]            =~ $t\r\n{code}\r\n\r\nThis is currently not possible to express since the size only applies to the last entry (the String in the example above).\r\n\r\nThis is important to get into 3.5.0 since it changes the semantics of the Tuple type.","closed_at":"2019-04-04T22:30:11.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2017","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:11.000-0700","timestamp":1652285948.053032,"priority":"Normal","status_category":"Done","pull_request":2459},{"issue_id":"37399","title":"Puppet master passenger processes keep growing","url":"https://tickets.puppetlabs.com/browse/PUP-2692","created_at":"2014-05-28T11:35:49.000-0700","number":"PUP-2692","body":"[~jhoblitt] reported on IRC in #puppet-dev that after upgrading from 3.6.0 to 3.6.1 his master processes started growing to 1.5GB.\r\n\r\n","closed_at":"2019-04-04T22:30:13.000-0700","comments":27,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2692","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:13.000-0700","timestamp":1652285948.600631,"priority":"Normal","status_category":"Done","pull_request":2714},{"issue_id":"35460","title":"Cannot use class references with upper cased strings","url":"https://tickets.puppetlabs.com/browse/PUP-2568","created_at":"2014-05-14T09:20:45.000-0700","number":"PUP-2568","body":"The future parser accepts {{Class[Apache::Foo]}} as a reference but will reject {{Class['Apache::Foo']}} and {{$a = 'Apache::Foo'; Class[$a]}} (a string or an expression that results in a string.\r\n\r\nAll of these variations should continue to work.","closed_at":"2019-04-04T22:30:13.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2568","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:13.000-0700","timestamp":1652285948.708969,"priority":"Normal","status_category":"Done","pull_request":2656},{"issue_id":"108193","title":"Missing API docs for /puppet/v3/environment endpoint","url":"https://tickets.puppetlabs.com/browse/PUP-5571","created_at":"2015-12-02T18:13:15.000-0800","number":"PUP-5571","body":"As part of the application management work, a new endpoint (/puppet/v3/environment) was added to the /puppet/v3 API without documentation. We need an API document (similar to existing ones) added to the puppet/api/doc directory, and a JSON schema for the endpoint's responses added to the puppet/api/schemas directory.","closed_at":"2019-04-04T22:30:14.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5571","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:14.000-0700","timestamp":1652285948.930677,"priority":"Normal","status_category":"Done","pull_request":4524},{"issue_id":"16291","title":"Validate collect expressions (future parser)","url":"https://tickets.puppetlabs.com/browse/PUP-527","created_at":"2013-10-04T17:40:21.000-0700","number":"PUP-527","body":"Future parsers 3x validator does not check its LHS operand which leads to error messages about internal types not being found as resource types.","closed_at":"2019-04-04T22:30:15.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-527","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:15.000-0700","timestamp":1652285949.367371,"priority":"Normal","status_category":"Done","pull_request":4275},{"issue_id":"33031","title":"Validation missing for meaningless sequences","url":"https://tickets.puppetlabs.com/browse/PUP-2357","created_at":"2014-04-24T07:38:13.000-0700","number":"PUP-2357","body":"There is currently no validation of the future parser's result wrt. evaluation of meaningless sequences. If user enters:\r\n{code}\r\n1 2 3 hello goodbye\r\n{code}\r\nThe evaluator will just \"do what it is told\", and produce a 1, then a 2, etc.\r\nThe only place were a \"side effect free\" expression may appear is as the last expression in a sequence / block as this is the produced value of an expression.\r\n\r\nThe importance of this validation has increased since the future parser (since 3.6) handles calls without parentheses as reserved for a handful of built in \"calls\" (i.e. 'include', 'require', etc.). Thus, if users have code where calls without parentheses are used they are not informed about this issue - i.e. their code turned into a \"side effect free sequence\" that is just silently evaluated.","closed_at":"2019-04-04T22:30:15.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2357","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:15.000-0700","timestamp":1652285949.475582,"priority":"Normal","status_category":"Done","pull_request":2583},{"issue_id":"53894","title":"Type system does not handle Pattern correctly","url":"https://tickets.puppetlabs.com/browse/PUP-3401","created_at":"2014-10-07T17:50:39.000-0700","number":"PUP-3401","body":"The Pattern type has similar problems to the Enum type + it is not implemented correctly. \r\n\r\n{code}\r\nPattern < Pattern[/.*/]   # false\r\nPattern > Pattern[/.*/]    # false\r\nPattern == Pattern[/.*/]  # false\r\n{code}\r\n\r\nThat is not correct and neither complies with the spec, nor the the \"law of least surprise\"\r\n","closed_at":"2019-04-04T22:30:17.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3401","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:17.000-0700","timestamp":1652285950.022504,"priority":"Normal","status_category":"Done","pull_request":3195},{"issue_id":"35482","title":"\"puppet cert revoke <name>\" doesn't always revoke what you expect","url":"https://tickets.puppetlabs.com/browse/PUP-2569","created_at":"2014-05-14T11:06:55.000-0700","number":"PUP-2569","body":"When revoking a certificate by name and there is not certificate by that name present (for instance if the certificates were deleted) the \"puppet cert\" command falls back to the {{inventory.txt}} file to find the serial number. When it does this it ends up only revoking the first serial number recorded in the file. This leaves the most recent certificate (and possibly others) unrevoked.\r\n\r\n{code:title=Revoking the wrong certificate}\r\n> be puppet cert clean testing\r\nNotice: Revoked certificate with serial 2\r\nNotice: Removing file Puppet::SSL::Certificate testing at '/Users/andy/.puppet/ssl/ca/signed/testing.pem'\r\nNotice: Removing file Puppet::SSL::Certificate testing at '/Users/andy/.puppet/ssl/certs/testing.pem'\r\nNotice: Removing file Puppet::SSL::Key testing at '/Users/andy/.puppet/ssl/private_keys/testing.pem'\r\n\r\n> be puppet cert generate testing\r\nNotice: testing has a waiting certificate request\r\nNotice: Signed certificate request for testing\r\nNotice: Removing file Puppet::SSL::CertificateRequest testing at '/Users/andy/.puppet/ssl/ca/requests/testing.pem'\r\nNotice: Removing file Puppet::SSL::CertificateRequest testing at '/Users/andy/.puppet/ssl/certificate_requests/testing.pem'\r\n\r\n> rm ~/.puppet/ssl/ca/signed/testing.pem\r\n> rm ~/.puppet/ssl/certs/testing.pem\r\n> rm ~/.puppet/ssl/private_keys/testing.pem\r\n\r\n> be puppet cert revoke testing\r\nNotice: Revoked certificate with serial 2\r\n{code}\r\n\r\nOn the last revoke it should have revoked serial 3 instead of serial 2.","closed_at":"2019-04-04T22:30:20.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2569","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:20.000-0700","timestamp":1652285951.011924,"priority":"Normal","status_category":"Done","pull_request":2704},{"issue_id":"27203","title":"puppet apply --modulepath not respected when /etc/puppet/environments/production exists","url":"https://tickets.puppetlabs.com/browse/PUP-1765","created_at":"2014-02-25T05:41:47.000-0800","number":"PUP-1765","body":"This appears to be a strange condition since the new directory environments work went in.  When /etc/puppet/environments/production exists, puppet apply stops obeying --modulepath and instead attempts to look up the module in /etc only.  For example:\r\n\r\n{noformat}\r\n# mkdir /etc/puppet/environments/production\r\n# puppet module install -i /tmp/test saz/ntp\r\nNotice: Preparing to install into /tmp/test ...\r\nNotice: Created target directory /tmp/test\r\nNotice: Downloading from https://forge.puppetlabs.com ...\r\nNotice: Installing -- do not interrupt ...\r\n/tmp/test\r\n└── saz-ntp (v2.2.0)\r\n# puppet apply --modulepath /tmp/test -e 'include ntp' --noop\r\nError: Could not find class ntp for foreman-el6.example.com on node foreman-el6.example.com\r\nError: Could not find class ntp for foreman-el6.example.com on node foreman-el6.example.com\r\n# cp -a /tmp/test/ntp /etc/puppet/environments/production/modules/\r\n# puppet apply --modulepath /tmp/test -e 'include ntp' --noop\r\nWarning: Config file /etc/puppet/hiera.yaml not found, using Hiera defaults\r\nNotice: Compiled catalog for foreman-el6.example.com in environment production in 0.53 seconds\r\nNotice: /Stage[main]/Ntp/Package[ntp]/ensure: current_value absent, should be present (noop)\r\n^CExiting\r\n{noformat}\r\n\r\nBut if I remove that directory:\r\n\r\n{noformat}\r\n# rm -rf /etc/puppet/environments/production/\r\n# ll /etc/puppet/environments\r\ntotal 0\r\n# puppet apply --modulepath /tmp/test -e 'include ntp' --noop\r\nWarning: Config file /etc/puppet/hiera.yaml not found, using Hiera defaults\r\nNotice: Compiled catalog for foreman-el6.example.com in environment production in 0.53 seconds\r\nNotice: /Stage[main]/Ntp/Package[ntp]/ensure: current_value absent, should be present (noop)\r\n^CExiting\r\n{noformat}","closed_at":"2019-04-04T22:30:21.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1765","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:21.000-0700","timestamp":1652285951.551814,"priority":"Major","status_category":"Done","pull_request":2407},{"issue_id":"41094","title":"epp does not handle empty template","url":"https://tickets.puppetlabs.com/browse/PUP-2883","created_at":"2014-07-02T13:43:24.000-0700","number":"PUP-2883","body":"When epp is told to evaluate an empty template, the result is a complaint that the end of input is reached. epp should produce an empty string in this situation and not complain.\r\n\r\nTo reproduce:\r\n{code}\r\nnotice inline_epp(@(END), {x => world})\r\n  <%-| $x| %>\r\n  |- END\r\n{code}\r\nThis template has a parameter, but no other content in the template.\r\n","closed_at":"2019-04-04T22:30:24.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2883","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:24.000-0700","timestamp":1652285952.319545,"priority":"Normal","status_category":"Done","pull_request":2868},{"issue_id":"19934","title":"An empty csr_attributes.yaml file fails with undefined method","url":"https://tickets.puppetlabs.com/browse/PUP-913","created_at":"2013-12-02T16:11:47.000-0800","number":"PUP-913","body":"[~josh] found that an empty csr_attributes.yaml file raised:\r\n\r\nError: Could not request certificate: undefined method `delete' for false:FalseClass\r\n\r\nwhen the agent tries to create a keypair.  He found this on a windows agent, but the problem is likely general.\r\n\r\n{noformat}\r\n0 ~/work/puppet (master)  $ rm -rf ~/.puppet\r\n0 ~/work/puppet (master)  $ mkdir ~/.puppet\r\n0 ~/work/puppet (master)  $ touch ~/.puppet/csr_attributes.yaml\r\n0 ~/work/puppet (master)  $ bundle exec puppet agent -td --server puppetmaster.solar.lan\r\n...\r\nInfo: Creating a new SSL key for arcturus.local\r\nInfo: Caching certificate for ca\r\nInfo: csr_attributes file loading from /Users/josh/.puppet/csr_attributes.yaml\r\nError: Could not request certificate: undefined method `delete' for false:FalseClass\r\n{noformat}\r\n\r\nwhere the stacktrace is:\r\n\r\n{noformat}\r\nError: Could not request certificate: undefined method `delete' for false:FalseClass\r\n/Users/josh/work/puppet/lib/puppet/ssl/certificate_request_attributes.rb:25:in `load'\r\n/Users/josh/work/puppet/lib/puppet/ssl/host.rb:178:in `generate_certificate_request'\r\n/Users/josh/work/puppet/lib/puppet/ssl/host.rb:229:in `generate'\r\n/Users/josh/work/puppet/lib/puppet/ssl/host.rb:36:in `localhost'\r\n/Users/josh/work/puppet/lib/puppet/ssl/validator/default_validator.rb:26:in `initialize'\r\n/Users/josh/work/puppet/lib/puppet/ssl/validator.rb:27:in `new'\r\n/Users/josh/work/puppet/lib/puppet/ssl/validator.rb:27:in `default_validator'\r\n/Users/josh/work/puppet/lib/puppet/network/http_pool.rb:27:in `http_instance'\r\n/Users/josh/work/puppet/lib/puppet/indirector/rest.rb:58:in `network'\r\n/Users/josh/work/puppet/lib/puppet/indirector/rest.rb:83:in `http_request'\r\n/Users/josh/work/puppet/lib/puppet/indirector/rest.rb:63:in `http_get'\r\n/Users/josh/work/puppet/lib/puppet/indirector/rest.rb:97:in `block in find'\r\n/Users/josh/work/puppet/lib/puppet/indirector/rest.rb:178:in `block in do_request'\r\n/Users/josh/work/puppet/lib/puppet/indirector/request.rb:261:in `do_request'\r\n/Users/josh/work/puppet/lib/puppet/indirector/rest.rb:178:in `do_request'\r\n/Users/josh/work/puppet/lib/puppet/indirector/rest.rb:91:in `find'\r\n/Users/josh/work/puppet/lib/puppet/indirector/certificate/rest.rb:12:in `find'\r\n/Users/josh/work/puppet/lib/puppet/indirector/indirection.rb:201:in `find'\r\n/Users/josh/work/puppet/lib/puppet/ssl/host.rb:202:in `certificate'\r\n/Users/josh/work/puppet/lib/puppet/ssl/host.rb:324:in `wait_for_cert'\r\n/Users/josh/work/puppet/lib/puppet/application/agent.rb:477:in `wait_for_certificates'\r\n/Users/josh/work/puppet/lib/puppet/application/agent.rb:318:in `run_command'\r\n{noformat}\r\n\r\nOnce in this state, you need to delete the csr_attributes.yaml file from the confdir\r\n\r\n","closed_at":"2019-04-04T22:30:26.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-913","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:26.000-0700","timestamp":1652285953.078484,"priority":"Normal","status_category":"Done","pull_request":7085},{"issue_id":"30672","title":"Evaluation Error: Error while evaluating a Virtual Query, undefined local variable or method `slurpfunc' for #<Puppet::Pops::Parser::Lexer2:> ","url":"https://tickets.puppetlabs.com/browse/PUP-2129","created_at":"2014-03-31T17:07:32.000-0700","number":"PUP-2129","body":"Error: Could not retrieve catalog from remote server: Error 400 on SERVER: Evaluation Error: Error while evaluating a Virtual Query, undefined local variable or method `slurpfunc' for #<Puppet::Pops::Parser::Lexer2:0x000000031a3cb0> at /etc/puppet/external/modules/python/manifests/config.pp:20:31 on node ....\r\n\r\nThe module where this is happening can be found at https://github.com/quizlet/puppet-python","closed_at":"2019-04-04T22:30:29.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2129","labels":"future-parser","state":"Closed","updated_at":"2019-04-04T22:30:29.000-0700","timestamp":1652285954.035191,"priority":"Major","status_category":"Done","pull_request":2518},{"issue_id":"50277","title":"Puppetmaster removes /etc/puppet/environments/production if it's a link rather than a directory","url":"https://tickets.puppetlabs.com/browse/PUP-3186","created_at":"2014-09-05T04:49:48.000-0700","number":"PUP-3186","body":"We use puppet environments, and symlink the puppet folder of one of our git repos to /etc/puppet/environment.\r\n\r\nThis is how it looks like:\r\n#:/etc/puppet/environments$ ls -l\r\ntotal 4\r\nlrwxrwxrwx 1 root root   47 Jul  4 10:05 user1 -> /var/lib/ops-automation.user1/puppet\r\nlrwxrwxrwx 1 root root   49 Jul  4 10:05 user2 -> /var/lib/ops-automation.user2/puppet\r\nlrwxrwxrwx 1 root root   49 Jul  4 10:05 production -> /var/lib/ops-automation.production/puppet\r\n\r\nAfter we upgraded to puppet 3.7.0 this morning, Puppet would remove the symlink /etc/puppet/environment/production and replace it with an empty folder. Reverting to 3.6.2 fixed the issue for us.\r\n\r\nI suspect it *might* be linked to this patch: \r\nhttps://github.com/puppetlabs/puppet/pull/2646/files#diff-13\r\n\r\nIt seems to ensure the environment folder is a directory and manage it if this, among other things, is true:\r\nPuppet::FileSystem.exist?(envdir)\r\n\r\nThough in our case, the file exists but isn't a directory. If I'm right with this assumption, testing if the filepath is a directory rather than checking if the filepath exists could fix it...\r\n\r\nThanks!","closed_at":"2019-04-04T22:30:29.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3186","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:29.000-0700","timestamp":1652285954.253003,"priority":"Normal","status_category":"Done","pull_request":3075},{"issue_id":"37370","title":"A node can't always collect its own exported resources","url":"https://tickets.puppetlabs.com/browse/PUP-2689","created_at":"2014-05-28T07:29:56.000-0700","number":"PUP-2689","body":"Depending on how tags are applied, a node does not collect its own resources.\r\n\r\nSetting the  {{tag}} metaparameter in a resource default results in none of the test nodes collecting this resource.\r\n\r\nWhen the {{tag}} function is used, then each node collects the other nodes resources, but not it's own.\r\n\r\nWhen the resource has a {{tag =>}} metaparameter applied directly, then all resources are collected.\r\n\r\nHowever, even when the tag is given as a string rather than an array, the resource is collected ( at least on some resource types, {{notify}}, setting the {{tag}} as a string did not fully work for a {{concat}} resource )\r\n\r\nFor code samples that will reproduce the behavior, please refer to:\r\n\r\nhttps://gist.github.com/llowder/209fece500c1823c229b\r\nhttps://gist.github.com/llowder/a455dd2e8d7ceddf9abc\r\n\r\nI've also created a table that summarizes the notify resource test results, it is attached to the ticket.","closed_at":"2019-04-04T22:30:30.000-0700","comments":17,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2689","labels":"support","state":"Closed","updated_at":"2019-04-04T22:30:30.000-0700","timestamp":1652285954.471019,"priority":"Normal","status_category":"Done","pull_request":2712},{"issue_id":"56620","title":"Remove current_environment check in Puppet::Indirector::Request#environment=","url":"https://tickets.puppetlabs.com/browse/PUP-3567","created_at":"2014-10-29T10:26:13.000-0700","number":"PUP-3567","body":"Currently we have the environment setter in lib/puppet/indirector/request.rb set to allow the environment to be set to an environment when it is what is in `Puppet.lookup(:current_environment)`. We should only allow environments that puppet knows about in Puppet.lookup(:environments)\r\n\r\nThe following lines should be removed:\r\n{noformat}\r\nelsif (current_environment = Puppet.lookup(:current_environment)).name == env\r\n  current_environment\r\n{noformat}","closed_at":"2019-04-04T22:30:30.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3567","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:30.000-0700","timestamp":1652285954.578903,"priority":"Normal","status_category":"Done","pull_request":3390},{"issue_id":"20600","title":"future parser fails to recognize hash as parameter in un-parenthesized calls","url":"https://tickets.puppetlabs.com/browse/PUP-979","created_at":"2013-12-09T18:33:37.000-0800","number":"PUP-979","body":"If an attempt is made to evaluate this\r\n{code}\r\nnotice {a => 10}\r\n{code}\r\n\r\nThe result is the error message: \"ll resource specifications require names\"\r\n\r\nThis is because it was once allowed to have resource initialization without a name, and the parser issues a deprecation error for this.\r\n\r\nThis is somewhat tricky to work around as the grammar does not know if a name represents a function name, or a type name (nor can it, because that would require it to know every function/type up-front when parsing).\r\n\r\nIt may be possible to specialize the grammar; now it accepts an Expression followed by Body or Bodies that may or may not have titles depending on what the LHS Expression is. This may solve the problem but requires experimentation.\r\n\r\nAnother option, since the case of a no-title resource body is specific is to simply generate a name, followed by a hash if the body is only using '=>' as attribute operator. If '+>' it would be an error in any case.\r\n\r\nYet another option is to perform lexical look ahead (but this is both expensive and difficult since the ':' which signals that what otherwise looks like a hash is a title is on the right of what may be a complex expression.\r\n\r\nGoing to far solving this creates another problem; functions and types end up being in the same name space, and needs to be resolved at runtime.\r\n\r\nMeanwhile, use () around the arguments in the function call.\r\n\r\nThis work relates to the work to refactor the errors raised from within the grammar itself.\r\n\r\nFinally. It may be an acceptable restriction and that the specification states that it is not possible to call a function without using parentheses when the argument is a literal hash.\r\n\r\nA decision is needed if it is worth trying to fix this.\r\n\r\nStory point wise, this is hard to assess as a working solution can only be found by experimenting, it may take a day, or a week, or we may end up with a different anomaly. Ended up setting 2 as a cap on exploratory work.","closed_at":"2019-04-04T22:30:34.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-979","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:34.000-0700","timestamp":1652285969.519223,"priority":"Normal","status_category":"Done","pull_request":7726},{"issue_id":"19262","title":"Structured CSR attributes cannot be displayed by OpenSSL","url":"https://tickets.puppetlabs.com/browse/PUP-801","created_at":"2013-11-20T10:30:10.000-0800","number":"PUP-801","body":"When using `openssl req` to inspect a CSR with custom attributes, the attribute value cannot be displayed. Given the following `csr_attributes.yaml`:\r\n\r\n<pre>\r\n---\r\ncustom_attributes:\r\n  1.3.6.1.4.1.34380.2.1: \"string data\"\r\n  1.3.6.1.4.1.34380.2.2: ['structured', 'data']\r\n\r\nextension_requests:\r\n  pp_uuid: '6036aec5-b5a2-4919-9194-8bf8a81d92b9'\r\n</pre>\r\n\r\nInspecting the CSR with `openssl req -in ~/.puppet/csr.pem -noout -text` yields the following:\r\n\r\n<pre>\r\n[...]\r\n        Attributes:\r\n            1.3.6.1.4.1.34380.2.1    :unable to print attribute\r\n            1.3.6.1.4.1.34380.2.2    :unable to print attribute\r\n        Requested Extensions:\r\n            1.3.6.1.4.1.34380.1.1.1: \r\n                6036aec5-b5a2-4919-9194-8bf8a81d92b9\r\n[...]\r\n</pre>\r\n\r\nThis is because the OpenSSL code expects attributes to either be the extReq attribute, or a custom attribute with a type of `T61String`, `IA5String`, or `PrintableString`:\r\n\r\n(openssl 1.0.1e crypto/asn1/t_req.c lines 206-216)\r\n<pre>\r\n\t\t\t\tif (\t(type == V_ASN1_PRINTABLESTRING) ||\r\n\t\t\t\t\t(type == V_ASN1_T61STRING) ||\r\n\t\t\t\t\t(type == V_ASN1_IA5STRING))\r\n\t\t\t\t\t{\r\n\t\t\t\t\tif (BIO_write(bp,(char *)bs->data,bs->length)\r\n\t\t\t\t\t\t!= bs->length)\r\n\t\t\t\t\t\tgoto err;\r\n\t\t\t\t\tBIO_puts(bp,\"\\n\");\r\n\t\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\tBIO_puts(bp,\"unable to print attribute\\n\");\r\n\t\t\t\t\t}\r\n</pre>\r\n\r\nThe specification of CSRs indicates that attributes may be arbitrarily structured, but the openssl command line is one of the main methods that people will be interacting with CSRs with custom attributes. Changing the CSR attribute structure to only use string values simplifies the code and interacts better with openssl, and if structured data is needed then a data can be serialized as JSON/YAML/XML/JSONx and deserialized by the consumer of the CSR if needed.","closed_at":"2019-04-04T22:30:35.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-801","labels":"redmine","state":"Resolved","updated_at":"2019-04-04T22:30:35.000-0700","timestamp":1652285970.076031,"priority":"Normal","status_category":"Done","pull_request":8334},{"issue_id":"28207","title":"File type ignore can't convert Fixnum into String","url":"https://tickets.puppetlabs.com/browse/PUP-1885","created_at":"2014-03-07T00:38:10.000-0800","number":"PUP-1885","body":"The following worked in Puppet 3.1 but throws errors in Puppet 3.4.x\r\n{noformat}\r\n    file { $::epiphany::cluster_dir:\r\n      ensure  => directory,\r\n      mode    => $::epiphany::config_file_mode,\r\n      owner   => $::epiphany::config_file_owner,\r\n      group   => $::epiphany::config_file_group,\r\n      require => Exec[\"${::epiphany::cluster_dir}/registry/db\"],\r\n      source  => 'puppet:///modules/epiphany/cluster',\r\n      recurse => true,\r\n      ignore  => ['.snapshot', '0', 'k', 'z'],\r\n    }\r\n{noformat}\r\nError thrown by Puppet:\r\n{noformat}puppet-agent[29514]: (/Stage[main]/Epiphany::Install/File[/srv/epiphany/cluster]) Failed to generate additional resources using 'eval_generate': Error 400 on SERVER: can't convert Fixnum into String{noformat}\r\nWhen removing {{'0'}} from the array, no errors are thrown.","closed_at":"2019-04-04T22:30:36.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1885","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:36.000-0700","timestamp":1652285970.402011,"priority":"Normal","status_category":"Done","pull_request":2419},{"issue_id":"237478","title":"Incorrect handling of white space surrounding comments in EPP","url":"https://tickets.puppetlabs.com/browse/PUP-8476","created_at":"2018-02-20T07:49:35.000-0800","number":"PUP-8476","body":"An EPP comment preceded by any number of spaces or tabs will not produce those spaces or tabs on output:\r\n{code:puppet}\r\ninline_epp(\"some   \\t\\t   <%#%>text\")) # returns 'sometext'\r\ninline_epp(\"some<%#%> text\")) # returns 'some text'\r\n{code}\r\nI can't find anything in the documentation that supports this. The code contains [this comment and a regexp|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/pops/parser/epp_support.rb#L244-L245]. It would make sense if the regexp was anchored at the beginning of line (and if the behavior was documented) but it isn't.","closed_at":"2019-04-04T22:30:37.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8476","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:37.000-0700","timestamp":1652285970.622452,"priority":"Normal","status_category":"Done","pull_request":6745},{"issue_id":"56227","title":"4x function API's call_function cannot call a 3x function","url":"https://tickets.puppetlabs.com/browse/PUP-3548","created_at":"2014-10-26T16:51:29.000-0700","number":"PUP-3548","body":"The 4x API exposes a method called \"call_function\" that a 4x function can use to call other functions. \r\n\r\nThis is however currently restricted to only work for 4x functions as the function is loaded using the loaders subsystem, and this subsystem is not used to load 3x functions. \r\n\r\nWe can either change the use of the loaders for 3x functions, or add handling in the call_function to perform lookup of a 3x function the \"old way\" if it is not found in the new loaders subsystem.","closed_at":"2019-04-04T22:30:37.000-0700","comments":18,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3548","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:37.000-0700","timestamp":1652285970.955767,"priority":"Normal","status_category":"Done","pull_request":3503},{"issue_id":"37404","title":"LiteralString class parameters get parsed with positioning information that includes a negative length","url":"https://tickets.puppetlabs.com/browse/PUP-2693","created_at":"2014-05-28T12:12:06.000-0700","number":"PUP-2693","body":"When using the future parser, any class parameter with a LiteralString value receive positioning information with a negative length:\r\n\r\n{code}\r\n# param_test.rb\r\nrequire 'puppet'\r\nrequire 'puppet/pops'\r\n\r\nparser = Puppet::Pops::Parser::Parser.new\r\n\r\nresult = parser.parse_string <<-EOM\r\nclass test::class (\r\n  $param_one = undef,\r\n  $param_two = 'some string',\r\n  $param_three = true,\r\n  $param_four = 'another string',\r\n  $param_five = $some::varaible::somewhere, \r\n) {}\r\nEOM\r\n\r\nresult.current.definitions.each do |d|\r\n  d.parameters.each do |p|\r\n    puts \"#{p.name}: #{p.value.length}\"\r\n  end\r\nend\r\n{code}\r\n\r\n{noformat}\r\n# ruby param_test.rb\r\nparam_one: 5\r\nparam_two: -13\r\nparam_three: 4\r\nparam_four: -16\r\nparam_five: 26\r\n{noformat}\r\n\r\nThis prevents SourcePosAdapters attached to these object from being fully functional.","closed_at":"2019-04-04T22:30:38.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2693","labels":"future-parser","state":"Closed","updated_at":"2019-04-04T22:30:38.000-0700","timestamp":1652285971.384473,"priority":"Normal","status_category":"Done","pull_request":2755},{"issue_id":"55972","title":"Future parser handling undef's incorrectly","url":"https://tickets.puppetlabs.com/browse/PUP-3505","created_at":"2014-10-22T13:50:59.000-0700","number":"PUP-3505","body":"Trying to run the future parser with PE I ran in to the following error\r\nhttps://github.com/puppetlabs/puppetlabs-pe_staging/blob/3.2.x/manifests/file.pp#L18\r\nThe manifest above is failing because the future parser is overriding the variable $environment with the top-level puppet variable ($environment) set to 'production' in our case.\r\n\r\nThe error I got was\r\nError: Failed to apply catalog: Parameter environment failed on Exec[/opt/staging/pe_repo/puppet-enterprise-3.4.0-rc1-1641-g71eeb3f-debian-7-amd64-agent.tar.gz]: Invalid environment setting 'production' at /opt/puppet/share/puppet/modules/pe_staging/manifests/file.pp:95\r\nWrapped exception:\r\nInvalid environment setting 'production'\r\nWrapped exception:\r\nInvalid environment setting 'production'\r\n\r\nReproduction steps in PE:\r\nInstall pe\r\nSet parser = future in puppet.conf\r\nRestart puppetserver\r\nWait 30 sec\r\nrun the agent with -tdv","closed_at":"2019-04-04T22:30:40.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3505","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:40.000-0700","timestamp":1652285971.818817,"priority":"Blocker","status_category":"Done","pull_request":3229},{"issue_id":"51200","title":"Function calls no longer showing up in profile data","url":"https://tickets.puppetlabs.com/browse/PUP-3245","created_at":"2014-09-15T09:49:00.000-0700","number":"PUP-3245","body":"When the {{profile}} setting is enabled, the catalog compilation tracks course grained profiling information. One piece of information tracked is how long it takes it to make function calls.\r\n\r\n{noformat}\r\nDebug: PROFILE [apply] 2.3.1 Called notice: took 0.0001 seconds\r\n{noformat}\r\n\r\nHowever, this information is missing when the future parser is in effect. Without this, there is a large gap in accounting for where time is spent when producing a catalog.","closed_at":"2019-04-04T22:30:40.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3245","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:40.000-0700","timestamp":1652285971.924363,"priority":"Normal","status_category":"Done","pull_request":3098},{"issue_id":"35826","title":"Spurious warnings when using multiple file sources","url":"https://tickets.puppetlabs.com/browse/PUP-2584","created_at":"2014-05-15T17:54:46.000-0700","number":"PUP-2584","body":"When a file resource uses multiple sources puppet issues a warning like (the example manifest and the warning are not intended to match in file names):\r\n{code}\r\nWarning: Find /production/file_metadata/modules/slurm/c12-8.ymir.cse.ucdavis.edu/slurm.sh?links=manage&source_permissions=use resulted in 404 with the message: Not Found: Could not find file_metadata modules/slurm/c12-8.ymir.cse.ucdavis.edu/slurm.sh\r\n{code}\r\n\r\nThis causes the puppet run, although successful, to look like it has done a number of things wrong.","closed_at":"2019-04-04T22:30:40.000-0700","comments":27,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2584","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:40.000-0700","timestamp":1652285972.300258,"priority":"Critical","status_category":"Done","pull_request":2663},{"issue_id":"32707","title":"Functions unable to call functions in different modules","url":"https://tickets.puppetlabs.com/browse/PUP-2344","created_at":"2014-04-22T14:11:47.000-0700","number":"PUP-2344","body":"With two modules, a and b, and one function in each module, a::func1 and b::func2, it doesn't seem possible for a::func1 to make a call to b::func2.\r\n\r\nIt needs to be possible with the new function API and the new loader system for function calls between modules to take place. The new loaders try to limit the visibility of modules so that they can more strictly control their dependencies, but it seems to be too strict right now.\r\n\r\nThe rules should be:\r\n  1. If there is *no* metadata for the module, everything is visible to it.\r\n  2. If there is metadata, only those modules listed in the dependencies are visible to it.","closed_at":"2019-04-04T22:30:41.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2344","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:41.000-0700","timestamp":1652285972.509094,"priority":"Critical","status_category":"Done","pull_request":2568},{"issue_id":"25329","title":"Using new directory environments with puppet apply prevents evaluation of the manifest requested on the commandline.","url":"https://tickets.puppetlabs.com/browse/PUP-1574","created_at":"2014-02-03T15:06:00.000-0800","number":"PUP-1574","body":"Assuming you are working with master past the inclusion of PUP-1118 (3c4669d) and you have directory environments available:\r\n\r\n{code}\r\njpartlow@percival:~/work/puppet$ tree ~/.puppet/environments/\r\n/home/jpartlow/.puppet/environments/\r\n└── myenv\r\n\r\n1 directory, 0 files\r\n{code}\r\n\r\nThen given a manifest ./local.pp\r\n\r\n{code}\r\njpartlow@percival:~/work/puppet$ cat local.pp \r\nnotice('in local.pp')\r\n{code}\r\n\r\nYou will see the following behavior depending on whether you puppet apply with a directory environment:\r\n\r\n{code}\r\njpartlow@percival:~/work/puppet$ be puppet apply local.pp                                                                                                        \r\n/dev/mem: Permission denied\r\nNotice: Scope(Class[main]): in local.pp\r\nNotice: Compiled catalog for percival.corp.puppetlabs.net in environment production in 0.01 seconds\r\nNotice: Finished catalog run in 0.05 seconds\r\n{code}\r\n\r\n{code}\r\njpartlow@percival:~/work/puppet$ be puppet apply local.pp --environment myenv\r\n/dev/mem: Permission denied\r\nNotice: Compiled catalog for percival.corp.puppetlabs.net in environment myenv in 0.02 seconds\r\nNotice: Finished catalog run in 0.07 seconds\r\njpartlow@percival:~/work/puppet$ \r\n{code}","closed_at":"2019-04-04T22:30:41.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1574","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:41.000-0700","timestamp":1652285972.61184,"priority":"Normal","status_category":"Done","pull_request":2334},{"issue_id":"37739","title":"tag should be a statement function in future parser","url":"https://tickets.puppetlabs.com/browse/PUP-2703","created_at":"2014-05-30T11:21:33.000-0700","number":"PUP-2703","body":"The {{tag}} function should (just like include, require, contain, and\r\nthe logging functions), be considered a statement function by the future parser. Now, it is required to use parentheses around its arguments.","closed_at":"2019-04-04T22:30:42.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2703","labels":"future-parser","state":"Closed","updated_at":"2019-04-04T22:30:42.000-0700","timestamp":1652285972.920213,"priority":"Normal","status_category":"Done","pull_request":2713},{"issue_id":"28974","title":"Environment & transaction_uuid is not passed to facts indirector during compilation","url":"https://tickets.puppetlabs.com/browse/PUP-1975","created_at":"2014-03-18T10:07:45.000-0700","number":"PUP-1975","body":"The class Puppet::Indirector::Catalog::Compiler contains a method 'extract_facts_from_request' which extracts facts from the request to be stored in a cache indirector.\r\n\r\nThis call is used in the flow for the PuppetDB terminus to save facts.\r\n\r\nThe problem however, is that the environment is not passed through to the indirector, which means we cannot preserve facts with the environment they were created from so we can complete PDB-453.\r\n\r\nI have a patch that remedies this, and it is forthcoming.\r\n\r\n[~eric.sorenson], [~andy] ... I'm not sure if this is strictly a bug or non-feature, what do you think? I simply ask because I'm not sure what branch/fix version to target this for.","closed_at":"2019-04-04T22:30:44.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1975","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:44.000-0700","timestamp":1652285973.537236,"priority":"Normal","status_category":"Done","pull_request":2444},{"issue_id":"20598","title":"multiple literal default entries in case should raise warning or error under control by --strict","url":"https://tickets.puppetlabs.com/browse/PUP-978","created_at":"2013-12-09T17:42:03.000-0800","number":"PUP-978","body":"Multiple 'default' entries should result in a parse error. It creates an ambiguity. Consider the following examples:\r\n\r\n{code}\r\ncase 10 {\r\n  default : { notice 'nbr1' }\r\n  default : { notice 'nbr2' }\r\n}\r\n# => notices nbr 2\r\n\r\ncase default {\r\n  default : { notice 'nbr1 }\r\n  default : { notice 'nbr2' }\r\n}\r\n# => notices nbr1\r\n{code}\r\n\r\nThe solution is to validate that only one option among all propositions is a literal default.\r\n\r\nUPDATE\r\n----\r\nThe check for this can only detect literal (i.e. static) duplication. This because it is possible to use any expression as a case option and we cannot evaluate all options as the language is specified to evaluate them sequentially until there is a match. Here is an illustration:\r\n{code:puppet}\r\n$a = default\r\ncase 10 {\r\n  $a : { notice yay }\r\n  default : { notice nay }\r\n}\r\n{code}\r\nThis will notice {{yay}}.\r\n\r\nIt is not only duplication of literal {{default}} that can cause problems - a check could check for any static duplication since the option with a second identical value would never be reached. Such a check is however more expensive than only checking duplication of literal {{default}} since option values can be arbitrarily complex.","closed_at":"2019-04-04T22:30:44.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-978","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:44.000-0700","timestamp":1652285973.641457,"priority":"Normal","status_category":"Done","pull_request":7588},{"issue_id":"37891","title":"Future parser returns nil when parsing a source that contains no statements","url":"https://tickets.puppetlabs.com/browse/PUP-2714","created_at":"2014-06-02T14:16:28.000-0700","number":"PUP-2714","body":"Consider the following example:\r\n\r\n{code}\r\nrequire 'puppet'\r\nrequire 'puppet/pops'\r\n\r\nparser = Puppet::Pops::Parser::Parser.new\r\n\r\nresult = parser.parse_string('# This is a comment')\r\n\r\nputs \"Result: #{result.inspect}\"\r\n\r\nresult = parser.parse_string <<-EOM\r\n# This is a comment\r\n$foo = 1\r\nEOM\r\n\r\nputs \"Result: #{result.inspect}\"\r\n{code}\r\n\r\nThe result is:\r\n\r\n{noformat}\r\n# ruby parser_tst.rp \r\nResult: nil\r\nResult: #<Puppet::Pops::Model::Factory:0x7ffe0c270dc8 @current=Puppet::Pops::Model::AssignmentExpression>\r\n{noformat}\r\n\r\nIn the first case, a nil is returned because there are no Puppet statements in the input. We should consider returning some {{Pops::Model}} object, such as {{Nop}}, instead of nil.\r\n\r\nOr, document nil as a valid return type for the future parser.","closed_at":"2019-04-04T22:30:48.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2714","labels":"future-parser","state":"Closed","updated_at":"2019-04-04T22:30:48.000-0700","timestamp":1652285974.900053,"priority":"Normal","status_category":"Done","pull_request":2749},{"issue_id":"21371","title":"Resource defaults and automatic tags are applied after collectors are evaluated","url":"https://tickets.puppetlabs.com/browse/PUP-1053","created_at":"2013-12-16T05:36:09.000-0800","number":"PUP-1053","body":"Resources (and virtual resources) are not having their classes declared tags correctly applied. (\"Add the specified tags to the containing class or definition. All contained objects will then acquire that tag, also.\" ref: http://docs.puppetlabs.com/references/latest/function.html#tag)\r\n\r\n{code}\r\nclass foo {\r\n    tag 'notworking'\r\n    notify { \"I'm untagged\": }\r\n    notify { \"I'm tagged\": tag => \"notworking\" }\r\n}\r\ninclude foo\r\nNotify <| tag == \"notworking\" |> { message => \"I am though\" }\r\n{code}\r\n\r\nResults in:\r\n\r\n{code}\r\nmauve /home/jbooth > puppet tagmagic.pp\r\nnotice: I am though\r\nnotice: //foo/Notify[I'm tagged]/message: defined 'message' as 'I am though'\r\nnotice: I'm untagged\r\nnotice: //foo/Notify[I'm untagged]/message: defined 'message' as 'I'm untagged'\r\n{code}\r\n\r\nYou can change the 'tag == \"foo\"' and life doesn't get any better. The neither notify gets the message changed.\r\n\r\n{code}\r\nmauve /home/jbooth > tail -1 tagmagic.pp \r\nNotify <| tag == \"foo\" |> { message => \"I am though\" }\r\nmauve /home/jbooth > puppet tagmagic.pp\r\nnotice: I'm untagged\r\nnotice: //foo/Notify[I'm untagged]/message: defined 'message' as 'I'm untagged'\r\nnotice: I'm tagged\r\nnotice: //foo/Notify[I'm tagged]/message: defined 'message' as 'I'm tagged'\r\n{code}","closed_at":"2019-04-04T22:30:48.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1053","labels":"customer;redmine","state":"Closed","updated_at":"2019-04-04T22:30:48.000-0700","timestamp":1652285975.004387,"priority":"Normal","status_category":"Done","pull_request":8183},{"issue_id":"197414","title":"puppet epp render fails on valid templates ","url":"https://tickets.puppetlabs.com/browse/PUP-7691","created_at":"2017-06-22T09:26:58.000-0700","number":"PUP-7691","body":"puppet apply is able to parse/render template data where puppet epp render fails.\r\n\r\n{noformat}\r\npuppet apply /tmp/foo.pp -v\r\nInfo: Applying configuration version '1498149368'\r\nNotice: /Stage[main]/Main/File[/tmp/epp_file.txt]/ensure: defined content as '{md5}b5648129ac61afe0f9ffdaac69db3b75'\r\nNotice: /Stage[main]/Main/File[/tmp/epp_inline.txt]/ensure: defined content as '{md5}b5648129ac61afe0f9ffdaac69db3b75'\r\nNotice: Applied catalog in 0.01 seconds\r\n{noformat}\r\n\r\n{noformat}\r\npuppet epp render /tmp/foo.epp --trace\r\nError: Evaluation Error: Error while evaluating a Method call, each(): Wrong number of arguments given (1 for minimum 2) at /tmp/foo.epp:2:9\r\nError: error while rendering epp\r\n/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/gems/puppet-4.10.4/lib/puppet/face/epp.rb:345:in `block (3 levels) in <top (required)>'\r\n/usr/local/opt/rbenv/versions/2.3.1/gemsets/solaris_providers/gems/puppet-4.10.4/lib/puppet/interface/action.rb+eval[wrapper]:242:in `render'\r\n/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/gems/puppet-4.10.4/lib/puppet/application/face_base.rb:252:in `main'\r\n/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/gems/puppet-4.10.4/lib/puppet/application.rb:366:in `run_command'\r\n/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/gems/puppet-4.10.4/lib/puppet/application.rb:358:in `block in run'\r\n/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/gems/puppet-4.10.4/lib/puppet/util.rb:542:in `exit_on_fail'\r\n/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/gems/puppet-4.10.4/lib/puppet/application.rb:358:in `run'\r\n/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/gems/puppet-4.10.4/lib/puppet/util/command_line.rb:132:in `run'\r\n/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/gems/puppet-4.10.4/lib/puppet/util/command_line.rb:72:in `execute'\r\n/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/gems/puppet-4.10.4/bin/puppet:5:in `<top (required)>'\r\n/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/bin/puppet:23:in `load'\r\n/usr/local/Cellar/rbenv/1.1.0/versions/2.3.1/gemsets/solaris_providers/bin/puppet:23:in `<main>'\r\nError: Try 'puppet help epp render' for usage\r\n{noformat}\r\n\r\n\r\n\r\n\r\nThe following manifest will create the test condition.\r\nAfter application puppet epp render /tmp/foo.epp fails\r\n\r\n{code:java}\r\n$foo_epp=@(END)\r\n<% $data = [\"routers\", \"servers\", \"workstations\"] -%>\r\n<% $data.each |$value| { %>\r\n  <%= $value %>\r\n<% } -%>\r\nEND\r\n\r\n# Can't actually create the template here the catalog compilation fails\r\n# file { \"/tmp/foo.epp\":\r\n#   ensure   => file,\r\n#   content  => $foo_epp,\r\n# }\r\n\r\nfile { \"/tmp/epp_file.txt\":\r\n ensure    => file,\r\n content   => epp('/tmp/foo.epp')\r\n}\r\n\r\nfile { \"/tmp/epp_inline.txt\":\r\n  ensure   => file,\r\n  content  => inline_epp($foo_epp)\r\n}\r\n\r\n{code}\r\n","closed_at":"2019-04-04T22:30:49.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7691","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:49.000-0700","timestamp":1652285975.311075,"priority":"Normal","status_category":"Done","pull_request":6007},{"issue_id":"12668","title":"A hiera-1 hiera.yaml should be ignored in $confdir","url":"https://tickets.puppetlabs.com/browse/PUP-200","created_at":"2013-07-31T10:07:15.000-0700","number":"PUP-200","body":"The default bootstrap of the bindings looks at hiera.yaml in $confdir. If this is a hiera-1 yaml, it should silently be ignored. Currently there is no logic in place for this (it should be in the ConfdirHieraSchemeHandler).","closed_at":"2019-04-04T22:30:50.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-200","labels":"","state":"Resolved","updated_at":"2019-04-04T22:30:50.000-0700","timestamp":1652285975.721188,"priority":"Major","status_category":"Done","pull_request":2464},{"issue_id":"20950","title":"Make relationship with empty set in the middle work as expected","url":"https://tickets.puppetlabs.com/browse/PUP-996","created_at":"2013-12-11T14:12:47.000-0800","number":"PUP-996","body":"If a relationship is formed with an empty set of references,, there will be no relationships created. In practice this becomes a problem when a set is empty as in the following example:\r\n{code}\r\nFile[a] -> [] -> File[b]\r\n{code}\r\n\r\nWhich results in the same as:\r\n{code}\r\nFile[a] -> []\r\n[] -> File[b]\r\n{code}\r\nThis case is not a problem as the intent here must be interpreted as forming optional relationships and there is nothing wrong. Naturally it is surprising if that was not the intention.\r\n\r\nRight now this is silently just a no-op. \r\n\r\nA thorny problem exists when a collector is used to form the relationship. Is that supposed to be optional or not. Arguably, if a collector is used in the middle and returns empty, it should work as if the collector was not there. The main problem with collectors is that they are lazily evaluated at the end of the compilation, and they must be given enough information to be able to close the gap if it is in the middle of a relationship expression. The evaluator must give it this, since it is evaluating the relationship expressions.\r\n\r\nWe should:\r\n* Make the empty set in the middle case work by acting if it was not there, and instead typing the LLHS, to the RRHS.\r\n* When doing this, and the relationship type differs, the RRHS operator should be used (as that defines what the RRHS side expects)\r\n* Accept all other cases silently\r\n* Log with level debug when a relationship is formed with an empty set","closed_at":"2019-04-04T22:30:53.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-996","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:53.000-0700","timestamp":1652285976.643878,"priority":"Normal","status_category":"Done","pull_request":7676},{"issue_id":"51827","title":"Puppet resource broken when directory environments enabled","url":"https://tickets.puppetlabs.com/browse/PUP-3302","created_at":"2014-09-18T06:15:51.000-0700","number":"PUP-3302","body":"When running puppet resource, the command fails for want of a 'none' environment\r\n\r\n{quote} puppet resource file /usr/share/puppet-dashboard-mirror ensure=directory source=/usr/share/puppet-dashboard recurse=true ignore='*log*'\r\nError: /File[/usr/share/puppet-dashboard-mirror]: Failed to generate additional resources using 'eval_generate': Could not find a directory environment named 'none' anywhere in the path: /platform/puppet/environment. Does the directory exist?\r\nError: /File[/usr/share/puppet-dashboard-mirror]: Could not evaluate: Could not retrieve file metadata for file:/usr/share/puppet-dashboard: Could not find a directory environment named 'none' anywhere in the path: /platform/puppet/environment. Does the directory exist?\r\nWrapped exception:\r\nCould not find a directory environment named 'none' anywhere in the path: /platform/puppet/environment. Does the directory exist?\r\nError: Could not run: Could not retrieve file metadata for file:/usr/share/puppet-dashboard: Could not find a directory environment named 'none' anywhere in the path: /platform/puppet/environment. Does the directory exist?\r\nWrapped exception:\r\nCould not find a directory environment named 'none' anywhere in the path: /platform/puppet/environment. Does the directory exist?\r\n{quote}\r\n\r\nNote also - when a large number of directory environments exist, the valid_directories routine in /usr/lib/ruby/site_ruby/1.8/puppet/environments.rb takes a lot of time to stat the environment directory and work out whether all the directories are valid (I currently have 224 environments and the delay between e.g. a puppet agent -t --debug and the command even starting to display debug output is something like 10s (ymmv depending on IO etc)","closed_at":"2019-04-04T22:30:53.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3302","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:53.000-0700","timestamp":1652285976.856035,"priority":"Normal","status_category":"Done","pull_request":3198},{"issue_id":"20923","title":"Relationship expression artificially denies arrays as operands","url":"https://tickets.puppetlabs.com/browse/PUP-992","created_at":"2013-12-11T13:22:43.000-0800","number":"PUP-992","body":"The future evaluator artificially denies the use of arrays as operands in a relationship expression (this because they are not supported in 3x).\r\n\r\nAll it takes to support this is to add three lines to the RelationshipOperator:\r\n{code}\r\ndef transformArray(o)\r\n  o.map{|x| transform(x) }\r\nend\r\n{code}\r\n\r\nThis because the multiplication is handled by the new implementation and there are no restrictions in the grammar wrt. the LHS and RHS operands.\r\n","closed_at":"2019-04-04T22:30:54.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-992","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:54.000-0700","timestamp":1652285976.959837,"priority":"Normal","status_category":"Done","pull_request":7640},{"issue_id":"25804","title":"Module tool cache directory isn't multi-process safe","url":"https://tickets.puppetlabs.com/browse/PUP-1609","created_at":"2014-02-07T04:50:26.000-0800","number":"PUP-1609","body":"When running two \"puppet module install\" processes in parallel as the same user, you can get intermittent errors as the working/cache directory is shared across both processes.\r\n\r\nWe see this on our Jenkins instance when using librarian-puppet in concurrent jobs (which are much preferred due to the speed).  e.g.\r\n\r\n{noformat}\r\n\u001bError: No such file or directory - /home/jenkins/.puppet/var/puppet-module/cache/tmp-unpacker-caddf5336d687def271badc2321a49b23e7dbd56\u001b[0m\r\n\u001bError: Try 'puppet help module install' for usage\u001b[0m\r\n{noformat}\r\n\r\nIt's exacerbated if your storage device is slow.  To reproduce, add a {{sleep rand(3)}} into the middle of the \"extract_module_to_install_dir\" method in lib/puppet/module_tool/applications/unpacker.rb and run:\r\n\r\n{noformat}\r\n$ rm -rf /tmp/test{1,2}; puppet module install -i /tmp/test2 puppetlabs/apache --ignore-dependencies & puppet module install -i /tmp/test1 puppetlabs/apache --ignore-dependencies\r\n[1] 20513\r\nNotice: Preparing to install into /tmp/test2 ...\r\nNotice: Created target directory /tmp/test2\r\nNotice: Downloading from https://forge.puppetlabs.com ...\r\nNotice: Preparing to install into /tmp/test1 ...\r\nNotice: Created target directory /tmp/test1\r\nNotice: Downloading from https://forge.puppetlabs.com ...\r\nNotice: Installing -- do not interrupt ...\r\nNotice: Installing -- do not interrupt ...\r\n/tmp/test2\r\n└── puppetlabs-apache (v0.11.0)\r\nError: No such file or directory @ unlink_internal - /home/dcleal/.puppet/var/puppet-module/cache/tmp-unpacker-95dbd7679d60ec112592f6f481c974f40194f30e\r\nError: Try 'puppet help module install' for usage\r\n{noformat}","closed_at":"2019-04-04T22:30:55.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1609","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:55.000-0700","timestamp":1652285977.578799,"priority":"Normal","status_category":"Done","pull_request":2336},{"issue_id":"16099","title":"Remove partially implemented support for 'import'","url":"https://tickets.puppetlabs.com/browse/PUP-490","created_at":"2013-10-02T10:42:01.000-0700","number":"PUP-490","body":"In --parser future, 'import's are handled as if they are function calls, but when transforming to 3x AST these expressions are handled the same way as in 3x; they go off and parse the referenced file.\r\n\r\nSince the decision for 3.5 is to deprecate import and instead provide a directory containing manifests to auto-run. That implementation for 3x will also work\r\nfor future parser/evaluator. That work is covered by PUP-865 and PUP-866. There is however unused support/transformations of import calls in the future code base. Those transformations should be removed:\r\n\r\n* The import instruction model object should be removed:\r\n* methods in supporting classes; transformer, tree dumper, factory removed\r\n* The special handling of transforming an import function to an import model object) should be removed\r\n\r\ni.e. future parser/evaluator will not issue deprecation, and will instead interpret import as if it is a function call (leading to unknown function error since\r\nthere is no such function).","closed_at":"2019-04-04T22:30:55.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-490","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:55.000-0700","timestamp":1652285977.680793,"priority":"Normal","status_category":"Done","pull_request":4117},{"issue_id":"70587","title":"Default environment_timeout should be 0, not infinity.","url":"https://tickets.puppetlabs.com/browse/PUP-4094","created_at":"2015-03-06T11:36:25.000-0800","number":"PUP-4094","body":"We've gone back and forth on this a few times ([PUP-2702], [PUP-2639]) but after running into issues from PS engagements to training to [this puppet-dev thread|https://groups.google.com/d/topic/puppet-dev/lnbXyHlviT0/discussion], it seems the best option is actually to default the environment_timeout to 0 (do not cache) and let people tune upwards if they need to.\r\n\r\nPlease set the default to 0 for Puppet 3.7.x and beyond and let's update the docs to describe the rationale there.","closed_at":"2019-04-04T22:30:56.000-0700","comments":26,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4094","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:56.000-0700","timestamp":1652285977.89185,"priority":"Normal","status_category":"Done","pull_request":3727},{"issue_id":"32538","title":"assert_type function should handle lambda","url":"https://tickets.puppetlabs.com/browse/PUP-2314","created_at":"2014-04-21T17:58:05.000-0700","number":"PUP-2314","body":"The assert_type function was written before lambda support was added to the new function API. If called like this:\r\n\r\n{code}\r\nassert_type(Callable[Optional[Object]]) |$x| { }\r\n{code}\r\nIt fails because it does not support an optional lambda being passed.\r\n\r\n(The error message is also hard to understand - this is a separate issue).\r\n\r\nThis is easily fixed by adding support for an optional lambda in the function, and then either check the given value, or the given lambda, and error if both are given.\r\n\r\nThe assert_type will probably also fail if called with only a type argument since it will dispatch to a method that requires two arguments. (The method should have a default value assigned).","closed_at":"2019-04-04T22:30:58.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2314","labels":"","state":"Closed","updated_at":"2019-04-04T22:30:58.000-0700","timestamp":1652285978.517938,"priority":"Normal","status_category":"Done","pull_request":2685},{"issue_id":"21453","title":"create_resources auto importing a manifest with a syntax error produce a bad error message","url":"https://tickets.puppetlabs.com/browse/PUP-1100","created_at":"2013-12-16T11:45:44.000-0800","number":"PUP-1100","body":"Given a module with this structure:\r\n\r\n{noformat}\r\nx\r\n└── manifests\r\n    ├── init.pp\r\n    └── y.pp\r\n{noformat}\r\n\r\ninit.pp:\r\n{noformat}\r\nclass x {\r\n    $r = {\"one\" => {\"foo\" => \"bar\"}}\r\n\r\n    create_resources(\"x::y\", $r)\r\n}\r\n{noformat}\r\n\r\nand y.pp which has an obvious syntax error:\r\n\r\n{code}\r\ndefine x::y {\r\n    obvious error should be obvious\r\n}\r\n{code}\r\n\r\nI get the following error:\r\n\r\n{noformat}\r\n% puppet apply --modulepath=`pwd` -e 'include x'\r\nError: exception object expected at /home/rip/temp/x/manifests/init.pp:4 on node devco.net\r\nWrapped exception:\r\nexception object expected\r\nError: exception object expected at /home/rip/temp/x/manifests/init.pp:4 on node devco.net\r\n{noformat}\r\n\r\nWhat's happening here is the y.pp only gets imported during the processing of create_resources and inside create_resources the parse error is incorrectly handled. \r\n\r\nIn this case the following code:\r\n\r\n{code}\r\n  begin\r\n    resource.safeevaluate(self)\r\n  rescue Puppet::ParseError => internal_error\r\n    raise internal_error.original\r\n  end\r\n{code}\r\n\r\nhas a nil for original in the internal_error object and so it fails.\r\n","closed_at":"2019-04-04T22:30:58.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1100","labels":"redmine","state":"Closed","updated_at":"2019-04-04T22:30:58.000-0700","timestamp":1652285978.722215,"priority":"Normal","status_category":"Done","pull_request":8556},{"issue_id":"54842","title":"Puppet::Node::Facts allows a fact named 'trusted' that collides with the reserved top scope puppet variable name 'trusted'.","url":"https://tickets.puppetlabs.com/browse/PUP-3449","created_at":"2014-10-13T10:36:43.000-0700","number":"PUP-3449","body":"There is a top scope variable named 'trusted' which is reserved by the compiler for the trusted data that the server gathers from the request's certificate.  A node's facts are also made available as top scope variables during puppet execution, and if the node has a 'trusted' fact, either created by the user, or retrieved from a node terminus like PuppetDB which stores the trusted data collected by the master for that node as 'trusted', then an \"Attempt to assign to a reserved variable name\" error is raised by the compiler: https://github.com/puppetlabs/puppet/blob/master/lib/puppet/parser/scope.rb#L629\r\n\r\n","closed_at":"2019-04-04T22:31:00.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3449","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:00.000-0700","timestamp":1652285994.100266,"priority":"Normal","status_category":"Done","pull_request":3190},{"issue_id":"52249","title":"Changes to environment.conf are not being picked up, even when environment timeout is set to 0.","url":"https://tickets.puppetlabs.com/browse/PUP-3334","created_at":"2014-09-23T17:39:33.000-0700","number":"PUP-3334","body":"I haven't tracked down all the details here, but [~adrien] noticed that changes to a directory environment's environment.conf are not being reloaded, even when environment_timeout is 0.","closed_at":"2019-04-04T22:31:00.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3334","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:00.000-0700","timestamp":1652285994.204487,"priority":"Normal","status_category":"Done","pull_request":3197},{"issue_id":"50365","title":"\"each\" no longer supported in Puppet 3.7.0","url":"https://tickets.puppetlabs.com/browse/PUP-3190","created_at":"2014-09-05T12:32:51.000-0700","number":"PUP-3190","body":"After upgrading to Puppet 3.7.0, the puppetmaster no longer\r\nrecognizes the \"each\" keyword.  It prints this in the log:\r\n\r\n{noformat}\r\nSep  5 19:22:56 minicfg2 puppet-master[11897]: each() is only available when parser/evaluator future is in effect on node buildhost1.lysator.liu.se\r\n{noformat}\r\n\r\nThe /etc/puppet/puppet.conf on the puppetmaster host looks like this:\r\n\r\n{noformat}\r\n[main]\r\n  logdir = /var/log/puppet\r\n  vardir = /var/lib/puppet\r\n  ssldir = /var/lib/puppet/ssl\r\n  rundir = /var/run/puppet\r\n  factpath = $vardir/lib/facter\r\n  templatedir = $confdir/templates\r\n  server = minicfg2.lysator.liu.se\r\n  environment = production\r\n\r\n[agent]\r\n  report = true\r\n\r\n[master]\r\n  modulepath=/etc/puppet/environs/$environment/modules:/etc/puppet/environs/$environment/services:/etc/puppet/environ\r\ns/$environment/forge\r\n  manifest=/etc/puppet/environs/$environment/manifests/\r\n  storeconfigs = true\r\n  storeconfigs_backend = puppetdb\r\n  reports = store,rrdgraph,nagiosupdate\r\n  rrddir = /var/www/puppet-rrd\r\n  parser = future\r\n\r\n  # These are needed when the puppetmaster is run by passenger\r\n  # and can safely be removed if webrick is used.\r\n  ssl_client_header = SSL_CLIENT_S_DN\r\n  ssl_client_verify_header = SSL_CLIENT_VERIFY\r\n{noformat}\r\n\r\n(I have changed the hostnames.)\r\n\r\nOn the clients, the file looks like:\r\n\r\n{noformat}\r\n[main]\r\n  logdir = /var/log/puppet\r\n  vardir = /var/lib/puppet\r\n  ssldir = /var/lib/puppet/ssl\r\n  rundir = /var/run/puppet\r\n  factpath = $vardir/lib/facter\r\n  templatedir = $confdir/templates\r\n  server = minicfg2.lysator.liu.se\r\n  environment = production\r\n\r\n[agent]\r\n  report = true\r\n{noformat}\r\n\r\nThis setup worked fine with Puppet 3.5 and 3.6.\r\n\r\nI have looked at https://docs.puppetlabs.com/puppet/latest/reference/experiments_future.html#enabling-the-future-parser to check if I need to do more nowadays to enable both the future parser and evaluator, but as far as I can tell it should still be enough to specify \"parser = future\" in the master section of puppet.conf.\r\n\r\n(I am aware that I'm using deprecated configuration-based environments, but they should still work until Puppet 4, right?)","closed_at":"2019-04-04T22:31:02.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3190","labels":"future-parser","state":"Closed","updated_at":"2019-04-04T22:31:02.000-0700","timestamp":1652285994.622889,"priority":"Blocker","status_category":"Done","pull_request":3058},{"issue_id":"19872","title":"3x functions do not know how to handle new data types","url":"https://tickets.puppetlabs.com/browse/PUP-910","created_at":"2013-12-01T17:43:15.000-0800","number":"PUP-910","body":"In the 4x evaluator there are new data types that logic written for 3x does not know how to handle; these are the types in the type system, and regular expressions.\r\n\r\nThe evaluator currently converts these to 3x representations when assigning such values to resources but they are passed around otherwise (assigned to variables in scope), sent to functions etc.\r\n\r\nThe main issue is when functions are called with the new types of values. Primarily resource references such as File['foo'], or a Class[bar]. \r\n\r\nOne solution is to mark functions that are aware of 4x and convert the arguments to 3x compatible types for all other. Alternatively, ignore the issue as existing code typically do not pass resource references around, nor regular expressions (since they cannot be created by the 3x parser).\r\n\r\nThe downside of doing value conversion is that Numeric data may have to be converted to String (it is currently passed through to resources). (It is a bummer that type/resource references have to be strings - this is something to solve later with proper data types in resource types).","closed_at":"2019-04-04T22:31:02.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-910","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:02.000-0700","timestamp":1652285994.833223,"priority":"Normal","status_category":"Done","pull_request":7709},{"issue_id":"13488","title":"create_resources ignores exec type's command attribute","url":"https://tickets.puppetlabs.com/browse/PUP-256","created_at":"2013-08-19T17:38:00.000-0700","number":"PUP-256","body":null,"closed_at":"2019-04-04T22:31:02.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-256","labels":"","state":"Resolved","updated_at":"2019-04-04T22:31:02.000-0700","timestamp":1652285994.935174,"priority":"Major","status_category":"Done","pull_request":3379},{"issue_id":"14924","title":"Users reporting b64_zlib_yaml errors with 3.3.0","url":"https://tickets.puppetlabs.com/browse/PUP-384","created_at":"2013-09-18T16:01:43.000-0700","number":"PUP-384","body":"Per this puppet-users topic https://groups.google.com/forum/#!topic/puppet-users/ujRKmWtfHUA\n\nSome users are reporting errors retrieving catalogs. The log snippets seem to indicate one too many or one too few levels of urlencoding.\n\n\n\n","closed_at":"2019-04-04T22:31:03.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-384","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:03.000-0700","timestamp":1652285995.035304,"priority":"Blocker","status_category":"Done","pull_request":3484},{"issue_id":"50616","title":"Validation thinks that an Undef instance is of type Runtime","url":"https://tickets.puppetlabs.com/browse/PUP-3201","created_at":"2014-09-08T23:01:10.000-0700","number":"PUP-3201","body":"Create a define like this:\r\n{noformat}\r\ndefine hey(String $x) { notice $x }\r\n{noformat}\r\nCall it like this:\r\n{noformat}\r\nhey{'heyer': x => undef }\r\n{noformat}\r\nGet the somewhat unexpected error:\r\n{noformat}\r\nExpected parameter 'x' of 'Hey[heyer]' to have type String, got Runtime[ruby, Symbol]\r\n{noformat}\r\n\r\n","closed_at":"2019-04-04T22:31:03.000-0700","comments":17,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3201","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:03.000-0700","timestamp":1652285995.343605,"priority":"Normal","status_category":"Done","pull_request":3210},{"issue_id":"41275","title":"creating a resource override for a Class fails (future parser)","url":"https://tickets.puppetlabs.com/browse/PUP-2891","created_at":"2014-07-03T14:54:01.000-0700","number":"PUP-2891","body":"{code}\r\nClass[a] { x => 'the default' }\r\n{code}\r\nResults in the error:\r\n{code}\r\nError: Evaluation Error: Error while evaluating a Resource Override, undefined method `type_name' for Puppet::Pops::Types::PHostClassType:Puppet::Pops::Types::PHostClassType at /Users/henrik/git/puppet/bar.pp:4:1 on node henriks-macbook-pro.local\r\n/Users/henrik/git/puppet/lib/puppet/pops/evaluator/runtime3_support.rb:331:in `block in create_resource_overrides'\r\n{code}\r\n\r\nThe method in question should detect that a PHostClassType is given and use the type_name \"class\".\r\n","closed_at":"2019-04-04T22:31:04.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2891","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:04.000-0700","timestamp":1652285995.44803,"priority":"Normal","status_category":"Done","pull_request":2845},{"issue_id":"11590","title":"Remove relative namespacing","url":"https://tickets.puppetlabs.com/browse/PUP-121","created_at":"2013-07-01T17:55:44.000-0700","number":"PUP-121","body":"This is the issue where `include apache` actually means “try to declare class `<current namespace>::apache`, class `<parent of current namespace>::apache`, and so on, eventually declaring `apache` as a last resort.\" \r\n\r\nThis bites people in the wild frequently, and seem to be getting a steady stream of customer complaints about it. \r\n\r\nWe seem to have nearly universal agreement that this isn't how Puppet should work, but fixing it will break code in the wild. In redmine #2053, I suggested a deprecation plan:\r\n\r\n* In a mid-stream 3.x release, we start logging warnings when relative namespacing finds a class that doesn't match the provided name, and provide a setting to turn on a \"strict mode\" that kills relative namespacing completely.\r\n* In 4.0, we make the strict mode the only mode.","closed_at":"2019-04-04T22:31:04.000-0700","comments":17,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-121","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:04.000-0700","timestamp":1652285995.760593,"priority":"Major","status_category":"Done","pull_request":2229},{"issue_id":"32545","title":"Future parser does not error on import statements","url":"https://tickets.puppetlabs.com/browse/PUP-2317","created_at":"2014-04-22T00:10:09.000-0700","number":"PUP-2317","body":"Puppet 3.5.1 with Future parser enabled does not fail on import statements. When parser is set to current it correctly warns the user that import is deprecated.","closed_at":"2019-04-04T22:31:05.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2317","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:05.000-0700","timestamp":1652285995.973093,"priority":"Critical","status_category":"Done","pull_request":2573},{"issue_id":"21207","title":"filter function should accept two parameters","url":"https://tickets.puppetlabs.com/browse/PUP-1029","created_at":"2013-12-15T17:55:40.000-0800","number":"PUP-1029","body":"The filter function should accept two keys for all LHS types; key/value, or index/value to make it consistent with each and map.","closed_at":"2019-04-04T22:31:05.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1029","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:05.000-0700","timestamp":1652285996.083093,"priority":"Normal","status_category":"Done","pull_request":8095},{"issue_id":"13719","title":"ENC can't declare any classes that are declared by Puppet","url":"https://tickets.puppetlabs.com/browse/PUP-268","created_at":"2013-08-27T17:08:35.000-0700","number":"PUP-268","body":"If an ENC uses the class parameter format to return its results, Puppet will declare *all* those classes as resources (even if none of them actually have parameters). This means that if the ENC declares a class which is declared elsewhere in Puppet (even if it's just included), compilation will fail. Because the Console now always uses the class parameter format, classifying a node in Console with any class which is already included either in site.pp or by some other class will fail.","closed_at":"2019-04-04T22:31:07.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-268","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:07.000-0700","timestamp":1652285996.715047,"priority":"Major","status_category":"Done","pull_request":2712},{"issue_id":"48757","title":"Puppet module generate - dependency problem","url":"https://tickets.puppetlabs.com/browse/PUP-3121","created_at":"2014-08-21T02:14:57.000-0700","number":"PUP-3121","body":"Puppet will generate module, which reports dependency problem when listed.\r\n\r\nGenerate module:\r\npuppet module generate bla-bla\r\n\r\nBuild module:\r\npuppet module build bla-bla\r\n\r\nInstall module (It will correctly install stdlib dependency):\r\npuppet module install /root/bla-bla/pkg/bla-bla-0.1.0.tar.gz\r\n\r\nList modules (It will report missing dependency):\r\n[root@puppet7 ~]$ puppet module list\r\nWarning: Missing dependency 'puppetlabs-stdlib':\r\n  'bla-bla' (v0.1.0) requires 'puppetlabs-stdlib' (>= 0.0.0)\r\n/etc/puppet/modules\r\n├── bla-bla (v0.1.0)\r\n└── puppetlabs-stdlib (v4.3.2)\r\n/usr/share/puppet/modules (no modules installed)\r\n\r\nPossible fix is to  replace '-' with '/' in dependency part of module metadata:\r\nsed -i -e 's|puppetlabs-stdlib|puppetlabs/stdlib|' bla-bla/metadata.json\r\n\r\nThen It doesn't report anything after rebuilding and reinstalling the module. \r\n","closed_at":"2019-04-04T22:31:08.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3121","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:08.000-0700","timestamp":1652285997.027889,"priority":"Normal","status_category":"Done","pull_request":3152},{"issue_id":"51343","title":"puppet apply + ENC + 3.7.x: does not read the .pp file","url":"https://tickets.puppetlabs.com/browse/PUP-3258","created_at":"2014-09-16T09:01:48.000-0700","number":"PUP-3258","body":"Running 'puppet apply' with an ENC and a .pp file on the command line (full example supplied): at 3.6.1, the 'notice's in the .pp file are executed; at 3.7.x, they are not.  'puppet agent' 3.7.x does the right thing (same as 3.6.1).\r\n\r\nSee the README file in the attached .tar.gz (a complete example).  I ran './vapply --noop' (it needed sudo in my case; maybe not for you).\r\n\r\nI have no idea on the possible cause; maybe I missed something.","closed_at":"2019-04-04T22:31:08.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3258","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:08.000-0700","timestamp":1652285997.135038,"priority":"Normal","status_category":"Done","pull_request":3144},{"issue_id":"28871","title":"Using undefined variable as class parameter default fails in future evaluator","url":"https://tickets.puppetlabs.com/browse/PUP-1964","created_at":"2014-03-17T11:39:21.000-0700","number":"PUP-1964","body":"The following manifest fails in the future evaluator:\r\n\r\n{code}\r\nclass a ($b=$x) {notify{$b:}}\r\ninclude a\r\n{code}\r\n\r\nI get the following output (also not the lack of line numbers):\r\n\r\n{noformat}\r\nError: Evaluation Error: Error while evaluating a Function Call, Received incomplete information - no value provided for parameter b on node test.dalen.cloud.spotify.net\r\nError: Evaluation Error: Error while evaluating a Function Call, Received incomplete information - no value provided for parameter b on node test.dalen.cloud.spotify.net\r\n{noformat}\r\n\r\nIn the 3.x evaluator this prints undef as expected:\r\n\r\n{noformat}\r\nNotice: Compiled catalog for test.dalen.cloud.spotify.net in environment production in 0.06 seconds\r\nNotice: undef\r\nNotice: /Stage[main]/A/Notify[undef]/message: defined 'message' as 'undef'\r\nNotice: Finished catalog run in 0.02 seconds\r\n{noformat}","closed_at":"2019-04-04T22:31:10.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1964","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:10.000-0700","timestamp":1652285998.038148,"priority":"Normal","status_category":"Done","pull_request":2509},{"issue_id":"56034","title":"Future parser not showing line/column for error","url":"https://tickets.puppetlabs.com/browse/PUP-3514","created_at":"2014-10-23T06:05:41.000-0700","number":"PUP-3514","body":"We had a manifest that contains this:\r\n\r\n{code}\r\nFile ['/etc/pam.d/sshd'] {\r\n{code}\r\n\r\nObviously the space there is a mistake but the future parser gave me this back:\r\n\r\n{noformat}\r\nError: Could not parse for environment production: Expression is not valid as a resource, resource-default, or resource-override at (slice () 'file'):(slice () 'line'):(slice ([] '/etc/pam.d/sshd') 'pos')\r\n{noformat}\r\n\r\nI'm missing file, line and the message isn't particularly helpful.","closed_at":"2019-04-04T22:31:12.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3514","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:12.000-0700","timestamp":1652285998.679637,"priority":"Normal","status_category":"Done","pull_request":3233},{"issue_id":"34062","title":"module skeleton is using deprecated way to configure spec_helper","url":"https://tickets.puppetlabs.com/browse/PUP-2432","created_at":"2014-05-02T11:57:34.000-0700","number":"PUP-2432","body":"[~josh] states that we are using a deprecated method for configuring rspec","closed_at":"2019-04-04T22:31:13.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2432","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:13.000-0700","timestamp":1652285998.898117,"priority":"Normal","status_category":"Done","pull_request":2612},{"issue_id":"40284","title":"All concrete types do not inherit PAnyType","url":"https://tickets.puppetlabs.com/browse/PUP-2833","created_at":"2014-06-24T14:48:51.000-0700","number":"PUP-2833","body":"All concrete types in the type system should inherit from the PAnyType. Now, some types still inherit from the abstract PAbstractType.\r\n\r\nFor some reason this manages to work even if it is wrong. It should be corrected.","closed_at":"2019-04-04T22:31:13.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2833","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:13.000-0700","timestamp":1652285999.111798,"priority":"Normal","status_category":"Done","pull_request":2803},{"issue_id":"43511","title":"Implementation of +=/-= is potentially confusing","url":"https://tickets.puppetlabs.com/browse/PUP-2972","created_at":"2014-07-24T15:58:45.000-0700","number":"PUP-2972","body":"It seems to me that += and -= are more confusing than useful, and I would argue that they simply shouldn't exist.\r\n\r\nRight now (with \"--parser future\"), these operators implicitly create a new variable that may shadow one from an outer scope, appending/removing the RHS to the outer scope variable if it exists. If the variable has already been defined in the current scope, the operation fails.\r\n\r\nIn practice, this works like a kind of temporary mutation, or else it's just regular assignment, or else causes a failure. The alternative, using +/- with =, is more intuitive, less ambiguous, and sacrifices little if anything in terms of expressiveness.\r\n\r\nI apologize in advance if there's something major that I'm missing here, but I'd like to reopen the discussion on whether it's better to just remove these operators from the language.","closed_at":"2019-04-04T22:31:15.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2972","labels":"future-parser","state":"Closed","updated_at":"2019-04-04T22:31:15.000-0700","timestamp":1652285999.643215,"priority":"Normal","status_category":"Done","pull_request":2958},{"issue_id":"32342","title":"Puppet::Util::Execution.execute no longer returns a String","url":"https://tickets.puppetlabs.com/browse/PUP-2306","created_at":"2014-04-18T12:52:30.000-0700","number":"PUP-2306","body":"Commit 732d450 ( https://github.com/puppetlabs/puppet/commit/732d450 ) changed the return type of {{Puppet::Util::Execution.execute}} from a String, to a new string subclass {{Puppet::ProcessOutput}}.\r\n\r\nThis is not a fully backwards compatible change, and causes problems where things do strict type checking - for example, the {{chomp()}} function in stdlib.","closed_at":"2019-04-04T22:31:15.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2306","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:15.000-0700","timestamp":1652285999.748092,"priority":"Normal","status_category":"Done","pull_request":2559},{"issue_id":"52592","title":"Puppet Master Memory Leak","url":"https://tickets.puppetlabs.com/browse/PUP-3345","created_at":"2014-09-25T11:08:54.000-0700","number":"PUP-3345","body":"Starting with 3.7, the Puppet master process will allocate more and more memory until it is killed by the OOM process.  This occurs in about 24 hours in our environment.\r\n\r\nThe behaviour occurs in both Rack and WEBRick configurations.  In the Rack configuration the four Rack processes will grow until killed.   In WEBRick configuration the one puppet master process will grow.","closed_at":"2019-04-04T22:31:15.000-0700","comments":43,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3345","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:15.000-0700","timestamp":1652285999.861518,"priority":"Normal","status_category":"Done","pull_request":3188},{"issue_id":"28242","title":"URI.unescape mangles UTF-8 paths producing invalid ASCII strings","url":"https://tickets.puppetlabs.com/browse/PUP-1890","created_at":"2014-03-07T12:53:04.000-0800","number":"PUP-1890","body":"Hi, \r\n\r\nI am running a puppet server under Ubuntu 12.04 (Puppet 2.7.11) and a puppet client under Ubuntu 14.04 (Puppet 3.4.2). \r\n\r\nI am distributing a directory of ttf fonts from the server to the clients, the rule is\r\n\r\n      file{\"/usr/local/share/fonts/FreeFonts\":\r\n        ensure  => directory,\r\n        mode    => 0444,\r\n        recurse => true,\r\n        purge   => true,\r\n        source  => \"puppet:///modules/hadmut/soft/Daten/Fonts/Installation/FreeFonts\",\r\n      }\r\n\r\n\r\nThis works with a great number of font files, but fails with one particular font:\r\n\r\nError: Could not set 'file' on ensure: invalid byte sequence in US-ASCII\r\nError: Could not set 'file' on ensure: invalid byte sequence in US-ASCII\r\nWrapped exception:\r\ninvalid byte sequence in US-ASCII\r\nError: /Stage[main]/Hadmut::Application::X11_common/File[/usr/local/share/fonts/FreeFonts/Momоt___.ttf]/ensure: change from absent to file failed: Could not set 'file' on ensure: invalid byte sequence in US-ASCII\r\n\r\n\r\nFor some reason Puppet assumes that this is an US-ASCII text file, but it should treat this as a binary. \r\n\r\n\r\n\r\n","closed_at":"2019-04-04T22:31:17.000-0700","comments":21,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1890","labels":"customer;encoding;i18n;resolved-issue-added;support;utf-8","state":"Closed","updated_at":"2019-04-04T22:31:17.000-0700","timestamp":1652286000.298398,"priority":"Major","status_category":"Done","pull_request":5991},{"issue_id":"36788","title":"Increase environment_timeout default.","url":"https://tickets.puppetlabs.com/browse/PUP-2639","created_at":"2014-05-22T13:43:51.000-0700","number":"PUP-2639","body":"Current environment_timeout defaults to 5s, which is too quick for typically production catalog build.  It is essential that the timeout be longer than the typical catalog build time, and we want a default that will work reasonable well for general production cases.  Three minutes seems reasonable.\r\n\r\nThis fix should be cherry picked (or merged down if all stable is being merged) back to pe-puppet/3.3.x.","closed_at":"2019-04-04T22:31:20.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2639","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:20.000-0700","timestamp":1652286001.813048,"priority":"Normal","status_category":"Done","pull_request":2710},{"issue_id":"31321","title":"Accessing resource metaparameters fails in future evaluator","url":"https://tickets.puppetlabs.com/browse/PUP-2190","created_at":"2014-04-09T09:05:19.000-0700","number":"PUP-2190","body":"Accessing regular parameters works fine, and when accessing unknown ones you get a decent error message. But when trying to access metaparameters you get a bad internal error\r\n\r\n{code}\r\nnotify{foo:}\r\nnotify{Notify[foo][tag]:}\r\n{code}\r\n\r\nGives:\r\n\r\n{noformat}\r\nError: Evaluation Error: Error while evaluating a '[]' expression, undefined method `value' for nil:NilClass at line 1:33 on node 10.48.20.37.office.spotify.net\r\nError: Evaluation Error: Error while evaluating a '[]' expression, undefined method `value' for nil:NilClass at line 1:33 on node 10.48.20.37.office.spotify.net\r\n{noformat}","closed_at":"2019-04-04T22:31:22.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2190","labels":"future-parser","state":"Closed","updated_at":"2019-04-04T22:31:22.000-0700","timestamp":1652286002.343186,"priority":"Normal","status_category":"Done","pull_request":2534},{"issue_id":"19735","title":"Too easy to hit \"CRL not yet valid for <host>\" (and not very informative)","url":"https://tickets.puppetlabs.com/browse/PUP-894","created_at":"2013-11-26T13:54:59.000-0800","number":"PUP-894","body":"Currently we set the CRL time range to start at 1 second in the past:\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/a8311df5438601a3394d38e37f671626969d50db/lib/puppet/ssl/certificate_revocation_list.rb#L85\r\n\r\nHowever, this creates a window where an agent with a small amount of clock skew can hit the `CRL not yet valid for <host>` message.  This affects both acceptance tests, which sometimes hit [this condition|https://jenkins.puppetlabs.com/job/Puppet-Package-Acceptance-stable/127/label=acc-coord,platform=precise/consoleText] and [end-users|http://www.jethrocarr.com/2013/10/20/puppet-crl-time-errors/].\r\n\r\nWe should do something about this.  Suggestion here is to: a) bump the 1 second to 1 minute, and b) catch this error message out of OpenSSL and wordsmith it a bit to hint at addressing clock skew.","closed_at":"2019-04-04T22:31:22.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-894","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:22.000-0700","timestamp":1652286002.451518,"priority":"Normal","status_category":"Done","pull_request":7633},{"issue_id":"20304","title":"add support for enumerable type(s) in all iterative functions","url":"https://tickets.puppetlabs.com/browse/PUP-939","created_at":"2013-12-05T10:52:19.000-0800","number":"PUP-939","body":"Currently, only the each function supports iterating over an enumerable type (currently only Integer). Add this support to filter, map, and select as well.","closed_at":"2019-04-04T22:31:22.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-939","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:22.000-0700","timestamp":1652286002.557873,"priority":"Normal","status_category":"Done","pull_request":7872},{"issue_id":"53661","title":"Significant delay in puppet runs with growing numbers of directory environments","url":"https://tickets.puppetlabs.com/browse/PUP-3389","created_at":"2014-10-06T07:38:07.000-0700","number":"PUP-3389","body":"When using directory environments there appears to be significant lag at the start of a puppet *agent* run whilst the agent startup explores the environment path.\r\n\r\nWith 576 directory environments, each is statted 1159 times during puppet agent startup (one of the stats is opening the environment.conf) - having straced the puppet run:\r\n\r\n{{# grep -c cda_core_0_4_70 puppet.txt}}\r\n{{1160}}\r\n\r\nThis causes significant delay in run startup - circa 20s.\r\n\r\nThe agent also attempts to open an environment.conf in each environment whilst doing this (and I'm not sure this is necessary either) though this only happens 1162 times","closed_at":"2019-04-04T22:31:23.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3389","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:23.000-0700","timestamp":1652286002.883615,"priority":"Normal","status_category":"Done","pull_request":3386},{"issue_id":"63031","title":"Modify file_bucket_file API to use \"application/octet-stream\" instead of \"text/plain\" for Content-Type","url":"https://tickets.puppetlabs.com/browse/PUP-3812","created_at":"2015-01-06T08:32:19.000-0800","number":"PUP-3812","body":"The Puppet file_bucket_file API -- https://docs.puppetlabs.com/guides/rest_api.html#file-bucket -- requires a PUT request for a file to include a Content-Type of \"text/plain\".  Puppet agent and file_bucket_file requests through the puppet filebucket CLI face also do not include a charset along with the Content-Type.  Per various industry specifications -- see https://tools.ietf.org/html/rfc6657 in particular -- the default charset that a receiver should assume for this case would be either US-ASCII or ISO-8859-1.  Puppet agent and filebucket CLI face requests, however, currently format the request body as raw \"binary data\".  This is incompatible with the US-ASCII and ISO-8859-1 formats.\r\n\r\nIn order to make the client's intentions about the request body encoding more clear, it would be better for clients to include a Content-Type of \"application/octet-stream\".\r\n\r\n[~josh] suggested that we could create a new format called \":binary\", map that to \"application/octet-stream\", and change file_bucket/file to use it.  Here are some relevant locations in the code where this could be done:\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/master/lib/puppet/network/formats.rb#L65\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/master/lib/puppet/file_bucket/file.rb#L16-L27\r\n\r\nDepending upon how we would do this, it may need to be done on a major version boundary.  If the master were upgraded to accept \"application/octet-stream\" while still treating \"text/plain\" as \"binary\" initially, backward compatibility would be preserved.  At some point, though, it may make sense to just break compatibility for \"text/plain\" on file_bucket/file altogether as the current implementation is ambiguous and not in alignment with industry standards.\r\n\r\nh3.QA:\r\nRisk Assessment: Low?  Issue didn't reproduce after all.","closed_at":"2019-04-04T22:31:24.000-0700","comments":19,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3812","labels":"","state":"Resolved","updated_at":"2019-04-04T22:31:24.000-0700","timestamp":1652286003.425997,"priority":"Normal","status_category":"Done","pull_request":3582},{"issue_id":"49950","title":"Resource titles ending with square brackets fail","url":"https://tickets.puppetlabs.com/browse/PUP-3177","created_at":"2014-09-03T04:55:50.000-0700","number":"PUP-3177","body":"Hi,\r\n\r\nWe're trying to install a package but the title has got square brackets which seems to make Puppet blow up, for example:\r\n\r\n  package { \"Windows Server AppFabric v1.1 CU4 [KB 2800726]\":\r\n    ensure          => installed,\r\n    source          => $fullInstallerPath,\r\n    install_options => $install_options,\r\n  }  \r\n\r\nTrying to run this results in error \"invalid tag\".  We've tried escaping the brackets but that doesn't work either.\r\n\r\nEven running puppet resource form the command prompt gives an error:\r\n\r\nC:\\Program Files (x86)\\Puppet Labs\\Puppet\\bin>puppet resource package\r\nError: Could not run: Invalid tag \"microsoft sql server 2005 compact edition \"\r\n\r\nThe actual title in control panel for is \"microsoft sql server 2005 compact edition [ENU]\".  It would seem resource titles with square brackets cause issues.\r\n\r\nIs this is a bug in Puppet?  Can anyone suggest a work around as this kind of renders Puppet not very useful for us without being able to install products.\r\n\r\nPuppet agent 3.4.3\r\n\r\nThanks\r\n\r\nDan\r\n\r\nhttps://groups.google.com/forum/#!searchin/puppet-users/gibbons/puppet-users/Lv61sE-rdQU/r8XTRHU9mgAJ","closed_at":"2019-04-04T22:31:25.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3177","labels":"windows","state":"Closed","updated_at":"2019-04-04T22:31:25.000-0700","timestamp":1652286003.744638,"priority":"Normal","status_category":"Done","pull_request":3055},{"issue_id":"50836","title":"\"{}\" in systemd service files cause services to fail to start","url":"https://tickets.puppetlabs.com/browse/PUP-3228","created_at":"2014-09-10T11:50:47.000-0700","number":"PUP-3228","body":"This prevents systemd from failing to interpret values correctly.  Variables enclosed as \"${}\" are interpreted by systemd literally.\r\n\r\nexamples\r\n---\r\n\"${PUPPETMASTER_EXTRA_OPTS}\":\r\n[root@c7 vagrant]# systemctl status puppetmaster\r\npuppetmaster.service - Puppet master\r\n   Loaded: loaded (/usr/lib/systemd/system/puppetmaster.service; disabled)\r\n   Active: failed (Result: exit-code) since Mon 2014-08-25 20:25:02 UTC; 40s ago\r\n  Process: 17658 ExecStart=/usr/bin/puppet master ${PUPPETMASTER_EXTRA_OPTS} --no-daemonize (code=exited, status=1/FAILURE)\r\n Main PID: 17658 (code=exited, status=1/FAILURE)\r\n\r\nAug 25 20:25:02 c7.hubspot.local systemd[1]: Started Puppet master.\r\nAug 25 20:25:02 c7.hubspot.local puppet[17658]: Error: Could not parse application options: invalid option: --config /etc/puppetmaster/puppet-vagrant.conf --logdest /var/log/puppetmaster.log\r\nAug 25 20:25:02 c7.hubspot.local systemd[1]: puppetmaster.service: main process exited, code=exited, status=1/FAILURE\r\nAug 25 20:25:02 c7.hubspot.local systemd[1]: Unit puppetmaster.service entered failed state.\r\n\r\n---\r\n\"$PUPPETMASTER_EXTRA_OPTS\"\r\n[root@c7 vagrant]# systemctl status puppetmaster\r\npuppetmaster.service - Puppet master\r\n   Loaded: loaded (/usr/lib/systemd/system/puppetmaster.service; disabled)\r\n   Active: active (running) since Mon 2014-08-25 20:26:47 UTC; 4s ago\r\n Main PID: 17873 (puppet)\r\n   CGroup: /system.slice/puppetmaster.service\r\n           └─17873 /usr/bin/ruby /usr/bin/puppet master --config /etc/puppetmaster/puppet-vagrant.conf --logdest /var/log/puppetmaster.log --no-daemonize\r\n\r\nAug 25 20:26:47 c7.hubspot.local systemd[1]: Started Puppet master.","closed_at":"2019-04-04T22:31:26.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3228","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:26.000-0700","timestamp":1652286003.84946,"priority":"Normal","status_category":"Done","pull_request":4111},{"issue_id":"283437","title":"Text Fragmentation in Exception Message","url":"https://tickets.puppetlabs.com/browse/PUP-9300","created_at":"2018-11-01T16:24:03.000-0700","number":"PUP-9300","body":"In our localization tool (Transifex), I encountered the following text:\r\n\r\n\"Failed to send the %\\{control_signal} signal to the service. Its current state is %\\{current_state}. Failed with\"\r\n\r\n*A localizable string should be a complete phrase.*\r\n\r\nI found the string in puppet.pot and then tracked it to this file:\r\n\r\n[https://github.com/puppetlabs/puppet/blob/master/lib/puppet/util/windows/service.rb#L719]\r\n\r\nFrom looking at the code, this text is an exception message.\r\n\r\n--- \r\n\r\nHere are two possible resolutions:\r\n\r\n1) Add placeholder to string \"\r\n\r\n\"Failed to send the %\\{control_signal} signal to the service. Its current state is %\\{current_state}. Failed with %\\{more_info}\"\r\n\r\n2) Remove \"Failed with\" from the string\r\n\r\n\"Failed to send the %\\{control_signal} signal to the service. Its current state is %\\{current_state}. \"\r\n\r\n—\r\n\r\nIf we go with resolution #1, 1 string resource will have to be changed and code will have to be changed (minor).\r\n\r\nIf we go with resolution #2, 2 string resources will have to be changed.\r\n\r\nCan you point me where the exception catcher code is?\r\n\r\n ","closed_at":"2019-04-04T22:31:26.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9300","labels":"L10n;i18n","state":"Closed","updated_at":"2019-04-04T22:31:26.000-0700","timestamp":1652286004.061637,"priority":"Normal","status_category":"Done","pull_request":7240},{"issue_id":"11447","title":"Remove the need for the anchor pattern","url":"https://tickets.puppetlabs.com/browse/PUP-99","created_at":"2013-06-25T21:52:25.000-0700","number":"PUP-99","body":"This is basically a duplicate of redmine issue #[8040][1].\n\nPinterest estimated that they spend about 75% of their puppet-related development time trying to work around ordering issues and determinism.  They attribute the majority of that to the \"anchor pattern\", which is also discussed [here][2].\n\nSite notes detailing Pinterest's feedback around this and other related issues can be found [here][3] and [here][4].\n\nIf this has already been captured in JIRA, please feel free to mark this as a dupe.\n\n  [1]: http://projects.puppetlabs.com/issues/8040\n  [2]: http://projects.puppetlabs.com/projects/puppet/wiki/Anchor_Pattern\n  [3]: https://sites.google.com/a/puppetlabs.com/main/home/trip-reports/luke-kanies/meetingwithpinterestautoscalingandordering\n  [4]: https://sites.google.com/a/puppetlabs.com/main/home/trip-reports/engineering/20130620pinterest","closed_at":"2019-04-04T22:31:26.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-99","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:26.000-0700","timestamp":1652286004.167778,"priority":"Critical","status_category":"Done","pull_request":7664},{"issue_id":"25016","title":"V2.0 API shows the message body in the Reason-Phrase","url":"https://tickets.puppetlabs.com/browse/PUP-1549","created_at":"2014-01-30T11:21:17.000-0800","number":"PUP-1549","body":"The v2.0 api is responding to error conditions with the reason phrase in the response (the section after the reason code) containing the full body of the response. The reason phrase is not required to be the standard reason phrase text (such as Not Found for a 404 response), but putting the full body in there is definitely not right.\r\n\r\nI think the correct fix is to just use the standard reason phrases. See http://www.w3.org/Protocols/rfc2616/rfc2616-sec6.html#sec6","closed_at":"2019-04-04T22:31:27.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1549","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:27.000-0700","timestamp":1652286004.594073,"priority":"Normal","status_category":"Done","pull_request":2315},{"issue_id":"18209","title":"Qualified variable lookups are very slow under Puppet 2.7+ unless prefixed with ::","url":"https://tickets.puppetlabs.com/browse/PUP-659","created_at":"2013-11-04T19:31:29.000-0800","number":"PUP-659","body":"This ticket concerns a performance regression that occurs when variable lookups are qualified as suggested by the [language documentation|http://docs.puppetlabs.com/puppet/3/reference/lang_variables.html#naming]:\r\n\r\n{quote}\r\nQualified variable names are prefixed with the name of their scope and the `::` (double colon) namespace separator. (For example, the `$vhostdir` variable from the `apache::params` class would be `$apache::params::vhostdir`.)\r\n{quote}\r\n\r\nThe regression affects the 3.x and 2.7.x branches of Puppet.\r\n\r\nConsider the following node definitions in `site.pp`:\r\n\r\n{code}\r\nnode badnode {\r\n  include 'tst_lookup::badclass'\r\n}\r\n\r\nnode goodnode {\r\n  include 'tst_lookup::goodclass'\r\n}\r\n{code}\r\n\r\nThese definitions reference a `tst_lookup` module with the following `params` class:\r\n\r\n{code}\r\nclass tst_lookup::params {\r\n  $basedir = '/tmp/type_collection_tst'\r\n  $user = 'tstusr'\r\n  $ugroup = 'tstugroup'\r\n}\r\n{code}\r\n\r\n`tst_lookup::goodclass` and `tst_lookup::badclass` are defined by ERB templates that generate 1000 file resources each referencing variables in `tst_lookup::params`. `badclass` references the variables in the manner suggested by the docs linked above. `goodclass` adds a leading `::` to the variable references.\r\n\r\n{code}\r\n# badclass.pp.erb\r\nclass tst_lookup::badclass {\r\n  include tst_lookup::params\r\n\r\n  group { \"${tst_lookup::params::ugroup}\":\r\n    ensure => present,\r\n  }\r\n\r\n  user { \"${tst_lookup::params::user}\":\r\n    ensure => present,\r\n    gid    => $tst_lookup::params::ugroup,\r\n  }\r\n\r\n  file { \"${tst_lookup::params::basedir}\":\r\n    ensure  => directory,\r\n    owner   => $tst_lookup::params::user,\r\n    group   => $tst_lookup::params::ugroup,\r\n  }\r\n\r\n<% (1..1000).to_a.each do |i| %>\r\n  file{ \"${tst_lookup::params::basedir}/file_<%= i %>\":\r\n    ensure  => file,\r\n    content => \"This is a test file.\\n\",\r\n    owner   => $tst_lookup::params::user,\r\n    group   => $tst_lookup::params::ugroup,\r\n    require => File[\"${tst_lookup::params::basedir}\"],\r\n  }\r\n\r\n<% end %>\r\n}\r\n{code}\r\n\r\n{code}\r\n# goodclass.pp.erb\r\nclass tst_lookup::goodclass {\r\n  include tst_lookup::params\r\n\r\n  group { \"${::tst_lookup::params::ugroup}\":\r\n    ensure => present,\r\n  }\r\n\r\n  user { \"${::tst_lookup::params::user}\":\r\n    ensure => present,\r\n    gid    => $::tst_lookup::params::ugroup,\r\n  }\r\n\r\n  file { \"${::tst_lookup::params::basedir}\":\r\n    ensure  => directory,\r\n    owner   => $::tst_lookup::params::user,\r\n    group   => $::tst_lookup::params::ugroup,\r\n  }\r\n\r\n<% (1..1000).to_a.each do |i| %>\r\n  file{ \"${::tst_lookup::params::basedir}/file_<%= i %>\":\r\n    ensure  => file,\r\n    content => \"This is a test file.\\n\",\r\n    owner   => $::tst_lookup::params::user,\r\n    group   => $::tst_lookup::params::ugroup,\r\n    require => File[\"${::tst_lookup::params::basedir}\"],\r\n  }\r\n\r\n<% end %>\r\n}\r\n{code}\r\n\r\nThese templates can be turned into an actual Puppet manifests via:\r\n\r\n{code}\r\nerb badclass.pp.erb > badclass.pp\r\nerb goodclass.pp.erb > goodclass.pp\r\n{code}\r\n\r\n(A pre-built module is also attached to this ticket.)\r\n\r\n\r\nThe performance characteristics of each class can be observed using the `puppet master --compile` command.\r\n\r\n## 3.x\r\n\r\n{code}\r\n# puppet --version\r\n3.3.1\r\n\r\n# time puppet master --compile badnode 2>&1 | grep 'Compiled catalog for'                                                                     \r\nNotice: Compiled catalog for badnode in environment production in 19.65 seconds\r\n\r\n# puppet master --compile goodnode 2>&1 | grep 'Compiled catalog for'                                                                         \r\nNotice: Compiled catalog for goodnode in environment production in 3.64 seconds\r\n{code}\r\n\r\n## 2.7.x\r\n\r\n{code}\r\n# puppet --version\r\n2.7.23\r\n\r\n# puppet master --compile badnode 2>&1 | grep 'Compiled catalog for'\r\nnotice: Compiled catalog for badnode in environment production in 67.04 seconds\r\n\r\n# puppet master --compile goodnode 2>&1 | grep 'Compiled catalog for'\r\nnotice: Compiled catalog for goodnode in environment production in 4.89 seconds\r\n{code}\r\n\r\n## 2.6.x\r\n\r\n{code}\r\n# puppet --version\r\n2.6.18\r\n\r\n# puppet master --compile badnode 2>&1 | grep 'Compiled catalog for'                                                                          \r\nnotice: Compiled catalog for badnode in environment production in 3.49 seconds\r\n\r\n# puppet master --compile goodnode 2>&1 | grep 'Compiled catalog for'                                                                         \r\nnotice: Compiled catalog for goodnode in environment production in 3.45 seconds\r\n{code}\r\n\r\nThe performance regression appears to be due to the [resolve_namespaces method in typeloader.rb|https://github.com/puppetlabs/puppet/blob/3.3.1/lib/puppet/resource/type_collection.rb#L164-L197]. This method constructs a list of namespaces to search, starting with the local scope and proceeds to add namespace components until it reaches global scope. This method was added in [6b1dd81|https://github.com/puppetlabs/puppet/commit/6b1dd81799a44288287d9ab0cdf46afa3aaf090a] to address #4472 and #4483 --- but the behavior implemented is probably obsolete given the retirement of dynamic scope.\r\n\r\nSome examples of the behavior of `resolve_namespaces` under 3.3.x:\r\n\r\nSearching for {{$::tst_lookup::params}} in {{class tst_lookup::goodclass}} searches {{[\"tst_lookup::params\"]}} and takes ~3 seconds for 4006 variable lookups.\r\n\r\nSearching for {{$tst_lookup::params}} in {{class tst_lookup::badclass}} searches {{[\"tst_lookup::badclass::tst_lookup::params\",\"tst_lookup::tst_lookup::params\",\"tst_lookup::params\"]}} and takes ~20 seconds for 4006 variable lookups.\r\n\r\nSearching for `$tst_lookup::params` in `class tst_lookup::foo::worseclass` searches {{[\"tst_lookup::foo::worseclass::tst_lookup::params\",\"tst_lookup::foo::tst_lookup::params\",\"tst_lookup::tst_lookup::params\",\"tst_lookup::params\"]}} and takes ~33 seconds for 4006 variable lookups.\r\n","closed_at":"2019-04-04T22:31:27.000-0700","comments":20,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-659","labels":"qa-reviewed;redmine","state":"Closed","updated_at":"2019-04-04T22:31:27.000-0700","timestamp":1652286004.704165,"priority":"Normal","status_category":"Done","pull_request":3359},{"issue_id":"16414","title":"NetApp network device failing with Puppet >3.2.1 - \"Could not intern...\"","url":"https://tickets.puppetlabs.com/browse/PUP-534","created_at":"2013-10-08T11:20:27.000-0700","number":"PUP-534","body":null,"closed_at":"2019-04-04T22:31:28.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-534","labels":"","state":"Resolved","updated_at":"2019-04-04T22:31:28.000-0700","timestamp":1652286017.504138,"priority":"Normal","status_category":"Done","pull_request":4341},{"issue_id":"119222","title":"Systemd  service provider do not support custom status command","url":"https://tickets.puppetlabs.com/browse/PUP-5992","created_at":"2016-02-29T21:02:14.000-0800","number":"PUP-5992","body":"When use puppet on systems that use systemd to manage services, it's not able to customize the status checking command. The systemd provider can only use systemctl is-active to check the service status. We need to support the ability to customize status command.\r\n\r\n\r\nFor example, I use puppet to manage ceph service on CentOS7, and I need to use command like `service ceph status mon` to check the service status of ceph monitor. But puppet only use `systemctl is-active mon` to check the service status regardless of the status parameter of service resource in my puppet code:\r\n\r\n\r\n{code:java}\r\nservice {\"ceph-mon\":\r\n  ensure  => running,\r\n  start   => \"service ceph start mon\",\r\n  stop    => \"service ceph stop mon\",\r\n  status  => \"service ceph status mon\",\r\n}\r\n{code}\r\n\r\nThe status parameter above never work correctly cause systemd provider only use `systemctl is-active` command.\r\n\r\n\r\n","closed_at":"2019-04-04T22:31:29.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5992","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:29.000-0700","timestamp":1652286017.609994,"priority":"Normal","status_category":"Done","pull_request":4737},{"issue_id":"49755","title":"Fix all file permissions on puppet module install","url":"https://tickets.puppetlabs.com/browse/PUP-3168","created_at":"2014-09-02T05:02:02.000-0700","number":"PUP-3168","body":"If module with broken file permissions is installed, only directory permissions are fixed. File permissions are just slightly modified. E.g.:\r\n\r\n{noformat}\r\n# puppet module install ceritsc-psacct\r\n{noformat}\r\n\r\nEnds up with fixed mode 755 on directories, but follows 400 (resp. 600) from module archive.\r\n\r\n{noformat}\r\n# ls -la /etc/puppet/modules/psacct/\r\ntotal 36\r\ndrwxr-xr-x. 4 root root 4096 Sep  2 11:20 .\r\ndrwxr-xr-x. 4 root root 4096 Sep  2 13:58 ..\r\n-r--------. 1 root root  296 Sep  2 11:16 CHANGELOG.md\r\n-r--------. 1 root root  571 Sep  2 11:20 checksums.json\r\n-r--------. 1 root root 1115 Jul  9 14:02 LICENSE\r\ndrwxr-xr-x. 2 root root 4096 Nov 12  2013 manifests\r\n-r--------. 1 root root 1152 Sep  2 11:20 metadata.json\r\n-r--------. 1 root root  820 Sep  2 11:20 README.md\r\ndrwxr-xr-x. 2 root root 4096 Jul 15  2013 tests\r\n{noformat}","closed_at":"2019-04-04T22:31:29.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3168","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:29.000-0700","timestamp":1652286018.146437,"priority":"Normal","status_category":"Done","pull_request":3533},{"issue_id":"19253","title":"Complete implementation of Location handling","url":"https://tickets.puppetlabs.com/browse/PUP-800","created_at":"2013-11-20T09:01:06.000-0800","number":"PUP-800","body":"Location handling is implemented differently in the new parser / evaluator. It does not currently pass this information correctly at the boundary new/3x. \r\n\r\nAlso look at PP-799 that suggests additional improvements to the Location handling. (A performance enhancement as well as support for serialization with preserved location information).\r\n\r\nThe current implementation fakes file/line/position information in certain transitions; look at PopsBridge, and 3x runtime support class.\r\n\r\nThere are very few complete location tests.","closed_at":"2019-04-04T22:31:30.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-800","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:30.000-0700","timestamp":1652286018.357601,"priority":"Normal","status_category":"Done","pull_request":7162},{"issue_id":"78954","title":"FreeBSD specific Service provider fix","url":"https://tickets.puppetlabs.com/browse/PUP-4530","created_at":"2015-05-06T04:38:02.000-0700","number":"PUP-4530","body":"The Service provider for FreeBSD parses the output of 'service foo rcvar' to work out what the service name is.   However for some services -- only a very few -- the output contains an optional 'description' field, leading to output like this:\r\n{code}\r\n% service local_unbound rcvar\r\n# local_unbound : local caching forwarding resolver\r\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n#\r\nlocal_unbound_enable=\"YES\"\r\n#   (default: \"\")\r\n\r\n{code}\r\nleading to the creation of a file whose name has embedded spaces and other syntactically significant stuff which prevents it being loaded by the rc.conf system:\r\n{code}\r\n% ls -1 /etc/rc.conf.d/ \r\nlocal_unbound : local caching forwarding resolver\r\nsnmpd\r\n{code}\r\n\r\nA simple fix is to take just the leading string of non-whitespace characters\r\nfrom the first line of the rcvar output as the service name:\r\n{code}\r\n% diff -u puppet-3.7.5/lib/puppet/provider/service/freebsd.rb{.orig,}\r\n--- puppet-3.7.5/lib/puppet/provider/service/freebsd.rb.orig    2015-03-25 16:32:47.000000000 +0000\r\n+++ puppet-3.7.5/lib/puppet/provider/service/freebsd.rb 2015-05-06 12:33:59.043029246 +0100\r\n@@ -39,7 +39,7 @@\r\n \r\n   # Extract service name\r\n   def service_name\r\n-    extract_value_name('service', 0, /# (.*)/, '\\1')\r\n+    extract_value_name('service', 0, /# (\\S*).*/, '\\1')\r\n   end\r\n \r\n   # Extract rcvar name\r\n{code}","closed_at":"2019-04-04T22:31:30.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4530","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:30.000-0700","timestamp":1652286018.464098,"priority":"Normal","status_category":"Done","pull_request":3928},{"issue_id":"76302","title":"Service with 'hasstatus => false' fails","url":"https://tickets.puppetlabs.com/browse/PUP-4431","created_at":"2015-04-17T03:42:04.000-0700","number":"PUP-4431","body":"The resource:\r\n{code}\r\nservice { 'nullmailer':\r\n    ensure     => running,\r\n    enable     => true,\r\n    hasstatus  => false,\r\n    hasrestart => true,\r\n    require    => Class['nullmailer::config'],\r\n  }\r\n{code}\r\n\r\nfails with the following error message:\r\n{code}\r\nError: /Stage[main]/Nullmailer::Service/Service[nullmailer]: Could not evaluate: private method `getpid' called for #<Puppet::Type::Service::ProviderDebian:0x00000004c74f58>\r\n{code}\r\n\r\n\r\n","closed_at":"2019-04-04T22:31:30.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4431","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:30.000-0700","timestamp":1652286018.78796,"priority":"Normal","status_category":"Done","pull_request":3951},{"issue_id":"59663","title":"puppet cert fingerprint invalidhost returns zero instead of non-zero","url":"https://tickets.puppetlabs.com/browse/PUP-3694","created_at":"2014-11-24T15:32:21.000-0800","number":"PUP-3694","body":"# puppet cert fingerprint notfound; echo $?\r\nError: Could not find certificate for notfound\r\n0\r\n\r\nThis should return 1 or another non-zero exist code since it does not exist.","closed_at":"2019-04-04T22:31:31.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3694","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:31.000-0700","timestamp":1652286018.900027,"priority":"Normal","status_category":"Done","pull_request":4116},{"issue_id":"76182","title":"Executable external facts broken in 4.0.0: not executable on agent","url":"https://tickets.puppetlabs.com/browse/PUP-4420","created_at":"2015-04-15T18:11:30.000-0700","number":"PUP-4420","body":"While investigating 3.x->4.x compatibility for SERVER-526 I tried to use an executable external fact, but this did not work in 4.0.0 (it worked in 3.7.5). The file is no longer executable on the agent side, so the agent run spits out a warning saying the fact file was parsed but returned an empty data set.\r\n\r\nWhen looking at the HTTP traffic for my executable external fact file, I see the file_metadata response does in fact specify a different mode between 3.7.5 and 4.0.0.\r\n\r\nBelow you'll find the request+response for the external fact - notice the {{mode}} is different in the responses.\r\n\r\n{code:title=3.7.5}\r\nREQUEST\r\nGET /production/file_metadatas/pluginfacts?links=manage&recurse=true&ignore=.svn&ignore=CVS&ignore=.git&checksum_type=md5 HTTP/1.1\r\nAccept: pson, msgpack, yaml, b64_zlib_yaml, raw\r\nAccept-Encoding: identity\r\nUser-Agent: Ruby\r\nHost: localhost:8666\r\n\r\nRESPONSE\r\nHTTP/1.1 200 OK \r\nX-Puppet-Version: 3.7.5\r\nContent-Type: text/pson\r\nServer: WEBrick/1.3.1 (Ruby/1.9.3/2014-11-13) OpenSSL/0.9.8za\r\nDate: Tue, 14 Apr 2015 23:49:29 GMT\r\nContent-Length: 696\r\nConnection: Keep-Alive\r\n\r\n[\r\n    {\r\n        \"document_type\": \"FileMetadata\",\r\n        \"data\": {\r\n            \"path\": \"\\/Users\\/nwolfe\\/workspace\\/puppetlabs\\/conf\\/master\\/v3\\/conf\\/modules\\/tmpfiles\\/facts.d\",\r\n            \"relative_path\": \".\",\r\n            \"links\": \"manage\",\r\n            \"owner\": 501,\r\n            \"group\": 20,\r\n            \"mode\": 493,\r\n            \"checksum\": {\r\n                \"type\": \"ctime\",\r\n                \"value\": \"{ctime}2015-04-14 16:31:21 -0700\"\r\n            },\r\n            \"type\": \"directory\",\r\n            \"destination\": null\r\n        },\r\n        \"metadata\": {\r\n            \"api_version\": 1\r\n        }\r\n    },\r\n    {\r\n        \"document_type\": \"FileMetadata\",\r\n        \"data\": {\r\n            \"path\": \"\\/Users\\/nwolfe\\/workspace\\/puppetlabs\\/conf\\/master\\/v3\\/conf\\/modules\\/tmpfiles\\/facts.d\",\r\n            \"relative_path\": \"external_fact_date\",\r\n            \"links\": \"manage\",\r\n            \"owner\": 501,\r\n            \"group\": 20,\r\n            \"mode\": 493,\r\n            \"checksum\": {\r\n                \"type\": \"md5\",\r\n                \"value\": \"{md5}abec184c543c4dadfa4bf4e70c0b3000\"\r\n            },\r\n            \"type\": \"file\",\r\n            \"destination\": null\r\n        },\r\n        \"metadata\": {\r\n            \"api_version\": 1\r\n        }\r\n    }\r\n]\r\n{code}\r\n\r\n{code:title=4.0.0}\r\nREQUEST\r\nGET /puppet/v3/file_metadatas/pluginfacts?environment=production&links=follow&recurse=true&ignore=.svn&ignore=CVS&ignore=.git&checksum_type=md5 HTTP/1.1\r\nAccept: pson, msgpack, yaml, binary\r\nX-Puppet-Version: 4.0.0\r\nAccept-Encoding: gzip;q=1.0,deflate;q=0.6,identity;q=0.3\r\nUser-Agent: Ruby\r\nHost: localhost:8666\r\n\r\nRESPONSE\r\nHTTP/1.1 200 OK \r\nX-Puppet-Version: 4.0.0\r\nContent-Type: text/pson\r\nServer: WEBrick/1.3.1 (Ruby/1.9.3/2014-11-13) OpenSSL/0.9.8za\r\nDate: Tue, 14 Apr 2015 23:56:14 GMT\r\nContent-Length: 606\r\nConnection: Keep-Alive\r\n\r\n[\r\n    {\r\n        \"path\": \"\\/Users\\/nwolfe\\/workspace\\/puppetlabs\\/conf\\/master\\/v4\\/code\\/environments\\/production\\/modules\\/tmpfiles\\/facts.d\",\r\n        \"relative_path\": \".\",\r\n        \"links\": \"follow\",\r\n        \"owner\": 501,\r\n        \"group\": 20,\r\n        \"mode\": 420,\r\n        \"checksum\": {\r\n            \"type\": \"ctime\",\r\n            \"value\": \"{ctime}2015-04-14 16:31:21 -0700\"\r\n        },\r\n        \"type\": \"directory\",\r\n        \"destination\": null\r\n    },\r\n    {\r\n        \"path\": \"\\/Users\\/nwolfe\\/workspace\\/puppetlabs\\/conf\\/master\\/v4\\/code\\/environments\\/production\\/modules\\/tmpfiles\\/facts.d\",\r\n        \"relative_path\": \"external_fact_date\",\r\n        \"links\": \"follow\",\r\n        \"owner\": 501,\r\n        \"group\": 20,\r\n        \"mode\": 420,\r\n        \"checksum\": {\r\n            \"type\": \"md5\",\r\n            \"value\": \"{md5}abec184c543c4dadfa4bf4e70c0b3000\"\r\n        },\r\n        \"type\": \"file\",\r\n        \"destination\": null\r\n    }\r\n]\r\n{code}\r\n\r\nI came across some tickets that may be related:\r\n* PUP-3935\r\n* PUP-2705\r\n\r\nI verified this behavior in our newly-released 4.0.0 packages (PC1).\r\n\r\nh3. QA\r\n----\r\nrisk: high (regression)\r\nseverity: high\r\nprobability: high \r\ntest layer: acceptance","closed_at":"2019-04-04T22:31:31.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4420","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:31.000-0700","timestamp":1652286019.115703,"priority":"Normal","status_category":"Done","pull_request":3883},{"issue_id":"48934","title":"Deprecate hidden _timestamp fact","url":"https://tickets.puppetlabs.com/browse/PUP-3129","created_at":"2014-08-22T13:47:09.000-0700","number":"PUP-3129","body":null,"closed_at":"2019-04-04T22:31:32.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3129","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:32.000-0700","timestamp":1652286019.541405,"priority":"Normal","status_category":"Done","pull_request":3006},{"issue_id":"40449","title":"Move epp() and inline_epp() to 4x function API","url":"https://tickets.puppetlabs.com/browse/PUP-2845","created_at":"2014-06-26T07:23:30.000-0700","number":"PUP-2845","body":"The {{epp()}} and {{inline_epp()}} functions must be moved to the 4x function API in order to work correctly. The 3x function API requires transformation of all undef/nils to empty string, and that catalog entry types are transformed to Resource references. This does not work well when these values again emerge in Puppet logic.\r\n\r\nThis also blocks the wanted \"call by name\" semantics as it is impossible to differentiate between missing values and empty strings.","closed_at":"2019-04-04T22:31:32.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2845","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:32.000-0700","timestamp":1652286019.750891,"priority":"Normal","status_category":"Done","pull_request":2815},{"issue_id":"71488","title":"Puppet's logdir permissions prevent puppetserver service start","url":"https://tickets.puppetlabs.com/browse/PUP-4194","created_at":"2015-03-12T16:09:57.000-0700","number":"PUP-4194","body":"When a user runs {{puppet apply -e 'notice foo'}} immediately after installing {{puppet-agent}} and before installing {{puppetserver}} the permissions on {{/var/log/puppetlabs}} are silently changed from {{root:root 0755}} to {{root:root 0750}}.\r\n\r\nThis is a problem because once {{puppetserver}} is installed, it cannot start the service because it cannot traverse through {{/var/log/puppetlabs}} into {{/var/log/puppetlabs/puppetserver}}.\r\n\r\nOther information:\r\n\r\n{{:rundir}} is 0755 in defaults.rb which is why we don't see this here.\r\n\r\nWe also don't see this in our testing because we don't run puppet in the space between installing puppet-agent and puppetserver.\r\n\r\nrisk: medium\r\nprobability: medium (only local logfile)\r\nseverity: medium (error, with work-around)\r\ntest layer: acceptance, (package creates file/sets permissions)","closed_at":"2019-04-04T22:31:32.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4194","labels":"AIO","state":"Closed","updated_at":"2019-04-04T22:31:32.000-0700","timestamp":1652286019.961291,"priority":"Normal","status_category":"Done","pull_request":3742},{"issue_id":"14598","title":" Functions that require the future parser should be concretely identifiable","url":"https://tickets.puppetlabs.com/browse/PUP-335","created_at":"2013-09-12T18:00:05.000-0700","number":"PUP-335","body":"\n\nTake a look at the function reference:\n\nhttp://docs.puppetlabs.com/references/3.latest/function.html\n\nThere are a bunch of functions in there that will just plain explode on a stock Puppet 3.x install. (each, collect, etc.) This is because there’s no indication in these functions' code that they require the future parser.\n\nWe need an indication of this built into the function API, not only for the sake of documentation but also to improve error handling, etc.\n","closed_at":"2019-04-04T22:31:32.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-335","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:32.000-0700","timestamp":1652286020.06932,"priority":"Normal","status_category":"Done","pull_request":3163},{"issue_id":"41488","title":"Make string/symbol use consistent in new function API","url":"https://tickets.puppetlabs.com/browse/PUP-2904","created_at":"2014-07-08T04:09:23.000-0700","number":"PUP-2904","body":"The new function API has inconsistent use of string/symbol when parameters are named in the dispatch declaration. We should be using symbols for the parameter names.","closed_at":"2019-04-04T22:31:33.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2904","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:33.000-0700","timestamp":1652286020.173961,"priority":"Normal","status_category":"Done","pull_request":3360},{"issue_id":"10963","title":"Resource defaults and automatic tags are applied after collectors are evaluated","url":"https://tickets.puppetlabs.com/browse/PUP-22","created_at":"2013-06-17T17:36:39.000-0700","number":"PUP-22","body":"Automatic tags and resource defaults are applied by the compiler during the [finish stage|https://github.com/puppetlabs/puppet/blob/3.2.0/lib/puppet/parser/compiler.rb#L105] which is executed after the [evaluate_generators stage|https://github.com/puppetlabs/puppet/blob/3.2.0/lib/puppet/parser/compiler.rb#L103] where collectors are evaluated. Additionally, [the step that adds automatic_tags|https://github.com/puppetlabs/puppet/blob/3.2.0/lib/puppet/parser/resource.rb#L246-L250] from parent scopes is not selective at all---it performs a wholesale copy of all tags. Therefore, a notify resource defined inside a class ends up tagged as both a class resource and a notify resource which is probably not the intended behavior as this makes it difficult to use tags to filter by resource type.","closed_at":"2019-04-04T22:31:35.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-22","labels":"redmine","state":"Closed","updated_at":"2019-04-04T22:31:35.000-0700","timestamp":1652286020.760378,"priority":"Major","status_category":"Done","pull_request":5956},{"issue_id":"66272","title":"Upgrading Puppet package within Puppet agent run on EL7 results in bad package state","url":"https://tickets.puppetlabs.com/browse/PUP-3931","created_at":"2015-01-30T12:41:45.000-0800","number":"PUP-3931","body":"Under CentOS 7, having the puppet package upgrade under the daemonized instance of the puppet agent results in a broken package state.\r\n\r\nInstallation via manual {{yum update}} or a one-off puppet run (not the daemonized agent) works fine, but when the update operation occurs within the daemonized puppet run, systemd seems to squash the running agent along with its {{yum}} process - the update never fully cleans up the old package, both are left showing as installed, and puppet keeps unsuccessfully trying to upgrade the old package.\r\n\r\nManual:\r\n{code}\r\n[root@test ~]# rpm -qa | grep puppet\r\npuppet-3.7.3-1.el7.noarch\r\n[root@test ~]# yum update puppet-3.7.4\r\n...\r\nResolving Dependencies\r\n--> Running transaction check\r\n---> Package puppet.noarch 0:3.7.3-1.el7 will be updated\r\n---> Package puppet.noarch 0:3.7.4-1.el7 will be an update\r\n...\r\nRunning transaction\r\n  Updating   : puppet-3.7.4-1.el7.noarch                                                                                                                             1/2\r\n  Cleanup    : puppet-3.7.3-1.el7.noarch                                                                                                                             2/2\r\n  Verifying  : puppet-3.7.4-1.el7.noarch                                                                                                                             1/2\r\n  Verifying  : puppet-3.7.3-1.el7.noarch                                                                                                                             2/2\r\n\r\nUpdated:\r\n  puppet.noarch 0:3.7.4-1.el7\r\n\r\nComplete!\r\n[root@test ~]# rpm -qa | grep puppet\r\npuppet-3.7.4-1.el7.noarch\r\n{code}\r\n\r\nOne-off:\r\n{code}\r\n[root@test ~]# rpm -qa | grep puppet\r\npuppet-3.7.3-1.el7.noarch\r\n[root@test ~]# puppet apply -e \"package { \"puppet\": ensure => latest }\"\r\n...\r\n[root@test ~]# rpm -qa | grep puppet\r\npuppet-3.7.4-1.el7.noarch\r\n{code}\r\n\r\nWithin daemonized agent (syslog):\r\n{code}\r\nJan 30 20:04:29 test systemd: Starting Puppet agent...\r\nJan 30 20:04:29 test systemd: Started Puppet agent.\r\nJan 30 20:04:31 test puppet-agent[3016]: Starting Puppet client version 3.7.3\r\nJan 30 20:04:34 test puppet-agent[3023]: The package type's allow_virtual parameter will be changing its default value from false to true in a future release. If you do not want to allow virtual packages, please explicitly set allow_virtual to false.\r\nJan 30 20:04:34 test puppet-agent[3023]: (at /usr/share/ruby/vendor_ruby/puppet/type/package.rb:430:in `block (3 levels) in <module:Puppet>')\r\nJan 30 20:04:51 test systemd: Reloading.\r\nJan 30 20:04:51 test yum[3442]: Updated: puppet-3.7.4-1.el7.noarch\r\nJan 30 20:04:51 test systemd: Stopping Puppet agent...\r\nJan 30 20:04:51 test puppet-agent[3023]: Caught TERM; calling stop\r\nJan 30 20:04:51 test puppet-agent[3016]: Caught TERM; calling stop\r\nJan 30 20:04:51 test systemd: Starting Puppet agent...\r\nJan 30 20:04:51 test systemd: Started Puppet agent.\r\nJan 30 20:04:53 test puppet-agent[3517]: Starting Puppet client version 3.7.4\r\nJan 30 20:04:56 test puppet-agent[3527]: The package type's allow_virtual parameter will be changing its default value from false to true in a future release. If you do not want to allow virtual packages, please explicitly set allow_virtual to false.\r\nJan 30 20:04:56 test puppet-agent[3527]: (at /usr/share/ruby/vendor_ruby/puppet/type/package.rb:430:in `block (3 levels) in <module:Puppet>')\r\nJan 30 20:05:12 test puppet-agent[3527]: Could not update: Execution of '/usr/bin/yum -d 0 -e 0 -y install puppet-3.7.4-1.el7' returned 1: There are unfinished transactions remaining. You might consider running yum-complete-transaction, or \"yum-complete-transaction --cleanup-only\" and \"yum history redo last\", first to finish them. If those don't work you'll have to try removing/installing packages by hand (maybe package-cleanup can help).\r\nJan 30 20:05:12 test puppet-agent[3527]:\r\nJan 30 20:05:12 test puppet-agent[3527]:\r\nJan 30 20:05:12 test puppet-agent[3527]: Transaction check error:\r\nJan 30 20:05:12 test puppet-agent[3527]: package puppet-3.7.4-1.el7.noarch is already installed\r\nJan 30 20:05:12 test puppet-agent[3527]:\r\nJan 30 20:05:12 test puppet-agent[3527]: Error Summary\r\nJan 30 20:05:12 test puppet-agent[3527]: -------------\r\nJan 30 20:05:12 test puppet-agent[3527]: Wrapped exception:\r\nJan 30 20:05:12 test puppet-agent[3527]: Execution of '/usr/bin/yum -d 0 -e 0 -y install puppet-3.7.4-1.el7' returned 1: There are unfinished transactions remaining. You might consider running yum-complete-transaction, or \"yum-complete-transaction --cleanup-only\" and \"yum history redo last\", first to finish them. If those don't work you'll have to try removing/installing packages by hand (maybe package-cleanup can help).\r\nJan 30 20:05:12 test puppet-agent[3527]:\r\nJan 30 20:05:12 test puppet-agent[3527]:\r\nJan 30 20:05:12 test puppet-agent[3527]: Transaction check error:\r\nJan 30 20:05:12 test puppet-agent[3527]: package puppet-3.7.4-1.el7.noarch is already installed\r\nJan 30 20:05:12 test puppet-agent[3527]:\r\nJan 30 20:05:12 test puppet-agent[3527]: Error Summary\r\nJan 30 20:05:12 test puppet-agent[3527]: -------------\r\nJan 30 20:05:12 test puppet-agent[3527]: (/Stage[main]/Puppet_client::Install/Package[puppet]/ensure) change from 3.7.3-1.el7 to 3.7.4-1.el7 failed: Could not update: Execution of '/usr/bin/yum -d 0 -e 0 -y install puppet-3.7.4-1.el7' returned 1: There are unfinished transactions remaining. You might consider running yum-complete-transaction, or \"yum-complete-transaction --cleanup-only\" and \"yum history redo last\", first to finish them. If those don't work you'll have to try removing/installing packages by hand (maybe package-cleanup can help).\r\nJan 30 20:05:12 test puppet-agent[3527]: (/Stage[main]/Puppet_client::Install/Package[puppet]/ensure)\r\nJan 30 20:05:12 test puppet-agent[3527]: (/Stage[main]/Puppet_client::Install/Package[puppet]/ensure)\r\nJan 30 20:05:12 test puppet-agent[3527]: (/Stage[main]/Puppet_client::Install/Package[puppet]/ensure) Transaction check error:\r\nJan 30 20:05:12 test puppet-agent[3527]: (/Stage[main]/Puppet_client::Install/Package[puppet]/ensure)   package puppet-3.7.4-1.el7.noarch is already installed\r\nJan 30 20:05:12 test puppet-agent[3527]: (/Stage[main]/Puppet_client::Install/Package[puppet]/ensure)\r\nJan 30 20:05:12 test puppet-agent[3527]: (/Stage[main]/Puppet_client::Install/Package[puppet]/ensure) Error Summary\r\nJan 30 20:05:12 test puppet-agent[3527]: (/Stage[main]/Puppet_client::Install/Package[puppet]/ensure) -------------\r\nJan 30 20:05:12 test puppet-agent[3527]: (/Stage[main]/Puppet_client::Service/Service[puppet]) Dependency Package[puppet] has failures: true\r\nJan 30 20:05:12 test puppet-agent[3527]: (/Stage[main]/Puppet_client::Service/Service[puppet]) Skipping because of failed dependencies\r\nJan 30 20:05:13 test puppet-agent[3527]: Finished catalog run in 11.66 seconds\r\n\r\n[root@test ~]# rpm -qa | grep puppet\r\npuppet-3.7.4-1.el7.noarch\r\npuppet-3.7.3-1.el7.noarch\r\n{code}\r\n\r\nI think the behavior under the old init scripts was to TERM just PID 3016 above and not also 3023, which seems to be what's causing the problem.","closed_at":"2019-04-04T22:31:35.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3931","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:35.000-0700","timestamp":1652286021.28482,"priority":"Normal","status_category":"Done","pull_request":3700},{"issue_id":"34608","title":"Remove support to search for Type in String","url":"https://tickets.puppetlabs.com/browse/PUP-2514","created_at":"2014-05-07T13:16:06.000-0700","number":"PUP-2514","body":"The idea to support search for Type in String with the rationale that if String is an array of characters, then any slice of that string is also a String, and thus searching for a substring with matching types should be allowed.\r\n\r\nThe implementation does this now, but not in a comprehensive way, and does not support string length, pattern, variant etc.\r\n\r\nInstead of trying to add support for this support for searching for types in String should be removed.","closed_at":"2019-04-04T22:31:36.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2514","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:36.000-0700","timestamp":1652286021.597485,"priority":"Normal","status_category":"Done","pull_request":2689},{"issue_id":"57763","title":"Environments::Cached#get! bypasses the environment cache.","url":"https://tickets.puppetlabs.com/browse/PUP-3621","created_at":"2014-11-05T09:45:31.000-0800","number":"PUP-3621","body":"Cached subclasses Combined and calls Combind#get! which implements in terms of its loaders get calls, bypassing Cached#get entirely.  Just need to implement Cached#get! as Cached#get or raise EnvironmentNotFound.","closed_at":"2019-04-04T22:31:37.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3621","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:37.000-0700","timestamp":1652286021.701416,"priority":"Normal","status_category":"Done","pull_request":3300},{"issue_id":"38210","title":"Reserved keywords conflict with resource type parameters","url":"https://tickets.puppetlabs.com/browse/PUP-2727","created_at":"2014-06-04T11:41:02.000-0700","number":"PUP-2727","body":"The words \"function\", \"type\", and \"attr\" are now reserved and produce warnings in the current parser and errors in the future parser. However, \"type\" conflicts with the \"type\" parameter on the ssh_authorized_key resource type. This means that under the future parser you can't fully use that type, or any others that happen to have a \"type\", \"function\", or \"attr\" parameters.\r\n\r\nThis isn't consistent with other keywords in the language such as \"class\". You can create a class that has a parameter named \"class\" and use it.\r\n\r\nI think the new keywords should be handled in the same way and not limit the allowed parameter names.","closed_at":"2019-04-04T22:31:41.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2727","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:41.000-0700","timestamp":1652286023.383021,"priority":"Critical","status_category":"Done","pull_request":2748},{"issue_id":"28298","title":"Multiple paths in --modulepath command line option not parsed","url":"https://tickets.puppetlabs.com/browse/PUP-1905","created_at":"2014-03-10T02:03:26.000-0700","number":"PUP-1905","body":"In Puppet 3.4 and earlier, multiple paths could be supplied with the --modulepath option, but as of PUP-1765, there has been a regression and they no longer work.\r\n\r\n{noformat}\r\n$ git co 3.4.3\r\nNote: checking out '3.4.3'.\r\n$ bin/puppet apply --modulepath /tmp:/tmp/test/ --noop -e 'include ntp'\r\nNotice: Compiled catalog for cobalt.redhat.com in environment production in 0.76 seconds\r\nNotice: /Stage[main]/Ntp/Package[ntp]/ensure: current_value absent, should be present (noop)\r\nNotice: /Stage[main]/Ntp/File[/etc/ntp.conf]/ensure: current_value absent, should be present (noop)\r\nNotice: /Stage[main]/Ntp/File[/etc/sysconfig/ntpd]/ensure: current_value absent, should be present (noop)\r\nNotice: /Stage[main]/Ntp/Service[ntpd]/ensure: current_value stopped, should be running (noop)\r\nNotice: Class[Ntp]: Would have triggered 'refresh' from 4 events\r\nNotice: Stage[main]: Would have triggered 'refresh' from 1 events\r\nNotice: Finished catalog run in 0.99 seconds\r\n{noformat}\r\n\r\n{noformat}\r\n$ git co master\r\nPrevious HEAD position was bbe30e0... (packaging) Update PUPPETVERSION to 3.4.3\r\nSwitched to branch 'master'\r\n$ bin/puppet apply --modulepath /tmp:/tmp/test/ --noop -e 'include ntp'\r\nError: Could not find class ntp for cobalt.redhat.com on node cobalt.redhat.com\r\nError: Could not find class ntp for cobalt.redhat.com on node cobalt.redhat.com\r\n{noformat}\r\n","closed_at":"2019-04-04T22:31:42.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1905","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:42.000-0700","timestamp":1652286023.594796,"priority":"Normal","status_category":"Done","pull_request":2426},{"issue_id":"36534","title":"Running the puppet agent against a nonexistent environment produces an overly verbose error message.","url":"https://tickets.puppetlabs.com/browse/PUP-2631","created_at":"2014-05-21T09:54:32.000-0700","number":"PUP-2631","body":"When the puppet agent is run against a Puppet master using a nonexistent environment, the agent fails and prints an error message with the associated URL from the REST terminus. When the URL contains POST parameters, the resulting error is extremely verbose and produces about 50 or more lines of output. This is harmful from a user perspective because it produces a large amount of output that doesn't contribute to the explanation of the error. This was introduced as part of PUP-2214.\r\n\r\nSteps to reproduce:\r\n\r\nSet up a master with this puppet.conf:\r\n\r\n{code}\r\n[master]\r\nenvironmentpath = $confdir/environments\r\n{code}\r\n\r\nRun an agent against a garbage environment name, and step well back.","closed_at":"2019-04-04T22:31:43.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2631","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:43.000-0700","timestamp":1652286024.019346,"priority":"Major","status_category":"Done","pull_request":2971},{"issue_id":"25343","title":"New Parser does not handle hyphenated barewords","url":"https://tickets.puppetlabs.com/browse/PUP-1576","created_at":"2014-02-03T16:19:34.000-0800","number":"PUP-1576","body":"The current parser/evaluator handles hyphenated bare words such as {{hi-there}}. The new parser and evaluator chokes on these, and tries to interpret them as numeric expressions of subtraction.\r\n\r\nWorks on current parser:\r\n{noformat}\r\n[16:08:41][Ruby(ruby-1.9.3-p448)][Git(pr/2320)] andy:puppet\r\n> be puppet apply -e 'notify { hi-there: }'\r\nNotice: Compiled catalog for aparker.corp.puppetlabs.net in environment production in 0.02 seconds\r\nNotice: hi-there\r\nNotice: /Stage[main]/Main/Notify[hi-there]/message: defined 'message' as 'hi-there'\r\nNotice: Finished catalog run in 0.03 seconds\r\n{noformat}\r\n\r\nNew evaluator shows that it is checking that the left and right operands of the {{-}} operator are numeric:\r\n{noformat}\r\n[16:08:05][Ruby(ruby-1.9.3-p448)][Git(pr/2320)] andy:puppet\r\n> be puppet apply -e 'notify { hi-there: }' --parser future\r\nError: Evaluation Error: The value 'hi' cannot be converted to Numeric. at line 1:10 on node aparker.corp.puppetlabs.net\r\nError: Evaluation Error: The value 'hi' cannot be converted to Numeric. at line 1:10 on node aparker.corp.puppetlabs.net\r\n{noformat}\r\n\r\nThe current evaluator is passed it as a numeric expression as well.\r\n{noformat}\r\n[16:08:13][Ruby(ruby-1.9.3-p448)][Git(pr/2320)] andy:puppet\r\n> be puppet apply -e 'notify { hi-there: }' --parser future --evaluator current\r\nError: left operand of - is not a number at line 1 on node aparker.corp.puppetlabs.net\r\nWrapped exception:\r\nleft operand of - is not a number\r\nError: left operand of - is not a number at line 1 on node aparker.corp.puppetlabs.net\r\n{noformat}\r\n\r\nIt appears that the new parser is tokenizing the hyphenated bare word as something like {{IDENTIFIER, SUBTRACT, IDENTIFIER}} where the old parser is seeing it as simply {{IDENTIFIER}}. ","closed_at":"2019-04-04T22:31:45.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1576","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:45.000-0700","timestamp":1652286024.539743,"priority":"Major","status_category":"Done","pull_request":2393},{"issue_id":"15157","title":"File ignore and pluginsync pluginignore not being respected.","url":"https://tickets.puppetlabs.com/browse/PUP-413","created_at":"2013-09-24T20:17:20.000-0700","number":"PUP-413","body":"Details are in Redmine #22652.  This is filed against 3.3.1-rc1.  Kylo and I have tried to reproduce without success, and have accessed for and received some more information.","closed_at":"2019-04-04T22:31:45.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-413","labels":"","state":"Resolved","updated_at":"2019-04-04T22:31:45.000-0700","timestamp":1652286024.643703,"priority":"Normal","status_category":"Done","pull_request":4017},{"issue_id":"50181","title":"puppet catalog download fails","url":"https://tickets.puppetlabs.com/browse/PUP-3182","created_at":"2014-09-04T09:04:19.000-0700","number":"PUP-3182","body":"1) Install master and agent\r\n2) Execute {{puppet catalog download}}\r\n3) Get inscrutable failure\r\n\r\n{code}\r\ntesthost 08:58:48$  env PATH=\"/opt/puppet/bin:${PATH}\" RUBYLIB=\"${RUBYLIB}\" puppet catalog download    \r\nError: Could not call 'save' on 'catalog': Instance name \"testhost.us-west-2.compute.internal\" does not match requested key {}\r\nError: Could not call 'save' on 'catalog': Instance name \"testhost.us-west-2.compute.internal\" does not match requested key {}\r\nError: Try 'puppet help catalog download' for usage\r\n{code}","closed_at":"2019-04-04T22:31:45.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3182","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:45.000-0700","timestamp":1652286024.75074,"priority":"Normal","status_category":"Done","pull_request":5047},{"issue_id":"24554","title":"When compiling a catalog, providers should be loaded from specified environment","url":"https://tickets.puppetlabs.com/browse/PUP-1515","created_at":"2014-01-24T14:29:11.000-0800","number":"PUP-1515","body":"When compiling a catalog, types and providers are validated, but while Puppet will load types from the agent's environment, it only loads providers from the compiling master's default environment (production). \r\n\r\nThis is a problem because the method that creates the {{provider}} parameter is sometimes called due to code in the *provider,* not the type. If a custom resource type only exists in a non-default environment, and you declare a resource that specifies a value for the {{provider}} attribute, this can cause an {{invalid parameter provider}} error.\r\n\r\nThe expected behavior is that Puppet will autoload types and providers from the agent's environment.\r\n\r\n----\r\n\r\noriginal description:\r\nIn Puppet 3 I am getting an error on all definitions for custom types.  It says \"Error 400 on SERVER: Invalid parameter provider...\".  Provider should be a given parameter for custom types because otherwise there is no way to specify which provider should be used with it.  This is potentially a very major bug.  Please let me know how I can help so you're able to reproduce and fix the issue.\r\n\r\n----\r\n\r\nFinal resolution: When validating resources during catalog compilation, Puppet will load types and providers from the environment that the catalog is being compiled for. (Modulo that other bug that causes cross-environment contamination.)","closed_at":"2019-04-04T22:31:46.000-0700","comments":49,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1515","labels":"redmine","state":"Closed","updated_at":"2019-04-04T22:31:46.000-0700","timestamp":1652286025.061236,"priority":"Critical","status_category":"Done","pull_request":3539},{"issue_id":"21598","title":"No longer allows variables with leading underscores","url":"https://tickets.puppetlabs.com/browse/PUP-1144","created_at":"2013-12-17T10:26:36.000-0800","number":"PUP-1144","body":"It appears that puppet 3.4 has changed the rules for allowed variable names. A variable with a leading underscore (e.g. {{$_last}}), now results in an error.\r\n\r\nhttps://github.com/puppetlabs/puppetlabs-apache/pull/540","closed_at":"2019-04-04T22:31:47.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1144","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:47.000-0700","timestamp":1652286025.177797,"priority":"Blocker","status_category":"Done","pull_request":8886},{"issue_id":"47029","title":"Typemanager wastes CPU cycles with global scope defined types","url":"https://tickets.puppetlabs.com/browse/PUP-3038","created_at":"2014-08-08T05:32:30.000-0700","number":"PUP-3038","body":"Defined type defined in a global scope will make MetaType::Manager go through all known code locations (modules, gems, loadpaths, etc) looking for that_type.rb\r\n\r\nThat combined with a fact that code locations are not cached makes puppet slow when working with large repositories.\r\n\r\nI'm preparing 2 PRs related to this issue.","closed_at":"2019-04-04T22:31:50.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3038","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:50.000-0700","timestamp":1652286026.329621,"priority":"Normal","status_category":"Done","pull_request":2952},{"issue_id":"52391","title":"Puppet apply breaks when an ENC returns an environment","url":"https://tickets.puppetlabs.com/browse/PUP-3341","created_at":"2014-09-24T16:51:41.000-0700","number":"PUP-3341","body":"Given the following ENC script (/tmp/enc)\r\n{code}\r\n#!/bin/sh\r\necho 'classes: []'\r\necho 'environment: production'\r\n{code}\r\nand two manifests\r\n 1. a manifest to apply (/tmp/manifest.pp)\r\n {code}\r\nnotify { 'it works': }\r\n {code}\r\n 2. a pseudo site-manifest (/tmp/site.pp)\r\n {code}\r\nnotify { 'FAIL': }\r\n {code}\r\n\r\nInvoking {{puppet apply}} in the following fashion should print \"itworks\", but does not.\r\n{noformat}\r\n$ bundle exec puppet apply /tmp/manifest.pp --node_terminus exec --external_nodes /tmp/enc --manifest /tmp/site.pp \r\n...\r\nNotice: FAIL\r\n{noformat}\r\n\r\n--\r\nSummary\r\n\r\nPreviously, if the master was configured to use an ENC, and the ENC returned an environment for a node, then {{puppet apply manifest.pp}} would apply the catalog from that environment instead of the manifest specified on the command line.\r\n\r\nNow, {{puppet apply manifest.pp}} will use the specified manifest from the command line, even if the ENC returns an environment.\r\n----\r\nh3. QA Risk Analysis\r\n|Risk Level|High (a broken apply can break production)|\r\n|Probability|High (it seems highly likely an ENC will return an envrionment)|\r\n|Severity|Medium ({{puppet apply}} should work)|\r\n|Test Level|Acceptance (crosses component boundaries)|","closed_at":"2019-04-04T22:31:50.000-0700","comments":25,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3341","labels":"commandline","state":"Closed","updated_at":"2019-04-04T22:31:50.000-0700","timestamp":1652286026.438284,"priority":"Normal","status_category":"Done","pull_request":4945},{"issue_id":"22325","title":"Custom reports not working (Class is already defined in Puppet::Reports)","url":"https://tickets.puppetlabs.com/browse/PUP-1189","created_at":"2013-12-19T09:22:46.000-0800","number":"PUP-1189","body":"I've got a client experiencing this with the boundary report from https://github.com/puppetlabs/puppetlabs-boundary\r\n\r\nAlso someone in #puppet said they get it with the datadog report in Puppet 3.0.\r\n\r\nHere's the full message we get at the end of the run:\r\n\r\nerr: Could not send report: Error 400 on SERVER: Could not autoload boundary: Class Boundary is already defined in Puppet::Reports","closed_at":"2019-04-04T22:31:52.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1189","labels":"redmine;reports","state":"Closed","updated_at":"2019-04-04T22:31:52.000-0700","timestamp":1652286027.278748,"priority":"Normal","status_category":"Done","pull_request":4118},{"issue_id":"21355","title":"Puppet lacks a proper \"undefined\" value","url":"https://tickets.puppetlabs.com/browse/PUP-1037","created_at":"2013-12-16T03:00:41.000-0800","number":"PUP-1037","body":"    $y = undef\r\n    notice($y == \"\")  # true\r\n    notice($x == $y)  # true\r\n    notice($x == \"\")  # true\r\n\r\nRecent changes in the Puppet DSL made equality commutative (good!), but in doing so broke work-arounds for actually testing for the difference between an undefined and \"empty\" value.  The most logical fix would be to equate Puppet's `undef` with Ruby's `nil`.","closed_at":"2019-04-04T22:31:53.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1037","labels":"redmine","state":"Closed","updated_at":"2019-04-04T22:31:53.000-0700","timestamp":1652286027.591739,"priority":"Normal","status_category":"Done","pull_request":8091},{"issue_id":"46000","title":"puppet parser validate shouldn't puke on exported resources","url":"https://tickets.puppetlabs.com/browse/PUP-2994","created_at":"2014-07-30T16:46:24.000-0700","number":"PUP-2994","body":"{code}\r\n[root@master /etc/puppetlabs/puppet/modules/hosts]# puppet parser validate manifests/init.pp\r\nWarning: You cannot collect exported resources without storeconfigs being set; the collection will be ignored on line 25 in file /etc/puppetlabs/puppet/modules/hosts/manifests/init.pp\r\n{code}\r\n\r\nThis kinda makes {{puppet parser validate}} really non user friendly.","closed_at":"2019-04-04T22:31:55.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2994","labels":"future-parser","state":"Closed","updated_at":"2019-04-04T22:31:55.000-0700","timestamp":1652286042.594477,"priority":"Normal","status_category":"Done","pull_request":2953},{"issue_id":"37212","title":"Trailing commas should be allowed in node definitions","url":"https://tickets.puppetlabs.com/browse/PUP-2682","created_at":"2014-05-27T12:02:45.000-0700","number":"PUP-2682","body":"Trailing commas are allowed on parametrized classes, node definitions should have the same behaviour.\r\n\r\nA comma after c should be allowed.\r\n\r\n{code}\r\nnode a, b, c, { }\r\n{code}","closed_at":"2019-04-04T22:31:56.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2682","labels":"future-parser","state":"Closed","updated_at":"2019-04-04T22:31:56.000-0700","timestamp":1652286043.031296,"priority":"Normal","status_category":"Done","pull_request":2699},{"issue_id":"19250","title":"New Evaluator does not cache parse results","url":"https://tickets.puppetlabs.com/browse/PUP-798","created_at":"2013-11-20T08:31:41.000-0800","number":"PUP-798","body":"The new evaluator does not cache parse result; everything is reparsed on every request.\r\n\r\nIn the previous version the \"future parser\" also used an instance of the \"old parser\" to perform imports and to handle caching of parse results.\r\n\r\nThis was obviously inefficient and was removed. The support for caching should be added. It should however not be implemented in the actual parser - the new e4 parser adapter is probably the right place.\r\n\r\nThe problem is worse. Since the layer above assume that once it has parsed a file, it only needs to be checked if it is in the cache of \"watched files\". ","closed_at":"2019-04-04T22:31:57.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-798","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:57.000-0700","timestamp":1652286043.136781,"priority":"Normal","status_category":"Done","pull_request":6251},{"issue_id":"41114","title":"Periodic timeouts when reading from master","url":"https://tickets.puppetlabs.com/browse/PUP-2885","created_at":"2014-07-02T15:02:45.000-0700","number":"PUP-2885","body":"Periodically, there are failures where the agent performs a pluginsync, a number of files are downloaded from the master, and eventually one of the files hangs, timeouts, and causes the pluginsync to abort.","closed_at":"2019-04-04T22:31:59.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2885","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:59.000-0700","timestamp":1652286044.333626,"priority":"Normal","status_category":"Done","pull_request":2853},{"issue_id":"25361","title":"Rename Literal Type to Scalar","url":"https://tickets.puppetlabs.com/browse/PUP-1579","created_at":"2014-02-04T02:01:49.000-0800","number":"PUP-1579","body":"The type named \"Literal\" should be renamed to \"Scalar\" since it is not limited to literal data entered in source, but also to created \"non literal\" results.","closed_at":"2019-04-04T22:31:59.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1579","labels":"","state":"Closed","updated_at":"2019-04-04T22:31:59.000-0700","timestamp":1652286044.44067,"priority":"Normal","status_category":"Done","pull_request":2326},{"issue_id":"32312","title":"New evaluator does not properly handle resource defaults","url":"https://tickets.puppetlabs.com/browse/PUP-2302","created_at":"2014-04-18T09:57:31.000-0700","number":"PUP-2302","body":"Resource defaults in the new evaluator appear to not be working for defined resource types.\r\n\r\n{code:title=Testing manifest}\r\ndefine testing::thing($msg = 'param default') {\r\n  notify { 'name': message => $msg }\r\n}\r\n\r\nTesting::Thing  {\r\n    msg => 'resource default'\r\n}\r\n\r\ntesting::thing { 'name': }\r\n{code}\r\n\r\nIf the above code is run with the new evaluator, then it will output {{param default}} rather than the expected {{resource default}}.\r\n{code:title=Incorrect message when using new evaluator}\r\n> be puppet apply t.pp --parser future --evaluator future\r\nWarning: Could not retrieve fact fqdn\r\nNotice: Compiled catalog for aparker in environment production in 0.41 seconds\r\nNotice: param default\r\nNotice: /Stage[main]/Main/Testing::Thing[name]/Notify[name]/message: defined 'message' as 'param default'\r\nNotice: Finished catalog run in 0.04 seconds\r\n{code}\r\n\r\nSimply changing to use the old evaluator gets the expected output.\r\n{code:title=Correct message when using old evaluator}\r\n> be puppet apply t.pp --parser future --evaluator current\r\nWarning: Could not retrieve fact fqdn\r\nNotice: Compiled catalog for aparker in environment production in 0.41 seconds\r\nNotice: resource default\r\nNotice: /Stage[main]/Main/Testing::Thing[name]/Notify[name]/message: defined 'message' as 'resource default'\r\nNotice: Finished catalog run in 0.05 seconds\r\n{code}","closed_at":"2019-04-04T22:32:04.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2302","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:04.000-0700","timestamp":1652286046.242072,"priority":"Major","status_category":"Done","pull_request":2570},{"issue_id":"39711","title":"4x logging functions does not include container","url":"https://tickets.puppetlabs.com/browse/PUP-2807","created_at":"2014-06-18T16:17:09.000-0700","number":"PUP-2807","body":"The logging functions (notice, error, etc) were modified in future evaluator to use the new function API and the new loaders. In the new implementation, it was missed that the old (i.e. current) functions also output the name of the calling container (i.e. the \"resource\" owning the scope).\r\n\r\nFirst - do we want it to continue working the same way? (And if so, is it always the point in the call chain that is contained in a class / define that should be displayed?)","closed_at":"2019-04-04T22:32:05.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2807","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:05.000-0700","timestamp":1652286046.454422,"priority":"Normal","status_category":"Done","pull_request":2792},{"issue_id":"25206","title":"PR (2322) Module tool rechecks for conflicts for each installed module","url":"https://tickets.puppetlabs.com/browse/PUP-1563","created_at":"2014-01-31T15:59:53.000-0800","number":"PUP-1563","body":"resolve_install_conflicts causes a very long (edited from \"endless\") recursion because the recursion loop is inside the modules_by_path iterator causing each module and dependency to be checked for conflict once for each module that is installed. With a tree of dependencies and mearly dozens of previously installed modules, this walk can take hours.\r\n\r\nSince I can't see any reason for the same module to be checked against the same list of installed modules as many times as there are modules installed, I believe the recursion call should be moved outside of the modules_by_path iterator loop.","closed_at":"2019-04-04T22:32:05.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1563","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:05.000-0700","timestamp":1652286046.774433,"priority":"Normal","status_category":"Done","pull_request":2322},{"issue_id":"49895","title":"After enabling directory environments the manifestdir setting is still required to be valid","url":"https://tickets.puppetlabs.com/browse/PUP-3174","created_at":"2014-09-02T15:57:51.000-0700","number":"PUP-3174","body":"PE gives a stack trace if the manifestdir does not exist.  When setting up directory environments we recommend moving the $confdir/manifest folder into your environment which is guaranteed to break your install.  \r\n\r\nhttps://docs.puppetlabs.com/puppet/latest/reference/environments.html\r\n\r\nSteps to reproduce:\r\n\r\n1. Install PE3.3 on your platform of choice ( customer had Ubuntu 12.04, I tried centos 6.4) \r\n2. Edit {{puppet.conf}}\r\n - add {{environmentpath = /etc/puppetlabs/puppet/environments}}\r\n\r\n3. {{mkdir -p /etc/puppetlabs/puppet/environments/production}}\r\n4. {{service pe-httpd restart}}\r\n5. Complete a successful {{puppet agent -t}} run\r\n6. {{mv /etc/puppetlabs/puppet/manifests/ /etc/puppetlabs/puppet/environments/production/}}\r\n7. {{service pe-httpd restart}}\r\n\r\n","closed_at":"2019-04-04T22:32:08.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3174","labels":"customer;support","state":"Closed","updated_at":"2019-04-04T22:32:08.000-0700","timestamp":1652286047.787487,"priority":"Normal","status_category":"Done","pull_request":3054},{"issue_id":"46667","title":"Puppet doesn't like to evaluate 'require => [ [], [] ],'","url":"https://tickets.puppetlabs.com/browse/PUP-3018","created_at":"2014-08-06T01:34:04.000-0700","number":"PUP-3018","body":"Sometimes you might want to programmatically decide upon a resources requries, viz:\r\n\r\n{code}\r\nsomeresource {'mynam':\r\n   require => $flag ? { true => Another_resource['name'], false => []},\r\n}\r\n{code}\r\n\r\nThis works ok until you have lists on the RHS of the require line.\r\n\r\nThis works ok:\r\n\r\n{code}\r\nsomeresource {'mynam':\r\n   require => [$flag_a ? { true => Resource_a['name_a'], false => []},],\r\n}\r\n{code}\r\n\r\nBut this does not:\r\n\r\n{code}\r\nsomeresource {'mynam':\r\n   require => [\r\n              $flag_a ? { true => Resource_a['name_a'], false => []},\r\n              $flag_b ? { true => Resource_b['name_b'], false => []},\r\n              ],\r\n}\r\n{code}\r\n\r\nWhy? When {{$flag_a}} AND {{$flag_b}} are both false this reduces to:\r\n\r\n{code}\r\nsomeresource {'mynam':\r\n   require => [ [], [] ],\r\n}\r\n{code}\r\n\r\nAnd puppet does not like this.\r\n\r\nTo recap: require => [[]], is fine but require => [[],[]], is not.\r\n\r\nAlso: {{require => [ [] , SomeResource['name'] ]}}, is OK too. As is : {{require => [ [] , SomeResource['name'], [] ],}}, this is OK.\r\n\r\nConfused yet?\r\n\r\nYou might think that the rule is \"don't have [],[] in a require\". but you'd be wrong this stanza works fine:\r\n\r\n{code}\r\nrequire => [ [] , SomeResource['name'], [], [] ],\r\n{code}\r\n\r\nThe error messages puppet client creates is :\r\n\r\n{noformat}\r\nError: Failed to apply catalog: Parameter require failed on Exec[xxxxxx]: No title provided and [] is not a valid resource reference at /etc/puppet/......:##\r\n{noformat}\r\n","closed_at":"2019-04-04T22:32:10.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3018","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:10.000-0700","timestamp":1652286048.686807,"priority":"Major","status_category":"Done","pull_request":4786},{"issue_id":"26253","title":"Puppet config print respects legacy but not directory environments","url":"https://tickets.puppetlabs.com/browse/PUP-1676","created_at":"2014-02-12T13:51:24.000-0800","number":"PUP-1676","body":"Puppet config print and --configprint respect only legacy environments if specified.\r\n\r\nFor example:\r\n\r\n{code}\r\njpartlow@percival:~/work/puppet$ cat ~/.puppet/puppet.conf \r\n[legacy]\r\nmodulepath=/home/jpartlow/work/tmp/envs/legacy\r\n\r\njpartlow@percival:~/work/puppet$ tree ~/.puppet/environments/\r\n/home/jpartlow/.puppet/environments/\r\n└── direnv\r\n    └── modules\r\n\r\n2 directories, 0 files\r\n{code}\r\n\r\nthen\r\n\r\n{code}\r\njpartlow@percival:~/work/puppet$ be puppet agent --configprint modulepath\r\n/home/jpartlow/.puppet/modules:/usr/share/puppet/modules\r\njpartlow@percival:~/work/puppet$ be puppet agent --configprint modulepath --environment legacy\r\n/home/jpartlow/work/tmp/envs/legacy\r\n{code}\r\n\r\nbut\r\n\r\n{code}\r\njpartlow@percival:~/work/puppet$ be puppet agent --configprint modulepath --environment direnv\r\n/home/jpartlow/.puppet/modules:/usr/share/puppet/modules\r\n{code}\r\n\r\nbecause in https://github.com/puppetlabs/puppet/blob/master/lib/puppet/settings.rb#L1049-L1070 expects to find environment settings in a legacy puppet.conf section as provided by searchpath(environment).\r\n","closed_at":"2019-04-04T22:32:12.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1676","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:12.000-0700","timestamp":1652286049.438023,"priority":"Normal","status_category":"Done","pull_request":2369},{"issue_id":"25029","title":"V2.0 API reports Not Authorized as a \"RUNTIME_ERROR\"","url":"https://tickets.puppetlabs.com/browse/PUP-1552","created_at":"2014-01-30T12:17:07.000-0800","number":"PUP-1552","body":"When requesting a path from the v2.0 api, which the client does not have permission, the {{issue_kind}} shows as a {{RUNTIME_ERROR}}. It doesn't seem like that should be classified in that way. I would expect {{RUNTIME_ERROR}} to be reserved for unexpected situations.","closed_at":"2019-04-04T22:32:12.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1552","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:12.000-0700","timestamp":1652286049.541382,"priority":"Normal","status_category":"Done","pull_request":2439},{"issue_id":"36577","title":"Type type is not an Object","url":"https://tickets.puppetlabs.com/browse/PUP-2632","created_at":"2014-05-21T11:53:26.000-0700","number":"PUP-2632","body":"It seemed to be a good idea to make the Type type not be an Object, but this creates difficulties when a type is needed for \"anything\" as it has to be written as Optional[Variant[Type, Object]], which is a horrible construct to begin with, and it will be shown in error messages for all untyped since it has to be the default for accepting anything.\r\n\r\nThe simple fix is to make Type a subtype of Object.","closed_at":"2019-04-04T22:32:14.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2632","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:14.000-0700","timestamp":1652286049.979727,"priority":"Normal","status_category":"Done","pull_request":2685},{"issue_id":"22729","title":"ruby_manifest_spec does not test everything properly","url":"https://tickets.puppetlabs.com/browse/PUP-1321","created_at":"2013-12-31T05:22:49.000-0800","number":"PUP-1321","body":"Steps to reproduce:\r\n\r\n1. Modify spec/integration/parser/ruby_manifest_spec.rb, test \"should be properly reloaded when stale\", so that Puppet[:filetimeout] would be set to a high value (e.g. 1000) instead of current -1.\r\n2. Run spec tests\r\n3. Check the result\r\n\r\nExpected result: The test fails as the file should be cached and obsolete notice should be present in the output.\r\n\r\nActual result: The test succeeds.\r\n\r\nIt means that the test as it stands today is useless, not actually checking the expected functionality.","closed_at":"2019-04-04T22:32:15.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1321","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:15.000-0700","timestamp":1652286050.613834,"priority":"Normal","status_category":"Done","pull_request":2206},{"issue_id":"34992","title":"parameter lookup produces screwy result for default values","url":"https://tickets.puppetlabs.com/browse/PUP-2532","created_at":"2014-05-12T09:40:33.000-0700","number":"PUP-2532","body":"When the future parser \"lookup resource parameter\" evaluates and there is no parameter value set by the evaluated manifest logic at that point, the evaluator then looks up the default value for that parameter.\r\n\r\nThis unfortunately looks up the default value as seen from the perspective of the \"lookup resource parameter\" scope/context, and not the context in which the resource was defined. Thus, the evaluator will produce a \"lie\" in every other context except the one where the resource was defined.\r\n\r\nThis is unacceptable.\r\n\r\nThere are different ways to solve this:\r\n\r\n*  Do not ever lookup default (rationale: we don't know what the value ending up in the catalog will be until it is actually computed *at the end of the compilation* when no more user logic will be evaluated).\r\n* Do the same kind of lookup as the compiler does (rationale: provides the best knowledge about what the value probably will end up being if nothing else is evaluated that affects the outcome, which by the way is the best the parameter lookup can achieve at any point throughout the evaluation).\r\n\r\nThe 'do not provide defaults' may seem harsh, but it is far better than producing erroneous/misleading results. \r\n\r\nStory points of 2 reflects attempting to do the more difficult option (lookup in correct scope). Suggest attempting that, but if that does not work out with a cap on time, then skip looking up default.","closed_at":"2019-04-04T22:32:15.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2532","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:15.000-0700","timestamp":1652286050.720709,"priority":"Normal","status_category":"Done","pull_request":2844},{"issue_id":"28981","title":"future parser doesn't accept empty array as title","url":"https://tickets.puppetlabs.com/browse/PUP-1978","created_at":"2014-03-18T10:41:42.000-0700","number":"PUP-1978","body":"When passed an empty array the future parser ends up giving an unhelpful error message {{Error: Evaluation Error: Group[] accepts 1 argument. Got 0 on node super-secret-foo}}\r\n\r\n{noformat}\r\n/usr/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:19:in `fail'\r\n/usr/lib/ruby/vendor_ruby/puppet/pops/evaluator/access_operator.rb:443:in `access_PResourceType'\r\n/usr/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:74:in `visit_this_2'\r\n/usr/lib/ruby/vendor_ruby/puppet/pops/evaluator/access_operator.rb:25:in `access'\r\n/usr/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:484:in `eval_AccessExpression'\r\n/usr/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:64:in `visit_this_1'\r\n{noformat}\r\n\r\nThe current parser accepts an empty array as an argument to Group (I have no idea what it does with it though, probably ignores it).","closed_at":"2019-04-04T22:32:16.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1978","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:16.000-0700","timestamp":1652286050.824239,"priority":"Normal","status_category":"Done","pull_request":2448},{"issue_id":"31005","title":"Directory Environments breaks many classic Config File Environments","url":"https://tickets.puppetlabs.com/browse/PUP-2158","created_at":"2014-04-04T06:02:28.000-0700","number":"PUP-2158","body":"If you use the script in the classic blog post http://puppetlabs.com/blog/git-workflow-and-puppet-environments you have Config File Environments located at /etc/puppet/environments.  Unfortunately, Puppet 3.5.0 will treat them as Directory Environments.  If you have a modulepath such as this:\r\n\r\n{noformat}\r\n  modulepath=/etc/puppet/environments/$environment/modules:/etc/puppet/environmentss/$environment/services:/etc/puppet/environments/$environment/forge\r\n{noformat}\r\n\r\nit will not be used.  You have to move your environments someplace else.\r\n\r\nIt is a pity that Puppet 3.5.0 reused the proposed location from that blog post.  The transition would have been less painful if another location had been used.\r\n\r\nFailing that, it would have been less painful if the resolution order had been Config File Enviroment -> DIrectory Environment -> global environment.\r\n\r\nAt the very least, this should be mentioned in the release note and on http://docs.puppetlabs.com/puppet/3.5/reference/environments.html.  It was a bit hard to find the resultion order deep down in http://docs.puppetlabs.com/puppet/3.5/reference/environments_classic.html#interaction-with-directory-environments.","closed_at":"2019-04-04T22:32:16.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2158","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:16.000-0700","timestamp":1652286050.930052,"priority":"Normal","status_category":"Done","pull_request":2512},{"issue_id":"25687","title":"functions accepting regexp string should also accept Regexp","url":"https://tickets.puppetlabs.com/browse/PUP-1601","created_at":"2014-02-06T09:47:07.000-0800","number":"PUP-1601","body":"Functions (e.g. split) that accepts a regular expression in string form\r\nshould also accept an already created regular expression, or the PRegexpType from which a regular expression can be obtained.","closed_at":"2019-04-04T22:32:16.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1601","labels":"docs_reviewed","state":"Closed","updated_at":"2019-04-04T22:32:16.000-0700","timestamp":1652286051.036343,"priority":"Normal","status_category":"Done","pull_request":3542},{"issue_id":"36865","title":"label provider for class/define should capitalize all segments","url":"https://tickets.puppetlabs.com/browse/PUP-2654","created_at":"2014-05-23T09:13:08.000-0700","number":"PUP-2654","body":"When the label provider produces a label for a define/class etc. all segments of the name should be capitalized. The label is shown in error messages.\r\n\r\nReproduce with:\r\n{code}\r\nnotice Type[Foo::Bar::Fee]\r\n{code}\r\n\r\nWhich displays:\r\n{code}\r\nType[Foo::bar::fee]\r\n{code}\r\nwhen it should have been\r\n{code}\r\nType[Foo::Bar::Fee]\r\n{code}","closed_at":"2019-04-04T22:32:17.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2654","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:17.000-0700","timestamp":1652286051.141189,"priority":"Normal","status_category":"Done","pull_request":2810},{"issue_id":"38806","title":"Apply parses everything twice","url":"https://tickets.puppetlabs.com/browse/PUP-2757","created_at":"2014-06-11T13:27:41.000-0700","number":"PUP-2757","body":"When the runtime creates {{Puppet::Resource}} instances, an attempt is made to lookup its type. This means that code will attempt to lookup the type in {{known_resource_types}}. If {{known_resource_type}} is nil, the runtime will issue a call to {{initial_import}} which is the starting point of parsing and evaluating code.\r\n\r\nThe {{Puppet::Resource#envronment}} method attempts to figure out which environment to use (since that hold on to {{known_resource_type}} by looking at the resource instance's catalog's environment. The problem is when resource instances are created for the purpose of acting as a reference to a resource (rather than the instance itself), since such references are never contained in a Catalog per se. The {{environment}} method used a synthetic environment called {{NONE}} internally, and when {{NONE}} is not initialized the {{initial_import}} ill be called to again perform parsing.\r\n\r\nThis is fixed in this commit: https://github.com/hlindberg/puppet/commit/3ab10bc6ffe724a204e0fd2d1df0e651c9d93d66\r\n\r\nas part of PUP-2714, where this problem was detected.\r\n\r\nCurrently, the fix is is part of https://github.com/puppetlabs/puppet/pull/2749\r\n\r\nBut the issue is serious enough to warrant this ticket. There is a strong suspicion that the behavior also can cause leakage into the NONE environment (one env leaking into another). It is also probably worse for directory based environments since there is no file watching, and thus parsing never skips files when asked to parse them.\r\n\r\nNot sure what the right action here is except simply correcting the faulty behavior as per the PR-2749. Longer term, the notion of resource references requiring access to their type is something we want to get rid off.","closed_at":"2019-04-04T22:32:18.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2757","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:18.000-0700","timestamp":1652286051.89655,"priority":"Normal","status_category":"Done","pull_request":2873},{"issue_id":"15957","title":"(PR) (#4506) Don't serialize transient vars in Puppet::Resource","url":"https://tickets.puppetlabs.com/browse/PUP-447","created_at":"2013-10-01T12:25:47.000-0700","number":"PUP-447","body":"When serializing Ruby objects to YAML, Procs may be serialized that\r\ncannot be deserialized. Given the following example:\r\n\r\nYAML.load(YAML.dump lambda { \"hi\" })\r\nA TypeError is raised with the message \"allocator undefined for Proc\".\r\n\r\nCommit e161cbc introduced a new instance variable to Puppet::Resource,\r\n@rstype, which was the serialized resource_type for the given object.\r\nWhen a Puppet::Resource object was round tripped from YAML the\r\ndeserialization would fail with the above TypeError. Using Puppet's\r\nbuilt in deserialization (EG Puppet::Resource.convert_from('yaml', serialized_data))\r\nwould work, but directly parsing the YAML would fail.\r\n\r\nTo resolve this an explicit list of instance variables is specified for\r\nserialization, so instead of trying to serialize everything we only\r\nserialize the things we need.\r\n\r\nThis supersedes GH-1868.","closed_at":"2019-04-04T22:32:20.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-447","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:20.000-0700","timestamp":1652286052.703178,"priority":"Normal","status_category":"Done","pull_request":7663},{"issue_id":"10959","title":"File bucket and Puppet File resource: fails with \"regexp buffer overflow\" when backing up binary file","url":"https://tickets.puppetlabs.com/browse/PUP-19","created_at":"2013-06-17T17:30:26.000-0700","number":"PUP-19","body":"File contents are transferred to and from filebuckets as raw un-encoded bytes in a one element JSON hash. Aside from being inefficient for large files, transmitting unencoded binary in this fashion will croak the JSON parser.\n\n_NOTE:_ There is a trivial fix for this issue, which is to base-64 encode filebucket contents during transfer. However this change will break compatibility between agents and masters.","closed_at":"2019-04-04T22:32:21.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-19","labels":"redmine","state":"Closed","updated_at":"2019-04-04T22:32:21.000-0700","timestamp":1652286052.807301,"priority":"Major","status_category":"Done","pull_request":6866},{"issue_id":"35977","title":"Rack masters lose track of environment loaders","url":"https://tickets.puppetlabs.com/browse/PUP-2610","created_at":"2014-05-16T16:32:51.000-0700","number":"PUP-2610","body":"When a puppet master is running under rack the first few seconds of running will cause it to use the wrong modules if the {{[main]}} section has a different {{modulepath}} (or {{environmentpath}}) from the {{[master]}} section.\r\n\r\nReproduction:\r\n\r\nGiven a rack master with the following puppet.conf:\r\n{code}\r\n[main]\r\nmodulepath = /tmp/main-modules\r\n[master]\r\nmodulepath = /tmp/master-modules\r\n{code}\r\n\r\nInstall {{puppetlabs-stdlib}} into the {{/tmp/main-modules}} directory:\r\n{code}\r\n> puppet module install puppetlabs-stdlib\r\n{code}\r\n\r\nRestart the apache master (this is the command if you installed the puppetmaster-passenger package for debian):\r\n{code}\r\n> service apache2 restart\r\n{code}\r\n\r\nRun the agent:\r\n{code}\r\n> puppet agent -t\r\n{code}\r\n\r\nActual outcome:\r\n\r\nThe agent will run and start to download the stdlib functions as part of pluginsync. Part way through downloading it will start failing to fetch files with the reason that the files don't exist.\r\n\r\nExpected outcome:\r\n\r\nThe agent shouldn't pluginsync anything because the master's modulepath doesn't include any modules.","closed_at":"2019-04-04T22:32:21.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2610","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:21.000-0700","timestamp":1652286053.118849,"priority":"Critical","status_category":"Done","pull_request":2664},{"issue_id":"12630","title":"optional bindings does not work for autoloaded bindings","url":"https://tickets.puppetlabs.com/browse/PUP-197","created_at":"2013-07-30T09:28:44.000-0700","number":"PUP-197","body":"The binding schemes that makes use of the autoloader does not correctly handle optionality as they need to know if something will be loaded or not.\r\n\r\nThis could either be implemented by:\r\n\r\n - querying the autoloader if it will be able to load something (without actually loading), \r\n - performing early loading, stashing the result until it is being used (it may be excluded later so this is wasteful.\r\n - make the optionality carry through to the resolution phase (now optionality is checked when URIs are expanded and the effective set of included - excluded is processed.\r\n","closed_at":"2019-04-04T22:32:22.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-197","labels":"needs_decision","state":"Closed","updated_at":"2019-04-04T22:32:22.000-0700","timestamp":1652286053.436093,"priority":"Major","status_category":"Done","pull_request":2448},{"issue_id":"55003","title":"Blocks validate parameters incorrectly","url":"https://tickets.puppetlabs.com/browse/PUP-3461","created_at":"2014-10-14T12:29:35.000-0700","number":"PUP-3461","body":"h1. Problem\r\nThe following validation fails:\r\n\r\n{code}\r\nwith({ 1 => a, 2 => b }) |Hash[Integer, String] $x| { $x }\r\n{code}\r\n\r\nand produces the error:\r\n\r\n{noformat}\r\nError: Evaluation Error: Error while evaluating a Function Call, lambda called with mis-matched arguments\r\nexpected:\r\n  lambda(Hash[Integer, String] x) - arg count {1}\r\nactual:\r\n  lambda(Hash[Variant[Integer, Integer], Variant[String, String]]) - arg count {1} at /Users/andy/work/puppet/t.pp:7:1 on node aparker.corp.puppetlabs.net\r\n{noformat}\r\n\r\nHowever, an analogous type declaration for a {{define}} works:\r\n\r\n{code}\r\ndefine a(Hash[Integer, String] $x) {\r\n}\r\n\r\na { testing: x => { 1 => a, 2 => b } }\r\n{code}\r\n\r\nh2. Expected\r\n\r\nBoth of these cases should work in the same way. Either that has *is* a {{Hash[Integer, String]}} or it isn't.\r\n\r\nh1. Analysis\r\n\r\nUpon investigation, it turns out that the way EPP and blocks have parameters validated are different. {{define}} and {{class}} validation is done by calling {{Puppet::Pops::Types::TypeCalculator.instance?}} whereas the block validation is done by constructing a {{Callable}} of the given values, having a {{Callable}} of the declared types, and using {{Puppet::Pops::Types::TypeCalculator.callable?}}. The {{callable?}} method then delegates to {{Puppet::Pops::Types::TypeCalculator.assignable?}}.\r\n\r\nThe {{assignable?}} and {{instance?}} implementations are completely separate. They appear to have several places where the answers can diverge.  The above example is just one case.","closed_at":"2019-04-04T22:32:24.000-0700","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3461","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:24.000-0700","timestamp":1652286067.700648,"priority":"Critical","status_category":"Done","pull_request":3491},{"issue_id":"52964","title":"Attempt to use Numeric as title in a Resource type causes internal error","url":"https://tickets.puppetlabs.com/browse/PUP-3364","created_at":"2014-09-29T16:35:06.000-0700","number":"PUP-3364","body":"When an attempt is made to reference a resource and using a numeric title, the error messages that is emitted is \"Cannot use Fixnum where String is expected\" - which is technically correct, but it could be much more informative.\r\n\r\nThis is the result of doing something like:\r\n{code}\r\nFile[3]\r\nResource[sometype, 42]\r\n{code}\r\n\r\nA more specific error message should be used \"A Resource title cannot be numeric\" and with a proper reference to the source location.","closed_at":"2019-04-04T22:32:25.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3364","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:25.000-0700","timestamp":1652286068.217555,"priority":"Normal","status_category":"Done","pull_request":3136},{"issue_id":"37482","title":"deprecate that defining a class twice \"merges\" their behaviors","url":"https://tickets.puppetlabs.com/browse/PUP-2695","created_at":"2014-05-28T14:57:25.000-0700","number":"PUP-2695","body":"A new hire ([~erin]) is working through exercises and inadvertently defined a class twice in a file with surprising results.\r\n\r\n{code}\r\nclass test {\r\n  notice('testing')\r\n  notify { 'first': }\r\n}\r\n\r\nclass test {\r\n  notice('again')\r\n  notify { 'surprise!': }\r\n}\r\n\r\ninclude test\r\n{code}\r\n\r\n{code}\r\n[root@student ~]# puppet apply test.pp\r\nNotice: Scope(Class[Test]): testing\r\nNotice: Scope(Class[Test]): again\r\nNotice: Compiled catalog for student.puppetlabs.vm in environment production in 0.04 seconds\r\nNotice: surprise!\r\nNotice: /Stage[main]/Test/Notify[surprise!]/message: defined 'message' as 'surprise!'\r\nNotice: first\r\nNotice: /Stage[main]/Test/Notify[first]/message: defined 'message' as 'first'\r\nNotice: Finished catalog run in 0.18 seconds\r\n{code}\r\n\r\nShouldn't the parser error out on this? If not that, shouldn't the second definition replace the first? I would never expect this combining effect.\r\n\r\nThis should be controlled by the new {{\\--strict}} flag (PUP-5889). When it is set to warning or error output should be produced to indicate the problem.","closed_at":"2019-04-04T22:32:25.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2695","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:25.000-0700","timestamp":1652286068.425898,"priority":"Normal","status_category":"Done","pull_request":4729},{"issue_id":"27644","title":"Double backslashes in single quote strings should be interpreted as single","url":"https://tickets.puppetlabs.com/browse/PUP-1814","created_at":"2014-02-28T06:44:09.000-0800","number":"PUP-1814","body":"Double backslashes in single quoted strings should be interpreted as single backslashes but aren't.\r\n\r\nThe following manifest:\r\n{code}\r\n    notice('foo\\\\bar')\r\n{code}\r\nGives:\r\n{code}\r\n    notice: Scope(Class[main]): foo\\\\bar\r\n{code}\r\nThis is not the behavior described at [http://docs.puppetlabs.com/guides/language_guide.html#quoting](http://docs.puppetlabs.com/guides/language_guide.html#quoting)","closed_at":"2019-04-04T22:32:26.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1814","labels":"DSL;redmine","state":"Closed","updated_at":"2019-04-04T22:32:26.000-0700","timestamp":1652286068.532354,"priority":"Normal","status_category":"Done","pull_request":2400},{"issue_id":"20926","title":"Future evaluator should unique relationship operands","url":"https://tickets.puppetlabs.com/browse/PUP-994","created_at":"2013-12-11T13:41:28.000-0800","number":"PUP-994","body":"If a relationship operands contains the same reference more than once, the future evaluator will create duplicate relationships. The compiler handles this gracefully, but it is far better to ensure such requests are not made in the first place.\r\n\r\nThis is achieved with a simple call to {code}uniq{code} after they have been transformed and flattened.","closed_at":"2019-04-04T22:32:26.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-994","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:26.000-0700","timestamp":1652286068.6348,"priority":"Normal","status_category":"Done","pull_request":7664},{"issue_id":"49754","title":"node namespaces override class namespaces if they happen to match","url":"https://tickets.puppetlabs.com/browse/PUP-3167","created_at":"2014-09-02T03:33:19.000-0700","number":"PUP-3167","body":"if a node happens to match the name of a class, it will override its namespace with the node's namespace (which I didn't even know existed). I marked this as major b/c it potentially breaks any modules that rely on fully qualified namespace lookup (like apache)\r\n\r\nThe issue is probably better articulated with the following simple example:\r\n{code}\r\nclass foo {\r\n  $bar = 'one'\r\n}\r\n\r\nnode /foo/ {\r\n  $bar = 'two'\r\n  include foo\r\n  notice(\"${::foo::bar}\")\r\n}\r\n{code}","closed_at":"2019-04-04T22:32:27.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3167","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:27.000-0700","timestamp":1652286068.949996,"priority":"Major","status_category":"Done","pull_request":3590},{"issue_id":"21785","title":"Add feature switch for evaluator","url":"https://tickets.puppetlabs.com/browse/PUP-1176","created_at":"2013-12-18T13:54:12.000-0800","number":"PUP-1176","body":"Add a feature switch --evaluator that can be set to future or current.\r\nThis should toggle the use of the future evaluator.\r\n\r\nWe can later decide if it should be current or future by default.","closed_at":"2019-04-04T22:32:27.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1176","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:27.000-0700","timestamp":1652286069.054469,"priority":"Normal","status_category":"Done","pull_request":2209},{"issue_id":"40269","title":"Puppet does not work with RGen 0.7.0","url":"https://tickets.puppetlabs.com/browse/PUP-2831","created_at":"2014-06-24T12:05:54.000-0700","number":"PUP-2831","body":"As discovered in PUP-2755, strange things happen when using RGen 0.7.0 with puppet.","closed_at":"2019-04-04T22:32:27.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2831","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:27.000-0700","timestamp":1652286069.167256,"priority":"Major","status_category":"Done","pull_request":2802},{"issue_id":"49019","title":"Intermittent acceptance failure in resource/service/ticket_14297_handle_upstart.rb","url":"https://tickets.puppetlabs.com/browse/PUP-3136","created_at":"2014-08-25T07:53:12.000-0700","number":"PUP-3136","body":"Just recently there have been a few intermittent failures in resource/service/ticket_14297_handle_upstart.rb. (Btw note that this test is confined to Ubuntu.) Three examples:\r\n\r\nhttps://jenkins.puppetlabs.com/job/Puppet-Package-Acceptance-4.0/label=acc-coord,platform=precise/212/consoleFull\r\n\r\nhttps://jenkins.puppetlabs.com/view/Puppet%20FOSS/view/Master/job/Puppet-Package-Acceptance-master/787/label=acc-coord,platform=lucid/consoleText\r\n\r\nhttps://jenkins.puppetlabs.com/view/Puppet%20FOSS/view/Master/job/Puppet-Package-Acceptance-master/786/label=acc-coord,platform=precise_and_lucid/consoleText\r\n\r\nIn all 3 of these cases the test fails trying to manage the apache service on the master.","closed_at":"2019-04-04T22:32:29.000-0700","comments":28,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3136","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:29.000-0700","timestamp":1652286069.903596,"priority":"Normal","status_category":"Done","pull_request":3083},{"issue_id":"11261","title":"Stack level too deep after updating from 3.1.1 to 3.2.2","url":"https://tickets.puppetlabs.com/browse/PUP-51","created_at":"2013-06-20T21:20:26.000-0700","number":"PUP-51","body":null,"closed_at":"2019-04-04T22:32:29.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-51","labels":"","state":"Resolved","updated_at":"2019-04-04T22:32:29.000-0700","timestamp":1652286070.112006,"priority":"Blocker","status_category":"Done","pull_request":7678},{"issue_id":"31543","title":"Many puppet commands fail when using a configured or requested directory environment that doesn't exist.","url":"https://tickets.puppetlabs.com/browse/PUP-2214","created_at":"2014-04-10T17:58:02.000-0700","number":"PUP-2214","body":"This original description is documenting the difference between an agent making a request for an environment that does not exist, and an agent making a request for an environment that does not exist which also happens to be the configured environment on the master.\r\n\r\nOn rhel6 vms, with a master puppet.conf of:\r\n\r\n{code}\r\n[main]\r\n    # The Puppet log directory.\r\n    # The default value is '$vardir/log'.\r\n    logdir = /var/log/puppet\r\n\r\n    # Where Puppet PID files are kept.\r\n    # The default value is '$vardir/run'.\r\n    rundir = /var/run/puppet\r\n\r\n    # Where SSL certificates are kept.\r\n    # The default value is '$confdir/ssl'.\r\n    ssldir = $vardir/ssl\r\n\r\n    environmentpath = $confdir/environments\r\n\r\n[agent]\r\n    # The file in which puppetd stores a list of the classes\r\n    # associated with the retrieved configuratiion.  Can be loaded in\r\n    # the separate ``puppet`` executable using the ``--loadclasses``\r\n    # option.\r\n    # The default value is '$confdir/classes.txt'.\r\n    classfile = $vardir/classes.txt\r\n\r\n    # Where puppetd caches the local configuration.  An\r\n    # extension indicating the cache format is added automatically.\r\n    # The default value is '$confdir/localconfig'.\r\n    localconfig = $vardir/localconfig\r\n    server = k2jv2z7f3vrqsoj.delivery.puppetlabs.net\r\n{code}\r\n\r\nand environments:\r\n\r\n{code}\r\n[root@k2jv2z7f3vrqsoj puppet]# tree /etc/puppet/environments/\r\n/etc/puppet/environments/\r\n└── foo\r\n\r\n1 directory, 0 files\r\n{code}\r\n\r\nThis agent call produces:\r\n\r\n{code}\r\n[root@ueu8qnql450gx07 ~]# puppet agent -t --environment doesnotexist\r\nInfo: Retrieving pluginfacts\r\nError: /File[/var/lib/puppet/facts.d]: Could not evaluate: Could not retrieve information from environment doesnotexist source(s) puppet://k2jv2z7f3vrqsoj.delivery.puppetlabs.net/pluginfacts\r\nInfo: Retrieving plugin\r\nError: /File[/var/lib/puppet/lib]: Could not evaluate: Could not retrieve information from environment doesnotexist source(s) puppet://k2jv2z7f3vrqsoj.delivery.puppetlabs.net/plugins\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\n{code}\r\n\r\nAnd this one:\r\n{code}\r\n[root@ueu8qnql450gx07 ~]# puppet agent -t --environment production\r\nInfo: Retrieving pluginfacts\r\nError: /File[/var/lib/puppet/facts.d]: Could not evaluate: Could not retrieve information from environment production source(s) puppet://k2jv2z7f3vrqsoj.delivery.puppetlabs.net/pluginfacts\r\nInfo: Retrieving plugin\r\nError: /File[/var/lib/puppet/lib]: Could not evaluate: Could not retrieve information from environment production source(s) puppet://k2jv2z7f3vrqsoj.delivery.puppetlabs.net/plugins\r\nInfo: Caching catalog for ueu8qnql450gx07.delivery.puppetlabs.net\r\nInfo: Applying configuration version '1397175258'\r\nNotice: Finished catalog run in 0.03 seconds\r\n{code}\r\n","closed_at":"2019-04-04T22:32:30.000-0700","comments":20,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2214","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:30.000-0700","timestamp":1652286070.22076,"priority":"Minor","status_category":"Done","pull_request":2631},{"issue_id":"56422","title":"Future parser, square brackets in references cause syntax errors related to non-ASCII characters","url":"https://tickets.puppetlabs.com/browse/PUP-3558","created_at":"2014-10-28T09:06:04.000-0700","number":"PUP-3558","body":"After upgrading our puppet master to 3.7.2 we started to get syntax errors in our site.pp file. After some binary search/deletions we ended up with the attached example which does not seem to allow further deletions or the syntax error will disappear.\r\n\r\nThe error always happens on the open square bracket of the reference in the resource parameter. It occurs even if the parameter is turned into an array (additional square brackets). The names are intentionally minimized, originally it was a file resource but the resource type does not seem to matter (and I would not expect it to for a syntax error).\r\n\r\nNamespaces (double colons at the start or inside the name) or lack thereof in the referenced name don't seem to matter.\r\n\r\nStrangely enough deleting any additional characters from the referenced resource title makes the error disappear though it was originally two characters longer. If the title is completely removed, including quotes, the syntax error suddenly shows correctly on the closing square bracket instead of the opening one.\r\n\r\nIf any of the umlaut characters on the first line are removed the error disappears too. The context they appear in (comment, string,...) does not seem to matter, originally they were part of some strings and some comments inside our site.pp. Spacing does not seem to matter here either.\r\n\r\nThe syntax error disappears if the reference is not in the context of a parameter. Not all references in parameters trigger it. Originally the line was on line ~5000 of our site.pp, when commented out the next occurrence was on ~7500 where several of them appeared in a row when commenting the current error out.\r\n\r\nI set the priority to major because it completely prevents use of Puppet 3.7.2 as a puppet master as the bug does not seem to behave in a very predictable fashion.","closed_at":"2019-04-04T22:32:31.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3558","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:31.000-0700","timestamp":1652286071.025292,"priority":"Major","status_category":"Done","pull_request":3250},{"issue_id":"41450","title":"collection of classes should raise a meaningful error","url":"https://tickets.puppetlabs.com/browse/PUP-2902","created_at":"2014-07-07T14:53:19.000-0700","number":"PUP-2902","body":"If an attempt is made to collect classes\r\n{code}\r\nClass <| |>\r\n{code}\r\nThe 3x runtime issues an error that says:\r\n{code}\r\nError: Resource type class doesn't exist\r\n{code}\r\nWhich is misleading.\r\n\r\nThe 4x runtime fails with this message: (essentially the same).\r\n{code}\r\nError while evaluating a Virtual Query, Resource type class doesn't exist\r\n{code}\r\n\r\nThe message should say that it is invalid/not allowed to collect classes.\r\nThe logic should not even attempt to collect.\r\n","closed_at":"2019-04-04T22:32:32.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2902","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:32.000-0700","timestamp":1652286071.768847,"priority":"Normal","status_category":"Done","pull_request":2847},{"issue_id":"28262","title":"Cannot render EPP templates from a module","url":"https://tickets.puppetlabs.com/browse/PUP-1894","created_at":"2014-03-07T14:37:26.000-0800","number":"PUP-1894","body":"According to the [module guide section about templates|http://docs.puppetlabs.com/puppet/latest/reference/modules_fundamentals.html#templates] a template is found in a module's template directory by joining the module name with the template name. However the {{epp}} function doesn't seem to be able to do this. It also does not find the template if the module name is left off.\r\n\r\nh2. Example\r\n\r\n{noformat}\r\n> tree ~/.puppet/environments/foo/modules/\r\n/Users/andy/.puppet/environments/foo/modules/\r\n└── foo\r\n    ├── manifests\r\n    │   └── init.pp\r\n    └── templates\r\n        ├── template.epp\r\n        └── template.erb\r\n> cat ~/.puppet/environments/foo/modules/foo/templates/template.epp\r\n<%= $x %>\r\n> cat ~/.puppet/environments/foo/modules/foo/templates/template.erb\r\n<%= @value %>\r\n> cat ~/.puppet/environments/foo/modules/foo/manifests/init.pp\r\nclass foo($value) {\r\n  notice(epp(\"foo/template.epp\", { x => $value }))\r\n  notice(template(\"foo/template.erb\"))\r\n}\r\n> be puppet apply -e \"class { foo: value => 3 }\" --parser future --environment foo\r\nError: Evaluation Error: Error while evaluating a Function Call, undefined method `module' for \"foo\":String at /Users/andy/.puppet/environments/foo/modules/foo/manifests/init.pp:2:10 on node aparker.corp.puppetlabs.net\r\nError: Evaluation Error: Error while evaluating a Function Call, undefined method `module' for \"foo\":String at /Users/andy/.puppet/environments/foo/modules/foo/manifests/init.pp:2:10 on node aparker.corp.puppetlabs.net\r\n{noformat}\r\n\r\nUncommenting the epp line shows that the erb line works.","closed_at":"2019-04-04T22:32:33.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1894","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:33.000-0700","timestamp":1652286071.979946,"priority":"Normal","status_category":"Done","pull_request":2667},{"issue_id":"22690","title":"Deprecate and eliminate magic parameter array handling","url":"https://tickets.puppetlabs.com/browse/PUP-1299","created_at":"2013-12-30T15:09:01.000-0800","number":"PUP-1299","body":"Puppet's parser will automatically de-arrayify single element arrays for parameters (and properties). See `lib/puppet/parser/resource.rb`\r\n\r\n{code}\r\nresult[p] = if v.is_a?(Array) and v.length == 1\r\n                    v[0]\r\n                  else\r\n                    v\r\n                  end\r\n{code}\r\n\r\nAs a result when writing a custom type, the parameter's validate and munge methods may receive an array or string depending on what values were specified in the manifest. This leads to idioms such as:\r\n\r\n{code}\r\nmunge do |value|\r\n  # I don't really know how this is happening.\r\n  value = value.shift if value.is_a?(Array)\r\n{code}\r\n\r\nand\r\n\r\n{code}\r\nmunge do |value|\r\n  value = [value] unless value.is_a?(Array)\r\n{code}\r\n\r\nHowever, the magic only happens when parsing a manifest, not when writing tests that create resources. For example:\r\n\r\n{code}\r\n$ puppet apply -e \"exec { '/bin/true': environment => [ 'foo=bar']}\"\r\nvalues = [values] unless values.is_a? Array\r\n(rdb:1) values\r\n\"foo=bar\"\r\n{code}\r\n\r\nBut:\r\n\r\n{code}\r\n$ irb\r\n>> require 'puppet'\r\n>> Puppet::Type.type(:exec).new(:command => '/bin/true', :environment => ['foo=bar'])\r\nvalues = [values] unless values.is_a? Array\r\n(rdb:1) values\r\n[\"foo=bar\"]\r\n{code}\r\n\r\nIf a parameter only accepts a single argument, then the DSL should support this easily, e.g. `newparam(:timeout, :array => false)`\r\n\r\nSee also [#6746|http://projects.puppetlabs.com/issues/6746] and https://github.com/puppetlabs/puppet/commit/46252b5bb858a1f2b87cc8646f3a59f935c58061","closed_at":"2019-04-04T22:32:34.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1299","labels":"future-parser;redmine","state":"Closed","updated_at":"2019-04-04T22:32:34.000-0700","timestamp":1652286072.399835,"priority":"Normal","status_category":"Done","pull_request":2791},{"issue_id":"33977","title":"Puppet's v2 environment listing does not display config_version and environment_timeout as well.","url":"https://tickets.puppetlabs.com/browse/PUP-2426","created_at":"2014-05-01T15:47:33.000-0700","number":"PUP-2426","body":"We added config_version and environment_timeout settings to directory environment environment.conf.  Puppet's v2 environments listing needs to show these environment parameters as well.  (lib/puppet/network/http/api/v2/environments.rb)\r\n\r\nWill also need to update the API docs for v2.0/environments","closed_at":"2019-04-04T22:32:35.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2426","labels":"docs_reviewed","state":"Closed","updated_at":"2019-04-04T22:32:35.000-0700","timestamp":1652286072.620315,"priority":"Normal","status_category":"Done","pull_request":2757},{"issue_id":"16838","title":"(#22891) Use the most preferred supported format","url":"https://tickets.puppetlabs.com/browse/PUP-570","created_at":"2013-10-16T13:21:30.000-0700","number":"PUP-570","body":null,"closed_at":"2019-04-04T22:32:36.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-570","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:36.000-0700","timestamp":1652286073.042627,"priority":"Normal","status_category":"Done","pull_request":8745},{"issue_id":"16292","title":"Line number information missing from 3x AST transformer errors","url":"https://tickets.puppetlabs.com/browse/PUP-528","created_at":"2013-10-04T17:47:14.000-0700","number":"PUP-528","body":"The AST transformer raises errors that do not contain any line information. These errors are for things that were not caught by the validator (most should).\n\nNot sure if it is ok with just a general wrapper around transformation (polymorphic calls) and using the line information of the semantic object. This may be good enough as the transformer will eventually not be used.\n\nThere is an implementation with a general catch, and all transformation that is actually used in future parser/evaluator is safe guarded by this.\n\nIt is probably mostly a matter of doing a functional review.","closed_at":"2019-04-04T22:32:36.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-528","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:36.000-0700","timestamp":1652286073.146612,"priority":"Normal","status_category":"Done","pull_request":7263},{"issue_id":"28272","title":"EPP ignores code after parameter declaration","url":"https://tickets.puppetlabs.com/browse/PUP-1897","created_at":"2014-03-07T16:39:44.000-0800","number":"PUP-1897","body":"If the parameter declaration for a single parameter in an EPP template is in a {{<%= ... %>}} snippet along with other code, the parameter declaration seems to be evaluated but all of the following code is ignored. If multiple parameters are specified then it ends up being a syntax error.\r\n\r\nExample\r\n{noformat}\r\n> be puppet apply -e \"notice(inline_epp('<%= (\\$x) \\$x + 1 %>', { x => 2 }))\" --parser future\r\nNotice: Scope(Class[main]): 2\r\nNotice: Compiled catalog for aparker.corp.puppetlabs.net in environment production in 0.39 seconds\r\nNotice: Finished catalog run in 0.03 seconds\r\n{noformat}\r\n\r\nExample of the error when there are multiple parameters\r\n{noformat}\r\n> be puppet apply -e \"notice(inline_epp('<%= (\\$x, \\$y) \\$x + 1 %>', { x => 2, y => 4 }))\" --parser future\r\nError: Evaluation Error: Error while evaluating a Function Call, inline_epp(): Invalid EPP: Syntax error at ',' at inlined-epp-text:1:8 at line 1:8 on node aparker.corp.puppetlabs.net\r\nError: Evaluation Error: Error while evaluating a Function Call, inline_epp(): Invalid EPP: Syntax error at ',' at inlined-epp-text:1:8 at line 1:8 on node aparker.corp.puppetlabs.net\r\n{noformat}\r\n\r\nI would expect either a syntax error or the parameter declaration to be interpreted as such and the body evaluated.","closed_at":"2019-04-04T22:32:37.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1897","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:37.000-0700","timestamp":1652286073.470073,"priority":"Normal","status_category":"Done","pull_request":2424},{"issue_id":"10977","title":"Deprecate YAML over the network","url":"https://tickets.puppetlabs.com/browse/PUP-31","created_at":"2013-06-17T17:51:57.000-0700","number":"PUP-31","body":"Deprecate using YAML over the network in Puppet. This may require the implementation of pson support in some places where it doesn't currently exist.","closed_at":"2019-04-04T22:32:37.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-31","labels":"","state":"Resolved","updated_at":"2019-04-04T22:32:37.000-0700","timestamp":1652286073.57386,"priority":"Major","status_category":"Done","pull_request":6884},{"issue_id":"34334","title":"`puppet module build` should provide deprecated functionality with warning until Puppet v4","url":"https://tickets.puppetlabs.com/browse/PUP-2484","created_at":"2014-05-06T07:54:35.000-0700","number":"PUP-2484","body":"With the recent changes in the PMT tool, if you have both a Modulefile and metadata.json file, the Modulefile will be completely ignored, breaking current functionality. The ultimate goal is to get to this behavior of using the metadata.json file only but needs to be deprecated in a manner that still provides the current functionality with a warning and then removed in Puppet v4.\r\n\r\nThat deprecated functionality is outlined below.\r\n\r\nFrom [~hunter] (paraphrased from PUP-1976):\r\n\r\n{quote}\r\n[The changes with PMT Build have a] backwards-incompatible nature [that] will currently break the packaging of all of our modules.\r\nExample:: We only declare dependencies in the Modulefile but not metadata.json. We also don't synchronize the versions in Modulefile and metadata.json because pmt prefers the Modulefile version over metadata.json invisibly.\r\n\r\nSuggestion: The pmt should merge Modulefile and metadata.json entries, preferring the entries in Modulefile for conflicts. It should warn that support for Modulefile is deprecated and it will only use metadata.json in the future. It would also be helpful if it warned about every entry that exists in Modulefile but is different or non-existent in the metadata.json\r\n{quote}","closed_at":"2019-04-04T22:32:39.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2484","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:39.000-0700","timestamp":1652286073.894287,"priority":"Normal","status_category":"Done","pull_request":2619},{"issue_id":"20494","title":"Case and Selector expressions using Regexp type does not set match vars","url":"https://tickets.puppetlabs.com/browse/PUP-957","created_at":"2013-12-07T19:52:39.000-0800","number":"PUP-957","body":"Since =~ operator treats the Regexp type as if it were a regular expression and sets the match variables, so should the other conditional expressions that invoke pattern matching (case and selector).\r\n\r\nThis is missing in the new evaluator implementation. (Matching is still done, but without the side effect of setting the match variables).","closed_at":"2019-04-04T22:32:41.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-957","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:41.000-0700","timestamp":1652286074.312963,"priority":"Normal","status_category":"Done","pull_request":8672},{"issue_id":"11362","title":"Data bindings don't set calling_module / calling_class variables during lookups","url":"https://tickets.puppetlabs.com/browse/PUP-83","created_at":"2013-06-24T22:54:43.000-0700","number":"PUP-83","body":"According to [the Hiera documentation](http://docs.puppetlabs.com/hiera/1/puppet.html#special-pseudo-variables) these variables are available \"when doing any Hiera lookup, with both automatic parameter lookup and the Hiera functions\".\n\nHowever:\n\n> The automatic parameter lookup uses a different scope (Puppet::DataBinding) than the explicit lookup with the hiera function (Hiera::Scope). The calling_module and calling_class variables are generated in Hiera::Scope and therefore are not available when automatic parameter lookup is used. This breaks hiera configurations that make use of those variables for lookups. \n\nThe classes `Hiera::Scope` and `Puppet::DataBinding::Variables` are nearly duplicates of each other. These classes should possibly be re-factored into a single interface so there is no drift in capability if someone forgets to create duplicate code for both classes when a common feature is added.","closed_at":"2019-04-04T22:32:41.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-83","labels":"redmine","state":"Closed","updated_at":"2019-04-04T22:32:41.000-0700","timestamp":1652286074.41861,"priority":"Major","status_category":"Done","pull_request":7977},{"issue_id":"48695","title":"Puppet needs to use default keylength 2048 on FIPS enabled systems","url":"https://tickets.puppetlabs.com/browse/PUP-3114","created_at":"2014-08-20T12:53:56.000-0700","number":"PUP-3114","body":"FIPS 140-2 does not allow for the use of 4096 bit keys. Therefore, the initial certificate generation of a key using a key length > 2048 bits will fail.\r\n\r\nAny system that is FIPS enabled, should use a 2048 bit key when generating the initial CA and server certificates.","closed_at":"2019-04-04T22:32:45.000-0700","comments":21,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3114","labels":"DOCS","state":"Closed","updated_at":"2019-04-04T22:32:45.000-0700","timestamp":1652286075.923309,"priority":"Normal","status_category":"Done","pull_request":3044},{"issue_id":"30219","title":"Puppet module install --force does not re-install dependencies","url":"https://tickets.puppetlabs.com/browse/PUP-2078","created_at":"2014-03-27T08:09:01.000-0700","number":"PUP-2078","body":"Installing a module from forge on the commandline with --force does not (re)install its dependencies.\r\n\r\ninstalling normally\r\n{code}\r\n$ puppet module install puppetlabs-ntp\r\nNotice: Preparing to install into /etc/puppet/modules ...\r\nNotice: Downloading from https://forge.puppetlabs.com ...\r\nNotice: Installing -- do not interrupt ...\r\n/etc/puppet/modules\r\n└─┬ puppetlabs-ntp (v3.0.3)\r\n  └── puppetlabs-stdlib (v4.1.0)\r\n{code}\r\n\r\nNow with --force:\r\n{code}\r\n$ puppet module install --force puppetlabs-ntp\r\nNotice: Preparing to install into /etc/puppet/modules ...\r\nNotice: Downloading from https://forge.puppetlabs.com ...\r\nNotice: Installing -- do not interrupt ...\r\n/etc/puppet/modules\r\n└── puppetlabs-ntp (v3.0.3)\r\n{code}\r\n\r\nThe description of --force is: \"Force overwrite of existing module, if any.\"\r\nAnd there is also an --ignore-dependencies flag \"Do not attempt to install dependencies\".\r\n\r\nApparently --force also implies --ignore-dependencies which is not expected behaviour. If the user would want to ignore dependencies he would just use the --ignore-dependencies flag.\r\n\r\nPresently it is not possible to reinstall puppet modules without completely wiping all /etc/puppet/modules.","closed_at":"2019-04-04T22:32:45.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2078","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:45.000-0700","timestamp":1652286076.029247,"priority":"Normal","status_category":"Done","pull_request":2852},{"issue_id":"52976","title":"type system does not handle Enum/String compare correctly","url":"https://tickets.puppetlabs.com/browse/PUP-3366","created_at":"2014-09-29T19:25:00.000-0700","number":"PUP-3366","body":"{code}\r\nEnum[blue] < String\r\n{code}\r\nshould be true, but it isn't.\r\n{code}\r\nEnum < String\r\n{code}\r\nshould be true but fails with a comparison of fixnum vs. integer in the type calculator.\r\n\r\nWhile any enum is in fact the same as any string, it should still be considered more specific (they are not equal as types at least).","closed_at":"2019-04-04T22:32:46.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3366","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:46.000-0700","timestamp":1652286076.353481,"priority":"Normal","status_category":"Done","pull_request":3134},{"issue_id":"40170","title":"Make $title and $name Reserved Words","url":"https://tickets.puppetlabs.com/browse/PUP-2824","created_at":"2014-06-23T16:24:43.000-0700","number":"PUP-2824","body":"If one creates a class with {{$name}} or {{$title}} in it and assigns them default values, if a user later tries to instantiate this class using the default values, Puppet will generate an error.\r\n\r\nConsider the following:\r\nThe setup:\r\n{code}\r\n# manifests/init.pp\r\nclass pup514 {\r\n  define bark(String $name = 'No Name', Integer $phone = 0) {\r\n    notice \"Name: '$name', Number: '$phone'\"\r\n  }\r\n}  \r\n\r\n# tests/init.pp\r\npup514::bark { 'obj1': name => 'Jenny', phone => 8675309, }\r\npup514::bark { 'obj2': name => 'Pennsylvania', phone => 65000, }\r\npup514::bark { 'obj3': name => 'Rhonda', }\r\npup514::bark { 'obj4': phone => 42, }\r\npup514::bark { 'obj5': }\r\n{code}\r\n\r\nThe output from this manifest is not quite what I expected. Specifically, for {{obj4}} and {{obj5}}, I was expecting the default values to be used where the parameters are missing.\r\n{code}\r\n$ be puppet apply krw-pup514/tests/init.pp\r\nNotice: Name: 'Jenny', Number: '8675309'\r\nNotice: Name: 'Pennsylvania', Number: '65000'\r\nNotice: Name: 'Rhonda', Number: '0'\r\nError: Cannot reassign variable name on node ubuntu.localdomain\r\nError: Cannot reassign variable name on node ubuntu.localdomain\r\n{code}\r\nI expected:\r\n{code}\r\nNotice: Name: 'Jenny', Number: '8675309'\r\nNotice: Name: 'Pennsylvania', Number: '65000'\r\nNotice: Name: 'Rhonda', Number: '0'\r\nNotice: Name: 'No Name', Number: '42'\r\nNotice: Name: 'No Name', Number: '0'\r\n{code}","closed_at":"2019-04-04T22:32:49.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2824","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:49.000-0700","timestamp":1652286077.231194,"priority":"Normal","status_category":"Done","pull_request":2804},{"issue_id":"25669","title":"\"contain\" cannot contain a fully qualified class","url":"https://tickets.puppetlabs.com/browse/PUP-1597","created_at":"2014-02-06T04:41:03.000-0800","number":"PUP-1597","body":"nested contains don't appeare to work. I'm hitting this issue when trying to {{contain}} puppetlabs/mysql::client, but the issue can be reproduced quite simply:\r\n\r\n{code}\r\n#\r\nclass mybug::client (\r\n  $package_ensure  = 'present',\r\n  $package_name    = 'mysql',\r\n){\r\n  package { 'mybug_client':\r\n    ensure => $mybug::client::package_ensure,\r\n    name   => $mybug::client::package_name,\r\n  }\r\n}\r\n{code}\r\n{code}\r\nclass profile::mybug {\r\n  contain ::mybug::client\r\n}\r\n{code}\r\n\r\nNow, if we call {{puppet apply --debug -e 'include ::profile::mybug'}}, we get:\r\n{code}\r\nWARNING: Nokogiri was built against LibXML version 2.9.0, but has dynamically loaded 2.9.1\r\nInfo: Loading facts in /etc/puppet/modules/stdlib/lib/facter/facter_dot_d.rb\r\nInfo: Loading facts in /etc/puppet/modules/stdlib/lib/facter/root_home.rb\r\nInfo: Loading facts in /etc/puppet/modules/stdlib/lib/facter/puppet_vardir.rb\r\nInfo: Loading facts in /etc/puppet/modules/stdlib/lib/facter/pe_version.rb\r\nWarning: Could not retrieve fact fqdn\r\nDebug: importing '/etc/puppet/modules/profile/manifests/mybug.pp' in environment production\r\nDebug: Automatically imported profile::mybug from profile/mybug into production\r\nDebug: importing '/etc/puppet/modules/mybug/manifests/init.pp' in environment production\r\nDebug: importing '/etc/puppet/modules/mybug/manifests/client.pp' in environment production\r\nDebug: Automatically imported mybug::client from mybug/client into production\r\nDebug: hiera(): Hiera YAML backend starting\r\nDebug: hiera(): Looking up mybug::client::package_ensure in YAML backend\r\nDebug: hiera(): Looking for data source production\r\nDebug: hiera(): Cannot find datafile /var/lib/hiera/production.yaml, skipping\r\nDebug: hiera(): Looking for data source global\r\nDebug: hiera(): Looking up mybug::client::package_name in YAML backend\r\nDebug: hiera(): Looking for data source production\r\nDebug: hiera(): Cannot find datafile /var/lib/hiera/production.yaml, skipping\r\nDebug: hiera(): Looking for data source global\r\nError: undefined method `ref' for nil:NilClass on node levix\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/resource/catalog.rb:527:in `block in to_catalog'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/resource/catalog.rb:515:in `each'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/resource/catalog.rb:515:in `to_catalog'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/resource/catalog.rb:402:in `to_resource'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/parser/compiler.rb:24:in `compile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/indirector/catalog/compiler.rb:116:in `block (2 levels) in compile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util/profiler/none.rb:6:in `profile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util/profiler.rb:31:in `profile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/indirector/catalog/compiler.rb:114:in `block in compile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util.rb:161:in `block in benchmark'\r\n/usr/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util.rb:160:in `benchmark'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/indirector/catalog/compiler.rb:113:in `compile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/indirector/catalog/compiler.rb:46:in `find'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/indirector/indirection.rb:201:in `find'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application/apply.rb:204:in `main'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application/apply.rb:146:in `run_command'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application.rb:364:in `block (2 levels) in run'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application.rb:470:in `plugin_hook'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application.rb:364:in `block in run'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util.rb:478:in `exit_on_fail'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application.rb:364:in `run'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util/command_line.rb:137:in `run'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util/command_line.rb:91:in `execute'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/bin/puppet:4:in `<top (required)>'\r\n/usr/local/bin/puppet:23:in `load'\r\n/usr/local/bin/puppet:23:in `<main>'\r\nError: undefined method `ref' for nil:NilClass on node levix\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/resource/catalog.rb:527:in `block in to_catalog'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/resource/catalog.rb:515:in `each'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/resource/catalog.rb:515:in `to_catalog'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/resource/catalog.rb:402:in `to_resource'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/parser/compiler.rb:24:in `compile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/indirector/catalog/compiler.rb:116:in `block (2 levels) in compile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util/profiler/none.rb:6:in `profile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util/profiler.rb:31:in `profile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/indirector/catalog/compiler.rb:114:in `block in compile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util.rb:161:in `block in benchmark'\r\n/usr/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util.rb:160:in `benchmark'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/indirector/catalog/compiler.rb:113:in `compile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/indirector/catalog/compiler.rb:46:in `find'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/indirector/indirection.rb:201:in `find'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application/apply.rb:204:in `main'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application/apply.rb:146:in `run_command'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application.rb:364:in `block (2 levels) in run'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application.rb:470:in `plugin_hook'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application.rb:364:in `block in run'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util.rb:478:in `exit_on_fail'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application.rb:364:in `run'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util/command_line.rb:137:in `run'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util/command_line.rb:91:in `execute'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/bin/puppet:4:in `<top (required)>'\r\n/usr/local/bin/puppet:23:in `load'\r\n/usr/local/bin/puppet:23:in `<main>'\r\n{code}\r\n\r\nAlternatively, if we call {{sudo puppet apply --debug -e 'contain ::mybug::client'}}, we get\r\n{code}\r\nWARNING: Nokogiri was built against LibXML version 2.9.0, but has dynamically loaded 2.9.1\r\nInfo: Loading facts in /etc/puppet/modules/stdlib/lib/facter/facter_dot_d.rb\r\nInfo: Loading facts in /etc/puppet/modules/stdlib/lib/facter/root_home.rb\r\nInfo: Loading facts in /etc/puppet/modules/stdlib/lib/facter/puppet_vardir.rb\r\nInfo: Loading facts in /etc/puppet/modules/stdlib/lib/facter/pe_version.rb\r\nWarning: Could not retrieve fact fqdn\r\nDebug: importing '/etc/puppet/modules/mybug/manifests/init.pp' in environment production\r\nDebug: importing '/etc/puppet/modules/mybug/manifests/client.pp' in environment production\r\nDebug: Automatically imported mybug::client from mybug/client into production\r\nDebug: hiera(): Hiera YAML backend starting\r\nDebug: hiera(): Looking up mybug::client::package_ensure in YAML backend\r\nDebug: hiera(): Looking for data source production\r\nDebug: hiera(): Cannot find datafile /var/lib/hiera/production.yaml, skipping\r\nDebug: hiera(): Looking for data source global\r\nDebug: hiera(): Looking up mybug::client::package_name in YAML backend\r\nDebug: hiera(): Looking for data source production\r\nDebug: hiera(): Cannot find datafile /var/lib/hiera/production.yaml, skipping\r\nDebug: hiera(): Looking for data source globalError: undefined method `tag' for nil:NilClass on node levix\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/parser/compiler.rb:443:in `block in add_resource_metaparams'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/graph/simple_graph.rb:355:in `block in walk'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/graph/simple_graph.rb:354:in `each'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/graph/simple_graph.rb:354:in `walk'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/parser/compiler.rb:432:in `add_resource_metaparams'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/parser/compiler.rb:419:in `finish'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/parser/compiler.rb:119:in `block in compile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util/profiler/none.rb:6:in `profile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util/profiler.rb:31:in `profile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/parser/compiler.rb:119:in `compile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/parser/compiler.rb:24:in `compile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/indirector/catalog/compiler.rb:116:in `block (2 levels) in compile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util/profiler/none.rb:6:in `profile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util/profiler.rb:31:in `profile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/indirector/catalog/compiler.rb:114:in `block in compile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util.rb:161:in `block in benchmark'\r\n/usr/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util.rb:160:in `benchmark'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/indirector/catalog/compiler.rb:113:in `compile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/indirector/catalog/compiler.rb:46:in `find'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/indirector/indirection.rb:201:in `find'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application/apply.rb:204:in `main'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application/apply.rb:146:in `run_command'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application.rb:364:in `block (2 levels) in run'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application.rb:470:in `plugin_hook'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application.rb:364:in `block in run'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util.rb:478:in `exit_on_fail'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application.rb:364:in `run'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util/command_line.rb:137:in `run'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util/command_line.rb:91:in `execute'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/bin/puppet:4:in `<top (required)>'\r\n/usr/local/bin/puppet:23:in `load'\r\n/usr/local/bin/puppet:23:in `<main>'\r\nError: undefined method `tag' for nil:NilClass on node levix\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/parser/compiler.rb:443:in `block in add_resource_metaparams'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/graph/simple_graph.rb:355:in `block in walk'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/graph/simple_graph.rb:354:in `each'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/graph/simple_graph.rb:354:in `walk'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/parser/compiler.rb:432:in `add_resource_metaparams'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/parser/compiler.rb:419:in `finish'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/parser/compiler.rb:119:in `block in compile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util/profiler/none.rb:6:in `profile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util/profiler.rb:31:in `profile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/parser/compiler.rb:119:in `compile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/parser/compiler.rb:24:in `compile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/indirector/catalog/compiler.rb:116:in `block (2 levels) in compile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util/profiler/none.rb:6:in `profile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util/profiler.rb:31:in `profile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/indirector/catalog/compiler.rb:114:in `block in compile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util.rb:161:in `block in benchmark'\r\n/usr/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util.rb:160:in `benchmark'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/indirector/catalog/compiler.rb:113:in `compile'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/indirector/catalog/compiler.rb:46:in `find'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/indirector/indirection.rb:201:in `find'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application/apply.rb:204:in `main'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application/apply.rb:146:in `run_command'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application.rb:364:in `block (2 levels) in run'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application.rb:470:in `plugin_hook'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application.rb:364:in `block in run'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util.rb:478:in `exit_on_fail'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/application.rb:364:in `run'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util/command_line.rb:137:in `run'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/lib/puppet/util/command_line.rb:91:in `execute'\r\n/var/lib/gems/1.9.1/gems/puppet-3.4.2/bin/puppet:4:in `<top (required)>'\r\n/usr/local/bin/puppet:23:in `load'\r\n/usr/local/bin/puppet:23:in `<main>'\r\n{code}","closed_at":"2019-04-04T22:32:49.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1597","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:49.000-0700","timestamp":1652286077.338483,"priority":"Normal","status_category":"Done","pull_request":2625},{"issue_id":"32147","title":"ca_server and directory based environments don't play nice together","url":"https://tickets.puppetlabs.com/browse/PUP-2290","created_at":"2014-04-17T02:48:47.000-0700","number":"PUP-2290","body":"When a Puppet Master is stared and is a CA but does not have any environments in {{/etc/puppet/environments}} even though it is configured for directory based environments it stops accepting CSR's.\r\n\r\nWe have a Puppet Master that is CA-only and therefor don't deploy the environments to it. The fix was to simply remove the {{environmentpath}} setting from {{puppet.conf}} but I don't think that using directory based environments should brick certificate signing.","closed_at":"2019-04-04T22:32:51.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2290","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:51.000-0700","timestamp":1652286078.213052,"priority":"Major","status_category":"Done","pull_request":2597},{"issue_id":"36802","title":"selector expression default should be matched last","url":"https://tickets.puppetlabs.com/browse/PUP-2642","created_at":"2014-05-22T14:49:36.000-0700","number":"PUP-2642","body":"The future evaluator treats a default in a selector expression just like any other value (historically puppet regular did this too - although I may be wrong). It should instead defer matching against a default until no other entry matched (just like the case expression does).\r\n\r\nThis will bite all users that have not followed the advice to place the default entry last in the selector.","closed_at":"2019-04-04T22:32:52.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2642","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:52.000-0700","timestamp":1652286092.638713,"priority":"Major","status_category":"Done","pull_request":2687},{"issue_id":"34383","title":"REST API regression in DELETE request handling","url":"https://tickets.puppetlabs.com/browse/PUP-2505","created_at":"2014-05-06T11:45:36.000-0700","number":"PUP-2505","body":"Hi,\r\n\r\n[Note that I have to remove hostnames, so i replaced them with fake\r\n ones. In the logs they are shown correctly and as expected]\r\n\r\nUsing puppet on Debian with the packages from puppetlabs, puppet is 3.5.1-1puppetlabs1. Following added to auth.conf on the master:\r\n\r\n-----------\r\n# allow nodes to touch their own cert and installcert to touch all certs\r\npath ~ /certificate_status/([^/]+)$\r\nauth yes\r\nallow $1\r\nallow installcert\r\n-----------\r\n\r\nNow, following http://docs.puppetlabs.com/guides/rest_api.html#certificate-status that documentation, a request like\r\n\r\ncurl --cert ./installcert.crt --key ./installcert.key -k -X DELETE -H \"Accept: pson\" https://puppetserver:8140/production/certificate_status/machine.example.com\r\n\r\nought to delete the certificate.\r\nNote that a revocation request with PUT works fine.\r\n\r\nThe puppetmaster log for a revocation:\r\n-----------\r\nMay  6 20:35:44 puppetserver puppet-master[264631]: Handling request: PUT /production/certificate_status/machine.example.com\r\nMay  6 20:35:44 puppetserver puppet-master[264631]: Routes Registered:\r\nMay  6 20:35:44 puppetserver puppet-master[264631]: Route /^\\/v2\\.0/\r\nMay  6 20:35:44 puppetserver puppet-master[264631]: Route /.*/\r\nMay  6 20:35:44 puppetserver puppet-master[264631]: Evaluating match for Route /^\\/v2\\.0/\r\nMay  6 20:35:44 puppetserver puppet-master[264631]: Did not match path (\"/production/certificate_status/machine.example.com\")\r\nMay  6 20:35:44 puppetserver puppet-master[264631]: Evaluating match for Route /.*/\r\nMay  6 20:35:44 puppetserver puppet-master[264631]: certificate_status supports formats: pson msgpack yaml b64_zlib_yaml raw\r\nMay  6 20:35:44 puppetserver puppet-master[264631]: Revoked certificate with serial 7\r\n-----------\r\n\r\nSo thats fine, and works as designed.\r\nNow, revocation isn't enough, the cert should go away. Running the\r\nabove mentioned command to DELETE it ends up with the following lines\r\nin the log:\r\n-----------\r\nMay  6 20:41:03 puppetserver puppet-master[264631]: Handling request: DELETE /production/certificate_status/machine.example.com\r\nMay  6 20:41:03 puppetserver puppet-master[264631]: Routes Registered:\r\nMay  6 20:41:03 puppetserver puppet-master[264631]: Route /^\\/v2\\.0/\r\nMay  6 20:41:03 puppetserver puppet-master[264631]: Route /.*/\r\nMay  6 20:41:03 puppetserver puppet-master[264631]: Evaluating match for Route /^\\/v2\\.0/\r\nMay  6 20:41:03 puppetserver puppet-master[264631]: Did not match path (\"/production/certificate_status/machine.example.com\")\r\nMay  6 20:41:03 puppetserver puppet-master[264631]: Evaluating match for Route /.*/\r\nMay  6 20:41:03 puppetserver puppet-master[264631]: Server Error: undefined method `each' for nil:NilClass\r\n-----------\r\n\r\nAnd a load of output back to the shell from curl:\r\n-----------\r\n{\"message\":\"Server Error: undefined method `each' for nil:NilClass\",\"issue_kind\":\"RUNTIME_ERROR\",\"stacktrace\":[\"/usr/lib/ruby/vendor_ruby/puppet/network/http/route.rb:72:in `process'\",\"/usr/lib/ruby/vendor_ruby/puppet/network/http/handler.rb:63:in `block in process'\",\"/usr/lib/ruby/vendor_ruby/puppet/util/profiler/none.rb:6:in `profile'\",\"/usr/lib/ruby/vendor_ruby/puppet/util/profiler.rb:43:in `profile'\",\"/usr/lib/ruby/vendor_ruby/puppet/network/http/handler.rb:61:in `process'\",\"/usr/lib/ruby/vendor_ruby/puppet/network/http/rack.rb:21:in `call'\",\"/usr/lib/ruby/vendor_ruby/phusion_passenger/rack/request_handler.rb:96:in `process_request'\",\"/usr/lib/ruby/vendor_ruby/phusion_passenger/abstract_request_handler.rb:516:in `accept_and_process_next_request'\",\"/usr/lib/ruby/vendor_ruby/phusion_passenger/abstract_request_handler.rb:274:in `main_loop'\",\"/usr/lib/ruby/vendor_ruby/phusion_passenger/rack/application_spawner.rb:206:in `start_request_handler'\",\"/usr/lib/ruby/vendor_ruby/phusion_passenger/rack/application_spawner.rb:171:in `block in handle_spawn_application'\",\"/usr/lib/ruby/vendor_ruby/phusion_passenger/utils.rb:479:in `safe_fork'\",\"/usr/lib/ruby/vendor_ruby/phusion_passenger/rack/application_spawner.rb:166:in `handle_spawn_application'\",\"/usr/lib/ruby/vendor_ruby/phusion_passenger/abstract_server.rb:357:in `server_main_loop'\",\"/usr/lib/ruby/vendor_ruby/phusion_passenger/abstract_server.rb:206:in `start_synchronously'\",\"/usr/lib/ruby/vendor_ruby/phusion_passenger/abstract_server.rb:180:in `start'\",\"/usr/lib/ruby/vendor_ruby/phusion_passenger/rack/application_spawner.rb:129:in `start'\",\"/usr/lib/ruby/vendor_ruby/phusion_passenger/spawn_manager.rb:253:in `block (2 levels) in spawn_rack_application'\",\"/usr/lib/ruby/vendor_ruby/phusion_passenger/abstract_server_collection.rb:132:in `lookup_or_add'\",\"/usr/lib/ruby/vendor_ruby/phusion_passenger/spawn_manager.rb:246:in `block in spawn_rack_application'\",\"/usr/lib/ruby/vendor_ruby/phusion_passenger/abstract_server_collection.rb:82:in `block in synchronize'\",\"<internal:prelude>:10:in `synchronize'\",\"/usr/lib/ruby/vendor_ruby/phusion_passenger/abstract_server_collection.rb:79:in `synchronize'\",\"/usr/lib/ruby/vendor_ruby/phusion_passenger/spawn_manager.rb:244:in `spawn_rack_application'\",\"/usr/lib/ruby/vendor_ruby/phusion_passenger/spawn_manager.rb:137:in `spawn_application'\",\"/usr/lib/ruby/vendor_ruby/phusion_passenger/spawn_manager.rb:275:in `handle_spawn_application'\",\"/usr/lib/ruby/vendor_ruby/phusion_passenger/abstract_server.rb:357:in `server_main_loop'\",\"/usr/lib/ruby/vendor_ruby/phusion_passenger/abstract_server.rb:206:in `start_synchronously'\",\"/usr/share/phusion-passenger/helper-scripts/passenger-spawn-server:99:in `<main>'\"]}\r\n-----------\r\n\r\nI don't think it should do this, I would have expected it to delete\r\nthat cert... :)\r\n\r\n--\r\nbye Joerg\r\n","closed_at":"2019-04-04T22:32:52.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2505","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:52.000-0700","timestamp":1652286092.747071,"priority":"Critical","status_category":"Done","pull_request":2659},{"issue_id":"41156","title":"future parser should validate class/resource names that are types","url":"https://tickets.puppetlabs.com/browse/PUP-2886","created_at":"2014-07-02T18:11:20.000-0700","number":"PUP-2886","body":"The validator should issue an error if a type name is used as the name of a class or define.\r\n\r\n{code}\r\ndefine integer { }\r\nclass data {}\r\n{code}\r\n\r\nThe names should be allowed when used in some context e.g. {{MyVeryOwn::Integer}} - this, although most names are computer science like, the type Data may be something that people want to use.\r\n\r\nThere is no deprecation, and if not validated, references to those classes/defines will not work as expected, with strange effects, or errors elsewhere.","closed_at":"2019-04-04T22:32:52.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2886","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:52.000-0700","timestamp":1652286092.95923,"priority":"Normal","status_category":"Done","pull_request":2842},{"issue_id":"38323","title":"Puppet squats on the PuppetX::Puppetlabs and PuppetX::Puppet namespaces","url":"https://tickets.puppetlabs.com/browse/PUP-2733","created_at":"2014-06-05T12:51:51.000-0700","number":"PUP-2733","body":"The implementation of the heredoc syntax validators added logic into the PuppetX module, took the names PuppetX::Puppetlabs and PuppetX::Puppet and added an implementation into PuppetX::Puppetlabs for json syntax validation and some interfaces into PuppetX::Puppet.\r\n\r\nThe PuppetX module needs to remain as a convention for code *external* to puppet to have for any implementations outside of the implementation of the extension itself (e.g. Puppet::Type::X) to use. By adding logic to the PuppetX ruby module, we have begun interfering with extensions.\r\n\r\nThe use of PuppetX::Puppet is a little less of a problem, but seems to be very strange that puppet is extending itself. Puppet code should be contained within Puppet, not PuppetX.\r\n\r\nI would expect that Puppet would have no meaningful contact with PuppetX other than, maybe, creating the PuppetX ruby module in {{puppetx.rb}}.","closed_at":"2019-04-04T22:32:53.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2733","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:53.000-0700","timestamp":1652286093.277871,"priority":"Normal","status_category":"Done","pull_request":3286},{"issue_id":"41338","title":"Long form Resource Type reference fools \"future parser\" this is an override","url":"https://tickets.puppetlabs.com/browse/PUP-2898","created_at":"2014-07-07T06:35:53.000-0700","number":"PUP-2898","body":"When setting defaults for a resource type R, the short form works:\r\n{code}\r\nR { attr => value }\r\n{code}\r\nbut not the long form:\r\n{code}\r\nResource[R] { attr => value }\r\nResource['r'] { attr => value }\r\n{code}\r\n\r\nThis problem is due to the static transformation of a resource expression\r\nsince the two forms (override and default) have different rules than a regular resource expression.\r\n\r\nIdeally I would like to only have one form and require that defaults have a title of literal default, and that overrides specify the title of the resource that is being overridden. This would alleviate much grammar pain.\r\n","closed_at":"2019-04-04T22:32:56.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2898","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:56.000-0700","timestamp":1652286094.030609,"priority":"Normal","status_category":"Done","pull_request":2914},{"issue_id":"12405","title":"Puppet agents with agent cert but no CA cert perform infinite recursion","url":"https://tickets.puppetlabs.com/browse/PUP-191","created_at":"2013-07-23T09:12:39.000-0700","number":"PUP-191","body":"When the Puppet Agent has a SSL cert, but no CA cert with which to validate its credentials, it will request the CA cert from the master. During the request, the expiration dates of all certs are checked so that the user can be warned if anything is nearing expiration. Checking the expiration date causes the agent cert to be validated, which triggeres a request to the master for the CA cert, which causes the expiration dates of all certs to be checked...\n\nThis recursion continues until the agent experiences a stack overflow or misses a thread lock. A side effect of this recursion is that the agent will flood the master with CA requests.\n\nTo re-produce this issue:\n\n  - Spin up a master-agent pair.\n\n  - Allow the agent to check in with the master and obtain a cert.\n\n  - Move `/var/lib/puppet/ssl/certs/ca.pem` to a temporary location.\n\n  - `puppet agent -t` should now fail with a stack overflow or thread synchronization error.\n\nThe main use case triggering this issue is using `puppet cert generate` to pre-seed an agent with keys.","closed_at":"2019-04-04T22:32:57.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-191","labels":"redmine","state":"Closed","updated_at":"2019-04-04T22:32:57.000-0700","timestamp":1652286094.13674,"priority":"Critical","status_category":"Done","pull_request":6570},{"issue_id":"28953","title":"future parser doesn't bind variables from inherited scope","url":"https://tickets.puppetlabs.com/browse/PUP-1973","created_at":"2014-03-18T07:37:23.000-0700","number":"PUP-1973","body":"If you run the puppetlabs-ntp module with parser=future on 3.5.0-rc1 it will break complaining that it can't call {{flatten}} on {{nil:NilClass}} in the ntp.conf template.\r\n\r\nThis happens because for some reason {{@restrict}} and every other variable in the template isn't bound, ergo nil.\r\n\r\nIf I explicitly add a {{$restricted = $::ntp::restricted}} to config.pp it works.","closed_at":"2019-04-04T22:32:58.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1973","labels":"","state":"Closed","updated_at":"2019-04-04T22:32:58.000-0700","timestamp":1652286094.68076,"priority":"Major","status_category":"Done","pull_request":2445},{"issue_id":"206988","title":"beaker instructions at ./acceptance/readme seem to be wrong","url":"https://tickets.puppetlabs.com/browse/PUP-7861","created_at":"2017-08-22T22:25:30.000-0700","number":"PUP-7861","body":"Instructions for running beaker locally in the file {{acceptance/README.md}} seem to be broken in master.\r\n\r\nI've been running using:\r\n{noformat}\r\nCONFIG=config/nodes/centos6-local.yaml SHA=#{test-commit-sha} GIT_SERVER='192.168.80.1' FORK='puppet' bundle exec rake --trace ci:test:git\r\n{noformat}\r\n\r\nAs suggested by the instructions, I encountered 2x failures:\r\n\r\n*Errored build: Unable to yum install rubygem-json*\r\nFix was to use a centos7 vagrant box which already has \"Development Tools\" metapackage installed\r\n\r\n*Errored build:  Unable to checkout puppet from git*\r\n{noformat}\r\n...SNIP\r\n    Don't run Bundler as root. Bundler can ask for sudo if it is needed, and\r\n    installing your bundle as root will break this application for all non-root\r\n    users on this machine.\r\n    Fetching https://github.com/puppet/puppet.git\r\n    fatal: Needed a single revision\r\n    Revision 15ffe6b31 does not exist in the repository\r\n    https://github.com/puppet/puppet.git. Maybe you misspelled it?\r\n  \r\n  all-in-one executed in 226.35 seconds\r\n  Exited: 11\r\n  Beaker::Host::CommandFailure: Host 'all-in-one' exited with 11 running:\r\n...SNIP\r\n{noformat}\r\n\r\nThis turns out to be the build system not using the GIT_SERVER environment variable.  I had a quick scan through the code and couldn't see it being used anywhere.  I came up with a hacky workaround by editing {{acceptance/setup/git/pre-suite/010_TestSetup.rb}} around line 35 to just hardcode to the git server I setup (git daemon, as per instructions):\r\n\r\n{noformat}\r\n        gemfile_contents = <<END\r\nsource '#{ENV[\"GEM_SOURCE\"] || \"https://rubygems.org\"}'\r\ngem '#{repository[:name]}', :git => 'git://192.168.0.1/puppetlabs-puppet.git', :ref => '#{ENV['SHA']}'\r\n# gem '#{repository[:name]}', :git => '#{repository[:path]}', :ref => '#{ENV['SHA']}'\r\nEND\r\n{noformat}\r\n\r\nAfter making these two changes, it looks like the beaker tests are mostly working, but it would be great to get the instructions updated/helpers fixed to make life easier for those contributing patches","closed_at":"2019-04-04T22:34:07.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7861","labels":"","state":"Closed","updated_at":"2019-04-04T22:34:07.000-0700","timestamp":1652286094.891891,"priority":"Normal","status_category":"Done","pull_request":6457},{"issue_id":"190355","title":"Puppet Acceptance Test Failure in Imaging Acceptance Tests","url":"https://tickets.puppetlabs.com/browse/PUP-7521","created_at":"2017-05-11T10:02:53.000-0700","number":"PUP-7521","body":"The new Packer/Imaging acceptance tests are consistently failing with the following test failures:\r\n* tests/reports/corrective_change_new_resource.rb\r\n* tests/reports/corrective_change_outside_puppet.rb\r\n* tests/reports/corrective_change_via_puppet.rb\r\n* tests/resource/file/ticket_6448_file_with_utf8_source.rb\r\n\r\nThese tests are a copy of the existing Puppet Acceptance Tests from the Puppet Agent Suite remodelled to run on the Jenkins Imaging Server as part the {{vmpooler}} image creation pipeline.\r\n\r\nAn example of a failing test is available at: https://jenkins-imaging.delivery.puppetlabs.net/view/Windows/job/imaging_windows-2012r2-wmf5_x86_64_vmware_vsphere.cygwin_acceptance_packer/5/consoleFull\r\n\r\nAll of these tests show the following common error pattern:\r\n{noformat}\r\n05:10:32           \r\n05:10:32           duaytgmfihwjgou (redhat7-64-1) 05:10:32$ service puppetserver reload\r\n05:10:32             Redirecting to /bin/systemctl reload  puppetserver.service\r\n05:10:35           \r\n05:10:35           duaytgmfihwjgou (redhat7-64-1) executed in 3.15 seconds\r\n05:10:35           RuntimeError: PuppetAcceptance::DSL::Helpers.with_puppet_running_on failed (check backtrace for location) because: Host 'iel4i3wbexk81wn' exited with 1 running:\r\n05:10:35            cmd.exe /c puppet agent -t --environment corrective_change_new_resource_vh8jbk1t --server duaytgmfihwjgou\r\n05:10:35           Last 10 lines of output were:\r\n05:10:35           \tInfo: Using configured environment 'corrective_change_new_resource_vh8jbk1t'\r\n05:10:35           \tInfo: Retrieving pluginfacts\r\n05:10:35           \tInfo: Retrieving plugin\r\n05:10:35           \tError: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: No matching entry for selector parameter with value 'iel4i3wbexk81wn.delivery.puppetlabs.net' at /etc/puppetlabs/code/environments/corrective_change_new_resource_vh8jbk1t/manifests/site.pp:2:14 on node iel4i3wbexk81wn.delivery.puppetlabs.net\r\n05:10:35           \tWarning: Not using cache on failed catalog\r\n05:10:35           \tError: Could not retrieve catalog; skipping run\r\n05:10:35           /var/lib/jenkins/workspace/imaging_windows-2012r2-wmf5_x86_64_vmware_vsphere.cygwin_acceptance_packer/acceptance/puppet/acceptance/vendor/bundle/gems/beaker-3.14.0/lib/beaker/host.rb:373:in `exec'\r\n{noformat}\r\n","closed_at":"2019-04-04T22:34:08.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7521","labels":"","state":"Closed","updated_at":"2019-04-04T22:34:08.000-0700","timestamp":1652286095.10524,"priority":"Normal","status_category":"Done","pull_request":6079},{"issue_id":"91271","title":"One test failure on IBM z Systems","url":"https://tickets.puppetlabs.com/browse/PUP-4962","created_at":"2015-07-30T10:56:23.000-0700","number":"PUP-4962","body":"We have performed the test suite on IBM z platform. The one z platform specific failure is\r\n\r\n\"rspec ./spec/unit/indirector/file_bucket_file/file_spec.rb:43 # Puppet::FileBucketFile::File non-stubbing tests when servicing a save request fails if the contents collide with existing contents\"\r\n\r\nThis is due to the difference of endianness, since z systems use big endianness. This test is used to test contents collision, where an MD5 collision is constructed in the test. However, in the test, the MD5 digest is represent in a little endian UINT type. So when ported to z systems, such MD5 collision is not valid. This caused the failure of this particular test. \r\n\r\nA quick workaround is to reconstruct the MD5 collision by converting the little endian to big endian expression in the test file: \" ./spec/unit/indirector/file_bucket_file/file_spec.rb\".\r\n\r\nOriginal code:\r\n\"\r\nfirst_contents = [0x6165300e,0x87a79a55,0xf7c60bd0,0x34febd0b,\r\n                          0x6503cf04,0x854f709e,0xfb0fc034,0x874c9c65,\r\n                          0x2f94cc40,0x15a12deb,0x5c15f4a3,0x490786bb,\r\n                          0x6d658673,0xa4341f7d,0x8fd75920,0xefd18d5a].pack(\"I\" * 16)\r\n\r\n        collision_contents = [0x6165300e,0x87a79a55,0xf7c60bd0,0x34febd0b,\r\n                              0x6503cf04,0x854f749e,0xfb0fc034,0x874c9c65,\r\n                              0x2f94cc40,0x15a12deb,0xdc15f4a3,0x490786bb,\r\n                              0x6d658673,0xa4341f7d,0x8fd75920,0xefd18d5a].pack(\"I\" * 16)\r\n\"\r\nchange to:\r\n\"\r\n        first_contents_s390x = [0x0e306561,0x559aa787,0xd00bc6f7,0x0bbdfe34,0x04cf0365,0x9e704f85,0x34c00ffb,\r\n0x659c4c87,0x40cc942f,0xeb2da115,0xa3f4155c,0xbb860749,0x7386656d,0x7d1f34a4,\r\n0x2059d78f,0x5a8dd1ef].pack(\"I\" * 16)\r\n\r\n        collision_contents_s390x = [0x0e306561,0x559aa787,0xd00bc6f7,0x0bbdfe34,0x04cf0365,0x9e744f85,0x34c00ffb,\r\n0x659c4c87,0x40cc942f,0xeb2da115,0xa3f415dc,0xbb860749,0x7386656d,0x7d1f34a4,\r\n0x2059d78f,0x5a8dd1ef].pack(\"I\" * 16)\r\n\"","closed_at":"2019-04-04T22:34:09.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4962","labels":"","state":"Closed","updated_at":"2019-04-04T22:34:09.000-0700","timestamp":1652286095.525852,"priority":"Normal","status_category":"Done","pull_request":6063},{"issue_id":"63833","title":"Use internal gem mirror for acceptance host setup","url":"https://tickets.puppetlabs.com/browse/PUP-3839","created_at":"2015-01-13T16:17:36.000-0800","number":"PUP-3839","body":"When using our internal gem mirror for acceptance tests, setup of the hosts still uses the default (rubygems.org). This can lead to acceptance failures due to network failures.\r\n\r\nWhen using the internal mirror for bundler, we should also use it to setup the hosts, to avoid network-related failures.","closed_at":"2019-04-04T22:34:10.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3839","labels":"","state":"Resolved","updated_at":"2019-04-04T22:34:10.000-0700","timestamp":1652286096.101122,"priority":"Normal","status_category":"Done","pull_request":3481},{"issue_id":"14849","title":"Windows-Vagrant: Build.sh helper and up.sh helper broken on Ubuntu / CentOS","url":"https://tickets.puppetlabs.com/browse/PUP-346","created_at":"2013-09-18T07:24:08.000-0700","number":"PUP-346","body":"Helper scripts are confirmed working on OSX, but not quite on Ubuntu due to shell / tooling variations.\r\n\r\n* `build.sh`, though it does error and skips tooling checks, does at least kick off the `packer build`\r\n* `up.sh` dies in a ball of fire, and does not start the VM (this partly has to do with the output of the `hash` command which isn't really necessary to use as it turns out)","closed_at":"2019-04-04T22:34:11.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-346","labels":"","state":"Resolved","updated_at":"2019-04-04T22:34:11.000-0700","timestamp":1652286096.511601,"priority":"Major","status_category":"Done","pull_request":3215},{"issue_id":"15345","title":"Don't let smallwall go to sleep","url":"https://tickets.puppetlabs.com/browse/PUP-435","created_at":"2013-09-26T22:57:55.000-0700","number":"PUP-435","body":null,"closed_at":"2019-04-04T22:34:12.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-435","labels":"","state":"Resolved","updated_at":"2019-04-04T22:34:12.000-0700","timestamp":1652286096.819552,"priority":"Normal","status_category":"Done","pull_request":3807},{"issue_id":"16862","title":"Add a fedora19 host to the platforms we are testing in ci.","url":"https://tickets.puppetlabs.com/browse/PUP-576","created_at":"2013-10-16T18:11:18.000-0700","number":"PUP-576","body":"We are not currently testing on fedora19 because of two test failures we haven't had time to resolve.  I believe fedora19 is the only platform currently available in our dynamic vcloud templates running Ruby 2.0, so it would be good to get this in.\r\n\r\nThe two failures are:\r\n\r\n1) helpful_error_message_when_hostname_not_match_server_certificate.rb\r\n2) store_configs/enc_provides_node_when_storeconfigs_enabled.rb\r\n\r\nIt's possible that #1 is a bug in our logging output.  The output is, in fact, different between fedora18 and fedora19.  I haven't had time to track down why yet.\r\n\r\nfedora18 (and our other platforms, I believe):\r\n\r\n{code}\r\npu2huc8q6leizk3 (master) $ env RUBYLIB=\"/opt/puppet-git-repos/hiera/lib:/opt/puppet-git-repos/hiera-puppet/lib:${RUBYLIB}\" PATH=\"/usr/bin:/opt/puppet-git-repos/hiera/bin:${PATH}\" puppet agent  --test --server pu2huc8q6leizk3\r\nWarning: Unable to fetch my node definition, but the agent run will continue:\r\nWarning: Server hostname 'pu2huc8q6leizk3' did not match server certificate; expected one of foobar_not_my_hostname, DNS:blue_cert, DNS:foobar_not_my_hostname, DNS:one_cert, DNS:red_cert, DNS:two_cert\r\nInfo: Retrieving plugin\r\nError: /File[/var/lib/puppet/lib]: Failed to generate additional resources using 'eval_generate': Server hostname 'pu2huc8q6leizk3' did not match server certificate; expected one of foobar_not_my_hostname, DNS:blue_cert, DNS:foobar_not_my_hostname, DNS:one_cert, DNS:red_cert, DNS:two_cert\r\nError: /File[/var/lib/puppet/lib]: Could not evaluate: Server hostname 'pu2huc8q6leizk3' did not match server certificate; expected one of foobar_not_my_hostname, DNS:blue_cert, DNS:foobar_not_my_hostname, DNS:one_cert, DNS:red_cert, DNS:two_cert Could not retrieve file metadata for puppet://pu2huc8q6leizk3/plugins: Server hostname 'pu2huc8q6leizk3' did not match server certificate; expected one of foobar_not_my_hostname, DNS:blue_cert, DNS:foobar_not_my_hostname, DNS:one_cert, DNS:red_cert, DNS:two_cert\r\nError: Could not retrieve catalog from remote server: Server hostname 'pu2huc8q6leizk3' did not match server certificate; expected one of foobar_not_my_hostname, DNS:blue_cert, DNS:foobar_not_my_hostname, DNS:one_cert, DNS:red_cert, DNS:two_cert\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\nError: Could not send report: Server hostname 'pu2huc8q6leizk3' did not match server certificate; expected one of foobar_not_my_hostname, DNS:blue_cert, DNS:foobar_not_my_hostname, DNS:one_cert, DNS:red_cert, DNS:two_cert\r\nExited: 1\r\n{code}\r\n\r\nfedora19:\r\n{code}\r\nsvwqk4sikgo5sw7 (master) $ env RUBYLIB=\"/opt/puppet-git-repos/hiera/lib:/opt/puppet-git-repos/hiera-puppet/lib:${RUBYLIB}\" PATH=\"/usr/bin:/opt/puppet-git-repos/hiera/bin:${PATH}\" puppet agent  --test --server svwqk4sikgo5sw7\r\nError: Failed to apply catalog: hostname \"svwqk4sikgo5sw7\" does not match the server certificate\r\nError: Could not send report: hostname \"svwqk4sikgo5sw7\" does not match the server certificate\r\nExited: 1\r\n{code}\r\n\r\nThis is with a master running who's config has been changed to include:\r\n\r\n{code}\r\n[master]\r\ncertname = foobar_not_my_hostname\r\ndns_alt_names = one_cert,two_cert,red_cert,blue_cert\r\n{code}\r\n\r\nRuby 2.0 issue?\r\n\r\nThe second failure is also a problem on rhel6, but we confine it there.  I do not know yet if it's the same problem (difficulty with the sqlite packages).\r\n\r\nA configuration with a RHEL6 master and RHEL5 agent is also blocked on the store_configs test...because it's confined RHEL6, but not RHEL5, but that leaves the test with no master to execute against...","closed_at":"2019-04-04T22:34:14.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-576","labels":"","state":"Closed","updated_at":"2019-04-04T22:34:14.000-0700","timestamp":1652286097.447926,"priority":"Normal","status_category":"Done","pull_request":4764},{"issue_id":"21566","title":"Windows generates test failures when %ALLUSERSPROFILE%\\PuppetLabs\\puppet doesn't exist","url":"https://tickets.puppetlabs.com/browse/PUP-1133","created_at":"2013-12-17T06:22:53.000-0800","number":"PUP-1133","body":"If %ALLUSERSPROFILE%\\PuppetLabs\\puppet (C:\\ProgramData\\PuppetLabs\\puppet on Win2008 R2) does not exist, a number of failures are generated.\r\n\r\nOn cursory examination, manually creating `C:\\ProgramData\\PuppetLabs` is not sufficient to remove the errors.\r\n\r\nOne work-around that *does* work is to run the Windows MSI package, allow it to create `C:\\ProgramData\\PuppetLabs` and the underlying directory hierarchy... in this case, I ran the installer, then uninstalled Puppet to leave the directory structure behind.\r\n\r\nThe failures that crop up are:\r\n\r\n<pre>\r\nFailures:\r\n\r\n  1) agent logging for [\"--onetime\", \"--verbose\", \"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--onetime\", \"--verbose\", \"--logdest=/dev/null/foo\"], logs to #<Set: {:console, \"/dev/null/foo\"}> at level info\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  2) agent logging for [\"--onetime\", \"--verbose\", \"--logdest=syslog\"] it should behave like an agent when evoked with [\"--onetime\", \"--verbose\", \"--logdest=syslog\"], logs to #<Set: {:console, \"syslog\"}> at level info\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  3) agent logging for [\"--onetime\", \"--verbose\", \"--logdest=console\"] it should behave like an\r\n agent when evoked with [\"--onetime\", \"--verbose\", \"--logdest=console\"], logs to #<Set: {:console, \"console\"}> at level info\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  4) agent logging for [\"--onetime\", \"--verbose\"] it should behave like an agent when evoked with [\"--onetime\", \"--verbose\"], logs to #<Set: {:console, :eventlog}> at level info\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  5) agent logging for [\"--onetime\", \"--debug\", \"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--onetime\", \"--debug\", \"--logdest=/dev/null/foo\"], logs to #<Set:\r\n {:console, \"/dev/null/foo\"}> at level debug\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  6) agent logging for [\"--onetime\", \"--debug\", \"--logdest=syslog\"] it should behave like an agent when evoked with [\"--onetime\", \"--debug\", \"--logdest=syslog\"], logs to #<Set: {:console, \"syslog\"}> at level debug\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  7) agent logging for [\"--onetime\", \"--debug\", \"--logdest=console\"] it should behave like an agent when evoked with [\"--onetime\", \"--debug\", \"--logdest=console\"], logs to #<Set: {:console, \"console\"}> at level debug\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  8) agent logging for [\"--onetime\", \"--debug\"] it should behave like an agent when evoked with\r\n [\"--onetime\", \"--debug\"], logs to #<Set: {:console, :eventlog}> at level debug\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  9) agent logging for [\"--onetime\", \"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--onetime\", \"--logdest=/dev/null/foo\"], logs to #<Set: {\"/dev/null/foo\"}> at\r\n level notice\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  10) agent logging for [\"--onetime\", \"--logdest=syslog\"] it should behave like an agent when evoked with [\"--onetime\", \"--logdest=syslog\"], logs to #<Set: {\"syslog\"}> at level notice\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  11) agent logging for [\"--onetime\", \"--logdest=console\"] it should behave like an agent when evoked with [\"--onetime\", \"--logdest=console\"], logs to #<Set: {\"console\"}> at level notice\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  12) agent logging for [\"--onetime\"] it should behave like an agent when evoked with [\"--onetime\"], logs to #<Set: {:eventlog}> at level notice\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  13) agent logging for [\"--onetime\", \"--no-daemonize\", \"--verbose\", \"--logdest=/dev/null/foo\"]\r\n it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\", \"--verbose\", \"--logdest=/dev/null/foo\"], logs to #<Set: {:console, \"/dev/null/foo\"}> at level info\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  14) agent logging for [\"--onetime\", \"--no-daemonize\", \"--verbose\", \"--logdest=syslog\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\", \"--verbose\", \"--logdest=syslog\"], logs to #<Set: {:console, \"syslog\"}> at level info\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  15) agent logging for [\"--onetime\", \"--no-daemonize\", \"--verbose\", \"--logdest=console\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\", \"--verbose\", \"--logdest=console\"], logs to #<Set: {:console, \"console\"}> at level info\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  16) agent logging for [\"--onetime\", \"--no-daemonize\", \"--verbose\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\", \"--verbose\"], logs to #<Set: {:console, :eventlog}> at level info\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  17) agent logging for [\"--onetime\", \"--no-daemonize\", \"--debug\", \"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\", \"--debug\", \"--logdest=/dev/null/foo\"], logs to #<Set: {:console, \"/dev/null/foo\"}> at level debug\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  18) agent logging for [\"--onetime\", \"--no-daemonize\", \"--debug\", \"--logdest=syslog\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\", \"--debug\", \"--logdest=syslog\"], logs to #<Set: {:console, \"syslog\"}> at level debug\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  19) agent logging for [\"--onetime\", \"--no-daemonize\", \"--debug\", \"--logdest=console\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\", \"--debug\", \"--logdest=console\"], logs to #<Set: {:console, \"console\"}> at level debug\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  20) agent logging for [\"--onetime\", \"--no-daemonize\", \"--debug\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\", \"--debug\"], logs to #<Set: {:console, :eventlog}> at level debug\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  21) agent logging for [\"--onetime\", \"--no-daemonize\", \"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\", \"--logdest=/dev/null/foo\"],\r\n logs to #<Set: {\"/dev/null/foo\"}> at level notice\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  22) agent logging for [\"--onetime\", \"--no-daemonize\", \"--logdest=syslog\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\", \"--logdest=syslog\"], logs to #<Set: {\"syslog\"}> at level notice\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  23) agent logging for [\"--onetime\", \"--no-daemonize\", \"--logdest=console\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\", \"--logdest=console\"], logs to #<Set: {\"console\"}> at level notice\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  24) agent logging for [\"--onetime\", \"--no-daemonize\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\"], logs to #<Set: {:eventlog}> at level notice\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  25) agent logging for [\"--no-daemonize\", \"--verbose\", \"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--no-daemonize\", \"--verbose\", \"--logdest=/dev/null/foo\"],\r\n logs to #<Set: {:console, \"/dev/null/foo\"}> at level info\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  26) agent logging for [\"--no-daemonize\", \"--verbose\", \"--logdest=syslog\"] it should behave like an agent when evoked with [\"--no-daemonize\", \"--verbose\", \"--logdest=syslog\"], logs to #<Set: {:console, \"syslog\"}> at level info\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  27) agent logging for [\"--no-daemonize\", \"--verbose\", \"--logdest=console\"] it should behave like an agent when evoked with [\"--no-daemonize\", \"--verbose\", \"--logdest=console\"], logs to #<Set: {:console, \"console\"}> at level info\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  28) agent logging for [\"--no-daemonize\", \"--verbose\"] it should behave like an agent when evoked with [\"--no-daemonize\", \"--verbose\"], logs to #<Set: {:console, :eventlog}> at level info\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  29) agent logging for [\"--no-daemonize\", \"--debug\", \"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--no-daemonize\", \"--debug\", \"--logdest=/dev/null/foo\"], logs to #<Set: {:console, \"/dev/null/foo\"}> at level debug\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  30) agent logging for [\"--no-daemonize\", \"--debug\", \"--logdest=syslog\"] it should behave like\r\n an agent when evoked with [\"--no-daemonize\", \"--debug\", \"--logdest=syslog\"], logs to #<Set: {:console, \"syslog\"}> at level debug\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  31) agent logging for [\"--no-daemonize\", \"--debug\", \"--logdest=console\"] it should behave like an agent when evoked with [\"--no-daemonize\", \"--debug\", \"--logdest=console\"], logs to #<Set: {:console, \"console\"}> at level debug\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  32) agent logging for [\"--no-daemonize\", \"--debug\"] it should behave like an agent when evoked with [\"--no-daemonize\", \"--debug\"], logs to #<Set: {:console, :eventlog}> at level debug\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  33) agent logging for [\"--no-daemonize\", \"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--no-daemonize\", \"--logdest=/dev/null/foo\"], logs to #<Set: {\"/dev/null/foo\"}> at level notice\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  34) agent logging for [\"--no-daemonize\", \"--logdest=syslog\"] it should behave like an agent when evoked with [\"--no-daemonize\", \"--logdest=syslog\"], logs to #<Set: {\"syslog\"}> at level notice\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  35) agent logging for [\"--no-daemonize\", \"--logdest=console\"] it should behave like an agent when evoked with [\"--no-daemonize\", \"--logdest=console\"], logs to #<Set: {\"console\"}> at level notice\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  36) agent logging for [\"--no-daemonize\"] it should behave like an agent when evoked with [\"--no-daemonize\"], logs to #<Set: {:eventlog}> at level notice\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  37) agent logging for [\"--verbose\", \"--logdest=/dev/null/foo\"] it should behave like an agent\r\n when evoked with [\"--verbose\", \"--logdest=/dev/null/foo\"], logs to #<Set: {:console, \"/dev/null/foo\"}> at level info\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  38) agent logging for [\"--verbose\", \"--logdest=syslog\"] it should behave like an agent when evoked with [\"--verbose\", \"--logdest=syslog\"], logs to #<Set: {:console, \"syslog\"}> at level info\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  39) agent logging for [\"--verbose\", \"--logdest=console\"] it should behave like an agent when evoked with [\"--verbose\", \"--logdest=console\"], logs to #<Set: {:console, \"console\"}> at level info\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  40) agent logging for [\"--verbose\"] it should behave like an agent when evoked with [\"--verbose\"], logs to #<Set: {:console, :eventlog}> at level info\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  41) agent logging for [\"--debug\", \"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--debug\", \"--logdest=/dev/null/foo\"], logs to #<Set: {:console, \"/dev/null/foo\"}> at level debug\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  42) agent logging for [\"--debug\", \"--logdest=syslog\"] it should behave like an agent when evoked with [\"--debug\", \"--logdest=syslog\"], logs to #<Set: {:console, \"syslog\"}> at level debug\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  43) agent logging for [\"--debug\", \"--logdest=console\"] it should behave like an agent when evoked with [\"--debug\", \"--logdest=console\"], logs to #<Set: {:console, \"console\"}> at level debug\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  44) agent logging for [\"--debug\"] it should behave like an agent when evoked with [\"--debug\"], logs to #<Set: {:console, :eventlog}> at level debug\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  45) agent logging for [\"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--logdest=/dev/null/foo\"], logs to #<Set: {\"/dev/null/foo\"}> at level notice\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  46) agent logging for [\"--logdest=syslog\"] it should behave like an agent when evoked with [\"--logdest=syslog\"], logs to #<Set: {\"syslog\"}> at level notice\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  47) agent logging for [\"--logdest=console\"] it should behave like an agent when evoked with [\"--logdest=console\"], logs to #<Set: {\"console\"}> at level notice\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  48) agent logging for [] it should behave like an agent when evoked with [], logs to #<Set: {:eventlog}> at level notice\r\n     Failure/Error: command_line.execute\r\n     SystemExit:\r\n       exit\r\n     Shared Example Group: \"an agent\" called from ./spec/integration/agent/logging_spec.rb:173\r\n     # ./lib/puppet/util.rb:498:in `exit'\r\n     # ./lib/puppet/util.rb:498:in `rescue in exit_on_fail'\r\n     # ./lib/puppet/util.rb:484:in `exit_on_fail'\r\n     # ./lib/puppet/application.rb:362:in `run'\r\n     # ./lib/puppet/util/command_line.rb:137:in `run'\r\n     # ./lib/puppet/util/command_line.rb:91:in `execute'\r\n     # ./spec/integration/agent/logging_spec.rb:79:in `double_of_bin_puppet_agent_call'\r\n     # ./spec/integration/agent/logging_spec.rb:101:in `block (3 levels) in <top (required)>'\r\n\r\n  49) Puppet::Application::Agent during setup has an application default :catalog_cache_terminus setting of 'json'\r\n     Failure/Error: @puppetd.setup\r\n     RuntimeError:\r\n       Got 0 failure(s) while initializing:\r\n     # ./lib/puppet/settings.rb:946:in `block in use'\r\n     # ./lib/puppet/resource/catalog.rb:176:in `apply'\r\n     # ./lib/puppet/settings.rb:942:in `use'\r\n     # ./lib/puppet/application/agent.rb:403:in `setup'\r\n     # ./spec/unit/application/agent_spec.rb:338:in `block (3 levels) in <top (required)>'\r\n\r\n  50) Puppet::Application::Agent during setup should tell the catalog cache class based on the :catalog_cache_terminus setting\r\n     Failure/Error: @puppetd.setup\r\n     RuntimeError:\r\n       Got 0 failure(s) while initializing:\r\n     # ./lib/puppet/settings.rb:946:in `block in use'\r\n     # ./lib/puppet/resource/catalog.rb:176:in `apply'\r\n     # ./lib/puppet/settings.rb:942:in `use'\r\n     # ./lib/puppet/application/agent.rb:403:in `setup'\r\n     # ./spec/unit/application/agent_spec.rb:346:in `block (3 levels) in <top (required)>'\r\n\r\n  51) Puppet::Application::Agent during setup should not set catalog cache class if :catalog_cache_terminus is explicitly nil\r\n     Failure/Error: @puppetd.setup\r\n     RuntimeError:\r\n       Got 0 failure(s) while initializing:\r\n     # ./lib/puppet/settings.rb:946:in `block in use'\r\n     # ./lib/puppet/resource/catalog.rb:176:in `apply'\r\n     # ./lib/puppet/settings.rb:942:in `use'\r\n     # ./lib/puppet/application/agent.rb:403:in `setup'\r\n     # ./spec/unit/application/agent_spec.rb:354:in `block (3 levels) in <top (required)>'\r\n\r\n  52) Puppet::Application::Device during setup has an application default :catalog_cache_terminus setting of 'json'\r\n     Failure/Error: @device.setup\r\n     RuntimeError:\r\n       Got 0 failure(s) while initializing:\r\n     # ./lib/puppet/settings.rb:946:in `block in use'\r\n     # ./lib/puppet/resource/catalog.rb:176:in `apply'\r\n     # ./lib/puppet/settings.rb:942:in `use'\r\n     # ./lib/puppet/application/device.rb:222:in `setup'\r\n     # ./spec/unit/application/device_spec.rb:226:in `block (3 levels) in <top (required)>'\r\n\r\n  53) Puppet::Application::Device during setup should tell the catalog cache class based on the\r\n :catalog_cache_terminus setting\r\n     Failure/Error: @device.setup\r\n     RuntimeError:\r\n       Got 0 failure(s) while initializing:\r\n     # ./lib/puppet/settings.rb:946:in `block in use'\r\n     # ./lib/puppet/resource/catalog.rb:176:in `apply'\r\n     # ./lib/puppet/settings.rb:942:in `use'\r\n     # ./lib/puppet/application/device.rb:222:in `setup'\r\n     # ./spec/unit/application/device_spec.rb:234:in `block (3 levels) in <top (required)>'\r\n\r\n  54) Puppet::Application::Device during setup should not set catalog cache class if :catalog_cache_terminus is explicitly nil\r\n     Failure/Error: @device.setup\r\n     RuntimeError:\r\n       Got 0 failure(s) while initializing:\r\n     # ./lib/puppet/settings.rb:946:in `block in use'\r\n     # ./lib/puppet/resource/catalog.rb:176:in `apply'\r\n     # ./lib/puppet/settings.rb:942:in `use'\r\n     # ./lib/puppet/application/device.rb:222:in `setup'\r\n     # ./spec/unit/application/device_spec.rb:242:in `block (3 levels) in <top (required)>'\r\n\r\nFinished in 5 minutes 58.91 seconds\r\n18673 examples, 54 failures, 74 pending\r\n\r\nFailed examples:\r\n\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--verbose\", \"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--onetime\", \"--verbose\", \"--logdest=/dev/null/foo\"], logs to #<Set: {:console, \"/dev/null/foo\"}> at level info rspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--verbose\", \"--logdest=syslog\"] it should behave like an agent when evoked with [\"--onetime\", \"--verbose\", \"--logdest=syslog\"], logs to #<Set: {:console, \"syslog\"}> at level info\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--verbose\", \"--logdest=console\"] it should behave like an agent when evoked with [\"--onetime\", \"--verbose\", \"--logdest=console\"], logs to #<Set: {:console, \"console\"}> at level info\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--verbose\"] it should behave like an agent when evoked with [\"--onetime\", \"--verbose\"], logs to #<Set: {:console, :eventlog}> at level info\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--debug\", \"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--onetime\", \"--debug\", \"--logdest=/dev/null/foo\"], logs to #<Set: {:console, \"/dev/null/foo\"}> at level debug\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--debug\", \"--logdest=syslog\"] it should behave like an agent when evoked with [\"--onetime\", \"--debug\", \"--logdest=syslog\"], logs to #<Set: {:console, \"syslog\"}> at level debug\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--debug\", \"--logdest=console\"] it should behave like an agent when evoked with [\"--onetime\", \"--debug\", \"--logdest=console\"], logs to #<Set: {:console, \"console\"}> at level debug\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--debug\"] it should behave like an agent when evoked with [\"--onetime\", \"--debug\"], logs to #<Set: {:console, :eventlog}> at level debug\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--onetime\", \"--logdest=/dev/null/foo\"], logs to #<Set: {\"/dev/null/foo\"}> at level notice\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--logdest=syslog\"] it should behave like an agent when evoked with [\"--onetime\", \"--logdest=syslog\"], logs to #<Set: {\"syslog\"}> at level notice\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--logdest=console\"] it should behave like an agent when evoked with [\"--onetime\", \"--logdest=console\"], logs to #<Set: {\"console\"}> at level notice\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\"] it should behave like an agent when evoked with [\"--onetime\"], logs to #<Set: {:eventlog}> at level notice\r\n\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--no-daemonize\", \"--verbose\", \"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\", \"--verbose\", \"--logdest=/dev/null/foo\"], logs to #<Set: {:console, \"/dev/null/foo\"}> at level info\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--no-daemonize\", \"--verbose\", \"--logdest=syslog\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\", \"--verbose\", \"--logdest=syslog\"], logs to #<Set: {:console, \"syslog\"}>\r\n at level info\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--no-daemonize\", \"--verbose\", \"--logdest=console\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\", \"--verbose\", \"--logdest=console\"], logs to #<Set: {:console, \"console\"}> at level info\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--no-daemonize\", \"--verbose\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\", \"--verbose\"], logs to #<Set: {:console, :eventlog}> at level info\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--no-daemonize\", \"--debug\", \"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\", \"--debug\", \"--logdest=/dev/null/foo\"], logs to #<Set: {:console, \"/dev/null/foo\"}> at level debug\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--no-daemonize\", \"--debug\", \"--logdest=syslog\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\", \"--debug\", \"--logdest=syslog\"], logs to #<Set: {:console, \"syslog\"}> at level debug\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--no-daemonize\", \"--debug\", \"--logdest=console\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\", \"--debug\", \"--logdest=console\"], logs to #<Set: {:console, \"console\"}> at level debug\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--no-daemonize\", \"--debug\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\", \"--debug\"], logs to #<Set: {:console, :eventlog}> at level debug\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--no-daemonize\", \"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--onetime\",\r\n \"--no-daemonize\", \"--logdest=/dev/null/foo\"], logs to #<Set: {\"/dev/null/foo\"}> at level notice\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--no-daemonize\", \"--logdest=syslog\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\", \"--logdest=syslog\"], logs to #<Set: {\"syslog\"}> at level notice\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--no-daemonize\", \"--logdest=console\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\", \"--logdest=console\"], logs to #<Set: {\"console\"}> at level notice\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--onetime\", \"--no-daemonize\"] it should behave like an agent when evoked with [\"--onetime\", \"--no-daemonize\"], logs to\r\n #<Set: {:eventlog}> at level notice\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--no-daemonize\", \"--verbose\", \"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--no-daemonize\", \"--verbose\", \"--logdest=/dev/null/foo\"], logs to #<Set: {:console, \"/dev/null/foo\"}> at level info\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--no-daemonize\", \"--verbose\", \"--logdest=syslog\"] it should behave like an agent when evoked with [\"--no-daemonize\", \"--verbose\", \"--logdest=syslog\"], logs to #<Set: {:console, \"syslog\"}> at level info\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--no-daemonize\", \"--verbose\", \"--logdest=console\"] it should behave like an agent when evoked with [\"--no-daemonize\", \"--verbose\", \"--logdest=console\"], logs to #<Set: {:console, \"console\"}> at level info\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--no-daemonize\", \"--verbose\"] it should behave like an agent when evoked with [\"--no-daemonize\", \"--verbose\"], logs to\r\n #<Set: {:console, :eventlog}> at level info\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--no-daemonize\", \"--debug\", \"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--no-daemonize\", \"--debug\", \"--logdest=/dev/null/foo\"], logs to #<Set: {:console, \"/dev/null/foo\"}> at level\r\n debug\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--no-daemonize\", \"--debug\", \"--logdest=syslog\"] it should behave like an agent when evoked with [\"--no-daemonize\", \"--debug\", \"--logdest=syslog\"], logs to #<Set: {:console, \"syslog\"}> at level debug\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--no-daemonize\", \"--debug\", \"--logdest=console\"] it should behave like an agent when evoked with [\"--no-daemonize\", \"--debug\", \"--logdest=console\"], logs to #<Set: {:console, \"console\"}> at level debug\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--no-daemonize\", \"--debug\"] it should behave like an agent when evoked with [\"--no-daemonize\", \"--debug\"], logs to #<Set: {:console, :eventlog}> at level debug\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--no-daemonize\", \"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--no-daemonize\", \"--logdest=/dev/null/foo\"], logs to #<Set: {\"/dev/null/foo\"}> at level notice\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--no-daemonize\", \"--logdest=syslog\"] it should behave like an agent when evoked with [\"--no-daemonize\", \"--logdest=syslog\"], logs to #<Set: {\"syslog\"}> at level notice\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--no-daemonize\", \"--logdest=console\"] it should behave like an agent when evoked with [\"--no-daemonize\", \"--logdest=console\"], logs to #<Set: {\"console\"}> at level notice\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--no-daemonize\"] it should behave like an agent when evoked with [\"--no-daemonize\"], logs to #<Set: {:eventlog}> at level notice\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--verbose\", \"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--verbose\", \"--logdest=/dev/null/foo\"], logs to #<Set: {:console, \"/dev/null/foo\"}> at level info\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--verbose\", \"--logdest=syslog\"] it should behave like an agent when evoked with [\"--verbose\", \"--logdest=syslog\"], logs to #<Set: {:console, \"syslog\"}> at level info\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--verbose\", \"--logdest=console\"] it should behave like an agent when evoked with [\"--verbose\", \"--logdest=console\"], logs to #<Set: {:console, \"console\"}> at level info\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--verbose\"] it should behave like an agent when evoked with [\"--verbose\"], logs to #<Set: {:console, :eventlog}> at level info\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--debug\", \"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--debug\", \"--logdest=/dev/null/foo\"], logs to #<Set: {:console, \"/dev/null/foo\"}> at level debug\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--debug\", \"--logdest=syslog\"] it should behave like an agent when evoked with [\"--debug\", \"--logdest=syslog\"], logs to\r\n #<Set: {:console, \"syslog\"}> at level debug\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--debug\", \"--logdest=console\"] it should behave like an agent when evoked with [\"--debug\", \"--logdest=console\"], logs to #<Set: {:console, \"console\"}> at level debug\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--debug\"] it should behave like an agent when evoked with [\"--debug\"], logs to #<Set: {:console, :eventlog}> at level debug\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--logdest=/dev/null/foo\"] it should behave like an agent when evoked with [\"--logdest=/dev/null/foo\"], logs to #<Set: {\"/dev/null/foo\"}> at level notice\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--logdest=syslog\"] it should behave like an agent when evoked with [\"--logdest=syslog\"], logs to #<Set: {\"syslog\"}> at\r\n level notice\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [\"--logdest=console\"] it should behave like an agent when evoked with [\"--logdest=console\"], logs to #<Set: {\"console\"}>\r\n at level notice\r\nrspec ./spec/integration/agent/logging_spec.rb:90 # agent logging for [] it should behave like an agent when evoked with [], logs to #<Set: {:eventlog}> at level notice\r\nrspec ./spec/unit/application/agent_spec.rb:334 # Puppet::Application::Agent during setup has an application default :catalog_cache_terminus setting of 'json'\r\nrspec ./spec/unit/application/agent_spec.rb:341 # Puppet::Application::Agent during setup should tell the catalog cache class based on the :catalog_cache_terminus setting\r\nrspec ./spec/unit/application/agent_spec.rb:349 # Puppet::Application::Agent during setup should not set catalog cache class if :catalog_cache_terminus is explicitly nil\r\nrspec ./spec/unit/application/device_spec.rb:222 # Puppet::Application::Device during setup has\r\n an application default :catalog_cache_terminus setting of 'json'\r\nrspec ./spec/unit/application/device_spec.rb:229 # Puppet::Application::Device during setup should tell the catalog cache class based on the :catalog_cache_terminus setting\r\nrspec ./spec/unit/application/device_spec.rb:237 # Puppet::Application::Device during setup should not set catalog cache class if :catalog_cache_terminus is explicitly nil\r\n</pre>","closed_at":"2019-04-04T22:34:16.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1133","labels":"","state":"Closed","updated_at":"2019-04-04T22:34:16.000-0700","timestamp":1652286097.654823,"priority":"Major","status_category":"Done","pull_request":8842},{"issue_id":"54797","title":"CertificateError when running tests with OpenSSL >= 1.0.1i","url":"https://tickets.puppetlabs.com/browse/PUP-3446","created_at":"2014-10-12T20:31:06.000-0700","number":"PUP-3446","body":"The :minimal_certificate stub in Puppet::Network::HTTP::RackREST does everything necessary to produce a valid test certificate except sign it. An unsigned certificate has empty signing algorithm fields, which is invalid ASN.1, although OpenSSL versions prior to 1.0.1i would accept this ASN.1 anyway.\r\n\r\nWhen these tests are run on OpenSSL 1.0.1i or newer, an OpenSSL::X509::CertificateError is raised with the message \"nested asn1 error\". I have confirmed that the resultant ASN.1 is invalid using the dumpasn1 utility, ruling out a bug in OpenSSL reading the certificate.\r\n\r\nTo reproduce the problem, simply run (on any system with OpenSSL 1.0.1i or newer):\r\n\r\n    bundle exec rspec spec/unit/network/http/rack/rest_spec.rb\r\n\r\nThis code was introduced in a706fa30ae6be5dd5fcc3f539f31aa26cbccf42b, which is why I have selected all versions from 3.5.0 onwards as affected.\r\n\r\nI have a simple, tested patch which fixes this problem by self-signing the test certificate, which I intend to submit as a pull request on GitHub shortly.","closed_at":"2019-04-04T22:34:20.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3446","labels":"","state":"Closed","updated_at":"2019-04-04T22:34:20.000-0700","timestamp":1652286098.694757,"priority":"Minor","status_category":"Done","pull_request":3150},{"issue_id":"157127","title":"Puppet filebucket command does not pick up proper server address from server_list config property","url":"https://tickets.puppetlabs.com/browse/PUP-6823","created_at":"2016-10-17T05:32:09.000-0700","number":"PUP-6823","body":"I have following problem. When I changed *server* config option to *server_list* to increase redundancy, I met following problem (useless stuff omitted):\r\n{noformat}\r\nroot@localhost: puppet filebucket backup foo\r\nDebug: Runtime environment: puppet_version=4.7.0, ruby_version=2.1.9, run_mode=user, default_encoding=UTF-8\r\nInfo: Computing checksum on file foo\r\nDebug: Dynamically-bound server lookup failed; using first entry\r\nDebug: Dynamically-bound port lookup failed; using first entry\r\nDebug: Applying settings catalog for sections main, ssl\r\nDebug: /User[puppet]: Provider useradd does not support features libuser; not managing attribute forcelocal\r\nDebug: Puppet::Type::Group::ProviderDirectoryservice: file /usr/bin/dscl does not exist\r\nDebug: Puppet::Type::Group::ProviderPw: file pw does not exist\r\nDebug: Puppet::Type::Group::ProviderLdap: feature ldap is missing\r\nDebug: /Group[puppet]: Provider groupadd does not support features libuser; not managing attribute forcelocal\r\nDebug: Finishing transaction 29004960\r\nDebug: Creating new connection for https://puppet:8140\r\nError: Could not back up foo: getaddrinfo: Name or service not known\r\nError: Could not run: Could not back up foo: getaddrinfo: Name or service not known\r\n{noformat}\r\n\r\n*puppet.conf* file:\r\n{noformat}\r\n[main]\r\nserver_list=foo:8140,bar:8140,baz:8140\r\nfactpath=$vardir/lib/facter\r\nca_server=foo\r\npreferred_serialization_format=msgpack\r\n{noformat}\r\n\r\nWhen I specify both *server* and *server_list* in puppet.conf file it's working, but I'm getting this warning:\r\n{noformat}\r\nWarning: Attempted to set both server and server_list. Server setting will not be used.\r\n   (at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/defaults.rb:1411:in `block in <module:Puppet>')\r\n{noformat}","closed_at":"2019-04-04T22:34:59.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6823","labels":"","state":"Closed","updated_at":"2019-04-04T22:34:59.000-0700","timestamp":1652286099.015337,"priority":"Normal","status_category":"Done","pull_request":6418},{"issue_id":"96995","title":"Puppet filebucket --local uses $bucketdir instead of $clientbucketdir","url":"https://tickets.puppetlabs.com/browse/PUP-5206","created_at":"2015-09-07T02:53:18.000-0700","number":"PUP-5206","body":"As I've noticed we are finally fixing {{filebucket}} I'd love to see the following long-standing bug fixed.\r\n\r\n{code}\r\n# cat /opt/puppetlabs/puppet/cache/clientbucket/2/c/1/5/a/e/7/2/2c15ae72acdbd8878a6550275bc15fef/paths \r\n/etc/puppetlabs/puppet/puppet.conf\r\n\r\n# puppet filebucket get --local 2c15ae72acdbd8878a6550275bc15fef\r\nError: Could not run: File not found\r\n{code}\r\n\r\nThe thing is, you can find the file just fine if you manually specify the clientbucket.\r\n\r\n{code}\r\n[root@client puppet]# puppet filebucket get -b /opt/puppetlabs/puppet/cache/clientbucket 2c15ae72acdbd8878a6550275bc15fef\r\nInfo: FileBucket read 2c15ae72acdbd8878a6550275bc15fef\r\n# This file can be used to override the default puppet settings.\r\n# See the following links for more details on what settings are available:\r\n{code}\r\n\r\nLooking at the code with strace, it is trying to read the {{$bucketdir}} instead of the {{$clientbucketdir}}, which makes no sense when using the --{{local}} option.\r\n\r\nIf there is some use for --{{local}} that somehow makes sense, change this to a feature request for --{{client}} or some such option?","closed_at":"2019-04-04T22:35:01.000-0700","comments":35,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5206","labels":"puppethack","state":"Closed","updated_at":"2019-04-04T22:35:01.000-0700","timestamp":1652286099.450845,"priority":"Normal","status_category":"Done","pull_request":6417},{"issue_id":"22785","title":"Empty clientbucket files produce errors","url":"https://tickets.puppetlabs.com/browse/PUP-1334","created_at":"2014-01-01T23:04:01.000-0800","number":"PUP-1334","body":"I'm not sure how it happened, but I ended up with an empty clientbucket entry for one of my files. The 'contents' and 'paths' files were both present and empty. It caused this error:\r\n\r\n{code}\r\nerr: /Stage[main]/Os::Ubuntu/File[/etc/motd]/content: change from {md5}82cdaef7f3ba52467fb4e65491369889 to {md5}cd657ddfb4ff1e73910088a1d1c669ff failed: Could not back up /etc/motd: Got passed new contents for sum {md5}82cdaef7f3ba52467fb4e65491369889\r\n{code}\r\n\r\nFunky. Investigating, I see this:\r\n\r\n{code}\r\nroot@solr00-2:/var/lib/puppet/clientbucket/8/2/c/d/a/e/f/7# ls -l 82cdaef7f3ba52467fb4e65491369889/\r\ntotal 0\r\n-r--r----- 1 root root 0 2010-10-20 03:20 contents\r\n-rw-r--r-- 1 root root 0 2010-10-20 03:20 paths\r\n{code}\r\n\r\nThis could have been caused (theoretically) by me killing puppet mid-run with a reboot or something similar, so I'm not convinced this the original problem is a bug in puppet.\r\n\r\nMy request specifically is this: I think puppet should handle this case better. If the filebucket files are empty, it's might safe to discard them - especially if 'paths' is empty.\r\n\r\nFeel free to close this as \"not a bug\" if you feel such; it was a strange-enough behavior I felt it was worth sharing :)","closed_at":"2019-04-04T22:35:03.000-0700","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1334","labels":"redmine;resolved-issue-added","state":"Closed","updated_at":"2019-04-04T22:35:03.000-0700","timestamp":1652286099.775919,"priority":"Major","status_category":"Done","pull_request":5704},{"issue_id":"240614","title":"Hiera lookup must hard fail on invalid YAML","url":"https://tickets.puppetlabs.com/browse/PUP-8541","created_at":"2018-03-11T11:13:38.000-0700","number":"PUP-8541","body":"PuppetServer/Hiera just ignores broken YAML files instead of hard failing on them.\r\n\r\nThe consequences can be as serious as compromised system and/or lost network access to host. I would consider that *critical* based on experience with the problem.\r\n\r\nBelow is broken sample from hierarchy for tests:\r\n\r\n{code:yaml}\r\n---\r\n#classes:\r\n - cls1\r\n - cls2\r\n\r\nsomevar: 1\r\n{code}\r\n","closed_at":"2019-04-04T22:35:27.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8541","labels":"","state":"Closed","updated_at":"2019-04-04T22:35:27.000-0700","timestamp":1652286099.888879,"priority":"Normal","status_category":"Done","pull_request":6730},{"issue_id":"108636","title":"Cached catalogs are loaded using the agent's string locale which can result in corrupted data","url":"https://tickets.puppetlabs.com/browse/PUP-5584","created_at":"2015-12-07T15:26:08.000-0800","number":"PUP-5584","body":"If a cached catalog is applied, which contains a file resource that used the {{content}} parameter, and that content begins with a byte-order mark, the character will be rendered as garbage text when that cached catalog is applied on Windows.\r\n\r\nThis does not occur during normal master-agent puppet runs, only when applying a cached catalog, and only on Windows.\r\n\r\nReproduction:\r\n\r\nDownload the attached ERB file. If you view it with {{vim -b chocolatey.confg}} you will see {{<feff>}} at the beginning, indicating the byte-order mark.\r\n\r\nUse the template with a file resource, and deploy it to a Windows System, in any location.\r\n\r\nView the file and it will appear normally.\r\n\r\nNow, apply the cached catalog, either by disabling the puppet master and performing a puppet run (note that {{--test}} disables the use of  cached catalogs), or via {{puppet apply C:\\ProgramData\\PuppetLabs\\puppet\\var\\client_data\\catalog\\<certname>.json}} replacing {{<certname>}} with the test node's actual certname.\r\n\r\nOpen the file on disk, and it will look like so: \r\n!Screenshot 2015-12-07 15.23.05.png|thumbnail!\r\n\r\nNote the junk characters at the beginning.\r\n\r\nTested with a CentOS 6.6 master running PE 3.8.3 (Puppet 3.8.4) and a Windows Server 2012 agent running PE 3.8.3. I also tested with both the 64 and 32 bit clients.\r\nAlso tested with the same setup, running PE 2015.2.3 (Puppet 4.2.3) on the master and Windows agent.\r\n\r\nThe current workaround would be to disable cached catalogs. I'm also working on an additional workaround that would not require this, using concat to retrieve the first part of the file via the source parameter, to avoid storing the BOM in the catalog.\r\n\r\nNote: This is *not* a PE bug. I did my testing with PE, but this is not a PE-specific bug, as far as I can tell. It deals with generic Puppet functionality only. E.g. cached catalogs on Windows.","closed_at":"2019-04-04T22:35:31.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5584","labels":"support","state":"Closed","updated_at":"2019-04-04T22:35:31.000-0700","timestamp":1652286100.522594,"priority":"Normal","status_category":"Done","pull_request":4550},{"issue_id":"108954","title":"undefined local variable or method `data' for Puppet::Provider::Package::Windows::Package:Class","url":"https://tickets.puppetlabs.com/browse/PUP-5591","created_at":"2015-12-09T13:45:00.000-0800","number":"PUP-5591","body":"On a Windows 2012 R2 node, the command: \"puppet resource package --trace\"\r\n\r\ngenerates the following error:\r\n\r\nDebug: Puppet::Type::Package::ProviderZypper: file /usr/bin/zypper does not exist\u001b[0m\r\n\u001b[1;31mError: Could not run: undefined local variable or method `data' for Puppet::Provider::Package::Windows::Package:Class\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/registry.rb:216:in `block in read'\r\n\r\n\r\nLine 216 in puppet/util/windows/registry.rb is this:\r\nresult = [ type, data.read_bytes(0, byte_length) ]\r\n\r\n\r\nThat line uses \"data.read_bytes\", but all the other lines in that case statement use \"data_ptr.read_bytes\". This appears to be an oversight.\r\n","closed_at":"2019-04-04T22:35:31.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5591","labels":"windows","state":"Closed","updated_at":"2019-04-04T22:35:31.000-0700","timestamp":1652286100.631759,"priority":"Critical","status_category":"Done","pull_request":4534},{"issue_id":"76212","title":"Backport PUP-4386 - group resource doesn't work on Windows when members is an array and noop is used","url":"https://tickets.puppetlabs.com/browse/PUP-4426","created_at":"2015-04-16T09:55:04.000-0700","number":"PUP-4426","body":"The following resource fails: \r\n{code}\r\ngroup { 'administrators': \r\n  ensure => present, \r\n  members => ['TESTLA\\aaa02364'], \r\n}\r\n{code}\r\nWhen applied: \r\n{noformat}\r\nE:\\mgmt\\Puppet Labs\\Puppet Enterprise\\bin>puppet apply group.pp --noop \r\nNotice: Compiled catalog for p0wvaplz0013_1249_1251 in environment production in \r\n0.22 seconds \r\nError: undefined method `split' for #<Array:0x00000006201e70> \r\nError: /Group[administrators]: Could not evaluate: Puppet::Util::Log requires a \r\nmessage \r\nNotice: Finished catalog run in 0.41 seconds\r\n{noformat}\r\n\r\nThe problem is group.rb is_to_s does not handle array.\r\n\r\n{noformat}\r\nE:\\mgmt\\Puppet Labs\\Puppet Enterprise\\bin>puppet apply group.pp --noop --trace \r\nNotice: Compiled catalog for p0wvaplz0013_1249_1251 in environment production in \r\n0.22 seconds \r\nError: undefined method `split' for #<Array:0x000000063bd200> \r\nE:/MGMT/Puppet Labs/Puppet Enterprise/puppet/lib/puppet/type/group.rb:102:in `is \r\n_to_s' \r\nE:/MGMT/Puppet Labs/Puppet Enterprise/puppet/lib/puppet/transaction/resource_har \r\nness.rb:199:in `noop' \r\nE:/MGMT/Puppet Labs/Puppet Enterprise/puppet/lib/puppet/transaction/resource_har \r\nness.rb:126:in `sync_if_needed' \r\nE:/MGMT/Puppet Labs/Puppet Enterprise/puppet/lib/puppet/transaction/resource_har \r\nness.rb:89:in `block in perform_changes' \r\nE:/MGMT/Puppet Labs/Puppet Enterprise/puppet/lib/puppet/transaction/resource_har \r\nness.rb:88:in `each' \r\nE:/MGMT/Puppet Labs/Puppet Enterprise/puppet/lib/puppet/transaction/resource_har \r\nness.rb:88:in `perform_changes' \r\nE:/MGMT/Puppet Labs/Puppet Enterprise/puppet/lib/puppet/transaction/resource_har \r\nness.rb:20:in `evaluate' \r\nE:/MGMT/Puppet Labs/Puppet Enterprise/puppet/lib/puppet/transaction.rb:204:in `a \r\npply' \r\nE:/MGMT/Puppet Labs/Puppet Enterprise/puppet/lib/puppet/transaction.rb:217:in `e \r\nval_resource' \r\nE:/MGMT/Puppet Labs/Puppet Enterprise/puppet/lib/puppet/transaction.rb:147:in `c \r\nall' \r\nE:/MGMT/Puppet Labs/Puppet Enterprise/puppet/lib/puppet/transaction.rb:147:in `b \r\nlock (2 levels) in evaluate' \r\nE:/MGMT/Puppet Labs/Puppet Enterprise/puppet/lib/puppet/util.rb:327:in `block in \r\nthinmark' \r\nE:/MGMT/Puppet Labs/Puppet Enterprise/sys/ruby/lib/ruby/2.0.0/benchmark.rb:296:i \r\nn `realtime'\r\n{noformat}\r\n\r\nThis patches is_to_s method, but getting array value back for currentvalue is not expected:\r\n{code}\r\ndef is_to_s(currentvalue) \r\n  if provider.respond_to?(:members_to_s) \r\n    currentvalue = '' if currentvalue.nil? \r\n    if currentvalue.is_a? ::Array \r\n      v = currentvalue \r\n    else \r\n    v = currentvalue.split(',') \r\n   end \r\n  return provider.members_to_s(v) \r\n  end\r\n  super(currentvalue) \r\nend\r\n{code}","closed_at":"2019-04-04T22:35:33.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4426","labels":"customer;support;windows","state":"Closed","updated_at":"2019-04-04T22:35:33.000-0700","timestamp":1652286101.050785,"priority":"Normal","status_category":"Done","pull_request":4399},{"issue_id":"98941","title":"Windows user resource should not manage password unless specified","url":"https://tickets.puppetlabs.com/browse/PUP-5271","created_at":"2015-09-21T14:00:18.000-0700","number":"PUP-5271","body":"Attempts to have puppet create Windows users without passwords fail with result \"OLE error code:800708C5 in Active Directory. The password does not meet the password policy requirements. Check the minimum password length, password complexity and password history requirements.\"\r\n\r\n-`This occurs regardless of password security policy.- This only occurs when password security policy has been applied for complexity and/or minimum length.\r\n\r\nh3. Reproduction:\r\n\r\nCreate following users:\r\n\r\n{noformat}\r\nuser {'bob': \r\n  ensure      => present,  \r\n}\r\n\r\nuser {'bob_pwd': \r\n  ensure      => present,  \r\n  password    => '@#SAFSawasf123',\r\n}\r\n\r\nuser {'bob_managehome': \r\n  ensure      => present, \r\n  managehome  => true, \r\n}\r\n\r\nuser {'bob_managehome_pwd': \r\n  ensure      => present,  \r\n  managehome  => true,\r\n  password    => '@#SAFSawasf123',\r\n}\r\n\r\nuser {'bob_groups': \r\n  ensure      => present, \r\n  groups      => 'Users', \r\n}\r\n\r\nuser {'bob_everything': \r\n  ensure      => present, \r\n  managehome  => true,\r\n  groups      => 'Users', \r\n}\r\n\r\nuser {'bob_everything_pwd': \r\n  ensure      => present, \r\n  password    => '@#SAFSawasf123',\r\n  managehome  => true,\r\n  groups      => 'Users', \r\n}\r\n{noformat}\r\n\r\nRun puppet agent, then:\r\n\r\n{noformat}\r\nC:\\Users\\Administrator>puppet resource user\r\nuser { 'bob_everything_pwd':\r\n  ensure => 'present',\r\n  groups => ['Users'],\r\n  uid    => 'S-1-5-21-1953236517-242735908-2433092285-1042',\r\n}\r\nuser { 'bob_managehome_pwd':\r\n  ensure => 'present',\r\n  uid    => 'S-1-5-21-1953236517-242735908-2433092285-1045',\r\n}\r\nuser { 'bob_pwd':\r\n  ensure => 'present',\r\n  uid    => 'S-1-5-21-1953236517-242735908-2433092285-1041',\r\n}\r\n{noformat}\r\n\r\nh3. Fixed by:\r\n\r\nEditing puppet/lib/puppet/util/windows/adsi.rb to force verification that password is not nil. Any attempts to use {{managehome => true}} without specifying a password should validly fail. It is not possible to logon a user (to ensure the home directories are set) without a password that is set. This also cannot address when \"Minimum password length\" is greater than 0, as that is a validation built-in to Windows that requires a password for all new accounts.","closed_at":"2019-04-04T22:35:33.000-0700","comments":16,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5271","labels":"windows","state":"Closed","updated_at":"2019-04-04T22:35:33.000-0700","timestamp":1652286101.159299,"priority":"Normal","status_category":"Done","pull_request":4336},{"issue_id":"62782","title":"User resource cannot add DOMAIN\\User style accounts (through Active Directory) and should emit error message","url":"https://tickets.puppetlabs.com/browse/PUP-3804","created_at":"2015-01-02T15:28:30.000-0800","number":"PUP-3804","body":"Try to create a domain style account with a manifest like:\r\n\r\n{code}\r\nuser { \"domain\\\\bud\":\r\n  ensure => present,\r\n  groups => 'Administrator'\r\n}\r\n{code}\r\n\r\nPuppet will error with {{8007089A}}\r\n\r\n{code}\r\nError: User update failed: (in OLE method `SetInfo': )\r\n    OLE error code:8007089A in Active Directory\r\n      The specified username is invalid.\r\n\r\n    HRESULT error code:0x80020009\r\n      Exception occurred.\r\nWrapped exception:\r\n(in OLE method `SetInfo': )\r\n    OLE error code:8007089A in Active Directory\r\n      The specified username is invalid.\r\n\r\n    HRESULT error code:0x80020009\r\n      Exception occurred.\r\nError: /Stage[main]/Main/User[domain\\bud]/ensure: change from absent to present failed: User update failed: (in OLE method `SetInfo': )\r\n    OLE error code:8007089A in Active Directory\r\n      The specified username is invalid.\r\n\r\n    HRESULT error code:0x80020009\r\n      Exception occurred.\r\n{code}\r\n\r\nThere should be some discussion around Puppets intended behavior in this case, as there are multiple potential outcomes here, given the domain user creation is usually only available to Domain Administrators.  Puppet has traditionally understood only local accounts, and has allowed the manipulation of local groups to include domain accounts.\r\n\r\nWith that said, for a {{User}} resource that references a domain account:\r\n\r\n- Puppet should try to resolve the account name to a SID as it does normally (which currently should work OK)\r\n    - When the account doesn't exist, Puppet should trap {{8007089A}}, and expose an error to the user about the domain account not existing / state that Puppet doesn't perform that functionality\r\n\r\n- Puppet should add the domain user to local groups where appropriate\r\n\r\n\r\nBased on a user report, Puppet may also emit {{80070562}} when trying to add the domain user to a local group.  For instance, \r\n\r\n{code}\r\nNotice: /Stage[main]/Profiles::Scd::Users/User[cppib\\svc_scd_dev]/groups: groups changed 'Proofpoint Archive User Membership,Domain Users,wf1_ibimr-role_AnalyticalUser,wf1_ibimr-grp_managementre,wf1_ibimr-grp_herbiportal' to 'Administrators,Domain Users,Proofpoint Archive User Membership,wf1_ibimr-grp_herbiportal,wf1_ibimr-grp_managementre,wf1_ibimr-role_AnalyticalUser'\r\n\r\nError: /User[cppib\\svc_scd_dev]: Could not evaluate: User update failed: (in OLE method `SetInfo': )\r\n    OLE error code:80070005 in Active Directory\r\n      Access is denied.\r\n\r\n    HRESULT error code:0x80020009\r\n      Exception occurred.\r\nWrapped exception:\r\n(in OLE method `SetInfo': )\r\n    OLE error code:80070005 in Active Directory\r\n      Access is denied.\r\n\r\n    HRESULT error code:0x80020009\r\n      Exception occurred.\r\n\r\nNotice: Finished catalog run in 18.38 seconds\r\n{code}\r\n\r\nOn the second run:\r\n\r\n{code}\r\nError: (in OLE method `Add': )\r\n    OLE error code:80070562 in Active Directory\r\n      The specified account name is already a member of the group.\r\n\r\n    HRESULT error code:0x80020009\r\n      Exception occurred.\r\n\r\nError: /Stage[main]/Profiles::Scd::Users/User[cppib\\svc_scd_dev]/groups: change from Proofpoint Archive User Membership,Domain Users,wf1_ibimr-role_AnalyticalUser,wf1_ibimr-grp_managementre,wf1_ibimr-grp_herbiportal to Administrators,Domain Users,Proofpoint Archive User Membership,wf1_ibimrgrp_herbiportal,wf1_ibimr-grp_managementre,wf1_ibimr-role_AnalyticalUser failed: (in OLE method `Add': )\r\n    OLE error code:80070562 in Active Directory\r\n      The specified account name is already a member of the group.\r\n\r\n    HRESULT error code:0x80020009\r\n{code}","closed_at":"2019-04-04T22:35:35.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3804","labels":"windows","state":"Closed","updated_at":"2019-04-04T22:35:35.000-0700","timestamp":1652286101.47139,"priority":"Normal","status_category":"Done","pull_request":3772},{"issue_id":"36490","title":"Ability to add a member to a group, instead of specifying the complete list","url":"https://tickets.puppetlabs.com/browse/PUP-2628","created_at":"2014-05-20T16:58:01.000-0700","number":"PUP-2628","body":"On Windows, if you try to add a (domain) member to the local 'Administrators' group, you have to specify the complete list of members. Otherwise, puppet will remove current members that are not desired.\r\nThe `auth_membership` group parameter is designed to control whether the list of members is inclusive or explicit, like the `auth_membership` user parameter. However, the windows group provider does not take the `auth_membership` group parameter into account.","closed_at":"2019-04-04T22:35:36.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2628","labels":"docs_reviewed;windows","state":"Closed","updated_at":"2019-04-04T22:35:36.000-0700","timestamp":1652286101.578316,"priority":"Major","status_category":"Done","pull_request":3753},{"issue_id":"36783","title":"Puppet apply fails to write the graph if puppet agent has never run","url":"https://tickets.puppetlabs.com/browse/PUP-2638","created_at":"2014-05-22T13:11:30.000-0700","number":"PUP-2638","body":"Via ENTERPRISE-181:\r\nThis is a general puppet platform issue. It can occur (on any platform) when all of the following are true:\r\n\r\n# The `$vardir/state/graphs` directory doesn't exist\r\n# The `graph` setting is true\r\n# The agent has never run before\r\n\r\nExecuting `puppet apply` will fail to write the catalog.\r\n\r\nOn Windows (PE only), we set `graph` to true: https://github.com/puppetlabs/puppet_for_the_win/blob/master/wix/puppet.wxs#L302-L306.\r\n\r\nOn *nix (PE only), we set `graph` to true: https://github.com/puppetlabs/enterprise-dist/blob/3.3.x/ext/erb/puppet.conf.erb#L52\r\n\r\n{noformat}\r\n$ bundle exec puppet apply -e \"notice 'foo'\" --graphNotice: Scope(Class[main]): foo\r\nNotice: Compiled catalog for arcturus.luna.lan in environment production in 0.01 seconds\r\nError: No such file or directory - /Users/josh/.puppet/var/state/graphs/resources.dot\r\n{noformat}\r\n\r\nOn Windows:\r\n\r\n{noformat}\r\nC:\\work\\puppet [stable +1 ~0 -0 !]> bundle exec puppet apply -e \"notice 'foo'\" --graph --trace\r\nNotice: Scope(Class[main]): foo\r\nNotice: Compiled catalog for win-qp47voha2p4.solar.lan in environment production in 0.05 seconds\r\nError: No such file or directory - C:/ProgramData/PuppetLabs/puppet/var/state/graphs/resources.dot\r\nC:/work/puppet/lib/puppet/graph/simple_graph.rb:474:in `initialize'\r\nC:/work/puppet/lib/puppet/graph/simple_graph.rb:474:in `open'\r\nC:/work/puppet/lib/puppet/graph/simple_graph.rb:474:in `write_graph'\r\nC:/work/puppet/lib/puppet/resource/catalog.rb:448:in `write_graph'\r\nC:/work/puppet/lib/puppet/resource/catalog.rb:231:in `finalize'\r\nC:/work/puppet/lib/puppet/application/apply.rb:219:in `block in main'\r\nC:/work/puppet/lib/puppet/context.rb:56:in `override'\r\nC:/work/puppet/lib/puppet.rb:234:in `override'\r\nC:/work/puppet/lib/puppet/application/apply.rb:190:in `main'\r\nC:/work/puppet/lib/puppet/application/apply.rb:151:in `run_command'\r\nC:/work/puppet/lib/puppet/application.rb:371:in `block (4 levels) in run'\r\nC:/work/puppet/lib/puppet/application.rb:479:in `plugin_hook'\r\nC:/work/puppet/lib/puppet/application.rb:371:in `block (3 levels) in run'\r\nC:/work/puppet/lib/puppet/util.rb:479:in `exit_on_fail'\r\nC:/work/puppet/lib/puppet/application.rb:371:in `block (2 levels) in run'\r\nC:/work/puppet/lib/puppet/context.rb:56:in `override'\r\nC:/work/puppet/lib/puppet.rb:234:in `override'\r\nC:/work/puppet/lib/puppet/application.rb:361:in `block in run'\r\nC:/work/puppet/lib/puppet/context.rb:56:in `override'\r\nC:/work/puppet/lib/puppet.rb:234:in `override'\r\nC:/work/puppet/lib/puppet/application.rb:356:in `run'\r\nC:/work/puppet/lib/puppet/util/command_line.rb:137:in `run'\r\nC:/work/puppet/lib/puppet/util/command_line.rb:91:in `execute'\r\nC:/work/puppet/bin/puppet:4:in `<top (required)>'\r\nC:/work/puppet/.bundle/gems/ruby/1.9.1/bin/puppet:23:in `load'\r\nC:/work/puppet/.bundle/gems/ruby/1.9.1/bin/puppet:23:in `<main>'\r\n{noformat}\r\n\r\nThe problem is that the code that writes the graph, {{Catalog.write_graph}}, executes before the code that creates the necessary directories, {{Puppet.settings.use(:agent)}}.","closed_at":"2019-04-04T22:35:36.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2638","labels":"","state":"Closed","updated_at":"2019-04-04T22:35:36.000-0700","timestamp":1652286101.793615,"priority":"Normal","status_category":"Done","pull_request":3996},{"issue_id":"58185","title":"Unable to create/force empty Windows groups","url":"https://tickets.puppetlabs.com/browse/PUP-3653","created_at":"2014-11-10T12:41:49.000-0800","number":"PUP-3653","body":"In Windows, many groups are built-in and cannot be removed, therefore {{ensure => absent}} is useless.  Another approach would be to define the group as present with no members.  For example:\r\n\r\n{noformat}\r\ngroup { 'Guests':\r\n  ensure  => 'present',\r\n  members => [],\r\n}\r\n{noformat}\r\n\r\nUnfortunately, this will not remove any members of the built-in Guests group, but instead leave any members existing.\r\n\r\nThe underlying goal is to ensure that all unnecessary groups are empty.\r\n\r\nh3. Update for Puppet 4\r\nIn PUP 4.x+, because groups are not authoritative by default, you need the add {{auth_membership => true}} to the mix to force an existing group to empty.\r\n\r\n{noformat}\r\ngroup { 'Guests':\r\n  ensure  => 'present',\r\n  members => [],\r\n  auth_membership => true,\r\n}\r\n{noformat}\r\n","closed_at":"2019-04-04T22:35:37.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3653","labels":"puppet-agent;windows","state":"Closed","updated_at":"2019-04-04T22:35:37.000-0700","timestamp":1652286102.013011,"priority":"Normal","status_category":"Done","pull_request":3786},{"issue_id":"11206","title":"Puppet returns different result non-existent services on EL and Debian","url":"https://tickets.puppetlabs.com/browse/PUP-41","created_at":"2013-06-19T02:52:48.000-0700","number":"PUP-41","body":"EL and Debian have different results for service resources that don't exist.\n\nOn EL, `puppet resource service abcdefg` will return\n\n    service { 'abcdefg':\n      ensure => 'stopped',\n      enable => 'false',\n    }\n\nOn Debian, this will return\n\n    Error: Could not run: Could not find init script for 'abcdefg'\n\nWhile what is returned by puppet on EL is technically true, it isn't particularly useful. Puppet on EL doesn't seem to have a notion of a purged service.\n\nThis causes issues for Live Management in PE 3, since we are adding service as a browsable resource type (appears in the list of resources under 'Browse Resources') - see PE-714.","closed_at":"2019-04-04T22:35:38.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-41","labels":"manage-service","state":"Closed","updated_at":"2019-04-04T22:35:38.000-0700","timestamp":1652286102.118369,"priority":"Major","status_category":"Done","pull_request":4017},{"issue_id":"13162","title":"Puppet agent cannot read facts.d on Windows","url":"https://tickets.puppetlabs.com/browse/PUP-221","created_at":"2013-08-09T11:38:23.000-0700","number":"PUP-221","body":"Links to PE-1237\n\nNeeded for 3.0.1","closed_at":"2019-04-04T22:35:43.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-221","labels":"","state":"Resolved","updated_at":"2019-04-04T22:35:43.000-0700","timestamp":1652286118.184649,"priority":"Critical","status_category":"Done","pull_request":2631},{"issue_id":"13837","title":"Empty string element in containment path array","url":"https://tickets.puppetlabs.com/browse/PUP-278","created_at":"2013-08-29T09:02:52.000-0700","number":"PUP-278","body":"Now that we are storing resource containment paths in PuppetDB, we've noticed that many of the paths that puppet passes around contain an empty element.\n\nFor example, if you watch the log messages on an agent run, you may see a resource path logged like this:\n\n    /Stage[main]//Foo/Notify['bar']\n\nNote the double slash after Stage.  When we receive the containment path in the report processor, it's represented as an array of strings, and in a case like the one above, the array would look like this:\n\n    [\"Stage[main]\", \"\", \"Foo\", \"Notify['bar']\"]\n\nI'm questioning whether or not that empty string at index 1 is intentional or not.  It seems like it's probably not, and that we should probably tweak puppet to get rid of it...\n\nI'm also debating whether or not the PuppetDB report terminus should filter this out.  If it's not meaningful and is just going to confuse end users, then we probably should; if we're going to get rid of it in Puppet, then it probably makes sense to add a filter for it in the PuppetDB terminus so that the data looks consistent between older versions of puppet and new ones.\n\nHowever, at this point, I'm mostly just trying to determine whether or not this behavior is intentional, and decide what to do about it.\n\nNOTE: I do not consider this to be a blocker for the upcoming PE release, just want to get a conversation started.\n\n","closed_at":"2019-04-04T22:35:43.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-278","labels":"","state":"Closed","updated_at":"2019-04-04T22:35:43.000-0700","timestamp":1652286118.289018,"priority":"Minor","status_category":"Done","pull_request":2780},{"issue_id":"13528","title":"Recursive file resources (and probably all implicit resources) have no containment path","url":"https://tickets.puppetlabs.com/browse/PUP-257","created_at":"2013-08-20T15:58:15.000-0700","number":"PUP-257","body":"This is a duplicate of Redmine #22229; bringing it in to Jira because [~wagner] has indicated that this is a blocker for Burgundy release.\n\n------------------------------------------------------------------------------------\n\nWhen a directory is being managed recursively, the file resources created within the directory do not have any class containment.\nFor example:\n\n    file { '/tmp/example':\n      source  => 'puppet:///modules/example/example',\n      recurse => true,\n    }\n\nWill result in:\n\n    Notice: **/Stage[main]/Example**/File[/tmp/example]/ensure: created\n    Notice: /File[/tmp/example/example_directory]/ensure: created\n    Notice: /File[/tmp/example/example_directory/example_file3]/ensure: defined content as '{md5}d41d8cd98f00b204e9800998ecf8427e'\n    Notice: /File[/tmp/example/example_file2]/ensure: defined content as '{md5}d41d8cd98f00b204e9800998ecf8427e'\n    Notice: /File[/tmp/example/example_file1]/ensure: defined content as '{md5}d41d8cd98f00b204e9800998ecf8427e'\n\nNotice how the explicit resource shows its containment path as starting from `Stage[main]`, and includes the class that contains the resource; however, all of the implicit resources appear to be top-level resources.  This has a big impact on the usefulness of the Burgundy UI.","closed_at":"2019-04-04T22:35:44.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-257","labels":"","state":"Resolved","updated_at":"2019-04-04T22:35:44.000-0700","timestamp":1652286118.392834,"priority":"Critical","status_category":"Done","pull_request":4246},{"issue_id":"13337","title":"Filebucket corrupts files","url":"https://tickets.puppetlabs.com/browse/PUP-228","created_at":"2013-08-14T14:59:06.000-0700","number":"PUP-228","body":"I am escalating the following issue as a priority 3. \n\nhttps://support.puppetlabs.com/tickets/2682\n\nEssentially the customer has given me a set of manifests and files that will always cause an error backing up files to the file bucket.  \n\nThe issue with the filebucket can be resolved by deleting corresponding files from the bucket folder on the master, however, that isn't scalable when he's trying to deploy this to new nodes on a regular basis.  \n\nI've attached the files to recreate the issue and an example puppet run output as the most recent comment on the ticket.  I'm hoping someone can let us know why the issue is occurring and hopefully provide a patch or a workaround.  ","closed_at":"2019-04-04T22:35:46.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-228","labels":"","state":"Resolved","updated_at":"2019-04-04T22:35:46.000-0700","timestamp":1652286118.922786,"priority":"Major","status_category":"Done","pull_request":5956},{"issue_id":"13775","title":"Versionable Windows Package Provider","url":"https://tickets.puppetlabs.com/browse/PUP-272","created_at":"2013-08-28T12:19:18.000-0700","number":"PUP-272","body":"See PE-1269","closed_at":"2019-04-04T22:35:46.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-272","labels":"windows","state":"Resolved","updated_at":"2019-04-04T22:35:46.000-0700","timestamp":1652286119.025969,"priority":"Major","status_category":"Done","pull_request":3966},{"issue_id":"13795","title":"Too many new clients can cause CA to get confused","url":"https://tickets.puppetlabs.com/browse/PUP-277","created_at":"2013-08-28T14:50:24.000-0700","number":"PUP-277","body":"If too many new clients try to check in to the CA at the same time, the CA gets confused. Errors on the client say Cannot find certificate request for $HOSTNAME. The problem is that $HOSTNAME does not actually match the hostname of the client returning the error. I have since been using a ssh loop to avoid having them all check in at the same time and have not encountered this again, but I saw it with as little as 5 servers checking in for the first time at the same time.\n","closed_at":"2019-04-04T22:35:47.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-277","labels":"","state":"Closed","updated_at":"2019-04-04T22:35:47.000-0700","timestamp":1652286119.130289,"priority":"Major","status_category":"Done","pull_request":2825},{"issue_id":"13908","title":"Accept processor should handle 'Accept: */*'","url":"https://tickets.puppetlabs.com/browse/PUP-282","created_at":"2013-08-30T11:54:36.000-0700","number":"PUP-282","body":"Puppet dashboard makes cert requests using an Accept of `*/*`, which is not accepted by a puppet master.\n\n** cd /opt/puppet/share/puppet-dashboard; /opt/puppet/bin/bundle exec /opt/puppet/bin/rake -s -f /opt/puppet/share/puppet-dashboard/Rakefile cert:request RAILS_ENV=production\nrake aborted!\n406 \"Not Acceptable\"\nThe master log has the following entry: Aug 30 11:35:52 localhost puppet-master[26755]: Not Acceptable: No supported formats are acceptable (Accept: */*)","closed_at":"2019-04-04T22:35:47.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-282","labels":"","state":"Resolved","updated_at":"2019-04-04T22:35:47.000-0700","timestamp":1652286119.23383,"priority":"Blocker","status_category":"Done","pull_request":7940},{"issue_id":"14613","title":"Reports nolonger work for clients older than 3.3.0 when using a 3.3.0 puppet master","url":"https://tickets.puppetlabs.com/browse/PUP-336","created_at":"2013-09-13T09:48:35.000-0700","number":"PUP-336","body":null,"closed_at":"2019-04-04T22:35:48.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-336","labels":"","state":"Resolved","updated_at":"2019-04-04T22:35:48.000-0700","timestamp":1652286119.438384,"priority":"Normal","status_category":"Done","pull_request":6258},{"issue_id":"14322","title":"Puppet doesn't gracefully handle invalid state.yaml when using Psych parser","url":"https://tickets.puppetlabs.com/browse/PUP-308","created_at":"2013-09-09T16:15:12.000-0700","number":"PUP-308","body":"state.yaml can be invalid for a number of reasons, and when it cannot be correctly loaded Puppet tries to rescue the error. This works in Syck (default in ruby 1.8), but fails in ruby 1.9 with Psych because the loaderror is raised as a Psych::SyntaxError which is a subclass of SyntaxError. A blind rescue won't catch a SyntaxError, so Puppet needs to also rescue Psych::SyntaxError to gracefully handle an invalid state.yaml file.\n\nA puppet apply run after deliberately invalidating state.yaml:\n\n<pre>\n[root@el5-64 ~]# puppet apply --exec 'notify {\"hello\":}'\nNotice: Compiled catalog for el5-64.localdomain in environment production in 0.04 seconds\nError: Could not run: (<unknown>): could not find expected ':' while scanning a simple key at line 4 column 3\n</pre>\n\nWe use the following bit of code in lib/puppet/indirector/yaml.rb that would help alleviate this problem.\n\n<pre>\n  4 class Puppet::Indirector::Yaml < Puppet::Indirector::Terminus\n  5   if defined?(::Psych::SyntaxError)\n  6     YamlLoadExceptions = [::StandardError, ::ArgumentError, ::Psych::SyntaxError]\n  7   else\n  8     YamlLoadExceptions = [::StandardError, ::ArgumentError]\n  9   end\n</pre>","closed_at":"2019-04-04T22:35:49.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-308","labels":"","state":"Resolved","updated_at":"2019-04-04T22:35:49.000-0700","timestamp":1652286119.644913,"priority":"Normal","status_category":"Done","pull_request":4000},{"issue_id":"14434","title":"Excessive logging from files not found in file resources","url":"https://tickets.puppetlabs.com/browse/PUP-315","created_at":"2013-09-11T10:15:37.000-0700","number":"PUP-315","body":null,"closed_at":"2019-04-04T22:35:49.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-315","labels":"","state":"Resolved","updated_at":"2019-04-04T22:35:49.000-0700","timestamp":1652286119.747587,"priority":"Normal","status_category":"Done","pull_request":3066},{"issue_id":"15323","title":"Reboot module has temp description","url":"https://tickets.puppetlabs.com/browse/PUP-433","created_at":"2013-09-26T12:23:19.000-0700","number":"PUP-433","body":"There's a fake description for the reboot module. See attached screenshot. It looks amateurish. We should either give it a real description or remove the description altogether.\r\n","closed_at":"2019-04-04T22:35:51.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-433","labels":"windows","state":"Resolved","updated_at":"2019-04-04T22:35:51.000-0700","timestamp":1652286120.270838,"priority":"Normal","status_category":"Done","pull_request":3763},{"issue_id":"15910","title":"Puppet times out when receiving large reports","url":"https://tickets.puppetlabs.com/browse/PUP-439","created_at":"2013-10-01T09:06:59.000-0700","number":"PUP-439","body":"Running `puppet agent -t` on a node containing a manifest with 10,000 file resources times out trying to submit the report.\r\n\r\nIn 2.8.2 the error is\r\nnotice: Finished catalog run in 118.16 seconds\r\nerr: Could not run Puppet configuration client: execution expired\r\n\r\nIn 3.1.0 the error is\r\nrror: Could not retrieve catalog from remote server: Timeout::Error\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run","closed_at":"2019-04-04T22:35:52.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-439","labels":"qa-reviewed;scalability","state":"Closed","updated_at":"2019-04-04T22:35:52.000-0700","timestamp":1652286120.374639,"priority":"Major","status_category":"Done","pull_request":3824},{"issue_id":"16199","title":"Puppet cannot store empty files into filebucket","url":"https://tickets.puppetlabs.com/browse/PUP-510","created_at":"2013-10-03T08:15:29.000-0700","number":"PUP-510","body":"Steps to reproduce:\r\n\r\n1. Configure a master and an agent (can be on a single machine)\r\n2. Create an empty file\r\n3. Try to backup the file\r\n\r\nExpected behaviour: The file is stored in the filebucket\r\nActual behaviour: Error 400 is raised\r\n\r\n{code}\r\nroot@petest:/tmp# >tstfile\r\nroot@petest:/tmp# puppet filebucket backup /tmp/tstfile        \r\nError: Could not back up /tmp/tstfile: Error 400 on SERVER: No data to save\r\nError: Could not run: Could not back up /tmp/tstfile: Error 400 on SERVER: No data to save\r\n{code}\r\n\r\nWhen run with a local filebucket everything looks good:\r\n\r\n{code}\r\nroot@petest:/tmp# puppet filebucket backup /tmp/tstfile --local\r\n/tmp/tstfile: d41d8cd98f00b204e9800998ecf8427e\r\n{code}\r\n\r\nWhen there's content in the file it looks good as well:\r\n\r\n{code}\r\nroot@petest:/tmp# echo Hello >tstfile\r\nroot@petest:/tmp# puppet filebucket backup /tmp/tstfile\r\n/tmp/tstfile: 09f7e02f1290be211da707a266f153b3\r\n{code}\r\n\r\nThis happens in the following version (not sure what is the first affected version):\r\n{code}\r\nroot@petest:/tmp# puppet --version\r\n3.3.1 (Puppet Enterprise 3.1.0-rc1-3-geacb9a8)\r\n{code}\r\n\r\nThis looks like a major bug since any content change on a file that's empty prevents the catalog from successful applying.\r\n\r\nNote: The same operation works fine with PE 2.8.1\r\n","closed_at":"2019-04-04T22:35:52.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-510","labels":"","state":"Resolved","updated_at":"2019-04-04T22:35:52.000-0700","timestamp":1652286120.579907,"priority":"Major","status_category":"Done","pull_request":7678},{"issue_id":"16552","title":"Puppet should not use --include-dependencies with gem provider","url":"https://tickets.puppetlabs.com/browse/PUP-544","created_at":"2013-10-10T10:52:07.000-0700","number":"PUP-544","body":"This is a customer request for a backport of c07f0a9 (#19663) to PE 2.8.x. Ruby Gems 2.0 and newer outright reject the --include-dependencies flag which prevents Puppet from managing gems on newer Ruby installations.","closed_at":"2019-04-04T22:35:53.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-544","labels":"customer;redmine;support","state":"Resolved","updated_at":"2019-04-04T22:35:53.000-0700","timestamp":1652286120.685409,"priority":"Major","status_category":"Done","pull_request":4453},{"issue_id":"16482","title":"Race condition in filebucket","url":"https://tickets.puppetlabs.com/browse/PUP-538","created_at":"2013-10-09T10:48:28.000-0700","number":"PUP-538","body":"The file bucket writes files in an unsafe way. First it tests for the existence of the file, and then it attempts to write to the file if it doesn't exist. Since file contents are written with 440 permissions, this raises a permission denied error and causes an agent failure.","closed_at":"2019-04-04T22:35:53.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-538","labels":"qa-reviewed","state":"Closed","updated_at":"2019-04-04T22:35:53.000-0700","timestamp":1652286120.791493,"priority":"Normal","status_category":"Done","pull_request":4383},{"issue_id":"16810","title":"Puppet events from Debian show in event inspector as \"unclassified\"","url":"https://tickets.puppetlabs.com/browse/PUP-565","created_at":"2013-10-16T09:17:18.000-0700","number":"PUP-565","body":"This issue is being reported against Event Inspector but may have an underlying cause in Puppet or PuppetDB.\r\n\r\nEvents from Debian-based systems are not correctly associated with a class when viewed in Event Inspector. This means that \"Classes with Failures\" can be zero, while \"Nodes with Failures\" can show _n_ Debian nodes where _n_ is not zero.\r\n\r\nTake the following class for example.\r\n\r\n{code}\r\nclass profile::localusers {\r\n\r\n  # The guy driving the demo\r\n  user { 'reid':\r\n    ensure => present,\r\n    uid    => '1500',\r\n  }\r\n\r\n  # User Experience design team\r\n  user { 'joe':\r\n    ensure => present,\r\n    uid    => '1501',\r\n  }\r\n\r\n  # Puppet Enterprise product owner\r\n  user { 'lindsey':\r\n    ensure => present,\r\n    uid    => '1502',\r\n  }\r\n\r\n  # A system user\r\n  user { 'git':\r\n    ensure => present,\r\n    uid    => '501',\r\n  }\r\n\r\n  # A system user also. Does the same thing as the git user so\r\n  # best practices aside I want it to have the same uid as git.\r\n  user { 'svn':\r\n    ensure => present,\r\n    uid    => '501',\r\n  }\r\n\r\n}\r\n{code}\r\n\r\nApplying to five nodes, three CentOS, a Debian and an Ubuntu, we get the following results.\r\n\r\n!Screen Shot 2013-10-15 at 12.14.57 PM.png|width=\"700\"!\r\n\r\n!Screen Shot 2013-10-15 at 12.27.10 PM.png|width=\"700\"!\r\n\r\n!Screen Shot 2013-10-15 at 12.15.08 PM.png|width=\"700\"!\r\n\r\n!Screen Shot 2013-10-15 at 12.15.14 PM.png|width=\"700\"!\r\n\r\n!Screen Shot 2013-10-15 at 12.15.18 PM.png|width=\"700\"!\r\n\r\nNote the failed resources in the Debian nodes, marked \"unclassified'.\r\n\r\n(The images don't show up in the preview, hopefully it works after the issue is created)","closed_at":"2019-04-04T22:35:54.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-565","labels":"","state":"Closed","updated_at":"2019-04-04T22:35:54.000-0700","timestamp":1652286121.299327,"priority":"Major","status_category":"Done","pull_request":4620},{"issue_id":"17099","title":"Cached catalogs no longer work in PE 3.0.0 and above","url":"https://tickets.puppetlabs.com/browse/PUP-580","created_at":"2013-10-23T07:48:25.000-0700","number":"PUP-580","body":"From Redmine:\r\n\r\nCached catalogs no longer work in PE 3.0.0 and above.\r\n\r\nNote: I’ve truncated the output where it made sense to do so.\r\n\r\nPE 2.8.3:\r\n\r\n{code}\r\n[root@pe-28-master ~]# puppet --version\r\n2.7.23 (Puppet Enterprise 2.8.3)\r\n\r\n[root@pe-28-master ~]# cat /etc/puppetlabs/puppet/manifests/site.pp\r\nnode default {\r\n  # This is where you can declare classes for all nodes.\r\n  # Example:\r\n  #   class { 'my_class': }\r\n}\r\n\r\nnotify { 'BU BU BU BIRD BIRD BIRD, BIRD IS THE WORD':}\r\n\r\n[root@pe-28-master ~]# puppet agent --onetime --no-daemonize --verbose\r\ninfo: Caching catalog for pe-28-master.puppetdebug.vlan\r\ninfo: Applying configuration version '1382386729'\r\nnotice: BU BU BU BIRD BIRD BIRD, BIRD IS THE WORD\r\nnotice: /Stage[main]//Notify[BU BU BU BIRD BIRD BIRD, BIRD IS THE WORD]/message: defined 'message' as 'BU BU BU BIRD BIRD BIRD, BIRD IS THE WORD'\r\nnotice: Finished catalog run in 0.05 seconds\r\n\r\n[root@pe-28-master ~]# /etc/init.d/pe-httpd stop\r\nStopping pe-httpd:                                         [  OK  ]\r\n[root@pe-28-master ~]# puppet agent --onetime --no-daemonize --verbose\r\ninfo: Retrieving plugin\r\nerr: /File[/var/opt/lib/pe-puppet/lib]: Failed to generate additional resources using 'eval_generate: Connection refused - connect(2)\r\nerr: /File[/var/opt/lib/pe-puppet/lib]: Could not evaluate: Connection refused - connect(2) Could not retrieve file metadata for puppet://pe-28-master.puppetdebug.vlan/plugins: Connection refused - connect(2)\r\ninfo: Loading facts in /opt/puppet/share/puppet/modules/stdlib/lib/facter/pe_version.rb\r\ninfo: Loading facts in /opt/puppet/share/puppet/modules/stdlib/lib/facter/facter_dot_d.rb\r\ninfo: Loading facts in /opt/puppet/share/puppet/modules/stdlib/lib/facter/puppet_vardir.rb\r\ninfo: Loading facts in /opt/puppet/share/puppet/modules/stdlib/lib/facter/root_home.rb\r\ninfo: Loading facts in /opt/puppet/share/puppet/modules/auth_conf/lib/facter/custom_auth_conf.rb\r\ninfo: Loading facts in /opt/puppet/share/puppet/modules/concat/lib/facter/concat_basedir.rb\r\ninfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/pe_version.rb\r\ninfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/custom_auth_conf.rb\r\ninfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/concat_basedir.rb\r\ninfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/facter_dot_d.rb\r\ninfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/puppet_vardir.rb\r\ninfo: Loading facts in /var/opt/lib/pe-puppet/lib/facter/root_home.rb\r\nerr: Could not retrieve catalog from remote server: Connection refused - connect(2)\r\nnotice: Using cached catalog\r\ninfo: Applying configuration version '1382386729'\r\nnotice: BU BU BU BIRD BIRD BIRD, BIRD IS THE WORD\r\nnotice: /Stage[main]//Notify[BU BU BU BIRD BIRD BIRD, BIRD IS THE WORD]/message: defined 'message' as 'BU BU BU BIRD BIRD BIRD, BIRD IS THE WORD'\r\nnotice: Finished catalog run in 0.04 seconds\r\nerr: Could not send report: Connection refused - connect(2)\r\n{code}\r\n\r\nGreat, behaves as we expect.\r\n\r\nPE 3.1.0\r\n\r\n{code}\r\n[root@pe-310-master manifests]# puppet --version\r\n3.3.1 (Puppet Enterprise 3.1.0)\r\n\r\n[root@pe-310-master manifests]# cat /etc/puppetlabs/puppet/manifests/site.pp\r\nnode default {W\r\n  # This is where you can declare classes for all nodes.\r\n  # Example:\r\n  #   class { 'my_class': }\r\n}\r\n\r\nnotify { 'BU BU BU BIRD BIRD BIRD, BIRD IS THE WORD': }\r\n\r\n[root@pe-310-master manifests]# puppet agent --test\r\nInfo: Applying configuration version '1382387428'\r\nNotice: BU BU BU BIRD BIRD BIRD, BIRD IS THE WORD\r\nNotice: /Stage[main]//Notify[BU BU BU BIRD BIRD BIRD, BIRD IS THE WORD]/message: defined 'message' as 'BU BU BU BIRD BIRD BIRD, BIRD IS THE WORD'\r\n\r\n[root@pe-310-master manifests]# puppet agent --onetime --verbose --no-daemonize\r\nError: Failed to apply catalog: Connection refused - connect(2)\r\nError: Could not send report: Connection refused - connect(2)\r\n{code}\r\n\r\nThe run is not attempted with a cached catalog.\r\n\r\nSame result with puppet agent --onetime --verbose --no-daemonize --debug --use_cached_catalog.\r\nSame result with 3.0.x series.","closed_at":"2019-04-04T22:35:54.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-580","labels":"redmine","state":"Closed","updated_at":"2019-04-04T22:35:54.000-0700","timestamp":1652286121.409834,"priority":"Normal","status_category":"Done","pull_request":8824},{"issue_id":"17790","title":"If insync? on a property causes a failure then you get a failed event on the resource, rather than on the property","url":"https://tickets.puppetlabs.com/browse/PUP-639","created_at":"2013-10-30T11:53:19.000-0700","number":"PUP-639","body":"If you try to change the owner or group of a file to an owner/group that doesn't exist, you end up with a failure event for the whole resource, with no property listed in the event. We know what property failed, so the event should happen for that property, rather than for the whole resource/without a property.","closed_at":"2019-04-04T22:35:56.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-639","labels":"","state":"Resolved","updated_at":"2019-04-04T22:35:56.000-0700","timestamp":1652286121.852869,"priority":"Normal","status_category":"Done","pull_request":5962},{"issue_id":"17619","title":"CLONE - Resource display differs when resource is first enforced vs. when later changed","url":"https://tickets.puppetlabs.com/browse/PUP-633","created_at":"2013-10-29T16:00:29.000-0700","number":"PUP-633","body":"As noted in PE-1772, multiple parameter changes on a resource on the same node during the same Puppet run show up as apparent \"duplicates\" in the resource detail list.\r\n\r\nHowever, for some resource types, when that resource is first enforced, only one entry shows in the resource list.  For example, \"file\" resources, when the file is first created, will show only one line in the resource list regardless of how many additional parameters (owner, group, permissions, etc.) are enforced at the same time as the file is created.  Subsequent changes enforced by Puppet on a file that is already present on the file system will show as individual events; for example, simultaneous changes to mode and content as in the screenshots attached to PE-1772. \r\n\r\nThis behavior is possibly confusing to the end user since for many resources there is no clear binary distinction between the first-time initialization of a resource and subsequent updates to it.  For example, what does it mean to \"create\" an \"exec\" resource? Under what conditions should events resulting from a single enforcement of an \"exec\" resource be collapsed into one event, and under what conditions should they be split up as in PE-1772?  ","closed_at":"2019-04-04T22:35:56.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-633","labels":"docs_reviewed;qa-reviewed","state":"Closed","updated_at":"2019-04-04T22:35:56.000-0700","timestamp":1652286122.080658,"priority":"Normal","status_category":"Done","pull_request":5230},{"issue_id":"18844","title":"CLONE - Puppet windows spec tests get permission denied error during file server test","url":"https://tickets.puppetlabs.com/browse/PUP-738","created_at":"2013-11-13T13:22:21.000-0800","number":"PUP-738","body":"I don't know if this is a legitimate failure or an infra bug. I'd like some eyes from the platform team on it to confirm expected behavior here and file appropriate tickets if there is an issue.\r\n\r\n{noformat}\r\nFailures:\r\n\r\n  1) Puppet::Indirector::DirectFileServer  when interacting with FileServing::Fileset and the model should return instances capable of returning their content\r\n     Failure/Error: when /one/; instance.content.should == \"one content\"\r\n     Errno::EACCES:\r\n       Permission denied - C:/Users/ADMINI~1/AppData/Local/Temp/rspecrun20131108-2556-9nu7l6/direct_file_server_testing20131108-2556-1w8ones\r\n     # ./lib/puppet/file_serving/content.rb:37:in `binread'\r\n     # ./lib/puppet/file_serving/content.rb:37:in `content'\r\n     # ./spec/integration/indirector/direct_file_server_spec.rb:61:in `block (3 levels) in <top (required)>'\r\n     # ./spec/integration/indirector/direct_file_server_spec.rb:59:in `each'\r\n     # ./spec/integration/indirector/direct_file_server_spec.rb:59:in `block (2 levels) in <top (required)>'\r\n\r\nFinished in 9 minutes 10.99 seconds\r\n18436 examples, 1 failure, 80 pending\r\n{noformat}\r\n\r\nhttp://jenkins-enterprise.delivery.puppetlabs.net/view/Component%20Specs/job/Puppet%20Specs%20(Windows)/95/","closed_at":"2019-04-04T22:35:57.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-738","labels":"windows","state":"Closed","updated_at":"2019-04-04T22:35:57.000-0700","timestamp":1652286122.301482,"priority":"Normal","status_category":"Done","pull_request":5877},{"issue_id":"18742","title":"Cannot add aliases without a catalog","url":"https://tickets.puppetlabs.com/browse/PUP-726","created_at":"2013-11-12T15:20:21.000-0800","number":"PUP-726","body":"During PE installation, Puppet fails with the following new error:\r\n\r\n{code}\r\n[root@centos6 ~]# /opt/puppet/bin/puppet apply --no-report --modulepath /opt/puppet/share/puppet/modules -v --exec \"class { pe_postgresql: version => '9.2', config_hash => { listen_addresses => 'localhost', ip_mask_allow_all_users => '0.0.0.0/0' } }\" --trace\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/auth_conf/lib/facter/custom_auth_conf.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/pe_puppetdb/lib/facter/puppetdb_server_status.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/stdlib/lib/facter/facter_dot_d.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/stdlib/lib/facter/root_home.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/stdlib/lib/facter/pe_version.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/stdlib/lib/facter/puppet_vardir.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/pe_common/lib/facter/windows.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/postgresql/lib/facter/postgres_default_version.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/concat/lib/facter/concat_basedir.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/firewall/lib/facter/iptables_version.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/firewall/lib/facter/ip6tables_version.rb\r\nInfo: Loading facts in /opt/puppet/share/puppet/modules/firewall/lib/facter/iptables_persistent_version.rb\r\nNotice: Compiled catalog for centos6 in environment production in 2.25 seconds\r\nError: Parameter alias failed on File[/opt/puppet/var/lib/pgsql/9.2/data/pg_hba.conf]: Munging failed for value \"concat_/opt/puppet/var/lib/pgsql/9.2/data/pg_hba.conf\" in class alias: Cannot add aliases without a catalog at /opt/puppet/share/puppet/modules/concat/manifests/init.pp:228\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/type.rb:1347:in `block (2 levels) in <class:Type>'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/parameter.rb:432:in `munge'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/parameter.rb:502:in `value='\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/type.rb:653:in `[]='\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/type.rb:2267:in `block in set_parameters'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/type.rb:2261:in `each'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/type.rb:2261:in `set_parameters'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/type.rb:2217:in `initialize'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/type/file.rb:402:in `initialize'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/resource.rb:307:in `new'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/resource.rb:307:in `to_ral'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/resource/catalog.rb:502:in `block in to_catalog'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/resource/catalog.rb:495:in `each'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/resource/catalog.rb:495:in `to_catalog'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/resource/catalog.rb:397:in `to_ral'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application/apply.rb:207:in `main'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application/apply.rb:146:in `run_command'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application.rb:364:in `block (2 levels) in run'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application.rb:470:in `plugin_hook'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application.rb:364:in `block in run'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util.rb:485:in `exit_on_fail'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/application.rb:364:in `run'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/command_line.rb:132:in `run'\r\n/opt/puppet/lib/ruby/site_ruby/1.9.1/puppet/util/command_line.rb:86:in `execute'\r\n/opt/puppet/bin/puppet:4:in `<main>'\r\n{code}\r\n\r\nObviously during puppet apply there should be a catalog, so this isn't a problem with the module. This appears to be related to work done for PP-565.","closed_at":"2019-04-04T22:35:57.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-726","labels":"","state":"Closed","updated_at":"2019-04-04T22:35:57.000-0700","timestamp":1652286122.411146,"priority":"Blocker","status_category":"Done","pull_request":5845},{"issue_id":"19327","title":"Puppet::Util::SUIDManager.run_and_capture is missing from current puppet","url":"https://tickets.puppetlabs.com/browse/PUP-841","created_at":"2013-11-20T14:06:46.000-0800","number":"PUP-841","body":"The method `run_and_capture` is used by the puppetlabs-postgresql module in its `postgresql_sql` type.\r\n\r\nThis method was removed in commit 026b2f7ea996bb3ab5acbc0214919f3d5bc0754f.\r\n\r\nShipping with that code removed will break all deployments of the puppetdb module currently in the wild.","closed_at":"2019-04-04T22:35:58.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-841","labels":"","state":"Closed","updated_at":"2019-04-04T22:35:58.000-0700","timestamp":1652286122.848976,"priority":"Blocker","status_category":"Done","pull_request":6602},{"issue_id":"22413","title":"Puppet Resource Package fails","url":"https://tickets.puppetlabs.com/browse/PUP-1211","created_at":"2013-12-20T13:21:02.000-0800","number":"PUP-1211","body":"Trying to get all windows package resources i get the following error\r\n\r\n{code}\r\nruby 1.9.3p448 (2013-06-27) [i386-mingw32]\r\n\r\nC:\\Windows\\system32>puppet resource package\r\nError: Could not run: invalid byte sequence in US-ASCII\r\n{code}","closed_at":"2019-04-04T22:36:01.000-0700","comments":17,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1211","labels":"i18n;support;windows","state":"Resolved","updated_at":"2019-04-04T22:36:01.000-0700","timestamp":1652286123.288776,"priority":"Normal","status_category":"Done","pull_request":2229},{"issue_id":"22730","title":"Puppet REST API always fails if there's at least one broken manifest","url":"https://tickets.puppetlabs.com/browse/PUP-1322","created_at":"2013-12-31T05:30:28.000-0800","number":"PUP-1322","body":"Steps to reproduce:\r\n\r\n1. Install several puppet modules\r\n2. Make a syntax error in one or more installed manifests\r\n3. Query <host>/production/resource_types/*?kind=class\r\n4. Query the same url again\r\n\r\nExpected result: Step #3 and #4 returns the same result, containing parseable all classes *)\r\n\r\nActual result: Step #3 fails with an error reporting the first problem it encounters, step #4 fails with \"Import loop detected\"\r\n\r\n*) The question is how errors should be reported - this is a matter of design/discussion. Perhaps it would be good if a list of errors would be exposed in the json structure along with the successfully parsed classes.\r\n","closed_at":"2019-04-04T22:36:02.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1322","labels":"","state":"Closed","updated_at":"2019-04-04T22:36:02.000-0700","timestamp":1652286123.400534,"priority":"Major","status_category":"Done","pull_request":2201},{"issue_id":"24106","title":"test agent/fallback_to_cached_catalog.rb assumes no master is running by default","url":"https://tickets.puppetlabs.com/browse/PUP-1485","created_at":"2014-01-21T11:52:42.000-0800","number":"PUP-1485","body":"When running the puppet tests against pe, the master is running even outside of a with_puppet_running_on block.\r\n\r\nDo we need a \"without_puppet_running_on\" block in beaker?","closed_at":"2019-04-04T22:36:04.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1485","labels":"","state":"Closed","updated_at":"2019-04-04T22:36:04.000-0700","timestamp":1652286123.841859,"priority":"Normal","status_category":"Done","pull_request":2291},{"issue_id":"22412","title":"authentication_authority key is not set when managing root's password using the puppet user provider","url":"https://tickets.puppetlabs.com/browse/PUP-1210","created_at":"2013-12-20T13:20:40.000-0800","number":"PUP-1210","body":"If you try to set the root password on OS X using the Puppet user provider, there are two bugs:\r\n\r\n1. /var/db/dslocal/nodes/Default/users/root.plist has the 'passwd' key set incorrectly.  It sets:\r\n\r\n{code:xml}\r\n<key>passwd</key>\r\n<string>********</string>\r\n{code}\r\n\r\nwhen it should be:\r\n\r\n{code:xml}\r\n<key>passwd</key>\r\n<array>\r\n             <string>********</string>\r\n<array>\r\n{code}\r\n\r\nThis causes 'dscl . read /Users/root' to not display the contents of the 'Password' attribute. If you use 'dsenableroot' to enable root, you can see how the passwd key should be set (both in dscl and reading the .plist in dslocal).\r\n\r\n2. The root user cannot log in via the loginwindow (GUI login).  SSH works, but the GUI does not.  The major differences I see between root and other puppet-made accounts is that root lacks the 'KerberosKeys' and 'authentication_authority' keys in its dslocal plist.\r\n\r\n\r\n","closed_at":"2019-04-04T22:36:06.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1210","labels":"osx;redmine","state":"Closed","updated_at":"2019-04-04T22:36:06.000-0700","timestamp":1652286124.394759,"priority":"Normal","status_category":"Done","pull_request":2457},{"issue_id":"29100","title":"Permissions for libdir are set arbitrarily","url":"https://tickets.puppetlabs.com/browse/PUP-1986","created_at":"2014-03-19T11:10:30.000-0700","number":"PUP-1986","body":"It appears that the mode for libdir is set during pluginsync, to the mode of the lib/ directory of some module being synced (apparently whichever comes first). However, the owner and group are always set to root. This means that a module which is readable only by puppet in the modulepath becomes readable only by root in the libdir. That causes problems for users who install modules with restrictive umasks and wish to install plugins for the puppet master, since it isn't actually allowed to load them from the libdir (and {{require}} won't find them in the modulepath).\r\n\r\nWorse still, the mode is set separately from the standard settings catalog, which means even overriding it in {{puppet.conf}} will cause it to be set correctly and then changed later by pluginsync.","closed_at":"2019-04-04T22:36:08.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1986","labels":"customer","state":"Closed","updated_at":"2019-04-04T22:36:08.000-0700","timestamp":1652286125.170025,"priority":"Major","status_category":"Done","pull_request":2513},{"issue_id":"28693","title":"Acceptance tests assume ruby is in path on windows","url":"https://tickets.puppetlabs.com/browse/PUP-1937","created_at":"2014-03-13T14:39:28.000-0700","number":"PUP-1937","body":"Which isn't the case when running PE.\r\n\r\nIf we are going to be able to ensure open source functionality we need to make sure that we can run the tests against PE. PE doesn't include Ruby in the path after its installed. This is an issue with a few tests that directly call ruby.","closed_at":"2019-04-04T22:36:09.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1937","labels":"","state":"Closed","updated_at":"2019-04-04T22:36:09.000-0700","timestamp":1652286125.282154,"priority":"Normal","status_category":"Done","pull_request":2480},{"issue_id":"21694","title":"Spurious 'trigger changed' messages generated by scheduled task provider","url":"https://tickets.puppetlabs.com/browse/PUP-1165","created_at":"2013-12-18T04:52:38.000-0800","number":"PUP-1165","body":"The Windows scheduled task (scheduled_task) provider will generate spurious messages during Puppet runs which suggest that scheduled task resources are being reapplied during each run even when the task is present and its associated resource has not been modified. The messages in question look like the following:\r\n\r\n{noformat}notice: /Stage[main]/Schedtask/Scheduled_task[restart_some_service]/trigger: trigger changed '{'every' => '1', 'on' => ['sun'], 'schedule' => 'weekly', 'start_date' => '2012-10-22', 'start_time' => '01:00'}' to '[{'day_of_week' => ['sun'], 'schedule' => 'weekly', 'start_time' => '01:00'}]'{noformat}\r\n\r\nThe resource associated with the task looks like this:\r\n\r\n{noformat}\r\n  scheduled_task { 'restart_some_service':\r\n    ensure  => present,\r\n    enabled => true,\r\n    command => 'c:\\windows\\restart_some_service.bat',\r\n    user    => 'SYSTEM',\r\n    trigger => {\r\n      schedule    => weekly,\r\n      day_of_week => [sun],\r\n      start_time  => '01:00',\r\n    },\r\n    require => File['restart_some_service.bat'],\r\n  }\r\n{noformat}\r\n\r\nThis seems to be some kind of artifact of date conversion/formatting or something. While Puppet reports a change, examining the history tab for the task shows no changes aside from the initial creation of the task and subsequent 'real' changes which were initiated by actually modifying the resource. The notices will be generated regardless of whether there is a real change to report. ","closed_at":"2019-04-04T22:36:13.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1165","labels":"customer;pe_mcollective;redmine;scheduled_task;windows","state":"Closed","updated_at":"2019-04-04T22:36:13.000-0700","timestamp":1652286126.592947,"priority":"Normal","status_category":"Done","pull_request":3158},{"issue_id":"50626","title":"scheduled_task triggers cannot be updated","url":"https://tickets.puppetlabs.com/browse/PUP-3203","created_at":"2014-09-09T07:05:58.000-0700","number":"PUP-3203","body":"I'm using the scheduled_task provider to create a daily task. The initial task creation goes fine, but on any future puppet run I get things like this:\r\n\r\n{noformat}\r\nchange from {'every' => '1', 'schedule' => 'daily', 'start_date' => '2014-9-9', 'start_time' => '12:00'} to [{'every' => '1', 'schedule' => 'daily', 'start_date' => '2014-9-8', 'start_time' => '12:00'}] failed: no implicit conversion from nil to integer\r\n{noformat}\r\n\r\nI previously had a less complicated definition and got this error:\r\n\r\n{noformat}\r\nchange from {'every' => '1', 'schedule' => 'daily', 'start_date' => '2014-9-8', 'start_time' => '12:00'} to [{'schedule' => 'daily', 'start_time' => '12:00'}] failed: no implicit conversion from nil to integer\r\n{noformat}\r\n\r\nUnfortunately I'm not sure if this was present in 3.6.2 as all my machines are running 3.7.0 and set to automatically upgrade. I made this class shortly before the upgrade and I don't think it was a problem.\r\n\r\nAm I the only one having this problem?","closed_at":"2019-04-04T22:36:14.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3203","labels":"regression;scheduled_task;windows","state":"Closed","updated_at":"2019-04-04T22:36:14.000-0700","timestamp":1652286126.922573,"priority":"Normal","status_category":"Done","pull_request":3159},{"issue_id":"54157","title":"Weekly tasks always notify 'trigger changed'","url":"https://tickets.puppetlabs.com/browse/PUP-3429","created_at":"2014-10-09T11:59:37.000-0700","number":"PUP-3429","body":"The Windows scheduled task (scheduled_task) provider will generate notices that weekly scheduled task triggers are changed even when no change is necessary. The messages in question look like the following:\r\n\r\n{noformat}notice: /Stage[main]/Schedtask/Scheduled_task[weekly_task]/trigger: trigger changed '{'every' => '1', 'on' => ['mon', 'tues', 'wed', 'thurs', 'fri'], 'schedule' => 'weekly', 'start_date' => '2014-10-9', 'start_time' => '07:30'}' to '[{'day_of_week' => ['mon', 'tues', 'wed', 'thurs', 'fri'], 'schedule' => 'weekly', 'start_time' => '07:30'}]'{noformat}\r\n\r\nThe resource associated with the task looks like this:\r\n\r\n{noformat}\r\n  scheduled_task { 'Weekly Task' :\r\n    ensure  => present,\r\n    command => \"C:\\Windows\\System32\\cmd.exe\",\r\n    trigger => {\r\n      schedule    => weekly,\r\n      start_time  => '07:30',\r\n      day_of_week => [mon, tues, wed, thurs, fri],\r\n    },\r\n  }\r\n{noformat}\r\n\r\nThe provider seems to be comparing the day_of_week parameter against the on parameter.  Weekly triggers are supposed to use day_of_week according to the documentation.\r\n","closed_at":"2019-04-04T22:36:15.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3429","labels":"customer;docs_reviewed;scheduled_task;windows","state":"Closed","updated_at":"2019-04-04T22:36:15.000-0700","timestamp":1652286127.141658,"priority":"Normal","status_category":"Done","pull_request":3754},{"issue_id":"55858","title":"Adding a setting to puppet.conf that has a :hook handled on define preloads incorrect directory environment settings.","url":"https://tickets.puppetlabs.com/browse/PUP-3500","created_at":"2014-10-22T00:20:59.000-0700","number":"PUP-3500","body":"When using directory environments, if you have a setting like 'certname' set in puppet.conf (either in main, or in the section that will correspond to the run_mode of your application), setting values will be cached for the production environment which will return legacy default values for manifest and modulepath.\r\n\r\n{noformat}\r\njpartlow@percival:~/work/puppet$ cat ~/.puppet/puppet.conf \r\ncertname=foo\r\nenvironmentpath=$confdir/environments\r\njpartlow@percival:~/work/puppet$ be puppet apply -e 'notice(\"$settings::modulepath\") notice(\"$settings::manifest\") notice(\"$settings::config_version\")'                                                      \r\nNotice: Scope(Class[main]): /home/jpartlow/.puppet/modules:/usr/share/puppet/modules\r\nNotice: Scope(Class[main]): /home/jpartlow/.puppet/manifests/site.pp\r\nNotice: Scope(Class[main]): \r\nNotice: Compiled catalog for foo in environment production in 0.01 seconds\r\nNotice: Finished catalog run in 0.06 seconds\r\n{noformat}\r\n\r\nThe reason for this is that Settings#parse_config looks up the environment for the preferred_run_mode, and then when it attempts to handle any :hooks for settings that have a non-default value, it looks up the setting value in this environment.  This causes a ChainedValues instance to be cached in the @values[environment][preferred_run_mode] hash, but because all of this is happening prior to @global_defaults_initialized being set true (and hence, before Puppet.do_initialize_settings_for_run_mode has set up the base_context and generated environment loaders) we are not yet in a position to create ValuesFromEnvironmentConf sections.  So the ChainedValues instance is created with a value_sets that does not have a section for the environment, and it passes up manifest/modulepath from the defaults instead.\r\n\r\nA solution to this is to use non cached instances of ChainedValues when handling setting values for :hooks.\r\n\r\nThere is a deeper disconnect though both in terms of what it means to handle setting hooks within an environment during configuration parsing, and also, how environment settings should work with their own setting hooks.  Currently they would never be processed if a hook was set on an environment setting and directory environments were in use.","closed_at":"2019-04-04T22:36:15.000-0700","comments":17,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3500","labels":"","state":"Closed","updated_at":"2019-04-04T22:36:15.000-0700","timestamp":1652286127.252379,"priority":"Blocker","status_category":"Done","pull_request":3228},{"issue_id":"273491","title":"External process termination handling rate (including \"exec\" resource) is slow","url":"https://tickets.puppetlabs.com/browse/PUP-9092","created_at":"2018-08-30T08:38:23.000-0700","number":"PUP-9092","body":"*Puppet Version: 4.10.5+*\r\n *Puppet Server Version: irrelevant*\r\n *OS Name/Version: Any supported Windows OS*\r\n\r\nExecuting external processes by puppet on Windows can be very slow, compared to the execution time of the process itself, if the execution time is below 1 second. When applying manifests that contain many \"exec\" resources, it may take many minutes to apply. When analyzing logs, I took note that even simple \"reg query\" process took 1.02/1.03 second to run. Windows doesn't spawn processes that slow, I wrote simple example in C# which showed that my machine is capable of executing about 140 of such commands per second (no parallelism, waiting for exit of each process before spawning another).\r\nI did a little bit of digging and found this [piece of code|https://github.com/puppetlabs/puppet/blob/31cd0aa11218e882c60de416e0f89af7b3c5262b/lib/puppet/util/windows/process.rb#L17]. This code waits for at least one second, unless the process terminated _immediately_ (which is rarely feasible).\r\n Replacing 'sleep(1)' with 'sleep(0)' is the simplest fix, but is not too efficient from a CPU consumption standpoint, so I propose a different fix in a [PR#7033|https://github.com/puppetlabs/puppet/pull/7033].\r\n\r\nI did a little more digging and found out that this 'sleep(1)' was [added|https://github.com/puppetlabs/puppet/commit/1d058ce233aeb2f70e1612c56dac52aa5f9c4387] to properly handle signals, I did additional testing (\"exec\"-ed a slow process and tried to Ctrl-C an interactive puppet run), and it worked.\r\n\r\n*Desired Behavior: Process termination is handled immediately*\r\n\r\n*Actual Behavior: Processes are considered to be running at least for 1 second, even if they exit immediately*\r\n\r\n It would be great if this gets into 4.10.z release train, since at least our company is not yet ready for 5.x.","closed_at":"2019-04-04T22:36:44.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9092","labels":"","state":"Closed","updated_at":"2019-04-04T22:36:44.000-0700","timestamp":1652286127.570662,"priority":"Major","status_category":"Done","pull_request":7038},{"issue_id":"119711","title":"Puppet slowing down after calling Puppet.initialize_settings multiple times","url":"https://tickets.puppetlabs.com/browse/PUP-6000","created_at":"2016-03-03T00:57:19.000-0800","number":"PUP-6000","body":"I experienced some performance issues using foreman-proxy version 1.10.2-1 during class import.\r\n\r\nStack trace brought me to [initializer.rb in theforeman/smart-proxy|https://github.com/theforeman/smart-proxy/blob/develop/modules/puppet_proxy/initializer.rb#L20]. Smart-proxy is calling Puppet.initialize_settings for each puppet class. \r\n\r\nContinuing following stack trace brought me to @hooks_to_call_on_application_initialization array which is growing up on each Puppet.initialize_settings call and I don't think it's a proper behavior. Problematic lines are: [settings.rb:589|https://github.com/puppetlabs/puppet/blob/3.8.6/lib/puppet/settings.rb#L589] and [settings.rb:895|https://github.com/puppetlabs/puppet/blob/3.8.6/lib/puppet/settings.rb#L895]. I think that hooks should be added to this array only if they are unique. Another solution would be to clear hooks_to_call_on_application_initialization on each Puppet.settings.initialize_global_settings and Puppet.settings.initialize_app_defaults call.\r\n\r\n","closed_at":"2019-04-04T22:36:45.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6000","labels":"","state":"Closed","updated_at":"2019-04-04T22:36:45.000-0700","timestamp":1652286127.897319,"priority":"Normal","status_category":"Done","pull_request":4752},{"issue_id":"101461","title":"Slow catalog run after updating to puppet 3.7.5","url":"https://tickets.puppetlabs.com/browse/PUP-5380","created_at":"2015-10-13T11:41:50.000-0700","number":"PUP-5380","body":"After upgrading 3.7.4 -> 3.7.5 (actually i was upgrading to 3.8.2 but was able to trace to performance problems to 3.7.5) I am seeing slower catalog compilations and a lot of failed puppet runs. \r\n\r\nI have about 800-1000 puppet clients connecting to a single puppetserver vm with 8 cores and 16GB RAM. Puppetserver configured with 9 jruby instances and 12GB of java Xmx. With 3.7.4 I have compilation times of 1-5s and now the compilation time is 15-100s _if_ it even succeeds. The majority of my nodes fails with the WritePendingException error. I'm not using puppetdb.\r\n\r\nHere are the log output from puppetserver-access.log for one failed run:\r\n\r\n\r\n{noformat}\r\n172.31.28.123 - - - 12/Oct/2015:11:18:27 +0000 \"GET /production/node/lxserv641.smhi.se?transaction_uuid=95384261-d8f5-48a1-bf35-a4faf21fe5c9&fail_on_404=true HTTP/1.1\" 200 7011 172.31.28.123 172.31.28.123 8140 36744\r\n172.31.28.123 - - - 12/Oct/2015:11:19:03 +0000 \"GET /production/file_metadatas/pluginfacts?links=manage&recurse=true&checksum_type=md5&ignore=.svn&ignore=CVS&ignore=.git HTTP/1.1\" 200 305 172.31.28.123 172.31.28.123 8140 36117\r\n172.31.28.123 - - - 12/Oct/2015:11:20:05 +0000 \"GET /production/file_metadata/pluginfacts?links=manage&source_permissions=use HTTP/1.1\" 404 51 172.31.28.123 172.31.28.123 8140 61710\r\n172.31.28.123 - - - 12/Oct/2015:11:20:38 +0000 \"GET /production/file_metadatas/plugins?links=manage&recurse=true&checksum_type=md5&ignore=.svn&ignore=CVS&ignore=.git HTTP/1.1\" 200 60788 172.31.28.123 172.31.28.123 8140 33207\r\n172.31.28.123 - - - 12/Oct/2015:11:21:17 +0000 \"GET /production/file_metadata/plugins?links=manage&source_permissions=ignore HTTP/1.1\" 200 316 172.31.28.123 172.31.28.123 8140 39250\r\n172.31.28.123 - - - 12/Oct/2015:11:25:33 +0000 \"POST /production/catalog/lxserv641.smhi.se HTTP/1.1\" 200 229376 172.31.28.123 172.31.28.123 8140 255513\r\n\r\n{noformat}\r\n\r\n\r\nand from puppetserver.log\r\n\r\n{noformat}\r\n2015-10-12 11:23:58,642 INFO  [puppet-server] Puppet Compiled catalog for lxserv641.smhi.se in environment production in 43.13 seconds\r\n2015-10-12 11:25:33,160 WARN  [o.e.j.s.HttpChannel] /production/catalog/lxserv641.smhi.se\r\njava.nio.channels.WritePendingException: null\r\n{noformat}\r\n\r\n\r\nSomehow my puppet master is getting overloaded. If I downgrade to 3.7.4, everything is fine. Looking at the release notes for 3.7.5 I cant really see what could cause such a performance difference, any ideas?\r\n\r\nMy guess is that since the catalog run takes so much longer for each agent, the number of concurrent agent runs is rising which overloads the server completely. So the underlying problem is probably a dramatic performance loss. When I use mcollective to trigger a puppet run with 20 concurrent agents it works without any failed runs. It's slow, but it works. Normally, we run puppet via cron with a 900s splay time, so when a single agent run takes up to 100s there's will be a lot of concurrent runs overloading the server. ","closed_at":"2019-04-04T22:36:45.000-0700","comments":47,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5380","labels":"","state":"Closed","updated_at":"2019-04-04T22:36:45.000-0700","timestamp":1652286128.01892,"priority":"Normal","status_category":"Done","pull_request":4349},{"issue_id":"290588","title":"Puppet Parser cannot handle \"case $:xxx:{ default: {} }\" block","url":"https://tickets.puppetlabs.com/browse/PUP-9400","created_at":"2019-01-06T04:57:55.000-0800","number":"PUP-9400","body":"*Puppet Version: 6.1.0*\r\n *Puppet Server Version:* *does not apply***\r\n *OS Name/Version: Windows but does not apply*\r\n\r\nI am using puppet internals (puppet parser) to parse puppet manifests into JSON (puppet structured AST).\r\n\r\nI have noticed that PNTransformer cannot transform this block \r\n{code:java}\r\nclass breakme {\r\n  case \"test\" {\r\n    default: {}\r\n  }\r\n}{code}\r\ninto JSON and crashes \r\n{code:java}\r\nVisitor Error: the configured receiver (Puppet::Pops::Model::PNTransformer) can't handle instance of: NilClass (RuntimeError){code}\r\n(see crash stack trace attached).\r\n\r\n \r\nThe reason of this is because the instruction pretty much produces nothing AND PNTransformer has no method to visit the transform_NilClass (puppet server even thinks it's illegal, This 'case' statement has no effect.). However, the instruction being illegal is irrelevant, as the puppet parser has to parse the AST structure correctly anyway.\r\n \r\nPlease see the puppet-parser-test-current.rb and puppet-parser-test-fixed.rb as self-containing examples\r\n*Desired Behavior:*\r\n\r\n**It should resolve the default section into, for example, a \"nop\" instruction:\r\n{code:java}\r\n{\"^\":[\"class\",{\"#\":[\"name\",\"breakme\",\"body\",[{\"^\":[\"case\",\"test\",[{\"#\":[\"when\",[{\"^\":[\"default\"]}],\"then\",[{\"^\":[\"nop\"]}]]}]]}]]}]}{code}\r\n*Actual Behavior:*\r\n\r\n**It crashes with {color:#FF0000}Visitor Error: the configured receiver (Puppet::Pops::Model::PNTransformer) can't handle instance of: NilClass (RuntimeError){color}\r\n\r\n \r\n\r\n*Solution:*\r\nThe solution would be to add this method to the PNTransformer class:\r\n{code:java}\r\nclass Puppet::Pops::Model::PNTransformer \r\n  def transform_NilClass(e)\r\n    Puppet::Pops::PN::Call.new('nop')\r\n  end\r\nend{code}\r\n Or, it should raise appropriate exception of the expression being illegal, instead of crashing","closed_at":"2019-04-04T22:37:10.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9400","labels":"parser;resolved-issue-added","state":"Closed","updated_at":"2019-04-04T22:37:10.000-0700","timestamp":1652286128.563798,"priority":"Minor","status_category":"Done","pull_request":7326},{"issue_id":"252092","title":"--config_version option to `puppet apply` leads to ruby-specific lastrun YAML","url":"https://tickets.puppetlabs.com/browse/PUP-8767","created_at":"2018-05-22T03:00:46.000-0700","number":"PUP-8767","body":"If you run {{puppet apply --config_version='echo foo' -e 'notify \\{ \"bar\": \\}'}} then the last run summary YAML ends up looking like this\r\n\r\n{noformat}\r\n---\r\nversion:\r\n config: !ruby/string:Puppet::Util::Execution::ProcessOutput \"foo\"\r\n[...]\r\n{noformat}\r\n\r\nHaving the explicit typing makes it difficult to parse with general YAML tools.\r\n\r\n ","closed_at":"2019-04-04T22:37:11.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8767","labels":"","state":"Closed","updated_at":"2019-04-04T22:37:11.000-0700","timestamp":1652286128.777381,"priority":"Minor","status_category":"Done","pull_request":6856},{"issue_id":"175707","title":"puppet prints deprecation warnings for SemVer even though they can't be fixed","url":"https://tickets.puppetlabs.com/browse/PUP-7232","created_at":"2017-02-19T16:33:00.000-0800","number":"PUP-7232","body":"In puppet 4.9.2, if I run {{puppet apply foo.pp}} and it includes {{postgresql}} (from puppetlabs-postgresql), checking of the dependencies in metadata.json will produce the following warning:\r\n\r\n{quote}Warning: Use of class Puppet::SemVer is deprecated. SemanticPuppet::Version or SemanticPuppet::VersionRange should be used instead\r\n   (file & line not available)\r\n{quote}\r\nAs far as I can tell (based on printing a stack trace with {{puts}} in {{SemVer}}), this relates to the continued use of {{SemVer}} in {{module_tool}}, which is scheduled to be fixed in 5.0 (see PUP-6240). As a regular Puppet user, this is rather confusing, since it seems to be instructing the user to fix something, but in fact the user can't fix it. As such, I suggest that the deprecation warning be removed until all uses of {{SemVer}} are removed from Puppet itself, or the condition on when to print it be fixed.","closed_at":"2019-04-04T22:37:13.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7232","labels":"","state":"Closed","updated_at":"2019-04-04T22:37:13.000-0700","timestamp":1652286129.31547,"priority":"Minor","status_category":"Done","pull_request":5651},{"issue_id":"144483","title":"An invalid path to the --logdest option is silently ignored","url":"https://tickets.puppetlabs.com/browse/PUP-6571","created_at":"2016-08-02T09:28:57.000-0700","number":"PUP-6571","body":"When passing an invalid path to the {{--logdest}} option, I would expect at least a warning. Instead, it just silently ignores it:\r\n\r\n{code}\r\n# puppet agent -t --logdest /no/such/path/foo.log\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for master.puppetlabs.vm\r\nInfo: Applying configuration version '1469935005'\r\n[...]\r\nNotice: Applied catalog in 33.58 seconds\r\n{code}\r\n","closed_at":"2019-04-04T22:37:14.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6571","labels":"puppethack;resolved-issue-added;the-goods","state":"Closed","updated_at":"2019-04-04T22:37:14.000-0700","timestamp":1652286142.852953,"priority":"Normal","status_category":"Done","pull_request":7340},{"issue_id":"55402","title":"Windows ffi dependency fails for Ruby 2.1.3","url":"https://tickets.puppetlabs.com/browse/PUP-3479","created_at":"2014-10-16T12:24:18.000-0700","number":"PUP-3479","body":"Ruby 2.1.x was released on Windows for the first time with Ruby 2.1.3 in September: https://www.ruby-forum.com/topic/5768030\r\n\r\nRunning Ruby from source on Windows with Ruby 2.1.3 fails, because ffi 1.9.3 isn't compatible with Ruby 2.1.x. The ffi dependency needs to be updated to require ffi 1.9.5+ on all our projects that depend on it: at least puppet, facter, hiera.","closed_at":"2019-04-04T22:38:27.000-0700","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3479","labels":"puppethack;windows","state":"Closed","updated_at":"2019-04-04T22:38:27.000-0700","timestamp":1652286142.967367,"priority":"Normal","status_category":"Done","pull_request":3378},{"issue_id":"55132","title":"Syntax error in test suite on Ruby <= 1.8.7-p352","url":"https://tickets.puppetlabs.com/browse/PUP-3470","created_at":"2014-10-14T19:24:12.000-0700","number":"PUP-3470","body":"https://github.com/puppetlabs/puppet/commit/baee7126eca089adc894e8ae7232fc3eb698f0c7 introduced a syntax error in the test suite on older Ruby 1.8.7 versions. I've confirmed failure on 1.8.7-p352 and 1.8.7-p302, although it seems to have passed on 1.8.7-p374 on Travis.\r\n\r\nThe problem is that older Rubies don't know that this is a single logical line of code, and need the newline to be escaped:\r\n\r\n  expect(PSON.parse(text))\r\n    .to eq({\"data\" => {}, \"document_type\" => \"Node\"})\r\n\r\nI'm not sure whether this is worth filing a ticket for, but CONTRIBUTING.md requests that commit messages reference a bug number, which is why I'm putting this into Jira. I'll be submitting a trivial pull request shortly.","closed_at":"2019-04-04T22:38:27.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3470","labels":"puppethack","state":"Closed","updated_at":"2019-04-04T22:38:27.000-0700","timestamp":1652286143.076211,"priority":"Minor","status_category":"Done","pull_request":3196},{"issue_id":"20110","title":"puppet apply on Windows always uses *nix style newlines from templates","url":"https://tickets.puppetlabs.com/browse/PUP-927","created_at":"2013-12-03T21:15:04.000-0800","number":"PUP-927","body":"When applying manifests containing templates using 'puppet apply' on Windows, the Windows-style CRLF line ending is always replaced with *nix style LF. The behavior is the same whether the template originally contains Windows line endings or *nix line endings - the generated file always has *nix line endings.\r\n\r\nThis does *not* occur if the template is generated on a Linux master from an erb containing Windows-style line endings (the correct Windows style endings are preserved). Also, very strangely, Windows-style newlines are preserved with 'puppet apply' when run on Linux.\r\n\r\n{noformat}\r\nC:\\>puppet agent -t\r\nInfo: Retrieving plugin\r\n<...snip...>\r\nInfo: Caching catalog for server2008r2a\r\nInfo: Applying configuration version '1386132854'\r\nNotice: /Stage[main]//Node[default]/File[c:/newline_test.txt]/content:\r\n\r\nInfo: /Stage[main]//Node[default]/File[c:/newline_test.txt]: Filebucketed c:/new\r\nline_test.txt to main with sum 72cff61ef2581d7e849e2fa4c20b4e31\r\nNotice: /Stage[main]//Node[default]/File[c:/newline_test.txt]/content: content c\r\nhanged '{md5}72cff61ef2581d7e849e2fa4c20b4e31' to '{md5}ba4749398421eb02703fc958\r\n71fdd73e'\r\nNotice: Finished catalog run in 0.95 second\r\n\r\nC:\\>hexdump.exe newline_test.txt\r\n00000000: 74 65 73 74 0D 0A 74 65 - 73 74 0D 0A 74 65 73 74 |test  test  test|\r\n00000010: 0D 0A 74 65 73 74 0D 0A - 74 65 73 74 0D 0A 74 65 |  test  test  te|\r\n00000020: 73 74 0D 0A 0D 0A       -                         |st    |\r\n00000026;\r\n\r\nC:\\>hexdump.exe newline_test.txt.erb\r\n00000000: 74 65 73 74 0D 0A 74 65 - 73 74 0D 0A 74 65 73 74 |test  test  test|\r\n00000010: 0D 0A 74 65 73 74 0D 0A - 74 65 73 74 0D 0A 74 65 |  test  test  te|\r\n00000020: 73 74 0D 0A 0D 0A       -                         |st    |\r\n00000026;\r\n\r\nC:\\>type test.pp\r\nfile { 'c:/newline_test.txt':\r\n  ensure  => file,\r\n  content => template('c:/newline_test.txt.erb'),\r\n}\r\nC:\\>puppet apply test.pp \r\nNotice: Compiled catalog for server2008r2a in environment production in 0.09 sec\r\nonds\r\nNotice: /Stage[main]//File[c:/newline_test.txt]/content: content changed '{md5}b\r\na4749398421eb02703fc95871fdd73e' to '{md5}72cff61ef2581d7e849e2fa4c20b4e31'\r\nNotice: Finished catalog run in 0.12 seconds\r\n\r\nC:\\>hexdump.exe newline_test.txt\r\n00000000: 74 65 73 74 0A 74 65 73 - 74 0A 74 65 73 74 0A 74 |test test test t|\r\n00000010: 65 73 74 0A 74 65 73 74 - 0A 74 65 73 74 0A 0A    |est test test  |\r\n0000001f;\r\n{noformat}\r\n\r\nNote that I have only tested this on Puppet Enterprise.\r\n\r\n\r\n*Note*: There may be other places this happens. Look for File.read and adjust.\r\n\r\nrisk: high\r\nprobability: high (almost any windows template use when testing with apply on a windows agent)\r\nseverity: high (prevents template use with certain resources)\r\ntest layer: unit \r\ncovered by unit tests.  validate PR in windows and linux","closed_at":"2019-04-04T22:38:28.000-0700","comments":23,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-927","labels":"puppethack;windows","state":"Closed","updated_at":"2019-04-04T22:38:28.000-0700","timestamp":1652286143.189734,"priority":"Major","status_category":"Done","pull_request":2397},{"issue_id":"53785","title":"relationship_spec.rb has minor bugs","url":"https://tickets.puppetlabs.com/browse/PUP-3393","created_at":"2014-10-06T18:54:42.000-0700","number":"PUP-3393","body":"There were a couple of typos in the relationship_spec.rb spec tests relating to ALL_EVENTS.","closed_at":"2019-04-04T22:38:28.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3393","labels":"puppethack;trivial","state":"Closed","updated_at":"2019-04-04T22:38:28.000-0700","timestamp":1652286143.300906,"priority":"Normal","status_category":"Done","pull_request":3166},{"issue_id":"36835","title":"Windows user provider reports that the password is created instead of changed","url":"https://tickets.puppetlabs.com/browse/PUP-2647","created_at":"2014-05-22T19:31:31.000-0700","number":"PUP-2647","body":"If you change an existing user's password on Windows, puppet reports:\r\n\r\n{noformat}\r\nNotice: /Stage[main]/Main/User[testing6]/password: created password\r\n{noformat}\r\n\r\nIf the desired password doesn't match current password, the windows_adsi provider's {{#password}} method returns :absent, to force the provider to apply the new password. But this causes puppet to think the property was \"created\".\r\n\r\nIt would be preferrable to say that the passwords were changed.\r\n\r\nSee https://github.com/puppetlabs/puppet/commit/51b33d1f/lib/puppet/provider/user/windows_adsi.rb#diff-cb6db5b98229b4ec070f9158795e3708R61","closed_at":"2019-04-04T22:38:29.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2647","labels":"docs_reviewed;puppethack;windows","state":"Closed","updated_at":"2019-04-04T22:38:29.000-0700","timestamp":1652286143.62746,"priority":"Normal","status_category":"Done","pull_request":3143},{"issue_id":"26706","title":"Yumrepo logs info messages without context","url":"https://tickets.puppetlabs.com/browse/PUP-1723","created_at":"2014-02-17T05:27:04.000-0800","number":"PUP-1723","body":"Since PUP-789, the yumrepo inifile provider logs two messages without any context (e.g. the resource or provider).\r\n\r\n{noformat}\r\ncreate new repo SCL in file /etc/yum.repos.d/SCL.repo\r\n/Stage[main]/Foreman::Install::Repos::Extra/Yumrepo[SCL]/ensure: created\r\nchanging mode of /etc/yum.repos.d/SCL.repo from 600 to 644\r\n{noformat}\r\n\r\nThe provider code calls \"Puppet.info\" currently when it should use just \"info\" to add context.  As these are class utility methods, it should ideally use the context from the instance to provide even better context, related to the resource that made the change.","closed_at":"2019-04-04T22:38:30.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1723","labels":"help_wanted;maintenance;puppethack;resolved-issue-added;yumrepo","state":"Closed","updated_at":"2019-04-04T22:38:30.000-0700","timestamp":1652286143.736096,"priority":"Trivial","status_category":"Done","pull_request":5874},{"issue_id":"37906","title":"ssl_server_ca_chain and ssl_client_ca_chain are dead settings","url":"https://tickets.puppetlabs.com/browse/PUP-2716","created_at":"2014-06-02T15:18:31.000-0700","number":"PUP-2716","body":"The ssl_server_ca_chain setting is used in webrick to add intermediate root certificates (chain) to the SSL context. When the ssl server sends its Server Certificate message, it includes the chain of certs so that clients can validate the connection.\r\n\r\nFor example, {{:localcacerts}} might contain the cert for {{C=US/O=GeoTrust Inc./CN=GeoTrust Global CA}}\r\n\r\nand {{:ssl_server_ca_chain}} might contain the cert for {{/C=US/O=GeoTrust Inc./CN=GeoTrust SSL CA - G2}}.","closed_at":"2019-04-04T22:38:32.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2716","labels":"docs_reviewed;puppethack","state":"Closed","updated_at":"2019-04-04T22:38:32.000-0700","timestamp":1652286144.718897,"priority":"Minor","status_category":"Done","pull_request":3241},{"issue_id":"284007","title":"A heredoc with interpolation containing [ ] in the expression can cause syntax error","url":"https://tickets.puppetlabs.com/browse/PUP-9303","created_at":"2018-11-06T08:02:09.000-0800","number":"PUP-9303","body":"*Puppet Version:* Anything greater than 5.X\r\n*Puppet Server Version:* N/A\r\n*OS Name/Version:* N/A\r\n\r\nDownload the {{simp_pki_service}} module from https://github.com/simp/pupmod-simp-simp_pki_service and run {{puppet parser validate manifests/kra.pp}}.\r\n\r\nUse {{d07265e253bb2cb11314dbb962043a21a2cbad05}} for the breaking behavior. Changing the {{fact}} call to a local variable did not show any issues.\r\n\r\n*Desired Behavior:*\r\n\r\nNo validation errors should be shown (just as in Puppet 4)\r\n\r\n*Actual Behavior:*\r\n\r\nPuppet parser validation fails with a syntax error in the HEREDOC at line 123.\r\n\r\nNote: Removing the only line in the *comments* section of the document causes the validation to no longer fail.\r\n\r\nUPDATE\r\n------\r\nThis is the same problem as in PUP-9163 which apparently did not fix all cases of the problem.\r\n\r\nThe issue is that the lexer looks at the wrong character when it is looking at what comes just before the {{\\[}} char in an interpolated expression inside a heredoc. The position it is looking at depend on how much source text there is before the {{\\[}} - if the erroneous position happens to be a space the result is a syntax error. ","closed_at":"2019-04-04T22:40:16.000-0700","comments":19,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9303","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-04-04T22:40:16.000-0700","timestamp":1652286145.262174,"priority":"Major","status_category":"Done","pull_request":7355},{"issue_id":"148933","title":"create_resources does not honor '@@resource' as exported resource","url":"https://tickets.puppetlabs.com/browse/PUP-6698","created_at":"2016-08-24T10:36:58.000-0700","number":"PUP-6698","body":"I have an in house nagios module (that will eventually be on the forge) that has a file export defined in it. Every time that export is hit the exporting client side throws an error because it's trying to write the file locally when it shouldn't be. This only happens when Puppet Agent 1.6.1 is installed on the puppet server (I back reved the server to 2.4.0 and installed latest 1.6.1 agent and ran into it as well so it's likely in the agent, but as it requires exported resources working I can't give a test with just the agent)\r\n\r\nExample error:\r\n{code}\r\nError: Puppet::Util::FileType::FileTypeFlat could not write /etc/nagios/conf.d/host_ldap.home.bardicgrove.org_ldap.home.bardicgrove.org.cfg: No such file or directory @ rb_sysopen - /etc/nagios/conf.d/host_ldap.home.bardicgrove.org_ldap.home.bardicgrove.org.cfg\r\nError: /Stage[main]/Nagios::Client/Nagios::Resource[ldap.home.bardicgrove.org]/Nagios::Resource::Host[ldap.home.bardicgrove.org]/Nagios_host[ldap.home.bardicgrove.org]: Could not evaluate: Puppet::Util::FileType::FileTypeFlat could not write /etc/nagios/conf.d/host_ldap.home.bardicgrove.org_ldap.home.bardicgrove.org.cfg: No such file or directory @ rb_sysopen - /etc/nagios/conf.d/host_ldap.home.bardicgrove.org_ldap.home.bardicgrove.org.cfg\r\n{code}\r\n\r\nThe code that is getting called is listed in [0] which gets called by [1] on all systems.\r\n\r\n[0] https://github.com/tykeal/puppet-nagios/blob/master/manifests/resource.pp#L87-L91\r\n[1] https://github.com/tykeal/puppetserver-mod-profile/blob/master/manifests/nagios/client.pp\r\n\r\nFull lab / environment configuration can be found by a combination of the following 4 repositories:\r\n\r\nhttps://github.com/tykeal/puppetserver-main\r\nhttps://github.com/tykeal/puppetserver-hiera\r\nhttps://github.com/tykeal/puppetserver-mod-profile\r\nhttps://github.com/tykeal/puppetserver-mod-role\r\n\r\nUPDATE\r\n----\r\nThe problem here came from use of {{create_resources}} with resource type preceded by {{@@}} to indicate that the resource is exported.\r\nThere may also be a problem with virtual resources.","closed_at":"2019-04-04T22:40:17.000-0700","comments":36,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6698","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-04-04T22:40:17.000-0700","timestamp":1652286145.76806,"priority":"Normal","status_category":"Done","pull_request":5894},{"issue_id":"131111","title":"Overriding evaluated resources silently changes its parameters wo re-eval","url":"https://tickets.puppetlabs.com/browse/PUP-6290","created_at":"2016-05-11T08:53:50.000-0700","number":"PUP-6290","body":"Override of user defined resources that have been evaluated will just change its parameters without re-evaluating its body. It also says nothing about that this happened. This is a problem in itself since it means that the resource will end up in the catalog with different parameters than those that were used when its body was evaluated. It is like having evaluated \"add(2,2)=>4\" and then changing it so it is reported as \"add(3,2)=>4\". This is total nonsense.\r\n\r\n{code:puppet}\r\ndefine foo($message) { notify {\"$title n1\": message => $message } }\r\nnotify { 'n1': message => 'unchanged' }\r\nfoo {'f1': message => 'unchanged' }\r\ndefine delayed {\r\n  Notify <| title == 'n1' |>    { message => 'changed' }\r\n  Foo    <| title == 'f1' |>    { message => 'changed' }\r\n}\r\ndelayed {'d1': }\r\n{code}\r\nProduces:\r\n{code}\r\nNotice: Compiled catalog for funnybones.com in environment production in 0.06 seconds\r\nNotice: changed\r\nNotice: /Stage[main]/Main/Notify[n1]/message: defined 'message' as 'changed'\r\nNotice: unchanged\r\nNotice: /Stage[main]/Main/Foo[f1]/Notify[f1 n1]/message: defined 'message' as 'unchanged'\r\n{code}\r\n\r\nIn the example above it can be noted that the notify resource in the 'foo' body is unchanged since the parameters to Foo[f1] was changed after evaluation.\r\n\r\nThis means that override is sensitive to evaluation order. We cannot perform reevaluation of the resource as it ultimately leads to the ability to write infinite loops (the change causes it to do another override, it could then also be used to affect the logic that included it in the first place which in essence means user has access to the catalog and can mutate anything (although with a horrible blunt API).\r\n\r\nIt should probably be an error to override something that has already been evaluated as the result that is produced is nonsense. Such a change is however not backwards compatible since currently nothing much happens and the change would break manifests that do this.\r\n\r\nThe more drastic approach of removing overrides will not work as long as what it is used to solve is not supported in a better way (e.g. merging reources). ","closed_at":"2019-04-04T22:40:22.000-0700","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6290","labels":"","state":"Closed","updated_at":"2019-04-04T22:40:22.000-0700","timestamp":1652286146.199019,"priority":"Normal","status_category":"Done","pull_request":6018},{"issue_id":"130428","title":"include undef doesn't fail","url":"https://tickets.puppetlabs.com/browse/PUP-6274","created_at":"2016-05-06T14:18:02.000-0700","number":"PUP-6274","body":"{code}\r\n❯ puppet apply -e \"include undef\"\r\nNotice: Compiled catalog for zhora.local in environment production in 0.04 seconds\r\nNotice: Applied catalog in 0.03 seconds\r\n{code}\r\n\r\nExpected results: compilation failure\r\n\r\nSimilarly, {{include ''}} doesn't fail, though {{include nosuchclass}} does.\r\n\r\nExample scenario: {{include $::some::class::tyypo}} (in my case, I accidentally grabbed the dollar sign while copying and pasting)","closed_at":"2019-04-04T22:40:22.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6274","labels":"low-hanging-fruit","state":"Closed","updated_at":"2019-04-04T22:40:22.000-0700","timestamp":1652286146.311388,"priority":"Minor","status_category":"Done","pull_request":6552},{"issue_id":"60589","title":"Update puppet package dependencies to require ruby 1.9.3 or greater","url":"https://tickets.puppetlabs.com/browse/PUP-3740","created_at":"2014-12-04T12:02:54.000-0800","number":"PUP-3740","body":"Update rpm, deb, gem packages to require ruby 1.9.3 as puppet will no longer run on pre-1.9.3.","closed_at":"2019-04-04T22:41:17.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3740","labels":"","state":"Closed","updated_at":"2019-04-04T22:41:17.000-0700","timestamp":1652286147.385911,"priority":"Normal","status_category":"Done","pull_request":4902},{"issue_id":"21452","title":"incorrect permissions in rpms","url":"https://tickets.puppetlabs.com/browse/PUP-1099","created_at":"2013-12-16T11:45:10.000-0800","number":"PUP-1099","body":"The /usr/share/doc/puppet-3.3.1 and below directories have incorrect perms:\r\n\r\n<pre>\r\n% rpm -qlpv http://yum.puppetlabs.com/el/6/products/x86_64/puppet-3.3.1-1.el6.noarch.rpm|egrep ^d.+share.doc\r\ndrwxr-x---    2 puppet  puppet                      0 Oct  7 19:03 /usr/share/doc/puppet-3.3.1\r\ndrwxr-x---    2 puppet  puppet                      0 Oct  7 19:00 /usr/share/doc/puppet-3.3.1/examples\r\ndrwxr-x---    2 puppet  puppet                      0 Oct  7 19:00 /usr/share/doc/puppet-3.3.1/examples/hiera\r\ndrwxr-x---    2 puppet  puppet                      0 Oct  7 19:00 /usr/share/doc/puppet-3.3.1/examples/hiera/etc\r\ndrwxr-x---    2 puppet  puppet                      0 Oct  7 19:00 /usr/share/doc/puppet-3.3.1/examples/hiera/etc/hieradb\r\ndrwxr-x---    2 puppet  puppet                      0 Oct  7 19:00 /usr/share/doc/puppet-3.3.1/examples/hiera/modules\r\ndrwxr-x---    2 puppet  puppet                      0 Oct  7 19:00 /usr/share/doc/puppet-3.3.1/examples/hiera/modules/data\r\ndrwxr-x---    2 puppet  puppet                      0 Oct  7 19:00 /usr/share/doc/puppet-3.3.1/examples/hiera/modules/data/manifests\r\ndrwxr-x---    2 puppet  puppet                      0 Oct  7 19:00 /usr/share/doc/puppet-3.3.1/examples/hiera/modules/ntp\r\ndrwxr-x---    2 puppet  puppet                      0 Oct  7 19:00 /usr/share/doc/puppet-3.3.1/examples/hiera/modules/ntp/manifests\r\ndrwxr-x---    2 puppet  puppet                      0 Oct  7 19:00 /usr/share/doc/puppet-3.3.1/examples/hiera/modules/ntp/templates\r\ndrwxr-x---    2 puppet  puppet                      0 Oct  7 19:00 /usr/share/doc/puppet-3.3.1/examples/hiera/modules/users\r\ndrwxr-x---    2 puppet  puppet                      0 Oct  7 19:00 /usr/share/doc/puppet-3.3.1/examples/hiera/modules/users/manifests\r\n</pre>\r\n\r\nthey're all 0750","closed_at":"2019-04-04T22:41:22.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1099","labels":"redmine","state":"Closed","updated_at":"2019-04-04T22:41:22.000-0700","timestamp":1652286149.50103,"priority":"Normal","status_category":"Done","pull_request":8566},{"issue_id":"15140","title":"Use consistent puppet agent service name on all platforms","url":"https://tickets.puppetlabs.com/browse/PUP-411","created_at":"2013-09-24T11:48:16.000-0700","number":"PUP-411","body":"For unknown reasons, the puppet agent service was renamed to puppetagent as part of #16144… but only on Fedora. Everywhere else it’s puppet.\r\n\r\nThis inconsistency is bad and pointless.\r\n\r\n 1. Let’s restore puppet as the agent’s service name on Fedora. It’s possible systemd supports some form of aliasing or symlinking; if so, we should change the name to puppet and use aliasing to keep puppetagent working until Puppet 4 (when we can remove it). If aliasing is infeasible, we should ship duplicate service configs to re-enable puppet.\r\n 2. Can anyone give a really really good reason for changing the name of the agent service and inconveniencing everybody? Is puppet confusing somehow? If so, we should change it EVERYWHERE at the same time on the Puppet 4 boundary.","closed_at":"2019-04-04T22:41:24.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-411","labels":"","state":"Closed","updated_at":"2019-04-04T22:41:24.000-0700","timestamp":1652286150.452555,"priority":"Normal","status_category":"Done","pull_request":3691},{"issue_id":"14935","title":"Windows installer options should override existing settings","url":"https://tickets.puppetlabs.com/browse/PUP-388","created_at":"2013-09-18T23:00:50.000-0700","number":"PUP-388","body":null,"closed_at":"2019-04-04T22:41:26.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-388","labels":"windows","state":"Closed","updated_at":"2019-04-04T22:41:26.000-0700","timestamp":1652286151.006424,"priority":"Normal","status_category":"Done","pull_request":3673},{"issue_id":"16317","title":"Installer for Puppet 3 does not check for hiera","url":"https://tickets.puppetlabs.com/browse/PUP-530","created_at":"2013-10-07T11:37:05.000-0700","number":"PUP-530","body":"The `install.rb` script for puppet checks for facter and will refuse to install puppet if facter is not on the system. However, puppet also cannot function correctly without hiera and the `install.rb` script does not check for that.\r\n\r\nThe installation script that we ship in the tarball should also check for hiera being present.","closed_at":"2019-04-04T22:41:26.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-530","labels":"","state":"Closed","updated_at":"2019-04-04T22:41:26.000-0700","timestamp":1652286151.112857,"priority":"Normal","status_category":"Done","pull_request":4404},{"issue_id":"19920","title":"puppetmaster-passenger package does not afford a way to test status of puppet master","url":"https://tickets.puppetlabs.com/browse/PUP-912","created_at":"2013-12-02T15:40:37.000-0800","number":"PUP-912","body":"The Debian puppetmaster-passenger package provides for running puppet master workers via apache/passenger, but there is no parallel to the init.d/puppetmaster script's `service puppetmaster status` for determining whether puppet master is up.  The best you can do is to check `service apache2 status`.","closed_at":"2019-04-04T22:41:26.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-912","labels":"","state":"Closed","updated_at":"2019-04-04T22:41:26.000-0700","timestamp":1652286151.217109,"priority":"Normal","status_category":"Done","pull_request":7089},{"issue_id":"41044","title":"puppet-kick.8.gz conflict upgrading from 2.7.26 to 3.6.2","url":"https://tickets.puppetlabs.com/browse/PUP-2878","created_at":"2014-07-02T10:18:04.000-0700","number":"PUP-2878","body":"{noformat}\r\n# apt-get install puppet facter puppet-common ruby-rgen\r\nReading package lists... Done\r\nBuilding dependency tree       \r\nReading state information... Done\r\nThe following extra packages will be installed:\r\n  hiera libjson-ruby ruby-json virt-what\r\nSuggested packages:\r\n  puppet-el vim-puppet ruby-selinux libselinux-ruby1.8 librrd-ruby1.9.1 librrd-ruby1.8\r\nThe following NEW packages will be installed\r\n  hiera libjson-ruby ruby-json ruby-rgen virt-what\r\nThe following packages will be upgraded:\r\n  facter puppet puppet-common\r\n3 to upgrade, 5 to newly install, 0 to remove and 3 not to upgrade.\r\nNeed to get 1,583 kB of archives.\r\nAfter this operation, 2,330 kB of additional disk space will be used.\r\nDo you want to continue [Y/n]? \r\n(Reading database ... 97569 files and directories currently installed.)\r\nPreparing to replace puppet-common 2.7.26-1puppetlabs1 (using .../puppet-common_3.6.2-1puppetlabs1_all.deb) ...\r\nUnpacking replacement puppet-common ...\r\ndpkg: error processing /var/cache/apt/archives/puppet-common_3.6.2-1puppetlabs1_all.deb (--unpack):\r\n trying to overwrite '/usr/share/man/man8/puppet-kick.8.gz', which is also in package puppet 2.7.26-1puppetlabs1\r\nNo apport report written because MaxReports has already been reached\r\n                                                                    dpkg-deb: error: subprocess paste was killed by signal (Broken pipe)\r\nPreparing to replace puppet 2.7.26-1puppetlabs1 (using .../puppet_3.6.2-1puppetlabs1_all.deb) ...\r\n * Stopping puppet agent                                                                                                                                                                                                              [ OK ] \r\nUnpacking replacement puppet ...\r\nSelecting previously unselected package ruby-json.\r\nUnpacking ruby-json (from .../ruby-json_1.6.3-1_i386.deb) ...\r\nSelecting previously unselected package libjson-ruby.\r\nUnpacking libjson-ruby (from .../libjson-ruby_1.6.3-1_all.deb) ...\r\nSelecting previously unselected package hiera.\r\nUnpacking hiera (from .../hiera_1.3.4-1puppetlabs1_all.deb) ...\r\nSelecting previously unselected package ruby-rgen.\r\nUnpacking ruby-rgen (from .../ruby-rgen_0.6.5-1puppetlabs1_all.deb) ...\r\nSelecting previously unselected package virt-what.\r\nUnpacking virt-what (from .../virt-what_1.11-1_i386.deb) ...\r\nPreparing to replace facter 1.6.18-1puppetlabs1 (using .../facter_2.0.2-1puppetlabs1_i386.deb) ...\r\nUnpacking replacement facter ...\r\nProcessing triggers for man-db ...\r\nProcessing triggers for ureadahead ...\r\nErrors were encountered while processing:\r\n /var/cache/apt/archives/puppet-common_3.6.2-1puppetlabs1_all.deb\r\nE: Sub-process /usr/bin/dpkg returned an error code (1)\r\n{noformat}","closed_at":"2019-04-04T22:41:27.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2878","labels":"","state":"Closed","updated_at":"2019-04-04T22:41:27.000-0700","timestamp":1652286151.532955,"priority":"Normal","status_category":"Done","pull_request":2831},{"issue_id":"48100","title":"Include indent file in vim-puppet","url":"https://tickets.puppetlabs.com/browse/PUP-3070","created_at":"2014-08-15T15:48:37.000-0700","number":"PUP-3070","body":null,"closed_at":"2019-04-04T22:41:30.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3070","labels":"","state":"Closed","updated_at":"2019-04-04T22:41:30.000-0700","timestamp":1652286152.505374,"priority":"Normal","status_category":"Done","pull_request":2987},{"issue_id":"50832","title":"Upgrade conflict: puppetmaster-common and puppet-common","url":"https://tickets.puppetlabs.com/browse/PUP-3227","created_at":"2014-09-10T11:46:03.000-0700","number":"PUP-3227","body":"We've already addressed an issue where man pages were moved from the puppet packages to the puppet-common package. Unfortunately, we're seeing this conflict again when upgrading a system with both puppet and puppetmaster installed. The conflict here being that puppetmaster-common now owns man pages that were previously packaged in puppet-common (or at least the puppet-common package provided by Debian Wheezy).\r\n\r\n{code}\r\nPreparing to replace puppetmaster 2.7.23-1~deb7u3 (using .../puppetmaster_3.7.0.30-1puppetlabs1_all.deb) ...\r\n[ ok ] Stopping puppet master.\r\nUnpacking replacement puppetmaster ...\r\nPreparing to replace puppetmaster-common 2.7.23-1~deb7u3 (using .../puppetmaster-common_3.7.0.30-1puppetlabs1_all.deb) ...\r\n[ ok ] Stopping puppet queue.\r\nUnpacking replacement puppetmaster-common ...\r\ndpkg: error processing /var/cache/apt/archives/puppetmaster-common_3.7.0.30-1puppetlabs1_all.deb (--unpack):\r\n trying to overwrite '/usr/share/man/man8/puppet-master.8.gz', which is also in package puppet-common 2.7.23-1~deb7u3\r\n[ ok ] Starting puppet queue.\r\nPreparing to replace puppet 2.7.23-1~deb7u3 (using .../puppet_3.7.0.30-1puppetlabs1_all.deb) ...\r\n[ ok ] Stopping puppet agent.\r\nUnpacking replacement puppet ...\r\nPreparing to replace puppet-common 2.7.23-1~deb7u3 (using .../puppet-common_3.7.0.30-1puppetlabs1_all.deb) ...\r\nUnpacking replacement puppet-common ...\r\nProcessing triggers for man-db ...\r\nErrors were encountered while processing:\r\n /var/cache/apt/archives/puppetmaster-common_3.7.0.30-1puppetlabs1_all.deb\r\nE: Sub-process /usr/bin/dpkg returned an error code (1)\r\n{code}","closed_at":"2019-04-04T22:41:31.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3227","labels":"","state":"Closed","updated_at":"2019-04-04T22:41:31.000-0700","timestamp":1652286153.04214,"priority":"Normal","status_category":"Done","pull_request":3074},{"issue_id":"105068","title":"puppet.conf permission issues should be blocking - now silently ignoring error","url":"https://tickets.puppetlabs.com/browse/PUP-5575","created_at":"2015-11-10T01:21:28.000-0800","number":"PUP-5575","body":"If puppetserver can't access puppet.conf because of permission issues, it logs a warning line and carries on.\r\n\r\nAll configurations in puppet.conf are of course ignored.\r\n\r\nThis is a major headache because user is likely to issue\r\n\r\n{noformat}\r\nsudo /opt/puppetlabs/bin/puppet master --genconfig\r\n{noformat}\r\n\r\nwhich prints out the expected configurations.\r\n\r\nI would prefer the puppetserver to block when unable to access puppet.conf.\r\n\r\n","closed_at":"2019-04-04T22:46:16.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5575","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-04-04T22:46:16.000-0700","timestamp":1652286153.150179,"priority":"Normal","status_category":"Done","pull_request":7269},{"issue_id":"189799","title":"helpful_error_message_when_hostname_not_match_server_certificate test fails with Ruby 2.4","url":"https://tickets.puppetlabs.com/browse/PUP-7503","created_at":"2017-05-08T13:30:21.000-0700","number":"PUP-7503","body":"When running the puppet acceptance test suite with Ruby 2.4.1, one test fails: https://github.com/puppetlabs/puppet/blob/master/acceptance/tests/helpful_error_message_when_hostname_not_match_server_certificate.rb, with the following output:\r\n\r\n{code}\r\n Test Case tests/helpful_error_message_when_hostname_not_match_server_certificate.rb reported: #<Beaker::DSL::Outcomes::FailTest:\r\nExpected Server hostname 'hquif3c5f1yylte\\.delivery\\.puppetlabs\\.net' did not match server certificate; expected one of foobar_not_my_hostname, (.*)$ to match 'Warning: Unable to fetch my node definition, but the agent run will continue:\r\nWarning: SSL_connect returned=1 errno=0 state=error: certificate verify failed: [ok for /CN=foobar_not_my_hostname]\r\nError: /File[/opt/puppetlabs/puppet/cache/facts.d]: Failed to generate additional resources using 'eval_generate': SSL_connect returned=1 errno=0 state=error: certificate verify failed: [ok for /CN=foobar_not_my_hostname]\r\nError: /File[/opt/puppetlabs/puppet/cache/facts.d]: Could not evaluate: Could not retrieve file metadata for puppet:///pluginfacts: SSL_connect returned=1 errno=0 state=error: certificate verify failed: [ok for /CN=foobar_not_my_hostname]\r\nError: /File[/opt/puppetlabs/puppet/cache/lib]: Failed to generate additional resources using 'eval_generate': SSL_connect returned=1 errno=0 state=error: certificate verify failed: [ok for /CN=foobar_not_my_hostname]\r\nError: /File[/opt/puppetlabs/puppet/cache/lib]: Could not evaluate: Could not retrieve file metadata for puppet:///plugins: SSL_connect returned=1 errno=0 state=error: certificate verify failed: [ok for /CN=foobar_not_my_hostname]\r\nError: Could not retrieve catalog from remote server: SSL_connect returned=1 errno=0 state=error: certificate verify failed: [ok for /CN=foobar_not_my_hostname]\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\nError: Could not send report: SSL_connect returned=1 errno=0 state=error: certificate verify failed: [ok for /CN=foobar_not_my_hostname]\r\n{code}\r\n\r\nThis appears to be the result of SSL erroring in a different spot than previously; the test expects a specialized error message from {{post_connection_check}} (see https://github.com/ruby/ruby/blob/ruby_2_4/ext/openssl/lib/openssl/ssl.rb#L291, called from https://github.com/ruby/ruby/blob/b3209c258eddc093ffdcbf77ee079cdc93f094ae/lib/net/http.rb#L950), but with Ruby 2.4, it appears to be failing two lines earlier, with the error stacktrace pointing to this line: https://github.com/ruby/ruby/blob/ruby_2_4/lib/net/protocol.rb#L44, which calls out to C code.\r\n\r\nWe need to figure out if the failure is due to a change in Ruby's error checking or a matter of misconfiguration. If the error checking has changed, we may need to update the logic here https://github.com/puppetlabs/puppet/blob/master/lib/puppet/network/http/connection.rb#L226-L234, if possible, to use the new output to still print the helpful error message.","closed_at":"2019-04-12T13:34:12.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7503","labels":"","state":"Closed","updated_at":"2019-04-12T13:34:12.000-0700","timestamp":1652286161.356153,"priority":"Normal","status_category":"Done","pull_request":5850},{"issue_id":"149101","title":"Ruby types still loaded even when a PCore type is found","url":"https://tickets.puppetlabs.com/browse/PUP-6653","created_at":"2016-08-25T11:04:24.000-0700","number":"PUP-6653","body":"In PE, we recently merged a change that ran `puppet generate types` on all changed environments. This resulted in catalog compile failures on the server side. They looked like the following.\r\n\r\nIt looks as though the PCore file is being loaded first, and then maybe the ruby type is being loaded still? Line 116 in {{profile/master.pp}} is the a use of pe_ini_setting, but not a definition of it.\r\n\r\n{code}\r\n2016-08-25 10:50:34,271 ERROR [qtp1820595966-74] [puppetserver] Puppet Evaluation Error: Error while evaluating a Resource Statement, Evaluation Error: Error while evaluating a Resource Statement, Attempt to redefine entity 'http://puppet.com/2016.1/runtime/resource_type_pp/pe_ini_setting'. Originally set /etc/puppetlabs/code/environments/production/.resource_types/pe_ini_setting.pp. at /opt/puppetlabs/puppet/modules/puppet_enterprise/manifests/profile/master.pp:116:3 on node wiagamb4u9sm77e.delivery.puppetlabs.net\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:113:in `fail_redefine'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:63:in `set_entry'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/module_loaders.rb:152:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/runtime3_type_loader.rb:66:in `find_impl'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/runtime3_type_loader.rb:55:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:142:in `internal_load'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:32:in `load_typed'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:141:in `internal_load'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:32:in `load_typed'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:141:in `internal_load'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/base_loader.rb:32:in `load_typed'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loader/loader.rb:49:in `load'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_resource_support.rb:104:in `find_builtin_resource_type'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_resource_support.rb:71:in `find_resource_type'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_resource_support.rb:23:in `create_resources'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:310:in `create_resources'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:818:in `eval_ResourceExpression'\r\norg/jruby/RubyArray.java:2412:in `map'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:815:in `eval_ResourceExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:69:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:82:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:622:in `eval_BlockExpression'\r\norg/jruby/RubyArray.java:1613:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:622:in `eval_BlockExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:69:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:82:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/evaluating_parser.rb:63:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:32:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast.rb:31:in `safeevaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:182:in `evaluate_code'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:81:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:73:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:587:in `evaluate_definitions'\r\norg/jruby/RubyArray.java:1613:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:585:in `evaluate_definitions'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:584:in `evaluate_definitions'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/errors.rb:64:in `exceptwrap'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:583:in `evaluate_definitions'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:611:in `evaluate_generators'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:608:in `evaluate_generators'\r\norg/jruby/RubyKernel.java:1511:in `loop'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:605:in `evaluate_generators'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:187:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:187:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:241:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:162:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:33:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:266:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:264:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:223:in `benchmark'\r\n/opt/puppetlabs/server/apps/puppetserver/puppet-server-release.jar!/META-INF/jruby.home/lib/ruby/1.9/benchmark.rb:295:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:222:in `benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:262:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:53:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:194:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:121:in `do_find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:48:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:241:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/indirected_routes.rb:47:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:82:in `process'\r\norg/jruby/RubyArray.java:1613:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:81:in `process'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:87:in `process'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:87:in `process'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/handler.rb:60:in `process'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/handler.rb:58:in `process'\r\nfile:/opt/puppetlabs/server/apps/puppetserver/puppet-server-release.jar!/puppetserver-lib/puppet/server/master.rb:42:in `handleRequest'\r\nPuppet$$Server$$Master_996578613.gen:13:in `handleRequest'\r\nrequest_handler_core.clj:273:in `invoke'\r\njruby_request.clj:46:in `invoke'\r\njruby_request.clj:31:in `invoke'\r\nrequest_handler_service.clj:34:in `handle_request'\r\nrequest_handler.clj:3:in `invoke'\r\nrequest_handler.clj:3:in `invoke'\r\ncore.clj:2493:in `invoke'\r\nring_middleware.clj:284:in `invoke'\r\ncore.clj:168:in `invoke'\r\ncore.clj:211:in `invoke'\r\ncore.clj:45:in `invoke'\r\ncore.clj:330:in `invoke'\r\ncore.clj:51:in `invoke'\r\nringutils.clj:86:in `invoke'\r\nmaster_core.clj:428:in `invoke'\r\nring.clj:21:in `invoke'\r\nring.clj:12:in `invoke'\r\ncomidi.clj:249:in `invoke'\r\nhttp.clj:152:in `invoke'\r\nhttp.clj:152:in `invoke'\r\nhttp.clj:148:in `invoke'\r\ncomidi.clj:336:in `invoke'\r\njetty9_core.clj:424:in `invoke'\r\nnormalized_uri_helpers.clj:80:in `invoke'\r\n{code}\r\n\r\nHere is the PCore file:\r\n{code}\r\ncat /etc/puppetlabs/code/environments/production/.resource_types/pe_ini_setting.pp\r\n# This file was automatically generated on 2016-08-25 10:40:26 -0700.\r\n# Use the 'puppet generate types' command to regenerate this file.\r\n\r\nPuppet::Resource::ResourceType3.new(\r\n  'pe_ini_setting',\r\n  [\r\n    # The basic property that the resource should be in.\r\n    #\r\n    # Valid values are `present`, `absent`.\r\n    Puppet::Resource::Param(Enum['present', 'absent'], 'ensure'),\r\n\r\n    # The value of the setting to be defined.\r\n    Puppet::Resource::Param(Any, 'value')\r\n  ],\r\n  [\r\n    # An arbitrary name used as the identity of the resource.\r\n    Puppet::Resource::Param(Any, 'name', true),\r\n\r\n    # The name of the section in the ini file in which the setting should be defined.\r\n    Puppet::Resource::Param(Any, 'section'),\r\n\r\n    # The name of the setting to be defined.\r\n    Puppet::Resource::Param(Any, 'setting'),\r\n\r\n    # The ini file Puppet will ensure contains the specified setting.\r\n    Puppet::Resource::Param(Any, 'path'),\r\n\r\n    # The separator string to use between each setting name and value. Defaults to \" = \", but you could use this to override e.g. whether or not the separator should include whitespace.\r\n    Puppet::Resource::Param(Any, 'key_val_separator'),\r\n\r\n    # The specific backend to use for this `pe_ini_setting`\r\n    # resource. You will seldom need to specify this --- Puppet will usually\r\n    # discover the appropriate provider for your platform.Available providers are:\r\n    #\r\n    # ruby\r\n    # :\r\n    Puppet::Resource::Param(Any, 'provider')\r\n  ],\r\n  {\r\n    /(.*)/ => ['name']\r\n  },\r\n  true)\r\n{code}","closed_at":"2019-04-15T16:17:51.000-0700","comments":18,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6653","labels":"","state":"Closed","updated_at":"2019-04-15T16:17:51.000-0700","timestamp":1652286161.896725,"priority":"Blocker","status_category":"Done","pull_request":5234},{"issue_id":"294574","title":"Use OpenSSL::X509::Name#to_utf8","url":"https://tickets.puppetlabs.com/browse/PUP-9472","created_at":"2019-02-01T16:44:29.000-0800","number":"PUP-9472","body":"Calling {{OpenSSL::X509::Name#to_s}} with a non USASCII string generates a binary ruby string, which can cause problems when later string operations are performed. We should always use the {{to_utf8}} method instead.\r\n\r\n{noformat}\r\nirb(main):013:0> name = \"CN=root-ca-天\"\r\n=> \"CN=root-ca-天\"\r\nirb(main):014:0>\r\nirb(main):015:0>  OpenSSL::X509::Name.parse(name).to_s\r\n=> \"/CN=root-ca-\\\\xE5\\\\xA4\\\\xA9\"\r\nirb(main):016:0>  OpenSSL::X509::Name.parse(name).to_s.encoding\r\n=> #<Encoding:ASCII-8BIT>\r\nirb(main):017:0>  OpenSSL::X509::Name.parse(name).to_utf8\r\n=> \"CN=root-ca-天\"\r\n{noformat}","closed_at":"2019-05-13T14:18:21.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9472","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-05-13T14:18:21.000-0700","timestamp":1652286170.73918,"priority":"Normal","status_category":"Done","pull_request":7441},{"issue_id":"301985","title":"Puppet Device plugin sync slow","url":"https://tickets.puppetlabs.com/browse/PUP-9584","created_at":"2019-03-27T15:39:24.000-0700","number":"PUP-9584","body":"*Puppet Version: 6.0.5*\r\n *Puppet Server Version: 2019.0.0.67 (PE 2019.0.2)*\r\n *OS Name/Version: CentOS 7*\r\n\r\nChanges to Puppet Device plugin sync [PUP-8766|https://tickets.puppetlabs.com/browse/PUP-8766] appear to have greatly increased the time it takes for plugin sync to execute:\r\n\r\n*+2019.0.1+*\r\n{noformat}real\t0m16.590s\r\nuser\t0m4.394s\r\nsys\t0m0.734s\r\n{noformat}\r\n *+2019.0.2+*\r\n{noformat}real\t1m7.999s\r\nuser\t0m32.533s\r\nsys\t0m1.017s\r\n{noformat}\r\n*+2019.1.0 RC+*\r\n{noformat}real\t1m2.258s\r\nuser\t0m30.187s\r\nsys\t0m0.880s\r\n{noformat}\r\n \r\n[Full log of a slow run|https://gist.github.com/shermdog/3439746e89ab73a40d616b4d119fa54b]","closed_at":"2019-05-13T14:18:26.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9584","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-05-13T14:18:26.000-0700","timestamp":1652286180.300555,"priority":"Normal","status_category":"Done","pull_request":7462},{"issue_id":"302650","title":"waitforcert not working in 6.4","url":"https://tickets.puppetlabs.com/browse/PUP-9589","created_at":"2019-04-01T21:39:51.000-0700","number":"PUP-9589","body":"waitforcert doesnt seem to be working with puppet agent 6.4, at least on windows. Tested on Windows Server 2008 SP2 x64 and Windows Server 2012 R2.\r\n{code:java}\r\nPS C:\\Users\\Administrator> puppet agent -t --waitforcert 10\r\nInfo: csr_attributes file loading from C:/ProgramData/PuppetLabs/puppet/etc/csr_attributes.yaml\r\nInfo: Creating a new SSL certificate request for lab1-2012r2-10.nkgnet.local\r\nInfo: Certificate Request fingerprint (SHA256): 75:90:E7:59:1B:D2:E7:A9:46:8F:71:27:83:7F:E8:65:37:AB:1D:26:67:0D:1E:AD:5B:46:6B:B7:22:50:20:31\r\nInfo: Certificate for lab1-2012r2-10.nkgnet.local has not been signed yet\r\nExiting; no certificate found and waitforcert is disabled\r\nPS C:\\Users\\Administrator>{code}","closed_at":"2019-05-13T14:18:28.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9589","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-05-13T14:18:28.000-0700","timestamp":1652286180.417011,"priority":"Normal","status_category":"Done","pull_request":7458},{"issue_id":"302189","title":"Failed refreshonly resources generate duplicate event","url":"https://tickets.puppetlabs.com/browse/PUP-9586","created_at":"2019-03-28T14:00:06.000-0700","number":"PUP-9586","body":"PUP-9339 and PUP-8908 both cause an event to be added to the report when a refreshed resource fails. PUP-8908 was fixed first in 5.5.3, then PUP-9339 was fixed in 4.10.13 and merged up, but the semantic conflict wasn't resolved correctly in [https://github.com/puppetlabs/puppet/commit/c3eed15cd1c2f4bdd6bdd3cca9acffe0a9a103a1] causing a duplicate event to end up in puppetdb. The duplicate events were first released in 5.5.9.\r\n\r\nTo reproduce:\r\n{code:puppet}exec { 'duplicate exec events':\r\n  command     => '/usr/bin/false',\r\n  subscribe   => Notify['test1'],\r\n  refreshonly => true,\r\n}\r\n\r\nnotify { 'test1':\r\n  message => 'foo'\r\n}\r\n{code}\r\n\r\nresults in 2 events for the refreshed event:\r\n\r\n{code:yaml}\r\n  Exec[duplicate exec events]:\r\n    title: duplicate exec events\r\n    file: \"/Users/josh/work/puppet/manifest.pp\"\r\n    line: 1\r\n    resource: Exec[duplicate exec events]\r\n    resource_type: Exec\r\n    provider_used: posix\r\n    containment_path:\r\n    - Stage[main]\r\n    - Main\r\n    - Exec[duplicate exec events]\r\n    evaluation_time: 0.000102\r\n    tags:\r\n    - exec\r\n    - class\r\n    time: '2019-03-28T13:59:12.868197000-07:00'\r\n    failed: true\r\n    failed_to_restart: true\r\n    changed: false\r\n    out_of_sync: true\r\n    skipped: false\r\n    change_count: 0\r\n    out_of_sync_count: 2\r\n    events:\r\n    - audited: false\r\n      property: \r\n      previous_value: \r\n      desired_value: \r\n      historical_value: \r\n      message: 'Failed to call refresh: ''/usr/bin/false'' returned 1 instead of one\r\n        of [0]'\r\n      name: refresh\r\n      status: failure\r\n      time: '2019-03-28T13:59:12.882309000-07:00'\r\n      redacted: false\r\n      corrective_change: false\r\n    - audited: false\r\n      property: \r\n      previous_value: \r\n      desired_value: \r\n      historical_value: \r\n      message: 'Failed to call refresh: ''/usr/bin/false'' returned 1 instead of one\r\n        of [0]'\r\n      name: resource_error\r\n      status: failure\r\n      time: '2019-03-28T13:59:12.882390000-07:00'\r\n      redacted: false\r\n      corrective_change: false\r\n    corrective_change: false\r\n{code}","closed_at":"2019-05-13T14:18:30.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9586","labels":"customer0","state":"Closed","updated_at":"2019-05-13T14:18:30.000-0700","timestamp":1652286180.532306,"priority":"Normal","status_category":"Done","pull_request":7467},{"issue_id":"215426","title":"Use of server_list can cause misleading agent errors","url":"https://tickets.puppetlabs.com/browse/PUP-8036","created_at":"2017-10-09T12:25:36.000-0700","number":"PUP-8036","body":"h3. The issue:\r\n\r\nthe \"server_urls\" configuration setting can mask server-side issues by mistakingly pointing to a connectivity issue on port 0:\r\n\r\n{noformat}\r\nError: /File[/opt/puppetlabs/puppet/cache/facts.d]: Failed to generate additional resources using 'eval_generate': Connection refused - connect(2) for nil port 0\r\n{noformat}\r\n\r\nh3. Replication: \r\n\r\nConfigure an agent to connect to a master with the server_list setting:\r\n\r\n{noformat}\r\n[agent]\r\n#server = pe-201724-master.puppetdebug.vlan\r\nserver_list = pe-201724-master.puppetdebug.vlan:8140\r\n{noformat}\r\n\r\nRevoke the agent's certificate on the master and observe the error on the next agent run:\r\n\r\nh3. Actual result:\r\n\r\n{noformat}\r\nWarning: Could not select a functional puppet master\r\nWarning: Unable to fetch my node definition, but the agent run will continue:\r\nWarning: Connection refused - connect(2) for nil port 0\r\nInfo: Retrieving pluginfacts\r\nError: /File[/opt/puppetlabs/puppet/cache/facts.d]: Failed to generate additional resources using 'eval_generate': Connection refused - connect(2) for nil port 0\r\nError: /File[/opt/puppetlabs/puppet/cache/facts.d]: Could not evaluate: Could not retrieve file metadata for puppet:///pluginfacts: Connection refused - connect(2) for nil port 0\r\nInfo: Retrieving plugin\r\nError: /File[/opt/puppetlabs/puppet/cache/lib]: Failed to generate additional resources using 'eval_generate': Connection refused - connect(2) for nil port 0\r\nError: /File[/opt/puppetlabs/puppet/cache/lib]: Could not evaluate: Could not retrieve file metadata for puppet:///plugins: Connection refused - connect(2) for nil port 0\r\nInfo: Loading facts\r\nError: Could not retrieve catalog from remote server: Connection refused - connect(2) for nil port 0\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\nError: Could not send report: Connection refused - connect(2) for nil port 0\r\n{noformat}\r\n\r\nh3. Expected result:\r\n\r\nChange the agent's configuration to use the \"server\" setting and observe the difference.  The error points more clearly to an SSL issue:\r\n\r\n{noformat}\r\nWarning: Unable to fetch my node definition, but the agent run will continue:\r\nWarning: SSL_connect SYSCALL returned=5 errno=0 state=unknown state\r\nInfo: Retrieving pluginfacts\r\nError: /File[/opt/puppetlabs/puppet/cache/facts.d]: Failed to generate additional resources using 'eval_generate': SSL_connect SYSCALL returned=5 errno=0 state=unknown state\r\nError: /File[/opt/puppetlabs/puppet/cache/facts.d]: Could not evaluate: Could not retrieve file metadata for puppet:///pluginfacts: SSL_connect SYSCALL returned=5 errno=0 state=unknown state\r\nInfo: Retrieving plugin\r\nError: /File[/opt/puppetlabs/puppet/cache/lib]: Failed to generate additional resources using 'eval_generate': SSL_connect SYSCALL returned=5 errno=0 state=unknown state\r\nError: /File[/opt/puppetlabs/puppet/cache/lib]: Could not evaluate: Could not retrieve file metadata for puppet:///plugins: SSL_connect SYSCALL returned=5 errno=0 state=unknown state\r\nInfo: Loading facts\r\nError: Could not retrieve catalog from remote server: SSL_connect SYSCALL returned=5 errno=0 state=unknown state\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\nError: Could not send report: SSL_connect SYSCALL returned=5 errno=0 state=unknown state\r\n{noformat}","closed_at":"2019-05-13T14:18:31.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8036","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-05-13T14:18:31.000-0700","timestamp":1652286180.649758,"priority":"Normal","status_category":"Done","pull_request":7436},{"issue_id":"300500","title":"Not possible to set Multiple Logging Destination with puppet agent  anymore","url":"https://tickets.puppetlabs.com/browse/PUP-9565","created_at":"2019-03-15T09:58:52.000-0700","number":"PUP-9565","body":"Puppet Version: > 5.5.7\r\n OS Name/Version: Debian Jessie\r\n\r\nBeginning with release 5.5.7, it is not possible anymore to have more then 1 logdestination.\r\n\r\nBefore it was possible to have multiple Logging Destinations, by appending logdest multiple times\r\n\r\nThis seems to be the Ticket related to it.\r\n https://tickets.puppetlabs.com/browse/PUP-2997\r\n Fixed since: PUP 5.5.7, PUP 6.0.3\r\n\r\nExample:\r\n\r\npuppet agent --no-daemonize --detailed-exitcodes --onetime --logdest console --logdest /var/log/puppetlabs/puppet/puppet.log\r\n Starting with release 5.5.7 the puppet agent ignores the second logdestination, which keeps us from saving changes to a local file.\r\n\r\nSteps to reproduce:\r\n\r\nInstall Agent 5.5.6 and run:\r\n{code} puppet agent --no-daemonize --detailed-exitcodes --onetime --logdest console --logdest /var/log/puppet.log\r\n{code}\r\nOutput will be show in console and also send to the file\r\n\r\nInstall Agent 5.5.7 or any higher version number and run:\r\n{code} puppet agent --no-daemonize --detailed-exitcodes --onetime --logdest console --logdest /var/log/puppet.log\r\n{code}\r\nOutput will be show in console but not send to the file\r\n\r\nDesired Behavior: Have all mentioned logdestinations enabled agian\r\n\r\nActual Behavior: Only the first mentioned logdestination will be applied","closed_at":"2019-05-13T14:21:20.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9565","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-05-13T14:21:20.000-0700","timestamp":1652286180.879865,"priority":"Normal","status_category":"Done","pull_request":7478},{"issue_id":"108701","title":"Unnecessary amount of dns requests with SRV records","url":"https://tickets.puppetlabs.com/browse/PUP-5587","created_at":"2015-12-08T09:43:40.000-0800","number":"PUP-5587","body":"Originally filed in https://projects.puppetlabs.com/issues/19842 by Vincent Gallissot:\r\n\r\nI want to make you a feedback of using SRV records with Puppet 3.1.1\r\n\r\nMy architecture is :\r\n\r\n* puppetca = puppet master acting as ca and able to manage all nodes files (centos 6.3 with Puppet server 3.1.1)\r\n* puppet1 and puppet2 = puppet master not ca. They are configured the old way (not with SRV) with ca_server=puppetca, server=fqdn and ca=false\r\n* mynode = desktop with puppet 3.1.1, under Fedora 16\r\n\r\nHere are my DNS records : \r\n\r\nx-puppet.tcp IN SRV 0 50 8140 puppet1.foobar.fr.\r\nx-puppet.tcp IN SRV 0 50 8140 puppet2.foobar.fr.\r\nx-puppet.tcp IN SRV 10 100 8140 puppetca.foobar.fr.\r\nx-puppet-ca.tcp IN SRV 0 100 8140 puppetca.foobar.fr.\r\nx-puppet-report.tcp IN SRV 0 100 8140 puppetca.foobar.fr.\r\n\r\nFirst of all, thanks for correcting the bug in http://projects.puppetlabs.com/issues/18161, works fine now !\r\n\r\nSecondly, the tips given in http://projects.puppetlabs.com/issues/16840 work for me too.\r\n\r\nThirdly, as you can see in logs (files mynode, puppet1 and puppet2 .foobar.fr), with SRV, nodes try to reach every masters and generate a lot of requests, not only dns ones. It tries to access all servers in “x-puppet.tcp.foobar.fr.” and it’s not the best way. It also continue to resolve SRV even if it’s downloading its configuration from the master. Using SRV records is for high availability and load distribution. It shouldn’t double the nodes connexions. In facts, the more masters you have the more your network is overloaded.\r\n\r\nNodes should try to resolve “x-puppet.tcp.foobar.fr.” only one time and if the returned server is available to connect, the node shouldn’t do any other SRV request for “x-puppet.tcp.foobar.fr.” or tries to connect to the other masters.\r\n\r\nAs it’s written in the doc, the amount of DNS requests is very high, but is not needed at all.","closed_at":"2019-05-17T15:57:20.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5587","labels":"","state":"Closed","updated_at":"2019-05-17T15:57:20.000-0700","timestamp":1652286183.752968,"priority":"Normal","status_category":"Done","pull_request":5578},{"issue_id":"224551","title":"Error message for certificate name mismatch is clear as mud","url":"https://tickets.puppetlabs.com/browse/PUP-8213","created_at":"2017-11-28T16:41:45.000-0800","number":"PUP-8213","body":"A common error in enterprise environments is a mismatch between the server setting on the agent and the common name of the master's cert / its dns alt names.\r\n\r\nToday, if this situation occurs the error message the agent prints is as clear as mud. For example:\r\n\r\n{code}\r\n# You can't tell, but for this run server=master.tld\r\n# \r\n[root@aws-1 ssl]# puppet agent -t\r\nWarning: Unable to fetch my node definition, but the agent run will continue:\r\nWarning: SSL_connect returned=1 errno=0 state=error: certificate verify failed: [ok for /CN=master-1.tld]\r\nInfo: Retrieving pluginfacts\r\nError: /File[/opt/puppetlabs/puppet/cache/facts.d]: Failed to generate additional resources using 'eval_generate': SSL_connect returned=1 errno=0 state=error: certificate verify failed: [ok for /CN=master-1.tld]\r\n...\r\n{code}\r\n\r\nThis error message is INCREDIBLY unhelpful. There's kinda-sorta a reference to the master's certificate being {{master-1.tld}}, but you can't see in the message that the configured server is {{master.tld}}. There's also no reference to other valid alt names.\r\n\r\nWhat we want:\r\n\r\nThe error message should clearly state something along the lines of\r\n\r\n{code}\r\nError: Unable to validate server certificate. Expected \"master.tld\":\r\n  server certificate common name \"master-1.tld\" does not match\r\n  server certificate alt name \"puppet\" does not match\r\n  server certificate alt name \"master\" does not match\r\n  server certificate alt name \"master-alt.tld\" does not match\r\n{code}","closed_at":"2019-05-30T15:54:18.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8213","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-05-30T15:54:18.000-0700","timestamp":1652286184.381075,"priority":"Normal","status_category":"Done","pull_request":7475},{"issue_id":"106805","title":"Puppet fails to convert Windows Unicode group or user names to sids","url":"https://tickets.puppetlabs.com/browse/PUP-5538","created_at":"2015-11-23T00:52:53.000-0800","number":"PUP-5538","body":"The win32-security gem that Puppet uses for SID conversion uses ANSI versions of APIs that can make it fail to convert Unicode group / user names to SIDs properly.\r\n\r\nhttps://github.com/puppetlabs/puppet-win32-ruby/blob/2.1.x-x64/ruby/lib/ruby/gems/2.1.0/gems/win32-security-0.2.5/lib/win32/security/windows/functions.rb#L79-L80","closed_at":"2019-06-03T09:24:26.000-0700","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5538","labels":"encoding;i18n;windows","state":"Closed","updated_at":"2019-06-03T09:24:26.000-0700","timestamp":1652286184.591716,"priority":"Critical","status_category":"Done","pull_request":4603},{"issue_id":"28870","title":"Generated resources never receive dependency edges","url":"https://tickets.puppetlabs.com/browse/PUP-1963","created_at":"2014-03-17T11:37:31.000-0700","number":"PUP-1963","body":"I've preserved the original description below for posterity. Note however that this issue is now tracking only the first (of two) issues described in the original problem report.\r\n\r\n-----\r\nFirst off I will quickly explain what it is I'm trying to do.  I have installed the puppetlabs-apache-0.0.3 module that provides a new type called a2mod.  My goal is to use virtual resources to collect a list of modules to enable/disable on a node.  I would also however, like to ensure that all other apache modules are disabled on the system.  I found the resources type has a purge option.  I then updated the provider to have an instances section since it did not have one.  It looks like this:\r\n\r\n{code}\r\n    class << self\r\n        attr_accessor :defpath\r\n    end\r\n\r\n    @defpath = \"/etc/apache2/mods-available/\"\r\n\r\n    def self.instances\r\n        self.defpath = [self.defpath] unless self.defpath.is_a? Array\r\n\r\n        instances = []\r\n\r\n        self.defpath.each do |path|\r\n            unless FileTest.directory?(path)\r\n                Puppet.debug \"Apache module path %s does not exist\" % path\r\n                next\r\n            end\r\n\r\n            check = [:ensure]\r\n\r\n            if public_method_defined? :enabled?\r\n                check << :enable\r\n            end\r\n\r\n            Dir.entries(path).each do |name|\r\n                if name =~ /.load/\r\n                    name = name.sub(\".load\",\"\")\r\n                    instances << new(:name => name, :path => path)\r\n                end\r\n            end\r\n        end\r\n        instances\r\n    end\r\n{code}\r\n\r\nI then used the resources type to purge out unused apache modules.  This seemingly does the job I wanted it to do.  However, I wanted to notify my apache to restart if it had disabled any modules.  I added the notify metaparameter to the configuration but it would never notify.\r\n\r\n{code}\r\n    resources { 'a2mod': tag => 'modtest', notify => Exec['apache2reload'], purge => true, loglevel => 'notice' }\r\n{code}\r\n\r\nI then tried to add a tag for testing purposes and it would not see the tag being set.  I could however use loglevel but it would seem other metaparameters would not work properly.  I'm assuming that all parameters on   http://docs.puppetlabs.com/references/stable/metaparameter.html should be available to the resources type as indicated by the documentation for the resources type.\r\n\r\nSo, I'm wanting to understand if \"all\" metaparameters should work with the resources type or not.  And, is there any possible way to do a purge that would allow me to do a notify of another resource.","closed_at":"2019-06-03T16:25:01.000-0700","comments":33,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1963","labels":"redmine","state":"Closed","updated_at":"2019-06-03T16:25:01.000-0700","timestamp":1652286184.89648,"priority":"Blocker","status_category":"Done","pull_request":4258},{"issue_id":"310858","title":"Reduce specificity of gem and pip providers","url":"https://tickets.puppetlabs.com/browse/PUP-9727","created_at":"2019-05-31T03:22:47.000-0700","number":"PUP-9727","body":"Due to the recent changes on package providers, when\r\nno default package provider is explicitly set it will\r\nalways fallback to gem/puppet_gem/pip/pip3 because of the way\r\nthat specificity is calculated for a system which does\r\nnot have a default(the match expression and number of ancestors)\r\n\r\nSince those are specific language package managers,\r\ntheir specificity should be lowered to 1 if none of those providers\r\nare set as default provider, otherwise the specificity\r\nis calculated like it was before.","closed_at":"2019-06-06T00:20:54.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9727","labels":"","state":"Resolved","updated_at":"2019-06-06T00:20:54.000-0700","timestamp":1652286185.106484,"priority":"Normal","status_category":"Done","pull_request":7544},{"issue_id":"21655","title":"Incorrect ordering of group and user resource purging","url":"https://tickets.puppetlabs.com/browse/PUP-1153","created_at":"2013-12-17T14:53:01.000-0800","number":"PUP-1153","body":"I am using the following below code to purge/remove all unmanaged (to Puppet) users and groups on a system so that only OS groups and users I allow can exist.\r\n\r\nI receive errors in my log though because Puppet will attempt to remove a (primary) group before it removes the corresponding user.  Although a subsequent run has no errors (the user was eventually purged) I am left with undesired groups until I run Puppet again.  The current work around is to run Puppet multiple times and modify monitoring scripts to ignore the group deletion errors.\r\n\r\nAttempts at using before, require, ->, etc. notation do not cause the desired order (purge users then groups).\r\n\r\n\r\nI'd propose that Puppet be modified such that it either honors the specified ordering or as a rule always processes user removal/purging before it processes any group removal/purging.\r\n\r\n\r\n\r\nError in log:\r\n{noformat}\r\nError: /Group[vagrant]/ensure: change from present to absent failed: Could not delete group vagrant: Execution of '/usr/sbin/groupdel vagrant' returned 8: groupdel: cannot remove the primary group of user 'vagrant'\r\n{noformat}\r\n\r\n(note that vagrant was not logged in)\r\n(This was on an Ubuntu 12.04 server)\r\n\r\n\r\nIteration # 1 (failed):\r\n\r\n{noformat}\r\n  resources { 'user':\r\n    purge => true,\r\n    unless_system_user => false,\r\n  }\r\n\r\n  resources { 'group':\r\n    purge => true,\r\n    unless_system_user => false,\r\n  }\r\n{noformat}\r\n\r\nIteration # 2 (failed):\r\n{noformat}\r\n  resources { 'user':\r\n    purge => true,\r\n    unless_system_user => false,\r\n    before\t=> Resources['group'],\r\n  }\r\n\r\n  resources { 'group':\r\n    purge => true,\r\n    unless_system_user => false,\r\n  }\r\n{noformat}\r\n\r\n\r\nIteration # 3 (failed):\r\n{noformat}\r\n  resources { 'user':\r\n    purge => true,\r\n    unless_system_user => false,\r\n  }\r\n\r\n  resources { 'group':\r\n    purge => true,\r\n    unless_system_user => false,\r\n    require\t=> Resources['user'],\r\n  }\r\n{noformat}\r\n\r\n\r\nIteration # 4 (failed):\r\n{noformat}\r\n  resources { 'user':\r\n    purge => true,\r\n    unless_system_user => false,\r\n    before\t=> Resources['group'],\r\n  }\r\n\r\n  resources { 'group':\r\n    purge => true,\r\n    unless_system_user => false,\r\n    require\t=> Resources['user'],\r\n  }\r\n{noformat}\r\n\r\n\r\nIteration # 5 (failed):\r\n{noformat}\r\n  resources { 'user':\r\n    purge => true,\r\n    unless_system_user => false,\r\n  }\r\n\r\n  resources { 'group':\r\n    purge => true,\r\n    unless_system_user => false,\r\n  }\r\n\r\n  Resources['user'] -> Resources['group']\r\n{noformat}\r\n\r\n\r\nIteration # 6 (failed):\r\n{noformat}\r\n  resources { 'user':\r\n    purge => true,\r\n    unless_system_user => false,\r\n    before\t=> Resources['group'],\r\n  }\r\n\r\n  resources { 'group':\r\n    purge => true,\r\n    unless_system_user => false,\r\n    require\t=> Resources['user'],\r\n  }\r\n\r\n  Resources['user'] -> Resources['group']\r\n{noformat}","closed_at":"2019-06-10T10:19:48.000-0700","comments":23,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1153","labels":"autorequire;group;redmine;type_and_provider;user","state":"Closed","updated_at":"2019-06-10T10:19:48.000-0700","timestamp":1652286185.425113,"priority":"Normal","status_category":"Done","pull_request":8910},{"issue_id":"293409","title":"Readd password protected private key support","url":"https://tickets.puppetlabs.com/browse/PUP-9466","created_at":"2019-01-24T17:46:26.000-0800","number":"PUP-9466","body":"If {{passfile}} exists when puppet starts for the first time, then it will encrypt its private key using 3DES-CBC. However, the current implementation is a bit dubious. If puppet tries to load an encrypted private key and the {{passfile}} does not exist, then ruby will hang due to openssl prompting for the password. Ruby uses the legacy {{PEM_write_*}} methods that only use 1 iteration. Per https://www.openssl.org/docs/man1.0.2/crypto/pem.html \"The encryption key is determined using EVP_BytesToKey(), using salt and an iteration count of 1\" and https://github.com/ruby/openssl/issues/13. Also puppetserver does not support password protected private keys, so it can't be enabled on server hosts.","closed_at":"2019-06-11T16:09:08.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9466","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-06-11T16:09:08.000-0700","timestamp":1652286185.843455,"priority":"Normal","status_category":"Done","pull_request":7502},{"issue_id":"304723","title":"protection against illegal methods in legacy functions hides syntax error","url":"https://tickets.puppetlabs.com/browse/PUP-9643","created_at":"2019-04-15T06:50:07.000-0700","number":"PUP-9643","body":"*Puppet Version: 6.4.0*\r\n *Puppet Server Version: 6.3.0*\r\n *OS Name/Version: CentOS 7.6.1810*\r\n\r\nAfter updating our Puppet Server to latest release we received this issue on agents:\r\n\r\nroot@xyz1000 # puppet agent --test --environment=production\r\n Info: Using configured environment 'production'\r\n Info: Retrieving pluginfacts\r\n Info: Retrieving plugin\r\n Info: Retrieving locales\r\n Info: Loading facts\r\n Error: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Function Call, The code loaded from /etc/puppetlabs/code/environments/production/modules/etchosts/lib/puppet/parser/functions/get_host_hash.rb does not seem to be a Puppet 3x API function - no 'newfunction' call. (file: /etc/puppetlabs/code/environments/production/modules/etchosts/manifests/base/solaris.pp, line: 94, column: 15) on node xyz1000.xyz.de\r\n Warning: Not using cache on failed catalog\r\n Error: Could not retrieve catalog; skipping run\r\n\r\nThe affected function is valid and was accepted valid before (I only replaced \"values\" by an empty array to reduce complexity:\r\n\r\n \r\n{noformat}\r\nmodule Puppet::Parser::Functions\r\n  newfunction(:get_host_hash, :type => :rvalue, :doc => \"\") do |args|\r\n\r\n    # start with an empty hash\r\n    temp = Hash.new\r\n\r\n    # empty array in this example\r\n    values = Array.new\r\n\r\n    # get the first argument number\r\n    firstargnr = args[1].to_i\r\n\r\n    # get the first argument number\r\n    secondargnr = args[2].to_i\r\n\r\n    # analyze each entry in the values\r\n    values.each do |entry|\r\n\r\n      # split the entry array to sub arrays\r\n      subentry = entry.split\r\n\r\n      # if first requested element starts with # sign or second requested argument starts with + sign skip this entry\r\n      if not subentry[firstargnr].empty? and not subentry[firstargnr].start_with?(\"#\") and and not subentry[secondargnr].empty? and not subentry[secondargnr].start_with?(\"+\")\r\n\r\n        # add to the hash\r\n        temp.merge!({\"#{subentry[firstargnr]}\" => \"#{subentry[secondargnr]}\"})\r\n\r\n      end\r\n\r\n    end\r\n\r\n    # return the hash\r\n    temp\r\n\r\n  end\r\n\r\nend\r\n{noformat}\r\n \r\n\r\n*Desired Behavior:*\r\n\r\nWorks fine with 6.0.x and 5.5.x.\r\n\r\n*Actual Behavior:*\r\n\r\nUse of \"func3x_check = false\" in puppet.conf to get te catalog creation running again.\r\n\r\nroot@xyz1000 # puppet agent --test --environment=production\r\n Info: Using configured environment 'production'\r\n Info: Retrieving pluginfacts\r\n Info: Retrieving plugin\r\n Info: Retrieving locales\r\n Info: Loading facts\r\n Info: Caching catalog for xyz1000.xyz.de\r\n\r\n ","closed_at":"2019-06-12T04:36:19.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9643","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-06-12T04:36:19.000-0700","timestamp":1652286186.053811,"priority":"Normal","status_category":"Done","pull_request":7509},{"issue_id":"224644","title":"Tag filtering for skip_tag incorrectly expanded","url":"https://tickets.puppetlabs.com/browse/PUP-8215","created_at":"2017-11-29T10:24:24.000-0800","number":"PUP-8215","body":"{{\\--skip_tags foo::bar}} splits the tag on the namespace separator {{::}} and expands to skip the set {{['foo::bar', 'foo', 'bar']}}. Because resources are tagged with all parent tags, this means that every resource in the `foo` namespace is skipped when {{\\--skip_tags foo::bar}} is used. The same expansion issue was addressed for the {{\\--tags}} flag in PUP-4495, but it appears that the expansion logic for {{\\--tags}} and {{\\--skip_tags}} is separate.","closed_at":"2019-06-12T11:46:05.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8215","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-06-12T11:46:05.000-0700","timestamp":1652286186.263809,"priority":"Normal","status_category":"Done","pull_request":7508},{"issue_id":"300439","title":"Puppet upgrades debian packages with pending updates when setting them on hold","url":"https://tickets.puppetlabs.com/browse/PUP-9564","created_at":"2019-03-15T05:56:04.000-0700","number":"PUP-9564","body":"*Puppet Version: 4.10.x, probably other too*\r\n *Puppet Server Version:*\r\n *OS Name/Version: Debian 8, probably other versions too*\r\n\r\nIf puppet sets a package with a pending upgrade on hold (ensure=>held), the pending upgrade is installed before the package is set on hold.\r\n\r\nDescribe steps to reproduce:\r\n\r\n1. Show available versions\r\n{code:java}\r\n# apt-cache policy openssl\r\nopenssl:\r\n  Installed: 1.0.1t-1+deb8u11\r\n  Candidate: 1.0.1t-1+deb8u11\r\n  Version table:\r\n *** 1.0.1t-1+deb8u11 0\r\n        500 http://mirror.ip-platform.net/debian-security/ jessie/updates/main amd64 Packages\r\n        100 /var/lib/dpkg/status\r\n     1.0.1t-1+deb8u8 0\r\n        500 http://mirror.ip-platform.net/debian/ jessie/main amd64 Packages{code}\r\n \r\n\r\n 2. Downgrade package:\r\n\r\n \r\n{code:java}\r\n# puppet resource package openssl ensure=1.0.1t-1+deb8u8\r\nNotice: /Package[openssl]/ensure: ensure changed '1.0.1t-1+deb8u11' to '1.0.1t-1+deb8u8'\r\npackage { 'openssl':\r\n ensure => '1.0.1t-1+deb8u8',\r\n}\r\n{code}\r\n3. Set package on hold:\r\n\r\n \r\n{code:java}\r\n# puppet resource --debug package openssl ensure=held\r\n[...]\r\nDebug: Prefetching apt resources for package\r\nDebug: Executing '/usr/bin/dpkg-query -W --showformat '${Status} ${Package} ${Version}\\n''\r\nDebug: Executing: '/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install openssl'\r\nDebug: Executing: 'dpkg --set-selections'\r\nNotice: /Package[openssl]/ensure: ensure changed '1.0.1t-1+deb8u8' to 'held'\r\nDebug: Finishing transaction 28203320\r\nDebug: Storing state\r\nDebug: Stored state in 0.45 seconds\r\nDebug: Executing: '/usr/bin/dpkg-query -W --showformat '${Status} ${Package} ${Version}\\n' openssl'\r\npackage { 'openssl':\r\n ensure => '1.0.1t-1+deb8u11',\r\n}\r\n{code}\r\n4. Now the package has been upgraded:\r\n{code:java}\r\n# apt-cache policy openssl\r\nopenssl:\r\n Installed: 1.0.1t-1+deb8u11\r\n Candidate: 1.0.1t-1+deb8u11\r\n Version table:\r\n 1.0.2l-1~bpo8+1 0\r\n 200 http://mirror.ip-platform.net/debian/ jessie-backports/main amd64 Packages\r\n *** 1.0.1t-1+deb8u11 0\r\n 500 http://mirror.ip-platform.net/debian-security/ jessie/updates/main amd64 Packages\r\n 100 /var/lib/dpkg/status\r\n 1.0.1t-1+deb8u8 0\r\n 500 http://mirror.ip-platform.net/debian/ jessie/main amd64 Packages{code}\r\n \r\n\r\n \r\n\r\n*Desired Behavior:*\r\n\r\nThe package version stays unchanged and the package is marked on-hold.\r\n\r\n*Actual Behavior:*\r\n\r\nThe package has been upgraded and is on hold. This is counterintuitive and also not reflected by the agent output, especially as the \"on hold\" setting may be performed especially to prevent the pending upgrade from being installed.\r\n\r\n*Probable cause:*\r\n\r\nThe reason this happens is the apt-get install line marked bold above. If the package already is installed, it should not happen.\r\n\r\n ","closed_at":"2019-06-13T13:07:19.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9564","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-06-13T13:07:19.000-0700","timestamp":1652286186.577525,"priority":"Normal","status_category":"Done","pull_request":7489},{"issue_id":"307503","title":"Hiera Lookup Fails when convert_to is used","url":"https://tickets.puppetlabs.com/browse/PUP-9693","created_at":"2019-05-06T18:15:29.000-0700","number":"PUP-9693","body":"common.yaml has lookup_options configured with convert_to Sensitive for a data item:\r\n{code}\r\nlookup_options:\r\n \"^*my_con_pwd\":\r\n convert_to:\r\n - \"Sensitive\"\r\n{code}\r\n\r\nIf lookup_option is configured as shown above but this data is interpolated for another setting in a list, like:\r\n{code}\r\nmy_env_list:\r\n   db_settings:\r\n      db_pwd: \"%{hiera('my_con_pwd')}\"\r\n{code}\r\nthen the following error occurs:\r\n{code}\r\n2019-05-06 17:10:27 -0700 Puppet (err): Evaluation Error: Error while evaluating a Function Call, Lookup of key 'my_env_list' failed: The convert_to lookup_option for key 'my_con_pwd' raised error: undefined method `call_function' for #<Hiera::Scope:0x0000000001bf4e28> \r\n{code}\r\nCall-stack:\r\n{code}\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:111:in `rescue in convert_result'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:105:in `convert_result'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:65:in `block in lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:71:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:52:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:76:in `search_and_merge'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:31:in `block (2 levels) in lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:31:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:31:in `block in lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:29:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:29:in `reduce'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:29:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/interpolation.rb:81:in `block (3 levels) in interpolate_method'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:75:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/interpolation.rb:81:in `block (2 levels) in interpolate_method'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:19:in `with_scope'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/interpolation.rb:80:in `block in interpolate_method'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/interpolation.rb:60:in `block (2 levels) in interpolate_string'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/interpolation.rb:49:in `gsub'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/interpolation.rb:49:in `block in interpolate_string'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:133:in `with'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/interpolation.rb:48:in `interpolate_string'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/interpolation.rb:20:in `interpolate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/context.rb:187:in `interpolate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions/eyaml_lookup_key.rb:92:in `decrypt'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions/eyaml_lookup_key.rb:69:in `decrypt_value'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions/eyaml_lookup_key.rb:72:in `block in decrypt_value'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions/eyaml_lookup_key.rb:72:in `each_pair'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions/eyaml_lookup_key.rb:72:in `decrypt_value'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions/eyaml_lookup_key.rb:72:in `block in decrypt_value'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions/eyaml_lookup_key.rb:72:in `each_pair'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions/eyaml_lookup_key.rb:72:in `decrypt_value'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions/eyaml_lookup_key.rb:72:in `block in decrypt_value'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions/eyaml_lookup_key.rb:72:in `each_pair'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions/eyaml_lookup_key.rb:72:in `decrypt_value'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions/eyaml_lookup_key.rb:72:in `block in decrypt_value'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions/eyaml_lookup_key.rb:72:in `each_pair'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions/eyaml_lookup_key.rb:72:in `decrypt_value'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions/eyaml_lookup_key.rb:42:in `eyaml_lookup_key'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatch.rb:60:in `invoke'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:43:in `block in dispatch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:42:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:42:in `dispatch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:46:in `block in call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:45:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:45:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_key_function_provider.rb:53:in `block in lookup_key'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_key_function_provider.rb:50:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_key_function_provider.rb:50:in `lookup_key'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_key_function_provider.rb:31:in `block in invoke_with_location'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:133:in `with'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_key_function_provider.rb:30:in `invoke_with_location'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_key_function_provider.rb:20:in `block (2 levels) in unchecked_key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/merge_strategy.rb:219:in `block (2 levels) in lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/merge_strategy.rb:219:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/merge_strategy.rb:219:in `block in lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/merge_strategy.rb:219:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/merge_strategy.rb:219:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_key_function_provider.rb:19:in `block in unchecked_key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:133:in `with'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_key_function_provider.rb:18:in `unchecked_key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_key_function_provider.rb:77:in `unchecked_key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/configured_data_provider.rb:56:in `block (2 levels) in unchecked_key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/merge_strategy.rb:219:in `block (2 levels) in lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/merge_strategy.rb:219:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/merge_strategy.rb:219:in `block in lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/merge_strategy.rb:219:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/merge_strategy.rb:219:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/configured_data_provider.rb:55:in `block in unchecked_key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:133:in `with'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/configured_data_provider.rb:48:in `unchecked_key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/global_data_provider.rb:36:in `unchecked_key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/global_data_provider.rb:23:in `block (2 levels) in unchecked_key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:75:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/global_data_provider.rb:23:in `block in unchecked_key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:19:in `with_scope'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/global_data_provider.rb:18:in `unchecked_key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/data_provider.rb:26:in `block in key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:90:in `check'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/data_provider.rb:26:in `key_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:125:in `lookup_global'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:321:in `do_lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:67:in `block (4 levels) in lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:67:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:67:in `block (3 levels) in lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:133:in `with'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:66:in `block (2 levels) in lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:91:in `convert_result'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:65:in `block in lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/invocation.rb:75:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:52:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/lookup_adapter.rb:52:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:76:in `search_and_merge'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:31:in `block (2 levels) in lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:31:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:31:in `block in lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:29:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:29:in `reduce'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup.rb:29:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/hiera/puppet_function.rb:74:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/hiera/puppet_function.rb:46:in `hiera_no_default'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatch.rb:60:in `invoke'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:43:in `block in dispatch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:42:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:42:in `dispatch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:46:in `block in call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:45:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:45:in `call'\r\n/home/tstuser/tst.pp:59:in `block in call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:305:in `eval'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:305:in `block in call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:303:in `call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:964:in `call_function_with_block'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:933:in `eval_CallNamedFunctionExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:90:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:370:in `eval_AssignmentExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:90:in `visit_this_1'\r\n\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/evaluating_parser.rb:63:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:32:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:72:in `block (2 levels) in evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:71:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:71:in `block in evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:70:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:70:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast.rb:31:in `safeevaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:136:in `evaluate_code'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:79:in `block in evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:71:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:386:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:386:in `evaluate_classes'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions/include.rb:48:in `include'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatch.rb:60:in `invoke'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:43:in `block in dispatch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:42:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:42:in `dispatch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:46:in `block in call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:45:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:45:in `call'\r\n:1:in `block in call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:305:in `eval'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:305:in `block in call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:303:in `call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:964:in `call_function_with_block'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:933:in `eval_CallNamedFunctionExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:48:in `block in visit_this'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:42:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:42:in `visit_this'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:92:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n:in `stack'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/puppet_stack.rb:33:in `eval'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/puppet_stack.rb:33:in `stack'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:737:in `eval_Program'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:48:in `block in visit_this'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:42:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:42:in `visit_this'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:92:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/evaluating_parser.rb:63:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:125:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast.rb:31:in `safeevaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:136:in `evaluate_code'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:79:in `block in evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:71:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:592:in `evaluate_main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:166:in `block (2 levels) in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:166:in `block in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:260:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:155:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:35:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:301:in `block in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:232:in `block in benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/2.4.0/benchmark.rb:308:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:231:in `benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:299:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:54:in `block in find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/node/environment.rb:450:in `with_text_domain'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:53:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:198:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:262:in `block in main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:260:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:233:in `main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:174:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:667:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:136:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:73:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\n{code}","closed_at":"2019-06-17T16:10:47.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9693","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-06-17T16:10:47.000-0700","timestamp":1652286188.042316,"priority":"Normal","status_category":"Done","pull_request":7517},{"issue_id":"262704","title":"FastGettext.default_text_domain order dependent test failure","url":"https://tickets.puppetlabs.com/browse/PUP-8959","created_at":"2018-06-26T02:01:20.000-0700","number":"PUP-8959","body":"When running _bundle exec rake parallel:spec[12]_ from the puppet master branch on a Fedora Linux (I've tested 27 and 28) the following statement:\r\n{code:ruby}\r\nFastGettext.translation_repositories[FastGettext.default_text_domain]\r\n{code}\r\nreturns {{nil}} which results in the message \"undefined method `chain' for nil:NilClass\" in file _lib/puppet/gettext/config.rb_ on line 179. This in turn, causes +40 spec test failures.\r\n\r\nSample stack trace from one of the failed tests:\r\n{code}\r\n  1) Puppet::Resource::Catalog::Compiler when initializing should cache the server metadata and reuse it\r\n     Failure/Error: puppet_translations = FastGettext.translation_repositories[FastGettext.default_text_domain].chain\r\n     NoMethodError:\r\n       undefined method `chain' for nil:NilClass\r\n     # ./lib/puppet/gettext/config.rb:179:in `copy_default_translations'\r\n     # ./lib/puppet/gettext/config.rb:73:in `reset_text_domain'\r\n     # ./lib/puppet/node/environment.rb:426:in `with_text_domain'\r\n     # ./lib/puppet/indirector/catalog/compiler.rb:53:in `find'\r\n     # ./spec/unit/indirector/catalog/compiler_spec.rb:35:in `block (3 levels) in <top (required)>'\r\n     # util/rspec_runner:44:in `run'\r\n     # util/rspec_runner:59:in `<main>'\r\n{code}\r\n","closed_at":"2019-06-19T10:16:32.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8959","labels":"","state":"Closed","updated_at":"2019-06-19T10:16:32.000-0700","timestamp":1652286189.077793,"priority":"Normal","status_category":"Done","pull_request":6894},{"issue_id":"313352","title":"Constants assigned twice emit warning during Litmus use on Windows.","url":"https://tickets.puppetlabs.com/browse/PUP-9789","created_at":"2019-06-20T11:07:37.000-0700","number":"PUP-9789","body":"When running acceptance tests via Litmus, the Puppet::Util::Windows::APITypes::FFI module from lib/puppet/util/windows/api_types.rb is loaded via the puppet gem.\r\n\r\nUnfortunately this module always gets loaded twice and a warning is returned to the commandline:\r\n\r\n\r\n{noformat}\r\nC:/src/puppetlabs-java_ks/.bundle/gems/ruby/2.5.0/gems/puppet-6.4.2-x64-mingw32/lib/puppet/util/windows/api_types.rb:6: warning: already initialized constant FFI::WIN32_FALSE\r\nC:/src/puppetlabs-java_ks/.bundle/gems/ruby/2.5.0/gems/pdk-1.10.0/lib/pdk/util/windows/api_types.rb:6: warning: previous definition of WIN32_FALSE was here\r\nC:/src/puppetlabs-java_ks/.bundle/gems/ruby/2.5.0/gems/puppet-6.4.2-x64-mingw32/lib/puppet/util/windows/api_types.rb:9: warning: already initialized constant FFI::ERROR_SUCCESS\r\nC:/src/puppetlabs-java_ks/.bundle/gems/ruby/2.5.0/gems/pdk-1.10.0/lib/pdk/util/windows/api_types.rb:9: warning: previous definition of ERROR_SUCCESS was here\r\n{noformat}\r\n\r\n\r\n","closed_at":"2019-06-25T15:14:06.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9789","labels":"litmus;windows","state":"Closed","updated_at":"2019-06-25T15:14:06.000-0700","timestamp":1652286190.523282,"priority":"Normal","status_category":"Done","pull_request":7588},{"issue_id":"309697","title":"Puppet 6 client exits on start when it cannot connect to puppetserver ","url":"https://tickets.puppetlabs.com/browse/PUP-9717","created_at":"2019-05-22T08:28:52.000-0700","number":"PUP-9717","body":"*Puppet Version: 6.4.2*\r\n *Puppet Server Version: 6.3.0*\r\n *OS Name/Version: CentOS 7.6*\r\n\r\nIn previous versions of puppet, I would spin up instances in AWS, regardless of the puppetservere being available, and have runinterval at 20 seconds. Whenever the base packages were installed, I'd update the puppet configuration to a runinterval of every 30 minutes.\r\n\r\nSince I've started version 6 clients, this \"trick\" no longer works. The puppet client will try to connect to the puppetserver when it starts, and if it doesn't it will exit. That's quite disastrous for my deployment strategy.\r\n\r\nSteps to reproduce:\r\n\r\nPre-requisites: Have the above puppet server and client versions on a single machine. Have puppetserver and client stopped.\r\n\r\n1. Start puppet client.\r\n\r\n*Desired Behavior:*\r\n\r\nA. puppet client starts, regardless of a connection is possible with the puppetserver. It will re-try each runinterval.\r\n\r\n*Actual Behavior:*\r\n - puppet client exits with below message in /var/log/messages:\r\n{noformat}May 22 15:08:05 bas-t-1 systemd: Started Puppet agent.\r\nMay 22 15:08:07 bas-t-1 puppet-agent[12580]: Could not run: Failed to open TCP connection to bas-t-1.t.dam.loc:8140 (Connection refused - connect(2) for \"bas-t-1.t.dam.loc\" port 8140)\r\nMay 22 15:08:07 bas-t-1 systemd: puppet.service: main process exited, code=exited, status=1/FAILURE\r\nMay 22 15:08:07 bas-t-1 systemd: Unit puppet.service entered failed state.\r\nMay 22 15:08:07 bas-t-1 systemd: puppet.service failed.{noformat}\r\npuppet.conf:\r\n{noformat}[main]\r\nserver = bas-t-1.t.dam.loc\r\nenvironment = production\r\nruninterval = 20s\r\nhiera_config = /etc/puppetlabs/puppet/hiera.yaml\r\n[master]\r\ndns_alt_names = bas-t-1.t.dam.loc{noformat}\r\n ","closed_at":"2019-07-02T09:25:14.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9717","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-07-02T09:25:14.000-0700","timestamp":1652286199.888907,"priority":"Normal","status_category":"Done","pull_request":7560},{"issue_id":"311950","title":"Puppet ssl submit_request does not translate custom oids correctly","url":"https://tickets.puppetlabs.com/browse/PUP-9746","created_at":"2019-06-10T16:10:02.000-0700","number":"PUP-9746","body":"When defining an extension request in csr_attributes.yaml, like so:\r\n{code}\r\n---\r\nextension_requests:\r\n  pp_role: pe_compiler \r\n{code}\r\nRunning `puppet ssl submit_request` results in the following error:\r\n{code}\r\nError: Could not run: Failed to submit certificate request: Cannot create CSR with extension request pp_role: OBJ_txt2obj: first num too large\r\nWrapped exception:\r\nCannot create CSR with extension request pp_role: OBJ_txt2obj: first num too large\r\n{code}\r\nHowever, doing a puppet agent run to generate the CSR works fine.\r\n\r\nPer [~josh], the SSL application may be registering the oids like the puppet agent code path does, and the call to `Puppet::SSL::Oids.register_puppet_oids` should be moved to the SSL provider, instead of each application having to do it.  Also, Puppet's `certificate_extensions.rb` beaker test only runs `puppet agent` and should be expanded to include at least `puppet ssl`.","closed_at":"2019-07-02T09:25:15.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9746","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-07-02T09:25:15.000-0700","timestamp":1652286199.995188,"priority":"Normal","status_category":"Done","pull_request":7566},{"issue_id":"126290","title":"it should not be possible to disable manifest ordering","url":"https://tickets.puppetlabs.com/browse/PUP-6165","created_at":"2016-04-12T11:48:05.000-0700","number":"PUP-6165","body":"Manifest ordering have as far as I can tell been proven to work, problem is with it being configurable it's not something one can really rely on in public code as you just have no way to know if your users have it on or not.\r\n\r\nWhen next allowed by semver I'd propose it be turned on and remain on without the option to configure.","closed_at":"2019-07-02T10:20:19.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6165","labels":"","state":"Closed","updated_at":"2019-07-02T10:20:19.000-0700","timestamp":1652286200.310405,"priority":"Normal","status_category":"Done","pull_request":7059},{"issue_id":"90662","title":"Provide helpful error message when provider does not have instances defined","url":"https://tickets.puppetlabs.com/browse/PUP-4930","created_at":"2015-07-27T10:09:07.000-0700","number":"PUP-4930","body":"When using the RAL to get a list of resources, if the provider does not have the {{instances}} method defined you get:\r\n\r\n{code}\r\nError: Could not run: Provider getsetsebool has not defined the 'instances' class method\r\n{code}\r\n\r\nRegurgitating an implementation detail is incredibly unhelpful except for those few that actually know how types and providers work.\r\n\r\nI'd like to suggest we add a default {{instances}} method on providers that gives us a more helpful error message which every provider must then override (which they'll do anyway if they want to provide this feature, if not they get a user friendly error message for free).","closed_at":"2019-07-03T01:38:14.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4930","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-07-03T01:38:14.000-0700","timestamp":1652286200.724878,"priority":"Normal","status_category":"Done","pull_request":7522},{"issue_id":"246189","title":"rpm package provider is too specific","url":"https://tickets.puppetlabs.com/browse/PUP-8664","created_at":"2018-04-17T16:19:37.000-0700","number":"PUP-8664","body":"*Puppet Version: 5.3.5 (and older)*\r\n *Puppet Server Version: N/A*\r\n *OS Name/Version: Centos/Redhat*\r\n\r\nThe uninstall method in the rpm package provider is more specific than the package resource it is uninstalling, and uses a cache that can become out of date by the time it executes.\r\n\r\n*Desired Behavior:*\r\n\r\nUnconditionally uninstall a package when conditions are not specified.\r\n\r\n*Actual Behavior:*\r\n\r\nExample:\r\n{code:java}\r\n  package { 'cronie-anacron':\r\n    ensure  => absent,\r\n    require => Package['cronie-noanacron']\r\n  }\r\n\r\n  package { 'cronie-noanacron':\r\n    ensure => installed,\r\n  }\r\n{code}\r\n \r\n{code:java}\r\nyum[3546]: Updated: cronie-anacron-1.4.11-19.el7.x86_64 \r\nyum[3546]: Updated: cronie-1.4.11-19.el7.x86_64 \r\nyum[3546]: Installed: cronie-noanacron-1.4.11-19.el7.x86_64\r\n\r\npuppet-agent[1371]: (/Stage[main]/Package[cronie-noanacron]/ensure) created \r\npuppet-agent[1371]: Execution of '/usr/bin/rpm -e cronie-anacron-1.4.11-17.el7.x86_64' returned 1: error: package cronie-anacron-1.4.11-17.el7.x86_64 is not installed \r\npuppet-agent[1371]: (/Stage[main]/Package[cronie-anacron]/ensure) change from '1.4.11-17.el7' to 'absent' failed: Execution of '/usr/bin/rpm -e cronie-anacron-1.4.11-17.el7.x86_64' returned 1: error: package cronie-anacron-1.4.11-17.el7.x86_64 is not installed\r\n{code}\r\n\r\n To reset the test environment after that puppet run, download cronie-1.4.11-14.el7.x86_64.rpm and cronie-anacron-1.4.11-14.el7.x86_64.rpm and run:\r\n\r\n{code:java}\r\nrpm -e cronie cronie-noanacron crontabs ; yum install -y cronie-* ; rpm -qa | grep cron ; puppet agent -t ; rpm -qa | grep cron\r\n{code}\r\n","closed_at":"2019-07-03T01:41:38.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8664","labels":"cs_pr_review;resolved-issue-added","state":"Resolved","updated_at":"2019-07-03T01:41:38.000-0700","timestamp":1652286200.829811,"priority":"Minor","status_category":"Done","pull_request":6792},{"issue_id":"262030","title":"puppet device permissions preventing reading dirs","url":"https://tickets.puppetlabs.com/browse/PUP-9642","created_at":"2018-06-21T05:56:50.000-0700","number":"PUP-9642","body":"With umask=027, puppet device sets permissions in a way preventing pe-puppet user from reading some directories \r\n(https://docs.google.com/document/d/1C_opr4OdiovFO1qScz7qH3Qu4RECbpMkobAQNJrT85k/edit#heading=h.glx17pt2xr21)","closed_at":"2019-07-03T01:45:57.000-0700","comments":22,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9642","labels":"dtt;resolved-issue-added","state":"Closed","updated_at":"2019-07-03T01:45:57.000-0700","timestamp":1652286200.942875,"priority":"Normal","status_category":"Done","pull_request":7483},{"issue_id":"308724","title":"Removing user on Solaris 11 with altered managehome","url":"https://tickets.puppetlabs.com/browse/PUP-9706","created_at":"2019-05-15T07:54:40.000-0700","number":"PUP-9706","body":"*Puppet Version: 6.4.2*\r\n *Puppet Server Version: N/A*\r\n *OS Name/Version: Solaris 11*\r\n\r\n*Desired Behavior: Able to remove a user without any errors*\r\n\r\n*Actual Behavior:*\r\n\r\nWhen applying the following an error occurs:\r\n{code:java}root@yz4rr58lsjdxqz3:~# puppet apply -e 'user { \"testuser\": ensure => \"present\", managehome => false }'\r\nNotice: /File[/etc/puppetlabs/code/environments/production]/ensure: created\r\nNotice: Compiled catalog for yz4rr58lsjdxqz3.delivery.puppetlabs.net in environment production in 0.03 seconds\r\nNotice: /Stage[main]/Main/User[testuser]/ensure: created\r\nNotice: Applied catalog in 0.06 seconds\r\nroot@yz4rr58lsjdxqz3:~# puppet apply -e 'user { \"testuser\": ensure => \"absent\",  managehome => true  }'\r\nNotice: Compiled catalog for yz4rr58lsjdxqz3.delivery.puppetlabs.net in environment production in 0.03 seconds\r\nError: Could not delete user testuser: Execution of '/usr/sbin/userdel -r testuser' returned 12: UX: /usr/sbin/userdel: ERROR: Unable to remove home directory. No such file or directory\r\nError: /Stage[main]/Main/User[testuser]/ensure: change from 'present' to 'absent' failed: Could not delete user testuser: Execution of '/usr/sbin/userdel -r testuser' returned 12: UX: /usr/sbin/userdel: ERROR: Unable to remove home directory. No such file or directory\r\nNotice: Applied catalog in 0.12 seconds// code placeholder\r\n{code}\r\nWe are seeing this issue in puppetlabs-accounts in [https://github.com/puppetlabs/puppetlabs-accounts/pulls/222] when running adhoc against Solaris 11.","closed_at":"2019-07-03T01:48:01.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9706","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-07-03T01:48:01.000-0700","timestamp":1652286201.04879,"priority":"Normal","status_category":"Done","pull_request":7527},{"issue_id":"313529","title":"undefined method `pip_version' with pip3 provider","url":"https://tickets.puppetlabs.com/browse/PUP-9790","created_at":"2019-06-21T01:36:31.000-0700","number":"PUP-9790","body":"*Puppet Version: 6.5.0*\r\n *Puppet Server Version: 6.4.0*\r\n *OS Name/Version: Debian stretch*\r\n\r\nAfter updating puppet-agent to 6.5.0 and the puppet server to 6.4.0 package resources with a pip3 provider throw the following error:\r\n{noformat}Debug: Prefetching pip3 resources for packageDebug: Executing '/usr/bin/pip3 --version'\r\nDebug: Executing '/usr/bin/pip3 freeze --all'Debug: Puppet::Type::Package::ProviderPip3: Prefetched instance: %{name} via command: %{command}\r\nDebug: Puppet::Type::Package::ProviderPip3: Prefetched instance: %{name} via command: %{command}\r\nError: Could not get latest version: undefined method `pip_version' for Package[checkdmarc](provider=pip3)(command=default):Puppet::Type::Package::ProviderPip3\r\nInfo: Unknown failure using insync_values? on type: Package[checkdmarc] / property: ensure to compare values [:latest] and 4.1.10 Error: /Stage[main]/Main/Node[redacted]/Mail::Dmarc_report[redacted]/Package[checkdmarc]/ensure: change from '4.1.10' to 'latest' failed: Could not get latest version: undefined method `pip_version' for Package[checkdmarc](provider=pip3)(command=default):Puppet::Type::Package::ProviderPip3{noformat}\r\nThe code from the module is just:\r\n{noformat}package { 'checkdmarc':\r\n ensure => 'latest'\r\n , provider => 'pip3'\r\n , require => Package['python3-pip']\r\n }{noformat}\r\n \r\n{noformat}$ /usr/bin/pip3 --version\r\npip 9.0.1 from /usr/lib/python3/dist-packages (python 3.5)\r\n{noformat}\r\n \r\n\r\n \r\n\r\n ","closed_at":"2019-07-03T01:48:58.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9790","labels":"regression;resolved-issue-added;type_and_provider","state":"Closed","updated_at":"2019-07-03T01:48:58.000-0700","timestamp":1652286201.155991,"priority":"Major","status_category":"Done","pull_request":7593},{"issue_id":"62743","title":"pacman provider's yaourt support now totally broken","url":"https://tickets.puppetlabs.com/browse/PUP-3802","created_at":"2014-12-31T19:03:55.000-0800","number":"PUP-3802","body":"As of pacman 4.2, the pacman provider's yaourt support is totally broken by an upstream change.\r\n\r\nhttps://projects.archlinux.org/pacman.git/commit/?id=61ba5c961e4a3536c4bbf41edb348987a9993fdb removed the {{--asroot}} option from {{makepkg}}, so {{yaourt}} can no longer build packages as root.\r\n\r\nSpeaking with some people in the Arch community, it seems like a bad idea and big security hole that it ever could.\r\n\r\nI'll be researching alternatives, but it seems like the best thing would probably be to just deprecate the yaourt support.","closed_at":"2019-07-11T00:43:47.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3802","labels":"arch;help_wanted;package;pacman;type_and_provider;yaourt","state":"Resolved","updated_at":"2019-07-11T00:43:47.000-0700","timestamp":1652286202.243924,"priority":"Normal","status_category":"Done","pull_request":6525},{"issue_id":"301168","title":"Serial execution with puppet device and ciscopuppet fails","url":"https://tickets.puppetlabs.com/browse/PUP-9587","created_at":"2019-03-21T13:57:37.000-0700","number":"PUP-9587","body":"When executing puppet device with multiple instances of ciscopuppet  nodes beyond the first fail to execute:\r\n\r\n\r\n{noformat}\r\n[root@h0wm6jin2afatag ~]# puppet device -v --trace\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: starting applying configuration to nexus1 at file:///etc/puppetlabs/puppet/devices/nexus1.conf\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\n/opt/puppetlabs/puppet/lib/ruby/gems/2.5.0/gems/cisco_node_utils-2.0.0/lib/cisco_node_utils/node.rb:154: warning: constant ::Fixnum is deprecated\r\nInfo: Caching catalog for nexus1\r\nInfo: Applying configuration version '1553200309'\r\nNotice: Applied catalog in 0.12 seconds\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: starting applying configuration to nexus2 at file:///etc/puppetlabs/puppet/devices/nexus2.conf\r\nWarning: Unable to fetch my node definition, but the agent run will continue:\r\nWarning: Error 403 on SERVER: Forbidden request: /puppet/v3/node/nexus2 (method :get). Please see the server logs for details.\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\n/opt/puppetlabs/puppet/lib/ruby/gems/2.5.0/gems/cisco_node_utils-2.0.0/lib/cisco_node_utils/node.rb:154: warning: constant ::Fixnum is deprecated\r\nError: Could not retrieve catalog from remote server: Error 403 on SERVER: Forbidden request: /puppet/v3/catalog/nexus2 (method :post). Please see the server logs for details.\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/rest.rb:241:in `is_http_200?'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/rest.rb:120:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:194:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:464:in `block in retrieve_new_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:518:in `block in thinmark'\r\n/opt/puppetlabs/puppet/lib/ruby/2.5.0/benchmark.rb:308:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:517:in `thinmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:463:in `retrieve_new_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:75:in `retrieve_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:167:in `prepare_and_retrieve_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:341:in `run_internal'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:239:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:252:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:217:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/device.rb:327:in `block (2 levels) in main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/device.rb:256:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/device.rb:256:in `collect'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/device.rb:256:in `block in main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:252:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/device.rb:241:in `main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:390:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:382:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:671:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:382:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:135:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:73:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\nError: Could not retrieve catalog; skipping run\r\nError: Could not send report: Error 403 on SERVER: Forbidden request: /puppet/v3/report/nexus2 (method :put). Please see the server logs for details.\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/rest.rb:241:in `is_http_200?'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/rest.rb:190:in `save'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:285:in `save'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:416:in `send_report'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:388:in `run_internal'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:239:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:252:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:217:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/device.rb:327:in `block (2 levels) in main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/device.rb:256:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/device.rb:256:in `collect'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/device.rb:256:in `block in main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:252:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/device.rb:241:in `main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:390:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:382:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:671:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:382:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:135:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:73:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\n\r\n{noformat}\r\n\r\n\r\nServer Log \r\n{noformat}\r\n2019-03-21T20:31:49.135Z INFO  [qtp2129953650-177] [puppetserver] Puppet 'replace_facts' command for nexus1 submitted to PuppetDB with UUID 15cc8e0d-5e6c-4ee8-9c6f-2e1c0129763e\r\n2019-03-21T20:31:49.301Z WARN  [qtp2129953650-177] [puppetserver] Puppet Host is missing hostname and/or domain: nexus1\r\n2019-03-21T20:31:49.305Z INFO  [qtp2129953650-177] [puppetserver] Puppet Compiled catalog for nexus1 in environment production in 0.07 seconds\r\n2019-03-21T20:31:49.305Z INFO  [qtp2129953650-177] [puppetserver] Puppet Caching catalog for nexus1\r\n2019-03-21T20:31:49.342Z INFO  [qtp2129953650-177] [puppetserver] Puppet 'replace_catalog' command for nexus1 submitted to PuppetDB with UUID a0568882-d669-440d-b4ec-16379250973b\r\n2019-03-21T20:31:49.588Z INFO  [qtp2129953650-181] [puppetserver] Puppet 'store_report' command for nexus1 submitted to PuppetDB with UUID 06465d95-6019-4f82-8f76-1ea37d7d04b8\r\n2019-03-21T20:31:51.111Z ERROR [qtp2129953650-176] [p.t.a.rules] Forbidden request: nexus1(10.16.114.187) access to /puppet/v3/node/nexus2 (method :get) (authenticated: true) denied by rule 'puppetlabs node'.\r\n2019-03-21T20:31:55.961Z ERROR [qtp2129953650-176] [p.t.a.rules] Forbidden request: nexus1(10.16.114.187) access to /puppet/v3/catalog/nexus2 (method :post) (authenticated: true) denied by rule 'puppetlabs catalog'.\r\n2019-03-21T20:31:55.996Z ERROR [qtp2129953650-181] [p.t.a.rules] Forbidden request: nexus1(10.16.114.187) access to /puppet/v3/report/nexus2 (method :put) (authenticated: true) denied by rule 'puppetlabs report'\r\n{noformat}\r\n\r\n\r\n ","closed_at":"2019-07-12T01:44:22.000-0700","comments":21,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9587","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-07-12T01:44:22.000-0700","timestamp":1652286202.454542,"priority":"Major","status_category":"Done","pull_request":7450},{"issue_id":"305706","title":"Backport certname mismatch to 5.5.x and 6.0.x (PUP-8213)","url":"https://tickets.puppetlabs.com/browse/PUP-9649","created_at":"2019-04-19T16:13:41.000-0700","number":"PUP-9649","body":"When running with ruby 2.4 or 2.5, ruby will raise a certname mismatch error before we have a chance to handle it, and print a meaningful message.\r\n\r\nThis is a backport of the changes made in 6.4.x in PUP-8213","closed_at":"2019-07-12T01:45:00.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9649","labels":"","state":"Resolved","updated_at":"2019-07-12T01:45:00.000-0700","timestamp":1652286202.556942,"priority":"Normal","status_category":"Done","pull_request":7491},{"issue_id":"315708","title":"PAL fixes to support AST compilation","url":"https://tickets.puppetlabs.com/browse/PUP-9818","created_at":"2019-07-09T11:44:49.000-0700","number":"PUP-9818","body":"In the process of writing the Ruby code for the new AST compilation endpoint, we discovered several bugs and API gaps in PAL. This ticket tracks those fixes.","closed_at":"2019-07-12T09:07:37.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9818","labels":"","state":"Resolved","updated_at":"2019-07-12T09:07:37.000-0700","timestamp":1652286202.75939,"priority":"Normal","status_category":"Done","pull_request":7599},{"issue_id":"106593","title":"Error when purging local users on Windows","url":"https://tickets.puppetlabs.com/browse/PUP-6716","created_at":"2015-11-20T09:29:02.000-0800","number":"PUP-6716","body":"This a significant user.\r\n\r\nFROM THE USER:\r\n\r\nWe want to control the local users with Puppet and purge any unmanaged user for audit compliance and security purposes. When I configure this in the below manifest I get the following error: \r\nError: /Stage[main]/Main/Resources[user]: Failed to generate additional resources using 'generate': comparison of String with 499 failed \r\nCan this please be fixed.\r\n\r\nuser { ['Administrator', 'guest']: \r\nensure => present \r\n}\r\n\r\nresources { 'user': \r\npurge => true \r\n}\r\n\r\n\r\nAs a generic rule of thumb you can expect us to use Puppet and all classes on every Windows edition available from 2003 and up, although 2008 and up is really the current scope, don't care too much about 2003. I just tested and this doesn't work on Windows 2012R2 either. I've never tested it before, we're in the process of putting this compliancy rule in Puppet so this is the first time I run into this. It looks like a bug to me, tt work fine (as expected) for for example the group resource or host resource and even type/providers we created ourselves.\r\n\r\n","closed_at":"2019-07-15T16:43:02.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6716","labels":"customer;manage-user-group;type_and_provider;user;windows;windows-parity","state":"Resolved","updated_at":"2019-07-15T16:43:02.000-0700","timestamp":1652286203.371143,"priority":"Critical","status_category":"Done","pull_request":7107},{"issue_id":"104507","title":"Windows Service provider should use something better than net.exe - perhaps direct FFI access","url":"https://tickets.puppetlabs.com/browse/PUP-5475","created_at":"2015-11-05T08:28:52.000-0800","number":"PUP-5475","body":"From http://stackoverflow.com/q/33531461/18475, {{net.exe}} can timeout while waiting for a process that is in a start pending state. The Windows provider for service in Puppet uses {{net.exe}}, which returns a non-zero exit code when it times out waiting for the service, even if the service does eventually start up. \r\n\r\nIt is believed (needs research) that [Service Controller ({{sc.exe}})|https://technet.microsoft.com/en-us/library/bb490995.aspx] doesn't suffer from this issue.\r\n\r\nInvestigate using it instead. As a benefit, it can also [create and destroy services|http://ss64.com/nt/sc.html].","closed_at":"2019-07-15T16:45:39.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5475","labels":"maintenance;service;tech-debt;type_and_provider;windows","state":"Closed","updated_at":"2019-07-15T16:45:39.000-0700","timestamp":1652286204.321328,"priority":"Major","status_category":"Done","pull_request":7110},{"issue_id":"161236","title":"Windows package provider should set working directory (cwd)","url":"https://tickets.puppetlabs.com/browse/PUP-6920","created_at":"2016-11-15T22:54:48.000-0800","number":"PUP-6920","body":"Some installations may require files other than the installer to install properly.  The assumption of these installation packages may be that the path to these files is the current working directory.\r\n\r\nHowever, the Windows package provider currently does not set a working directory - and hence cannot currently support certain types of installations.\r\n\r\nPUP-6919 tracks the work to support {{cwd}} with the underlying {{Puppet::Util::Execution.execute}} mechanism.  This ticket is to track setting the {{cwd}} automatically to the same location as the installer source.","closed_at":"2019-07-15T16:47:26.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6920","labels":"package;type_and_provider;windows","state":"Closed","updated_at":"2019-07-15T16:47:26.000-0700","timestamp":1652286204.529279,"priority":"Normal","status_category":"Done","pull_request":7136},{"issue_id":"46494","title":"User resource on AIX returns a non-working structure or 'attributes'","url":"https://tickets.puppetlabs.com/browse/PUP-3021","created_at":"2014-08-05T07:32:33.000-0700","number":"PUP-3021","body":"The `user` resource on AIX returns back non-working Puppet code for the 'attributes' key.\r\n\r\nExample:\r\n{code:title=puppet resource user root|borderStyle=solid}# puppet resource user root | tee /tmp/root.pp\r\n\r\nuser { 'root':\r\n  ensure           => 'present',\r\n  attributes       => {'account_locked' => 'false', 'admin' => 'true', 'auditclasses' => 'general', 'auth1' => 'SYSTEM', 'auth2' => 'NONE', 'core' => '-1', 'cpu' => '-1', 'daemon' => 'true', 'data' => '-1', 'fsize' => '-1', 'histexpire' => '0', 'histsize' => '0', 'host_last_login' => 'removed.example.com', 'host_last_unsuccessful_login' => 'removed.example.com', 'login' => 'true', 'loginretries' => '0', 'maxexpired' => '-1', 'maxrepeats' => '8', 'minalpha' => '0', 'mindiff' => '0', 'mindigit' => '0', 'minlen' => '0', 'minloweralpha' => '0', 'minother' => '0', 'minspecialchar' => '0', 'minupperalpha' => '0', 'name' => 'root', 'nofiles' => '2000', 'pwdwarntime' => '0', 'registry' => 'files', 'rlogin' => 'true', 'rss' => '-1', 'stack' => '-1', 'su' => 'true', 'sugroups' => 'ALL', 'system' => 'compat', 'time_last_login' => '1407248916', 'time_last_unsuccessful_login' => '1407184651', 'tpath' => 'nosak', 'tty_last_login' => '/dev/pts/1', 'tty_last_unsuccessful_login' => 'ssh', 'ttys' => 'ALL', 'umask' => '22', 'unsuccessful_login_count' => '0'},\r\n  comment          => 'root',\r\n  expiry           => '2032-12-31',\r\n  gid              => '0',\r\n  groups           => ['system', 'bin', 'sys', 'security', 'cron', 'audit', 'lp'],\r\n  home             => '/',\r\n  password         => 'WuthH/s1ny/5s',\r\n  password_max_age => '0',\r\n  password_min_age => '0',\r\n  shell            => '/bin/ksh',\r\n  uid              => '0',\r\n}\r\n{code}\r\nAnd then running the same code through puppet apply:\r\n{code:title=puppet apply root.pp|borderStyle=solid}# puppet apply /tmp/root.pp\r\nNotice: Compiled catalog for myhost.example.com in environment production in 0.28 seconds\r\nError: Parameter attributes failed on User[root]: Attributes value pairs must be separated by an = at /tmp/root.pp:14\r\nWrapped exception:\r\nAttributes value pairs must be separated by an =\r\n\r\n{code}\r\nThe issue seems to stem from the attributes field. `puppet resource` outputs a key/value object for attributes, while puppet apply seems to expect an array with key=value parts in it as a string.\r\n\r\nChanging it to an array of key=value pairs results in a still broken setup. Puppet resource outputs several key/value pairs that are NOT items that can be changed via the chuser command it runs under the covers. It should not return the 'name' or the 'system' keys.\r\n\r\nThis was my working root.pp file:\r\n{code:title=root.pp}user { 'root':\r\n  ensure           => 'present',\r\n  attributes => ['account_locked=false', 'admin=true', 'auditclasses=general', 'auth1=SYSTEM', 'auth2=NONE', 'core=-1', 'cpu=-1', 'daemon=true', 'data=-1', 'fsize=-1', 'histexpire=0', 'histsize=0', 'host_last_login=removed.example.com', 'host_last_unsuccessful_login=removed.example.com', 'login=true', 'loginretries=0', 'maxexpired=-1', 'maxrepeats=8', 'minalpha=0', 'mindiff=0', 'mindigit=0', 'minlen=0', 'minloweralpha=0', 'minother=0', 'minspecialchar=0', 'minupperalpha=0', 'nofiles=2000', 'pwdwarntime=0', 'registry=files', 'rlogin=true', 'rss=-1', 'stack=-1', 'su=true', 'sugroups=adm', 'time_last_login=1407248916', 'time_last_unsuccessful_login=1407184651', 'tpath=nosak', 'tty_last_login=/dev/pts/1', 'tty_last_unsuccessful_login=ssh', 'ttys=ALL', 'umask=22', 'unsuccessful_login_count=0'],\r\n  comment          => 'root',\r\n  expiry           => '2032-12-31',\r\n  gid              => '0',\r\n  groups           => ['system', 'bin', 'sys', 'security', 'cron', 'audit', 'lp'],\r\n  home             => '/',\r\n  password         => 'fakepass',\r\n  password_max_age => '0',\r\n  password_min_age => '0',\r\n  shell            => '/bin/ksh',\r\n  uid              => '0',\r\n}\r\n{code}\r\nPS:","closed_at":"2019-07-16T05:47:19.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3021","labels":"aix;aix-parity;cli;help_wanted;maintenance;puppethack;type_and_provider;user","state":"Resolved","updated_at":"2019-07-16T05:47:19.000-0700","timestamp":1652286205.355669,"priority":"Normal","status_category":"Done","pull_request":6987},{"issue_id":"318074","title":"\"Failed to apply catalog: undefined method `each' for #<Puppet::Type::Cisco_tacacs_server:0x0000000206c7f8>\"","url":"https://tickets.puppetlabs.com/browse/PUP-9926","created_at":"2019-07-25T03:46:51.000-0700","number":"PUP-9926","body":"*Puppet Version:* 6.7.0\r\n*Puppet Server Version:* n/a\r\n*OS Name/Version:* n/a\r\n\r\nThe ciscopuppet acceptance tests fail on trivial catalogs with \"Error: Failed to apply catalog: undefined method `each' for #<Puppet::Type::Cisco_tacacs_server:0x0000000206c7f8>\", due to https://github.com/puppetlabs/puppet/commit/6c257fc7827989c2af2901f974666f0f23611153#diff-7f00f7dbc0f9bfecbaadfec966d0b8b1L2149 . Specifically, the change from {{[list]}} to {{Array(list)}} in the chunk linked.\r\n\r\nObserve the following pry example to show the issue:\r\n\r\n{code}\r\n[10] pry(main)> class Foo\r\n[10] pry(main)*   include Enumerable\r\n[10] pry(main)* end  \r\n=> Foo\r\n[11] pry(main)> Foo.new.to_a\r\nNoMethodError: undefined method `each' for #<Foo:0x000055b8c11be7c8>\r\nfrom (pry):13:in `to_a'\r\n[12] pry(main)> Array(Foo.new)\r\nNoMethodError: undefined method `each' for #<Foo:0x000055b8c1188308>\r\nfrom (pry):14:in `to_a'\r\n[13] pry(main)> [Foo.new]\r\n=> [#<Foo:0x000055b8c110dcc0>]\r\n[14] pry(main)> class Foo2\r\n[14] pry(main)* end  \r\n=> nil\r\n[15] pry(main)> Array(Foo2.new)\r\n=> [#<Foo2:0x000055b8c1065598>]\r\n[16] pry(main)> \r\n{code}\r\n\r\nThis can be traced back to https://github.com/puppetlabs/puppet/blob/0c34993f87f100f3bbbccfbb5b000a51094fce5e/lib/puppet/type.rb#L2276 without having a `each` method. This bug was introduced in 2005 (see my previous unrelated analysis of this in https://twitter.com/dev_el_ops/status/1141814653653311489?s=19).\r\n\r\n*Desired Behavior:*\r\n\r\nPuppet not failing on a ruby error.\r\n\r\n*Actual Behavior:*\r\n\r\nPuppet failing on a ruby error.\r\n\r\nFull stacktrace from https://jenkins-master-prod-1.delivery.puppetlabs.net/view/modules/view/networking/view/ciscopuppet/job/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/lastFailedBuild/PLATFORM=cisconx-64default.%257Bssh%253D%257Buser%253Dadmin%252Cpassword%253Dadmin%257D%257D,WORKER_LABEL=beaker/consoleFull :\r\n\r\n{code}\r\n00:06:07.170   * TestStep :: 1.1 Apply default manifest with 'default' as a string in attributes [ensure => present] :: MANIFEST    \r\n00:06:07.170     test_manifest :: manifest:\r\n00:06:07.171     0\r\n00:06:07.171     test_manifest :: check puppet apply cmd (code: [0, 2])\r\n00:06:07.171     \r\n00:06:16.260             cisco_tacacs_server      { 'default': ensure => present }\r\n00:06:16.260           \r\n00:06:16.260                                        cisco_aaa_authorization_login_cfg_svc { 'default':\r\n00:06:16.260                                    \r\n00:06:16.260         ensure                                   => 'present',\r\n00:06:16.260         groups                                   => 'default',\r\n00:06:16.260         method                                   => 'default',\r\n00:06:16.260     \r\n00:06:16.260                                  }\r\n00:06:16.260     Notice: Compiled catalog for sut in environment production in 0.12 seconds\r\n00:06:16.271     Info: Applying configuration version '1564016874'\r\n00:06:16.271     Error: Failed to apply catalog: undefined method `each' for #<Puppet::Type::Cisco_tacacs_server:0x0000000206c7f8>\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/type.rb:2190:in `to_a'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/type.rb:2190:in `Array'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/type.rb:2190:in `block in autorelation'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/type.rb:2127:in `block in eachautorequire'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/type.rb:2126:in `each'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/type.rb:2126:in `eachautorequire'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/type.rb:2183:in `autorelation'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/type.rb:2215:in `autorequire'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/graph/relationship_graph.rb:173:in `block (2 levels) in build_autorelation_dependencies'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/graph/relationship_graph.rb:172:in `each'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/graph/relationship_graph.rb:172:in `block in build_autorelation_dependencies'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/graph/relationship_graph.rb:171:in `each'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/graph/relationship_graph.rb:171:in `build_autorelation_dependencies'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/graph/relationship_graph.rb:25:in `populate_from'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/resource/catalog.rb:266:in `relationship_graph'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/transaction.rb:222:in `relationship_graph'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/transaction.rb:172:in `evaluate'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/resource/catalog.rb:240:in `block (2 levels) in apply'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/util.rb:521:in `block in thinmark'\r\n00:06:16.271     /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/2.3.0/benchmark.rb:308:in `realtime'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/util.rb:520:in `thinmark'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/resource/catalog.rb:239:in `block in apply'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/util/log.rb:161:in `with_destination'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/transaction/report.rb:146:in `as_logging_destination'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/resource/catalog.rb:238:in `apply'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/configurer.rb:194:in `block (2 levels) in apply_catalog'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/util.rb:521:in `block in thinmark'\r\n00:06:16.271     /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/2.3.0/benchmark.rb:308:in `realtime'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/util.rb:520:in `thinmark'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/configurer.rb:193:in `block in apply_catalog'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/util.rb:233:in `block in benchmark'\r\n00:06:16.271     /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/2.3.0/benchmark.rb:308:in `realtime'\r\n00:06:16.271     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/util.rb:232:in `benchmark'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/configurer.rb:192:in `apply_catalog'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/configurer.rb:381:in `run_internal'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/configurer.rb:242:in `block in run'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/context.rb:65:in `override'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet.rb:266:in `override'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/configurer.rb:219:in `run'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/application/apply.rb:343:in `apply_catalog'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/application/apply.rb:260:in `block (2 levels) in main'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/context.rb:65:in `override'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet.rb:266:in `override'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/application/apply.rb:243:in `block in main'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/context.rb:65:in `override'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet.rb:266:in `override'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/application/apply.rb:207:in `main'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/application/apply.rb:177:in `run_command'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/application/device.rb:340:in `block (4 levels) in main'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/context.rb:65:in `override'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet.rb:266:in `override'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/application/device.rb:339:in `block (3 levels) in main'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/context.rb:65:in `override'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet.rb:266:in `override'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/application/device.rb:261:in `block (2 levels) in main'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/application/device.rb:259:in `each'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/application/device.rb:259:in `collect'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/application/device.rb:259:in `block in main'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/context.rb:65:in `override'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet.rb:266:in `override'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/application/device.rb:244:in `main'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/application.rb:390:in `run_command'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/application.rb:382:in `block in run'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/util.rb:687:in `exit_on_fail'\r\n00:06:16.285     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/application.rb:382:in `run'\r\n00:06:16.298     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/util/command_line.rb:143:in `run'\r\n00:06:16.298     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/lib/puppet/util/command_line.rb:77:in `execute'\r\n00:06:16.298     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/puppet-6.7.0/bin/puppet:5:in `<top (required)>'\r\n00:06:16.298     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/bin/puppet:23:in `load'\r\n00:06:16.298     /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/bin/puppet:23:in `<top (required)>'\r\n00:06:16.298     /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/cli/exec.rb:74:in `load'\r\n00:06:16.298     /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/cli/exec.rb:74:in `kernel_load'\r\n00:06:16.298     /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/cli/exec.rb:28:in `run'\r\n00:06:16.298     /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/cli.rb:424:in `exec'\r\n00:06:16.298     /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/vendor/thor/lib/thor/command.rb:27:in `run'\r\n00:06:16.298     /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/vendor/thor/lib/thor/invocation.rb:126:in `invoke_command'\r\n00:06:16.298     /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/vendor/thor/lib/thor.rb:387:in `dispatch'\r\n00:06:16.298     /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/cli.rb:27:in `dispatch'\r\n00:06:16.298     /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/vendor/thor/lib/thor/base.rb:466:in `start'\r\n00:06:16.298     /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/cli.rb:18:in `start'\r\n00:06:16.298     /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/exe/bundle:30:in `block in <top (required)>'\r\n00:06:16.298     /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/friendly_errors.rb:124:in `with_friendly_errors'\r\n00:06:16.298     /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/exe/bundle:22:in `<top (required)>'\r\n00:06:16.298     /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/bin/bundle:23:in `load'\r\n00:06:16.298     /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/bin/bundle:23:in `<main>'\r\n00:06:16.298     /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/bin/ruby_executable_hooks:15:in `eval'\r\n00:06:16.298     /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/bin/ruby_executable_hooks:15:in `<main>'\r\n00:06:16.298 RuntimeError: Unexpected error while applying catalog\r\n00:06:16.298 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/tests/beaker_tests/lib/utilitylib.rb:388\r\n00:06:16.304 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/beaker-4.6.0/lib/beaker/dsl/structure.rb:44\r\n00:06:16.305 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/beaker-4.6.0/lib/beaker/logger.rb:239\r\n00:06:16.306 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/beaker-4.6.0/lib/beaker/dsl/structure.rb:43\r\n00:06:16.306 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/tests/beaker_tests/lib/utilitylib.rb:351\r\n00:06:16.307 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/tests/beaker_tests/lib/utilitylib.rb:311\r\n00:06:16.308 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/tests/beaker_tests/lib/utilitylib.rb:1022\r\n00:06:16.308 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/tests/beaker_tests/cisco_aaa_login_cfg_svc/test_cisco_aaa_login_cfg_svc.rb:177\r\n00:06:16.309 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/tests/beaker_tests/cisco_aaa_login_cfg_svc/test_cisco_aaa_login_cfg_svc.rb:173\r\n00:06:16.310 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/tests/beaker_tests/cisco_aaa_login_cfg_svc/test_cisco_aaa_login_cfg_svc.rb:173\r\n00:06:16.310 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/beaker-4.6.0/lib/beaker/dsl/structure.rb:124\r\n00:06:16.311 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/beaker-4.6.0/lib/beaker/logger.rb:239\r\n00:06:16.312 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/beaker-4.6.0/lib/beaker/dsl/structure.rb:123\r\n00:06:16.313 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/tests/beaker_tests/cisco_aaa_login_cfg_svc/test_cisco_aaa_login_cfg_svc.rb:169\r\n00:06:16.313 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/beaker-4.6.0/lib/beaker/test_case.rb:133\r\n00:06:16.314 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/beaker-4.6.0/lib/beaker/test_case.rb:133\r\n00:06:16.315 /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/2.3.0/benchmark.rb:308\r\n00:06:16.315 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/beaker-4.6.0/lib/beaker/test_case.rb:130\r\n00:06:16.316 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/beaker-4.6.0/lib/beaker/test_suite.rb:66\r\n00:06:16.316 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/beaker-4.6.0/lib/beaker/test_suite.rb:63\r\n00:06:16.317 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/beaker-4.6.0/lib/beaker/test_suite.rb:63\r\n00:06:16.318 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/beaker-4.6.0/lib/beaker/test_suite.rb:115\r\n00:06:16.319 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/beaker-4.6.0/lib/beaker/cli.rb:192\r\n00:06:16.319 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/beaker-4.6.0/lib/beaker/cli.rb:118\r\n00:06:16.320 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/gems/beaker-4.6.0/bin/beaker:9\r\n00:06:16.321 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/bin/beaker:23\r\n00:06:16.321 /tmp/jenkins/workspace/forge-netdev_cisco-ciscopuppet_intn-sys_smoke-develop/PLATFORM/cisconx-64default.%7Bssh%3D%7Buser%3Dadmin%2Cpassword%3Dadmin%7D%7D/WORKER_LABEL/beaker/.bundle/gems/bin/beaker:23\r\n00:06:16.322 /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/cli/exec.rb:74\r\n00:06:16.323 /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/cli/exec.rb:74\r\n00:06:16.323 /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/cli/exec.rb:28\r\n00:06:16.323 /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/cli.rb:424\r\n00:06:16.324 /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/vendor/thor/lib/thor/command.rb:27\r\n00:06:16.325 /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/vendor/thor/lib/thor/invocation.rb:126\r\n00:06:16.325 /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/vendor/thor/lib/thor.rb:387\r\n00:06:16.325 /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/cli.rb:27\r\n00:06:16.326 /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/vendor/thor/lib/thor/base.rb:466\r\n00:06:16.327 /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/cli.rb:18\r\n00:06:16.327 /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/exe/bundle:30\r\n00:06:16.327 /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/lib/bundler/friendly_errors.rb:124\r\n00:06:16.327 /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/gems/bundler-1.16.5/exe/bundle:22\r\n00:06:16.327 /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/bin/bundle:23\r\n00:06:16.327 /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/bin/bundle:23\r\n00:06:16.327 /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/bin/ruby_executable_hooks:15\r\n00:06:16.327 /usr/local/rvm/rubies/ruby-2.3.1/lib/ruby/gems/2.3.0/bin/ruby_executable_hooks:15\r\n00:06:16.327 Begin teardown\r\n00:06:16.327 \r\n00:06:16.327 * \r\n00:06:16.327 --------\r\n00:06:16.327  * TestStep :: absent clean\r\n00:06:16.327 no feature tacacs+\r\n00:06:21.430 End teardown\r\n00:06:21.465 Warning: tests/beaker_tests/cisco_aaa_login_cfg_svc/test_cisco_aaa_login_cfg_svc.rb errored in 26.54 seconds\r\n{code}\r\n","closed_at":"2019-07-25T17:34:24.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9926","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-07-25T17:34:24.000-0700","timestamp":1652286218.513108,"priority":"Normal","status_category":"Done","pull_request":7638},{"issue_id":"317861","title":"v6.7.0 Breaks camptocamp-postfix","url":"https://tickets.puppetlabs.com/browse/PUP-9914","created_at":"2019-07-23T17:41:31.000-0700","number":"PUP-9914","body":"The new version (v6.7.0) of the puppet-agent has introduced a regression that has broken our MTA (Postfix), based on the camptocamp-postfix module.\r\n \r\nSteps to reproduce on Ubuntu 18.04 LTS:\r\n```\r\nwget https://apt.puppetlabs.com/puppet6-release-bionic.deb\r\ndpkg -i puppet6-release-bionic.deb\r\napt update;apt install -y puppet-agent\r\npuppet module install camptocamp-postfix --version 1.8.0\r\npuppet apply -e 'include ::postfix'\r\n```\r\nOutput: Error: Could not prefetch mailalias provider 'aliases': Could not parse line \"postmaster:    root\" (file: /etc/aliases, line: 3)\r\nError: Failed to apply catalog: Could not parse line \"postmaster:    root\" (file: /etc/aliases, line: 3)","closed_at":"2019-08-06T11:31:54.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9914","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-08-06T11:31:54.000-0700","timestamp":1652286219.681807,"priority":"Critical","status_category":"Done","pull_request":7632},{"issue_id":"68130","title":"Add support for no_proxy env var","url":"https://tickets.puppetlabs.com/browse/PUP-4030","created_at":"2015-02-16T15:29:58.000-0800","number":"PUP-4030","body":"Puppet::Util::HttpProxy returns a proxy object to use for interacting with the forge in the case that http_proxy is set.  However, it does not take into account the no_proxy variable meaning that it will always use the proxy even if no_proxy would have it go direct.","closed_at":"2019-08-07T15:06:28.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4030","labels":"","state":"Closed","updated_at":"2019-08-07T15:06:28.000-0700","timestamp":1652286220.798482,"priority":"Normal","status_category":"Done","pull_request":3896},{"issue_id":"173751","title":"The yaml_data function used by lookup should return empty hash for empty yaml files","url":"https://tickets.puppetlabs.com/browse/PUP-7164","created_at":"2017-02-02T05:41:27.000-0800","number":"PUP-7164","body":"Since upgrading to 4.9.0 my Puppet installation is throwing errors up about {{lookup_options}} not being found in Hiera.\r\n\r\nFull error:\r\n\r\n{noformat}\r\nInfo: Using configured environment 'ci'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nError: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Resource Statement, Lookup of key 'lookup_options' failed: Value returned from Hierarchy entry \"yaml\" has wrong type, expects a Hash value, got Boolean in Value returned from Hierarchy entry \"yaml\" has wrong type, expects a Hash value, got Boolean at /etc/puppetlabs/code/modules/klxnginx/manifests/init.pp:4:3 on node klx-ci\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\n{noformat}\r\n\r\nLine 4 of {{klxnginx/manifests/init.pp}} is as follows:\r\n\r\n{noformat}\r\nclass { 'nginx' : }\r\n{noformat}\r\n\r\nwhich references the [Puppet NGINX|https://forge.puppet.com/puppet/nginx/changelog] module","closed_at":"2019-08-13T14:41:33.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7164","labels":"","state":"Closed","updated_at":"2019-08-13T14:41:33.000-0700","timestamp":1652286222.398245,"priority":"Normal","status_category":"Done","pull_request":5604},{"issue_id":"319404","title":"Change $deviceconfdir section to agent","url":"https://tickets.puppetlabs.com/browse/PUP-9936","created_at":"2019-08-02T03:00:03.000-0700","number":"PUP-9936","body":"Setting {{$deviceconfdir}} in the main section makes puppetserver want to create it, which it shouldn't.\r\n\r\nStarting puppetserver with an affected agent fails because of this:\r\n\r\n{noformat}\r\nAug 02 08:57:43 lnfb7hk8n03wnpk systemd[1]: Starting puppetserver Service...\r\nAug 02 08:58:01 lnfb7hk8n03wnpk puppetserver[17006]: RuntimeError: Got 1 failure(s) while initializing: File[/etc/puppetlabs/puppet/devices]: change from 'absent' to 'directory' failed: Could not set 'directory' on ensure: Permission denied - /etc/puppetlabs/puppet/devices\r\nAug 02 08:58:01 lnfb7hk8n03wnpk puppetserver[17006]: block in use at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/settings.rb:1026\r\nAug 02 08:58:01 lnfb7hk8n03wnpk puppetserver[17006]: apply at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:249\r\nAug 02 08:58:01 lnfb7hk8n03wnpk puppetserver[17006]: use at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/settings.rb:1016\r\nAug 02 08:58:01 lnfb7hk8n03wnpk puppetserver[17006]: initialize_puppet at uri:classloader:/puppetserver-lib/puppet/server/puppet_config.rb:45\r\nAug 02 08:58:01 lnfb7hk8n03wnpk puppetserver[17006]: initialize at uri:classloader:/puppetserver-lib/puppet/server/master.rb:32\r\nAug 02 08:58:02 lnfb7hk8n03wnpk puppetserver[17006]: Execution error (RuntimeError) at RUBY/block in use (/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/settings.rb:1026).\r\nAug 02 08:58:02 lnfb7hk8n03wnpk puppetserver[17006]: (RuntimeError) Got 1 failure(s) while initializing: File[/etc/puppetlabs/puppet/devices]: change from 'absent' to 'directory' failed: Could not set 'directory' on ensure: Permission denied - /etc/puppetlabs/puppet/devices\r\n{noformat}\r\n\r\nChanging the section of {{$deviceconfdir}} to {{agent}} fixes the issue.","closed_at":"2019-08-14T02:05:19.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9936","labels":"","state":"Resolved","updated_at":"2019-08-14T02:05:19.000-0700","timestamp":1652286222.503923,"priority":"Normal","status_category":"Done","pull_request":7651},{"issue_id":"318146","title":"PKey.read monkey patch is incompatible with JRuby 9.1","url":"https://tickets.puppetlabs.com/browse/PUP-9927","created_at":"2019-07-25T15:04:18.000-0700","number":"PUP-9927","body":"Puppetserver 6.0 uses JRuby 9.1 which is compatible (sort of) with MRI 2.3. However, that version of JRuby doesn't implement \\{{OpenSSL::PKey.read}} so our monkey patch in puppet fails:\r\n\r\n{noformat}\r\n$ ruby --version\r\njruby 9.1.17.0 (2.3.3) 2018-04-20 d8b1ff9 Java HotSpot(TM) 64-Bit Server VM 25.162-b12 on 1.8.0_162-b12 +jit [darwin-x86_64]\r\n$ git rev-parse HEAD\r\nf292c7ebcfd2b5e0f6696c40ae4f66ed7c053947\r\n$ bx rake parallel;spec\r\nrake aborted!\r\nNameError: undefined method `read' for module `OpenSSL::PKey'\r\n/Users/josh/work/puppet/lib/puppet/util/monkey_patches.rb:104:in `<module:PKey>'\r\n/Users/josh/work/puppet/lib/puppet/util/monkey_patches.rb:103:in `<main>'\r\n/Users/josh/work/puppet/lib/puppet/util.rb:1:in `<module:(root)>'\r\n/Users/josh/work/puppet/lib/puppet/util.rb:17:in `<module:Util>'\r\n/Users/josh/work/puppet/lib/puppet/util.rb:16:in `<main>'\r\n...\r\n{noformat}","closed_at":"2019-08-19T11:07:51.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9927","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-08-19T11:07:51.000-0700","timestamp":1652286223.151479,"priority":"Normal","status_category":"Done","pull_request":7639},{"issue_id":"315541","title":"puppet parser validate version 6.6.0 does not accept STDIN properly","url":"https://tickets.puppetlabs.com/browse/PUP-9816","created_at":"2019-07-08T13:45:02.000-0700","number":"PUP-9816","body":"*Puppet Version: 6.6.0 and 6.5.0*\r\n *Puppet Server Version: N/A*\r\n *OS Name/Version: Ubuntu 19.04 using bionic packages 6.6.0-1bionic*\r\n\r\nPassing code over stdin to puppet parser fails with 'Error: undefined method `message' for nil:NilClass'. I was able to reproduce with 6.5.0 and 6.6.0, but not with 6.4.2\r\n\r\n*Desired Behavior:*\r\n\r\nValidation of code using filename or stdin should be identical\r\n\r\n*Actual Behavior:*\r\n\r\n> touch foo.pp\r\n> puppet parser validate foo.pp\r\n> cat foo.pp | puppet parser validate\r\nError: undefined method `message' for nil:NilClass\r\nError: Try 'puppet help parser validate' for usage\r\n\r\nI noticed this because emacs flycheck uses stdin to do syntax checking.\r\n\r\nNote that the documentation (man puppet parser) states that this is a valid way to submit output:\r\n\r\nEXAMPLES\r\n\r\n \r\n\r\nValidate from STDIN:\r\n\r\n$ cat init.pp | puppet parser validate","closed_at":"2019-08-19T15:39:03.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9816","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-08-19T15:39:03.000-0700","timestamp":1652286223.47314,"priority":"Minor","status_category":"Done","pull_request":7611},{"issue_id":"31264","title":"Package resource not working as expected in 3.5.0","url":"https://tickets.puppetlabs.com/browse/PUP-2182","created_at":"2014-04-08T13:04:38.000-0700","number":"PUP-2182","body":"One of my modules has the following code:\r\n\r\n{code}\r\npackage { 'inetd': ensure => absent; }\r\n{code}\r\n\r\nOn the next Puppet run, Puppet tries to remove the xinetd package (debug output):\r\n{code}\r\nDebug: Executing '/bin/rpm -q inetd --nosignature --nodigest --qf %{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\\n'\r\nDebug: Executing '/bin/rpm -q inetd --nosignature --nodigest --qf %{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\\n --whatprovides'\r\nDebug: Executing '/bin/rpm -e xinetd-2.3.14-39.el6_4.x86_64'\r\nError: Execution of '/bin/rpm -e xinetd-2.3.14-39.el6_4.x86_64' returned 1: error: Failed dependencies:\r\n        xinetd is needed by (installed) tftp-server-0.49-7.el6.x86_64\r\nError: /Stage[main]/Services/Package[inetd]/ensure: change from 2.3.14-39.el6_4 to absent failed: Execution of '/bin/rpm -e xinetd-2.3.14-39.el6_4.x86_64' returned 1: error: Failed dependencies:\r\n        xinetd is needed by (installed) tftp-server-0.49-7.el6.x86_64\r\n{code}\r\n\r\nI've also noticed this problem with the JRE package.  Our local yum repo has many versions of java.  One of these packages has the %{NAME} 'jre' (downloaded from oracle's site directly) which is what we used to create the package resource.  However it's substituting other java packages that provide 'jre' and installing those packages instead.  In fact, if there's a package that provides 'jre' already installed on your system puppet won't install the package named jre!","closed_at":"2019-08-23T13:47:51.000-0700","comments":38,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2182","labels":"","state":"Closed","updated_at":"2019-08-23T13:47:51.000-0700","timestamp":1652286224.424906,"priority":"Major","status_category":"Done","pull_request":2654},{"issue_id":"322201","title":"Regression: Unable to install g++ package using dpkg provider","url":"https://tickets.puppetlabs.com/browse/PUP-9975","created_at":"2019-08-24T12:48:21.000-0700","number":"PUP-9975","body":"*Puppet Version: 6.8.0*\r\n *Puppet Server Version: NA*\r\n *OS Name/Version: Ubuntu 16.04 and Ubuntu 18.04*\r\n\r\n*Desired Behavior:*\r\n\r\nInstall \"g++\" package using dpkg provider\r\n\r\n*Actual Behavior:*\r\n\r\nI get this message:\r\n\r\n \r\n{noformat}Info: Package g++ is virtual, defaulting to binutils\r\n{noformat}\r\nIf I do simple \"apt-get install g++\", that works fine but unable to do that with changes made to dpkg provider in 6.8.0. I think the \"++\" sign is breaking the parsing added here:\r\n\r\n \r\n\r\n[https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/package/dpkg.rb#L126]\r\n\r\n \r\n\r\nThe issue was introduced in PUP-9824 I think. If I run the dpkg command being used the first line that contains a \"g\" is \"binutils\" so I think what's getting matched is just \"g\" and not \"g++\".\r\n\r\n \r\n\r\nReproduce:\r\n\r\nInstall Puppet on Ubuntu 16.04 or Ubuntu 18.04 and try to install g++\r\n\r\n \r\n{noformat}puppet resource package g++ ensure=installed\r\n{noformat}\r\n \r\n\r\n ","closed_at":"2019-08-27T15:47:34.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9975","labels":"","state":"Resolved","updated_at":"2019-08-27T15:47:34.000-0700","timestamp":1652286224.965437,"priority":"Major","status_category":"Done","pull_request":7683},{"issue_id":"322106","title":"Regression: allow_virtual => true matches too much for dpkg provider","url":"https://tickets.puppetlabs.com/browse/PUP-9974","created_at":"2019-08-23T08:18:54.000-0700","number":"PUP-9974","body":"*Puppet Version:* 6.8.0\r\n*Puppet Server Version:* 6.5.0\r\n*OS Name/Version:* Debian buster (10.x)\r\n\r\nSince the change of allow_virtual to true in Puppet 6.8.0 some of our package resources behaved strangely and required to change the parameter back to the old default. At first we thought this only affected packages where the name and a provides value are identical (e.g. a resource to uninstall vim and install vim-nox now tried to unistall vim-nox since it also provides vim).\r\n\r\nAfter installing a new server with the new Puppet version we noticed that the package bc had not been installed. It is defined with the simplest of package resources:\r\n\r\n{code:Manifest}\r\npackage { 'bc':\r\n    ensure => latest\r\n}\r\n{code}\r\n\r\nLooking at the provider source code we can see the relevant part here\r\n\r\n{code:title=dpkg.rb}\r\n      if @resource.allow_virtual?\r\n        output = dpkgquery(\r\n          \"-W\",\r\n          \"--showformat\",\r\n          self.class::DPKG_QUERY_PROVIDES_FORMAT_STRING\r\n        ).lines.find {|package| package.match(/\\[.*#{@resource[:name]}.*\\]/)}\r\n        if output          \r\n          hash = self.class.parse_line(output,self.class::FIELDS_REGEX_WITH_PROVIDES)\r\n          Puppet.info(\"Package #{@resource[:name]} is virtual, defaulting to #{hash[:name]}\")\r\n          @resource[:name] = hash[:name]\r\n        end\r\n      end\r\n{code}\r\n\r\nwith the constant used being defined further up in the file as\r\n\r\n{code:title=dpkg.rb}\r\n  self::DPKG_QUERY_PROVIDES_FORMAT_STRING = %Q{'${Status} ${Package} ${Version} [${Provides}]\\\\n'}\r\n{code}\r\n\r\nRunning the command\r\n\r\n{code:shell}\r\ndpkg-query -W --showformat '${Status} ${Package} ${Version} [${Provides}]\\n\"'\r\n{code}\r\n\r\non the affected system we can see the output the provider processes in the above code, a line might look like one of these\r\n\r\n{code}\r\n\"install ok installed php-apcu-bc 1.0.4-4 [php7.3-apcu-bc]\r\n\"install ok installed php7.3-bcmath 7.3.4-2 [php-bcmath]\r\n\"install ok installed php7.3-odbc 7.3.4-2 [php-odbc, php-pdo-odbc, php7.3-pdo-odbc]\r\n{code}\r\n\r\nIt is easy to see that all of these would also match the package resource named bc since the code just matches .*name.* within the comma-separated list of dpkg provides values, with no concern for matching a full name.\r\n\r\n*Desired Behavior:*\r\n\r\nVirtual packages (provides values) should only match exactly. The default for allow_virtual should be false for at least the apt and dpkg provider since there are many packages in the apt repositories that have identical names and provides values which leads to broken systems when puppet starts uninstalling packages on ensure => absent.\r\n\r\n*Actual Behavior:*\r\n\r\nPackage resources are currently satisfied that they have found a matching package when they find the resource name as a substring in the list of provides values anywhere.\r\n\r\n","closed_at":"2019-08-27T15:47:50.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9974","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-08-27T15:47:50.000-0700","timestamp":1652286225.073103,"priority":"Major","status_category":"Done","pull_request":7684},{"issue_id":"161235","title":"Puppet::Util::Windows::Process.execute should accept a working directory","url":"https://tickets.puppetlabs.com/browse/PUP-6919","created_at":"2016-11-15T22:51:41.000-0800","number":"PUP-6919","body":"{{Puppet::Util::Execution.execute}} should take in a `cwd` option that lets the user specify the new process' working directory.","closed_at":"2019-09-04T16:28:08.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6919","labels":"package;type_and_provider;windows","state":"Closed","updated_at":"2019-09-04T16:28:08.000-0700","timestamp":1652286226.347581,"priority":"Normal","status_category":"Done","pull_request":7098},{"issue_id":"315304","title":"Performance of unpacking modules is extremely slow","url":"https://tickets.puppetlabs.com/browse/PUP-9813","created_at":"2019-07-03T15:53:20.000-0700","number":"PUP-9813","body":"*Puppet Version: any*\r\n *Puppet Server Version: any*\r\n *OS Name/Version: any*\r\n\r\nInstalling modules from Puppet Forge is extremely slow. I have found a culprit. It is a\r\n\r\n{{Puppet::ModuleTool::Tar::Mini}}\r\n\r\nimplementation.\r\n\r\nThe unpack is *100x times* slower then executing a {{tar xzvf}} system command!\r\n\r\n*Steps to reproduce:*\r\n\r\nInstall a module from Puppet Forge and measure a time:\r\n\r\n{{time puppet module install puppetlabs-stdlib --version 4.25.1}}\r\n\r\nThen execute:\r\n\r\n{{time bash -c 'curl [https://forge.puppet.com/v3/files/puppetlabs-stdlib-4.25.1.tar.gz] -o puppetlabs-stdlib-4.25.1.tar.gz && tar xzvf puppetlabs-stdlib-4.25.1.tar.gz'}}\r\n\r\n*Desired Behavior:*\r\n\r\nExtraction of downloaded modules should be about the same performance as system tar xzvf command. It might be at most 2x times slower then system command, but preferably should be about the same.\r\n\r\n*Temporal solution:*\r\n\r\nTo install modules faster i propose to switch to Gnu implementation as a first choice. Al least until Minitar can be much faster.","closed_at":"2019-09-10T21:10:28.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9813","labels":"","state":"Closed","updated_at":"2019-09-10T21:10:28.000-0700","timestamp":1652286226.775015,"priority":"Normal","status_category":"Done","pull_request":7602},{"issue_id":"320046","title":"no_proxy environment variable does not work","url":"https://tickets.puppetlabs.com/browse/PUP-9942","created_at":"2019-08-07T15:05:26.000-0700","number":"PUP-9942","body":"Commit 90560edf0f43f5382bd539646988f7a96ea3809e for PUP-4030 added the ability to skip an http proxy if the host and port matched an entry in the {{NO_PROXY}} environment variable. However it didn't actually work because our connection factory passed the {{Site}} object instead of a String or URI. To reproduce specify an unused http proxy port and try to not use a proxy for the puppet server:\r\n\r\n{noformat}\r\n$ env NO_PROXY=$(bundle exec puppet config print server --section main) bundle exec puppet agent -t --http_proxy_host localhost --http_proxy_port 12345\r\nWarning: Unable to fetch my node definition, but the agent run will continue:\r\nWarning: Failed to open TCP connection to localhost:12345 (Connection refused - connect(2) for \"localhost\" port 12345)\r\nInfo: Retrieving pluginfacts\r\nError: /File[/Users/josh/.puppetlabs/opt/puppet/cache/facts.d]: Failed to generate additional resources using 'eval_generate': Failed to open TCP connection to localhost:12345 (Connection refused - connect(2) for \"localhost\" port 12345)\r\nError: /File[/Users/josh/.puppetlabs/opt/puppet/cache/facts.d]: Could not evaluate: Could not retrieve file metadata for puppet:///pluginfacts: Failed to open TCP connection to localhost:12345 (Connection refused - connect(2) for \"localhost\" port 12345)\r\n...\r\n{noformat}\r\n\r\n ","closed_at":"2019-09-16T11:57:53.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9942","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-09-16T11:57:53.000-0700","timestamp":1652286227.95993,"priority":"Normal","status_category":"Done","pull_request":7660},{"issue_id":"77763","title":"Puppet's http connection factory doesn't support authenticating proxies","url":"https://tickets.puppetlabs.com/browse/PUP-4470","created_at":"2015-04-28T11:52:36.000-0700","number":"PUP-4470","body":"Work for ticket PUP-4030 uncovered that puppet's http connection code does not support authenticating proxies (that require a username and password). Note there are {{http_proxy_user}} and {{http_proxy_password}} settings, but they are only used with the PMT and some providers.\r\n\r\nPuppet connection handling should be refactored to use Puppet::Util::HttpProxy class.","closed_at":"2019-09-16T11:58:37.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4470","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-09-16T11:58:37.000-0700","timestamp":1652286228.176101,"priority":"Normal","status_category":"Done","pull_request":7663},{"issue_id":"31144","title":"Don't use an http proxy when connecting to localhost","url":"https://tickets.puppetlabs.com/browse/PUP-2172","created_at":"2014-04-07T10:58:36.000-0700","number":"PUP-2172","body":"We had a PE site which had set the http_proxy_\\{port,host\\} settings for PMT usage, which had the unintended consequence that all puppet master http connections went through the proxy, including those to the dashboard for node lookups. When something (not yet identified) changed in the network/proxy configuration, these lookups failed causing all agent runs to fail.\r\n\r\nThis raises the question about whether it *ever* makes sense for the master to use a proxy for connections to localhost.\r\n\r\nWe've considered two approaches here:\r\n1) add a new setting for http proxy exclusions. This could be set to, e.g. {{localhost;*.internal.lan}}, etc.\r\n2) never using the proxy settings when talking to localhost\r\n\r\nThere may be some other approaches that would work as well.","closed_at":"2019-09-16T11:58:45.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2172","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-09-16T11:58:45.000-0700","timestamp":1652286228.285744,"priority":"Normal","status_category":"Done","pull_request":7662},{"issue_id":"320444","title":"Exec logs output of Sensitive unless and onlyif checks at debug","url":"https://tickets.puppetlabs.com/browse/PUP-9956","created_at":"2019-08-09T14:24:39.000-0700","number":"PUP-9956","body":"*Puppet Version:* 6.7.2\r\n *Puppet Server Version:* N/A\r\n *OS Name/Version:* macOS 10.14, Ubuntu 18.10\r\n\r\nI have been working on implementing support for Sensitive in a module that contains many execs. When I use Sensitive in the command parameter it redacts the command and does not show any command output in debug mode. However, when I use Sensitive in the unless or onlyif parameters it redacts the command and logs the output at debug.\r\n\r\nThis is problematic for me because some of the commands being used in the unless statements are leaking passwords into reports when running in debug.\r\n\r\nI would expect that if I mark a command as Sensitive that I wouldn't get logged output from the command as it would have a higher likelihood of containing sensitive information.\r\n\r\nThe following manifest can reproduce the issue:\r\n{code:puppet}# test.pp\r\nexec { 'Sensitive command':\r\n  command => Sensitive('/bin/echo \"secret0\"'),\r\n}\r\n\r\nexec { 'Sensitive unless':\r\n  command => '/bin/echo Pass',\r\n  unless  => Sensitive('/bin/echo \"secret1\"'),\r\n}\r\n\r\nexec { 'Sensitive onlyif':\r\n  command => '/bin/echo Pass',\r\n  onlyif  => Sensitive('/bin/echo \"secret2'),\r\n}\r\n{code}\r\n \r\n\r\nWhen I run puppet apply test.pp --debug I get the following output:\r\n{noformat}puppet apply test.pp --debug\r\nDebug: Runtime environment: puppet_version=6.7.2, ruby_version=2.4.5, run_mode=user, default_encoding=UTF-8\r\n...\r\nInfo: Applying configuration version '1565384722'\r\nDebug: Exec[Sensitive command](provider=posix): Executing '[redacted]'\r\nDebug: Executing: '[redacted]'\r\nNotice: /Stage[main]/Main/Exec[Sensitive command]/returns: executed successfully\r\nDebug: /Stage[main]/Main/Exec[Sensitive command]: The container Class[Main] will propagate my refresh event\r\nDebug: Exec[Sensitive unless](provider=posix): Executing check '[redacted]'\r\nDebug: Executing: '[redacted]'\r\nDebug: /Stage[main]/Main/Exec[Sensitive unless]/unless: secret1\r\nDebug: /Stage[main]/Main/Exec[Sensitive unless]: '[command redacted]' won't be executed because of failed check 'unless'\r\nDebug: Exec[Sensitive onlyif](provider=posix): Executing check '[redacted]'\r\nDebug: Executing: '[redacted]'\r\nDebug: /Stage[main]/Main/Exec[Sensitive onlyif]/onlyif: secret2\r\nDebug: Exec[Sensitive onlyif](provider=posix): Executing '[redacted]'\r\nDebug: Executing: '[redacted]'\r\nNotice: /Stage[main]/Main/Exec[Sensitive onlyif]/returns: executed successfully\r\nDebug: /Stage[main]/Main/Exec[Sensitive onlyif]: The container Class[Main] will propagate my refresh event\r\nDebug: Class[Main]: The container Stage[main] will propagate my refresh event\r\nDebug: Finishing transaction 70240057109900\r\nDebug: Storing state\r\nDebug: Pruned old state cache entries in 0.00 seconds\r\nDebug: Stored state in 0.01 seconds\r\nNotice: Applied catalog in 0.07 seconds\r\n{noformat}\r\nIt's a bit verbose, but you can see secret1 and secret2 leaked above on the following lines:\r\n{noformat}Debug: /Stage[main]/Main/Exec[Sensitive unless]/unless: secret1\r\nDebug: /Stage[main]/Main/Exec[Sensitive onlyif]/onlyif: secret2\r\n{noformat}\r\nIt's worth noting that logoutput does not affect this particular behavior:\r\n{noformat}# logoutput.pp\r\nexec { 'Sensitive unless':\r\n  command => '/bin/true',\r\n  logoutput  => false,\r\n  unless => Sensitive('/bin/echo secret1')\r\n}\r\n\r\npuppet apply --debug logoutput.pp\r\n...\r\nInfo: Applying configuration version '1565385531'\r\nDebug: Exec[Sensitive unless](provider=posix): Executing check '[redacted]'\r\nDebug: Executing: '[redacted]'\r\nDebug: /Stage[main]/Main/Exec[Sensitive unless]/unless: secret1\r\nDebug: /Stage[main]/Main/Exec[Sensitive unless]: '[command redacted]' won't be executed because of failed check 'unless'\r\nDebug: Finishing transaction 70187444945900\r\nDebug: Storing state\r\nDebug: Pruned old state cache entries in 0.00 seconds\r\nDebug: Stored state in 0.01 seconds\r\nNotice: Applied catalog in 0.02 seconds\r\n{noformat}\r\n*Desired Behavior:* When I run code in debug that contains an exec with Sensitive unless/onlyif commands the output of that command should be redacted or not logged.\r\n\r\n*Actual Behavior:* Sensitive unless/onlyif checks log their output at debug.\r\n\r\nSome minor digging shows the following code in the check methods for unless (in lib/puppet/type/exec.rb):\r\n{code:ruby}      # Return true if the command does not return 0.\r\n      def check(value)\r\n        begin\r\n          output, status = provider.run(value, true)\r\n        rescue Timeout::Error\r\n          err _(\"Check %{value} exceeded timeout\") % { value: value.inspect }\r\n          return false\r\n        end\r\n\r\n        output.split(/\\n/).each { |line|\r\n          self.debug(line)\r\n        }\r\n\r\n        status.exitstatus != 0\r\n      end\r\n    end\r\n{code}\r\nThe code for onlyif is quite similar. I suspect that this is the code responsible for logging the output in debug mode. A quick git blame shows that the output.split blocks in those methods haven't been touched in a long time and probably got missed in previous passes for Sensitive.","closed_at":"2019-09-16T12:19:58.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9956","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-09-16T12:19:58.000-0700","timestamp":1652286228.393972,"priority":"Normal","status_category":"Done","pull_request":7691},{"issue_id":"245716","title":"puppet plugin download doesn't re-use HTTP connections","url":"https://tickets.puppetlabs.com/browse/PUP-8662","created_at":"2018-04-13T17:33:38.000-0700","number":"PUP-8662","body":"The {{puppet plugin download}} command doesn't re-use connections to the\r\nPuppet Server when downloading plugins from modules. This adds considerable time to\r\ndownloads along with extra load on the Puppet Server due to multiple redundant TLS handshakes.\r\n\r\nh2. Reproduction Case\r\n\r\n  - Install {{puppet-agent}} 5.5.0 and {{puppetserver}} 5.3.0 on a CentOS 7\r\n    node:\r\n\r\n{code:bash}\r\nrpm -Uvh http://yum.puppetlabs.com/puppet5/puppet5-release-el-7.noarch.rpm\r\nyum install -y puppet-agent-5.5.0 puppetserver-5.3.0\r\n{code}\r\n\r\n  - Configure the puppet agent to connect to the local host and start\r\n    puppetserver:\r\n\r\n{code:bash}\r\n/opt/puppetlabs/bin/puppet config set --section main server $(hostname -f)\r\nsystemctl start puppetserver\r\n{code}\r\n\r\n\r\n  - Run {{puppet agent -t}} to verify things work.\r\n\r\n  - Install the {{puppetlabs-windows}} module, which brings in a ton of\r\n    plugins that will have to be synced:\r\n\r\n{code:bash}\r\n/opt/puppetlabs/bin/puppet module install puppetlabs-windows\r\n{code}\r\n\r\n  - Empty the plugin cache, and time a puppet agent run along with the\r\n    number of network connections it opens:\r\n\r\n{code:bash}\r\nrm -rf /opt/puppetlabs/puppet/cache/lib\r\ntime /opt/puppetlabs/bin/puppet agent -t --http_debug 2>&1|grep -e Info: -e 'opening connection'\r\n{code}\r\n\r\n  - Empty the cache again and time a puppet plugin download run along\r\n    with the number of network connections opened:\r\n\r\n{code:bash}\r\nrm -rf /opt/puppetlabs/puppet/cache/lib\r\ntime /opt/puppetlabs/bin/puppet plugin download --verbose --http_debug 2>&1|grep -e Info: -e 'opening connection'\r\n{code}\r\n\r\n\r\n\r\nh3. Outcome\r\n\r\nThe puppet agent run uses a handful of connections:\r\n\r\n{noformat}\r\n# rm -rf /opt/puppetlabs/puppet/cache/lib\r\n# time /opt/puppetlabs/bin/puppet agent -t --http_debug 2>&1|grep -e Info: -e 'opening connection'\r\n\r\nopening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nopening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...\r\nInfo: Retrieving locales\r\nInfo: Loading facts\r\nInfo: Caching catalog for wzwhytp204ipraf.delivery.puppetlabs.net\r\nInfo: Applying configuration version '1523665266'\r\n\r\nreal\t0m43.990s\r\nuser\t0m16.685s\r\nsys\t0m1.497s\r\n{noformat}\r\n\r\nThe puppet plugin download run uses hundreds of connections and takes much\r\nlonger than the puppet agent run despite only doing a subset of the work:\r\n\r\n{noformat}\r\n# rm -rf /opt/puppetlabs/puppet/cache/lib\r\n# time /opt/puppetlabs/bin/puppet plugin download --verbose --http_debug 2>&1|grep -e Info: -e 'opening connection'\r\n\r\nInfo: Retrieving pluginfacts\r\nopening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...\r\nInfo: Retrieving plugin\r\nopening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...\r\nopening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...\r\nopening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...\r\n... omitted hundreds of open calls for brevity ...\r\nopening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...\r\nopening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...\r\nopening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...\r\nopening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...\r\nInfo: Retrieving locales\r\nopening connection to wzwhytp204ipraf.delivery.puppetlabs.net:8140...\r\n\r\nreal  3m39.345s\r\nuser  1m29.576s\r\nsys 0m2.405s\r\n{noformat}\r\n\r\nh3. Expected Outcome\r\n\r\nThe {{puppet plugin download}} action should complete much faster than\r\n{{puppet agent -t}} when populating a cold plugin cache.","closed_at":"2019-09-16T13:13:57.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8662","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-09-16T13:13:57.000-0700","timestamp":1652286228.503089,"priority":"Major","status_category":"Done","pull_request":7671},{"issue_id":"95553","title":"Puppet::Resource::Catalog::Compiler#set_server_facts always produces a warning on ipv6 only systems","url":"https://tickets.puppetlabs.com/browse/PUP-5109","created_at":"2015-08-29T04:34:40.000-0700","number":"PUP-5109","body":"When compiling a catalogue for an IPv6-only system such as\r\n{code}\r\nigalic@mydb02 ~> ip a\r\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default \r\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\r\n    inet 127.0.0.1/8 scope host lo\r\n       valid_lft forever preferred_lft forever\r\n    inet6 ::1/128 scope host \r\n       valid_lft forever preferred_lft forever\r\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\r\n    link/ether 52:54:00:ba:b8:17 brd ff:ff:ff:ff:ff:ff\r\n    inet6 2a01:4f8:211:9d6::14/64 scope global \r\n       valid_lft forever preferred_lft forever\r\n    inet6 fe80::5054:ff:feba:b817/64 scope link \r\n       valid_lft forever preferred_lft forever\r\nigalic@mydb02 ~>\r\n{code}\r\n\r\npuppet will throw the warning: {{Warning: Could not retrieve fact ipaddress}}\r\n\r\nGiven that the code that produces this warning has a fallback for _some_ {{nil?}} values, perhaps it's not necessary to issue a warning at all, and instead just add another {{.nil?}} case:\r\n\r\n{code}\r\n  # Initialize our server fact hash; we add these to each client, and they\r\n  # won't change while we're running, so it's safe to cache the values.\r\n  def set_server_facts\r\n    @server_facts = {}\r\n\r\n    # Add our server version to the fact list\r\n    @server_facts[\"serverversion\"] = Puppet.version.to_s\r\n\r\n    # And then add the server name and IP\r\n    {\"servername\" => \"fqdn\",\r\n      \"serverip\" => \"ipaddress\"\r\n    }.each do |var, fact|\r\n      @server_facts[var] = value if value = Facter.value(fact)\r\n    end\r\n\r\n    if @server_facts[\"servername\"].nil?\r\n      host = Facter.value(:hostname)\r\n      if domain = Facter.value(:domain)\r\n        @server_facts[\"servername\"] = [host, domain].join(\".\")\r\n      else\r\n        @server_facts[\"servername\"] = host\r\n      end\r\n    end\r\n    if @server_facts[\"serverip\"].nil?\r\n      @server_facts[\"serverip\"] = Facter.value(:ipaddress6)\r\n    end\r\n  end\r\n{code}","closed_at":"2019-09-16T14:45:56.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5109","labels":"IPv6;help_wanted;resolved-issue-added","state":"Resolved","updated_at":"2019-09-16T14:45:56.000-0700","timestamp":1652286228.719476,"priority":"Normal","status_category":"Done","pull_request":7678},{"issue_id":"23233","title":"Puppet package providers use execpipe, which does not set LC_ALL or LANG","url":"https://tickets.puppetlabs.com/browse/PUP-1401","created_at":"2014-01-08T12:01:34.000-0800","number":"PUP-1401","body":"The opkg, rpm, pip, dpkg, pacman, and openbsd package providers all use `Puppet::Util::Execution.execpipe` to run commands, which does not normalize langage/locale environment variables. If any of the commands executed by those providers have been localized, then trying to execute a command and parse the output may fail because the parsing assumes an English locale/lang. `Puppet::Util::Execution.execute` does reset the LC_ALL and LANG variables, but `execpipe` calls out to Ruby's `Kernel#open` without normalizing the command output first.\r\n\r\nThis could be reconciled by converting all of the `execpipe` invocations to `execute`. Alternately the code used in `execute` could be duplicated in the `execpipe` method.","closed_at":"2019-09-18T08:42:23.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1401","labels":"i18n;utf-8","state":"Accepted","updated_at":"2019-09-18T08:42:23.000-0700","timestamp":1652286237.92131,"priority":"Normal","status_category":"To Do","pull_request":7724},{"issue_id":"32446","title":"Puppet client does not update and does consult the crl during authentication","url":"https://tickets.puppetlabs.com/browse/PUP-2310","created_at":"2014-04-21T09:53:21.000-0700","number":"PUP-2310","body":"I my tests puppet client never updates it's /var/lib/puppet/ssl/ca/ca_crl.pem from the master\r\neven if I delete it - it is not fetched from master then client runs.\r\n\r\nAnother issue is that puppet client does not consult the crl - after revoking cert of node dev2.internal on master - and manually copying /var/lib/puppet/ssl/ca/{ca_crl.pem,inventory.txt} to client mon1a.internal and restarting the client to make sure it can pickup the crl changes - I was still able to trigger client puppet run on mon1a.internal from dev2.internal.\r\n\r\nIt looks like puppet - client does not take the crl into consideration then authenticating.\r\n\r\nThe relevant config on mon1a.internal is\r\n<pre>\r\n # allow all authenticated nodes to trigger puppet run\r\npath /run\r\nmethod save\r\nauth yes\r\nallow *\r\n</pre>\r\nthis ACL comes first in the auth.conf file\r\n\r\nAnd this is the command I used to triger puppet run from dev2.internal\r\n<pre>\r\n curl --cert /var/lib/puppet/ssl/certs/dev2.internal.pem --key  /var/lib/puppet/ssl/private_keys/dev2.internal.pem --cacert /var/lib/puppet/ssl/certH \"Content-Type: text/pson\" -d \"{}\" https://mon1a.internal:8139/production/run/dev2.internal\r\n</pre>\r\nCould these problems be taken care of?\r\n\r\nThanks\r\nAlex\r\n\r\n*Ed- description from #9205 which is closely related included*\r\n\r\nWe came across this in a weird way.  Last night we reissued the CA certificate, which had expired.  We then reissued the puppetmaster and puppetca certificate (which we had to do for RHEL4 and RHEL5 but all other systems were happy without this step).  We then noticed on RHEL4 and RHEL5 that they were still complaining about cert validation, but ONLY for getting plugins and sending the report (it got a catalog and was able to get files for modules, etc, just fine).  We did an strace and found this was the only times it was trying to get a CRL (and was failing).  Why is this the only time the CRL was in play?  ","closed_at":"2019-09-20T08:16:53.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2310","labels":"redmine;resolved-issue-added;resolved_issue_added","state":"Resolved","updated_at":"2019-09-20T08:16:53.000-0700","timestamp":1652286238.356721,"priority":"Normal","status_category":"Done","pull_request":3247},{"issue_id":"274566","title":"File: source attribute broken for HTTP(s) URI's containing query parameters","url":"https://tickets.puppetlabs.com/browse/PUP-9109","created_at":"2018-09-06T04:02:04.000-0700","number":"PUP-9109","body":"*Puppet Version:* 4.4.0 *-* 5.5.6\r\n *Puppet Server Version:* All\r\n *OS Name/Version:* All\r\n\r\nWe want to use the [`source` attribute of the file type|https://puppet.com/docs/puppet/5.5/types/file.html#file-attribute-source] to get host specific stuff from a web service. For this we're using the following code:\r\n{code:puppet}file { '/etc/path/to/file':\r\n  ensure => file,\r\n  source => 'https://fancywebservice.example.org/get_host_specific_config.py?host=foobar'\r\n}{code}\r\nThe important part here is the `host=foobar` parameter. If it's not added, the web service will return a 404.\r\n\r\n*Desired Behavior:*\r\n The file type should be able to retrieve a file from a http(s) URL which contains query parameters\r\n\r\n*Actual Behavior:*\r\n{noformat}Error: /Stage[main]/Main/File[/etc/path/to/file]: Could not evaluate: Could not retrieve information from environment production source(s) https://fancywebservice.example.org/get_host_specific_config.py?host=foobar{noformat}\r\nThis happens, because Puppet, for reason unknown to me, requests only the `path` element of the uri and skips on the query parameters:\r\n\r\n[https://github.com/puppetlabs/puppet/blob/7ec328f0832492353cad5b2b3ae6e90449fa105f/lib/puppet/util/http_proxy.rb#L184]\r\n\r\n \r\n\r\nI will submit a PR to fix this.","closed_at":"2019-09-30T10:03:08.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9109","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-09-30T10:03:08.000-0700","timestamp":1652286239.697915,"priority":"Normal","status_category":"Done","pull_request":7709},{"issue_id":"263871","title":"validate_cmd creates tmp file with inconsistent permissions","url":"https://tickets.puppetlabs.com/browse/PUP-8983","created_at":"2018-07-05T09:55:54.000-0700","number":"PUP-8983","body":"*Puppet Version: 5.5.0*\r\n *Puppet Server Version: NA*\r\n *OS Name/Version: Linux & Mc OSX confirmed*\r\n\r\nWhen the validate_cmd runs it creates a temporary file however the permissions it assigns to this temporary file are not related to the permissions defined on the file type object. \r\n\r\n*Desired Behaviour:*\r\n\r\nThe temporary file used when running the validate command should have the exact same permissions as the file resources it is trying to create.  e.g. \r\n\r\nwith a file type of\r\n{code:puppet}file {'/tmp/test':\r\n   owner => 'foo',\r\n   group => 'bar',\r\n   mode  => '0555',\r\n   validate_cmd => 'test -x %'\r\n}{code}\r\nthe tmpe file created should have `foo:bar 0555` permissions\r\n\r\n*Actual Behavior:*\r\n\r\nI have observed the following behaviour.\r\n * tmp files are always created with permissions `0600`\r\n * if the file being managed does not exist the tmp file is owned by root\r\n * if the file being managed the tmp file uses has the same owner as the file being managed on disk\r\n\r\n \r\n the following runs a loop to detect the how the tmp file is created.  the tests use the folloing manifest file\r\n{code:puppet}file {'/tmp/test/test':\r\n  ensure => file,\r\n  owner => 'jbond',\r\n  group => 'jbond',\r\n  content => 'foobar',\r\n  validate_cmd => '/bin/false ',\r\n}\r\n{code}\r\n*output when `/tmp/test/test` doesn't exist*\r\n{code:bash}root@dev:~# ls -la /tmp/test/\r\ntotal 8\r\ndrwxr-xr-x  2 root root 4096 Jul  5 16:40 .\r\ndrwxrwxrwt 11 root root 4096 Jul  5 16:41 ..\r\nroot@dev01.l:~# while true ; do ls -l /tmp/test/ | grep test ; done\r\n-rw------- 1 root root 6 Jul  5 16:41 test20180705-24634-jluwct\r\n{code}\r\n*output when file exists with correct permissions*\r\n{code:bash}root@dev01.l:~# ls -la /tmp/test/test\r\n-rw-r--r-- 1 jbond jbond 0 Jul  5 16:42 /tmp/test/test\r\nroot@dev:~# while true ; do ls -l /tmp/test/ | grep test | egrep -v 'test$'; done\r\n-rw------- 1 jbond jbond 6 Jul  5 16:43 test20180705-5929-sdmjsa\r\n {code}\r\n*output when file exists with correct incorrect permissions*\r\n{code:bash}root@dev~# chown nsd:nsd /tmp/test/test\r\nroot@dev:~# ls -la !$\r\nls -la /tmp/test/test\r\n-rw-r--r-- 1 nsd nsd 0 Jul  5 16:42 /tmp/test/test\r\nroot@dev:~# while true ; do ls -l /tmp/test/ | grep test | egrep -v 'test$'; done\r\n-rw------- 1 nsd nsd 6 Jul  5 16:43 test20180705-22012-13alhap\r\n{code}\r\nThis causes problems when the validate command drops previlages or needs to run as a specific user.  An example of this is  using `/usr/lib/quagga/bgpd` to validate quagga files.  The command by default drops privileges to the quagga user before reading the config file.  if the file is owned by anything other then quagga then the validate command fails.  \r\n\r\n \r\n\r\n* note the bgpd command does take a user parameter so you can run the tests as the root user.  however bgpd still drops privileges to the root user and when it does so it does so *without* `CAP_DAV_OVERRIDE`.  meaning that even the root user can only validate files owned by root\r\n\r\n \r\n\r\n ","closed_at":"2019-09-30T12:40:55.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8983","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-09-30T12:40:55.000-0700","timestamp":1652286239.80315,"priority":"Normal","status_category":"Done","pull_request":7469},{"issue_id":"178941","title":"Confine systemd provider to init system matching systemd","url":"https://tickets.puppetlabs.com/browse/PUP-7312","created_at":"2017-03-07T05:38:01.000-0800","number":"PUP-7312","body":"I've created a PR to allow systemd provider to work in a chrooted environment.\r\n\r\n/run/systemd/system does not exist when running Puppet in a chroot environment\r\n\r\nThe init executable (/proc/1/exe) should always point to something with systemd in the name, which would be safe to query\r\n\r\nhttps://github.com/puppetlabs/puppet/pull/5693","closed_at":"2019-10-03T04:19:07.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7312","labels":"linux;resolved-issue-added;service;systemd;type_and_provider","state":"Resolved","updated_at":"2019-10-03T04:19:07.000-0700","timestamp":1652286243.362922,"priority":"Normal","status_category":"Done","pull_request":7545},{"issue_id":"229124","title":"Win-2012r2 FR Puppet Acceptance showing 4 test failures (localisation)","url":"https://tickets.puppetlabs.com/browse/PUP-8319","created_at":"2018-01-05T02:57:29.000-0800","number":"PUP-8319","body":"These errors were spotted when doing {{win-2012r2-fr-x86_64}} imaging acceptance testing.\r\n\r\nBuild Log is at: https://jenkins-imaging.delivery.puppetlabs.net/view/Win-vSphere/job/imaging_win-2012r2-fr_x86_64_vmware_vsphere.cygwin_acceptance_packer/12/consoleFull\r\n\r\nGist of build log is also saved at: https://gist.github.com/jcoconnor/f2392aeeb038c060d9c5e91f5cadd45c\r\n\r\n{noformat}\r\n01:36:50.996 Failed Tests Cases:\r\n01:36:50.996   Test Case tests/windows/eventlog.rb reported: #<Beaker::DSL::Outcomes::FailTest: \r\n01:36:50.996 Event not found in Application event log\r\n01:36:50.996 >\r\n01:36:50.996     Test line: tests/windows/eventlog.rb:35:in `block (3 levels) in run_test'\r\n01:36:50.997   Test Case tests/resource/group/should_query_all.rb reported: #<Beaker::DSL::Outcomes::FailTest: \r\n01:36:50.997 group Accès DCOM service de certificats found by puppet, not natively\r\n01:36:50.997 >\r\n01:36:50.997     Test line: tests/resource/group/should_query_all.rb:19:in `block (4 levels) in run_test'\r\n01:36:50.997   Test Case tests/resource/user/should_query_all.rb reported: #<Beaker::DSL::Outcomes::FailTest: \r\n01:36:50.997 user Invité found by puppet, not natively\r\n01:36:50.997 >\r\n01:36:50.997     Test line: tests/resource/user/should_query_all.rb:21:in `block (4 levels) in run_test'\r\n01:36:50.997 Errored Tests Cases:\r\n01:36:50.997   Test Case tests/face/parser_validate.rb reported: #<Beaker::Host::CommandFailure: Host 'm5a0caz1vz71n0h' exited with 1 running:\r\n01:36:50.998  chown Administrator:Administrators C:/cygwin64/tmp/parser_validate.nBctlx/parser_validate.pp\r\n01:36:50.998 Last 10 lines of output were:\r\n01:36:50.998 \tchown: invalid group: 'Administrator:Administrators'>\r\n01:36:50.998     Test line: tests/face/parser_validate.rb:30:in `block (4 levels) in run_test'\r\n{noformat}","closed_at":"2019-10-03T04:19:47.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8319","labels":"Engineering-Initiative","state":"Resolved","updated_at":"2019-10-03T04:19:47.000-0700","timestamp":1652286243.468857,"priority":"Major","status_category":"Done","pull_request":7652},{"issue_id":"303636","title":"Type package (provider yum) fails when handling kernel packages","url":"https://tickets.puppetlabs.com/browse/PUP-9605","created_at":"2019-04-08T01:38:23.000-0700","number":"PUP-9605","body":"*Puppet Version:* \r\n\r\n4.10.4\r\n\r\n*Puppet Server Version:*\r\n\r\n3.6.2\r\n *OS Name/Version:*\r\n\r\nCentOS 7\r\n\r\n*Desired Behavior:*\r\n\r\n**Being able to handle yum packages that in the rare cases in which you can have *multiple versions* of a package *installed* without conflict (e.g., the kernel package)\r\n\r\n*Actual Behavior:*\r\n\r\nError: Could not update: Failed to update to version 3.10.0-957.10.1.el7.x86_64, got version 3.10.0-957.5.1.el7 instead\r\nError: /Stage[main]/Dap_pcappiper::Install/Package[kernel-devel]/ensure: change from 3.10.0-957.5.1.el7 to 3.10.0-957.10.1.el7.x86_64 failed: Could not update: Failed to update to version 3.10.0-957.10.1.el7.x86_64, got version 3.10.0-957.5.1.el7 instead\r\n\r\npackage {'kernel-devel':\r\n ensure => '3.10.0-957.10.1.el7.x86_64',\r\n}\r\n\r\n \r\n\r\nWhen running i debug mode I can see the following command\r\n\r\n/bin/rpm -q kernel-devel --nosignature --nodigest --qf '%\\{NAME} %|EPOCH?\\{%{EPOCH}}:\\{0}| %\\{VERSION} %\\{RELEASE} %\\{ARCH}\\n'\r\n\r\nAnd if I run that I get\r\n\r\nsudo /bin/rpm -q kernel-devel --nosignature --nodigest --qf '%\\{NAME} %|EPOCH?\\{%{EPOCH}}:\\{0}| %\\{VERSION} %\\{RELEASE} %\\{ARCH}\\n'\r\nkernel-devel 0 3.10.0 957.5.1.el7 x86_64\r\nkernel-devel 0 3.10.0 957.10.1.el7 x86_64\r\n\r\n ","closed_at":"2019-10-03T04:21:14.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9605","labels":"needs_repro;resolved-issue-added","state":"Resolved","updated_at":"2019-10-03T04:21:14.000-0700","timestamp":1652286243.576027,"priority":"Normal","status_category":"Done","pull_request":7626},{"issue_id":"310253","title":"Regression: File mode changed on every puppet run","url":"https://tickets.puppetlabs.com/browse/PUP-9722","created_at":"2019-05-27T09:56:43.000-0700","number":"PUP-9722","body":"*Puppet Version: 5.5.14, 5.5.10*\r\n *Puppet Server Version: 5.3.8*\r\n *OS Name/Version: Windows 10 / 1809*\r\n\r\nFile modes are applied on every puppet run at least if files reside in special folders like \"Program Files\" and \"Windows\". This was working in *5.5.1*\r\n\r\nReproducible: Always, see example below\r\n\r\n*Desired Behavior:*\r\n\r\nFile modes are not changed\r\n\r\n*Actual Behavior:*\r\n\r\nFile modes are changed with every run ({{mode changed '2000644' to '0644'}})\r\n\r\n*Example*\r\n\r\n \r\n{code:java}C:\\Users\\administrator>cacls C:\\Windows\\system32\\puppet_facter_pci.ids.gz\r\nC:\\Windows\\system32\\puppet_facter_pci.ids.gz APPLICATION PACKAGE AUTHORITY\\ALL APPLICATION PACKAGES:(OI)(CI)(special access:)\r\n                                                                                                            READ_CONTROL\r\n                                                                                                            FILE_READ_DATA\r\n                                                                                                            FILE_READ_EA\r\n                                                                                                            FILE_WRITE_EA                                             APPLICATION PACKAGE AUTHORITY\\ALL APPLICATION PACKAGES:(CI)(IO)(special access:)\r\n                                                                                                            GENERIC_READ                                             BUILTIN\\Administrators:(special access:)\r\n                                                                    STANDARD_RIGHTS_ALL\r\n                                                                    DELETE\r\n                                                                    READ_CONTROL\r\n                                                                    WRITE_DAC\r\n                                                                    WRITE_OWNER\r\n                                                                    SYNCHRONIZE\r\n                                                                    STANDARD_RIGHTS_REQUIRED\r\n                                                                    FILE_GENERIC_READ\r\n                                                                    FILE_GENERIC_WRITE\r\n                                                                    FILE_READ_DATA\r\n                                                                    FILE_WRITE_DATA\r\n                                                                    FILE_APPEND_DATA\r\n                                                                    FILE_READ_EA\r\n                                                                    FILE_WRITE_EA\r\n                                                                    FILE_READ_ATTRIBUTES\r\n                                                                    FILE_WRITE_ATTRIBUTES                                             MBOX\\Domain Admins:(special access:)\r\n                                                                READ_CONTROL\r\n                                                                SYNCHRONIZE\r\n                                                                FILE_GENERIC_READ\r\n                                                                FILE_READ_DATA\r\n                                                                FILE_READ_EA\r\n                                                                FILE_READ_ATTRIBUTES                                             Everyone:(special access:)\r\n                                                      READ_CONTROL\r\n                                                      SYNCHRONIZE\r\n                                                      FILE_GENERIC_READ\r\n                                                      FILE_READ_DATA\r\n                                                      FILE_READ_EA\r\n                                                      FILE_READ_ATTRIBUTES                                             NT AUTHORITY\\SYSTEM:F\r\n\r\nC:\\Users\\administrator>puppet apply -e \"file { 'C:\\Windows\\system32\\puppet_facter_pci.ids.gz': mode => '0644'}\"\r\nNotice: Compiled catalog for host in environment production in 0.02 seconds\r\nNotice: /Stage[main]/Main/File[C:\\Windows\\system32\\puppet_facter_pci.ids.gz]/mode: mode changed '2000644' to '0644'\r\nNotice: Applied catalog in 0.77 secondsC:\\Users\\administrator>cacls C:\\Windows\\system32\\puppet_facter_pci.ids.gz\r\nC:\\Windows\\system32\\puppet_facter_pci.ids.gz APPLICATION PACKAGE AUTHORITY\\ALL APPLICATION PACKAGES:(OI)(CI)(special access:)\r\n                                                                                                            READ_CONTROL\r\n                                                                                                            FILE_READ_DATA\r\n                                                                                                            FILE_READ_EA\r\n                                                                                                            FILE_WRITE_EA                                             APPLICATION PACKAGE AUTHORITY\\ALL APPLICATION PACKAGES:(CI)(IO)(special access:)\r\n                                                                                                            GENERIC_READ                                             BUILTIN\\Administrators:(special access:)\r\n                                                                    STANDARD_RIGHTS_ALL\r\n                                                                    DELETE\r\n                                                                    READ_CONTROL\r\n                                                                    WRITE_DAC\r\n                                                                    WRITE_OWNER\r\n                                                                    SYNCHRONIZE\r\n                                                                    STANDARD_RIGHTS_REQUIRED\r\n                                                                    FILE_GENERIC_READ\r\n                                                                    FILE_GENERIC_WRITE\r\n                                                                    FILE_READ_DATA\r\n                                                                    FILE_WRITE_DATA\r\n                                                                    FILE_APPEND_DATA\r\n                                                                    FILE_READ_EA\r\n                                                                    FILE_WRITE_EA\r\n                                                                    FILE_READ_ATTRIBUTES\r\n                                                                    FILE_WRITE_ATTRIBUTES                                             MBOX\\Domain Admins:(special access:)\r\n                                                                READ_CONTROL\r\n                                                                SYNCHRONIZE\r\n                                                                FILE_GENERIC_READ\r\n                                                                FILE_READ_DATA\r\n                                                                FILE_READ_EA\r\n                                                                FILE_READ_ATTRIBUTES                                             Everyone:(special access:)\r\n                                                      READ_CONTROL\r\n                                                      SYNCHRONIZE\r\n                                                      FILE_GENERIC_READ\r\n                                                      FILE_READ_DATA\r\n                                                      FILE_READ_EA\r\n                                                      FILE_READ_ATTRIBUTES                                             NT AUTHORITY\\SYSTEM:F\r\n\r\nC:\\Users\\administrator>puppet apply -e \"file { 'C:\\Windows\\system32\\puppet_facter_pci.ids.gz': mode => '0644'}\"\r\nNotice: Compiled catalog for host in environment production in 0.02 seconds\r\nNotice: /Stage[main]/Main/File[C:\\Windows\\system32\\puppet_facter_pci.ids.gz]/mode: mode changed '2000644' to '0644'\r\nNotice: Applied catalog in 0.75 seconds\r\n\r\n{code}\r\n ","closed_at":"2019-10-03T04:21:40.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9722","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-10-03T04:21:40.000-0700","timestamp":1652286243.680874,"priority":"Major","status_category":"Done","pull_request":7604},{"issue_id":"318202","title":"New installers no longer needs puppetres.dll ","url":"https://tickets.puppetlabs.com/browse/PUP-9928","created_at":"2019-07-26T02:28:10.000-0700","number":"PUP-9928","body":"Following [PA-2701|https://tickets.puppetlabs.com/browse/PA-2701], puppet agent no longer uses puppetres.dll as the EventMessageFile, so puppetres.dll should not be installed on versions containing this fix.\r\n\r\nTo be merged together with [PA-2701|https://tickets.puppetlabs.com/browse/PA-2701].","closed_at":"2019-10-03T04:24:27.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9928","labels":"","state":"Resolved","updated_at":"2019-10-03T04:24:27.000-0700","timestamp":1652286243.997102,"priority":"Normal","status_category":"Done","pull_request":7640},{"issue_id":"322037","title":"Can't create users using useradd provider when specifying uid since 6.8.0","url":"https://tickets.puppetlabs.com/browse/PUP-9973","created_at":"2019-08-22T14:35:02.000-0700","number":"PUP-9973","body":"*Puppet Version: 6.8.0*\r\n *Puppet Server Version: 6.4.0*\r\n *OS Name/Version: Ubuntu 18.04*\r\n\r\nCreating a user specifying the UID (uses useradd provider automatically):\r\n{code:puppet}user { 'test':   ...   uid => 123,}\r\n{code}\r\n*Desired Behavior:*\r\n\r\nUser is created with uid 123.\r\n\r\n*Actual Behavior:*\r\n\r\n{{Error: Could not create user test1: Execution of '[redacted]' returned 1: Error: Could not execute posix command: no implicit conversion of Integer into String}}\r\n\r\nDebugging showed the command as:\r\n\r\n{{[\"/usr/sbin/useradd\", \"-c\", \"Test1\", \"-g\", \"users\", \"-d\", \"/home/test1\", \"-p\", \"removed\", \"-s\", \"/bin/tcsh\", \"-u\", 123, \"-m\", \"test1\"]}}\r\n\r\nSo I'm assuming the 123 argument there should be quoted.\r\n\r\nSuspect this is to do with this change, but can't see why:\r\n\r\n[https://github.com/puppetlabs/puppet/commit/70d20329012fc986c3d130f5769cc644f248c1b0#diff-f5b9cc80dd02278d845d220721ac0217]","closed_at":"2019-10-03T13:57:59.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9973","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-10-03T13:57:59.000-0700","timestamp":1652286244.102119,"priority":"Major","status_category":"Done","pull_request":7688},{"issue_id":"327890","title":"Exec resources fail if the working directory is inaccessible","url":"https://tickets.puppetlabs.com/browse/PUP-10080","created_at":"2019-10-03T08:15:12.000-0700","number":"PUP-10080","body":"*Puppet Version:* 6.8.1\r\n *Puppet Server Version:* 6.5.0\r\n *OS Name/Version:* CentOS 7\r\n\r\nExec resources fail unnecessarily when the working directory from which the 'agent' or 'apply' face is launched does not exist or is inaccessible to puppet. Additionally, in the event that the working directory exists but is inaccessible to the process, the diagnostic emitted incorrectly reports that the directory does not exist.\r\n\r\nI typically observe this on machines where my home directory is NFS-mounted, such that it is inaccessible to the local root account. With that as my working directory, I {{sudo}} a privileged shell in which to run the Puppet agent, but catalog application fails on account of errors from multiple {{Exec}} resources. Changing directory to a root-accessible one allows catalog application to succeed. In at least some cases, the command being executed is insensitive to the accessibility of the working directory, so there's no particular reason that the {{Exec}} should fail.\r\n\r\n*Desired Behavior:*\r\n\r\n{{Exec}} resources should not automatically fail on account of a missing or inaccessible working directory, unless a specific working directory is requested via the {{cwd}} parameter.\r\n\r\nPuppet, generally, should not rely on the working directory being accessible except where it actually needs to access it for some configuration-, face-, or catalog-specific reason.\r\n\r\n*Actual Behavior:*\r\n\r\n{{Exec}} resources with no {{cwd}} specified fail spuriously when Puppet's working directory cannot be accessed, even when execution of the command does not depend on accessing that directory. The specific failure mode seems to depend on details of the situation, but the one I normally run into can be reproduced with {{puppet apply}}, too, like so:\r\n----\r\n*Example 1*\r\n\r\n1. log in to a machine on which my home directory is on an automounted NFS file system with root squashing in effect\r\n 2. {{sudo bash}} to obtain a root shell\r\n 3. Execute\r\n{code:shell}puppet apply --execute \"exec { '/bin/echo': }\"{code}\r\n*_Output:_*\r\n{quote}Notice: Compiled catalog for xxx.yyy.zzz in environment production in 0.04 seconds\r\n Error: Working directory /mnt/auto/home/a_group/jbolling does not exist!\r\n Error: /Stage[main]/Main/Exec[/bin/echo]/returns: change from 'notrun' to ['0'] failed: Working directory /mnt/auto/home/miller2grp/jbolling does not exist!\r\n Notice: Applied catalog in 0.12 seconds\r\n{quote}\r\n----\r\nErrors of the same form are also reported by the agent under these circumstances if the catalog being applied contains `Exec` resources without {{cwd}} parameters. On the other hand, these particular failures do not occur if the {{Exec}} in question has a {{cwd}} parameter designating an existing, accessible directory, notwithstanding that the Puppet process's own working directory is inaccessible to it.\r\n\r\nOddly enough, a different failure occurs if Puppet's working directory actually doesn't exist. That situation can be reproduced like so:\r\n----\r\n*Example 2*\r\n\r\n1. Create a fresh directory for the experiment: {{mkdir doomed}}.\r\n 2. Make that directory the working directory: {{cd doomed}}.\r\n 3. In a separate shell, remove the directory: {{rm doomed}}.\r\n 4. In the first shell, run any Puppet command at all, for example\r\n{code:shell}puppet agent --test{code}\r\nor\r\n{code:shell}puppet apply --execute \"exec { '/bin/echo': cwd => '/tmp' }\"{code}\r\n.\r\n\r\n*_Output_*\r\n{quote}shell-init: error retrieving current directory: getcwd: cannot access parent directories: No such file or directory\r\n terminate called after throwing an instance of 'boost::filesystem::filesystem_error'\r\n what(): boost::filesystem::current_path: No such file or directory\r\n Aborted\r\n{quote}\r\n----\r\nAs described in conjunction with Example 1, however, Puppet does not actually need to access the current working directory to compile or apply a catalog, at least not as a general rule, so this failure is spurious.\r\n\r\nOf course, these issues can be worked around by ensuring that the working directory is an existing, accessible one before running Puppet, and I imagine that both failure scenarios presented are unlikely for most people. However, I personally hit the Example 1 case often enough to inspire me to file this report. I note also that it's distinctly more annoying when it occurs as a result of {{puppet agent --test}} ing a catalog that takes a minute to retrieve and a few minutes to apply, and there is some risk that such a failure leaves the system in an unexpected state requiring manual intervention.","closed_at":"2019-10-09T06:32:53.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10080","labels":"","state":"Closed","updated_at":"2019-10-09T06:32:53.000-0700","timestamp":1652286244.740314,"priority":"Minor","status_category":"Done","pull_request":7774},{"issue_id":"313276","title":"Unintentional secret reveal while installing modules ","url":"https://tickets.puppetlabs.com/browse/PUP-9787","created_at":"2019-06-19T15:45:49.000-0700","number":"PUP-9787","body":"*Puppet Version:* any\r\n *Puppet Server Version:* any\r\n *OS Name/Version:* any\r\n\r\n*Actual Behavior:*\r\n\r\nPuppet Forge is public, and downloading modules don't require authentication. However there are some repositories that can hold modules and require authentication to connect.\r\n\r\nThose repositories are:\r\n * [Artifactory|https://www.jfrog.com/confluence/display/RTF/Puppet+Repositories] (live)\r\n * [Nexus|https://github.com/wavesoftware/nexus-repository-puppet] (emerging)\r\n\r\nWhen installing modules from those repositories user is forced to set his credentials in plain text in URI supported form, for ex.:\r\n{noformat}https://admin:s3creT@pkg.acmecorp.com/repository/puppet{noformat}\r\nInstalling modules with similar module repository being set, reveals those credentials. In fact it's done each time a module is installed, with a message:\r\n{noformat}Notice: Preparing to install into /home/jdoe/.puppetlabs/etc/code/modules ...\r\nNotice: Downloading from https://jdoe:s3creT@pkg.acmecorp.com/repository/puppet ...\r\n{noformat}\r\n*Desired Behavior:*\r\n\r\nPuppet should mask password if given, like this:\r\n{noformat}Notice: Preparing to install into /home/jdoe/.puppetlabs/etc/code/modules ...\r\nNotice: Downloading from https://jdoe:***@pkg.acmecorp.com/repository/puppet ...\r\n{noformat}\r\n ","closed_at":"2019-10-10T08:45:23.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9787","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-10-10T08:45:23.000-0700","timestamp":1652286245.056856,"priority":"Minor","status_category":"Done","pull_request":7587},{"issue_id":"141117","title":"exec resources leak the command string when execution fails","url":"https://tickets.puppetlabs.com/browse/PUP-6494","created_at":"2016-07-12T09:19:56.000-0700","number":"PUP-6494","body":"If an exec is run as an inline sh script with an eyaml'd password variable, the password will get logged in plaintext on the console and agent if it fails. loglevel and logoutput don't do anything in this situation, as it's the command that's being displayed, not the output of the command. It was suggested to make the command into a script and run it that way, but that presents putting the password plaintext in the script, not a viable long-term solution.\r\n\r\nHaving the exec's inline sh script executed in this manner presents another issue. The same data is present in the cached catalog on agents in /opt/puppetlabs/puppet/cache/client_data/catalog/*.json. I imagine this issue is caught somewhere in https://tickets.puppetlabs.com/browse/PUP-1974.\r\n\r\nJust an idea to branch off of the \"sensitive\" resource type mentioned in PUP-1974: Most passwords and sensitve data will be coming from an eyaml'd variable(at least, in our scenario). If there were a setting in puppet.conf that would mark all eyaml data as \"sensitive\", hashing or masking it in logs and cached catalogs, that might take care of the lion's share of sensitive information leaks. This would be in addition to being able \"to give manifest/module authors the ability to specify resource properties (such as attributes or titles) which are sensitive\".","closed_at":"2019-10-15T09:55:08.000-0700","comments":22,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6494","labels":"secrets","state":"Closed","updated_at":"2019-10-15T09:55:08.000-0700","timestamp":1652286245.383079,"priority":"Normal","status_category":"Done","pull_request":5502},{"issue_id":"188237","title":"\"Successful\" puppet agent reports hide provider errors","url":"https://tickets.puppetlabs.com/browse/PUP-7630","created_at":"2017-04-27T12:08:17.000-0700","number":"PUP-7630","body":"It's possible to get a successful agent run report that on closer inspection include errors.\r\n\r\nFor instance, an error points to a failure with the Chocolatey provider. Because the provider failed out, it did not return a complete list of resources to manage, and the agent run completes successfully on this smaller catalog without raising an alarm.\r\n\r\nThere is no way for an administrator to notice this problem and correct it without drilling down into green agent reports to confirm whether an error has occurred or not. On large scale deployments this solution rapidly becomes unmanageable.\r\n\r\nAgent runs need to return some condition when providers fail that highlights that this has occurred. There needs to be a scaleable way to monitor and report on this kind of failure.\r\n\r\nPlease add all errors and warnings for consideration as failed run status assignment criteria [here|https://docs.google.com/document/d/1PKLzYYPyPVt0pKS4Fc6r-1BbDAfK8eFOmTICcgT5gQ4/edit?usp=sharing].","closed_at":"2019-10-21T07:47:00.000-0700","comments":22,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7630","labels":"","state":"Closed","updated_at":"2019-10-21T07:47:00.000-0700","timestamp":1652286247.580535,"priority":"Major","status_category":"Done","pull_request":6578},{"issue_id":"182344","title":"FileBucket should use `Puppet::Util::replace_file` to write contents","url":"https://tickets.puppetlabs.com/browse/PUP-7397","created_at":"2017-03-23T14:44:34.000-0700","number":"PUP-7397","body":"Per feedback on PR for PUP-1334, https://github.com/puppetlabs/puppet/pull/5704, it would be ideal to use {{Puppet::Util::replace_file}} to write the contents file instead of {{Puppet::FileSystem::open}}.\r\n\r\nDue to PUP-7394 and PUP-7395 doing so at the time of filing this ticket was not optimal, but once those are addressed this change should be made.\r\n\r\nSee https://github.com/MosesMendoza/puppet/commit/9f1bf4b3a186942439f41a282c57823bae4af5a2 for an implementation","closed_at":"2019-10-21T07:47:10.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7397","labels":"","state":"Closed","updated_at":"2019-10-21T07:47:10.000-0700","timestamp":1652286247.686145,"priority":"Normal","status_category":"Done","pull_request":6448},{"issue_id":"249624","title":"Numeric('0') raises an error","url":"https://tickets.puppetlabs.com/browse/PUP-8703","created_at":"2018-05-08T06:02:30.000-0700","number":"PUP-8703","body":"The {{Numeric}} data type when given the string \"0\" will fail because it attempts to look at the second char in the string - if it is a downcased 'b' or 'x' - and this fails since there is nothing to downcase.","closed_at":"2019-10-21T07:47:39.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8703","labels":"","state":"Closed","updated_at":"2019-10-21T07:47:39.000-0700","timestamp":1652286247.792032,"priority":"Normal","status_category":"Done","pull_request":6822},{"issue_id":"249032","title":"Comparison of Numeric to Timestamp/Timespan fails, but other way is ok","url":"https://tickets.puppetlabs.com/browse/PUP-8694","created_at":"2018-05-03T03:14:40.000-0700","number":"PUP-8694","body":"When comparing Numeric to Timestamp or Timespan it does not work to compare with the Numeric value first:\r\n\r\n{code:puppet}\r\n1 < Timespan(2)\r\n1 < Timestamp(2)\r\n{code}\r\nbut works in reverse\r\n{code:puppet}\r\nTimespan(2) > 1\r\nTimestamp(2) > 1\r\n{code}\r\n\r\nIt should work both ways.","closed_at":"2019-10-21T07:47:47.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8694","labels":"","state":"Closed","updated_at":"2019-10-21T07:47:47.000-0700","timestamp":1652286247.89654,"priority":"Normal","status_category":"Done","pull_request":6817},{"issue_id":"188415","title":"Agent sends wrong content-type when using http file sources","url":"https://tickets.puppetlabs.com/browse/PUP-7482","created_at":"2017-04-28T11:05:46.000-0700","number":"PUP-7482","body":"Error when running a Puppet agent run:\r\n\r\n{code}\r\nfile {'C:\\temp\\example.msi':\r\n  ensure  => present,\r\n  source => 'http://foo.example.com/example.msi',\r\n}\r\n{code}\r\n\r\nThe file was hosted on an IIS server, and gave this error when run:\r\n\r\n{code}\r\nError: Could not set 'file' on ensure: Error 406 on SERVER: <!DOCTYPE html PUBLI\r\nC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-str\r\nict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\"/>\r\n<title>406 - Client browser does not accept the MIME type of the requested page.\r\n</title>\r\n<style type=\"text/css\">\r\n<!--\r\nbody{margin:0;font-size:.7em;font-family:Verdana, Arial, Helvetica, sans-serif;b\r\nackground:#EEEEEE;}\r\nfieldset{padding:0 15px 10px 15px;}\r\nh1{font-size:2.4em;margin:0;color:#FFF;}\r\nh2{font-size:1.7em;margin:0;color:#CC0000;}\r\nh3{font-size:1.2em;margin:10px 0 0 0;color:#000000;}\r\n#header{width:96%;margin:0 0 0 0;padding:6px 2% 6px 2%;font-family:\"trebuchet MS\r\n\", Verdana, sans-serif;color:#FFF;\r\nbackground-color:#555555;}\r\n#content{margin:0 0 0 2%;position:relative;}\r\n.content-container{background:#FFF;width:96%;margin-top:8px;padding:10px;positio\r\nn:relative;}\r\n-->\r\n</style>\r\n</head>\r\n<body>\r\n<div id=\"header\"><h1>Server Error</h1></div>\r\n<div id=\"content\">\r\n<div class=\"content-container\"><fieldset>\r\n  <h2>406 - Client browser does not accept the MIME type of the requested page.<\r\n/h2>\r\n  <h3>The page you are looking for cannot be opened by your browser because it h\r\nas a file name extension that your browser does not accept.</h3>\r\n</fieldset></div>\r\n</div>\r\n</body>\r\n</html>\r\nat /etc/puppetlabs/code/environments/production/modules/profiles/manifests/msi_download.pp:7\r\nError: Could not set 'file' on ensure: Error 406 on SERVER: <!DOCTYPE html PUBLI\r\nC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-str\r\nict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\"/>\r\n<title>406 - Client browser does not accept the MIME type of the requested page.\r\n</title>\r\n<style type=\"text/css\">\r\n<!--\r\nbody{margin:0;font-size:.7em;font-family:Verdana, Arial, Helvetica, sans-serif;b\r\nackground:#EEEEEE;}\r\nfieldset{padding:0 15px 10px 15px;}\r\nh1{font-size:2.4em;margin:0;color:#FFF;}\r\nh2{font-size:1.7em;margin:0;color:#CC0000;}\r\nh3{font-size:1.2em;margin:10px 0 0 0;color:#000000;}\r\n#header{width:96%;margin:0 0 0 0;padding:6px 2% 6px 2%;font-family:\"trebuchet MS\r\n\", Verdana, sans-serif;color:#FFF;\r\nbackground-color:#555555;}\r\n#content{margin:0 0 0 2%;position:relative;}\r\n.content-container{background:#FFF;width:96%;margin-top:8px;padding:10px;positio\r\nn:relative;}\r\n-->\r\n</style>\r\n</head>\r\n<body>\r\n<div id=\"header\"><h1>Server Error</h1></div>\r\n<div id=\"content\">\r\n<div class=\"content-container\"><fieldset>\r\n  <h2>406 - Client browser does not accept the MIME type of the requested page.<\r\n/h2>\r\n  <h3>The page you are looking for cannot be opened by your browser because it h\r\nas a file name extension that your browser does not accept.</h3>\r\n</fieldset></div>\r\n</div>\r\n</body>\r\n</html>\r\nat /etc/puppetlabs/code/environments/production/modules/profiles/manifests/msi_download.pp:7\r\nWrapped exception:\r\nError 406 on SERVER: <!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"h\r\nttp://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\"/>\r\n<title>406 - Client browser does not accept the MIME type of the requested page.\r\n</title>\r\n<style type=\"text/css\">\r\n<!--\r\nbody{margin:0;font-size:.7em;font-family:Verdana, Arial, Helvetica, sans-serif;b\r\nackground:#EEEEEE;}\r\nfieldset{padding:0 15px 10px 15px;}\r\nh1{font-size:2.4em;margin:0;color:#FFF;}\r\nh2{font-size:1.7em;margin:0;color:#CC0000;}\r\nh3{font-size:1.2em;margin:10px 0 0 0;color:#000000;}\r\n#header{width:96%;margin:0 0 0 0;padding:6px 2% 6px 2%;font-family:\"trebuchet MS\r\n\", Verdana, sans-serif;color:#FFF;\r\nbackground-color:#555555;}\r\n#content{margin:0 0 0 2%;position:relative;}\r\n.content-container{background:#FFF;width:96%;margin-top:8px;padding:10px;positio\r\nn:relative;}\r\n-->\r\n</style>\r\n</head>\r\n<body>\r\n<div id=\"header\"><h1>Server Error</h1></div>\r\n<div id=\"content\">\r\n<div class=\"content-container\"><fieldset>\r\n  <h2>406 - Client browser does not accept the MIME type of the requested page.<\r\n/h2>\r\n  <h3>The page you are looking for cannot be opened by your browser because it h\r\nas a file name extension that your browser does not accept.</h3>\r\n</fieldset></div>\r\n</div>\r\n</body>\r\n</html>\r\n{code}\r\n\r\nSame code ran fine when running with puppet apply\r\n\r\nhttps://support.microsoft.com/en-us/help/942050/error-message-when-you-visit-a-web-site-that-is-hosted-on-a-server-that-is-running-internet-information-services-7.0-http-error-406---not-acceptable\r\n\r\nWorkaround was to use the remote_file module in the mean time","closed_at":"2019-10-21T07:49:03.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7482","labels":"Windows","state":"Closed","updated_at":"2019-10-21T07:49:03.000-0700","timestamp":1652286258.547799,"priority":"Normal","status_category":"Done","pull_request":6486},{"issue_id":"224387","title":"The Variant type without any types matches in strange ways","url":"https://tickets.puppetlabs.com/browse/PUP-8212","created_at":"2017-11-28T07:23:14.000-0800","number":"PUP-8212","body":"The {{Variant}} type when used as just {{Variant}} (no list of types) has an implementation that uses {{all?}} to check if all types in a RHS variant can be assigned to the LHS type. This fails when the RHS Variant is empty.\r\n\r\nAn empty {{Variant}} should only be assignable from a {{Variant}} as the only meaningful interpretation of a {{Variant}} without any types to perform an OR matching operation on is that it means \"all types that are actually {{Variant}}\".\r\n\r\nIf an empty {{Variant}} was to be interpreted as {{Variant\\[Any}}}, then it is essentially the same as {{Any}}, and that is surprising.\r\n\r\nIf it was to be an error to use {{Variant}} as an expression, we need to change the entire implementation how parameterized types are formed using the AST. (It has one expression that evaluates to the base {{Variant}} type, followed by an \"at\" expression {{\\[T1, T2,...]}} that constrains/widens/defines the type instance that will be created.\r\n\r\nWhen fixing this, there are numerous tests that include the {{Variant}} in the list of \"all types\", and this change will require a special section of tests for the {{Variant}} type.\r\n","closed_at":"2019-10-21T07:49:41.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8212","labels":"","state":"Closed","updated_at":"2019-10-21T07:49:41.000-0700","timestamp":1652286259.075517,"priority":"Normal","status_category":"Done","pull_request":6396},{"issue_id":"230110","title":"When enforcing String data type for a class param, a regex data type does not raise an error.","url":"https://tickets.puppetlabs.com/browse/PUP-8343","created_at":"2018-01-11T09:00:17.000-0800","number":"PUP-8343","body":"When enforcing a String data type for a class parameter:\r\n\r\n{code:puppet}\r\nclass test::myclass(String $my_string = 'default') { \r\n  notify { \"notice ${my_string}\": }\r\n}\r\n{code}\r\n\r\nIf you provide a Regex data type, no exception is raised:\r\n\r\n{code:puppet}\r\nclass { 'test::myclass':\r\n  my_string => /my_regex/\r\n}\r\n{code}\r\n\r\n","closed_at":"2019-10-21T07:50:45.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8343","labels":"","state":"Closed","updated_at":"2019-10-21T07:50:45.000-0700","timestamp":1652286259.178239,"priority":"Normal","status_category":"Done","pull_request":6542},{"issue_id":"230042","title":"Add transaction_completed to schema","url":"https://tickets.puppetlabs.com/browse/PUP-8342","created_at":"2018-01-10T15:14:20.000-0800","number":"PUP-8342","body":"Forked off of PUP-8288 to track adding the transaction_completed flag to the report schema for serialization/deserialization.  Broken out into a separate ticket targeted at master branch to minimize impact to our LTS release at 4.10.x, which the flag/partial fix was added to.","closed_at":"2019-10-21T07:50:53.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8342","labels":"","state":"Closed","updated_at":"2019-10-21T07:50:53.000-0700","timestamp":1652286259.281375,"priority":"Major","status_category":"Done","pull_request":6510},{"issue_id":"228387","title":"Puppet webrick no longer functions in Ruby 2.3.6/2.4.3 and up","url":"https://tickets.puppetlabs.com/browse/PUP-8297","created_at":"2017-12-28T02:23:51.000-0800","number":"PUP-8297","body":"*Puppet Version:*  4.10.8\r\n*OS Name/Version:* FreeBSD 11.1-RELEASE (Affects Linux as well), with OpenSSL 1.0.2k\r\n\r\nWhen Launching the puppetmaster rc.d script on FreeBSD, which uses $Puppet_Location/puppet/network/http/webrick.rb, webrick fails to accept SSL/TLS connections, due to a change upstream in Ruby.\r\n\r\nhttps://bugs.ruby-lang.org/issues/14005\r\n\r\nThe issue occurs in webrick.rb, supplied by puppet.\r\nwebrick.rb:32 {\r\nsock.accept\r\n}\r\nDue to the changes in Ruby, this should read:\r\nsock.accept_nonblock\r\n\r\nTo reproduce, run a webrick puppetmaster with Ruby 2.3.6 or newer on any OS using OpenSSL.\r\n\r\n*Desired Behavior:*\r\nWebrick puppetmaster does the needful \r\n\r\n*Actual Behavior:*\r\nWebrick puppetmaster outputs the following to logs:\r\n[2017-12-25 21:30:26] ERROR OpenSSL::SSL::SSLError: SSL_accept returned=1 errno=0 state=SSLv3 read client hello B: unexpected record\r\n        /usr/local/lib/ruby/site_ruby/2.3/puppet/network/http/webrick.rb:32:in `accept'\r\n        /usr/local/lib/ruby/site_ruby/2.3/puppet/network/http/webrick.rb:32:in `block (2 levels) in listen'\r\n        /usr/local/lib/ruby/2.3/webrick/server.rb:314:in `block in start_thread'\r\n\r\nand the following on the client:\r\nError: /File[/var/puppet/lib]: Failed to generate additional resources using 'eval_generate': SSL_read: decryption failed or bad record mac                               \r\n\r\n--\r\nI am aware webrick is being deprecated, however it is still in use currently.\r\nI have filed a separate bug with FreeBSD to change the default puppet pkg to use sysutils/puppetserver from the ports system.\r\nhttps://bugs.freebsd.org/bugzilla/show_bug.cgi?id=224623\r\n\r\n","closed_at":"2019-10-21T07:51:19.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8297","labels":"","state":"Closed","updated_at":"2019-10-21T07:51:19.000-0700","timestamp":1652286259.490513,"priority":"Normal","status_category":"Done","pull_request":6548},{"issue_id":"228279","title":"Bad Markdown in 'unique' function breaks Strings-generated reference","url":"https://tickets.puppetlabs.com/browse/PUP-8292","created_at":"2017-12-22T11:50:18.000-0800","number":"PUP-8292","body":"*Puppet Version:* 5.3.3\r\n*Puppet Server Version:* N/A\r\n*OS Name/Version:* N/A\r\n\r\nThe Puppet Strings-generated docs for the [{{unique}} function|https://puppet.com/docs/puppet/5.3/function_strings_prefer_v4.html#unique] include a Markdown error resulting in a broken codeblock and formatting.\r\n\r\n*Desired Behavior:*\r\n\r\nThe formatting is correct and the page renders correctly on the docs site.\r\n\r\n*Actual Behavior:*\r\n\r\nThe formatting is wrong and the page renders incorrectly on the docs site.","closed_at":"2019-10-21T07:51:26.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8292","labels":"","state":"Closed","updated_at":"2019-10-21T07:51:26.000-0700","timestamp":1652286259.595246,"priority":"Minor","status_category":"Done","pull_request":6487},{"issue_id":"227615","title":"PAL task_signature adds 'default' to some type descriptions","url":"https://tickets.puppetlabs.com/browse/PUP-8270","created_at":"2017-12-20T10:46:28.000-0800","number":"PUP-8270","body":"Using {{bolt task show}} on the following metadata file results in some strange artifacts\r\n{code}\r\n{\r\n  \"description\": \"Do a thing.\",\r\n  \"parameters\": {\r\n    \"foo\": {\r\n      \"description\": \"The foo\",\r\n      \"type\": \"String[1]\"\r\n    }\r\n  }\r\n}\r\n{code}\r\n\r\nresults in\r\n\r\n{code}\r\nPARAMETERS:\r\n- foo: String[1, default]\r\n    The foo\r\n{code}\r\n\r\nI'm not sure where {{default}} is coming from. It doesn't seem to happen in all the examples I try however.","closed_at":"2019-10-21T07:51:43.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8270","labels":"","state":"Closed","updated_at":"2019-10-21T07:51:43.000-0700","timestamp":1652286259.802117,"priority":"Normal","status_category":"Done","pull_request":6469},{"issue_id":"243167","title":"PuppetStack.stacktrace is slow with a large stack","url":"https://tickets.puppetlabs.com/browse/PUP-8610","created_at":"2018-03-27T12:09:29.000-0700","number":"PUP-8610","body":"Several places in Puppet call {{PuppetStack.stacktrace[0]}} to get their \"caller\". Most notably, log messages where the \"source\" is a Scope object _without_ an associated resource use that method to determine the \"source\" to log from. There are also some Puppet functions that use it (empty, create_resource, and more).\r\n\r\nThose calls become quite slow (I saw up to 50ms) when the stack is large. While it's probably uncommon for the stack to grow that deep, _no_ caller currently uses anything but the top element of the stack, which means this is a straightforward opportunity for improvement.\r\n\r\nIt probably makes sense to either make that method lazy, which is a bit of a challenge as it's both a filter and a map, or to add a method that specifically returns the top element of the stack, which satisfies every current caller.","closed_at":"2019-10-21T07:52:04.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8610","labels":"","state":"Closed","updated_at":"2019-10-21T07:52:04.000-0700","timestamp":1652286260.009245,"priority":"Normal","status_category":"Done","pull_request":6769},{"issue_id":"240172","title":"Lexer errors with non existing Issues::HEREDOC_MISSING_ENDTAG","url":"https://tickets.puppetlabs.com/browse/PUP-8519","created_at":"2018-03-08T00:43:23.000-0800","number":"PUP-8519","body":"Given an expression such as:\r\n{code:puppet}\r\n@(\"\")\r\nThis is heredoc $text\r\n|-END\r\n{code}\r\nthe lexer attempts to error with {{Issues::HEREDOC_MISSING_ENDTAG}}. Since there's no such issue, this instead results in a {{NameError}}. The correct issue to use here, given that there's no actual tag, would be {{Issues::HEREDOC_EMPTY_TAG}}.","closed_at":"2019-10-21T07:53:29.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8519","labels":"","state":"Closed","updated_at":"2019-10-21T07:53:29.000-0700","timestamp":1652286260.717427,"priority":"Normal","status_category":"Done","pull_request":6724},{"issue_id":"237580","title":"selinux types are being set on every run","url":"https://tickets.puppetlabs.com/browse/PUP-8477","created_at":"2018-02-20T13:31:39.000-0800","number":"PUP-8477","body":"*Puppet Version: 5.4.0*\r\n *Puppet Server Version:*\r\n *OS Name/Version: RHEL 7.4*\r\n\r\nThe handling of selinux file parameters seems to have changed between 5.3.5 and 5.4.0.  Specifically, we are managing some .k5login files as type 'krb5_home_t':\r\n\r\n{code:puppet}\r\n  file { \"${basedir}/${name}/.k5login\": seltype => 'krb5_home_t' }\r\n{code}\r\n\r\nAs of when we upgraded to v5.4.0, puppet has been trying to reset the parameters every run, e.g.:\r\n\r\n{noformat}\r\nFeb 20 15:16:50 XXXX04 puppet-agent[99767]: (/Stage[main]/P_puppet_server::\r\nAutomation::User/K5login[/var/lib/foo/.k5login]/seluser) seluser changed  to 'user_u'\r\nFeb 20 15:16:50 XXXX04 puppet-agent[99767]: (/Stage[main]/P_puppet_server::\r\nAutomation::User/K5login[/var/lib/foo/.k5login]/selrole) selrole changed  to 'object_r'\r\nFeb 20 15:16:50 XXXX04 puppet-agent[99767]: (/Stage[main]/P_puppet_server::\r\nAutomation::User/K5login[/var/lib/foo/.k5login]/seltype) seltype changed  to 'krb5_home_t'\r\nFeb 20 15:16:50 XXXX04 puppet-agent[99767]: (/Stage[main]/P_puppet_server::\r\nAutomation::User/K5login[/var/lib/foo/.k5login]/selrange) selrange changed  to 's0'\r\n{noformat}\r\n\r\nDowngrading to 5.3.5 reverts the behavior - e.g. the values are no longer updated every run.\r\n\r\nNote that selinux is off on these hosts anyway.\r\n\r\n*Desired Behavior:  don't change every run*\r\n\r\n*Actual Behavior:  tries to change every run*","closed_at":"2019-10-21T07:54:49.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8477","labels":"regression","state":"Closed","updated_at":"2019-10-21T07:54:49.000-0700","timestamp":1652286261.351135,"priority":"Normal","status_category":"Done","pull_request":6689},{"issue_id":"237172","title":"fqdn_rand should use md5 on non-fips enabled hosts","url":"https://tickets.puppetlabs.com/browse/PUP-8469","created_at":"2018-02-16T11:51:10.000-0800","number":"PUP-8469","body":"Puppet 5.4's {{fqdn_rand}} function produces a different value than earlier versions for the same set of inputs. \r\n\r\n{noformat}\r\n$ bx puppet apply -e '$value = fqdn_rand(30); notice(\"$puppetversion: $value\")'\r\nNotice: Scope(Class[main]): 5.4.0: 22\r\nNotice: Compiled catalog for r1nc1m63jxi6u3e.delivery.puppetlabs.net in environment production in 0.04 seconds\r\n{noformat}\r\n\r\n{noformat}\r\n$ bx puppet apply -e '$value = fqdn_rand(30); notice(\"$puppetversion: $value\")'\r\nNotice: Scope(Class[main]): 5.3.5: 5\r\nNotice: Compiled catalog for r1nc1m63jxi6u3e.delivery.puppetlabs.net in environment production in 0.03 seconds\r\n{noformat}\r\n\r\nThis is a problem because the values are often written into service configuration files. When they change, services get notified and restart.\r\n\r\nWe should restore the previous {{fqdn_rand}} behavior of calculating its seed value using MD5 when running on a non-FIPS enabled master. FIPS enabled masters should continue using SHA256.","closed_at":"2019-10-21T07:54:56.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8469","labels":"","state":"Closed","updated_at":"2019-10-21T07:54:56.000-0700","timestamp":1652286261.465628,"priority":"Normal","status_category":"Done","pull_request":6654},{"issue_id":"236125","title":"\"puppet cert clean\" only works if at least one cert has already been signed","url":"https://tickets.puppetlabs.com/browse/PUP-8448","created_at":"2018-02-09T15:03:03.000-0800","number":"PUP-8448","body":"PUP-1916 added the ability to clean certificates that have not yet been signed, without having to manually sign/revoke them first. However, this only works if there is at least one signed certificate in the list of certificate names passed to \"puppet cert clean\".","closed_at":"2019-10-21T07:55:04.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8448","labels":"","state":"Closed","updated_at":"2019-10-21T07:55:04.000-0700","timestamp":1652286261.572593,"priority":"Normal","status_category":"Done","pull_request":6627},{"issue_id":"235785","title":"Default upper limit of Timestamp and Timespan data types is incorrectly set equal to lower limit","url":"https://tickets.puppetlabs.com/browse/PUP-8439","created_at":"2018-02-08T00:57:57.000-0800","number":"PUP-8439","body":"The data types {{Float}}, {{Integer}}, {{Timespan}}, and {{Timestamp}} in the Puppet type system can be specified with a lower and upper limit using the syntax {{T[min, max]}}. When using just one argument, {{T[x]}} the  {{Float}} and {{Integer}} will interpret this as {{T[x, <no limit>]}} whereas {{Timespan}} and {{Timestamp}} interprets it as {{T[x,x]}}. The latter interpretation is incorrect. {{Timespan}} and {{Timestamp}} must be changed to use the same semantics as {{Float}} and {{Integer}}.","closed_at":"2019-10-21T07:56:40.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8439","labels":"","state":"Closed","updated_at":"2019-10-21T07:56:40.000-0700","timestamp":1652286261.897491,"priority":"Normal","status_category":"Done","pull_request":6622},{"issue_id":"235706","title":"puppet should only ignore pot files when syncing locales","url":"https://tickets.puppetlabs.com/browse/PUP-8436","created_at":"2018-02-07T11:45:26.000-0800","number":"PUP-8436","body":"*Puppet Version: 5.3.4*\r\n *Puppet Server Version: n/a*\r\n *OS Name/Version:*\r\n\r\n*Desired Behavior:*\r\n\r\nPuppet should only ignore {{*.pot}} files when syncing {{locales}}, but not for {{plugins}} or {{pluginfacts}}.\r\n\r\n*Actual Behavior:*\r\n\r\nThe default {{pluginsignore}} applies to all plugin related requests. We should instead exclude {{*.pot}} files in the same way we do for {{config.yaml}}, in the locales-specific downloader.\r\n\r\nIf you create an executable script named {{my.pot}} in the {{facts.d}} directory of a module, the agent won't download the file. On master:\r\n\r\n{noformat}\r\n$ echo <<END > ~/.puppetlabs/etc/code/environments/production/modules/acl/facts.d/my.pot\r\nheredoc> #!/bin/sh\r\nheredoc> echo \"foo=bar\"\r\nheredoc> END\r\n$ chmod a+x  ~/.puppetlabs/etc/code/environments/production/modules/acl/facts.d/my.pot\r\n{noformat}\r\n\r\nOn agent, the file isn't downloaded:\r\n\r\n{noformat}\r\n$ bx puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Loading facts\r\n...\r\n$ find  ~/.puppetlabs/opt/puppet/cache/facts.d\r\n/Users/josh/.puppetlabs/opt/puppet/cache/facts.d\r\n{noformat}","closed_at":"2019-10-21T07:56:54.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8436","labels":"","state":"Closed","updated_at":"2019-10-21T07:56:54.000-0700","timestamp":1652286262.002986,"priority":"Normal","status_category":"Done","pull_request":6624},{"issue_id":"234032","title":"Puppet config print lists invalid value for environment_timeout when set to unlimited","url":"https://tickets.puppetlabs.com/browse/PUP-8409","created_at":"2018-01-30T16:53:26.000-0800","number":"PUP-8409","body":"When running {{puppet config print --all}} on the command line with {{environment_timeout}} set to {{unlimited}} in {{puppet.conf}}, the value for {{environment_timeout}} is listed as {{Infinity}}, which is not a valid setting (it can be a positive integer, 0, or `{{unlimited`}}). As a user if I saw this I would presume it was a valid setting.\r\n\r\nWhen I try using {{Infinity}} as a setting value for {{environment_timeout}}, I get a not so helpful error message and stack trace.\r\n{code}puppet apply --environment_timeout=Infinity -e \"notify{'foo':}\"\r\n/Users/matthaus/src/puppet/lib/puppet/settings/ttl_setting.rb:43:in `munge': Invalid 'time to live' format '\"Infinity\"' for parameter: environment_timeout (Puppet::Settings::ValidationError)\r\n\tfrom /Users/matthaus/src/puppet/lib/puppet/settings/ttl_setting.rb:25:in `munge'\r\n\tfrom /Users/matthaus/src/puppet/lib/puppet/settings.rb:1310:in `interpolate'\r\n\tfrom /Users/matthaus/src/puppet/lib/puppet/settings.rb:1082:in `value_sym'\r\n\tfrom /Users/matthaus/src/puppet/lib/puppet/settings.rb:1054:in `value'\r\n\tfrom /Users/matthaus/src/puppet/lib/puppet/settings/environment_conf.rb:87:in `environment_timeout'\r\n\tfrom /Users/matthaus/src/puppet/lib/puppet/environments.rb:414:in `entry'\r\n\tfrom /Users/matthaus/src/puppet/lib/puppet/environments.rb:345:in `get'\r\n\tfrom /Users/matthaus/src/puppet/lib/puppet/util/autoload.rb:131:in `module_directories'\r\n\tfrom /Users/matthaus/src/puppet/lib/puppet/util/autoload.rb:166:in `search_directories'\r\n\tfrom /Users/matthaus/src/puppet/lib/puppet/util/autoload.rb:100:in `files_to_load'\r\n\tfrom /Users/matthaus/src/puppet/lib/puppet/util/autoload.rb:220:in `files_to_load'\r\n\tfrom /Users/matthaus/src/puppet/lib/puppet/application.rb:212:in `available_application_names'\r\n\tfrom /Users/matthaus/src/puppet/lib/puppet/util/command_line.rb:90:in `find_subcommand'\r\n\tfrom /Users/matthaus/src/puppet/lib/puppet/util/command_line.rb:73:in `execute'\r\n\tfrom /usr/bin/puppet:5:in `<main>'\r\n{code}\r\nThe simple reproducer here is:\r\n{code}puppet config print --environment_timeout=unlimited environment_timeout\r\nInfinity\r\n{code}","closed_at":"2019-10-21T07:57:20.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8409","labels":"","state":"Closed","updated_at":"2019-10-21T07:57:20.000-0700","timestamp":1652286262.324115,"priority":"Normal","status_category":"Done","pull_request":6608},{"issue_id":"232984","title":"Standard Array conversions do not work on return value from tree_each function","url":"https://tickets.puppetlabs.com/browse/PUP-8393","created_at":"2018-01-24T16:54:27.000-0800","number":"PUP-8393","body":"I am trying to see what the {{tree_each}} function actually produces, to see how I could use it for complex tree transformations.\r\n\r\nI went with the simplest approach first:\r\n{noformat}\r\n# t1.pp\r\n\r\n$hash = {\r\n  foo => bar,\r\n  baz => [\r\n    quux,\r\n    { whatsit => whosit }\r\n  ]\r\n}\r\n\r\n$tree = $hash.tree_each\r\n\r\n$tree_array = Array($tree)\r\nnotice(inline_template('<% require \"pp\"; pp @tree_array %>'))\r\n{noformat}\r\nThe result was less than helpful:\r\n{noformat}\r\n$ puppet apply t1.pp\r\nError: Evaluation Error: Error while evaluating a Function Call, super: no superclass method `to_a' for #<Puppet::Pops::Types::Iterable::DepthFirstTreeIterator:0x0000000314be98>\r\nDid you mean?  to_s at /home/vagrant/t1.pp:13:15 on node localhost\r\n{noformat}\r\n\r\nNext, I tried something [~henrik.lindberg] suggested:\r\n{noformat}\r\n# t2.pp\r\n\r\n$hash = {\r\n  foo => bar,\r\n  baz => [\r\n    quux,\r\n    { whatsit => whosit }\r\n  ]\r\n}\r\n\r\n$tree = $hash.tree_each\r\n\r\n$tree_array = *$tree\r\nnotice(inline_template('<% require \"pp\"; pp @tree_array %>'))\r\n{noformat}\r\nThis gave me:\r\n{noformat}\r\n$ puppet apply t2.pp\r\n[#<Puppet::Pops::Types::Iterable::DepthFirstTreeIterator:0x000000043feea0\r\n  @containers_t=\r\n   #<Puppet::Pops::Types::PVariantType:0x00000003451598\r\n    @types=\r\n     [#<Puppet::Pops::Types::PArrayType:0x00000003211df0\r\n       @element_type=#<Puppet::Pops::Types::PAnyType:0x00000003204b00>,\r\n       @size_type=nil>,\r\n      #<Puppet::Pops::Types::PHashType:0x00000003211850\r\n       @key_type=#<Puppet::Pops::Types::PAnyType:0x00000003204b00>,\r\n       @size_type=nil,\r\n       @value_type=#<Puppet::Pops::Types::PAnyType:0x00000003204b00>>,\r\n      #<Puppet::Pops::Types::PObjectType:0x00000002c15de8\r\n       @annotations=nil,\r\n       @attributes={},\r\n       @checks=nil,\r\n       @equality=nil,\r\n       @equality_include_type=true,\r\n       @functions={},\r\n       @name=nil,\r\n       @parent=nil>]>,\r\n  @current_path=[],\r\n  @element_t=nil,\r\n  @include_refs=false,\r\n  @indexer_stack=[],\r\n  @recursed=false,\r\n  @root={\"foo\"=>\"bar\", \"baz\"=>[\"quux\", {\"whatsit\"=>\"whosit\"}]},\r\n  @value_stack=[{\"foo\"=>\"bar\", \"baz\"=>[\"quux\", {\"whatsit\"=>\"whosit\"}]}],\r\n  @with_containers=true,\r\n  @with_root=true,\r\n  @with_values=true>]\r\nNotice: Scope(Class[main]):\r\nNotice: Compiled catalog for localhost\r\n{noformat}\r\nAgain, not very useful.\r\n\r\nI tried passing the results of the {{*}} operator to the {{Array}} conversion...\r\n{noformat}\r\n# t3.pp\r\n\r\n$hash = {\r\n  foo => bar,\r\n  baz => [\r\n    quux,\r\n    { whatsit => whosit }\r\n  ]\r\n}\r\n\r\n$tree = $hash.tree_each\r\n\r\n$tree_array = Array(*$tree)\r\nnotice(inline_template('<% require \"pp\"; pp @tree_array %>'))\r\n{noformat}\r\nand got the same as the first attempt:\r\n{noformat}\r\n$ puppet apply t3.pp\r\nError: Evaluation Error: Error while evaluating a Function Call, super: no superclass method `to_a' for #<Puppet::Pops::Types::Iterable::DepthFirstTreeIterator:0x00000004b52878>\r\nDid you mean?  to_s at /home/vagrant/t3.pp:13:15 on node localhost\r\n{noformat}\r\n\r\nFinally, I used a {{map}} to convert it to itself:\r\n{noformat}\r\n# t4.pp\r\n\r\n$hash = {\r\n  foo => bar,\r\n  baz => [\r\n    quux,\r\n    { whatsit => whosit }\r\n  ]\r\n}\r\n\r\n$tree = $hash.tree_each\r\n\r\n$tree_array = $tree.map |$idx,$val| { [ $idx, $val ] }\r\nnotice(inline_template('<% require \"pp\"; pp @tree_array %>'))\r\n{noformat}\r\nand this gave something useful:\r\n{noformat}\r\n$ puppet apply t4.pp\r\n[[0, [[], {\"foo\"=>\"bar\", \"baz\"=>[\"quux\", {\"whatsit\"=>\"whosit\"}]}]],\r\n [1, [[\"foo\"], \"bar\"]],\r\n [2, [[\"baz\"], [\"quux\", {\"whatsit\"=>\"whosit\"}]]],\r\n [3, [[\"baz\", 0], \"quux\"]],\r\n [4, [[\"baz\", 1], {\"whatsit\"=>\"whosit\"}]],\r\n [5, [[\"baz\", 1, \"whatsit\"], \"whosit\"]]]\r\nNotice: Scope(Class[main]):\r\nNotice: Compiled catalog for localhost\r\n{noformat}\r\n\r\n[~henrik.lindberg] told me to submit a ticket, so here I am. :)","closed_at":"2019-10-21T07:57:52.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8393","labels":"","state":"Closed","updated_at":"2019-10-21T07:57:52.000-0700","timestamp":1652286262.537078,"priority":"Normal","status_category":"Done","pull_request":6572},{"issue_id":"244183","title":"Remove deprecation of empty(undef) introduced in PUP-8492","url":"https://tickets.puppetlabs.com/browse/PUP-8623","created_at":"2018-04-04T06:34:05.000-0700","number":"PUP-8623","body":"In PUP-8492 the empty function was moved from stdlib to puppet and it introduced a deprecation of calling {{empty(undef)}}. As discussed in PUP-8492, that deprecation is not wanted and it should be removed.\r\n","closed_at":"2019-10-21T07:59:58.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8623","labels":"","state":"Closed","updated_at":"2019-10-21T07:59:58.000-0700","timestamp":1652286262.864617,"priority":"Normal","status_category":"Done","pull_request":6776},{"issue_id":"324178","title":"Systemd provider is not correctly selected as the service provider if puppet is run as non root","url":"https://tickets.puppetlabs.com/browse/PUP-10016","created_at":"2019-09-10T06:16:31.000-0700","number":"PUP-10016","body":"*Puppet Version: 6.8.1*\r\n\r\nIt seems that this change breaks a few things when Puppet is not being run as root, for example during spec tests (i.e. pdk test unit).\r\n\r\nAt least under Ubuntu 16.04 and 18.04 the file /proc/1/exe is not accessible by regular users, so Puppet::FileSystem.exist?('/proc/1/exe') returns false and Puppet::FileSystem.readlink('/proc/1/exe').include?('systemd') fails with Errno::EACCES. ls also fails, obviously:\r\n\r\n{code}\r\n\r\n$ ls /proc/1/exe\r\nls: cannot read symbolic link '/proc/1/exe': Permission denied\r\nlrwxrwxrwx 1 root root 0 Sep  7 00:13 /proc/1/exe\r\nThis has interesting implications in that now Puppet no longer recognizes that systemd is the correct service provider for recent Debian and Ubuntu releases. Thus spec tests for services fail with cryptic error messages like this:\r\n{code}\r\n\r\n\r\n\r\n{code}\r\n$ pdk test unit\r\n...\r\nfailed: rspec: ./spec/classes/service_spec.rb:9: Could not find the daemon directory (tested [/etc/sv,/var/lib/service])\r\n{code}\r\n\r\n","closed_at":"2019-10-29T07:06:20.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10016","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-10-29T07:06:20.000-0700","timestamp":1652286263.388557,"priority":"Normal","status_category":"Done","pull_request":7706},{"issue_id":"305737","title":"Run rspec tests against ruby 2.6 or latest","url":"https://tickets.puppetlabs.com/browse/PUP-9650","created_at":"2019-04-22T10:05:50.000-0700","number":"PUP-9650","body":"Update travis and appveyor to test against ruby latest which is now ruby 2.6.3.","closed_at":"2019-11-12T17:07:27.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9650","labels":"","state":"Resolved","updated_at":"2019-11-12T17:07:27.000-0800","timestamp":1652286266.669685,"priority":"Normal","status_category":"Done","pull_request":7494},{"issue_id":"330903","title":"no_proxy does not exclude hosts whose FQDN matches based on suffix","url":"https://tickets.puppetlabs.com/browse/PUP-10106","created_at":"2019-10-19T11:52:20.000-0700","number":"PUP-10106","body":"*Puppet Version: 5.5.17*\r\n *Puppet Server Version: 5.3.10*\r\n *OS Name/Version: CentOS 7*\r\n\r\n*Original Summary* Since update to puppet 5.5.17 puppetdb forge module cannot connect to puppetdb\r\n\r\nSince the update to puppet agent 5.5.17 the puppetdb forge module is using the configured proxy server and ignoring the no_proxy setting when trying to validate the connection to puppetdb.  This worked properly on 5.5.16. \r\n\r\nMy environment proxy settings are:\r\n\r\n{noformat}\r\nhttp_proxy=http://ottinstall.ls.cbn:3128\r\nftp_proxy=http://ottinstall.ls.cbn:3128\r\nhttps_proxy=http://ottinstall.ls.cbn:3128\r\nno_proxy=ls.cbn, localhost, puppet, 127.0.0.1\r\n{noformat}\r\n\r\nMy puppetdb server is: {{https://glycon.ls.cbn:8081}}\r\n\r\n*Desired Behavior:* \r\n\r\nRespect the no_proxy value {{ls.cbn}} and not proxy connections to {{https://glycon.ls.cbn:8018}}\r\n\r\n*Actual Behavior:*\r\n\r\n{noformat}\r\nopening connection to ottinstall.ls.cbn:3128...\r\nopened\r\n<- \"CONNECT glycon.ls.cbn:8081 HTTP/1.1\\r\\nHost: glycon.ls.cbn:8081\\r\\n\\r\\n\"\r\n-> \"HTTP/1.1 403 Forbidden\\r\\n\"\r\n-> \"Server: squid/3.5.20\\r\\n\"\r\n-> \"Mime-Version: 1.0\\r\\n\"\r\n-> \"Date: Sat, 19 Oct 2019 18:46:40 GMT\\r\\n\"\r\n-> \"Content-Type: text/html;charset=utf-8\\r\\n\"\r\n-> \"Content-Length: 3448\\r\\n\"\r\n-> \"X-Squid-Error: ERR_ACCESS_DENIED 0\\r\\n\"\r\n-> \"Vary: Accept-Language\\r\\n\"\r\n-> \"Content-Language: en\\r\\n\"\r\n-> \"X-Cache: MISS from ottinstall.ls.cbn\\r\\n\"\r\n-> \"X-Cache-Lookup: NONE from ottinstall.ls.cbn:80\\r\\n\"\r\n-> \"Via: 1.1 ottinstall.ls.cbn (squid/3.5.20)\\r\\n\"\r\n-> \"Connection: keep-alive\\r\\n\"\r\n-> \"\\r\\n\"\r\nConn close because of connect error 403 \"Forbidden\"\r\nNotice: Unable to connect to puppetdb server (https://glycon.ls.cbn:8081): 403 \"Forbidden\"\r\n{noformat}","closed_at":"2019-11-15T15:42:05.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10106","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-11-15T15:42:05.000-0800","timestamp":1652286267.612002,"priority":"Normal","status_category":"Done","pull_request":7810},{"issue_id":"329033","title":"Exec resource should not leak sensitive commands when a relative path is given","url":"https://tickets.puppetlabs.com/browse/PUP-10100","created_at":"2019-10-11T09:56:14.000-0700","number":"PUP-10100","body":"From: https://tickets.puppetlabs.com/browse/PUP-6494?focusedCommentId=692157&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-692157\r\n\r\n{code:puppet}\r\nexec { \"echo_passphrase\":\r\n command => Sensitive(\"echo \\\"${secretpw.unwrap}\\\"\"),\r\n}\r\n{code}\r\n\r\n{noformat}\r\nError: Failed to apply catalog: Validation of Exec[populate_luksfile] failed: 'echo \"supersecretpassword\"' is not qualified and no path was specified. Please qualify the command or specify a path.\r\n{noformat}\r\n\r\nThe issue is the error message includes the entire command to execute, instead of the first component of command which wasn't an absolute path.","closed_at":"2019-11-15T16:32:03.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10100","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-11-15T16:32:03.000-0800","timestamp":1652286267.716966,"priority":"Normal","status_category":"Done","pull_request":7784},{"issue_id":"325377","title":"skip_tags not documented for puppet agent","url":"https://tickets.puppetlabs.com/browse/PUP-10026","created_at":"2019-09-19T05:42:37.000-0700","number":"PUP-10026","body":"*Puppet Version: 5.5.16*\r\n *Puppet Server Version: 5.5.16*\r\n *OS Name/Version: FreeBSD-12-RELEASE*\r\n\r\npuppet agent --help\r\n\r\n...\r\n'--tags' allows you to specify what portions of a configuration you want\r\nto apply. Puppet elements are tagged with all of the class or definition\r\nnames that contain them, and you can use the 'tags' flag to specify one\r\nof these names, causing only configuration elements contained within\r\nthat class or definition to be applied. This is very useful when you are\r\ntesting new configurations -- for instance, if you are just starting to\r\nmanage 'ntpd', you would put all of the new elements into an 'ntpd'\r\nclass, and call puppet with '--tags ntpd', which would only apply that\r\nsmall portion of the configuration during your testing, rather than\r\napplying the whole thing.\r\n\r\n...\r\n\r\n*Desired Behavior:*\r\n\r\nAdd a section describing --skip_tags option.\r\n\r\n*Actual Behavior:*\r\n\r\nSee above\r\n\r\n ","closed_at":"2019-11-16T12:21:46.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10026","labels":"beginner;resolved-issue-added","state":"Resolved","updated_at":"2019-11-16T12:21:46.000-0800","timestamp":1652286267.928018,"priority":"Minor","status_category":"Done","pull_request":7763},{"issue_id":"297090","title":"Puppet 3 API functions should be loaded from the pluginsync location as part of the cache system loader","url":"https://tickets.puppetlabs.com/browse/PUP-9509","created_at":"2019-02-22T01:08:29.000-0800","number":"PUP-9509","body":"*Puppet Version:* 6.3.0\r\n*Puppet Server Version:* N/A\r\n*OS Name/Version:* Windows 10 - 1803 Ruby 2.5\r\n\r\nDescribe your issue in as much detail as possible...\r\nDescribe steps to reproduce...\r\n\r\n*Desired Behavior:*\r\nPuppet 3 API functions that are plugin sync'd should be loaded from the cache libdir\r\n\r\n*Actual Behavior:*\r\nPuppet 3 API functions are missing\r\n\r\nPreviously in PUP-6964 (https://github.com/puppetlabs/puppet/pull/7019) the system loader was modified to to be able to load Puppet 3 API functions;\r\n\r\nof note - https://github.com/puppetlabs/puppet/pull/7019/files#diff-83a8daf215ff39828e0e3758c2e5a866R34\r\n\r\nSee how the system loader has loadables of {{[:func_4x, :func_3x, :datatype]}}\r\n\r\nHowever when the system cache loader was introduced in PUP-9035 (https://github.com/puppetlabs/puppet/commit/7404ee14745c78bd4a3173c79cac198809faea74 ) the loadables specified did not include the Puppet 3 API functions.\r\n\r\nof note - https://github.com/puppetlabs/puppet/pull/6963/files#diff-83a8daf215ff39828e0e3758c2e5a866R30\r\n\r\nSee how the cache loader has loadables of {{[:func_4x, :datatype]}}\r\n\r\nThe comment at https://github.com/puppetlabs/puppet/pull/6963/files#diff-83a8daf215ff39828e0e3758c2e5a866R22 says they should be the same but is clear they are not.\r\n\r\nAlso note that the acceptance tests do not test for this;\r\nhttps://github.com/puppetlabs/puppet/pull/6963/files#diff-d3791ca879b2c6c0586dd8974a7bec0eR25\r\n\r\nThat is just a Puppet 4 API location","closed_at":"2019-11-18T09:45:14.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9509","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-11-18T09:45:14.000-0800","timestamp":1652286268.137268,"priority":"Normal","status_category":"Done","pull_request":7793},{"issue_id":"117135","title":"exec resources fail unless cwd is readable","url":"https://tickets.puppetlabs.com/browse/PUP-5915","created_at":"2016-02-17T10:44:17.000-0800","number":"PUP-5915","body":"The {{exec()}} resource always attempts to perform a {{chdir()}} to the current working directory (cwd). This is true regardless of the value of the {{cwd}} parameter.\r\n\r\nIf the cwd isn't accessible by the user running Puppet, Puppet will fail to apply the {{exec()}} resource. This is true regardless of whether the command being executed actually requires the cwd to be readable.\r\n\r\nAn example:\r\n\r\n{noformat}\r\n$ cd /tmp\r\n$ mkdir test\r\n$ cd test\r\n$ chmod 0000 .\r\n\r\n$ puppet apply -e 'exec { \"/bin/pwd\": logoutput => true }'\r\nNotice: Compiled catalog for myhost.example.org in environment production in 0.05 seconds\r\nError: Permission denied @ dir_chdir - /tmp/test\r\nError: /Stage[main]/Main/Exec[/bin/pwd]/returns: change from notrun to 0 failed: Permission denied @ dir_chdir - /tmp/test\r\nNotice: Applied catalog in 0.04 seconds\r\n\r\n$ puppet apply -e 'exec { \"/bin/pwd\": logoutput => true, cwd => \"/\" }'\r\nNotice: Compiled catalog for myhost.example.org in environment production in 0.06 seconds\r\nError: Permission denied @ dir_chdir - /tmp/test\r\nError: /Stage[main]/Main/Exec[/bin/pwd]/returns: change from notrun to 0 failed: Permission denied @ dir_chdir - /tmp/test\r\nNotice: Applied catalog in 0.05 seconds\r\n{noformat}\r\n\r\nIf the cwd is accessible, the {{exec}} will succeed:\r\n\r\n{noformat}\r\n$ chmod 0755 .\r\n\r\n$ puppet apply -e 'exec { \"/bin/pwd\": logoutput => true }'\r\nNotice: Compiled catalog for myhost.example.org in environment production in 0.05 seconds\r\nNotice: /Stage[main]/Main/Exec[/bin/pwd]/returns: /tmp/test\r\nNotice: /Stage[main]/Main/Exec[/bin/pwd]/returns: executed successfully\r\nNotice: Applied catalog in 0.05 seconds\r\n\r\n{noformat}\r\n\r\nYou may be tempted to respond: \"Why does this matter? It's almost never useful to run Puppet as a non-root user, and the root user has implicit access to all files and directories.\"\r\n\r\nThe problem is that this is not true.\r\n\r\nAt our site, we are deploying NFSv4 user home directories, where home directories are mounted from an NFSv4 server with sec=krb5p (that is, with Kerberos security). In such a scenario, the root user always and implicit possesses host/hostname@DOMAIN credentials, and nothing more.\r\n\r\nUser home directories are private (mode 0700) by default. Effectively, this means that the root user is unable to {{chdir()}} to a user's home directory, or any subdirectory thereof.\r\n\r\nAs we began to deploy NFSv4 user home directories, developers who run {{sudo puppet agent --test}} from the command line began reporting Puppet failures. Investigating the problems let us to discover the {{exec}} resource's behavior of always attempting to {{chdir()}} to the cwd, regardless of what the {{cwd}} parameter is set to (or whether it's defined at all).\r\n\r\nOur developers get hit by this because they are typically sitting in their (NFSv4-based) home directory when they attempt to run {{sudo puppet agent --test}}.\r\n\r\nI would argue that the {{exec}} resource should behave this way:\r\n\r\n# If the {{cwd}} parameter is defined, the {{exec}} resource attempts to {{chdir()}} to that directory, and _only_ that directory.\r\n# If the {{cwd}} parameter is undefined, the {{exec}} resource should not call {{chdir()}} at all.\r\n\r\nThe current behavior of the {{exec}} resource is at best extremely non-intuitive and at worst outright incorrect, even if it only causes problems when specific (and uncommon) conditions are met (i.e., root not having implicit access to the cwd).\r\n\r\nThoughts?","closed_at":"2019-11-18T10:28:27.000-0800","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5915","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-11-18T10:28:27.000-0800","timestamp":1652286268.250892,"priority":"Normal","status_category":"Done","pull_request":7775},{"issue_id":"283215","title":"Notify resource exposes Sensitive data when message is a Sensitive data","url":"https://tickets.puppetlabs.com/browse/PUP-9295","created_at":"2018-10-31T08:09:01.000-0700","number":"PUP-9295","body":"*Puppet Version: 6.0.2*\r\n *Puppet Server Version: 2019.0.0*\r\n *OS Name/Version: Mac OS X, also confirmed on Linux by customer*\r\n\r\nThe Notify{} resource will leak Sensitive data if the message is a raw value of Sensitive() type.\r\n\r\nIt looks like the Notify{} resource is mishandling the processing of the message parameter if the input is a raw Sensitive datatype (not encapsulated in double quotes).\r\n\r\n*Desired Behavior:*\r\n\r\nNo Sensitive data should be output in clear text.\r\n\r\n*Actual Behavior:*\r\n\r\nFor example, in the following code both message 1 and 2 leak sensitive data:\r\n{code:java}\r\n$secret = Sensitive('s3cret')\r\nnotify { 'Sensitive message 1':\r\n message => $secret,\r\n}\r\nnotify { 'Sensitive message 2':\r\n message => Sensitive('s3cret2'),\r\n}\r\nnotify { 'Sensitive message 3':\r\n message => \"${secret}\",\r\n}\r\n{code}\r\nOutput:\r\n{noformat}\r\nNotice: Compiled catalog for kevin.reeuwijk-c02tp0a7g8wl in environment production in 0.03 seconds\r\nNotice: s3cret\r\nNotice: /Stage[main]/Main/Notify[Sensitive message 1]/message: changed [redacted] to [redacted]\r\nNotice: s3cret2\r\nNotice: /Stage[main]/Main/Notify[Sensitive message 2]/message: changed [redacted] to [redacted]\r\nNotice: Sensitive [value redacted]\r\nNotice: /Stage[main]/Main/Notify[Sensitive message 3]/message: defined 'message' as 'Sensitive [value redacted]'\r\nNotice: Applied catalog in 0.02 seconds{noformat}\r\nThere are two messages in the output that should not appear:\r\n\r\n \r\n{noformat}\r\nNotice: s3cret\r\nNotice: s3cret2\r\n{noformat}","closed_at":"2019-11-19T09:16:33.000-0800","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9295","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-11-19T09:16:33.000-0800","timestamp":1652286268.367306,"priority":"Major","status_category":"Done","pull_request":7770},{"issue_id":"332037","title":"no_proxy config setting is ignored when http_proxy environment variable is set","url":"https://tickets.puppetlabs.com/browse/PUP-10112","created_at":"2019-10-24T15:14:33.000-0700","number":"PUP-10112","body":"If a host matches the {{no_proxy}} exception list set in the environment or puppet.conf, then ruby may decide to use the proxy due to the way that Puppet creates the Net::HTTP object. See PUP-9990 for more details.","closed_at":"2019-11-19T09:17:24.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10112","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-11-19T09:17:24.000-0800","timestamp":1652286268.482249,"priority":"Normal","status_category":"Done","pull_request":7791},{"issue_id":"55473","title":"Systemd provider doesn't scan for changed units","url":"https://tickets.puppetlabs.com/browse/PUP-3483","created_at":"2014-10-17T09:32:32.000-0700","number":"PUP-3483","body":"When a package updates it's sysvinit script or systemd unit (or for that matter if I were to be manually managing a systemd unit with a file resource), nothing ever tells systemd to check for changed units. \r\n\r\nTypically you would invoke `systemctl daemon-reload` to scan for new and changed units. \r\n\r\n","closed_at":"2019-11-19T16:08:18.000-0800","comments":26,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3483","labels":"community;resolved-issue-added;systemd;type_and_provider","state":"Closed","updated_at":"2019-11-19T16:08:18.000-0800","timestamp":1652286268.712369,"priority":"Critical","status_category":"Done","pull_request":7126},{"issue_id":"175424","title":"systemd service provider missing double dash","url":"https://tickets.puppetlabs.com/browse/PUP-7218","created_at":"2017-02-14T04:55:59.000-0800","number":"PUP-7218","body":"The systemd service provider doesn't use double dashes for ending options, meaning that it will fail on any service with a name beginning with a {{-}} (dash):\r\n\r\n{noformat}\r\n13:52:54 runejuhl@tolu:~\r\n$ /opt/puppetlabs/bin/puppet --version\r\n4.9.2\r\n13:53:00 runejuhl@tolu:~ \r\n$ /opt/puppetlabs/bin/puppet apply -e \"service { '-h-asd': enable=>true}\" | head\r\nNotice: Compiled catalog for tolu.petardo.dk in environment production in 0.27 seconds\r\nsystemctl [OPTIONS...] {COMMAND} ...\r\n\r\nQuery or send control commands to the systemd manager.\r\n\r\n  -h --help           Show this help\r\n     --version        Show package version\r\n     --system         Connect to system manager\r\n     --user           Connect to user service manager\r\n  -H --host=[USER@]HOST\r\nError: Failed to apply catalog: Broken pipe @ io_write - <STDOUT>\r\n{noformat}\r\n\r\nUnits starting with {{-}} are fairly common in systemd, e.g. the {{\\-.mount}} unit.\r\n\r\nFor a quick fix, it looks like changing https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/service/systemd.rb#L47 like this would work (albeit only when enabling/disabling):\r\n\r\n{noformat}\r\n- output = systemctl(action, @resource[:name])\r\n+ output = systemctl(action, '--', @resource[:name])\r\n{noformat}","closed_at":"2019-11-19T16:08:18.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7218","labels":"beginner;linux;provider;resolved-issue-added;service;systemd;type_and_provider","state":"Resolved","updated_at":"2019-11-19T16:08:18.000-0800","timestamp":1652286268.828721,"priority":"Normal","status_category":"Done","pull_request":7798},{"issue_id":"329426","title":"puppet device fails when using csr_attributes.yaml","url":"https://tickets.puppetlabs.com/browse/PUP-10104","created_at":"2019-10-15T03:07:56.000-0700","number":"PUP-10104","body":"Whilst trying to use trusted facts for my puppet device, I noticed the `puppet device --target devicename` fail with the error \"OBJ_txt2obj: first num too large\". However, manually requesting the cert with `puppet ssl` does work and behaves as expected. Guessing it's related to [PUP-9746|https://tickets.puppetlabs.com/browse/PUP-9746], or at least a similar issue.\r\n\r\n*Desired Behavior:* First `puppet device` run should request a cert with correct extension requests\r\n\r\n*Actual Behavior:* First `puppet device` run fails with \"Cannot create CSR with extension request extension_name: OBJ_txt2obj: first num too large\"","closed_at":"2019-11-21T01:58:01.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10104","labels":"beginner;resolved-issue-added","state":"Closed","updated_at":"2019-11-21T01:58:01.000-0800","timestamp":1652286269.045614,"priority":"Normal","status_category":"Done","pull_request":7816},{"issue_id":"333915","title":"Could not request certificate","url":"https://tickets.puppetlabs.com/browse/PUP-10121","created_at":"2019-11-07T06:21:13.000-0800","number":"PUP-10121","body":"*Puppet Version: 5.5.17*\r\n *Puppet Server Version: 5.3.6*\r\n *OS Name/Version: RHEL 7.7*\r\n\r\nI am migrating RHEL servers from RHS 5 to 6. Everything is working properly, except for requesting Puppet Certificate. After editing my puppet.conf on my client, and do a puppet agent -t for example, I have error \"Error: Could not request certificate: wrong number of arguments (given 1, expected 2)\".\r\n\r\n*Desired Behavior: Get an actual certificate request*\r\n\r\n*Actual Behavior: Got the error \"Error: Could not request certificate: wrong number of arguments (given 1, expected 2)\".*\r\n\r\n \r\n\r\nDebug: Selected server from the ca_server setting: [RHS URL]\r\nDebug: Selected port from the ca_port setting: 8140\r\nDebug: Creating new connection for [RHS URL]:8140\r\nError: Could not request certificate: wrong number of arguments (given 1, expected 2)\r\n/opt/puppetlabs/puppet/lib/ruby/2.4.0/net/http/exceptions.rb:6:in `initialize'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/connection.rb:322:in `new'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/connection.rb:322:in `rescue in execute_request'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/connection.rb:306:in `execute_request'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/connection.rb:186:in `block (2 levels) in do_request'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/connection.rb:332:in `block in with_connection'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/nocache_pool.rb:15:in `with_connection'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/connection.rb:331:in `with_connection'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/connection.rb:183:in `block in do_request'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/connection.rb:180:in `upto'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/connection.rb:180:in `do_request'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/connection.rb:80:in `get'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/rest.rb:160:in `http_request'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/rest.rb:139:in `http_get'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/rest.rb:174:in `block in find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/rest.rb:263:in `block in do_request'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/request.rb:231:in `do_request'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/rest.rb:263:in `do_request'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/rest.rb:167:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/certificate/rest.rb:12:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:198:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/ssl/host.rb:201:in `certificate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/ssl/host.rb:329:in `wait_for_cert'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:483:in `wait_for_certificates'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:349:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:667:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:139:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:77:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\n\r\n ","closed_at":"2019-11-22T08:09:49.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10121","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-11-22T08:09:49.000-0800","timestamp":1652286278.999828,"priority":"Normal","status_category":"Done","pull_request":7844},{"issue_id":"242078","title":"Augeas unable to handle escaped quotes within quotes","url":"https://tickets.puppetlabs.com/browse/PUP-8561","created_at":"2018-03-20T07:48:22.000-0700","number":"PUP-8561","body":"*Puppet Version: 5.4.0*\r\n *Puppet Server Version: 5.2.0*\r\n *OS Name/Version: CentOS 7.4.1708*\r\n\r\nI am unable to find a way to set the \"log_format\" variable in nginx.conf using augeas. The problem seems to be the combination of quotes within quotes just doesn't seem to be possible.\r\n\r\nThe desired value I am trying to set exactly is:\r\n{noformat}timed_combined  '$remote_addr - $remote_user $http_x_unit_id [$time_local] \"$request\" $status $body_bytes_sent \"$http_referer\" \"$http_user_agent\" $request_time $upstream_response_time $pipe'{noformat}\r\nTake careful note that I need to have the long single quoted string, but that this contains some double quoted strings. I have tried every possible combination I can think of for enclosing in single or double quoted strings in and for escaping then, but I have not successfully managed to set exactly what is required. I have tried so many different possible ways over the last 2 days that I am now convinced I haven't missed something and that this has to be a bug.\r\n\r\nTo describe some of the more obvious steps I have tried, lets store the initial variables like as following:\r\n{code:puppet}\r\n#The log title:\r\n$log_title = 'timed_combined'\r\n\r\n#Set-up the needed log_format string:\r\n$log_format_str = '$remote_addr - $remote_user $http_x_unit_id [$time_local] \"$request\" $status $body_bytes_sent \"$http_referer\" \"$http_user_agent\" $request_time $upstream_response_time $pipe'\r\n{code}\r\nThe initial most logical combination of options that I have tried are (elaborated here to try and make it clear):\r\n\r\n*Attempt 1*\r\nEscape the double quotes within the substring, then pass the variable in augeas with escaped quotes:\r\n{code:puppet}\r\n# Create the combined string\r\n$use_log_format = regsubst(\"${log_title} '${log_format_str}'\", '\"', '\\\\\"', 'G')\r\n\r\naugeas { 'set-up_log_format':\r\n    context => \"/files${conf_file}/http\",\r\n    changes => [\r\n        \"set log_format \\\"${use_log_format}\\\"\"\r\n    ]\r\n}\r\n{code}\r\nProduces:\r\n{noformat}\r\n-    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\r\n-                      '$status $body_bytes_sent \"$http_referer\" '\r\n-                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\r\n+    log_format  timed_combined  '$remote_addr - $remote_user $http_x_unit_id [$time_local] \\\"$request\\\" $status $body_bytes_sent \\\"$http_referer\\\" \\\"$http_user_agent\\\" $request_time $upstream_response_time $pipe';\r\n{noformat}\r\n*Result:* Produces almost exactly what I want, but unfortunately the escapes have been passed through and retained. The result is confirmed when grep'ing the file:\r\n{noformat}\r\nroot@devsvr2 ~]# grep log_format /etc/nginx/nginx.conf\r\n    log_format  timed_combined  '$remote_addr - $remote_user $http_x_unit_id [$time_local] \\\"$request\\\" $status $body_bytes_sent \\\"$http_referer\\\" \\\"$http_user_agent\\\" $request_time $upstream_response_time $pipe';\r\n{noformat}\r\nMaybe I do not need the escapes? Let's try without...\r\n\r\n*Attempt 2*\r\nDon't escape the double quotes within the substring, but still pass the variable in augeas with escaped quotes:\r\n{code:puppet}\r\n# Create the combined string\r\n$use_log_format = \"${log_title} '${log_format_str}'\"\r\n\r\naugeas { 'set-up_log_format':\r\n    context => \"/files${conf_file}/http\",\r\n    changes => [\r\n        \"set log_format \\\"${use_log_format}\\\"\"\r\n    ]\r\n}\r\n{code}\r\nProduces:\r\n{noformat}\r\n-    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\r\n-                      '$status $body_bytes_sent \"$http_referer\" '\r\n-                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\r\n+    log_format  timed_combined  '$remote_addr - $remote_user $http_x_unit_id [$time_local] ;\r\n{noformat}\r\n*Result:* As you might expect, the unescaped quotes cause the value to be truncated completely. How about we wrap it in single quotes in the augeas command instead? Let's try it...\r\n\r\n*Attempt 3*\r\nSingle quotes in the augeas command instead of the escaped doubles:\r\n{code:puppet}\r\n# Create the combined string\r\n$use_log_format = \"${log_title} '${log_format_str}'\"\r\n\r\naugeas { 'set-up_log_format':\r\n    context => \"/files${conf_file}/http\",\r\n    changes => [\r\n        \"set log_format '${use_log_format}'\"\r\n    ]\r\n}\r\n{code}\r\nProduces:\r\n{noformat}\r\n-    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\r\n-                      '$status $body_bytes_sent \"$http_referer\" '\r\n-                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\r\n+    log_format  timed_combined  ;\r\n{noformat}\r\n*Result:* Now we've lost the value altogether. Maybe I'd better escape those single quotes in the string too...\r\n\r\n*Attempt 4*\r\n*Single quotes in the augeas command, but add escapes to the single quotes that define the substring in the variable*\r\n{code:puppet}\r\n# Create the combined string\r\n$use_log_format = \"${log_title} \\\\'${log_format_str}\\\\'\"\r\n\r\naugeas { 'set-up_log_format':\r\n    context => \"/files${conf_file}/http\",\r\n    changes => [\r\n        \"set log_format '${use_log_format}'\"\r\n    ]\r\n}\r\n{code}\r\nProduces:\r\n{noformat}\r\n-    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\r\n-                      '$status $body_bytes_sent \"$http_referer\" '\r\n-                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\r\n+    log_format  timed_combined  \\'$remote_addr - $remote_user $http_x_unit_id [$time_local] \"$request\" $status $body_bytes_sent \"$http_referer\" \"$http_user_agent\" $request_time $upstream_response_time $pipe\\';\r\n{noformat}\r\n*Result:* Oh wonderful! Now we have a the reverse of attempt 1 - the escaped single quotes have now been passed through to the final output. Again, confirming this is real and not just in the displayed output:\r\n{noformat}\r\n[root@devsvr2 ~]# grep log_format /etc/nginx/nginx.conf\r\n    log_format  timed_combined  \\'$remote_addr - $remote_user $http_x_unit_id [$time_local] \"$request\" $status $body_bytes_sent \"$http_referer\" \"$http_user_agent\" $request_time $upstream_response_time $pipe\\';\r\n{noformat}\r\n\r\nAs you can see, this is how I began. I tried adding various extra levels of escape and switching back and forth between single and double quotes, but nothing worked.\r\n\r\nI then eventually tried to apply the same set-up manually using augtool, and it didn't take long to get a working result:\r\n*Attempt 1:*\r\nSet the line value, in double quotes, with no escapes:\r\n{noformat}\r\naugtool> set /files/etc/nginx/nginx.conf/http/log_format \"timed_combined  '$remote_addr - $remote_user $http_x_unit_id [$time_local] \"$request\" $status $body_bytes_sent \"$http_referer\" \"$http_user_agent\" $request_time $upstream_response_time $pipe'\"\r\n{noformat}\r\n*Produces:*\r\n{noformat}\r\naugtool> print /files/etc/nginx/nginx.conf/http/log_format\r\n/files/etc/nginx/nginx.conf/http/log_format = \"timed_combined  '$remote_addr - $remote_user $http_x_unit_id [$time_local] $request $status $body_bytes_sent $http_referer $http_user_agent $request_time $upstream_response_time $pipe'\"\r\n{noformat}\r\n*Result:* Missing the double quotes in the output. Okay, I'll try escaping them:\r\n\r\n*Attempt 2:*\r\nSet the line value, in double quotes, and escape the double quotes in the substring:\r\n{noformat}\r\naugtool> set /files/etc/nginx/nginx.conf/http/log_format \"timed_combined  '$remote_addr - $remote_user $http_x_unit_id [$time_local] \\\"$request\\\" $status $body_bytes_sent \\\"$http_referer\\\" \\\"$http_user_agent\\\" $request_time $upstream_response_time $pipe'\"\r\n{noformat}\r\n*Produces:*\r\n{noformat}\r\naugtool> print /files/etc/nginx/nginx.conf/http/log_format\r\n/files/etc/nginx/nginx.conf/http/log_format = \"timed_combined  '$remote_addr - $remote_user $http_x_unit_id [$time_local] \\\"$request\\\" $status $body_bytes_sent \\\"$http_referer\\\" \\\"$http_user_agent\\\" $request_time $upstream_response_time $pipe'\"\r\n{noformat}\r\n*Result:* Escapes are shown in the output value above, but when 'save' is run and we check the file on disk, we can see that it is actually correct:\r\n{noformat}\r\n[root@devsvr2 ~]# grep log_format /etc/nginx/nginx.conf\r\n    log_format  timed_combined  '$remote_addr - $remote_user $http_x_unit_id [$time_local] \"$request\" $status $body_bytes_sent \"$http_referer\" \"$http_user_agent\" $request_time $upstream_response_time $pipe';\r\n{noformat}\r\n\r\nSo, I guess the ultimate question is: Is this a bug, or is this the correct expected behaviour? If it is the latter, then this feature is becomes pretty unusable.\r\n\r\nBefore posting, I did a fair amount of searching for someone else with the exact same issue, and though I found plenty of comments/tickets/posts from people with similar issues, none were the exact same issue as mine; but I apologise now if the above for the slightest moment wastes someone's time.","closed_at":"2019-12-10T04:14:57.000-0800","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8561","labels":"","state":"Closed","updated_at":"2019-12-10T04:14:57.000-0800","timestamp":1652286279.84995,"priority":"Normal","status_category":"Done","pull_request":6759},{"issue_id":"21416","title":"pip provider should handle multiple pips/pythons","url":"https://tickets.puppetlabs.com/browse/PUP-1082","created_at":"2013-12-16T11:06:29.000-0800","number":"PUP-1082","body":"The Pip provider should provide a way to specify the path to pip.  This would allow people to manage multiple python installs, by pointing to the one they want to install into.  \r\n\r\nIn RHEL, this makes it easy to have a non-system python installed somewhere (ie: 2.7 or 3.x) and let puppet manage the python packages.\r\n\r\nThis is related to bug #15980.  (related in the way that if you could provide the path to the pip binary, 15980 would have a workaround).","closed_at":"2019-12-10T07:41:57.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1082","labels":"package;pip;redmine;resolved-issue-added;type_and_provider","state":"Resolved","updated_at":"2019-12-10T07:41:57.000-0800","timestamp":1652286280.06518,"priority":"Normal","status_category":"Done","pull_request":8823},{"issue_id":"42950","title":"Rapid-fire puppet runs cause race condition with SSL data","url":"https://tickets.puppetlabs.com/browse/PUP-2958","created_at":"2014-07-21T14:16:44.000-0700","number":"PUP-2958","body":"It appears that two rapid-fire puppet runs can cause a race condition of some kind when:\r\n\r\n# Puppet requests a certificate from the master.\r\n# An additional puppet run is triggered immediately, before the signed certificate is received.\r\n# New private keys are generated - but the master has already received the original CSR.\r\n# The master continuously returns the original certificate, which does not match the newly generated private keys / csr on the agent, from the second puppet run.\r\n\r\nThis shouldn't be possible, but I've seen it demonstrated by a customer.\r\n\r\nIt's also possible I'm misinterpreting exactly what is happening.\r\n\r\n/cc [~reid] for comment - he's seen the bug in the past but couldn't nail it down cohesively.","closed_at":"2019-12-10T07:44:06.000-0800","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2958","labels":"customer;resolved-issue-added;support","state":"Resolved","updated_at":"2019-12-10T07:44:06.000-0800","timestamp":1652286280.180075,"priority":"Normal","status_category":"Done","pull_request":7555},{"issue_id":"97917","title":"puppet inspect is using wrong path for catalog data","url":"https://tickets.puppetlabs.com/browse/PUP-5233","created_at":"2015-09-14T00:35:09.000-0700","number":"PUP-5233","body":"Deploying Puppet 4 at a client which makes heavy use of {{puppet inspect}} and found that Puppet 4 uses the wrong path to find the client catalog.\r\n\r\n{code}\r\n[vagrant@client ~]$ sudo puppet agent --test\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for client.example.com\r\nInfo: Applying configuration version '1442215415'\r\nNotice: /Stage[main]/Main/File[/etc/hosts]/content: audit change: previously recorded value {md5}e2b06541983600068fff455f8c11861a has been changed to {md5}28c9f9f5a3d060a500d4b57f9875ba32\r\nNotice: Applied catalog in 0.39 seconds\r\n\r\n[vagrant@client ~]$ sudo puppet inspect\r\nError: Could not run: Could not find catalog for client.example.com\r\n{code}\r\n\r\nStrace shows us that it's looking in the {{client_yaml}} directory instead of {{client_data}}.\r\n\r\n{code}\r\n[pid  7817] lstat(\"/opt/puppetlabs\", {st_mode=S_IFDIR|0755, st_size=42, ...}) = 0\r\n[pid  7817] lstat(\"/opt/puppetlabs/puppet\", {st_mode=S_IFDIR|0755, st_size=102, ...}) = 0\r\n[pid  7817] lstat(\"/opt/puppetlabs/puppet/lib\", {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0\r\n[pid  7817] lstat(\"/opt/puppetlabs/puppet/lib/ruby\", {st_mode=S_IFDIR|0755, st_size=47, ...}) = 0\r\n[pid  7817] lstat(\"/opt/puppetlabs/puppet/lib/ruby/vendor_ruby\", {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0\r\n[pid  7817] lstat(\"/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet\", {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0\r\n[pid  7817] lstat(\"/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector\", {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0\r\n[pid  7817] lstat(\"/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/yaml.rb\", {st_mode=S_IFREG|0644, st_size=1940, ...}) = 0\r\n[pid  7817] stat(\"/etc/puppetlabs/puppet/routes.yaml\", 0x7fff96c96bd0) = -1 ENOENT (No such file or directory)\r\n[pid  7817] stat(\"/opt/puppetlabs/puppet/cache/client_yaml/catalog/client.example.com.yaml\", 0x7fff96c96bd0) = -1 ENOENT (No such file or directory)\r\n[pid  7817] write(2, \"\\33[1;31mError: Could not run: Cou\"..., 78Error: Could not run: Could not find catalog for client.example.com) = 78\r\n{code}\r\n\r\nThe catalog is actually stored in {{/opt/puppetlabs/puppet/cache/client_data/catalog/}}. \r\n\r\nFurthermore, the catalog is now in JSON format not YAML, and there's no documented command line option to read this properly.\r\n\r\n{code}\r\n$ ls -la /opt/puppetlabs/puppet/cache/client_data/catalog/\r\ntotal 24\r\ndrwxr-xr-x 2 root root    64 Sep 14 07:46 .\r\ndrwxr-x--- 3 root root    20 Aug  2 22:49 ..\r\n-rw-rw---- 1 root root 16947 Sep 14 07:46 client.example.com.json\r\n{code}","closed_at":"2019-12-10T07:44:54.000-0800","comments":16,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5233","labels":"","state":"Closed","updated_at":"2019-12-10T07:44:54.000-0800","timestamp":1652286280.293761,"priority":"Major","status_category":"Done","pull_request":4772},{"issue_id":"151753","title":"Windows service in Paused state cannot be managed","url":"https://tickets.puppetlabs.com/browse/PUP-6702","created_at":"2016-09-14T03:33:40.000-0700","number":"PUP-6702","body":"When a service is in the Paused state; it's 'ensure' property cannot be managed by Puppet\r\n\r\nNote that for our own services that use nssm; nssm has a characteristic that it uses the \"Paused\" service state for a service that has reached a fault state (see https://nssm.cc/usage )\r\n\r\n*To reproduce:*\r\n * Install puppet-agent\r\n * Ensure pxp-agent service is stopped in services.msc\r\n * Ensure the ProgramData/PuppetLabs/pxp-agent/etc/pxp-agent.conf file is renamed or deleted\r\n * Run _puppet resource service pxp-agent ensure=running_\r\n\r\nThe service will now be in the paused state. \r\nAttempting _puppet resource service pxp-agent ensure=stopped_ will echo back ensure=stopped , but services.msc will show the service as still paused. \r\nAttempting _puppet resource service pxp-agent ensure=running_ will return an error:\r\n\r\n{noformat}C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Puppet>puppet resource serv\r\nice pxp-agent ensure=running\r\nError: Cannot start pxp-agent, error was: Execution of 'C:/Windows/system32/net.\r\nexe start pxp-agent' returned 2: The requested service has already been started.\r\n\r\n\r\nMore help is available by typing NET HELPMSG 2182.\r\nWrapped exception:\r\nExecution of 'C:/Windows/system32/net.exe start pxp-agent' returned 2: The reque\r\nsted service has already been started.\r\n\r\nMore help is available by typing NET HELPMSG 2182.\r\nError: /Service[pxp-agent]/ensure: change from stopped to running failed: Cannot\r\n start pxp-agent, error was: Execution of 'C:/Windows/system32/net.exe start pxp\r\n-agent' returned 2: The requested service has already been started.\r\n\r\nMore help is available by typing NET HELPMSG 2182.{noformat}\r\n\r\nOutside of Puppet, the service can be stopped by simply using the Stop option in services.msc\r\n\r\n*Expected behaviour:*\r\n * The \"Paused\" state should be understood by Puppet for a Windows service resource. Or at least; Puppet should actually stop a service in the \"Paused\" state when ensure=stopped is applied.","closed_at":"2019-12-10T07:49:21.000-0800","comments":19,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6702","labels":"service;type_and_provider;windows","state":"Closed","updated_at":"2019-12-10T07:49:21.000-0800","timestamp":1652286280.514263,"priority":"Major","status_category":"Done","pull_request":7134},{"issue_id":"335042","title":"Deferring template rendering is awkward","url":"https://tickets.puppetlabs.com/browse/PUP-10139","created_at":"2019-11-13T11:37:12.000-0800","number":"PUP-10139","body":"Currently users have to jump through awkward hoops to render secrets agent side:\r\n\r\n{code}\r\n$variables = {\r\n  'password' => Deferred('vault_lookup::lookup',\r\n                  [\"secret/test\", 'https://vault.docker:8200']),\r\n}\r\n\r\n# compile the template source into the catalog\r\nfile { '/etc/secrets.conf':\r\n  ensure  => file,\r\n  content => Deferred('inline_epp',\r\n               [file('mymodule/secrets.conf.epp'), $variables]),\r\n}\r\n{code}\r\n\r\nThe problem with the solution is that the *template* file has to be stored in the *files* directory and that's super unintuitive.\r\n\r\nAfter some conversation in Slack, I'm proposing a {{find_template()}} function that would make this make a lot more sense in that the template source is still stored in the traditional {{templates}} directory.\r\n\r\n{code}\r\n$variables = {\r\n  'password' => Deferred('vault_lookup::lookup',\r\n                  [\"secret/test\", 'https://vault.docker:8200']),\r\n}\r\n\r\n# compile the template source into the catalog\r\nfile { '/etc/secrets.conf':\r\n  ensure  => file,\r\n  content => Deferred('inline_epp',\r\n               [find_template('mymodule/secrets.conf.epp').file, $variables]),\r\n}\r\n{code}\r\n","closed_at":"2019-12-11T13:45:37.000-0800","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10139","labels":"","state":"Resolved","updated_at":"2019-12-11T13:45:37.000-0800","timestamp":1652286281.447714,"priority":"Normal","status_category":"Done","pull_request":7840},{"issue_id":"213667","title":"\"Attempt to redefine entity\" caused by using a resource collector ","url":"https://tickets.puppetlabs.com/browse/PUP-8002","created_at":"2017-09-28T09:59:09.000-0700","number":"PUP-8002","body":"See PUP-7650 for the root cause of the issue. This behaviour is also sometimes (indeterminately) cause by using a *resource collector*, and that does not seem to be corrected by the patch linked in PUP-7650.\r\n\r\nThe error thrown is:\r\n\r\n{code}\r\nError: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Virtual Query, Could not autoload puppet/type/pe_ini_setting: Attempt to redefine entity 'http://puppet.com/2016.1/runtime/type/pe_ini_setting'. Set at unknown location at /etc/puppetlabs/code/modules/classroom/manifests/master/student_environment.pp:51:3 on node superdog.puppetlabs.vm\r\n{code}","closed_at":"2019-12-12T05:28:32.000-0800","comments":24,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8002","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-12-12T05:28:32.000-0800","timestamp":1652286283.36086,"priority":"Major","status_category":"Done","pull_request":7162},{"issue_id":"237430","title":"Unable to modify local user group membership with forcelocal","url":"https://tickets.puppetlabs.com/browse/PUP-8470","created_at":"2018-02-19T11:59:11.000-0800","number":"PUP-8470","body":"*Puppet Version: 5.4.0*\r\n *Puppet Server Version: 5.2.0*\r\n *OS Name/Version: RHEL 7*\r\n\r\nBreaking Change: https://tickets.puppetlabs.com/browse/PUP-8223\r\n\r\nI also validated this is broken when using a puppet apply with this code.\r\n{code:puppet}group { 'group1' :\r\n ensure => present,\r\n gid => '901',\r\n forcelocal => true,\r\n }\r\n\r\ngroup { 'group2' :\r\n ensure => present,\r\n gid => '902',\r\n forcelocal => true,\r\n }\r\n\r\nuser { 'user1' :\r\n ensure => present,\r\n home => '/home/user1',\r\n uid => '900',\r\n gid => 'user1',\r\n comment => 'user1',\r\n shell => '/bin/bash',\r\n forcelocal => true,\r\n managehome => true,\r\n groups => ['group1', 'group2'],\r\n require => Group['group1', 'group2'],\r\n }\r\n{code}\r\nSo far I have found two issues.\r\n\r\n1) lusermod does not support -G\r\n # lusermod --help\r\n Usage: lusermod [OPTION...] user\r\n -i, --interactive prompt for all information\r\n -c, --gecos=STRING GECOS information\r\n -d, --directory=STRING home directory\r\n -m, --movedirectory move home directory contents\r\n -s, --shell=STRING set shell for user\r\n -u, --uid=NUM set UID for user\r\n -g, --gid=NUM set primary GID for user\r\n -l, --login=STRING change login name for user\r\n -P, --plainpassword=STRING plaintext password for the user\r\n -p, --password=STRING pre-hashed password for the user\r\n -L, --lock lock account\r\n -U, --unlock unlock account\r\n --commonname=STRING set common name for user\r\n --givenname=STRING set given name for user\r\n --surname=STRING set surname for user\r\n --roomnumber=STRING set room number for user\r\n --telephonenumber=STRING set telephone number for user\r\n --homephone=STRING set home telephone number for user\r\n\r\nHelp options:\r\n -?, --help Show this help message\r\n --usage Display brief usage message\r\n\r\n2) the new code will not \"modify\" the user's groups in /etc/group because the user already exists.\r\n\r\n*Desired Behavior:*  \r\n user type allowed to modify local users groups\r\n\r\n*Actual Behavior:*\r\n\r\n{noformat}\r\nError: UID 900 already exists, use allowdupe to force user creation\r\n Error: /Stage[main]/Localusers::Identities/User[user1]/groups: change from to 'group1,group2' failed: UID 900 already exists, use allowdupe to force user creation\r\n{noformat}","closed_at":"2019-12-12T05:33:01.000-0800","comments":16,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8470","labels":"","state":"Closed","updated_at":"2019-12-12T05:33:01.000-0800","timestamp":1652286283.47106,"priority":"Normal","status_category":"Done","pull_request":6662},{"issue_id":"240507","title":"AIX user resource fails with new service packs","url":"https://tickets.puppetlabs.com/browse/PUP-8538","created_at":"2018-03-09T11:00:46.000-0800","number":"PUP-8538","body":"New versions of AIX have changed the behavior of the {{chpasswd}} command to report errors when the command syntax is incorrect. See the links below. \r\n\r\nhttp://www-01.ibm.com/support/docview.wss?uid=isg1IV95055\r\nhttp://www-01.ibm.com/support/docview.wss?uid=isg1IJ04629\r\n\r\nThe change to behavior went into 7100-05-01-1731 and 7200-02-01-1731, so setting the password in these AIX versions will fail. This will also cause new user creations to fail on these SPs. \r\n\r\nThe issue is that in  https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/user/aix.rb#L279 we use {{chpasswd -e -c username}}, where as the username is not a valid option to the command. Since the behavior change, customers have seen failures in the user resources on these new SPs. \r\n\r\n\r\n*Errors*\r\n\r\n{code}\r\nDebug: Executing: '/usr/bin/mkuser shell=/usr/bin/ksh minage=0 maxage=0 groups=patrol patrol'\r\nDebug: Executing: '/bin/chpasswd -e -c patrol'\r\nError: Could not set 'present' on ensure: undefined local variable or method `param' for User[patrol](provider=aix):Puppet::Type::User::ProviderAix at /root/newuser.pp:10\r\nError: Could not set 'present' on ensure: undefined local variable or method `param' for User[patrol](provider=aix):Puppet::Type::User::ProviderAix at /root/newuser.pp:10\r\nWrapped exception:\r\nundefined local variable or method `param' for User[patrol](provider=aix):Puppet::Type::User::ProviderAix\r\nError: /Stage[main]/Main/User[patrol]/ensure: change from absent to present failed: Could not set 'present' on ensure: undefined local variable or method `param' for User[patrol](provider=aix):Puppet::Type::User::ProviderAix at /root/newuser.pp:10\r\n{code}\r\n","closed_at":"2019-12-12T05:33:42.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8538","labels":"cs_pr_review;maintenance;triage","state":"Closed","updated_at":"2019-12-12T05:33:42.000-0800","timestamp":1652286283.576599,"priority":"Major","status_category":"Done","pull_request":6726},{"issue_id":"251126","title":"The match function does not accept a type alias ","url":"https://tickets.puppetlabs.com/browse/PUP-8745","created_at":"2018-05-16T12:42:38.000-0700","number":"PUP-8745","body":"h1.  The Problem\r\n\r\nPassing a type alias to the match function results in an error.  \r\n\r\nExample Code: \r\n\r\nhttps://github.com/npwalker/regex_variable/blob/test_pattern_type_alias/manifests/profile/test.pp#L14\r\n\r\nAnd example error:\r\n\r\n{code}\r\nerror during compilation: Evaluation Error: Error while evaluating a Method call, match() expects pattern of T, where T is String, Regexp, Regexp[r], Pattern[p], or Array[T]. Got Puppet::Pops::Types::PTypeAliasType (file: /home/travis/build/npwalker/regex_variable/spec/fixtures/modules/regex_variable/manifests/profile/test.pp, line: 14, column: 21) on node travis-job-npwalker-regex-variable-124411915.travisci.net\r\n{code}\r\n\r\nWhich can been seen in travis as well: \r\n\r\nhttps://travis-ci.com/npwalker/regex_variable/jobs/124411915#L532","closed_at":"2019-12-12T05:37:11.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8745","labels":"","state":"Closed","updated_at":"2019-12-12T05:37:11.000-0800","timestamp":1652286283.680744,"priority":"Major","status_category":"Done","pull_request":6839},{"issue_id":"262552","title":"[Regression] PUP-8167 behaviour noted in Puppet AiO 5.5.3","url":"https://tickets.puppetlabs.com/browse/PUP-8957","created_at":"2018-06-25T03:06:22.000-0700","number":"PUP-8957","body":"*Puppet Version:* All-in-One 5.5.3\r\n*Puppet Server Version:* N/A\r\n*OS Name/Version:* Solaris 10 u 10\r\n\r\nThis appears to be a regression\r\n","closed_at":"2019-12-12T05:40:29.000-0800","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8957","labels":"service;solaris;solaris-parity;type_and_provider","state":"Closed","updated_at":"2019-12-12T05:40:29.000-0800","timestamp":1652286283.89396,"priority":"Normal","status_category":"Done","pull_request":6983},{"issue_id":"262757","title":"Type and provider info should be logged when prefetch fails","url":"https://tickets.puppetlabs.com/browse/PUP-8962","created_at":"2018-06-26T09:06:15.000-0700","number":"PUP-8962","body":"While the puppet agent is applying a catalog, it will pre-fetch resource instances that share a common source. Such as packages from the same provider or cron jobs from the same crontab. Catalog application will abort with an error message if this prefetch operation fails. Often, these errors are terse, cryptic, and give no insight into which sort of resource type failed to fetch (cron job? package? SSH key?). In the case of types based on the ParsedFile provider, the prefetch code is shared among all types which means that the stack trace produced by {{--trace}} doesn't even help distinguish what type encountered the error.\r\n\r\nError messages should be clear about which type and provider failed so that users can proceed directly to debugging instead of puzzling out what happened.\r\n\r\nh2. Reproduction Case\r\n\r\n  - Install PE 2018.1.2 on CentOS 7.\r\n\r\n  - Configure {{site.pp}} in the production environment with a cron resource:\r\n\r\n{code:bash}\r\ncat <<EOF > /etc/puppetlabs/code/environments/production/manifests/master_node.pp\r\nnode '$(hostname -f)' {\r\n  cron {'cron job to trigger prefetch':\r\n    command => '/bin/true',\r\n    user => 'root',\r\n    hour => 1,\r\n  }\r\n}\r\nEOF\r\n{code}\r\n\r\n  - Write garbage to root's crontab to trigger a parse failure:\r\n\r\n{code:bash}\r\nprintf '\\0\\0\\0\\0odelay' > /var/spool/cron/root\r\n{code}\r\n\r\n  - Run {{puppet agent -t}}\r\n\r\nh3. Outcome\r\n\r\nThe catalog fails to apply with a very terse, cryptic error message:\r\n\r\n{noformat}\r\n# puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Loading facts\r\nInfo: Caching catalog for pe-201812-master.puppetdebug.vlan\r\nInfo: Applying configuration version '1530028114'\r\nError: Failed to apply catalog: Could not parse line \"\\u0000\\u0000\\u0000\\u0000odelay\" (file: root, line: 2)\r\n{noformat}\r\n\r\nh3. Expected Outcome\r\n\r\nError message should include the type and provider name as is done when prefetch fails due to a LoadError or Puppet::MissingCommand error:\r\n\r\n{noformat}\r\n# puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Loading facts\r\nInfo: Caching catalog for pe-201812-master.puppetdebug.vlan\r\nInfo: Applying configuration version '1530028653'\r\nError: Failed to apply catalog: Could not prefetch cron provider 'crontab': Could not parse line \"\\u0000\\u0000\\u0000\\u0000odelay\" (file: root, line: 2)\r\n{noformat}","closed_at":"2019-12-12T05:40:52.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8962","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-12-12T05:40:52.000-0800","timestamp":1652286283.999185,"priority":"Normal","status_category":"Done","pull_request":7328},{"issue_id":"278613","title":"Unable to modify user account expiry date when forcelocal == true","url":"https://tickets.puppetlabs.com/browse/PUP-9195","created_at":"2018-10-03T01:55:12.000-0700","number":"PUP-9195","body":"*Puppet Version: 5.5.6 6.0.1*\r\n *Puppet Server Version: 5.2.0*\r\n *OS Name/Version: CentOS 7.5*\r\n\r\nSimilar to https://tickets.puppetlabs.com/browse/PUP-8470 (where lusermod does not support -G), lusermod does not support -e either.\r\n{code:puppet}\r\nuser {\"someuser\":\r\n  ensure => present,\r\n  forcelocal => true,\r\n  expiry => \"2019-05-31\"\r\n}\r\n{code}\r\n\r\n *Desired Behavior:*\r\nuser type allowed to modify local user's account expiry parameter\r\n\r\n*Actual Behavior:*\r\n\r\n{noformat}\r\nError: Could not set expiry on user[someuser]: Execution of '/sbin/lusermod -e 2019-05-31 someuser' returned 1: Error parsing arguments: unknown option.\r\nUsage: lusermod [-imLU?] [-i|--interactive] [-c|--gecos STRING]\r\n        [-d|--directory STRING] [-m|--movedirectory] [-s|--shell STRING]\r\n        [-u|--uid NUM] [-g|--gid NUM] [-l|--login STRING]\r\n        [-P|--plainpassword STRING] [-p|--password STRING] [-L|--lock]\r\n        [-U|--unlock] [--commonname=STRING] [--givenname=STRING]\r\n        [--surname=STRING] [--roomnumber=STRING] [--telephonenumber=STRING]\r\n        [--homephone=STRING] [-?|--help] [--usage] [OPTION...] user\r\nError: /Stage[main]/Main/User[someuser]/expiry: change from 'absent' to '2019-05-31' failed: Could not set expiry on user[someuser]: Execution of '/sbin/lusermod -e  someuser' returned 1: Error parsing arguments: unknown option.\r\nUsage: lusermod [-imLU?] [-i|--interactive] [-c|--gecos STRING]\r\n        [-d|--directory STRING] [-m|--movedirectory] [-s|--shell STRING]\r\n        [-u|--uid NUM] [-g|--gid NUM] [-l|--login STRING]\r\n        [-P|--plainpassword STRING] [-p|--password STRING] [-L|--lock]\r\n        [-U|--unlock] [--commonname=STRING] [--givenname=STRING]\r\n        [--surname=STRING] [--roomnumber=STRING] [--telephonenumber=STRING]\r\n        [--homephone=STRING] [-?|--help] [--usage] [OPTION...] user\r\n{noformat}","closed_at":"2019-12-12T05:47:04.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9195","labels":"Community;resolved-issue-added","state":"Closed","updated_at":"2019-12-12T05:47:04.000-0800","timestamp":1652286284.103915,"priority":"Normal","status_category":"Done","pull_request":7177},{"issue_id":"284764","title":"puppet package provider fails when reading from registry","url":"https://tickets.puppetlabs.com/browse/PUP-9312","created_at":"2018-11-12T09:27:52.000-0800","number":"PUP-9312","body":"*Puppet Version: 5.5.6*\r\n *Puppet Server Version: 5.3.5*\r\n *OS Name/Version: Windows 2016*\r\n\r\nThe ClaySys AppForms 6 application creates a Registry key in:\r\n\r\n{{HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\ClaySys AppForms_6\\ConnectionString}}\r\n\r\n... that causes the Windows package provider to fail. The data appears to binary but {{reg_enum_value}} expects a string and calls {{read_wide_string}} in ...\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/package/windows/package.rb#L28\r\nhttps://github.com/puppetlabs/puppet/blob/master/lib/puppet/util/windows/registry.rb#L62\r\nhttps://github.com/puppetlabs/puppet/blob/master/lib/puppet/util/windows/registry.rb#L120\r\n\r\n*Desired Behavior: It does not fail.*\r\n\r\n*Actual Behavior:*\r\n\r\n{code}\r\nDebug: Unable to convert value \"8\\xB3zk\\xF6\\xBB\\xDF\\n\\x18lK8\\xA1\\xAA\\x96\\xA9T0\\tB \\xFC\\xF5\\v\\xC0>\\xE2\\xC0\\xDAEI\\x98\\xC2h\\x00\\xD21\\xE8*\\xA2\\xB2rW\\xAF5R\\xB8\\xDDm\\xB4n0\\xE1\\xD9\\xDC@J\\xA1\\x86\\xC3\\b\\xD8)q\\x96\\xED\\x8A\\xB50\\x83\\xC8J\\xAB\\xAD\\xCA\\xACI\\x05\\f\\xFC\\xE9\\xD6A\\xEF\\xB5\\t\\xE7B\\x1D\\x18\\fc\\x1EM\\x9BS\\x83\\xE8\\xA6\\x84c;\\x87\\xF5?e1\\x97\\x1C\\xB9\\xAA?\\xDF@\\xBB\\xBCs\\x9A\\x18\\x95\\xFD<D\\xB2\\xA5\\xE9\\x8D\\xC4\\x93-\\xABw\\xBD\\xF9\\x9B\\xA1w\\xE0\\a\\r<\\xB3\\xCD\\xD5\\x00x\\xD3V\\x8CQ\\xD1?g6\\x99\\xB6>\\xBE\\xBE\\x05SB\\bI\\xA3\\x8E\\xAB\\xDD\\xA2Yl\\xF3\\xB5\\xFC\\x04\\xC9\\x8A\\xB7`\\xD9\\x96\\xC1\\xFD=\\xF4\\xA8\\xE4\\xB3\\xBC\\xFCb\\xDA\\xC6\\xF0\\b\\xD7\\x89\\xAABO\\xAC\\xB6\\x1C\\xC8\\x8E\\xD1\\x80\\x10Q\\xFE\\x00\\x0F\\x99\\xAFB\\xB5\\xFBU\\x8BJ\\x1C\\xEC'.\".force_encoding(\"UTF-16LE\") to encoding UTF-8 due to #<Encoding::InvalidByteSequenceError: \"\\xB8\\xDD\" on UTF-16LE>\r\nError: Cannot collect packages for Puppet::Type::Package::ProviderWindows provider; \"\\xB8\\xDD\" on UTF-16LE \r\n{code}\r\n\r\n","closed_at":"2019-12-12T05:49:41.000-0800","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9312","labels":"","state":"Closed","updated_at":"2019-12-12T05:49:41.000-0800","timestamp":1652286284.52507,"priority":"Minor","status_category":"Done","pull_request":7266},{"issue_id":"295978","title":"Unable to use remote URI as source parameter with package provider on Windows","url":"https://tickets.puppetlabs.com/browse/PUP-9496","created_at":"2019-02-12T18:30:01.000-0800","number":"PUP-9496","body":"Prior to Puppet 5.5.7, it was possible with the 'windows' provider for the Package resource to use HTTP sources for MSI packages. As of Puppet 5.5.7, this functionality no longer works.\r\n\r\nExample:\r\n{code}package { 'my software':\r\nensure => '1.0.0',\r\nsource => 'http://my-web-repo.net/my-package.msi',\r\n}\r\n{code}\r\nError message:\r\n{code}'Error: Could not update: Working directory http://my-web-repo.net does not exist!'\r\n{code}\r\nPuppet 5.5.7 implemented https://tickets.puppetlabs.com/browse/PUP-6920, which allows for the working directory to be the same directory as the package source, which breaks the unintended functionality of the windows provider using a remote URI. It previously worked because MSI was actually handling the download of the installer rather than Puppet handling the download.","closed_at":"2019-12-12T06:05:00.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9496","labels":"customer;package;resolved-issue-added;type_and_provider;windows","state":"Closed","updated_at":"2019-12-12T06:05:00.000-0800","timestamp":1652286284.871296,"priority":"Normal","status_category":"Done","pull_request":7393},{"issue_id":"306573","title":"String to integer conversion fails","url":"https://tickets.puppetlabs.com/browse/PUP-9689","created_at":"2019-04-29T01:47:44.000-0700","number":"PUP-9689","body":"*Puppet Version:2018.1.5*\r\n *Puppet Server Version:5.5.8*\r\n *OS Name/Version: RHEl and Solaris*\r\n\r\n*Desired Behavior:* \r\n\r\nConvert \"08\" from a string to an integer successfully on puppet run.\r\n\r\n*Actual Behavior:*\r\n\r\nFails to convert \"08\" from a string to an integer on a puppet run.\r\n\r\nSome of our newly added code was failing on what seems to be a valid String -> Integer conversion.\r\n\r\nA minimal case to reproduce:\r\n\r\nThis, which is essentially the same as one of the examples in the docs ([https://puppet.com/docs/puppet/5.5/function.html#conversion-to-integer]) works:\r\n\r\n# puppet apply -e 'notify \\{ \"message\": message => Integer(\"010\", 10) }' \r\nNotice: Compiled catalog for denga02l.unix.anz in environment production in 0.05 seconds \r\nNotice: 10 \r\nNotice: /Stage[main]/Main/Notify[message]/message: defined 'message' as 10 \r\nNotice: Applied catalog in 0.26 seconds\r\n\r\nAs you can see the \"radix\" argument to specify base 10 makes it it correctly interpret the string as a decimal number\r\n\r\n# puppet apply -e 'notify \\{ \"message\": message => Integer(\"07\", 10) }'\r\nNotice: Compiled catalog for pe-201817-master.puppetdebug.vlan in environment production in 0.11 seconds\r\nNotice: 7\r\nNotice: /Stage[main]/Main/Notify[message]/message: defined 'message' as 7\r\nNotice: Applied catalog in 0.30 seconds\r\n\r\nBut this fails:\r\n\r\n# puppet apply -e 'notify \\{ \"message\": message => Integer(\"08\", 10) }' \r\nError: Evaluation Error: Error while evaluating a Function Call, 'new' The string '08' cannot be converted to Integer (line: 1, column: 33) on node denga02l.unix.anz\r\n\r\nSince the first example correctly interprets the string I suspect that there are two passes over it - one of which is trying to interpret the value as octal, and the second which is doing the actual conversion.\r\n\r\nThis happens on both RHEL and Solaris systems\r\n\r\n ","closed_at":"2019-12-12T06:10:10.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9689","labels":"resolved-issue-added","state":"Resolved","updated_at":"2019-12-12T06:10:10.000-0800","timestamp":1652286285.081356,"priority":"Normal","status_category":"Done","pull_request":7504},{"issue_id":"308025","title":"Solaris Crontabs -> puppet resource cron only returns root account","url":"https://tickets.puppetlabs.com/browse/PUP-9697","created_at":"2019-05-09T09:40:00.000-0700","number":"PUP-9697","body":"*Puppet Version:2018.1.5*\r\n *Puppet Server Version:*\r\n *OS Name/Version: Solaris 11*\r\n\r\nUnable to get a cron job from crontab for another user using `puppet resource cron` or `crontab -l` Solaris 11.\r\n\r\nThis has been set with a .pp code through classification and it uses the `user` resource to set up the cron job. \r\n\r\nExample :\r\n\r\ncrontab -l -> returns only jobs in the root crontab file.\r\n\r\ncrontab -l username -> returns only cron jobs in the users crontab.\r\n\r\nPuppet Resource Cron will only return the root crontab.\r\n\r\n \r\n\r\n*Desired Behavior:*\r\n\r\nWhen running a puppet resource cron it should return all crontabs\r\n\r\n*Actual Behavior:*\r\n\r\nOnly the root accounts crontab is returned on Solaris 11.\r\n\r\n \r\n\r\nCron is created with pp code\r\n   cron\r\n\r\n{ 'my cron job':                         command => \"my command\",                          user => \"someuser\",                 }","closed_at":"2019-12-12T06:10:28.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9697","labels":"resolved-issue-added","state":"Closed","updated_at":"2019-12-12T06:10:28.000-0800","timestamp":1652286285.18706,"priority":"Normal","status_category":"Done","pull_request":7568},{"issue_id":"335096","title":"puppet service and puppet-agent failing on windows ","url":"https://tickets.puppetlabs.com/browse/PUP-10140","created_at":"2019-11-13T13:56:55.000-0800","number":"PUP-10140","body":"Installing the puppet-agent on windows platforms isn't generating a CSR, and I've also encountered problems with manually trying to start the puppet service in general on windows platforms. This started cropping up in PE 2018.1.x CI, tests started failing because CSRs were not showing up when the tests expected them to.\r\n\r\nAn example of the failure can be seen in this [Agent Integration job|https://cinext-jenkinsmaster-enterprise-prod-1.delivery.puppetlabs.net/view/pe-integration/view/pe-2018.1.x/job/enterprise_pe-acceptance-tests_integration-system_pe_full-agent_nightly_2018.1.x/154/LAYOUT=centos6-64mcd-windows10ent-64f-32f-windows2008r2-64f-windows2012r2-64f-windows2016-64f-windows2019-64f,LEGACY_AGENT_VERSION=NONE,PLATFORM=NOTUSED,SCM_BRANCH=2018.1.x,UPGRADE_FROM=NONE,UPGRADE_TO_VERSION=NONE,label=beaker/] for PE 2018.1.x, with a puppet-agent SHA of 5.5.17.71.gb6ebce3","closed_at":"2020-01-08T04:08:47.000-0800","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10140","labels":"","state":"Resolved","updated_at":"2020-01-08T04:08:47.000-0800","timestamp":1652286285.822113,"priority":"Blocker","status_category":"Done","pull_request":7842},{"issue_id":"327639","title":"Puppet won't install (some) packages with ensure => held","url":"https://tickets.puppetlabs.com/browse/PUP-10059","created_at":"2019-10-02T05:43:50.000-0700","number":"PUP-10059","body":"*Puppet Version: 6.9.0-1bionic*\r\n *Puppet Server Version: 6.2.0-1bionic*\r\n *OS Name/Version: Ubuntu 18.04*\r\n\r\nI have postfix and installed and held:\r\n\r\n \r\n{code:java}package { 'postfix':\r\n ensure => 'held',\r\n}{code}\r\n \r\n\r\n \r\n{code:java}# dpkg -l | grep postfix\r\nhi postfix 3.3.0-1ubuntu0.2 amd64 High-performance mail transport agent{code}\r\n \r\n\r\n \r\n\r\nNow I'm trying to install a few sub-packages, also as held:\r\n\r\n \r\n{code:java}$packages = [\r\n 'postfix-pcre',\r\n 'postfix-mysql',\r\n]\r\npackage { $packages:\r\n ensure => 'held',\r\n}\r\n{code}\r\n \r\n\r\nWhen running puppet, the following messages are displayed:\r\n\r\nNotice: /Stage[main]/Main/Package[postfix-pcre]/ensure: created\r\n Notice: /Stage[main]/Main/Package[postfix-mysql]/ensure: created\r\n\r\n*Desired Behavior:*\r\n\r\n**Packages postfix-pcre and postfix-mysql should be installed and set to \"held\".\r\n\r\n*Actual Behavior:*\r\n\r\n \r\n\r\nNeither package is installed. The puppet resource command results in a package resource with ensure set to \"purged\":\r\n{code:java}# puppet resource package postfix-mysql ensure=held\r\nNotice: /Package[postfix-mysql]/ensure: created\r\npackage { 'postfix-mysql':\r\n ensure => 'purged',\r\n provider => 'apt',\r\n}{code}\r\n \r\n\r\n This seems to only affect sub-packages like in this Postfix example; I have other packages set to ensure => held which have been installed properly.","closed_at":"2020-01-08T04:15:02.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10059","labels":"resolved-issue-added","state":"Resolved","updated_at":"2020-01-08T04:15:02.000-0800","timestamp":1652286286.032414,"priority":"Normal","status_category":"Done","pull_request":7785},{"issue_id":"329403","title":"Systemd provider is not correctly selected on Alpine Linux","url":"https://tickets.puppetlabs.com/browse/PUP-10102","created_at":"2019-10-15T01:27:13.000-0700","number":"PUP-10102","body":"*Puppet Version: 6.8.0 - 6.10.0*\r\n\r\nRunning unit tests (i.e pdk test unit) on Alpine Linux with puppet agents >= 6.8.0 fails:\r\n\r\n \r\n{code:java}\r\npdk (INFO): Using Ruby 2.4.6\r\npdk (INFO): Using Puppet 6.8.0\r\nRun options: exclude {:bolt=>true}\r\n Evaluated 83 tests in 30.530483644 seconds: 1 failures, 0 pending.\r\nfailed: rspec: ./spec/classes/common_spec.rb:9: Could not find the daemon directory (tested [/etc/sv,/var/lib/service])\r\n common should contain class: Ubuntu on ubuntu-18.04-x86_64 is expected to compile into a catalogue without dependency cycles\r\n Failure/Error:\r\n let(:facts) { os_facts }\r\nit { is_expected.to compile.with_all_deps }\r\n end\r\n{code}\r\n \r\n\r\nThis seems to be related to changes in:\r\n\r\nhttps://tickets.puppetlabs.com/browse/PUP-7312\r\nhttps://tickets.puppetlabs.com/browse/PUP-10016","closed_at":"2020-01-08T04:15:33.000-0800","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10102","labels":"resolved-issue-added","state":"Resolved","updated_at":"2020-01-08T04:15:33.000-0800","timestamp":1652286286.140128,"priority":"Normal","status_category":"Done","pull_request":7794},{"issue_id":"335940","title":"Systemd provider daemon-reload broken in puppet 6.11.0","url":"https://tickets.puppetlabs.com/browse/PUP-10149","created_at":"2019-11-19T15:38:10.000-0800","number":"PUP-10149","body":"*Puppet Version:* 6.11.0\r\n*Puppet Server Version:* NA\r\n*OS Name/Version:* RHEL7\r\n\r\nThe feature implemented in https://tickets.puppetlabs.com/browse/PUP-3483 where daemon-reload is called if required has been broken in puppet 6.11\r\n\r\nMy PR https://github.com/voxpupuli/puppet-prometheus/pull/390 worked yesterday, but today puppet 6.11 came out and now the build fails.\r\n\r\nThis change https://github.com/puppetlabs/puppet/commit/0ea1776b096b379b554b835ab091ec00d325e99c#diff-dafbe8211057bc10ff2cfe788a6c4ebbR130 looks to be the problem.\r\n\r\nWith the {noformat}'--'{noformat} added where it has been, the {noformat}'--property=NeedDaemonReload'{noformat} argument is not processed (as an option) and all properties are returned.","closed_at":"2020-01-08T06:52:35.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10149","labels":"resolved-issue-added","state":"Resolved","updated_at":"2020-01-08T06:52:35.000-0800","timestamp":1652286286.559048,"priority":"Normal","status_category":"Done","pull_request":7852},{"issue_id":"341337","title":"Puppet lookup invocation recursion detection not thread-safe","url":"https://tickets.puppetlabs.com/browse/PUP-10222","created_at":"2020-01-07T10:38:50.000-0800","number":"PUP-10222","body":"Initial production testing by Customer0 with Puppet in multithreaded mode has revealed that the code to detect recursive hiera lookups is not thread-safe:\r\n{code}\r\n2020-01-07T08:41:31.500-08:00 ERROR [qtp612319309-15848] [puppetserver] Puppet Evaluation Error: Error while evaluating a Resource Statement, Lookup of key 'ntp::config_template' failed: Recursive lookup detected in [epel::epel_debuginfo_sslclientkey, ntp::tinker, ntp::leapfile, ntp::config_template] (file: /etc/puppetlabs/code/environments/production/site/profile/manifests/time.pp, line: 2, column: 3) on node ldap-testfixture-prod-2.delivery.puppetlabs.net\r\n{code}\r\n\r\nThese errors come from https://github.com/puppetlabs/puppet/blob/master/lib/puppet/pops/lookup/invocation.rb#L84. Current theory is that since the {{@current}} class variable is not thread-safe, if multiple threads look for the same key at the same time, this error could occur. In their environments, this was happening when doing automatic lookup of class params via hiera.","closed_at":"2020-01-10T07:31:01.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10222","labels":"","state":"Resolved","updated_at":"2020-01-10T07:31:01.000-0800","timestamp":1652286287.076827,"priority":"Normal","status_category":"Done","pull_request":7917},{"issue_id":"336155","title":"Ruby stacktraces no longer interleave Puppet Code stacktraces","url":"https://tickets.puppetlabs.com/browse/PUP-10150","created_at":"2019-11-21T06:01:11.000-0800","number":"PUP-10150","body":"*Puppet Version:* 6.11.1\r\n*Puppet Server Version:* N/A\r\n*OS Name/Version:* Windows 10\r\n\r\nAs part of https://github.com/puppetlabs/puppet/pull/7754 the Puppet Stack Trace feature was modified to use an independent stack trace storing mechanism, however this may have introduced an unforseen behaviour change.\r\n\r\nPreviously users would be able to trace how Puppet has traversed the invocations within a Manifest file.  For example int the given manifest\r\n\r\n{code}\r\nclass nest1 {\r\n  fail('somethinng')\r\n}\r\n\r\nclass nest2 {\r\n  include nest1\r\n}\r\n\r\ninclude nest2\r\n{code}\r\n\r\nPreviously in Puppet 6.10.1, we can see a {{puppet apply <manifest> --trace}} gives\r\n\r\n{code}\r\nError: Evaluation Error: Error while evaluating a Function Call, somethinng (file: C:/Source/puppet/tmp/test.pp, line: 2, column: 3) on node glenn.sarti-r90qu2hx\r\nC:/Source/puppet/lib/puppet/parser/functions/fail.rb:10:in `block in get_binding'\r\nC:/Source/puppet/lib/puppet/parser/functions.rb:206:in `block (2 levels) in newfunction'\r\n...\r\nC:/Source/puppet/tmp/test.pp:2:in `block in call_function'\r\n...\r\nC:/Source/puppet/tmp/test.pp:6:in `block in call_function'\r\n...\r\nC:/Source/puppet/tmp/test.pp:9:in `block in call_function'\r\n...\r\nC:/Source/puppet/tmp/test.pp:in `stack'\r\n...\r\n{code}\r\n\r\nWe can see the various includes and Puppet call stack.\r\n\r\nHowever in Puppet 6.11.1 we get:\r\n\r\n{code}\r\n...\r\nError: Evaluation Error: Error while evaluating a Function Call, somethinng (file: C:/Source/puppet/tmp/test.pp, line: 2, column: 3) on node glenn.sarti-r90qu2hx\r\n{code}\r\n\r\nAnd that's it.  The call stack within Puppet is no longer available.  Now, that's probably due to Puppet no longer using the Ruby stack to store the information, however...\r\n\r\nDue to the way the stack is implemented, the stack is cleared (via the `shift` in https://github.com/puppetlabs/puppet/blob/1356f58d66/lib/puppet/pops/puppet_stack.rb#L44-L46) BEFORE any error trapping can occur.\r\n\r\nEffectively, the Puppet Stack is no longer available during exceptions, only the exception location, which seems a concerning.","closed_at":"2020-01-11T14:02:17.000-0800","comments":24,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10150","labels":"resolved-issue-added","state":"Resolved","updated_at":"2020-01-11T14:02:17.000-0800","timestamp":1652286287.405877,"priority":"Normal","status_category":"Done","pull_request":7899},{"issue_id":"328315","title":"premature loading of module-provided facts under `-p`","url":"https://tickets.puppetlabs.com/browse/PUP-10136","created_at":"2019-10-07T10:30:12.000-0700","number":"PUP-10136","body":"When running {{facter -p}} on windows with the puppetlabs/ciscopuppet module pluginsynced to the agent, facter is loading {{facter/cisco.rb}} from {{C:/ProgramData/PuppetLabs/puppet/cache/lib}} before setting up the {{$LOAD_PATH}} to load that file's dependencies from there. Please see the attached screenshot for the debug modifications I did and the results on the machine showing the issue.\r\n\r\nTo make sure there is nothing wonky with the {{facter/cisco_nexus}} file itself, a {{require}} within a {{setcode}} worked fine.\r\n\r\nRegular agent runs work fine and do not show any errors.\r\nh3. Desired Behaviour\r\n\r\n{{facter -p}} loads files from puppet's cache only once, after {{$LOAD_PATH}} has been properly initialised.","closed_at":"2020-01-12T11:45:15.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10136","labels":"resolved-issue-added","state":"Resolved","updated_at":"2020-01-12T11:45:15.000-0800","timestamp":1652286287.511353,"priority":"Normal","status_category":"Done","pull_request":7827},{"issue_id":"338500","title":"puppetdb_query doesn't respect hostprivkey & hostcert settings","url":"https://tickets.puppetlabs.com/browse/PUP-10165","created_at":"2019-12-07T01:18:22.000-0800","number":"PUP-10165","body":"*Puppet Version: 6.11.1*\r\n*Puppet Server Version: 6.6.0*\r\n*OS Name/Version: Ubuntu 16.04 xenial*\r\n\r\nI hit into this issue when tried to call {{puppetdb_query}} function from choria playbook. It fails to find SSL certificate & private key. Then I tried to run \r\n{{puppet apply -e \"notice(puppetdb_query('nodes[certname]{}'))\"}}\r\n*as non-root user* but it fails with same error.\r\n\r\nI have {{hostprivkey}} and {{hostcert}} in my user's {{~/.puppetlabs/etc/puppet/puppet.conf}} ({{[main]}} section). Those cert & key are 100% valid. {{puppet config print}} shows proper values. But it seems {{puppetdb_query}} doesn't respect the settings.\r\n\r\nThough this function forks fine if I set {{certname}} to {{username.mcollective}} (filename of user certificate, see below).\r\n\r\n*Desired Behavior:*\r\n{{puppetdb_query}} function must respect {{hostprivkey}} and {{hostcert}} config parameters.\r\n\r\n*Actual Behavior:*\r\nI replaced actual user name with {{username}} and host name with {{hostname.tld}} in output below:\r\n{code}\r\n$ cat ~/.puppetlabs/etc/puppet/puppet.conf\r\n[main]\r\n  hostprivkey = $privatekeydir/username.mcollective.pem\r\n  hostcert = $certdir/username.mcollective.pem\r\n\r\n$ puppet config print hostprivkey hostcert\r\nhostcert = /home/username/.puppetlabs/etc/puppet/ssl/certs/username.mcollective.pem\r\nhostprivkey = /home/username/.puppetlabs/etc/puppet/ssl/private_keys/username.mcollective.pem\r\n\r\n$ puppet apply -e \"notice(puppetdb_query('nodes[certname]{}'))\"\r\nError: Failed to initialize SSL: The private key is missing from '/home/username/.puppetlabs/etc/puppet/ssl/private_keys/hostname.tld.pem'\r\nError: Run `puppet agent -t`\r\nError: Evaluation Error: Error while evaluating a Function Call, The private key is missing from '/home/username/.puppetlabs/etc/puppet/ssl/private_keys/hostname.tld.pem' (line: 1, column: 8) on node hostname.tld\r\n{code}\r\n\r\nThough, if I set {{certname}} in puppet.conf it works fine:\r\n{code}\r\n$ cat ~/.puppetlabs/etc/puppet/puppet.conf\r\n[main]\r\n  certname = username.mcollective\r\n\r\n$ puppet apply -e \"notice(puppetdb_query('nodes[certname]{}'))\"\r\nNotice: Scope(Class[main]): [{certname => hostname.tld}, ... ]\r\nNotice: Compiled catalog for username.mcollective in environment production in 0.19 seconds\r\nNotice: Applied catalog in 0.04 seconds\r\n{code}\r\n\r\nTrace log:\r\n{code}\r\nusername@spdapuppetp1:~$ puppet apply -e \"notice(puppetdb_query('nodes[certname]{}'))\" --trace\r\nError: Failed to initialize SSL: The private key is missing from '/home/username/.puppetlabs/etc/puppet/ssl/private_keys/hostname.tld.pem'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/x509/cert_provider.rb:171:in `load_private_key'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/ssl/ssl_provider.rb:112:in `load_context'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:215:in `block in base_context'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:164:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:54:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:266:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/puppetdb/http.rb:219:in `action'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/puppetdb.rb:74:in `block in query_puppetdb'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/puppetdb.rb:71:in `query_puppetdb'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions/puppetdb_query.rb:8:in `puppetdb_query'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatch.rb:60:in `invoke'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:43:in `block in dispatch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:42:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:42:in `dispatch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:46:in `block in call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:45:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:45:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/puppet_stack.rb:42:in `stack'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:305:in `block in call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:303:in `call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:976:in `call_function_with_block'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:945:in `eval_CallNamedFunctionExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:94:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:1289:in `block in unfold'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:1284:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:1284:in `unfold'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:945:in `eval_CallNamedFunctionExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:49:in `block in visit_this'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:43:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:43:in `visit_this'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:96:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/puppet_stack.rb:42:in `stack'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:737:in `eval_Program'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:49:in `block in visit_this'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:43:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:43:in `visit_this'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:96:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/evaluating_parser.rb:63:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:125:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast.rb:30:in `safeevaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:137:in `evaluate_code'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:79:in `block in evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:71:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:594:in `evaluate_main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:166:in `block (2 levels) in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:166:in `block in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:62:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:274:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:155:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:34:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:307:in `block (2 levels) in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:305:in `block in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:233:in `block in benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/2.5.0/benchmark.rb:308:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:232:in `benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:303:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:56:in `block in find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/node/environment.rb:423:in `with_text_domain'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:55:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:223:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:232:in `block in main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:62:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:274:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:207:in `main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:177:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:382:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:687:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:382:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:143:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:77:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\nError: Run `puppet agent -t`\r\nError: Evaluation Error: Error while evaluating a Function Call, The private key is missing from '/home/username/.puppetlabs/etc/puppet/ssl/private_keys/hostname.tld.pem' (line: 1, column: 8) on node hostname.tld\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/x509/cert_provider.rb:171:in `load_private_key'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/ssl/ssl_provider.rb:112:in `load_context'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:215:in `block in base_context'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:164:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:54:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:266:in `lookup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/puppetdb/http.rb:219:in `action'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/puppetdb.rb:74:in `block in query_puppetdb'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/puppetdb.rb:71:in `query_puppetdb'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions/puppetdb_query.rb:8:in `puppetdb_query'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatch.rb:60:in `invoke'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:43:in `block in dispatch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:42:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/dispatcher.rb:42:in `dispatch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:46:in `block in call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:45:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/functions/function.rb:45:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/puppet_stack.rb:42:in `stack'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:305:in `block in call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:303:in `call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:976:in `call_function_with_block'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:945:in `eval_CallNamedFunctionExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:94:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:1289:in `block in unfold'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:1284:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:1284:in `unfold'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:945:in `eval_CallNamedFunctionExpression'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:49:in `block in visit_this'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:43:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:43:in `visit_this'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:96:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/puppet_stack.rb:42:in `stack'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:737:in `eval_Program'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:49:in `block in visit_this'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:43:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:43:in `visit_this'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/visitor.rb:96:in `visit_this_1'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/evaluator_impl.rb:81:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/parser/evaluating_parser.rb:63:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/pops_bridge.rb:125:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/ast.rb:30:in `safeevaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/type.rb:137:in `evaluate_code'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:79:in `block in evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/resource.rb:71:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:594:in `evaluate_main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:166:in `block (2 levels) in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:166:in `block in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:62:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:274:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:155:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:34:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:307:in `block (2 levels) in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:305:in `block in compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:233:in `block in benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/2.5.0/benchmark.rb:308:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:232:in `benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:303:in `compile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:56:in `block in find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/node/environment.rb:423:in `with_text_domain'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/compiler.rb:55:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:223:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:232:in `block in main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:62:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:274:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:207:in `main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:177:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:382:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:687:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:382:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:143:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:77:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\n{code}\r\n\r\n","closed_at":"2020-01-12T12:01:52.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10165","labels":"resolved-issue-added","state":"Resolved","updated_at":"2020-01-12T12:01:52.000-0800","timestamp":1652286287.625363,"priority":"Normal","status_category":"Done","pull_request":7893},{"issue_id":"327453","title":"User resource on Windows confuses domain and local accounts","url":"https://tickets.puppetlabs.com/browse/PUP-10057","created_at":"2019-10-01T02:11:17.000-0700","number":"PUP-10057","body":"*Puppet Version: 6.4.3 (PE Agent from PE 2019.1.1)*\r\n *Puppet Server Version: PE 2019.1.1*\r\n *OS Name/Version: Tested against Windows 2016*\r\n\r\nBehavior of the user resource goes wonky when an AD account exists that has the same name as the local user account you’re trying to manage on a Windows server that is domain-joined.\r\n\r\n*Desired Behavior:*\r\n\r\nEnforcing configuration of local user accounts on Windows domain-member servers works normally.\r\n\r\n*Actual Behavior:*\r\n\r\nWhen a user account exists locally on a member server, and a user account with the same name also exists in the Active Directory domain, this happens when setting `ensure=>absent` on that local user account:\r\n * The first puppet run, the local user account is detected, and removed\r\n * The second puppet run, the provider seems to detect the *domain* user account, and tries to delete the account again (from the local user database), which fails with this error:\r\n\r\nCould not set 'absent' on ensure: (in OLE method `Delete': )\r\nOLE error code:800708AD in Active Directory\r\nThe user name could not be found.\r\nHRESULT error code:0x80020009\r\nException occurred. (file: /etc/puppetlabs/code/environments/development/site-modules/profile/manifests/base.pp, line: 98)\r\nWrapped exception:\r\n(in OLE method `Delete': )\r\nOLE error code:800708AD in Active Directory\r\nThe user name could not be found.\r\nHRESULT error code:0x80020009\r\nException occurred.\r\n ","closed_at":"2020-01-12T12:58:59.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10057","labels":"resolved-issue-added","state":"Resolved","updated_at":"2020-01-12T12:58:59.000-0800","timestamp":1652286287.733813,"priority":"Normal","status_category":"Done","pull_request":7812},{"issue_id":"290075","title":"HP-UX usermod syntax is incorrect","url":"https://tickets.puppetlabs.com/browse/PUP-9391","created_at":"2019-01-02T08:20:54.000-0800","number":"PUP-9391","body":"*Puppet Version:*\r\n*Puppet Server Version:*\r\n*OS Name/Version:*\r\n\r\nDescribe your issue in as much detail as possible…\r\nDescribe steps to reproduce…\r\n\r\n*Desired Behavior:*\r\n\r\n\r\n*Actual Behavior:*\r\n\r\n\r\nPlease take a moment and attach any relevant log output and/or manifests. This will help us immensely when troubleshooting the issue.\r\n\r\nExamples:\r\nRun puppet agent with --test --trace --debug\r\n\r\nRelevant sections of {{/var/log/puppetlabs/puppetserver/puppetserver.log}} or any applicable logs from the same directory.\r\n\r\nFor more detailed information turn up the server logs by upping the log level in the server's logback.xml\r\n\r\nRelevant sections of configurations files (puppet.conf, hiera.conf, Server's conf.d, defaults/sysconfig)\r\n\r\nFor memory issues with server heap dumps are also helpful.\r\n","closed_at":"2020-01-12T13:02:42.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9391","labels":"resolved-issue-added","state":"Resolved","updated_at":"2020-01-12T13:02:42.000-0800","timestamp":1652286287.838626,"priority":"Normal","status_category":"Done","pull_request":7872},{"issue_id":"331590","title":"Package provider removes colon from package name","url":"https://tickets.puppetlabs.com/browse/PUP-10124","created_at":"2019-10-23T02:33:07.000-0700","number":"PUP-10124","body":"Hello,\r\n\r\nthe puppet-agent in version 6.9.0 (I am not sure on which version bug appeared first) has broken package provider in a way than it \"eats\" colon \":\" from package name.\r\n\r\nWhich breaks package/slot handling on Gentoo Linux.\r\n\r\nOn Gentoo you can install package with emerge to a specific version slot by specifying slot after package name separated with a colon eg.:\r\n\r\n\"emerge dev-db/postgresql:11\"\r\n\r\nOn puppet-agent version 6.7.2 it was working alright.\r\n\r\nBest regards\r\n\r\nAM\r\n\r\n \r\n\r\nError message:\r\n\r\nError: /Stage[main]/Package::Dev_db::Postgresql/Package[dev-db/postgresql:11]/ensure: change from 'absent' to 'present' failed: Execution of '/usr/bin/emerge dev-db/postgresql11' returned 1: These are the packages that would be merged, in order:\r\n \r\nCalculating dependencies ... done! \r\n \r\nemerge: there are no ebuilds to satisfy \"dev-db/postgresql11\".\r\n\r\n \r\n\r\n ","closed_at":"2020-01-13T14:14:14.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10124","labels":"bug;linux;package;provider;resolved-issue-added","state":"Resolved","updated_at":"2020-01-13T14:14:14.000-0800","timestamp":1652286288.047672,"priority":"Major","status_category":"Done","pull_request":7814},{"issue_id":"328673","title":"Protect against binary diffs","url":"https://tickets.puppetlabs.com/browse/PUP-10097","created_at":"2019-10-09T11:15:34.000-0700","number":"PUP-10097","body":"*Puppet Version:* 5.5.16\r\n*Puppet Server Version:* PE 2018.1.9\r\n*OS Name/Version:* RHEL 7.6\r\n\r\n*Desired Behavior:*\r\n\r\n{{puppet agent}} can manage the contents of a {{file}} resource that uses a {{Binary}} type for its contents, with behavior consistent with {{puppet apply}} running the same manifest.\r\n\r\n*Actual Behavior:*\r\n\r\nAttempting to write binary file content represented in hex as {{c7 d1 fc 84}}, converted to base64 and passed as {{Binary('x9H8hA==')}}, editing {{/etc/puppetlabs/code/environments/production/manifests/site.pp}}:\r\n\r\n{code}\r\n[root@pe-201819-master manifests]# cat site.pp\r\n## site.pp ##\r\n\r\n# This file (/etc/puppetlabs/puppet/manifests/site.pp) is the main entry point\r\n...\r\nnode default {\r\n  # This is where you can declare classes for all nodes.\r\n  # Example:\r\n  #   class { 'my_class': }\r\n  file { '/tmp/test':\r\n    ensure  => present,\r\n    content => Binary('x9H8hA=='),\r\n  }\r\n}\r\n\r\n[root@pe-201819-master manifests]# puppet apply site.pp\r\nNotice: Compiled catalog for pe-201819-master.puppetdebug.vlan in environment production in 0.02 seconds\r\nNotice: /Stage[main]/Main/Node[default]/File[/tmp/test]/ensure: defined content as '{md5}387d16f3cb61048e6fb16cfd81367ce8'\r\nNotice: Applied catalog in 0.20 seconds\r\n\r\n[root@pe-201819-master manifests]# od -t x1 /tmp/test\r\n0000000 c7 d1 fc 84\r\n0000004\r\n{code}\r\n\r\nThis is the expected result of applying the manifest. {{puppet apply}} works as expected.\r\n\r\nRunning as {{puppet agent}} fails:\r\n\r\n{code}\r\n[root@pe-201819-master manifests]# puppet agent --test\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Loading facts\r\nInfo: Caching catalog for pe-201819-master.puppetdebug.vlan\r\nInfo: Applying configuration version '1570644420'\r\nNotice: /Stage[main]/Main/Node[default]/File[/tmp/test]/content: Received a Log attribute with invalid encoding:\"\\n--- /tmp/test\\t2019-10-09 18:06:34.850138853 +0000\\n+++ /tmp/puppet-file20191009-20057-12z3c2w\\t2019-10-09 18:07:15.397076080 +0000\\n@@ -1 +1 @@\\n-\\xC7\\xD1\\xFC\\x84\\n\\\\ No newline at end of file\\n+x9H8hA==\\n\\\\ No newline at end of file\\n\"\\nBacktrace:\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:190:in `newmessage'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:313:in `initialize'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:88:in `new'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:88:in `create'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/logging.rb:11:in `send_log'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/logging.rb:20:in `block (2 levels) in <module:Logging>'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/file/data_sync.rb:45:in `block in checksum_insync?'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/file/data_sync.rb:19:in `write_temporarily'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/file/data_sync.rb:44:in `checksum_insync?'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/file/content.rb:104:in `insync?'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/property.rb:278:in `safe_insync?'\r\nNotice: /Stage[main]/Main/Node[default]/File[/tmp/test]/content: content changed '{md5}387d16f3cb61048e6fb16cfd81367ce8' to '{md5}1567c6c4f10f34202b0f7578d8d44e43'\r\nNotice: Applied catalog in 21.24 seconds\r\n{code}\r\n\r\nExcerpted with debug logging:\r\n\r\n{code}\r\n...\r\n2019-10-09 18:25:28 +0000 Puppet (debug): Executing: 'diff -u /tmp/test /tmp/puppet-file20191009-29036-thyi2b'\r\n2019-10-09 18:25:28 +0000 /Stage[main]/Main/Node[default]/File[/tmp/test]/content (notice): Received a Log attribute with invalid encoding:\"\\n--- /tmp/test\\t2019-10-09 18:25:21.809153889 +0000\\n+++ /tmp/puppet-file20191009-29036-thyi2b\\t2019-10-09 18:25:28.063298027 +0000\\n@@ -1 +1 @@\\n-\\xC7\\xD1\\xFC\\x84\\n\\\\ No newline at end of file\\n+x9H8hA==\\n\\\\ No newline at end of file\\n\"\\nBacktrace:\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:190:in `newmessage'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:313:in `initialize'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:88:in `new'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:88:in `create'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/logging.rb:11:in `send_log'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/logging.rb:20:in `block (2 levels) in <module:Logging>'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/file/data_sync.rb:45:in `block in checksum_insync?'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/file/data_sync.rb:19:in `write_temporarily'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/file/data_sync.rb:44:in `checksum_insync?'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/file/content.rb:104:in `insync?'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/property.rb:278:in `safe_insync?'\r\n2019-10-09 18:25:28 +0000 Puppet (debug): Executing: 'diff -u /tmp/test /tmp/puppet-file20191009-29036-2dqm05'\r\n2019-10-09 18:25:28 +0000 /Stage[main]/Main/Node[default]/File[/tmp/test]/content (notice):\r\n2019-10-09 18:25:28 +0000 /Stage[main]/Main/Node[default]/File[/tmp/test]/content (notice): content changed '{md5}387d16f3cb61048e6fb16cfd81367ce8' to '{md5}1567c6c4f10f34202b0f7578d8d44e43' (corrective)\r\n2019-10-09 18:25:28 +0000 /Stage[main]/Main/Node[default]/File[/tmp/test] (debug): The container Node[default] will propagate my refresh event\r\n...\r\n{code}\r\n\r\nThe file is created, but with the base64 content written as a string:\r\n\r\n{code}\r\n[root@pe-201819-master manifests]# od -t x1 /tmp/test\r\n0000000 78 39 48 38 68 41 3d 3d\r\n0000010\r\n\r\n[root@pe-201819-master manifests]# cat /tmp/test\r\nx9H8hA==\r\n{code}\r\n\r\nmd5 of the incorrect content ends in {{4e43}}. md5 of the correct content ends in {{7ce8}}.","closed_at":"2020-01-13T14:15:09.000-0800","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10097","labels":"beginner;resolved-issue-added","state":"Resolved","updated_at":"2020-01-13T14:15:09.000-0800","timestamp":1652286288.15607,"priority":"Normal","status_category":"Done","pull_request":7854},{"issue_id":"337748","title":"Observe server_list for CA requests","url":"https://tickets.puppetlabs.com/browse/PUP-10157","created_at":"2019-12-03T21:40:09.000-0800","number":"PUP-10157","body":"puppet does not observe the {{server_list}} setting when making CA requests. This is a regression introduced in https://tickets.puppetlabs.com/browse/PUP-10040 as it wasn't apparent that {{Puppet::Rest::Routes}} called {{Puppet::Util::Connection.determine_server}} to set the {{@default_server}}.\r\n\r\nWe need to enable the server_list resolver such that:\r\n\r\n# If we successfully resolved the CA server/port once in a session, then we should always reuse that same server/port \r\n# Next if SRV records are enabled, we should try to connect to each entry. If that fails, fallback to #3\r\n# Next if {{server_list}} is set and {{ca_server}} is not set explicitly (so inherits {{server}}), we should try each server/port combo. If the list is exhausted, raise an error.\r\n# Next fallback to {{ca_server}} setting which defaults to {{server}}. If that fails, fallback to #5\r\n# Raise no more routes to try\r\n\r\nNote we are preserving the old behavior of \"if the server list is exhausted, raise an error\" instead of falling back to settings.","closed_at":"2020-01-13T14:30:24.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10157","labels":"resolved-issue-added","state":"Resolved","updated_at":"2020-01-13T14:30:24.000-0800","timestamp":1652286288.2632,"priority":"Normal","status_category":"Done","pull_request":7867},{"issue_id":"337552","title":"Cumulus v4.0.0 support","url":"https://tickets.puppetlabs.com/browse/PUP-10162","created_at":"2019-12-03T12:30:35.000-0800","number":"PUP-10162","body":"Cumulus recently released v4.0.0 of it's operating system: [https://cumulusnetworks.com/about/press-releases/fourth-generation-launch/]\r\n\r\nI've been hitting issues when running Puppet on this, some service definitions that previously worked are no longer valid:\r\n{code:java}\r\nDebug: Service[collectd@mgmt.service](provider=debian): Could not find collectd@mgmt.service in /etc/init.d\r\nDebug: Service[collectd@mgmt.service](provider=debian): Could not find collectd@mgmt.service.sh in /etc/init.d{code}\r\nLooking at the provider code: [https://github.com/puppetlabs/puppet/blob/4f6e758348d6f5e8a287f90f4ea04d9ffec0e4d1/lib/puppet/provider/service/systemd.rb#L28]\r\n\r\nIt seems that this needs to be updated to support Cumulus v4 as well.  I'm not sure if there's other work involved here in adding a new OS version.","closed_at":"2020-01-13T15:09:13.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10162","labels":"resolved-issue-added","state":"Closed","updated_at":"2020-01-13T15:09:13.000-0800","timestamp":1652286288.476337,"priority":"Normal","status_category":"Done","pull_request":7868},{"issue_id":"341094","title":"Unable to create local user when username already exists in Windows domain","url":"https://tickets.puppetlabs.com/browse/PUP-10219","created_at":"2020-01-05T23:31:30.000-0800","number":"PUP-10219","body":"*Puppet Version: 6.3.0*\r\n *Puppet Server Version: N/A (happens with puppet apply)*\r\n *OS Name/Version: Windows Server 2012 R2 (and I believe other Windows OS')*\r\n\r\nWhen using the below user resource declaration on a domain joined computer that also has a user called 'test_user' in the domain an error is thrown and the user is not created.\r\n{quote}{{user { 'test_user':}}\r\n{{  ensure   => present,}}\r\n{{  comment  => 'Test user',}}\r\n{{  password => 'user_pass',}}\r\n{{  groups   => ['Administrators'],}}\r\n{{}}}\r\n{quote}\r\nThe name of the user to be created, whether noop is on/off and whether using puppet apply or puppet agent do not matter.\r\n\r\n*Desired Behavior:*\r\n\r\nA local user with the same name is created on the computer using the attributes specified.\r\n\r\n*Actual Behavior:*\r\n\r\nThe following output is produced:\r\n{quote}{{Notice: Compiled catalog for member.domain.com in environment production in 0.02 seconds}}\r\n{{Error: /Stage[main]/Main/User[test_user]: Could not evaluate: ADSI connection error: failed to parse display name of moniker `WinNT://./test_user,user'}}\r\n{{  HRESULT error code:0x800708ad}}\r\n{{    The user name could not be found.}}\r\n{{Wrapped exception:}}\r\n{{failed to parse display name of moniker `WinNT://./test_user,user'}}\r\n{{  HRESULT error code:0x800708ad}}\r\n{{    The user name could not be found.}}\r\n{{Notice: Applied catalog in 0.04 seconds}}{quote}\r\n \r\n\r\n*Partial workaround:*\r\n\r\nIf we change the manifest to the one shown below then the user is created successfully when not in noop mode:\r\n{quote}{{$username  = 'test_user'}}\r\n{{$user_pass = 'user_pass'}}\r\n{{exec { 'create local user first':}}\r\n{{  command => \"${system32}/net.exe user ${username} ${user_pass} /add /y\",}}\r\n{{  unless  => \"${system32}/net.exe user ${username}\",}}\r\n{{  before  => User[$username],}}\r\n{{}}}\r\n{{user { $username:}}\r\n{{  ensure   => present,}}\r\n{{  comment  => 'Test user',}}\r\n{{  password => $user_pass,}}\r\n{{  groups   => ['Administrators'],}}\r\n{{}}}{quote}\r\nIn noop mode the error still appears.\r\n\r\n*Other information:*\r\n\r\nAccording to the documentation ([https://puppet.com/docs/puppet/latest/types/user.html#user-provider-windows_adsi]) the user resource is for local user management and hence shouldn't be effected by domain users.\r\n\r\nI think the issue lies in the fact that *principal.rb* uses '*LookupAccountSidW*' which specifies that if an account can't be found on the local system it tries to resolve it using domain controllers. [https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-lookupaccountsidw]\r\n\r\nThis is not the behaviour wanted when managing a local user but it looks like the same code is also being used for finding users to be placed as members of groups which does allow domain users.\r\n\r\nI'm wondering if it's possible to separate the local user management out and use '*LookupAccountSidLocalW*' which only looks on the local machine for the account. [https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-lookupaccountsidlocalw]\r\n\r\nA trace log with the original resource declaration is attached\r\n\r\n[^user-trace.log]\r\n\r\n ","closed_at":"2020-01-13T16:55:23.000-0800","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10219","labels":"puppet-agent;puppet-apply;resolved-issue-added;type_and_provider;windows","state":"Resolved","updated_at":"2020-01-13T16:55:23.000-0800","timestamp":1652286288.685285,"priority":"Medium","status_category":"Done","pull_request":7915},{"issue_id":"324443","title":"User resource always reports password changed when account disabled for Win 2012 R2","url":"https://tickets.puppetlabs.com/browse/PUP-10021","created_at":"2019-09-11T19:37:46.000-0700","number":"PUP-10021","body":"This case is already fixed with PUP 4.6.1. Corresponding JIRA case \" https://tickets.puppetlabs.com/browse/PUP-6586\".\r\n\r\nHowever, latest version 6.x, the issue still persists.( PE Version 2019.1.1)\r\n\r\n```\r\nPS C:\\Program Files\\Puppet Labs\\Puppet\\bin> .\\puppet.bat apply -e \"user { 'mcoad\r\nmin': ensure => present, password => 'password@123'}\"\r\nNotice: Compiled catalog for b3apzcy9g7ci4uo.delivery.puppetlabs.net in environm\r\nent production in 0.02 seconds\r\nNotice: /Stage[main]/Main/User[mcoadmin]/ensure: created\r\nNotice: Applied catalog in 0.21 seconds\r\nPS C:\\Program Files\\Puppet Labs\\Puppet\\bin> .\\puppet.bat apply -e \"user { 'mcoad\r\nmin': ensure => present, password => 'password@1234'}\"\r\nNotice: Compiled catalog for b3apzcy9g7ci4uo.delivery.puppetlabs.net in environm\r\nent production in 0.02 seconds\r\nWarning: User[mcoadmin](provider=windows_adsi): The user account 'mcoadmin' is d\r\nisabled; puppet will not reset the password\r\nNotice: /Stage[main]/Main/User[mcoadmin]/password: changed [redacted] to [redact\r\ned]\r\nNotice: Applied catalog in 0.08 seconds\r\n```\r\nThis issue has not appeared over 5.5.x version ( PE Version 2018.1.5)\r\n\r\n```\r\nPS C:\\Program Files\\Puppet Labs\\Puppet\\bin> .\\puppet.bat apply user1.pp\r\nNotice: Compiled catalog for ms2012.ldap.plab in environment production in 0.02 seconds\r\nNotice: /Stage[main]/User1/User[mcoadmin]/password: changed password\r\nNotice: Applied catalog in 0.23 seconds\r\nPS C:\\Program Files\\Puppet Labs\\Puppet\\bin> .\\puppet.bat apply user1.pp\r\nNotice: Compiled catalog for ms2012.ldap.plab in environment production in 0.02 seconds\r\nNotice: Applied catalog in 0.47 seconds\r\n```\r\n","closed_at":"2020-01-14T09:35:19.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10021","labels":"resolved-issue-added","state":"Resolved","updated_at":"2020-01-14T09:35:19.000-0800","timestamp":1652286288.893495,"priority":"Normal","status_category":"Done","pull_request":7792},{"issue_id":"281272","title":"Puppet pidlock checks only look for PID if it is running, not process name","url":"https://tickets.puppetlabs.com/browse/PUP-9247","created_at":"2018-10-18T13:07:23.000-0700","number":"PUP-9247","body":"*Puppet Version: 6.0.2 (or any)*\r\n *Puppet Server Version:  2018.1*\r\n *OS Name/Version: Windows (linux most likely as well)*\r\n\r\nWhen puppet runs it created the pidlock file with the pid of puppet.  If puppet stops/crashes while running the lock file remains.  Puppet reads the file, checks for pid as integer, and sees if that pid is running (system.kill(0) to see if alive). If ANY PID responds, it locks, even if the PID is not a puppet PID.\r\n\r\n*Desired Behavior: Puppet should check PID to see if it is running and its puppet, not just running.*\r\n\r\n*Actual Behavior: if any process has that pid, puppet locks.*\r\n\r\nSteps to replicate (tested on windows 2016 with Puppet 6.0.2)\r\n\r\n1 - start puppet run with 'puppet agent -t'\r\n\r\n2 - while running stop the puppet/puppet-pxp agent services\r\n\r\n3 - open pidloclk file, there should be a PID there\r\n\r\n4 - change PID lock file contents to any other currently running PID\r\n\r\n5 - start puppet / run 'puppet agent -t'\r\n\r\n \r\n\r\nAffected Code: [https://github.com/puppetlabs/puppet/blob/master/lib/puppet/util/pidlock.rb#L55]\r\n\r\nThis is the logic check that only determines if a pid is active, not who owns it.","closed_at":"2020-01-22T22:29:44.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9247","labels":"agent;cspapercuts;linux;puppet-agent;windows","state":"Closed","updated_at":"2020-01-22T22:29:44.000-0800","timestamp":1652286299.814052,"priority":"Normal","status_category":"Done","pull_request":7335},{"issue_id":"23138","title":"Windows File: Error: ReplaceFile is unable to find file (or file resources generating 0 byte files): replace_file errors","url":"https://tickets.puppetlabs.com/browse/PUP-1389","created_at":"2014-01-07T14:17:48.000-0800","number":"PUP-1389","body":"Module to reproduce the issue is here: \r\nhttps://github.com/openstack-hyper-v/puppet-jenkins/\r\n\r\nSpecifically the slave.pp file and the windows file components found in it.\r\n\r\n{noformat}\r\nNotice: /Stage[main]/Jenkins::Slave/File[C:\\ProgramData\\jenkins-slave\\jenkins-slave.xml]/content:\r\n\r\nInfo: FileBucket got a duplicate file {md5}d41d8cd98f00b204e9800998ecf8427e\r\nInfo: /Stage[main]/Jenkins::Slave/File[C:\\ProgramData\\jenkins-slave\\jenkins-slave.xml]: Filebucketed\r\n C:/ProgramData/jenkins-slave/jenkins-slave.xml to puppet with sum d41d8cd98f00b204e9800998ecf8427e\r\nError: ReplaceFile(C:/ProgramData/jenkins-slave/jenkins-slave.xml, C:/ProgramData/jenkins-slave/jenkins-slave.xml20140107-2944-124j5d4):  The system cannot find the file specified.\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/util/windows/file.rb:14:in `replace_file'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:456:in `replace_file'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/type/file.rb:720:in `write'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/type/file/content.rb:150:in `sync'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harness.rb:193:in `sync'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harness.rb:130:in `sync_if_needed'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harness.rb:82:in `block in perform_changes'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harness.rb:81:in `each'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harness.rb:81:in `perform_changes'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/transaction/resource_harness.rb:18:in `evaluate'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:174:in `apply'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:187:in `eval_resource'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:117:in `call'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:117:in `block (2 levels) in evaluate'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:327:in `block in thinmark'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/sys/ruby/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:326:in `thinmark'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:117:in `block in evaluate'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/graph/relationship_graph.rb:118:in `traverse'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/transaction.rb:108:in `evaluate'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/resource/catalog.rb:164:in `block in apply'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/util/log.rb:149:in `with_destination'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/transaction/report.rb:108:in `as_logging_destination'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/resource/catalog.rb:163:in `apply'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:125:in `block in apply_catalog'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:161:in `block in benchmark'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/sys/ruby/lib/ruby/1.9.1/benchmark.rb:295:in `realtime'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:160:in `benchmark'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:124:in `apply_catalog'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/configurer.rb:192:in `run'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/agent.rb:44:in `block (4 levels) in run'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/agent/locker.rb:20:in `lock'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/agent.rb:44:in `block (3 levels) in run'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/agent.rb:114:in `with_client'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/agent.rb:41:in `block (2 levels) in run'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/agent.rb:79:in `run_in_fork'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/agent.rb:40:in `block in run'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:179:in `call'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:179:in `controlled_run'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/agent.rb:38:in `run'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/application/agent.rb:355:in `onetime'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/application/agent.rb:321:in `run_command'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:364:in `block (2 levels) in run'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:470:in `plugin_hook'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:364:in `block in run'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/util.rb:478:in `exit_on_fail'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/application.rb:364:in `run'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/util/command_line.rb:137:in `run'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/lib/puppet/util/command_line.rb:91:in `execute'\r\nC:/Program Files (x86)/Puppet Labs/Puppet/puppet/bin/puppet:4:in `<main>'\r\nError: /Stage[main]/Jenkins::Slave/File[C:\\ProgramData\\jenkins-slave\\jenkins-slave.xml]/content: change from {md5}d41d8cd98f00b204e9800998ecf8427e to {md5}7fdfe67c86f483cc0f89d5842da3aab6 failed:\r\nReplaceFile(C:/ProgramData/jenkins-slave/jenkins-slave.xml, C:/ProgramData/jenkins-slave/jenkins-slave.xml20140107-2944-124j5d4):  The system cannot find the file specified.\r\nNotice: /Stage[main]/Jenkins::Slave/Exec[sc_create_service]: Dependency File[C:\\ProgramData\\jenkins-slave\\jenkins-slave.exe] has failures: true\r\nNotice: /Stage[main]/Jenkins::Slave/Exec[sc_create_service]: Dependency File[C:\\ProgramData\\jenkins-slave\\jenkins-slave.xml] has failures: true\r\nWarning: /Stage[main]/Jenkins::Slave/Exec[sc_create_service]: Skipping because of failed dependencies\r\n{noformat}\r\n\r\nError occurs if file present or not.   \r\n\r\nicacls on files causing issues\r\n{noformat}\r\nC:\\ProgramData\\jenkins-slave>icacls jenkins-slave.exe\r\njenkins-slave.exe BUILTIN\\Administrators:(M,WDAC,WO)\r\n                  HV-COMPUTE09\\None:(RX,W)\r\n                  Everyone:(RX,W)\r\n                  NT AUTHORITY\\SYSTEM:(F)\r\n\r\nSuccessfully processed 1 files; Failed processing 0 files\r\n\r\nC:\\ProgramData\\jenkins-slave>icacls jenkins-slave.xml\r\njenkins-slave.xml NT AUTHORITY\\SYSTEM:(I)(F)\r\n                  BUILTIN\\Administrators:(I)(F)\r\n                  BUILTIN\\Users:(I)(RX)\r\n\r\nSuccessfully processed 1 files; Failed processing 0 files\r\n{noformat}\r\n","closed_at":"2020-01-25T14:42:23.000-0800","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1389","labels":"windows","state":"Closed","updated_at":"2020-01-25T14:42:23.000-0800","timestamp":1652286300.456944,"priority":"Normal","status_category":"Done","pull_request":2270},{"issue_id":"340709","title":"puppet fails with JSON error when a fact value equals Infinity","url":"https://tickets.puppetlabs.com/browse/PUP-10210","created_at":"2019-12-26T11:04:37.000-0800","number":"PUP-10210","body":"*Puppet Version: 6.10 and possibly earlier*\r\n\r\nANY fact converted to / interpreted as (Ruby) {{Infinity}} generates a JSON error when executing {{puppet agent}} or {{puppet facts}} The same error does not occur when executing {{facter -p}}\r\n\r\n*Desired Behavior:*\r\n\r\nNo JSON error via {{puppet}}\r\n\r\n*Actual Behavior:*\r\n\r\n Given:\r\n{code}puppet config print maxwaitforcert\r\nunlimited\r\n{code}\r\nCreate a custom fact for {{maxwaitforcert}}:\r\n{code}Facter.add('maxwaitforcert') do\r\n  setcode do\r\n    Puppet.settings['maxwaitforcert']\r\n  end\r\nend\r\n{code}\r\n{code}[root@pe-201921-master ~]# puppet facts\r\nError: 862: Infinity not allowed in JSON\r\nError: Try 'puppet help facts find' for usage\r\n{code}\r\n{code}[root@pe-201921-master ~]# puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Loading facts\r\nError: Failed to apply catalog: Could not render to json: 862: Infinity not allowed in JSON\r\n{code}\r\nVersus:\r\n{code}[root@pe-201921-master ~]# facter -p maxwaitforcert\r\ninf\r\n{code}\r\n ","closed_at":"2020-01-31T04:25:58.000-0800","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10210","labels":"","state":"Closed","updated_at":"2020-01-31T04:25:58.000-0800","timestamp":1652286302.335774,"priority":"Normal","status_category":"Done","pull_request":7944},{"issue_id":"255723","title":"\"puppet facts upload\" face only tries first master in server_list","url":"https://tickets.puppetlabs.com/browse/PUP-8900","created_at":"2018-05-31T17:23:28.000-0700","number":"PUP-8900","body":"*Puppet Version:* 5.5.1\r\n*Puppet Server Version:* 5.5.2 (2018.1.0.41)\r\n*OS Name/Version:* RHEL 7\r\n\r\nWhen a node's puppet.conf specifies multiple masters in server_list the facts upload face only tries the first master in the list. If this fails due to a hostname lookup failure on the first master the face exits with an error, rather than trying the second master. \r\n\r\nSteps to reproduce:\r\n\r\n- remove any \"server\" configs from puppet.conf\r\n- add the following \"server_list\" configuration: \"foo.example,actual-master.example\" (where \"actual-master.example\" is the working master address, and \"foo.example\" is not resolvable to an IP address)\r\n- run \"puppet facts upload\"\r\n\r\n*Desired Behavior:*\r\n\r\n- the face should gracefully fail over to the second master in the server_list and complete the facts upload successfully\r\n\r\n*Actual Behavior:*\r\n\r\n- the face fails with the following error message:\r\n\r\n{noformat}\r\n# puppet facts upload\r\nNotice: Uploading facts for 'pe-201730-master.puppetdebug.vlan' to: 'foo.example'\r\nError: Failed to open TCP connection to foo.example:8140 (getaddrinfo: Name or service not known)\r\nError: Try 'puppet help facts upload' for usage\r\n{noformat}\r\n\r\nI'm attaching the output of \"puppet facts upload --debug --trace\" as well. \r\n\r\nThis face (and the facts endpoint in puppetserver) were (re)added in this PR: https://github.com/puppetlabs/puppet/pull/6434\r\n","closed_at":"2020-02-18T09:05:07.000-0800","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8900","labels":"resolved-issue-added","state":"Resolved","updated_at":"2020-02-18T09:05:07.000-0800","timestamp":1652286304.858015,"priority":"Normal","status_category":"Done","pull_request":7931},{"issue_id":"310162","title":"Cannot run Puppet Agent as Administrator if first PA run is done as System","url":"https://tickets.puppetlabs.com/browse/PUP-9719","created_at":"2019-05-24T12:40:19.000-0700","number":"PUP-9719","body":"*Puppet Version:* 6.4.2\r\n *Puppet Server Version:* N/A\r\n *OS Name/Version:* Windows Server 2016 x64\r\n\r\nWhen installing Puppet Agent (6.4.2/PE 2019.1.0) on Server 2016 using a Powershell script running as the SYSTEM account, Administrator users can't run Puppet. Daemon/service runs are performed as expected. Direct Puppet runs appear to occur but no report is sent to the master.\r\n *UPDATE* - It the first Run as SYSTEM that is the problem - so have changed ticket title.\r\n\r\nPUP-8939 had reportedly solved this issue.\r\n\r\n*Desired Behavior:*\r\n\r\n*note* - so far, this can only be replicated using scheduled tasks as {{psexec}} doesn't provide the same permissions environment :\r\n # Install: {{schtasks /create /tn PuppetInstall /RL HIGHEST /RU SYSTEM /F /SC ONCE /ST 11:15 /TR 'cmd /c c:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\powershell.exe -sta -WindowStyle Hidden -ExecutionPolicy Bypass -NonInteractive -NoProfile -File c:\\puppet.ps1 >> C:\\windows\\temp\\puppet-ins.log 2>&1'}}\r\n # Run PA {{schtasks /create /tn PuppetInstall /RL HIGHEST /RU SYSTEM /F /SC ONCE /ST 11:17 /TR 'cmd /c c:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\powershell.exe -sta -WindowStyle Hidden -ExecutionPolicy Bypass -NonInteractive -NoProfile -File c:\\puppetrun.ps1 >> C:\\windows\\temp\\puppet-run.log 2>&1'}}\r\n # Populate csr_attributes.yml and {{server}} in the agent config as necessary.\r\n # As an Administrator, run {{puppet agent --test}} on the newly installed agent.\r\n\r\n See [https://gist.github.com/jcoconnor/79767ef986a3ec600de0cd84ec4ea600] for example {{puppet-ins.ps1}} and {{puppet-run.ps1}} scripts.\r\n\r\n*Actual Behavior:*\r\n\r\nCatalog retrieval fails; log has been redacted:\r\n{code}2019-05-21 17:20:36 -0400 Puppet (debug): HTTP POST https://compiler.example.net:8140/puppet/v3/catalog/examplenode.example.net returned 200 OK\r\n2019-05-21 17:20:36 -0400 Puppet (debug): Caching connection for https://compiler.example.net:8140\r\n2019-05-21 17:20:36 -0400 Puppet (info): Caching catalog for examplenode.example.net\r\n2019-05-21 17:20:38 -0400 Puppet (err): ReplaceFile(C:/ProgramData/PuppetLabs/puppet/cache/client_data/catalog/examplenode.example.net.json, C:/ProgramData/PuppetLabs/puppet/cache/client_data/catalog/examplenode.example.net.json20190521-6580-blokpv):  Access is denied. \r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/file.rb:89:in `replace_file'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util.rb:636:in `replace_file'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/indirector/json.rb:17:in `save'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:200:in `find'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:466:in `block in retrieve_new_catalog'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util.rb:518:in `block in thinmark'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/2.5.0/benchmark.rb:308:in `realtime'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util.rb:517:in `thinmark'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:465:in `retrieve_new_catalog'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:75:in `retrieve_catalog'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:167:in `prepare_and_retrieve_catalog'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:342:in `run_internal'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:240:in `block in run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet.rb:264:in `override'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:217:in `run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:59:in `block (5 levels) in run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/2.5.0/timeout.rb:93:in `block in timeout'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/2.5.0/timeout.rb:103:in `timeout'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:58:in `block (4 levels) in run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/agent/locker.rb:21:in `lock'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:52:in `block (3 levels) in run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:130:in `with_client'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:49:in `block (2 levels) in run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:87:in `run_in_fork'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:48:in `block in run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/application.rb:179:in `controlled_run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:46:in `run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:371:in `onetime'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:353:in `run_command'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/application.rb:382:in `block in run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util.rb:671:in `exit_on_fail'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/application.rb:382:in `run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:139:in `run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:77:in `execute'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/bin/puppet:4:in `<main>'\r\n2019-05-21 17:20:38 -0400 Puppet (err): Could not retrieve catalog from remote server: ReplaceFile(C:/ProgramData/PuppetLabs/puppet/cache/client_data/catalog/examplenode.example.net.json, C:/ProgramData/PuppetLabs/puppet/cache/client_data/catalog/examplenode.example.net.json20190521-6580-blokpv):  Access is denied. \r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/file.rb:89:in `replace_file'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util.rb:636:in `replace_file'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/indirector/json.rb:17:in `save'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:200:in `find'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:466:in `block in retrieve_new_catalog'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util.rb:518:in `block in thinmark'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/2.5.0/benchmark.rb:308:in `realtime'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util.rb:517:in `thinmark'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:465:in `retrieve_new_catalog'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:75:in `retrieve_catalog'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:167:in `prepare_and_retrieve_catalog'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:342:in `run_internal'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:240:in `block in run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet.rb:264:in `override'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:217:in `run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:59:in `block (5 levels) in run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/2.5.0/timeout.rb:93:in `block in timeout'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/2.5.0/timeout.rb:103:in `timeout'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:58:in `block (4 levels) in run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/agent/locker.rb:21:in `lock'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:52:in `block (3 levels) in run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:130:in `with_client'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:49:in `block (2 levels) in run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:87:in `run_in_fork'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:48:in `block in run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/application.rb:179:in `controlled_run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:46:in `run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:371:in `onetime'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:353:in `run_command'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/application.rb:382:in `block in run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util.rb:671:in `exit_on_fail'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/application.rb:382:in `run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:139:in `run'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:77:in `execute'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/bin/puppet:4:in `<main>'\r\n{code}\r\nReporting also fails:\r\n{code}2019-05-21 17:20:38 -0400 Puppet (debug): Using cached connection for https://compiler.example.net:8140\r\n2019-05-21 17:20:39 -0400 Puppet (debug): HTTP PUT https://compiler.example.net:8140/puppet/v3/report/examplenode.example.net returned 200 OK\r\n2019-05-21 17:20:39 -0400 Puppet (debug): Caching connection for https://compiler.example.net:8140\r\n2019-05-21 17:20:39 -0400 Puppet (err): Could not send report: ReplaceFile(C:/ProgramData/PuppetLabs/puppet/cache/state/last_run_report.yaml, C:/ProgramData/PuppetLabs/puppet/cache/state/last_run_report.yaml20190521-6580-1yfrb1r):  Access is denied. \r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/file.rb:89:in `replace_file'\r\n...\r\n{code}\r\nACLs from C:\\ProgramData\\PuppetLabs\\puppet\\cache\\ on the agent:\r\n{code}PS C:\\Windows\\system32> Get-Acl C:\\ProgramData\\PuppetLabs\\puppet\\cache\\ | Select *\r\n\r\nPSPath : Microsoft.PowerShell.Core\\FileSystem::C:\\ProgramData\\PuppetLabs\\puppet\\cache\\\r\nPSParentPath : Microsoft.PowerShell.Core\\FileSystem::C:\\ProgramData\\PuppetLabs\\puppet\r\nPSChildName : cache\r\nPSDrive : C\r\nPSProvider : Microsoft.PowerShell.Core\\FileSystem\r\nCentralAccessPolicyId :\r\nCentralAccessPolicyName :\r\nPath : Microsoft.PowerShell.Core\\FileSystem::C:\\ProgramData\\PuppetLabs\\puppet\\cache\\\r\nOwner : NT AUTHORITY\\SYSTEM\r\nGroup : NT AUTHORITY\\SYSTEM\r\nAccess : {System.Security.AccessControl.FileSystemAccessRule,\r\nSystem.Security.AccessControl.FileSystemAccessRule,\r\nSystem.Security.AccessControl.FileSystemAccessRule}\r\nSddl : O:SYG:SYD:AI(A;OICIID;FA;;;SY)(A;OICIID;FA;;;BA)(A;OICIID;FA;;;S-1-5-21-1092630797-2642148860\r\n-572411492-162715)\r\nAccessToString : NT AUTHORITY\\SYSTEM Allow FullControl\r\nBUILTIN\\Administrators Allow FullControl\r\nDEVAONNET\\ah14740 Allow FullControl\r\nAuditToString :\r\nAccessRightType : System.Security.AccessControl.FileSystemRights\r\nAccessRuleType : System.Security.AccessControl.FileSystemAccessRule\r\nAuditRuleType : System.Security.AccessControl.FileSystemAuditRule\r\nAreAccessRulesProtected : False\r\nAreAuditRulesProtected : False\r\nAreAccessRulesCanonical : True\r\nAreAuditRulesCanonical : True\r\n{code}","closed_at":"2020-02-18T09:07:00.000-0800","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9719","labels":"resolved-issue-added","state":"Resolved","updated_at":"2020-02-18T09:07:00.000-0800","timestamp":1652286304.96996,"priority":"Major","status_category":"Done","pull_request":7807},{"issue_id":"338721","title":"Generalize forcelocal parameter use for user/group resources","url":"https://tickets.puppetlabs.com/browse/PUP-10169","created_at":"2019-12-10T01:15:59.000-0800","number":"PUP-10169","body":"Currently, the {{forcelocal}} parameter forces the management of local accounts/groups when they are also being managed by some other NSS. However, this parameter is wrongly coupled with the {{libuser}} feature, which is a platform-specific application.\r\n\r\nThis parameter can also be used on AIX and Windows, but due to the way it was implemented it is impossible to do so.\r\n\r\nPUP-9465 and PUP-10168 are tasked with separating the libuser functionality from the useradd/groupadd providers into a separate libuser provider.\r\n\r\nWhen that work is complete, we can work on generalizing the {{forcelocal}} parameter:\r\n- add a new feature called {{manages_local_users/groups}}\r\n- remove the {{libuser}} feature\r\n- make {{forcelocal}} require the new {{manages_local_users/groups}} feature instead\r\n- update impacted providers accordingly","closed_at":"2020-02-18T09:10:05.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10169","labels":"resolved-issue-added","state":"Resolved","updated_at":"2020-02-18T09:10:05.000-0800","timestamp":1652286305.076239,"priority":"Normal","status_category":"Done","pull_request":7936},{"issue_id":"40051","title":"\"Array\" settings get misleading formatting for default values and error reporting","url":"https://tickets.puppetlabs.com/browse/PUP-2820","created_at":"2014-06-23T10:28:47.000-0700","number":"PUP-2820","body":"From the user's perspective, the new \":array\" settings type is just a comma separated list, like we use in existing settings like {{dns_alt_names}} or {{tags}}. But the default values and error reporting for the {{disable_warnings}} setting aren't formatted with this in mind, and are presented in a confusing fashion:\r\n \r\n{code}\r\nError: Could not initialize global default settings: Cannot disable unrecognized warning types [\"stuff\"]. Valid values are [\"deprecations\"].\r\n{code}\r\n\r\nSee also the config reference, which shows the default value as \"[]\". (http://docs.puppetlabs.com/references/latest/configuration.html#disablewarnings) \r\n\r\nIf you try to follow these hints and give a value like {{[deprecations]}}, you get:\r\n\r\n{code}\r\nError: Could not initialize global default settings: Cannot disable unrecognized warning types [\"[deprecations\"]\"]. Valid values are [\"deprecations\"].\r\n{code}\r\n\r\nBoo. The UI is a comma-separated list without brackets, so any error or information reporting should present that same UI.","closed_at":"2020-02-18T09:15:16.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2820","labels":"beginner;help_wanted;resolved-issue-added;simplefix","state":"Resolved","updated_at":"2020-02-18T09:15:16.000-0800","timestamp":1652286305.181919,"priority":"Normal","status_category":"Done","pull_request":7940},{"issue_id":"346292","title":"Order dependent test failure with recent pidlock changes","url":"https://tickets.puppetlabs.com/browse/PUP-10294","created_at":"2020-02-13T16:57:21.000-0800","number":"PUP-10294","body":"{noformat}\r\n$ bundle exec ruby --version\r\nruby 2.3.8p459 (2018-10-18 revision 65136) [x86_64-darwin18]\r\n$ git rev-parse HEAD\r\n88cb4f20657b9ea7b9eafc34a6039bde5102c5cd\r\n$ bundle exec rspec spec/unit/agent_spec.rb:220  spec/unit/util/pidlock_spec.rb:23\r\n...\r\n  1) Puppet::Util::Pidlock#ps pid argument on posix should allow ps execution\r\n     Failure/Error: expect(@lock).to be_locked\r\n       expected `#<Puppet::Util::Pidlock:0x00007fd1d5a5f308 @lockfile=#<Puppet::Util::Lockfile:0x00007fd1d5a5f2e0 @fil...ers/8m/d6146zxd6bv_3h8y4ykvvxh40000gn/T/rspecrun20200213-39510-1m2gjzq/lock20200213-39510-15x8lj0\">>.locked?` to return true, got false\r\n     # ./spec/unit/util/pidlock_spec.rb:23:in `block (3 levels) in <top (required)>'\r\n     # ./spec/spec_helper.rb:180:in `block (2 levels) in <top (required)>'\r\n\r\nFinished in 0.11031 seconds (files took 0.99606 seconds to load)\r\n2 examples, 1 failure\r\n{noformat}\r\n\r\nRunning the pidlock spec in isolation works fine, so something about the agent_spec is leaking into the other test.","closed_at":"2020-02-20T23:59:33.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10294","labels":"","state":"Resolved","updated_at":"2020-02-20T23:59:33.000-0800","timestamp":1652286306.331687,"priority":"Normal","status_category":"Done","pull_request":7985},{"issue_id":"129419","title":"Cannot convert Puppet::Util::Log to integer","url":"https://tickets.puppetlabs.com/browse/PUP-6256","created_at":"2016-05-02T13:40:35.000-0700","number":"PUP-6256","body":"Re-creating [this issue|https://projects.puppetlabs.com/issues/22930]. There seems to be a bug in a particular method where an integer return value is expected, but a log object is returned instead. This prevents the exception from bubbling up into an error that the user can actually understand","closed_at":"2020-02-21T14:40:29.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6256","labels":"","state":"Closed","updated_at":"2020-02-21T14:40:29.000-0800","timestamp":1652286306.647624,"priority":"Normal","status_category":"Done","pull_request":6002},{"issue_id":"278499","title":"puppet ignores exit code from windows exe package install because it uses 'start'","url":"https://tickets.puppetlabs.com/browse/PUP-9193","created_at":"2018-10-02T09:18:12.000-0700","number":"PUP-9193","body":"This effects all supported versions of puppet:\r\n\r\nWe use \"cmd /c start\" to execute exe package installs on Windows: https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/package/windows/exe_package.rb#L45. Comments suggest this is because otherwise executables that are console apps will launch a new window (which is undesired).\r\n\r\nHowever, the use of \"start\" means the calling process (i.e. puppet) will never see the actual exit code from the installation, only the exit code from the call to start (which will be 0: success) \r\n\r\nThis means from puppet's perspective exe package installs _always_ succeed and puppet will always report a successful installation, regardless of whether or not the application install actually succeeded.","closed_at":"2020-02-24T12:04:34.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9193","labels":"package;type_and_provider;windows","state":"Closed","updated_at":"2020-02-24T12:04:34.000-0800","timestamp":1652286307.500926,"priority":"Normal","status_category":"Done","pull_request":7145},{"issue_id":"16393","title":"(#22719) Allow exec to runas different user on windows","url":"https://tickets.puppetlabs.com/browse/PUP-532","created_at":"2013-10-08T09:26:33.000-0700","number":"PUP-532","body":"The `exec` type has a `user` parameter that allows the exec to be performed as a different user. On Windows, this functionality is not supported, because unlike *nix, we can't switch users without the password.\r\n\r\nTo support this feature, we would need to add a `password` parameter to the `exec` type, and modify the SUIDManager to support switching users on Windows.","closed_at":"2020-02-25T14:24:56.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-532","labels":"exec;windows","state":"Ready for Engineering","updated_at":"2020-02-25T14:24:56.000-0800","timestamp":1652286308.233269,"priority":"Normal","status_category":"To Do","pull_request":4248},{"issue_id":"19915","title":"Puppet silent about inability to acquire pidlock","url":"https://tickets.puppetlabs.com/browse/PUP-911","created_at":"2013-12-02T15:26:19.000-0800","number":"PUP-911","body":"The {{--verbose}} flag does tell the user that something has happened, but without it there isn't any indication. I would expect the error to always show up (even without verbose) and a non-zero exit status.\r\n\r\n{noformat}\r\nroot@debian-607-x64-vf503-nocm:~# puppet agent --verbose\r\nError: Could not run: Could not create PID file: /var/run/puppet/agent.pid\r\nroot@debian-607-x64-vf503-nocm:~# echo $?\r\n0\r\nroot@debian-607-x64-vf503-nocm:~# puppet agent\r\nroot@debian-607-x64-vf503-nocm:~# echo $?\r\n0\r\n{noformat}","closed_at":"2020-02-26T16:31:25.000-0800","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-911","labels":"","state":"Closed","updated_at":"2020-02-26T16:31:25.000-0800","timestamp":1652286308.459486,"priority":"Minor","status_category":"Done","pull_request":7105},{"issue_id":"36799","title":"puppet describe --list requires the description to include a period","url":"https://tickets.puppetlabs.com/browse/PUP-2641","created_at":"2014-05-22T14:30:13.000-0700","number":"PUP-2641","body":"Given this code:\r\n\r\n{code:ruby}\r\n    Puppet::Type.newtype(:rcsrepo) do\r\n      desc 'A local version control repository'\r\n      ensurable\r\n      ...\r\n    end\r\n{code}\r\n\r\nI see this behavior.\r\n\r\n{noformat}\r\n    [root@master ~]# puppet describe --list | grep rcsrepo\r\n    rcsrepo         - .. no documentation ..\r\n    [root@master ~]# puppet describe rcsrepo\r\n \r\n    rcsrepo\r\n    =======\r\n    A local version control repository\r\n{noformat}\r\n\r\nIf I add a period at the end, `puppet describe --list` outputs as expected.\r\n\r\nSee [https://github.com/puppetlabs/puppet/blob/master/lib/puppet/application/describe.rb#L73](https://github.com/puppetlabs/puppet/blob/master/lib/puppet/application/describe.rb#L73)\r\n\r\nWhy is this?","closed_at":"2020-02-28T19:17:21.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2641","labels":"beginner;help_wanted;redmine","state":"Resolved","updated_at":"2020-02-28T19:17:21.000-0800","timestamp":1652286308.775336,"priority":"Normal","status_category":"Done","pull_request":7993},{"issue_id":"338977","title":"Cannot change flavor on installed dnf module","url":"https://tickets.puppetlabs.com/browse/PUP-10171","created_at":"2019-12-11T04:24:20.000-0800","number":"PUP-10171","body":"*Puppet Version:* 6.11.0\r\n *OS Name/Version:* CentOS/RHEL/Fedora\r\n\r\nApply the following manifest installing the postgresql module stream with the {{client}} flavor/profile:\r\n\r\n{{package {'postgresql':}}\r\n {{  ensure   => '9.6',}}\r\n {{  flavor   => 'client',}}\r\n {{  provider => 'dnfmodule',}}\r\n {{}}}\r\n\r\nApply the following manifest, changing the flavor:\r\n\r\n{{package {'postgresql':}}\r\n {{  ensure   => '9.6',}}\r\n {{  flavor   => '*server*',}}\r\n {{  provider => 'dnfmodule',}}\r\n {{}}}\r\n\r\n*Desired Behavior:*\r\n\r\n{{postgres --version}} should print out the PostgreSQL server version.\r\n\r\n*Actual Behavior:*\r\n\r\n{{postgres}} does not exist because the installed flavor is still *client*, not *server*.\r\n\r\nThis can be confirmed with: {{dnf module list --installed}}","closed_at":"2020-03-03T03:23:57.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10171","labels":"resolved-issue-added","state":"Resolved","updated_at":"2020-03-03T03:23:57.000-0800","timestamp":1652286309.410098,"priority":"Normal","status_category":"Done","pull_request":7906},{"issue_id":"342832","title":"Cannot set/change password of a user resource on macOS 10.15","url":"https://tickets.puppetlabs.com/browse/PUP-10246","created_at":"2020-01-21T06:28:19.000-0800","number":"PUP-10246","body":"It looks like direct access to binary plists under {{/var/db/dslocal/nodes/Default/}} has been blocked beginning with macOS 10.15 (even with Full Disk Access activated), so we can no longer overwrite that file to set/change the password on an macOS user.\r\n\r\n{code}\r\nError: Unable to write the file /var/db/dslocal/nodes/Default/users/testuser.plist. #<IOError: File /var/db/dslocal/nodes/Default/users/testuser.plist not writable!>\r\n{code}\r\n\r\nThere's still _a way_ to circumvent this and still be able to modify passwords. It involves the use of the {{dsimport}} command to indirectly manipulate the contents of the binary user plist.\r\n\r\nFor this, we need to have the {{ShadowHashData}} (which we previously wrote to the plist) in binary format, then converted to base64.\r\n\r\nHere is some ancient {{dsimport}} documentation (Apple seems to have removed all mentions of this tool since, but it still works): http://web.archive.org/web/20090106120111/http://support.apple.com/kb/TA21305?viewlocale=en_US\r\n\r\nBasically the steps would be to:\r\n1. If the user exists, remove the existing ShadowHashData (with dscl delete)\r\n {{dscl -plist . read /Users/testuser}} should show no {{ShadowHashData}}\r\n2. Import the file with the base64-converted hash using dsimport: {{dsimport /file/to/import /Local/Default M}}\r\n {{dscl -plist . read /Users/testuser}} should show the new {{ShadowHashData}}\r\n\r\nThe challenge that remains is to correctly build the ShadowHashData plist, convert it to binary and then to base64, then build the dsimport file.\r\n\r\nAs per the documentation above, this is a file that changes the hashed password of an existing account:\r\n\r\n{code}\r\n0x0A 0x5C 0x3A 0x2C dsRecTypeStandard:Users 2 dsAttrTypeStandard:RecordName base64:dsAttrTypeNative:ShadowHashData\r\ntestuser:<base64 string>\r\n{code}","closed_at":"2020-03-03T03:25:32.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10246","labels":"resolved-issue-added","state":"Resolved","updated_at":"2020-03-03T03:25:32.000-0800","timestamp":1652286309.51426,"priority":"Normal","status_category":"Done","pull_request":7945},{"issue_id":"345706","title":"mailalias always performs a \"change\" when value has a comma","url":"https://tickets.puppetlabs.com/browse/PUP-10287","created_at":"2020-02-10T00:48:00.000-0800","number":"PUP-10287","body":"I'm using puppet 2.7 and on one node, I have a mailalias resource to\r\nsetup something for redmine like the following:\r\n\r\n{code}\r\n    mailalias {\r\n        \"redmine\":\r\n            recipient =>\r\n'|/usr/share/redmine/extra/mail_handler/sub-mailhandler.py -e\r\nredmine@redmine.example.com -- /usr/share/redmine/extra/mail_handler/rdm-mailhandler.rb --url https://redmine.example.com --key somerandomalphanumstring --no-check-certificate --unknown-user accept --no-permission-check --allow-override project,tracker,category,priority,status';\r\n    }\r\n{code}\r\n\r\npuppet is always refreshing the alias for no reason. changing the value\r\nto the same thing.\r\n\r\nafter doing some more testing, I found out that mailalias bugs in the above manner as soon as there is a comma in the recipient parameter value (e.g. with \"...project\" it's ok but with \"...project,\" I start seeing the issue).","closed_at":"2020-03-03T03:25:50.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10287","labels":"resolved-issue-added","state":"Resolved","updated_at":"2020-03-03T03:25:50.000-0800","timestamp":1652286318.638847,"priority":"Normal","status_category":"Done","pull_request":7972},{"issue_id":"24894","title":"Dpkg package provider misbehaving for held package with specific version","url":"https://tickets.puppetlabs.com/browse/PUP-1537","created_at":"2014-01-29T10:59:04.000-0800","number":"PUP-1537","body":"Judging from this StackOverflow question [1], I am running into a long-standing problem with the dpkg package provder. I have packages pinned to specific versions in Puppet with\r\n\r\n       ensure => 'version_string'\r\n\r\nand at the same time have put these packages on 'hold' with dpkg to prevent unintended manual upgrades. Now, on every Puppet run, I get this:\r\n\r\n       Package[mypackage]/ensure: ensure changed 'held' to 'version_string'\r\n\r\nI assume this is because of the following code in provider/package/dpkg.rb, line 92 (in Puppet 3.3.2-1puppetlabs1):\r\n\r\n       hash[:ensure] = :held if hash[:desired] == 'hold'\r\n\r\nwhich sets the current 'ensure' to 'held', where the desired 'ensure' is the package version. It seems to me that the 'ensure' parameter should not be (ab)used to implement the 'holdable' feature.\r\n\r\n[1] http://serverfault.com/questions/370266/puppet-using-ensure-with-package-version-and-held","closed_at":"2020-03-03T03:26:01.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1537","labels":"debian;linux;package;puppethack;redmine;resolved-issue-added;type_and_provider;ubuntu","state":"Resolved","updated_at":"2020-03-03T03:26:01.000-0800","timestamp":1652286318.744054,"priority":"Normal","status_category":"Done","pull_request":7815},{"issue_id":"348479","title":"Client does not reconnect when the server closes a persistent connection","url":"https://tickets.puppetlabs.com/browse/PUP-10347","created_at":"2020-03-03T17:25:10.000-0800","number":"PUP-10347","body":"Puppet may fail to reuse a previously cached connection under the following conditions:\r\n\r\n1. It uses the new HTTP client\r\n2. The previous request was kept alive (the server didn't send {{Connection: close}})\r\n3. The server closes the connection between the time that the client caches it and when the client tries to reuse it.\r\n\r\nPuppet will report that the connection was \"interrupted after 0.001 seconds\".\r\n\r\nThe issue occurs because puppet's HTTP client makes a non-local return from the block passed to {{Net::HTTP#request}}. As a result the {{Net::HTTP#end_transport}} method is never called, which is what sets {{last_communication}} to the current timestamp. https://github.com/ruby/ruby/blob/v2_5_7/lib/net/http.rb#L1567\r\n\r\nThe next time {{Net::HTTP#request}} is called, the client's side of the socket is still open and it interprets the nil {{last_communication}} value to mean \"we've never used this connection before\", so it skips the call to {{Net::HTTP#connect}}. https://github.com/ruby/ruby/blob/v2_5_7/lib/net/http.rb#L1537-L1546\r\n\r\nBut as soon as it tries to write the request and read the response, EOFError is raised.","closed_at":"2020-03-04T11:43:45.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10347","labels":"","state":"Resolved","updated_at":"2020-03-04T11:43:45.000-0800","timestamp":1652286319.804141,"priority":"Normal","status_category":"Done","pull_request":8015},{"issue_id":"347571","title":"Puppet tries to print ssl information for non-ssl connections in debug mode","url":"https://tickets.puppetlabs.com/browse/PUP-10314","created_at":"2020-02-25T14:09:42.000-0800","number":"PUP-10314","body":"When running in debug mode, puppet tries to print ssl information (protocol & ciphers) for each new connection, but it does it for non-ssl connections. It's unlikely to be triggered in 6.13.0 because only the CA REST APIs and PMT are using the new http client, but can be triggered via:\r\n\r\n {noformat}\r\n$ bx puppet module search puppetlabs-stdlib --debug --module_repository=http://localhost:8081/artifactory/api/puppet/puppet\r\nDebug: Runtime environment: puppet_version=6.13.0, ruby_version=2.3.8, run_mode=user, default_encoding=UTF-8\r\nNotice: Searching http://localhost:8081/artifactory/api/puppet/puppet ...\r\nDebug: Could not find library 'pe_license' required to enable feature 'pe_license'\r\nDebug: Creating new connection for http://localhost:8081\r\nDebug: Starting connection for http://localhost:8081\r\nError: Could not connect to http://localhost:8081/artifactory/api/puppet/puppet\r\n  There was a network communications problem\r\n    The error we caught said 'Request to http://localhost:8081/artifactory/api/puppet/puppet/v3/modules?query=puppetlabs-stdlib failed after 0.002 seconds: undefined method `ssl_version' for #<TCPSocket:fd 9>'\r\n{noformat}\r\n\r\nThe problem is a {{verifier}} is being passed to the {{pool}} in the non-ssl case, and the pool is using that to determine if the connection is ssl based or not.\r\n","closed_at":"2020-03-04T11:46:28.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10314","labels":"","state":"Resolved","updated_at":"2020-03-04T11:46:28.000-0800","timestamp":1652286319.907408,"priority":"Normal","status_category":"Done","pull_request":8003},{"issue_id":"203387","title":"puppet resource <...> --to_yaml mishandles structured resource values","url":"https://tickets.puppetlabs.com/browse/PUP-7808","created_at":"2017-08-01T09:47:23.000-0700","number":"PUP-7808","body":"I'm specifically experiencing this with\r\n\r\n{code}\r\npuppet resource ec2_instance --to_yaml\r\n{code}\r\n\r\nusing the puppetlabs-aws module from the forge. The module itself doesn't seem to be touching any yaml related stuff. Without the yaml flag I get this data: https://gist.github.com/wkalt/a97a42b84b1afc3cd23236ea32eed3fa and using the yaml flag I get https://gist.github.com/wkalt/a97a42b84b1afc3cd23236ea32eed3fa . Note that the former has ruby maps embedded, which is the bug.","closed_at":"2020-03-05T00:32:15.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7808","labels":"resolved-issue-added","state":"Resolved","updated_at":"2020-03-05T00:32:15.000-0800","timestamp":1652286339.989911,"priority":"Normal","status_category":"Done","pull_request":7718},{"issue_id":"347941","title":"Secondary group handling causing issues in 6.13.0","url":"https://tickets.puppetlabs.com/browse/PUP-10320","created_at":"2020-02-28T11:47:31.000-0800","number":"PUP-10320","body":"*Puppet Version: 6.13.0*\r\n *Puppet Server Version: 6.9.0-1.el7*\r\n *OS Name/Version: Centos 7*\r\n\r\nIssues with managing users, groups and secondary groups with 6.13.0, issue is not present in 6.12.0.\r\n\r\n*Desired Behavior:*\r\n\r\n \r\n\r\n{{Info: Applying configuration version '1582911791'}}\r\n {{Notice: /Stage[main]/Users::Users/Users::Local_user[jsmith]/Accounts::User[jsmith]/Group[jsmith]/ensure: created}}\r\n {{Notice: /Stage[main]/Users::Users/Users::Local_user[jsmith]/Accounts::User[jsmith]/User[jsmith]/ensure: created}}\r\n {{Notice: /Stage[main]/Users::Groups/Users::Virtual_group[dev]/Group[dev]/members: members changed 'auser,another' to ['auser', 'another', 'jsmith'] (corrective)}}\r\n\r\n \r\n\r\n*Actual Behavior:*\r\n\r\n{{Info: Loading facts}}\r\n {{Error: Failed to apply catalog: Parameter members failed on Group[dev]: can't find user for jsmith (file: /etc/puppetlabs/code/environments/production/modules/users/manifests/virtual_group.pp, line: 13)}}\r\n\r\n \r\n\r\nlocal_user.pp contains the following code...\r\n\r\n{{accounts::user { \"$title\":}}\r\n {{  ensure => $ensure,}}\r\n {{  shell => $shell,}}\r\n {{  comment => $comment,}}\r\n {{  home => $home,}}\r\n {{  home_mode => $home_mode,}}\r\n {{  uid => $uid,}}\r\n {{  gid => $gid,}}\r\n {{  group => $group,}}\r\n {{  create_group => $create_group,}}\r\n {{  membership => $membership,}}\r\n {{  forcelocal => $forcelocal,}}\r\n {{  password => $password,}}\r\n {{  locked => $locked,}}\r\n {{  sshkeys => $sshkeys,}}\r\n {{  purge_sshkeys => $purge_sshkeys,}}\r\n {{  managehome => $managehome,}}\r\n {{  bashrc_content => $bashrc_content,}}\r\n {{  bashrc_source => $bashrc_source,}}\r\n {{  bash_profile_content => $bash_profile_content,}}\r\n {{  bash_profile_source => $bash_profile_source,}}\r\n {{  system => $system,}}\r\n {{  ignore_password_if_empty => $ignore_password_if_empty,}}\r\n {{  forward_content => $forward_content,}}\r\n {{  forward_source => $forward_source,}}\r\n \\{{ }}}\r\n\r\n{{User[$title] -> Group[$groups.delete($group)]}}\r\n\r\n \r\n\r\nOn 6.12.0 and earlier we see the primary group created, the user and the secondary group, on 6.13.0 this does not occur we get an error that the not yet created user can't be found.\r\n\r\n ","closed_at":"2020-03-06T02:34:11.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10320","labels":"","state":"Resolved","updated_at":"2020-03-06T02:34:11.000-0800","timestamp":1652286340.983591,"priority":"Normal","status_category":"Done","pull_request":8013},{"issue_id":"348856","title":"Agents no longer accept rich data in catalogs","url":"https://tickets.puppetlabs.com/browse/PUP-10359","created_at":"2020-03-05T15:32:15.000-0800","number":"PUP-10359","body":"Add the following to a puppetserver's site.pp:\r\n\r\n{code:puppet}\r\nnotify { \"deferred\":\r\n   message => Deferred(\"join\", [[1, 2, 3], \":\"])\r\n}\r\n{code}\r\n\r\nRun an agent from the same host or different host. The {{Accept}} header is missing rich data so the server returns an JSON catalog:\r\n\r\n{noformat}\r\n$ git rev-parse HEAD\r\ne9107d98e911f8b956061ab0d5a116c559b8b9a3\r\n$ bundle exec puppet agent -t --http_debug\r\n-> \"POST /puppet/v3/catalog/XXX?environment=production HTTP/1.1\\r\\nX-Puppet-Version: 6.14.0\\r\\nUser-Agent: Puppet/6.14.0 Ruby/2.5.7-p206 (x86_64-darwin18)\\r\\nAccept: application/json, application/x-msgpack, text/pson\\r\\nAccept-Encoding: gzip;q=1.0,deflate;q=0.6,identity;q=0.3\\r\\nHost: indoor-overtime.delivery.puppetlabs.net:8140\\r\\nContent-Length: 8002\\r\\nContent-Type: application/x-www-form-urlencoded\\r\\n\\r\\n\"\r\n...\r\n-> \"HTTP/1.1 200 OK\\r\\n\"\r\n-> \"Date: Thu, 05 Mar 2020 23:29:16 GMT\\r\\n\"\r\n-> \"Content-Type: application/json;charset=utf-8\\r\\n\"\r\n-> \"X-Puppet-Version: 6.14.0\\r\\n\"\r\n-> \"Vary: Accept-Encoding, User-Agent\\r\\n\"\r\n-> \"Content-Encoding: gzip\\r\\n\"\r\n-> \"Content-Length: 431\\r\\n\"\r\n-> \"\\r\\n\"\r\n{noformat}\r\n\r\nAs a result the deferred function is never evaluated on the client. In 6.13.0, the agent sends:\r\n\r\n{noformat}\r\n<- \"POST /puppet/v3/catalog/XXX?environment=production HTTP/1.1\\r\\nAccept: application/vnd.puppet.rich+json, application/json, application/vnd.puppet.rich+msgpack, application/x-msgpack, text/pson\\r\\nX-Puppet-Version: 6.13.0\\r\\nAccept-Encoding: gzip;q=1.0,deflate;q=0.6,identity;q=0.3\\r\\nUser-Agent: Puppet/6.13.0 Ruby/2.5.7-p206 (x86_64-darwin18)\\r\\nHost: indoor-overtime.delivery.puppetlabs.net:8140\\r\\nContent-Length: 7976\\r\\nContent-Type: application/x-www-form-urlencoded\\r\\n\\r\\n\"\r\n...\r\n{noformat}\r\n\r\nSo something is broken in how the agent generates the list of {{Accept}} headers.\r\n\r\nAdditionally static catalogs are broken and server_list is not used to resolve the file server or report services.","closed_at":"2020-03-06T11:09:25.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10359","labels":"","state":"Resolved","updated_at":"2020-03-06T11:09:25.000-0800","timestamp":1652286341.085035,"priority":"Normal","status_category":"Done","pull_request":8024},{"issue_id":"322755","title":"no_proxy config setting is overridden by http_proxy environment variable","url":"https://tickets.puppetlabs.com/browse/PUP-9990","created_at":"2019-08-29T06:40:03.000-0700","number":"PUP-9990","body":"*Puppet Version: 6.8.0*\r\n *Puppet Server Version: 6.5.0*\r\n *OS Name/Version: CentOS 6/7*\r\n\r\nI'm seeing {{puppet-agent}} fail to respect the {{no_proxy}} setting when defined in the config file. Having checked the diff that merged this support into 6.8.0, I've added some debug logging to identify the code path being taken, and it correctly determines a proxy should be bypassed, but then tries to use the proxy to connect to the {{puppetserver}} anyway, which is blocked by local policy\r\n\r\n*Desired Behavior:*\r\n\r\nPuppet agent should respect the {{no_proxy}} setting in {{puppet.conf}}\r\n\r\n*Actual Behavior:*\r\n\r\n{code:none}\r\npuppet agent --test --server_list master1 --noop\r\n# Lots of debug output omitted\r\nDebug: LOCAL Using settings no_proxy 10.0.0.0/8,example.com,*.example.com,local,*.local,127.0.0.1,localhost,master1,master2\r\nDebug: LOCAL not using proxy because destination (?-mix:^master1$) matched a no_proxy entry for master1\r\nDebug: LOCAL not using proxy because no_proxy? returned True\r\nDebug: Starting connection for https://master1:8140\r\nDebug: Unable to connect to server from server_list setting: 403 \"Forbidden\"\r\nError: Could not run Puppet configuration client: Could not select a functional puppet master from server_list: 'master1'\r\n# 403 Forbidden is coming from local webproxy\r\n{code}\r\n\r\n(hostnames and actual value of no_proxy obfuscated. Lines containing LOCAL are local modifications to the puppet code to expose the behaviour).\r\n\r\nI only see this happen when the {{no_proxy}} setting is being read from {{puppet.conf}}. If {{no_proxy}} is set as env var, it properly bypasses the proxy for the unqualified hostname which matches the {{no_proxy}} value.\r\n\r\nIt feels like {{puppet agent}} is not using the proxy settings from puppet.conf at all. It does all the work to decide whether it should and that answer isn't respected by the thing that actually makes the requests to the {{puppetserver}}\r\n","closed_at":"2020-03-11T01:46:19.000-0700","comments":16,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9990","labels":"jira_escalated;proxy;resolved-issue-added","state":"Resolved","updated_at":"2020-03-11T01:46:19.000-0700","timestamp":1652286342.004217,"priority":"Normal","status_category":"Done","pull_request":7699},{"issue_id":"235343","title":"Agent's node request fails if environment directory doesn't exist locally","url":"https://tickets.puppetlabs.com/browse/PUP-8419","created_at":"2018-02-06T01:49:56.000-0800","number":"PUP-8419","body":"Hi there,\r\n\r\nour puppet-agent got upgraded from 5.3.3 to 5.3.4 on all of our servers (Debian 8, Debian 9) and some of them throw a Warning at the beginning of their puppetrun.\r\n{noformat}\r\nWarning: Unable to fetch my node definition, but the agent run will continue:\r\nWarning: Could not intern from application/json: Could not find a directory environment named 'my_custom_env' anywhere in the path: /etc/puppetlabs/code/environments. Does the directory exist?\r\n{noformat}\r\n\r\n\"my_custom_env\" is located on my puppetserver under \"/opt\" somewhere so I don't know where \"/etc/puppetlabs/code/environments\" is coming from. Have you encountered this warning before? Do you know how to fix this?\r\n\r\nbest regards and thanks\r\nSebastian","closed_at":"2020-03-31T20:55:59.000-0700","comments":20,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8419","labels":"regression","state":"Closed","updated_at":"2020-03-31T20:55:59.000-0700","timestamp":1652286344.993663,"priority":"Blocker","status_category":"Done","pull_request":6618},{"issue_id":"123360","title":"Multiple contradictory 'consumes' annotation do not lead to an error","url":"https://tickets.puppetlabs.com/browse/PUP-6087","created_at":"2016-03-23T16:45:16.000-0700","number":"PUP-6087","body":"I have a {{Sql}} service resource that is exported by a {{Db}} component and define a {{Web}} component as follows:\r\n{code}\r\ndefine web(\r\n  $database = undef,\r\n  $dbuser = undef,\r\n  $dbpassword = undef,\r\n  $dbhost = undef,\r\n  $port = 80)\r\n{\r\n  $txt = @(\"EOS\")\r\nWeb server ${name} on ${::fqdn}:\r\n  connect to ${dbuser}:${dbpassword}@${dbhost}/${database}\r\n\r\nuptime: ${uptime_seconds}\r\nEOS\r\n\r\n  file { \"/root/${name}.txt\": content => $txt }\r\n}\r\n\r\nWeb consumes Sql {\r\n  dbuser => 'nouser',\r\n  dbpassword => 'nopassword',\r\n  dbhost => 'nohost',\r\n  database => 'nodatabase'\r\n}\r\n\r\nWeb consumes Sql {\r\n  dbuser => $user,\r\n  dbpassword => $password,\r\n  dbhost => $host,\r\n  database => $database\r\n}\r\n{code}\r\n\r\nEven though there are two {{Web consumes Sql}} annotations with contradictory parameter mappings, it is possible to use this component in an application and instantiate such an application in the {{site}} block.\r\n\r\nThis should lead to compile errors, ideally both during environment compilation and node compilation. Of course, the same thing with {{produces}} annotations should also lead to an error.\r\n\r\nI'll attach a tar of my {{/etc/puppetlabs/code/environments/production}} dir with all the manifests I used","closed_at":"2020-03-31T20:56:43.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6087","labels":"","state":"Closed","updated_at":"2020-03-31T20:56:43.000-0700","timestamp":1652286345.0982,"priority":"Normal","status_category":"Done","pull_request":5289},{"issue_id":"313648","title":"Could not autoload puppet/provider/package/gem: superclass must be a Class (Module given)","url":"https://tickets.puppetlabs.com/browse/PUP-9794","created_at":"2019-06-21T12:52:43.000-0700","number":"PUP-9794","body":"*Puppet Version:* 6.5.0\r\n *Puppet Server Version:* 6.4.0\r\n *OS Name/Version:* Linux ip-10-0-42-40 4.4.0-1047-aws #56-Ubuntu SMP Sat Jan 6 19:39:06 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n{code}Error: Could not autoload puppet/provider/package/gem: superclass must be a Class (Module given)\r\nError: Facter: error while resolving custom facts in /opt/puppetlabs/puppet/cache/lib/facter/package_provider.rb: Could not autoload puppet/provider/package/gem: superclass must be a Class (Module given)\r\n{code}\r\n*Describe steps to reproduce…*\r\n\r\nLimited to AWS Kernel ...\r\n{code}uname -a\r\nLinux ip-10-0-42-40 4.4.0-1047-aws #56-Ubuntu SMP Sat Jan 6 19:39:06 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n{code}\r\nInstall Puppet 6 and puppetlabs-stdlib ...\r\n{code}sudo -i\r\nwget https://apt.puppetlabs.com/puppet6-release-xenial.deb\r\ndpkg -i puppet6-release-xenial.deb\r\napt update\r\napt install -y puppetserver\r\nsource /etc/profile.d/puppet-agent.sh\r\npuppet config set server $(hostname -f)\r\npuppetserver ca setup\r\nsystemctl start puppetserver\r\npuppet module install puppetlabs-stdlib\r\n{code}\r\nTrigger ...\r\n{code}puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nNotice: /File[/opt/puppetlabs/puppet/cache/lib/facter]/ensure: created\r\n...\r\nInfo: Retrieving locales\r\nInfo: Loading facts\r\nError: Could not autoload puppet/provider/package/gem: superclass must be a Class (Module given)\r\nError: Facter: error while resolving custom facts in /opt/puppetlabs/puppet/cache/lib/facter/package_provider.rb: Could not autoload puppet/provider/package/gem: superclass must be a Class (Module given)\r\nInfo: Caching catalog for ip-10-0-42-40.us-west-2.compute.internal\r\nInfo: Applying configuration version '1561145391'\r\nInfo: Creating state file /opt/puppetlabs/puppet/cache/state/state.yaml\r\nNotice: Applied catalog in 0.02 seconds\r\n{code}\r\nOr ...\r\n{code}facter -p os\r\n2019-06-21 19:36:32.606934 ERROR puppetlabs.facter - error while resolving custom facts in /opt/puppetlabs/puppet/cache/lib/facter/package_provider.rb: Could not autoload puppet/provider/package/gem: superclass must be a Class (Module given)\r\n{\r\n  architecture => \"amd64\",\r\n  distro => {\r\n    codename => \"xenial\",\r\n    description => \"Ubuntu 16.04.3 LTS\",\r\n    id => \"Ubuntu\",\r\n    release => {\r\n      full => \"16.04\",\r\n      major => \"16.04\"\r\n    }\r\n  },\r\n  family => \"Debian\",\r\n  hardware => \"x86_64\",\r\n  name => \"Ubuntu\",\r\n  release => {\r\n    full => \"16.04\",\r\n    major => \"16.04\"\r\n  },\r\n  selinux => {\r\n    enabled => false\r\n  }\r\n}\r\n{code}\r\nOr ...\r\n{code}/opt/puppetlabs/puppet/bin/ruby /opt/puppetlabs/puppet/cache/lib/facter/package_provider.rb\r\nTraceback (most recent call last):\r\n\t15: from /opt/puppetlabs/puppet/cache/lib/facter/package_provider.rb:11:in `<main>'\r\n\t14: from /opt/puppetlabs/puppet/lib/ruby/2.5.0/rubygems/core_ext/kernel_require.rb:59:in `require'\r\n\t13: from /opt/puppetlabs/puppet/lib/ruby/2.5.0/rubygems/core_ext/kernel_require.rb:59:in `require'\r\n\t12: from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/package.rb:9:in `<top (required)>'\r\n\t11: from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/package.rb:10:in `<module:Puppet>'\r\n\t10: from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/metatype/manager.rb:127:in `newtype'\r\n\t 9: from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:215:in `loadall'\r\n\t 8: from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:79:in `loadall'\r\n\t 7: from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:79:in `each'\r\n\t 6: from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:81:in `block in loadall'\r\n\t 5: from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:66:in `load_file'\r\n\t 4: from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:66:in `load'\r\n\t 3: from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/package/gem.rb:1:in `<top (required)>'\r\n\t 2: from /opt/puppetlabs/puppet/lib/ruby/2.5.0/rubygems/core_ext/kernel_require.rb:59:in `require'\r\n\t 1: from /opt/puppetlabs/puppet/lib/ruby/2.5.0/rubygems/core_ext/kernel_require.rb:59:in `require'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/package_targetable.rb:23:in `<top (required)>': Could not autoload puppet/provider/package/gem: superclass must be a Class (Module given) (Puppet::Error)\r\n{code}\r\nResolve ...\r\n{code}puppet module uninstall puppetlabs-stdlib\r\npuppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Caching catalog for ip-10-0-42-40.us-west-2.compute.internal\r\nInfo: Applying configuration version '1561145919'\r\nNotice: Applied catalog in 0.05 seconds\r\n{code}\r\nUnable to reproduce with Generic Kernel ...\r\n{code}uname -a\r\nLinux fy4y57a54szfeln 4.4.0-21-generic #37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\r\n{code}","closed_at":"2020-04-01T09:34:14.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9794","labels":"resolved-issue-added","state":"Closed","updated_at":"2020-04-01T09:34:14.000-0700","timestamp":1652286346.12068,"priority":"Normal","status_category":"Done","pull_request":7590},{"issue_id":"140429","title":"\"Unable to set ownership\" error with logdest on agents","url":"https://tickets.puppetlabs.com/browse/PUP-7331","created_at":"2016-07-07T09:43:23.000-0700","number":"PUP-7331","body":"Customer has noted that after installing a 2016.2 agent and setting up logdest via /etc/sysconfig/puppet:\r\n\r\n{code:java}\r\nPUPPET_EXTRA_OPTS=--logdest=/var/log/puppetlabs/puppet/puppet.log\r\n{code}\r\n\r\nThe log shows the error:\r\n\r\n{code:java}\r\n2016-07-07 07:51:55 -0700 Puppet (err): Unable to set ownership to puppet:puppet for log file: /var/log/puppetlabs/puppet/puppet.log\r\n{code}\r\n\r\nThis is caused by the fact that even though the new AIO agent no longer creates the puppet user and group, the log destination code still refers to them at https://github.com/puppetlabs/puppet/blob/master/lib/puppet/util/log/destinations.rb#L95-L102.  On a master, this code is fine, since the default puppet user \"pe-puppet\" is created, but on an agent they default to \"puppet\" which is not.  \r\n\r\nEither the AIO agent RPM needs to have the creation of the puppet user and group added back to the pre-install script as it was in Puppet 3.x, or logic needs to be added to the destinations.rb to not run on agents where the user does not exist to prevent the error.","closed_at":"2020-04-02T00:28:32.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7331","labels":"cspapercuts;resolved-issue-added;the-goods","state":"Closed","updated_at":"2020-04-02T00:28:32.000-0700","timestamp":1652286346.329131,"priority":"Normal","status_category":"Done","pull_request":7196},{"issue_id":"348571","title":"Change http client API to generic options hash","url":"https://tickets.puppetlabs.com/browse/PUP-10353","created_at":"2020-03-04T11:31:28.000-0800","number":"PUP-10353","body":"The HTTP client API needs to use a generic options hash instead of keyword arguments for two reasons:\r\n\r\n1. The API currently uses keyword arguments, but we need to add a puppetserver implementation. If we add a new argument to puppet's implementation, then it will break puppetserver, unless it collects \"extra\" options using {{**options}}. But then we'll end up with some arguments expressed as keyword arguments and some \"leftovers\".\r\n2. Callers of the API sometimes pass options that the client implementation doesn't know about, such as {{compress}}. The API needs a way to pass options which may only be understood by one implementation. Each implementation should parse and validate options it recognizes and pass through options it doesn't.","closed_at":"2020-04-06T06:37:02.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10353","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-06T06:37:02.000-0700","timestamp":1652286346.532555,"priority":"Normal","status_category":"Done","pull_request":8025},{"issue_id":"353752","title":"Upgraded to Puppetserver 6.9.2 from Puppet 6.5","url":"https://tickets.puppetlabs.com/browse/PUP-10405","created_at":"2020-04-01T14:35:41.000-0700","number":"PUP-10405","body":"Upgraded Puppet Server from 6.5.1 to 6.9.2\r\n\r\nWe are seeing a error when trying to query for environments. \"Error: undefined method `collect' for nil:NilClass\". API is reporting a 406 error.\r\n\r\nCheck the SSL and auth.conf.  \r\n\r\nDump for the puppet server logs:\r\n\r\n{noformat}\r\n2020-04-01T14:30:31.118-07:00 ERROR [qtp1259599435-40] [puppetserver] Puppet Server Error: undefined method `collect' for nil:NilClass\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:204:in `list'\r\norg/jruby/RubyArray.java:2579:in `collect'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:275:in `list'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:351:in `list'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/master/v3/environments.rb:11:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/api/master/v3/authorization.rb:14:in `block in wrap'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:82:in `block in process'\r\norg/jruby/RubyArray.java:1800:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:81:in `process'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:88:in `process'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/route.rb:88:in `process'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/handler.rb:87:in `block in process'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/handler.rb:70:in `block in with_request_profiling'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/handler.rb:66:in `with_request_profiling'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/handler.rb:86:in `block in process'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/handler.rb:93:in `respond_to_errors'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/http/handler.rb:85:in `process'\r\nuri:classloader:/puppetserver-lib/puppet/server/master.rb:64:in `block in handleRequest'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:62:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:290:in `override'\r\nuri:classloader:/puppetserver-lib/puppet/server/master.rb:63:in `handleRequest'\r\n{noformat}","closed_at":"2020-04-06T06:38:16.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10405","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-06T06:38:16.000-0700","timestamp":1652286346.839617,"priority":"Major","status_category":"Done","pull_request":8071},{"issue_id":"350907","title":"pkgng does not parse latest version properly","url":"https://tickets.puppetlabs.com/browse/PUP-10382","created_at":"2020-03-24T02:27:05.000-0700","number":"PUP-10382","body":"*Puppet Version: 5.5.18*\r\n *Puppet Server Version: 5.5.18*\r\n *OS Name/Version: FreeBSD 12*\r\n\r\nthe pkgng provider does not parse the output of pkg version -voRL= correctly.\r\nIf the package is no longer found in the repo, no latest version can be parsed out of it.\r\n\r\nFor example the output is:\r\nsysutils/splunk ? orphaned: sysutils/splunk\r\ndatabases/sqlite3 < needs updating (remote has 3.30.1)\r\n\r\n*Desired Behavior:*\r\n\r\nlatests version for splunk should be nil\r\nlatests version for sqlite3 should be 3.30.1\r\n\r\n*Actual Behavior:*\r\n\r\nlatests version for splunk is sysutils/splunk\r\nlatests version for sqlite3 is 3.30.1\r\n\r\n ","closed_at":"2020-04-06T06:38:25.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10382","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-06T06:38:25.000-0700","timestamp":1652286346.940335,"priority":"Normal","status_category":"Done","pull_request":8055},{"issue_id":"350775","title":"pkgng does not support install_options","url":"https://tickets.puppetlabs.com/browse/PUP-10380","created_at":"2020-03-23T08:02:58.000-0700","number":"PUP-10380","body":"*Puppet Version: 5.5.18*\r\n *Puppet Server Version: 5.5.18*\r\n *OS Name/Version: FreeBSD 12.1*\r\n\r\nThe pkgng provider does not support install_options\r\n\r\n*Desired Behavior:* \r\n\r\npackage { 'mypackage':\r\n    ensure => present,\r\n    source => '[https://my.downloadsite.com/mypackage-freebsd-11.1.txz'-amd64|https://my.downloadsite.com/mypackage-freebsd-11.1.txz'] ,\r\n    provider => 'pkgng',\r\n    install_options = '-f',\r\n}\r\n\r\n \r\n\r\nNotice: /Stage[main]/Mymodule::Install/Package[mypackage]/ensure: created\r\n\r\n*Actual Behavior:*\r\n\r\nError: Could not update: Execution of '/usr/local/sbin/pkg add -q [https://my.downloadsite.com/mypackage-freebsd-11.1-amd64.txz'|https://my.downloadsite.com/mypackage-freebsd-11.1.txz'] returned 70: pkg: wrong architecture: FreeBSD:11:amd64 instead of FreeBSD:12:amd64\r\n\r\n ","closed_at":"2020-04-06T06:38:39.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10380","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-06T06:38:39.000-0700","timestamp":1652286347.041738,"priority":"Normal","status_category":"Done","pull_request":8053},{"issue_id":"350515","title":"puppet plugin download doesn't download from locales mount","url":"https://tickets.puppetlabs.com/browse/PUP-10374","created_at":"2020-03-18T15:09:52.000-0700","number":"PUP-10374","body":"Running {{puppet plugin download}} doesn't download from the locales mount, though {{puppet agent}} does. We should be consistent. This issue was introduced when switching to the http client, because we're checking for the {{locales}} capability for only the {{:puppet}} service, but in the case of {{puppet plugin download}} we only connect to the {{:fileserver}} service.","closed_at":"2020-04-06T06:38:50.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10374","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-06T06:38:50.000-0700","timestamp":1652286347.143048,"priority":"Minor","status_category":"Done","pull_request":8046},{"issue_id":"321972","title":"Can't disable Puppet::SSL::Host deprecation warning when using puppetdb terminus","url":"https://tickets.puppetlabs.com/browse/PUP-10355","created_at":"2019-08-22T11:03:26.000-0700","number":"PUP-10355","body":"PuppetDB module uses deprecated in puppet 6.8.0 function, causing a warning:\r\n\r\n{noformat}\r\nWarning: Puppet::SSL::Host is deprecated and will be removed in a future release of Puppet.\r\n\r\n   (location: /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/ssl/host.rb:235:in `initialize')\r\n{noformat}","closed_at":"2020-04-06T06:39:49.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10355","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-06T06:39:49.000-0700","timestamp":1652286347.246524,"priority":"Normal","status_category":"Done","pull_request":8032},{"issue_id":"347916","title":"puppet_gem package provider ensure => absent breaks subsequent File resources","url":"https://tickets.puppetlabs.com/browse/PUP-10319","created_at":"2020-02-28T03:35:31.000-0800","number":"PUP-10319","body":"*Puppet Version: 6.13.0*\r\n *Puppet Server Version: 6.8.0*\r\n *OS Name/Version: RHEL 7*\r\n\r\nGems can be installed into the puppet agent's ruby environment for use in providers etc.\r\n When they're no longer required, it should be possible to remove them.\r\n eg.\r\n{noformat}package { 'redis_gem':\r\n  ensure => absent,\r\n  name   => 'redis',\r\n  provider => 'puppet_gem',\r\n}\r\n{noformat}\r\nWhilst the puppet_gem provider does successfully uninstall the gem, subsequent File/Concat resources fail. (I imagine other stuff might fail too, but this was the first thing I hit)\r\n{noformat}Info: Applying configuration version 'puppet6server1-redis_gem_test-79e063b8d35'\r\nNotice: /Stage[main]/Profile::Redis_keepalived/Package[redis gem]/ensure: removed (corrective)\r\nNotice: /Stage[main]/Keepalived::Config/Concat[/etc/keepalived/keepalived.conf]/File[/etc/keepalived/keepalived.conf]/content: \r\n--- /etc/keepalived/keepalived.conf\t2020-02-28 11:27:08.821195162 +0000\r\n+++ /tmp/puppet-file20200228-21277-1uxs10h\t2020-02-28 11:28:30.905963796 +0000\r\n@@ -1,4 +1,4 @@\r\n-## Managed by Puppet\r\n+# Managed by Puppet\r\n vrrp_script check_redis {\r\n   script    \"/usr/libexec/keepalived/check_redis.sh\"\r\n   interval  2\r\n\r\nInfo: Computing checksum on file /etc/keepalived/keepalived.conf\r\nError: Could not back up /etc/keepalived/keepalived.conf: pid: 21277 nil spec! included in [#<Gem::StubSpecifi...\r\n--- SNIP --- (The array printed is ~150KB long, so I've not included it here and continue with the stack trace)\r\n/opt/puppetlabs/puppet/lib/ruby/2.5.0/rubygems/specification.rb:743:in `_all'\r\n/opt/puppetlabs/puppet/lib/ruby/2.5.0/rubygems/specification.rb:1153:in `latest_specs'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/rubygems.rb:44:in `directories'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:142:in `gem_directories'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:172:in `search_directories'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:98:in `get_file'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:62:in `load_file'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:201:in `load'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/instance_loader.rb:51:in `loaded_instance'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/terminus.rb:112:in `terminus_class'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:366:in `make_terminus'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:140:in `terminus'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/file_bucket_file/selector.rb:16:in `get_terminus'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/file_bucket_file/selector.rb:20:in `head'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:260:in `head'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/file_bucket/dipper.rb:48:in `backup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/backups.rb:82:in `backup_file_with_filebucket'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/backups.rb:28:in `perform_backup_with_bucket'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/backups.rb:15:in `perform_backup'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/file.rb:1024:in `backup_existing'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/file.rb:761:in `remove_existing'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/file.rb:888:in `write'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/file/data_sync.rb:93:in `contents_sync'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/file/content.rb:136:in `sync'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:241:in `sync'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:136:in `sync_if_needed'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:90:in `block in perform_changes'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:89:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:89:in `perform_changes'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:21:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:267:in `apply'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:287:in `eval_resource'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:191:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:191:in `block (2 levels) in evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:521:in `block in thinmark'\r\n/opt/puppetlabs/puppet/lib/ruby/2.5.0/benchmark.rb:308:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:520:in `thinmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:191:in `block in evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:122:in `traverse'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:178:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:240:in `block (2 levels) in apply'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:521:in `block in thinmark'\r\n/opt/puppetlabs/puppet/lib/ruby/2.5.0/benchmark.rb:308:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:520:in `thinmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:239:in `block in apply'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:161:in `with_destination'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/report.rb:146:in `as_logging_destination'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:238:in `apply'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:187:in `block (2 levels) in apply_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:521:in `block in thinmark'\r\n/opt/puppetlabs/puppet/lib/ruby/2.5.0/benchmark.rb:308:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:520:in `thinmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:186:in `block in apply_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:233:in `block in benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/2.5.0/benchmark.rb:308:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:232:in `benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:185:in `apply_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:394:in `run_internal'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:235:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:62:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:289:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:212:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:59:in `block (5 levels) in run'\r\n/opt/puppetlabs/puppet/lib/ruby/2.5.0/timeout.rb:93:in `block in timeout'\r\n/opt/puppetlabs/puppet/lib/ruby/2.5.0/timeout.rb:103:in `timeout'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:58:in `block (4 levels) in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent/locker.rb:21:in `lock'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:52:in `block (3 levels) in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:130:in `with_client'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:49:in `block (2 levels) in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:87:in `run_in_fork'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:48:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:179:in `controlled_run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:46:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:410:in `onetime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:370:in `block in run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:62:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:289:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:368:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:382:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:710:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:382:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:143:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:77:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\n{noformat}","closed_at":"2020-04-06T06:40:01.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10319","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-06T06:40:01.000-0700","timestamp":1652286347.348521,"priority":"Normal","status_category":"Done","pull_request":8009},{"issue_id":"337164","title":"Pacman provider shouldn't be doing partial upgrades","url":"https://tickets.puppetlabs.com/browse/PUP-10152","created_at":"2019-11-29T15:54:13.000-0800","number":"PUP-10152","body":"*Puppet Version: 6.10.1*\r\n *Puppet Server Version:*\r\n *OS Name/Version: Arch Linux*\r\n\r\nEvery time the pacman provider is used to install a package, it includes the y flag to refresh the package list, eg:\r\n\r\n{{==> default: Debug: Executing: '/usr/bin/pacman --noconfirm --needed --noprogressbar -Sy virtualbox-guest-utils'}}\r\n\r\nFrom the Arch Linux wiki, this is a \"partial upgrade\" which they say shouldn't be done:\r\n\r\n[https://wiki.archlinux.org/index.php/System_maintenance#Partial_upgrades_are_unsupported]\r\n\r\n*Desired Behavior:*\r\n\r\nEither:\r\n # Don't refresh the package list (remove the y flag), in which case new packages will be installed matching the same point in time version as the rest of the system\r\n # Add the u flag so the package list is updated and all existing packages are upgraded to the current point in time versions\r\n\r\nOption 2 probably isn't desired( ? ). Asking Puppet to install a new package shouldn't result in the rest of the system being upgraded( ? )\r\n\r\n*Actual Behavior:*\r\n\r\nRunning on Arch Linux (with pacman as the default provider), this resource:\r\n\r\n{package \\{ 'virtualbox-guest-utils': ensure => 'present' }}\r\n\r\nshould produce something more like this in the log:\r\n\r\n {{==> default: Debug: Executing: '/usr/bin/pacman --noconfirm --needed --noprogressbar -S virtualbox-guest-utils'}}","closed_at":"2020-04-06T06:40:21.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10152","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-06T06:40:21.000-0700","timestamp":1652286347.449913,"priority":"Minor","status_category":"Done","pull_request":8064},{"issue_id":"229892","title":"Puppet apply doesn't stream file content","url":"https://tickets.puppetlabs.com/browse/PUP-8338","created_at":"2018-01-09T16:11:51.000-0800","number":"PUP-8338","body":"*Puppet Version:* Puppet 4 (at least) and up\r\n*Puppet Server Version:* n/a\r\n*OS Name/Version:* all\r\n\r\nWhen running {{puppet apply}} with a file resource and source parameter, then puppet will load the entire file into memory, instead of streaming it.\r\n\r\nThis was noticed while researching why the bug described in PUP-7482 only affected {{puppet agent}} but not {{puppet apply}}.\r\n\r\n*Desired Behavior:*\r\n\r\nWhen managing files with a {{source}} parameter, puppet apply should always stream file content from all of the following sources\r\n\r\n{{<absolute path>}} local file\r\n{{file://<URI-encoded path>}} local file\r\n{{puppet:///modules/mymodule}} local file\r\n{{http?://host:port/path/to/file}} remote file\r\n\r\n*Actual Behavior:*\r\n\r\n{{puppet apply}} does not stream file content from http-based sources. See https://github.com/puppetlabs/puppet/blob/5.3.3/lib/puppet/type/file/source.rb#L274-L276.\r\n\r\nAt first glance it appears the {{Puppet::Type::File::ParameterSource#content}} method can be deleted entirely, and should always rely on {{chunk_file_from_disk}} or {{chunk_file_from_source}}.","closed_at":"2020-04-07T11:36:44.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8338","labels":"","state":"Resolved","updated_at":"2020-04-07T11:36:44.000-0700","timestamp":1652286347.755793,"priority":"Normal","status_category":"Done","pull_request":7977},{"issue_id":"349424","title":"Puppet apply recursive copy of directory fails in file resource","url":"https://tickets.puppetlabs.com/browse/PUP-10367","created_at":"2020-03-12T02:16:52.000-0700","number":"PUP-10367","body":"*Puppet Version: 6.14.0*\r\n *Puppet Server Version: NA*\r\n *OS Name/Version: Centos 7*\r\n\r\nIn Puppet 6.14 copying a puppet served directory fails. Here is an example\r\n\r\n file { '/a':\r\n {{  ensure  => 'directory',}}\r\n {{  source  => \"puppet:///modules/test\",}}\r\n {{  recurse => true,}}\r\n {{  purge   => true,}}\r\n }\r\n\r\nNow fails with this error\r\n\r\n{{[root@rcudb vagrant]# puppet apply test_case.pp}}\r\n {{Notice: Compiled catalog for rcudb.example.com in environment production in 0.05 seconds}}\r\n {{Notice: /Stage[main]/Main/File[/a]/ensure: created}}\r\n {{{color:#de350b}Error: Could not set 'file' on ensure: Is a directory @ io_fread - /etc/puppetlabs/code/environments/production/modules/test/files{color}}}\r\n {{{color:#de350b}Error: Could not set 'file' on ensure: Is a directory @ io_fread - /etc/puppetlabs/code/environments/production/modules/test/files{color}}}\r\n {{{color:#de350b}Wrapped exception:{color}}}\r\n {{{color:#de350b}Is a directory @ io_fread - /etc/puppetlabs/code/environments/production/modules/test/files{color}}}\r\n {{{color:#de350b}Error: /Stage[main]/Main/File[/a/a.a]/ensure: change from 'absent' to 'file' failed: Could not set 'file' on ensure: Is a directory @ io_fread -{color} /etc/puppetlabs/code/environments/production/modules/test/files}}\r\n {{Notice: Applied catalog in 0.42 seconds}}\r\n\r\n \r\n\r\n*Desired Behavior:*\r\n\r\nWith puppet version puppet-agent.x86_64 0:6.13.0-1.el7 This works as expected:\r\n\r\n{{root@rcudb vagrant]# puppet apply test_case.pp}}\r\n {{Notice: Compiled catalog for rcudb.example.com in environment production in 0.06 seconds}}\r\n {{Notice: /Stage[main]/Main/File[/a]/seltype: seltype changed 'etc_runtime_t' to 'default_t'}}\r\n {{Notice: /Stage[main]/Main/File[/a/a.a]/ensure: defined content as '\\{md5}d41d8cd98f00b204e9800998ecf8427e'}}\r\n {{Notice: Applied catalog in 0.47 seconds}}\r\n\r\n \r\n\r\n ","closed_at":"2020-04-07T11:36:44.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10367","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-07T11:36:44.000-0700","timestamp":1652286347.859984,"priority":"Critical","status_category":"Done","pull_request":8037},{"issue_id":"349360","title":"puppet agent unable to fetch file from https source - Error: certificate verify failed","url":"https://tickets.puppetlabs.com/browse/PUP-10365","created_at":"2020-03-11T11:12:56.000-0700","number":"PUP-10365","body":"*Puppet Version: 6.14.0*\r\n *Puppet Server Version:  6.9.1*\r\n *OS Name/Version: CentOS Linux release 7.7.1908 (Core) and CentOS Linux release 8.1.1911 (Core)*\r\n\r\nFile resource with an source https source cannot be created and produces the following error:\r\n\r\n \r\n{code:java}Error: certificate verify failed [unable to get local issuer certificate for CN=DigiCert SHA2 High Assurance Server CA,OU=www.digicert.com,O=DigiCert Inc,C=US] Error: /Stage[main]/Main/File[tree.js]/ensure: change from 'absent' to 'file' failed: certificate verify failed [unable to get local issuer certificate for CN=DigiCert SHA2 High Assurance Server CA,OU=www.digicert.com,O=DigiCert Inc,C=US]\r\n{code}\r\n \r\n\r\nCommand to reproduce:\r\n\r\n \r\n{code:java}puppet apply -e \"file { 'puppet6.repo.rpm': ensure => 'present', source => 'https://yum.puppet.com/puppet6-release-el-8.noarch.rpm', path => '/tmp/puppet6.repo.rpm' }\"\r\n{code}\r\n \r\n\r\nI am suspecting this is related to PUP-10260 - Modifies puppet to use the new http client for all REST requests. It seems like the new agent's http client only has access to the puppetmaster CA, hence getting SSL certificate issues when source is not on the puppetmaster.\r\n\r\nRelated ticket: PUP-7814 https://tickets.puppetlabs.com/browse/PUP-7814, where it is explained why https source for file would failed, but is missing why it worked in 6.13.0 but it no longers works in 6.14.0.\r\n\r\n*Desired Behavior:*\r\n\r\nFile is downloaded without SSL error and created in path.\r\n\r\n*Actual Behavior:*\r\n\r\nPuppet agent produces the following error:\r\n{code:java}Error: certificate verify failed [unable to get local issuer certificate for CN=DigiCert SHA2 High Assurance Server CA,OU=www.digicert.com,O=DigiCert Inc,C=US]\r\nError: /Stage[main]/Main/File[tree.js]/ensure: change from 'absent' to 'file' failed: certificate verify failed [unable to get local issuer certificate for CN=DigiCert SHA2 High Assurance Server CA,OU=www.digicert.com,O=DigiCert Inc,C=US]{code}\r\n ","closed_at":"2020-04-16T11:49:54.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10365","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-16T11:49:54.000-0700","timestamp":1652286348.572,"priority":"Normal","status_category":"Done","pull_request":8036},{"issue_id":"238912","title":"Puppet lookup always includes classes from the ENC","url":"https://tickets.puppetlabs.com/browse/PUP-8502","created_at":"2018-02-28T12:38:31.000-0800","number":"PUP-8502","body":"The puppet lookup command evaluates classes that are returned from the ENC when the {{--compile}} flag is not specified. This results in failures of the lookup command if the catalog cannot be compiled. \r\n\r\n \r\n\r\n*Reproduction Steps* \r\n # Install PE or Puppetserver\r\n # Create a class like the one below.\r\n # Classify a node with the class in the classifier\r\n # Run {{puppet lookup anyhierakey --node <nodename>}}\r\n\r\nA simple class to cause a failure in the lookup is below. \r\n\r\n \r\n{code}class test (\r\n  String $myparam,\r\n) {\r\n  file {$myparam:\r\n    ensure => absent,\r\n  }\r\n}\r\n{code}\r\n*Logs*\r\n\r\nUsing the steps above, we see this output from a lookup.\r\n{code}# puppet lookup anything --node pe-201735-agent.puppetdebug.vlan --debug \r\n...\r\nDebug: importing '/etc/puppetlabs/code/environments/production/modules/test/manifests/init.pp' in environment production\r\nDebug: Automatically imported test from test into production\r\n...\r\nError: Could not run: Evaluation Error: Error while evaluating a Resource Statement, Class[Test]: expects a value for parameter 'myparam'\r\n{code}\r\n*Workaround*\r\n\r\nAdd the {{--node_terminus plain}} to the command.\r\n{code}# puppet lookup anything --node pe-201735-agent.puppetdebug.vlan --node_terminus plain\r\n--- \"test\"\r\n{code}","closed_at":"2020-04-22T17:26:54.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8502","labels":"","state":"Closed","updated_at":"2020-04-22T17:26:54.000-0700","timestamp":1652286348.877137,"priority":"Normal","status_category":"Done","pull_request":6711},{"issue_id":"190026","title":"puppet lookup --facts <json file> can't modify $facts hash","url":"https://tickets.puppetlabs.com/browse/PUP-7507","created_at":"2017-05-09T17:48:10.000-0700","number":"PUP-7507","body":"I was trying to simulate a change to my {{$facts['networking']}} fact, so I ran {{facter --json > ~/Desktop/facts.json}}, edited the appropriate spot, and tried to pass that to {{puppet lookup --facts}}. No dice: my change was ignored. \r\n\r\nThat's because I was using {{facts.networking}} in my hierarchy, and apparently --facts doesn't actually set the $facts variable — it just sets top-scope variables with names from the JSON. \r\n\r\n* Problem one: That's unexpected, and it interferes with using {{facter --json}} as a basis for simulating other nodes. \r\n\r\nSo, I tried wrapping the facts json in another object with only a {{\"facts\":}} key. Which resulted in the following error: \"Error: Could not run: Attempt to assign to a reserved variable name: 'facts'\"\r\n\r\n* Problem two: If your hierarchy uses the $facts variable like we recommend (instead of ::factname vars), it's impossible to simulate any changes with the puppet lookup CLI. I expect this blocks setting other values for $trusted or $server_facts, as well. \r\n\r\nThe first problem goes into the bucket of things we need to discuss around puppet lookup's UX. The second problem seems like a straight-up defect. ","closed_at":"2020-04-22T17:50:36.000-0700","comments":25,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7507","labels":"hiera","state":"Closed","updated_at":"2020-04-22T17:50:36.000-0700","timestamp":1652286348.985833,"priority":"Normal","status_category":"Done","pull_request":6369},{"issue_id":"356444","title":"Persistent http connection timeouts can't be changed when using the new http client","url":"https://tickets.puppetlabs.com/browse/PUP-10434","created_at":"2020-04-22T15:43:43.000-0700","number":"PUP-10434","body":"The http client hardcodes the timeout for the http connection pool to 15 seconds. As a result, persistent connections can't be tuned or disabled. This issue existed when the client was created, but only noticed when most of puppet was switched over to use the client for network connections. To reproduce:\r\n\r\n{noformat}\r\n$ puppet agent -td --http_keepalive_timeout 0 | grep 'Using cached connection'\r\nDebug: Using cached connection for https://bleak-scorecard.delivery.puppetlabs.net:8140\r\nDebug: Using cached connection for https://bleak-scorecard.delivery.puppetlabs.net:8140\r\nDebug: Using cached connection for https://bleak-scorecard.delivery.puppetlabs.net:8140\r\nDebug: Using cached connection for https://bleak-scorecard.delivery.puppetlabs.net:8140\r\nDebug: Using cached connection for https://bleak-scorecard.delivery.puppetlabs.net:8140\r\n{noformat}","closed_at":"2020-04-27T03:39:29.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10434","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-27T03:39:29.000-0700","timestamp":1652286349.502263,"priority":"Normal","status_category":"Done","pull_request":8111},{"issue_id":"354993","title":"Unify service return values","url":"https://tickets.puppetlabs.com/browse/PUP-10418","created_at":"2020-04-09T09:12:04.000-0700","number":"PUP-10418","body":"The {{get|post|put|*}} REST API methods aren't consistent about return values. For example {{put}} can return a boolean, the stringified response body or the response object. It would be good to make those consistent. Also it would be good to always return the response so that the caller can elect to resubmit the request with different parameters if needed. If the method also returns an entity, then have the method return an array containing {{[response, entity]}}.","closed_at":"2020-04-27T03:44:11.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10418","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-27T03:44:11.000-0700","timestamp":1652286349.60406,"priority":"Normal","status_category":"Done","pull_request":8096},{"issue_id":"354829","title":"Comparing rpm package versions without epoch fails","url":"https://tickets.puppetlabs.com/browse/PUP-10416","created_at":"2020-04-08T09:04:39.000-0700","number":"PUP-10416","body":"*Desired Behavior:*\r\n To succesfully do the version comparison:\r\n{panel}\r\n3:1.0 > 1.2\r\n{panel}\r\n \r\n\r\n \r\n\r\n*Actual Behavior:*\r\n Is not able to compare epoch *3* against missing epoch.\r\n\r\n \r\n\r\n*Proposed solution:*\r\n\r\nCurrently, missing epoch is considered to be nil in the code. This should be instead treated as 0 when comparing versions. This case occurs when a package with a version containing epoch was already installed.\r\n\r\n \r\n\r\nRegarding this topic, version received in the :ensure field of the manifest should be stripped of epoch when installing packages (as yum at least seems to use epoch just for sorting the versions but will not find specific version when epoch is mentioned).\r\n\r\n ","closed_at":"2020-04-27T03:44:31.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10416","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-27T03:44:31.000-0700","timestamp":1652286359.353713,"priority":"Normal","status_category":"Done","pull_request":8102},{"issue_id":"354468","title":"Windows service calls deprecated `puppet agent --configprint`","url":"https://tickets.puppetlabs.com/browse/PUP-10414","created_at":"2020-04-06T14:32:08.000-0700","number":"PUP-10414","body":"If you set the log_level to debug and restart the Windows agent running as a service, \r\n\r\n{noformat}\r\nC:\\> puppet config set log_level debug --section main\r\nC:\\> puppet config set logdest C:\\Users\\Administrator --section main\r\n{noformat}\r\n\r\nThen the Windows agent will log a deprecation warning each time it runs due to calling `puppet agent --configprint runinterval`. It should instead call `puppet config print runinterval --section agent`.\r\n\r\n{noformat}\r\n2020-04-06 21:27:15 +0000 Puppet (warning): Using --configprint is deprecated. Use 'puppet config <subcommand>' instead.\r\n   (location: C:/Program Files/Puppet Labs/Puppet/sys/ruby/lib/ruby/vendor_ruby/puppet/settings.rb:498:in `print_config_options')\r\n{noformat}","closed_at":"2020-04-27T03:45:24.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10414","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-27T03:45:24.000-0700","timestamp":1652286359.454254,"priority":"Normal","status_category":"Done","pull_request":8093},{"issue_id":"354076","title":"Puppet .dmg packages fail on macOS 10.15","url":"https://tickets.puppetlabs.com/browse/PUP-10408","created_at":"2020-04-02T16:38:29.000-0700","number":"PUP-10408","body":"*Puppet Version: 5.5.19, 6.14.0*\r\n *Puppet Server Version: 5.3.12*\r\n *OS Name/Version: macOS 10.15.4*\r\n\r\nThe pkgdmg provider uses the \"-noidme\" flag when mounting .dmg files with hdiutil. Per the man page for hdiutil in macOS 10.15, the IDME flags have been removed.\r\n\r\n\"Removed the deprecated \"hdiutil internet-enable\" command and the IDME attach flags.\"\r\n\r\nThe use of the \"-noidme\" flag with hdiutil on any version of macOS 10.15 causes hdiutil to output a deprecation warning, which then causes the pkgdmg provider to fail to parse the plist xml generated by hdiutil, causing .dmg packages to fail in puppet.\r\n\r\nRemoving the \"-noidme\" flag from pkgdmg.rb seems to correct the issue. \r\n\r\n*Desired Behavior:*\r\n\r\n.dmg packages get installed correctly by puppet.\r\n\r\n*Actual Behavior:*\r\n\r\n \r\n\r\nPuppet fails to install .dmg packages with the following error:\r\n{code:java}\r\nFatal error: Start tag expected, '<' not found at :1.\r\nError: Could not set 'present' on ensure: undefined method `has_key?' for nil:NilClass (file: /etc/puppetlabs/code/modules/darwin/manifests/init.pp, line: 212)\r\nError: Could not set 'present' on ensure: undefined method `has_key?' for nil:NilClass (file: /etc/puppetlabs/code/modules/darwin/manifests/init.pp, line: 212)\r\nWrapped exception:\r\nundefined method `has_key?' for nil:NilClass{code}\r\nUpon inspection with the debug output, the error above occurs when puppet attempts to mount a .dmg with hdiutil using the following command:\r\n{code:java}\r\nhdiutil mount -plist -nobrowse -readonly -noidme -mountrandom /tmp package.dmg{code}\r\nWhich generates the following output:\r\n{code:java}\r\nhdiutil: attach: WARNING: ignoring IDME options (obsolete)\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\r\n<plist version=\"1.0\">\r\n<dict>\r\n <key>system-entities</key>\r\n <array>\r\n <dict>\r\n <key>content-hint</key>\r\n <string>Apple_partition_scheme</string>\r\n <key>dev-entry</key>\r\n <string>/dev/disk10</string>\r\n <key>potentially-mountable</key>\r\n <false/>\r\n <key>unmapped-content-hint</key>\r\n <string>Apple_partition_scheme</string>\r\n </dict>\r\n <dict>\r\n <key>content-hint</key>\r\n <string>Apple_partition_map</string>\r\n <key>dev-entry</key>\r\n <string>/dev/disk10s1</string>\r\n <key>potentially-mountable</key>\r\n <false/>\r\n <key>unmapped-content-hint</key>\r\n <string>Apple_partition_map</string>\r\n </dict>\r\n <dict>\r\n <key>content-hint</key>\r\n <string>Apple_HFS</string>\r\n <key>dev-entry</key>\r\n <string>/dev/disk10s2</string>\r\n <key>mount-point</key>\r\n <string>/private/tmp/dmg.YdyjLr</string>\r\n <key>potentially-mountable</key>\r\n <true/>\r\n <key>unmapped-content-hint</key>\r\n <string>Apple_HFS</string>\r\n <key>volume-kind</key>\r\n <string>hfs</string>\r\n </dict>\r\n </array>\r\n</dict>\r\n</plist>{code}\r\nThe first line in the output is not xml, which causes the pkgdmg provider to fail when attempting to parse the generated plist xml.","closed_at":"2020-04-27T03:46:53.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10408","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-27T03:46:53.000-0700","timestamp":1652286359.557124,"priority":"Major","status_category":"Done","pull_request":8081},{"issue_id":"351396","title":"Use '**' to pass keyword arguments in Ruby 2.7","url":"https://tickets.puppetlabs.com/browse/PUP-10393","created_at":"2020-03-27T05:16:34.000-0700","number":"PUP-10393","body":"*Puppet Version: 5.5.10 (but it is not fixed in master branch also)*\r\n *Puppet Server Version:*\r\n *OS Name/Version:*\r\n\r\nUbuntu Focal. puppet 5.5.10, ruby2.7.\r\n\r\n*Desired Behavior:*\r\n\r\nNo warning pops up when puppet is executed with Ruby 2.7.\r\n\r\n*Actual Behavior:*\r\n\r\n \r\n\r\nA warning is emitted here: https://github.com/puppetlabs/puppet/blob/master/lib/puppet/file_system/file_impl.rb#L83\r\n\r\nThe '**' operator should be used to pass keyword arguments from now on.","closed_at":"2020-04-27T03:50:29.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10393","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-27T03:50:29.000-0700","timestamp":1652286359.856915,"priority":"Normal","status_category":"Done","pull_request":8060},{"issue_id":"350600","title":"Custom file ownership for lastrunreport as defined in puppet.conf is ignored","url":"https://tickets.puppetlabs.com/browse/PUP-10376","created_at":"2020-03-19T08:29:13.000-0700","number":"PUP-10376","body":"*Puppet Version: 6.14.0*\r\n *Puppet Server Version: 6.9.1*\r\n *OS Name/Version: Ubuntu 18.04.4 LTS (Bionic Beaver)*\r\n\r\nSomewhat similarly to PUP-10325, the custom ownership settings for the `lastrunreport` file in `puppet.conf` also doesn't seem to be preserved once the agent run is finished. Interestingly enough, _during_ the run it seems to be correctly set.\r\n\r\n*Desired Behavior:*\r\n\r\n**After the run is finished, the `lastrunreport` file should have the ownership and permissions set as specified in `puppet.conf`.\r\n\r\n*Actual Behavior:*\r\n\r\n \r\n\r\nDuring the run the ownership/permissions seems to be correctly set, but once finished, the ownership of the `lastrunreport` file is set to `root:root` and permissions to `0660`.","closed_at":"2020-04-27T03:54:39.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10376","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-27T03:54:39.000-0700","timestamp":1652286360.265294,"priority":"Normal","status_category":"Done","pull_request":8076},{"issue_id":"350599","title":"Latest version ensured for python packages is incorrect","url":"https://tickets.puppetlabs.com/browse/PUP-10375","created_at":"2020-03-19T08:27:40.000-0700","number":"PUP-10375","body":"In [lib/puppet/provider/package/pip.rb|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/package/pip.rb] pip version checks and python packages sortings/comparisons are prone to be often done incorrectly. One example would be for the 'numpy' package. Below can be seen some of this package's versions being sorted incorrectly:\r\n||{color:#00875a}Correctly sorted{color}||{color:#de350b}Currently sorted{color}||\r\n|1.10.4|1.10.4|\r\n|1.11.0b3|{color:#de350b}1.11.0{color}|\r\n|1.11.0rc1|{color:#de350b}1.11.0b3{color}|\r\n|1.11.0rc2|{color:#de350b}1.11.0rc1{color}|\r\n|1.11.0|{color:#de350b}1.11.0rc2{color}|\r\n|1.11.1rc1|{color:#de350b}1.11.1{color}|\r\n|1.11.1|{color:#de350b}1.11.1rc1{color}|\r\n|1.11.2rc1|{color:#de350b}1.11.2{color}|\r\n|1.11.2|{color:#de350b}1.11.2rc1{color}|\r\n\r\n \r\n\r\nThis impacts package installation, using pip, when trying to ensure the latest version for any python package. \r\n\r\n \r\n\r\n*{{Proposed solution:}}*\r\n\r\nAll pip version checks and python packages comparison/sortings should be done using {color:#57d9a3}Puppet::Util::Package::Version::Pip.compare{color} instead of {color:#de350b}Puppet::Util::Package.versioncmp{color}.\r\n\r\nThis solution's implementation impact needs to be addressed as following:\r\n * in case of invalid/unsupported versions, it shouldn't raise anything which might disrupt the rest of a manifest application/agent run\r\n * would be a good idea to investigate pip's legacy versions (see [pip's source code|https://github.com/pypa/pip/blob/master/src/pip/_vendor/packaging/version.py], check if this is still being used by packages/if such packages still exist and then, based on findings, maybe reconsider supporting them {color:#ff8b00}*OR*{color} find a suitable solution for when puppet will come across one of them)\r\n * some refactoring needs to be done for partially duplicated code: get all available versions for a package in only one method (at least per pip version particularities) by sorting the list of available versions and use it to find out the latest version and also use it when checking for a version range)\r\n\r\n \r\n\r\n ","closed_at":"2020-04-27T03:55:55.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10375","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-27T03:55:55.000-0700","timestamp":1652286360.371892,"priority":"Normal","status_category":"Done","pull_request":8091},{"issue_id":"349097","title":"Convert some beaker tests to rspec integration","url":"https://tickets.puppetlabs.com/browse/PUP-10362","created_at":"2020-03-09T10:54:31.000-0700","number":"PUP-10362","body":"The switch to using the http client for all indirector requests introduced regressions that weren't caught in nightly CI or when running {{jenkins please test this with servertests}}. Fortunately this was caught downstream before we released in PUP-10359, but it would be good to faster feedback.\r\n\r\nThe issues weren't tested during PR testing, because {{with servertests}} only runs tests tagged with {{risk:high}} or {{audit:high}}, and several tests that would have caught the issue are tagged as {{*:medium}}, such as:\r\n\r\n{noformat}\r\nacceptance/tests/direct_puppet/static_catalog_env_control.rb\r\nacceptance/tests/direct_puppet/cached_catalog_remediate_local_drift.rb\r\nacceptance/tests/language/sensitive_data_type.rb\r\nacceptance/tests/reports/failover_master.rb\r\n{noformat}","closed_at":"2020-04-27T04:00:03.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10362","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-27T04:00:03.000-0700","timestamp":1652286360.473391,"priority":"Normal","status_category":"Done","pull_request":8034},{"issue_id":"348140","title":"Custom file mode for lastrunreport as defined in puppet.conf is ignored","url":"https://tickets.puppetlabs.com/browse/PUP-10325","created_at":"2020-03-02T16:24:34.000-0800","number":"PUP-10325","body":"*Puppet Version: 6.13.0*\r\n *Puppet Server Version: 6.7.1*\r\n *OS Name/Version: CentOS Linux release 7.7.1908 (Core)*\r\n\r\n \r\n\r\nWe just attempted to upgrade puppet agent from 6.8.1 to 6.13.0 and found that after the upgrade the file permissions on the \"lastrunreport\" file were reset and not honored to what was defined in our puppet.conf:\r\n\r\nExample:\r\n{code:java}\r\n[agent]\r\n  lastrunreport = /var/tmp/puppet/last_run_report.yaml { mode = 0664 }\r\n  lastrunfile = /var/tmp/puppet/last_run_summary.yaml { mode = 0664 }{code}\r\n \r\n\r\n*Desired Behavior:*\r\n\r\nPermissions should match what's defined in puppet.conf:\r\n\r\n \r\n{code:java}\r\n$ ls -lah\r\ntotal 856K\r\ndrwxr-xr-x. 2 root root 61 Feb 28 21:20 .\r\ndrwxrwxrwt. 6 root root 4.0K Feb 28 14:32 ..\r\n-rw-rw-r--. 1 root root 848K Feb 28 21:20 last_run_report.yaml\r\n-rw-rw-r--. 1 root root 1.7K Feb 28 21:20 last_run_summary.yaml\r\n$\r\n{code}\r\nBoth files have a mode of 664\r\n\r\n \r\n\r\n \r\n\r\n*Actual Behavior:*\r\n\r\nIn reality, after the upgrade the file permissions will be correct if the puppet service is restarted... But after a manual, or scheduled run (by the service daemon) the file permissions will be incorrect:\r\n{code:java}\r\n$ ls -lah\r\ntotal 856K\r\ndrwxr-xr-x. 2 root root   61 Feb 28 21:20 .\r\ndrwxrwxrwt. 6 root root 4.0K Feb 28 14:32 ..\r\n-rw-rw----. 1 root root 848K Feb 28 21:20 last_run_report.yaml\r\n-rw-rw-r--. 1 root root 1.7K Feb 28 21:20 last_run_summary.yaml\r\n$\r\n{code}\r\nNotice that last_run_report.yaml has a mode of 660 when it should be 664\r\n\r\n \r\n\r\n ","closed_at":"2020-04-27T04:01:28.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10325","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-27T04:01:28.000-0700","timestamp":1652286361.150507,"priority":"Normal","status_category":"Done","pull_request":8023},{"issue_id":"348081","title":"Forward http client requests to puppetserver","url":"https://tickets.puppetlabs.com/browse/PUP-10324","created_at":"2020-03-02T09:57:23.000-0800","number":"PUP-10324","body":"In order to switch the http report processor and other server-side termini to using the new HTTP Client API, we need to provide a puppetserver implementation of the API. However, we don't want to introduce an incompatibility in puppet 6.x such that it requires a specific version of puppetserver 6.x to work.\r\n\r\nSo the idea is to create an implementation of the HTTP Client API which adapts the legacy \r\n{{Puppet::Network::HttpPool.http_client_class}} that puppetserver currently registers.\r\n\r\nFor this ticket:\r\n\r\n\r\n1. Create {{Puppet::HTTP::ExternalClient}} which implements a subset of the {{Puppet::HTTP::Client}} API, {{get}} and {{post}}, as those are the only methods implemented in puppetserver.\r\n2. All other public methods should raise {{NotImplementedError}}, like {{create_session}}, {{put}}, etc.\r\n3. When {{get}} or {{post}} are called, the external client should create an instance of {{Puppet::Network::HttpPool.http_client_class}} and adapt the Client API to the legacy Connection API. So raise instances of {{Puppet::HTTP::HTTPError}} or subclasses, return {{Puppet::HTTP::Response}} objects, etc.\r\n4. Register the {{Puppet::HTTP::ExternalClient}} in the puppet runtime when the {{HttpPool.http_client_class=}} method is called.","closed_at":"2020-04-27T04:02:11.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10324","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-27T04:02:11.000-0700","timestamp":1652286361.251566,"priority":"Normal","status_category":"Done","pull_request":8051},{"issue_id":"343144","title":"windows pidlock can raise access denied","url":"https://tickets.puppetlabs.com/browse/PUP-10248","created_at":"2020-01-22T22:16:32.000-0800","number":"PUP-10248","body":"If puppet is running in the background as a service, and you run {{puppet agent -t}} in the foreground, then the foreground process may not have permission to open the process token for the background process running as {{LocalSystem}} resulting in an ugly error message:\r\n\r\n{noformat}\r\nc:\\Program Files\\Puppet Labs\\Puppet\\puppet\\lib\\ruby\\vendor_ruby\\puppet>puppet agent -t --trace\r\nError: Could not run Puppet configuration client: OpenProcess(2000, 0, 1604):  Access is denied.\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/process.rb:73:in `open_process'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/process.rb:125:in `get_process_image_name_by_pid'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/pidlock.rb:69:in `clear_if_stale'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/pidlock.rb:11:in `locked?'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/pidlock.rb:20:in `lock'\r\nc:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/agent/locker.rb:19:in `lock'\r\n{noformat}\r\n\r\nPuppet should either interpret that to mean \"the pid specified in the lockfile is still running\" or it needs to enable the {{SeDebugPrivilege}} prior to calling {{OpenProcess}} like we do when managing file DACLs. The former is unable to tell if the running process is puppet/ruby or some other process that is now reusing the stale pid, which is the problem we had originally. Might be able to run {{tasklist}} to get the command line, though enabling the debug privilege would definitely detect if the process id is puppet:\r\n\r\n{code:ruby}\r\nwith_privilege(SE_DEBUG_PRIVILEGE) do\r\n  open_process(PROCESS_QUERY_INFORMATION, false, pid) do |phandle|\r\n    ...\r\n  end\r\nend\r\n{code}","closed_at":"2020-04-27T05:33:00.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10248","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-27T05:33:00.000-0700","timestamp":1652286361.453754,"priority":"Normal","status_category":"Done","pull_request":8052},{"issue_id":"341497","title":"Puppet 6 daemons do not release ssl_lockfile","url":"https://tickets.puppetlabs.com/browse/PUP-10228","created_at":"2020-01-08T14:32:54.000-0800","number":"PUP-10228","body":"The {{puppet}} service holds {{ssl_lockfile}} after submiting a Certificate\r\nSigning Request. This blocks other processes from running {{puppet agent -t}}\r\nor {{puppet ssl download_cert}} after the request has been signed by the\r\nPuppet CA.\r\n\r\nh2. Reproduction Case\r\n\r\n  - Install Puppet Server 6.7 on CentOS 7 and initialize it:\r\n\r\n{code:bash}\r\nyum install -y http://yum.puppetlabs.com/puppet6-release-el-7.noarch.rpm\r\nyum install -y puppetserver\r\n\r\nsource /etc/profile.d/puppet-agent.sh\r\npuppet config set server $(hostname -f)\r\npuppetserver ca setup\r\nsystemctl start puppetserver\r\n{code}\r\n\r\n  - Install Puppet Agent 6.11.1 on another CentOS 7 node, configure it to talk\r\n    with the server, and start the daemon:\r\n\r\n{code:bash}\r\nyum install -y http://yum.puppetlabs.com/puppet6-release-el-7.noarch.rpm\r\nyum install -y puppet-agent\r\n\r\nsource /etc/profile.d/puppet-agent.sh\r\npuppet config set server <hostname of server from step 1>\r\nsystemctl start puppet\r\n{code}\r\n\r\n\r\n  - Sign the certificate on the server:\r\n\r\n{code:bash}\r\npuppetserver ca sign --certname=<hostname of agent from step 2>\r\n{code}\r\n\r\n  - Run {{puppet agent -t}} or {{puppet ssl download_cert}} on the agent.\r\n\r\nh3. Outcome\r\n\r\nBoth commands fail with \"Could not run: Another puppet instance is already running; exiting\"\r\n\r\n{noformat}\r\n# puppet agent -t --trace\r\nError: Could not run: Another puppet instance is already running; exiting\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/ssl/state_machine.rb:421:in `with_lock'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/ssl/state_machine.rb:392:in `run_machine'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/ssl/state_machine.rb:370:in `ensure_client_certificate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:505:in `wait_for_certificates'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:368:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:382:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:687:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:382:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:143:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:77:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\n\r\n# puppet ssl download_cert --trace\r\nError: Could not run: Another puppet instance is already running; exiting\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/ssl/state_machine.rb:421:in `with_lock'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/ssl/state_machine.rb:392:in `run_machine'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/ssl/state_machine.rb:361:in `ensure_ca_certificates'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/ssl.rb:130:in `main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:390:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:382:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:687:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:382:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:143:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:77:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\n{noformat}\r\n\r\nThis is because the {{ssl_lockfile}} exists and is held by the daemon:\r\n\r\n{noformat}\r\n# ls $(puppet config print ssl_lockfile)\r\n/etc/puppetlabs/puppet/ssl/ssl.lock\r\n\r\n# echo $(cat $(puppet config print ssl_lockfile))\r\n10460\r\n\r\n# systemctl show -p MainPID puppet\r\nMainPID=10460\r\n{noformat}\r\n\r\nh3. Expected Outcome\r\n\r\nThe daemon releases the {{ssl_lockfile}} when it is not actively updating certificate state.","closed_at":"2020-04-27T05:33:47.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10228","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-27T05:33:47.000-0700","timestamp":1652286361.556773,"priority":"Normal","status_category":"Done","pull_request":8078},{"issue_id":"320115","title":"User type has custom retrieve() with non-standard return values","url":"https://tickets.puppetlabs.com/browse/PUP-9943","created_at":"2019-08-08T06:58:19.000-0700","number":"PUP-9943","body":"The core user type has a custom retrieve() method which returns a Hash that is inconsistent with the data type returned by the common method in Puppet::Type.retrieve(). As a result, mechanisms expecting to use retrieve() will have problems with user resources.\r\n\r\nHere is the offending code in the user type: [https://github.com/puppetlabs/puppet/blob/master/lib/puppet/type/user.rb#L496-L513]\r\n\r\nI think it may be safe and desirable to just remove the user type's retrieve block and let the standard one take effect. The existing retrieve method seems to be 10+ years old and may just be an artifact of a much earlier time in Puppet's life.\r\n\r\nRegardless if the method is needed or not, it should have a return value consistent with the expected return value from the standard Puppet::Type.retrieve() method.","closed_at":"2020-04-27T05:35:26.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9943","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-04-27T05:35:26.000-0700","timestamp":1652286361.657909,"priority":"Normal","status_category":"Done","pull_request":7664},{"issue_id":"349295","title":"5.5.17 agents fail on interval runs","url":"https://tickets.puppetlabs.com/browse/PUP-10366","created_at":"2020-03-11T01:17:21.000-0700","number":"PUP-10366","body":"After upgrade to 2018.1.11, agents with 5.5.17 fail to run successfully on interval. Manual agent runs are successful and also when set with cron job. \n\nError is no implicit conversion from nil to integer (TypeError)\n\n\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:98:in `exit': no implicit conversion from nil to integer (TypeError)\nfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:98:in `block in run_in_fork'\nfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:94:in `fork'\nfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:94:in `run_in_fork'\nfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:48:in `block in run'\nfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:179:in `controlled_run'\nfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent.rb:46:in `run'\nfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/daemon.rb:170:in `block in run_event_loop'\nfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/scheduler/job.rb:49:in `run'\nfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/scheduler/scheduler.rb:39:in `block in run_ready'\nfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/scheduler/scheduler.rb:34:in `each'\nfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/scheduler/scheduler.rb:34:in `run_ready'\nfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/scheduler/scheduler.rb:11:in `run_loop'\nfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/daemon.rb:193:in `run_event_loop'\nfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/daemon.rb:149:in `start'\nfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:402:in `main'\nfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/agent.rb:354:in `run_command'\nfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `block in run'\nfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:667:in `exit_on_fail'\nfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `run'\nfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:139:in `run'\nfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:77:in `execute'\nfrom /opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\n\n~* Please see Zendesk Support tab for further comments and attachments.~","closed_at":"2020-04-27T05:46:27.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10366","labels":"doc_reviewed;jira_escalated","state":"Resolved","updated_at":"2020-04-27T05:46:27.000-0700","timestamp":1652286361.760845,"priority":"Normal","status_category":"Done","pull_request":8074},{"issue_id":"356870","title":"Pass credentials in basic_auth hash","url":"https://tickets.puppetlabs.com/browse/PUP-10470","created_at":"2020-04-27T09:45:36.000-0700","number":"PUP-10470","body":"The old API accepts credentials as {{options[:basic_auth]}} where it contains a hash of {{\\{user: \"username\"\\}}} and {{\\{password: \"a password\"\\}}}. The new API accepts a flattened version {{options[:user]}} and {{options[:password]}}, which assumes basic authentication. We should be able to support different authentication schemes in the future, so it would be good to namespace them, e.g. {{options[:basic_auth]}} vs {{options[:digest_auth]}}.","closed_at":"2020-04-30T09:10:15.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10470","labels":"","state":"Resolved","updated_at":"2020-04-30T09:10:15.000-0700","timestamp":1652286362.478951,"priority":"Normal","status_category":"Done","pull_request":8123},{"issue_id":"356228","title":"RedHat RHBA-2020:1028 breaks yum.rb in yum provider for some systems","url":"https://tickets.puppetlabs.com/browse/PUP-10432","created_at":"2020-04-21T09:48:42.000-0700","number":"PUP-10432","body":"*Puppet Version: 5.5.x (probably 6.x as well)*\r\n *Puppet Server Version: NA, but 5.3.x*\r\n *OS Name/Version: RedHat Linux 7.8*\r\n\r\nDescribe your issue in as much detail as possible…\r\n Describe steps to reproduce…\r\n\r\n*Desired Behavior:*\r\n\r\nYum package ensure => latest should ensure latest\r\n\r\n*Actual Behavior:*\r\n\r\nYum package ensure => latest never finds an update.  Explicit versions work OK.\r\n\r\nMore details:\r\n\r\nRH added a newline character when subscription manager is enabled.\r\n\r\nyum.rb looks for first blank line: [https://github.com/puppetlabs/puppet/blob/f2709eb5b28894cf017dbe41290d3c0d168e721b/lib/puppet/provider/package/yum.rb#L123-L125]\r\n\r\n \r\n{code:java}lib/puppet/provider/package/yum.rb:123-125\r\n def self.parse_updates(str)\r\n # Strip off all content before the first blank line\r\n body = str.partition(/^\\s*\\n/m).last\r\n{code}\r\n As a result, parse_updates returns {} when subscription manager is enabled.\r\n\r\nOld behavior:\r\n{code:java}# yum check-update\r\n Loaded plugins: product-id, search-disabled-repos, subscription-manager\r\n This system is not registered with an entitlement server. You can use subscription-manager to register.{code}\r\n \r\n\r\nNew behavior:\r\n{code:java}# yum check-update\r\n Loaded plugins: product-id, search-disabled-repos, subscription-manager\r\n\r\nThis system is not registered with an entitlement server. You can use subscription-manager to register.{code}\r\n \r\n\r\nworkaround 1: disable subscription-manager\r\n workaround 2: downgrade subscription-manager\r\n\r\n \r\n\r\nExample Code:\r\n $app == 'pcmhi'\r\n $version == 'latest'\r\n{code:java} # package\r\n    package { $app:\r\n        ensure    => $version,\r\n        provider  => yum,\r\n        require   => Yumrepo[$app],\r\n        subscribe => [\r\n            Package['nginx'],\r\n            Package['python3']\r\n        ]\r\n    }{code}\r\n \r\n  \r\n\r\nRepo Contents:\r\n{code:java}Index of rpm/pcmhi/quality_assurance\r\nName                       Last modified      Size\r\n../\r\nrepodata/                   20-Apr-2020 19:28    -\r\npcmhi-3.5.23-0.x86_64.rpm   20-Apr-2020 16:01  19.53 MB\r\npcmhi-3.6.0-0.x86_64.rpm    20-Apr-2020 19:28  23.33 MB\r\n\r\n{code}\r\nManual Update Check:\r\n{code:java}# yum check-update | grep pcmhi\r\n pcmhi.x86_64             1:3.6.0-0             pcmhi{code}\r\n \r\n\r\nPuppet logs:\r\n{code:java}^[[0;36mDebug: Executing: '/bin/rpm --version'^[[0m\r\n ^[[0;36mDebug: Executing '/bin/rpm -qa --nosignature --nodigest --qf '%{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\\n' | sort'^[[0m\r\n ^[[0;36mDebug: Executing: '/bin/yum check-update'^[[0m{code}\r\n \r\n\r\nPoC debug output for yum.rb:\r\n  \r\n{code:java}def self.parse_updates(str)\r\n     # Strip off all content before the first blank line\r\n     self.debug \"parse_updates input #{str}\"\r\n     body = str.partition(/^\\s*\\n/m).last\r\n     self.debug \"parse_updates body #{body}\"\r\n\r\n     updates = Hash.new { |h, k| h[k] = [] }\r\n     body.split.each_slice(3) do |tuple|\r\n       self.debug \"tuple #{tuple}\"\r\n       break if tuple[0] =~ /^(Obsoleting|Security:|Update)/  {code}\r\n \r\n\r\nCustom Debug Output (bad):\r\n  \r\n  \r\n{code:java}Debug: Executing: '/bin/yum check-update'\r\nDebug: Puppet::Type::Package::ProviderYum: parse_updates body - note that the subscription manager warning is present on a bad run\r\nDebug: Puppet::Type::Package::ProviderYum: ----------------------------\r\nDebug: Puppet::Type::Package::ProviderYum: This system is not registered with an entitlement server. You can use subscription-manager to register.\r\ncontainerd.io.x86_64 1.2.6-3.3.el7 sbai \r\ndocker-ce.x86_64 3:19.03.5-3.el7 sbai \r\ndocker-ce-cli.x86_64 1:19.03.5-3.el7 sbai \r\npcmhi.x86_64 1:3.6.0-0 pcmhi \r\npuppet-agent.x86_64 5.5.19-1.el7 puppet5\r\nrhn-check.x86_64 2.0.2-24.el7 rhel7 \r\nrhn-client-tools.x86_64 2.0.2-24.el7 rhel7 \r\nrhn-setup.x86_64 2.0.2-24.el7 rhel7 \r\nDebug: Puppet::Type::Package::ProviderYum: ----------------------------\r\nDebug: Puppet::Type::Package::ProviderYum: update tuple - should be name|version|repo: [\"This\", \"system\", \"is\"]\r\nDebug: Puppet::Type::Package::ProviderYum: parse_updates output {}\r\n{code}\r\n \r\n\r\nCustom Debug Output (downgraded subscription-manager package):\r\n{code:java}Debug: Executing: '/bin/yum check-update'\r\nDebug: Puppet::Type::Package::ProviderYum: parse_updates body - note that the subscription manager warning is present on a bad run\r\nDebug: Puppet::Type::Package::ProviderYum: ----------------------------\r\nDebug: Puppet::Type::Package::ProviderYum: containerd.io.x86_64                               1.2.6-3.3.el7         sbai   \r\ndocker-ce.x86_64                                   3:19.03.5-3.el7       sbai   \r\ndocker-ce-cli.x86_64                               1:19.03.5-3.el7       sbai   \r\npcmhi.x86_64                                       1:3.6.0-0             pcmhi  \r\npuppet-agent.x86_64                                5.5.19-1.el7          puppet5\r\nrhn-check.x86_64                                   2.0.2-24.el7          rhel7  \r\nrhn-client-tools.x86_64                            2.0.2-24.el7          rhel7  \r\nrhn-setup.x86_64                                   2.0.2-24.el7          rhel7  \r\nsubscription-manager.x86_64                        1.24.26-1.el7         rhel7  \r\nsubscription-manager-rhsm.x86_64                   1.24.26-1.el7         rhel7  \r\nsubscription-manager-rhsm-certificates.x86_64      1.24.26-1.el7         rhel7  \r\nDebug: Puppet::Type::Package::ProviderYum: ----------------------------\r\n<snip>\r\nDebug: Puppet::Type::Package::ProviderYum: update tuple - should be name|version|repo: [\"pcmhi.x86_64\", \"1:3.6.0-0\", \"pcmhi\"]\r\nDebug: Puppet::Type::Package::ProviderYum: update_to_hash {:name=>\"pcmhi\", :epoch=>\"1\", :version=>\"3.6.0\", :release=>\"0\", :arch=>\"x86_64\"}\r\nDebug: Puppet::Type::Package::ProviderYum: short_name pcmhi\r\nDebug: Puppet::Type::Package::ProviderYum: long_name pcmhi.x86_64\r\n<snip>\r\nDebug: Puppet::Type::Package::ProviderYum: parse_updates output {\"containerd.io\"=>[{:name=>\"containerd.io\", :epoch=>\"0\", :version=>\"1.2.6\", :release=>\"3.3.el7\", :arch=>\"x86_64\"}], \"containerd.io.x86_64\"=>[{:name=>\"containerd.io\", :epoch=>\"0\", :version=>\"1.2.6\", :release=>\"3.3.el7\", :arch=>\"x86_64\"}], \"docker-ce\"=>[{:name=>\"docker-ce\", :epoch=>\"3\", :version=>\"19.03.5\", :release=>\"3.el7\", :arch=>\"x86_64\"}], \"docker-ce.x86_64\"=>[{:name=>\"docker-ce\", :epoch=>\"3\", :version=>\"19.03.5\", :release=>\"3.el7\", :arch=>\"x86_64\"}], \"docker-ce-cli\"=>[{:name=>\"docker-ce-cli\", :epoch=>\"1\", :version=>\"19.03.5\", :release=>\"3.el7\", :arch=>\"x86_64\"}], \"docker-ce-cli.x86_64\"=>[{:name=>\"docker-ce-cli\", :epoch=>\"1\", :version=>\"19.03.5\", :release=>\"3.el7\", :arch=>\"x86_64\"}], \"pcmhi\"=>[{:name=>\"pcmhi\", :epoch=>\"1\", :version=>\"3.6.0\", :release=>\"0\", :arch=>\"x86_64\"}], \"pcmhi.x86_64\"=>[{:name=>\"pcmhi\", :epoch=>\"1\", :version=>\"3.6.0\", :release=>\"0\", :arch=>\"x86_64\"}], \"puppet-agent\"=>[{:name=>\"puppet-agent\", :epoch=>\"0\", :version=>\"5.5.19\", :release=>\"1.el7\", :arch=>\"x86_64\"}], \"puppet-agent.x86_64\"=>[{:name=>\"puppet-agent\", :epoch=>\"0\", :version=>\"5.5.19\", :release=>\"1.el7\", :arch=>\"x86_64\"}], \"rhn-check\"=>[{:name=>\"rhn-check\", :epoch=>\"0\", :version=>\"2.0.2\", :release=>\"24.el7\", :arch=>\"x86_64\"}], \"rhn-check.x86_64\"=>[{:name=>\"rhn-check\", :epoch=>\"0\", :version=>\"2.0.2\", :release=>\"24.el7\", :arch=>\"x86_64\"}], \"rhn-client-tools\"=>[{:name=>\"rhn-client-tools\", :epoch=>\"0\", :version=>\"2.0.2\", :release=>\"24.el7\", :arch=>\"x86_64\"}], \"rhn-client-tools.x86_64\"=>[{:name=>\"rhn-client-tools\", :epoch=>\"0\", :version=>\"2.0.2\", :release=>\"24.el7\", :arch=>\"x86_64\"}], \"rhn-setup\"=>[{:name=>\"rhn-setup\", :epoch=>\"0\", :version=>\"2.0.2\", :release=>\"24.el7\", :arch=>\"x86_64\"}], \"rhn-setup.x86_64\"=>[{:name=>\"rhn-setup\", :epoch=>\"0\", :version=>\"2.0.2\", :release=>\"24.el7\", :arch=>\"x86_64\"}], \"subscription-manager\"=>[{:name=>\"subscription-manager\", :epoch=>\"0\", :version=>\"1.24.26\", :release=>\"1.el7\", :arch=>\"x86_64\"}], \"subscription-manager.x86_64\"=>[{:name=>\"subscription-manager\", :epoch=>\"0\", :version=>\"1.24.26\", :release=>\"1.el7\", :arch=>\"x86_64\"}], \"subscription-manager-rhsm\"=>[{:name=>\"subscription-manager-rhsm\", :epoch=>\"0\", :version=>\"1.24.26\", :release=>\"1.el7\", :arch=>\"x86_64\"}], \"subscription-manager-rhsm.x86_64\"=>[{:name=>\"subscription-manager-rhsm\", :epoch=>\"0\", :version=>\"1.24.26\", :release=>\"1.el7\", :arch=>\"x86_64\"}], \"subscription-manager-rhsm-certificates\"=>[{:name=>\"subscription-manager-rhsm-certificates\", :epoch=>\"0\", :version=>\"1.24.26\", :release=>\"1.el7\", :arch=>\"x86_64\"}], \"subscription-manager-rhsm-certificates.x86_64\"=>[{:name=>\"subscription-manager-rhsm-certificates\", :epoch=>\"0\", :version=>\"1.24.26\", :release=>\"1.el7\", :arch=>\"x86_64\"}]}\r\n{code}\r\n ","closed_at":"2020-05-01T09:20:49.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10432","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-05-01T09:20:49.000-0700","timestamp":1652286364.003591,"priority":"Normal","status_category":"Done","pull_request":8109},{"issue_id":"305257","title":"Pip package provider does not handle pip executable paths with spaces","url":"https://tickets.puppetlabs.com/browse/PUP-9647","created_at":"2019-04-17T13:39:22.000-0700","number":"PUP-9647","body":"The package pip provider has some suggestion of Windows support. However, it uses \"execpipe\" to invoke commands, which puts a shell redirection of \"2>&1\" into the final command which is not compatible with Windows.\r\n\r\nOn a Windows system with Python installed when the \"pip_version\" method is called it results in an error: \"Cannot collect packages for Puppet::Type::Package::ProviderPip3 provider; undefined method `[]' for nil:NilClass\"\r\n\r\nReworking this in terms of execute allows the pip provider to work on Windows as well.\r\n\r\n ","closed_at":"2020-05-01T13:20:35.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9647","labels":"maintenance;resolved-issue-added;triage","state":"Resolved","updated_at":"2020-05-01T13:20:35.000-0700","timestamp":1652286364.209616,"priority":"Normal","status_category":"Done","pull_request":7752},{"issue_id":"263957","title":"pip provider fails if \"pip --version\" does not emit the version on the first line of output","url":"https://tickets.puppetlabs.com/browse/PUP-8986","created_at":"2018-07-06T05:14:46.000-0700","number":"PUP-8986","body":"*Puppet Version: 4.8.2*\r\n*OS Name/Version: Debian 8.10*\r\n\r\n \r\n\r\nWhen trying to install a package with the pip provider\r\n\r\npuppet agent -t fails with\r\n{code:java}\r\nInfo: Using configured environment 'xxx'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for myhost.com\r\nInfo: Applying configuration version '123213'\r\nError: Failed to apply catalog: undefined method `[]' for nil:NilClass\r\n \r\n{code}\r\nwith --trace it points to:\r\n\r\n \r\n{code:java}\r\nError: Failed to apply catalog: undefined method `[]' for nil:NilClass\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/package/pip.rb:64:in `block (2 levels) in pip_version'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/package/pip.rb:63:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/package/pip.rb:63:in `collect'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/package/pip.rb:63:in `block in pip_version'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/execution.rb:81:in `block (2 levels) in execpipe'\r\n/opt/puppetlabs/puppet/lib/ruby/2.1.0/open-uri.rb:36:in `open'\r\n/opt/puppetlabs/puppet/lib/ruby/2.1.0/open-uri.rb:36:in `open'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/execution.rb:80:in `block in execpipe'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:128:in `withenv'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/execution.rb:79:in `execpipe'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider.rb:117:in `execpipe'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/package/pip.rb:62:in `pip_version'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/package/pip.rb:43:in `instances'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/package.rb:4:in `prefetch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:323:in `prefetch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:223:in `prefetch_if_necessary'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:107:in `block in evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:116:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:116:in `traverse'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:154:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:222:in `block in apply'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:155:in `with_destination'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/report.rb:142:in `as_logging_destination'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:221:in `apply'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:171:in `block in apply_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:223:in `block in benchmark'\r\n \r\n{code}\r\nThe code is:\r\n{code:java}\r\n1  def self.pip_version\r\n2    pip_cmd = self.pip_cmd\r\n3    return nil unless pip_cmd\r\n4    execpipe [pip_cmd, '--version'] do |process|\r\n5      process.collect do |line|\r\n6        return line.strip.match(/^pip (\\d+\\.\\d+\\.?\\d*).*$/)[1]\r\n7      end\r\n8    end\r\n9  end\r\n\r\n{code}\r\nLine 6 fails when \"pip --version\" returns other information:\r\n{code:java}\r\n# pip --version\r\n/usr/local/lib/python2.7/dist-packages/urllib3/contrib/socks.py:37: DependencyWarning: SOCKS support in urllib3 requires the installation of optional dependencies: specifically, PySocks.  For more information, see https://urllib3.readthedocs.io/en/latest/contrib.html#socks-proxies\r\n  DependencyWarning\r\npip 1.5.6 from /usr/lib/python2.7/dist-packages (python 2.7)\r\n{code}\r\nBecause then there is no match, it returns null and using [1] on null obviously fails.\r\n\r\nInstalling python-pysocks removes the warning and fixes the puppet run.\r\n\r\n\r\n*Desired Behavior:*\r\n\r\nThe pip_version function should be able to handle additional output. Either by checking if there is a match or by filtering out stderr.\r\n\r\n ","closed_at":"2020-05-11T00:59:04.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8986","labels":"Easy;jira_escalated;linux;package;pip;resolved-issue-added;type_and_provider","state":"Resolved","updated_at":"2020-05-11T00:59:04.000-0700","timestamp":1652286365.276383,"priority":"Normal","status_category":"Done","pull_request":7751},{"issue_id":"348049","title":"Facter 4 debug logs don't use Puppet logger","url":"https://tickets.puppetlabs.com/browse/PUP-10322","created_at":"2020-03-02T07:13:29.000-0800","number":"PUP-10322","body":"*Puppet Version: 6.13*\r\n *Puppet Server Version: ---*\r\n *OS Name/Version: all*\r\n\r\n \r\n\r\nWhen we enable facterng feature flag\r\n{code:java}\r\npuppet config set facterng true{code}\r\n and run \r\n{code:java}\r\npuppet facts --debug{code}\r\n log messages use Facter 4 logger instead of Puppet logger\r\n\r\n \r\n\r\nFacter 4 logger output format is\r\n{code:java}\r\n[<date_time> ] <log-level> <class-name> - <log-message>\r\n{code}\r\nPuppet debug logs fro facter\r\n{code:java}\r\nDebug: Facter: <log-message>{code}\r\n ","closed_at":"2020-05-13T01:53:22.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10322","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-05-13T01:53:22.000-0700","timestamp":1652286365.482901,"priority":"Normal","status_category":"Done","pull_request":8016},{"issue_id":"342589","title":"Change strict_hostname_checking to true","url":"https://tickets.puppetlabs.com/browse/PUP-10238","created_at":"2020-01-17T10:41:22.000-0800","number":"PUP-10238","body":"the decision was to change the default for strict_hostname_checking from false to true in the next release and to remove the option entirely (and only allow strict hostname checking) in Puppet 7. This would include an advisory that users not upgrading should change strict_hostname_checking to true.\r\n\r\nFor those who want the previous insecure behavior for the remainder of the 6 series they may disable strict_hostname_checking. However they are encouraged to switch to the preferred way to have that functionality in 7 now. For those users that want to classify their nodes using the CN but with partial segment matching they should switch their node declarations to use regexes. For those users that want to include hostname, fqdn, or domain facts in their classification schemes they should do so explicitly in a default node block. (I can create example manifests if desired)\r\n\r\nThe rationale for this, is that partial segment matching could also be considered insecure (don't have a rating for it though), there are more explicit ways to match partial CNs or facts in a site.pp (see above workarounds), and other options don't allow for users to opt out of the security fixes (should they be relying on this behavior) in the short term.\r\n\r\n \r\n\r\nBecause this is a documented option (though inherently insecure) I will do this work with a PR to the open source repo (not a private fork), but w/o reference to the CVE. I will open this PR towards the end of the normal release cycle as well.","closed_at":"2020-05-13T18:18:22.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10238","labels":"","state":"Resolved","updated_at":"2020-05-13T18:18:22.000-0700","timestamp":1652286366.112374,"priority":"Normal","status_category":"Done","pull_request":7982},{"issue_id":"341492","title":"Close the http connection prior to sleeping retry-after seconds","url":"https://tickets.puppetlabs.com/browse/PUP-10227","created_at":"2020-01-08T13:56:09.000-0800","number":"PUP-10227","body":"To prevent thundering herds, puppetserver may return Retry-After and ask the agent to sleep. Until recently the agent would keep the connection open, until timeout occurs. To reduce resource usage on puppetserver, we should close the connection immediately.\r\n\r\nThe latest puppetserver version will return {{Connection: close}}, but agents may talk to older puppetservers versions which would benefit from this.","closed_at":"2020-05-13T18:18:23.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10227","labels":"resolved-issue-added","state":"Resolved","updated_at":"2020-05-13T18:18:23.000-0700","timestamp":1652286366.21959,"priority":"Normal","status_category":"Done","pull_request":7980},{"issue_id":"332233","title":"Functions are slower if called with chained syntax than with prefix syntax","url":"https://tickets.puppetlabs.com/browse/PUP-10113","created_at":"2019-10-28T07:45:25.000-0700","number":"PUP-10113","body":"*Puppet Version: 5.5.17*\r\n *Puppet Server Version: 2018.1*\r\n *OS Name/Version: Centos 7*\r\n\r\n \r\n\r\n*Desired Behavior:*\r\n\r\nAs documented in [https://puppet.com/docs/puppet/5.5/lang_functions.html#chained-function-calls], chained function call syntax should result in same behaviour as prefixed syntax.\r\n\r\n*Actual Behavior:*\r\n\r\nUsing chained syntax results in slower performance of the function call. The performance depends on the size of the object \"before the dot\".\r\n\r\n{{Examples:}}\r\n\r\n{{Run puppet apply test.pp --debug --profile}}\r\n\r\nPlease see attached:\r\n * test.pp\r\n * test.log","closed_at":"2020-05-13T18:18:24.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10113","labels":"resolved-issue-added","state":"Resolved","updated_at":"2020-05-13T18:18:24.000-0700","timestamp":1652286366.529693,"priority":"Normal","status_category":"Done","pull_request":7928},{"issue_id":"357903","title":"Puppet settings catalog requires codedir to be a directory","url":"https://tickets.puppetlabs.com/browse/PUP-10500","created_at":"2020-05-06T11:33:04.000-0700","number":"PUP-10500","body":"When file-sync is in {{versioned_deploys}} mode, we turn the target of Puppet's codedir setting into a symlink that points at the most recently-deployed version of the code. However, Puppet's internal settings catalog tries to ensure that {{codedir}} is a directory. When it finds a symlink instead, it errors, causing server startup to fail.\r\n{code:java}2020-05-06T16:27:25.444Z ERROR [clojure-agent-send-pool-0] [puppetserver] Puppet Could not set 'directory' on ensure: File exists - /etc/puppetlabs/code/latest\r\nFile exists - /etc/puppetlabs/code/latestorg/jruby/RubyDir.java:632:in `mkdir'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/file/ensure.rb:93:in `block in set_directory'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/property.rb:490:in `set'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/property.rb:570:in `sync'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/file/ensure.rb:189:in `sync'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:241:in `sync'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:136:in `sync_if_needed'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:82:in `perform_changes'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/resource_harness.rb:21:in `evaluate'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:267:in `apply'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:287:in `eval_resource'org/jruby/RubyMethod.java:119:in `call'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:191:in `block in evaluate'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:521:in `block in thinmark'uri:classloader:/META-INF/jruby.home/lib/ruby/stdlib/benchmark.rb:308:in `realtime'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:520:in `thinmark'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:191:in `block in evaluate'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:122:in `traverse'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:178:in `evaluate'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:240:in `block in apply'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:521:in `block in thinmark'uri:classloader:/META-INF/jruby.home/lib/ruby/stdlib/benchmark.rb:308:in `realtime'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:520:in `thinmark'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:239:in `block in apply'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:165:in `with_destination'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/report.rb:146:in `as_logging_destination'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:238:in `apply'/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/settings.rb:1070:in `use'uri:classloader:/puppetserver-lib/puppet/server/puppet_config.rb:89:in `initialize_puppet'uri:classloader:/puppetserver-lib/puppet/server/master.rb:37:in `initialize' \r\n{code}","closed_at":"2020-05-18T10:48:59.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10500","labels":"","state":"Closed","updated_at":"2020-05-18T10:48:59.000-0700","timestamp":1652286367.579104,"priority":"Normal","status_category":"Done","pull_request":8149},{"issue_id":"337880","title":"Puppet should not load types and providers during environment convergence","url":"https://tickets.puppetlabs.com/browse/PUP-10160","created_at":"2019-12-04T11:42:30.000-0800","number":"PUP-10160","body":"During environment convergence, puppet loads types and providers for pluginsynced modules, potentially multiple times. Type/provider loading is triggered when writing the cached catalog and/or when converting the resource catalog to a RAL catalog.\r\n\r\nHowever, if the environment doesn't converge the first time, then puppet will switch environments, and pluginsync in a different environment, potentially receiving different versions of type/provider code. Puppet can reload new versions of types and providers, but can't reload helper code required by type/providers. This can result in newer providers calling methods in older helper code still in memory.\r\n\r\nThis problem may occur when the classifier uses pluginsynced facts to determine environment, a node doesn't have that fact yet (or a wrong version of the fact), puppetdb doesn't have a facts for that node in the \"final\" environment, the node attempts to get a catalog, and there are different versions of a module in different environments.\r\n\r\nThe problem may not occur, or may not be noticed if the different versions of modules don't conflict in a way that causes an exception.\r\n\r\nThe problem won't occur if the agent resolves the environment during the node request (before pluginsync). However, the agent doesn't send facts with the node request (a long standing request), so this generally applies to nodes that have already resolved the environment once.\r\n\r\nHere's a stacktrace showing the inifile type/provider being loaded during the environment resolution process (using 5.5.17):\r\n\r\n{noformat}\r\n# puppet --version\r\n5.5.17\r\n# rm -rf /opt/puppetlabs/puppet/cache/lib/ && puppet config set certname \"agent55x$RANDOM\" --section main && puppet agent -t --trace --logdest /tmp/out.log\r\n\r\n--> #0  #<Class:Puppet::Util::Autoload>.mark_loaded(name#String, file#String) at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:43\r\n    #1  #<Class:Puppet::Util::Autoload>.load_file(name#String, env#Puppet::Node::Environment::Remote) at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:70\r\n    #2  Puppet::Util::Autoload.load(name#Symbol, env#Puppet::Node::Environment::Remote) at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:198\r\n    #3  Puppet::MetaType::Manager.type(name#Symbol) at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/metatype/manager.rb:174\r\n    #4  #<Class:Puppet::Resource>.resource_type(type#String, title#String, environment#Puppet::Node::Environment::Remote) at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource.rb:360\r\n    #5  Puppet::Resource.resource_type at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource.rb:348\r\n    #6  Puppet::Resource.parse_title at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource.rb:656\r\n    #7  Puppet::Resource.to_hash at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource.rb:392\r\n    #8  Puppet::Resource.to_data_hash at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource.rb:93\r\n    #9  block in Puppet::Resource::Catalog.block in to_data_hash at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:506\r\n    ͱ-- #10 Array.map at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:506\r\n    #11 Puppet::Resource::Catalog.to_data_hash at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:506\r\n    #12 Puppet::Network::FormatSupport.to_json(*args#Array) at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/format_support.rb:100\r\n    #13 Puppet::Network::Format.render(instance#Puppet::Resource::Catalog) at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/format.rb:65\r\n    #14 Puppet::Network::FormatSupport.render(format#String) at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/format_support.rb:106\r\n    #15 Puppet::Resource::Catalog::Json.to_json(object#Puppet::Resource::Catalog) at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/json.rb:19\r\n    #16 block in Puppet::Indirector::JSON.block in save(request#Puppet::Indirector::Request) at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/json.rb:17\r\n    #17 #<Class:Puppet::Util>.replace_file(file#Pathname, default_mode#Integer, &block#Proc) at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:603\r\n    #18 Puppet::Indirector::JSON.save(request#Puppet::Indirector::Request) at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/json.rb:17\r\n    #19 Puppet::Indirector::Indirection.find(key#String, options#Hash) at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:204\r\n    #20 block in Puppet configuration client.block in retrieve_new_catalog(query_options#Hash) at /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:455\r\n{noformat}\r\n\r\nTo fix this problem the conversion of resource catalog to RAL catalog and writing the cached catalog need to occur after the environment converges.\r\n","closed_at":"2020-05-18T14:50:24.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10160","labels":"resolved-issue-added","state":"Resolved","updated_at":"2020-05-18T14:50:24.000-0700","timestamp":1652286367.78504,"priority":"Normal","status_category":"Done","pull_request":7874},{"issue_id":"160414","title":"useradd provider fails if the current value of user's expiry is nil","url":"https://tickets.puppetlabs.com/browse/PUP-6909","created_at":"2016-11-09T20:34:32.000-0800","number":"PUP-6909","body":"Error: /Stage[main]/xxx::Userlistt/Resources[user]: Failed to generate additional resources using 'generate': expected numeric                                    [250/1815]\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/provider/user/useradd.rb:40:in `+'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/provider/user/useradd.rb:40:in `block (2 levels) in <top (required)>'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/provider/nameservice.rb:218:in `call'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/provider/nameservice.rb:218:in `unmunge'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/provider/user/useradd.rb:208:in `block (3 levels) in <top (required)>'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/property.rb:471:in `retrieve'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/type/user.rb:393:in `block in retrieve'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/type/user.rb:387:in `each'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/type/user.rb:387:in `inject'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/type/user.rb:387:in `retrieve'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/type.rb:1076:in `retrieve_resource'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/type/resources.rb:149:in `user_check'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/type/resources.rb:94:in `check'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/type/resources.rb:113:in `block in generate'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/type/resources.rb:113:in `select'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/type/resources.rb:113:in `generate'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/transaction/additional_resource_generator.rb:17:in `generate_additional_resources'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/transaction.rb:83:in `block in evaluate'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/transaction.rb:83:in `each'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/transaction.rb:83:in `evaluate'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/resource/catalog.rb:169:in `block in apply'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/util/log.rb:149:in `with_destination'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/transaction/report.rb:112:in `as_logging_destination'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/resource/catalog.rb:168:in `apply'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/configurer.rb:120:in `block in apply_catalog'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/util.rb:161:in `block in benchmark'\r\n/usr/lib64/ruby/2.1.0/benchmark.rb:294:in `realtime'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/util.rb:160:in `benchmark'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/configurer.rb:119:in `apply_catalog'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/configurer.rb:227:in `run_internal'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/configurer.rb:134:in `block in run'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/context.rb:64:in `override'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet.rb:246:in `override'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/configurer.rb:133:in `run'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/agent.rb:47:in `block (4 levels) in run'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/agent/locker.rb:20:in `lock'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/agent.rb:47:in `block (3 levels) in run'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/agent.rb:117:in `with_client'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/agent.rb:44:in `block (2 levels) in run'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/agent.rb:82:in `run_in_fork'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/agent.rb:43:in `block in run'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/application.rb:179:in `call'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/application.rb:179:in `controlled_run'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/agent.rb:41:in `run'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/application/agent.rb:361:in `onetime'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/application/agent.rb:327:in `run_command'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/application.rb:381:in `block (2 levels) in run'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/application.rb:507:in `plugin_hook'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/application.rb:381:in `block in run'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/util.rb:496:in `exit_on_fail'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/application.rb:381:in `run'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/util/command_line.rb:146:in `run'\r\n/usr/lib64/ruby/vendor_ruby/2.1.0/puppet/util/command_line.rb:92:in `execute'\r\n/usr/bin/puppet:8:in `<main>'","closed_at":"2020-05-19T02:41:59.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6909","labels":"linux;platform-os;sles;type_and_provider;user","state":"Closed","updated_at":"2020-05-19T02:41:59.000-0700","timestamp":1652286367.889896,"priority":"Normal","status_category":"Done","pull_request":8159},{"issue_id":"356873","title":"Accept symbols as names of runtime implementation","url":"https://tickets.puppetlabs.com/browse/PUP-10471","created_at":"2020-04-27T09:52:51.000-0700","number":"PUP-10471","body":"The {{Puppet.runtime[name]}} API should use symbols, e.g. {{:http}}, because it doesn't require the caller to allocate a string (puppet doesn't use the frozen string pragma yet).\r\n\r\nIf a string is specified, we may want to covert to a symbol using {{String#to_sym}}, but we could also just not do that.\r\n\r\nUpdate API docs to use a symbol.","closed_at":"2020-05-19T06:51:45.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10471","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-05-19T06:51:45.000-0700","timestamp":1652286368.299014,"priority":"Normal","status_category":"Done","pull_request":8128},{"issue_id":"356713","title":"Add deprecation warning to find/search/save/destroy methods in the abstract rest terminus","url":"https://tickets.puppetlabs.com/browse/PUP-10445","created_at":"2020-04-24T13:19:50.000-0700","number":"PUP-10445","body":"Add deprecation warnings to the find/search/save/destroy methods to the Puppet::Indirection::Rest.","closed_at":"2020-05-19T06:53:14.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10445","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-05-19T06:53:14.000-0700","timestamp":1652286368.401202,"priority":"Normal","status_category":"Done","pull_request":8117},{"issue_id":"356711","title":"Deprecate http file content terminus","url":"https://tickets.puppetlabs.com/browse/PUP-10444","created_at":"2020-04-24T13:14:41.000-0700","number":"PUP-10444","body":"Puppet no longer uses the indirector to retrieve file content from puppet/http(s) URLS, so the {{http}} fille content terminus can be deprecated in 6.x and removed in puppet 7.","closed_at":"2020-05-19T06:54:12.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10444","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-05-19T06:54:12.000-0700","timestamp":1652286368.503803,"priority":"Normal","status_category":"Done","pull_request":8116},{"issue_id":"356111","title":"Add method for registering runtime implementations","url":"https://tickets.puppetlabs.com/browse/PUP-10429","created_at":"2020-04-20T11:19:06.000-0700","number":"PUP-10429","body":"Puppetserver needs to be able to register its http client implementation (See SERVER-2780). This ticket is to make the change in puppet so puppetserver can do that.","closed_at":"2020-05-19T06:55:17.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10429","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-05-19T06:55:17.000-0700","timestamp":1652286368.606892,"priority":"Normal","status_category":"Done","pull_request":8105},{"issue_id":"355521","title":"Observe waitforlock when acquiring the ssl lock","url":"https://tickets.puppetlabs.com/browse/PUP-10420","created_at":"2020-04-14T11:44:28.000-0700","number":"PUP-10420","body":"PUP-8051 adds an option so the agent can wait for an in-progress run to finish. This ticket is to add the same functionality to the ssl state machine lock. This ticket is blocked on PUP-10228","closed_at":"2020-05-19T06:56:02.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10420","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-05-19T06:56:02.000-0700","timestamp":1652286368.710399,"priority":"Normal","status_category":"Done","pull_request":8097},{"issue_id":"347230","title":"puppet plugin download fails if agent specified environment doesn't exist on the agent","url":"https://tickets.puppetlabs.com/browse/PUP-10307","created_at":"2020-02-21T08:51:41.000-0800","number":"PUP-10307","body":"Add a {{dev}} environment to {{/etc/puppetlabs/code/environments/dev}} on the puppetserver.\r\nOn a different host, the agent run will succeed, but plugin download will fail:\r\n\r\n{noformat}\r\n$ puppet agent -t -E dev\r\nInfo: Using configured environment 'dev'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Caching catalog for XXX\r\nInfo: Applying configuration version '1582303430'\r\n$  bx puppet plugin download  -E dev\r\nbundler: failed to load command: puppet (/Users/josh/work/puppet/.bundle/ruby/2.3.0/bin/puppet)\r\nPuppet::Environments::EnvironmentNotFound: Could not find a directory environment named 'dev' anywhere in the path: /Users/josh/.puppetlabs/etc/code/environments. Does the directory exist?\r\n  /Users/josh/work/puppet/lib/puppet/environments.rb:40:in `get!'\r\n  /Users/josh/work/puppet/lib/puppet/application_support.rb:34:in `push_application_context'\r\n  /Users/josh/work/puppet/lib/puppet/application.rb:370:in `run'\r\n  /Users/josh/work/puppet/lib/puppet/util/command_line.rb:143:in `run'\r\n  /Users/josh/work/puppet/lib/puppet/util/command_line.rb:77:in `execute'\r\n  /Users/josh/work/puppet/bin/puppet:5:in `<top (required)>'\r\n  /Users/josh/work/puppet/.bundle/ruby/2.3.0/bin/puppet:22:in `load'\r\n  /Users/josh/work/puppet/.bundle/ruby/2.3.0/bin/puppet:22:in `<top (required)>'\r\n{noformat}\r\n\r\nThe problem is the {{plugin}} application needs to specify that the environment is not required to exist locally:\r\n\r\n{code:diff}\r\ndiff --git a/lib/puppet/application/plugin.rb b/lib/puppet/application/plugin.rb\r\nindex 2d0402e43f..06beb9eabf 100644\r\n--- a/lib/puppet/application/plugin.rb\r\n+++ b/lib/puppet/application/plugin.rb\r\n@@ -1,3 +1,4 @@\r\n require 'puppet/application/face_base'\r\n class Puppet::Application::Plugin < Puppet::Application::FaceBase\r\n+  environment_mode :not_required\r\n end\r\n{code}\r\n","closed_at":"2020-05-19T06:58:53.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10307","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-05-19T06:58:53.000-0700","timestamp":1652286368.814022,"priority":"Normal","status_category":"Done","pull_request":8140},{"issue_id":"346028","title":"external trusted data is executed for file_content requests","url":"https://tickets.puppetlabs.com/browse/PUP-10292","created_at":"2020-02-12T05:52:47.000-0800","number":"PUP-10292","body":"*Puppet Version: 6.12.0*\r\n *Puppet Server Version: 6.8.0*\r\n *OS Name/Version: RHEL*\r\n\r\nWhen using the trusted_external_command setting, the command is executed for every file_content request, not just catalogs. This info can't possibly be required for a file_content request and this will cause a huge performance impact to the puppetserver as this could easily be executed 1000 times for a given node if it's new and needs to do a pluginsync, or if there are a lot of files managed.\r\n\r\nThe error you see below is just from my trusted_external_command and is irrelevant other than show that it does execute it each time\r\n\r\n \r\n{code:java}\r\n172.17.0.2 - - - 12/Feb/2020:11:52:37 +0000 \"GET /puppet/v3/file_content/plugins/puppet/parser/functions/chomp.rb?environment=production& HTTP/1.1\" 200 1295 172.17.0.2 172.17.0.2 8140 96\r\n2020-02-12 11:52:37,545 WARN  [c.p.p.ShellUtils] Executed an external process which logged to STDERR: loading of puppet_x/external_data/multiplexer failed, no external data will be returned172.17.0.2 - - - 12/Feb/2020:11:52:37 +0000 \"GET /puppet/v3/file_content/plugins/puppet/parser/functions/chop.rb?environment=production& HTTP/1.1\" 200 1343 172.17.0.2 172.17.0.2 8140 107\r\n2020-02-12 11:52:37,632 WARN  [c.p.p.ShellUtils] Executed an external process which logged to STDERR: loading of puppet_x/external_data/multiplexer failed, no external data will be returned172.17.0.2 - - - 12/Feb/2020:11:52:37 +0000 \"GET /puppet/v3/file_content/plugins/puppet/parser/functions/clamp.rb?environment=production& HTTP/1.1\" 200 1330 172.17.0.2 172.17.0.2 8140 84\r\n2020-02-12 11:52:37,730 WARN  [c.p.p.ShellUtils] Executed an external process which logged to STDERR: loading of puppet_x/external_data/multiplexer failed, no external data will be returned172.17.0.2 - - - 12/Feb/2020:11:52:37 +0000 \"GET /puppet/v3/file_content/plugins/puppet/parser/functions/concat.rb?environment=production& HTTP/1.1\" 200 1331 172.17.0.2 172.17.0.2 8140 85\r\n2020-02-12 11:52:37,811 WARN  [c.p.p.ShellUtils] Executed an external process which logged to STDERR: loading of puppet_x/external_data/multiplexer failed, no external data will be returned172.17.0.2 - - - 12/Feb/2020:11:52:37 +0000 \"GET /puppet/v3/file_content/plugins/puppet/parser/functions/convert_base.rb?environment=production& HTTP/1.1\" 200 1935 172.17.0.2 172.17.0.2 8140 87\r\n2020-02-12 11:52:37,916 WARN  [c.p.p.ShellUtils] Executed an external process which logged to STDERR: loading of puppet_x/external_data/multiplexer failed, no external data will be returned172.17.0.2 - - - 12/Feb/2020:11:52:37 +0000 \"GET /puppet/v3/file_content/plugins/puppet/parser/functions/count.rb?environment=production& HTTP/1.1\" 200 1373 172.17.0.2 172.17.0.2 8140 86\r\n2020-02-12 11:52:38,013 WARN  [c.p.p.ShellUtils] Executed an external process which logged to STDERR: loading of puppet_x/external_data/multiplexer failed, no external data will be returned172.17.0.2 - - - 12/Feb/2020:11:52:38 +0000 \"GET /puppet/v3/file_content/plugins/puppet/parser/functions/create_ini_settings.rb?environment=production& HTTP/1.1\" 200 1711 172.17.0.2 172.17.0.2 8140 94\r\n2020-02-12 11:52:38,107 WARN  [c.p.p.ShellUtils] Executed an external process which logged to STDERR: loading of puppet_x/external_data/multiplexer failed, no external data will be returned {code}\r\n ","closed_at":"2020-05-19T06:59:50.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10292","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-05-19T06:59:50.000-0700","timestamp":1652286368.919192,"priority":"Major","status_category":"Done","pull_request":8119},{"issue_id":"338108","title":"Agent incorrectly reporting corrective changes when base64 padding is missing from Content-MD5","url":"https://tickets.puppetlabs.com/browse/PUP-10164","created_at":"2019-12-05T13:51:59.000-0800","number":"PUP-10164","body":"*Puppet Version: 6.11.1*\r\n *Puppet Server Version: 6*\r\n *OS Name/Version: Centos* \r\n\r\nReproducing this requires using a file from an https server as the source for a local file. In our case it is things that are secret like /etc/shadow that we don't want committed to our puppet repo. \r\n\r\n*Local Reproducing Steps:*\r\n\r\n* run the command below and copy the md5 resulted\r\n\r\n{code:bash}[root@unpaved-song ttt]# printf '%s' \"File Data\" | md5sum\r\n0ee8336a3589503bcb03c7885950c909{code}\r\n\r\n* create a .rb file and copy the following inside to have a server with a get response with \"File Data\" text and a Content-MD5 header.\r\n\r\n \r\n{code:ruby}# server.rb\r\nrequire 'socket'\r\nserver = TCPServer.new 5678\r\nwhile session = server.accept\r\n  request = session.gets\r\n  puts request \r\n  session.print \"HTTP/1.1 200\\r\\n\"\r\n  session.print \"Content-Type: text/html\\r\\n\"\r\n  session.print \"Content-MD5: 0ee8336a3589503bcb03c7885950c909\\r\\n\"\r\n  session.print \"\\r\\n\"\r\n  session.print \"File Data\"\r\n  session.close\r\nend\r\n{code}\r\n\r\n* run ruby server.rb to start the server\r\n* run puppet apply -e 'file \\{\"/file_from_server\": source => \"http://localhost:5678\"}' to get the data form the local server\r\n\r\n{code:java}[root@unpaved-song ttt]# puppet apply -e 'file {\"/file_from_server\": source => \"http://localhost:5678\"}'\r\nNotice: Compiled catalog for unpaved-song.delivery.puppetlabs.net in environment production in 0.01 seconds\r\nNotice: /Stage[main]/Main/File[/file_from_server]/ensure: defined content as '{md5}f5d7fb75fe1beb6f1bedaefa6bddf7df9e7df797b9ef4d9c'\r\nNotice: Applied catalog in 0.07 seconds\r\n{code}\r\n\r\n* Running the command again you will get\r\n\r\n{code:java}Notice: /Stage[main]/Main/File[/file_from_server]/content: content changed '{md5}0ee8336a3589503bcb03c7885950c909' to '{md5}f5d7fb75fe1beb6f1bedaefa6bddf7df9e7df797b9ef4d9c'\r\n{code}\r\n \r\n\r\n*Desired Behavior:*\r\n\r\nI want the agent to calculate the md5sum correctly when pulling a file from a remote https server. \r\n\r\n*Actual Behavior:*\r\n\r\nAgent reports changing content from an MD5 with 128 bits to an 'MD5' with 196 bits. It doesn't change the file as no changes are needed. The 'changed' file's md5sum is the same before and  after the agent runs.\r\n\r\nIt seems to be using a 196 bit hash in place of an md5sum and reporting it needs changing as the 128 bit and 196 bit values are not equal.","closed_at":"2020-05-19T07:02:13.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10164","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-05-19T07:02:13.000-0700","timestamp":1652286369.025134,"priority":"Normal","status_category":"Done","pull_request":8132},{"issue_id":"353908","title":"\"Unable to set ownership\" error with logdest on agents running as root","url":"https://tickets.puppetlabs.com/browse/PUP-10407","created_at":"2020-04-02T00:28:32.000-0700","number":"PUP-10407","body":"As described in the attached issue, a puppet agent run raises the following error: \"Puppet (err): Unable to set ownership to puppet:puppet for log file\".\r\nCaused by trying to change the owner to puppet:puppet which doesn't exist and shouldn't happen when run as root.\r\n\r\nThis happens if the file doesn't exist but also when it does, since it writes to a temporary file and tries to set owner on this one too.\r\n\r\nAlso the command line parameter \"--no-manage_internal_file_permissions\" dosen't help.\r\n\r\nAlthough this should have been fixed, it's not.","closed_at":"2020-05-19T09:38:20.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10407","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-05-19T09:38:20.000-0700","timestamp":1652286369.131948,"priority":"Normal","status_category":"Done","pull_request":8100},{"issue_id":"259518","title":"AIX package installation is not checking state of the package ","url":"https://tickets.puppetlabs.com/browse/PUP-8937","created_at":"2018-06-06T20:11:25.000-0700","number":"PUP-8937","body":"Hi, \r\n\r\nWhen we installing packages on AIX servers, We are only checking package name and version. We are not checking the package state. If the package is broken or inconsistent state, the puppet is not reporting any error. Puppet thinks the package is installed and good shape. So it is leaving the customer to check manually about the issue. \r\n\r\n \r\n\r\nOne of our customer package was installed but it was inconsistent, puppet didn't check the status of that package. \r\n\r\nFor example: \r\n\r\n+*Broken state:-*+\r\n\r\n \r\n\r\n[root@tstspap221:/root]# /usr/sbin/installp -L -d /nfs/infra/veritas/sw/VOM/VRTSsfmh_7.3.1.200_AIX.bff\r\n\r\nVRTSsfmh:VRTSsfmh:7.3.1.200::I:?:::::N:Veritas Infoscale Operations Manager Managed Host::::0::\r\n\r\n[root@tstspap221:/root]# /usr/bin/lslpp -Lc VRTSsfmh\r\n\r\n#Package Name:Fileset:Level:State:PTF Id:Fix State:Type:Description:Destination Dir.:Uninstaller:Message Catalog:Message Set:Message Number:Parent:Automatic:EFIX Locked:Install Path:Build Date\r\n\r\nVRTSsfmh:VRTSsfmh:7.3.1.200: : :?: :Veritas Infoscale Operations Manager Managed Host: : : : : : :0:0:/:\r\n\r\n[root@tstspap221:/root]#\r\n\r\n[root@tstspap221:/root]#\r\n\r\n \r\n\r\n \r\n\r\n+*Successful* *installation*:*-*+\r\n\r\n \r\n\r\n[root@qatcdex143:/root]# lslpp -Lcq VRTSsfmh\r\n\r\nVRTSsfmh:VRTSsfmh:7.3.1.200: : :C: :Veritas Infoscale Operations Manager Managed Host: : : : : : :0:0:/:\r\n\r\n[root@qatcdex143:/root]# /usr/sbin/installp -L -d /nfs/infra/veritas/sw/VOM/VRTSsfmh_7.3.1.200_AIX.bff\r\n\r\nVRTSsfmh:VRTSsfmh:7.3.1.200::I:C:::::N:Veritas Infoscale Operations Manager Managed Host::::0::\r\n\r\n[root@qatcdex143:/root]#\r\n\r\n \r\n\r\n{color:#ff0000}*State codes:*{color}\r\nA – Applied.\r\nB – Broken.\r\nC – Committed.\r\nE – EFIX Locked.\r\nO – Obsolete. (partially migrated to newer version)\r\n? – Inconsistent State...Run lppchk -v.\r\n\r\n \r\n\r\nCan we add install_option for AIX provider ? Currently AIX provider will not support install_option attribute. \r\n\r\n \r\n\r\nExpected Result,\r\n\r\n \r\n\r\nIf broken package or incosistent pacakge , Puppet will raise error and report failed change. \r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\n ","closed_at":"2020-05-27T02:58:35.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8937","labels":"aix;customer;doc_reviewed;package;type_and_provider","state":"Resolved","updated_at":"2020-05-27T02:58:35.000-0700","timestamp":1652286379.463277,"priority":"Normal","status_category":"Done","pull_request":8107},{"issue_id":"304376","title":"Windows package resource does not remove trailing whitespace","url":"https://tickets.puppetlabs.com/browse/PUP-9639","created_at":"2019-04-10T14:56:52.000-0700","number":"PUP-9639","body":"Package Inspector in Windows is reading in the version number without removing trailing whitespace, which when submitted to the DB as a fact causes the updated facts for that agent to be discarded.\r\n\r\nAs seen on a Windows machine:\r\n\r\n{code:puppet}\r\npackage { 'McAfee SiteAdvisor Enterprise':\r\n  ensure => '1.7.0.144                                                                                                                                                                                                                                                      ',\r\n}\r\n{code}\r\n\r\nWhich is passed into a fact as:\r\n\r\n{code:json}\r\n{\r\n\"name\": \"node.puppet.com\",\r\n\"values\": {\r\n\"_puppet_inventory_1\": {\r\n\"packages\": [\r\n[\"McAfee SiteAdvisor Enterprise\", \"1.7.0.144\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\", \"windows\"]\r\n{code}\r\n\r\nWhich in turn causes PuppetDB to reject facts from the node, including facts other than the one with the null bit:\r\n\r\n{code:puppet}\r\n2017-10-06 17:32:11,961 ERROR [p.p.command] [5,166,564] [replace facts] Retrying after attempt 0 for node.puppet.com, due to: org.postgresql.util.PSQLException: ERROR: invalid byte sequence for encoding \"UTF8\": 0x00 \r\norg.postgresql.util.PSQLException: ERROR: invalid byte sequence for encoding \"UTF8\": 0x00\r\n{code}\r\n","closed_at":"2020-05-28T13:08:25.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9639","labels":"cstop10;jira_escalated;maintenance;resolved-issue-added;triage","state":"Resolved","updated_at":"2020-05-28T13:08:25.000-0700","timestamp":1652286379.985274,"priority":"Critical","status_category":"Done","pull_request":7492},{"issue_id":"357470","title":"LOAD_PATH can get corrupted when multithreading is on","url":"https://tickets.puppetlabs.com/browse/PUP-10483","created_at":"2020-04-30T14:37:28.000-0700","number":"PUP-10483","body":null,"closed_at":"2020-05-28T17:15:24.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10483","labels":"","state":"Resolved","updated_at":"2020-05-28T17:15:24.000-0700","timestamp":1652286380.088945,"priority":"Normal","status_category":"Done","pull_request":8163},{"issue_id":"356838","title":"Portage package provider doesn't work on Gentoo-based distributions","url":"https://tickets.puppetlabs.com/browse/PUP-10469","created_at":"2020-04-27T05:09:38.000-0700","number":"PUP-10469","body":"*Puppet Version:* 6.13.0\r\n *Puppet Server Version:* 6.10.0\r\n *OS* *Name/Version:*  Sabayon Linux 20.03\r\n\r\nThe portage provider in Puppet confines to only operatingsystem gentoo, which won't work on distributions based on Gentoo.\r\n\r\n*Desired Behavior:*\r\n\r\nThe portage provider works on all Gentoo-family distributions.\r\n\r\n*Actual Behavior:*\r\n\r\n{{Error: /Package[net-misc/choria-bin]: Provider portage is not functional on this host}}","closed_at":"2020-05-29T01:19:49.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10469","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-05-29T01:19:49.000-0700","timestamp":1652286380.399193,"priority":"Normal","status_category":"Done","pull_request":8114},{"issue_id":"21361","title":"Remove ability to specify file checksum in `content` property","url":"https://tickets.puppetlabs.com/browse/PUP-1043","created_at":"2013-12-16T03:02:16.000-0800","number":"PUP-1043","body":"Using the source attribute to access static catalogs is the replacement for this use case (setting content => <md5 chucksum>), but you can still use magic {{content}} values. We have to remove this, but it needs to be on a major version boundary, probably Puppet 6.\r\n\r\nPlease ensure consistency with the deprecation warning provided to users:\r\n\r\nUsing a checksum in a file\\'s \"content\" property is deprecated. The ability to use a checksum to retrieve content from the filebucket using the \"content\" property will be removed in a future release. The literal value of the \"content\" property will be written to the file. Functionality is being replaced by the use of static catalogs. See [https://puppet.com/docs/puppet/latest/static_catalogs.html] for more information.\r\n\r\n—\r\n\r\nPrevious description:\r\n\r\nRather than passing around the contents of a file (e.g. in logs) we use the checksum; to support this the user is also allowed to _specify_ the contents as a checksum, but this leads to an ambiguity when the actual contents match the checksum pattern.","closed_at":"2020-06-10T23:26:32.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1043","labels":"redmine","state":"Ready for Engineering","updated_at":"2020-06-10T23:26:32.000-0700","timestamp":1652286386.595412,"priority":"Normal","status_category":"To Do","pull_request":8786},{"issue_id":"31124","title":"Not possible to manage SELinux file contexts via puppet in a sane way","url":"https://tickets.puppetlabs.com/browse/PUP-2169","created_at":"2014-04-07T06:40:28.000-0700","number":"PUP-2169","body":"There's currently no sane way to manage SELinux file contexts using puppet. The only way is to call 'semanage' via a 'exec' resource. But then the next issue comes up: Puppet seems to keep some file context rule cache, built once at startup. I wasn't able to find a way to invalidate this cache without restarting the whole puppet agent. Even when calling 'restorecon' from puppet, the next puppet run will reset file contexts for 'file' resources found in the catalog because of the cached file context rules. \r\n\r\n*How to reproduce:*\r\n{code:title=setest.pp|borderStyle=solid}\r\nfile { '/srv/setest-before':\r\n\tensure => directory,\r\n}\r\n-> exec { 'semanage':\r\n\tcommand =>  '/usr/sbin/semanage fcontext -a -t home_root_t /srv/setest[^/]*',\r\n\tcreates => '/srv/setest-after',\r\n}\r\n-> file { '/srv/setest-after':\r\n\tensure => directory,\r\n}\r\n{code}\r\n\r\n{code}\r\n# semanage fcontext -l | grep -c '^/srv/setest'\r\n0\r\n# puppet apply setest.pp\r\n{code}\r\n\r\n\r\n*Expected behavior:*\r\n/srv/setest-before created with default file context\r\n/srv/setest-after created according to new file context rule. \r\n\r\n*Seen behavior:*\r\nBoth directories are created with default file context.tUP21","closed_at":"2020-06-24T11:04:23.000-0700","comments":25,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2169","labels":"linux;resolved-issue-added;selinux","state":"Resolved","updated_at":"2020-06-24T11:04:23.000-0700","timestamp":1652286387.634048,"priority":"Normal","status_category":"Done","pull_request":7601},{"issue_id":"350662","title":"'puppet resource service' does not return all active services on Ubuntu","url":"https://tickets.puppetlabs.com/browse/PUP-10378","created_at":"2020-03-19T16:08:49.000-0700","number":"PUP-10378","body":"*Puppet Version: 6.14.0*\r\n *Puppet Server Version: whatever's in PE 2019.5.0*\r\n *OS Name/Version: Ubuntu 18.04.4*\r\n{code:java}\r\n$ puppet resource service pe-postgresql\r\nservice { 'pe-postgresql':\r\n  ensure   => 'running',\r\n  enable   => 'true',\r\n  provider => 'systemd',\r\n}\r\n$ puppet resource service | grep pe-postgresql\r\n$ {code}\r\n*Desired Behavior:*\r\n\r\npe-postgresql should be listed when listing all services, because it definitely exists.\r\n\r\n*Actual Behavior:*\r\n\r\nSeems to be omitted. Some related debugging\r\n{code:java}\r\nsystemctl list-unit-files --type service --full | grep pe-postgresql\r\npe-postgresql.service                  bad\r\npe-postgresql11.service                static\r\npe-postgresql96.service                static{code}\r\n ","closed_at":"2020-07-02T02:59:27.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10378","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-07-02T02:59:27.000-0700","timestamp":1652286388.66181,"priority":"Normal","status_category":"Done","pull_request":8089},{"issue_id":"356395","title":"Zypper provider doesn't recognize --no-gpg-checks as global option","url":"https://tickets.puppetlabs.com/browse/PUP-10433","created_at":"2020-04-22T10:37:24.000-0700","number":"PUP-10433","body":"*Puppet Version:* 5.5.19**\r\n\r\n*Desired Behavior:* When running the below code, it should recognize the following install option as a global option.\r\n\r\n \r\n{code:java}\r\npackage { $foo:\r\nensure => installed,\r\ninstall_options => ['--no-gpg-checks'],\r\n}{code}\r\n \r\n\r\n*Actual Behavior:*\r\n\r\nIt appends the option to the end of the zypper command, and errors out when read as a sub-command option.\r\n\r\n*Workaround:*\r\n\r\nUsing the --no-gpg-check variant (note the lack of an S at the end) is recognized as a global zypper option, relevant code [here|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/package/zypper.rb#L91]. This issue is closely related to PUP-4090.\r\n\r\nA note on discoverability: The Zypper help output and manual only lists the \"checks\" variant of the option.","closed_at":"2020-07-02T03:00:25.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10433","labels":"doc_reviewed;jira_escalated","state":"Resolved","updated_at":"2020-07-02T03:00:25.000-0700","timestamp":1652286388.762821,"priority":"Normal","status_category":"Done","pull_request":8134},{"issue_id":"356472","title":"Running remove_old_postgresql_versions after upgrade failed","url":"https://tickets.puppetlabs.com/browse/PUP-10437","created_at":"2020-04-23T04:29:30.000-0700","number":"PUP-10437","body":"On Ubuntu 18.04, I ran the upgrade to 2019.5 and saw in the output a suggestion to run {{puppet infrastructure run remove_old_postgresql_versions}}. When I did that I got\r\n{code:java}\r\nThis node does not appear to have PE Postgresql11 installed, this plan can only be run to remove old Postgresql data after upgrading to PE Postgresql11. {code}\r\nin task error output.\r\n\r\nWhen I checked, the system was running postgresql 11\r\n{code:java}\r\n$ ps -ef | grep postgres\r\npe-post+ 14416     1  0 22:21 ?        00:00:00 /opt/puppetlabs/server/apps/postgresql/11/bin/postgres -D /opt/puppetlabs/server/data/postgresql/11/data -c log_directory=/var/log/puppetlabs/postgresql/11 -p 5432 {code}\r\n \r\n\r\nI tracked this back to the task checking whether postgres 11 is being used and found the following odd behavior\r\n{code:java}\r\n$ puppet resource service pe-postgresql\r\nservice { 'pe-postgresql':\r\n  ensure   => 'running',\r\n  enable   => 'true',\r\n  provider => 'systemd',\r\n}\r\n$ puppet resource service | grep pe-postgresql\r\n$ {code}\r\nThe task checks whether the {{pe-postgresql11}} service exists, but puppet didn't show that service. This appears to be a bug in puppet (although it's also more efficient on some platforms to check whether a single service exists than to grep all of them).","closed_at":"2020-07-02T03:01:13.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10437","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-07-02T03:01:13.000-0700","timestamp":1652286388.863494,"priority":"Normal","status_category":"Done","pull_request":8112},{"issue_id":"354877","title":"Installer switch \"service-enable true\" reports wrong actions in certain conditions","url":"https://tickets.puppetlabs.com/browse/PUP-10479","created_at":"2020-04-08T11:29:01.000-0700","number":"PUP-10479","body":"When installing an agent on Ubuntu (any version) using switches to both enable and stop the puppet service, via\r\n{code:bash}curl -k https://<fqdnhere>:8140/packages/current/install.bash | bash -s -- --puppet-service-ensure stopped --puppet-service-enable true\r\n{code}\r\nThe output shows this:\r\n{code:java}Setting the puppet service to ensure=stopped and enable=true\r\nservice { 'puppet':\r\n  ensure => 'stopped',\r\n  enable => 'false',\r\n  provider => 'systemd',\r\n}{code}\r\nThe expected output, and the output on EL6/7/8, is this:\r\n{code:java}Setting the puppet service to ensure=stopped and enable=true\r\nservice { 'puppet':\r\n  ensure => 'stopped',\r\n  enable => 'true',\r\n  provider => 'systemd',\r\n}{code}\r\nThis issue is entirely cosmetic, the service does end up enabled. The issue is not present when the switch \"--puppet-service-enable true\" is used standalone.\r\n\r\n~* Please see Zendesk Support tab for further comments and attachments.~","closed_at":"2020-07-02T03:01:53.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10479","labels":"doc_reviewed;jira_escalated","state":"Resolved","updated_at":"2020-07-02T03:01:53.000-0700","timestamp":1652286388.967726,"priority":"Normal","status_category":"Done","pull_request":8126},{"issue_id":"357551","title":"pip package provider does not handle pip executable paths with spaces","url":"https://tickets.puppetlabs.com/browse/PUP-10485","created_at":"2020-05-01T13:20:13.000-0700","number":"PUP-10485","body":"*Puppet Version: 6.4.5 and 6.14.0*\r\n*OS Name/Version: Windows*\r\n\r\nOn a Windows Server 2016 node running Puppet 6.4.5 and 6.14.0 with Python installed in a path with spaces, the Puppet catalog returns the below error if package collection is enabled:\r\n\r\nCannot collect packages for Puppet::Type::Package::ProviderPip provider; [nil, nil]\r\n\r\nMore specifically, this issue was fixed in PUP-9647 for getting the pip version, but this was not fixed when Puppet executes the `pip freeze -all' command to get the packages. \r\n\r\n*Desired Behavior:*\r\n\r\nQuote function should be added to the pip provider here:\r\n[https://github.com/puppetlabs/puppet/blob/6.14.0/lib/puppet/provider/package/pip.rb#L79]\r\n\r\n \r\n\r\nRelevant sections of configurations files (puppet.conf, hiera.conf, Server's conf.d, defaults/sysconfig)\r\n\r\nFor memory issues with server heap dumps are also helpful.","closed_at":"2020-07-02T03:02:21.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10485","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-07-02T03:02:21.000-0700","timestamp":1652286389.069623,"priority":"Normal","status_category":"Done","pull_request":8133},{"issue_id":"173739","title":"regression - systemd provider does not honor documented enabled states","url":"https://tickets.puppetlabs.com/browse/PUP-7163","created_at":"2017-02-01T20:00:07.000-0800","number":"PUP-7163","body":"We found this bug again with puppet-agent 1.9.0\r\n\r\nFor CentOS:\r\npuppet-agent-1.9.0-1.el7.x86_64\r\n\r\nFor Ubuntu:\r\nii  puppet-agent                          1.9.0-1xenial                         amd64        The Puppet Agent package contains all of the elements needed to run puppet, including ruby, facter, hiera and mcollective.\r\n\r\nThe virtlockd/virtlogd services under systemd (both on Ubuntu and CentOS) are being marked as non-idempotent due to\r\n2017-02-02 03:38:31 +0000 /Stage[main]/Nova::Compute::Libvirt::Services/Service[virtlockd]/enable (notice): enable changed 'false' to 'true'\r\n2017-02-02 03:38:31 +0000 /Stage[main]/Nova::Compute::Libvirt::Services/Service[virtlogd]/enable (notice): enable changed 'false' to 'true'\r\n\r\nSee logs\r\nhttp://logs.openstack.org/38/393738/15/check/gate-puppet-openstack-integration-4-scenario002-tempest-ubuntu-xenial/55b4fbf/logs/puppet.txt.gz#_2017-02-02_03_38_31\r\nhttp://logs.openstack.org/38/393738/15/check/gate-puppet-openstack-integration-4-scenario001-tempest-centos-7/ea5b599/logs/puppet.txt.gz#_2017-02-02_03_43_59\r\n\r\n\r\nPrevious bug PUP-6370 was described as:\r\nThe systemd provider considers too many states as \"disabled\" and should probably just simply track the return value of \"is-enabled\" instead of capturing stdout and comparing it to a static list of knows states.  This has the added benefit of us not having to externally track new states added to systemd over time.\r\n\r\nThis issue was found in puppet-nova's CI where we found that the virtlockd and virtlogd services attempt to be enabled on every run; their \"is-enabled\" state is \"indirect\".\r\n","closed_at":"2020-07-02T03:03:23.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7163","labels":"doc_reviewed;linux;service;systemd;type_and_provider","state":"Resolved","updated_at":"2020-07-02T03:03:23.000-0700","timestamp":1652286389.174715,"priority":"Major","status_category":"Done","pull_request":8108},{"issue_id":"195934","title":"User resource expiry incorrect on SLES 11","url":"https://tickets.puppetlabs.com/browse/PUP-7663","created_at":"2017-06-14T10:35:30.000-0700","number":"PUP-7663","body":"Setting the user resource's expiry to `absent` in SLES 11 results in the expiry for the user to be `1970-01-01` instead of `never`. This is different from what is seen in CentOS 6/7, and results in users that are not able to authenticate. \r\n\r\n{code}\r\n# puppet resource user testuser ensure=present expiry=absent\r\nNotice: /User[testuser]/ensure: created\r\nuser { 'testuser':\r\n  ensure => 'present',\r\n  expiry => '1970-01-01',\r\n}\r\n# puppet resource user testuser ensure=present expiry=absent\r\nNotice: /User[testuser]/expiry: undefined 'expiry' from '1970-01-01'\r\nuser { 'testuser':\r\n  ensure => 'present',\r\n  expiry => '1970-01-01',\r\n}\r\n{code}\r\n","closed_at":"2020-07-02T03:03:43.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7663","labels":"doc_reviewed;platform-os;sles;type_and_provider;user","state":"Resolved","updated_at":"2020-07-02T03:03:43.000-0700","timestamp":1652286389.277168,"priority":"Normal","status_category":"Done","pull_request":8110},{"issue_id":"76574","title":"The error message associated with a file resource that requires a non-existent directory is misleading.","url":"https://tickets.puppetlabs.com/browse/PUP-4442","created_at":"2015-04-20T15:20:23.000-0700","number":"PUP-4442","body":"When managing a file, if you specify a location that requires an intermediate directory that is missing, and not managed by puppet, the error message is misleading. It implies that the issue is with the temp file created, rather than the missing directory itself. For example, when managing /etc/eyaml/config.yaml, /etc/eyaml does not exist:\r\n\r\nCatalog:\r\n{code}\r\n  file {'/etc/eyaml/config.yaml':\r\n    ensure => file,\r\n    content => template('eyaml/config.yaml.erb'),\r\n  }\r\n{code}\r\n{code}\r\nError:\r\nError: Could not set 'file' on ensure: No such file or directory - /etc/eyaml/config.yaml20150420-14321-me6waj.lock at 66:/etc/puppetlabs/puppet/environments/eyaml/dist/eyaml/manifests/init.pp\r\nError: Could not set 'file' on ensure: No such file or directory - /etc/eyaml/config.yaml20150420-14321-me6waj.lock at 66:/etc/puppetlabs/puppet/environments/eyaml/dist/eyaml/manifests/init.pp\r\nWrapped exception:\r\nNo such file or directory - /etc/eyaml/config.yaml20150420-14321-me6waj.lock\r\nError: /Stage[main]/Eyaml/File[/etc/eyaml/config.yaml]/ensure: change from absent to file failed: Could not set 'file' on ensure: No such file or directory - /etc/eyaml/config.yaml20150420-14321-me6waj.lock at 66:/etc/puppetlabs/puppet/environments/eyaml/dist/eyaml/manifests/init.pp\r\n{code}\r\n\r\nThe preference would be to generate an error that indicates that /etc/eyaml does not exist, or even a generic \"Parent directories for $file do not exist\"","closed_at":"2020-07-02T03:50:13.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4442","labels":"beginner;doc_reviewed","state":"Resolved","updated_at":"2020-07-02T03:50:13.000-0700","timestamp":1652286389.380712,"priority":"Normal","status_category":"Done","pull_request":8141},{"issue_id":"364176","title":"HTTP 406 Not Acceptable error message should contain format names","url":"https://tickets.puppetlabs.com/browse/PUP-10549","created_at":"2020-06-26T09:54:34.000-0700","number":"PUP-10549","body":"If the server can't generate a response in a mime type that the agent accepts, the server will emit an HTTP 406 Not Acceptable error, but the message includes the format objects instead of the names, leading to an unintelligible message on the agent:\r\n\r\n{noformat}\r\nWarning: Error 406 on SERVER: Not Acceptable: No supported formats are acceptable (Accept: [#<Puppet::Network::Format:0x7854686e @required_methods=[:render_method, :intern_method], @thename=:json, @confine_collection=#<Puppet::ConfineCollection:0x5c6ddb08 @confines=[], @label=\"Puppet::Network::Format[json]\">, @charset=#<Encoding:UTF-8>, @render_multiple_method=\"to_multiple_json\", @extension=\"json\", @intern_multiple_method=\"from_multiple_json\", @render_method=\"to_json\", @weight=15, @mime=\"application/json\", @intern_method=:from_data_hash, @options=nil>, #<Puppet::Network::Format:0x1393113d @required_methods=[:render_method, :intern_method], @thename=:pson, @confine_collection=#<Puppet::ConfineCollection:0x31d503f1 @confines=[], @label=\"Puppet::Network::Format[pson]\">, @charset=nil, @render_multiple_method=\"to_multiple_pson\", @extension=\"pson\", @intern_multiple_method=\"from_multiple_pson\", @render_method=\"to_pson\", @weight=10, @mime=\"text/pson\", @intern_method=:from_data_hash, @options=nil>])\r\n{noformat}","closed_at":"2020-07-07T03:21:44.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10549","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-07-07T03:21:44.000-0700","timestamp":1652286389.687655,"priority":"Normal","status_category":"Done","pull_request":8205},{"issue_id":"358908","title":"Sensitive data type is lost when declaring multiple resources using title arrays","url":"https://tickets.puppetlabs.com/browse/PUP-10511","created_at":"2020-05-14T12:03:34.000-0700","number":"PUP-10511","body":"*Puppet Version:* 6.15.0, 5.5.20\r\n*Puppet Server Version:* N/A\r\n*OS Name/Version:* N/A\r\n\r\nWhen multiple resources are declared using an array of titles, the type information for {{Sensitive}} parameters is lost. This results in type validation errors if a resource declares a data type such as {{Sensitive[String]}}\r\n\r\nInstall Puppet 6 on CentOS 7 and create a defined type with a password parameter declared to be {{Sensitive[String]}}:\r\n\r\n{code:bash}\r\nmkdir -p /etc/puppetlabs/code/environments/production/modules/test_mod/manifests\r\n\r\ncat <<'EOF' > /etc/puppetlabs/code/environments/production/modules/test_mod/manifests/service.pp\r\ndefine test_mod::service(\r\n  Sensitive[String] $password,\r\n){\r\n  notify{\"${title} ${password}\": }\r\n}\r\nEOF\r\n{code}\r\n\r\nAttempt to apply the following manifest:\r\n\r\n{code:puppet}\r\ntest_mod::service { [\"ServiceA\",\"ServiceB\"]:\r\n  password => Sensitive(\"password\")\r\n}\r\n{code}\r\n\r\n*Desired Behavior:*\r\n\r\nOutput matches individual resources declared in a loop:\r\n\r\n{noformat}\r\n# puppet apply <<'EOF'\r\neach([\"ServiceA\",\"ServiceB\"] ) |String $svc_name| {\r\n  test_mod::service { $svc_name:\r\n    password => Sensitive(\"password\")\r\n  }\r\n}\r\nEOF\r\n\r\nNotice: Compiled catalog for olde-pacemaker.delivery.puppetlabs.net in environment production in 0.02 seconds\r\nNotice: ServiceA Sensitive [value redacted]\r\nNotice: /Stage[main]/Main/Test_mod::Service[ServiceA]/Notify[ServiceA Sensitive [value redacted]]/message: defined 'message' as 'ServiceA Sensitive [value redacted]'\r\nNotice: ServiceB Sensitive [value redacted]\r\nNotice: /Stage[main]/Main/Test_mod::Service[ServiceB]/Notify[ServiceB Sensitive [value redacted]]/message: defined 'message' as 'ServiceB Sensitive [value redacted]'\r\nNotice: Applied catalog in 0.01 seconds\r\n{noformat}\r\n\r\n*Actual Behavior:*\r\n\r\nCompilation fails when defining the second resource as {{password}} has been coerced to a {{String}}:\r\n\r\n{noformat}\r\n# puppet apply <<'EOF'\r\ntest_mod::service { [\"ServiceA\",\"ServiceB\"]:\r\n  password => Sensitive(\"password\")\r\n}\r\nEOF\r\n\r\nError: Test_mod::Service[ServiceB]: parameter 'password' expects a Sensitive[String] value, got String on node olde-pacemaker.delivery.puppetlabs.net\r\n{noformat}","closed_at":"2020-07-07T03:29:38.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10511","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-07-07T03:29:38.000-0700","timestamp":1652286398.248347,"priority":"Normal","status_category":"Done","pull_request":8184},{"issue_id":"363206","title":"File sources whose path starts with double slashes are interpreted as a local file","url":"https://tickets.puppetlabs.com/browse/PUP-10544","created_at":"2020-06-17T12:13:27.000-0700","number":"PUP-10544","body":"Specifying a file source with an extra leading slash in the path causes puppet to think the source is a local file, and doesn't provide indications that that's what happened:\r\n\r\nCreate the following manifest on the server:\r\n{code:puppet}file { '/tmp/doubleslash':\r\n  ensure => file,\r\n  source => \"http://www.google.com//index.html\",\r\n}\r\n{code}\r\nThe agent run results in:\r\n{noformat}$ bx puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Caching catalog for localhost\r\nInfo: Applying configuration version '1592422524'\r\nError: /Stage[main]/Main/File[/tmp/doubleslash]: Could not evaluate: Could not retrieve information from environment production source(s) http://www.google.com//index.html\r\n{noformat}\r\nRunning with {{--http_debug}} shows that the HEAD request to google is never made.","closed_at":"2020-07-07T06:46:29.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10544","labels":"doc_reviewed","state":"Closed","updated_at":"2020-07-07T06:46:29.000-0700","timestamp":1652286398.352693,"priority":"Normal","status_category":"Done","pull_request":8200},{"issue_id":"363201","title":"Puppet agents can't download file content from puppetserver via \"raw\" https","url":"https://tickets.puppetlabs.com/browse/PUP-10543","created_at":"2020-06-17T11:41:30.000-0700","number":"PUP-10543","body":"Trying to download a file from puppetserver using as an {{https}} source instead of {{puppet://}} will fail because puppetserver does not allow HEAD requests. This is similar to PUP-6380. For example, given:\r\n\r\n{code:puppet}\r\nfile { '/tmp/ca.pem':\r\n  ensure => file,\r\n  source => \"https://${server_facts['servername']}:8140/puppet-ca/v1/certificate/ca?environment=production\",\r\n}\r\n{code}\r\n\r\nThe agent will fail:\r\n\r\n{noformat}\r\n$ puppet agent -t --http_debug\r\n...\r\n<- \"HEAD /puppet-ca/v1/certificate/ca?environment=production HTTP/1.1\\r\\nX-Puppet-Version: 6.17.0\\r\\nUser-Agent: Puppet/6.17.0 Ruby/2.5.7-p206 (x86_64-darwin18)\\r\\nAccept: */*\\r\\nHost: dusty-haulage.delivery.puppetlabs.net:8140\\r\\n\\r\\n\"\r\n-> \"HTTP/1.1 403 Forbidden\\r\\n\"\r\n-> \"Date: Wed, 17 Jun 2020 18:39:03 GMT\\r\\n\"\r\n-> \"X-Puppet-Version: 6.16.0\\r\\n\"\r\n-> \"Content-Length: 103\\r\\n\"\r\n-> \"\\r\\n\"\r\nConn end_transport\r\nConn keep-alive\r\nError: /Stage[main]/Main/File[/tmp/puppetserver]: Could not evaluate: Could not retrieve information from environment production source(s) https://dusty-haulage.delivery.puppetlabs.net:8140/puppet-ca/v1/certificate/ca?environment=production\r\n{noformat}\r\n\r\nOne possible solution is to sniff the response header and fallback to a partial GET request as is done for PUP-6380.","closed_at":"2020-07-07T06:47:22.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10543","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-07-07T06:47:22.000-0700","timestamp":1652286398.455178,"priority":"Normal","status_category":"Done","pull_request":8199},{"issue_id":"343627","title":"Ensure Windows wide character strings have a wide terminator","url":"https://tickets.puppetlabs.com/browse/PUP-10254","created_at":"2020-01-25T14:42:23.000-0800","number":"PUP-10254","body":"Prior to ruby 2.1.0, it was possible for multibyte strings to have only a single null terminator, followed by garbage which could cause buffer overruns. This was fixed in https://github.com/ruby/ruby/commit/1549894a0699abdfab1fbba0e468afd3f2f990b3, but never backported to 1.9.3.\r\n\r\nWe added code to puppet to protect against this. See https://github.com/puppetlabs/puppet/commit/cabd95cbd06ac3d834e0e401bcb07c2878a0b0f2 and https://github.com/puppetlabs/puppet/commit/b7c10f5d045af5890f83159b74ab5d5a23e0abc9\r\n\r\nHowever, puppet's {{from_string_to_wide_string}} copies the wide string from the ruby heap to the native heap using {{FFI::MemoryPointer#put_array_of_uchar}}. But it does not explicitly double null terminate the resulting wide string pointer. For example, here's a string of character length 1 and byte length 2.\r\n\r\n{noformat}\r\nirb(main):025:0> str = \"a\".encode(\"UTF-16LE\")\r\n=> \"a\"\r\nirb(main):026:0> str.bytes.length\r\n=> 2\r\nirb(main):027:0> str.length\r\n=> 1\r\n{noformat}\r\n\r\nWhen copying from the ruby heap to the native heap, we get a pointer to memory of length 2 bytes, which doesn't have room for the double null:\r\n\r\n{noformat}\r\nirb(main):028:0> ptr = FFI::MemoryPointer.new(:byte, str.bytes.length)\r\n=> #<FFI::MemoryPointer address=0x0000000003aea340 size=2>\r\nirb(main):029:0> ptr.total\r\n=> 2\r\n{noformat}\r\n\r\nThis hasn't been an issue because {{Puppet::Util::Windows::String.wide_string}} embeds a double null in the ruby string:\r\n\r\n{noformat}\r\nirb(main):030:0> str = Puppet::Util::Windows::String.wide_string(\"a\")\r\n=> \"a\\u0000\"\r\nirb(main):031:0> str.bytes.length\r\n=> 4\r\nirb(main):032:0> str.length\r\n=> 2\r\n{noformat}\r\n\r\nWe should always explicitly double null terminate the wide string in the native heap, so as to not rely on the ruby workaround.","closed_at":"2020-07-07T06:51:01.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10254","labels":"doc_reviewed","state":"Closed","updated_at":"2020-07-07T06:51:01.000-0700","timestamp":1652286398.660164,"priority":"Normal","status_category":"Done","pull_request":8224},{"issue_id":"160802","title":"Add support for username:password@domain for http/https sources","url":"https://tickets.puppetlabs.com/browse/PUP-6916","created_at":"2016-11-14T01:45:25.000-0800","number":"PUP-6916","body":"the following code:\r\n\r\n{code}\r\nfile { '/tmp/hello.txt':\r\nensure => file,\r\nsource => \"http://myuser:mypassword@hostwith.basic.auth.demo/hello.txt\",\r\n}\r\n{code}\r\n\r\ncurrently results to:\r\n\r\n{code}\r\n2016-11-14 09:41:32 +0000 /Stage[main]/Hello/File[/tmp/hello.txt] (err): Could not evaluate: Could not retrieve information from environment production source(s) http://myuser:mypassword@hostwith.basic.auth.demo/hello.txt\r\n{code}\r\n\r\nit would be great if this was supported in the product","closed_at":"2020-07-07T06:58:36.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6916","labels":"doc_reviewed;help_wanted;maintenance","state":"Resolved","updated_at":"2020-07-07T06:58:36.000-0700","timestamp":1652286398.865944,"priority":"Normal","status_category":"Done","pull_request":8201},{"issue_id":"135135","title":"HTTP file sources fail for GET-only URIs","url":"https://tickets.puppetlabs.com/browse/PUP-6380","created_at":"2016-06-02T11:21:05.000-0700","number":"PUP-6380","body":"URIs that only succeed on a GET cannot currently be used as file sources, as when retrieving file metadata, we use a HEAD request. The most notable of these URI types are Amazon S3 presigned URIs. These URIs contain a signatures with the HTTP method in them, which is usually GET for downloading. This causes them to return a 403 when responding to a HEAD request. If that occurs puppet will fallback to making a partial GET request using the Range header, so that it can retrieve the file checksum and determine if the local file needs to be updated, but do so without retrieving any file content.\r\n\r\nPull request with a fix is here: https://github.com/puppetlabs/puppet/pull/5002","closed_at":"2020-07-07T06:59:11.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6380","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-07-07T06:59:11.000-0700","timestamp":1652286398.971148,"priority":"Normal","status_category":"Done","pull_request":8197},{"issue_id":"365067","title":"ConnectionAdapter encodes the path and query whereas the Connection class didn't","url":"https://tickets.puppetlabs.com/browse/PUP-10580","created_at":"2020-07-06T13:56:05.000-0700","number":"PUP-10580","body":"A regression in 6.16.0 causes puppet to encode paths and queries when calling the legacy HTTP API {{Puppet::Network::HttpPool}}. To reproduce, given the following code:\r\n\r\n{code}\r\nrequire 'puppet'\r\nrequire 'puppet/network/http_pool'\r\n\r\nPuppet.initialize_settings(['--http_debug'])\r\nquery = URI.escape({ 'a' => 'b' }.to_json)\r\n\r\nhttp = Puppet::Network::HttpPool.http_instance('www.google.com', 80, false, false)\r\nhttp.get(\"/foo%20bar?q=#{query}\")\r\n{code}\r\n\r\nIn 6.16.0 it results in:\r\n\r\n{noformat}\r\n$ bx ruby http.rb\r\nopening connection to www.google.com:80...\r\nopened\r\nConn transport_request\r\nConn begin_transport\r\n<- \"GET /foo%2520bar?q=%257B%2522a%2522%3A%2522b%2522%257D HTTP/1.1\r\n{noformat}\r\n\r\nWhereas in 6.15.0:\r\n\r\n{noformat}\r\n$ bx ruby http.rb\r\nopening connection to www.google.com:80...\r\nopened\r\nConn transport_request\r\nConn begin_transport\r\n<- \"GET /foo%20bar?q=%7B%22a%22:%22b%22%7D HTTP/1.1\r\n{noformat}\r\n\r\nNote the different levels of encoding on the {{GET}} request line.\r\n\r\nThis issue was introduced in PUP-10289 when switching over to the {{ConnectionAdapter}}. See https://github.com/puppetlabs/puppet/pull/8166#commitcomment-40394792\r\n\r\n/cc [~vchepkov]","closed_at":"2020-07-07T11:51:31.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10580","labels":"","state":"Resolved","updated_at":"2020-07-07T11:51:31.000-0700","timestamp":1652286399.178135,"priority":"Normal","status_category":"Done","pull_request":8212},{"issue_id":"253150","title":"check_manage_home useradd provider needs to add -M on Debian","url":"https://tickets.puppetlabs.com/browse/PUP-8897","created_at":"2018-05-29T14:40:16.000-0700","number":"PUP-8897","body":"Regarding the code here:\r\n\r\n[https://github.com/puppetlabs/puppet/blob/1c77bfb8961587ddf5399cd4a70fc908cac6a6ec/lib/puppet/provider/user/useradd.rb#L127-L135]\r\n\r\nThere is an edge case that is missed. If force_local is true and manage_home is false, then \"-M\" should be added as a command line argument on Debian Jessie (and possibly others).\r\n\r\nIf this is not in place, a bug occurs as follows when running on Debian Jessie (and possibly others). First manually create `/home/bob` (like pam_mkhomedir might do) and then try to add `bob` with a resource like this, and it will fail:\r\n\r\n{code:puppet}\r\nuser { 'bob':\r\n\r\n  force_local => true,\r\n\r\n  manage_home => false,\r\n\r\n  ... Other Params ...\r\n\r\n}\r\n{code}","closed_at":"2020-07-08T06:08:42.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8897","labels":"doc_reviewed;platform-os","state":"Resolved","updated_at":"2020-07-08T06:08:42.000-0700","timestamp":1652286399.38286,"priority":"Normal","status_category":"Done","pull_request":8158},{"issue_id":"364693","title":"Puppet cannot apply a cached catalog containing binary rich data","url":"https://tickets.puppetlabs.com/browse/PUP-10572","created_at":"2020-06-30T16:52:07.000-0700","number":"PUP-10572","body":"If a cached catalog contains rich data (such as {{Binary}}) then puppet will fail to load the cached catalog and fallback to loading a new catalog. This doesn't happen with {{Sensitive}} because that data type is handled differently:\r\n\r\n{noformat}\r\nCached catalog for vernal-creator.delivery.puppetlabs.net failed: Could not parse JSON data for catalog vernal-creator.delivery.puppetlabs.net: Could not intern from rich_data_json: Internal Error: Puppet Context ':loaders' missing\r\n{noformat}\r\n\r\nTo reproduce, create the following resource:\r\n\r\n{code:puppet}\r\nnotify { 'message':\r\n  message => Binary.new('aGk=')\r\n}\r\n{code}\r\n\r\nNote {{aGk=}} is base64 for {{hi}}\r\n\r\nRun the agent once to cache the catalog:\r\n\r\n{noformat}\r\n[root@vernal-creator ~]# puppet agent --no-daemonize --onetime --verbose\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Caching catalog for vernal-creator.delivery.puppetlabs.net\r\nInfo: Applying configuration version '1593554072'\r\nNotice: hi\r\nNotice: /Stage[main]/Main/Notify[message]/message: defined 'message' as 'hi'\r\nNotice: Applied catalog in 0.01 seconds\r\n{noformat}\r\n\r\nRun it again, but this time force the agent to use a cached catalog:\r\n\r\n{noformat}\r\n[root@vernal-creator ~]# puppet agent --no-daemonize --onetime --use_cached_catalog --verbose --trace\r\nError: Cached catalog for vernal-creator.delivery.puppetlabs.net failed: Could not parse JSON data for catalog vernal-creator.delivery.puppetlabs.net: Could not intern from rich_data_json: Internal Error: Puppet Context ':loaders' missing\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loaders.rb:176:in `loaders'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/loaders.rb:89:in `find_loader'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/types/types.rb:319:in `create'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/serialization/from_data_converter.rb:216:in `pcore_type_hash_to_value'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/serialization/from_data_converter.rb:139:in `block in initialize'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/serialization/from_data_converter.rb:155:in `convert'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/serialization/from_data_converter.rb:157:in `block (3 levels) in convert'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/serialization/from_data_converter.rb:171:in `with'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/serialization/from_data_converter.rb:157:in `block (2 levels) in convert'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/serialization/from_data_converter.rb:157:in `each_pair'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/serialization/from_data_converter.rb:157:in `block in convert'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/serialization/from_data_converter.rb:179:in `with_value'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/serialization/from_data_converter.rb:195:in `build'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/serialization/from_data_converter.rb:157:in `convert'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/serialization/from_data_converter.rb:72:in `convert'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource.rb:55:in `initialize_from_hash'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource.rb:42:in `from_data_hash'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:437:in `block in from_data_hash'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:436:in `collect'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:436:in `from_data_hash'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/formats.rb:216:in `block in data_to_instance'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:62:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:314:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/formats.rb:214:in `data_to_instance'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/formats.rb:189:in `block in intern'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:62:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:314:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/formats.rb:188:in `intern'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/network/format_support.rb:12:in `convert_from'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/catalog/json.rb:11:in `from_json'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/json.rb:62:in `load_json_from_file'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/json.rb:10:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:265:in `find_in_cache'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:215:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:497:in `block in retrieve_catalog_from_cache'\r\n{noformat}\r\n\r\nSince the cached catalog fails, puppet will fallback to requesting a new catalog (though it defeats the purpose of using a cached catalog):\r\n\r\n{noformat}\r\n# continued from above\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Caching catalog for vernal-creator.delivery.puppetlabs.net\r\nInfo: Applying configuration version '1593554078'\r\nNotice: hi\r\nNotice: /Stage[main]/Main/Notify[message]/message: defined 'message' as 'hi'\r\nNotice: Applied catalog in 0.01 seconds\r\n{noformat}","closed_at":"2020-07-14T01:24:08.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10572","labels":"doc_reviewed;jira_escalated","state":"Resolved","updated_at":"2020-07-14T01:24:08.000-0700","timestamp":1652286401.348812,"priority":"Normal","status_category":"Done","pull_request":8208},{"issue_id":"228229","title":"Exceptions during transaction evaluate reported as success","url":"https://tickets.puppetlabs.com/browse/PUP-8288","created_at":"2017-12-21T15:42:35.000-0800","number":"PUP-8288","body":"Forked off of PUP-7630, to handle only the issue that overall success is reported when an exception is not caught inside transaction.evaluate.\r\n\r\nActually affects versions as far back as  pup 4.0.0-rc1.","closed_at":"2020-07-22T08:36:56.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8288","labels":"","state":"Closed","updated_at":"2020-07-22T08:36:56.000-0700","timestamp":1652286402.519222,"priority":"Major","status_category":"Done","pull_request":6502},{"issue_id":"101989","title":"Update filebucket manpage with how to manage puppetserver's filebucket","url":"https://tickets.puppetlabs.com/browse/PUP-5392","created_at":"2015-10-19T05:44:27.000-0700","number":"PUP-5392","body":"It seems configuration parameter {{bucketdir}} is not used in Puppet 4. \r\n\r\n{code}\r\n# /opt/puppetlabs/bin/puppet config print bucketdir \r\n/opt/puppetlabs/puppet/cache/bucket\r\n\r\n# ls /opt/puppetlabs/puppet/cache/bucket | wc -w \r\n0\r\n{code}\r\n\r\nInstead, buckets are held here, so setting is ignored:\r\n\r\n{code}\r\n# ls /opt/puppetlabs/server/data/puppetserver/bucket/ | wc -w \r\n16\r\n{code}\r\n\r\nHow does one get location of this directory from a puppet manifest? \r\n\r\nWhat is the configuration parameter for puppet server filebucket?","closed_at":"2020-07-24T21:39:53.000-0700","comments":19,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5392","labels":"","state":"Closed","updated_at":"2020-07-24T21:39:53.000-0700","timestamp":1652286402.838025,"priority":"Normal","status_category":"Done","pull_request":6521},{"issue_id":"352740","title":"Pip package provider outputs warning on puppet run","url":"https://tickets.puppetlabs.com/browse/PUP-10401","created_at":"2020-03-30T15:55:02.000-0700","number":"PUP-10401","body":"*Puppet Version:* 6.14.0.135.gaf1499b7 (but may have started happening in earlier builds)\r\n*Puppet Server Version:* N/A, but using latest PE master build (rc2-37)\r\n*OS Name/Version:* centos 6, sles 12, ubuntu 18.04\r\nWhen doing a puppet agent -t run, the following warnings are printed.\r\n{code}\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/package/pip.rb:18: warning: already initialized constant PIP_VERSION\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/package/pip.rb:18: warning: previous definition of PIP_VERSION was here\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/package/pip.rb:19: warning: already initialized constant PIP_VERSION_RANGE\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/package/pip.rb:19: warning: previous definition of PIP_VERSION_RANGE was here\r\n{code}\r\n\r\nThis doesn't cause any errors, but is printed on every run.\r\n\r\n","closed_at":"2020-07-29T09:38:22.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10401","labels":"doc_reviewed;jira_escalated","state":"Resolved","updated_at":"2020-07-29T09:38:22.000-0700","timestamp":1652286402.946275,"priority":"Normal","status_category":"Done","pull_request":8073},{"issue_id":"348520","title":"Puppet Agent fails to self-restart on config change or update","url":"https://tickets.puppetlabs.com/browse/PUP-10351","created_at":"2020-03-04T05:41:35.000-0800","number":"PUP-10351","body":"When the configuration of Puppet Agent changes, or when Puppet Agent is upgraded to a newer version, it gets completely stuck. The Puppet Agent essentially stops all operations. The following messages get logged:\r\n\r\n{noformat}\r\n$ systemctl status puppet\r\n● puppet.service - Puppet agent\r\n   Loaded: loaded (/usr/lib/systemd/system/puppet.service; enabled; vendor preset: disabled)\r\n   Active: active (running) since Tue 2020-03-03 18:46:45 CET; 19h ago\r\n Main PID: 11433 (puppet)\r\n   CGroup: /system.slice/puppet.service\r\n           └─11433 /opt/puppetlabs/puppet/bin/ruby /opt/puppetlabs/puppet/bin/puppet agent --no-daemonize\r\n\r\nMar 04 09:46:47 host.example.com puppet-agent[11433]: Shutdown/restart in progress (:restart_requested); skipping run\r\nMar 04 10:16:47 host.example.com puppet-agent[11433]: Shutdown/restart in progress (:restart_requested); skipping run\r\nMar 04 10:46:47 host.example.com puppet-agent[11433]: Shutdown/restart in progress (:restart_requested); skipping run\r\nMar 04 11:16:47 host.example.com puppet-agent[11433]: Shutdown/restart in progress (:restart_requested); skipping run\r\nMar 04 11:46:47 host.example.com puppet-agent[11433]: Shutdown/restart in progress (:restart_requested); skipping run\r\nMar 04 12:16:47 host.example.com puppet-agent[11433]: Shutdown/restart in progress (:restart_requested); skipping run\r\nMar 04 12:46:47 host.example.com puppet-agent[11433]: Shutdown/restart in progress (:restart_requested); skipping run\r\nMar 04 13:16:47 host.example.com puppet-agent[11433]: Shutdown/restart in progress (:restart_requested); skipping run\r\nMar 04 13:46:47 host.example.com puppet-agent[11433]: Shutdown/restart in progress (:restart_requested); skipping run\r\nMar 04 14:16:47 host.example.com puppet-agent[11433]: Shutdown/restart in progress (:restart_requested); skipping run\r\n{noformat}\r\n\r\nThe system log contains the following additional entries:\r\n\r\n{noformat}\r\nMar  3 18:50:35 host.example.com systemd: Reloading Puppet agent.\r\nMar  3 18:50:35 host.example.com systemd: Reloaded Puppet agent.\r\nMar  3 18:50:35 host.example.com puppet-agent[11433]: Caught HUP; storing restart\r\nMar  3 18:50:35 host.example.com puppet-agent[4047]: (/Stage[main]/Puppet::Agent::Service::Daemon/Service[puppet]) Triggered 'refresh' from 1 event\r\nMar  3 18:50:35 host.example.com puppet-agent[4047]: (/Stage[main]/Puppet::Agent::Service::Systemd/Service[puppet-run.timer]) Triggered 'refresh' from 1 event\r\nMar  3 18:50:35 host.example.com systemd: Reloading.\r\nMar  3 18:50:35 host.example.com puppet-agent[4047]: (/Stage[main]/Puppet::Agent::Service::Systemd/Exec[systemctl-daemon-reload-puppet]) Triggered 'refresh' from 1 event\r\nMar  3 18:50:36 host.example.com puppet-agent[4047]: Applied catalog in 256.53 seconds\r\nMar  3 18:50:38 host.example.com puppet-agent[11433]: Processing restart\r\nMar  3 18:50:38 host.example.com puppet-agent[11433]: Puppet::Agent::Locker.running? is deprecated as it is inherently unsafe. The only safe way to know if the lock is locked is to try lock and perform some action and then handle the LockError that may result.\r\nMar  3 18:50:38 host.example.com puppet-agent[11433]:   (location: /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/agent/locker.rb:37:in `running?')\r\nMar  3 18:50:47 host.example.com puppet-agent[11433]: Config file /etc/puppetlabs/puppet/puppet.conf changed; triggering re-parse of all config files.\r\nMar  3 19:16:47 host.example.com puppet-agent[11433]: Shutdown/restart in progress (:restart_requested); skipping run\r\n{noformat}\r\n\r\nThis was also reported on the [Puppet Users list|https://groups.google.com/forum/#!msg/puppet-users/sJ51uEpB3Sc/jL_5DInGAAAJ]. Several people confirmed this issue over there. In that thread [~josh] asked to create a JIRA ticket. I couldn't find an existing ticket.\r\n\r\nThis is a major issue, because it essentially breaks automation with Puppet. The Puppet Agent has to be manually restarted.","closed_at":"2020-08-10T23:39:32.000-0700","comments":17,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10351","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-08-10T23:39:32.000-0700","timestamp":1652286403.487179,"priority":"Major","status_category":"Done","pull_request":8147},{"issue_id":"351394","title":"URI.escape is obsolete in Ruby 2.7","url":"https://tickets.puppetlabs.com/browse/PUP-10391","created_at":"2020-03-27T05:05:12.000-0700","number":"PUP-10391","body":"After using puppet 5.5.10 in Ubuntu with Ruby 2.7 I got the warning below:\r\n\r\n/usr/lib/ruby/vendor_ruby/puppet/util.rb:461: warning: URI.escape is obsolete\r\n\r\n \r\n\r\nI also checked if it was fixed in the master branch but it doesn't:\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/master/lib/puppet/util.rb#L463\r\n\r\n ","closed_at":"2020-08-11T02:11:03.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10391","labels":"platform_7","state":"Resolved","updated_at":"2020-08-11T02:11:03.000-0700","timestamp":1652286403.911866,"priority":"Normal","status_category":"Done","pull_request":8175},{"issue_id":"302978","title":"puppet 6 apply fails if puppet types have been generated","url":"https://tickets.puppetlabs.com/browse/PUP-9602","created_at":"2019-04-03T05:33:26.000-0700","number":"PUP-9602","body":"*Puppet Version:*\r\n6.4.0\r\n*Puppetserver Version*\r\n6.3.0\r\n*OS Name/Version:*\r\nCentOS 7.5\r\n\r\nStumbled upon an unusual behavior in Puppet 6 (works as expected on Puppet 5)\r\n\r\nIf command puppet generate types has been executed, puppet apply fails.\r\nPuppet agent works normally.\r\n\r\n{noformat}\r\n[root@master ~]# puppet apply -e 'include bootstrap::master'\r\nNotice: Compiled catalog for master.localdomain in environment production in 0.81 seconds\r\nNotice: Applied catalog in 0.89 seconds\r\n\r\n[root@master ~]# puppet generate types\r\nNotice: Generating Puppet resource types.\r\nWarning: The a2mod provider is deprecated, please use apache::mod instead\r\nNotice: Generating '/etc/puppetlabs/code/environments/production/.resource_types/a2mod.pp' using 'pcore' format.\r\nNotice: Generating '/etc/puppetlabs/code/environments/production/.resource_types/concat_file.pp' using 'pcore' format.\r\nNotice: Generating '/etc/puppetlabs/code/environments/production/.resource_types/concat_fragment.pp' using 'pcore' format.\r\nNotice: Generating '/etc/puppetlabs/code/environments/production/.resource_types/git_config.pp' using 'pcore' format.\r\nNotice: Generating '/etc/puppetlabs/code/environments/production/.resource_types/ini_setting.pp' using 'pcore' format.\r\nNotice: Generating '/etc/puppetlabs/code/environments/production/.resource_types/ini_subsetting.pp' using 'pcore' format.\r\nNotice: Generating '/etc/puppetlabs/code/environments/production/.resource_types/postgresql_conf.pp' using 'pcore' format.\r\nNotice: Generating '/etc/puppetlabs/code/environments/production/.resource_types/postgresql_conn_validator.pp' using 'pcore' format.\r\nNotice: Generating '/etc/puppetlabs/code/environments/production/.resource_types/postgresql_psql.pp' using 'pcore' format.\r\nNotice: Generating '/etc/puppetlabs/code/environments/production/.resource_types/postgresql_replication_slot.pp' using 'pcore' format.\r\nNotice: Generating '/etc/puppetlabs/code/environments/production/.resource_types/puppetdb_conn_validator.pp' using 'pcore' format.\r\nNotice: Generating '/etc/puppetlabs/code/environments/production/.resource_types/anchor.pp' using 'pcore' format.\r\nNotice: Generating '/etc/puppetlabs/code/environments/production/.resource_types/file_line.pp' using 'pcore' format.\r\nNotice: Generating '/etc/puppetlabs/code/environments/production/.resource_types/vcsrepo.pp' using 'pcore' format.\r\n\r\n[root@master ~]# puppet apply -e 'include bootstrap::master'\r\nNotice: Compiled catalog for master.localdomain in environment production in 0.75 seconds\r\nError: Could not autoload puppet/type/anchor: Attempt to redefine entity 'http://puppet.com/2016.1/runtime/type/anchor'. Set at unknown location\r\nError: Could not autoload puppet/type/anchor: Attempt to redefine entity 'http://puppet.com/2016.1/runtime/type/anchor'. Set at unknown location\r\n\r\n{noformat}\r\n\r\n\r\n","closed_at":"2020-08-13T06:48:43.000-0700","comments":37,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9602","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-08-13T06:48:43.000-0700","timestamp":1652286404.986332,"priority":"Normal","status_category":"Done","pull_request":8215},{"issue_id":"368742","title":"Add facts and vars back to PAL ScriptCompiler scope","url":"https://tickets.puppetlabs.com/browse/PUP-10615","created_at":"2020-08-10T13:57:15.000-0700","number":"PUP-10615","body":"*Puppet Version: 6.15.0 - 6.17.0*\r\n\r\nAs part of work on Bolt, PUP-10397 removed vars and facts for the current node from PAL's script compiler. This resulted in a breaking change to a public API, affecting downstream projects that rely on PAL. The script compiler should make the current node's vars and facts available again.\r\n\r\n*Desired Behavior:*\r\n\r\n**PAL's script compiler should have access to vars and facts for the node running the script.\r\n\r\n*Actual Behavior:*\r\n\r\nPAL's script compiler does not have access to the vars and facts for the node running the script, causing project's that rely on the PAL API to lose access to this data.","closed_at":"2020-08-20T01:56:12.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10615","labels":"docs-reviewed","state":"Resolved","updated_at":"2020-08-20T01:56:12.000-0700","timestamp":1652286405.619705,"priority":"Normal","status_category":"Done","pull_request":8268},{"issue_id":"35962","title":"An error is logged during an agent run if the puppetmaster does not have at least one <module>/lib dir in its modules directory.","url":"https://tickets.puppetlabs.com/browse/PUP-2608","created_at":"2014-05-16T15:33:27.000-0700","number":"PUP-2608","body":"To reproduce:\r\n\r\n(Make sure you have a '127.0.0.1       localhost puppetmaster' entry in /etc/hosts for the below)\r\n\r\nIn one terminal setup the master:\r\n\r\n{noformat}\r\n    jpartlow@percival:~/work/puppet$ rm -rf ~/test/master/bug-test\r\n    jpartlow@percival:~/work/puppet$ mkdir -p ~/test/master/bug-test\r\n    jpartlow@percival:~/work/puppet$ bundle exec puppet master --no-daemonize --trace --autosign=true --debug --confdir=~/test/master/bug-test --vardir=~/test/master/bug-test --certname puppetmaster\r\n{noformat}\r\n\r\nIn another terminal, run the agent:\r\n\r\n{noformat}\r\n    jpartlow@percival:~/work/puppet$ be puppet agent -t --server puppetmaster\r\n    Info: Creating a new SSL key for percival.corp.puppetlabs.net\r\n    Info: Caching certificate for ca\r\n    Info: Creating a new SSL certificate request for percival.corp.puppetlabs.net\r\n    Info: Certificate Request fingerprint (SHA256): 20:18:5A:F0:3B:A0:BE:76:6B:03:71:ED:BD:EF:47:04:F1:49:3F:BD:63:AC:42:3D:7E:0F:66:3F:08:F9:70:C9\r\n    Info: Caching certificate for percival.corp.puppetlabs.net\r\n    Info: Caching certificate_revocation_list for ca\r\n    Info: Retrieving plugin\r\n    Error: /File[/home/jpartlow/.puppet/var/lib]: Could not evaluate: Could not retrieve information from environment production source(s) puppet://puppetmaster/plugins\r\n    Info: Caching catalog for percival.corp.puppetlabs.net\r\n    Info: Applying configuration version '1374537817'\r\n    Info: Creating state file /home/jpartlow/.puppet/var/state/state.yaml\r\n{noformat}","closed_at":"2020-08-20T02:06:45.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2608","labels":"doc_reviewed;redmine","state":"Resolved","updated_at":"2020-08-20T02:06:45.000-0700","timestamp":1652286405.831716,"priority":"Normal","status_category":"Done","pull_request":8218},{"issue_id":"366012","title":"Puppet::Util::Yaml safe_load not loading \"Time\" class which leads to compilation error for time serial data","url":"https://tickets.puppetlabs.com/browse/PUP-10585","created_at":"2020-07-14T20:46:35.000-0700","number":"PUP-10585","body":"*Puppet Version: 6.16.0*\r\n\r\n*Puppet Server Version: PE 2019.8*\r\n *OS Name/Version: RHEL*\r\n\r\nCustomer is using `audit -> mtime` in a file resource. When the time is saved into transactionstore.yaml. The next puppet agent run will fail with the following error:\r\n{code:java}\r\nError: Transaction store file /opt/puppetlabs/puppet/cache/state/transactionstore.yaml is corrupt ((/opt/puppetlabs/puppet/cache/state/transactionstore.yaml): Tried to load unspecified class: Time); replacing\r\nWrapped exception:\r\nTried to load unspecified class: Time {code}\r\nThis should be because Puppet::Util::Yaml is using safe_load now and by default \"Time\" class is not permitted to load.\r\n\r\n*Desired Behavior:* Understand that there should be some security concerns to contain only few classes by default. The Puppet::Util::Yaml has a parameter called 'allowed_classes'. Thus, an option to configure 'allowed_classes' from Puppet (for example) Hiera is expected. Otherwise, as long as there are needs such as auditing time from this case, the Classes out of the list will trigger the same error message.\r\n\r\n*Actual Behavior:* \r\n\r\nError: Transaction store file /opt/puppetlabs/puppet/cache/state/transactionstore.yaml is corrupt ((/opt/puppetlabs/puppet/cache/state/transactionstore.yaml): Tried to load unspecified class: Time); replacing\r\nWrapped exception:\r\nTried to load unspecified class: Time\r\n\r\n*How to Reproduce:*\r\n\r\nDefine a file resource in manifest:\r\n{code:java}\r\nfile { $file_path :\r\naudit => mtime,\r\n} {code}\r\n(1) Touch the file.\r\n\r\n(2) edited the file once. \r\n\r\n(3) Run puppet agent -t, can see successful logging the time.\r\n{code:java}\r\nInfo: Loading facts\r\nInfo: Caching catalog for pe-201980-agent.platform9.puppet.net\r\nInfo: Applying configuration version 'pe-201980-master-production-6e5f8c73c43'\r\nNotice: /Stage[main]/Ggtest::Selva/File[/tmp/text.abc]/mtime: audit change: previously recorded value '2020-07-15 03:11:23 +0000' has been changed to '2020-07-15 03:43:48 +0000'\r\nNotice: Applied catalog in 0.12 seconds\r\n[root@pe-201980-agent ~]# {code}\r\nMeanwhile, the content of /opt/puppetlabs/puppet/cache/state/transactionstore.yaml managed to store that data.\r\n{code:java}\r\n---\r\nresources:\r\n  File[/tmp/text.abc]:\r\n    parameters:\r\n      mtime:\r\n        system_value:\r\n        - 2020-07-15 03:43:48.772919060 +00:00\r\n      ensure:\r\n        system_value: {code}\r\n(4) run puppet agent once more with the following error of unable to load Time class:\r\n{code:java}\r\nInfo: Retrieving locales\r\nInfo: Loading facts\r\nInfo: Caching catalog for pe-201980-agent.platform9.puppet.net\r\nError: Transaction store file /opt/puppetlabs/puppet/cache/state/transactionstore.yaml is corrupt ((/opt/puppetlabs/puppet/cache/state/transactionstore.yaml): Tried to load unspecified class: Time); replacing\r\nWrapped exception:\r\nTried to load unspecified class: Time\r\nInfo: Applying configuration version 'pe-201980-master-production-6e5f8c73c43'\r\nNotice: Applied catalog in 0.07 seconds\r\n[root@pe-201980-agent ~]# {code}\r\n \r\n\r\n ","closed_at":"2020-08-20T10:12:42.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10585","labels":"doc_reviewed;jira_escalated","state":"Resolved","updated_at":"2020-08-20T10:12:42.000-0700","timestamp":1652286406.045617,"priority":"High","status_category":"Done","pull_request":8225},{"issue_id":"366100","title":"Regression: Puppet::Util.default_env method removed in 5.5.21 and 6.17.0","url":"https://tickets.puppetlabs.com/browse/PUP-10586","created_at":"2020-07-15T10:15:28.000-0700","number":"PUP-10586","body":"Commit https://github.com/puppetlabs/puppet/commit/94df3c1a3992d89b2d7d5db8a70373c135bdd86b unintentionally removed the {{Puppet::Util.default_env}} method in 5.5.21 and 6.17.0, causing the following error when testing puppet modules using rspec-puppet:\r\n\r\n{noformat}\r\n Failure/Error: require 'puppetlabs_spec_helper/module_spec_helper'\r\n NameError:\r\n   undefined local variable or method `default_env' for Puppet::Util:Module\r\n # ./vendor/bundle/ruby/2.5.0/gems/rspec-puppet-2.7.8/lib/rspec-puppet/monkey_patches.rb:139:in `get_env'\r\n # ./vendor/bundle/ruby/2.5.0/gems/puppet-6.17.0/lib/puppet/node/environment.rb:501:in `extralibs'\r\n # ./vendor/bundle/ruby/2.5.0/gems/puppet-6.17.0/lib/puppet/node/environment.rb:76:in `initialize'\r\n # ./vendor/bundle/ruby/2.5.0/gems/puppet-6.17.0/lib/puppet/node/environment.rb:43:in `new'\r\n # ./vendor/bundle/ruby/2.5.0/gems/puppet-6.17.0/lib/puppet/node/environment.rb:43:in `create'\r\n # ./vendor/bundle/ruby/2.5.0/gems/puppet-6.17.0/lib/puppet.rb:240:in `base_context'\r\n # ./vendor/bundle/ruby/2.5.0/gems/puppet-6.17.0/lib/puppet/test/test_helper.rb:53:in `initialize'\r\n # ./vendor/bundle/ruby/2.5.0/gems/rspec-puppet-2.7.8/lib/rspec-puppet.rb:77:in `block in <top (required)>'\r\n # ./vendor/bundle/ruby/2.5.0/gems/rspec-puppet-2.7.8/lib/rspec-puppet.rb:34:in `<top (required)>'\r\n # ./vendor/bundle/ruby/2.5.0/gems/puppetlabs_spec_helper-2.15.0/lib/puppetlabs_spec_helper/module_spec_helper.rb:1:in `require'\r\n # ./vendor/bundle/ruby/2.5.0/gems/puppetlabs_spec_helper-2.15.0/lib/puppetlabs_spec_helper/module_spec_helper.rb:1:in `<top (required)>'\r\n # ./spec/spec_helper.rb:7:in `require'\r\n # ./spec/spec_helper.rb:7:in `<top (required)>'\r\n{noformat}\r\n\r\nSee also https://github.com/rodjek/rspec-puppet/issues/796.\r\n ","closed_at":"2020-08-20T11:00:21.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10586","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-08-20T11:00:21.000-0700","timestamp":1652286406.152538,"priority":"Normal","status_category":"Done","pull_request":8224},{"issue_id":"367500","title":"File Resource HTTP GET - Misuse of URL encoding","url":"https://tickets.puppetlabs.com/browse/PUP-10603","created_at":"2020-07-28T13:53:31.000-0700","number":"PUP-10603","body":"*Puppet Version: 6.16.0*\r\n *Puppet Server Version: 6.*\r\n *OS Name/Version: Win10x64 WinServer2012R2*\r\n\r\nAfter upgrading from agent 6.13.0 URL's that are pre-encoded are being re-encoded during the HTTP GET phase of file resource execution. The header HEAD phase is working as expected. This was not occurring in agent 6.13.0 but occurs in 6.16 and 6.15 versions of the agent\r\n\r\nWhen attempting to remove the encoding the HTTP HEAD uses the correct url unencoded, but when the GET goes to encode, it for some reason drops the trailing '=' (in fact no '=' are encoded at all) which is found in all Azure SAS tokens and storage keys.\r\n\r\nWe store sensitive files in Azure private blob containers, and utilize a SAS token who's sensitive data is looked up via a hiera eyaml and appended to the https:// endpoint of the url as the file \"source\" parameter\r\n\r\n*Desired Behavior:*\r\n\r\nIf already encoded the file resource should not re-encode during the GET phase\r\n\r\nIf not encoded, the GET phase should encode the request but not drop the trailing '='.\r\n\r\n*Actual Behavior:*\r\n\r\nDummy file resource being run in debug when specifying with the encoded section of the SAS token appended to the http request:\r\n{code:java}\r\nDebug: Using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384\r\nDebug: HTTP HEAD https://anystorageaccount.blob.core.windows.net/puppet/test/test.txt?sv=2019-02-02&st=2020-07-28T20%3A18%3A53Z&se=2020-07-28T20%3A38%3A00Z&sr=b&sp=r&sig=xkd9E0xReTZ18zc1Woa1rQmhAwcaYYJRHZcac5yczQ8%3D returned 200 OK\r\nDebug: Caching connection for https://anystorageaccount.blob.core.windows.net:443\r\nDebug: Using cached connection for https://anystorageaccount.blob.core.windows.net:443\r\nDebug: HTTP GET https://anystorageaccount.blob.core.windows.net/puppet/test/test.txt?sv=2019-02-02&st=2020-07-28T20%253A18%253A53Z&se=2020-07-28T20%253A38%253A00Z&sr=b&sp=r&sig=xkd9E0xReTZ18zc1Woa1rQmhAwcaYYJRHZcac5yczQ8%253D returned 403 Server failed to authenticate the request. Make sure the value of Authorization header is formed correctly including the signature.\r\nDebug: Closing connection for https://anystorageaccount.blob.core.windows.net:443\r\nError: Could not set 'file' on ensure: Error 403 on SERVER: ´╗┐<?xml version=\"1.0\" encoding=\"utf-8\"?><Error><Code>AuthenticationFailed</Code><Message>Server failed to authenticate the request. Make sure the value of Authorization header is formed correctly including the signature.\r\nRequestId:ce4f9ec1-501e-0114-7f1e-65a9cd000000\r\nTime:2020-07-28T20:34:34.9632157Z</Message><AuthenticationErrorDetail>Signature fields not well formed.\r\n{code}\r\nsame file resource, with the token portion of the string unencoded. The final '=' of the string is stripped off during the GET\r\n{code:java}\r\nDebug: Using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384\r\nDebug: HTTP HEAD https://anystorageaccount.blob.core.windows.net/puppet/test/test.txt?sv=2019-02-02&st=2020-07-28T20:18:53Z&se=2020-07-28T21:03:00Z&sr=b&sp=r&sig=JaZhcqxT4akJcOwUdUGrQB2m1geUoh89iL8WMag8a8c= returned 200 OK\r\nDebug: Caching connection for https://anystorageaccount.blob.core.windows.net:443\r\nDebug: Using cached connection for https://anystorageaccount.blob.core.windows.net:443\r\nDebug: HTTP GET https://anystorageaccount.blob.core.windows.net/puppet/test/test.txt?sv=2019-02-02&st=2020-07-28T20%3A18%3A53Z&se=2020-07-28T21%3A03%3A00Z&sr=b&sp=r&sig=JaZhcqxT4akJcOwUdUGrQB2m1geUoh89iL8WMag8a8c returned 403 Server failed to authenticate the request. Make sure the value of Authorization header is formed correctly including the signature.\r\nDebug: Closing connection for https://anystorageaccount.blob.core.windows.net:443\r\nError: Could not set 'file' on ensure: Error 403 on SERVER: ´╗┐<?xml version=\"1.0\" encoding=\"utf-8\"?><Error><Code>AuthenticationFailed</Code><Message>Server failed to authenticate the request. Make sure the value of Authorization header is formed correctly including the signature.\r\nRequestId:1a6c4010-101e-003e-7920-659add000000\r\nTime:2020-07-28T20:46:22.0326377Z</Message><AuthenticationErrorDetail>Signature fields not well formed.\r\n{code}\r\nWe noticed that puppet 6.15.0 introduced many changes to the file http resource according to the documentation.\r\n\r\n ","closed_at":"2020-08-24T09:46:52.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10603","labels":"docs-reviewed","state":"Resolved","updated_at":"2020-08-24T09:46:52.000-0700","timestamp":1652286406.901,"priority":"High","status_category":"Done","pull_request":8260},{"issue_id":"367445","title":"Puppet_Agent : Constant Corrective Change for sles 12","url":"https://tickets.puppetlabs.com/browse/PUP-10609","created_at":"2020-07-28T06:58:37.000-0700","number":"PUP-10609","body":"_Basic Info_\r\n *Module Version:4.0.0*\r\n *Puppet Version:2019.8.0*\r\n *OS Name/Version:SLES 12*\r\n\r\n_When using the puppet_agent modules package_version to auto_ \r\n\r\n*Desired Behavior: Once correct version is installed, should not see any corrective changes.*\r\n\r\n*Actual Behavior: Seeing corrective change every puppet run*\r\n{code:java}\"Notice: /Stage[main]/Puppet_agent::Install/Package[puppet-agent]/ensure: ensure changed '6.16.0-1.sles12' to '6.16.0' (corrective)\"\r\n{code}\r\nAlso tested against centos and it did not have this issue, seems specific to sles.\r\n\r\nThis was also tested on PE 2019.5.0 with puppet_agent v4.0.0 without this issue.","closed_at":"2020-08-27T05:11:47.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10609","labels":"docs_reviewed;jira_escalated","state":"Resolved","updated_at":"2020-08-27T05:11:47.000-0700","timestamp":1652286407.531334,"priority":"Normal","status_category":"Done","pull_request":8252},{"issue_id":"145220","title":"The environment cache erroneously binds topscope and compilation gets values from \"first compilation after restart\"","url":"https://tickets.puppetlabs.com/browse/PUP-6582","created_at":"2016-08-04T11:56:42.000-0700","number":"PUP-6582","body":"There's a fairly detailed reproducible test case with more details [here|https://github.com/thrnio/function-cache-bug].\r\n\r\nIn short, the resultant value of a function defined in the Puppet language which does not reference any Ruby code will be cached when {{environment_timeout}} is set to {{unlimited}}. This cache is generated separately based on parameters passed to the function, but it is shared between runs and between nodes. This causes a problem when the function refers to fact values, because if a fact value used by the function changed between runs or between nodes, the result of the function may not be accurate.\r\n\r\nThis behavior does not occur if the function calls a Ruby function. It also does not occur if {{environment_timeout}} is set to {{0}}.\r\n\r\nIf the expected use of functions defined in the Puppet language is to only ever reference data that is passed in directly via variables, then the scoping should reflect that by not making any top-scope variables available within a function, although this would make functions different than every other construct in Puppet, so I don't think that would be a good resolution. Better is to stop this result caching behavior from occurring.\r\n\r\nThis occurs at least in Puppet Server 2.4.0 on CentOS 7, both FOSS and PE builds. I have not tested this in other versions or under other conditions.","closed_at":"2020-09-04T12:16:38.000-0700","comments":21,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6582","labels":"","state":"Closed","updated_at":"2020-09-04T12:16:38.000-0700","timestamp":1652286408.068092,"priority":"Critical","status_category":"Done","pull_request":5221},{"issue_id":"27200","title":"Puppet run continues despite failed Pluginsync","url":"https://tickets.puppetlabs.com/browse/PUP-1763","created_at":"2014-02-24T20:54:47.000-0800","number":"PUP-1763","body":"A puppet run that has enough custom types/providers/facts to sync to a local system that it exceeds configtimeout (default 2m), should not continue to perform a puppet run, but rather completely fail. This would be the only way to meet the expectation that pluginsync ensures certain types/providers/facts are available before a module's code runs.\r\n\r\nIf a puppetrun can continue despite failing to download plugins or custom facts, the proper operation of puppet modules cannot be guaranteed (without sanity checks in the puppet code). Also, it becomes impossible to base a Hiera hierarchy off of a custom fact because the first run would fail to pull in the expected Hiera data.","closed_at":"2020-09-15T02:13:53.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1763","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-09-15T02:13:53.000-0700","timestamp":1652286418.117095,"priority":"Normal","status_category":"Done","pull_request":8226},{"issue_id":"25794","title":"put warn/error for attempt to instantiate virtual class under --strict control","url":"https://tickets.puppetlabs.com/browse/PUP-1606","created_at":"2014-02-06T18:38:01.000-0800","number":"PUP-1606","body":"Declaring a virtual class should not instantiate it without being realized.  This worked in puppet 2.6.1 but is broken in 2.6.7.  I also tried it in 2.7.9 and it still seems to be broken.  The code below is a very simple example.  vclass and the notify should not happen because it is not realized.\r\n\r\n{code}\r\nclass vclass {\r\n    notify {\"vclass\":\r\n        message => \"I've been realized\"\r\n    }\r\n}\r\n\r\nclass iclass {\r\n    @class {\"vclass\": }\r\n}\r\n\r\nclass {\"iclass\":}\r\n{code}\r\n\r\nPuppet 2.7.9 output:\r\n{code}\r\npuppet apply --debug iclass.pp\r\ndebug: importing '/root/iclass.pp' in environment production\r\ndebug: Creating default schedules\r\ndebug: Failed to load library 'selinux' for feature 'selinux'\r\ndebug: Failed to load library 'shadow' for feature 'libshadow'\r\ndebug: Puppet::Type::User::ProviderDirectoryservice: file /usr/bin/dscl does not exist\r\ndebug: Puppet::Type::User::ProviderUser_role_add: file roleadd does not exist\r\ndebug: Failed to load library 'ldap' for feature 'ldap'\r\ndebug: Puppet::Type::User::ProviderLdap: feature ldap is missing\r\ndebug: Puppet::Type::User::ProviderPw: file pw does not exist\r\ndebug: /File[/etc/puppet/ssl/public_keys]: Autorequiring File[/etc/puppet/ssl]\r\ndebug: /File[/etc/puppet/ssl/certificate_requests]: Autorequiring File[/etc/puppet/ssl]\r\ndebug: /File[/var/lib/puppet/state/state.yaml]: Autorequiring File[/var/lib/puppet/state]\r\ndebug: /File[/var/lib/puppet/clientbucket]: Autorequiring File[/var/lib/puppet]\r\ndebug: /File[/var/lib/puppet/state/last_run_report.yaml]: Autorequiring File[/var/lib/puppet/state]\r\ndebug: /File[/var/lib/puppet/run]: Autorequiring File[/var/lib/puppet]\r\ndebug: /File[/etc/puppet/ssl/private_keys]: Autorequiring File[/etc/puppet/ssl]\r\ndebug: /File[/var/lib/puppet/state/graphs]: Autorequiring File[/var/lib/puppet/state]\r\ndebug: /File[/var/lib/puppet/client_data]: Autorequiring File[/var/lib/puppet]\r\ndebug: /File[/var/lib/puppet/log]: Autorequiring File[/var/lib/puppet]\r\ndebug: /File[/etc/puppet/ssl]: Autorequiring File[/etc/puppet]\r\ndebug: /File[/etc/puppet/ssl/private]: Autorequiring File[/etc/puppet/ssl]\r\ndebug: /File[/var/lib/puppet/lib]: Autorequiring File[/var/lib/puppet]\r\ndebug: /File[/var/lib/puppet/facts]: Autorequiring File[/var/lib/puppet]\r\ndebug: /File[/var/lib/puppet/state]: Autorequiring File[/var/lib/puppet]\r\ndebug: /File[/var/lib/puppet/state/last_run_summary.yaml]: Autorequiring File[/var/lib/puppet/state]\r\ndebug: /File[/var/lib/puppet/client_yaml]: Autorequiring File[/var/lib/puppet]\r\ndebug: /File[/etc/puppet/ssl/certs]: Autorequiring File[/etc/puppet/ssl]\r\ndebug: Finishing transaction 23948234472800\r\ndebug: Loaded state in 0.00 seconds\r\ndebug: Loaded state in 0.00 seconds\r\ninfo: Applying configuration version '1327691293'\r\ndebug: /Schedule[daily]: Skipping device resources because running on a host\r\ndebug: /Schedule[monthly]: Skipping device resources because running on a host\r\nnotice: I've been realized\r\nnotice: /Notify[vclass]/message: defined 'message' as 'I've been realized'\r\ndebug: /Schedule[hourly]: Skipping device resources because running on a host\r\ndebug: /Schedule[never]: Skipping device resources because running on a host\r\ndebug: /Schedule[weekly]: Skipping device resources because running on a host\r\ndebug: /Schedule[puppet]: Skipping device resources because running on a host\r\ndebug: Finishing transaction 23948233321400\r\ndebug: Storing state\r\ndebug: Stored state in 0.00 seconds\r\nnotice: Finished catalog run in 0.03 seconds\r\ndebug: Finishing transaction 23948233059620\r\n{code}\r\n\r\nPuppet 2.6.1:\r\n{code}\r\npuppet apply --debug iclass.pp\r\ndebug: Creating default schedules\r\ndebug: Failed to load library 'selinux' for feature 'selinux'\r\ndebug: Puppet::Type::File::ProviderMicrosoft_windows: feature microsoft_windows is missing\r\ndebug: Failed to load library 'ldap' for feature 'ldap'\r\ndebug: /File[/home/keibaker/.puppet/ssl/private_keys]: Autorequiring File[/home/keibaker/.puppet/ssl]\r\ndebug: /File[/home/keibaker/.puppet/ssl/public_keys]: Autorequiring File[/home/keibaker/.puppet/ssl]\r\ndebug: /File[/home/keibaker/.puppet/ssl]: Autorequiring File[/home/keibaker/.puppet]\r\ndebug: /File[/home/keibaker/.puppet/var/log]: Autorequiring File[/home/keibaker/.puppet/var]\r\ndebug: /File[/home/keibaker/.puppet/var]: Autorequiring File[/home/keibaker/.puppet]\r\ndebug: /File[/home/keibaker/.puppet/var/state/graphs]: Autorequiring File[/home/keibaker/.puppet/var/state]\r\ndebug: /File[/home/keibaker/.puppet/ssl/certificate_requests]: Autorequiring File[/home/keibaker/.puppet/ssl]\r\ndebug: /File[/home/keibaker/.puppet/var/clientbucket]: Autorequiring File[/home/keibaker/.puppet/var]\r\ndebug: /File[/home/keibaker/.puppet/var/client_data]: Autorequiring File[/home/keibaker/.puppet/var]\r\ndebug: /File[/home/keibaker/.puppet/var/client_yaml]: Autorequiring File[/home/keibaker/.puppet/var]\r\ndebug: /File[/home/keibaker/.puppet/var/facts]: Autorequiring File[/home/keibaker/.puppet/var]\r\ndebug: /File[/home/keibaker/.puppet/var/lib]: Autorequiring File[/home/keibaker/.puppet/var]\r\ndebug: /File[/home/keibaker/.puppet/var/run]: Autorequiring File[/home/keibaker/.puppet/var]\r\ndebug: /File[/home/keibaker/.puppet/ssl/certs]: Autorequiring File[/home/keibaker/.puppet/ssl]\r\ndebug: /File[/home/keibaker/.puppet/var/state/state.yaml]: Autorequiring File[/home/keibaker/.puppet/var/state]\r\ndebug: /File[/home/keibaker/.puppet/ssl/private]: Autorequiring File[/home/keibaker/.puppet/ssl]\r\ndebug: /File[/home/keibaker/.puppet/var/state]: Autorequiring File[/home/keibaker/.puppet/var]\r\ndebug: Finishing transaction 70277340166120\r\ndebug: Loaded state in 0.02 seconds\r\ninfo: Applying configuration version '1327691483'\r\ndebug: Finishing transaction 70277340695320\r\ndebug: Storing state\r\ndebug: Stored state in 0.01 seconds\r\n{code}","closed_at":"2020-09-15T15:24:49.000-0700","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1606","labels":"redmine","state":"Closed","updated_at":"2020-09-15T15:24:49.000-0700","timestamp":1652286418.229114,"priority":"Normal","status_category":"Done","pull_request":5895},{"issue_id":"117270","title":"Deprecate source_permissions","url":"https://tickets.puppetlabs.com/browse/PUP-5921","created_at":"2016-02-17T17:16:43.000-0800","number":"PUP-5921","body":"We are steering people away from {{source_permissions}} for two reasons:\r\n# it doesn't make sense for environments (including PE) that use git for the backend (user/group aren't managed by git)\r\n# -it is not fully supported/supportable by static_catalogs- no longer true, it will now be fully supported in static_catalogs\r\n\r\nIt is still used by pluginsync for external facts however, and we will need to find a replacement mechanism for that, see linked PUP-5920.","closed_at":"2020-09-23T06:27:31.000-0700","comments":16,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5921","labels":"docs_reviewed","state":"Closed","updated_at":"2020-09-23T06:27:31.000-0700","timestamp":1652286418.659265,"priority":"Normal","status_category":"Done","pull_request":6956},{"issue_id":"150707","title":"Timespan sometimes parses fractions incorrectly.","url":"https://tickets.puppetlabs.com/browse/PUP-6686","created_at":"2016-09-07T04:43:58.000-0700","number":"PUP-6686","body":"The following code, when applied, \r\n{code:puppet} \r\nnotice(strftime(Timespan('02:03.4', '%M:%S.%L'), '%M:%S.%L')) \r\n{code} \r\nincorrectly notices \r\n{code} \r\n02:03.004 \r\n{code} \r\nThe reason is that the '4' is parsed by the '%L' format descriptor, and hence considered to be milliseconds. While this is correct in some sense, it's not very intuitive. Puppet should instead do what Ruby's DateTime#strptime does and treat %L and %N as values to the right of a decimal point, i.e. a \"4\" is intepreted as \"0.4\", which means 400000000 nanoseconds.","closed_at":"2020-09-28T07:39:18.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6686","labels":"","state":"Closed","updated_at":"2020-09-28T07:39:18.000-0700","timestamp":1652286419.366509,"priority":"Normal","status_category":"Done","pull_request":5262},{"issue_id":"274845","title":"Remove CA related deprecation warnings","url":"https://tickets.puppetlabs.com/browse/PUP-9116","created_at":"2018-09-07T10:24:52.000-0700","number":"PUP-9116","body":"Puppet 5.5.6 will emit deprecation warnings for ca related settings even if the setting is never set on the CLI or in settings:\r\n\r\n{noformat}\r\n$ bx puppet agent -t\r\nWarning: Accessing 'ca' as a setting is deprecated.\r\n   (location: /Users/josh/work/puppet/lib/puppet/settings.rb:1165:in `issue_deprecation_warning')\r\nExiting; no certificate found and waitforcert is disabled\r\n{noformat}\r\n\r\nWe should remove these warning from the settings entirely, as they will still be available in Puppet 6.\r\n\r\nSee PUP-9027","closed_at":"2020-10-09T10:08:00.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9116","labels":"","state":"Closed","updated_at":"2020-10-09T10:08:00.000-0700","timestamp":1652286422.840246,"priority":"Normal","status_category":"Done","pull_request":7081},{"issue_id":"371054","title":"Resource collector overrides cause Puppet Server to retain Compiler instances","url":"https://tickets.puppetlabs.com/browse/PUP-10657","created_at":"2020-09-02T16:15:40.000-0700","number":"PUP-10657","body":"Use of a resource collector with an override block will cause Puppet Server to retain {{Puppet::Parser::Catlog}} objects in memory after requests finish.\r\n\r\nSee SERVER-2874 for more context and PE reproduction case.\r\n\r\nh2. Reproduction Case\r\n\r\n  - Install Puppet Server on CentOS 7 along with the Java development tools:\r\n\r\n{code:bash}\r\nyum install -y http://yum.puppetlabs.com/puppet6-release-el-7.noarch.rpm\r\nyum install -y puppetserver java-devel\r\nsource /etc/profile.d/puppet-agent.sh\r\n{code}\r\n\r\n  - Install the `pupeptlabs-inifile` module and use it to enable JRuby class reification. This allows Ruby objects, like {{Puppet::Parser::Compiler}}, to be identified easily in the Java heap:\r\n\r\n{code:bash}\r\npuppet module install puppetlabs-inifile\r\n\r\npuppet apply <<'EOF'\r\nini_subsetting { 'Enable JRuby reify.classes':\r\n  ensure            => present,\r\n  path              => '/etc/sysconfig/puppetserver',\r\n  section           => '',\r\n  key_val_separator => '=',\r\n  setting           => 'JAVA_ARGS',\r\n  subsetting        => '-Djruby.reify.classes',\r\n  value             => '=true',\r\n}\r\nEOF\r\n{code}\r\n\r\n  - Bootstrap the CA, configure the agent, and start the {{puppetserver}} service:\r\n\r\n{code:bash}\r\npuppetserver ca setup\r\npuppet config set server $(hostname -f)\r\nsystemctl start puppetserver\r\n{code}\r\n\r\n  - Give the service a trivial catalog to compile:\r\n\r\n{code:bash}\r\ncat <<'EOF' > /etc/puppetlabs/code/environments/production/manifests/site.pp\r\nnode default {\r\n  notify { 'test message':\r\n    message => 'Hello, world!',\r\n  }\r\n\r\n  Notify <| title == 'test message' |> {\r\n    message => 'collector override',\r\n  }\r\n}\r\nEOF\r\n{code}\r\n\r\n  - Run {{puppet}} a couple of times:\r\n\r\n{code:bash}\r\npuppet agent -t\r\npuppet agent -t\r\n{code}\r\n\r\n  - Check the number of {{Puppet::Parser::Compiler}} instances retained in Puppet Server memory:\r\n\r\n{code:bash}\r\nsudo -u puppet jmap -histo:live $(systemctl show -p MainPID puppetserver|cut -d= -f2)|fgrep 'rubyobj.Puppet.Parser.Compiler'\r\n{code}\r\n\r\nh3. Outcome\r\n\r\nAfter running the agent twice, the {{puppetserver}} service is retaining two Compiler instances in memory:\r\n\r\n{noformat}\r\n# sudo -u puppet jmap -histo:live $(systemctl show -p MainPID puppetserver|cut -d= -f2)|fgrep 'rubyobj.Puppet.Parser.Compiler'\r\n\r\n5895:             2             64  rubyobj.Puppet.Parser.Compiler\r\n{noformat}\r\n\r\nh3. Expected Outcome\r\n\r\nNo compiler instances should be retained as the compiler is discarded at the end of the request and the {{-histo:live}} flag forces a full garbage collection.","closed_at":"2020-10-12T06:16:58.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10657","labels":"doc_reviewed;jira_escalated","state":"Resolved","updated_at":"2020-10-12T06:16:58.000-0700","timestamp":1652286423.162329,"priority":"Normal","status_category":"Done","pull_request":8326},{"issue_id":"369684","title":"Performance regression with large hashes using lookup","url":"https://tickets.puppetlabs.com/browse/PUP-10628","created_at":"2020-08-19T07:55:26.000-0700","number":"PUP-10628","body":"*Puppet Version: starting from 5.0.0*\r\n**\r\n\r\nAfter upgrading our Puppet installation from 4.10 to 6.x I found large catalog compile time increasing (over 300 seconds) for some nodes.\r\n\r\nProfiling shows problem with large hashes in Hiera yamls.\r\n\r\n \r\n\r\nGood case:\r\n\r\n \r\n{code:java}\r\n$ sudo yum downgrade -y http://yum.puppetlabs.com/el/6x/PC1/x86_64/puppet-agent-1.10.14-1.el6.x86_64.rpm\r\n$ puppet --version\r\n4.10.12\r\n$ time puppet lookup --hiera_config hiera.yaml hash1.hash2.hash3.key1\r\n--- value1\r\n...\r\nreal    0m2.195s\r\nuser    0m2.010s\r\nsys     0m0.181s{code}\r\nBad cases:\r\n\r\n \r\n\r\n \r\n{code:java}\r\n$ sudo yum update -y http://yum.puppetlabs.com/puppet5/el/6/x86_64/puppet-agent-5.0.0-1.el6.x86_64.rpm\r\n$ puppet --version\r\n5.0.0\r\n$ time puppet lookup --hiera_config hiera.yaml hash1.hash2.hash3.key1\r\n--- value1\r\n...\r\nreal    0m9.837s\r\nuser    0m9.623s\r\nsys     0m0.207s{code}\r\n{code:java}\r\n$ sudo yum update -y puppet-agent\r\n$ puppet --version\r\n6.17.0\r\n$ time puppet lookup --hiera_config hiera.yaml hash1.hash2.hash3.key1\r\n--- value1\r\nreal    0m9.788s\r\nuser    0m9.494s\r\nsys     0m0.296s{code}\r\nMy research ended on follow debug points:\r\n\r\n \r\n{code:java}\r\n$ patch /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/lookup/data_provider.rb <<EOF\r\n--- data_provider.rb\r\n+++ data_provider.rb\r\n@@ -80,11 +80,14 @@\r\n   # @param data_provider [DataProvider] The data provider that produced the hash\r\n   # @return [Object] The data value\r\n   def validate_data_value(value, &block)\r\n+require 'time'\r\n+print \"data_provider.rb::validate_data_value::1 \", ::Time.now.to_f, \"\\n\"\r\n     # The DataProvider.value_type is self recursive so further recursive check of collections is needed here\r\n     unless value_is_validated? || DataProvider.value_type.instance?(value)\r\n       actual_type = Types::TypeCalculator.singleton.infer(value)\r\n       raise Types::TypeAssertionError.new(\"#{yield} has wrong type, expects Puppet::LookupValue, got #{actual_type}\", DataProvider.value_type, actual_type)\r\n     end\r\n+print \"data_provider.rb::validate_data_value::2 \", ::Time.now.to_f, \"\\n\"\r\n     value\r\n   end\r\n end\r\nEOF{code}\r\nRun with debug timestamps on 6.17.0:\r\n{code:java}\r\n$ time puppet lookup --hiera_config hiera.yaml hash1.hash2.hash3.key1\r\ndata_provider.rb::validate_data_value::1 1597847682.16178\r\ndata_provider.rb::validate_data_value::2 1597847689.6889844\r\n--- value1\r\nreal    0m9.819s\r\nuser    0m9.557s\r\nsys     0m0.261s{code}\r\nRun with debug timestamps on 4.10.12:\r\n{code:java}\r\n$ time puppet lookup --hiera_config hiera.yaml hash1.hash2.hash3.key1\r\ndata_provider.rb::validate_data_value::1 1597847876.923722\r\ndata_provider.rb::validate_data_value::2 1597847876.9429817\r\n--- value1\r\n...\r\nreal    0m2.206s\r\nuser    0m2.050s\r\nsys     0m0.151s\r\n{code}\r\nSlowdown from 19ms to 7.5s (390 times) on 2000 items.\r\n\r\n \r\n\r\n \r\n\r\nFor 4000 items - slowndown from 38ms to 31s (800 times)\r\n\r\n ","closed_at":"2020-10-12T06:17:35.000-0700","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10628","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-10-12T06:17:35.000-0700","timestamp":1652286423.273083,"priority":"Normal","status_category":"Done","pull_request":8307},{"issue_id":"365792","title":"puppet_gem provider does not use vendored PKG_CONFIG_PATH when installing native extensions","url":"https://tickets.puppetlabs.com/browse/PUP-10584","created_at":"2020-07-14T06:33:16.000-0700","number":"PUP-10584","body":"Based on bellow issue on using /opt/puppetlabs/puppet/bin/gem, we will update puppet_gem package provider to be able to handle rugged installation with puppet: *puppet resource package rugged ensure=present provider=puppet_gem*\r\n\r\n------\r\n\r\n \r\n\r\nWhen installing R10K, if you install Rugged with the following method\r\n\r\n`/opt/puppetlabs/puppet/bin/gem install rugged`\r\n\r\nIt will build as intended, but will then cause SegV to occur on running R10K even no matter what provider you have it set to use.\r\n\r\nIf you first set your pkgconfig env with \r\n `export PKG_CONFIG_PATH=/opt/puppetlabs/puppet/lib/pkgconfig`\r\n\r\nAnd then install Rugged, it will then build and run as intended.\r\n\r\nThe Puppet Gem environment should probably handle making sure gems built use vendored components.","closed_at":"2020-10-13T08:25:06.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10584","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-10-13T08:25:06.000-0700","timestamp":1652286423.688627,"priority":"Normal","status_category":"Done","pull_request":8222},{"issue_id":"370140","title":"hold => none not idempotent with dpkg provider","url":"https://tickets.puppetlabs.com/browse/PUP-10643","created_at":"2020-08-25T05:19:58.000-0700","number":"PUP-10643","body":"*Puppet Version: 5.5.21/6.18.0*\r\n *Puppet Server Version: n/a*\r\n *OS Name/Version: Debian/Ubuntu (any)*\r\n\r\nWhen explicitly specifying {{hold => none}} in a manifest, puppet will always report changes. Sample resource:\r\n{code}package { 'mc':\r\n    ensure => present,\r\n    mark   => none,\r\n}\r\n{code}\r\n*Desired Behavior:*\r\n\r\nPuppet should set mark to none and not report any subsequent changes.\r\n\r\n*Actual Behavior:*\r\n\r\nPuppet sets mark to none on each run.\r\n\r\n----------------------------\r\n\r\nSolved by the following patch:\r\n{code}--- a/lib/puppet/provider/package/dpkg.rb\r\n+++ b/lib/puppet/provider/package/dpkg.rb\r\n@@ -74,7 +74,7 @@ Puppet::Type.type(:package).provide :dpkg, :parent => Puppet::Provider::Package\r\n       elsif ['config-files', 'half-installed', 'unpacked', 'half-configured'].include?(hash[:status])\r\n         hash[:ensure] = :absent\r\n       end\r\n-      hash[:mark] = :hold if hash[:desired] == 'hold'\r\n+      hash[:mark] = hash[:desired] == 'hold' ? :hold : :none\r\n     else\r\n       Puppet.debug(\"Failed to match dpkg-query line #{line.inspect}\")\r\n     end\r\n{code}","closed_at":"2020-10-13T08:57:19.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10643","labels":"","state":"Resolved","updated_at":"2020-10-13T08:57:19.000-0700","timestamp":1652286423.792841,"priority":"Normal","status_category":"Done","pull_request":8296},{"issue_id":"371830","title":"if pluginsync fails puppet should apply cached catalog","url":"https://tickets.puppetlabs.com/browse/PUP-10667","created_at":"2020-09-15T02:11:44.000-0700","number":"PUP-10667","body":"This ticket relates to https://tickets.puppetlabs.com/browse/PUP-1763 and https://tickets.puppetlabs.com/browse/PUP-10598\r\n\r\nIn the case we have ignore_plugin_errors==false and usecacheonfailure==true, puppet should apply cached catalog when pluginsync fails","closed_at":"2020-10-13T08:58:02.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10667","labels":"","state":"Resolved","updated_at":"2020-10-13T08:58:02.000-0700","timestamp":1652286423.89797,"priority":"Normal","status_category":"Done","pull_request":8328},{"issue_id":"201571","title":"No useful debug output for yum/rpm provider success/failure/version information","url":"https://tickets.puppetlabs.com/browse/PUP-7791","created_at":"2017-07-20T11:10:40.000-0700","number":"PUP-7791","body":"When running puppet agent with the debug flag, there's no indication as to whether a package was successfully upgraded, or what version it was upgraded to, requiring customers and support to fish for this information on the command line.\r\n\r\nExample debug output from a failed package upgrade:\r\n{code}\r\n[[0;36mDebug: Facter: resolving Xen facts.^[[0m\r\n1531 ^[[0;36mDebug: Evicting cache entry for environment 'production'^[[0m\r\n1532 ^[[0;36mDebug: Caching environment 'production' (ttl = 0 sec)^[[0m\r\n1533 ^[[mNotice: Compiled catalog for cmh1vlatgps003d.dev2a.dswd1.com in environment production in 0.05 seconds^[[0m\r\n1534 ^[[0;36mDebug: Creating default schedules^[[0m\r\n1535 ^[[0;36mDebug: Loaded state in 0.11 seconds^[[0m\r\n1536 ^[[0;36mDebug: Loaded state in 0.08 seconds^[[0m\r\n1537 ^[[0;32mInfo: Applying configuration version '1500483207'^[[0m\r\n1538 ^[[0;36mDebug: Prefetching yum resources for package^[[0m\r\n1539 ^[[0;36mDebug: Executing: '/bin/rpm --version'^[[0m\r\n1540 ^[[0;36mDebug: Executing '/bin/rpm -qa --nosignature --nodigest --qf '%{NAME} %|EPOCH?{%{EPOCH}}:{0}| %{VERSION} %{RELEASE} %{ARCH}\\n''^[[0m\r\n1541 ^[[0;36mDebug: Executing: '/usr/bin/yum check-update'^[[0m\r\n1542 ^[[0;36mDebug: Finishing transaction 22088640^[[0m\r\n1543 ^[[0;36mDebug: Storing state^[[0m\r\n1544 ^[[0;36mDebug: Stored state in 0.12 seconds^[[0m\r\n1545 ^[[mNotice: Applied catalog in 2.38 seconds^[[0m\r\n1546 ^\r\n{code}\r\n\r\nSince we see this situation quite frequently in support, and lengthens time to resolution, and  seems trivial to add this the debug logging, I wanted to get this issue submitted and tracked, along with a recent Zendesk example.","closed_at":"2020-10-13T08:58:37.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7791","labels":"","state":"Resolved","updated_at":"2020-10-13T08:58:37.000-0700","timestamp":1652286424.001053,"priority":"Normal","status_category":"Done","pull_request":8338},{"issue_id":"296813","title":"Fact yaml should quote mac addresses.","url":"https://tickets.puppetlabs.com/browse/PUP-9505","created_at":"2019-02-20T08:38:19.000-0800","number":"PUP-9505","body":"In puppet 6 (and not in 5), `puppet facts --render-as yaml` outputs mac addresses unquoted.\r\nIf your mac address doesn't contain any chars A-F this is a problem as other tools parsing this yaml will interpret the value as a sexagesimal (base 60) integer.\r\nhttps://yaml.org/type/int.html\r\n\r\nCached fact data in /opt/puppetlabs/server/data/puppetserver/yaml/facts is also broken.\r\nOne tool affected by this problem is the enc script that ships with Foreman.  It loads data from /opt/puppetlabs/server/data/puppetserver/yaml/facts/some_node.yaml and uploads the facts to foreman as json.  Foreman understandably doesn't like the mac address it receives in the payload.","closed_at":"2020-10-21T07:16:26.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9505","labels":"community;doc_reviewed;platform_7","state":"Resolved","updated_at":"2020-10-21T07:16:26.000-0700","timestamp":1652286426.500552,"priority":"Normal","status_category":"Done","pull_request":8359},{"issue_id":"375479","title":"masterport not honoured when is configured in other section than main","url":"https://tickets.puppetlabs.com/browse/PUP-10722","created_at":"2020-10-21T02:17:37.000-0700","number":"PUP-10722","body":"https://tickets.puppetlabs.com/browse/PUP-10670 introduced the `serverport` alias for `masterport` and changed Puppet to use it internally instead of `masterport`.\r\n\r\nThis introduced the following change in behaviour:\r\n - when setting `masterport` in any section different than `main`(eg. agent), this is ignored and the default `serverport` value is used.\r\n\r\n - users that have `masterport` set in their configuration, in a different section than `main`(eg. agent), are also affected as Puppet will not pick up the value set for `masterport` and it will use the default `serverport` value.","closed_at":"2020-10-22T05:20:01.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10722","labels":"doc_reviewed","state":"Closed","updated_at":"2020-10-22T05:20:01.000-0700","timestamp":1652286426.817045,"priority":"Critical","status_category":"Done","pull_request":8411},{"issue_id":"190900","title":"Handling of non-leading tildes in rpmvercmp","url":"https://tickets.puppetlabs.com/browse/PUP-7529","created_at":"2017-05-13T22:43:40.000-0700","number":"PUP-7529","body":"rpmvercmp handles only the leading tilde.\r\nSo, the following test fails.\r\n\r\n\r\n{code:ruby}\r\nit { expect(provider.rpmvercmp(\"~\", \"~~\")).to eq(1) }\r\n{code}\r\n\r\nA tilde must sort before everything else.\r\nhttps://github.com/rpm-software-management/rpm/issues/214","closed_at":"2020-10-23T16:54:54.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7529","labels":"resolved-issue-added","state":"Closed","updated_at":"2020-10-23T16:54:54.000-0700","timestamp":1652286428.409011,"priority":"Normal","status_category":"Done","pull_request":5869},{"issue_id":"16694","title":"Extend batch processing to use more aggressive algorithm","url":"https://tickets.puppetlabs.com/browse/PUP-562","created_at":"2013-10-14T14:32:56.000-0700","number":"PUP-562","body":"The initial implementation of batch processing followed the most conservative ordering.  This extends batch processing to allow a more optimized algorithm (all items in the ready q for a given provider are batch candidates).","closed_at":"2020-10-23T16:54:54.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-562","labels":"","state":"Ready for Engineering","updated_at":"2020-10-23T16:54:54.000-0700","timestamp":1652286428.513556,"priority":"Normal","status_category":"To Do","pull_request":5185},{"issue_id":"20281","title":"Relationship Expression is not R-value producing - validation missing","url":"https://tickets.puppetlabs.com/browse/PUP-937","created_at":"2013-12-04T18:35:48.000-0800","number":"PUP-937","body":"The future parser / evaluator does not flag an error when a relationship expression is used where an R-value is required. e.g. \r\n{code}\r\n$a = foo -> bar\r\n{code}\r\n\r\nIt cannot be an R-value since the evaluation is delayed until the end of the compilation. The checker/validator should be updated and list RelationshipExpression as not being an R-value. \r\n\r\nThe work is a one-liner, plus some tests.","closed_at":"2020-10-23T16:54:57.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-937","labels":"","state":"Ready for Engineering","updated_at":"2020-10-23T16:54:57.000-0700","timestamp":1652286438.364506,"priority":"Normal","status_category":"To Do","pull_request":7310},{"issue_id":"287001","title":"Ensure provider suitability is always lazily evaluated","url":"https://tickets.puppetlabs.com/browse/PUP-9336","created_at":"2018-11-30T10:18:48.000-0800","number":"PUP-9336","body":"[Puppet::Provider::Service::Upstart|https://github.com/puppetlabs/puppet/blob/c6ee7ddcb80f2ec4be03edcafade20d1853a4aee/lib/puppet/provider/service/upstart.rb#L30-L35] had a confine added that is run when the provider is loaded.\r\n\r\n{code:ruby}\r\n  confine :true => begin\r\n    initctl('version', '--quiet')\r\n    true\r\n  rescue\r\n    false\r\n  end\r\n{code}\r\n\r\nThis causes issues with running tests under things like JRuby, and also means that it is not possible for the provider to become suitable during the course of a transaction.  Instead of using a begin/rescue/end block which will be evaluated during the provider definition, this should be something that will be evaluated only when checking if the provider is suitable.\r\n \r\n\r\nThis probably means creating a new type of [Puppet::Confine|https://github.com/puppetlabs/puppet/tree/c6ee7ddcb80f2ec4be03edcafade20d1853a4aee/lib/puppet/confine] that is capable of taking a block to be lazily evaluated as the only existing one that does any sort of \"call this code later\" goes through the feature machinery. We could also modify the existing {{true}} and {{false}} confines to optionally accept a block.","closed_at":"2020-10-23T17:01:10.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9336","labels":"resolved-issue-added","state":"Closed","updated_at":"2020-10-23T17:01:10.000-0700","timestamp":1652286439.927334,"priority":"Normal","status_category":"Done","pull_request":7306},{"issue_id":"374908","title":"Fix json output of puppet facts show action","url":"https://tickets.puppetlabs.com/browse/PUP-10716","created_at":"2020-10-14T05:58:00.000-0700","number":"PUP-10716","body":"*Puppet Version: main branch*\r\n *Puppet Server Version:*\r\n *OS Name/Version: All*\r\n\r\nBy default puppet facts show output is rendered as json. The json output is not pretty printed.\r\n\r\n*Desired Behavior:*\r\n\r\n*`\"os\": {*\r\n *\"name\": \"Darwin\",*\r\n *\"hardware\": \"x86_64\",*\r\n *\"architecture\": \"x86_64\",*\r\n *\"family\": \"Darwin\",*\r\n *\"release\": {*\r\n *\"full\": \"18.7.0\",*\r\n *\"major\": \"18\",*\r\n *\"minor\": \"7\"*\r\n *},*\r\n *\"macosx\": {*\r\n *\"build\": \"18G95\",*\r\n *\"product\": \"Mac OS X\",*\r\n *\"version\": {*\r\n *\"full\": \"10.14.6\",*\r\n *\"major\": \"10.14\",*\r\n *\"minor\": \"6\"*\r\n *}*\r\n *}}`*\r\n\r\n*Actual Behavior:*\r\n\r\n The output for os query :\r\n\r\n`\\{\"os\":{\"architecture\":\"x86_64\",\"family\":\"Darwin\",\"hardware\":\"x86_64\",\"macosx\":{\"build\":\"18G95\",\"product\":\"Mac OS X\",\"version\":{\"full\":\"10.14.6\",\"major\":\"10.14\",\"minor\":\"6\"}},\"name\":\"Darwin\",\"release\":\\{\"full\":\"18.7.0\",\"major\":\"18\",\"minor\":\"7\"}}}`","closed_at":"2020-10-26T01:19:09.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10716","labels":"platform_7","state":"Closed","updated_at":"2020-10-26T01:19:09.000-0700","timestamp":1652286440.35553,"priority":"Normal","status_category":"Done","pull_request":8407},{"issue_id":"376350","title":"Old report processors don't work with the new puppetserver http client","url":"https://tickets.puppetlabs.com/browse/PUP-10730","created_at":"2020-10-28T11:34:08.000-0700","number":"PUP-10730","body":"Add the following report processor to {{lib/puppet/reports/legacy.rb}}, which is a simplified version of the {{http}} processor from puppet 5/6:\r\n\r\n{code:ruby}\r\nrequire 'puppet'\r\nrequire 'puppet/network/http_pool'\r\nrequire 'uri'\r\n\r\nPuppet::Reports.register_report(:legacy) do\r\n  def process\r\n    url = URI.parse(Puppet[:reporturl])\r\n    conn = Puppet::Network::HttpPool.http_instance(url.host, url.port, false)\r\n    response = conn.post(url.path, self.to_yaml, { \"Content-Type\" => \"application/x-yaml\" })\r\n    unless response.kind_of?(Net::HTTPSuccess)\r\n      Puppet.err (\"Unable to submit report to #{Puppet[:reporturl]} [#{response.code}] #{response.msg}\")\r\n    end\r\n  end\r\nend\r\n{code}\r\n\r\nMake sure puppetserver includes commit https://github.com/puppetlabs/puppetserver/commit/d6c07c9fae476cfd07502436fd397fa8ef60ac67 and the report processor is the jruby load-path.\r\n\r\nConfigure puppet.conf with:\r\n\r\n{code:ini}\r\n[server]\r\nreports = legacy\r\nreporturl = http://localhost:8000/reports\r\n{code}\r\n\r\nStart a simple http server on port 8000, like {{python -m SimpleHTTPServer}}\r\n\r\nStart puppetserver and run the agent, and the report processor will fail with:\r\n\r\n{noformat}\r\n020-10-28 11:26:04,868 ERROR [qtp470539277-446] [puppetserver] Puppet Report processor failed: undefined method `code' for nil:NilClass\r\n/Users/josh/work/puppet/lib/puppet/reports/legacy.rb:35:in `process'\r\n/Users/josh/work/puppet/lib/puppet/indirector/report/processor.rb:37:in `block in process'\r\n/Users/josh/work/puppet/lib/puppet/indirector/report/processor.rb:54:in `block in processors'\r\norg/jruby/RubyArray.java:1809:in `each'\r\n/Users/josh/work/puppet/lib/puppet/indirector/report/processor.rb:51:in `processors'\r\n/Users/josh/work/puppet/lib/puppet/indirector/report/processor.rb:30:in `process'\r\n/Users/josh/work/puppet/lib/puppet/indirector/report/processor.rb:14:in `save'\r\n{noformat}\r\n\r\nThis is because {{Puppet::HTTP::Response#nethttp}} returns nil","closed_at":"2020-10-30T16:51:29.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10730","labels":"platform_7","state":"Resolved","updated_at":"2020-10-30T16:51:29.000-0700","timestamp":1652286441.199036,"priority":"Normal","status_category":"Done","pull_request":8425},{"issue_id":"185591","title":"Remove win32-service gem dependency from packaging","url":"https://tickets.puppetlabs.com/browse/PUP-7446","created_at":"2017-04-12T10:54:50.000-0700","number":"PUP-7446","body":"This task should be completed after PUP-7445 code changes, and involves updating any of the following if necessary:\r\n\r\n* {{Gemfile}}\r\n* {{.gemspec}}\r\n* {{project_data.yaml}}\r\n* Removing gem from {{puppet-win32-ruby}} which is used by {{ci:test:git}}\r\n* Removing gem reference from {{puppet-agent}} packaging repo","closed_at":"2020-11-05T00:56:28.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7446","labels":"platform-os;platform_7","state":"Resolved","updated_at":"2020-11-05T00:56:28.000-0800","timestamp":1652286442.783196,"priority":"Normal","status_category":"Done","pull_request":8251},{"issue_id":"374909","title":"When query for a specific fact with puppet facts show there are 3 additional puppet specific facts displayed","url":"https://tickets.puppetlabs.com/browse/PUP-10717","created_at":"2020-10-14T06:11:16.000-0700","number":"PUP-10717","body":"*.Puppet Version: main branch*\r\n *Puppet Server Version:*\r\n *OS Name/Version: all*\r\n\r\nAfter resolving the requested facts, in puppet are added 3 additional local facts: \"clientcert\", \"clientversion\" and \"clientnoop\". `puppet facts show` action should display only the requested facts without the additional facts.\r\n\r\n*Desired Behavior:*\r\n\r\nFor 'timezone' query (puppet facts show timezone) the output should be:\r\n\r\n{\"timezone\":\"EEST\"}\r\n\r\n*Actual Behavior:*\r\n\r\nFor 'timezone' query (puppet facts show timezone) the output is:\r\n\r\n{\"timezone\":\"EEST\",\"clientcert\":\"macbookpro.local\",\"clientversion\":\"6.14.0\",\"clientnoop\":false}\r\n\r\n ","closed_at":"2020-11-05T00:57:57.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10717","labels":"platform_7","state":"Resolved","updated_at":"2020-11-05T00:57:57.000-0800","timestamp":1652286442.891292,"priority":"Normal","status_category":"Done","pull_request":8399},{"issue_id":"376434","title":"fresh puppet agent installation fails when msgpack is enabled on puppetserver","url":"https://tickets.puppetlabs.com/browse/PUP-10772","created_at":"2020-10-29T03:11:21.000-0700","number":"PUP-10772","body":"Hi!\r\n(I'm not sure if this is a bug in puppet agent or puppetserver)\r\n\r\nI'm running the latest puppetserver \r\n\r\n{code}\r\nroot ~ # puppetserver -v\r\npuppetserver version: 6.14.1\r\nroot ~ # \r\n{code}\r\n\r\nthe msgpack gem is installed:\r\n\r\n{code}\r\nroot ~ # puppetserver gem list msgpack\r\n\r\n*** LOCAL GEMS ***\r\n\r\nmsgpack (1.3.3 java)\r\nroot ~ # \r\n{code}\r\n\r\npreferred_serialization_format isn't set on the server:\r\n\r\n{code}\r\n[main]\r\n    ca_server = *\r\n    certname = *\r\n    codedir = /etc/puppetlabs/code\r\n    environmentpath = /etc/puppetlabs/code/environments\r\n    hiera_config = $confdir/hiera.yaml\r\n    hostprivkey = $privatekeydir/$certname.pem { mode = 640 }\r\n    logdir = /var/log/puppetlabs/puppet\r\n    pluginfactsource = puppet:///pluginfacts\r\n    pluginsource = puppet:///plugins\r\n    privatekeydir = $ssldir/private_keys { group = service }\r\n    reports = puppetdb,foreman\r\n    rundir = /var/run/puppetlabs\r\n    server = *\r\n    show_diff = true\r\n    ssldir = /etc/puppetlabs/puppet/ssl\r\n    vardir = /opt/puppetlabs/puppet/cache\r\n\r\n[agent]\r\n    classfile = $statedir/classes.txt\r\n    default_schedules = false\r\n    environment = snow\r\n    localconfig = $vardir/localconfig\r\n    masterport = 8140\r\n    noop = false\r\n    report = true\r\n    runinterval = 7200\r\n    splay = true\r\n    splaylimit = 7200\r\n    usecacheonfailure = true\r\n\r\n[master]\r\n    autosign = /etc/puppetlabs/puppet/autosign.conf { mode = 0664 }\r\n    ca = true\r\n    certname = *\r\n    external_nodes = /etc/puppetlabs/puppet/node.rb\r\n    logdir = /var/log/puppetlabs/puppetserver\r\n    node_terminus = exec\r\n    parser = current\r\n    rundir = /var/run/puppetlabs/puppetserver\r\n    ssldir = /etc/puppetlabs/puppet/ssl\r\n    storeconfigs = true\r\n    strict_variables = true\r\n    trusted_external_command = /etc/puppetlabs/puppet/trusted-external-commands/*.rb\r\n    vardir = /opt/puppetlabs/server/data/puppetserver\r\n{code}\r\n\r\nWe rolled out the msgpack gem to existing agents:\r\n\r\n{code}\r\n  if fact('aio_agent_version') {\r\n    package { 'msgpack':\r\n      ensure   => 'present',\r\n      provider => 'puppet_gem',\r\n    }\r\n  }\r\n{code}\r\n\r\nbecause I forgot to install it on the servers as well, we did that with multiple days delay:\r\n\r\n{code}\r\n    package { 'msgpack-puppetserver':\r\n      ensure   => 'present',\r\n      name     => 'msgpack',\r\n      provider => 'puppetserver_gem',\r\n      notify   => Service['puppetserver'],\r\n    }\r\n{code}\r\n\r\nthis means by the time it got installed on the puppetservers, all existing agents already had the gem installed. those agents produce the following debug output:\r\n\r\n{code}\r\nDebug: catalog supports formats: rich_data_json json rich_data_msgpack msgpack pson yaml dot\r\n...\r\nDebug: file_metadata supports formats: json msgpack pson yaml\r\nDebug: Closing connection for https://*:8140\r\nDebug: Creating new connection for https://*:8140\r\nDebug: Starting connection for https://*:8140\r\nDebug: Using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256\r\nDebug: HTTP GET https://*:8140/puppet/v3/file_metadatas/plugins?recurse=true&ignore=.svn&ignore=CVS&ignore=.git&ignore=.hg&links=follow&checksum_type=md5&source_permissions=ignore&environment=snow returned 200 OK\r\nDebug: Caching connection for https://*:8140\r\n...\r\nDebug: file_metadata supports formats: json msgpack pson yaml\r\nDebug: Using cached connection for https://*:8140\r\nDebug: HTTP GET https://*:8140/puppet/v3/file_metadatas/locales?recurse=true&ignore=.svn&ignore=CVS&ignore=.git&ignore=.hg&ignore=%2A.pot&ignore=config.yaml&links=follow&checksum_type=md5&source_permissions=ignore&environment=snow returned 200 OK\r\nDebug: Caching connection for https://*:8140\r\nDebug: Finishing transaction 40300740\r\n{code}\r\n\r\nthats from a up2date box:\r\n{code}\r\nroot ~ # puppet --version\r\n6.19.1\r\nroot ~ # /opt/puppetlabs/puppet/bin/gem list msgpack\r\n\r\n*** LOCAL GEMS ***\r\n\r\nmsgpack (1.3.1)\r\nroot ~ # \r\n{code}\r\n\r\n\r\nnow a new setup. I installed the puppet6-el7-release rpm and afterwards puppet-agent. the config file is empty:\r\n\r\n{code}\r\nroot ~ # cat /etc/puppetlabs/puppet/puppet.conf \r\n# This file can be used to override the default puppet settings.\r\n# See the following links for more details on what settings are available:\r\n# - https://puppet.com/docs/puppet/latest/config_important_settings.html\r\n# - https://puppet.com/docs/puppet/latest/config_about_settings.html\r\n# - https://puppet.com/docs/puppet/latest/config_file_main.html\r\n# - https://puppet.com/docs/puppet/latest/configuration.html\r\nroot ~ #\r\n{code}\r\n\r\nthis nodes logs:\r\n{code}\r\nDebug: Puppet::Network::Format[msgpack]: feature msgpack is missing\r\nDebug: catalog supports formats: rich_data_json json rich_data_msgpack pson yaml dot\r\nDebug: Using cached connection for https://:8140\r\nDebug: HTTP POST https://*:8140/puppet/v3/catalog/*?environment=production returned 200 OK\r\nDebug: Caching connection for https://*:8140\r\nError: Could not retrieve catalog from remote server: Failed to deserialize Puppet::Resource::Catalog from rich_data_msgpack: uninitialized constant MessagePack\r\nWrapped exception:\r\nuninitialized constant MessagePack\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\nDebug: Resolving service 'report' using Puppet::HTTP::Resolver::SRV\r\nDebug: Searching for SRV records for domain: *\r\nDebug: Found 0 SRV records for: _x-puppet-report._tcp.*\r\nDebug: Searching for SRV records for domain: *\r\nDebug: Using cached record for _x-puppet._tcp.*\r\nDebug: Yielding next server of *:8140\r\nDebug: Using cached connection for https://*:8140\r\nDebug: Caching connection for https://*:8140\r\nDebug: Resolved service 'report' to https://*:8140/puppet/v3\r\nDebug: Puppet::Network::Format[msgpack]: feature msgpack is missing\r\nDebug: report supports formats: json pson yaml\r\nDebug: Using cached connection for https://*:8140\r\nDebug: HTTP PUT https://*:8140/puppet/v3/report/*?environment=production returned 200 OK\r\nDebug: Caching connection for https://*:8140\r\nDebug: Closing connection for https://*:8140\r\n{code}\r\n\r\ninstalled gems on the new agent:\r\n{code}\r\nroot ~ # /opt/puppetlabs/puppet/bin/gem list\r\n\r\n*** LOCAL GEMS ***\r\n\r\nbigdecimal (default: 1.3.4)\r\ncmath (default: 1.0.0)\r\nconcurrent-ruby (1.1.5)\r\ncsv (default: 1.0.0)\r\ndate (default: 1.0.0)\r\ndeep_merge (1.0.1)\r\ndid_you_mean (1.2.0)\r\netc (default: 1.0.0)\r\nfacter (3.14.14)\r\nfacter-ng (4.0.43)\r\nfast_gettext (1.1.2)\r\nfcntl (default: 1.0.0)\r\nffi (1.13.1)\r\nfiddle (default: 1.0.0)\r\nfileutils (default: 1.0.2)\r\ngettext (3.2.2)\r\nhiera (3.6.0)\r\nhiera-eyaml (3.2.0)\r\nhighline (1.6.21)\r\nhocon (1.3.1)\r\nhttpclient (2.8.3)\r\nio-console (default: 0.4.6)\r\nipaddr (default: 1.2.0)\r\njson (default: 2.1.0)\r\nlocale (2.1.3)\r\nminitest (5.10.3)\r\nmulti_json (1.14.1)\r\nnet-ssh (4.2.0)\r\nnet-telnet (0.1.1)\r\nopenssl (default: 2.1.2)\r\noptimist (3.0.1)\r\npower_assert (1.1.1)\r\npsych (default: 3.0.2)\r\npuppet (6.19.1)\r\npuppet-resource_api (1.8.13)\r\nrake (12.3.3)\r\nrdoc (default: 6.0.1.1)\r\nscanf (default: 1.0.0)\r\nsdbm (default: 1.0.0)\r\nsemantic_puppet (1.0.2)\r\nstringio (default: 0.0.1)\r\nstrscan (default: 1.0.0)\r\nsys-filesystem (1.3.2)\r\ntest-unit (3.2.7)\r\ntext (1.3.1)\r\nthor (1.0.1)\r\nwebrick (default: 1.4.2)\r\nxmlrpc (0.3.0)\r\nzlib (default: 1.0.0)\r\nroot ~ #\r\n{code}\r\n\r\nI got a few questions here:\r\n* my understanding of https://puppet.com/docs/puppet/6.19/experiments_msgpack.html is that msgpack is only used if preferred_serialization_format is set. That does not seem to be the case\r\n* Why isn't there a fallback to pson/json? the agent notices that the msgpack gem isn't installed on the agent.","closed_at":"2020-11-09T03:47:37.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10772","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-11-09T03:47:37.000-0800","timestamp":1652286443.416857,"priority":"Normal","status_category":"Done","pull_request":8431},{"issue_id":"375617","title":"Deprecate func3x_check setting","url":"https://tickets.puppetlabs.com/browse/PUP-10724","created_at":"2020-10-21T16:32:35.000-0700","number":"PUP-10724","body":"The {{func3x_check}} setting will be removed in puppet 7. It currently defaults to {{false}} but if set to {{true}} we should issue a deprecation warning.","closed_at":"2020-11-09T03:49:50.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10724","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-11-09T03:49:50.000-0800","timestamp":1652286443.520932,"priority":"Normal","status_category":"Done","pull_request":8413},{"issue_id":"374990","title":"Puppet's feature detection can leave rubygems in a bad state","url":"https://tickets.puppetlabs.com/browse/PUP-10719","created_at":"2020-10-14T13:09:44.000-0700","number":"PUP-10719","body":"If a gem is managed by a native package manager (rpm, etc), and it is updated during a puppet run, it is possible for rubygems to be left in a bad state causing the run to fail.\r\n\r\nThis can be reproduced using:\r\n\r\n{code:ruby}\r\nrequire 'fileutils'\r\nrequire 'rubygems'\r\nif File.exist?(\"/tmp/thor-1.0.1.gemspec\")\r\n  FileUtils.mv(\"/tmp/thor-1.0.1.gemspec\", \"/opt/puppetlabs/puppet/lib/ruby/gems/2.5.0/specifications/thor-1.0.1.gemspec\")\r\nend\r\nGem.clear_paths\r\nbegin\r\n  require 'msgpack'\r\nrescue LoadError => e\r\nend\r\nFileUtils.mv(\"/opt/puppetlabs/puppet/lib/ruby/gems/2.5.0/specifications/thor-1.0.1.gemspec\", \"/tmp/thor-1.0.1.gemspec\")\r\nGem::Specification.latest_specs\r\n{code}\r\n\r\nRubygems monkey patches {{Kernel.require}} so that if the gem fails to load, it will try to activate it. This has the side effect of caching the stub specifications for all gems.\r\n\r\nIf the gemspec is then removed via rpm upgrade, then the cached stub specification will refer to a gemspec that no longer exists.\r\n\r\nIf we later try to load the full specifications (such as when autoloading a terminus), then rubygems will raise:\r\n\r\n{noformat}\r\n/opt/puppetlabs/puppet/lib/ruby/2.5.0/rubygems/specification.rb:743:in `_all': pid: 9272 nil spec! included in [...#<Gem::StubSpecification:0x0000000001bf0bc0 @extension_dir=nil, @full_gem_path=nil, @gem_dir=nil, @ignored=nil, @loaded_from=\"/opt/puppetlabs/puppet/lib/ruby/gems/2.5.0/specifications/thor-1.0.1.gemspec\", @data=#<Gem::StubSpecification::StubLine:0x0000000001c44810 @name=\"thor\", @version=#<Gem::Version \"1.0.1\">...]\r\n{noformat}\r\n\r\nIt can also be reproduced in puppet using:\r\n\r\n{code:ruby}\r\nrequire 'fileutils'\r\nrequire 'puppet'\r\n \r\nif File.exist?(\"/tmp/thor-1.0.1.gemspec\")\r\n  FileUtils.mv(\"/tmp/thor-1.0.1.gemspec\", \"/opt/puppetlabs/puppet/lib/ruby/gems/2.5.0/specifications/thor-1.0.1.gemspec\")\r\nend\r\n \r\nPuppet.initialize_settings\r\nPuppet[:log_level] = 'debug'\r\n \r\nPuppet.features.msgpack?\r\nFileUtils.mv(\"/opt/puppetlabs/puppet/lib/ruby/gems/2.5.0/specifications/thor-1.0.1.gemspec\", \"/tmp/thor-1.0.1.gemspec\")\r\nPuppet::FileBucket::File.indirection.terminus(:rest)\r\n{code}","closed_at":"2020-11-09T06:49:56.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10719","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-11-09T06:49:56.000-0800","timestamp":1652286443.626018,"priority":"Normal","status_category":"Done","pull_request":8394},{"issue_id":"370505","title":"puppet 6 agent doesn't honor usecacheonfailure setting when using server_list","url":"https://tickets.puppetlabs.com/browse/PUP-10648","created_at":"2020-08-27T09:27:42.000-0700","number":"PUP-10648","body":"*Puppet Version:* 6.17.0 (PE2019.8.1)\r\n *Puppet Server Version:  2019.8.0.37*\r\n *OS Name/Version: RHEL8*\r\n\r\nHad a case where /etc/resolv.conf was accidentally removed and puppet agent hasn't recovered it for unknown reason.  usecacheonfailure is set to true\r\n\r\n \r\n\r\n \r\n\r\nEasy to reproduce, manage /etc/resolv.conf by puppet, remove the file, puppet agent will start failing and not recovering the file. The log entry :\r\n\r\n \r\n{noformat}\r\nCould not run Puppet configuration client: Could not select a functional puppet master from server_list:{noformat}\r\n ","closed_at":"2020-11-09T08:42:30.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10648","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-11-09T08:42:30.000-0800","timestamp":1652286444.251937,"priority":"Normal","status_category":"Done","pull_request":8388},{"issue_id":"356948","title":"Remove Puppet::Util::Yaml.load_file","url":"https://tickets.puppetlabs.com/browse/PUP-10475","created_at":"2020-04-27T17:12:13.000-0700","number":"PUP-10475","body":"The load_file method is unsafe, and should be removed:\r\n\r\n{noformat}\r\n  def self.load_file(filename, default_value = false, strip_classes = false)\r\n    Puppet.deprecation_warning(_(\"Puppet::Util::Yaml.load_file is deprecated. Use safe_load_file instead.\"))\r\n{noformat}","closed_at":"2020-11-09T08:57:06.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10475","labels":"doc_reviewed;platform_7","state":"Resolved","updated_at":"2020-11-09T08:57:06.000-0800","timestamp":1652286445.725226,"priority":"Normal","status_category":"Done","pull_request":8304},{"issue_id":"347102","title":"Windows user management fails if group contains not resolvable Domain accounts","url":"https://tickets.puppetlabs.com/browse/PUP-10303","created_at":"2020-02-20T09:54:06.000-0800","number":"PUP-10303","body":"*Puppet Version:6.11.1, 6.12, 6.13*\r\n *Puppet Server Version: 6.7.1*\r\n *OS Name/Version: Windows Server 2012 R2*\r\n\r\nUnable to manage windows users if a not resolvable SID exists in a group.  Also, the command 'puppet resource group' fails if there is a not resolvable SID in any group on the server.  We currently run Puppet 5.5.6 and this is not an issue.  We are holding off on upgrading.  \r\n\r\n*Steps to reproduce:*\r\n # **Create a test user in Active Directory\r\n # Add the test user to the local Administrators group on a windows server\r\n # Delete the test user in Active Directory\r\n # There are two tests\r\n ## Run *puppet resource group* command\r\n ## Run *puppet apply -e \"group \\{'Administrators': ensure => 'present', members => ['Administrator'], auth_membership => false }\"* \r\n\r\n*Desired Behavior:*\r\n\r\nPuppet should ignore not resolvable SIDs so we can still manage windows users locally\r\n\r\n*Actual Behavior:*\r\n\r\n \r\n\r\nAfter running *'puppet resource group':*  Error: Could not run: Could not resolve name: S-1-5-21-994416979-1451695006-1560425512-1327 (unresolvable)\r\n\r\nAfter running *puppet apply -e \"group \\{'Administrators': ensure => 'present', members => ['Administrator'], auth_membership => false }\":*  Error: /Stage[main]/Main/Group[Administrators]: Could not evaluate: Could not resolve name: S-1-5-21-994416979-1451695006-1560425512-1327 (unresolvable)\r\n\r\n \r\n\r\n \r\n\r\n ","closed_at":"2020-11-10T00:17:21.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10303","labels":"doc_reviewed;jira_escalated","state":"Resolved","updated_at":"2020-11-10T00:17:21.000-0800","timestamp":1652286447.497003,"priority":"Critical","status_category":"Done","pull_request":8044},{"issue_id":"356947","title":"Remove deprecated Puppet::Resource methods","url":"https://tickets.puppetlabs.com/browse/PUP-10474","created_at":"2020-04-27T17:10:40.000-0700","number":"PUP-10474","body":"Remove the following deprecated methods:\r\n\r\n{noformat}\r\nlib/puppet/resource.rb:    Puppet.deprecation_warning(_('The method Puppet::Resource.set_default_parameters is deprecated and will be removed in the next major release of Puppet.'))\r\nlib/puppet/resource.rb:    Puppet.deprecation_warning(_('The method Puppet::Resource.validate_complete is deprecated and will be removed in the next major release of Puppet.'))\r\nlib/puppet/resource/type.rb:    Puppet.deprecation_warning(_('The method Puppet::Resource::Type.assign_parameter_values is deprecated and will be removed in the next major release of Puppet.'))\r\n{noformat}","closed_at":"2020-11-10T01:38:47.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10474","labels":"doc_reviewed;platform_7","state":"Resolved","updated_at":"2020-11-10T01:38:47.000-0800","timestamp":1652286447.600576,"priority":"Normal","status_category":"Done","pull_request":8281},{"issue_id":"356946","title":"Remove legacy auth.conf support","url":"https://tickets.puppetlabs.com/browse/PUP-10473","created_at":"2020-04-27T17:04:55.000-0700","number":"PUP-10473","body":"Per https://puppet.com/docs/puppetserver/latest/deprecated_features.html#use-of-core-puppet-authconf-for-authorizing-master-service-routes\r\n\r\n\"The jruby-puppet.use-legacy-auth-conf setting will be removed from Puppet Server configuration, and Puppet Server will instead always use the new trapperkeeper-authorization “auth.conf” when authorizing client requests.\"\r\n\r\nThis ticket is to remove the legacy authorization layer from puppet. This includes the {{rest_authconfig}} setting, the AuthConfigLoader, AuthConfigParser, DefaultAuthProvider, AuthConfig, Authorization, Rights, AuthStore, beaker and rspec tests.","closed_at":"2020-11-10T01:39:43.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10473","labels":"doc_reviewed;platform_7","state":"Resolved","updated_at":"2020-11-10T01:39:43.000-0800","timestamp":1652286447.705745,"priority":"Normal","status_category":"Done","pull_request":8380},{"issue_id":"356936","title":"Remove Puppet.define_settings","url":"https://tickets.puppetlabs.com/browse/PUP-10472","created_at":"2020-04-27T16:46:48.000-0700","number":"PUP-10472","body":"Remove the Puppet.define_settings method","closed_at":"2020-11-10T01:40:23.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10472","labels":"doc_reviewed;platform_7","state":"Resolved","updated_at":"2020-11-10T01:40:23.000-0800","timestamp":1652286447.812247,"priority":"Normal","status_category":"Done","pull_request":8279},{"issue_id":"356722","title":"Remove application orchestration language features","url":"https://tickets.puppetlabs.com/browse/PUP-10446","created_at":"2020-04-24T15:01:34.000-0700","number":"PUP-10446","body":"Remove the language features deprecated in https://tickets.puppetlabs.com/browse/PUP-9251","closed_at":"2020-11-10T01:41:29.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10446","labels":"doc_reviewed;platform_7","state":"Resolved","updated_at":"2020-11-10T01:41:29.000-0800","timestamp":1652286447.917417,"priority":"Normal","status_category":"Done","pull_request":8316},{"issue_id":"356464","title":"Remove strict_hostname_checking","url":"https://tickets.puppetlabs.com/browse/PUP-10436","created_at":"2020-04-22T21:40:16.000-0700","number":"PUP-10436","body":"Remove the strict_hostname_checking puppet setting. It was changed to false in 6.x, otherwise a node could get a catalog it wasn't supposed to have.\r\n\r\nRemove the node_name setting which is related to strict_hostname_checking.","closed_at":"2020-11-10T01:57:20.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10436","labels":"doc_reviewed;platform_7","state":"Resolved","updated_at":"2020-11-10T01:57:20.000-0800","timestamp":1652286458.65669,"priority":"Normal","status_category":"Done","pull_request":8274},{"issue_id":"291460","title":"Remove future_features logic","url":"https://tickets.puppetlabs.com/browse/PUP-9426","created_at":"2019-01-10T14:47:58.000-0800","number":"PUP-9426","body":"Make sure any functionality controlled by the {{future_features}} flag has been removed/updated for Puppet 7","closed_at":"2020-11-10T02:02:22.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9426","labels":"doc_reviewed;platform_7","state":"Resolved","updated_at":"2020-11-10T02:02:22.000-0800","timestamp":1652286459.281174,"priority":"Normal","status_category":"Done","pull_request":8290},{"issue_id":"291105","title":"Don't backup to the local filebucket by default","url":"https://tickets.puppetlabs.com/browse/PUP-9407","created_at":"2019-01-09T15:03:00.000-0800","number":"PUP-9407","body":"Puppet agent's will backup any overwritten or deleted file to its local filebucket via the default {{backup}} parameter for the file type. It defaults to {{puppet}} which means to use the filebucket named {{puppet}} which is automatically created.\r\n\r\nMany users run into trouble because the filebucket will grow unbounded, such as PUP-1137. It has been proposed to use the {{tidy}} resource to clean up stale files, but can lead to memory issues with large numbers of {{file}} resources being created. See https://github.com/npwalker/pe_metric_curl_cron_jobs/issues/3\r\n\r\nFor this ticket we should change the default value of the {{bucket}} parameter from {{puppet}} to {{false}}, see https://github.com/puppetlabs/puppet/blob/6.1.0/lib/puppet/type/file.rb#L110, and update the {{file}} reference documentation to reflect the new behavior.","closed_at":"2020-11-10T02:03:11.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9407","labels":"doc_reviewed;platform_7","state":"Resolved","updated_at":"2020-11-10T02:03:11.000-0800","timestamp":1652286459.654594,"priority":"Normal","status_category":"Done","pull_request":8263},{"issue_id":"287916","title":"Change default value of hostcsr setting","url":"https://tickets.puppetlabs.com/browse/PUP-9346","created_at":"2018-12-07T15:03:36.000-0800","number":"PUP-9346","body":"The {{hostcsr}} setting seems valid as it's similar to {{hostcert}}, {{hostcrl}}, but the setting is actually dead. Instead hosts generate CSRs and store them as \"{{requestdir}}/{{certname}}.pem\".\r\n\r\nThis ticket is to either make {{hostcsr}} resolve to the correct thing. Since it's changing the default value of a setting, it needs to happen in 7.0.","closed_at":"2020-11-10T02:04:29.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9346","labels":"doc_reviewed;platform_7","state":"Resolved","updated_at":"2020-11-10T02:04:29.000-0800","timestamp":1652286459.858718,"priority":"Normal","status_category":"Done","pull_request":8264},{"issue_id":"205816","title":"The list of reserved type names known to the parser validator is incomplete","url":"https://tickets.puppetlabs.com/browse/PUP-7843","created_at":"2017-08-15T01:01:41.000-0700","number":"PUP-7843","body":"The {{Checker4_0}} class, used for validating the AST produced by the puppet parser, keeps a list named [RESERVED_TYPE_NAMES|https://github.com/puppetlabs/puppet/blob/master/lib/puppet/pops/validation/checker4_0.rb#L360-L380]. This list is incomplete. It lacks the following entries:\r\n{code:ruby}\r\n    'init' => true,\r\n    'object' => true,\r\n    'sensitive' => true,\r\n    'semver' => true,\r\n    'semverrange' => true,\r\n    'string' => true,\r\n    'timestamp' => true,\r\n    'timespan' => true,\r\n    'typeset' => true,\r\n{code}","closed_at":"2020-11-10T02:39:30.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7843","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-11-10T02:39:30.000-0800","timestamp":1652286461.285534,"priority":"Normal","status_category":"Done","pull_request":8423},{"issue_id":"192222","title":"Make attempt to export or virtualize a class an error","url":"https://tickets.puppetlabs.com/browse/PUP-7582","created_at":"2017-05-22T06:00:26.000-0700","number":"PUP-7582","body":"Currently (under to control of --strict), it is a warning or an error to attempt to use {{@class}} or {{@@class}} in a resource expression or a {{create_resources}} call.\r\n\r\nIn Puppet 7.0.0 this should always be an error.\r\n\r\nNote the configuration for this is done twice, once for the static validation, and once for the runtime. The checker4_0 has the static validation logic, and the runtime check is in the `create_resources`. See PUP-1606 where the warnings were added.","closed_at":"2020-11-10T02:41:02.000-0800","comments":16,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7582","labels":"doc_reviewed;platform_7","state":"Resolved","updated_at":"2020-11-10T02:41:02.000-0800","timestamp":1652286461.491221,"priority":"Normal","status_category":"Done","pull_request":8346},{"issue_id":"185590","title":"Remove win32-process usage within Puppet","url":"https://tickets.puppetlabs.com/browse/PUP-7445","created_at":"2017-04-12T10:48:43.000-0700","number":"PUP-7445","body":"win32-process gem is no longer maintained and should be removed / replaced with FFI equivalents inside the Puppet.\r\n\r\nwin32/process is currently consumed explicitly in:\r\n\r\n* https://github.com/puppetlabs/puppet/blob/ce5500dd660019b2be6d132b14f70baff4c553fa/ext/windows/service/daemon.rb\r\n* https://github.com/puppetlabs/puppet/blob/3a5dfed0fef8fc5cb1b6ec168766115de3e8f23b/lib/puppet/util/windows/process.rb\r\n* https://github.com/puppetlabs/puppet/blob/e39b265ef0b34644bb645b4f6674c257ddaa75fa/lib/puppet/type/exec.rb\r\n* https://github.com/puppetlabs/puppet/blob/59f1bcfef7515cc4558ad038f8c9c6a515fe419e/install.rb\r\n\r\nIt is used implicitly at least in:\r\n\r\n* https://github.com/puppetlabs/puppet/blob/ebd96213cab43bb2a8071b7ac0206c3ed0be8e58/lib/puppet/util/pidlock.rb\r\n\r\nwin32/process performs monkey patches to Rubys process execution and should be extricated carefully.\r\n\r\n\r\nAnother ticket will be added to remove the dependency from the .gemspec / Gemfile / puppet-agent packaging repos.","closed_at":"2020-11-10T02:41:45.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7445","labels":"doc_reviewed;platform-os;platform_7","state":"Resolved","updated_at":"2020-11-10T02:41:45.000-0800","timestamp":1652286461.598635,"priority":"Normal","status_category":"Done","pull_request":8204},{"issue_id":"31150","title":"puppet config set certname accepts upper-case names","url":"https://tickets.puppetlabs.com/browse/PUP-2173","created_at":"2014-04-07T11:06:29.000-0700","number":"PUP-2173","body":"On CentOS 6 with Puppet 3.5.0, the certname subcommand accepts upper case letters for the certname. If you then try to change the name to lower-case, puppet complains and refuses to do so:\r\n\r\n{noformat}\r\n[sharon.fonge@puppetmaster ~]$ sudo puppet cert list\r\n[sharon.fonge@puppetmaster ~]$ puppet cert sign puppetclient.local.org\r\nError: Could not find certificate request for puppetclient.local.org\r\n[sharon.fonge@puppetmaster ~]$ sudo rm -rf /etc/puppet/ssl /var/lib/puppet/ssl\r\n[sharon.fonge@puppetmaster ~]$ sudo rm -rf /etc/puppet/ssl /usr/lib/puppet/ssl\r\n{noformat}","closed_at":"2020-11-10T02:44:09.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2173","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-11-10T02:44:09.000-0800","timestamp":1652286461.909681,"priority":"Normal","status_category":"Done","pull_request":8400},{"issue_id":"371191","title":"Data Type casts cause Puppet Server to retain Compiler instances","url":"https://tickets.puppetlabs.com/browse/PUP-10659","created_at":"2020-09-04T08:51:58.000-0700","number":"PUP-10659","body":"Casting between Puppet Data Types, such as {{Integer(\"9\")}}, will cause Puppet Server to retain {{Puppet::Parser::Catlog}} objects in memory after requests finish.\r\n\r\nSee SERVER-2874 for more context and PE reproduction case.\r\n\r\nh2. Reproduction Case\r\n\r\n  - Install Puppet Server on CentOS 7 along with the Java development tools:\r\n\r\n{code:bash}\r\nyum install -y http://yum.puppetlabs.com/puppet6-release-el-7.noarch.rpm\r\nyum install -y puppetserver java-devel\r\nsource /etc/profile.d/puppet-agent.sh\r\n{code}\r\n\r\n  - Install the `pupeptlabs-inifile` module and use it to enable JRuby class reification. This allows Ruby objects, like {{Puppet::Parser::Compiler}}, to be identified easily in the Java heap:\r\n\r\n{code:bash}\r\npuppet module install puppetlabs-inifile\r\n\r\npuppet apply <<'EOF'\r\nini_subsetting { 'Enable JRuby reify.classes':\r\n  ensure            => present,\r\n  path              => '/etc/sysconfig/puppetserver',\r\n  section           => '',\r\n  key_val_separator => '=',\r\n  setting           => 'JAVA_ARGS',\r\n  subsetting        => '-Djruby.reify.classes',\r\n  value             => '=true',\r\n}\r\nEOF\r\n{code}\r\n\r\n  - Bootstrap the CA, configure the agent, and start the {{puppetserver}} service:\r\n\r\n{code:bash}\r\npuppetserver ca setup\r\npuppet config set server $(hostname -f)\r\nsystemctl start puppetserver\r\n{code}\r\n\r\n  - Give the service a trivial catalog to compile:\r\n\r\n{code:bash}\r\ncat <<'EOF' > /etc/puppetlabs/code/environments/production/manifests/site.pp\r\nnode default {\r\n  $string_version = \"9\"\r\n  $version = Integer($string_version)\r\n}\r\nEOF\r\n{code}\r\n\r\n  - Run {{puppet}} a couple of times:\r\n\r\n{code:bash}\r\npuppet agent -t\r\npuppet agent -t\r\n{code}\r\n\r\n  - Check the number of {{Puppet::Parser::Compiler}} instances retained in Puppet Server memory:\r\n\r\n{code:bash}\r\nsudo -u puppet jmap -histo:live $(systemctl show -p MainPID puppetserver|cut -d= -f2)|fgrep 'rubyobj.Puppet.Parser.Compiler'\r\n{code}\r\n\r\nh3. Outcome\r\n\r\nAfter running the agent twice, the {{puppetserver}} service is retaining two Compiler instances in memory:\r\n\r\n{noformat}\r\n# sudo -u puppet jmap -histo:live $(systemctl show -p MainPID puppetserver|cut -d= -f2)|fgrep 'rubyobj.Puppet.Parser.Compiler'\r\n5871:             2             64  rubyobj.Puppet.Parser.Compiler\r\n{noformat}\r\n\r\nh3. Expected Outcome\r\n\r\nNo compiler instances should be retained as the compiler is discarded at the end of the request and the {{-histo:live}} flag forces a full garbage collection.","closed_at":"2020-11-10T08:42:39.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10659","labels":"doc_reviewed;jira_escalated","state":"Resolved","updated_at":"2020-11-10T08:42:39.000-0800","timestamp":1652286462.012775,"priority":"Normal","status_category":"Done","pull_request":8323},{"issue_id":"367118","title":"Puppet lookup on remote nodes should skip loading local external facts","url":"https://tickets.puppetlabs.com/browse/PUP-10599","created_at":"2020-07-23T04:43:31.000-0700","number":"PUP-10599","body":"When performing a puppet lookup on a remote node, puppet requires some settings that are provided by Facter. When Facter provides the setting, it evaluates all external facts even if it does not need them.\r\n\r\nWhen running this command puppet should not evaluate all local external facts.","closed_at":"2020-11-13T16:58:03.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10599","labels":"docs-reviewed","state":"Resolved","updated_at":"2020-11-13T16:58:03.000-0800","timestamp":1652286462.32117,"priority":"Normal","status_category":"Done","pull_request":8219},{"issue_id":"153502","title":"Error running puppet with non-existent and non-default environment","url":"https://tickets.puppetlabs.com/browse/PUP-6739","created_at":"2016-09-25T13:35:26.000-0700","number":"PUP-6739","body":"If no matching local $environment folder on agent, error when running any 'puppet config' or 'puppet module' command.\r\nSee REPROs in comments below.\r\n\r\nFor example, if you have an environment called 'dev' on the master, and you want to set an agent's $environment from the default of 'production' to 'dev', you might issue a {{puppet config set environment dev}} comand. When run, {{puppet config}} will look up the current environment ('production' at this point) and ensure there is a corresponding 'production' folder in the environments path. Assume this succeeds because a 'production' folder exists locally on the agent, by default, but NO OTHER environment folders exist locally on the agent (and shouldn't need to exist in my view).\r\n\r\nNow the environment is set to 'dev'.\r\n\r\nIf a user issues any {{puppet config}} command at this point, the  current environment ('dev' at this point) will NOT have a corresponding environment folder, so we get an error like:\r\n\r\n{code}\r\nCould not find a directory environment named 'dev' anywhere in the path: /etc/puppetlabs/code/environments. Does the directory exist?\r\n{code}\r\n\r\n{code}\r\n[root@pup-vra7-0403 ~]# puppet config set environment production\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:38:in `get!': Could not find a directory environment named 'dev' anywhere in the path: /etc/puppetlabs/code/environments. Does the directory exist? (Puppet::Environments::EnvironmentNotFound)\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application_support.rb:29:in `push_application_context'\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:337:in `run'\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:132:in `run'\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute'\r\n\tfrom /usr/local/bin/puppet:5:in `<main>'\r\n{code}\r\n\r\nThis means we're stuck and cannot issue any {{puppet config print}} or {{puppet config set}} commands even to get us back to an environment setting of 'production'!","closed_at":"2020-12-01T12:29:29.000-0800","comments":36,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6739","labels":"the-goods","state":"Closed","updated_at":"2020-12-01T12:29:29.000-0800","timestamp":1652286464.482262,"priority":"Major","status_category":"Done","pull_request":6431},{"issue_id":"379680","title":"puppet 7 gem is missing runtime dependency on scanf","url":"https://tickets.puppetlabs.com/browse/PUP-10797","created_at":"2020-12-02T09:37:15.000-0800","number":"PUP-10797","body":"Ruby 2.7 removed the scanf implementation (in Kernel, IO and String) from core ruby to a separate gem. Puppet's [{{scanf}} function|https://puppet.com/docs/puppet/latest/function.html#scanf] depends on that ruby method, but only expresses the {{scanf}} runtime dependency in its [{{Gemfile}}|https://github.com/puppetlabs/puppet/blob/96029b003cfbb5303426cbc110f350a0d4b6af06/Gemfile#L21], but not in the gem that is pushed to rubygems. See https://rubygems.org/gems/puppet/versions/7.0.0.\r\n\r\nAs a result, if a module calls the puppet {{scanf}} function using puppet 7 (gem) and ruby 2.7, such as when running rspec tests, then you'll see (for example in https://github.com/puppetlabs/puppetlabs-puppetdb/pull/317)\r\n\r\n{noformat}\r\n       LoadError:\r\n         cannot load such file -- scanf\r\n{noformat}\r\n\r\nThis doesn't affect module functionality when testing or running against puppet-agent 7 packages, because the {{scanf}} gem is included.\r\n\r\nAFAIK rubygems doesn't have a way to express conditional runtime dependencies (i.e. only add this dependency when running on ruby 2.7 and up). So the best thing may be to always add the runtime dependency for the puppet 7.x collection? If you're running the puppet 7 gem with ruby 2.5.0, then things will still work (the scanf gem is ignored).\r\n\r\n{noformat}\r\n$ rbenv shell 2.5.8\r\n$ gem install scanf --no-document\r\nFetching: scanf-1.0.0.gem (100%)\r\nSuccessfully installed scanf-1.0.0\r\n1 gem installed\r\n$ irb\r\nirb(main):001:0> require 'scanf'\r\n=> true\r\nirb(main):002:0> $LOADED_FEATURES.grep /scanf/\r\n=> [\"/usr/local/Cellar/rbenv/1.1.2/versions/2.5.8/lib/ruby/2.5.0/scanf.rb\"]\r\n{noformat}","closed_at":"2020-12-09T08:32:41.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10797","labels":"doc_reviewed;platform_7.1","state":"Resolved","updated_at":"2020-12-09T08:32:41.000-0800","timestamp":1652286466.12092,"priority":"Normal","status_category":"Done","pull_request":8447},{"issue_id":"378889","title":"Puppet Node Clean action's LoggerIO needs to implement `warn`","url":"https://tickets.puppetlabs.com/browse/PUP-10786","created_at":"2020-11-19T09:06:33.000-0800","number":"PUP-10786","body":"In the [Puppet Node|https://github.com/puppetlabs/puppet/blob/d4982257ab2ab5f4f1e696c212b328fa99a9253d/lib/puppet/face/node/clean.rb#L49-L57] face's 'clean' action, we load the Puppet Server CA CLI as a library, passing in a 'LoggerIO' object as an adapter between the CA's logging facilities and Puppet's.\r\n\r\nPreviously, we only needed `inform` and `err` methods to call the relevant APIs in the CA - and it appears our LoggerIO adapter only implements those two methods.\r\n\r\nWith the new cadir default change (see SERVER-2896) we may `warn` as well which will now cause {{puppet node clean}} calls to fail with an undefined method on LoggerIO.\r\n\r\nTo fix this we should update the LoggerIO adapter to provide all the methods available in the Puppet Server CA's Logger.","closed_at":"2020-12-09T08:33:19.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10786","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-12-09T08:33:19.000-0800","timestamp":1652286466.220041,"priority":"Normal","status_category":"Done","pull_request":8445},{"issue_id":"377970","title":"Calling scope#tags results in undefined method","url":"https://tickets.puppetlabs.com/browse/PUP-10779","created_at":"2020-11-11T12:45:52.000-0800","number":"PUP-10779","body":"The following prints a confusing error message in 4.10.5 and up:\r\n\r\n{noformat}\r\n$ bundle exec puppet apply -e \"notice(inline_template('<%= tags %>'))\"\r\nError: Evaluation Error: Error while evaluating a Function Call, Failed to parse inline template: undefined method `tags' for Scope(Class[main]):Puppet::Parser::Scope (line: 1, column: 8) on node localhost\r\n{noformat}\r\n\r\nWithin the body of the ERB template, {{self}} is {{TemplateWrapper}} and {{TemplateWrapper#tags}} is a valid method that delegates to the {{Scope}}, but that doesn't forward it to the parser resource, due to https://github.com/puppetlabs/puppet/commit/02576c98fa5a8b7decb7b53c9407bf8523947220#diff-b929053e73f66fa12eac30a6222276489f6ea778ec407f99183a03e763b38623\r\n\r\nWe should either remove the {{tags}} method from {{TemplateWrapper}} or raise a more meaningful error (to call {{all_tags}} instead) /cc [~ben.ford], [~david.schmitt]","closed_at":"2020-12-09T08:34:04.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10779","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-12-09T08:34:04.000-0800","timestamp":1652286466.320488,"priority":"Normal","status_category":"Done","pull_request":8437},{"issue_id":"374883","title":"Fine grained environment timeout issues","url":"https://tickets.puppetlabs.com/browse/PUP-10713","created_at":"2020-10-13T17:25:46.000-0700","number":"PUP-10713","body":"Puppet's environment cache has three methods for evicting a single expired environment, all expired environments, or all environments, but they don't mutate the cache in a consistent way:\r\n\r\n1. Whenever {{Puppet::Environments::Cached#get_conf(name)}} is called to lookup the {{EnvironmentConf}} for an environment, we clear that environment if it is now expired via {{evict_if_expired(name)}}, but the method doesn't update the {{@next_expiration}} instance variable. As a result, the optimization in {{clear_all_evicted}} may cause us to call the {{cache_expiration_service.expired?(name.to_sym}} twice.\r\n\r\n2. Whenever {{Puppet::Environments::Cached#get(name)}} is called, we clear all environments that are now expired via {{clear_all_expired}}. This method updates the cache consistently.\r\n\r\n3. Whenever {{Puppet::Environments::Cached#clear_all}} is called, the {{cache_expiration_service}} is never notified of the eviction, which could lead to puppetserver holding onto environment names in memory. The method also does not clear environment related settings (for each environment). So anyone calling `Puppet[:rich_data]` for example could \"see\" the value from the now evicted environment. The {{clear_all}} method is used when Puppet[:rich_data] is set and also in unit tests.\r\n\r\n4. The {{Puppet::Environments::Cached#clear}} method does not remove the environment entry from the {{@expirations}} sorted set and doesn't recalculate the {{@next_expiration}} time, or clear the enviroment related settings. The {{clear}} methods does not appear to be used in puppet, as it was decided earlier to only support a REST API for cache eviction.","closed_at":"2020-12-09T08:39:28.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10713","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-12-09T08:39:28.000-0800","timestamp":1652286466.421552,"priority":"Normal","status_category":"Done","pull_request":8434},{"issue_id":"379059","title":"user provider with uid/gid as Integer raises warning","url":"https://tickets.puppetlabs.com/browse/PUP-10790","created_at":"2020-11-20T15:58:48.000-0800","number":"PUP-10790","body":" \r\n{code:java}\r\n # cat foo.pp \r\nuser { 'user1':\r\n  ensure             => 'present',\r\n  gid                => 10008,\r\n  groups             => ['bla'],\r\n  home               => '/home/user1',\r\n  provider           => 'useradd',\r\n  shell              => '/bin/bash',\r\n  uid                => '10008',\r\n}\r\n\r\n# puppet apply --noop foo.pp\r\nNotice: Compiled catalog for foo in environment production in 0.02 seconds\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type/user.rb:468: warning: deprecated Object#=~ is called on Integer; it always returns nil\r\nNotice: /Stage[main]/Main/User[user1]/ensure: current_value 'absent', should be 'present' (noop)\r\nNotice: Class[Main]: Would have triggered 'refresh' from 1 event Notice: Stage[main]: Would have triggered 'refresh' from 1 event Notice: Applied catalog in 0.41 seconds\r\n{code}\r\n\r\nvs.\r\n\r\n\r\n{code:java}\r\n # cat foo.pp \r\nuser { 'user1':\r\n  ensure             => 'present',\r\n  gid                => '10008',\r\n  groups             => ['bla'],\r\n  home               => '/home/user1',\r\n  provider           => 'useradd',\r\n  shell              => '/bin/bash',\r\n  uid                => '10008',\r\n}\r\n\r\n\r\n # puppet apply --noop foo.pp \r\nNotice: Compiled catalog for foo in environment production in 0.02 seconds\r\nNotice: /Stage[main]/Main/User[user1]/ensure: current_value 'absent', should be 'present' (noop)\r\nNotice: Class[Main]: Would have triggered 'refresh' from 1 event\r\nNotice: Stage[main]: Would have triggered 'refresh' from 1 event\r\nNotice: Applied catalog in 0.42 seconds\r\n{code}","closed_at":"2020-12-14T07:04:02.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10790","labels":"doc_reviewed;platform_7.1","state":"Closed","updated_at":"2020-12-14T07:04:02.000-0800","timestamp":1652286467.032485,"priority":"Normal","status_category":"Done","pull_request":8453},{"issue_id":"349115","title":"server_list is processed once per service not once per session","url":"https://tickets.puppetlabs.com/browse/PUP-10363","created_at":"2020-03-09T15:10:22.000-0700","number":"PUP-10363","body":"In 6.13.0, if puppet is configured to use {{server_list}}, it tries to connect to each entry in the list, stopping at the first HTTP 200 connection to puppetserver's simple status endpoint, and adds the resolved {{server}} and {{port}} into puppet's context, which is then looked up each time a connection is made. Each time connection attempt may result in a 2 minute timeout for each failed connection. The timeout defaults to 2 minutes, but is configurable using the {{http_connect_timeout}} puppet setting.\r\n\r\nIn 6.14.0, puppet will resolve {{server_list}} for {{puppet}}, {{fileserver}} and {{report}} services. This can result in additional delay during the run. So if 6.13.0 was delayed X minutes, then puppet 6.14.0 will be delayed 3X minutes. The exact number depends on how many entries in {{server_list}} fail before a successfully connection is made.","closed_at":"2020-12-22T08:06:55.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10363","labels":"doc_reviewed","state":"Resolved","updated_at":"2020-12-22T08:06:55.000-0800","timestamp":1652286468.260737,"priority":"Normal","status_category":"Done","pull_request":8035},{"issue_id":"290248","title":"provider gem in package type doesn't work anymore when rubygems is >=  3.0.0","url":"https://tickets.puppetlabs.com/browse/PUP-9395","created_at":"2019-01-03T08:06:27.000-0800","number":"PUP-9395","body":"Since version 3.x, gem will not have anymore the 2 params {{\\-\\-no-ri}} and {{\\-\\-no-rdoc}}, that currently are the default params.([https://github.com/puppetlabs/puppet/blob/24ead48f617cd3912491fe419ac7b67cda53a320/lib/puppet/provider/package/gem.rb#L131)] when is used the provider gem in the type package. This should be addressed by adding an option to disable them or override them through the parameter `install_options` already existing in the type package. The version 3.x of rubygems is a constraint since the new bundler major version 2.0.0 dropped support for rubygem older than 3.0.0 : [https://github.com/bundler/bundler/releases/tag/v2.0.0] .\r\n\r\n ","closed_at":"2021-01-04T23:45:01.000-0800","comments":15,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9395","labels":"gem;package;resolved-issue-added;sadness;type_and_provider","state":"Closed","updated_at":"2021-01-04T23:45:01.000-0800","timestamp":1652286468.469437,"priority":"Major","status_category":"Done","pull_request":7320},{"issue_id":"69290","title":"package resource doesn't find new packages in yum repo","url":"https://tickets.puppetlabs.com/browse/PUP-4039","created_at":"2015-02-24T16:06:53.000-0800","number":"PUP-4039","body":"I created a new meta RPM and added it to my yum repo.\r\n\r\nI then added a package resource to install the new RPM.\r\n\r\nThe manifest fails as follows:\r\n\r\n{code}\r\nError: /Stage[main]/Profile_sensu_client::Nagios_plugins/Package[ubnt-meta-nagios-plugins]/ensure: change from absent to present failed: Execution of '/bin/yum -d 0 -e 0 -y list ubnt-meta-nagios-plugins' returned 1: Error: No matching Packages to list\r\n{code}\r\n\r\nThis is because \"yum list\" does not update the yum cache:\r\n{code}\r\n# yum list ubnt-meta-nagios-plugins\r\nLoaded plugins: fastestmirror\r\nLoading mirror speeds from cached hostfile\r\n * base: mirror.solarvps.com\r\n * epel: mirror.cogentco.com\r\n * extras: mirror.us.leaseweb.net\r\n * updates: mirror.steadfast.net\r\nError: No matching Packages to list\r\n{code}\r\n\r\nHowever, if I just try \"yum install\" directly, the cache is updated, and the package is found and installed:\r\n{code}\r\n# yum install ubnt-meta-nagios-plugins\r\nLoaded plugins: fastestmirror\r\nbase                                                                                                                  | 3.6 kB  00:00:00\r\nepel                                                                                                                  | 4.4 kB  00:00:00\r\nextras                                                                                                                | 3.4 kB  00:00:00\r\nforeman                                                                                                               | 2.9 kB  00:00:00\r\nforeman-plugins                                                                                                       | 2.9 kB  00:00:00\r\npuppetlabs-deps                                                                                                       | 2.5 kB  00:00:00\r\npuppetlabs-products                                                                                                   | 2.5 kB  00:00:00\r\nupdates                                                                                                               | 3.4 kB  00:00:00\r\nyo61                                                                                                                  | 2.9 kB  00:00:00\r\n(1/4): foreman-plugins/x86_64/primary_db                                                                              |  49 kB  00:00:00\r\n(2/4): epel/x86_64/primary_db                                                                                         | 4.0 MB  00:00:00\r\n(3/4): yo61/primary_db                                                                                                | 242 kB  00:00:00\r\n(4/4): updates/7/x86_64/primary_db                                                                                    | 6.6 MB  00:00:07\r\n(1/2): epel/x86_64/updateinfo                                                                                         | 288 kB  00:00:00\r\n(2/2): epel/x86_64/pkgtags                                                                                            | 1.4 MB  00:00:00\r\nLoading mirror speeds from cached hostfile\r\n * base: distro.ibiblio.org\r\n * epel: mirror.cogentco.com\r\n * extras: mirror.us.leaseweb.net\r\n * updates: mirror.steadfast.net\r\nResolving Dependencies\r\n--> Running transaction check\r\n---> Package ubnt-meta-nagios-plugins.noarch 0:1.0.0-1 will be installed\r\n--> Finished Dependency Resolution\r\n\r\nDependencies Resolved\r\n\r\n=============================================================================================================================================\r\n Package                                        Arch                         Version                        Repository                  Size\r\n=============================================================================================================================================\r\nInstalling:\r\n ubnt-meta-nagios-plugins                       noarch                       1.0.0-1                        yo61                       3.5 k\r\n\r\nTransaction Summary\r\n=============================================================================================================================================\r\nInstall  1 Package\r\n\r\nTotal download size: 3.5 k\r\nInstalled size: 0\r\nIs this ok [y/d/N]:\r\n{code}\r\n\r\nIt seems there is no way to install the package on this node without manually refreshing the cache in this way.","closed_at":"2021-01-08T09:46:45.000-0800","comments":28,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4039","labels":"community;linux;package;platform-os;redhat;triaged;type_and_provider;yum","state":"Accepted","updated_at":"2021-01-08T09:46:45.000-0800","timestamp":1652286468.579423,"priority":"Normal","status_category":"To Do","pull_request":5699},{"issue_id":"381915","title":"puppet apply creates warnings (since 7.x)","url":"https://tickets.puppetlabs.com/browse/PUP-10845","created_at":"2020-12-30T06:53:14.000-0800","number":"PUP-10845","body":"*Puppet Version:* 7.1.0\r\n*Puppet Server Version:* -\r\n*OS Name/Version:* Windows 10 x64 20H2\r\n\r\nCreate a {{main.pp}} with the following contents (anywhere on your disk):\r\n\r\n{code:puppet}\r\nnode default {\r\n}\r\n{code}\r\n\r\nRun:\r\n\r\n{code}\r\npuppet apply main.pp\r\n{code}\r\n\r\n*Desired Behavior:*\r\n\r\nNo warnings should be shown.\r\n\r\n*Actual Behavior:*\r\n\r\nThe following warnings are displayed:\r\n\r\n{code}\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/pops/model/ast_transformer.rb:34: warning: Using the last argument as keyword parameters is deprecated; maybe ** should be added to the call\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/parser/ast/leaf.rb:29: warning: The called method `initialize' is defined here\r\n{code}\r\n\r\nIf you guys need any additional information, I'd happy to provide them.\r\n","closed_at":"2021-01-13T06:05:07.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10845","labels":"doc_reviewed","state":"Resolved","updated_at":"2021-01-13T06:05:07.000-0800","timestamp":1652286468.786617,"priority":"Normal","status_category":"Done","pull_request":8467},{"issue_id":"381404","title":"Remove Pathname#cleanpath workaround","url":"https://tickets.puppetlabs.com/browse/PUP-10840","created_at":"2020-12-17T11:14:04.000-0800","number":"PUP-10840","body":"Ruby 1.9 Pathname#cleanpath did not work correctly on windows. https://bugs.ruby-lang.org/issues/9618 This was fixed in ruby 2.0. Puppet 6.x requires ruby 2.3 or greater, so we should remove our workaround.","closed_at":"2021-01-13T06:05:53.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10840","labels":"doc_reviewed","state":"Resolved","updated_at":"2021-01-13T06:05:53.000-0800","timestamp":1652286476.888116,"priority":"Normal","status_category":"Done","pull_request":8465},{"issue_id":"147758","title":"Apt package provider does not mark managed packages as manual","url":"https://tickets.puppetlabs.com/browse/PUP-6631","created_at":"2016-08-18T03:06:13.000-0700","number":"PUP-6631","body":"The apt package provider does not mark packages as manual. This means that if a package gets removed, some packages may get marked for deletion if nothing depends on them any longer - even though they should be installed according to Puppet. \r\n\r\nExample:\r\nPuppet purges a package depending on `ethtool`.\r\nNothing depends on `ethtool` any longer, so it gets marked for deletion, but is still installed.\r\nPuppet processes 'package {'ethtool': ensure -> installed}' and does nothing, since it's already installed\r\nIf something or someone then runs `apt-get -y autoremove` the package ethtool will then be removed (in my case puppet does this later in the run). \r\n\r\nThis specific example makes it impossible for Puppet to rectify it in a later run, since the ethtool package is required to bring up the network interface.","closed_at":"2021-01-14T05:17:45.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6631","labels":"debian;doc_reviewed;linux;package;type_and_provider;ubuntu","state":"Resolved","updated_at":"2021-01-14T05:17:45.000-0800","timestamp":1652286477.713744,"priority":"Normal","status_category":"Done","pull_request":7802},{"issue_id":"382201","title":"\"puppet facts show fact\" output differs from \"facter fact\"","url":"https://tickets.puppetlabs.com/browse/PUP-10847","created_at":"2021-01-05T13:07:39.000-0800","number":"PUP-10847","body":"*Puppet Version:* {{7.1}}\r\n*OS Name/Version:* macOS 11.1\r\n\r\nThe output of \"{{puppet facts show _somefact_}}\" is not the same as \"{{facter _somefact_}}\", as it returns JSON, which requires subsequent parsing to get the the fact value.\r\n\r\nWe use \"{{facter --puppet _somefact_}}\" quite a bit in non-puppet code, such as shell and python scripts and other internal management utilities. This is a strongly complicating issue in a migration from facter 3/puppet 6 to facter 4/puppet 7: \"{{facter --puppet}}\" no longer works in Facter 4, and I believe \"{{puppet facts show _somefact_}}\" only works in Puppet 7.\r\n\r\nThis will mean all the various places we use \"{{facter --puppet _somefact_}}\" will have to have a case on the puppet version and then call \"{{facter --puppet _somefact_}}\" or \"{{puppet facts show _somefact_}}\" as appropriate. And we'll have to do extra processing on the output of \"{{puppet facts show}}\", as it sends JSON.\r\n\r\n*Desired Behavior:*\r\n{quote}\r\n$ puppet facts show facterversion\r\n4.0.47\r\n$ facter facterversion\r\n4.0.47\r\n{quote}\r\n\r\n*Actual Behavior:*\r\n{quote}\r\n$ puppet facts show facterversion\r\n\\{\r\n  \"facterversion\": \"4.0.47\"\r\n}\r\n$ facter facterversion\r\n4.0.47\r\n{quote}\r\n","closed_at":"2021-01-20T02:22:06.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10847","labels":"doc_reviewed","state":"Resolved","updated_at":"2021-01-20T02:22:06.000-0800","timestamp":1652286478.424087,"priority":"Normal","status_category":"Done","pull_request":8469},{"issue_id":"358891","title":"sshkeys_core 2.0.0 cannot purge sshkey resources","url":"https://tickets.puppetlabs.com/browse/PUP-10510","created_at":"2020-05-14T12:00:20.000-0700","number":"PUP-10510","body":"*Puppet Version:* 6.15.0\r\n *Puppet Server Version:* 6.11.0\r\n *OS Name/Version:* CentOS / Debian\r\n\r\nAfter updating the sshkeys_core module to 2.0.0 in our control repo, puppet is unable to purge sshkeys. We use the following configuration to export each host SSH keys and collect them on some of our nodes:\r\n\r\n{code:puppet}\r\n # in site.pp\r\nresources { 'sshkey':\r\n  purge => true\r\n}\r\n{code}\r\n\r\n{code:puppet}\r\n# on each node ($host_aliases is an array of the names of the node)\r\n@@sshkey { \"sshdsakey-${host_aliases[0]}\":\r\n  host_aliases => $host_aliases,\r\n  type => 'ssh-dss',\r\n  key => $facts['ssh']['dsa']['key'],\r\n}\r\n{code}\r\n\r\n{code:puppet}\r\n # on some nodes\r\nSshkey <<| |>>\r\n{code}\r\n\r\nDowngrading to sshkeys_core 1.0.3 fix the issue.\r\n\r\n*Desired Behavior:*\r\n When a node is decomissioned, it's SSH key should be removed from the known_hosts file of the node collecting the ssh keys.\r\n\r\n*Actual Behavior:*\r\n Puppet says it removes the key, but it's not actually done. So the configuration never converge, at each run Puppet says it remove the key.","closed_at":"2021-01-20T06:17:09.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10510","labels":"","state":"Resolved","updated_at":"2021-01-20T06:17:09.000-0800","timestamp":1652286478.532711,"priority":"Normal","status_category":"Done","pull_request":8174},{"issue_id":"382858","title":"Puppet facts show doesn't have an option to opt out of legacy facts","url":"https://tickets.puppetlabs.com/browse/PUP-10850","created_at":"2021-01-11T07:34:06.000-0800","number":"PUP-10850","body":"*Puppet Version: 7.0.1*\r\n *Puppet Server Version: -* \r\n *OS Name/Version: All*\r\n\r\nBy default\r\n{noformat}\r\npuppet facts show{noformat}\r\ndisplays legacy facts, there is an option (--show-legacy) that has no effect. There isn't any way to indicate puppet to not retrieve legacy facts.\r\n\r\n*Desired Behavior:*\r\n\r\n By default {{puppet facts show}} does not display legacy facts, but they may be displayed using {{puppet facts show --show-legacy}}\r\n\r\n ","closed_at":"2021-01-21T15:15:36.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10850","labels":"doc_reviewed","state":"Resolved","updated_at":"2021-01-21T15:15:36.000-0800","timestamp":1652286479.738365,"priority":"Normal","status_category":"Done","pull_request":8482},{"issue_id":"18323","title":"Namevar over 1024 characters is not caught and results in invalid yaml with accompanying errors","url":"https://tickets.puppetlabs.com/browse/PUP-684","created_at":"2013-11-06T11:41:29.000-0800","number":"PUP-684","body":"Puppet resources with namevars over 1024 characters result in the generation of invalid yaml.\r\n\r\nFor example, this nonsense resource:\r\n\r\n\tssh_authorized_key { 'ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff':\r\n\tensure => present,\r\n\tuser => 'root',\r\n\ttype => 'rsa',\r\n\tkey => 'foo',\r\n\t}\r\n\r\nResults in the following: \r\n\r\n\t[root@pe-301-master pe-301-master.puppetdebug.vlan]# puppet agent --test\r\n    ...\r\n\tInfo: Applying configuration version '1380664174'\r\n\tNotice: /Stage[main]//Ssh_authorized_key[ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff]/ensure: created\r\n\tInfo: Creating state file /var/opt/lib/pe-puppet/state/state.yaml\r\n\tNotice: Finished catalog run in 8.37 seconds\r\n\tError: Could not send report: Error 400 on SERVER: (<unknown>): could not find expected ':' while scanning a simple key at line 1314 column 5\r\n\t\r\nAll future runs are prevented at that point, until you remove the state.yaml file:\r\n\r\n\t[root@pe-301-master pe-301-master.puppetdebug.vlan]# puppet agent --test\r\n\tError: Could not run Puppet configuration client: (<unknown>): could not find expected ':' while scanning a simple key at line 441 column 3\r\n\tError: Could not run: can't convert Puppet::Util::Log into Integer\r\n\t\r\nand then:\r\n\r\n\troot@pe-301-master pe-301-master.puppetdebug.vlan]# rm /var/opt/lib/pe-puppet/state/state.yaml\r\n\trm: remove regular file `/var/opt/lib/pe-puppet/state/state.yaml'? y\r\n\t[root@pe-301-master pe-301-master.puppetdebug.vlan]# /opt/puppet/bin/puppet agent --test\r\n\tInfo: Retrieving plugin\r\n\tInfo: Loading facts in /opt/puppet/share/puppet/modules/stdlib/lib/facter/pe_version.rb\r\n\tInfo: Loading facts in /opt/puppet/share/puppet/modules/stdlib/lib/facter/facter_dot_d.rb\r\n\tInfo: Loading facts in /opt/puppet/share/puppet/modules/stdlib/lib/facter/puppet_vardir.rb\r\n\tInfo: Loading facts in /opt/puppet/share/puppet/modules/stdlib/lib/facter/root_home.rb\r\n\t…\r\n\tInfo: Caching catalog for pe-301-master.puppetdebug.vlan\r\n\tInfo: Applying configuration version '1380664174'\r\n\tInfo: Creating state file /var/opt/lib/pe-puppet/state/state.yaml\r\n\tNotice: Finished catalog run in 17.62 seconds\r\n\tError: Could not send report: Error 400 on SERVER: (<unknown>): could not find expected ':' while scanning a simple key at line 1302 column 5\r\n\t\r\nWhile obviously having a 1024+ character namevar is a bad idea, it shouldn't be SO bad that it prevents all future puppet runs from proceeding. \r\n\r\nNote: The namevar actually needs to be slightly less than 1024 chars to trigger this, since it ends up padded a bit in the yaml key, and then breaks 1024, even if the namevar itself isn't quite 1024 chars.\r\n\r\nOne real-world example of this is that the pe_accounts module we supply with PE has defined types that generate ssh trusted key resources, with the ssh keys themselves as the namevars. This results in very long namevars in some cases, with the above problem.\r\n\r\nThe issue is that the namevar gets set as the key of a hash in, for example, state.yaml, and the YAML spec restricts hash key length to 1024 chars.\r\n\r\nThis appears to have not been enforced in Ruby 1.8.7, but is in 1.9.3, and is now affecting users.","closed_at":"2021-01-26T12:25:50.000-0800","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-684","labels":"customer;redmine","state":"Closed","updated_at":"2021-01-26T12:25:50.000-0800","timestamp":1652286480.718189,"priority":"Normal","status_category":"Done","pull_request":5350},{"issue_id":"381531","title":"Issue with puppet creating production folder when multiple environment paths are set","url":"https://tickets.puppetlabs.com/browse/PUP-10842","created_at":"2020-12-21T04:05:53.000-0800","number":"PUP-10842","body":"*Tested on the below but likely occurs in every version since PUP-2519 was added*\r\n\r\n*Puppet Version:* 5.5.22**\r\n *Puppet Server Version: 2018.1.18*\r\n *OS Name/Version: centos7*\r\n\r\nAdd environmentpath setting to puppet.conf with multiple paths set.\r\n\r\nE.g:\r\n\r\nenvironmentpath = /home/puppet/projects:/etc/puppetlabs/code/environments\r\n\r\nPuppet will create an empty folder production under /home/puppet/projects resulting in /etc/puppetlabs/code/environments/production getting ignored and no classes getting picked up for production\r\n\r\n*Desired Behavior:*\r\n\r\nPuppet should check all environment paths for a production folder before creating one.\r\n\r\n*Actual Behavior:*\r\n\r\n Puppet creates a production folder the first environment path and ignores the 2nd","closed_at":"2021-01-26T22:50:44.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10842","labels":"doc_reviewed;jira_escalated","state":"Resolved","updated_at":"2021-01-26T22:50:44.000-0800","timestamp":1652286482.025582,"priority":"Major","status_category":"Done","pull_request":8481},{"issue_id":"144507","title":"The `site:modules:$basemodulepath` pattern should be default","url":"https://tickets.puppetlabs.com/browse/PUP-6572","created_at":"2016-08-02T10:26:39.000-0700","number":"PUP-6572","body":"For a very long time, CS has been recommending and educating the\r\n`modulepath = site:modules:$basemodulepath` pattern via\r\n`environment.conf`. It's now codified as a CS standard:\r\n\r\nhttps://github.com/puppetlabs/cs-standards/blob/master/control_repo_contents.md#directory-structure-and-contents\r\n\r\nIt's always felt a bit weird to be explaining to people why the best\r\npractice wasn't the Puppet default, so how about we make it the default?\r\nThis should not impact existing users unless they're currently using\r\n`$environment/site` for other purposes, and I'd wager that percentage is\r\nrather low.","closed_at":"2021-01-27T10:17:10.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6572","labels":"","state":"Accepted","updated_at":"2021-01-27T10:17:10.000-0800","timestamp":1652286483.339603,"priority":"Normal","status_category":"To Do","pull_request":5165},{"issue_id":"341316","title":"PObjectTypeExtension doesn't implement implementation_class","url":"https://tickets.puppetlabs.com/browse/PUP-10221","created_at":"2020-01-07T09:02:15.000-0800","number":"PUP-10221","body":"*Puppet Version:* 6.11.1\r\n*Puppet Server Version:*\r\n*OS Name/Version:* Ubuntu 16.04\r\n\r\nThe PObjectTypeExtension, which wraps PObjectType, does not implement the implementation_class method to get the underlying PObjectType implementation class. This raises an error when serializing Puppet::Datatypes::Error objects to pcore.\r\n","closed_at":"2021-01-27T10:43:10.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10221","labels":"resolved-issue-added","state":"Resolved","updated_at":"2021-01-27T10:43:10.000-0800","timestamp":1652286483.663838,"priority":"Normal","status_category":"Done","pull_request":7908},{"issue_id":"349628","title":"Checksums not validated when downloading file http(s):// sources","url":"https://tickets.puppetlabs.com/browse/PUP-10368","created_at":"2020-03-13T09:08:57.000-0700","number":"PUP-10368","body":"*Puppet Version:* all\r\n*OS Name/Version:* all\r\n\r\nWhen using a File resource with an http(s) source type and a checksum_value, Puppet does not validate that the content it downloads and puts into place matches the mandated checksum. This can cause Puppet to repeatedly re-download the file on every run, constantly reporting success, when in fact it is failing to retrieve the expected content.\r\n\r\nAssume the following manifest.\r\n\r\n{code}\r\nfile { '/tmp/file':\r\n  ensure         => file,\r\n  source         => 'http://httpstat.us/200',\r\n  checksum       => 'sha256',\r\n  checksum_value => 'ea8fac7c65fb589b0d53560f5251f74f9e9b243478dcb6b3ea79b5e36449c8d9',\r\n  #checksum_value => 'f9bafc82ba5f8fb02b25020d66f396860604f496ca919480147fa525cb505d88',\r\n}\r\n{code}\r\n\r\nLet the commented-out f9bafc8 checksum be correct, and ea8fac7 be incorrect.\r\n\r\n*Desired Behavior:*\r\n\r\nWhen Puppet applies this manifest and downloads f9bafc8 from http://httpstat.us/200, it should report failure. The content does not match the checksum_value parameter ea8fac7.\r\n\r\n*Actual Behavior:*\r\n\r\nWhen Puppet applies this manifest, it saves the f9bafc8 file and reports success. On subsequent runs it observes that the f9bafc8 content is present, does not match the required ea8fac7, re-downloads the f9bafc8 content from http://httpstat.us/200, and reports a successful change. It incorrectly reports that it changed the file content to ea8fac7.\r\n\r\nThe current behavior for three consecutive Puppet runs is shown below.\r\n\r\n{code}\r\n[reidmv@reids-mbp:~/Workspace/tmp/puppet-code/] % puppet apply test.pp\r\nNotice: Compiled catalog for reids-macbook-pro.local in environment production in 0.02 seconds\r\nNotice: /Stage[main]/Main/File[/tmp/file]/ensure: created\r\nNotice: Applied catalog in 0.50 seconds\r\n[reidmv@reids-mbp:~/Workspace/tmp/puppet-code/] % puppet apply test.pp\r\nNotice: Compiled catalog for reids-macbook-pro.local in environment production in 0.02 seconds\r\nNotice: /Stage[main]/Main/File[/tmp/file]/checksum_value: checksum_value changed 'f9bafc8...' to 'ea8fac7...'\r\nNotice: Applied catalog in 0.67 seconds\r\n[reidmv@reids-mbp:~/Workspace/tmp/puppet-code/] % puppet apply test.pp\r\nNotice: Compiled catalog for reids-macbook-pro.local in environment production in 0.02 seconds\r\nNotice: /Stage[main]/Main/File[/tmp/file]/checksum_value: checksum_value changed 'f9bafc8...' to 'ea8fac7...'\r\nNotice: Applied catalog in 0.52 seconds\r\n{code}\r\n","closed_at":"2021-01-27T18:06:49.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10368","labels":"doc_reviewed","state":"Resolved","updated_at":"2021-01-27T18:06:49.000-0800","timestamp":1652286484.199665,"priority":"Normal","status_category":"Done","pull_request":8211},{"issue_id":"219777","title":"Certificate signing request using sha384, sha512 spec test fail","url":"https://tickets.puppetlabs.com/browse/PUP-8110","created_at":"2017-10-31T13:39:42.000-0700","number":"PUP-8110","body":"We recently added support for following FIPS approved hash algorithms: SHA384, SHA512, SHA224. See PUP-8021\r\n\r\nRelevant spec tests were updated to exercise these new algorithms. However it was found that tests for signing certificate requests using either of sha384 or sha512 fail when run from within spec. Equivalent code when run as a ruby script works fine. \r\n\r\nThis currently is not an issue or is blocking any functionality or flows. However should be investigated and resolved. ","closed_at":"2021-02-01T08:29:07.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8110","labels":"","state":"Resolved","updated_at":"2021-02-01T08:29:07.000-0800","timestamp":1652286484.968535,"priority":"Minor","status_category":"Done","pull_request":8498},{"issue_id":"385148","title":"puppet facts show --value-only should not display a quoted value","url":"https://tickets.puppetlabs.com/browse/PUP-10861","created_at":"2021-01-27T09:35:49.000-0800","number":"PUP-10861","body":"When using --value-only to retrieve the value of a fact, the output is quoted:\r\n\r\n{noformat}\r\n[root@void-musicality ~]# puppet facts show os.name --value-only\r\n\"RedHat\"\r\n{noformat}\r\n\r\nIt should return the unquoted value so that the output can easily be consumed by external automation.","closed_at":"2021-02-05T01:07:31.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10861","labels":"doc_reviewed","state":"Resolved","updated_at":"2021-02-05T01:07:31.000-0800","timestamp":1652286485.853921,"priority":"Normal","status_category":"Done","pull_request":8500},{"issue_id":"383327","title":"Slower puppet agent run after agent upgrade to version 6","url":"https://tickets.puppetlabs.com/browse/PUP-10856","created_at":"2021-01-14T23:56:53.000-0800","number":"PUP-10856","body":"Puppet agent run after upgrading to v6 is taking longer. It’s consistent observation across our all environments. Puppet server was already at v6. So the agent version is the only change. ","closed_at":"2021-02-08T08:48:31.000-0800","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10856","labels":"doc_reviewed","state":"Resolved","updated_at":"2021-02-08T08:48:31.000-0800","timestamp":1652286486.499484,"priority":"Blocker","status_category":"Done","pull_request":8497},{"issue_id":"386956","title":"Puppet users with forcelocal are no longer idempotent","url":"https://tickets.puppetlabs.com/browse/PUP-10896","created_at":"2021-02-10T05:36:27.000-0800","number":"PUP-10896","body":"*Puppet Version:* 7.4.0 and 6.21.0\r\n*Puppet Server Version:* Masterless to demonstrate issue\r\n*OS Name/Version:* CentOS 7\r\n\r\nDefining a `forcelocal` user results in Puppet constantly wanting to change the GID for the user.\r\n\r\n*Desired Behavior:*\r\n\r\nIdempotent apply of forcelocal user.\r\n\r\n\r\n*Actual Behavior:*\r\n\r\n\r\n{noformat}\r\n[root@23aff6d4a202 /]# cat user-group.pp \r\nuser { 'keycloak':\r\n  ensure     => 'present',\r\n  name       => 'keycloak',\r\n  forcelocal => true,\r\n  shell      => '/sbin/nologin',\r\n  gid        => 'keycloak',\r\n  uid        => undef,\r\n  home       => '/var/lib/keycloak',\r\n  managehome => true,\r\n  system     => true,\r\n}\r\ngroup { 'keycloak':\r\n  ensure     => 'present',\r\n  name       => 'keycloak',\r\n  forcelocal => true,\r\n  gid        => undef,\r\n  system     => true,\r\n}\r\n[root@23aff6d4a202 /]# puppet apply user-group.pp \r\nNotice: Compiled catalog for 23aff6d4a202 in environment production in 0.01 seconds\r\nNotice: /Stage[main]/Main/Group[keycloak]/ensure: created\r\nNotice: /Stage[main]/Main/User[keycloak]/ensure: created\r\nNotice: Applied catalog in 0.04 seconds\r\n[root@23aff6d4a202 /]# puppet apply user-group.pp \r\nNotice: Compiled catalog for 23aff6d4a202 in environment production in 0.01 seconds\r\nNotice: /Stage[main]/Main/User[keycloak]/gid: gid changed '13' to 'keycloak'\r\nNotice: Applied catalog in 0.02 seconds\r\n\r\n{noformat}\r\n\r\nI am fairly certain the issue resides in this change: https://tickets.puppetlabs.com/browse/PUP-10857","closed_at":"2021-02-15T17:16:19.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10896","labels":"doc_reviewed","state":"Resolved","updated_at":"2021-02-15T17:16:19.000-0800","timestamp":1652286497.654035,"priority":"Major","status_category":"Done","pull_request":8512},{"issue_id":"203766","title":"HTTPS file sources with non-puppet-trusted certs can't be used","url":"https://tickets.puppetlabs.com/browse/PUP-7814","created_at":"2017-08-02T14:51:11.000-0700","number":"PUP-7814","body":"In [PUP-1072] we added support for http and https URL schemes for {{file}} resources' {{source}} attributes:\r\n\r\n{code}\r\nfile { '/tmp/myfile':\r\n  source => 'https://myserver/myfile'\r\n}\r\n{code}\r\n\r\n*UPDATED*\r\n\r\n1. The above works provided the CA certificate that issued the server's certificate is in the [CA bundle distributed|https://github.com/puppetlabs/puppet-ca-bundle] in puppet-agent packages. There are workarounds to add certificates to puppet's cert bundle, but those workarounds are lost when the puppet-agent package is updated.\r\n\r\n2. As of Puppet 6.15.0 puppet will trust the puppet CA in addition to puppet's CA bundle when retrieving file metadata and content via https file sources. So the issue [~chuck] described with {{source => \"https://${server_facts['servername']}:8140//puppet-ca/v1/certificate/ca?environment=production\"}} will be resolved.\r\n\r\n3. This ticket is about a) creating a puppet setting referring to a directory or file containing system CA certs, and b) modifying the {{Puppet::SSL::SSLProvider#create_system_context}} method so that the system CA certs are added to the X509 store via {{OpenSSL::X509::Store#add_path}} (for a directory) or {{OpenSSL::X509::Store#add_file}} (for a file).\r\n\r\n*Original*\r\n\r\nSomehow we failed to realize that the implementation of this feature requires that the remote webserver present a certificate that is trusted by the puppet agent's SSL configuration. In practice this is extremely unlikely and difficult to configure, and therefore the utility of this feature is pretty limited.\r\n\r\nIn the code, this is because the request ultimately uses the same routines (in {{Puppet::Util::HttpProxy.get_http_object}}) that the agent itself uses, where the SSL verification mode is hardcoded but the certificate store is not.\r\n\r\nThere should be some way to permit retrieval of these files. A couple of options that occured to me as I was tracing this down:\r\n\r\n1.  make the ssl verification mode configurable or disabled by default for file-source retrieval (equivalent to {{curl -k}})\r\n2. use the system-wide trust store instead of puppet's store\r\n3. expose the certificate trust and verification mode as parameters on the file type (this is truly awful)\r\n\r\n... surely someone else has better ideas ...","closed_at":"2021-02-15T22:21:08.000-0800","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7814","labels":"doc_reviewed;jira_escalated","state":"Resolved","updated_at":"2021-02-15T22:21:08.000-0800","timestamp":1652286497.760775,"priority":"Normal","status_category":"Done","pull_request":8170},{"issue_id":"324095","title":"pip provider doesn't handle arbitrary equality","url":"https://tickets.puppetlabs.com/browse/PUP-10015","created_at":"2019-09-09T14:39:21.000-0700","number":"PUP-10015","body":"*Puppet Version: 5.5.6*\r\n *Puppet Server Version: 5.3.5*\r\n *OS Name/Version: Ubuntu 18.04*\r\n\r\nThe current pip provider doesn't support Python's arbitrary equality [https://www.python.org/dev/peps/pep-0440/#arbitrary-equality]\r\n\r\nWhen encountering a python package specified with arbitrary equality via pip freeze, it fails to parse the package and keeps trying to install it\r\n\r\ne.g.\r\n\r\n$ pip freeze | grep pytz\r\n\r\npytz===2012f\r\n\r\n*Desired Behavior: Pip Provider correctly handles arbitrary equality*\r\n\r\n*Actual Behavior: Pip Provider incorrectly handles arbitrary equality*\r\n\r\n ","closed_at":"2021-02-16T12:24:50.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10015","labels":"resolved-issue-added","state":"Resolved","updated_at":"2021-02-16T12:24:50.000-0800","timestamp":1652286498.382929,"priority":"Normal","status_category":"Done","pull_request":7713},{"issue_id":"360365","title":"Puppet windows package provider fails if there are garbage characters after an embedded NULL","url":"https://tickets.puppetlabs.com/browse/PUP-10536","created_at":"2020-05-28T12:54:12.000-0700","number":"PUP-10536","body":"Puppet scans the registry when retrieving the list of currently installed packages. If one of the registry values it scans contains an embedded null followed by garbage, then puppet will try to transcode from UTF-16LE to UTF-8 and may fail.\r\n\r\nA fix for the embedded NULL problem was made in PUP-9639. However, it only works if transcoding succeeds.\r\n\r\nWhen reading package names, versions, etc from the registry puppet should read up to the first wide null or the length of the string, whichever comes first, and remove the sanitize method.\r\n\r\nIf there is a problem reading one of the whitelisted keys, it should print the name of the key in the error message.\r\n\r\nTo reproduce, import the following registry file whose {{DisplayVersion}} is corrupt and try to run puppet:\r\n{noformat}C:\\ProgramData\\PuppetLabs>type C:\\Users\\Administrator\\Documents\\test.reg\r\nWindows Registry Editor Version 5.00\r\n\r\n[HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\PUP10536]\r\n\"DisplayName\"=\"PUP10536\"\r\n\"DisplayVersion\"=hex(2):31,0,36,0,2e,0,30,0,2e,0,31,0,30,0,33,0,35,0,37,0,2e,0,32,0,30,0,30,0,30,0,32,0,0,0,0,0,0,0,0,0,f3,23,8a,bc,fa,7f,0,0,10,65,74,b9,fa,7f,0,0,90,d8,55,6f,59,0,0,0\r\n\r\nC:\\ProgramData\\PuppetLabs>reg import C:\\Users\\Administrator\\Documents\\test.reg\r\nThe operation completed successfully.\r\n\r\nC:\\ProgramData\\PuppetLabs>puppet resource package --trace\r\nError: Could not run: \"\\x90\\xD8\" followed by \"Uo\" on UTF-16LE\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/api_types.rb:59:in `encode'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/api_types.rb:59:in `read_wide_string'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:237:in `block in read'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:281:in `block (3 levels) in query_value_ex'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:268:in `initialize'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:268:in `new'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:268:in `block (2 levels) in query_value_ex'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:263:in `initialize'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:263:in `new'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:263:in `block in query_value_ex'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:262:in `initialize'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:262:in `new'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:262:in `query_value_ex'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:225:in `read'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:81:in `block (2 levels) in values_by_name'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/api_types.rb:29:in `block in from_string_to_wide_string'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/api_types.rb:25:in `initialize'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/api_types.rb:25:in `new'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/api_types.rb:25:in `from_string_to_wide_string'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:79:in `block in values_by_name'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:78:in `each'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:78:in `values_by_name'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/package/windows/package.rb:49:in `block (5 levels) in with_key'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:28:in `block in open'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/2.5.0/win32/registry.rb:439:in `open'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/2.5.0/win32/registry.rb:546:in `open'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:27:in `open'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/package/windows/package.rb:48:in `block (4 levels) in with_key'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:51:in `block in each_key'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:49:in `loop'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:49:in `each_key'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/package/windows/package.rb:47:in `block (3 levels) in with_key'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:28:in `block in open'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/2.5.0/win32/registry.rb:439:in `open'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/2.5.0/win32/registry.rb:546:in `open'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/windows/registry.rb:27:in `open'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/package/windows/package.rb:46:in `block (2 levels) in with_key'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/package/windows/package.rb:43:in `each'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/package/windows/package.rb:43:in `block in with_key'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/package/windows/package.rb:42:in `each'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/package/windows/package.rb:42:in `with_key'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/package/windows/package.rb:25:in `each'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/package/windows.rb:36:in `map'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/package/windows.rb:36:in `instances'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/type.rb:1205:in `block in instances'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/type.rb:1204:in `collect'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/type.rb:1204:in `instances'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/indirector/resource/ral.rb:24:in `search'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:299:in `search'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/application/resource.rb:228:in `find_or_save_resources'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/application/resource.rb:142:in `block in main'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/context.rb:62:in `override'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet.rb:290:in `override'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/application/resource.rb:137:in `main'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/application.rb:390:in `run_command'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/application.rb:382:in `block in run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util.rb:710:in `exit_on_fail'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/application.rb:382:in `run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:143:in `run'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:77:in `execute'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/bin/puppet:4:in `<main>'\r\n{noformat}","closed_at":"2021-02-26T07:34:32.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10536","labels":"doc_reviewed;jira_escalated","state":"Closed","updated_at":"2021-02-26T07:34:32.000-0800","timestamp":1652286500.826493,"priority":"Normal","status_category":"Done","pull_request":8183},{"issue_id":"125405","title":"Unable to install a Ruby gem to non-Puppet Ruby stack using the package resource type on Windows","url":"https://tickets.puppetlabs.com/browse/PUP-6134","created_at":"2016-04-06T16:45:58.000-0700","number":"PUP-6134","body":"Puppet is unable to install a Ruby gem into anything other than Puppet's Ruby stack on Windows nodes.\r\n\r\nh2. Example of the issue\r\nFor example, say I want to install the {{puppet-lint}} gem so that I can validate Puppet code while writing modules. Normally, I'd install Ruby from http://rubyinstaller.org/ then run {{gem install puppet-lint}}. But, let's say I wanted to automate that process using Puppet! First, I would install Chocolatey then use Chocolatey to install Ruby:\r\n{code}\r\ninclude chocolatey\r\npackage { 'ruby':\r\n  ensure   => present,\r\n  provider => 'chocolatey',\r\n  require  => Class['chocolatey'],\r\n}\r\n{code}\r\n\r\nThen I'd use the gem provider to install puppet-lint:\r\n{code}\r\npackage { 'puppet-lint':\r\n  ensure   => present,\r\n  provider => 'gem',\r\n  require  => Package['ruby'],\r\n}\r\n{code}\r\n\r\nA {{--debug}} log of that package installation looks like this:\r\n{code}\r\nC:\\Users\\Administrator>puppet resource package puppet-lint ensure=present provider=gem --debug\r\n(... removing Facter resolution messages ...)\r\nDebug: /Package[puppet-lint]: Provider gem does not support features virtual_packages; not managing attribute allow_virtual\r\nDebug: Loaded state in 0.03 seconds\r\nDebug: Evicting cache entry for environment 'production'\r\nDebug: Caching environment 'production' (ttl = 0 sec)\r\nDebug: Evicting cache entry for environment 'production'\r\nDebug: Caching environment 'production' (ttl = 0 sec)\r\nDebug: Evicting cache entry for environment 'production'\r\nDebug: Caching environment 'production' (ttl = 0 sec)\r\nDebug: Evicting cache entry for environment 'production'\r\nDebug: Caching environment 'production' (ttl = 0 sec)\r\nDebug: Failed to load library 'selinux' for feature 'selinux'\r\nDebug: Prefetching gem resources for package\r\nDebug: Executing: 'C:/Program Files/Puppet Labs/Puppet/sys/ruby/bin/gem.bat list --local'\r\nDebug: Finishing transaction 39019400\r\nDebug: Storing state\r\nDebug: Stored state in 0.05 seconds\r\npackage { 'puppet-lint':\r\n  ensure => ['1.1.0'],\r\n}\r\n{code}\r\n\r\nAfter doing this, the {{puppet-lint}} executable is not available in %PATH%, and {{gem list}} doesn't show puppet-lint as installed:\r\n{code}\r\nC:\\Users\\Administrator>puppet-lint\r\n'puppet-lint' is not recognized as an internal or external command,\r\noperable program or batch file.\r\nC:\\Users\\Administrator>gem list\r\n\r\n*** LOCAL GEMS ***\r\n\r\nbigdecimal (1.2.6)\r\nio-console (0.4.3)\r\njson (1.8.1)\r\nminitest (5.4.3)\r\npower_assert (0.2.2)\r\npsych (2.0.8)\r\nrake (10.4.2)\r\nrdoc (4.2.0)\r\ntest-unit (3.0.8)\r\n\r\nC:\\Users\\Administrator>\r\n{code}\r\n\r\n*But*, if I use's Puppet's {{gem}} command, I see that puppet-lint got installed into Puppet's Ruby stack:\r\n{code}\r\nC:\\Users\\Administrator>\"C:\\Program Files\\Puppet Labs\\Puppet\\sys\\ruby\\bin\\gem.bat\" list\r\n\r\n*** LOCAL GEMS ***\r\n\r\nbigdecimal (1.2.4)\r\ndeep_merge (1.0.1)\r\nffi (1.9.10 x64-mingw32)\r\nio-console (0.4.3, 0.4.2)\r\njson (1.8.1)\r\nminitar (0.5.4)\r\nminitest (4.7.5)\r\npsych (2.0.5)\r\npuppet-lint (1.1.0)\r\nrake (10.1.0)\r\nrdoc (4.1.0)\r\nstomp (1.3.3)\r\ntest-unit (2.1.8.0, 2.1.7.0, 2.1.6.0, 2.1.5.0)\r\nwin32-dir (0.4.9)\r\nwin32-eventlog (0.6.2)\r\nwin32-process (0.7.4)\r\nwin32-security (0.2.5)\r\nwin32-service (0.8.6)\r\n{code}\r\n\r\nh2. Likely Cause\r\nPuppet is putting its bin directory at the start of %PATH% during all invocations of {{puppet}}, which causes the {{gem}} provider to find Puppet's gem command rather than the gem command I installed via chocolatey.\r\nThis is happening in {{environment.bat}} which {{puppet.bat}} always invokes:\r\n{code}\r\n...\r\nSET PATH=%PUPPET_DIR%\\bin;%FACTERDIR%\\bin;%HIERA_DIR%\\bin;%MCOLLECTIVE_DIR%\\bin;%PL_BASEDIR%\\bin;%PL_BASEDIR%\\sys\\ruby\\bin;%PL_BASEDIR%\\sys\\tools\\bin;%PATH%\r\n...\r\n{code}\r\n\r\nOn the command line, I can install gems into my Ruby stack from Chocolatey without issue:\r\n{code}\r\nC:\\Users\\Administrator>where gem\r\nC:\\tools\\ruby22\\bin\\gem\r\nC:\\tools\\ruby22\\bin\\gem.bat\r\n\r\nC:\\Users\\Administrator>gem install gist\r\nFetching: gist-4.5.0.gem (100%)\r\nSuccessfully installed gist-4.5.0\r\nParsing documentation for gist-4.5.0\r\nInstalling ri documentation for gist-4.5.0\r\nDone installing documentation for gist after 0 seconds\r\n1 gem installed\r\n\r\nC:\\Users\\Administrator>gem list --local\r\n\r\n*** LOCAL GEMS ***\r\n\r\nbigdecimal (1.2.6)\r\ngist (4.5.0)\r\nio-console (0.4.3)\r\njson (1.8.1)\r\nminitest (5.4.3)\r\npower_assert (0.2.2)\r\npsych (2.0.8)\r\nrake (10.4.2)\r\nrdoc (4.2.0)\r\ntest-unit (3.0.8)\r\n{code}\r\n\r\nBut when Puppet runs, the %PATH% gets re-written to have Puppet's BIN dir at the start:\r\n{code}\r\nC:\\Users\\Administrator>echo %PATH%\r\nC:\\ProgramData\\chocolatey\\bin;C:\\tools\\ruby22\\bin;C:\\Windows\\system32;C:\\Windows;C:\\Windows\\System32\\Wbem;C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\;C:\\Program Files (x86)\\Git\\cmd;C:\\Program Files (x86)\\Git\\bin;C:\\Program Files\\Puppet Labs\\Puppet\\bin\r\n\r\nC:\\Users\\Administrator>puppet apply -e \"notice($::path)\"\r\nNotice: Scope(Class[main]): C:/Program Files/Puppet Labs/Puppet/facter/bin;C:\\Program Files\\Puppet Labs\\Puppet\\puppet\\bin;C:\\Program Files\\Puppet Labs\\Puppet\\facter\\bin;C:\\Program Files\\Puppet Labs\\Puppet\\hiera\\bin;C:\\Program Files\\Puppet Labs\\Puppet\\mcollective\\bin;C:\\Program Files\\Puppet Labs\\Puppet\\bin;C:\\Program Files\\Puppet Labs\\Puppet\\sys\\ruby\\bin;C:\\Progr\r\nam Files\\Puppet Labs\\Puppet\\sys\\tools\\bin;C:\\ProgramData\\chocolatey\\bin;C:\\tools\\ruby22\\bin;C:\\Windows\\system32;C:\\Windows;C:\\Windows\\System32\\Wbem;C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\;C:\\Program Files (x86)\\Git\\cmd;C:\\Program Files (x86)\\Git\\bin;C:\\Program Files\\Puppet Labs\\Puppet\\bin\r\nNotice: Compiled catalog for pe-201533-agent-win2012 in environment production in 0.03 seconds\r\nNotice: Applied catalog in 0.09 seconds\r\n{code}","closed_at":"2021-03-01T15:11:24.000-0800","comments":22,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6134","labels":"cs_pr_review;customer;gem;package;provider;windows","state":"Resolved","updated_at":"2021-03-01T15:11:24.000-0800","timestamp":1652286501.042112,"priority":"Normal","status_category":"Done","pull_request":5814},{"issue_id":"380551","title":"Cached catalog contains the result of deferred evaluation instead of the deferred function","url":"https://tickets.puppetlabs.com/browse/PUP-10818","created_at":"2020-12-09T11:29:11.000-0800","number":"PUP-10818","body":"The cached catalog contains the result of evaluating the deferred function, instead of the function. So if the agent applies a cached catalog, it will always apply the result of the deferred function when the cached catalog was saved instead of when the agent runs.\r\n\r\nTo reproduce, create:\r\n{code:puppet}cat /etc/puppetlabs/code/environments/production/manifests/site.pp\r\n$epp_var = {\r\n  'deferred_function' => Deferred('to_yaml', [{'test' => 'foo'}])\r\n}\r\nfile { '/tmp/deferred_function.txt':\r\n  content => Deferred('inline_epp', ['<%= $deferred_function -%>', $epp_var]),\r\n}\r\n{code}\r\nIn 6.11.0, we correctly cache the deferred function:\r\n{noformat}$ cat ~/.puppetlabs/opt/puppet/cache/client_data/catalog/$(facter fqdn).json| jq .\r\n...\r\n  {\r\n      \"type\": \"File\",\r\n      \"title\": \"/tmp/deferred_function.txt\",\r\n      \"tags\": [\r\n        \"file\",\r\n        \"class\"\r\n      ],\r\n      \"file\": \"/etc/puppetlabs/code/environments/production/manifests/site.pp\",\r\n      \"line\": 4,\r\n      \"exported\": false,\r\n      \"parameters\": {\r\n        \"content\": {\r\n          \"__ptype\": \"Deferred\",\r\n          \"name\": \"inline_epp\",\r\n          \"arguments\": [\r\n            \"<%= $deferred_function -%>\",\r\n            {\r\n              \"deferred_function\": {\r\n                \"__ptype\": \"Deferred\",\r\n                \"name\": \"to_yaml\",\r\n                \"arguments\": [\r\n                  {\r\n                    \"test\": \"foo\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          ]\r\n        }\r\n      }\r\n{noformat}\r\nand the file contains the result of evaluating the deferred function:\r\n{noformat}$ cat /tmp/deferred_function.txt\r\n ---\r\ntest: foo\r\n{noformat}\r\nIn 6.12.0 the cached catalog is incorrect:\r\n{noformat}    {\r\n      \"type\": \"File\",\r\n      \"title\": \"/tmp/deferred_function.txt\",\r\n      \"tags\": [\r\n        \"file\",\r\n        \"class\"\r\n      ],\r\n      \"file\": \"/etc/puppetlabs/code/environments/production/manifests/site.pp\",\r\n      \"line\": 4,\r\n      \"exported\": false,\r\n      \"parameters\": {\r\n        \"content\": \"---\\ntest: foo\\n\"\r\n      }\r\n    }\r\n{noformat}\r\nThe bug was introduced in a17761d60b2e5d42cc01a36e1d6ba3d790c9dcf8, as there was a semantic conflict due to the environment convergence changes in 5.5.x and the deferred functionality in 6.x.","closed_at":"2021-03-01T15:30:04.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10818","labels":"doc_reviewed;jira_escalated","state":"Resolved","updated_at":"2021-03-01T15:30:04.000-0800","timestamp":1652286501.148346,"priority":"Normal","status_category":"Done","pull_request":8479},{"issue_id":"380575","title":"3x functions cannot be called from deferred functions in puppet agent","url":"https://tickets.puppetlabs.com/browse/PUP-10819","created_at":"2020-12-09T16:35:22.000-0800","number":"PUP-10819","body":"{{sprintf}} is a builtin 3x function. The following works when running {{puppet apply}}:\r\n\r\n{noformat}\r\n[root@keen-lecture ~]# cat /etc/puppetlabs/code/environments/production/manifests/site.pp\r\nnotify { \"deferred\": message => Deferred(\"sprintf\", [\"hello\"]) }\r\n[root@keen-lecture ~]# puppet apply /etc/puppetlabs/code/environments/production/manifests/site.pp\r\nNotice: Compiled catalog for keen-lecture.delivery.puppetlabs.net in environment production in 0.02 seconds\r\nNotice: hello\r\nNotice: /Stage[main]/Main/Notify[deferred]/message: defined 'message' as 'hello'\r\nNotice: Applied catalog in 0.01 seconds\r\n{noformat}\r\n\r\nThe same code doesn't work when running {{puppet agent}} and gives an unhelpful error:\r\n\r\n{noformat}\r\n[root@keen-lecture ~]# puppet agent -t --trace\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Loading facts\r\nError: Failed to apply catalog: Function sprintf not defined despite being loaded!\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/scope.rb:1044:in `method_missing'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions.rb:751:in `block in call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions.rb:748:in `catch'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/functions.rb:748:in `call'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:283:in `block in external_call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/profiler.rb:51:in `profile'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/runtime3_support.rb:282:in `external_call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/scope.rb:1101:in `call_function'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/deferred_resolver.rb:119:in `resolve_future'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/deferred_resolver.rb:89:in `resolve'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/deferred_resolver.rb:71:in `block (2 levels) in resolve_futures'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/deferred_resolver.rb:70:in `each_pair'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/deferred_resolver.rb:70:in `block in resolve_futures'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/deferred_resolver.rb:68:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/deferred_resolver.rb:68:in `resolve_futures'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/pops/evaluator/deferred_resolver.rb:32:in `resolve_and_replace'\r\n{noformat}\r\n\r\nIt seems like we should either present a consistent error that 3x functions can't be deferred, or allow the agent to load 3x functions in the same way the apply does.\r\n\r\nThe same problem also happens when using a 3x function from a module, eg bool2str from stdlib:\r\n\r\n{noformat}\r\nnotify { \"deferred\": message => Deferred(\"bool2str\", [true]) }\r\n{noformat}\r\n\r\n{noformat}\r\n[root@keen-lecture ~]# puppet agent -t --trace\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Loading facts\r\nError: Failed to apply catalog: Function bool2str not defined despite being loaded!\r\n{noformat}\r\n","closed_at":"2021-03-01T15:30:10.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10819","labels":"doc_reviewed","state":"Resolved","updated_at":"2021-03-01T15:30:10.000-0800","timestamp":1652286501.251378,"priority":"Normal","status_category":"Done","pull_request":8486},{"issue_id":"388276","title":"Syntax error in previously valid puppet code due to removal of application orchestration keywords","url":"https://tickets.puppetlabs.com/browse/PUP-10929","created_at":"2021-02-22T07:15:41.000-0800","number":"PUP-10929","body":"*Puppet Version:*\r\n\r\n7.4.1\r\n{noformat}\r\nclass foo (\r\n  $site,\r\n) {\r\n  notice $site\r\n}\r\n\r\nclass { foo:\r\n  site => 'bar', # syntax error on this line in puppet 7\r\n}{noformat}\r\n \r\n\r\nThe above code works fine in Puppet 4, 5 and 6 despite `site` being on the list of reserved words here. https://puppet.com/docs/puppet/7.4/lang_reserved.html#lang_reserved_words\r\n\r\n*Actual Behavior:*\r\n{noformat}\r\nError: Could not parse for environment production: Syntax error at 'site' (file: /home/halexfis/test.pp, line: 8, column: 3) on node test{noformat}\r\n[https://puppet.com/docs/puppet/7.4/lang_reserved.html#lang_reserved_words] doesn't explicitly say you can't use these words as parameter names, and other examples from that list continue to work fine. (eg. 'node').\r\n\r\nIt looks like this regression was caused by https://tickets.puppetlabs.com/browse/PUP-10446\r\n\r\n ","closed_at":"2021-03-10T07:31:15.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10929","labels":"community;doc_reviewed","state":"Resolved","updated_at":"2021-03-10T07:31:15.000-0800","timestamp":1652286502.393849,"priority":"Normal","status_category":"Done","pull_request":8530},{"issue_id":"390019","title":"The operator '* =>' in a Virtual Query is not supported.","url":"https://tickets.puppetlabs.com/browse/PUP-10951","created_at":"2021-03-04T13:03:36.000-0800","number":"PUP-10951","body":"On Puppet 7.4.1, I get \"The operator '* =>' in a Virtual Query is not supported.\" from the following code:\r\n\r\n{noformat}\r\n  $services.each |$key, $value| {\r\n    if defined(Service[$key]) {\r\n      Service <| title == $key |> {\r\n        * => $value,\r\n      }\r\n    } else {\r\n      service { $key:\r\n        * => $value,\r\n      }\r\n    }\r\n  }\r\n{noformat}\r\n\r\nThis seemed to work fine with Puppet 5 and 6.","closed_at":"2021-03-10T12:15:27.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10951","labels":"doc_reviewed","state":"Resolved","updated_at":"2021-03-10T12:15:27.000-0800","timestamp":1652286502.497319,"priority":"Normal","status_category":"Done","pull_request":8535},{"issue_id":"239960","title":"Puppet should have a way of defining properties or parameters for types as sensitive","url":"https://tickets.puppetlabs.com/browse/PUP-8514","created_at":"2018-03-06T15:30:04.000-0800","number":"PUP-8514","body":"Currently we have this lovely dance we need to go through if we need to define a parameter or property as sensitive. You can see examples of this in file.rb and exec.rb ([https://github.com/puppetlabs/puppet/commit/abd866a648a32d3895011d25af5d4b3d994669c8]) As it currently works, we can only set a specific instance as sensitive. We should be able to say all instances of a particular property/parameter are sensitive when defining it.\r\n\r\n ","closed_at":"2021-03-11T10:53:09.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8514","labels":"","state":"Closed","updated_at":"2021-03-11T10:53:09.000-0800","timestamp":1652286502.600459,"priority":"Normal","status_category":"Done","pull_request":6770},{"issue_id":"281329","title":"Backport sensitive DSL method PUP-8514","url":"https://tickets.puppetlabs.com/browse/PUP-9249","created_at":"2018-10-18T17:07:12.000-0700","number":"PUP-9249","body":"To use the {{sensitive}} DSL method introduced in PUP-8514, you need to be on Puppet 6 or later. This is a problem if you're a module author and want to support pre-6 agents. For example the {{puppet_agent}} module used to upgrade agents relies on the {{yumrepo}} resource type, but the {{yumrepo_core}} module cannot be run on pre-6 agents.\r\n\r\nThis ticket is to backport the PUP-8514 to 5.5.x.","closed_at":"2021-03-11T10:54:38.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9249","labels":"","state":"Resolved","updated_at":"2021-03-11T10:54:38.000-0800","timestamp":1652286502.703823,"priority":"Normal","status_category":"Done","pull_request":7618},{"issue_id":"22652","title":"puppet gem does not include platform specific gem dependencies","url":"https://tickets.puppetlabs.com/browse/PUP-1282","created_at":"2013-12-30T10:28:53.000-0800","number":"PUP-1282","body":"The puppet gem on windows has dependencies on win32-dir, etc, but these are not expressed in the gemspec file. So if you are developing a module, and attempt to `bundle install`, the transitive dependencies are not satisfied. The same issue exists in facter and hiera.","closed_at":"2021-03-30T08:38:27.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1282","labels":"redmine;windows","state":"Closed","updated_at":"2021-03-30T08:38:27.000-0700","timestamp":1652286504.242755,"priority":"Normal","status_category":"Done","pull_request":2221},{"issue_id":"390822","title":"unable to use package task to install gems with puppet_gem provider on Windows","url":"https://tickets.puppetlabs.com/browse/PUP-10964","created_at":"2021-03-12T04:05:47.000-0800","number":"PUP-10964","body":"*Puppet Version: 7.0.0 - 7.5.0*\r\n *Puppet Server Version:* PE 2021\r\n *OS Name/Version: Windows agents*\r\n\r\nAfter the changes done in PUP-10677, the puppet_gem provider is no longer functional on Windows if the {{PUPPET_DIR}} environment variable is not present. The variable is set in environment.bat, which we source when executing puppet.bat and the puppet service.\r\nHowever, if Puppet is used without {{envionment.bat}}, or as a library in a ruby file, the variables may not be present. See https://github.com/puppetlabs/puppetlabs-package/blob/main/tasks/init.rb for an example.\r\n\r\n*Desired Behavior:*\r\n\r\nRunning the package task with the following parameters in PE passes:\r\n\r\nTask parameters:\r\naction: install\r\nname: pry\r\nprovider: puppet_gem\r\n\r\n*Actual Behavior:*\r\n\r\nRunning the task fails with the following:\r\n\r\n{code}\r\nError: Provider puppet_gem package command is not functional on this host\r\n\r\n{\r\n  \"status\" : \"failure\"\r\n}\r\n{code}\r\n\r\nNote that the package task has to be executed through PE/Orchestrator in order to be able to specify the {{provider}} parameter. When run on open source installations the task defaults to the powershell implementation which hardcodes choco and does not support setting a custom provider.\r\n\r\nSuggestion: {{Gem.default_bindir}} provides the path to {{gem.bat}}, but we don't have the certainty that puppet is being run with the system ruby or the vendored ruby.\r\n","closed_at":"2021-04-12T08:29:38.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10964","labels":"doc_reviewed;jira_escalated","state":"Resolved","updated_at":"2021-04-12T08:29:38.000-0700","timestamp":1652286505.317976,"priority":"Normal","status_category":"Done","pull_request":8550},{"issue_id":"390083","title":"Changing a Puppet setting in a catalog invalidates the env cache in multithreaded mode","url":"https://tickets.puppetlabs.com/browse/PUP-10952","created_at":"2021-03-04T15:50:48.000-0800","number":"PUP-10952","body":"While doing research on new loader architectures for SERVER-2860, I discovered the following:\r\n\r\nIn {{multithreaded}} mode in Puppetserver, we create a new settings object whenever a Puppet setting changes while a JRuby request is being processed. One example is if a Puppet function in a module calls {{Puppet[]=}}. In the process of initializing the new settings object with overrides (for thread safety), we resolve all settings. The {{rich_data}} setting [clears out the environment cache|https://github.com/puppetlabs/puppet/blob/main/lib/puppet/defaults.rb#L2162] when resolved.\r\n\r\nThis means if you are changing any Puppet settings in your catalog, in multithreaded mode environment caching is effectively disabled, because the cache will be invalidated on every compile of the offending environment.\r\n\r\nWe should find out why the hook is being called in the first place when [initializing|https://github.com/puppetlabs/puppetserver/blob/9ecd7fb18cd8e02edcfa9e2130c0b2053e0a3209/src/ruby/puppetserver-lib/puppet/server/settings.rb#L25-L31] the threadlocal settings object (we're not altering that setting, and the default hook mode is \"on_write_only\"), and see if we can avoid it.","closed_at":"2021-04-13T05:32:07.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10952","labels":"doc_reviewed","state":"Resolved","updated_at":"2021-04-13T05:32:07.000-0700","timestamp":1652286505.419697,"priority":"Normal","status_category":"Done","pull_request":8552},{"issue_id":"388736","title":"'puppet facts diff' logs error when apt module is installed","url":"https://tickets.puppetlabs.com/browse/PUP-10940","created_at":"2021-02-24T06:31:56.000-0800","number":"PUP-10940","body":"Platforms: OS X, Centos 7 (as tested by me), might be on all\r\npupptlabs-apt: 7.7.1(latest)\r\n\r\nStep to reproduce:\r\n- install latest puppet 6\r\n- install puppetlabs-apt module\r\n- run `puppet facts diff`\r\n\r\n\r\n{noformat}\r\n❯ puppet --version\r\n6.21.1\r\n❯ puppet facts diff\r\n{\"hypervisors.vmware.version\":{\"new_value\":\"ESXi 6.7\",\"old_value\":\"\"}}\r\n\r\n❯ puppet module install puppetlabs-stdlib\r\nNotice: Preparing to install into /etc/puppetlabs/code/environments/production/modules ...\r\nNotice: Downloading from https://forgeapi.puppet.com ...\r\nNotice: Installing -- do not interrupt ...\r\n/etc/puppetlabs/code/environments/production/modules\r\n└── puppetlabs-stdlib (v6.6.0)\r\n\r\n❯ puppet facts diff\r\n{\"hypervisors.vmware.version\":{\"new_value\":\"ESXi 6.7\",\"old_value\":\"\"}}\r\n\r\n❯ puppet module install puppetlabs-apt\r\nNotice: Preparing to install into /etc/puppetlabs/code/environments/production/modules ...\r\nNotice: Downloading from https://forgeapi.puppet.com ...\r\nNotice: Installing -- do not interrupt ...\r\n/etc/puppetlabs/code/environments/production/modules\r\n└─┬ puppetlabs-apt (v7.7.1)\r\n  ├── puppetlabs-stdlib (v6.6.0)\r\n  └── puppetlabs-translate (v2.2.0)\r\n\r\n❯ puppet facts diff\r\nE, [2021-02-17T07:14:34.049701 #1797] ERROR -- : Facter - Error while resolving custom fact fact='apt_package_updates', resolution='<anonymous>': undefined method `[]' for nil:NilClass\r\nE, [2021-02-17T07:14:34.051667 #1797] ERROR -- : Facter - Error while resolving custom fact fact='apt_package_dist_updates', resolution='<anonymous>': undefined method `[]' for nil:NilClass\r\nE, [2021-02-17T07:14:34.053433 #1797] ERROR -- : Facter - Error while resolving custom fact fact='apt_package_security_updates', resolution='<anonymous>': undefined method `[]' for nil:NilClass\r\nE, [2021-02-17T07:14:34.055293 #1797] ERROR -- : Facter - Error while resolving custom fact fact='apt_package_security_dist_updates', resolution='<anonymous>': undefined method `[]' for nil:NilClass\r\nE, [2021-02-17T07:14:34.057133 #1797] ERROR -- : Facter - Error while resolving custom fact fact='apt_updates', resolution='<anonymous>': undefined method `[]' for nil:NilClass\r\nE, [2021-02-17T07:14:34.058807 #1797] ERROR -- : Facter - Error while resolving custom fact fact='apt_dist_updates', resolution='<anonymous>': undefined method `[]' for nil:NilClass\r\nE, [2021-02-17T07:14:34.060489 #1797] ERROR -- : Facter - Error while resolving custom fact fact='apt_security_updates', resolution='<anonymous>': undefined method `[]' for nil:NilClass\r\nE, [2021-02-17T07:14:34.062122 #1797] ERROR -- : Facter - Error while resolving custom fact fact='apt_security_dist_updates', resolution='<anonymous>': undefined method `[]' for nil:NilClass\r\n{\"hypervisors.vmware.version\":{\"new_value\":\"ESXi 6.7\",\"old_value\":\"\"}}\r\n\r\n{noformat}\r\n\r\n*/opt/puppetlabs/puppet/bin/facter-ng* does not log any error so most likely it happens when resolving the facts added in puppet form modules.\r\n","closed_at":"2021-04-23T11:09:17.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10940","labels":"doc_reviewed","state":"Resolved","updated_at":"2021-04-23T11:09:17.000-0700","timestamp":1652286506.75971,"priority":"Normal","status_category":"Done","pull_request":8524},{"issue_id":"393433","title":"Race condition with agent_disabled_lockfile","url":"https://tickets.puppetlabs.com/browse/PUP-11000","created_at":"2021-03-31T04:27:58.000-0700","number":"PUP-11000","body":"*Puppet Version: Affects all versions*\r\n *Puppet Server Version:*\r\n *OS Name/Version: CentOS 7*\r\n\r\nThis is essentially the same issue as seen in a an old PR which was lost over the years - [https://github.com/puppetlabs/puppet/pull/1158] where rapid or parallel puppet runs can cause an already existing {{agent_disabled_lockfile}} to get truncated \r\n\r\n*Desired Behavior:*\r\n\r\nI do not believe puppet actually needs to be creating a resource for this file, the {{agent_catalog_run_lockfile}} has a setting type of {{string}} for this reason ([https://github.com/puppetlabs/puppet/blob/main/lib/puppet/defaults.rb#L1669]) I'd like to apply the same setting type to {{agent_disabled_lockfile}}\r\n\r\n*Actual Behavior:*\r\n\r\nExamples:\r\n {{puppet agent --test --trace --debug --logdest /root/puppet-debug.log}}\r\n\r\nLockfile being created (grep agent_disabled puppet-debug.log):\r\n\r\nNote: {{File[/opt/puppetlabs/puppet/cache/state/agent_disabled.lock]/ensure (debug): created}}\r\n{code:java}2021-03-31 10:49:33 +0000 Puppet (debug): Using settings: adding file resource 'agent_disabled_lockfile': 'File[/opt/puppetlabs/puppet/cache/state/agent_disabled.lock]{:path=>\"/opt/puppetlabs/puppet/cache/state/agent_disabled.lock\", :ensure=>:file, :loglevel=>:debug, :links=>:follow, :backup=>false}'\r\n2021-03-31 10:49:34 +0000 /File[/opt/puppetlabs/puppet/cache/state/agent_disabled.lock]/seluser (debug): Found seluser default 'system_u' for /opt/puppetlabs/puppet/cache/state/agent_disabled.lock\r\n2021-03-31 10:49:34 +0000 /File[/opt/puppetlabs/puppet/cache/state/agent_disabled.lock]/selrole (debug): Found selrole default 'object_r' for /opt/puppetlabs/puppet/cache/state/agent_disabled.lock\r\n2021-03-31 10:49:34 +0000 /File[/opt/puppetlabs/puppet/cache/state/agent_disabled.lock]/seltype (debug): Found seltype default 'usr_t' for /opt/puppetlabs/puppet/cache/state/agent_disabled.lock\r\n2021-03-31 10:49:34 +0000 /File[/opt/puppetlabs/puppet/cache/state/agent_disabled.lock]/selrange (debug): Found selrange default 's0' for /opt/puppetlabs/puppet/cache/state/agent_disabled.lock\r\n2021-03-31 10:49:34 +0000 /File[/opt/puppetlabs/puppet/cache/state/agent_disabled.lock] (debug): Adding autorequire relationship with File[/opt/puppetlabs/puppet/cache/state]\r\n2021-03-31 10:49:34 +0000 /File[/opt/puppetlabs/puppet/cache/state/agent_disabled.lock]/ensure (debug): created\r\n{code}\r\n Strace from guilty {{puppet agent --test}}\r\n{code:java}428070 10:49:34.313537 open(\"/opt/puppetlabs/puppet/cache/state/agent_disabled.lock\", O_WRONLY|O_CREAT|O_TRUNC|O_CLOEXEC, 0666) = 18</opt/puppetlabs/puppet/cache/state/agent_disabled.lock> <0.000076>\r\n{code}","closed_at":"2021-04-23T11:09:18.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11000","labels":"doc_reviewed","state":"Resolved","updated_at":"2021-04-23T11:09:18.000-0700","timestamp":1652286506.862119,"priority":"High","status_category":"Done","pull_request":8555},{"issue_id":"388981","title":"Listing environments during code deploys can prevent environment cache invalidation","url":"https://tickets.puppetlabs.com/browse/PUP-10942","created_at":"2021-02-25T13:51:25.000-0800","number":"PUP-10942","body":"If environments are listed via the {{environment_classes}} REST API while a new environment directory is deployed, it's possible for the default modulepath to be cached in settings, and cause future compilations with that environment to fail. It's can also cause agents to randomly delete pluginsync'ed files (due to omissions in the file metadata response).\r\n\r\nOn the puppetserver node, allow access to the REST API to listing and delete environments:\r\n\r\n{code:hocon}\r\n   {\r\n            \"allow\": \"ADD SERVER FQDN\",\r\n            \"match-request\": {\r\n                \"method\": \"delete\",\r\n                \"path\": \"/puppet-admin-api/v1/environment-cache\",\r\n                \"query-params\": {},\r\n                \"type\": \"path\"\r\n            },\r\n            \"name\": \"puppetlabs environment cache\",\r\n            \"sort-order\": 500\r\n        },\r\n        {\r\n            \"allow\": \"ADD SERVER FQDN\",\r\n            \"match-request\": {\r\n                \"method\": \"get\",\r\n                \"path\": \"/puppet/v3/environment_classes\",\r\n                \"query-params\": {},\r\n                \"type\": \"path\"\r\n            },\r\n            \"name\": \"puppetlabs environment classes\",\r\n            \"sort-order\": 500\r\n        },\r\n{code}\r\n\r\nThen run:\r\n\r\n{code:bash}\r\n#!/bin/sh\r\n\r\nserver=\"ADD SERVER NAME HERE\"\r\ncertname=\"${server}\"\r\n\r\n# use server cert for privileged REST APIs\r\ncurl_opts=\"-kf --cert /etc/puppetlabs/puppet/ssl/certs/${server}.pem --key /etc/puppetlabs/puppet/ssl/private_keys/${server}.pem\"\r\n\r\napi_environments=\"https://${server}:8140/puppet/v3/environments\"\r\napi_classes=\"https://${server}:8140/puppet/v3/environment_classes\"\r\napi_environment_cache=\"https://${server}:8140/puppet-admin-api/v1/environment-cache\"\r\napi_catalog=\"https://${server}:8140/puppet/v3/catalog\"\r\napi_catalog4=\"https://${server}:8140/puppet/v4/catalog\"\r\n\r\nname=\"env_${RANDOM}\"\r\nbasedir=\"/etc/puppetlabs/code/environments\"\r\nenvdir=\"${basedir}/${name}\"\r\nmkdir -p \"${envdir}\"\r\nchown puppet:puppet \"${envdir}\"\r\necho \"create random environment: ${name}\"\r\n\r\necho \"list environments, cache modulepath\"\r\ncurl ${curl_opts} -X GET -H 'Accept: application/json' ${api_environments} | jq .environments.${name}\r\n\r\necho \"finish deployment\"\r\nenvconf=\"${envdir}/environment.conf\"\r\ncat <<EOF > \"${envconf}\"\r\nmodulepath=site:dist:\\$basemodulepath\r\nEOF\r\n\r\nmkdir \"${envdir}/manifests\"\r\ncat <<EOF > \"${envdir}/manifests/init.pp\"\r\ninclude role\r\nEOF\r\n\r\nmkdir \"${envdir}/dist\"\r\nmkdir -p \"${envdir}/site/role/manifests\"\r\ncat <<EOF > \"${envdir}/site/role/manifests/init.pp\"\r\nclass role {\r\n  notify { 'in role': }\r\n}\r\nEOF\r\nchown -R puppet:puppet \"${envdir}\"\r\n\r\necho mark environments as expired\r\ncurl ${curl_opts} -X DELETE -H 'Accept: application/json' ${api_environment_cache}\r\n\r\necho we see the modulepath from before the deploy finished\r\ncurl ${curl_opts} -X GET -H 'Accept: application/json' ${api_environments} | jq .environments.${name}\r\n\r\necho compile v3 catalog fails\r\ncurl -kf \\\r\n --cert \"/etc/puppetlabs/puppet/ssl/certs/${certname}.pem\" \\\r\n --key \"/etc/puppetlabs/puppet/ssl/private_keys/${certname}.pem\" \\\r\n -X POST \\\r\n -d \"%257B%2522facts_format%2522%253A%2522application%252Fjson%2522%252C%2522facts%2522%253A%257B%2522name%2522%253A%2522${certname}%2522%257D%257D\" \\\r\n -H 'Content-Type: application/x-www-form-urlencoded' \\\r\n -H 'Accept: application/json' \\\r\n ${api_catalog}/${certname}\\?environment\\=${name}\r\n{code}\r\n\r\nDue to the bug, we expire all environments, but still see the cached environment's modulepath and compilation fails:\r\n\r\n{noformat}\r\n...\r\nmark environments as expired\r\nwe see the modulepath from before the deploy finished\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n100  6900  100  6900    0     0  87341      0 --:--:-- --:--:-- --:--:-- 87341\r\n{\r\n  \"settings\": {\r\n    \"modulepath\": [\r\n      \"/etc/puppetlabs/code/environments/env_1077/modules\",\r\n      \"/etc/puppetlabs/code/modules\",\r\n      \"/opt/puppetlabs/puppet/modules\"\r\n    ],\r\n    \"manifest\": \"/etc/puppetlabs/code/environments/env_1077/manifests\",\r\n    \"environment_timeout\": 0,\r\n    \"config_version\": \"\"\r\n  }\r\n}\r\ncompile v3 catalog fails\r\ncurl: (22) The requested URL returned error: 500 Server Error\r\n{noformat}\r\n\r\nAnd puppetserver.log contains:\r\n\r\n{noformat}\r\n2021-02-25T20:56:08.058Z ERROR [qtp1507614676-35] [puppetserver] Puppet Server Error: Evaluation Error: Error while evaluating a Function Call, Could not find class ::role for afferent-trot.delivery.puppetlabs.net (file: /etc/puppetlabs/code/environments/env_32225/manifests/init.pp, line: 1, column: 1) on node afferent-trot.delivery.puppetlabs.net\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:401:in `block in evaluate_classes'\r\norg/jruby/RubyArray.java:2572:in `collect'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/parser/compiler.rb:400:in `evaluate_classes'\r\n{noformat}","closed_at":"2021-04-23T11:09:18.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10942","labels":"customer0;doc_reviewed","state":"Closed","updated_at":"2021-04-23T11:09:18.000-0700","timestamp":1652286506.966256,"priority":"Normal","status_category":"Done","pull_request":8523},{"issue_id":"393085","title":"User resource with forcelocal and groups attributes set will fail if /etc/group contains empty lines","url":"https://tickets.puppetlabs.com/browse/PUP-10997","created_at":"2021-03-29T00:44:43.000-0700","number":"PUP-10997","body":"*Puppet Version:* 7.4.0 and 6.21.0 (and later)\r\n*Puppet Server Version:* Masterless to demonstrate issue\r\n*OS Name/Version:* CentOS 7\r\n\r\nA user resource with {{forcelocal => true}} and {{groups}} attributes set will fail if {{/etc/group}} contains any empty/blank lines\r\n\r\n{code:bash}# egrep -n '^$|testuser' /etc/passwd /etc/group\r\n/etc/passwd:24:testuser:x:1001:1001:testuser:/home/testuser:/bin/bash\r\n/etc/group:41:centos:x:1000:testuser\r\n/etc/group:42:testuser:x:1001:\r\n/etc/group:43:\r\n# grpck -r\r\ninvalid group file entry\r\ndelete line ''? No\r\ngrpck: no changes\r\n# bundle exec puppet apply -e \"user { 'testuser': groups => ['centos'], forcelocal => true}\"\r\nNotice: Compiled catalog for [redacted] in environment production in 0.02 seconds\r\nError: undefined method `split' for nil:NilClass\r\n#\r\n{code}\r\n\r\nThis is due to [this line|https://github.com/puppetlabs/puppet/blob/896bf34c5f5c3cdd410002490fce51ab45f03322/lib/puppet/provider/user/useradd.rb#L131] in {{localgroup}} method added for PUP-10857 in puppet 6.21.0 / puppet 7.4.0 and later\r\n\r\nThis does not occur in puppet 6.19.1 and earlier (example output from 6.16 agent)\r\n\r\n{code:bash}\r\n# puppet --version\r\n6.16.0\r\n# puppet apply -e \"user { 'testuser': groups => ['centos'], forcelocal => true}\"\r\nNotice: Compiled catalog for [redacted] in environment production in 0.04 seconds\r\nNotice: Applied catalog in 0.06 seconds\r\n#\r\n{code}\r\n\r\nWhile empty lines in {{/etc/group}} are technically not valid configuration, the behaviour change is difficult to diagnose as it occurs when the catalog is applied/enforced, and does not return much detail in the error.\r\n\r\n*Desired Behavior:*\r\n\r\nIdeally do not fail when empty lines are encountered, or at least output more detailed failure message.\r\n\r\n*Actual Behavior:*\r\n\r\n{code:ruby}\r\nError: undefined method `split' for nil:NilClass\r\n{code}","closed_at":"2021-04-23T11:09:20.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10997","labels":"doc_reviewed","state":"Resolved","updated_at":"2021-04-23T11:09:20.000-0700","timestamp":1652286517.071665,"priority":"Normal","status_category":"Done","pull_request":8554},{"issue_id":"395286","title":"Cannot ensure dnfmodule with no default profile","url":"https://tickets.puppetlabs.com/browse/PUP-11024","created_at":"2021-04-14T00:20:06.000-0700","number":"PUP-11024","body":"*OS Name/Version:* CentOS/RedHat 8\r\n\r\nWhen we added the enable functionality to the dnfmodule provider, we made the following statement: DNF modules that have no default profile (and cannot be installed) will be enabled by default, so there is no need to add {{enable_only}}.\r\n\r\nHowever this does not work anymore with the latest versions of DNF (at least 4.2.23).\r\n Attempting to apply a resource like the following will fail, requiring the user to also add enable_only:\r\n{code}package { '389-ds': ensure => present, provider => dnfmodule }\r\n{code}\r\n*Desired Behavior:*\r\n\r\nPuppet should enable the module\r\n\r\n*Actual Behavior:*\r\n\r\nExecution fails and an error message is raised","closed_at":"2021-04-23T11:09:22.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11024","labels":"doc_reviewed","state":"Resolved","updated_at":"2021-04-23T11:09:22.000-0700","timestamp":1652286517.276896,"priority":"Normal","status_category":"Done","pull_request":8569},{"issue_id":"88845","title":"PMT fails to install modules on Windows that have long paths","url":"https://tickets.puppetlabs.com/browse/PUP-4854","created_at":"2015-07-13T13:35:16.000-0700","number":"PUP-4854","body":"h1. Description\r\n\r\nIf a user attempts to install the DSC module from the Forge the installation will fail:\r\n\r\n{noformat}Notice: Preparing to install into C:/ProgramData/PuppetLabs/code/environments/production/modules ...\r\nNotice: Downloading from https://forgeapi.puppetlabs.com ...\r\nError: No such file or directory @ rb_sysopen - C:/ProgramData/PuppetLabs/puppet/cache/puppet-module/cache/tmp-unpacker20150713-2868-1k8nayj/puppetlabs-dsc-0.1.1-b20025-dd8e40f3/vendor/DSCResources/xRemoteDesktopSessionHost/DSCResources/MSFT_xRDSessionCollectionConfiguration/MSFT_xRDSessionCollectionConfiguration.schema.mof\r\nError: Try 'puppet help module install' for usage{noformat}\r\n\r\nh2. Attachments\r\n\r\n* PMT Debug Log\r\n\r\nh2. Repro Steps\r\n\r\n# Install Puppet Agent 1.2.1 on agent node.\r\n# Install \"puppetlabs-dsc\" module on agent:\r\n{noformat}puppet module install puppetlabs-dsc --module_repository https://api-module-staging.puppetlabs.com{noformat}\r\n\r\nh2. Expect\r\n\r\nThe module should install successfully.\r\n\r\nh2. Actual\r\n\r\nThe module installation fails:\r\n\r\n{noformat}Notice: Preparing to install into C:/ProgramData/PuppetLabs/code/environments/production/modules ...\r\nNotice: Downloading from https://forgeapi.puppetlabs.com ...\r\nError: No such file or directory @ rb_sysopen - C:/ProgramData/PuppetLabs/puppet/cache/puppet-module/cache/tmp-unpacker20150713-2868-1k8nayj/puppetlabs-dsc-0.1.1-b20025-dd8e40f3/vendor/DSCResources/xRemoteDesktopSessionHost/DSCResources/MSFT_xRDSessionCollectionConfiguration/MSFT_xRDSessionCollectionConfiguration.schema.mof\r\nError: Try 'puppet help module install' for usage{noformat}\r\n\r\n","closed_at":"2021-04-28T04:45:02.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4854","labels":"dsc;windows","state":"Closed","updated_at":"2021-04-28T04:45:02.000-0700","timestamp":1652286519.538062,"priority":"Major","status_category":"Done","pull_request":4091},{"issue_id":"397752","title":"Systemd not recognized as service_provider on Ubuntu 17 +","url":"https://tickets.puppetlabs.com/browse/PUP-11051","created_at":"2021-04-30T09:52:06.000-0700","number":"PUP-11051","body":"*Puppet Version: 4.10.12*\r\n *Puppet Server Version: 2.8.1*\r\n *OS Name/Version: Ubuntu 20.04 (Focal Fossa)*\r\n\r\nThe service_provider fact is resolved as `debian` on Ubuntu 20 and Puppet 4.10.x. This should be resolved as systemd. In more recent versions of Puppet this is resolved with the notdefaultfor function future-proofing. However for Puppet 4.10.x the versions need to be explicitly specified.\r\n\r\n*Desired Behavior:* \r\n\r\nThe service_provider should be recognized as systemd\r\n\r\n*Actual Behavior:*\r\n\r\nThe service_provider is recognized as debian\r\n\r\n*Examples:*\r\n\r\n$ puppet --version\r\n 4.10.12\r\n\r\n$ facter -p | grep service_provider\r\n service_provider => systemd\r\n\r\n$ hostnamectl | grep \"Operating System\"\r\n Operating System: Ubuntu 20.04.2 LTS\r\n\r\n \r\n\r\nA PR to fix this issue is available here: \r\n\r\n[https://github.com/puppetlabs/puppet/pull/8593]","closed_at":"2021-04-30T11:12:25.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11051","labels":"","state":"Closed","updated_at":"2021-04-30T11:12:25.000-0700","timestamp":1652286519.955023,"priority":"Low","status_category":"Done","pull_request":8593},{"issue_id":"397685","title":"Ruby 3 reports cert hostname mismatch differently","url":"https://tickets.puppetlabs.com/browse/PUP-11045","created_at":"2021-04-29T15:16:46.000-0700","number":"PUP-11045","body":"If ruby-openssl detects the server's hostname is mismatched, it passes {{preverify_ok=false}} but sets the X509Store error to {{V_ERR_OK}}. See https://github.com/ruby/openssl/issues/244\r\n\r\nThis was fixed in https://github.com/ruby/openssl/commit/035a04ece237105ba3c91a8db8f81dc81d2dc452 and released in ruby-openssl 2.2.0 which has only been released in Ruby 3.0. As a result, the X509Store error is now correctly set to X509_V_ERR_HOSTNAME_MISMATCH (in openssl 1.1 and up) or X509_V_ERR_CERT_REJECTED. This causes puppet to raise a generic \"CertVerifyError\" exception instead of the more specific hostname mismatch error.","closed_at":"2021-05-12T10:26:55.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11045","labels":"","state":"Resolved","updated_at":"2021-05-12T10:26:55.000-0700","timestamp":1652286521.430052,"priority":"Normal","status_category":"Done","pull_request":8587},{"issue_id":"397709","title":"Ruby 3 freezes CHILD_STATUS, so it can't be stubbed","url":"https://tickets.puppetlabs.com/browse/PUP-11048","created_at":"2021-04-29T15:57:12.000-0700","number":"PUP-11048","body":"Some of our provider tests add expectations to {{$CHILD_STATUS#exitstatus}}, but that is no longer possible in Ruby 3, because it is frozen, leading to:\r\n\r\n{noformat}\r\n       Cannot proxy frozen objects, rspec-mocks relies on proxies for method stubbing and expectations.\r\n{noformat}\r\n\r\nNow that {{Puppet::Util::Execution.execute}} returns a {{ProcessOutput}} containing the exitstatus, there is no reason to continue using {{CHILD_STATUS}}.","closed_at":"2021-05-18T06:54:49.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11048","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-05-18T06:54:49.000-0700","timestamp":1652286521.747694,"priority":"Normal","status_category":"Done","pull_request":8602},{"issue_id":"397686","title":"Ruby 3 removed URI.escape/unescape","url":"https://tickets.puppetlabs.com/browse/PUP-11046","created_at":"2021-04-29T15:29:35.000-0700","number":"PUP-11046","body":"Ruby deprecated URI.escape and unescape in 2.x and removed those methods in 3, because they rely on a deprecated URL parser (RFC2396). However, Puppet needs them to convert potentially unsafe characters, like file paths, into valid URLs.","closed_at":"2021-05-18T06:55:30.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11046","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-05-18T06:55:30.000-0700","timestamp":1652286521.851928,"priority":"Normal","status_category":"Done","pull_request":8588},{"issue_id":"191580","title":"puppet doesn't specify file type to get default selinux context","url":"https://tickets.puppetlabs.com/browse/PUP-7559","created_at":"2017-05-17T10:02:27.000-0700","number":"PUP-7559","body":"When creating a new file, puppet finds out the default selinux context with matchpathcon but it's not specifying the file type what can lead to use the incorrect context (selinux default context depends on file type) and breaks idempotency.\r\n\r\nReproducer:\r\n\r\n{code}\r\n\r\n[root@vmname ~]# cat test.pp \r\nfile {\r\n    '/etc/systemd/system/redis.service.d':\r\n       ensure => directory\r\n}\r\n\r\n# puppet apply test.pp \r\nNotice: Compiled catalog for vmname.example.com in environment production in 0.15 seconds\r\nNotice: /Stage[main]/Main/File[/etc/systemd/system/redis.service.d]/ensure: created\r\nNotice: Applied catalog in 0.54 seconds\r\n# ll -Zd /etc/systemd/system/redis.service.d\r\ndrwxr-xr-x. root root system_u:object_r:redis_unit_file_t:s0 /etc/systemd/system/redis.service.d\r\n# puppet apply test.pp \r\nNotice: Compiled catalog for vmname.example.com in environment production in 0.15 seconds\r\nNotice: /Stage[main]/Main/File[/etc/systemd/system/redis.service.d]/seltype: seltype changed 'redis_unit_file_t' to 'systemd_unit_file_t'\r\nNotice: Applied catalog in 0.51 seconds\r\n[root@vmname ~]# ll -Zd /etc/systemd/system/redis.service.d\r\ndrwxr-xr-x. root root system_u:object_r:systemd_unit_file_t:s0 /etc/systemd/system/redis.service.d\r\n\r\n\r\n{code}\r\n\r\nNote that first run used wrong selinux type for the just created directory.\r\n\r\n","closed_at":"2021-05-18T07:06:26.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7559","labels":"doc-reviewed;file;linux;platform-os;selinux;type_and_provider","state":"Resolved","updated_at":"2021-05-18T07:06:26.000-0700","timestamp":1652286522.071187,"priority":"Major","status_category":"Done","pull_request":8570},{"issue_id":"397486","title":"Unable to 'mask' a 'static' systemd service","url":"https://tickets.puppetlabs.com/browse/PUP-11034","created_at":"2021-04-28T12:55:43.000-0700","number":"PUP-11034","body":"*Puppet Version: 7.6.1*\r\n *Puppet Server Version: N/A*\r\n *OS Name/Version: CentOS 8.3*\r\n\r\nI'm trying to translate the following command into Puppet:\r\n{code:java}systemctl stop systemd-coredump.socket\r\nsystemctl mask systemd-coredump.socket{code}\r\nThe Puppet code i've written to do this is:\r\n{code:java}service { 'systemd-coredump.socket':\r\n   ensure => 'stopped',\r\n   enable => 'mask',\r\n}{code}\r\n*Desired Behavior:*\r\n\r\nI would expect the service to be stopped and masked.\r\n\r\n*Actual Behavior:*\r\n\r\nThe service is a 'static' service on the system and is resulting in a debug log being printed:\r\n{code:java}debug - Puppet - Executing: '/bin/systemctl is-enabled -- systemd-coredump.socket'debug - Puppet - Unable to enable or disable static service systemd-coredump.socket\r\n{code}\r\nRunning the systemctl commands manually, works just fine.\r\n\r\nDoing a little digging, i found the following code:\r\n [https://github.com/puppetlabs/puppet/blob/main/lib/puppet/provider/service/systemd.rb#L42-L56]\r\n\r\nThe comment in the block is accurate, however a little misleading because 'static' services are allowed to be 'masked'.\r\n\r\n ","closed_at":"2021-05-19T05:52:17.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11034","labels":"community;doc-reviewed","state":"Closed","updated_at":"2021-05-19T05:52:17.000-0700","timestamp":1652286522.283885,"priority":"Normal","status_category":"Done","pull_request":8584},{"issue_id":"393117","title":"Unable to update UserRightAssignment - Log on as service rights","url":"https://tickets.puppetlabs.com/browse/PUP-10999","created_at":"2021-03-29T07:58:43.000-0700","number":"PUP-10999","body":"*Puppet Version: 2019.8.4*\r\n *Puppet Server Version:*\r\n *OS Name/Version:*\r\n\r\nWe are trying to add an account to the \"UserRightAssignment - Log on as service rights\" of a Windows agent using the DSC Modules:\r\n\r\ndsc-securitypolicydsc\r\n puppetlabs-pwshlib\r\n\r\nand, at the same time, set a service with the account that just got the \"log on as service rights\". The manifest code used is:\r\n\r\n \r\n\r\nclass windows_towers { \r\n     dsc_userrightsassignmen\r\n\r\n{ \"add-jordi-to-logon-as-service\":          dsc_ensure => 'present',          dsc_policy => 'Log_on_as_a_service',          dsc_identity => ['NT SERVICE\\\\ALL SERVICES','cloudbase-init','jordi'],     }\r\n\r\n    service\r\n\r\n{ 'PlexUpdateService':          ensure => 'stopped',          logonaccount => 'PE-201984-WIN2K\\\\jordi',          logonpassword => 'puppetpuppet',          enable => 'false',          require => Dsc_userrightsassignment['add-jordi-to-logon-as-service'], }\r\n\r\n}\r\n  \r\n\r\n*Desired Behavior:*\r\n\r\nUpdate the windows service with the new credentials that just got ** \"log on as service rights\" - Basically, the code above should work first time round.\r\n\r\n*Actual Behavior:*\r\n\r\n \r\n PS C:\\Users\\Administrator\\tester> puppet agent -t\r\n [DEPRECATION] Struct layout is already defined for class Windows::ServiceStructs::SERVICE_STATUS_PROCESS. Redefinition as in C:/Ruby25-x64/lib/ruby/gems/2.5.0/gems/win32-service-0.8.8/lib/win32/windows/structs.rb:67:in `<class:SERVICE_STATUS_PROCESS>' will be disallowed in ffi-2.0.\r\n Info: Using configured environment 'production'\r\n Info: Retrieving pluginfacts\r\n Info: Retrieving plugin\r\n Info: Retrieving locales\r\n Info: Loading facts\r\n Error: Failed to apply catalog: Parameter logonaccount failed on Service[PlexUpdateService]: \"PE-201984-WIN2K\\jordi\" is missing the 'Log On As A Service' right. (file: /etc/puppetlabs/code/environments/production/site/windows_towers/manifests/init.pp, line: 16)\r\n\r\nThe error is indicating that the account selected doesn't have \"log on as service rights\" but, in fact, the account has not been added to the \"log on as service rights\" User Rights assignment and it is failing at compilation.\r\n\r\nAlternatively, if you comment out the service part of the code, the user gets added to the \"log on as service rights\" and, at this stage, the code will work as expected.\r\n class windows_towers { \r\n    dsc_userrightsassignment\r\n\r\n{ \"add-jordi-to-logon-as-service\":        dsc_ensure => 'present',        dsc_policy => 'Log_on_as_a_service',        dsc_identity => ['NT SERVICE\\\\ALL SERVICES','cloudbase-init','jordi'],    }\r\n\r\n   #service\r\n\r\n{ 'PlexUpdateService':        # ensure => 'stopped',        # logonaccount => 'PE-201984-WIN2K\\\\jordi',        #logonpassword => 'puppetpuppet',        # enable => 'false',        # require => Dsc_userrightsassignment['add-jordi-to-logon-as-service'],    #}\r\n\r\n}\r\n PS C:\\Users\\Administrator\\tester> puppet agent -t\r\n [DEPRECATION] Struct layout is already defined for class Windows::ServiceStructs::SERVICE_STATUS_PROCESS. Redefinition as in C:/Ruby25-x64/lib/ruby/gems/2.5.0/gems/win32-service-0.8.8/lib/win32/windows/structs.rb:67:in `<class:SERVICE_STATUS_PROCESS>' will be disallowed in ffi-2.0.\r\n Info: Using configured environment 'production'\r\n Info: Retrieving pluginfacts\r\n Info: Retrieving plugin\r\n Info: Retrieving locales\r\n Info: Loading facts\r\n Info: Caching catalog for pe-201984-win2k.platform9.puppet.net\r\n Info: Applying configuration version '1617025583'\r\n Notice: /Stage[main]/Windows_towers/Dsc_userrightsassignment[add-jordi-to-logon-as-service]/dsc_identity: dsc_identity changed ['PE-201984-WIN2K\\cloudbase-init', 'NT SERVICE\\ALL SERVICES'] to ['NT SERVICE\\ALL SERVICES', 'cloudbase-init', 'jordi']\r\n Notice: dsc_userrightsassignment[\\\\\\\\{:name=>\"add-jordi-to-logon-as-service\", :dsc_policy=>\"Log_on_as_a_service\"}|file://%7B:name%3D%3E%22add-jordi-to-logon-as-service%22%2C%20:dsc_policy%3D%3E%22log_on_as_a_service%22%7D/]: Updating: Finished in 2.36 seconds\r\n Notice: Applied catalog in 3.77 seconds\r\n\r\nI have worked with Michael Lombardi on https://tickets.puppetlabs.com/browse/MODULES-10969 created on the back of [https://puppetlabs.zendesk.com/agent/tickets/43304] that has determined that the error experienced is generated by [https://github.com/puppetlabs/puppet/blob/main/lib/puppet/type/service.rb#L152] and stops catalog compilation\r\n\r\nMichael has also suggested that the current validation be turned into a warning or placed in the provider and called during {{set method}}\r\n\r\n ","closed_at":"2021-05-19T05:53:01.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10999","labels":"doc-reviewed;jira_escalated","state":"Resolved","updated_at":"2021-05-19T05:53:01.000-0700","timestamp":1652286522.387789,"priority":"Normal","status_category":"Done","pull_request":8566},{"issue_id":"341249","title":"Puppet incorrectly detecting stale pidfile","url":"https://tickets.puppetlabs.com/browse/PUP-10218","created_at":"2020-01-07T00:44:36.000-0800","number":"PUP-10218","body":"*Puppet Version: 6.11.1*\r\n*Puppet Server Version: 6.11.1*\r\n*OS Name/Version: CentOS 7*\r\n\r\nWhen Puppet agent is incorrectly terminated (eg. killed by KILL signal) it might have a problem in detecting stale PID file. The code in question is this:\r\n\r\n{code:ruby|title=puppet/lib/ruby/vendor_ruby/puppet/util/pidlock.rb}\r\ndef clear_if_stale\r\n    begin\r\n      Process.kill(0, lock_pid)\r\n    rescue *errors\r\n      return @lockfile.unlock\r\n    end\r\n\r\n    if Puppet.features.posix?\r\n      procname = Puppet::Util::Execution.execute([\"ps\", \"-p\", lock_pid, \"-o\", \"comm=\"]).strip\r\n      args     = Puppet::Util::Execution.execute([\"ps\", \"-p\", lock_pid, \"-o\", \"args=\"]).strip\r\n      @lockfile.unlock unless procname =~ /ruby/ && args =~ /puppet/ || procname =~ /puppet(-.*)?$/\r\n    elsif Puppet.features.microsoft_windows?\r\n      # On Windows, we're checking if the filesystem path name of the running\r\n      # process is our vendored ruby:\r\n      exe_path = Puppet::Util::Windows::Process::get_process_image_name_by_pid(lock_pid)\r\n      @lockfile.unlock unless exe_path =~ /\\\\bin\\\\ruby.exe$/\r\n    end\r\n{code}\r\n\r\n*Process.kill(0, pid)* tries to find out if process with certain pid exists. The problem is that Process.kill checks regular processes as well as LightWeight Processes (LWP), so it will verify if certain process or lightweight process currently exists. If it exists it will try to find the name of the command for it. Unfortunately ps -p command only cares about processes and not LightWeight Processes, so if stale file contains PID of LWP Puppet will never be able to recover (unless we remove stale lock file) as LWP usually are spawned by long running daemons. Please find an attached patch (tested on CentOS7) which addresses the above issue: it makes sure ps command also considers LWPs otherwise you might run into error shown below. \r\n\r\n*Desired Behavior:*\r\n\r\nPuppet agent starts up and runs correctly.\r\n\r\n*Actual Behavior:*\r\n{noformat}\r\n# puppet agent --test\r\nError: Could not run Puppet configuration client: Execution of 'ps -p 2181 -o comm=' returned 1: \r\n{noformat}\r\n","closed_at":"2021-05-19T08:24:38.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10218","labels":"resolved-issue-added","state":"Resolved","updated_at":"2021-05-19T08:24:38.000-0700","timestamp":1652286522.494424,"priority":"Normal","status_category":"Done","pull_request":7958},{"issue_id":"287004","title":"Puppet sets permissions for Puppet files every run","url":"https://tickets.puppetlabs.com/browse/PUP-9337","created_at":"2018-11-30T10:48:07.000-0800","number":"PUP-9337","body":"*Puppet Version:* 2018.1.5, 2019.0.1\r\n*OS Name/Version:* Windows 2012 R2, 2016, 2019\r\n\r\nFile permissions for Puppet files are being set to the same value every run:\r\n\r\n{code}\r\nResource\tEvent\tChanged from\tChanged to\r\n\r\nFile[C:\\ProgramData/PuppetLabs/puppet/cache/state/package_inventory_enabled] \r\nFile: /opt/puppetlabs/puppet/modules/puppet_enterprise/manifests/profile/agent.pp Line: 89 \r\nCorrective change\t\r\n0674 \r\n664\r\n\r\nFile[C:\\ProgramData/PuppetLabs/pxp-agent/etc/pxp-agent.conf] \r\nFile: /opt/puppetlabs/puppet/modules/puppet_enterprise/manifests/pxp_agent.pp Line: 105 \r\nCorrective change\t\r\n0670 \r\n660\r\n{code}\r\n\r\n\r\nThis seems to target package_inventory_enabled most frequently. Every run the permission is set from 0674 to 0664, which would seem to correspond with documentation requirements (https://puppet.com/docs/puppet/6.0/resources_file_windows.html#how-nix-modes-map-to-windows-permissions):\r\n\r\n{panel}\r\nThe group can’t have higher permissions than the owner. Other users can’t have higher permissions than the owner or group. (That is, 0640 and 0755 are supported, but 0460 is not.)\r\n{panel}\r\n\r\n\r\nHowever the next agent run shows the value has reverted and needs to be set again. It appears that removing the file often - but not always - resolves the issue.","closed_at":"2021-05-23T20:13:50.000-0700","comments":19,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9337","labels":"escalation;jira_escalated;resolved-issue-added","state":"Closed","updated_at":"2021-05-23T20:13:50.000-0700","timestamp":1652286522.712874,"priority":"Major","status_category":"Done","pull_request":7400},{"issue_id":"397708","title":"Ruby 3 removed webrick","url":"https://tickets.puppetlabs.com/browse/PUP-11047","created_at":"2021-04-29T15:35:14.000-0700","number":"PUP-11047","body":"Ruby 3 removed webrick and sorted set. We rely on the former in rspec tests and rely on the latter to keep track of resources during catalog application.","closed_at":"2021-06-01T18:45:20.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11047","labels":"","state":"Resolved","updated_at":"2021-06-01T18:45:20.000-0700","timestamp":1652286523.252003,"priority":"Normal","status_category":"Done","pull_request":8589},{"issue_id":"388985","title":"Windows package provider continues to read DisplayVersion key after embedded NULL","url":"https://tickets.puppetlabs.com/browse/PUP-10943","created_at":"2021-02-25T14:38:59.000-0800","number":"PUP-10943","body":"When scanning for existing packages in Windows, Puppet reads uninstall listings in the \"per-machine\" and \"current user\" contexts, both 32 and 64 bit using the DisplayName or, more rarely, the QuietDisplayName keys. If these keys have an embedded Null, the package provider continues to read garbage data. It may attempt to decode these junk characters from UTF-16LE and fail.\r\n\r\nAn update was pushed out to fix this (PUP-10536), but a customer recently hit the bug again. This is a followup to that ticket.","closed_at":"2021-06-06T19:11:51.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10943","labels":"doc_reviewed;jira_escalated","state":"Resolved","updated_at":"2021-06-06T19:11:51.000-0700","timestamp":1652286526.834199,"priority":"Normal","status_category":"Done","pull_request":8533},{"issue_id":"22927","title":"Class names that match the node name are not evaluated","url":"https://tickets.puppetlabs.com/browse/PUP-1357","created_at":"2014-01-03T11:37:50.000-0800","number":"PUP-1357","body":"If I setup:\r\n\r\n{code:puppet}\r\nclass subversion {\r\n  warning(\"I am class subversion\")\r\n}\r\n{code}\r\n\r\nand in my nodes.pp I have\r\n\r\n{code}\r\nnode subversion { include subversion }\r\n{code}\r\n\r\nWhen i run puppet in verbose mode on subversion, I never see that warning.  ","closed_at":"2021-06-09T13:20:34.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1357","labels":"redmine","state":"Closed","updated_at":"2021-06-09T13:20:34.000-0700","timestamp":1652286537.432256,"priority":"Normal","status_category":"Done","pull_request":8494},{"issue_id":"30995","title":"FreeBSD service provider does not support rc.d files with profiles","url":"https://tickets.puppetlabs.com/browse/PUP-2153","created_at":"2014-04-03T17:45:17.000-0700","number":"PUP-2153","body":"Puppet freebsd service provider (lib/puppet/provider/service/freebsd.rb) doesn't support FreeBSD start scripts with profiles. \r\n\r\nExample:\r\nNO PROFILES:\r\n{noformat}\r\n/usr/local/etc/rc.d/nagios rcvar\r\n# nagios\r\n#\r\nnagios_enable=\"YES\"\r\n#   (default: \"\")\r\n{noformat}\r\n\r\nWITH PROFILES:\r\n{noformat}\r\n/usr/local/etc/rc.d/fcgiwrap  rcvar\r\n===> fcgiwrap profile: nagios\r\n# fcgiwrap\r\n#\r\nfcgiwrap_enable=\"YES\"\r\n#   (default: \"\")\r\n{noformat}\r\n\r\nWITH *MULTIPLE* PROFILES (mockup):\r\n{noformat}\r\n/usr/local/etc/rc.d/fcgiwrap  rcvar\r\n===> fcgiwrap profile: nagios1\r\n# fcgiwrap\r\n#\r\nfcgiwrap_enable=\"YES\"\r\n#   (default: \"\")\r\n\r\n===> fcgiwrap profile: nagios2\r\n# fcgiwrap\r\n#\r\nfcgiwrap_enable=\"YES\"\r\n#   (default: \"\")\r\n\r\n===> fcgiwrap profile: nagios3\r\n# fcgiwrap\r\n#\r\nfcgiwrap_enable=\"YES\"\r\n#   (default: \"\")\r\n\r\n{noformat}\r\n\r\nThe following puppet function will not work even with a single profile present, as it does not handle the \"profile heading\": ===> fcgiwrap profile: nagios\r\n\r\n{code}\r\n  # Executing an init script with the 'rcvar' argument returns\r\n  # the service name, rcvar name and whether it's enabled/disabled\r\n  def rcvar\r\n    rcvar = execute([self.initscript, :rcvar], :failonfail => true, :combine => false, :squelch => false)\r\n    rcvar = rcvar.split(\"\\n\")\r\n    rcvar.delete_if {|str| str =~ /^#\\s*$/}\r\n    rcvar[1] = rcvar[1].gsub(/^\\$/, '')\r\n    rcvar\r\n  end\r\n{code}\r\n\r\nAdding {noformat}rcvar.delete_if {|str| str =~ /^===*$/}{noformat} will help a bit, but there is a case where it will get confused - if the first profile is set to not enabled in rc.conf.d/someservice file, regardless if any other is set to enabled, this function will determine that service should be disabled as it only checks the first \"enable\", and there will be multiple \"enable\" lines with multiple profiles. It should ideally check all occurrences of <someservice>_enable and, if at least one is set to \"YES\", enable the entire thing and let the actual start script handle what to start and what not to start. Or maybe it should just skip the entire process if rc.conf.d file is already a puppet managed resource? But it doesn't have to be.\r\n\r\nI am using my own rc.conf.d/<service> file (obviously needed to configure profiles, but they could be configured in /etc/rc.conf file as well) and with freebsd provider I get this error: *Could not evaluate: rcvar value is empty*, as obviously it's trying to check the first line and it happens to be the profile header starting with ===>, and there's no <service>_enable string there.\r\n\r\nAs a \"workaround\" I use bsd service provider, that at least doesn't error, but it seems to just skip the entire process if rc.conf.d/<service> file is already present. Which might or might not be the desired behavior.","closed_at":"2021-06-09T15:33:48.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-2153","labels":"","state":"Ready for Merge","updated_at":"2021-06-09T15:33:48.000-0700","timestamp":1652286538.449079,"priority":"Normal","status_category":"In Progress","pull_request":8607},{"issue_id":"220019","title":"Service provider 'redhat' does not correctly detect enabled state of 'boot.*' services on SLES 11.","url":"https://tickets.puppetlabs.com/browse/PUP-8114","created_at":"2017-11-02T01:55:44.000-0700","number":"PUP-8114","body":"Service provider 'redhat' does not correctly detect enabled state of 'boot.*' services on SLES 11.\r\n\r\nPull request: https://github.com/puppetlabs/puppet/pull/6333\r\n\r\nSLES 11 has a list of Sys V services beginning with the string 'boot.' that do not behave like other services when {{chkconfig}} is run against them. To illustrate:\r\n{code:bash}\r\n$ cat /etc/SuSE-release\r\nSUSE Linux Enterprise Server 11 (x86_64)\r\nVERSION = 11\r\nPATCHLEVEL = 3\r\n\r\n# Service is running\r\n$ /sbin/service boot.kdump status\r\nkdump kernel loaded\r\n                                                                                                                                                                                                                                 running\r\n\r\n# chkconfig shows 'B'\r\n$ /sbin/chkconfig boot.kdump\r\nboot.kdump  B\r\n\r\n# Only appears when --allservices is specified\r\n$ /sbin/chkconfig --list | grep kdump\r\n$ /sbin/chkconfig --list --allservices | grep kdump\r\nboot.kdump                0:off  1:off  2:off  3:off  4:off  5:off  6:off  B:on\r\n\r\n# Compare with \"normal\" service\r\n$ /sbin/service ntp status\r\n...\r\n\r\nChecking for network time protocol daemon (NTPD):                                                                                                                                                                                running\r\n\r\n# chkconfig shows 'on', not 'B'\r\n$ /sbin/chkconfig ntp\r\nntp  on\r\n{code}\r\n\r\nThe provider script ({{puppet/lib/puppet/provider/service/redhat.rb}}) uses the following function to test whether a service is enabled.\r\n{code:ruby}\r\n  def enabled?\r\n    name = @resource[:name]\r\n\r\n    begin\r\n      output = chkconfig name\r\n    rescue Puppet::ExecutionFailure\r\n      return :false\r\n    end\r\n\r\n    # For Suse OS family, chkconfig returns 0 even if the service is disabled or non-existent\r\n    # Therefore, check the output for '<name>  on' to see if it is enabled\r\n    return :false unless Facter.value(:osfamily) != 'Suse' || output =~ /^#{name}\\s+on$/\r\n\r\n    :true\r\n  end\r\n{code}\r\n\r\nIt accounts for the fact that SLES, unlike RHEL, returns a zero return code in the event that a service is disabled or nonexistent:\r\n{code:bash}\r\n$ /sbin/chkconfig asdf\r\nasdf: unknown service\r\n$ echo $?\r\n0\r\n{code}\r\n\r\nThis doesn't trigger the {{rescue}} block with its {{false}} return value as a disabled or nonexistent service would for RHEL.\r\n\r\nSo, if the OS family is not 'Suse' and we didn't hit the {{rescue}} block, it returns {{true}}. If the OS family is 'Suse', {{output}} must contain the service name followed by {{'on'}} in order for it to return {{true}}. As we've seen above, the {{boot.*}} services print an output of {{<service_name> B}} and thus return {{false}} even when enabled.\r\n","closed_at":"2021-06-09T15:57:42.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8114","labels":"community","state":"Closed","updated_at":"2021-06-09T15:57:42.000-0700","timestamp":1652286539.075018,"priority":"Normal","status_category":"Done","pull_request":6333},{"issue_id":"80006","title":"With a systemd masked service: 'enable=true ensure=running' doesn't work on CentOS with default selinux rules","url":"https://tickets.puppetlabs.com/browse/PUP-4605","created_at":"2015-05-13T12:13:54.000-0700","number":"PUP-4605","body":"See [~kurt.wall]'s comment in PUP-1253 for more details. This is a followon to that ticket.\r\n\r\nPing [~peiriannydd] who worked on the original feature, and [~melissa] who was looking into systemd issues on jessie/vivid (and has a patch that might tie in to this).\r\n\r\nAssigned to RelEng scrum team since Melissa is currently working those tickets. And guessed at 2 story points.","closed_at":"2021-06-09T16:12:52.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4605","labels":"linux;platform-os;service;systemd;type_and_provider","state":"Closed","updated_at":"2021-06-09T16:12:52.000-0700","timestamp":1652286539.386956,"priority":"Normal","status_category":"Done","pull_request":4121},{"issue_id":"81478","title":"systemd service provider starts/enables in the wrong order","url":"https://tickets.puppetlabs.com/browse/PUP-4651","created_at":"2015-05-26T08:02:30.000-0700","number":"PUP-4651","body":"The systemd provider for the service resource type seems to always start a service before enabling it. This behavior does not work for the rsyslog service. Enabling the rsyslog service must happen before starting it because enabling it creates symlinks for syslog.service to rsyslog.service. Those are necessary for the syslog.socket unit to work properly which is again required by rsyslog.service. Thus starting rsyslog.service is not possible, before it has been enabled.\r\n\r\nHow to reproduce:\r\n\r\n1. Prepare environment\r\n$ systemctl stop rsyslog.service\r\n$ systemctl stop syslog.socket\r\n$ systemctl disable rsyslog.service\r\n$ systemctl is-active rsyslog.service\r\nunknown\r\n$ systemctl is-enabled rsyslog.service\r\ndisabled\r\n\r\n2. Try to activate rsyslog through puppet (will fail)\r\n$  puppet apply --debug --execute 'service { \"rsyslog.service\": ensure => 'running', enable => true, provider => 'systemd' }'\r\n\r\n3. Activate rsyslog manually (how puppet should do it)\r\n$ systemctl enable rsyslog.service\r\n$ systemctl start rsyslog.service\r\n\r\nThe relevant log messages from step 2. are:\r\n\r\nDebug: Executing '/bin/systemctl is-active rsyslog.service'\r\nDebug: Executing '/bin/systemctl is-enabled rsyslog.service'\r\nDebug: Executing '/bin/systemctl start rsyslog.service'\r\nError: Could not start Service[rsyslog.service]: Execution of '/bin/systemctl start rsyslog.service' returned 1: A dependency job for rsyslog.service failed. See 'journalctl -xn' for details.\r\nError: /Stage[main]/Main/Service[rsyslog.service]/ensure: change from stopped to running failed: Could not start Service[rsyslog.service]: Execution of '/bin/systemctl start rsyslog.service' returned 1: A dependency job for rsyslog.service failed. See 'journalctl -xn' for details.\r\n\r\n\r\n\r\n","closed_at":"2021-06-09T18:36:00.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4651","labels":"help_wanted;linux;platform-os;service;systemd;type_and_provider","state":"Closed","updated_at":"2021-06-09T18:36:00.000-0700","timestamp":1652286539.701766,"priority":"Normal","status_category":"Done","pull_request":7429},{"issue_id":"238529","title":"Ubuntu 16.10 _AND NEWER_ use systemd provider as default","url":"https://tickets.puppetlabs.com/browse/PUP-8495","created_at":"2018-02-27T07:46:22.000-0800","number":"PUP-8495","body":"*Puppet Version:*\r\n *Puppet Server Version:*\r\n *OS Name/Version:*\r\n\r\nDetection of systemd fails on Ubuntu releases higher than 16.10\r\n\r\n*Desired Behavior:*\r\n\r\ndisabling/enabling services should work as normal also on Ubuntu 17.04 and up.\r\n\r\nAs one can see here:\r\n\r\n[https://github.com/puppetlabs/puppet/commit/ef342d4ced9bf7aa0489005119bf80a298d094f2]\r\n\r\nUbuntu is only supported up to 16.10 - why is this hardcoded in like this, instead of saying Ubuntu with releases from 15.04 and up use systemd, while those below use sysc-rc - the problem is now that puppet tries to use sysv-rc on Ubuntu 17.04 and up as well. \r\n\r\n*Actual Behavior:*\r\n\r\n \r\n\r\n \r\n\r\n{{ubuntu1710 ~ # puppet resource service ipmievd enable='false'}}\r\n{{dpkg: error: --compare-versions takes three arguments: <version> <relation> <version>}}{{Type dpkg --help for help about installing and deinstalling packages [*];}}\r\n{{Use 'apt' or 'aptitude' for user-friendly package management;}}\r\n{{Type dpkg -Dhelp for a list of dpkg debug flag values;}}\r\n{{Type dpkg --force-help for a list of forcing options;}}\r\n{{Type dpkg-deb --help for help about manipulating *.deb files;}}{{Options marked [*] produce a lot of output - pipe it through 'less' or 'more' !}}\r\n{{Notice: /Service[ipmievd]/enable: enable changed 'true' to 'false'}}\r\n{{service \\{ 'ipmievd':}}\r\n{{   enable => 'true',}}\r\n{{}}}\r\n{{ubuntu1710 ~ # lsb_release -a}}\r\n{{No LSB modules are available.}}\r\n{{Distributor ID: Ubuntu}}\r\n{{Description: Ubuntu 17.10}}\r\n{{Release: 17.10}}\r\n{{Codename: artful}}\r\n{{ubuntu1710 ~ #}}\r\n\r\n \r\n\r\n ","closed_at":"2021-06-09T19:03:06.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8495","labels":"community;type_and_provider","state":"Closed","updated_at":"2021-06-09T19:03:06.000-0700","timestamp":1652286540.015692,"priority":"Normal","status_category":"Done","pull_request":6738},{"issue_id":"394276","title":"Running `bundle exec rake/rspec spec` has failures on main branch","url":"https://tickets.puppetlabs.com/browse/PUP-11022","created_at":"2021-04-06T12:32:17.000-0700","number":"PUP-11022","body":"Running the Puppet specs using {{bundle exec rspec spec}} or {{bundle exec rake spec}} consistently produces these failures: https://gist.github.com/pcarlisle/42b9792d2f1d997d24c7f6736bfb8473. We can reproduce this in both a mac and a linux environment.\r\n\r\nWhen those files are run individually or when using the {{parallel_spec}} rake task, nothing fails. So it would appear there's some kind of order dependent issue that's not getting picked up by Travis, which uses {{parallel_spec}}.","closed_at":"2021-06-10T00:28:23.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11022","labels":"tech-debt","state":"Resolved","updated_at":"2021-06-10T00:28:23.000-0700","timestamp":1652286540.851526,"priority":"Normal","status_category":"Done","pull_request":8567},{"issue_id":"85755","title":"`puppet agent arg` silently eats arguments and runs the agent","url":"https://tickets.puppetlabs.com/browse/PUP-4776","created_at":"2015-06-22T15:11:38.000-0700","number":"PUP-4776","body":"In general, `puppet <thing> help` tends to provide help text. This seems to be entirely accidental, because `puppet <thing> help` calls `puppet thing` with the argument `help`, which is invalid in many cases.\r\n\r\n`puppet agent help` silently launches the agent in the background and provides no help text. If one accidentally types `puppet agent disable` instead of `puppet agent --disable`, the changes one wanted to avoid applying are instead immediately applied.\r\n\r\nIt would be awesome if `puppet agent` died, preferably loudly, if called with extra arguments.","closed_at":"2021-06-10T23:25:04.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4776","labels":"","state":"Closed","updated_at":"2021-06-10T23:25:04.000-0700","timestamp":1652286544.829267,"priority":"Normal","status_category":"Done","pull_request":4043},{"issue_id":"132436","title":"undef in custom type autorequire value causes error in Puppet 4.5.0","url":"https://tickets.puppetlabs.com/browse/PUP-6321","created_at":"2016-05-18T10:58:35.000-0700","number":"PUP-6321","body":"The voxpupuli archive module contains a custom type that adds some file autorequires:\r\n\r\nhttps://github.com/voxpupuli/puppet-archive/blob/v0.5.1/lib/puppet/type/archive.rb#L162-L169\r\n{code}\r\nautorequire(:file) do\r\n    [\r\n      Pathname.new(self[:path]).parent.to_s,\r\n      self[:extract_path],\r\n      '/root/.aws/config',\r\n      '/root/.aws/credentials',\r\n    ]\r\n  end\r\n{code}\r\n\r\nIn this code, it is possible for {{self[:extract_path]}} to be {{undef}} if a user declares the resource without specifying it.  In Puppet 4.4.1, this does not cause a problem.  In Puppet 4.5.0, this results in the following error:\r\n\r\n{code}\r\nError: Failed to apply catalog: No title provided and :file is not a valid resource reference\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource.rb:544:in `extract_type_and_title'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource.rb:529:in `type_and_title'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:353:in `resource'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:2138:in `block (2 levels) in autorelation'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:2134:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:2134:in `block in autorelation'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:2069:in `block in eachautorequire'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:2068:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:2068:in `eachautorequire'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:2125:in `autorelation'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:2155:in `autorequire'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:169:in `block (2 levels) in build_autorelation_dependencies'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:168:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:168:in `block in build_autorelation_dependencies'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:167:in `each'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:167:in `build_autorelation_dependencies'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:25:in `populate_from'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:246:in `relationship_graph'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:175:in `relationship_graph'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:141:in `evaluate'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:222:in `block in apply'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:155:in `with_destination'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/report.rb:118:in `as_logging_destination'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:221:in `apply'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:171:in `block in apply_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:223:in `block in benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/2.1.0/benchmark.rb:294:in `realtime'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:222:in `benchmark'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:170:in `apply_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:315:in `run_internal'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:186:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:240:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:185:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:350:in `apply_catalog'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:274:in `block in main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:240:in `override'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:225:in `main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:170:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:540:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:128:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\n{code}\r\n\r\nHere are steps that can be used to reproduce on a clean CentOS7 VM:\r\n\r\n{code}\r\n# sudo rpm -ivh https://yum.puppetlabs.com/puppetlabs-release-pc1-el-7.noarch.rpm\r\n# yum install puppet-agent\r\n# /opt/puppetlabs/puppet/bin/puppet --version\r\n4.5.0\r\n# /opt/puppetlabs/puppet/bin/puppet module install puppet/archive --version 0.5.1\r\n# # cat > foo.pp <<EOF\r\narchive { 'git-client.hpi':\r\n   source => 'https://updates.jenkins-ci.org/download/plugins/git-client/1.19.6/git-client.hpi',\r\n   path => '/tmp/git-client.hpi',\r\n   checksum_verify => false,\r\n   checksum => undef,\r\n   checksum_type => 'sha1',\r\n   proxy_server => undef,\r\n   cleanup => false,\r\n   extract => false,\r\n}\r\nEOF\r\n# puppet apply ./foo.pp\r\nNotice: Compiled catalog for blah.blah in environment production in 0.08 seconds\r\nError: Failed to apply catalog: No title provided and :file is not a valid resource reference\r\n{code}\r\n\r\nDowngrading to an older version of Puppet fixes the issue:\r\n\r\n{code}\r\n# yum downgrade puppet-agent-1.4.1-1.el7\r\n# /opt/puppetlabs/puppet/bin/puppet --version\r\n4.4.1\r\n# /opt/puppetlabs/puppet/bin/puppet apply foo.pp\r\nNotice: Compiled catalog for blah.blah in environment production in 0.07 seconds\r\nNotice: /Stage[main]/Main/Archive[git-client.hpi]/ensure: replace archive: /tmp/git-client.hpi from (sha1)7ab5b9ec5635084ce192402e2d3203d2dfd66e65 to (sha1)\r\nNotice: Applied catalog in 1.64 seconds\r\n{code}","closed_at":"2021-06-10T23:43:31.000-0700","comments":14,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6321","labels":"couch-ss","state":"Closed","updated_at":"2021-06-10T23:43:31.000-0700","timestamp":1652286545.039087,"priority":"Critical","status_category":"Done","pull_request":4976},{"issue_id":"194231","title":"Fix broken implementation of Property#change_to_s method","url":"https://tickets.puppetlabs.com/browse/PUP-7616","created_at":"2017-06-02T14:23:33.000-0700","number":"PUP-7616","body":"The method {{Puppet::Property#change_to_s}}, which is used when constructing the message of an event, is broken. It calls the methods {{#is_to_s}} and {{#should_to_s}} to convert values to their string form and then calls {{#format_value_for_display}} to convert that string again.\r\n\r\nSometimes this almost works since the default implementation of the method {{#is_to_s}} just returns it's argument untouched (the documentation states that it produces a \"pretty printing string\", but it doesn't) so that two wrongs ends up as one right. The default for {{#should_to_s}} will however always convert its argument using default ruby string conversion (it converts to an array and joins with space).\r\n\r\nThis should be fixed so that the {{#change_to_s}} just calls {{#is_to_s}} and {{#should_to_s}} and the default implementation them then calls {{#format_value_for_display}}.","closed_at":"2021-06-11T12:50:21.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7616","labels":"resolved-issue-added","state":"Closed","updated_at":"2021-06-11T12:50:21.000-0700","timestamp":1652286545.656228,"priority":"Normal","status_category":"Done","pull_request":5960},{"issue_id":"199346","title":"New users with null passwords not created correctly","url":"https://tickets.puppetlabs.com/browse/PUP-7761","created_at":"2017-07-07T05:50:25.000-0700","number":"PUP-7761","body":"When using Puppet in a Beaker acceptance test to configure a user with a null password (in order to later test to ensure that null passwords would not be permitted to authenticate) I discovered a bug in Puppet when creating users with null passwords.\r\n\r\nGiven a manifest like:\r\n{code}\r\nuser { 'testuser': password => '' }\r\n{code}\r\n\r\nIt requires two Puppet runs to obtain the desired state.\r\n\r\nThis is due to https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/user/useradd.rb#L164 where properties with empty strings are not included.","closed_at":"2021-06-11T16:46:48.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7761","labels":"platform-os","state":"Closed","updated_at":"2021-06-11T16:46:48.000-0700","timestamp":1652286547.104557,"priority":"Minor","status_category":"Done","pull_request":6053},{"issue_id":"347802","title":"Class definition errors in multhreaded when using environment caching","url":"https://tickets.puppetlabs.com/browse/PUP-10318","created_at":"2020-02-27T08:05:00.000-0800","number":"PUP-10318","body":"When {{environment_timeout}} is set to something greater than 0 -- meaning we are caching environments -- we are seeing issues in multithreaded mode with errors like the following, coming out of our sandbox [thread testing environment|https://github.com/puppetlabs/puppetserver/tree/master/ext/thread_test]:\r\n\r\n{code}\r\n\"Server Error: Class 'threader::params_class' is already defined (file: /Users/aileen/code/server/puppetserver/ext/thread_test/environments/production/modules/threader/manifests/params_class.pp, line: 1); cannot redefine (file: /Users/aileen/code/server/puppetserver/ext/thread_test/environments/production/modules/threader/manifests/params_class.pp, line: 1) on node testone\"\r\n{code}\r\n\r\n{code}\r\n\"Server Error: Evaluation Error: Error while evaluating a Function Call, Could not find class ::threader::params_class for testtwo (file: /Users/aileen/code/server/puppetserver/ext/thread_test/environments/funky/manifests/init.pp, line: 9, column: 1) on node testtwo\"\r\n{code}\r\n\r\nThese are not fixed by the work so far in https://github.com/puppetlabs/puppet/pull/8002.","closed_at":"2021-06-11T17:08:14.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10318","labels":"doc_reviewed","state":"Resolved","updated_at":"2021-06-11T17:08:14.000-0700","timestamp":1652286547.512382,"priority":"Normal","status_category":"Done","pull_request":8019},{"issue_id":"261544","title":"Package pip provide won't work with ensure latest and custom index","url":"https://tickets.puppetlabs.com/browse/PUP-8949","created_at":"2018-06-19T08:45:25.000-0700","number":"PUP-8949","body":"Puppet agent will run every time if you have ensure => latest and custom index, for example\r\n{code:java}\r\npackage { 'mypippackage':\r\n  ensure          => latest,\r\n  provider        => 'pip',\r\n  install_options => { '--index' => 'https://pip.example.com' },\r\n} {code}\r\nI believe the issue is happening because puppet doesn't test package version against additional index (doesn;t use --index), while using --index on install.\r\n{code:java}\r\nDebug: Executing '/usr/bin/pip --version'\r\nDebug: Executing '/usr/bin/pip freeze --all'\r\nDebug: Executing '/usr/bin/pip --version'\r\nDebug: Executing '/usr/bin/pip --version'\r\nDebug: Executing '/usr/bin/pip install mypippackage==versionplease'\r\nDebug: /Stage[main]/Main/Package[mypippackage]/ensure: mypippackage \"1.2.3.post0\" is installed, latest is nil\r\nDebug: Executing: '/usr/bin/pip install -q --index=https://pip.example.com --upgrade mypippackage'\r\nNotice: /Stage[main]/Main/Package[mypippackage]/ensure: ensure changed '1.2.3.post0' to 'latest'\r\n {code}","closed_at":"2021-06-11T19:20:35.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8949","labels":"resolved-issue-added","state":"Closed","updated_at":"2021-06-11T19:20:35.000-0700","timestamp":1652286558.020901,"priority":"Normal","status_category":"Done","pull_request":7633},{"issue_id":"397714","title":"Ruby 3 changes default external encoding on Windows","url":"https://tickets.puppetlabs.com/browse/PUP-11049","created_at":"2021-04-29T16:21:21.000-0700","number":"PUP-11049","body":"Some encoding related tests fail on Windows on Ruby 3 in github actions. It appears ruby changed the default external encoding on Windows to be UTF-8, instead of the one that matches the native code page, eg. {{Encoding::CP437}}:\r\n\r\n{noformat}\r\nRun # https://github.com/ruby/ruby/pull/2791/files#diff-ff5ff976e81bebd977f0834e60416abbR97-R100\r\nActive code page: 437\r\n\r\nLCID             Name             DisplayName\r\n----             ----             -----------\r\n1033             en-US            English (United States)\r\n...\r\nopenssl (default: 2.2.0)\r\nOpenSSL Version - OpenSSL 1.1.1k  25 Mar 2021\r\nOpenSSL Library Version - OpenSSL 1.1.1k  25 Mar 2021\r\nPATH\r\n  remote: .\r\n  specs:\r\n    puppet (7.7.0)\r\n      CFPropertyList (~> 2.2)\r\n      concurrent-ruby (~> 1.0)\r\n      deep_merge (~> 1.0)\r\n      facter (>= 2.4.0, < 5)\r\n      fast_gettext (~> 1.1)\r\n      ffi (> 1.9.24, < 2)\r\n      hiera (>= 3.2.1, < 4)\r\n      locale (~> 2.1)\r\n      minitar (~> 0.9)\r\n      multi_json (~> 1.13)\r\n      scanf (~> 1.0)\r\n      semantic_puppet (~> 1.0)\r\n      sorted_set (~> 1.0)\r\n\r\nGEM\r\n  remote: https://rubygems.org/\r\n  specs:\r\n    CFPropertyList (2.3.6)\r\n    addressable (2.7.0)\r\n      public_suffix (>= 2.0.2, < 5.0)\r\n    artifactory (2.8.2)\r\n    concurrent-ruby (1.1.8)\r\n    crack (0.4.5)\r\n      rexml\r\n    csv (3.1.5)\r\n    deep_merge (1.2.1)\r\n    diff-lcs (1.4.4)\r\n    docopt (0.6.1)\r\n    facter (2.5.7-x64-mingw32)\r\n      ffi (~> 1.9)\r\n    fast_gettext (1.8.0)\r\n    ffi (1.15.0-x64-mingw32)\r\n    hashdiff (1.0.1)\r\n    hiera (3.7.0)\r\n    hiera-eyaml (3.2.1)\r\n      highline\r\n      optimist\r\n    highline (2.0.3)\r\n    hocon (1.3.1)\r\n    json-schema (2.8.1)\r\n      addressable (>= 2.4)\r\n    locale (2.1.3)\r\n    minitar (0.9)\r\n    msgpack (1.4.2)\r\n    multi_json (1.15.0)\r\n    optimist (3.0.1)\r\n    packaging (0.99.76)\r\n      artifactory (~> 2)\r\n      csv (= 3.1.5)\r\n      rake (>= 12.3)\r\n      release-metrics\r\n    public_suffix (4.0.6)\r\n    puppet-resource_api (1.8.13)\r\n      hocon (>= 1.0)\r\n    puppetserver-ca (2.1.0)\r\n      facter (>= 2.0.1, < 5)\r\n    rake (13.0.3)\r\n    rbtree (0.4.4)\r\n    release-metrics (1.1.0)\r\n      csv\r\n      docopt\r\n    rexml (3.2.5)\r\n    rspec (3.10.0)\r\n      rspec-core (~> 3.10.0)\r\n      rspec-expectations (~> 3.10.0)\r\n      rspec-mocks (~> 3.10.0)\r\n    rspec-core (3.10.1)\r\n      rspec-support (~> 3.10.0)\r\n    rspec-expectations (3.10.1)\r\n      diff-lcs (>= 1.2.0, < 2.0)\r\n      rspec-support (~> 3.10.0)\r\n    rspec-its (1.3.0)\r\n      rspec-core (>= 3.0.0)\r\n      rspec-expectations (>= 3.0.0)\r\n    rspec-mocks (3.10.2)\r\n      diff-lcs (>= 1.2.0, < 2.0)\r\n      rspec-support (~> 3.10.0)\r\n    rspec-support (3.10.2)\r\n    ruby-prof (1.4.3-x64-mingw32)\r\n    scanf (1.0.0)\r\n    semantic_puppet (1.0.3)\r\n    set (1.0.1)\r\n    sorted_set (1.0.3)\r\n      rbtree\r\n      set (~> 1.0)\r\n    vcr (5.1.0)\r\n    webmock (3.12.2)\r\n      addressable (>= 2.3.6)\r\n      crack (>= 0.3.2)\r\n      hashdiff (>= 0.4.0, < 2.0.0)\r\n    webrick (1.7.0)\r\n    yard (0.9.26)\r\n\r\nPLATFORMS\r\n  x64-mingw32\r\n\r\nDEPENDENCIES\r\n  diff-lcs (~> 1.3)\r\n  ffi\r\n  gettext-setup (~> 0.28)\r\n  hiera-eyaml\r\n  hocon (~> 1.0)\r\n  json-schema (~> 2.0)\r\n  memory_profiler\r\n  minitar (~> 0.9)\r\n  msgpack (~> 1.2)\r\n  packaging (~> 0.99)\r\n  pry\r\n  puppet!\r\n  puppet-resource_api (~> 1.5)\r\n  puppetserver-ca (~> 2.0)\r\n  racc (= 1.4.9)\r\n  rake (~> 13.0)\r\n  rdoc (~> 6.0)\r\n  ronn (~> 0.7.3)\r\n  rspec (~> 3.1)\r\n  rspec-expectations (~> 3.9, != 3.9.3)\r\n  rspec-its (~> 1.1)\r\n  rubocop (~> 0.49)\r\n  rubocop-i18n (~> 1.2.0)\r\n  ruby-prof (>= 0.16.0)\r\n  semantic_puppet (~> 1.0)\r\n  vcr (~> 5.0)\r\n  webmock (~> 3.0)\r\n  webrick (~> 1.7)\r\n  yard\r\n\r\nBUNDLED WITH\r\n   2.2.16\r\nruby 3.0.1p64 (2021-04-05 revision 0fb782ee38) [x64-mingw32]\r\n3.2.15\r\nBundler version 2.2.16\r\n...\r\nPuppet::Util#withenv on Windows works around Ruby bug 8822 (which fails to preserve UTF-8 properly when accessing ENV) (Ruby >= 2.3.x) \r\n     Failure/Error: raise 'This test requires a non-UTF8 codepage' if Encoding.default_external == Encoding::UTF_8\r\n     RuntimeError:\r\n       This test requires a non-UTF8 codepage\r\n     # ./spec/unit/util_spec.rb:147:in `block (3 levels) in <top (required)>'\r\n     # ./spec/spec_helper.rb:189:in `block (2 levels) in <top (required)>'\r\n     # util/rspec_runner:44:in `run'\r\n     # util/rspec_runner:59:in `<main>'\r\nFinished in 55.78 seconds (files took 3.11 seconds to load)\r\n\r\n  1) Puppet::Pops::Parser::Lexer2 when lexing files from disk should always read files as UTF-8\r\n     Failure/Error: raise 'This test must be run in a codepage other than 65001 to validate behavior'\r\n     RuntimeError:\r\n       This test must be run in a codepage other than 65001 to validate behavior\r\n     # ./spec/unit/pops/parser/lexer2_spec.rb:922:in `block (3 levels) in <top (required)>'\r\n     # ./spec/spec_helper.rb:189:in `block (2 levels) in <top (required)>'\r\n     # util/rspec_runner:44:in `run'\r\n     # util/rspec_runner:59:in `<main>'\r\n{noformat}","closed_at":"2021-06-14T10:02:00.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11049","labels":"","state":"Closed","updated_at":"2021-06-14T10:02:00.000-0700","timestamp":1652286558.333316,"priority":"Normal","status_category":"Done","pull_request":8626},{"issue_id":"383202","title":"apt provider does not work with local packages","url":"https://tickets.puppetlabs.com/browse/PUP-10854","created_at":"2021-01-14T05:17:44.000-0800","number":"PUP-10854","body":"*Puppet Version:* 6.19\r\n*Puppet Server Version:* n/a\r\n*OS Name/Version:* Debian/Ubuntu\r\n\r\nPUP-6631 indirectly broke the ability to manage local packages with the apt provider. This case appears to be supported by apt, so we should aim to fix this regression.\r\n\r\n*Desired Behavior:*\r\n\r\nApplying a resource like the following should work:\r\n\r\n{code}\r\npackage { '/path/to/package.deb': \r\n    ensure => installed,\r\n}\r\n{code}\r\n\r\n*Actual Behavior:*\r\n\r\nApplying the above resource results in the package being installed, but errors on the execution of {{apt-mark}}, marking the run as failed:\r\n\r\n{code}\r\nCould not evaluate: Execution of '/usr/bin/apt-mark manual /path/to/package.deb' returned 100: E: Unable to locate package /path/to/package.deb\r\n{code}\r\n\r\nPlease take a moment and attach any relevant log output and/or manifests. This will help us immensely when troubleshooting the issue.\r\n","closed_at":"2021-06-14T13:35:31.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10854","labels":"doc_reviewed","state":"Resolved","updated_at":"2021-06-14T13:35:31.000-0700","timestamp":1652286559.172626,"priority":"Normal","status_category":"Done","pull_request":8495},{"issue_id":"56590","title":"Puppet::Util::Windows::Process.execute leaks Win32::Process exception when it fails","url":"https://tickets.puppetlabs.com/browse/PUP-3561","created_at":"2014-10-28T17:18:21.000-0700","number":"PUP-3561","body":"When using validate_cmd on a windows box against Puppet 3.7+ it will leak the exception thrown by Win32::Process instead of throwing the Puppet::ExecutionFailure error we throw for other systems.\r\nhttps://github.com/puppetlabs/puppet/blob/master/lib/puppet/util/windows/process.rb#L12\r\n\r\nhttps://github.com/puppetlabs/puppetlabs-stdlib/pull/348/files has example of when this is done ","closed_at":"2021-06-15T06:56:33.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3561","labels":"windows","state":"Accepted","updated_at":"2021-06-15T06:56:33.000-0700","timestamp":1652286560.60644,"priority":"Normal","status_category":"To Do","pull_request":3253},{"issue_id":"340916","title":"Unexpected results on \"replace => false\" on symlinks","url":"https://tickets.puppetlabs.com/browse/PUP-10214","created_at":"2020-01-02T16:17:16.000-0800","number":"PUP-10214","body":"*Puppet Version: 5.5.17-1.el7*\r\n *Puppet Server Version:5.3.10-1.el7*\r\n *OS Name/Version: Centos 7*\r\n\r\nThis is a copy of an old redmine ticket that was never resolved:\r\n\r\n[https://projects.puppetlabs.com/issues/4872]\r\n\r\nTo summarize, if puppet contains a declaration:\r\n{code}file { '/foo':\r\n    ensure  => 'link',\r\n    target  => '/bar'\r\n    replace => false,\r\n}\r\n{code}\r\n...and '/foo' already exists as a dangling symlink (pointing to a file that does not exist), then puppet will change the symlink to point back to '/bar'.\r\n\r\n*Desired Behavior:*\r\n\r\nPuppet should respect {{replace =>}} false and not replace the symlink.\r\n\r\n*Actual Behavior:*\r\n\r\nAs described above, puppet replaces the symlink.\r\n\r\n \r\n\r\nI looked at the code and I think the current behavior is the same in master, though I don't have the means to test it myself. These parts seem relevant:\r\n\r\nlib/puppet/type/file/target.rb\r\n{code}     def insync?(currentvalue)\r\n      if [:nochange, :notlink].include?(self.should) or @resource.recurse?\r\n        return true\r\n      elsif ! @resource.replace? and Puppet::FileSystem.exist?(@resource[:path])\r\n        return true\r\n      else\r\n{code}\r\nlib/puppet/file_system.rb\r\n{code}  # Determines if a file exists by verifying that the file can be stat'd.\r\n  # Will follow symlinks and verify that the actual target path exists.\r\n  #\r\n  # @return [Boolean] true if the named file exists.\r\n  #\r\n  # @api public\r\n  #\r\n  def self.exist?(path)\r\n    @impl.exist?(assert_path(path))\r\n  end \r\n{code}\r\nI think that for this functionality, the file resource code should instead use a function that does _not_ follow symlinks. Puppet is supposed to be managing the symlink, and the target (present or not) is irrelevant. When creating a symlink, puppet correctly does not care if the target exists.\r\n\r\nThanks,\r\n Corey","closed_at":"2021-06-15T23:22:42.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10214","labels":"beginner","state":"Closed","updated_at":"2021-06-15T23:22:42.000-0700","timestamp":1652286561.954989,"priority":"Normal","status_category":"Done","pull_request":8643},{"issue_id":"189040","title":"The 'desired_value' as File mode is reported without leading zeros","url":"https://tickets.puppetlabs.com/browse/PUP-7493","created_at":"2017-05-03T06:57:03.000-0700","number":"PUP-7493","body":"A file mode change is reported inaccurately, for example, if the desired file mode value is '0640' and the actual value is '0660', the 'desired_value' is reported as '640', i.e. losing the leading zero.\r\n\r\nWe can observe this behaviour in PE 2016.4 (with puppet 4.10.1) and later but we didn't dive deeper in history, so this bug might have been there even since much older versions.\r\n\r\nHere's a snippet of a real report containing a trimmed file mode value in the event:\r\n{code}\r\n  File[pe-internal-mcollective-servers.cert.pem]: !ruby/object:Puppet::Resource::Status\r\n    title: pe-internal-mcollective-servers.cert.pem\r\n    file: \"/opt/puppetlabs/puppet/modules/puppet_enterprise/manifests/master/keypair.pp\"\r\n    line: 30\r\n    resource: File[pe-internal-mcollective-servers.cert.pem]\r\n    resource_type: File\r\n    containment_path:\r\n    - Stage[main]\r\n    - Puppet_enterprise::Profile::Master::Mcollective\r\n    - Puppet_enterprise::Master::Keypair[pe-internal-mcollective-servers]\r\n    - File[pe-internal-mcollective-servers.cert.pem]\r\n    evaluation_time: 0.002628581\r\n    tags:\r\n    - file\r\n    - pe-internal-mcollective-servers.cert.pem\r\n    - puppet_enterprise::master::keypair\r\n    - puppet_enterprise\r\n    - master\r\n    - keypair\r\n    - pe-internal-mcollective-servers\r\n    - class\r\n    - puppet_enterprise::profile::master::mcollective\r\n    - profile\r\n    - mcollective\r\n    - node\r\n    - default\r\n    time: '2017-04-28T11:07:47.359181163+00:00'\r\n    failed: false\r\n    changed: true\r\n    out_of_sync: true\r\n    skipped: false\r\n    change_count: 1\r\n    out_of_sync_count: 1\r\n    events:\r\n    - !ruby/object:Puppet::Transaction::Event\r\n      audited: false\r\n      property: mode\r\n      previous_value: '0660'\r\n      desired_value: '640'\r\n      historical_value:\r\n      message: mode changed '0660' to '0640'\r\n      name: :mode_changed\r\n      status: success\r\n      time: 2017-04-28 11:07:47.360815071 +00:00\r\n      redacted:\r\n      corrective_change: true\r\n    corrective_change: true\r\n{code}\r\n\r\nThis is the related puppet manifest that does contain the leading zero:\r\n{code:puppet}\r\ndefine puppet_enterprise::master::keypair(\r\n  $keypair_name = $title,\r\n){\r\n  File {\r\n    owner   => $puppet_enterprise::params::puppet_user,\r\n    group   => $puppet_enterprise::params::puppet_group,\r\n    mode    => '0640',\r\n    require => Package['pe-puppetserver'],\r\n  }\r\n\r\n  $cert_dir = \"${puppet_enterprise::params::ssl_dir}/certs\"\r\n  $private_key_dir = \"${puppet_enterprise::params::ssl_dir}/private_keys\"\r\n  $public_key_dir = \"${puppet_enterprise::params::ssl_dir}/public_keys\"\r\n\r\n  file { \"${keypair_name}.cert.pem\":\r\n    path    => \"${cert_dir}/${keypair_name}.pem\",\r\n    content => file(\"${cert_dir}/${keypair_name}.pem\", '/dev/null'),\r\n  }\r\n\r\n  file { \"${keypair_name}.private_key.pem\":\r\n    path    => \"${private_key_dir}/${keypair_name}.pem\",\r\n    content => Sensitive(file(\"${private_key_dir}/${keypair_name}.pem\", '/dev/null')),\r\n  }\r\n\r\n  file { \"${keypair_name}.public_key.pem\":\r\n    path    => \"${public_key_dir}/${keypair_name}.pem\",\r\n    content => file(\"${public_key_dir}/${keypair_name}.pem\", '/dev/null'),\r\n  }\r\n}\r\n{code}\r\n","closed_at":"2021-06-21T10:29:17.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7493","labels":"doc_reviewed;needs_epic","state":"Closed","updated_at":"2021-06-21T10:29:17.000-0700","timestamp":1652286562.572694,"priority":"Normal","status_category":"Done","pull_request":8633},{"issue_id":"401381","title":"Passing SemVer prerelease or build as a hash doesn't work","url":"https://tickets.puppetlabs.com/browse/PUP-11077","created_at":"2021-06-01T15:39:10.000-0700","number":"PUP-11077","body":"The [language specification|https://github.com/puppetlabs/puppet-specifications/blob/master/language/types_values_variables.md#semvernew] says you should be able to pass the SemVer {{prerelease}} and {{build}} components as a hash or list of arguments. However, the values are corrupted when SemVer objects are created this way:\r\n\r\n{noformat}\r\n❯ bx puppet apply  -e 'notice(SemVer(major => 1, minor => 0, patch => 0, prerelease => \"alpha\"))'\r\nNotice: Scope(Class[main]): 1.0.0-a.l.p.h.a\r\n...\r\n❯ bx puppet apply  -e 'notice(SemVer(major => 1, minor => 0, patch => 0, build => \"123\"))'       \r\nNotice: Scope(Class[main]): 1.0.0+1.2.3\r\n...\r\n{noformat}\r\n\r\nNote the extra dots in the output. This leads to confusing behavior:\r\n\r\n{noformat}\r\n❯ bx puppet apply  -e 'notice(SemVer(major => 1, minor => 0, patch => 0, build => \"123\") == SemVer(\"1.0.0+123\"))'\r\nNotice: Scope(Class[main]): false\r\n{noformat}\r\n\r\nPassing the build and prerelease components in the string version does work, because internally {{SemanticPuppet::Version.parse}} converts the [String component to an array|https://github.com/puppetlabs/semantic_puppet/blob/3ef28a432846c0d5492be1af3a412a1695b4b4b6/lib/semantic_puppet/version.rb#L38].\r\n\r\nThe problem is that the SemVer data type needs to pass the build and prerelease components as a single element array when calling {{SemanticPuppet::Version.new(.., prerelease, build)}}","closed_at":"2021-06-21T12:58:06.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11077","labels":"docs-reviewed","state":"Closed","updated_at":"2021-06-21T12:58:06.000-0700","timestamp":1652286563.800554,"priority":"Normal","status_category":"Done","pull_request":8616},{"issue_id":"399467","title":"Two Sensitive instances with the same value are not equal","url":"https://tickets.puppetlabs.com/browse/PUP-11061","created_at":"2021-05-13T14:30:35.000-0700","number":"PUP-11061","body":"Puppet Version: 7.6.0\r\n\r\nTwo instances of lib/puppet/pops/types/p_sensitive_type.rb Sensitive with the same value are not equal. The class is just using default object id for equality.\r\n\r\n*Desired Behavior:*\r\n\r\n{code}\r\njpartlow@work1804:~/work/src/puppet$ puppet apply -e '$a = Sensitive(\"secret\"); $b = Sensitive(\"secret\"); notice($a == $b)'\r\nNotice: Scope(Class[main]): true\r\nNotice: Compiled catalog for work1804.platform9.puppet.net in environment production in 0.03 seconds\r\nNotice: Applied catalog in 0.08 seconds\r\n{code}\r\n\r\n*Actual Behavior:*\r\n\r\n{code}\r\njpartlow@work1804:~/work/src/puppet$ puppet apply -e '$a = Sensitive(\"secret\"); $b = Sensitive(\"secret\"); notice($a == $b)'\r\nNotice: Scope(Class[main]): false\r\nNotice: Compiled catalog for work1804.platform9.puppet.net in environment production in 0.03 seconds\r\nNotice: Applied catalog in 0.08 seconds\r\n{code}","closed_at":"2021-06-21T12:58:14.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11061","labels":"docs-reviewed","state":"Resolved","updated_at":"2021-06-21T12:58:14.000-0700","timestamp":1652286563.907229,"priority":"Normal","status_category":"Done","pull_request":8603},{"issue_id":"401005","title":"Add catalog edge only if parent resource has a container","url":"https://tickets.puppetlabs.com/browse/PUP-11074","created_at":"2021-05-27T07:33:22.000-0700","number":"PUP-11074","body":"*Puppet Version: 7.7.0/6.23.0*\r\n *Puppet Server Version:* n/a\r\n *OS Name/Version: n/a*\r\n\r\nManaging resources with generators behaves differently with {{puppet resource}} and {{puppet apply}}.\r\n\r\nWhen running with {{puppet apply}}, the parent resource is always contained by something like {{Class[Main]}}, so adding an edge between that and our generated resource works.\r\n\r\nWhen running with {{puppet resource}}, the parent resource is not contained by anything ({{container_of(parent_resource)}} returns nil), which adds an edge with a nil vertex to the catalog. This in turn causes the run to fail with a NilClass exception when performing [pre-run checks|https://github.com/puppetlabs/puppet/blob/ab56d86ecb4b71298c75325462bf73376420bb40/lib/puppet/transaction.rb#L80] in the Transaction class, as the catalog now contains a nil vertex.\r\n\r\n*Desired Behavior:*\r\n\r\nRunning the following does not error:\r\n{code}\r\n> touch /tmp/asd\r\n> puppet resource tidy /tmp/asd age=0 --trace\r\n{code}\r\n\r\n*Actual Behavior:*\r\n\r\nRunning the above example gives the following error:\r\n{code}\r\nError: Could not run: undefined method `pre_run_check' for nil:NilClass\r\n/root/puppet/lib/puppet/transaction.rb:82:in `block in perform_pre_run_checks'\r\n/root/puppet/lib/puppet/transaction.rb:78:in `each'\r\n/root/puppet/lib/puppet/transaction.rb:78:in `perform_pre_run_checks'\r\n/root/puppet/lib/puppet/transaction.rb:104:in `evaluate'\r\n/root/puppet/lib/puppet/resource/catalog.rb:240:in `block (2 levels) in apply'\r\n[snip]\r\n{code}\r\n\r\n","closed_at":"2021-06-21T12:58:25.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11074","labels":"docs-reviewed","state":"Closed","updated_at":"2021-06-21T12:58:25.000-0700","timestamp":1652286564.01069,"priority":"Normal","status_category":"Done","pull_request":8614},{"issue_id":"402382","title":"Creating new user on macOS 10.14 results in `Operation not permitted` error","url":"https://tickets.puppetlabs.com/browse/PUP-11095","created_at":"2021-06-07T07:54:31.000-0700","number":"PUP-11095","body":"*Puppet Version:*7.7.0\r\n*OS Name/Version:*macOS 10.14\r\n\r\nCreating a new user on macOS 10.14 sometimes results in the following error:\r\n*Operation not permitted @ rb_sysopen - /var/db/dslocal/nodes/Default/users/testuser.plist*\r\n\r\nThis issue is not seen on macOS 10.15 or macOS 11.\r\n\r\nManifest used:\r\n\r\n{code:puppet}\r\n user { 'testuser':\r\n            ensure => present,\r\n            password => '6ce97688468f231845d9d982f1f10832ca0c6c728a77bac51c548af99ebd9b9c62bcba15112a0c7a7e34effbb2e92635650c79c51517d72b083a4eb2a513f51ad1f8ea9556cef22456159c341d8bcd382a91708afaf253c2b727d4c6cd3d29cc26011d5d511154037330ecea0263b1be8c1c13086d029c57344291bd37952b56',\r\n            salt       => '377e8b60e5fdfe509cad188d5b1b9e40e78b418f8c3f0127620ea69d4c32789c',\r\n            iterations => 40000,\r\n          }\r\n{code}\r\n","closed_at":"2021-06-21T12:58:34.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11095","labels":"docs-reviewed","state":"Closed","updated_at":"2021-06-21T12:58:34.000-0700","timestamp":1652286564.135356,"priority":"Normal","status_category":"Done","pull_request":8622},{"issue_id":"400737","title":"Puppet agent lacks access to user keychains on macOS","url":"https://tickets.puppetlabs.com/browse/PUP-11081","created_at":"2021-05-25T13:48:52.000-0700","number":"PUP-11081","body":"We have puppet-agent running on macOS 11.1.0. Puppet is added to Full Disk Access list.\r\n\r\nOne of things we have managed by Puppet is running a python script as some user via exec resource. The script has the following part:\r\n{code:python}\r\ncontents = subprocess.check_output(['security', 'cms', '-D', '-i', path])\r\n{code}\r\n\r\nIt works fine when run by hand ({{sudo -u user /my/script.py}}) and it also works fine when run with {{sudo puppet agent -t}}, but fails when puppet-agent is run as daemon with the following error:\r\n{code}\r\nsecurity: cert import failed: Write permissions error.\r\nsecurity: problem decoding\r\n{code}\r\n\r\nWhile researching the problem, I found SO post with similar problem: https://stackoverflow.com/questions/26474949/mac-security-command-needs-write-permissions-when-run-by-daemon. And there was referenced answer from another SO post: https://stackoverflow.com/questions/6827874/missing-certificates-and-keys-in-the-keychain-while-using-jenkins-hudson-as-cont/9482707#9482707.\r\n\r\nI took advice from the answer and added the following two lines to {{/Library/LaunchDaemons/com.puppetlabs.puppet.plist}}:\r\n{code}\r\n        <key>SessionCreate</key>\r\n        <true />\r\n{code}\r\nAnd then I run {{launchd bootout system/puppet}} and {{launchctl bootstrap system /Library/LaunchDaemons/com.puppetlabs.puppet.plist}} (I'm not really a Mac user, mainly Linux admin, so maybe the last part was not needed), and after that the script runs fine from puppet-agent running as a daemon.\r\n\r\nPlease consider adding this modification to plist for puppet agent packages for Mac (I've checked agent version 7.6.1-1.osx10.15 - plist looks like plist for version 6.3.0), or suggest another way of solving that problem.","closed_at":"2021-06-21T12:59:45.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11081","labels":"community;docs-reviewed","state":"Closed","updated_at":"2021-06-21T12:59:45.000-0700","timestamp":1652286564.236752,"priority":"Normal","status_category":"Done","pull_request":8617},{"issue_id":"392819","title":"service enable=mask fails when service isn't present","url":"https://tickets.puppetlabs.com/browse/PUP-10974","created_at":"2021-03-25T11:20:02.000-0700","number":"PUP-10974","body":"*Puppet Version: 6.21.1, 7.5.0*\r\n *Puppet Server Version: N/A*\r\n *OS Name/Version: CentOS 7*\r\n\r\nWith the systemd provider, setting {{enable}} to {{mask}} on a service that does not exist fails.\r\n\r\n*Desired Behavior:*\r\n\r\nMasking a service should work whether or not the service exists (the way that setting {{enable}} to {{false}} works either way).\r\n\r\n*Actual Behavior:*\r\n{noformat}\r\n[root@puppet ~]# systemctl list-unit-files | grep madeup\r\n[root@puppet ~]# puppet resource service madeup\r\nservice { 'madeup':\r\n ensure => 'stopped',\r\n enable => 'false',\r\n provider => 'systemd',\r\n}\r\n[root@puppet ~]# puppet resource service madeup enable=mask\r\nError: Could not disable madeup: \r\nError: /Service[madeup]/enable: change from 'false' to 'mask' failed: Could not disable madeup: \r\nservice { 'madeup':\r\n enable => 'false',\r\n provider => 'systemd',\r\n}\r\n[root@puppet ~]# systemctl mask madeup\r\nCreated symlink from /etc/systemd/system/madeup.service to /dev/null.\r\n[root@puppet ~]# systemctl list-unit-files | grep madeup\r\nmadeup.service masked{noformat}\r\nThe error here appears to be coming from [https://github.com/puppetlabs/puppet/blob/85bd9ed07e3e6c956f1972624a50be914292e1ab/lib/puppet/provider/service/systemd.rb#L162.]  If I wrap that in a begin block, the service is masked properly.","closed_at":"2021-06-21T13:00:10.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10974","labels":"community;docs-reviewed","state":"Closed","updated_at":"2021-06-21T13:00:10.000-0700","timestamp":1652286564.341487,"priority":"Normal","status_category":"Done","pull_request":8623},{"issue_id":"57947","title":"NIM provider uses a regex that is too restrictive when parsing RPM release tags","url":"https://tickets.puppetlabs.com/browse/PUP-3631","created_at":"2014-11-06T14:53:00.000-0800","number":"PUP-3631","body":"The NIM provider uses a regex that is too restrictive when parsing RPM release tags, it only allows numbers. For example if a package has a security release that includes letters it will fail to recognize it as a valid package name. \r\nThe package \"wget-1.9.1-2ssl\" gives the error: \"Unable to parse output from nimclient showres: package string does not match expected rpm package string format\"","closed_at":"2021-06-21T13:00:23.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3631","labels":"aix;docs-reviewed;jira_escalated;package;platform-os;type_and_provider","state":"Closed","updated_at":"2021-06-21T13:00:23.000-0700","timestamp":1652286564.443854,"priority":"Major","status_category":"Done","pull_request":8621},{"issue_id":"283329","title":"Audit and fix locations where set_mode is called with inappropriate permissions on Windows","url":"https://tickets.puppetlabs.com/browse/PUP-9297","created_at":"2018-11-01T00:58:04.000-0700","number":"PUP-9297","body":"[PUP-9216|https://github.com/puppetlabs/puppet/commit/2a4ba1c9f2ac1b6dcb48f3cb6d48351724987164] was merged earlier, which sets System ACE entries to full control. This triggers a failure in pxp-agent's [tasks.run_puppet.rb|https://github.com/puppetlabs/pxp-agent/blob/1.9.x/acceptance/tests/tasks/run_puppet.rb] test, specifically [here|https://github.com/puppetlabs/pxp-agent/blob/1.9.x/acceptance/tests/tasks/run_puppet.rb#L42] based on the stack trace.\r\n\r\nRepresentative job link: https://jenkins-platform.delivery.puppetlabs.net/view/puppet-agent/view/Acceptance%20Suites/view/5.5.x/view/Suite/job/platform_puppet-agent_puppet-agent-integration-suite_daily-5.5.x/232/RMM_COMPONENT_TO_TEST_NAME=pxp_agent,SLAVE_LABEL=beaker,TEST_TARGET=windows10ent-64a/\r\n\r\nRepresentative failure output:\r\n{code}\r\nSuccessful task expected to have no output on stderr. --- expected +++ actual @@ -1 +1,2 @@ -nil +\"\\e[1;33mWarning: An attempt to set mode 416 on item C:/ProgramData/PuppetLabs/puppet/cache/reports/xln2koezj7avuqx.delivery.puppetlabs.net/201810110803.yaml would result in the group, SYSTEM, to have less than Full Control rights. This attempt has been corrected to Full Control\\e[0m +\" \r\n{code}\r\n\r\n---\r\n\r\nPull Request https://github.com/puppetlabs/puppet/pull/7167 was raised to fix one place where {{set_mode}} was used, however some other testing exposed there are other places where set_mode is used to set inappropriate permissions on Windows platforms; e.g. https://github.com/puppetlabs/puppet/pull/7167#issuecomment-430682091\r\n\r\nThis issue will track the work to find all of the set_mode call sites and audit them for appropriate-ness on Windows platforms.  And then raise fix PRs where needed.","closed_at":"2021-06-22T01:32:16.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9297","labels":"","state":"Accepted","updated_at":"2021-06-22T01:32:16.000-0700","timestamp":1652286565.062706,"priority":"Normal","status_category":"To Do","pull_request":7167},{"issue_id":"109482","title":"Puppet apply doesn't protect shared files with a lock","url":"https://tickets.puppetlabs.com/browse/PUP-5609","created_at":"2015-12-14T12:16:05.000-0800","number":"PUP-5609","body":"Puppet apply should use a filesystem lock just like agent to protect shared state files from simultaneous writes (it actually writes to the same state files as agent even).","closed_at":"2021-06-22T01:54:18.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5609","labels":"","state":"Accepted","updated_at":"2021-06-22T01:54:18.000-0700","timestamp":1652286565.373174,"priority":"Normal","status_category":"To Do","pull_request":4584},{"issue_id":"188603","title":"useradd provider silently does not set password","url":"https://tickets.puppetlabs.com/browse/PUP-7486","created_at":"2017-04-30T15:39:25.000-0700","number":"PUP-7486","body":"h3. Issue\r\n\r\nWhen libshadow is not present on a client, the agent will silently not set the password for a user. In this case silence is not golden because a system can become insecure (e.g. rotating root passwords) and there is no report of the failure to update the password.\r\n\r\nh3. Repro\r\n\r\nDockerfile:\r\n{code:Dockerfile}\r\nFROM centos:7\r\n\r\nRUN rpm -Uvh https://yum.puppetlabs.com/puppetlabs-release-el-7.noarch.rpm && \\\r\n    yum install -y puppet-3.8.7\r\n{code}\r\n\r\nrun.sh:\r\n{code:bash}\r\n#!/bin/bash\r\n\r\necho \"==> Setting password for bob to 'alice'...\"\r\npuppet apply -tv --execute \"user {'bob': password => 'alice', }\"\r\ngrep bob /etc/shadow\r\necho\r\n\r\nrpm --nodeps --erase ruby-shadow\r\necho \"==> Setting password for bob to 'robert'...\"\r\npuppet apply -tv --execute \"user {'bob': password => 'robert', }\"\r\ngrep bob /etc/shadow\r\n{code}\r\n\r\n{code:bash}\r\n$ docker run --rm -t -v $PWD/run.sh:/run.sh puppet /run.sh\r\n==> Setting password for bob to 'alice'...\r\nNotice: Compiled catalog for b2a735570f73.local in environment production in 0.16 seconds\r\nInfo: Applying configuration version '1493591675'\r\nNotice: /Stage[main]/Main/User[bob]/ensure: created\r\nInfo: Creating state file /var/lib/puppet/state/state.yaml\r\nNotice: Finished catalog run in 0.50 seconds\r\nbob:alice:17286:0:99999:7:::\r\n\r\n==> Setting password for bob to 'robert'...\r\nNotice: Compiled catalog for b2a735570f73.local in environment production in 0.15 seconds\r\nInfo: Applying configuration version '1493591678'\r\nNotice: Finished catalog run in 0.04 seconds\r\nbob:alice:17286:0:99999:7:::\r\n{code}","closed_at":"2021-07-06T07:22:40.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7486","labels":"linux;platform-os;security;type_and_provider;user","state":"Accepted","updated_at":"2021-07-06T07:22:40.000-0700","timestamp":1652286567.142013,"priority":"Normal","status_category":"To Do","pull_request":5839},{"issue_id":"381638","title":"Agent failures with server_list when one puppetserver fails","url":"https://tickets.puppetlabs.com/browse/PUP-10844","created_at":"2020-12-22T08:06:55.000-0800","number":"PUP-10844","body":"*Puppet Version:* 6.15.0+\r\n*Puppet Server Version:* 6.x\r\n*OS Name/Version:* Any\r\n\r\nAfter the changes in 6.15.0 the server_list setting has different behavior. Previously when server_list was configured and the first puppetserver in the list failed, the agent would continue to run by connecting to the next puppetserver on the list. In 6.15.0, if the primary puppetserver fails while an agent is running, it results in a failed agent run.\r\n\r\n*Desired Behavior:*\r\nWhen the first puppetserver in the server_list goes offline, the agents should automatically try to connect to the second puppetserver in the server_list even if it is mid agent run.\r\n\r\n*Actual Behavior:*\r\nThe agent run fails if the first puppetserver in the server_list goes offline while the agent is in the middle of a run. \r\n\r\nSome failures are below.\r\n\r\n{noformat}\r\nCould not evaluate: Could not retrieve file metadata for puppet:///pe_packages/2019.8.1/windows-x86_64/puppet-agent-x64.msi: Request to https://primary.example.com:8140/puppet/v3/file_metadata/pe_packages/2019.8.1/windows-x86_64/puppet-agent-x64.msi?links=manage&checksum_type=sha256lite&source_permissions=ignore&environment=windows_testing failed after 21.011 seconds: Failed to open TCP connection to primary.example.com:8140 (A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond. - connect(2) for \"primary.example.com\" port 8140)\r\n{noformat}\r\n\r\n{noformat}\r\npuppet-agent[7053]: Could not retrieve catalog from remote server: Request to https://primary.example.com:8140/puppet/v3/catalog/agent.example.com?environment=development failed after 0.004 seconds: Failed to open TCP connection to primary.example.com:8140 (Connection refused - connect(2) for \"primary.example.com\" port 8140)\r\n{noformat}\r\n\r\n*Reproduction*\r\n1. Configure the server_list for two Puppetservers\r\n2. Configure 10 agents with the server_list and a run interval of a minute\r\n3. Shutdown the Puppetserver service on the first server in the server_list\r\n\r\nLikely one of the agents will have the failure. It seems to be more reproducible with file resources inside the catalog.\r\n\r\nWe believe this is related to the changes in PUP-10363","closed_at":"2021-07-06T07:38:31.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10844","labels":"doc-reviewed;jira_escalated;platform_7.2","state":"Closed","updated_at":"2021-07-06T07:38:31.000-0700","timestamp":1652286567.459655,"priority":"Normal","status_category":"Done","pull_request":8573},{"issue_id":"235941","title":"type parameters do not honor when default is set to false","url":"https://tickets.puppetlabs.com/browse/PUP-8442","created_at":"2018-02-08T17:04:50.000-0800","number":"PUP-8442","body":"In our puppet types, we are able to set defaults for parameters defined for each type. However, if a given parameter defaults to false, the code will take that for falsiness and not include that parameter as set, even though it should be. This originates at https://github.com/puppetlabs/puppet/blob/327b03a9e1ecdc7b925720a4eec59795f4456a56/lib/puppet/type.rb#L834, where {{value = parameter.default}} will return false and send us into the else block of that if statement, which removes our parameter from the list of parameters for our given resource.\r\n\r\nThis will likely result in some unexpected changes once we fix it.","closed_at":"2021-07-07T16:34:17.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8442","labels":"","state":"Ready for Engineering","updated_at":"2021-07-07T16:34:17.000-0700","timestamp":1652286576.771006,"priority":"Normal","status_category":"To Do","pull_request":6703},{"issue_id":"368953","title":"Request to status endpoint not using extra_headers setting","url":"https://tickets.puppetlabs.com/browse/PUP-10617","created_at":"2020-08-12T07:00:42.000-0700","number":"PUP-10617","body":"When using server_list, Puppet 6 adds a [new request|https://github.com/puppetlabs/puppet/blob/eadd5474c26e7d28d90de00b9d7a7545ac10e55d/lib/puppet/http/resolver/server_list.rb#L61] to validate that the server is listening. This request is done by using [Puppet::HTTP::Client|https://github.com/puppetlabs/puppet/blob/main/lib/puppet/http/client.rb] which in opposition to [Puppet::HTTP::Service|https://github.com/puppetlabs/puppet/blob/main/lib/puppet/http/service.rb], doesn't have a [proper way to handle the http_extra_headers setting|https://github.com/puppetlabs/puppet/blob/main/lib/puppet/http/service.rb#L110].\r\n\r\nThis supposes a problem as I'm redirecting the traffic based on that header. As the header is not present in status requests, the catalog compilation doesn't go through.\r\n\r\nFor more information on the extra_header setting refer to PUP-9566.","closed_at":"2021-07-07T16:37:20.000-0700","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10617","labels":"doc_reviewed","state":"Resolved","updated_at":"2021-07-07T16:37:20.000-0700","timestamp":1652286577.902404,"priority":"Normal","status_category":"Done","pull_request":8291},{"issue_id":"339935","title":"yum provider does not allow array of strings","url":"https://tickets.puppetlabs.com/browse/PUP-10177","created_at":"2019-12-17T10:30:50.000-0800","number":"PUP-10177","body":" \r\n*Puppet Version: Any*\r\n*Puppet Server Version: Any*\r\n*OS Name/Version: RHEL (All versions)*\r\n\r\nWhen using the puppet_agent module to update an RPM to the latest the install_options flags --enablerepo and --disablerepo only accepts array of hashes and not an array of Strings. This contradictory to the following documentation: [https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/package.rb#L36-L58]\r\n\r\n*PR:* Puppet 5.x: [https://github.com/puppetlabs/puppet/pull/7879 |https://github.com/puppetlabs/puppet/pull/7879] and Puppet 6.x: \\{PR to come, will update when available}\r\n\r\n*Desired Behavior:*\r\n\r\nUser's should be able to specify any package manager option as an array of String or an array of Hashes.\r\n\r\nThe docs detail the user can pass an array of strings or hashes.  However, there are no tests in the puppet code base that back up these claims.\r\n*Actual Behavior:*\r\n\r\nOnly --enablerepo and --disablerepo are special for YUM as they affect which packages are visible to the package manager. The logic that pulls them out for use in things like version checks only looks for Hash form of specifying an option: [https://github.com/puppetlabs/puppet/blob/5.5.17/lib/puppet/provider/package/yum.rb#L268-L296]\r\n\r\ncreate a /tmp/test.pp file with the following contents:\r\n # cat /tmp/test.pp\r\n package \\{ 'nginx':   ensure          => 'latest',   install_options => [ '--enablerepo=\"dev-*\"' ], }\r\n_nginx_ can be any rpm package\r\n\r\n Details show that an updated package was available and did not apply, contents of the manifest being applied:\r\n\r\n root@:~\r\n\r\n # yum list --enablerepo=dev nginx\r\n Loaded plugins: langpacks, package_upload, product-id, search-disabled-repos\r\n Installed Packages\r\n nginx.x86_64                                            0.0.1.1111-1e8410a                                            @dev-dev\r\n Available Packages\r\n nginxx86_64                                            0.0.1.1114-5e669d5                                           dev\r\n\r\n root@:~\r\n # cat /tmp/test.pp\r\n package \\{ 'nginx':   ensure          => 'latest',   install_options => [ '--enablerepo=\"dev-*\"' ], }\r\n\r\n root@:~\r\n\r\n # puppet apply /tmp/test.pp\r\n Notice: Compiled catalog for <hostname> in environment production in 0.02 seconds\r\n Notice: Applied catalog in 2.11 seconds\r\n\r\n Full puppet apply --debug /tmp/test.pp attached. ","closed_at":"2021-07-07T16:37:20.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10177","labels":"resolved-issue-added","state":"Resolved","updated_at":"2021-07-07T16:37:20.000-0700","timestamp":1652286578.006876,"priority":"Normal","status_category":"Done","pull_request":7879},{"issue_id":"251856","title":"puppet device fails with undefined method `loaders' for nil:NilClass when env is not production","url":"https://tickets.puppetlabs.com/browse/PUP-8766","created_at":"2018-05-21T11:09:27.000-0700","number":"PUP-8766","body":"The {{puppet device}} command fails with when {{environment}} is not 'production' and {{environment}} is specified locally in either {{puppet.conf}} or via the {{--environment}} option ...\r\n\r\n{code}\r\n[root@pe-201810-agent ~]# puppet device --verbose --environment=development\r\nError: Could not run: undefined method `loaders' for nil:NilClass\r\n{code}\r\n\r\nIt succeeds if environment is server-specified ...\r\n\r\n{code}\r\n[root@pe-201810-agent ~]# puppet device --verbose #--environment=development\r\nInfo: starting applying configuration to cisco.example.com at file:///etc/puppetlabs/puppet/devices/cisco.example.com.yaml\r\nNotice: Local environment: 'production' doesn't match server specified node environment 'development', switching agent to 'development'.\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Caching catalog for cisco.example.com\r\nInfo: Applying configuration version '1526925344'\r\nNotice: Applied catalog in 0.12 seconds\r\n{code}\r\n\r\nNote that even when the agent is not in production, only the production directory is created locally:\r\n\r\n{code}\r\n[root@pe-201810-agent ~]#  ls -al /etc/puppetlabs/code/environments/\r\ntotal 0\r\ndrwxr-xr-x 3 root root 23 May 21 17:28 .\r\ndrwxr-xr-x 4 root root 39 May 21 17:12 ..\r\ndrwxr-x--- 5 root root 87 May 21 17:29 production\r\n{code}","closed_at":"2021-07-07T16:37:21.000-0700","comments":19,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8766","labels":"resolved-issue-added","state":"Closed","updated_at":"2021-07-07T16:37:21.000-0700","timestamp":1652286578.116315,"priority":"Normal","status_category":"Done","pull_request":7242},{"issue_id":"389668","title":"Recursive file resources generate dangerous numbers of resource events","url":"https://tickets.puppetlabs.com/browse/PUP-10946","created_at":"2021-03-02T15:33:59.000-0800","number":"PUP-10946","body":"The {{file}} and {{tidy}} resource types have recursion options that allow the management of entire directory trees. This is accomplished by walking the tree and generating a new {{file}} resource that manages the state of each entry separately. This approach works well for small numbers of files (100s) but generates excessive numbers of events when applied to directory trees that contain large numbers of files. At high file counts, the behavior is detrimental to Puppet Agent performance and can cause Puppet Server outages by generating large reports. This behavior also combines poorly with {{noop => true}} which causes the large number of events to be reported every time Puppet runs instead of once when the state is enforced.\r\n\r\nh2. Reporduction Case\r\n\r\n  - Install Puppet Server 7 on a CentOS 7 node:\r\n\r\n{code:bash}\r\nyum install -y http://yum.puppetlabs.com/puppet7-release-el-7.noarch.rpm\r\nyum install -y puppetserver\r\nsource /etc/profile.d/puppet-agent.sh\r\n\r\npuppet config set server $(hostname -f)\r\npuppetserver ca setup\r\n\r\nsystemctl start puppetserver\r\n{code}\r\n\r\n  - Install PuppetDB 7 and configure it as a report processor:\r\n\r\n{code:bash}\r\npuppet module install puppetlabs-puppetdb\r\n\r\npuppet apply <<'EOF'\r\nclass { 'puppetdb':\r\n  postgres_version => '11',\r\n}\r\n\r\nclass { 'puppetdb::master::config':\r\n  enable_reports          => true,\r\n  manage_report_processor => true,\r\n}\r\nEOF\r\n{code}\r\n\r\n  - Next, configure Puppet Server to use one JRuby instance with the default allocation of 512 MB of RAM:\r\n\r\n{code:bash}\r\npuppet module install puppetlabs-hocon\r\n\r\npuppet apply <<'EOF'\r\nservice { 'puppetserver':\r\n  ensure => running,\r\n}\r\n\r\nini_subsetting {\r\n  default:\r\n    ensure            => present,\r\n    path              => '/etc/sysconfig/puppetserver',\r\n    section           => '',\r\n    key_val_separator => '=',\r\n    setting           => 'JAVA_ARGS',\r\n    notify            => Service['puppetserver'],\r\n  ;\r\n  'puppetserver min ram':\r\n    subsetting => '-Xms',\r\n    value      => '512m',\r\n  ;\r\n  'puppetserver max ram':\r\n    subsetting => '-Xmx',\r\n    value      => '512m',\r\n  ;\r\n}\r\n\r\nfile_line { 'fix EZ-142':\r\n  ensure => present,\r\n  path   => '/opt/puppetlabs/server/apps/puppetserver/cli/apps/start',\r\n  line   => \"out_of_memory_flag='-XX:OnOutOfMemoryError=kill -9 %p'\",\r\n  match  => '^out_of_memory_flag=',\r\n  notify => Service['puppetserver'],\r\n}\r\n\r\nhocon_setting { 'puppetserver jruby instances':\r\n  ensure  => present,\r\n  path    => '/etc/puppetlabs/puppetserver/conf.d/puppetserver.conf',\r\n  setting => 'jruby-puppet.max-active-instances',\r\n  value   => 1,\r\n  notify  => Service['puppetserver'],\r\n}\r\nEOF\r\n{code}\r\n\r\n  - Generate certificates for a test node and configure it to recursively purge a deep directory tree:\r\n\r\n{code:bash}\r\ncurl -L https://raw.githubusercontent.com/LLNL/fdtree/master/fdtree.bash -o /usr/local/bin/fdtree\r\nmkdir -p /tmp/recursion_test\r\n\r\n# Create, 1 level, 19 directories per level, 999 files per directory, 0 bytes per file\r\nbash /usr/local/bin/fdtree -C -l 1 -d 19 -f 999 -s 0 -o /tmp/recursion_test\r\n\r\npuppetserver ca generate --certname recursion.test\r\n\r\ncat <<'EOF' >>/etc/puppetlabs/code/environments/production/manifests/site.pp\r\nnode 'recursion.test' {\r\n  file {\"/tmp/recursion_test\":\r\n    ensure  => directory,\r\n    recurse => true,\r\n    purge   => true,\r\n    noop    => true,\r\n  }\r\n}\r\nEOF\r\n{code}\r\n\r\n  - Run `puppet agent` to enforce the resource and submit a report (this will take about 5 minutes):\r\n\r\n{code:bash}\r\n# Direct output to /dev/null to avoid spamming the console\r\npuppet agent -t --certname recursion.test &>/dev/null\r\n{code}\r\n\r\n  - Check the puppetserver service to see if it survived.\r\n\r\nh3. Outcome\r\n\r\nWhen faced with the prospect of processing such a large quantity of events, puppetserver chose to reincarnate:\r\n\r\n{noformat}\r\n# journalctl SYSLOG_IDENTIFIER=puppetserver + UNIT=puppetserver.service\r\n-- Logs begin at Tue 2021-03-02 23:07:14 UTC, end at Tue 2021-03-02 23:31:35 UTC. --\r\nMar 02 23:11:23 wine-appointee systemd[1]: Starting puppetserver Service...\r\nMar 02 23:11:41 wine-appointee systemd[1]: Started puppetserver Service.\r\nMar 02 23:12:43 wine-appointee systemd[1]: Stopping puppetserver Service...\r\nMar 02 23:12:44 wine-appointee systemd[1]: Starting puppetserver Service...\r\nMar 02 23:13:02 wine-appointee systemd[1]: Started puppetserver Service.\r\nMar 02 23:26:54 wine-appointee systemd[1]: Stopping puppetserver Service...\r\nMar 02 23:26:55 wine-appointee systemd[1]: Starting puppetserver Service...\r\nMar 02 23:27:13 wine-appointee systemd[1]: Started puppetserver Service.\r\nMar 0 23:31:35 wine-appointee puppetserver[2930]: #\r\nMar 02 23:31:35 wine-appointee puppetserver[2930]: # java.lang.OutOfMemoryError: GC overhead limit exceeded\r\nMar 02 23:31:35 wine-appointee puppetserver[2930]: # -XX:OnOutOfMemoryError=\"kill -9 %p\"\r\nMar 02 23:31:35 wine-appointee puppetserver[2930]: #   Executing /bin/sh -c \"kill -9 2955\"...\r\nMar 02 23:31:35 wine-appointee systemd[1]: puppetserver.service: main process exited, code=killed, status=9/KILL\r\nMar 02 23:31:35 wine-appointee systemd[1]: Unit puppetserver.service entered failed state.\r\nMar 02 23:31:35 wine-appointee systemd[1]: puppetserver.service failed.\r\nMar 02 23:31:35 wine-appointee systemd[1]: puppetserver.service holdoff time over, scheduling restart.\r\nMar 02 23:31:35 wine-appointee systemd[1]: Starting puppetserver Service...2\r\n{noformat}\r\n\r\nh3. Expected Outcome\r\n\r\nFile recursion can't DOS the puppetserver service.","closed_at":"2021-07-07T23:49:58.000-0700","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10946","labels":"doc-reviewed;jira_escalated","state":"Resolved","updated_at":"2021-07-07T23:49:58.000-0700","timestamp":1652286578.223941,"priority":"Major","status_category":"Done","pull_request":8598},{"issue_id":"249363","title":"--extra cli option is nonfunctional","url":"https://tickets.puppetlabs.com/browse/PUP-8700","created_at":"2018-05-04T16:52:30.000-0700","number":"PUP-8700","body":"*Puppet Version: 5.5.1*\r\n *Puppet Server Version: N/A*\r\n *OS Name/Version: Centos 7.4.1708*\r\n\r\nMany `puppet` applications such as `puppet facts` and `puppet catalog` take a `–terminus` option to specify what indirector to use. These applications generally also specify a `–extra` argument, like so:\r\n\r\n`--extra HASH                  - Extra arguments to pass to the indirection request`\r\n\r\nAs far as I can determine, this argument is not actually possible to use, since any argument supplied to the `–extra` option is treated by Ruby as a String. For example, `puppet facts --terminus network_device --extra '\\{target => \"example-device\"}'` results in `Error: Could not call 'find' on 'facts': undefined method `inject' for \"\\{target => \\\"example-device\\\"}\":String`\r\n\r\nThe same results are had when trying other hash-ish syntaxes such as JSON or key-value pairs.\r\n\r\nIf there's some existing syntax that will actually work here, it should be documented. But I had a look through the source code, and I don't think any such syntax exists.\r\n\r\nDescribe steps to reproduce…\r\n\r\n`puppet facts --terminus network_device --extra <anything at all here>`\r\n\r\n*Desired Behavior:*\r\n\r\n**The `–extra` argument should function, or should be removed.\r\n\r\n*Actual Behavior:*\r\n\r\n \r\n\r\n```\r\n\r\n$ sudo puppet facts --terminus network_device --extra '\\{target => \"example-device\"}' --trace\r\nError: Could not call 'find' on 'facts': undefined method `inject' for \"\\{target => \\\"example-device\\\"}\":String\r\nDid you mean? inspect\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/request.rb:68:in `initialize'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:115:in `new'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:115:in `request'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:187:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/face.rb:46:in `call_indirection_method'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/face.rb:84:in `block (2 levels) in <class:Face>'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/interface/action.rb+eval[wrapper]:264:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/face_base.rb:247:in `main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:383:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:661:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:137:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:73:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\nError: Could not call 'find' on 'facts': undefined method `inject' for \"\\{target => \\\"example-device\\\"}\":String\r\nDid you mean? inspect\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/request.rb:68:in `initialize'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:115:in `new'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:115:in `request'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:187:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/face.rb:46:in `call_indirection_method'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/face.rb:84:in `block (2 levels) in <class:Face>'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/interface/action.rb+eval[wrapper]:264:in `find'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/face_base.rb:247:in `main'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:383:in `run_command'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `block in run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:661:in `exit_on_fail'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:137:in `run'\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:73:in `execute'\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\nError: Try 'puppet help facts find' for usage\r\n\r\n```","closed_at":"2021-07-13T03:32:02.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8700","labels":"commandline;doc-reviewed","state":"Closed","updated_at":"2021-07-13T03:32:02.000-0700","timestamp":1652286579.165331,"priority":"Minor","status_category":"Done","pull_request":8640},{"issue_id":"89342","title":"PMT won't install a module on windows if module_working_dir contains backslashes","url":"https://tickets.puppetlabs.com/browse/PUP-4884","created_at":"2015-07-15T11:18:28.000-0700","number":"PUP-4884","body":"If you override {{module_working_dir}} using a native windows path with backslashes, the PMT will fail to install the module, because it expects the path to contain forward slashes:\r\n\r\n{noformat}\r\nC:\\work\\puppet [stable +25 ~0 -0 !]> bundle exec puppet module install puppetlabs-stdlib --module_working_dir C:\\Windows\\Temp --debug\r\n...\r\nError: Could not install package\r\n  Package attempted to install file into\r\n  \"C:/Windows/Temp/cache/tmp-unpacker20150714-3276-hqzekd/puppetlabs-stdlib-4.6.0\" under \"C:\\\\Windows\\\\Temp/cache/tmp-unpacker20150714-3276-hqzekd\".\r\n{noformat}\r\n\r\nChanging that to forward slashes works, including if the case doesn't match:\r\n\r\n{noformat}\r\nC:\\work\\puppet [stable +25 ~0 -0 !]> bundle exec puppet module install puppetlab\r\ns-stdlib --module_working_dir C:/windows/temp --debug\r\n...\r\nDebug: Extracting: C:/windows/temp/cache/tmp-unpacker20150714-2640-1mynaxp/puppe\r\ntlabs-stdlib-4.6.0/lib/facter/util/puppet_settings.rb\r\nNotice: Installing -- do not interrupt ...\r\nC:/ProgramData/PuppetLabs/code/modules\r\n└── puppetlabs-stdlib (v4.6.0)\r\n{noformat}\r\n\r\nA simple fix would be to ensure we call File.expand_path on whatever value is specified, as that canonicalizes the path (from ruby's perspective):\r\n\r\n{noformat}\r\nC:\\work\\puppet [stable +25 ~0 -0 !]> irb\r\nirb(main):001:0> File.expand_path('C:\\Windows\\Temp')\r\n=> \"C:/Windows/Temp\"\r\n{noformat}\r\n\r\n","closed_at":"2021-07-13T03:34:38.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4884","labels":"doc-reviewed;windows","state":"Resolved","updated_at":"2021-07-13T03:34:38.000-0700","timestamp":1652286579.384029,"priority":"Normal","status_category":"Done","pull_request":8629},{"issue_id":"289473","title":"Parsedfile produces a undefined method each for nil:NilClass","url":"https://tickets.puppetlabs.com/browse/PUP-9369","created_at":"2018-12-19T13:24:12.000-0800","number":"PUP-9369","body":"The parsedfile provider will output a difficult to identify error message {{undefined method `each' for nil:NilClass}} when prefetching targets.\r\n\r\n{{target_records}} can be set to nil in [https://github.com/puppetlabs/puppet/blob/5.5.8/lib/puppet/provider/parsedfile.rb#L264-L276] when {{retrieve(targets)}} returns nil at [https://github.com/puppetlabs/puppet/blob/5.5.8/lib/puppet/provider/parsedfile.rb#L291-L293]. The {{nil}} {{target_records}} is not handled, so it throws the undefined method error nil does not have en each method.\r\n\r\nThis error was seen in the nagios_service resource, where there was a line containing only {{################################}} in the {{/etc/nagios/nagios_service.cfg}} file. It was difficult to identify what the cause of the issue was and where it could be coming from. Removing the file and regenerating it resolved the issue, but we would like to see more coherent error messages to reduce troubleshooting effort when there is an issue in the parsed file.","closed_at":"2021-07-13T03:35:28.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9369","labels":"cspapercuts;doc-reviewed","state":"Resolved","updated_at":"2021-07-13T03:35:28.000-0700","timestamp":1652286579.493966,"priority":"Normal","status_category":"Done","pull_request":8634},{"issue_id":"67460","title":"Prevent node resource names from overlapping with other resources","url":"https://tickets.puppetlabs.com/browse/PUP-3995","created_at":"2015-02-10T12:02:08.000-0800","number":"PUP-3995","body":"Before the pull request for PUP-3167 was submitted, if a node with a regex name matched the name of of another resource (like a class), then it was possible that the two would step on each other. This is pretty clearly illustrated by the example given in the original ticket:\r\n\r\n{noformat} class foo {\r\n  $bar = 'one'\r\n}\r\n \r\nnode /foo/ {\r\n  $bar = 'two'\r\n  include foo\r\n  notice(\"${::foo::bar}\")\r\n} {noformat}\r\n\r\nAlthough the issue was fixed for nodes specified with a regex, we were unable to fix the issue for all node names, since that fix would have been significantly more complicated than the one we implemented for regular expressions (see Henrik's comment on PUP-3167). As such, we need to find a way to prevent resource names for non-regex nodes and other resources from overlapping.\r\n","closed_at":"2021-07-13T03:37:23.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3995","labels":"doc-reviewed;help_wanted;needs_repro","state":"Resolved","updated_at":"2021-07-13T03:37:23.000-0700","timestamp":1652286579.605457,"priority":"Normal","status_category":"Done","pull_request":8627},{"issue_id":"316059","title":"Print meaningful error message if the user/group providers are not suitable when applying the settings catalog","url":"https://tickets.puppetlabs.com/browse/PUP-9825","created_at":"2019-07-11T05:38:56.000-0700","number":"PUP-9825","body":"Hi Folks\r\n\r\nWe have a problem when trying to run the Puppet Agent on a freshly reinstalled Mac. This issue is occurring on most versions on MacOS - Sierra, High Sierra, Mojave\r\n\r\nWhat is happening, is that after the first Puppet run, Puppet will fail to run again and throw the following error. If we delete the cache in /opt/puppetlabs/puppet/cache, we can re-run Puppet again, however the error will then re-occur on the next run, and the cache will need deleting again.\r\n\r\n{code}\r\nError: Could not create resources for managing Puppet's files and directories in sections [:main, :agent, :ssl]: undefined method `exists?' for nil:NilClass\r\nError: Could not prepare for execution: Could not create resources for managing Puppet's files and directories in sections [:main, :agent, :ssl]: undefined method `exists?' for nil:NilClass\r\nundefined method `exists?' for nil:NilClass\r\n{code}\r\n\r\nThis also happens in no-op mode, so I speculate it's something to do with merely downloading the cache files from the server.\r\n\r\nI'd like to stress that we're only seeing this on freshly reinstalled Macs (using Apple's internet recovery). Macs new from the shop are fine.\r\n\r\nThanks\r\n\r\nJT","closed_at":"2021-07-13T03:38:35.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9825","labels":"doc-reviewed","state":"Closed","updated_at":"2021-07-13T03:38:35.000-0700","timestamp":1652286579.720037,"priority":"Normal","status_category":"Done","pull_request":8635},{"issue_id":"200793","title":"Puppet may fail if setting values appear to be numerics","url":"https://tickets.puppetlabs.com/browse/PUP-7785","created_at":"2017-07-18T07:17:45.000-0700","number":"PUP-7785","body":"/etc/puppetlabs/puppet/puppet.conf\r\ncertname = 000000000180\r\n------------------------------------------------------------------------------------------------------\r\n Error: Could not parse /etc/puppetlabs/puppet/puppet.conf: invalid value for Integer(): \"000000000180\"                                                                             \r\nError: Could not request certificate: Failed to open TCP connection to puppet:8140 (getaddrinfo: Name\r\n or service not known)                                   \r\nExiting; failed to retrieve certificate and waitforcert is disabled\r\n------------------------------------------------------------------------------------------------------\r\ncertname in quotations makes puppet agent run but then an error on the server side is thrown:\r\nError: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: invalid value for Integer(): \"000000000180\"\r\n","closed_at":"2021-07-13T03:42:37.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7785","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-07-13T03:42:37.000-0700","timestamp":1652286579.934142,"priority":"Normal","status_category":"Done","pull_request":8653},{"issue_id":"201900","title":"Puppet::Resources.search fails if conditions provided","url":"https://tickets.puppetlabs.com/browse/PUP-7799","created_at":"2017-07-21T16:37:00.000-0700","number":"PUP-7799","body":"The [Puppet::Resource::Ral indirection|https://github.com/puppetlabs/puppet/blob/5.0.1/lib/puppet/indirector/resource/ral.rb#L24-L27] appears to attempt to convert ral to_resource() twice when you provide search criteria (shown here with package).  I'm guessing the specs are mocked such as to be validating the broken behavior.\r\n\r\n{code}\r\nrequire 'puppet'\r\nrequire 'pp'\r\n\r\npackages = Puppet::Resource.indirection.search(\"package\")\r\npp packages.find { |r| r.name == 'Package/bash' }\r\n\r\nbegin\r\n  Puppet::Resource.indirection.search(\"package/bash\")\r\nrescue Exception => e\r\n  pp e.backtrace\r\n  puts e\r\nend\r\n\r\nbegin\r\n  Puppet::Resource.indirection.search(\"package\", {:ensure => \"installed\"})\r\nrescue Exception => e\r\n  pp e.backtrace\r\n  puts e\r\nend\r\n{code}\r\n\r\n{code}\r\njpartlow@percival:~/work/src/pl/puppet$ be ruby test.rb \r\nPackage[bash]{:name=>\"bash\", :ensure=>\"4.3-7ubuntu1.7\", :provider=>:apt, :configfiles=>:keep, :reinstall_on_refresh=>:false, :loglevel=>:notice}\r\n[\"/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `block (2 levels) in search'\",\r\n \"/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `each'\",\r\n \"/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `all?'\",\r\n \"/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `block in search'\",\r\n \"/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:26:in `each'\",\r\n \"/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:26:in `find_all'\",\r\n \"/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:26:in `search'\",\r\n \"/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/indirection.rb:270:in `search'\",\r\n \"test.rb:8:in `<main>'\"]\r\nundefined method `to_resource' for #<Puppet::Resource:0x007f1c8e0d57f8>\r\n[\"/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `block (2 levels) in search'\",\r\n \"/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `each'\",\r\n \"/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `all?'\",\r\n \"/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `block in search'\",\r\n \"/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:26:in `each'\",\r\n \"/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:26:in `find_all'\",\r\n \"/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:26:in `search'\",\r\n \"/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/indirection.rb:270:in `search'\",\r\n \"test.rb:15:in `<main>'\"]\r\nundefined method `to_resource' for #<Puppet::Resource:0x007f1c8dacac00>\r\n{code}","closed_at":"2021-07-13T03:43:32.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7799","labels":"doc-reviewed","state":"Closed","updated_at":"2021-07-13T03:43:32.000-0700","timestamp":1652286580.039457,"priority":"Normal","status_category":"Done","pull_request":8631},{"issue_id":"244849","title":"Repository error message uri is missing part of the path","url":"https://tickets.puppetlabs.com/browse/PUP-8650","created_at":"2018-04-09T14:43:23.000-0700","number":"PUP-8650","body":"We had a problem with our artifactory server, where it would return a 404 for the Puppet repository it was providing. This caused an error message to appear, about 404 errors. I tried to install the module manually (or search for it) and also got a 404 error:\r\n{code:java}\r\n[root@puppetmaster ~]# puppet module --debug search saz-sudo\r\nDebug: Runtime environment: puppet_version=5.3.5, ruby_version=2.4.3, run_mode=user, default_encoding=UTF-8\r\nNotice: Searching https://artifactory.domain.com/artifactory/api/puppet/puppet ...\r\nDebug: HTTP GET https://artifactory.domain.com/artifactory/api/puppet/puppet/artifactory/api/puppet/puppet/v3/modules?query=saz-sudo&module_groups=base%20pe_only\r\nError: Request to Puppet Forge failed.\r\n  The server being queried was https://artifactory.domain.com/v3/modules?query=saz-sudo&module_groups=base%20pe_only\r\n  The HTTP response we received was '404 '\r\nError: Try 'puppet help module search' for usage {code}\r\n \r\n\r\nBefore adding the debug flag, I thought that the puppet module tool was loosing the \"path\" part of the \"module_repository\" configuration when it read it from the puppet.conf, vs when it was specified on the command line. This was not the case, but it led to a lot of pointless troubleshooting. The error message should have the correct URL that failed.\r\n\r\n \r\n\r\nNOTICE the difference between:\r\n{code:java}\r\nDebug: HTTP GET https://artifactory.domain.com/artifactory/api/puppet/puppet/artifactory/api/puppet/puppet/v3/modules?query=saz-sudo&module_groups=base%20pe_only {code}\r\n... and:\r\n{code:java}\r\nThe server being queried was https://artifactory.domain.com/v3/modules?query=saz-sudo&module_groups=base%20pe_only {code}\r\n ","closed_at":"2021-07-13T04:00:18.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8650","labels":"beginner;doc-reviewed;help_wanted","state":"Closed","updated_at":"2021-07-13T04:00:18.000-0700","timestamp":1652286580.253573,"priority":"Normal","status_category":"Done","pull_request":8632},{"issue_id":"379509","title":"puppet filebucket fails when using non-default environment from master","url":"https://tickets.puppetlabs.com/browse/PUP-10796","created_at":"2020-12-01T12:28:20.000-0800","number":"PUP-10796","body":"*Puppet Version:* 5.5.21\r\n *Puppet Server Version:* 5.3.8\r\n *OS Name/Version:* RHEL 7\r\n\r\nWhen using a non default environment (something other than {{production}}) on a puppet agent from the puppet master, for example {{testenv}}, running {{puppet filebucket -l list --bucket /opt/puppetlabs/puppet/cache/clientbucket/ fails with Puppet::Environments::EnvironmentNotFound}}\r\n\r\n*Desired Behavior:* {{puppet filebucket}} uses Puppet environment from {{/etc/puppetlabs/puppet/puppet.conf and runs successfully.}}\r\n\r\n*Actual Behavior:*\r\n\r\n \r\n{noformat}\r\n $ sudo puppet filebucket -l list --bucket /opt/puppetlabs/puppet/cache/clientbucket/ \r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:38:in `get!': Could not find a directory environment named 'testenv' anywhere in the path: /etc/puppetlabs/code/environments. Does the directory exist? (Puppet::Environments::EnvironmentNotFound)\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application_support.rb:34:in `push_application_context'\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:363:in `run'\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:139:in `run'\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:77:in `execute'\r\n        from /opt/puppetlabs/puppet/bin/puppet:5:in `<main>'\r\n$ puppet --version\r\n5.5.21\r\n$ ls -lhatr /etc/puppetlabs/code/environments/ total 0 drwxr-xr-x. 4 root root 41 Jul 3 07:34 .. drwxr-xr-x. 3 root root 24 Jul 3 07:34 . drwxr-xr-x. 5 root root 92 Aug 21 01:30 production\r\n$ cat /etc/puppetlabs/puppet/puppet.conf\r\n[main]\r\nenvironment = testenv\r\nserver = puppetmaster.example.com\r\nruntimeout = 1h\r\nsplay = true\r\nsplaylimit = 3m\r\nstrict_variables = true\r\ngraph = true\r\n{noformat}","closed_at":"2021-07-13T04:47:18.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10796","labels":"beginner;doc-reviewed;help_wanted","state":"Closed","updated_at":"2021-07-13T04:47:18.000-0700","timestamp":1652286580.466918,"priority":"Normal","status_category":"Done","pull_request":8637},{"issue_id":"405015","title":"Cached environment may not be deleted if the directory is removed","url":"https://tickets.puppetlabs.com/browse/PUP-11129","created_at":"2021-06-28T17:24:00.000-0700","number":"PUP-11129","body":"Puppet::Environments::Cached#list returns environments that exist on disk and either caches the entry or updates its ttl. However, if an environment is in the cache, but is no longer on disk, then it is not removed from the cache. This shouldn't be an issue with r10k/code manager, because they explicitly delete the environment or all environments after purging the directory. But it could lead to consistency problems if the REST request never occurs or fails. The following shows how after the environment is deleted, it is not returned from the {{list}} method, yet it is still cached:\r\n{code:ruby}require 'puppet'\r\nPuppet.initialize_settings(['--environment_timeout', 'unlimited'])\r\nPuppet::Util::Log.newdestination(:console)\r\n\r\nname = \"test#{Process.pid}\"\r\ntestdir = File.join(Puppet[:environmentpath], name)\r\nFileUtils.mkdir_p(testdir)\r\n\r\nPuppet::ApplicationSupport.push_application_context(Puppet::Util::RunMode[:user])\r\n\r\nenvs = Puppet.lookup(:environments)\r\nenvs.get!(:production)\r\nenvs.get!(name)\r\n\r\nputs \"Listed #{envs.list.map(&:name).join(', ')} environments\"\r\n\r\nFileUtils.rm_rf(testdir)\r\nputs \"Deleted #{name} environment\"\r\n\r\nputs \"Listed #{envs.list.map(&:name).join(', ')} environments\"\r\nputs \"Cached #{envs.instance_variable_get(:@cache).keys.join(', ')} environments\"\r\n{code}\r\n{noformat}❯ ls  ~/.puppetlabs/etc/code/environments/\r\nproduction/\r\n\r\n❯ bx ruby envs.rb                         \r\nListed test2597598, production environments\r\nDeleted test2597598 environment\r\nListed production environments\r\nCached production, test2597598 environments\r\n{noformat}","closed_at":"2021-07-13T04:49:57.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11129","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-07-13T04:49:57.000-0700","timestamp":1652286580.680343,"priority":"Normal","status_category":"Done","pull_request":8663},{"issue_id":"143699","title":"Can't run puppet resource on agent with environment specified in main section","url":"https://tickets.puppetlabs.com/browse/PUP-6554","created_at":"2016-07-27T06:32:48.000-0700","number":"PUP-6554","body":"See also https://tickets.puppetlabs.com/browse/PUP-6048\r\n\r\nGiven a traditional Prod, Dev, Test scenario, and a desire to use MCollective\r\nGiven the desire to configure an environment in the agent's puppet.conf to cut down on log messages\r\nGiven the need to put the environment setting in [main] and not [agent] so that MCollective also knows the environment\r\n\r\nIf one manually runs puppet commands on a non-production node, such as puppet resource, one gets an error:\r\n\r\n[root@dev-node ~]# puppet resource service puppet ensure=running enable=true\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:38:in `get!': Could not find a directory environment named 'development' anywhere in the path: /etc/puppetlabs/code/environments. Does the directory exist? (Puppet::Environments::EnvironmentNotFound)\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application_support.rb:29:in `push_application_context'\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:337:in `run'\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:128:in `run'\r\n\tfrom /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute'\r\n\tfrom /usr/local/bin/puppet:5:in `<main>'\r\n\r\nHowever, if one impersonates the production environment, it works as expected:\r\n\r\n[root@dev-node ~]# puppet resource service puppet ensure=running enable=true --environment production\r\nNotice: /Service[puppet]/ensure: ensure changed 'stopped' to 'running'\r\nservice { 'puppet':\r\n  ensure => 'running',\r\n  enable => 'true',\r\n}\r\n\r\nThis inconsistency is frustrating to customers, regardless of the reasoning behind it. It requires retraining of their staff doing manual operations and lots of comments in their cron jobs, etc. ","closed_at":"2021-07-13T04:50:52.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6554","labels":"customer;doc-reviewed","state":"Resolved","updated_at":"2021-07-13T04:50:52.000-0700","timestamp":1652286580.787108,"priority":"Normal","status_category":"Done","pull_request":8647},{"issue_id":"391432","title":"Puppet always prints errors in debug when trying to resolve account to SID","url":"https://tickets.puppetlabs.com/browse/PUP-10967","created_at":"2021-03-16T18:16:23.000-0700","number":"PUP-10967","body":"Puppet on Windows shows the following errors when running with debugging:\r\n\r\n{noformat}\r\nC:\\> puppet agent -t --debug\r\n...\r\nDebug: Processing report from xxx with processor Puppet::Reports::Store\r\nDebug: Could not retrieve raw SID bytes from 'Administrator': Failed to convert string SID: Administrator:  The security ID structure is invalid.\r\nDebug: Could not retrieve raw SID bytes from 'Administrator': Failed to convert string SID: Administrator:  The security ID structure is invalid.\r\n{noformat}\r\n\r\nThis debugging was added in https://github.com/puppetlabs/puppet/commit/bea9ff75d5946dbb92c90ef068cf6c2d4cb0db85. However, the {{name_to_principal}} method is sometimes called with valid account names like {{Administrator}}, so the call to {{string_to_sid_ptr}} fails with ({{ERROR_INVALID_SID}} 0x539 and the debug message is printed.\r\n\r\nI think it'd be better to check if {{name}} starts with something like {{S-\\d+-\\d+}} or only log the error if {{e.code != 0x539}}. For example, if the SID string refers to an account that doesn't exist, you'll get 0x534 {{ERROR_NONE_MAPPED}}.","closed_at":"2021-07-13T05:04:40.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10967","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-07-13T05:04:40.000-0700","timestamp":1652286581.002926,"priority":"Minor","status_category":"Done","pull_request":8652},{"issue_id":"401529","title":"Setting age=0 on a tidy resource does not remove all files","url":"https://tickets.puppetlabs.com/browse/PUP-11079","created_at":"2021-06-03T06:21:34.000-0700","number":"PUP-11079","body":"*Puppet Version:* any\r\n *Puppet Server Version:* n/a\r\n *OS Name/Version:* n/a\r\n\r\nThe documentation for the {{age}} parameter for the {{tidy}} type states:\r\n{quote}Tidy files whose age is *equal to or greater* than the specified time. You can choose seconds, minutes, hours, days, or weeks by specifying the first letter of any of those words (for example, ‘1w’ represents one week).\r\n\r\nDocs: [https://puppet.com/docs/puppet/7.7/types/tidy.html#tidy-attribute-age]\r\n\r\n*Specifying 0 will remove all files*.\r\n{quote}\r\n*Desired Behavior:*\r\n\r\nSetting {{age=0}} removes all files\r\n\r\n*Actual Behavior:*\r\n\r\nSetting {{age=0}} requires the target file to be at least 1 second old.\r\n\r\nThis was discovered when writing integration tests for the {{puppet resource}} subcommand (PUP-11074).\r\n\r\nRelevant code: [https://github.com/puppetlabs/puppet/blob/b91e53a38cb4671d4de9078837c05931c69121f9/lib/puppet/type/tidy.rb#L147]\r\n{code}    def tidy?(path, stat)\r\n      # If the file's older than we allow, we should get rid of it.\r\n      (Time.now.to_i - stat.send(resource[:type]).to_i) > value\r\n    end\r\n{code}\r\nNote that the greater than or equal comparison is respected for the {{size}} parameter:\r\n{code}    def tidy?(path, stat)\r\n      stat.size >= value\r\n    end\r\n{code}","closed_at":"2021-07-13T05:06:50.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11079","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-07-13T05:06:50.000-0700","timestamp":1652286581.107766,"priority":"Normal","status_category":"Done","pull_request":8644},{"issue_id":"155635","title":"agent_specified_environment fact doesn't populate with the environment setting in the [agent] section","url":"https://tickets.puppetlabs.com/browse/PUP-6801","created_at":"2016-10-06T16:33:51.000-0700","number":"PUP-6801","body":"Currently, if I want to use the agent_specified_environment fact, I need to set the environment setting in puppet.conf in the [main] section.\r\n\r\nIf I happen to be hitting this bug: PUP-6048, this isn't possible.  \r\n\r\nPutting the environment setting in the [agent] section works around PUP-6048, but doesn't allow me to use agent_specified_environment, the fact ends up empty.","closed_at":"2021-07-13T05:12:16.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6801","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-07-13T05:12:16.000-0700","timestamp":1652286581.21279,"priority":"Normal","status_category":"Done","pull_request":8645},{"issue_id":"395833","title":"pip ensure=>latest fails with pip>=20.3.0","url":"https://tickets.puppetlabs.com/browse/PUP-11029","created_at":"2021-04-16T10:08:53.000-0700","number":"PUP-11029","body":"*Puppet Version: 6.21.1*\r\n *Puppet Server Version: 6.15.1*\r\n *OS Name/Version: Ubuntu 18.04 and MacOS 10.15*\r\n\r\n*Desired Behavior:*\r\n\r\nA package is installed:\r\n\r\n{code:puppet}\r\npackage { 'my_package':\r\n  ensure => latest,\r\n  provider => 'pip3',\r\n  install_options => [ '--extra-index-url', 'http://artifactory.mydomain.com:8081/artifactory/api/pypi/pypi-virtual/simple',\r\n'--trusted-host', 'artifactory.mydomain.com' ],\r\n}\r\n{code}\r\n\r\nNormal behavior is that puppet keeps this package updated to latest.\r\n\r\n*Actual Behavior:*\r\n\r\n\r\nThis fails. I believe the failure is due to a change in the output of pip when ==versionplease is used:\r\n\r\nlooks like a change in behavior after pip20.2.4 (so 20.3 and 21). Previously if you sent a weird version (like my_package==versionplease) you would get a result like this:\r\n\r\n{code}\r\nLooking in indexes: [https://pypi.org/simple], [http://artifactory.mydomain.com:8081/artifactory/api/pypi/pypi-virtual/simple|http://artifactory.arxan.com:8081/artifactory/api/pypi/pypi-virtual/simple]\r\nERROR: Could not find a version that satisfies the requirement my_package==versionplease (from versions: 2.33.6, 2.33.8, 2.33.9, 2.33.112, 2.34.7, 2.34.113, 2.34.114, 2.34.115, 2.35.116, 2.35.117, 2.35.118, 2.35.119, 2.35.120, 2.35.121, 2.35.122, 2.35.123, 2.35.124, 3.0.1, 3.0.2, 3.0.3, 3.0.4, 3.0.5, 3.0.6, 3.0.7, 3.0.8, 3.0.9, 3.0.125, 3.0.126, 3.0.127, 3.0.128, 3.0.129, 3.0.130, 3.0.131, 3.0.132, 3.0.138, 3.0.139, 3.0.143, 3.0.146, 3.0.147, 3.0.148, 3.0.149, 3.0.153, 3.0.154, 3.0.156, 3.0.157, 3.0.159, 3.0.160, 3.0.161, 3.0.162, 3.0.163, 3.0.164, 3.0.165, 3.0.166, 3.0.167, 3.0.168, 3.0.169, 3.0.170, 3.0.171, 3.0.172, 3.1.10, 3.1.11, 3.1.12, 3.1.13, 3.1.17, 3.1.20, 3.1.21, 3.1.22, 3.1.23, 3.1.24, 3.2.25, 3.2.26, 3.2.27, 3.2.28, 3.2.35, 3.2.36, 3.2.37, 3.2.38, 3.2.39, 3.2.40, 3.2.41, 3.2.42, 3.2.43, 3.2.44, 3.2.45, 3.2.46, 3.2.47, 3.2.48, 3.2.49, 3.2.50, 3.2.51, 3.2.52, 3.2.53, 3.2.56, 3.2.59, 3.2.64, 3.2.65, 3.2.66, 3.2.74, 3.2.75, 3.2.83, 3.2.87, 3.2.88, 3.2.89, 3.2.90, 3.2.92, 3.2.94, 3.2.97, 3.2.99, 3.2.102, 3.2.104, 3.2.116, 3.2.118, 3.2.119, 3.2.121, 3.2.123, 3.2.125, 3.2.127, 3.2.131, 3.2.136, 3.2.138, 3.2.159, 3.2.163, 4.0.168, 4.0.170, 4.0.171, 4.0.173, 4.0.175, 4.0.176, 4.0.177, 4.0.178, 4.0.179, 4.0.182, 4.0.183, 4.0.187, 4.0.189, 4.0.190, 4.0.191, 4.0.192, 4.0.193, 4.0.196, 4.0.197, 4.0.198, 4.0.199, 4.0.203, 4.0.226, 4.0.228, 4.0.230, 4.0.234, 4.0.235, 4.0.236, 4.0.237, 4.0.239, 4.0.240, 4.0.242, 4.0.243, 4.0.244, 4.0.245, 4.0.246, 4.0.248, 4.0.276, 4.0.277, 4.0.278, 4.0.279, 4.0.280, 4.0.281, 4.0.282, 4.0.299, 4.0.300, 4.0.309, 4.0.315, 4.0.316, 4.0.319, 4.0.328, 4.0.329, 4.0.333, 4.0.334, 5.335, 6.0.13, 6.0.14, 6.0.15, 6.0.16, 6.0.19, 6.0.20, 6.0.22, 6.0.336, 6.0.337, 6.0.338, 6.0.340, 6.0.351, 6.0.352, 6.0.353, 6.0.355, 6.0.357, 6.0.362, 6.0.363, 6.0.366, 6.0.368, 6.0.369, 6.0.370, 6.0.374, 6.1.27, 6.1.28, 6.1.29, 6.1.30, 6.1.31, 6.1.33, 6.1.34, 6.1.35, 6.1.37, 7.0.48, 7.0.49, 7.0.50, 7.0.51, 7.0.54, 7.0.55, 7.0.56, 7.0.58, 7.0.59, 7.0.62, 7.0.64, 7.0.65, 7.0.66, 7.0.67, 7.0.68, 7.0.70, 7.0.73, 7.0.74, 7.0.76, 7.0.78, 7.0.81, 7.0.82, 7.0.84, 7.0.85, 7.0.86, 7.0.88, 7.0.89, 7.0.91, 7.0.93, 7.0.96, 7.0.97, 7.0.98, 7.0.99, 7.0.105, 7.0.106)\r\nERROR: No matching distribution found for my_package==versionplease\r\n{code}\r\n\r\nAfter 20.3 you get this:\r\n{code}\r\nLooking in indexes: [https://pypi.org/simple], [http://artifactory.my_domain.com:8081/artifactory/api/pypi/pypi-virtual/simple|http://artifactory.arxan.com:8081/artifactory/api/pypi/pypi-virtual/simple]\r\nERROR: Could not find a version that satisfies the requirement my_package==versionplease\r\nERROR: No matching distribution found for my_package==versionplease\r\n{code}\r\n\r\nSo puppet's parsing to figure out if it needs to install a new version to satisfy 'ensure => latest' doesn't work. This is using puppet 6.21.1. Backing down to pip==20.2.4 gets everything working again.","closed_at":"2021-07-13T05:13:04.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11029","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-07-13T05:13:04.000-0700","timestamp":1652286581.319262,"priority":"Normal","status_category":"Done","pull_request":8675},{"issue_id":"306584","title":"User resource sets password on every puppet agent run (Windows)","url":"https://tickets.puppetlabs.com/browse/PUP-9688","created_at":"2019-04-29T03:25:21.000-0700","number":"PUP-9688","body":"*Puppet Version: 5.5.10\r\n*Puppet Server Version: \t5.3.7\r\n*OS Name/Version:* WIndows Server 2016\r\n\r\nWhen using the following simple code to set the Administrator password on Windows:\r\n\r\n{code:java}\r\n$adminpassword = 'slkdhfl@#$slkW223' \r\n\r\nif $adminpassword { \r\n    user { 'Administrator': \r\n    ensure => present, \r\n    password => $adminpassword, \r\n    } \r\n} \r\n{code}\r\n\r\nThe above sets the password correctly but if \r\n{code:java}\r\nDeny access to this computer from the network\r\n{code}\r\n local group policy has been configured for members of the Administrator group, the password will get applied on every puppet agent run.\r\n\r\nThis has been reproduced locally on my Windows 2016 box where Deny access to this computer from the network has been set for the admin group, using the above code and puppet apply.\r\n\r\n*Desired Behavior:* Corrective change for the password happens on the first puppet only.\r\n\r\n\r\n*Actual Behavior:* Corrective change for the password gets made on every puppet run.\r\n\r\n\r\n","closed_at":"2021-07-20T08:29:04.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9688","labels":"resolved-issue-added","state":"Resolved","updated_at":"2021-07-20T08:29:04.000-0700","timestamp":1652286582.593425,"priority":"Normal","status_category":"Done","pull_request":7528},{"issue_id":"143764","title":"Dir.glob in Ruby 2.3 has changed behavior on Windows, can break code loading","url":"https://tickets.puppetlabs.com/browse/PUP-6557","created_at":"2016-07-27T10:48:47.000-0700","number":"PUP-6557","body":"Ruby 2.3 addressed a bug in {{Dir.glob}} on Windows - https://bugs.ruby-lang.org/issues/10819 with commit https://github.com/ruby/ruby/commit/45df1c24d269f93a2bc1e7a6fe0ffcecc1193051\r\n\r\nUnfortunately this has changed the behavior in such a way that prevents file paths from being compared as they were previously.  Previously an 8.3 style file path was passed to {{Dir.glob}} and it returned {{8.3}} style paths in Ruby 2.1.  Due to bug fix 10819, the paths are now expanded from {{8.3}} paths.\r\n\r\nThis should also involve adding a new test, so that AppVeyor catches the problem (which it currently does *not*)\r\n\r\n\r\nAnalysis of the various call sites led to this gist - showing any time an Environment / Environment / Module was created - https://gist.github.com/Iristyle/9389f62d60a402f861df8a98012535c9","closed_at":"2021-07-22T17:15:10.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6557","labels":"windows","state":"Closed","updated_at":"2021-07-22T17:15:10.000-0700","timestamp":1652286584.167716,"priority":"Normal","status_category":"Done","pull_request":5150},{"issue_id":"283012","title":"`puppet facts upload` always uses environment \"production\" ignoring setting from puppet.conf","url":"https://tickets.puppetlabs.com/browse/PUP-9290","created_at":"2018-10-30T05:37:50.000-0700","number":"PUP-9290","body":"We have nodes with environment different than default \"production\", in here it's \"qa\":\r\n{code}\r\n[root@app03.XXX:~]# cat /etc/puppet/puppet.conf\r\n(...)\r\n[agent]\r\nreport      = true\r\nruninterval = 1800\r\nenvironment = qa\r\nsplay = true\r\n{code}\r\n\r\nBut if we upload facts using `puppet facts upload` always environment \"production\" is being used:\r\n{code}\r\n[root@app03.XXX:~]# /opt/puppetlabs/puppet/bin/puppet facts upload --debug\r\nDebug: Runtime environment: puppet_version=5.5.2, ruby_version=2.4.4, run_mode=user, default_encoding=UTF-8\r\nDebug: Evicting cache entry for environment 'production'\r\n(...)\r\n{code}\r\n\r\nIn puppetdb facts from such nodes have \"facts_environment\" set to \"production\", while \"report_environment\" and \"catalog_environment\" are set correctly to \"qa\".\r\n\r\nIf you simply run \"puppet agent -t\" facts with correct environment, \"qa\", are being uploaded. \r\n\r\n","closed_at":"2021-08-03T15:13:02.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9290","labels":"","state":"Closed","updated_at":"2021-08-03T15:13:02.000-0700","timestamp":1652286585.653573,"priority":"Major","status_category":"Done","pull_request":7609},{"issue_id":"405825","title":"An environment may be reloaded during a single compilation","url":"https://tickets.puppetlabs.com/browse/PUP-11158","created_at":"2021-07-02T16:43:10.000-0700","number":"PUP-11158","body":"The environment cache's keys may be strings or symbols, so you can end up with same environment cached under two different names (see PUP-10955). We tried fixing the issue, but it turns out we're currently relying on the symbol/string confusion to prevent an environment from being reloaded during a compilation.\r\n\r\nFor example, given this script:\r\n\r\n{code:ruby}\r\nrequire 'puppet'\r\nLocale.current = 'ja_JP'\r\nPuppet.initialize_settings\r\nPuppet::GettextConfig.setup_locale\r\nPuppet::Resource::Catalog.indirection.terminus_class = :compiler\r\nPuppet[:log_level] = 'debug'\r\nPuppet::Util::Log.newdestination(:console)\r\n\r\nPuppet::ApplicationSupport.push_application_context(Puppet::Util::RunMode[:server])\r\ncatalog = Puppet::Resource::Catalog.indirection.find(Puppet[:certname], environment: :production)\r\nputs catalog.resource(:notify, 'happy')[:message]\r\n{code}\r\n\r\nResults in the following:\r\n{code}\r\n$ bundle exec puppet module install eputnam-i18ndemo\r\n$ bundle exec ruby envs.rb\r\n...\r\nDebug: Loaded translations for puppetlabs-stdlib.\r\nDebug: Loaded translations for eputnam-i18ndemo.\r\nDebug: Evicting cache entry for environment 'production'\r\nDebug: Deleted current text domain :production: true\r\nDebug: Path to /home/josh/.puppetlabs/etc/code/environments/production does not exist, using default environment.conf\r\n...`\r\nNotice: Compiled catalog for localhost in environment production in 0.02 seconds\r\n--*IT'S HAPPY FUN TIME*--\r\nyppah\r\n--*IT'S HAPPY FUN TIME*--\r\n{code}\r\n\r\nNote the translations are loaded, but the environment is cleared and the text domain is deleted prior to compilation, so we end up with the non-localized message {{IT'S HAPPY FUN TIME}}.\r\n\r\nChanging the {{environment}} parameter to a string, prevents the environment from being cleared:\r\n\r\n{code:ruby}\r\ncatalog = Puppet::Resource::Catalog.indirection.find(Puppet[:certname], environment: 'production')\r\n{code}\r\n\r\nAnd we get the localized message:\r\n{code}\r\n--*eputnam-i18ndemo function: それは楽しい時間です*--\r\nyppah\r\n--*eputnam-i18ndemo function: それは楽しい時間です*--\r\n{code}\r\n\r\nWe should be explicit about not reloading an environment during a single compilation. If environment_timeout=0, then the environment should be reloaded during the next compilation (or any indirected request).\r\n\r\nAlso [~maggie] says it's important for versioned code deploys to keep the same environment object throughout a compile.","closed_at":"2021-08-11T05:59:47.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11158","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-08-11T05:59:47.000-0700","timestamp":1652286586.609781,"priority":"Normal","status_category":"Done","pull_request":8716},{"issue_id":"300842","title":"Catalog failure on first run due to pluginsync and environment switch","url":"https://tickets.puppetlabs.com/browse/PUP-9570","created_at":"2019-03-19T11:55:16.000-0700","number":"PUP-9570","body":"On the first run, the Puppet agent can fail to run due to a catalog failure, if its environment assignment in the classifier is based on facts.\r\n\r\nWhat will happen is:\r\n\r\n# The new agent queries node terminus to determine environment to pluginsync against\r\n# Master queries classifier with no facts to determine environment\r\n# The classifier returns some default environment value, because the fact that matches the node to the correct environment node group has not been uploaded and saved to PuppetDB yet\r\n# The agent pluginsync's against this default environment\r\n# The agent uploads its facts and requests a catalog\r\n# The master queries the classifier _with_ the facts\r\n# The classifier returns the _correct_ environment\r\n# The master starts compiling a catalog using the correct environment\r\n# The correct environment's Puppet code expects one or more facts to be available, but they are not. The absence of these facts causes the catalog compilation to fail.\r\n# The agent aborts the run due to the catalog compilation failure.\r\n\r\nFor example:\r\n\r\nSet up an environment called \"default\" with no modules. Assign this environment as the default.\r\n\r\nSet up an environment called \"production\". Install the puppetlabs-stdlib module, and give it a site.pp that looks like:\r\n\r\n{code}\r\nif ($facts['puppet_server'] == undef) {\r\n  fail('No value provided for facts.puppet_server!')\r\n}\r\n{code}\r\n\r\nSet up the classifier so that nodes are assigned the \"Production environment\" env node group if they have {{puppet_environment = production}} as a fact.\r\n\r\n !Screenshot 2019-03-19 11.52.33.png|width=500! \r\n\r\nThen run Puppet *for the first time* on a new agent. It will get something like this:\r\n\r\n{code}\r\npuppet agent [root@pe-xl-core-2 ~]# puppet agent -t\r\nNotice: Local environment: 'production' doesn't match server specified node environment 'default', switching agent to 'default'.\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nNotice: /File[/opt/puppetlabs/puppet/cache/lib/facter]/ensure: created\r\nNotice: /File[/opt/puppetlabs/puppet/cache/lib/facter/aio_agent_build.rb]/ensure: defined content as '{md5}cdcc1ff07bc245c66cc1d46be56b3af5'\r\nNotice: /File[/opt/puppetlabs/puppet/cache/lib/facter/aio_agent_version.rb]/ensure: defined content as '{md5}d05c8cbf788f47d33efd46a935dda61e'\r\n[...]\r\nNotice: /File[/opt/puppetlabs/puppet/cache/lib/shared/pe_build.rb]/ensure: defined content as '{md5}4f4652af20c4f0391b9ca2976940a710'\r\nNotice: /File[/opt/puppetlabs/puppet/cache/lib/shared/pe_server_version.rb]/ensure: defined content as '{md5}f3d3fc8776512ae73d3293c97b8f3dfe'\r\nInfo: Retrieving locales\r\nInfo: Loading facts\r\nError: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Function Call, No value provided for facts.puppet_server! (file: /et\r\nc/puppetlabs/code/environments/production/manifests/site.pp, line: 4, column: 3) on node pe-xl-core-2.dev33.puppet.vm\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\n[root@pe-xl-core-2 ~]#\r\n{code}\r\n\r\n*What would be better*:\r\n\r\nRather than trying to compile a catalog if the agent pluginsync'd the wrong environment, fail fast. Don't compile a catalog the agent is going to throw away anyway. Tell the agent to try again. The agent already has logic to retry, and wouldn't use a catalog with the \"wrong\" environment anyway.","closed_at":"2021-08-11T06:00:43.000-0700","comments":17,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9570","labels":"001G000001p3dQmIAI;doc-reviewed;jira_escalated","state":"Resolved","updated_at":"2021-08-11T06:00:43.000-0700","timestamp":1652286586.719203,"priority":"Normal","status_category":"Done","pull_request":8672},{"issue_id":"390307","title":"Environment caches string and symbol environment names differently","url":"https://tickets.puppetlabs.com/browse/PUP-10955","created_at":"2021-03-08T12:41:19.000-0800","number":"PUP-10955","body":"The {{Puppet::Environments::Cached#get}} method says it accepts Strings or Symbols, but it  doesn't normalize the name when getting/setting the environment in the cache. So you can end up caching environments for {{\"production\"}} and {{:production}}. \r\n\r\nAgent side we lookup the environment based on the {{Puppet[:environment]}} setting. Server side we lookup the [{{environment}} from a query parameter|https://github.com/puppetlabs/puppet/blob/12401c3af42cfbae41b48621f5b42336db1ace1d/lib/puppet/network/http/api/indirected_routes.rb#L95]. But there are other entry points like Bolt and non-indirected REST APIs, so it would be good to fix this.\r\n\r\n{code:ruby}\r\nrequire 'puppet'\r\nPuppet.initialize_settings\r\nPuppet::Util::Log.newdestination(:console)\r\nPuppet::ApplicationSupport.push_application_context(Puppet::Util::RunMode[:user])\r\nenvs = Puppet.lookup(:environments)\r\nenvs.get!('production')\r\nenvs.get!(:production)\r\npp envs.instance_variable_get(:@cache).keys\r\n{code}\r\n\r\n{noformat}\r\n$ bx ruby cache.rb\r\n[\"production\", :production]\r\n{noformat}","closed_at":"2021-08-11T06:10:22.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10955","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-08-11T06:10:22.000-0700","timestamp":1652286586.934176,"priority":"Normal","status_category":"Done","pull_request":8717},{"issue_id":"347236","title":"Puppet.lookup(:current_environment) is wrong if environment changes during convergence","url":"https://tickets.puppetlabs.com/browse/PUP-10308","created_at":"2020-02-21T10:11:11.000-0800","number":"PUP-10308","body":"At the start of the configurer run, puppet pushes its configured environment (from Puppet[:environment]) or the server-specified environment (from the ENC) onto the context in https://github.com/puppetlabs/puppet/blob/6.13.0/lib/puppet/configurer.rb#L319-L331\r\n\r\nHowever, if pluginsync causes environment to change, then the agent switches to the new environment, but {{Puppet.lookup(:current_environment)}} still returns old value, while {{Puppet::Resource::Catalog#environment}} returns the new value:\r\n\r\n{noformat}\r\n$ bx puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nNotice: Local environment: 'production' doesn't match server specified environment 'dev', restarting agent run with environment 'dev'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Caching catalog for XXX\r\nInfo: Applying configuration version '1582308523'\r\n\r\n[261, 270] in /Users/josh/work/puppet/lib/puppet/type/file/source.rb\r\n   261:       end\r\n   262:     end\r\n   263:\r\n   264:     def each_chunk_from\r\n   265:       require 'byebug'; byebug\r\n=> 266:       if Puppet[:default_file_terminus] == :file_server && scheme == 'puppet' && (uri.host.nil? || uri.host.empty?)\r\n   267:         chunk_file_from_disk(metadata.path) { |chunk| yield chunk }\r\n   268:       elsif local?\r\n   269:         chunk_file_from_disk(full_path) { |chunk| yield chunk }\r\n   270:       else\r\n(byebug) Puppet.lookup(:current_environment)\r\n<Puppet::Node::Environment::Remote:70205531253460 @name=\"production\" @manifest=\"no_manifest\" @modulepath=\"\" >\r\n(byebug) resource.catalog.environment\r\n\"dev\"\r\n{noformat}\r\n\r\nPuppet relies on the catalog's environment being correct when retrieving file metadata & content, such as https://github.com/puppetlabs/puppet/blob/6.13.0/lib/puppet/type/file/source.rb#L194","closed_at":"2021-08-11T06:12:56.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10308","labels":"001G000001p3dQmIAI;doc-reviewed","state":"Resolved","updated_at":"2021-08-11T06:12:56.000-0700","timestamp":1652286587.040679,"priority":"Normal","status_category":"Done","pull_request":8689},{"issue_id":"406437","title":"launchd service provider fails if a parsable but invalid LaunchAgent or LaunchDaemon plist file exists","url":"https://tickets.puppetlabs.com/browse/PUP-11164","created_at":"2021-07-08T15:49:27.000-0700","number":"PUP-11164","body":"If a file in the {{LaunchAgents}} or {{LaunchDaemons}} paths is encountered that's parseable by {{Puppet::Util::Plist.read_plist_from_file}} but not a valid {{launchd}} plist file, then Puppet will crash with an error.\r\n\r\nTo reproduce:\r\n{code}\r\n# echo \"aaa\" >/Library/LaunchDaemons/invalid.txt\r\n# puppet resource service\r\nError: Could not run: undefined method `has_key?' for \"aaa\":String\r\n{code}\r\n\r\nIn [launchd.rb line 141|https://github.com/puppetlabs/puppet/blob/aa1df95ab3c8ee5bd8f007ba45cca422b1de2498/lib/puppet/provider/service/launchd.rb#L141], the parsed plist ({{job}}) is checked with {{.has_key?}} to ensure  a {{Label}} is present. If the parsed plist is not a {{Hash}}, though, this will fail.\r\n\r\nI expect the correct course of action is to add a {{job.is_a?(Hash)}} check first.","closed_at":"2021-08-11T06:23:30.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11164","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-08-11T06:23:30.000-0700","timestamp":1652286587.456678,"priority":"Normal","status_category":"Done","pull_request":8683},{"issue_id":"390409","title":"pkg provider cannot unhold and update package in the same run","url":"https://tickets.puppetlabs.com/browse/PUP-10956","created_at":"2021-03-09T05:27:23.000-0800","number":"PUP-10956","body":"*Puppet Version:* starting with 5.5.19, 6.13.0 and 7.0.0\r\n *Puppet Server Version:* n/a\r\n *OS Name/Version:* Solaris 11\r\n\r\nDescribe your issue in as much detail as possible…\r\n\r\nAfter the addition of the {{mark}} property, a package cannot pe unheld and updated in the same run.\r\n\r\nDescribe steps to reproduce…\r\n\r\nAssuming {{mypkg}} is installed with version 0.0.2, and held/frozen, apply the following manifest:\r\n\r\n{code}\r\npackage {mypkg : ensure=>\"0.0.3\", mark=>\"none\", provider=>\"pkg\"}\r\n{code}\r\n\r\n*Desired Behavior:*\r\n\r\nThe package is unheld/unfrozen, and updated to 0.0.3\r\n\r\n*Actual Behavior:*\r\n\r\nPuppet attempts to update the package first, which results in:\r\n\r\n{code}\r\nDebug: Executing: '/usr/bin/pkg update -n mypkg@0.0.3,5.11:20210309T130735Z'\r\nError: No version of mypkg matching 0.0.3 is installable, even though the package is currently installed\r\nError: /Stage[main]/Main/Package[mypkg]/ensure: change from '0.0.2,5.11:20210309T130605Z' to '0.0.3' failed: No version of mypkg matching 0.0.3 is installable, even though the package is currently installed\r\n{code}\r\n\r\nAttempting to manually run {{pkg update}} gives:\r\n{code}\r\nCreating Plan (Solver setup): \\\r\npkg update: No matching version of mypkg can be installed:\r\n  Reject:  pkg://tstpub.lan/mypkg@0.0.3,5.11:20210309T130735Z\r\n  Reason:  This version is excluded by a freeze on mypkg at version 0.0.2,5.11:20210309T130605Z.\r\n{code}\r\n","closed_at":"2021-08-11T06:24:36.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10956","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-08-11T06:24:36.000-0700","timestamp":1652286587.561595,"priority":"Normal","status_category":"Done","pull_request":8682},{"issue_id":"407578","title":"undefined method `[]' for nil:NilClass when handling SemanticPuppet::Dependency::UnsatisfiableGraph","url":"https://tickets.puppetlabs.com/browse/PUP-11172","created_at":"2021-07-21T03:16:26.000-0700","number":"PUP-11172","body":"*Installed Software*\r\n # rpm -qa |grep -E '(puppet|pdk)'\r\n puppet7-release-7.0.0-2.el7.noarch\r\n puppet-agent-7.8.0-1.el7.x86_64\r\n pdk-2.1.1.0-1.el7.x86_64\r\n\r\n \r\n\r\n*Steps to reproduce*\r\n\r\nI am trying to deploy a custom puppet module and I went through:\r\n\r\nrake build:pdk\r\n\r\nthen:\r\n\r\npuppet module install ./path/to/OUR_MODULE_NAME-3.0.0.tar.gz --debug\r\n\r\n \r\n\r\n*Desired Behavior:*\r\n\r\nOur module with all dependencies be installed\r\n\r\n*Actual Behavior:*\r\n\r\nCode exits non-zero trying to call ..constraints[*nil*].first[1]\r\n\r\n \r\n\r\nIt seems like the error is caused because of a logical issue at:\r\n\r\n[https://github.com/puppetlabs/puppet/blob/main/lib/puppet/module_tool/applications/installer.rb#L141]\r\n\r\nWith some janky\r\n{quote}{\\{ rescue SemanticPuppet::Dependency::UnsatisfiableGraph => e}}\r\n {{  unsatisfied = nil}}\r\n {{  pp 'e'}}\r\n {{  pp e}}\r\n {{  pp 'e.respond_to?(:unsatisfied)'}}\r\n {{  pp e.respond_to?(:unsatisfied)}}\r\n {{  pp 'e.respond_to?(:unsatisfied)'}}\r\n {{  pp e.respond_to?(:unsatisfied)}}\r\n{quote}\r\nThe output below shows that `e` does respond to :unsatisfied, but e.unsatisfied is nil, so when it's called on L167 it fails\r\n\r\n \r\n{quote}{{$ puppet module install ./pkg/OUR_MODULE_NAME-3.0.0.tar.gz --debug}}\r\n {{Debug: Runtime environment: puppet_version=7.8.0, ruby_version=2.7.3, run_mode=user, default_encoding=UTF-8}}\r\n {{Notice: Preparing to install into /home/vagrant/.puppetlabs/etc/code/modules ...}}\r\n {{Debug: Could not find library 'archive/tar/minitar' required to enable feature 'minitar'}}\r\n {{Debug: Executing: 'gzip -dc /REDACTED/pkg/OUR_MODULE_NAME-3.0.0.tar.gz | tar xof -'}}\r\n {{Debug: Executing: 'find . -type d -exec chmod 755 {} +'}}\r\n {{Debug: Executing: 'find . -type f -exec chmod u+rw,g+r,a-st {} +'}}\r\n {{Debug: Executing: 'chown -R 1000:1000 .'}}\r\n {{Debug: Unpacked local tarball to /home/vagrant/.puppetlabs/opt/puppet/cache/OUR_MODULE_NAME/cache/local-tarball20210721-26316-1jpeh2d}}\r\n {{Notice: Downloading from [https://forgeapi.puppet.com|https://forgeapi.puppet.com/] ...}}\r\n {{Debug: Could not find library 'pe_license' required to enable feature 'pe_license'}}\r\n {{Debug: Creating new connection for [https://forgeapi.puppet.com:443|https://forgeapi.puppet.com/]}}\r\n {{Debug: Starting connection for [https://forgeapi.puppet.com:443|https://forgeapi.puppet.com/]}}\r\n {{Debug: Using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384}}\r\n {{Debug: HTTP GET [https://forgeapi.puppet.com/v3/releases?module=cds-puppet&sort_by=version&exclude_fields=readme%2Cchangelog%2Clicense%2Curi%2Cmodule%2Ctags%2Csupported%2Cfile_size%2Cdownloads%2Ccreated_at%2Cupdated_at%2Cdeleted_at] returned 200 OK}}\r\n {{Debug: Caching connection for [https://forgeapi.puppet.com:443|https://forgeapi.puppet.com/]}}\r\n {{Debug: Using cached connection for [https://forgeapi.puppet.com:443\r\n|https://forgeapi.puppet.com/]}}{{<SOME OUTPUT OMITTED>}}|\r\n\r\n{{Debug: Caching connection for [https://forgeapi.puppet.com:443|https://forgeapi.puppet.com/]}}\r\n {{Debug: Using cached connection for [https://forgeapi.puppet.com:443|https://forgeapi.puppet.com/]}}\r\n {{Debug: HTTP GET [https://forgeapi.puppet.com/v3/releases?module=thias-postfix&sort_by=version&exclude_fields=readme%2Cchangelog%2Clicense%2Curi%2Cmodule%2Ctags%2Csupported%2Cfile_size%2Cdownloads%2Ccreated_at%2Cupdated_at%2Cdeleted_at] returned 200 OK}}\r\n {{Debug: Caching connection for [https://forgeapi.puppet.com:443|https://forgeapi.puppet.com/]}}\r\n {{Info: Resolving dependencies ...}}\r\n{quote}\r\n{quote}{{\"e\"}}\r\n {{#<SemanticPuppet::Dependency::UnsatisfiableGraph: Could not find satisfying releases for OUR_MODULE_NAME>}}\r\n {{\"e.unsatisfied\"}}\r\n {{nil}}\r\n {{\"e.respond_to?(:unsatisfied)\"}}\r\n {{true}}\r\n{quote}\r\n{quote}{{Error: undefined method `[]' for nil:NilClass}}\r\n {{Error: Try 'puppet help module install' for usage}}\r\n{quote}\r\n \r\n\r\n*Bonus Info* \r\n * I am only seeing this now because I have finally been able to schedule time on upgrading from puppet 5, and am going straight to 7.\r\n * rake works:\r\n ** check\r\n ** rubocop\r\n ** lint\r\n ** metadata_lint\r\n ** validate","closed_at":"2021-08-11T06:25:16.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11172","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-08-11T06:25:16.000-0700","timestamp":1652286597.624985,"priority":"Low","status_category":"Done","pull_request":8718},{"issue_id":"410089","title":"Allow loading from scripts mount when loading Task files","url":"https://tickets.puppetlabs.com/browse/PUP-11200","created_at":"2021-08-05T15:11:52.000-0700","number":"PUP-11200","body":"When loading files specified in Task metadata, Puppet specifies which mounts those files can be loaded from. This adds the scripts mount to the list of mounts that Task files can be loaded from.","closed_at":"2021-08-12T01:43:21.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11200","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-08-12T01:43:21.000-0700","timestamp":1652286597.729824,"priority":"Normal","status_category":"Done","pull_request":8732},{"issue_id":"379779","title":"Unable to install rpm packages via provides of the package","url":"https://tickets.puppetlabs.com/browse/PUP-10798","created_at":"2020-12-03T03:08:14.000-0800","number":"PUP-10798","body":"*Puppet Version: 6.14*\r\n *OS Name/Version: CentOS 8.2*\r\n\r\nIt is not possible to install an rpm package via an provides name of the package.\r\n\r\nSample:\r\n{code:java}\r\npackage { 'dnf-plugin-post-transaction-actions': ensure => installed} {code}\r\nit will fails with:\r\n{code:java}\r\nError: Execution of '/usr/bin/dnf -d 0 -e 1 -y list dnf-plugin-post-transaction-actions' returned 1: Error: No matching Packages to list{code}\r\nbecause dnf list only work with real package names, not with package provides.\r\n\r\nBut an blind dnf call will work:\r\n{code:java}\r\nLANG=C dnf install dnf-plugin-post-transaction-actions\r\nLast metadata expiration check: 0:00:11 ago on Thu Dec  3 12:02:50 2020.\r\nDependencies resolved.\r\n===================================================================================================================================================================================================================\r\n Package                                                                     Architecture                           Version                                           Repository                              Size\r\n===================================================================================================================================================================================================================\r\nInstalling:\r\n python3-dnf-plugin-post-transaction-actions                                 noarch                                 4.0.12-4.el8_2                                    BaseOS                                  51 kTransaction Summary\r\n===================================================================================================================================================================================================================\r\nInstall  1 Package\r\n\r\n{code}\r\nIt will provides:\r\n{code:java}\r\ndnf download dnf-plugin-post-transaction-actions\r\npython3-dnf-plugin-post-transaction-actions-4.0.12-4.el8_2.noarch.rpm\r\n\r\nrpm -qp --provides python3-dnf-plugin-post-transaction-actions-4.0.12-4.el8_2.noarch.rpm\r\nconfig(python3-dnf-plugin-post-transaction-actions) = 4.0.12-4.el8_2\r\ndnf-plugin-post-transaction-actions = 4.0.12-4.el8_2\r\npython3-dnf-plugin-post-transaction-actions = 4.0.12-4.el8_2\r\n{code}\r\nSo it can be installed via dnf install dnf-plugin-post-transaction-actions. But puppet can't handle package provides of an rpm package. So doing the same with puppet will fail.\r\n\r\n ","closed_at":"2021-08-24T02:08:46.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10798","labels":"","state":"Accepted","updated_at":"2021-08-24T02:08:46.000-0700","timestamp":1652286601.196035,"priority":"Critical","status_category":"To Do","pull_request":8692},{"issue_id":"342644","title":"Puppet gem has no/missing development/test gems","url":"https://tickets.puppetlabs.com/browse/PUP-10240","created_at":"2020-01-19T10:35:24.000-0800","number":"PUP-10240","body":"Hi,\r\n\r\nI took a look at the puppet gem dependencies for the latest release:\r\n\r\nhttps://rubygems.org/gems/puppet/versions/6.12.0\r\n\r\nIt lists a few runtime dependencies, but no additional dependencies for development/test. Could you add gems required to execute the test suite as well?","closed_at":"2021-09-03T11:04:58.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10240","labels":"","state":"Closed","updated_at":"2021-09-03T11:04:58.000-0700","timestamp":1652286602.22388,"priority":"Normal","status_category":"Done","pull_request":7937},{"issue_id":"152161","title":"Agent does not save local copy of last_run_report.yaml if submission to report server fails","url":"https://tickets.puppetlabs.com/browse/PUP-6708","created_at":"2016-09-15T14:40:34.000-0700","number":"PUP-6708","body":"On an Ubuntu 16.04 VM running Puppet 1.6.2 agent:\r\n\r\nThe agent does not appear to save a run report if it fails to submit the report to its report server.\r\n\r\n*Repro*\r\n{code}\r\nroot@ubuntu16:~# puppet agent -t --server=foo:1 --report_server=bar:2 --http_connect_timeout=3s --http_debug\r\nopening connection to foo:1:8140...\r\nWarning: Unable to fetch my node definition, but the agent run will continue:\r\nWarning: execution expired\r\nInfo: Retrieving pluginfacts\r\nopening connection to foo:1:8140...\r\nError: /File[/opt/puppetlabs/puppet/cache/facts.d]: Failed to generate additional resources using 'eval_generate': execution expired\r\nopening connection to foo:1:8140...\r\nError: /File[/opt/puppetlabs/puppet/cache/facts.d]: Could not evaluate: Could not retrieve file metadata for puppet:///pluginfacts: execution expired\r\nInfo: Retrieving plugin\r\nopening connection to foo:1:8140...\r\nError: /File[/opt/puppetlabs/puppet/cache/lib]: Failed to generate additional resources using 'eval_generate': execution expired\r\nopening connection to foo:1:8140...\r\nError: /File[/opt/puppetlabs/puppet/cache/lib]: Could not evaluate: Could not retrieve file metadata for puppet:///plugins: execution expired\r\nInfo: Loading facts\r\nopening connection to foo:1:8140...\r\nError: Could not retrieve catalog from remote server: execution expired\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\nopening connection to bar:2:8140...\r\nError: Could not send report: execution expired\r\n# Afterward, no report is saved on the agent:\r\nroot@ubuntu16:~# ls /opt/puppetlabs/puppet/cache/\r\nclientbucket  client_data  client_yaml  facts.d  lib  preview  state\r\nroot@ubuntu16:~# ls /opt/puppetlabs/puppet/cache/state/\r\nclasses.txt  graphs  last_run_summary.yaml  resources.txt  state.yaml  transactionstore.yaml\r\n{code}\r\n\r\n","closed_at":"2021-09-08T02:30:52.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6708","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-09-08T02:30:52.000-0700","timestamp":1652286602.850042,"priority":"Normal","status_category":"Done","pull_request":8741},{"issue_id":"386484","title":"lookup fails if module lookup_options are empty","url":"https://tickets.puppetlabs.com/browse/PUP-10890","created_at":"2021-02-05T12:57:32.000-0800","number":"PUP-10890","body":"Doing a test on a module with hiera that has an empty `lookup_options:` will result in errors during unit tests like \r\n\r\n \r\n      # --- Caused by: ---\r\n      # NoMethodError:\r\n      #   undefined method `each_pair' for nil:NilClass\r\n      #   /opt/puppetlabs/pdk/private/puppet/ruby/2.4.0/gems/puppet-5.5.21/lib/puppet/pops/lookup/lookup_adapter.rb:292:in `validate_lookup_options'","closed_at":"2021-09-08T02:31:27.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10890","labels":"community;doc-reviewed","state":"Resolved","updated_at":"2021-09-08T02:31:27.000-0700","timestamp":1652286602.957327,"priority":"Normal","status_category":"Done","pull_request":8740},{"issue_id":"408666","title":"User resource not removing password on AIX agents","url":"https://tickets.puppetlabs.com/browse/PUP-11190","created_at":"2021-07-27T05:48:35.000-0700","number":"PUP-11190","body":"*Puppet Version:* 7.8.0\r\n*Puppet Server Version:* PE 2021.2 (\t7.2.0) \r\n*OS Name/Version:* AIX 7.2\r\n\r\nwhen deleting a user with Puppet (User resource type), the password entry in /etc/security/passwd is not being cleaned up.\r\n\r\nResource definition example:\r\n\r\n{code:java}\r\n  user { 'saaddm':\r\n    ensure     => 'absent',\r\n    managehome => true\r\n  }\r\n \r\n{code}\r\n\r\n\r\nDebug:\r\n\r\n(130)PROD:root@xxxxxx:/root# puppet agent -t --debug 2>&1 | grep rmuser\r\nDebug: Executing: '/usr/sbin/rmuser saaddm'\r\n(0)PROD:root@xxxxxx:/root#\r\n\r\n*Desired Behavior:* password gets cleaned up\r\n\r\n\r\n*Actual Behavior:* password is still present in /etc/security/passwd\r\n\r\n\r\n","closed_at":"2021-09-08T02:46:43.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11190","labels":"doc-reviewed;jira_escalated","state":"Resolved","updated_at":"2021-09-08T02:46:43.000-0700","timestamp":1652286603.061284,"priority":"Normal","status_category":"Done","pull_request":8737},{"issue_id":"407149","title":"User resource unable to remove user's home directory when set to absent in AIX","url":"https://tickets.puppetlabs.com/browse/PUP-11170","created_at":"2021-07-16T09:33:13.000-0700","number":"PUP-11170","body":"OS agent: AIX 7.1 or 7.2\r\n\r\nwhen using the following manifest with puppet apply to create finch user\r\n\r\n{code:java}\r\ninclude add_user\r\nclass add_user {\r\n  # add user, create homedir and set a password\r\n  user { 'finch':\r\n    ensure     => 'present',\r\n    comment    => 'H Finch',\r\n    managehome => true,\r\n    # note the single quotes to stop $ expanding\r\n    password   => 'Pa$$w0rd',\r\n    home       => '/home/finch',\r\n  }\r\n\r\n}\r\n{code}\r\n\r\nthe user finch gets created along with its home folder as expected\r\n\r\nThen, if we use the following manifest to get rid of the same user\r\n\r\n{code:java}\r\ninclude delete_user\r\nclass delete_user{\r\n\r\n user { 'finch':\r\n   ensure           => 'absent',\r\n   managehome       => true,\r\n   home             => '/home/finch',\r\n }\r\n}\r\n{code}\r\n\r\nthe user finch gets deleted but its home folder (/home/finch) is left behind.\r\n\r\nI have used the same code in centos7 and both user and home folder gets deleted at once as expected\r\n\r\n*Desired Behavior:*\r\n\r\nthe code should work in the same manner independently of the OS platform - here AIX and centos\r\n\r\n*Actual Behavior:*\r\n\r\ncode is not removing deleted user's home directory in AIX\r\n\r\n\r\n","closed_at":"2021-09-08T02:47:32.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11170","labels":"doc-reviewed;jira_escalated","state":"Resolved","updated_at":"2021-09-08T02:47:32.000-0700","timestamp":1652286603.165949,"priority":"Normal","status_category":"Done","pull_request":8725},{"issue_id":"409781","title":"puppet warns about BOM and US-ASCII encoding","url":"https://tickets.puppetlabs.com/browse/PUP-11196","created_at":"2021-08-03T10:57:52.000-0700","number":"PUP-11196","body":"The fix for PUP-8243 causes ruby to generate a warning if the default external encoding is US-ASCII:\r\n{noformat}/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/file_system/file_impl.rb:83: warning: BOM with non-UTF encoding US-ASCII is nonsense \r\n{noformat}\r\nSince ASCII characters are single bytes, there is no need for a BOM to detect byte ordering (LSB/MSB), hence the message. I had assumed ruby would just ignore the `bom` prefix.\r\n\r\nWe'll need to check that the current external encoding starts with `utf-` (case-insensitively I think), and only add the `bom` prefix if it does.\r\n\r\nSee [https://github.com/puppetlabs/puppet/pull/8639#issuecomment-891939114]\r\n\r\nTo reproduce:\r\n{noformat}$ bx ruby -e 'Encoding.default_external = \"US-ASCII\"; require \"puppet\"; Puppet::FileSystem.read_preserve_line_endings(\"Gemfile\")'\r\n/home/josh/work/puppet/lib/puppet/file_system/file_impl.rb:83: warning: BOM with non-UTF encoding US-ASCII is nonsense\r\n{noformat}","closed_at":"2021-09-08T02:52:25.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11196","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-09-08T02:52:25.000-0700","timestamp":1652286603.268536,"priority":"Normal","status_category":"Done","pull_request":8747},{"issue_id":"329731","title":"regression: puppet resource --to_yaml should not emit puppet class tags","url":"https://tickets.puppetlabs.com/browse/PUP-10105","created_at":"2019-10-16T08:15:44.000-0700","number":"PUP-10105","body":"From https://tickets.puppetlabs.com/browse/PUP-7808?focusedCommentId=693345&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-693345\r\n\r\nThis change caused a regression. The option --to_yaml no longer generates syntactically valid YAML.\r\n\r\nBefore pull request #7718:\r\n{code:java}\r\nmysql_database:\r\n  PERCONA_SCHEMA:\r\n    ensure : 'present'\r\n    charset: 'utf8'\r\n    collate: 'utf8_general_ci'\r\n{code}\r\nAfter pull request #7718:\r\n{code:java}\r\nmysql_database:\r\n  PERCONA_SCHEMA:\r\n    ensure: present\r\n    charset: !ruby/string:Puppet::Util::Execution::ProcessOutput utf8\r\n    collate: !ruby/string:Puppet::Util::Execution::ProcessOutput utf8_general_ci\r\n{code}","closed_at":"2021-09-08T02:53:11.000-0700","comments":16,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10105","labels":"doc-reviewed;jira_escalated","state":"Resolved","updated_at":"2021-09-08T02:53:11.000-0700","timestamp":1652286603.376353,"priority":"Normal","status_category":"Done","pull_request":8739},{"issue_id":"21360","title":"Change --write-catalog-summary option into a config setting","url":"https://tickets.puppetlabs.com/browse/PUP-1042","created_at":"2013-12-16T03:01:33.000-0800","number":"PUP-1042","body":"# Overview #\r\nThe classes.txt file is only written when running Puppet in the agent run mode.\r\n\r\nIt would be useful for integration with MCollective filtering if this\r\nfile were also written when running Puppet the stand alone apply run\r\nmode.\r\n\r\n{code}\r\n# The file in which puppet agent stores a list of the classes\r\n# associated with the retrieved configuration.  Can be loaded in\r\n# the separate `puppet` executable using the `--loadclasses`\r\n# option.\r\n# The default value is '$statedir/classes.txt'.\r\nclassfile = /var/lib/puppet/state/classes.txt\r\n{code}\r\n\r\nThis would be useful with MCollective's configuration setting of:\r\n\r\n    classesfile = /var/lib/puppet/state/classes.txt\r\n\r\n# Impact Data #\r\n\r\nAt least one community member has requested this feature.  (See comments below).\r\n\r\nThis ticket is important for mcollective integration with \"puppet apply.\"","closed_at":"2021-09-13T04:09:20.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1042","labels":"doc-reviewed;redmine","state":"Resolved","updated_at":"2021-09-13T04:09:20.000-0700","timestamp":1652286603.689579,"priority":"Normal","status_category":"Done","pull_request":8753},{"issue_id":"266411","title":"Autoloader module_directories should not include duplicate modules","url":"https://tickets.puppetlabs.com/browse/PUP-9018","created_at":"2018-07-24T12:36:28.000-0700","number":"PUP-9018","body":"The autoloader's {{module_directories}} method can return the same module multiple times, or more likely different versions of the same module. This can lead to situations where the autoloader loads a type from one version of the module, but a provider from a different version.\r\n\r\nThe {{module_directories}} method should only return the first instance of the module in the modulepath, which is how other parts of puppet, eg Puppet::Pops::Loaders, file serving, load facts from modules, and PMT.","closed_at":"2021-09-13T21:40:50.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9018","labels":"","state":"Accepted","updated_at":"2021-09-13T21:40:50.000-0700","timestamp":1652286604.423367,"priority":"Normal","status_category":"To Do","pull_request":6943},{"issue_id":"300292","title":"User resource does not respect forcelocal for the comment parameter","url":"https://tickets.puppetlabs.com/browse/PUP-9562","created_at":"2019-03-14T11:48:45.000-0700","number":"PUP-9562","body":"A user resource configured with {{forcelocal}} will still try to sync the comment with the external directory services. It does use the `lusermod` to modify the local `/etc/passwd` to the comment specified in the user resource, but it compares the `in_sync` with the external directory services, meaning that it always updates the comment on catalog compilation.\r\n\r\n*Reproduction*:\r\n1. Configure an agent with LDAP\r\n2. Ensure nsswitch.conf has LDAP before `files` for `passwd`\r\n3. Add a user to LDAP with a comment. Below is an example user.\r\n{code}testuser:*:510:10:test:/home/test:/bin/bash\r\n{code}\r\n4. Apply the following manifest on the agent multiple times and observe that it tries to update the comment every time.\r\n{code}user{'test':\r\n  ensure => present,\r\n  forcelocal => true,\r\n  comment => 'local comment',\r\n  uid => '510',\r\n  gid => '10',\r\n}\r\n{code}\r\n*Expected Behavior*:\r\nThe agent should check the local passwd file for the comment as per [https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/user/useradd.rb#L58-L72]","closed_at":"2021-09-14T18:09:29.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9562","labels":"resolved-issue-added","state":"Resolved","updated_at":"2021-09-14T18:09:29.000-0700","timestamp":1652286604.938176,"priority":"Minor","status_category":"Done","pull_request":7768},{"issue_id":"410096","title":"Refine when the last used environment is used","url":"https://tickets.puppetlabs.com/browse/PUP-11201","created_at":"2021-08-05T17:04:02.000-0700","number":"PUP-11201","body":"With the recent changes in PUP-10216, the agent stores the last used environment in {{last_run_summary.yaml}}. If the next run does not specify an environment on the CLI, then the last used environment *always* takes precedence over the environment specified in puppet.conf. For example, given:\r\n{noformat}# puppet agent -t --environment feature_branch\r\n# puppet agent -t\r\n{noformat}\r\nIf the agent is allowed to specify its environment:\r\n\r\nPrior to PUP-10216, the second run would use the original configured environment from puppet.conf or default to \"production\".\r\n\r\nAfter PUP-10216, the second run uses the \"feature_branch\" environment. This is also true if the second run occurs in the background (systemd/cron), which is especially surprising.\r\n\r\nIn cases where the agent is *not* allowed to specify its environment, the last used environment provides the same function that the node request did. So the agent's behavior before and after PUP-10216 is the same, assuming the agent pluginsync'ed the right set of facts and classification doesn't change between runs.\r\n\r\nThis ticket proposes we make an exception for the agent-specified case so that the second run only uses the environment from the previous run if it was server-specified. Otherwise, the agent should start in its configured environment (from puppet.conf) or default to \"production\".\r\n\r\nSo I think this means:\r\n # If environment specified on CLI, use it\r\n # If last environment was server-specified, use it\r\n # Otherwise use our configured environment {{Puppet[:environment]}}\r\n\r\nI think we can detect if the last environment was server-specified by saving both the initial environment and the converged environment in {{last_run_summary.yaml}}. If those are different, then the server told us to use a different environment.\r\n\r\nIf they are the same, then it doesn't matter if it's agent or server-specified, just use Puppet[:environment]\r\n\r\nInitial should be initially set with the values from first run (step 1 or 3) and carried over, not overwritten with values received from server","closed_at":"2021-09-27T05:53:00.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11201","labels":"","state":"Resolved","updated_at":"2021-09-27T05:53:00.000-0700","timestamp":1652286607.016291,"priority":"Normal","status_category":"Done","pull_request":8736},{"issue_id":"387947","title":"Default timeout not respected for Windows services","url":"https://tickets.puppetlabs.com/browse/PUP-10925","created_at":"2021-02-18T08:01:49.000-0800","number":"PUP-10925","body":"*Puppet Version: 6.21.1*\r\n *Puppet Server Version: n/a*\r\n *OS Name/Version: Windows*\r\n\r\nWindows services have a timeout for service-related operations that defaults to 30 seconds, as seen here: [https://github.com/puppetlabs/puppet/blob/e4a654400a4c1ad3b5bc73fb558d28219a4626b2/lib/puppet/util/windows/service.rb#L24]\r\n\r\nThis variable is used in the following method: [https://github.com/puppetlabs/puppet/blob/c6412ea369aa1613ca166b10fb819fcf6130814b/lib/puppet/provider/service/windows.rb#L118]\r\n\r\nThe method is called in the base service type: [https://github.com/puppetlabs/puppet/blob/e4a654400a4c1ad3b5bc73fb558d28219a4626b2/lib/puppet/type/service.rb#L301]\r\n\r\n*Desired Behavior:*\r\n\r\nNot setting the timeout parameter on a Windows service should cause it to default to 30 seconds.\r\n\r\n*Actual Behavior:*\r\n\r\nNot setting the timeout parameter on a Windows services causes it to default to 10 seconds.\r\n\r\n \r\n\r\nThe line in the service type should change from:\r\n{code}\r\ndefaultto { provider.class.respond_to?(:default_timeout) ? provider.default_timeout : 10 }\r\n{code}\r\n\r\nto\r\n\r\n{code}\r\ndefaultto { provider.respond_to?(:default_timeout) ? provider.default_timeout : 10 }\r\n{code}","closed_at":"2021-10-05T05:09:52.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10925","labels":"community;doc-reviewed","state":"Resolved","updated_at":"2021-10-05T05:09:52.000-0700","timestamp":1652286618.577844,"priority":"Normal","status_category":"Done","pull_request":8761},{"issue_id":"415709","title":"Not all user attributes honor forcelocal (e.g. home, shell)","url":"https://tickets.puppetlabs.com/browse/PUP-11241","created_at":"2021-09-14T18:03:13.000-0700","number":"PUP-11241","body":"*Puppet Version:* 6.19.1, 7.9.0\r\n*Puppet Server Version:* N/A\r\n*OS Name/Version:* CentOS 7\r\n\r\nWhen setting {{forcelocal => true}} on a {{user}} resource, I'd expect all user attributes available via {{/etc/passwd}} to be used as the \"is\" value for the insync? check.\r\n\r\nThis appears to not be the case for the {{home}} and {{shell}} attributes.\r\n\r\nThose are always checked against their values from directory services rather than from {{/etc/passwd}}, which means those attributes appear to change on each puppet run and the {{user}} resource is no longer idempotent.\r\n\r\n*Desired Behavior:*\r\n\r\nWhen an OS has directory services enabled (e.g. LDAP via SSSD) and a puppet-managed user exists in LDAP...\r\n\r\nGiven an {{/etc/passwd}} file containing:\r\n{noformat}\r\nnate:x:1000:1001:hello world:/opt/hello:/bin/zsh\r\n{noformat}\r\n\r\nThis code should read \"shell\", \"home\", and \"comment\" all from {{/etc/passwd}} when comparing the \"is\" state to the \"should\" state:\r\n{code}\r\nuser { 'nate':\r\n  ensure     => present,\r\n  forcelocal => true,\r\n  shell      => '/bin/zsh',\r\n  home       => '/opt/hello',\r\n  comment    => 'hello world',\r\n}\r\n{code}\r\n\r\n*Actual Behavior:*\r\n\r\nOnly \"uid\", \"gid\", \"comment\", and \"groups\" are fetched from {{/etc/passwd}} when {{forcelocal => true}}:\r\nhttps://github.com/puppetlabs/puppet/blob/7.11.0/lib/puppet/provider/user/useradd.rb#L60-L78\r\n\r\n\"home\" and \"shell\" are fetched from directory services, not from {{/etc/passwd}}.\r\n\r\nThe user resource shows a change to \"home\" and \"shell\" on each Puppet run even though nothing is changing.\r\n\r\n\r\n*Related:*\r\nSupport for \"comment\" when forcelocal is true was added here: https://github.com/puppetlabs/puppet/pull/7768\r\n\r\nBasically, I'm asking for that same support for all the other attributes pulled from {{/etc/passwd}} in [the finduser() method|https://github.com/puppetlabs/puppet/blob/7.11.0/lib/puppet/provider/user/useradd.rb#L80-L96]","closed_at":"2021-10-05T05:10:23.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11241","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-10-05T05:10:23.000-0700","timestamp":1652286618.682942,"priority":"Normal","status_category":"Done","pull_request":8767},{"issue_id":"412673","title":"Puppet fails to install packages on Solaris if another pkg install is running","url":"https://tickets.puppetlabs.com/browse/PUP-11208","created_at":"2021-08-19T04:17:38.000-0700","number":"PUP-11208","body":"Puppet fails hard if it tries to install a package on Solaris 11 while a {{pkg install}} command is already running in the background.\r\n\r\n{{pkg install}} fails with the following error:\r\n{code:java}root@initial-holdup:~# pkg install nano\r\npkg: The image cannot be modified as it is currently in use by another package client.\r\nroot@initial-holdup:~# echo $?\r\n7 {code}\r\nThe same error can be reproduced in a zone set up, if you execute {{pkg install something}} concurrently on global and the zone (the following output is from a puppet manifest with the nano package resource):\r\n{code:java}Debug: Executing: '/usr/bin/pkg install --accept --sync-actuators-timeout 900 nano'\r\nError: Unable to update  Startup: Linked image publisher check ... Done\r\npkg: install failed (linked image exception(s)):A 'pubcheck-linked' operation failed for child 'zone:devzone' with an unexpected\r\nreturn value of 7 and generated the following output:\r\npkg: The image cannot be modified as it is currently in use by another package client.\r\nError: /Stage[main]/Main/Package[nano]/ensure: change from 'absent' to 'present' failed: Unable to update  Startup: Linked image publisher check ... Done\r\npkg: install failed (linked image exception(s)):A 'pubcheck-linked' operation failed for child 'zone:devzone' with an unexpected\r\nreturn value of 7 and generated the following output:\r\npkg: The image cannot be modified as it is currently in use by another package client. {code}\r\n \r\n\r\nFrom the Solaris pkg manpages ([https://docs.oracle.com/cd/E36784_01/html/E36870/pkg-1.html):]\r\n{quote}7: The image is currently in use by another process and cannot be modified.\r\n{quote}\r\n From a Solaris KB article ([https://docs.oracle.com/cd/E53394_01/html/E54739/nomodimg.html]):\r\n\r\n \r\n{quote}Try your {{pkg}} command again after the current package process exits (process 26604 in this example). If the process does not exit quickly, use {{ptree -a}}, for example, to begin to examine the process.\r\n{quote}\r\n \r\n\r\nWe probably need to implement a similar defense in Puppet, that checks to see if the {{pkg}} command failed with error code 7 and keeps retrying the command a number of times (tbd how many times & how often). 5 x 2^n; 1; 2; 4; 8; 16","closed_at":"2021-10-05T05:11:17.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11208","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-10-05T05:11:17.000-0700","timestamp":1652286618.787697,"priority":"Normal","status_category":"Done","pull_request":8769},{"issue_id":"413595","title":"puppet-agent : Concat not respecting environments","url":"https://tickets.puppetlabs.com/browse/PUP-11265","created_at":"2021-08-26T23:42:32.000-0700","number":"PUP-11265","body":"_Basic Info_\r\n*Module Version:* puppetlabs-concat 7.1.1\r\n*Puppet Version:* 7.10.0\r\n*OS Name/Version:* Centos 7\r\n\r\n_Describe your issue in as much detail as possible..._\r\nConcat is not respecting the choosen environment via external enc when fetching module content for files.\r\n\r\nError:\r\n{noformat}\r\nError: /Stage[main]/Df_modsec::Config/Concat[/etc/nginx/modsecurity_main.conf]/Concat_file[/etc/nginx/modsecurity_main.conf]: Failed to generate additional resources using 'eval_generate': Could not retrieve \r\nsource(s) puppet:///modules/df_modsec/modsecurity_main.conf\r\n{noformat}\r\n\r\nCode:\r\n{code:puppet}\r\n -> concat { $df_modsec::config_main:\r\n    ensure => 'present',\r\n    owner  => 0,\r\n    group  => 0,\r\n    mode   => '0644',\r\n    order  => 'numeric',\r\n    notify => Class['::df_web::nginx::service'],\r\n  }\r\n  -> concat::fragment { $df_modsec::config_main:\r\n    order  => 0,\r\n    target => $df_modsec::config_main,\r\n    source => 'puppet:///modules/df_modsec/modsecurity_main.conf',\r\n    notify => Class['::df_web::nginx::service'],\r\n  }\r\n{code}\r\n\r\nAfter further inspection of the run with the --debug parameter it is visible that puppet switched back to the default environment \"production\" during the run. The file itself is managed in a different environment.\r\n\r\n{noformat}\r\n[root@somehost0 ~]# puppet agent -tv  --noop --debug \r\nInfo: Using environment 'customer1_production'\r\n...\r\nDebug: Using cached connection for https://puppet.int.hostname.net:8140\r\nDebug: HTTP GET https://puppet.int.hostname.net:8140/puppet/v3/file_metadata/modules/df_varnish/backend.vcl?*environment=production* returned 404 Not Found\r\n{noformat}\r\n\r\nbackend.vcl?environment=production should be customer1_production if i am not mistaken by the logic.\r\n\r\n\r\n*Desired Behavior:*\r\nRun resulting no error\r\n\r\n*Actual Behavior:*\r\nRun unable to fetch files via concat.\r\n\r\nPlease take a moment and attach any relevant log output and/or manifests. This will help us immensely when troubleshooting the issue.\r\n\r\nCan provide further logs if needed, just let me know.\r\nThanks for your time","closed_at":"2021-10-05T05:16:17.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11265","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-10-05T05:16:17.000-0700","timestamp":1652286618.895149,"priority":"Normal","status_category":"Done","pull_request":8770},{"issue_id":"414255","title":"Util::JSON.dump receives non-hash options","url":"https://tickets.puppetlabs.com/browse/PUP-11237","created_at":"2021-09-03T08:13:51.000-0700","number":"PUP-11237","body":"*Puppet Version:* Main branch (401e01b2691d9c496749ff07f7fca7fc852e105c)\r\n*Puppet Server Version:* Main branch (38479aafcb6c27d826976e31a993258e9e9e4de2)\r\n*OS Name/Version:* Ubuntu 20.04\r\n\r\nWhile testing the {{file_metadatas}} Puppetserver endpoint, when sending this request:\r\n{{code}}\r\n  https://localhost:8140/puppet/v3/file_metadatas/scripts/mymodule/script.sh?environment=production&recurse=yes\r\n{{code}}\r\nPuppet errors with (apologies for the backtrace!):\r\n{{code}}\r\n2021-09-03 07:58:27,688 DEBUG [qtp1541353205-57] [puppetserver] Puppet Could not render_multiple to Puppet::Network::Format[json]: undefined method `delete' for #<JSON::Ext::Generator::State:0x79067448>\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/util/json.rb:64:in `dump'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/format_support.rb:105:in `to_json'\r\njson/ext/GeneratorMethods.java:79:in `to_json'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/util/json.rb:65:in `dump'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/formats.rb:129:in `render_multiple'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/format_support.rb:26:in `render_multiple'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/api/indirected_routes.rb:161:in `block in do_search'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/api/indirected_routes.rb:192:in `block in first_response_formatter_for'\r\norg/jruby/RubyEnumerable.java:690:in `find'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/api/indirected_routes.rb:190:in `first_response_formatter_for'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/api/indirected_routes.rb:160:in `do_search'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/api/indirected_routes.rb:53:in `block in call'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/context.rb:62:in `override'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet.rb:306:in `override'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/api/indirected_routes.rb:52:in `call'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/api/server/v3.rb:17:in `block in wrap'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/route.rb:82:in `block in process'\r\norg/jruby/RubyArray.java:1809:in `each'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/route.rb:81:in `process'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/route.rb:88:in `process'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/route.rb:88:in `process'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/handler.rb:86:in `block in process'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/handler.rb:69:in `block in with_request_profiling'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/util/profiler/around_profiler.rb:58:in `profile'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/util/profiler.rb:51:in `profile'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/handler.rb:65:in `with_request_profiling'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/handler.rb:85:in `block in process'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/handler.rb:92:in `respond_to_errors'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/handler.rb:84:in `process'\r\nuri:classloader:/puppetserver-lib/puppet/server/master.rb:69:in `block in handleRequest'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/context.rb:62:in `override'\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet.rb:306:in `override'\r\nuri:classloader:/puppetserver-lib/puppet/server/master.rb:68:in `handleRequest'\r\n{{code}}\r\n\r\nThis only happens when requesting the {{scripts}} mount - the request\r\n{{code}}\r\nhttps://localhost:8140/puppet/v3/file_metadatas/modules/mymodule/file?environment=production&recurse=yes\r\n{{code}}\r\nbehaves as expected.\r\n\r\nThe object that {{dump}} is receiving in this case actually can be converted to a hash, and adding\r\n{{code}}\r\noptions = options.to_h unless options.is_a?(Hash)\r\n{{code}}\r\nfixes the issue, but doesn't really get to *why* this method is receiving the wrong object to begin with.\r\n\r\nHappy to provide more testing and info!","closed_at":"2021-10-05T05:17:37.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11237","labels":"doc-reviewed","state":"Closed","updated_at":"2021-10-05T05:17:37.000-0700","timestamp":1652286619.003505,"priority":"Normal","status_category":"Done","pull_request":8765},{"issue_id":"408088","title":"Autoloader is confused by Windows 8.3 paths","url":"https://tickets.puppetlabs.com/browse/PUP-11184","created_at":"2021-07-22T16:54:59.000-0700","number":"PUP-11184","body":"*Puppet Version: 7.9.0*\r\n\r\nThe autoloader can load the same file twice if the ruby load path contains Windows 8.3 style paths. The file {{lib/puppet/file_system/uniquefile.rb}} creates a class whose parent is an anonymous class. If the file is loaded twice, then it will fail with: {{superclass mismatch for class Uniquefile (TypeError)}}.\r\n\r\nTo reproduce, install puppet-agent on Windows:\r\n{noformat}C:\\> cmd /c start /w msiexec /qn /i http://builds.puppetlabs.lan/puppet-agent/7.9.0/artifacts/windows/puppet-agent-7.9.0-x64.msi\r\nC:\\> net stop puppet\r\nC:\\> cd C:\\PROGRA~1\\PUPPET~1\\Puppet\\puppet\\bin\r\n{noformat}\r\ncreate \"puppettest.rb\" containing:\r\n{code:ruby}require 'puppet'\r\nPuppet.initialize_settings\r\nputs \"RUBYLIBDIR #{RbConfig::CONFIG['rubylibdir']}\"\r\nputs \"Loaded Puppet\"\r\npp $LOADED_FEATURES.grep(/uniquefile/).first\r\nPuppet::Type.type(:exec)\r\n{code}\r\nAnd execute the script:\r\n{noformat}C:\\PROGRA~1\\PUPPET~1\\Puppet\\puppet\\bin>ruby puppettest.rb\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/facter/util/file_helper.rb:9: warning: already initialized constant Class::DEBUG_MESSAGE\r\nC:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/facter/util/file_helper.rb:9: warning: previous definition of DEBUG_MESSAGE was here\r\n...\r\nHundreds of already initialized constant errors\r\n...\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/file_system/windows.rb:123: warning: already initialized constant Puppet::FileSystem::Windows::LOCK_VIOLATION\r\nC:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/file_system/windows.rb:123: warning: previous definition of LOCK_VIOLATION was here\r\nTraceback (most recent call last):\r\n        33: from puppettest.rb:6:in `<main>'\r\n        32: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/metatype/manager.rb:154:in `type'\r\n        31: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/concurrent/lock.rb:10:in `synchronize'\r\n        30: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/metatype/manager.rb:171:in `block in type'\r\n        29: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:182:in `load'\r\n        28: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:78:in `load_file'\r\n        27: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:78:in `load'\r\n        26: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/type/exec.rb:1:in `<top (required)>'\r\n        25: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/type/exec.rb:2:in `<module:Puppet>'\r\n        24: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/metatype/manager.rb:73:in `newtype'\r\n        23: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/concurrent/lock.rb:10:in `synchronize'\r\n        22: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/metatype/manager.rb:126:in `block in newtype'\r\n        21: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:196:in `loadall'\r\n        20: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:91:in `loadall'\r\n        19: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:91:in `each'\r\n        18: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:93:in `block in loadall'\r\n        17: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:78:in `load_file'\r\n        16: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:78:in `load'\r\n        15: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/exec/posix.rb:1:in `<top (required)>'\r\n        14: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/exec/posix.rb:1:in `require_relative'\r\n        13: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/exec.rb:1:in `<top (required)>'\r\n        12: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/exec.rb:1:in `require_relative'\r\n        11: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider.rb:37:in `<top (required)>'\r\n        10: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider.rb:43:in `<class:Provider>'\r\n         9: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider.rb:43:in `require_relative'\r\n         8: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/confiner.rb:1:in `<top (required)>'\r\n         7: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/confiner.rb:1:in `require_relative'\r\n         6: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/confine_collection.rb:3:in `<top (required)>'\r\n         5: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/confine_collection.rb:3:in `require_relative'\r\n         4: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/confine.rb:3:in `<top (required)>'\r\n         3: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/confine.rb:3:in `require_relative'\r\n         2: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util.rb:11:in `<top (required)>'\r\n         1: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util.rb:11:in `require_relative'\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/file_system/uniquefile.rb:17:in `<top (required)>': superclass mismatch for class Uniquefile (TypeError)\r\n{noformat}\r\nThe problem stems from a behavior change in Dir.glob in Ruby 2.1 combined with using relative_require. See PUP-6557 and [https://bugs.ruby-lang.org/issues/10819].\r\n\r\nWhen puppet is initially loaded, all LOADED_FEATURES are added using 8.3 paths:\r\n{noformat}C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/file_system/uniquefile.rb\r\n{noformat}\r\nWhen we call `Puppet::Type.type(:exec)`, it uses the autoloader to load the exec type and all of its providers. The autoloader uses `Dir.glob` to find them. Ruby 2.1 changed the behavior of `Dir.glob` to always return the long path name on Windows. So then the autoloader tries to load:\r\n{noformat}C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/file_system/uniquefile.rb\r\n{noformat}\r\nAlso note in the stack trace above how the path changes from 8.3 to long paths:\r\n{noformat} 17: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:78:in `load_file'\r\n 16: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:78:in `load'\r\n 15: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/exec/posix.rb:1:in `<top (required)>'\r\n ...\r\n 1: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util.rb:11:in `require_relative'\r\n C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/file_system/uniquefile.rb:17:in `<top (required)>': Could not autoload puppet/type/exec: Could not autoload ../../../../../../../Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/exec/posix: superclass mismatch for class Uniquefile (Puppet::Error)\r\n{noformat}","closed_at":"2021-10-08T16:19:08.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11184","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-10-08T16:19:08.000-0700","timestamp":1652286620.067434,"priority":"Normal","status_category":"Done","pull_request":8768},{"issue_id":"418429","title":"Requiring files inside settings hook is slow on Windows","url":"https://tickets.puppetlabs.com/browse/PUP-11314","created_at":"2021-10-05T09:23:59.000-0700","number":"PUP-11314","body":"Calling require/require_relative inside of the storeconfigs setting hook is really slow on Windows: https://github.com/puppetlabs/puppet/blob/75737603872883d8d72224e2a6857804938f9634/lib/puppet/defaults.rb#L2122-L2123\r\n\r\nIt appears to add several minutes to the overall rspec time on Windows.\r\n\r\n","closed_at":"2021-10-08T19:46:55.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11314","labels":"","state":"Resolved","updated_at":"2021-10-08T19:46:55.000-0700","timestamp":1652286620.174749,"priority":"Normal","status_category":"Done","pull_request":8782},{"issue_id":"405654","title":"static catalogs not working for file resource when versioned_deploys enabled","url":"https://tickets.puppetlabs.com/browse/PUP-11169","created_at":"2021-07-02T09:38:16.000-0700","number":"PUP-11169","body":"*Puppet Version:* \r\n *Puppet Server Version:* *2019.8.5* and *2019.8.6*\r\n *OS Name/Version: Centos 7*\r\n\r\nWhen versioned_deploys is enabled (lockless deploys feature) the file resource stops operating as static catalog \r\n\r\n*Desired Behavior:*\r\n\r\nWhen deploy_versions is enabled (lockless deploys feature) the file resource stops operating as static catalog ** \r\n\r\n*Actual Behavior:*\r\n\r\n \r\n\r\nUsing the following class as example:\r\n\r\n\r\n{code:java}\r\nclass file_serving_test {\r\n# creating a file in the root folder\r\n  file { '/root/jordi9.conf':\r\n    ensure => file,\r\n    source => 'puppet:///modules/file_serving_test/jordi9.conf'\r\n  }\r\n}\r\n{code}\r\n\r\n\r\nwithout version_deploys - static catalogs working\r\n\r\n{code:java}\r\n 10.64.132.119 - - [02/Jul/2021:14:22:22 +0000] \"GET /puppet/v3/static_file_content/site/file_serving_test/files/jordi9.conf?environment=production&code_id=urn%3Apuppet%3Acode-id%3A1%3Acc6a314c8caf1c58434ba024e0a38c234044cbe0%3Bproduction HTTP/1.1\" 200 14 \"-\" \"Puppet/6.22.1 Ruby/2.5.9-p229 (x86_64-linux)\" 8 - -\r\n{code}\r\n\r\n with version_deploys and no other changes - static catalogs not working\r\n\r\n{code:java}\r\n 10.64.132.119 - - [02/Jul/2021:14:28:52 +0000] \"GET /puppet/v3/file_metadata/modules/file_serving_test/jordi9.conf?links=manage&checksum_type=md5&source_permissions=ignore&environment=production HTTP/1.1\" 200 289 \"-\" \"Puppet/6.22.1 Ruby/2.5.9-p229 (x86_64-linux)\" 16 - 12\r\n 10.64.132.119 - - [02/Jul/2021:14:35:10 +0000] \"GET /puppet/v3/file_metadata/modules/file_serving_test/jordi9.conf?links=manage&checksum_type=md5&source_permissions=ignore&environment=production HTTP/1.1\" 200 367 \"-\" \"Puppet/6.22.1 Ruby/2.5.9-p229 (x86_64-linux)\" 11 - 8\r\n 10.64.132.119 - - [02/Jul/2021:14:58:46 +0000] \"GET /puppet/v3/file_metadata/modules/file_serving_test/jordi9.conf?links=manage&checksum_type=md5&source_permissions=ignore&environment=production HTTP/1.1\" 200 367 \"-\" \"Puppet/6.22.1 Ruby/2.5.9-p229 (x86_64-linux)\" 10 - 7\r\n{code}\r\n\r\n with version_deploys, deleting {{jordi9.conf}} from the agent and no other changes - static catalogs not working\r\n\r\n{code:java}\r\n 10.64.132.119 - - [02/Jul/2021:15:04:41 +0000] \"GET /puppet/v3/file_metadata/modules/file_serving_test/jordi9.conf?links=manage&checksum_type=md5&source_permissions=ignore&environment=production HTTP/1.1\" 200 367 \"-\" \"Puppet/6.22.1 Ruby/2.5.9-p229 (x86_64-linux)\" 18 - 14\r\n 10.64.132.119 - - [02/Jul/2021:15:04:42 +0000] \"GET /puppet/v3/file_content/modules/file_serving_test/jordi9.conf?environment=production HTTP/1.1\" 200 14 \"-\" \"Puppet/6.22.1 Ruby/2.5.9-p229 (x86_64-linux)\" 10 - 7 1\r\n{code}\r\n\r\nLogic steps to reproduce:\r\n# Add a file resource with source => 'puppet:///modules...' into the control repo in a module\r\n# Enable code manager\r\n# Observe static catalogs are working and the metadata for the file is inlined in the catalog.\r\n# Enable versioned code deploys\r\n# Observe that the static catalogs do not include the inlined metadata and the agent makes the file_metadata API call for the files\r\n\r\n*OUTCOMES*\r\n* Determine the cause of this bug - if you've put in ~2 points worth of work into this and can't determine the cause, we should stop and re-evaluate next steps.\r\n* If it's easy, fix it\r\n* If not, open separate ticket(s) describing the necessary changes","closed_at":"2021-10-14T09:13:21.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11169","labels":"doc-reviewed;jira_escalated;versioned_deploys","state":"Resolved","updated_at":"2021-10-14T09:13:21.000-0700","timestamp":1652286621.235501,"priority":"Normal","status_category":"Done","pull_request":8697},{"issue_id":"14942","title":"Install windows packages from remote sources","url":"https://tickets.puppetlabs.com/browse/PUP-394","created_at":"2013-09-19T00:16:58.000-0700","number":"PUP-394","body":"This may not be an issue anymore, need to validate for both msi and exe based packages","closed_at":"2021-10-20T01:50:06.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-394","labels":"fileserver;package;platform-os;source;type_and_provider;windows","state":"Accepted","updated_at":"2021-10-20T01:50:06.000-0700","timestamp":1652286621.563782,"priority":"Normal","status_category":"To Do","pull_request":5938},{"issue_id":"14945","title":"Manage both 32 and 64-bit windows applications","url":"https://tickets.puppetlabs.com/browse/PUP-397","created_at":"2013-09-19T00:20:16.000-0700","number":"PUP-397","body":null,"closed_at":"2021-10-20T01:52:01.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-397","labels":"package;platform-os;type_and_provider;windows","state":"Accepted","updated_at":"2021-10-20T01:52:01.000-0700","timestamp":1652286621.895334,"priority":"Normal","status_category":"To Do","pull_request":7942},{"issue_id":"105646","title":"Reading services on Mac is very slow","url":"https://tickets.puppetlabs.com/browse/PUP-5505","created_at":"2015-11-13T13:39:56.000-0800","number":"PUP-5505","body":"Currently Puppet runs `plutil -convert xml1` on EVERY plist it encounters because it has no way of supporting binary plist files. This occurs even if the plist is a text file.\r\n\r\nSpeed up reading plists so it doesn't take 30 seconds to do so. The most promising approach to this is to first try reading the plist file as text, and if that fails (which happens immediately with binary plists) pipe it through plutil.\r\n\r\nMeasurements demonstrating that this gives significant performance improvements are attached to PUP-1455.","closed_at":"2021-11-04T12:47:41.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5505","labels":"","state":"Closed","updated_at":"2021-11-04T12:47:41.000-0700","timestamp":1652286623.836389,"priority":"Normal","status_category":"Done","pull_request":4447},{"issue_id":"114329","title":"Fix problematic usage of ENV for Windows","url":"https://tickets.puppetlabs.com/browse/PUP-5768","created_at":"2016-01-28T14:50:16.000-0800","number":"PUP-5768","body":"As part of PUP-5726, Windows API calls for retrieving / setting environment variables were added.  This was done to work around a Ruby {{ENV}} bug https://bugs.ruby-lang.org/issues/8822 that corrupts UTF8 characters set in the environment (as keys or values) that don't map cleanly to the local codepage.  While this was allegedly fixed in Ruby 2.3.0, it has not yet been backported or scheduled for backport.\r\n\r\nTherefore, the {{withenv}} helper was updated to not use Rubys {{ENV}}, and to instead use the API calls.\r\n\r\nHowever, there are a number of places where ENV is accessed and modified that may also trigger corruption issues.\r\n\r\nThis ticket should cover:\r\n\r\n* Finding other danger spots in the code - for instance access through {{ENV}} of  {{PATH}} and {{HOME}} have risks of being problematic, but {{SYSTEMROOT}}, {{PATHEXT}}, {{windir}} and {{COMSPEC}} should be safe to ignore due to the low likelihood of these values containing Unicode characters.  {{ENV}} usage inside tests can also generally be ignored, as problems running specs would likely only manifest on a non-English Windows install with a username that includes Unicode chars, that has a Unicode path as a home dir.\r\n** One way to synthetically trigger failures would be to insert a Unicode value into {{PATH}} like {{c:\\ᚠ}} or similarly set {{HOME}}\r\n* Potentially adding a cross-platform wrapper for setting / reading env vars (that delegates to {{ENV}} for POSIX and calls Windows APIs otherwise)\r\n* Replace Windows specific {{ENV}} access where there is danger \r\n* Finding danger spots in other modules by auditing the forge / notifying authors where appropriate (probably best done in another ticket)\r\n\r\nI've grepped through all of the code, and have narrowed the problematic spots (covering the first point), down to:\r\n\r\n{noformat}\r\nC:\\source\\puppet\\lib\\puppet\\defaults.rb:\r\n  236:           ENV[\"PATH\"] = \"\" if ENV[\"PATH\"].nil?\r\n  237:           ENV[\"PATH\"] = value unless value == \"none\"\r\n  238:           paths = ENV[\"PATH\"].split(File::PATH_SEPARATOR)\r\n  239            Puppet::Util::Platform.default_paths.each do |path|\r\n  240:             ENV[\"PATH\"] += File::PATH_SEPARATOR + path unless paths.include?(path)\r\n\r\nC:\\source\\puppet\\lib\\puppet\\util.rb:\r\n  201:       ENV['PATH'].split(File::PATH_SEPARATOR).each do |dir|\r\n  202          begin\r\n  ...\r\n  208:           if e.to_s =~ /HOME/ and (ENV['HOME'].nil? || ENV['HOME'] == \"\")\r\n  209              # if we get here they have a tilde in their PATH.  We'll issue a single warning about this and then\r\n\r\nC:\\source\\puppet\\lib\\puppet\\file_system\\uniquefile.rb:\r\n  159:       for dir in [ENV['TMPDIR'], ENV['TMP'], ENV['TEMP'], @@systmpdir, '/tmp']\r\n  160          if dir and stat = File.stat(dir) and stat.directory? and stat.writable?\r\n\r\nC:\\source\\puppet\\lib\\puppet\\node\\environment.rb:\r\n  451    def self.extralibs()\r\n  452:     if ENV[\"PUPPETLIB\"]\r\n  453:       split_path(ENV[\"PUPPETLIB\"])\r\n\r\nC:\\source\\puppet\\lib\\puppet\\test\\test_helper.rb:\r\n  124:       $old_env = ENV.to_hash\r\n  125  \r\n  ...\r\n  176        # faster to use the compare-then-set model to avoid excessive work that it\r\n  177        # justifies the complexity.  --daniel 2012-03-15\r\n  178:       unless ENV.to_hash == $old_env\r\n  179:         ENV.clear\r\n  180:         $old_env.each {|k, v| ENV[k] = v }\r\n\r\nC:\\source\\puppet\\spec\\unit\\util\\run_mode_spec.rb:\r\n  276    def without_env(name, &block)\r\n  277:     saved = ENV[name]\r\n  278:     ENV.delete name\r\n  279      yield\r\n  280    ensure\r\n  281:     ENV[name] = saved\r\n  282    end\r\n{noformat}","closed_at":"2021-11-11T11:30:14.000-0800","comments":13,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5768","labels":"i18n;utf-8;windows","state":"Closed","updated_at":"2021-11-11T11:30:14.000-0800","timestamp":1652286638.329348,"priority":"Normal","status_category":"Done","pull_request":4764},{"issue_id":"178530","title":"Avoid excessive type inference when checking instance_of?","url":"https://tickets.puppetlabs.com/browse/PUP-7301","created_at":"2017-03-04T00:31:24.000-0800","number":"PUP-7301","body":"The type of an instance is often inferred when checking if it is instance of a Pcore type. I.e:\r\n{code}\r\nt.instance_of?(o)\r\n{code}\r\ncan be written as:\r\n{code}\r\nt.assignable?(<inferred type of o>)\r\n{code}\r\nWhile this makes the instance check very simple and elegant, inferring a type can be very expensive in terms of CPU. Especially if the {{o}} is a large data structure. This means that inferring the type should not be done unless there's a real need for it. Consider the case where {{t}} is the type {{Scalar}} and {{o}} is a huge hash. There's no need to infer the type of {{o}} since it's already a known fact that a hash isn't a scalar.\r\n\r\nIn addition to the {{Scalar}} example, there are a couple of similar low hanging fruits that needs to be fixed in the Pcore type system.\r\n\r\nThe problem became very apparent in 4.9.x where the type of loaded Hiera data hashes is asserted. See PUP-7294 for more info.\r\n","closed_at":"2021-11-11T11:54:35.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7301","labels":"flanders-ss","state":"Closed","updated_at":"2021-11-11T11:54:35.000-0800","timestamp":1652286638.544865,"priority":"Critical","status_category":"Done","pull_request":5687},{"issue_id":"65158","title":"Noop changes to file ownership generate failures if required User or Group does not exist","url":"https://tickets.puppetlabs.com/browse/PUP-3907","created_at":"2015-01-23T12:11:42.000-0800","number":"PUP-3907","body":"If a noop run contains File resources, and those resources have pending changes for User or Group ownership, the run will show failures if those User or Group resources don't exist yet.\r\n\r\nh2. Reproduction Case\r\n\r\n- Create the following manifest:\r\n\r\n{code:puppet}\r\n# noop_test.pp\r\nfile {'/tmp/usertest':\r\n  ensure => present,\r\n  owner => testuser,\r\n}\r\n\r\nfile {'/tmp/grouptest':\r\n  ensure => present,\r\n  group => testgroup,\r\n}\r\n\r\nuser{'testuser':\r\n  ensure => present,\r\n}\r\n\r\ngroup{'testgroup':\r\n  ensure => present,\r\n}\r\n{code}\r\n\r\nCreate the test file:\r\n\r\n{code:bash}\r\ntouch /tmp/usertest\r\ntouch /tmp/grouptest\r\n{code}\r\n\r\nh3. Outcome\r\n\r\nA noop application produces errors:\r\n\r\n{noformat}\r\n# puppet apply --noop noop_test.pp\r\n\r\nNotice: Compiled catalog for poss-head-master.puppetdebug.vlan in environment production in 1.87 seconds\r\nNotice: /Stage[main]/Main/User[testuser]/ensure: current_value absent, should be present (noop)\r\nError: Could not find user testuser\r\nError: /Stage[main]/Main/File[/tmp/usertest]/owner: change from root to testuser failed: Could not find user testuser\r\nNotice: /Stage[main]/Main/Group[testgroup]/ensure: current_value absent, should be present (noop)\r\nError: Could not find group testgroup\r\nError: /Stage[main]/Main/File[/tmp/grouptest]/group: change from root to testgroup failed: Could not find group testgroup\r\nNotice: Applied catalog in 0.08 seconds\r\n{noformat}\r\n\r\nh3. Expected Outcome\r\n\r\nThe noop run notes that the values _would_ be changed but doesn't produce an error. The error should only happen if Users or Groups are missing when Puppet enforces the change.\r\n","closed_at":"2021-11-19T08:30:14.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3907","labels":"noop","state":"Resolved","updated_at":"2021-11-19T08:30:14.000-0800","timestamp":1652286639.27779,"priority":"Normal","status_category":"Done","pull_request":8814},{"issue_id":"418030","title":"Puppet creates excessive numbers of Pathname instances","url":"https://tickets.puppetlabs.com/browse/PUP-11312","created_at":"2021-10-01T09:42:53.000-0700","number":"PUP-11312","body":"There are a few different places where we make excessive numbers of Pathname objects and resulting Strings:\r\n\r\n1. Most of Puppet's FileSystem methods make two copies of their string arguments. Once to create the Pathname instance (via assert_path) and another when ruby's File.xxx method calls {{Pathname#to_path}} to get the original string back.\r\n\r\n2. Some of Puppet's FileSystem implementation, eg {{Windows#replace_file}}, methods call \"back out\" to {{Puppet::FileSystem.replace_file}}, which makes another copy of Pathname instead of using the existing instance.\r\n\r\n3. {{Checker4_0#namespace_for_file(file)}} creates N Pathname instances (one for each module path directory in the environment) for each file argument. And then calls {{Pathname#cleanpath}} and  {{Pathname#relative_path_from}}, both of which resolve each path component, e.g. \"/a/b/c/d/etc\" is copied to \"/a/b/c/d\", \"/a/b/c\", \"/a/b\", \"/a\", \"\". The mapping of {{file}} to {{namespace}} is cached in the environment, but if you have M files in an environment, then we get N * M Pathname instances and N * M * P string copies.\r\n\r\n4. {{PathNamePattern}} calls {{Pathname.each_filename}} to determine if any path component contains {{..}}. That ends up calling {{Pathname#chop_basename}}. We should just call {{String.split}}. It also calls {{Pathname#to_s}} multiple times during validation.","closed_at":"2021-11-19T08:32:29.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11312","labels":"","state":"Resolved","updated_at":"2021-11-19T08:32:29.000-0800","timestamp":1652286639.381949,"priority":"Normal","status_category":"Done","pull_request":8787},{"issue_id":"183334","title":"Fix code that rely on incorrect SemanticPuppet::VersionRange prerelease behavior","url":"https://tickets.puppetlabs.com/browse/PUP-7410","created_at":"2017-03-30T05:28:20.000-0700","number":"PUP-7410","body":"Several tests related to the {{PSemverType}} relies on the fact that the {{SemanticPuppet::VersionRange}} includes pre-release versions in ranges although the range doesn't explicitly state this. These tests must be adjusted before Puppet can be upgraded to use a semantic_puppet gem where PUP-6373 has been fixed.","closed_at":"2021-11-19T11:06:11.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7410","labels":"","state":"Closed","updated_at":"2021-11-19T11:06:11.000-0800","timestamp":1652286639.597627,"priority":"Normal","status_category":"Done","pull_request":5776},{"issue_id":"406447","title":"Don't change current working directory when listing modules","url":"https://tickets.puppetlabs.com/browse/PUP-11166","created_at":"2021-07-08T16:54:21.000-0700","number":"PUP-11166","body":"When listing modules by path, puppet changes the current working directory unnecessarily. This was first reported in PUP-9997, but broken out here into a separate issue:\r\n{code:ruby}def modules_by_path\r\n    modules_by_path = {}\r\n    modulepath.each do |path|\r\n      if Puppet::FileSystem.exist?(path)\r\n        Dir.chdir(path) do\r\n          module_names = Dir.entries(path).select do |name|\r\n            Puppet::Module.is_module_directory?(name, path)\r\n          end\r\n          modules_by_path[path] = module_names.sort.map do |name|\r\n            Puppet::Module.new(name, File.join(path, name), self)\r\n          end\r\n        end\r\n      else\r\n        modules_by_path[path] = []\r\n      end\r\n    end\r\n    modules_by_path\r\n  end\r\n{code}","closed_at":"2021-11-30T02:48:23.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11166","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-11-30T02:48:23.000-0800","timestamp":1652286639.915463,"priority":"Normal","status_category":"Done","pull_request":8687},{"issue_id":"422993","title":"Puppet::FileSystem.chmod doesn't validate its arguments like other FS methods","url":"https://tickets.puppetlabs.com/browse/PUP-11345","created_at":"2021-11-09T16:48:59.000-0800","number":"PUP-11345","body":"{{Puppet::FileSystem}} methods generally assert that they are passed either a {{String}} or {{Pathname}} and raise {{ArgumentError}} if that isn't the case. For example:\r\n\r\n{noformat}\r\nirb(main):009:0> Puppet::FileSystem.mkpath(nil)\r\n...\r\nArgumentError (FileSystem implementation expected Pathname, got: 'NilClass')\r\n{noformat}\r\n\r\nHowever, {{Puppet::FileSystem.chmod}} raises an unhelpful {{TypeError}} trying to convert nil to a String:\r\n\r\n{noformat}\r\nirb(main):007:0> Puppet::FileSystem.chmod(0644, nil)\r\n...\r\nTypeError (no implicit conversion of nil into String)\r\n{noformat}\r\n\r\nThe {{chmod}} method should raise {{ArgumentError}} like the other methods","closed_at":"2021-12-07T19:46:59.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11345","labels":"docs_reviewed","state":"Resolved","updated_at":"2021-12-07T19:46:59.000-0800","timestamp":1652286643.629369,"priority":"Normal","status_category":"Done","pull_request":8810},{"issue_id":"419320","title":"puppet code merger should use concat not plus","url":"https://tickets.puppetlabs.com/browse/PUP-11318","created_at":"2021-10-12T08:35:41.000-0700","number":"PUP-11318","body":"lib/puppet/pops/parser/code_merger.rb calls Array#+ which makes an unnecessary copy of parse results. It should call Array#flat_map instead.","closed_at":"2021-12-07T20:09:47.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11318","labels":"docs_reviewed","state":"Resolved","updated_at":"2021-12-07T20:09:47.000-0800","timestamp":1652286643.733007,"priority":"Normal","status_category":"Done","pull_request":8792},{"issue_id":"395282","title":"Plans apply function collides with resource types that have apply attribute","url":"https://tickets.puppetlabs.com/browse/PUP-11315","created_at":"2021-04-13T17:46:08.000-0700","number":"PUP-11315","body":"When using apply function in a Bolt as well as Puppet plan, it conflicts with a resource type that is having *apply* as an attribute. \r\n\r\nWays to reproduce:\r\n\r\nFinding a module *augeasproviders_sysctl* who has a resource type *sysctl* that has *apply* as an attribute.\r\n\r\nPlans with the following content will fail:\r\n{code:java}plan plans::test (\r\n  TargetSpec $targets = \"localhost\"\r\n) {\r\n#  out::message(\"Hello from plans::test\")\r\n#  $command_result = run_command('whoami', $targets)$targets.apply_prep$apply_results = apply($targets)\r\n{\r\n$shmmax_size = 184467440\r\n      \r\nsysctl{ 'kernel.shmmax':\r\n        apply => false,\r\n        ensure => present,\r\n        value => $shmmax_size,\r\n      }\r\n}\r\n}{code}\r\nWith errors:\r\n{code:java}Syntax error at 'apply' (file: /root/boltProjects/43878/plans/plans/test.pp, line: 21, column: 8){code}\r\nIf we comment out the `apply` line within the resource type, it is working without an error.\r\n\r\nHowever, directly running *bolt apply* _doesn't_ trigger the issue.\r\n{code:java}root@puppetmom manifests]# cat server.pp\r\n$shmmax_size = 184467440\r\nsysctl{ 'kernel.shmmax':\r\nensure => present,\r\napply => false,\r\nvalue => $shmmax_size,\r\n}\r\n\r\n[root@puppetmom manifests]# bolt apply server.pp --targets localhost\r\nStarting: install puppet and gather facts on localhost\r\nFinished: install puppet and gather facts with 0 failures in 12.94 sec\r\nStarting: apply catalog on localhost\r\nStarted on localhost...\r\nFinished on localhost:\r\n  Notice: /Stage[main]/Main/Sysctl[kernel.shmmax]/value: changed configuration value from '' to '184467440'\r\n  changed: 1, failed: 0, unchanged: 0 skipped: 0, noop: 0\r\nFinished: apply catalog with 0 failures in 15.31 sec\r\nSuccessful on 1 node: localhost\r\nRan on 1 node in 28.41 sec\r\n\r\n[root@puppetmom manifests]# cat /etc/sysctl.conf\r\n# sysctl settings are defined through files in\r\n# /usr/lib/sysctl.d/, /run/sysctl.d/, and /etc/sysctl.d/.\r\n#\r\n# Vendors settings live in /usr/lib/sysctl.d/.\r\n# To override a whole file, create a new file with the same in\r\n# /etc/sysctl.d/ and put new settings there. To override\r\n# only specific settings, add a file with a lexically later\r\n# name in /etc/sysctl.d/ and put new settings there.\r\n#\r\n# For more information, see sysctl.conf(5) and sysctl.d(5).\r\nkernel.shmmax = 184467440 {code}\r\nIt looks like the inline function apply within a plan is conflicting with the keyword *apply* in a manifest.","closed_at":"2021-12-07T20:15:26.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11315","labels":"docs_reviewed;jira_escalated","state":"Resolved","updated_at":"2021-12-07T20:15:26.000-0800","timestamp":1652286643.836618,"priority":"Normal","status_category":"Done","pull_request":8781},{"issue_id":"387911","title":"Puppet is trying to execute /etc/init.d/rc{0..6}.d directories","url":"https://tickets.puppetlabs.com/browse/PUP-11313","created_at":"2021-02-18T05:32:18.000-0800","number":"PUP-11313","body":"*Puppet Version: 5.5.22*\r\n *Puppet Server Version: 5.3.7*\r\n *OS Name/Version: SLES 12 SP5*\r\n\r\nRunning *puppet agent -t* results in multiple error messages in /var/log/messages which state the following:\r\n\r\nCould not execute posix command: Permission denied - /etc/init.d/rc0.d\r\n\r\nRunning puppet in debug mode gives the following hint:\r\n\r\n*Debug: Executing: '/etc/init.d/rc0.d status'*\r\n\r\nThese files have 755 permissions, owner is root and are part of the *insserv-compat* package.\r\n\r\n \r\n\r\n*Desired Behavior:*\r\n\r\n*Not having these error messages*\r\n\r\n ","closed_at":"2021-12-07T20:18:47.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11313","labels":"community;docs_reviewed;needs_repro","state":"Resolved","updated_at":"2021-12-07T20:18:47.000-0800","timestamp":1652286643.940363,"priority":"Normal","status_category":"Done","pull_request":8779},{"issue_id":"414011","title":"Reduce allocated memory in `lib/puppet/pops/parser/lexer2.rb`","url":"https://tickets.puppetlabs.com/browse/PUP-11236","created_at":"2021-09-01T05:51:42.000-0700","number":"PUP-11236","body":"PUP-11232 added *# frozen_string_literal: true* to some high memory consumption files but even after that, [lib/puppet/pops/parser/lexer2.rb|https://github.com/puppetlabs/puppet/blob/6.x/lib/puppet/pops/parser/lexer2.rb] still seems to have the most memory allocated.\r\n\r\nProposed investigation direction as stated by [~josh]:\r\n{panel}\r\nI'm guessing the lexer2 allocations are due to the closure scope bound to each [lambda|https://github.com/puppetlabs/puppet/blob/6.x/lib/puppet/pops/parser/lexer2.rb#L187-L580]? I'm thinking Ruby may be doing more work than is necessary to create the Binding as each token is scanned and the corresponding lambda is called? Or perhaps it's the [byteslice|https://github.com/puppetlabs/puppet/blob/6.x/lib/puppet/pops/parser/lexer2.rb#L197] calls?\r\n{panel}\r\n\r\n\r\n\r\n","closed_at":"2021-12-07T20:42:14.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11236","labels":"docs_reviewed","state":"Resolved","updated_at":"2021-12-07T20:42:14.000-0800","timestamp":1652286644.043511,"priority":"Normal","status_category":"Done","pull_request":8797},{"issue_id":"418025","title":"Reduce memory usage from Pathname absolute?","url":"https://tickets.puppetlabs.com/browse/PUP-11311","created_at":"2021-10-01T09:06:49.000-0700","number":"PUP-11311","body":"Pathname.absolute?('/a/b/c/etc') makes recursively smaller copies of the path, e.g. '/a/b/c', '/a/b', '/a', '', which leads to excessive numbers of temporary strings. Pathname was fixed upstream and that was included in ruby 3.0, but it would be good to apply the same to our 2.x builds:\r\n\r\nSee https://github.com/ruby/ruby/commit/39312cf4d6c2ab3f07d688ad1a467c8f84b58db0\r\n\r\n ","closed_at":"2021-12-07T20:42:32.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11311","labels":"docs_reviewed","state":"Resolved","updated_at":"2021-12-07T20:42:32.000-0800","timestamp":1652286644.148724,"priority":"Normal","status_category":"Done","pull_request":8776},{"issue_id":"413995","title":"versioncmp() thinks 11.0 is greater than 11","url":"https://tickets.puppetlabs.com/browse/PUP-11235","created_at":"2021-09-01T01:47:31.000-0700","number":"PUP-11235","body":"*Puppet Version:* 6.24.0\r\n*Puppet Server Version:* none\r\n*OS Name/Version:* Debian 11\r\n\r\nwhile debugging https://github.com/puppetlabs/puppetlabs-apache/pull/2186 i noticed that versioncmp('11.0', '11') doesn't return 0, it returns 1. Is that expected?\r\n\r\n*Desired Behavior:*\r\n\r\nI think 11.0 and 11 should be treated as equal\r\n\r\n*Actual Behavior:*\r\n\r\nversioncmp() thinks 11.0 is greater than 11\r\n\r\nto debug:\r\n{code}\r\nnotify { \"operatingsystemrelease compared to 11: ${versioncmp($::operatingsystemrelease, '11')}\":\r\n}\r\nnotify { \"operatingsystemmajrelease compared to 11: ${versioncmp($::operatingsystemmajrelease, '11')}\":\r\n}\r\nnotify { \"operatingsystemrelease: ${::operatingsystemrelease}\":\r\n}\r\nnotify { \"operatingsystemmajrelease: ${::operatingsystemrelease}\":\r\n}\r\n{code}\r\n\r\nwhich brings us:\r\n{code}\r\npuppet apply test.pp\r\nNotice: Compiled catalog for blal in environment production in 0.02 seconds\r\nNotice: operatingsystemrelease compared to 11: 1\r\nNotice: /Stage[main]/Main/Notify[operatingsystemrelease compared to 11: 1]/message: defined 'message' as 'operatingsystemrelease compared to 11: 1'\r\nNotice: operatingsystemmajrelease compared to 11: 0\r\nNotice: /Stage[main]/Main/Notify[operatingsystemmajrelease compared to 11: 0]/message: defined 'message' as 'operatingsystemmajrelease compared to 11: 0'\r\nNotice: operatingsystemrelease: 11.0\r\nNotice: /Stage[main]/Main/Notify[operatingsystemrelease: 11.0]/message: defined 'message' as 'operatingsystemrelease: 11.0'\r\nNotice: operatingsystemmajrelease: 11.0\r\nNotice: /Stage[main]/Main/Notify[operatingsystemmajrelease: 11.0]/message: defined 'message' as 'operatingsystemmajrelease: 11.0'\r\nNotice: Applied catalog in 0.01 seconds\r\n{code}\r\n\r\nand the facts:\r\n{code}\r\n:~> facter operatingsystemmajrelease\r\n11\r\n:~> facter operatingsystemrelease\r\n11.0\r\n{code}\r\n","closed_at":"2021-12-07T20:45:17.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11235","labels":"docs_reviewed;help_wanted","state":"Resolved","updated_at":"2021-12-07T20:45:17.000-0800","timestamp":1652286644.2532,"priority":"Normal","status_category":"Done","pull_request":8773},{"issue_id":"411148","title":"puppet lookup --facts {filename} fails if filename does not contain a dot","url":"https://tickets.puppetlabs.com/browse/PUP-11204","created_at":"2021-08-09T07:41:38.000-0700","number":"PUP-11204","body":"Calling:\r\n{code:java}\r\npuppet lookup --facts dummy keyX\r\nError: Could not parse application options: undefined method `[]' for nil:NilClass\r\n{code}\r\nFails because the code that verifies the filename expects, that the filename contains a dot:\r\n{code:java}\r\n  option('--facts FACT_FILE') do |arg|\r\n    if %w{.yaml .yml .json}.include?(arg.match(/\\.[^.]*$/)[0])\r\n      options[:fact_file] = arg\r\n    else\r\n      raise _(\"The --fact file only accepts yaml and json files.\\n%{run_help}\") % { run_help: RUN_HELP }\r\n    end\r\n  end\r\n{code}\r\nAlso, verifying based on the filename that the file contains json/yaml data is not correct in my opinion. In my opinion, the following should also be supported:\r\n{code:java}\r\npuppet lookup --facts <(puppet facts find $nodename | jq .values) --node $nodename keyX\r\n{code}","closed_at":"2021-12-08T08:14:46.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11204","labels":"docs_reviewed","state":"Resolved","updated_at":"2021-12-08T08:14:46.000-0800","timestamp":1652286644.356558,"priority":"Normal","status_category":"Done","pull_request":8784},{"issue_id":"356460","title":"facts provided in a file cannot be used for classification","url":"https://tickets.puppetlabs.com/browse/PUP-10435","created_at":"2020-04-22T17:49:27.000-0700","number":"PUP-10435","body":"If a facts file is provided to puppet lookup, then its contents are merged to the node's facts after classification, which means the lookup may be occur in the wrong environment.\r\n\r\nIt would be more consistent if lookup retrieved facts using the facts terminus, merged the facts file, and submitted the facts in the node request.","closed_at":"2021-12-08T08:18:39.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10435","labels":"docs_reviewed","state":"Resolved","updated_at":"2021-12-08T08:18:39.000-0800","timestamp":1652286644.460135,"priority":"Normal","status_category":"Done","pull_request":8786},{"issue_id":"224769","title":"Verify trusted facts are overridden consistently","url":"https://tickets.puppetlabs.com/browse/PUP-8220","created_at":"2017-11-30T01:25:58.000-0800","number":"PUP-8220","body":"The handling of trusted facts in the lookup CLI is somewhat unclear. In this ticket we need to discuss and decide on how it should handle trusted information and if something needs to change.\r\n\r\nSee background in PUP-7507.","closed_at":"2021-12-08T08:24:08.000-0800","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8220","labels":"docs_reviewed","state":"Resolved","updated_at":"2021-12-08T08:24:08.000-0800","timestamp":1652286644.565932,"priority":"Normal","status_category":"Done","pull_request":8800},{"issue_id":"114746","title":"Filenames in recursive directories appear to be shell expanded","url":"https://tickets.puppetlabs.com/browse/PUP-5800","created_at":"2016-02-01T14:37:24.000-0800","number":"PUP-5800","body":"When a file in a directory used as a source for a recursive file resource starts with a {{\\~}}, then it's evaluated as a username. I didn't check to see if other patterns expand. This is a real edge case, except that some editors save backup files with a prepended {{\\~}}.\r\n\r\n{code}\r\nroot@ip-172-31-8-159:~ # puppet apply test.pp\r\nNotice: Compiled catalog for puppetfactory.puppetlabs.vm in environment production in 0.03 seconds\r\nNotice: /Stage[main]/Main/File[/tmp/test]/ensure: created\r\nError: Could not set 'file' on ensure: user bar.txt20160201-23101-1o0dulq doesn't exist\r\nError: Could not set 'file' on ensure: user bar.txt20160201-23101-1o0dulq doesn't exist\r\nWrapped exception:\r\nuser bar.txt20160201-23101-1o0dulq doesn't exist\r\nError: /Stage[main]/Main/File[/tmp/test/~bar.txt]/ensure: change from absent to file failed: Could not set 'file' on ensure: user bar.txt20160201-23101-1o0dulq doesn't exist\r\nNotice: Applied catalog in 0.28 seconds\r\nroot@ip-172-31-8-159:~ # cat test.pp\r\nfile { '/tmp/test':\r\n  ensure  => directory,\r\n  recurse => true,\r\n  source  => '/root/foo',\r\n}\r\n\r\nroot@ip-172-31-8-159:~ # ls foo/\r\n~bar.txt\r\n{code}\r\n","closed_at":"2021-12-08T08:33:57.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5800","labels":"docs_reviewed","state":"Resolved","updated_at":"2021-12-08T08:33:57.000-0800","timestamp":1652286644.671118,"priority":"Normal","status_category":"Done","pull_request":8824},{"issue_id":"23952","title":"Puppet hangs trying to replace a FIFO","url":"https://tickets.puppetlabs.com/browse/PUP-1460","created_at":"2014-01-17T01:06:47.000-0800","number":"PUP-1460","body":"Puppet does some stupid things trying to replace a FIFO, including opening it and trying to MD5 the content.\r\n\r\nThis allows a DoS for any managed file that can be replaced with a disconnected FIFO, at least.\r\n\r\nTo reproduce:\r\n{noformat}\r\nmkfifo /tmp/boom\r\npuppet apply <<EOT\r\nfile { \"/tmp/boom\": ensure => file, content => \"Hello, World\" }\r\nEOT\r\n{noformat}","closed_at":"2021-12-08T08:41:31.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-1460","labels":"docs_reviewed;redmine","state":"Resolved","updated_at":"2021-12-08T08:41:31.000-0800","timestamp":1652286644.775668,"priority":"Normal","status_category":"Done","pull_request":8820},{"issue_id":"405068","title":"Puppet type 'user' does not honor 'purge_ssh_keys: false'","url":"https://tickets.puppetlabs.com/browse/PUP-11131","created_at":"2021-06-29T07:01:54.000-0700","number":"PUP-11131","body":"It seems that the type {{user}} does not honor setting {{purge_ssh_keys => false}} correctly.\r\n\r\npuppet language:\r\n{code:config}\r\nuser { \"myuser\":\r\n  ensure => present,\r\n  [...]\r\n  purge_ssh_keys => false,\r\n}\r\n{code}\r\n\r\nleads to the following warning:\r\n{code:log}\r\n/Stage[main]/Mymodule/Mymodule::Mydefinedtype[myuser]/User[myuser] (warning): Ssh_authorized_key type is not available. Cannot purge SSH keys.\r\n{code}\r\n\r\n\r\nDiving into the code, this seems logical: https://github.com/puppetlabs/puppet/blob/main/lib/puppet/type/user.rb#L698\r\n\r\n{{self[:purge_ssh_keys]}} may take values {{:true}}, {{:false}} and {{[\"string1\", \"string2\"]}}, but\r\n{code:ruby}\r\nirb(main):001:0> foo = :false\r\nirb(main):002:0> foo.empty?\r\n=> false\r\nirb(main):003:1* if !foo.empty?\r\nirb(main):004:1*   puts \"something wrong here\"\r\nirb(main):005:0> end\r\nsomething wrong here\r\n=> nil\r\n{code}\r\n\r\nI'd recommend the following patch to fix this:\r\n{code:ruby}\r\n--- /opt/puppetlabs/puppet/lib64/ruby/vendor_ruby/puppet/type/user.rb\t2021-06-29 14:56:58.756944173 +0200\r\n+++ /tmp/user.rb\t2021-06-29 14:56:35.920004027 +0200\r\n@@ -695,7 +695,7 @@\r\n     end\r\n \r\n     def generate\r\n-      if !self[:purge_ssh_keys].empty?\r\n+      if !self[:purge_ssh_keys].empty? && !(self[:purge_ssh_keys] == :false)\r\n         return [] if self[:ensure] == :present && !provider.exists? \r\n         if Puppet::Type.type(:ssh_authorized_key).nil?\r\n           warning _(\"Ssh_authorized_key type is not available. Cannot purge SSH keys.\")\r\n{code}","closed_at":"2021-12-08T16:57:45.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11131","labels":"doc-reviewed","state":"Resolved","updated_at":"2021-12-08T16:57:45.000-0800","timestamp":1652286644.986995,"priority":"Normal","status_category":"Done","pull_request":8667},{"issue_id":"147251","title":"purge_ssh_keys parameter requires home to be set in the manifest","url":"https://tickets.puppetlabs.com/browse/PUP-10506","created_at":"2016-08-15T13:00:43.000-0700","number":"PUP-10506","body":"If you try to manage a user using puppet and set purge_ssh_keys option to true, it fails unless the user has home directory set in the manifest. For example:\r\n\r\n{noformat}\r\n  user { 'root':\r\n    purge_ssh_keys => true,\r\n  }\r\n{noformat}\r\n\r\nExpected result:\r\n\r\nKeys are purged.\r\n\r\nActual result:\r\n\r\n{color:red}Failed to apply catalog: Parameter purge_ssh_keys failed on User[root]: Munging failed for value true in class purge_ssh_keys: purge_ssh_keys can only be true for users with a defined home directory at PATH_TO_MANIFEST_HERE{color}","closed_at":"2021-12-08T16:59:07.000-0800","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10506","labels":"doc_reviewed;purge_ssh_keys;ssh_authorized_key;user","state":"Resolved","updated_at":"2021-12-08T16:59:07.000-0800","timestamp":1652286645.091081,"priority":"Normal","status_category":"Done","pull_request":8157},{"issue_id":"399645","title":"Specifying purge_ssh_keys parameter for non-existing user errors out","url":"https://tickets.puppetlabs.com/browse/PUP-11067","created_at":"2021-05-15T05:16:40.000-0700","number":"PUP-11067","body":"*Puppet Version:* 7.6.1\r\n*Puppet Server Version:* N/A - reproducible via local {{puppet apply}}\r\n*OS Name/Version:* Ubuntu 20.04 (LTS \"Focal\")\r\n\r\n----\r\n\r\nA {{user}} resource, with {{purge_ssh_keys}} parameter provided as either {{true}} or as an array of paths results in a \"Failed to apply catalog\" error, if the user account does not previously exist.\r\n\r\n{code:bash}\r\n$ puppet apply -e 'user { \"test123\": ensure => present, purge_ssh_keys => true, }' --noop\r\n{code}\r\n\r\n\r\n*Desired Behavior:*\r\n\r\nUser account is created, with SSH keys as provided.\r\nSSH key purging for user is enforced following creation.\r\n\r\n*Actual Behavior:*\r\n\r\n{noformat}\r\nNotice: Compiled catalog for host.example.com in environment production in 0.02 seconds\r\nError: Parameter purge_ssh_keys failed on User[test123]: Munging failed for value true in class purge_ssh_keys: user test123 doesn't exist (line: 1)\r\n{noformat}","closed_at":"2021-12-08T16:59:07.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11067","labels":"community;docs-reviewed","state":"Resolved","updated_at":"2021-12-08T16:59:07.000-0800","timestamp":1652286645.196058,"priority":"Normal","status_category":"Done","pull_request":8610},{"issue_id":"419684","title":"Regression on user resource","url":"https://tickets.puppetlabs.com/browse/PUP-11320","created_at":"2021-10-15T05:29:11.000-0700","number":"PUP-11320","body":"*Puppet Version: 7.8.0 6.23.0 6.24.0 6.24.1 6.25.1*\r\n *Puppet Server Version:* -\r\n *OS Name/Version: RHEL 7 RHEL 8 CENTOS 7 CENTOS 8*\r\n\r\nThe user resource is not working as expected since puppet agent 6.23/7.8.\r\n\r\nDuring a puppet run, if a user is created by any utility (package / exec), the puppet user resource try to luseradd the same user instead of lusermod as the user already exists.\r\n\r\n \r\n\r\nThe following code:\r\n{code}\r\nexec { '/sbin/luseradd -u 50080 -M myuser': }\r\n-> user { 'myuser':\r\n  uid        => 50081,\r\n  forcelocal => true,\r\n}\r\n{code}\r\nproduce an error on user resource\r\n\r\n*Desired Behavior:*\r\n before version 6.23\r\n{code}\r\nNotice: /Stage[main]/Main/Exec[/sbin/luseradd -u 50080 -M myuser]/returns: executed successfully\r\nNotice: /Stage[main]/Main/User[myuser]/uid: uid changed '50080' to 50081\r\n{code}\r\n \r\n\r\n*Actual Behavior:*\r\n version 6.23 and after\r\n{code}\r\nNotice: /Stage[main]/Main/Exec[/sbin/luseradd -u 50080 -M myuser]/returns: executed successfully\r\nError: Could not create user myuser: Execution of '/usr/sbin/luseradd -g myuser -u 50081 -M myuser' returned 3: Account creation failed: entry already present in file.\r\nError: /Stage[main]/Main/User[myuser]/ensure: change from 'absent' to 'present' failed: Could not create user myuser: Execution of '/usr/sbin/luseradd -g myuser -u 50081 -M myuser' returned 3: Account creation failed: entry already present in file.\r\n{code}\r\nSeem regression introduced by https://tickets.puppetlabs.com/browse/PUP-11067\r\n\r\nseems puppet 7.9 has fixed default behavior with https://tickets.puppetlabs.com/browse/PUP-11131 but not done on puppet 6. \r\n\r\nwith:\r\n{code:java}\r\n-      if !self[:purge_ssh_keys].empty?\r\n+     if !self[:purge_ssh_keys].empty? && self[:purge_ssh_keys] != :false\r\n           return [] if self[:ensure] == :present && !provider.exists?\r\n{code}\r\n \r\n\r\n(I don't see exactly the link between the regression and this purge_ssh_keys setting, but changing this, is fixing it)\r\n\r\nBut if the purge_ssh_keys is set to true, it is not working anymore even in puppet 7.12 agent...\r\n{code}\r\nexec { '/sbin/luseradd -u 50080 -M myuser': }\r\n-> user { 'myuser':\r\n  uid            => 50081,\r\n  forcelocal     => true,\r\n  purge_ssh_keys => true,\r\n}\r\n{code}\r\n\r\n{code}\r\nNotice: /Stage[main]/Main/Exec[/sbin/luseradd -u 50080 -M myuser]/returns: executed successfully\r\nError: Could not create user myuser: Execution of '/usr/sbin/luseradd -g myuser -u 50081 -M myuser' returned 3: Account creation failed: entry already present in file.\r\nError: /Stage[main]/Main/User[myuser]/ensure: change from 'absent' to 'present' failed: Could not create user myuser: Execution of '/usr/sbin/luseradd -g myuser -u 50081 -M myuser' returned 3: Account creation failed: entry already present in file.\r\n\r\n{code}","closed_at":"2021-12-14T09:58:48.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11320","labels":"docs_reviewed","state":"Resolved","updated_at":"2021-12-14T09:58:48.000-0800","timestamp":1652286646.667883,"priority":"Normal","status_category":"Done","pull_request":8847},{"issue_id":"419688","title":"Warning: #<Puppet::Transaction::Persistence since upgrade to puppet-agent 6.25.0","url":"https://tickets.puppetlabs.com/browse/PUP-11321","created_at":"2021-10-15T05:57:49.000-0700","number":"PUP-11321","body":"*Puppet Version:* 6.25.0\r\n *Puppet Server Version:* 6.0.10\r\n *OS Name/Version:* Debian GNU/Linux 11 (bullseye)\r\n\r\nSince puppet-agent has been upgraded from 6.24.0, we get warnings on nodes using a specific configuration involving [cataphract/yaml_settings|https://forge.puppet.com/modules/cataphract/yaml_settings] wrapped by [trepasi/cassandra|https://forge.puppet.com/modules/trepasi/cassandra].\r\n\r\n*Desired Behavior:* work without warnings\r\n\r\n*Actual Behavior:* while the catalog is applied properly, warnings are raised for every hash key passed to the values parameter of yaml_settings resource stating a type cast issue.\r\n\r\nExample:\r\n\r\nNode manifest includes a {{contain cassandra}} and gets parameter via Hiera:\r\n{code:yaml}cassandra::config:\r\n  listen_address: \"%{facts.networking.ip}\"\r\n  broadcast_rpc_address: \"%{facts.networking.ip}\"\r\n  rpc_address: 0.0.0.0\r\n  num_tokens: 256\r\n  auto_bootstrap: true\r\n  cluster_name: \"Test Cassandra %{facts.mam_stage}\"\r\n  endpoint_snitch: GossipingPropertyFileSnitch\r\n  authenticator: PasswordAuthenticator\r\n  authorizer: CassandraAuthorizer\r\n  seed_provider:\r\n    - class_name: org.apache.cassandra.locator.SimpleSeedProvider\r\n      parameters:\r\n        - seeds: 10.90.21.10,10.90.18.238\r\n  diagnostic_events_enabled: true\r\n{code}\r\nOutput of {{puppet agent --test}} on a node includes the warnings:\r\n{code:console}Warning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0] contains a hash with an Array key. It will be converted to the String '[\"listen_address\"]'\r\nWarning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0] contains a hash with an Array key. It will be converted to the String '[\"broadcast_rpc_address\"]'\r\nWarning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0] contains a hash with an Array key. It will be converted to the String '[\"rpc_address\"]'\r\nWarning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0] contains a hash with an Array key. It will be converted to the String '[\"num_tokens\"]'\r\nWarning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0] contains a hash with an Array key. It will be converted to the String '[\"auto_bootstrap\"]'\r\nWarning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0] contains a hash with an Array key. It will be converted to the String '[\"cluster_name\"]'\r\nWarning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0] contains a hash with an Array key. It will be converted to the String '[\"endpoint_snitch\"]'\r\nWarning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0] contains a hash with an Array key. It will be converted to the String '[\"authenticator\"]'\r\nWarning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0] contains a hash with an Array key. It will be converted to the String '[\"authorizer\"]'\r\nWarning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0] contains a hash with an Array key. It will be converted to the String '[\"seed_provider\"]'\r\nWarning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0]['resources']['Yaml_settings[cassandra::config]']['parameters']['values']['system_value'][0] contains a hash with an Array key. It will be converted to the String '[\"diagnostic_events_enabled\"]'\r\n{code}\r\nDebug and trace options does not unveil more relevant information.\r\n\r\nContents of the transaction store on the node however changed from:\r\n{code:transactionstore.yaml}  Yaml_settings[cassandra::config]:\r\n    parameters:\r\n      values:\r\n        system_value:\r\n        - ? - listen_address\r\n          : 10.90.18.238\r\n          ? - broadcast_rpc_address\r\n          : 10.90.18.238\r\n          ? - rpc_address\r\n          : 0.0.0.0\r\n          ? - num_tokens\r\n          : 256\r\n          ? - auto_bootstrap\r\n          : true\r\n          ? - cluster_name\r\n          : Test Cassandra qa\r\n          ? - endpoint_snitch\r\n          : GossipingPropertyFileSnitch\r\n          ? - authenticator\r\n          : PasswordAuthenticator\r\n          ? - authorizer\r\n          : CassandraAuthorizer\r\n          ? - seed_provider\r\n          : - class_name: org.apache.cassandra.locator.SimpleSeedProvider\r\n              parameters:\r\n              - seeds: 10.90.21.10,10.90.18.238\r\n          ? - diagnostic_events_enabled\r\n          : true\r\n{code}\r\nwith 6.24.0 to:\r\n{code:transactionstore.yaml}  Yaml_settings[cassandra::config]:\r\n    parameters:\r\n      values:\r\n        system_value:\r\n        - '[\"listen_address\"]': 10.90.18.238\r\n          '[\"broadcast_rpc_address\"]': 10.90.18.238\r\n          '[\"rpc_address\"]': 0.0.0.0\r\n          '[\"num_tokens\"]': 256\r\n          '[\"auto_bootstrap\"]': true\r\n          '[\"cluster_name\"]': Test Cassandra qa\r\n          '[\"endpoint_snitch\"]': GossipingPropertyFileSnitch\r\n          '[\"authenticator\"]': PasswordAuthenticator\r\n          '[\"authorizer\"]': CassandraAuthorizer\r\n          '[\"seed_provider\"]':\r\n          - class_name: org.apache.cassandra.locator.SimpleSeedProvider\r\n            parameters:\r\n            - seeds: 10.90.21.10,10.90.18.238\r\n          '[\"diagnostic_events_enabled\"]': true\r\n{code}\r\nwith 6.25.0, which is the only change on the node.\r\n\r\nThings need to be clarified:\r\n * is this an actual issue involving a poor usage pattern\r\n * could this lead to a future issue\r\n * could the warnings be suppressed if not relevant\r\n\r\n ","closed_at":"2021-12-16T12:45:51.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11321","labels":"docs_reviewed;jira_escalated","state":"Resolved","updated_at":"2021-12-16T12:45:51.000-0800","timestamp":1652286646.775911,"priority":"Normal","status_category":"Done","pull_request":8828},{"issue_id":"421154","title":"Puppet agent may download all plugins after updating","url":"https://tickets.puppetlabs.com/browse/PUP-11328","created_at":"2021-10-25T15:35:19.000-0700","number":"PUP-11328","body":"When using a server-specified environment, the agent will re-download all of its plugins after updating to 6.25.0 or 7.12.0. This occurs, because the agent cannot determine what the last server-specified environment was. So it will:\r\n\r\n* fallback to \"production\"\r\n* download plugins from \"production\"\r\n* request a catalog from \"production\"\r\n* be redirected to the original environment\r\n* download plugins from the original environment\r\n* request a catalog from the original environment\r\n\r\nIf the puppet-agent package on the server is not updated to 6.25/7.12 or later, and the server-specified environment references a fact that doesn't exist in the \"production\" environment, then the \"hop back\" to the original environment will fail as described in PUP-9570.\r\n\r\nTo prevent the agent from redownloading all plugins, the agent should fallback to making a node request if its last run summary does not contain the last server-specified environment.\r\n\r\nThis was originally reported in PUP-11323 and PUP-11327.","closed_at":"2022-01-05T04:46:33.000-0800","comments":21,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11328","labels":"doc-reviewed;needs_repro","state":"Closed","updated_at":"2022-01-05T04:46:33.000-0800","timestamp":1652286657.829956,"priority":"Normal","status_category":"Done","pull_request":8802},{"issue_id":"111071","title":"Add Iterable type and runtime object","url":"https://tickets.puppetlabs.com/browse/PUP-5648","created_at":"2016-01-04T15:53:17.000-0800","number":"PUP-5648","body":"Commit 3a9db247c432d469e625d4abf7bee8e747178af9 regressed support for \"descending\" ranges, where the \"max\" is less than the \"min\":\r\n\r\n{code}\r\nnotice Integer[5, 1]\r\nInteger[5, 1].each |$x| {\r\n  notice $x\r\n}\r\n{code}\r\n\r\nThis is expected to output:\r\n{code}\r\nNotice: Scope(Class[main]): Integer[5, 1]\r\nNotice: Scope(Class[main]): 5\r\nNotice: Scope(Class[main]): 4\r\nNotice: Scope(Class[main]): 3\r\nNotice: Scope(Class[main]): 2\r\nNotice: Scope(Class[main]): 1\r\n{code}\r\n\r\nThis is because having a maximum less than a minimum treats the range as being in \"descending\" order.\r\n\r\nInstead, this is the actual output:\r\n{code}\r\nNotice: Scope(Class[main]): Integer[1, 5]\r\nNotice: Scope(Class[main]): 1\r\nNotice: Scope(Class[main]): 2\r\nNotice: Scope(Class[main]): 3\r\nNotice: Scope(Class[main]): 4\r\nNotice: Scope(Class[main]): 5\r\n{code}\r\n\r\nIt appears the min and max are silently being swapped when the max < min.\r\n\r\nRelated: I believe the compiler should error if a type is given a max argument less than a min argument when the type does not support a \"descending\" semantic, e.g. {{Callable[1, 0]}} should error rather than silently swapping the min and max.","closed_at":"2022-01-05T17:00:43.000-0800","comments":42,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5648","labels":"","state":"Closed","updated_at":"2022-01-05T17:00:43.000-0800","timestamp":1652286657.949677,"priority":"Normal","status_category":"Done","pull_request":4578},{"issue_id":"425101","title":"The pw user provider should support creating system users","url":"https://tickets.puppetlabs.com/browse/PUP-11369","created_at":"2021-11-28T13:19:05.000-0800","number":"PUP-11369","body":"When managing users with system=true, the pw provider should restrict uid / gid to system users.","closed_at":"2022-01-10T07:36:49.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11369","labels":"","state":"Needs Information","updated_at":"2022-01-10T07:36:49.000-0800","timestamp":1652286658.372235,"priority":"Normal","status_category":"To Do","pull_request":8827},{"issue_id":"69478","title":"Failed to generate additional resources using 'eval_generate': Cannot manage files of type socket","url":"https://tickets.puppetlabs.com/browse/PUP-4045","created_at":"2015-02-26T01:58:41.000-0800","number":"PUP-4045","body":"Using a slightly modified version of the code from \"Pro Puppet\" I am getting the following error:\r\n\r\n{code}\r\n    Jun 13 01:36:33 media puppet-agent[18196]: (/Stage[main]/Mysql::Config/File[mysql_data_dir]) Failed to generate additional resources using 'eval_generate': Cannot manage files of type socket\r\n{code}\r\n\r\nThe file resource in mysql/manifests/config.pp is as follows: \r\n\r\n{code}\r\n    file { \"mysql_data_dir\" :\r\n        path => $mysql::params::data_directory,\r\n        group => \"mysql\",\r\n        owner => \"mysql\",\r\n        recurse => true,\r\n        require => File[\"my.cnf\"],\r\n    }\r\n{code}\r\n\r\nAnd for this particular $operatingsystem (Fedora) the value for $data_directory in mysql/manifests/params.pp is :\r\n\r\n{code}\r\n    $data_directory = \"/var/lib/mysql\"\r\n{code}\r\n\r\nBy default mysql on a Fedora system places its mysql.sock file in the data directory but it appears when a you try and change the permissions recursively, puppet doesn't know what to do with the socket file. \r\n\r\nI can place the socket file elsewhere as a work around but I believe that puppet needs to ignore socket files when changing permissions. \r\n\r\n{code}\r\n    [root@media modules]# puppet --version\r\n    2.6.8\r\n    [root@media modules]# puppet master --version\r\n    2.6.8\r\n{code}\r\n","closed_at":"2022-01-11T20:15:26.000-0800","comments":7,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4045","labels":"customer;docs_reviewed;jira_escalated;redmine","state":"Resolved","updated_at":"2022-01-11T20:15:26.000-0800","timestamp":1652286658.9128,"priority":"Normal","status_category":"Done","pull_request":8821},{"issue_id":"124108","title":"Circular type aliases are not handled gracefully.","url":"https://tickets.puppetlabs.com/browse/PUP-6108","created_at":"2016-03-29T14:50:58.000-0700","number":"PUP-6108","body":"The following code:\r\n\r\n{code}\r\ntype Foo = Bar\r\ntype Bar = Foo\r\n0 =~ Bar\r\n{code}\r\n\r\nproduces:\r\n\r\n{code}\r\nError: Could not run: stack level too deep\r\n{code}\r\n\r\nExpected an error message saying that type {{Bar}} cannot be resolved due to a circular reference.\r\n\r\nAlso reproduced with a self-reference:\r\n\r\n{code}\r\ntype Foo = Foo\r\n0 =~ Foo\r\n{code}\r\n\r\nACCEPTANCE CRITERIA\r\n----\r\n* That a circular type alias does not cause an out of stack error\r\n* That the error message identifies at least one of the involved types in the circularity in the error message","closed_at":"2022-01-12T20:58:34.000-0800","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6108","labels":"","state":"Closed","updated_at":"2022-01-12T20:58:34.000-0800","timestamp":1652286659.768378,"priority":"Normal","status_category":"Done","pull_request":4822},{"issue_id":"313541","title":"Merge of lookup_options not working","url":"https://tickets.puppetlabs.com/browse/PUP-9792","created_at":"2019-06-21T04:09:02.000-0700","number":"PUP-9792","body":"*Puppet Version: 5.5.14*\r\n *Puppet Server Version: 5.3.8*\r\n *OS Name/Version: RHEL 7.x*\r\n\r\nIn our Hiera data, we have made use of lookup_options to control the merge behaviour, so in our catch-all common.yaml there are entries such as:\r\n{noformat}---\r\nlookup_options:\r\n  profile::autofs::mounts:\r\n    merge: hash {noformat}\r\nThis works as desired. However we have some exceptions where we want to override this on a per-role basis back to the original \"first\" behaviour, so as we have a higher priority role level, I added the following in a role/foo.yaml:\r\n{noformat}---\r\nlookup_options:\r\n  profile::autofs::mounts:\r\n    merge: first {noformat}\r\nIf I use the \"puppet lookup\" command against the correct host, this appears to work as desired, using `--explain-options` I get the following result:\r\n{noformat}  Merged result: {\r\n    \"profile::autofs::mounts\" => {\r\n      \"merge\" => \"first\"\r\n    }\r\n  }{noformat}\r\nFor any other hosts I still get the behaviour defined at the common level:\r\n{noformat}  Merged result: {\r\n    \"profile::autofs::mounts\" => {\r\n      \"merge\" => \"hash\"\r\n    }\r\n  } {noformat}\r\nAll good. However this doesn't seem to actually apply to the lookup itself:\r\n{noformat}Using merge options from \"lookup_options\" hash\r\nSearching for \"profile::autofs::mounts\"  Merge strategy hash\r\n  ... {noformat}\r\nIt only ever picks up the behaviour defined at the common level.\r\n\r\n*Desired Behavior:*\r\n\r\nI would expect to see:\r\n{noformat}Using merge options from \"lookup_options\" hash\r\nSearching for \"profile::autofs::mounts\"  ... {noformat}\r\ni.e. (no merge strategy displayed here)\r\n\r\n*Actual Behavior:*\r\n\r\nOne bit of information that might be relevant is that in order for our lookups to work from the CLI, I have to use the --compile option, so basically something like:\r\n{noformat}puppet lookup --compile --environment <env> --node <node> profile::autofs::mounts --explain(-options){noformat}\r\nWe have multiple backends/levels configured in Hiera, a mix of YAML/eYAML and using the HTTP backend too.\r\n\r\n \r\n\r\nI noticed there was PUP-7037 which was raised for similar behaviour but was ultimately traced to a typo. I'm confident this isn't down to a typo.\r\n\r\n \r\n\r\nEdit: After a bit more experimenting, I was a bit confused about where \"hash\" should be printed vs other merge strategies, the 'Using merge options from \"lookup_options\" hash' is pretty much a fixed string, it's the presence/lack of \"Merge strategy ...\" that is the identifier.","closed_at":"2022-01-12T22:03:09.000-0800","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9792","labels":"","state":"Accepted","updated_at":"2022-01-12T22:03:09.000-0800","timestamp":1652286659.886191,"priority":"Normal","status_category":"To Do","pull_request":7726},{"issue_id":"341077","title":"Failure to fetch node definition may result in bad pluginsync and cascading failure","url":"https://tickets.puppetlabs.com/browse/PUP-10216","created_at":"2020-01-03T14:11:31.000-0800","number":"PUP-10216","body":"*Puppet Version:* all\r\n\r\nEarly on in the agent run process, Puppet calls an indirector to choose an environment to pluginsync against. If _anything_ goes wrong with that call, pretty much anything at all, Puppet will *pluginsync against the agent-configured environment* (usually \"production\") and spit out a warning.\r\n{code}Warning: Unable to fetch my node definition, but the agent run will continue{code}\r\n \r\n\r\n*Desired Behavior:*\r\n\r\nPuppet should pluginsync against the *last-used environment*, or alternatively, *fail fast*. At customer sites where \"production\" is not used, pluginsyncing against what is probably an empty environment has been observed to add ten minutes+ of time to a Puppet agent run, as it first deletes all of its plugins, and then has to re-sync them fresh from the correct environment after it switches over. This can negatively affect the delivery of changes that need to be performed within a change control window.\r\n\r\n*Actual Behavior:*\r\n\r\nPuppet pluginsyncs against *production*, or the environment value set with {{--environment}} or in puppet.conf.\r\n\r\n \r\n\r\n*Reproduction:*\r\n * Create an environment \"r1\" and \"production\"\r\n * Pin a test agent to \"r1\"\r\n * Edit /etc/puppetlabs/puppetserver/conf.d/auth.conf to disallow the test agent from requesting the /puppet/v3/node path\r\n * Run {{puppet agent}} -t on the test agent\r\n\r\nThe agent will produce the expected error, pluginsync against production, retrieve a catalog, switch to r1, pluginsync against r1, retrieve a catalog, and apply it.\r\n\r\nThe kind of problem this can cause may be made clearly evident if you supply a fact in environment r1 that is needed to compile an r1 catalog. See below.\r\n{code:java}\r\n[root@pe-xl-compiler-2 ~]# puppet agent -t\r\nWarning: Unable to fetch my node definition, but the agent run will continue:\r\nWarning: Error 403 on SERVER: Forbidden request: /puppet/v3/node/pe-xl-compiler-2.dev36.puppet.vm (method :get). Please see the server logs for details.\r\nInfo: Retrieving pluginfacts\r\nNotice: /File[/opt/puppetlabs/puppet/cache/facts.d/r1.txt]/ensure: removed\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Loading facts\r\nError: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Function Call, Fact r1_fact does not exist! (file: /etc/puppetlabs/code/environments/r1/manifests/site.pp, line: 29, column: 5) on node pe-xl-compiler-2.dev36.puppet.vm\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\n{code}\r\nSpecifying r1 with the environment flag mitigates the issue, and demonstrates what a better behavior might look like when this problem occurs.\r\n{code:java}\r\n[root@pe-xl-compiler-2 ~]# puppet agent -t --environment=r1\r\nWarning: Unable to fetch my node definition, but the agent run will continue:\r\nWarning: Error 403 on SERVER: Forbidden request: /puppet/v3/node/pe-xl-compiler-2.dev36.puppet.vm (method :get). Please see the server logs for details.\r\nInfo: Retrieving pluginfacts\r\nNotice: /File[/opt/puppetlabs/puppet/cache/facts.d/r1.txt]/ensure: defined content as '{md5}13b8114b76258d0104dd0568b031361d'\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Loading facts\r\nInfo: Caching catalog for pe-xl-compiler-2.dev36.puppet.vm\r\nInfo: Applying configuration version 'pe-xl-core-0-r1-bb4c21dbce5'\r\nNotice: Applied catalog in 14.23 seconds  {code}","closed_at":"2022-01-17T17:42:05.000-0800","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10216","labels":"doc-reviewed;jira_escalated","state":"Resolved","updated_at":"2022-01-17T17:42:05.000-0800","timestamp":1652286661.701275,"priority":"Normal","status_category":"Done","pull_request":8691},{"issue_id":"147771","title":"Information Disclosure - Puppet Server Stacktraces","url":"https://tickets.puppetlabs.com/browse/PUP-6659","created_at":"2016-08-18T06:25:05.000-0700","number":"PUP-6659","body":"The new Puppet Server 2.5 and Puppet 4.6 now provide way too much information when a server side error occurs.  The new {{Could not retrieve catalog from remote server: Error 500 on SERVER: }} now prints a JSON object of the entire server side stacktrace, which leads to information disclosure (ref [CERT Secure Coding|https://www.securecoding.cert.org/confluence/display/java/ERR01-J.+Do+not+allow+exceptions+to+expose+sensitive+information]).  This message object contains the original error message, but it also contains the full stacktrace.  \r\n\r\nPuppet Server shouldn't expose the stacktrace.  ","closed_at":"2022-01-18T06:53:31.000-0800","comments":12,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6659","labels":"","state":"Closed","updated_at":"2022-01-18T06:53:31.000-0800","timestamp":1652286662.34984,"priority":"Normal","status_category":"Done","pull_request":5237},{"issue_id":"406565","title":"Add RHEL9 support for services","url":"https://tickets.puppetlabs.com/browse/PUP-11168","created_at":"2021-07-12T12:29:52.000-0700","number":"PUP-11168","body":"*Puppet Version:*\r\npuppet-7.8.0\r\n\r\n*Puppet Server Version:*\r\n*OS Name/Version:*\r\n\r\nCentOS Stream 9\r\n\r\nDescribe your issue in as much detail as possible…\r\n\r\nUsing the service provider results in chkconfig being used instead of systemd. This is similar to the steps we had to do for PUP-9069\r\n\r\nDescribe steps to reproduce…\r\n\r\nUse the service provider to manage a service.\r\n\r\n*Desired Behavior:*\r\n\r\nsystemd provider is used\r\n\r\n*Actual Behavior:*\r\n\r\nchkconfig provider is used\r\n\r\n*Example*\r\nhttps://github.com/openstack/puppet-pacemaker/blob/master/manifests/service.pp#L60-L66\r\n\r\nResults in:\r\n\r\n<13>Jul 12 19:00:39 puppet-user: Error: Could not enable pcsd: Execution of '/sbin/chkconfig --add pcsd' returned 1: error reading information on service pcsd: No such file or directory\r\n<13>Jul 12 19:00:39 puppet-user: Error: /Stage[main]/Pacemaker::Service/Service[pcsd]/ensure: change from 'stopped' to 'running' failed: Could not enable pcsd: Execution of '/sbin/chkconfig --add pcsd' returned 1: error reading information on service pcsd: No such file or directory\r\n\r\n","closed_at":"2022-01-24T04:29:59.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11168","labels":"doc-reviewed","state":"Resolved","updated_at":"2022-01-24T04:29:59.000-0800","timestamp":1652286662.672021,"priority":"Normal","status_category":"Done","pull_request":8694},{"issue_id":"419463","title":"Updated puppet gem and rspec-puppet Failures","url":"https://tickets.puppetlabs.com/browse/PUP-11319","created_at":"2021-10-13T07:16:21.000-0700","number":"PUP-11319","body":"Hi,\r\n\r\nWhen updating the puppet gem from 7.11 --> 7.12, we are now seeing rspec-puppet (via onceover) failures for all Windows related tests:\r\n{code:java}\r\nrole::windows::hyperv: failed\r\n  errors:\r\n    uninitialized constant Puppet::Util::Windows::Service\r\n      factsets: windows-2016-x86_64\r\n{code}\r\nAt a quick glance I didn't find any of our currently used modules using that, but will keep looking for any helpful information to provide.","closed_at":"2022-01-31T11:29:57.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11319","labels":"customer0;doc-reviewed","state":"Resolved","updated_at":"2022-01-31T11:29:57.000-0800","timestamp":1652286664.783637,"priority":"High","status_category":"Done","pull_request":8794},{"issue_id":"432109","title":"Use systemd provider by default in RHEL/CentOS","url":"https://tickets.puppetlabs.com/browse/PUP-11433","created_at":"2022-01-24T04:29:59.000-0800","number":"PUP-11433","body":"Since RHEL7/CentOS7, systemd is used to manage services.\r\n\r\nHowever in RHEL/CentOS, the old \"redhat\" provider is used by default, and the module should be updated when adding support for a new version.\r\n\r\n ","closed_at":"2022-02-01T13:48:58.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11433","labels":"","state":"Needs Information","updated_at":"2022-02-01T13:48:58.000-0800","timestamp":1652286665.104606,"priority":"Normal","status_category":"To Do","pull_request":8862},{"issue_id":"383136","title":"When blocking legacy facts in puppet7, puppet agent run fails to fetch 'operatingsystem' fact","url":"https://tickets.puppetlabs.com/browse/PUP-10853","created_at":"2021-01-13T10:39:39.000-0800","number":"PUP-10853","body":"In puppet 7, when blocking legacy facts, puppet agent run will fail in PE trying to fetch the 'operatingsystem' fact [here|https://github.com/puppetlabs/puppet/blob/main/lib/puppet/provider/service/init.rb#L24] with following error\r\n{code}\r\n# puppet agent -t --debug\r\n...\r\nDebug: Facter: Loading internal facts\r\nDebug: Facter: Loading all internal facts\r\nDebug: Facter: Loading external facts\r\nDebug: Facter: Loading custom facts\r\nDebug: Facter: Loading external facts\r\nDebug: Facter: User query is: [\"operatingsystem\"]\r\nDebug: Facter: Query is operatingsystem\r\nDebug: Facter: Checking query tokens operatingsystem\r\nDebug: Facter: List of resolvable facts: []\r\nDebug: Facter: Resolving facts sequentially\r\nError: Could not autoload puppet/provider/service/init: undefined method `downcase' for nil:NilClass\r\nError: Could not autoload puppet/provider/service/bsd: Could not autoload puppet/provider/service/init: undefined method `downcase' for nil:NilClass\r\nError: Could not autoload puppet/type/service: Could not autoload puppet/provider/service/bsd: Could not autoload puppet/provider/service/init: undefined method `downcase' for nil:NilClass\r\nError: Could not retrieve catalog from remote server: Failed to deserialize Puppet::Resource::Catalog from rich_data_json: Could not autoload puppet/type/service: Could not autoload puppet/provider/service/bsd: Could not autoload puppet/provider/service/init: undefined method `downcase' for nil:NilClass\r\nWrapped exception:\r\nCould not autoload puppet/type/service: Could not autoload puppet/provider/service/bsd: Could not autoload puppet/provider/service/init: undefined method `downcase' for nil:NilClass\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\n...\r\n{code}","closed_at":"2022-02-01T13:59:18.000-0800","comments":8,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10853","labels":"","state":"Accepted","updated_at":"2022-02-01T13:59:18.000-0800","timestamp":1652286665.301495,"priority":"Normal","status_category":"To Do","pull_request":8536},{"issue_id":"380578","title":"Binary, Sensitive, etc deferred results can corrupt the transaction store","url":"https://tickets.puppetlabs.com/browse/PUP-10820","created_at":"2020-12-09T17:03:21.000-0800","number":"PUP-10820","body":"If the result of a deferred function is the desired value for a resource's property, then the agent will save that in the transaction store, causing an error the next time the agent runs. As a result, our ability to report on corrective/intentional change is lost.\r\n\r\nGiven {{site.pp}} containing:\r\n\r\n{code:puppet}\r\nnotify { \"deferred\":\r\n  message => Deferred.new(\"binary_file\", [\"/tmp/binary\"])\r\n}\r\n{code}\r\n\r\nwhere {{/tmp/binary}} contains {{hi\\n}}, the agent evaluates the deferred function correctly:\r\n\r\n{noformat}\r\n[root@keen-lecture ~]# rm -f /opt/puppetlabs/puppet/cache/state/transactionstore.yaml\r\n[root@keen-lecture ~]# rm -f /opt/puppetlabs/puppet/cache/client_data/catalog/$(facter fqdn).json\r\n[root@keen-lecture ~]# puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Loading facts\r\nInfo: Caching catalog for keen-lecture.delivery.puppetlabs.net\r\nInfo: Applying configuration version '1607561363'\r\nNotice: aGkK\r\nNotice: /Stage[main]/Main/Notify[deferred]/message: defined 'message' as Binary(\"aGkK\")\r\nNotice: Applied catalog in 0.01 seconds\r\n{noformat}\r\n\r\nBut the transactionstore contains the raw {{Puppet::Pops::Types::PBinaryType::Binary}} object, not the pcore representation:\r\n\r\n{noformat}\r\n[root@keen-lecture ~]# cat /opt/puppetlabs/puppet/cache/state/transactionstore.yaml\r\n---\r\nresources:\r\n  Notify[deferred]:\r\n    parameters:\r\n      message:\r\n        system_value:\r\n        - !ruby/object:Puppet::Pops::Types::PBinaryType::Binary\r\n          binary_buffer: 'hi\r\n\r\n'\r\n{noformat}\r\n\r\nThe next agent run will generate an error:\r\n\r\n{noformat}\r\n[root@keen-lecture ~]# puppet agent -t\r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Loading facts\r\nInfo: Caching catalog for keen-lecture.delivery.puppetlabs.net\r\nError: Transaction store file /opt/puppetlabs/puppet/cache/state/transactionstore.yaml is corrupt ((/opt/puppetlabs/puppet/cache/state/transactionstore.yaml): Tried to load unspecified class: Puppet::Pops::Types::PBinaryType::Binary); replacing\r\nWrapped exception:\r\nTried to load unspecified class: Puppet::Pops::Types::PBinaryType::Binary\r\nInfo: Applying configuration version '1607561397'\r\nNotice: aGkK\r\nNotice: /Stage[main]/Main/Notify[deferred]/message: defined 'message' as Binary(\"aGkK\")\r\nNotice: Applied catalog in 0.01 seconds\r\n{noformat}\r\n\r\nThis issue doesn't happen if the deferred result is type that YAML natively supports (string, integer, etc).\r\n\r\nPuppet should probably be using {{Puppet::Pops::Serialization::ToDataConverter}} to persist the transactionstore instead of yaml.","closed_at":"2022-02-02T06:48:36.000-0800","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-10820","labels":"doc-reviewed","state":"Resolved","updated_at":"2022-02-02T06:48:36.000-0800","timestamp":1652286665.524726,"priority":"Normal","status_category":"Done","pull_request":8823},{"issue_id":"419718","title":"Excessive copying of already merged code for the main hostclass","url":"https://tickets.puppetlabs.com/browse/PUP-11322","created_at":"2021-10-15T10:29:08.000-0700","number":"PUP-11322","body":"When parsing manifests, we merge the main hostclass' code. Each merge creates a new BlockExpression containing the children from the old and new codes: https://github.com/puppetlabs/puppet/blob/e0ea9a23bc867d337abf6c9d274e46729b058f15/lib/puppet/resource/type.rb#L145\r\n\r\nThis means we're copying the code that has already been merged into {{self}} N times and the array gets bigger each time. The many_modules benchmark creates 100 modules each with 11 manifests and it generates an extra 11MB of allocated memory.\r\n\r\nIt seems like we should be *appending* the new code with the already merged code while preserving the flattening behavior.","closed_at":"2022-02-02T17:05:27.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11322","labels":"","state":"Closed","updated_at":"2022-02-02T17:05:27.000-0800","timestamp":1652286666.274578,"priority":"Normal","status_category":"Done","pull_request":8798},{"issue_id":"170107","title":"Insufficient logging when encountering 'permission denied' on environmentpath","url":"https://tickets.puppetlabs.com/browse/PUP-7102","created_at":"2017-01-13T04:54:29.000-0800","number":"PUP-7102","body":"It seems that when the puppetserver runs into \"permission denied\" when trying to cd into a configured environmentpath, there's no message to be found of that happening in the puppetservers logs, nor does that show in the puppet agent output (it just completes really quickly.\r\n\r\nI understand that there is automatic fallback to the next configured path (seperated by a colon in the config line), or even the default path, but it would be nice if the result of that selection process would get logged into puppetserver log in some way especially when it ran into a access problem on the way, and not \"just\" a non-existing folder.\r\n\r\nPresumably this same problem also exists with other configuration options that allow colons to denote several possible paths to be tried. The lack of detail in the logs makes it harder then necessary to debug a relatively simple problem.","closed_at":"2022-02-07T23:43:59.000-0800","comments":24,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-7102","labels":"","state":"Ready for Engineering","updated_at":"2022-02-07T23:43:59.000-0800","timestamp":1652286677.846955,"priority":"Normal","status_category":"To Do","pull_request":6022},{"issue_id":"155674","title":"Agent cannot compile catalog if it specifies an non-existent environment in puppet.conf even when the classifier is controlling environment","url":"https://tickets.puppetlabs.com/browse/PUP-6802","created_at":"2016-10-07T08:58:39.000-0700","number":"PUP-6802","body":"h1.  The Problem\r\n\r\n{code}\r\n[root@agent201621-centos ~]# puppet agent -t \r\nInfo: Using configured environment 'production'\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for agent201621-centos\r\nInfo: Applying configuration version '1475855527'\r\nNotice: Applied catalog in 0.40 seconds\r\n\r\n[root@agent201621-centos ~]# puppet config set environment fake --section agent\r\n\r\n[root@agent201621-centos ~]# puppet agent -t\r\nWarning: Unable to fetch my node definition, but the agent run will continue:\r\nWarning: Error 400 on SERVER: Could not find environment 'fake'\r\nInfo: Retrieving pluginfacts\r\nError: /File[/opt/puppetlabs/puppet/cache/facts.d]: Failed to generate additional resources using 'eval_generate': Error 400 on SERVER: Could not find environment 'fake'\r\nError: /File[/opt/puppetlabs/puppet/cache/facts.d]: Could not evaluate: Could not retrieve file metadata for puppet:///pluginfacts: Error 400 on SERVER: Could not find environment 'fake'\r\nInfo: Retrieving plugin\r\nError: /File[/opt/puppetlabs/puppet/cache/lib]: Failed to generate additional resources using 'eval_generate': Error 400 on SERVER: Could not find environment 'fake'\r\nError: /File[/opt/puppetlabs/puppet/cache/lib]: Could not evaluate: Could not retrieve file metadata for puppet:///plugins: Error 400 on SERVER: Could not find environment 'fake'\r\nInfo: Loading facts\r\nError: Could not retrieve catalog from remote server: Error 400 on SERVER: Could not find environment 'fake'\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\nError: Could not send report: Error 400 on SERVER: Could not find environment 'fake'\r\n{code}\r\n\r\nNow if I go ahead and make the environment on the master, it'll compile the catalog against the production environment as expected.  \r\n\r\nOn the master: \r\n{code}\r\n[root@master201621-centos ~]# cp -r /etc/puppetlabs/code/environments/production/ /etc/puppetlabs/code/environments/fake\r\n{code}\r\n\r\nNow on the agent:\r\n{code}\r\n[root@agent201621-centos ~]# puppet agent -t\r\nNotice: Local environment: 'fake' doesn't match server specified node environment 'production', switching agent to 'production'.\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for agent201621-centos\r\nInfo: Applying configuration version '1475855805'\r\nNotice: Applied catalog in 0.36 seconds\r\n{code}\r\n\r\nh1.  Expected Behavior\r\n\r\nThe existence of the environment that the agent sets in puppet.conf should not matter if the ENC is controlling the environment.  I expect this message in both cases.  \r\n\r\n{code}\r\nNotice: Local environment: 'fake' doesn't match server specified node environment 'production', switching agent to 'production'.\r\n{code}","closed_at":"2022-02-09T23:58:11.000-0800","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6802","labels":"doc-reviewed;tcse;the-goods","state":"Resolved","updated_at":"2022-02-09T23:58:11.000-0800","timestamp":1652286678.592885,"priority":"Major","status_category":"Done","pull_request":8701},{"issue_id":"295431","title":"Setting certname in multiple sections bypasses validation","url":"https://tickets.puppetlabs.com/browse/PUP-9481","created_at":"2019-02-08T01:43:22.000-0800","number":"PUP-9481","body":"*Puppet Version:* 6.0.5\r\n *Puppet Server Version:* N/A\r\n *OS Name/Version:* Windows Server 2012, CentOS 7\r\n\r\nWhen a config file is created with the certname setting on both the agent and main sections as follows:\r\n{code:java}\r\n[main]\r\ncertname = my-windows-server.puppet.com\r\n[agent]\r\ncertname = MY-WINDOWS-SERVER.puppet.com\r\n{code}\r\nPuppet's validation that certnames must be lowercase if bypassed and allows for very broken certs to be generated\r\n\r\n*Desired Behavior:* Cert generation fails with \"Error: Could not initialize global default settings: Certificate names must be lower case\"\r\n\r\n*Actual Behavior:* Certs are generated with uppercase names\r\n\r\n ","closed_at":"2022-02-15T22:11:24.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9481","labels":"doc_reviewed","state":"Resolved","updated_at":"2022-02-15T22:11:24.000-0800","timestamp":1652286679.109322,"priority":"Normal","status_category":"Done","pull_request":8395},{"issue_id":"214573","title":"Lookup ignores environment from the classifier when using rule with trusted facts","url":"https://tickets.puppetlabs.com/browse/PUP-8094","created_at":"2017-10-04T11:25:32.000-0700","number":"PUP-8094","body":"I have 2 environments, production and acceptance.\r\n\r\nI have an environment group for Acceptance:\r\n\r\n{code}\r\nnode_group { 'Acceptance Environment':\r\n  ensure               => 'present',\r\n  environment          => 'acceptance',\r\n  id                   => '539f71ae-50d3-42f6-8201-289dba160ba5',\r\n  override_environment => 'true',\r\n  parent               => 'Production environment',\r\n  rule                 => ['and',\r\n  ['~',\r\n    ['trusted', 'extensions', 'pp_role'],\r\n    'agent']],\r\n}\r\n{code}\r\n\r\n'Production Environment' node group has not been modified.\r\n\r\nWhen I run puppet agent in a node with pp_role = agent, I confirm that it is using the right environment:\r\n\r\n{code}\r\n[root@10-32-175-131 ~]# puppet agent -t\r\nNotice: Local environment: 'production' doesn't match server specified node environment 'acceptance', switching agent to 'acceptance'.\r\n{code}\r\n\r\nYet when I try to do a lookup for that node, the data retrieved is from Production:\r\n\r\n{code}\r\npuppet lookup --node 10-32-175-131.rfc1918.puppetlabs.net message --explain\r\nSearching for \"message\"\r\n  Global Data Provider (hiera configuration version 5)\r\n    Using configuration \"/etc/puppetlabs/puppet/hiera.yaml\"\r\n    Hierarchy entry \"Classifier Configuration Data\"\r\n      No such key: \"message\"\r\n  Environment Data Provider (hiera configuration version 5)\r\n    Using configuration \"/etc/puppetlabs/code/environments/production/hiera.yaml\"\r\n    Hierarchy entry \"Per-node data\"\r\n{code}\r\n\r\nIf I pin the node to the \"Acceptance Environment\" group, I get the right output for lookup:\r\n\r\n{code}\r\nnode_group { 'Acceptance Environment':\r\n  ensure               => 'present',\r\n  environment          => 'acceptance',\r\n  id                   => '539f71ae-50d3-42f6-8201-289dba160ba5',\r\n  override_environment => 'true',\r\n  parent               => 'Production environment',\r\n  rule                 => ['or',\r\n  ['and',\r\n    ['~',\r\n      ['trusted', 'extensions', 'pp_role'],\r\n      'agent']],\r\n  ['=', 'name', '10-32-175-131.rfc1918.puppetlabs.net']],\r\n}\r\n{code}\r\n\r\n{code}\r\nroot@10-32-175-155.rfc1918.puppetlabs.net /root> puppet lookup --node 10-32-175-131.rfc1918.puppetlabs.net message --explain\r\nSearching for \"message\"\r\n  Global Data Provider (hiera configuration version 5)\r\n    Using configuration \"/etc/puppetlabs/puppet/hiera.yaml\"\r\n    Hierarchy entry \"Classifier Configuration Data\"\r\n      No such key: \"message\"\r\n  Environment Data Provider (hiera configuration version 5)\r\n    Using configuration \"/etc/puppetlabs/code/environments/acceptance/hiera.yaml\"\r\n{code}\r\n\r\nFound the issue in LTS, reproduced in 2017.3.0.\r\n\r\nEDIT: A rule created with an out-of-the-box fact like domain honors the environment. A rule created with a trusted fact defaults to production. A mix of trusted + normal fact, like trusted.extensions.pp_role + domain defaults to production.","closed_at":"2022-02-20T16:32:06.000-0800","comments":30,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-8094","labels":"docs_reviewed","state":"Resolved","updated_at":"2022-02-20T16:32:06.000-0800","timestamp":1652286679.942427,"priority":"Normal","status_category":"Done","pull_request":8819},{"issue_id":"425363","title":"Server with multithreaded enabled hangs after upgrade v6 -> v7","url":"https://tickets.puppetlabs.com/browse/PUP-11373","created_at":"2021-12-01T06:19:08.000-0800","number":"PUP-11373","body":"After upgrading from Puppet v6 to v7, the server hangs after ~10 min of work. More precisely, *there are no free JRuby Instances*. All configs (puppetserver, puppetdb, puppetagent) including resources are absolutely equal between v6 and v7.  We have ~300 agents, the server is configured according to an official guideline. v6 has worked with no issues. \r\n\r\nConfig, environment, thread dump, graphs, and logs are attached. \r\n\r\n[Heapdump is here.|https://drive.google.com/file/d/1STOr8L9YzbzbDGmH8YyiOeUSDuOM6rTR/view?usp=sharing] ","closed_at":"2022-02-22T11:45:04.000-0800","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11373","labels":"docs-reviewed","state":"Resolved","updated_at":"2022-02-22T11:45:04.000-0800","timestamp":1652286680.361512,"priority":"Normal","status_category":"Done","pull_request":8834},{"issue_id":"401491","title":"puppet generate types should return non-zero when types cannot be generated","url":"https://tickets.puppetlabs.com/browse/PUP-11078","created_at":"2021-06-02T16:44:55.000-0700","number":"PUP-11078","body":"When {{puppet generate types}} cannot generate types, it will error, but it explicitly just logs it and keeps going.\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/1a13e0cf96c70b303492e684f9ccf4c38207b3dd/lib/puppet/generate/type.rb#L204-L211\r\n\r\n{code}\r\n[~/.puppetlabs/etc/code/environments/production]$ puppet generate types\r\nNotice: Generating Puppet resource types.\r\nError: /Users/ben/.puppetlabs/etc/code/environments/production/modules/drupal/lib/puppet/type/drupal_module.rb: title patterns that use procs are not supported.\r\nError: /Users/ben/.puppetlabs/etc/code/environments/production/modules/drupal/lib/puppet/type/drupal_theme.rb: title patterns that use procs are not supported.\r\nError: /Users/ben/.puppetlabs/etc/code/environments/production/modules/drupal/lib/puppet/type/drupal_variable.rb: title patterns that use procs are not supported.\r\n[~/.puppetlabs/etc/code/environments/production]$ echo $?\r\n0\r\n{code}\r\n\r\nThis might be so that code manager doesn't fail when code is deployed, but this is certainly not expected. Should there be an option for explicit error codes?","closed_at":"2022-02-22T21:00:36.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11078","labels":"docs-reviewed","state":"Resolved","updated_at":"2022-02-22T21:00:36.000-0800","timestamp":1652286681.188326,"priority":"Normal","status_category":"Done","pull_request":8826},{"issue_id":"428219","title":"puppet lookup --explain fails out of the box starting with 7.13.1","url":"https://tickets.puppetlabs.com/browse/PUP-11402","created_at":"2021-12-29T13:24:21.000-0800","number":"PUP-11402","body":"Starting with Puppet 7.13.1 (as installed via YUM for EL7) `puppet lookup --explain` now fails.\r\n{code:java}\r\n puppet lookup --explain test\r\nError: Failed to initialize SSL: The CA certificates are missing from '/etc/puppetlabs/puppet/ssl/certs/ca.pem'\r\nError: Run `puppet agent -t`\r\nError: Connection to https://puppet:8140/puppet-ca/v1 failed, trying next route: Request to https://puppet:8140/puppet-ca/v1 failed after 0.001 seconds: The CA certificates are missing from '/etc/puppetlabs/puppet/ssl/certs/ca.pem'\r\nWrapped exception:\r\nThe CA certificates are missing from '/etc/puppetlabs/puppet/ssl/certs/ca.pem'\r\nError: Could not run: No more routes to ca{code}\r\n7.12.1 and prior do not have this issue.","closed_at":"2022-02-22T21:01:17.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11402","labels":"docs-reviewed","state":"Resolved","updated_at":"2022-02-22T21:01:17.000-0800","timestamp":1652286681.505377,"priority":"Major","status_category":"Done","pull_request":8855},{"issue_id":"427206","title":"Regression: agent no longer calls local enc script","url":"https://tickets.puppetlabs.com/browse/PUP-11379","created_at":"2021-12-14T08:42:46.000-0800","number":"PUP-11379","body":"As a result of changes made in the environment convergence epic, the agent no longer calls the {{Puppet::Node}} terminus to resolve the environment during the run (before doing pluginsync and the catalog request). If the agent is configured to use a **local** enc, then it will no longer be called.\r\n\r\nSee [~gabriel.nagy] comment in https://tickets.puppetlabs.com/browse/PUP-11328?focusedCommentId=839470&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-839470 for more information.\r\n\r\nWe should re-add this capability with the following notes:\r\n\r\n1. The terminus should only be called when the following is true:\r\n\r\n{code:ruby}\r\n      unless (cached_catalog || options[:catalog] || Puppet[:strict_environment_mode])\r\n{code}\r\n\r\n2. The terminus should only be called if it's overridden from the default.\r\n\r\n3. If the terminus should be called with the same parameters as last time, e.g. transaction_uuid.\r\n\r\n4. If the terminus returns a node, then the agent should use its environment as the \"last known environment\" ignoring what is stored in the last run summary.\r\n\r\n5. If the terminus returns a node whose environment is nil, then I'm not sure. We should check what happened previously.","closed_at":"2022-02-22T21:01:23.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11379","labels":"docs_reviewed","state":"Closed","updated_at":"2022-02-22T21:01:23.000-0800","timestamp":1652286681.607519,"priority":"Normal","status_category":"Done","pull_request":8853},{"issue_id":"421293","title":"Puppet::Node#environment_name may return the wrong value","url":"https://tickets.puppetlabs.com/browse/PUP-11330","created_at":"2021-10-26T17:45:22.000-0700","number":"PUP-11330","body":"If an environment instance is set on a node, then the {{Node#environment_name}} returns nil, but {{Node#environment}} returns the instance whose name is the expected symbolic value:\r\n\r\n{noformat}\r\nirb(main):010:0> node = Puppet::Node.new('hostname')\r\n=> #<Puppet::Node:0x00005582e746c3e0 @name=\"hostname\", @classes=[], @parameters={}, @facts=nil, @server_facts={}, @time...\r\nirb(main):011:0> node.environment = Puppet::Node::Environment.remote('www123')\r\n=> <Puppet::Node::Environment::Remote:7880 @name=\"www123\" @manifest=\"no_manifest\" @modulepath=\"\" >\r\nirb(main):012:0> node.environment_name\r\n=> nil\r\nirb(main):013:0> node.environment.name\r\n=> :www123\r\n{noformat}\r\n\r\nHowever, setting {{environment_name}} on the node *DOES* cause {{Node#environment}} to load that environment (which must exist on disk):\r\n\r\n{noformat}\r\nirb(main):001:0> require 'puppet'\r\n=> true\r\nirb(main):002:0> Puppet.initialize_settings\r\n=> {}\r\nirb(main):003:0> FileUtils.mkdir(File.join(Puppet[:environmentpath], \"www123\"))\r\n=> [\"/home/josh/.puppetlabs/etc/code/environments/www123\"]\r\nirb(main):004:0> run_mode = Puppet::Util::RunMode[:agent]\r\n=> #<Puppet::Util::UnixRunMode:0x00005582e7075520 @name=:agent>\r\nirb(main):005:0> Puppet::ApplicationSupport.push_application_context(run_mode)\r\n=> #<Puppet::Context::Stack:0x00005582e646cc88 ...\r\nirb(main):006:0> node = Puppet::Node.new('hostname')\r\n=> #<Puppet::Node:0x00005582e7152c40 @name=\"hostname\", @classes=[], @parameters={}, @facts=nil, @server_facts={}, @time...\r\nirb(main):007:0> node.environment_name = 'www123'\r\n=> \"www123\"\r\nirb(main):008:0> node.environment_name\r\n=> \"www123\"\r\nirb(main):009:0> node.environment.name\r\n=> :www123\r\n{noformat}\r\n\r\nThis inconsistency leads to complicated logic where we can never be sure how to retrieve the node's environment, while trying to be careful to not load the environment from disk:\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/e89bc9f1e0a9365cb7f0e8b105c04c50a7b43395/lib/puppet/configurer.rb#L313-L317","closed_at":"2022-02-22T21:01:40.000-0800","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11330","labels":"docs_reviewed;tbd","state":"Resolved","updated_at":"2022-02-22T21:01:40.000-0800","timestamp":1652286681.914682,"priority":"Normal","status_category":"Done","pull_request":8842},{"issue_id":"395612","title":"puppet cannot set/change password of a user resource on Big Sur","url":"https://tickets.puppetlabs.com/browse/PUP-11026","created_at":"2021-04-15T06:19:53.000-0700","number":"PUP-11026","body":"Similar changes done for osx 10.15: https://github.com/puppetlabs/puppet/commit/688779d43c770598ca72c83e14b555f342252150","closed_at":"2022-02-23T18:44:29.000-0800","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11026","labels":"docs-reviewed","state":"Resolved","updated_at":"2022-02-23T18:44:29.000-0800","timestamp":1652286683.776405,"priority":"Normal","status_category":"Done","pull_request":8599},{"issue_id":"107312","title":"show_diff does not show content changes for new files","url":"https://tickets.puppetlabs.com/browse/PUP-9001","created_at":"2015-11-30T03:29:34.000-0800","number":"PUP-9001","body":"I searched in jira but did not see a similar issue. \r\nIt was filed in old issue tracker linked here: https://projects.puppetlabs.com/issues/21537\r\n\r\nh2. Overview\r\n\r\nshow_diff does not show diff for files that hasn't been created\r\n\r\nh2. Example\r\n\r\n    file { '/tmp/hahaha/':\r\n        ensure => present,\r\n        content => \"Hello Puppet Labs\",\r\n        show_diff => \"true\",\r\n    }\r\n\r\nh2. Expected behavior\r\n\r\npuppet agent --test --noop will show the diff of the file\r\n\r\nh2. Actual Behaviour\r\n\r\n[root@pe-383-master manifests]# puppet agent --test --noop \r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for pe-383-master.puppetdebug.vlan\r\nInfo: Applying configuration version '1448882931'\r\nNotice: /Stage[main]/Main/Node[default]/File[/tmp/hahaha/]/ensure: current_value absent, should be present (noop)\r\nNotice: Node[default]: Would have triggered 'refresh' from 1 events\r\nNotice: Class[Main]: Would have triggered 'refresh' from 1 events\r\nNotice: Stage[main]: Would have triggered 'refresh' from 1 events\r\nNotice: Finished catalog run in 8.09 seconds\r\n\r\nCustomer KPN Supply is facing this problem and is looking for possible workaround, (to see file content before it got apply)","closed_at":"2022-03-08T14:14:42.000-0800","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9001","labels":"cspapercuts","state":"Closed","updated_at":"2022-03-08T14:14:42.000-0800","timestamp":1652286686.658663,"priority":"Normal","status_category":"Done","pull_request":8890},{"issue_id":"432469","title":"Puppet 6.26 and 7.13 may cause specs to fail","url":"https://tickets.puppetlabs.com/browse/PUP-11435","created_at":"2022-01-25T16:57:10.000-0800","number":"PUP-11435","body":"Commit 78246ca8d08dee770886f0940a6472c45483d627 first released in 6.26.0 and 7.13.0 speeds up rspec tests but breaks puppet-enteprise-modules due to the way {{Facter.reset}} breaks stubbing for a custom fact.\r\n\r\n[https://github.com/puppetlabs/puppet/commit/78246ca8d08dee770886f0940a6472c45483d627]\r\n\r\nThis ticket is to:\r\n\r\n1. Delete the call to {{Facter.reset}} line in [https://github.com/puppetlabs/puppet/blob/4772afa194402a3876069785a178611797a8eb7d/lib/puppet/defaults.rb#L1998]\r\n2. Optional (attempt 1), try adding {{Facter.reset}} to puppet's [spec_helper.rb|https://github.com/puppetlabs/puppet/blob/4772afa194402a3876069785a178611797a8eb7d/sec/spec_helper.rb]. That way the facter search path is reset across tests, but it's only triggered when running puppet's spec tests. But not when a module runs tests and calls puppet as a library.\r\n3. Optional (attempt 2), if attempt 1 doesn't work, try adding {{Facter.reset}} to puppet's [test helper|https://github.com/puppetlabs/puppet/blob/4772afa194402a3876069785a178611797a8eb7d/lib/puppet/test/test_helper.rb#L145-L146] This likely has to be done after the call to {{{}Puppet.runtime[:facter]{}}}. Note this code will be invoked by modules that are using puppetlabs_spec_helper.\r\n4. If neither work, just omit the call to Facter.reset entirely.\r\n5. A more complete fix is to understand why this issue affects PE modules, but not a custom module generated via pdk (see comment below).\r\n\r\nTo reproduce the issue:\r\n{code}\r\n$ git clone git@github.com:puppetlabs/puppet_enterprise_modules\r\n$ cd puppet_enterprise_modules\r\n$ git revert f8ec0e5d9234be99b3566034e921d797fb85ea43\r\n$ PUPPET_VERSION=\"6.26.0\" bundle install --without system_tests \r\n$ cd modules/puppet_enterprise\r\n$ PUPPET_VERSION=\"6.26.0\" bundle exec rake spec SPEC=spec/unit/facter/inventory_spec.rb\r\n...\r\nFailures:  \r\n1) inventory facts the inventory and metadata facts when setting the inventory fact wil be populated when enabled\r\n     Failure/Error: expect(Facter.value('_puppet_inventory_1')).not_to be nil\r\n     \r\n       expected not #<NilClass:8> => nil\r\n                got #<NilClass:8> => nil\r\n     \r\n       Compared using equal?, which compares object identity.\r\n     # ./spec/unit/facter/inventory_spec.rb:77:in `block (4 levels) in <top (required)>'  \r\n2) inventory facts the inventory and metadata facts when setting the metadata fact sets enabled to true if enabled\r\n     Failure/Error: expect(Facter.value('puppet_inventory_metadata')['packages']['collection_enabled']).to be true\r\n     \r\n       expected true\r\n            got false\r\n     # ./spec/unit/facter/inventory_spec.rb:89:in `block (4 levels) in <top (required)>'Finished in 0.16165 seconds (files took 0.97491 seconds to load)\r\n9 examples, 2 failures\r\nFailed examples:\r\nrspec ./spec/unit/facter/inventory_spec.rb:75 # inventory facts the inventory and metadata facts when setting the inventory fact wil be populated when enabled\r\nrspec ./spec/unit/facter/inventory_spec.rb:87 # inventory facts the inventory and metadata facts when setting the metadata fact sets enabled to true if enabled{code}\r\nBut if then if you downgrade to 6.25.1 it works:\r\n{code}$ PUPPET_VERSION=\"6.25.1\" bundle update\r\n...\r\nUsing puppet 6.25.1 (was 6.26.0)\r\n...\r\n$ PUPPET_VERSION=\"6.25.1\" bundle exec rake spec SPEC=spec/unit/facter/inventory_spec.rb\r\n...\r\nFinished in 0.08799 seconds (files took 0.97687 seconds to load)\r\n9 examples, 0 failures\r\n{code}\r\n\r\nIf you go back to 6.26.0 and comment out the {{Facter.reset}} line in defaults.rb it works:\r\n\r\n{code}\r\n$ PUPPET_VERSION=\"6.26.0\" bundle update\r\n$ vi $(PUPPET_VERSION=\"6.26.0\" bundle exec gem which puppet/defaults.rb)\r\n# comment out the call to \"facter.reset\" and it should now pass\r\n$ PUPPET_VERSION=\"6.26.0\" bundle exec rake spec SPEC=spec/unit/facter/inventory_spec.rb\r\n{code}","closed_at":"2022-03-15T10:45:53.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11435","labels":"docs_reviewed","state":"Resolved","updated_at":"2022-03-15T10:45:53.000-0700","timestamp":1652286696.788634,"priority":"Normal","status_category":"Done","pull_request":8875},{"issue_id":"433415","title":"No option to fail fast when agent-specified environment does not exist","url":"https://tickets.puppetlabs.com/browse/PUP-11440","created_at":"2022-01-31T14:18:22.000-0800","number":"PUP-11440","body":"*Puppet Version:*\r\n*Puppet Server Version:*\r\n*OS Name/Version:*\r\n\r\nDescribe your issue in as much detail as possible…\r\nDescribe steps to reproduce…\r\n\r\n*Desired Behavior:*\r\n\r\n\r\n*Actual Behavior:*\r\n\r\n\r\nPlease take a moment and attach any relevant log output and/or manifests. This will help us immensely when troubleshooting the issue.\r\n\r\nExamples:\r\nRun puppet agent with --test --trace --debug\r\n\r\nRelevant sections of {{/var/log/puppetlabs/puppetserver/puppetserver.log}} or any applicable logs from the same directory.\r\n\r\nFor more detailed information turn up the server logs by upping the log level in the server's logback.xml\r\n\r\nRelevant sections of configurations files (puppet.conf, hiera.conf, Server's conf.d, defaults/sysconfig)\r\n\r\nFor memory issues with server heap dumps are also helpful.\r\n","closed_at":"2022-03-15T10:46:12.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11440","labels":"docs_reviewed","state":"Resolved","updated_at":"2022-03-15T10:46:12.000-0700","timestamp":1652286696.893395,"priority":"Normal","status_category":"Done","pull_request":8886},{"issue_id":"436205","title":"Puppet::Util::Windows is undefined on non-Windows platforms","url":"https://tickets.puppetlabs.com/browse/PUP-11459","created_at":"2022-02-17T20:47:18.000-0800","number":"PUP-11459","body":"The file {{lib/puppet/util/windows.rb}} defines a set of constants that should be available on all platforms, such as {{Puppet::Util::Windows}}, {{Puppet::Util::Windows::Service}} and {{Puppet::Util::Windows::Service::DEFAULT_TIMEOUT}}.\r\n\r\nIt also requires Windows-specific code that is only safe to load on Windows, because the code tries to load native libraries, such as {{user32.dll}}.\r\n\r\nThe problem is when puppet is running on a non-Windows platform, then {{lib/puppet/util/windows.rb}} is never loaded. As a result, trying to test a {{service}} resource using rspec-puppet fails when trying to reference the {{Puppet::Util::Windows}} constant. See PDK-1760 for steps to reproduce.\r\n\r\nA quicker reproduction is:\r\n\r\n{code}\r\n$ bundle exec ruby -e \"require 'puppet'; puts Puppet::Util::Windows\"\r\nTraceback (most recent call last):\r\n-e:1:in `<main>': uninitialized constant Puppet::Util::Windows (NameError)\r\n{code}","closed_at":"2022-03-15T10:46:21.000-0700","comments":1,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11459","labels":"docs_reviewed;jira_escalated","state":"Resolved","updated_at":"2022-03-15T10:46:21.000-0700","timestamp":1652286696.997144,"priority":"Normal","status_category":"Done","pull_request":8883},{"issue_id":"432982","title":"puppet lookup fails to interpolate topscope variables when an environment is specified","url":"https://tickets.puppetlabs.com/browse/PUP-11437","created_at":"2022-01-27T16:11:31.000-0800","number":"PUP-11437","body":"A regression introduced in PUP-7479 causes \"puppet lookup --environment <env> <key>\" to no longer set node parameters as topscope variables. If hiera.yaml is configured to interpolate based on topscope variables, such as \"nodes/%\\{fqdn}.yaml\", then the variable will be interpolated as an empty string.\r\n\r\nGiven a basic setup:\r\n{code}# tree /etc/puppetlabs/code/environments/\r\n/etc/puppetlabs/code/environments/\r\n├── production\r\n└── test\r\n    ├── data\r\n    │   ├── common.yaml\r\n    │   └── iron-judgement.yaml\r\n    └── hiera.yaml\r\n\r\n3 directories, 3 files\r\n# cat /etc/puppetlabs/code/environments/test/hiera.yaml \r\n---\r\nversion: 5\r\nhierarchy:\r\n  - name: \"node\"\r\n    paths:\r\n      - \"%{hostname}.yaml\"\r\n  - name: \"common\"\r\n    paths:\r\n      - \"common.yaml\"\r\n# cat /etc/puppetlabs/code/environments/test/data/common.yaml \r\n---\r\nfoo: defined in common\r\n# cat /etc/puppetlabs/code/environments/test/data/iron-judgement.yaml \r\n--- {}\r\n{code}\r\nThen a warning is generated trying to resolve the `hostname` variable:\r\n{code}# bundle exec puppet lookup -E test foo --explain\r\nWarning: Undefined variable 'hostname'; \r\n   (file & line not available)\r\nSearching for \"lookup_options\"\r\n  Global Data Provider (hiera configuration version 5)\r\n    No such key: \"lookup_options\"\r\n  Environment Data Provider (hiera configuration version 5)\r\n    Using configuration \"/etc/puppetlabs/code/environments/test/hiera.yaml\"\r\n    Merge strategy hash\r\n      Hierarchy entry \"node\"\r\n        Path \"/etc/puppetlabs/code/environments/test/data/.yaml\"\r\n          Original path: \"%{hostname}.yaml\"\r\n          Path not found\r\n      Hierarchy entry \"common\"\r\n        Path \"/etc/puppetlabs/code/environments/test/data/common.yaml\"\r\n          Original path: \"common.yaml\"\r\n          No such key: \"lookup_options\"\r\n{code}\r\nNote the path \"/etc/puppetlabs/code/environments/test/data/.yaml\"\r\n\r\nThe issue does not occur when an environment is omitted from the command line or when hiera interpolation uses facts such as \"nodes/%\\{facts.hostname}.yaml\".","closed_at":"2022-03-18T09:00:07.000-0700","comments":5,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11437","labels":"docs_reviewed","state":"Resolved","updated_at":"2022-03-18T09:00:07.000-0700","timestamp":1652286697.620605,"priority":"Normal","status_category":"Done","pull_request":8892},{"issue_id":"147729","title":"Corrective Change YAML file causes errors when type parameter is a complex type","url":"https://tickets.puppetlabs.com/browse/PUP-6629","created_at":"2016-08-17T15:40:55.000-0700","number":"PUP-6629","body":"https://jenkins-modules.puppetlabs.com/view/3.%20windows%20only/view/acl/view/acl%20-%20master/job/forge-windows_puppetlabs-acl_intn-sys_smoke-master/PLATFORM=windows-2008r2-64a,WORKER_LABEL=beaker/20/consoleFull\r\n\r\n{code}\r\n\r\nfile { 'c:/tmp':\r\n  ensure  => directory,\r\n}\r\n\r\nuser { 'bob':\r\n  ensure     => present,\r\n  groups     => 'Users',\r\n  managehome => true,\r\n  password   => \"L0v3Pupp3t!\"\r\n}\r\n\r\nacl { 'c:/tmp':\r\n  permissions  => [\r\n    { identity => 'bob', perm_type => 'allow', rights => ['modify'] },\r\n  ],\r\n}\r\n{code}\r\n\r\nThe permissions property of acl is a hash type. This looks to be killing runs for anyone using acl or another type that has a parameter/property that is a hash type.\r\n\r\nThe contents of the transactionstore.yaml are as so:\r\n\r\n{code}\r\n---\r\nresources:\r\n  File[c:/temp]:\r\n    parameters:\r\n      ensure:\r\n        system_value: :directory\r\n  File[c:/temp/deny_full_rights_dir]:\r\n    parameters:\r\n      ensure:\r\n        system_value: :directory\r\n  User[bob]:\r\n    parameters:\r\n      ensure:\r\n        system_value: :present\r\n      password:\r\n        system_value: L0v3Pupp3t!\r\n      groups:\r\n        system_value: BUILTIN\\Users,Users\r\n  Acl[c:/temp/deny_full_rights_dir]:\r\n    parameters:\r\n      permissions:\r\n        system_value:\r\n        - !ruby/hash:Puppet::Type::Acl::Ace {}\r\n      inherit_parent_permissions:\r\n        system_value: :true\r\n{code}\r\n\r\n","closed_at":"2022-03-23T08:45:51.000-0700","comments":19,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-6629","labels":"regression;windows","state":"Closed","updated_at":"2022-03-23T08:45:51.000-0700","timestamp":1652286698.145142,"priority":"Critical","status_category":"Done","pull_request":5241},{"issue_id":"433034","title":"An iterable returned by tree_each iterator does not work with reduce ","url":"https://tickets.puppetlabs.com/browse/PUP-11438","created_at":"2022-01-28T09:27:07.000-0800","number":"PUP-11438","body":"_tree_each_ function returns an iterator, which is supposed to chain with _revers_each,_ _filter, map_ and _reduce_ according to the [documentation|https://puppet.com/docs/puppet/7/function.html#tree-each|#tree-each]. In practice one of the chained functions, _reduce_ does not work.\r\n\r\nThe minimal code to reproduce with {_}puppet apply{_}:\r\n{code:java}$tree = {}\r\nnotice $tree.tree_each.reduce({}) |$m, $v| { $m } {code}\r\nThis results in an error:\r\n{code:java}Error: Evaluation Error: Error while evaluating a Method call, undefined method `reduce' for #<Puppet::Pops::Types::Iterable::DepthFirstTreeIterator:0x00005653899c8280>\r\nDid you mean?  rescue (file: /srv/production/site/profile/manifests/test.pp, line: 2, column: 30) on node ruthenium-dev{code}\r\n[~josh] ","closed_at":"2022-04-01T15:01:03.000-0700","comments":3,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11438","labels":"","state":"Resolved","updated_at":"2022-04-01T15:01:03.000-0700","timestamp":1652286700.414198,"priority":"Normal","status_category":"Done","pull_request":8871},{"issue_id":"48712","title":"The read_mounts function reads /proc/mounts for every file call and should instead cache.","url":"https://tickets.puppetlabs.com/browse/PUP-3116","created_at":"2014-08-20T13:38:05.000-0700","number":"PUP-3116","body":"During a puppet run, the read_mounts function in util/selinux is called for each file that it managed on the system.\r\n\r\nAs currently implemented, the system will read /proc/mounts for each file.\r\n\r\nWhile initially being unwanted due to unnecessary file IO, certain systems that use namespacing, such as OpenShift, create potentially thousands of redundant mount entries in /proc/mounts (5500 on one system that I've seen).\r\n\r\nThis causes each puppet run to observably crawl to over 30 minutes when normally it runs in 30 seconds.\r\n\r\nI've attached a patch that uses a caching mechanism to alleviate this issue.\r\n\r\n*However*, I'm 90% certain that there is some global space where this can be done instead of using a global variable and I'm hoping that someone that knows this off the top of their head can update the code appropriately.","closed_at":"2022-04-01T17:55:05.000-0700","comments":6,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-3116","labels":"file;jira_escalated;linux;optimization;platform-os;selinux;type_and_provider","state":"Accepted","updated_at":"2022-04-01T17:55:05.000-0700","timestamp":1652286700.723333,"priority":"Major","status_category":"To Do","pull_request":3043},{"issue_id":"81272","title":"Yum provider uses rpm -e to uninstall packages","url":"https://tickets.puppetlabs.com/browse/PUP-4647","created_at":"2015-05-22T03:24:36.000-0700","number":"PUP-4647","body":"{code:puppet}\r\nclass gvpbi::install ($ensure) {\r\n\r\n package {'pdi-gvp-bi-core':\r\n    require => Class['gvpbibase'],\r\n    provider => 'yum',\r\n    install_options => [ '-d5', '-e5' ],\r\n    ensure  => $ensure,\r\n }\r\n package {'pdi-python2.7-numpy':\r\n    require => Class['gvpbibase'],\r\n    provider => 'yum',\r\n    install_options => [ '-d5', '-e5' ],\r\n    ensure  => absent,\r\n    before => Package['pdi-gvp-bi-core'],\r\n }\r\n}\r\n{code}\r\n\r\nbut:\r\n\r\n{noformat}\r\nError: Execution of '/bin/rpm -e pdi-python2.7-numpy-1.8.1-1.x86_64' returned 1: error: Failed dependencies:\r\n\tpdi-python2.7-numpy is needed by (installed) pdi-gvp-bi-core-3.1.0-175.ga7bcd2c.noarch\r\nError: /Stage[main]/Gvpbi::Install/Package[pdi-python2.7-numpy]/ensure: change from 1.8.1-1 to absent failed: Execution of '/bin/rpm -e pdi-python2.7-numpy-1.8.1-1.x86_64' returned 1: error: Failed dependencies:\r\n\tpdi-python2.7-numpy is needed by (installed) pdi-gvp-bi-core-3.1.0-175.ga7bcd2c.noarch\r\n{noformat}\r\n\r\nbut if I remove the package using yum the dependecies are automatically resolved and unistall the pdi-gvp-bi-core package.","closed_at":"2022-04-11T03:31:06.000-0700","comments":9,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-4647","labels":"package;type_and_provider","state":"Closed","updated_at":"2022-04-11T03:31:06.000-0700","timestamp":1652286701.038332,"priority":"Normal","status_category":"Done","pull_request":6329},{"issue_id":"429291","title":"Puppet Agent does not automatically refresh CRLs on crl_refresh_interval","url":"https://tickets.puppetlabs.com/browse/PUP-11428","created_at":"2022-01-11T07:50:06.000-0800","number":"PUP-11428","body":"We have setup our puppet server's with a SubCA issued from our internal root. We have also setup a script to automatically load the Root CRLs into the PuppetServer CRL using the 'puppet-ca/v1/certificate_revocation_list' API endpoint. Finally, we have set crl_refresh_interval = 1d in puppet.conf on all of our agents.\r\n\r\nHowever, the behavior we are seeing is that the CRL is only refreshed when puppet is manually run (eg. using puppet agent --test from a root shell) or if the existing CRL is >1d old the first time puppet runs after the service is restarted. If the puppet agent is just left running (automatic runs every 30 minutes) the CRL is never refreshed and eventually expires.","closed_at":"2022-04-20T09:39:22.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11428","labels":"","state":"Closed","updated_at":"2022-04-20T09:39:22.000-0700","timestamp":1652286701.754307,"priority":"Normal","status_category":"Done","pull_request":8899},{"issue_id":"438698","title":"Yum Provider Does Not Properly Update Package Using Version Range and Install Options","url":"https://tickets.puppetlabs.com/browse/PUP-11475","created_at":"2022-03-08T11:15:25.000-0800","number":"PUP-11475","body":"*Puppet Version:* 7.14.0\r\n*Puppet Server Version:* N/A\r\n*OS Name/Version:* CentOS 7\r\n\r\nThe yum provider does not appear to pass in the install_options (disablerepo, enablerepo, disableexcludes) when listing available packages if a version range is specified\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/7.14.0/lib/puppet/provider/package/yum.rb#L228-L231\r\n\r\n\r\n\r\nWe have a custom / internal repo which has excludes enabled so packages are not updated during normal patching, but use install options to ensure the package is present during initial configurations, and would like to be able to use the version ranges to specify a minimum version to upgrade to when code is changed as well.\r\n\r\n*Desired Behavior:* The provider properly appends the install_options to the yum list command like it does with update and other commands currently\r\n\r\ni.e.\r\n{code:java}\r\n// Pseudo Example\r\nyumrepo { \"myrepofile\":\r\n  ensure  => present,    \r\n  name    => \"myrepofile\",\r\n  descr   => \"myrepofile\",\r\n  baseurl => \"https://my.repo.file\",\r\n  enabled => '1',\r\n  exclude => 'mypackage*',\r\n}\r\n\r\npackage { 'mypackage':\r\n  ensure          => \">=1.2.3\",\r\n  install_options => [     \r\n    {\r\n      '--disableexcludes' => \"myrepofile\"\r\n    },\r\n  ],\r\n}{code}\r\n \r\n{code:java}\r\n/usr/bin/yum list <package> --showduplicates --disableexcludes=<repo> | sed -e '1,/Available Packages/ d' | awk '{print $2}'{code}\r\nSample of where this is currently done during check-update: https://github.com/puppetlabs/puppet/blob/7.14.0/lib/puppet/provider/package/yum.rb#L109-L115\r\n\r\n \r\n\r\n*Actual Behavior:* \r\n\r\nAvailable versions are listed without {_}disablerepo{_}, {_}enablerepo{_}, _disableexcludes_ from _install_options_ that are necessary to properly list all available updates.\r\n\r\n \r\n{code:java}\r\n/usr/bin/yum list <package> --showduplicates | sed -e '1,/Available Packages/ d' | awk '{print $2}'{code}\r\nResulting in no available packages from _myrepofile_ because it is excluded by default\r\n\r\n ","closed_at":"2022-04-25T14:56:51.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11475","labels":"","state":"Closed","updated_at":"2022-04-25T14:56:51.000-0700","timestamp":1652286703.196336,"priority":"Normal","status_category":"Done","pull_request":8895},{"issue_id":"102362","title":"systemd: Puppet agent starts before network-online.target is reached","url":"https://tickets.puppetlabs.com/browse/PUP-5402","created_at":"2015-10-21T02:07:51.000-0700","number":"PUP-5402","body":"On Ubuntu 15.04 the puppet agent starts with multi-user.target.\r\nDue to this if using NetworkManager with DHCP, the agent tries to apply configuration before network connection is up resulting in printing several errors to the logs.\r\n\r\nChanging the puppet.service file and moving the symlink from /etc/systemd/system/multi-user.target.wants/puppet.service to /etc/systemd/system/network-online.target.wants/puppet.service is fixing the problem.\r\n\r\nContent of edited puppet.service file:\r\n\r\n{code:java}\r\n[Unit]\r\nDescription=Puppet agent\r\nWants=network-online.target\r\nAfter=network-online.target\r\n\r\n[Service]\r\nType=forking\r\nPIDFile=/run/puppet/agent.pid\r\nExecStart=/usr/bin/puppet agent\r\n\r\n[Install]\r\nWantedBy=network-online.target\r\n{code}\r\n","closed_at":"2022-04-26T12:15:35.000-0700","comments":10,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-5402","labels":"daemon;packaging;platform-os;systemd","state":"Resolved","updated_at":"2022-04-26T12:15:35.000-0700","timestamp":1652286703.511587,"priority":"Normal","status_category":"Done","pull_request":8893},{"issue_id":"434835","title":"Cannot login under user created by Puppet on MacOS 12.1","url":"https://tickets.puppetlabs.com/browse/PUP-11454","created_at":"2022-02-10T03:52:00.000-0800","number":"PUP-11454","body":"I create a new user using code example from  stdlib docs\r\n{code}$pw = Sensitive.new('Pa55w0rd')\r\n$salt = Sensitive.new('Using s0m3 s@lt')\r\n$pw_info = Sensitive.new(str2saltedpbkdf2($pw, $salt, 50000))\r\nuser { 'jdoe':\r\n  ensure     => present,\r\n  iterations => unwrap($pw_info)['iterations'],\r\n  password   => unwrap($pw_info)['password_hex'],\r\n  salt       => unwrap($pw_info)['salt_hex'],\r\n}\r\n{code}\r\nEverything applies with no error, but I can't login until I change password via system preferences. \r\nSystem:\r\n{code} uname -prsv\r\nDarwin 21.2.0 Darwin Kernel Version 21.2.0: Sun Nov 28 20:28:54 PST 2021; root:xnu-8019.61.5~1/RELEASE_X86_64 i386\r\n{code}\r\nPuppet:\r\n{code}puppet --version\r\n7.14.0\r\n{code}","closed_at":"2022-04-26T19:07:26.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11454","labels":"","state":"Resolved","updated_at":"2022-04-26T19:07:26.000-0700","timestamp":1652286704.125567,"priority":"Normal","status_category":"Done","pull_request":8900},{"issue_id":"434448","title":"puppetserver_gem doesn't install gems when they are loaded by facter","url":"https://tickets.puppetlabs.com/browse/PUP-11452","created_at":"2022-02-07T07:31:09.000-0800","number":"PUP-11452","body":"The {{puppetserver_gem}} package provider fails to list the correct gem list in puppetserver when there is a gem installed with `puppet_gem` and added by a `require` during the agent run or apply. In this scenario, the gem is listed as already installed by the {{puppetserver_gem}} provider when it is not installed in the puppetserver gem space.\r\n\r\n*Logs*\r\nThe gem is only installed into the puppet gem space\r\n{code}# puppetserver gem list aws-sdk-s3\r\n\r\n*** LOCAL GEMS ***\r\n\r\n# /opt/puppetlabs/puppet/bin/gem list aws-sdk-s3\r\n\r\n*** LOCAL GEMS ***\r\n\r\naws-sdk-s3 (1.112.0)\r\n{code}\r\nRunning the agent or apply shows the gem is prefetched in the {{puppetserver_gem}} provider\r\n{code}# puppet apply install.pp --debug |& grep aws-sdk-s3\r\nDebug: /Package[aws-sdk-s3]: Provider puppetserver_gem does not support features targetable; not managing attribute command\r\nDebug: /Package[aws-sdk-s3]: Provider puppetserver_gem does not support features install_only; not managing attribute install_only\r\nDebug: /Package[aws-sdk-s3]: Provider puppetserver_gem does not support features virtual_packages; not managing attribute allow_virtual\r\nDebug: Puppet::Type::Package::ProviderPuppetserver_gem: Prefetched instance: aws-sdk-s3 via command: default\r\n{code}\r\n*Reproduction*\r\n1) On a 7.x Puppetserver - PE 2021.4.0 in this example\r\n2) Install the gem using the `puppet_gem` provider: {{puppet resource package aws-sdk-s3 ensure=installed provider=puppet_gem}}\r\n3) Add the following fact into the environment and ensure it is downloaded with {{puppet plugin download}}\r\n{code}Facter.add(:testing) do\r\n  setcode do\r\n    require 'aws-sdk-s3'\r\n    Aws::S3::GEM_VERSION\r\n  end\r\nend\r\n{code}\r\n4) Apply the following manifest to observe that the {{puppetserver_gem}} package is not installed\r\n{code} package{'aws-sdk-s3':\r\n  ensure => installed,\r\n  provider => puppetserver_gem\r\n}\r\n{code}\r\n*Potential Fix*\r\nThis looks to be an issue due to the {{puppetserver_gem}} not forking the gem list command, so the [loaded gems are listed in these lines|https://github.com/puppetlabs/puppet/blob/main/lib/puppet/provider/package/puppetserver_gem.rb#L162-L170].\r\n\r\nIf I replace those lines with one that uses the {{/opt/puppetlabs/puppet/bin/gem}} command, the issue no longer appears. For example:\r\n{code}output = execute_gem_command(Puppet::Type::Package::ProviderPuppet_gem.provider_command, [\"list\",\"--local\"], gem_env)\r\ngem_list = output.lines.reject { |gem| gem =~ / \\(default\\: / }\r\n{code}\r\nThere is a significant difference in the number of gems listed between the two outputs.\r\n{code}# The current implementation\r\n> sio_out.string.lines.reject { |gem| gem =~ / \\(default\\: / }.length\r\n=> 56\r\n# Shelling out to `gem`\r\n> output.lines.reject { |gem| gem =~ / \\(default\\: / }.length\r\n=> 25\r\n{code}\r\nThis aligns with the `puppetserver gem list` and `gem list` commands.\r\n{code}# /opt/puppetlabs/puppet/bin/gem list |grep -v default | wc -l56# puppetserver gem list |grep -v default | wc -l\r\n25\r\n{code}","closed_at":"2022-04-26T19:08:57.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11452","labels":"jira_escalated","state":"Closed","updated_at":"2022-04-26T19:08:57.000-0700","timestamp":1652286704.231132,"priority":"Normal","status_category":"Done","pull_request":8872},{"issue_id":"283213","title":"Raise Error when a legacy function illegally defines methods","url":"https://tickets.puppetlabs.com/browse/PUP-9294","created_at":"2018-10-31T07:55:07.000-0700","number":"PUP-9294","body":"When a 3.x function .rb file contains calls to `def` they will end up in a place where they are not supposed to be. It is illegal to have such definitions (they used to work in 3.x because they ended up being methods on {{Object}} (i.e. it polluted every class in Ruby which is obviously horrible and unwanted).\r\n\r\nFrom 6.0.0, legacy functions are loaded by a new loader and it should catch these illegal definitions and raise an error instead of causing other hard to understand errors. (Currently the methods are defined, but in a place where the legacy function later cannot find and call them).\r\n\r\nIn the rare case that 3.x functions with illegal constructs are used in such a way that the illegal constructs are only loaded but never called users that want to prevent errors from being raised by the new check can set {{-\\-func3x_check}} to {{false}}.","closed_at":"2022-04-27T09:25:11.000-0700","comments":11,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9294","labels":"resolved-issue-added","state":"Closed","updated_at":"2022-04-27T09:25:11.000-0700","timestamp":1652286710.780704,"priority":"Normal","status_category":"Done","pull_request":7285},{"issue_id":"102767","title":"Compile catalogs on demand with user-specified facts","url":"https://tickets.puppetlabs.com/browse/PUP-9055","created_at":"2015-10-23T12:45:15.000-0700","number":"PUP-9055","body":"puppetserver currently lacks the equivalent of `puppet master --compile <node>`, which can make debugging difficult, particularly when `puppet master --compile` gives you a catalog in a few seconds but `puppet agent --test` hangs until the configtimeout is reached.","closed_at":"2022-05-10T08:51:00.000-0700","comments":25,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-9055","labels":"resolved-issue-added","state":"Resolved","updated_at":"2022-05-10T08:51:00.000-0700","timestamp":1652286713.156166,"priority":"Normal","status_category":"Done","pull_request":7477},{"issue_id":"437580","title":"Legacy function error does not include the source ref","url":"https://tickets.puppetlabs.com/browse/PUP-11472","created_at":"2022-02-28T15:17:45.000-0800","number":"PUP-11472","body":"*Puppet Version:* main\r\n\r\n*Desired Behavior:*\r\n\r\nLegacy function errors should include the source path. For example, if you have a 3x function in module, like \"$codedir/environments/production/modules/sample/lib/puppet/parser/functions/sample.rb\" containing:\r\n\r\n{code:ruby}\r\nmodule Puppet::Parser::Functions\r\n  newfunction(:sample, :type => :rvalue, :doc => <<-EOS\r\n    A function using the 3x API\r\n  EOS\r\n  ) do |arguments|\r\n    \"the returned value\"\r\n  end\r\n\r\n  def method_here_is_illegal()\r\n  end\r\nend\r\n{code}\r\n\r\nThen puppet should return the filename where the legacy function is defined. See PUP-9294 and https://puppet.com/docs/puppet/5.5/functions_legacy.html for information about legacy (3x) function errors.\r\n\r\nFor example, the following should indicate the path and line number of the legacy function:\r\n\r\n{noformat}\r\n$ bundle exec puppet apply -e 'notice(sample(\"\"))'\r\n{noformat}\r\n\r\n*Actual Behavior:*\r\n\r\nNo source path is included, e.g.\r\n\r\n{noformat}\r\nruby_legacy_function_instantiator.rb:97:in `walk': Illegal method definition of method 'initialize' on line 8 in legacy function. See https://puppet.com/docs/puppet/latest/functions_refactor_legacy.html for more information (SecurityError)\r\n{noformat}","closed_at":"2022-05-10T09:18:10.000-0700","comments":2,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11472","labels":"","state":"Resolved","updated_at":"2022-05-10T09:18:10.000-0700","timestamp":1652286713.271165,"priority":"Normal","status_category":"Done","pull_request":8888},{"issue_id":"447479","title":"Sub-directory names returned as task names when listing tasks from a module","url":"https://tickets.puppetlabs.com/browse/PUP-11539","created_at":"2022-05-11T01:42:36.000-0700","number":"PUP-11539","body":"*Puppet Version: 7*\r\n*Puppet Server Version: 7*\r\n*OS Name/Version: any*\r\n\r\nWhen querying puppetserver for a list of tasks, if a module has a sub-directory in its 'tasks' directory, this sub-directory name is incorrectly returned as an available task of the module.\r\n\r\n*Desired Behavior:* The API should only return the actual tasks names{*}{*}{*}{*}\r\n\r\n*Actual Behavior:*\r\n\r\nCreate a sub-directory in the tasks directory of a module ({{{}mkdir /etc/puppetlabs/code/environments/production/site-modules/profile/tasks/foo/{}}}) and query using the API endpoint {{GET /puppet/v3/tasks?environment=production}}\r\n\r\nA _profile::foo_ task is incorrectly listed","closed_at":"2022-05-11T02:12:19.000-0700","comments":0,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11539","labels":"","state":"Open","updated_at":"2022-05-11T02:12:19.000-0700","timestamp":1652286713.711551,"priority":"Normal","status_category":"To Do","pull_request":8910},{"issue_id":"444827","title":"Allow Puppet::HTTP::Client to connect to a server requiring client cert authentication and whose server cert is issued by a CA in the 'ssl_trust_store'","url":"https://tickets.puppetlabs.com/browse/PUP-11522","created_at":"2022-04-26T11:12:23.000-0700","number":"PUP-11522","body":"*Puppet Version:* 6.27.0 and 7.16.0\r\n*Puppet Server Version:* N/A\r\n*OS Name/Version:* Any\r\n\r\nPUP-11471 enabled using the system CA store when using HTTP::Client, however, it did not enable users to use the 'ssl_trust_store' Puppet.conf option with client SSL authentication. After PUP-11471 a user can use 'create_context' or 'load_context' to use client based authentication with 'include_system_store: true' to load the trusted CA certificates from '/opt/puppetlabs/puppet/ssl/certs/' and '/opt/puppetlabs/puppet/ssl/cert.pem'. It does not enable a user to use 'create_context' or 'load_context' to use client based authentication with 'include_system_store: true' to load the trusted CA certificates from the 'ssl_trust_store' Puppet.conf option. \r\n\r\nThe 'ssl_trust_store' Puppet.conf option removes the requirement of using 'c_rehash' or appending the CA bundle to '/opt/puppetlabs/puppet/ssl/cert.pem', which is overwritten on any agent upgrade. \r\n\r\nWhen 'include_system_store: true' is passed, 'create_context' should load 'Puppet[:ssl_trust_store]' the same way that 'create_system_context` does here: https://github.com/puppetlabs/puppet/blob/d894861565aa95bd6f4f1cb85fe44ab62cc37854/lib/puppet/ssl/ssl_provider.rb#L73-L89 \r\n\r\n\r\n\r\n*Desired Behavior:*\r\n\r\n'create_context' should load the certificates from 'Puppet[:ssl_trust_store]' with 'include_system_store: true'.\r\n\r\n*Actual Behavior:*\r\nThere is no way to load the certificates from 'Puppet[:ssl_trust_store]' with 'create_context'.\r\n\r\nUsing the system context is not an option in this scenario as it does not use the client certificates for authentication.\r\n\r\nExamples:\r\n\r\nWe would expect the following to use client certificates and load the certificate bundles defined in 'Puppet[:ssl_trust_store]'.  It does not work unless the CA certificate is loaded into {{/opt/puppetlabs/puppet/ssl/certs/}} and {{/opt/puppetlabs/puppet/bin/c_rehash}} is run.\r\n\r\n{code}\r\nurl = 'https://example.com/file.tar.gz' # server trusted by system trust store, and demanding a client certificate signed by the puppet CA\r\nclient = Puppet.runtime[:http]\r\nprovider = Puppet::SSL::SSLProvider.new\r\nssl_context = provider.load_context(revocation: false, include_system_store: true)\r\nclient.get(URI(url), options: { ssl_context: ssl_context }) do |response|\r\n  raise 'Failed to download artifact' unless response.success?\r\n\r\n  response.read_body { |data| do_something(data) }\r\nend\r\n{code}","closed_at":"2022-05-11T08:46:14.000-0700","comments":4,"comments_url":"https://tickets.puppetlabs.com/browse/PUP-11522","labels":"jira_escalated","state":"Ready for Merge","updated_at":"2022-05-11T08:46:14.000-0700","timestamp":1652286714.148409,"priority":"Normal","status_category":"In Progress","pull_request":8908}]