INSERT INTO `bugs_fixes` (`system`, `issue_id`, `pull_request_id`, `number`, `title`, `body`, `issue_url`, `pull_request_url`, `created_at`, `closed_at`, `updated_at`, `state`, `labels`, `comments`, `comments_url`, `commits`, `additions`, `deletions`, `changed_files`, `commits_data`, `bug_report_url`, `bug_fix_url`) VALUES
('puppet', 132436, 70810015, 4976, 'undef in custom type autorequire value causes error in Puppet 4.5.0', 'The voxpupuli archive module contains a custom type that adds some file autorequires:\r\n\r\nhttps://github.com/voxpupuli/puppet-archive/blob/v0.5.1/lib/puppet/type/archive.rb#L162-L169\r\n{code}\r\nautorequire(:file) do\r\n    [\r\n      Pathname.new(self[:path]).parent.to_s,\r\n      self[:extract_path],\r\n      "/root/.aws/config",\r\n      "/root/.aws/credentials",\r\n    ]\r\n  end\r\n{code}\r\n\r\nIn this code, it is possible for {{self[:extract_path]}} to be {{undef}} if a user declares the resource without specifying it.  In Puppet 4.4.1, this does not cause a problem.  In Puppet 4.5.0, this results in the following error:\r\n\r\n{code}\r\nError: Failed to apply catalog: No title provided and :file is not a valid resource reference\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource.rb:544:in `extract_type_and_title"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource.rb:529:in `type_and_title"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:353:in `resource"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:2138:in `block (2 levels) in autorelation"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:2134:in `each"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:2134:in `block in autorelation"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:2069:in `block in eachautorequire"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:2068:in `each"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:2068:in `eachautorequire"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:2125:in `autorelation"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:2155:in `autorequire"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:169:in `block (2 levels) in build_autorelation_dependencies"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:168:in `each"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:168:in `block in build_autorelation_dependencies"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:167:in `each"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:167:in `build_autorelation_dependencies"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/graph/relationship_graph.rb:25:in `populate_from"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:246:in `relationship_graph"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:175:in `relationship_graph"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction.rb:141:in `evaluate"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:222:in `block in apply"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/log.rb:155:in `with_destination"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/transaction/report.rb:118:in `as_logging_destination"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/resource/catalog.rb:221:in `apply"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:171:in `block in apply_catalog"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:223:in `block in benchmark"\r\n/opt/puppetlabs/puppet/lib/ruby/2.1.0/benchmark.rb:294:in `realtime"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:222:in `benchmark"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:170:in `apply_catalog"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:315:in `run_internal"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:186:in `block in run"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:240:in `override"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/configurer.rb:185:in `run"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:350:in `apply_catalog"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:274:in `block in main"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:65:in `override"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:240:in `override"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:225:in `main"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/apply.rb:170:in `run_command"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `block in run"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:540:in `exit_on_fail"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:344:in `run"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:128:in `run"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute"\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>"\r\n{code}\r\n\r\nHere are steps that can be used to reproduce on a clean CentOS7 VM:\r\n\r\n{code}\r\n# sudo rpm -ivh https://yum.puppetlabs.com/puppetlabs-release-pc1-el-7.noarch.rpm\r\n# yum install puppet-agent\r\n# /opt/puppetlabs/puppet/bin/puppet --version\r\n4.5.0\r\n# /opt/puppetlabs/puppet/bin/puppet module install puppet/archive --version 0.5.1\r\n# # cat > foo.pp <<EOF\r\narchive { "git-client.hpi":\r\n   source => "https://updates.jenkins-ci.org/download/plugins/git-client/1.19.6/git-client.hpi",\r\n   path => "/tmp/git-client.hpi",\r\n   checksum_verify => false,\r\n   checksum => undef,\r\n   checksum_type => "sha1",\r\n   proxy_server => undef,\r\n   cleanup => false,\r\n   extract => false,\r\n}\r\nEOF\r\n# puppet apply ./foo.pp\r\nNotice: Compiled catalog for blah.blah in environment production in 0.08 seconds\r\nError: Failed to apply catalog: No title provided and :file is not a valid resource reference\r\n{code}\r\n\r\nDowngrading to an older version of Puppet fixes the issue:\r\n\r\n{code}\r\n# yum downgrade puppet-agent-1.4.1-1.el7\r\n# /opt/puppetlabs/puppet/bin/puppet --version\r\n4.4.1\r\n# /opt/puppetlabs/puppet/bin/puppet apply foo.pp\r\nNotice: Compiled catalog for blah.blah in environment production in 0.07 seconds\r\nNotice: /Stage[main]/Main/Archive[git-client.hpi]/ensure: replace archive: /tmp/git-client.hpi from (sha1)7ab5b9ec5635084ce192402e2d3203d2dfd66e65 to (sha1)\r\nNotice: Applied catalog in 1.64 seconds\r\n{code}', 'https://tickets.puppetlabs.com/browse/PUP-6321', 'https://github.com/puppetlabs/puppet/pull/4976', '2016-05-18T10:58:35.000-0700', '2021-06-10T23:43:31.000-0700', '2021-06-10T23:43:31.000-0700', 'Closed', 'couch-ss', 14, '0', 2, 75, 1, 2, 'd673645bbc6ca7707cf852f4cc13f57e8f6deba4', 'https://tickets.puppetlabs.com/browse/PUP-6321', 'https://github.com/puppetlabs/puppet/pull/4976'),
('puppet', 194231, 124664243, 5960, 'Fix broken implementation of Property#change_to_s method', 'The method {{Puppet::Property#change_to_s}}, which is used when constructing the message of an event, is broken. It calls the methods {{#is_to_s}} and {{#should_to_s}} to convert values to their string form and then calls {{#format_value_for_display}} to convert that string again.\r\n\r\nSometimes this almost works since the default implementation of the method {{#is_to_s}} just returns it"s argument untouched (the documentation states that it produces a "pretty printing string", but it doesn"t) so that two wrongs ends up as one right. The default for {{#should_to_s}} will however always convert its argument using default ruby string conversion (it converts to an array and joins with space).\r\n\r\nThis should be fixed so that the {{#change_to_s}} just calls {{#is_to_s}} and {{#should_to_s}} and the default implementation them then calls {{#format_value_for_display}}.', 'https://tickets.puppetlabs.com/browse/PUP-7616', 'https://github.com/puppetlabs/puppet/pull/5960', '2017-06-02T14:23:33.000-0700', '2021-06-11T12:50:21.000-0700', '2021-06-11T12:50:21.000-0700', 'Closed', 'resolved-issue-added', 10, '0', 2, 9, 9, 3, 'c14b28f9c427de7a154de88b68b9bb3f480e3a95', 'https://tickets.puppetlabs.com/browse/PUP-7616', 'https://github.com/puppetlabs/puppet/pull/5960'),
('puppet', 199346, 129404604, 6053, 'New users with null passwords not created correctly', 'When using Puppet in a Beaker acceptance test to configure a user with a null password (in order to later test to ensure that null passwords would not be permitted to authenticate) I discovered a bug in Puppet when creating users with null passwords.\r\n\r\nGiven a manifest like:\r\n{code}\r\nuser { "testuser": password => "" }\r\n{code}\r\n\r\nIt requires two Puppet runs to obtain the desired state.\r\n\r\nThis is due to https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/user/useradd.rb#L164 where properties with empty strings are not included.', 'https://tickets.puppetlabs.com/browse/PUP-7761', 'https://github.com/puppetlabs/puppet/pull/6053', '2017-07-07T05:50:25.000-0700', '2021-06-11T16:46:48.000-0700', '2021-06-11T16:46:48.000-0700', 'Closed', 'platform-os', 2, '0', 1, 9, 1, 2, '', 'https://tickets.puppetlabs.com/browse/PUP-7761', 'https://github.com/puppetlabs/puppet/pull/6053'),
('puppet', 347802, 383974236, 8019, 'Class definition errors in multhreaded when using environment caching', 'When {{environment_timeout}} is set to something greater than 0 -- meaning we are caching environments -- we are seeing issues in multithreaded mode with errors like the following, coming out of our sandbox [thread testing environment|https://github.com/puppetlabs/puppetserver/tree/master/ext/thread_test]:\r\n\r\n{code}\r\n"Server Error: Class "threader::params_class" is already defined (file: /Users/aileen/code/server/puppetserver/ext/thread_test/environments/production/modules/threader/manifests/params_class.pp, line: 1); cannot redefine (file: /Users/aileen/code/server/puppetserver/ext/thread_test/environments/production/modules/threader/manifests/params_class.pp, line: 1) on node testone"\r\n{code}\r\n\r\n{code}\r\n"Server Error: Evaluation Error: Error while evaluating a Function Call, Could not find class ::threader::params_class for testtwo (file: /Users/aileen/code/server/puppetserver/ext/thread_test/environments/funky/manifests/init.pp, line: 9, column: 1) on node testtwo"\r\n{code}\r\n\r\nThese are not fixed by the work so far in https://github.com/puppetlabs/puppet/pull/8002.', 'https://tickets.puppetlabs.com/browse/PUP-10318', 'https://github.com/puppetlabs/puppet/pull/8019', '2020-02-27T08:05:00.000-0800', '2021-06-11T17:08:14.000-0700', '2021-06-11T17:08:14.000-0700', 'Resolved', 'doc_reviewed', 0, '0', 6, 166, 132, 9, '5a1dd535a5b3a380667b48194f190ea813186d20', 'https://tickets.puppetlabs.com/browse/PUP-10318', 'https://github.com/puppetlabs/puppet/pull/8019'),
('puppet', 261544, 300878715, 7633, 'Package pip provide won"t work with ensure latest and custom index', 'Puppet agent will run every time if you have ensure => latest and custom index, for example\r\n{code:java}\r\npackage { "mypippackage":\r\n  ensure          => latest,\r\n  provider        => "pip",\r\n  install_options => { "--index" => "https://pip.example.com" },\r\n} {code}\r\nI believe the issue is happening because puppet doesn"t test package version against additional index (doesn;t use --index), while using --index on install.\r\n{code:java}\r\nDebug: Executing "/usr/bin/pip --version"\r\nDebug: Executing "/usr/bin/pip freeze --all"\r\nDebug: Executing "/usr/bin/pip --version"\r\nDebug: Executing "/usr/bin/pip --version"\r\nDebug: Executing "/usr/bin/pip install mypippackage==versionplease"\r\nDebug: /Stage[main]/Main/Package[mypippackage]/ensure: mypippackage "1.2.3.post0" is installed, latest is nil\r\nDebug: Executing: "/usr/bin/pip install -q --index=https://pip.example.com --upgrade mypippackage"\r\nNotice: /Stage[main]/Main/Package[mypippackage]/ensure: ensure changed "1.2.3.post0" to "latest"\r\n {code}', 'https://tickets.puppetlabs.com/browse/PUP-8949', 'https://github.com/puppetlabs/puppet/pull/7633', '2018-06-19T08:45:25.000-0700', '2021-06-11T19:20:35.000-0700', '2021-06-11T19:20:35.000-0700', 'Closed', 'resolved-issue-added', 7, '0', 3, 70, 5, 3, '78a68c6424923687046eb3af6630c504de228ad7', 'https://tickets.puppetlabs.com/browse/PUP-8949', 'https://github.com/puppetlabs/puppet/pull/7633'),
('puppet', 397714, 666320205, 8626, 'Ruby 3 changes default external encoding on Windows', 'Some encoding related tests fail on Windows on Ruby 3 in github actions. It appears ruby changed the default external encoding on Windows to be UTF-8, instead of the one that matches the native code page, eg. {{Encoding::CP437}}:\r\n\r\n{noformat}\r\nRun # https://github.com/ruby/ruby/pull/2791/files#diff-ff5ff976e81bebd977f0834e60416abbR97-R100\r\nActive code page: 437\r\n\r\nLCID             Name             DisplayName\r\n----             ----             -----------\r\n1033             en-US            English (United States)\r\n...\r\nopenssl (default: 2.2.0)\r\nOpenSSL Version - OpenSSL 1.1.1k  25 Mar 2021\r\nOpenSSL Library Version - OpenSSL 1.1.1k  25 Mar 2021\r\nPATH\r\n  remote: .\r\n  specs:\r\n    puppet (7.7.0)\r\n      CFPropertyList (~> 2.2)\r\n      concurrent-ruby (~> 1.0)\r\n      deep_merge (~> 1.0)\r\n      facter (>= 2.4.0, < 5)\r\n      fast_gettext (~> 1.1)\r\n      ffi (> 1.9.24, < 2)\r\n      hiera (>= 3.2.1, < 4)\r\n      locale (~> 2.1)\r\n      minitar (~> 0.9)\r\n      multi_json (~> 1.13)\r\n      scanf (~> 1.0)\r\n      semantic_puppet (~> 1.0)\r\n      sorted_set (~> 1.0)\r\n\r\nGEM\r\n  remote: https://rubygems.org/\r\n  specs:\r\n    CFPropertyList (2.3.6)\r\n    addressable (2.7.0)\r\n      public_suffix (>= 2.0.2, < 5.0)\r\n    artifactory (2.8.2)\r\n    concurrent-ruby (1.1.8)\r\n    crack (0.4.5)\r\n      rexml\r\n    csv (3.1.5)\r\n    deep_merge (1.2.1)\r\n    diff-lcs (1.4.4)\r\n    docopt (0.6.1)\r\n    facter (2.5.7-x64-mingw32)\r\n      ffi (~> 1.9)\r\n    fast_gettext (1.8.0)\r\n    ffi (1.15.0-x64-mingw32)\r\n    hashdiff (1.0.1)\r\n    hiera (3.7.0)\r\n    hiera-eyaml (3.2.1)\r\n      highline\r\n      optimist\r\n    highline (2.0.3)\r\n    hocon (1.3.1)\r\n    json-schema (2.8.1)\r\n      addressable (>= 2.4)\r\n    locale (2.1.3)\r\n    minitar (0.9)\r\n    msgpack (1.4.2)\r\n    multi_json (1.15.0)\r\n    optimist (3.0.1)\r\n    packaging (0.99.76)\r\n      artifactory (~> 2)\r\n      csv (= 3.1.5)\r\n      rake (>= 12.3)\r\n      release-metrics\r\n    public_suffix (4.0.6)\r\n    puppet-resource_api (1.8.13)\r\n      hocon (>= 1.0)\r\n    puppetserver-ca (2.1.0)\r\n      facter (>= 2.0.1, < 5)\r\n    rake (13.0.3)\r\n    rbtree (0.4.4)\r\n    release-metrics (1.1.0)\r\n      csv\r\n      docopt\r\n    rexml (3.2.5)\r\n    rspec (3.10.0)\r\n      rspec-core (~> 3.10.0)\r\n      rspec-expectations (~> 3.10.0)\r\n      rspec-mocks (~> 3.10.0)\r\n    rspec-core (3.10.1)\r\n      rspec-support (~> 3.10.0)\r\n    rspec-expectations (3.10.1)\r\n      diff-lcs (>= 1.2.0, < 2.0)\r\n      rspec-support (~> 3.10.0)\r\n    rspec-its (1.3.0)\r\n      rspec-core (>= 3.0.0)\r\n      rspec-expectations (>= 3.0.0)\r\n    rspec-mocks (3.10.2)\r\n      diff-lcs (>= 1.2.0, < 2.0)\r\n      rspec-support (~> 3.10.0)\r\n    rspec-support (3.10.2)\r\n    ruby-prof (1.4.3-x64-mingw32)\r\n    scanf (1.0.0)\r\n    semantic_puppet (1.0.3)\r\n    set (1.0.1)\r\n    sorted_set (1.0.3)\r\n      rbtree\r\n      set (~> 1.0)\r\n    vcr (5.1.0)\r\n    webmock (3.12.2)\r\n      addressable (>= 2.3.6)\r\n      crack (>= 0.3.2)\r\n      hashdiff (>= 0.4.0, < 2.0.0)\r\n    webrick (1.7.0)\r\n    yard (0.9.26)\r\n\r\nPLATFORMS\r\n  x64-mingw32\r\n\r\nDEPENDENCIES\r\n  diff-lcs (~> 1.3)\r\n  ffi\r\n  gettext-setup (~> 0.28)\r\n  hiera-eyaml\r\n  hocon (~> 1.0)\r\n  json-schema (~> 2.0)\r\n  memory_profiler\r\n  minitar (~> 0.9)\r\n  msgpack (~> 1.2)\r\n  packaging (~> 0.99)\r\n  pry\r\n  puppet!\r\n  puppet-resource_api (~> 1.5)\r\n  puppetserver-ca (~> 2.0)\r\n  racc (= 1.4.9)\r\n  rake (~> 13.0)\r\n  rdoc (~> 6.0)\r\n  ronn (~> 0.7.3)\r\n  rspec (~> 3.1)\r\n  rspec-expectations (~> 3.9, != 3.9.3)\r\n  rspec-its (~> 1.1)\r\n  rubocop (~> 0.49)\r\n  rubocop-i18n (~> 1.2.0)\r\n  ruby-prof (>= 0.16.0)\r\n  semantic_puppet (~> 1.0)\r\n  vcr (~> 5.0)\r\n  webmock (~> 3.0)\r\n  webrick (~> 1.7)\r\n  yard\r\n\r\nBUNDLED WITH\r\n   2.2.16\r\nruby 3.0.1p64 (2021-04-05 revision 0fb782ee38) [x64-mingw32]\r\n3.2.15\r\nBundler version 2.2.16\r\n...\r\nPuppet::Util#withenv on Windows works around Ruby bug 8822 (which fails to preserve UTF-8 properly when accessing ENV) (Ruby >= 2.3.x) \r\n     Failure/Error: raise "This test requires a non-UTF8 codepage" if Encoding.default_external == Encoding::UTF_8\r\n     RuntimeError:\r\n       This test requires a non-UTF8 codepage\r\n     # ./spec/unit/util_spec.rb:147:in `block (3 levels) in <top (required)>"\r\n     # ./spec/spec_helper.rb:189:in `block (2 levels) in <top (required)>"\r\n     # util/rspec_runner:44:in `run"\r\n     # util/rspec_runner:59:in `<main>"\r\nFinished in 55.78 seconds (files took 3.11 seconds to load)\r\n\r\n  1) Puppet::Pops::Parser::Lexer2 when lexing files from disk should always read files as UTF-8\r\n     Failure/Error: raise "This test must be run in a codepage other than 65001 to validate behavior"\r\n     RuntimeError:\r\n       This test must be run in a codepage other than 65001 to validate behavior\r\n     # ./spec/unit/pops/parser/lexer2_spec.rb:922:in `block (3 levels) in <top (required)>"\r\n     # ./spec/spec_helper.rb:189:in `block (2 levels) in <top (required)>"\r\n     # util/rspec_runner:44:in `run"\r\n     # util/rspec_runner:59:in `<main>"\r\n{noformat}', 'https://tickets.puppetlabs.com/browse/PUP-11049', 'https://github.com/puppetlabs/puppet/pull/8626', '2021-04-29T16:21:21.000-0700', '2021-06-14T10:02:00.000-0700', '2021-06-14T10:02:00.000-0700', 'Closed', '', 2, '0', 2, 3, 16, 4, '276c678ab657594ae463d89a327cac069600bd40', 'https://tickets.puppetlabs.com/browse/PUP-11049', 'https://github.com/puppetlabs/puppet/pull/8626'),
('puppet', 383202, 562423349, 8495, 'apt provider does not work with local packages', '*Puppet Version:* 6.19\r\n*Puppet Server Version:* n/a\r\n*OS Name/Version:* Debian/Ubuntu\r\n\r\nPUP-6631 indirectly broke the ability to manage local packages with the apt provider. This case appears to be supported by apt, so we should aim to fix this regression.\r\n\r\n*Desired Behavior:*\r\n\r\nApplying a resource like the following should work:\r\n\r\n{code}\r\npackage { "/path/to/package.deb": \r\n    ensure => installed,\r\n}\r\n{code}\r\n\r\n*Actual Behavior:*\r\n\r\nApplying the above resource results in the package being installed, but errors on the execution of {{apt-mark}}, marking the run as failed:\r\n\r\n{code}\r\nCould not evaluate: Execution of "/usr/bin/apt-mark manual /path/to/package.deb" returned 100: E: Unable to locate package /path/to/package.deb\r\n{code}\r\n\r\nPlease take a moment and attach any relevant log output and/or manifests. This will help us immensely when troubleshooting the issue.\r\n', 'https://tickets.puppetlabs.com/browse/PUP-10854', 'https://github.com/puppetlabs/puppet/pull/8495', '2021-01-14T05:17:44.000-0800', '2021-06-14T13:35:31.000-0700', '2021-06-14T13:35:31.000-0700', 'Resolved', 'doc_reviewed', 1, '0', 1, 55, 4, 4, '3884b28033406e5ea46cc48b5324abf1b021e126', 'https://tickets.puppetlabs.com/browse/PUP-10854', 'https://github.com/puppetlabs/puppet/pull/8495'),
('puppet', 56590, 23507897, 3253, 'Puppet::Util::Windows::Process.execute leaks Win32::Process exception when it fails', 'When using validate_cmd on a windows box against Puppet 3.7+ it will leak the exception thrown by Win32::Process instead of throwing the Puppet::ExecutionFailure error we throw for other systems.\r\nhttps://github.com/puppetlabs/puppet/blob/master/lib/puppet/util/windows/process.rb#L12\r\n\r\nhttps://github.com/puppetlabs/puppetlabs-stdlib/pull/348/files has example of when this is done ', 'https://tickets.puppetlabs.com/browse/PUP-3561', 'https://github.com/puppetlabs/puppet/pull/3253', '2014-10-28T17:18:21.000-0700', '2021-06-15T06:56:33.000-0700', '2021-06-15T06:56:33.000-0700', 'Accepted', 'windows', 1, '0', 1, 6, 1, 1, '', 'https://tickets.puppetlabs.com/browse/PUP-3561', 'https://github.com/puppetlabs/puppet/pull/3253'),
('puppet', 340916, 671055237, 8643, 'Unexpected results on "replace => false" on symlinks', '*Puppet Version: 5.5.17-1.el7*\r\n *Puppet Server Version:5.3.10-1.el7*\r\n *OS Name/Version: Centos 7*\r\n\r\nThis is a copy of an old redmine ticket that was never resolved:\r\n\r\n[https://projects.puppetlabs.com/issues/4872]\r\n\r\nTo summarize, if puppet contains a declaration:\r\n{code}file { "/foo":\r\n    ensure  => "link",\r\n    target  => "/bar"\r\n    replace => false,\r\n}\r\n{code}\r\n...and "/foo" already exists as a dangling symlink (pointing to a file that does not exist), then puppet will change the symlink to point back to "/bar".\r\n\r\n*Desired Behavior:*\r\n\r\nPuppet should respect {{replace =>}} false and not replace the symlink.\r\n\r\n*Actual Behavior:*\r\n\r\nAs described above, puppet replaces the symlink.\r\n\r\n \r\n\r\nI looked at the code and I think the current behavior is the same in master, though I don"t have the means to test it myself. These parts seem relevant:\r\n\r\nlib/puppet/type/file/target.rb\r\n{code}     def insync?(currentvalue)\r\n      if [:nochange, :notlink].include?(self.should) or @resource.recurse?\r\n        return true\r\n      elsif ! @resource.replace? and Puppet::FileSystem.exist?(@resource[:path])\r\n        return true\r\n      else\r\n{code}\r\nlib/puppet/file_system.rb\r\n{code}  # Determines if a file exists by verifying that the file can be stat"d.\r\n  # Will follow symlinks and verify that the actual target path exists.\r\n  #\r\n  # @return [Boolean] true if the named file exists.\r\n  #\r\n  # @api public\r\n  #\r\n  def self.exist?(path)\r\n    @impl.exist?(assert_path(path))\r\n  end \r\n{code}\r\nI think that for this functionality, the file resource code should instead use a function that does _not_ follow symlinks. Puppet is supposed to be managing the symlink, and the target (present or not) is irrelevant. When creating a symlink, puppet correctly does not care if the target exists.\r\n\r\nThanks,\r\n Corey', 'https://tickets.puppetlabs.com/browse/PUP-10214', 'https://github.com/puppetlabs/puppet/pull/8643', '2020-01-02T16:17:16.000-0800', '2021-06-15T23:22:42.000-0700', '2021-06-15T23:22:42.000-0700', 'Closed', 'beginner', 7, '0', 1, 7, 2, 1, '', 'https://tickets.puppetlabs.com/browse/PUP-10214', 'https://github.com/puppetlabs/puppet/pull/8643'),
('puppet', 189040, 668699402, 8633, 'The "desired_value" as File mode is reported without leading zeros', 'A file mode change is reported inaccurately, for example, if the desired file mode value is "0640" and the actual value is "0660", the "desired_value" is reported as "640", i.e. losing the leading zero.\r\n\r\nWe can observe this behaviour in PE 2016.4 (with puppet 4.10.1) and later but we didn"t dive deeper in history, so this bug might have been there even since much older versions.\r\n\r\nHere"s a snippet of a real report containing a trimmed file mode value in the event:\r\n{code}\r\n  File[pe-internal-mcollective-servers.cert.pem]: !ruby/object:Puppet::Resource::Status\r\n    title: pe-internal-mcollective-servers.cert.pem\r\n    file: "/opt/puppetlabs/puppet/modules/puppet_enterprise/manifests/master/keypair.pp"\r\n    line: 30\r\n    resource: File[pe-internal-mcollective-servers.cert.pem]\r\n    resource_type: File\r\n    containment_path:\r\n    - Stage[main]\r\n    - Puppet_enterprise::Profile::Master::Mcollective\r\n    - Puppet_enterprise::Master::Keypair[pe-internal-mcollective-servers]\r\n    - File[pe-internal-mcollective-servers.cert.pem]\r\n    evaluation_time: 0.002628581\r\n    tags:\r\n    - file\r\n    - pe-internal-mcollective-servers.cert.pem\r\n    - puppet_enterprise::master::keypair\r\n    - puppet_enterprise\r\n    - master\r\n    - keypair\r\n    - pe-internal-mcollective-servers\r\n    - class\r\n    - puppet_enterprise::profile::master::mcollective\r\n    - profile\r\n    - mcollective\r\n    - node\r\n    - default\r\n    time: "2017-04-28T11:07:47.359181163+00:00"\r\n    failed: false\r\n    changed: true\r\n    out_of_sync: true\r\n    skipped: false\r\n    change_count: 1\r\n    out_of_sync_count: 1\r\n    events:\r\n    - !ruby/object:Puppet::Transaction::Event\r\n      audited: false\r\n      property: mode\r\n      previous_value: "0660"\r\n      desired_value: "640"\r\n      historical_value:\r\n      message: mode changed "0660" to "0640"\r\n      name: :mode_changed\r\n      status: success\r\n      time: 2017-04-28 11:07:47.360815071 +00:00\r\n      redacted:\r\n      corrective_change: true\r\n    corrective_change: true\r\n{code}\r\n\r\nThis is the related puppet manifest that does contain the leading zero:\r\n{code:puppet}\r\ndefine puppet_enterprise::master::keypair(\r\n  $keypair_name = $title,\r\n){\r\n  File {\r\n    owner   => $puppet_enterprise::params::puppet_user,\r\n    group   => $puppet_enterprise::params::puppet_group,\r\n    mode    => "0640",\r\n    require => Package["pe-puppetserver"],\r\n  }\r\n\r\n  $cert_dir = "${puppet_enterprise::params::ssl_dir}/certs"\r\n  $private_key_dir = "${puppet_enterprise::params::ssl_dir}/private_keys"\r\n  $public_key_dir = "${puppet_enterprise::params::ssl_dir}/public_keys"\r\n\r\n  file { "${keypair_name}.cert.pem":\r\n    path    => "${cert_dir}/${keypair_name}.pem",\r\n    content => file("${cert_dir}/${keypair_name}.pem", "/dev/null"),\r\n  }\r\n\r\n  file { "${keypair_name}.private_key.pem":\r\n    path    => "${private_key_dir}/${keypair_name}.pem",\r\n    content => Sensitive(file("${private_key_dir}/${keypair_name}.pem", "/dev/null")),\r\n  }\r\n\r\n  file { "${keypair_name}.public_key.pem":\r\n    path    => "${public_key_dir}/${keypair_name}.pem",\r\n    content => file("${public_key_dir}/${keypair_name}.pem", "/dev/null"),\r\n  }\r\n}\r\n{code}\r\n', 'https://tickets.puppetlabs.com/browse/PUP-7493', 'https://github.com/puppetlabs/puppet/pull/8633', '2017-05-03T06:57:03.000-0700', '2021-06-21T10:29:17.000-0700', '2021-06-21T10:29:17.000-0700', 'Closed', 'doc_reviewed;needs_epic', 4, '0', 2, 39, 21, 3, 'ba6de86f3aa1829baccbc18b3647ad234f0e18eb', 'https://tickets.puppetlabs.com/browse/PUP-7493', 'https://github.com/puppetlabs/puppet/pull/8633'),
('puppet', 401381, 659497958, 8616, 'Passing SemVer prerelease or build as a hash doesn"t work', 'The [language specification|https://github.com/puppetlabs/puppet-specifications/blob/master/language/types_values_variables.md#semvernew] says you should be able to pass the SemVer {{prerelease}} and {{build}} components as a hash or list of arguments. However, the values are corrupted when SemVer objects are created this way:\r\n\r\n{noformat}\r\n❯ bx puppet apply  -e "notice(SemVer(major => 1, minor => 0, patch => 0, prerelease => "alpha"))"\r\nNotice: Scope(Class[main]): 1.0.0-a.l.p.h.a\r\n...\r\n❯ bx puppet apply  -e "notice(SemVer(major => 1, minor => 0, patch => 0, build => "123"))"       \r\nNotice: Scope(Class[main]): 1.0.0+1.2.3\r\n...\r\n{noformat}\r\n\r\nNote the extra dots in the output. This leads to confusing behavior:\r\n\r\n{noformat}\r\n❯ bx puppet apply  -e "notice(SemVer(major => 1, minor => 0, patch => 0, build => "123") == SemVer("1.0.0+123"))"\r\nNotice: Scope(Class[main]): false\r\n{noformat}\r\n\r\nPassing the build and prerelease components in the string version does work, because internally {{SemanticPuppet::Version.parse}} converts the [String component to an array|https://github.com/puppetlabs/semantic_puppet/blob/3ef28a432846c0d5492be1af3a412a1695b4b4b6/lib/semantic_puppet/version.rb#L38].\r\n\r\nThe problem is that the SemVer data type needs to pass the build and prerelease components as a single element array when calling {{SemanticPuppet::Version.new(.., prerelease, build)}}', 'https://tickets.puppetlabs.com/browse/PUP-11077', 'https://github.com/puppetlabs/puppet/pull/8616', '2021-06-01T15:39:10.000-0700', '2021-06-21T12:58:06.000-0700', '2021-06-21T12:58:06.000-0700', 'Closed', 'docs-reviewed', 1, '0', 1, 26, 2, 2, '63dbb09e05f2e6878a4e207049580a9d1c62275c', 'https://tickets.puppetlabs.com/browse/PUP-11077', 'https://github.com/puppetlabs/puppet/pull/8616'),
('puppet', 399467, 644297486, 8603, 'Two Sensitive instances with the same value are not equal', 'Puppet Version: 7.6.0\r\n\r\nTwo instances of lib/puppet/pops/types/p_sensitive_type.rb Sensitive with the same value are not equal. The class is just using default object id for equality.\r\n\r\n*Desired Behavior:*\r\n\r\n{code}\r\njpartlow@work1804:~/work/src/puppet$ puppet apply -e "$a = Sensitive("secret"); $b = Sensitive("secret"); notice($a == $b)"\r\nNotice: Scope(Class[main]): true\r\nNotice: Compiled catalog for work1804.platform9.puppet.net in environment production in 0.03 seconds\r\nNotice: Applied catalog in 0.08 seconds\r\n{code}\r\n\r\n*Actual Behavior:*\r\n\r\n{code}\r\njpartlow@work1804:~/work/src/puppet$ puppet apply -e "$a = Sensitive("secret"); $b = Sensitive("secret"); notice($a == $b)"\r\nNotice: Scope(Class[main]): false\r\nNotice: Compiled catalog for work1804.platform9.puppet.net in environment production in 0.03 seconds\r\nNotice: Applied catalog in 0.08 seconds\r\n{code}', 'https://tickets.puppetlabs.com/browse/PUP-11061', 'https://github.com/puppetlabs/puppet/pull/8603', '2021-05-13T14:30:35.000-0700', '2021-06-21T12:58:14.000-0700', '2021-06-21T12:58:14.000-0700', 'Resolved', 'docs-reviewed', 4, '0', 1, 28, 0, 2, 'b19133ccbb8fb8d4fb1e32bc059d46afd7b1a190', 'https://tickets.puppetlabs.com/browse/PUP-11061', 'https://github.com/puppetlabs/puppet/pull/8603'),
('puppet', 401005, 655028890, 8614, 'Add catalog edge only if parent resource has a container', '*Puppet Version: 7.7.0/6.23.0*\r\n *Puppet Server Version:* n/a\r\n *OS Name/Version: n/a*\r\n\r\nManaging resources with generators behaves differently with {{puppet resource}} and {{puppet apply}}.\r\n\r\nWhen running with {{puppet apply}}, the parent resource is always contained by something like {{Class[Main]}}, so adding an edge between that and our generated resource works.\r\n\r\nWhen running with {{puppet resource}}, the parent resource is not contained by anything ({{container_of(parent_resource)}} returns nil), which adds an edge with a nil vertex to the catalog. This in turn causes the run to fail with a NilClass exception when performing [pre-run checks|https://github.com/puppetlabs/puppet/blob/ab56d86ecb4b71298c75325462bf73376420bb40/lib/puppet/transaction.rb#L80] in the Transaction class, as the catalog now contains a nil vertex.\r\n\r\n*Desired Behavior:*\r\n\r\nRunning the following does not error:\r\n{code}\r\n> touch /tmp/asd\r\n> puppet resource tidy /tmp/asd age=0 --trace\r\n{code}\r\n\r\n*Actual Behavior:*\r\n\r\nRunning the above example gives the following error:\r\n{code}\r\nError: Could not run: undefined method `pre_run_check" for nil:NilClass\r\n/root/puppet/lib/puppet/transaction.rb:82:in `block in perform_pre_run_checks"\r\n/root/puppet/lib/puppet/transaction.rb:78:in `each"\r\n/root/puppet/lib/puppet/transaction.rb:78:in `perform_pre_run_checks"\r\n/root/puppet/lib/puppet/transaction.rb:104:in `evaluate"\r\n/root/puppet/lib/puppet/resource/catalog.rb:240:in `block (2 levels) in apply"\r\n[snip]\r\n{code}\r\n\r\n', 'https://tickets.puppetlabs.com/browse/PUP-11074', 'https://github.com/puppetlabs/puppet/pull/8614', '2021-05-27T07:33:22.000-0700', '2021-06-21T12:58:25.000-0700', '2021-06-21T12:58:25.000-0700', 'Closed', 'docs-reviewed', 2, '0', 1, 31, 1, 2, '60fab122f9a118ab08f485ee116f983572b093e8', 'https://tickets.puppetlabs.com/browse/PUP-11074', 'https://github.com/puppetlabs/puppet/pull/8614'),
('puppet', 402382, 663667497, 8622, 'Creating new user on macOS 10.14 results in `Operation not permitted` error', '*Puppet Version:*7.7.0\r\n*OS Name/Version:*macOS 10.14\r\n\r\nCreating a new user on macOS 10.14 sometimes results in the following error:\r\n*Operation not permitted @ rb_sysopen - /var/db/dslocal/nodes/Default/users/testuser.plist*\r\n\r\nThis issue is not seen on macOS 10.15 or macOS 11.\r\n\r\nManifest used:\r\n\r\n{code:puppet}\r\n user { "testuser":\r\n            ensure => present,\r\n            password => "6ce97688468f231845d9d982f1f10832ca0c6c728a77bac51c548af99ebd9b9c62bcba15112a0c7a7e34effbb2e92635650c79c51517d72b083a4eb2a513f51ad1f8ea9556cef22456159c341d8bcd382a91708afaf253c2b727d4c6cd3d29cc26011d5d511154037330ecea0263b1be8c1c13086d029c57344291bd37952b56",\r\n            salt       => "377e8b60e5fdfe509cad188d5b1b9e40e78b418f8c3f0127620ea69d4c32789c",\r\n            iterations => 40000,\r\n          }\r\n{code}\r\n', 'https://tickets.puppetlabs.com/browse/PUP-11095', 'https://github.com/puppetlabs/puppet/pull/8622', '2021-06-07T07:54:31.000-0700', '2021-06-21T12:58:34.000-0700', '2021-06-21T12:58:34.000-0700', 'Closed', 'docs-reviewed', 1, '0', 1, 2, 28, 2, 'bf131cc5c3f8c6b1914543514d5d1353707f8fff', 'https://tickets.puppetlabs.com/browse/PUP-11095', 'https://github.com/puppetlabs/puppet/pull/8622'),
('puppet', 400737, 660928109, 8617, 'Puppet agent lacks access to user keychains on macOS', 'We have puppet-agent running on macOS 11.1.0. Puppet is added to Full Disk Access list.\r\n\r\nOne of things we have managed by Puppet is running a python script as some user via exec resource. The script has the following part:\r\n{code:python}\r\ncontents = subprocess.check_output(["security", "cms", "-D", "-i", path])\r\n{code}\r\n\r\nIt works fine when run by hand ({{sudo -u user /my/script.py}}) and it also works fine when run with {{sudo puppet agent -t}}, but fails when puppet-agent is run as daemon with the following error:\r\n{code}\r\nsecurity: cert import failed: Write permissions error.\r\nsecurity: problem decoding\r\n{code}\r\n\r\nWhile researching the problem, I found SO post with similar problem: https://stackoverflow.com/questions/26474949/mac-security-command-needs-write-permissions-when-run-by-daemon. And there was referenced answer from another SO post: https://stackoverflow.com/questions/6827874/missing-certificates-and-keys-in-the-keychain-while-using-jenkins-hudson-as-cont/9482707#9482707.\r\n\r\nI took advice from the answer and added the following two lines to {{/Library/LaunchDaemons/com.puppetlabs.puppet.plist}}:\r\n{code}\r\n        <key>SessionCreate</key>\r\n        <true />\r\n{code}\r\nAnd then I run {{launchd bootout system/puppet}} and {{launchctl bootstrap system /Library/LaunchDaemons/com.puppetlabs.puppet.plist}} (I"m not really a Mac user, mainly Linux admin, so maybe the last part was not needed), and after that the script runs fine from puppet-agent running as a daemon.\r\n\r\nPlease consider adding this modification to plist for puppet agent packages for Mac (I"ve checked agent version 7.6.1-1.osx10.15 - plist looks like plist for version 6.3.0), or suggest another way of solving that problem.', 'https://tickets.puppetlabs.com/browse/PUP-11081', 'https://github.com/puppetlabs/puppet/pull/8617', '2021-05-25T13:48:52.000-0700', '2021-06-21T12:59:45.000-0700', '2021-06-21T12:59:45.000-0700', 'Closed', 'community;docs-reviewed', 1, '0', 1, 2, 0, 1, 'f54f464521263536cd2a63e452b4275bc9387de7', 'https://tickets.puppetlabs.com/browse/PUP-11081', 'https://github.com/puppetlabs/puppet/pull/8617'),
('puppet', 392819, 665149608, 8623, 'service enable=mask fails when service isn"t present', '*Puppet Version: 6.21.1, 7.5.0*\r\n *Puppet Server Version: N/A*\r\n *OS Name/Version: CentOS 7*\r\n\r\nWith the systemd provider, setting {{enable}} to {{mask}} on a service that does not exist fails.\r\n\r\n*Desired Behavior:*\r\n\r\nMasking a service should work whether or not the service exists (the way that setting {{enable}} to {{false}} works either way).\r\n\r\n*Actual Behavior:*\r\n{noformat}\r\n[root@puppet ~]# systemctl list-unit-files | grep madeup\r\n[root@puppet ~]# puppet resource service madeup\r\nservice { "madeup":\r\n ensure => "stopped",\r\n enable => "false",\r\n provider => "systemd",\r\n}\r\n[root@puppet ~]# puppet resource service madeup enable=mask\r\nError: Could not disable madeup: \r\nError: /Service[madeup]/enable: change from "false" to "mask" failed: Could not disable madeup: \r\nservice { "madeup":\r\n enable => "false",\r\n provider => "systemd",\r\n}\r\n[root@puppet ~]# systemctl mask madeup\r\nCreated symlink from /etc/systemd/system/madeup.service to /dev/null.\r\n[root@puppet ~]# systemctl list-unit-files | grep madeup\r\nmadeup.service masked{noformat}\r\nThe error here appears to be coming from [https://github.com/puppetlabs/puppet/blob/85bd9ed07e3e6c956f1972624a50be914292e1ab/lib/puppet/provider/service/systemd.rb#L162.]  If I wrap that in a begin block, the service is masked properly.', 'https://tickets.puppetlabs.com/browse/PUP-10974', 'https://github.com/puppetlabs/puppet/pull/8623', '2021-03-25T11:20:02.000-0700', '2021-06-21T13:00:10.000-0700', '2021-06-21T13:00:10.000-0700', 'Closed', 'community;docs-reviewed', 4, '0', 1, 18, 1, 2, 'e42922b50ec235a2779029a82e64caef1999a39d', 'https://tickets.puppetlabs.com/browse/PUP-10974', 'https://github.com/puppetlabs/puppet/pull/8623'),
('puppet', 57947, 663624120, 8621, 'NIM provider uses a regex that is too restrictive when parsing RPM release tags', 'The NIM provider uses a regex that is too restrictive when parsing RPM release tags, it only allows numbers. For example if a package has a security release that includes letters it will fail to recognize it as a valid package name. \r\nThe package "wget-1.9.1-2ssl" gives the error: "Unable to parse output from nimclient showres: package string does not match expected rpm package string format"', 'https://tickets.puppetlabs.com/browse/PUP-3631', 'https://github.com/puppetlabs/puppet/pull/8621', '2014-11-06T14:53:00.000-0800', '2021-06-21T13:00:23.000-0700', '2021-06-21T13:00:23.000-0700', 'Closed', 'aix;docs-reviewed;jira_escalated;package;platform-os;type_and_provider', 0, '0', 2, 53, 6, 2, '18e1fde21fed4c063a308c07d67bb3b720da7dd0', 'https://tickets.puppetlabs.com/browse/PUP-3631', 'https://github.com/puppetlabs/puppet/pull/8621'),
('puppet', 283329, 222764592, 7167, 'Audit and fix locations where set_mode is called with inappropriate permissions on Windows', '[PUP-9216|https://github.com/puppetlabs/puppet/commit/2a4ba1c9f2ac1b6dcb48f3cb6d48351724987164] was merged earlier, which sets System ACE entries to full control. This triggers a failure in pxp-agent"s [tasks.run_puppet.rb|https://github.com/puppetlabs/pxp-agent/blob/1.9.x/acceptance/tests/tasks/run_puppet.rb] test, specifically [here|https://github.com/puppetlabs/pxp-agent/blob/1.9.x/acceptance/tests/tasks/run_puppet.rb#L42] based on the stack trace.\r\n\r\nRepresentative job link: https://jenkins-platform.delivery.puppetlabs.net/view/puppet-agent/view/Acceptance%20Suites/view/5.5.x/view/Suite/job/platform_puppet-agent_puppet-agent-integration-suite_daily-5.5.x/232/RMM_COMPONENT_TO_TEST_NAME=pxp_agent,SLAVE_LABEL=beaker,TEST_TARGET=windows10ent-64a/\r\n\r\nRepresentative failure output:\r\n{code}\r\nSuccessful task expected to have no output on stderr. --- expected +++ actual @@ -1 +1,2 @@ -nil +"\e[1;33mWarning: An attempt to set mode 416 on item C:/ProgramData/PuppetLabs/puppet/cache/reports/xln2koezj7avuqx.delivery.puppetlabs.net/201810110803.yaml would result in the group, SYSTEM, to have less than Full Control rights. This attempt has been corrected to Full Control\e[0m +" \r\n{code}\r\n\r\n---\r\n\r\nPull Request https://github.com/puppetlabs/puppet/pull/7167 was raised to fix one place where {{set_mode}} was used, however some other testing exposed there are other places where set_mode is used to set inappropriate permissions on Windows platforms; e.g. https://github.com/puppetlabs/puppet/pull/7167#issuecomment-430682091\r\n\r\nThis issue will track the work to find all of the set_mode call sites and audit them for appropriate-ness on Windows platforms.  And then raise fix PRs where needed.', 'https://tickets.puppetlabs.com/browse/PUP-9297', 'https://github.com/puppetlabs/puppet/pull/7167', '2018-11-01T00:58:04.000-0700', '2021-06-22T01:32:16.000-0700', '2021-06-22T01:32:16.000-0700', 'Accepted', '', 1, '0', 1, 49, 8, 9, '', 'https://tickets.puppetlabs.com/browse/PUP-9297', 'https://github.com/puppetlabs/puppet/pull/7167'),
('puppet', 109482, 56580743, 4584, 'Puppet apply doesn"t protect shared files with a lock', 'Puppet apply should use a filesystem lock just like agent to protect shared state files from simultaneous writes (it actually writes to the same state files as agent even).', 'https://tickets.puppetlabs.com/browse/PUP-5609', 'https://github.com/puppetlabs/puppet/pull/4584', '2015-12-14T12:16:05.000-0800', '2021-06-22T01:54:18.000-0700', '2021-06-22T01:54:18.000-0700', 'Accepted', '', 8, '0', 2, 51, 13, 8, '686a4cd62965eef9563372cf9e20cc5ddbd9d02a', 'https://tickets.puppetlabs.com/browse/PUP-5609', 'https://github.com/puppetlabs/puppet/pull/4584'),
('puppet', 188603, 118696593, 5839, 'useradd provider silently does not set password', 'h3. Issue\r\n\r\nWhen libshadow is not present on a client, the agent will silently not set the password for a user. In this case silence is not golden because a system can become insecure (e.g. rotating root passwords) and there is no report of the failure to update the password.\r\n\r\nh3. Repro\r\n\r\nDockerfile:\r\n{code:Dockerfile}\r\nFROM centos:7\r\n\r\nRUN rpm -Uvh https://yum.puppetlabs.com/puppetlabs-release-el-7.noarch.rpm && \\r\n    yum install -y puppet-3.8.7\r\n{code}\r\n\r\nrun.sh:\r\n{code:bash}\r\n#!/bin/bash\r\n\r\necho "==> Setting password for bob to "alice"..."\r\npuppet apply -tv --execute "user {"bob": password => "alice", }"\r\ngrep bob /etc/shadow\r\necho\r\n\r\nrpm --nodeps --erase ruby-shadow\r\necho "==> Setting password for bob to "robert"..."\r\npuppet apply -tv --execute "user {"bob": password => "robert", }"\r\ngrep bob /etc/shadow\r\n{code}\r\n\r\n{code:bash}\r\n$ docker run --rm -t -v $PWD/run.sh:/run.sh puppet /run.sh\r\n==> Setting password for bob to "alice"...\r\nNotice: Compiled catalog for b2a735570f73.local in environment production in 0.16 seconds\r\nInfo: Applying configuration version "1493591675"\r\nNotice: /Stage[main]/Main/User[bob]/ensure: created\r\nInfo: Creating state file /var/lib/puppet/state/state.yaml\r\nNotice: Finished catalog run in 0.50 seconds\r\nbob:alice:17286:0:99999:7:::\r\n\r\n==> Setting password for bob to "robert"...\r\nNotice: Compiled catalog for b2a735570f73.local in environment production in 0.15 seconds\r\nInfo: Applying configuration version "1493591678"\r\nNotice: Finished catalog run in 0.04 seconds\r\nbob:alice:17286:0:99999:7:::\r\n{code}', 'https://tickets.puppetlabs.com/browse/PUP-7486', 'https://github.com/puppetlabs/puppet/pull/5839', '2017-04-30T15:39:25.000-0700', '2021-07-06T07:22:40.000-0700', '2021-07-06T07:22:40.000-0700', 'Accepted', 'linux;platform-os;security;type_and_provider;user', 8, '0', 1, 7, 5, 2, '', 'https://tickets.puppetlabs.com/browse/PUP-7486', 'https://github.com/puppetlabs/puppet/pull/5839'),
('puppet', 381638, 618088347, 8573, 'Agent failures with server_list when one puppetserver fails', '*Puppet Version:* 6.15.0+\r\n*Puppet Server Version:* 6.x\r\n*OS Name/Version:* Any\r\n\r\nAfter the changes in 6.15.0 the server_list setting has different behavior. Previously when server_list was configured and the first puppetserver in the list failed, the agent would continue to run by connecting to the next puppetserver on the list. In 6.15.0, if the primary puppetserver fails while an agent is running, it results in a failed agent run.\r\n\r\n*Desired Behavior:*\r\nWhen the first puppetserver in the server_list goes offline, the agents should automatically try to connect to the second puppetserver in the server_list even if it is mid agent run.\r\n\r\n*Actual Behavior:*\r\nThe agent run fails if the first puppetserver in the server_list goes offline while the agent is in the middle of a run. \r\n\r\nSome failures are below.\r\n\r\n{noformat}\r\nCould not evaluate: Could not retrieve file metadata for puppet:///pe_packages/2019.8.1/windows-x86_64/puppet-agent-x64.msi: Request to https://primary.example.com:8140/puppet/v3/file_metadata/pe_packages/2019.8.1/windows-x86_64/puppet-agent-x64.msi?links=manage&checksum_type=sha256lite&source_permissions=ignore&environment=windows_testing failed after 21.011 seconds: Failed to open TCP connection to primary.example.com:8140 (A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond. - connect(2) for "primary.example.com" port 8140)\r\n{noformat}\r\n\r\n{noformat}\r\npuppet-agent[7053]: Could not retrieve catalog from remote server: Request to https://primary.example.com:8140/puppet/v3/catalog/agent.example.com?environment=development failed after 0.004 seconds: Failed to open TCP connection to primary.example.com:8140 (Connection refused - connect(2) for "primary.example.com" port 8140)\r\n{noformat}\r\n\r\n*Reproduction*\r\n1. Configure the server_list for two Puppetservers\r\n2. Configure 10 agents with the server_list and a run interval of a minute\r\n3. Shutdown the Puppetserver service on the first server in the server_list\r\n\r\nLikely one of the agents will have the failure. It seems to be more reproducible with file resources inside the catalog.\r\n\r\nWe believe this is related to the changes in PUP-10363', 'https://tickets.puppetlabs.com/browse/PUP-10844', 'https://github.com/puppetlabs/puppet/pull/8573', '2020-12-22T08:06:55.000-0800', '2021-07-06T07:38:31.000-0700', '2021-07-06T07:38:31.000-0700', 'Closed', 'doc-reviewed;jira_escalated;platform_7.2', 11, '0', 1, 38, 4, 2, '3587999aef868ce8507d79b5c8fbf64b7958e0bf', 'https://tickets.puppetlabs.com/browse/PUP-10844', 'https://github.com/puppetlabs/puppet/pull/8573'),
('puppet', 235941, 172581304, 6703, 'type parameters do not honor when default is set to false', 'In our puppet types, we are able to set defaults for parameters defined for each type. However, if a given parameter defaults to false, the code will take that for falsiness and not include that parameter as set, even though it should be. This originates at https://github.com/puppetlabs/puppet/blob/327b03a9e1ecdc7b925720a4eec59795f4456a56/lib/puppet/type.rb#L834, where {{value = parameter.default}} will return false and send us into the else block of that if statement, which removes our parameter from the list of parameters for our given resource.\r\n\r\nThis will likely result in some unexpected changes once we fix it.', 'https://tickets.puppetlabs.com/browse/PUP-8442', 'https://github.com/puppetlabs/puppet/pull/6703', '2018-02-08T17:04:50.000-0800', '2021-07-07T16:34:17.000-0700', '2021-07-07T16:34:17.000-0700', 'Ready for Engineering', '', 7, '0', 1, 9, 94, 8, 'c98bb6787fa2ec04842a92924dd4eb8e41bddd78', 'https://tickets.puppetlabs.com/browse/PUP-8442', 'https://github.com/puppetlabs/puppet/pull/6703'),
('puppet', 368953, 471457080, 8291, 'Request to status endpoint not using extra_headers setting', 'When using server_list, Puppet 6 adds a [new request|https://github.com/puppetlabs/puppet/blob/eadd5474c26e7d28d90de00b9d7a7545ac10e55d/lib/puppet/http/resolver/server_list.rb#L61] to validate that the server is listening. This request is done by using [Puppet::HTTP::Client|https://github.com/puppetlabs/puppet/blob/main/lib/puppet/http/client.rb] which in opposition to [Puppet::HTTP::Service|https://github.com/puppetlabs/puppet/blob/main/lib/puppet/http/service.rb], doesn"t have a [proper way to handle the http_extra_headers setting|https://github.com/puppetlabs/puppet/blob/main/lib/puppet/http/service.rb#L110].\r\n\r\nThis supposes a problem as I"m redirecting the traffic based on that header. As the header is not present in status requests, the catalog compilation doesn"t go through.\r\n\r\nFor more information on the extra_header setting refer to PUP-9566.', 'https://tickets.puppetlabs.com/browse/PUP-10617', 'https://github.com/puppetlabs/puppet/pull/8291', '2020-08-12T07:00:42.000-0700', '2021-07-07T16:37:20.000-0700', '2021-07-07T16:37:20.000-0700', 'Resolved', 'doc_reviewed', 7, '0', 2, 134, 34, 6, '232940bd10c9b03ad9d6b7c7634126faca06a4fc', 'https://tickets.puppetlabs.com/browse/PUP-10617', 'https://github.com/puppetlabs/puppet/pull/8291'),
('puppet', 339935, 352168765, 7879, 'yum provider does not allow array of strings', ' \r\n*Puppet Version: Any*\r\n*Puppet Server Version: Any*\r\n*OS Name/Version: RHEL (All versions)*\r\n\r\nWhen using the puppet_agent module to update an RPM to the latest the install_options flags --enablerepo and --disablerepo only accepts array of hashes and not an array of Strings. This contradictory to the following documentation: [https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/package.rb#L36-L58]\r\n\r\n*PR:* Puppet 5.x: [https://github.com/puppetlabs/puppet/pull/7879 |https://github.com/puppetlabs/puppet/pull/7879] and Puppet 6.x: \{PR to come, will update when available}\r\n\r\n*Desired Behavior:*\r\n\r\nUser"s should be able to specify any package manager option as an array of String or an array of Hashes.\r\n\r\nThe docs detail the user can pass an array of strings or hashes.  However, there are no tests in the puppet code base that back up these claims.\r\n*Actual Behavior:*\r\n\r\nOnly --enablerepo and --disablerepo are special for YUM as they affect which packages are visible to the package manager. The logic that pulls them out for use in things like version checks only looks for Hash form of specifying an option: [https://github.com/puppetlabs/puppet/blob/5.5.17/lib/puppet/provider/package/yum.rb#L268-L296]\r\n\r\ncreate a /tmp/test.pp file with the following contents:\r\n # cat /tmp/test.pp\r\n package \{ "nginx":   ensure          => "latest",   install_options => [ "--enablerepo="dev-*"" ], }\r\n_nginx_ can be any rpm package\r\n\r\n Details show that an updated package was available and did not apply, contents of the manifest being applied:\r\n\r\n root@:~\r\n\r\n # yum list --enablerepo=dev nginx\r\n Loaded plugins: langpacks, package_upload, product-id, search-disabled-repos\r\n Installed Packages\r\n nginx.x86_64                                            0.0.1.1111-1e8410a                                            @dev-dev\r\n Available Packages\r\n nginxx86_64                                            0.0.1.1114-5e669d5                                           dev\r\n\r\n root@:~\r\n # cat /tmp/test.pp\r\n package \{ "nginx":   ensure          => "latest",   install_options => [ "--enablerepo="dev-*"" ], }\r\n\r\n root@:~\r\n\r\n # puppet apply /tmp/test.pp\r\n Notice: Compiled catalog for <hostname> in environment production in 0.02 seconds\r\n Notice: Applied catalog in 2.11 seconds\r\n\r\n Full puppet apply --debug /tmp/test.pp attached. ', 'https://tickets.puppetlabs.com/browse/PUP-10177', 'https://github.com/puppetlabs/puppet/pull/7879', '2019-12-17T10:30:50.000-0800', '2021-07-07T16:37:20.000-0700', '2021-07-07T16:37:20.000-0700', 'Resolved', 'resolved-issue-added', 0, '0', 1, 59, 5, 2, '6def945eeaabfac658fb5a7d58474b822be797cd', 'https://tickets.puppetlabs.com/browse/PUP-10177', 'https://github.com/puppetlabs/puppet/pull/7879'),
('puppet', 251856, 231569457, 7242, 'puppet device fails with undefined method `loaders" for nil:NilClass when env is not production', 'The {{puppet device}} command fails with when {{environment}} is not "production" and {{environment}} is specified locally in either {{puppet.conf}} or via the {{--environment}} option ...\r\n\r\n{code}\r\n[root@pe-201810-agent ~]# puppet device --verbose --environment=development\r\nError: Could not run: undefined method `loaders" for nil:NilClass\r\n{code}\r\n\r\nIt succeeds if environment is server-specified ...\r\n\r\n{code}\r\n[root@pe-201810-agent ~]# puppet device --verbose #--environment=development\r\nInfo: starting applying configuration to cisco.example.com at file:///etc/puppetlabs/puppet/devices/cisco.example.com.yaml\r\nNotice: Local environment: "production" doesn"t match server specified node environment "development", switching agent to "development".\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Caching catalog for cisco.example.com\r\nInfo: Applying configuration version "1526925344"\r\nNotice: Applied catalog in 0.12 seconds\r\n{code}\r\n\r\nNote that even when the agent is not in production, only the production directory is created locally:\r\n\r\n{code}\r\n[root@pe-201810-agent ~]#  ls -al /etc/puppetlabs/code/environments/\r\ntotal 0\r\ndrwxr-xr-x 3 root root 23 May 21 17:28 .\r\ndrwxr-xr-x 4 root root 39 May 21 17:12 ..\r\ndrwxr-x--- 5 root root 87 May 21 17:29 production\r\n{code}', 'https://tickets.puppetlabs.com/browse/PUP-8766', 'https://github.com/puppetlabs/puppet/pull/7242', '2018-05-21T11:09:27.000-0700', '2021-07-07T16:37:21.000-0700', '2021-07-07T16:37:21.000-0700', 'Closed', 'resolved-issue-added', 19, '0', 5, 51, 33, 3, '138b5d0e8b52b333481986e8faea8d2bc7118ce4', 'https://tickets.puppetlabs.com/browse/PUP-8766', 'https://github.com/puppetlabs/puppet/pull/7242'),
('puppet', 389668, 643002758, 8598, 'Recursive file resources generate dangerous numbers of resource events', 'The {{file}} and {{tidy}} resource types have recursion options that allow the management of entire directory trees. This is accomplished by walking the tree and generating a new {{file}} resource that manages the state of each entry separately. This approach works well for small numbers of files (100s) but generates excessive numbers of events when applied to directory trees that contain large numbers of files. At high file counts, the behavior is detrimental to Puppet Agent performance and can cause Puppet Server outages by generating large reports. This behavior also combines poorly with {{noop => true}} which causes the large number of events to be reported every time Puppet runs instead of once when the state is enforced.\r\n\r\nh2. Reporduction Case\r\n\r\n  - Install Puppet Server 7 on a CentOS 7 node:\r\n\r\n{code:bash}\r\nyum install -y http://yum.puppetlabs.com/puppet7-release-el-7.noarch.rpm\r\nyum install -y puppetserver\r\nsource /etc/profile.d/puppet-agent.sh\r\n\r\npuppet config set server $(hostname -f)\r\npuppetserver ca setup\r\n\r\nsystemctl start puppetserver\r\n{code}\r\n\r\n  - Install PuppetDB 7 and configure it as a report processor:\r\n\r\n{code:bash}\r\npuppet module install puppetlabs-puppetdb\r\n\r\npuppet apply <<"EOF"\r\nclass { "puppetdb":\r\n  postgres_version => "11",\r\n}\r\n\r\nclass { "puppetdb::master::config":\r\n  enable_reports          => true,\r\n  manage_report_processor => true,\r\n}\r\nEOF\r\n{code}\r\n\r\n  - Next, configure Puppet Server to use one JRuby instance with the default allocation of 512 MB of RAM:\r\n\r\n{code:bash}\r\npuppet module install puppetlabs-hocon\r\n\r\npuppet apply <<"EOF"\r\nservice { "puppetserver":\r\n  ensure => running,\r\n}\r\n\r\nini_subsetting {\r\n  default:\r\n    ensure            => present,\r\n    path              => "/etc/sysconfig/puppetserver",\r\n    section           => "",\r\n    key_val_separator => "=",\r\n    setting           => "JAVA_ARGS",\r\n    notify            => Service["puppetserver"],\r\n  ;\r\n  "puppetserver min ram":\r\n    subsetting => "-Xms",\r\n    value      => "512m",\r\n  ;\r\n  "puppetserver max ram":\r\n    subsetting => "-Xmx",\r\n    value      => "512m",\r\n  ;\r\n}\r\n\r\nfile_line { "fix EZ-142":\r\n  ensure => present,\r\n  path   => "/opt/puppetlabs/server/apps/puppetserver/cli/apps/start",\r\n  line   => "out_of_memory_flag="-XX:OnOutOfMemoryError=kill -9 %p"",\r\n  match  => "^out_of_memory_flag=",\r\n  notify => Service["puppetserver"],\r\n}\r\n\r\nhocon_setting { "puppetserver jruby instances":\r\n  ensure  => present,\r\n  path    => "/etc/puppetlabs/puppetserver/conf.d/puppetserver.conf",\r\n  setting => "jruby-puppet.max-active-instances",\r\n  value   => 1,\r\n  notify  => Service["puppetserver"],\r\n}\r\nEOF\r\n{code}\r\n\r\n  - Generate certificates for a test node and configure it to recursively purge a deep directory tree:\r\n\r\n{code:bash}\r\ncurl -L https://raw.githubusercontent.com/LLNL/fdtree/master/fdtree.bash -o /usr/local/bin/fdtree\r\nmkdir -p /tmp/recursion_test\r\n\r\n# Create, 1 level, 19 directories per level, 999 files per directory, 0 bytes per file\r\nbash /usr/local/bin/fdtree -C -l 1 -d 19 -f 999 -s 0 -o /tmp/recursion_test\r\n\r\npuppetserver ca generate --certname recursion.test\r\n\r\ncat <<"EOF" >>/etc/puppetlabs/code/environments/production/manifests/site.pp\r\nnode "recursion.test" {\r\n  file {"/tmp/recursion_test":\r\n    ensure  => directory,\r\n    recurse => true,\r\n    purge   => true,\r\n    noop    => true,\r\n  }\r\n}\r\nEOF\r\n{code}\r\n\r\n  - Run `puppet agent` to enforce the resource and submit a report (this will take about 5 minutes):\r\n\r\n{code:bash}\r\n# Direct output to /dev/null to avoid spamming the console\r\npuppet agent -t --certname recursion.test &>/dev/null\r\n{code}\r\n\r\n  - Check the puppetserver service to see if it survived.\r\n\r\nh3. Outcome\r\n\r\nWhen faced with the prospect of processing such a large quantity of events, puppetserver chose to reincarnate:\r\n\r\n{noformat}\r\n# journalctl SYSLOG_IDENTIFIER=puppetserver + UNIT=puppetserver.service\r\n-- Logs begin at Tue 2021-03-02 23:07:14 UTC, end at Tue 2021-03-02 23:31:35 UTC. --\r\nMar 02 23:11:23 wine-appointee systemd[1]: Starting puppetserver Service...\r\nMar 02 23:11:41 wine-appointee systemd[1]: Started puppetserver Service.\r\nMar 02 23:12:43 wine-appointee systemd[1]: Stopping puppetserver Service...\r\nMar 02 23:12:44 wine-appointee systemd[1]: Starting puppetserver Service...\r\nMar 02 23:13:02 wine-appointee systemd[1]: Started puppetserver Service.\r\nMar 02 23:26:54 wine-appointee systemd[1]: Stopping puppetserver Service...\r\nMar 02 23:26:55 wine-appointee systemd[1]: Starting puppetserver Service...\r\nMar 02 23:27:13 wine-appointee systemd[1]: Started puppetserver Service.\r\nMar 0 23:31:35 wine-appointee puppetserver[2930]: #\r\nMar 02 23:31:35 wine-appointee puppetserver[2930]: # java.lang.OutOfMemoryError: GC overhead limit exceeded\r\nMar 02 23:31:35 wine-appointee puppetserver[2930]: # -XX:OnOutOfMemoryError="kill -9 %p"\r\nMar 02 23:31:35 wine-appointee puppetserver[2930]: #   Executing /bin/sh -c "kill -9 2955"...\r\nMar 02 23:31:35 wine-appointee systemd[1]: puppetserver.service: main process exited, code=killed, status=9/KILL\r\nMar 02 23:31:35 wine-appointee systemd[1]: Unit puppetserver.service entered failed state.\r\nMar 02 23:31:35 wine-appointee systemd[1]: puppetserver.service failed.\r\nMar 02 23:31:35 wine-appointee systemd[1]: puppetserver.service holdoff time over, scheduling restart.\r\nMar 02 23:31:35 wine-appointee systemd[1]: Starting puppetserver Service...2\r\n{noformat}\r\n\r\nh3. Expected Outcome\r\n\r\nFile recursion can"t DOS the puppetserver service.', 'https://tickets.puppetlabs.com/browse/PUP-10946', 'https://github.com/puppetlabs/puppet/pull/8598', '2021-03-02T15:33:59.000-0800', '2021-07-07T23:49:58.000-0700', '2021-07-07T23:49:58.000-0700', 'Resolved', 'doc-reviewed;jira_escalated', 8, '0', 1, 16, 4, 2, 'd07d37a938f2391bb1ccb74a1f0f8fcc839819b6', 'https://tickets.puppetlabs.com/browse/PUP-10946', 'https://github.com/puppetlabs/puppet/pull/8598'),
('puppet', 249363, 670669797, 8640, '--extra cli option is nonfunctional', '*Puppet Version: 5.5.1*\r\n *Puppet Server Version: N/A*\r\n *OS Name/Version: Centos 7.4.1708*\r\n\r\nMany `puppet` applications such as `puppet facts` and `puppet catalog` take a `–terminus` option to specify what indirector to use. These applications generally also specify a `–extra` argument, like so:\r\n\r\n`--extra HASH                  - Extra arguments to pass to the indirection request`\r\n\r\nAs far as I can determine, this argument is not actually possible to use, since any argument supplied to the `–extra` option is treated by Ruby as a String. For example, `puppet facts --terminus network_device --extra "\{target => "example-device"}"` results in `Error: Could not call "find" on "facts": undefined method `inject" for "\{target => \"example-device\"}":String`\r\n\r\nThe same results are had when trying other hash-ish syntaxes such as JSON or key-value pairs.\r\n\r\nIf there"s some existing syntax that will actually work here, it should be documented. But I had a look through the source code, and I don"t think any such syntax exists.\r\n\r\nDescribe steps to reproduce…\r\n\r\n`puppet facts --terminus network_device --extra <anything at all here>`\r\n\r\n*Desired Behavior:*\r\n\r\n**The `–extra` argument should function, or should be removed.\r\n\r\n*Actual Behavior:*\r\n\r\n \r\n\r\n```\r\n\r\n$ sudo puppet facts --terminus network_device --extra "\{target => "example-device"}" --trace\r\nError: Could not call "find" on "facts": undefined method `inject" for "\{target => \"example-device\"}":String\r\nDid you mean? inspect\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/request.rb:68:in `initialize"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:115:in `new"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:115:in `request"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:187:in `find"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/face.rb:46:in `call_indirection_method"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/face.rb:84:in `block (2 levels) in <class:Face>"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/interface/action.rb+eval[wrapper]:264:in `find"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/face_base.rb:247:in `main"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:383:in `run_command"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `block in run"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:661:in `exit_on_fail"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `run"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:137:in `run"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:73:in `execute"\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>"\r\nError: Could not call "find" on "facts": undefined method `inject" for "\{target => \"example-device\"}":String\r\nDid you mean? inspect\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/request.rb:68:in `initialize"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:115:in `new"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:115:in `request"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:187:in `find"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/face.rb:46:in `call_indirection_method"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/face.rb:84:in `block (2 levels) in <class:Face>"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/interface/action.rb+eval[wrapper]:264:in `find"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/face_base.rb:247:in `main"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:383:in `run_command"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `block in run"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:661:in `exit_on_fail"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:375:in `run"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:137:in `run"\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:73:in `execute"\r\n/opt/puppetlabs/puppet/bin/puppet:5:in `<main>"\r\nError: Try "puppet help facts find" for usage\r\n\r\n```', 'https://tickets.puppetlabs.com/browse/PUP-8700', 'https://github.com/puppetlabs/puppet/pull/8640', '2018-05-04T16:52:30.000-0700', '2021-07-13T03:32:02.000-0700', '2021-07-13T03:32:02.000-0700', 'Closed', 'commandline;doc-reviewed', 5, '0', 1, 3, 0, 3, 'eb39733a12219a98a9ffb78ef484eeeea8cc5d86', 'https://tickets.puppetlabs.com/browse/PUP-8700', 'https://github.com/puppetlabs/puppet/pull/8640'),
('puppet', 89342, 667677104, 8629, 'PMT won"t install a module on windows if module_working_dir contains backslashes', 'If you override {{module_working_dir}} using a native windows path with backslashes, the PMT will fail to install the module, because it expects the path to contain forward slashes:\r\n\r\n{noformat}\r\nC:\work\puppet [stable +25 ~0 -0 !]> bundle exec puppet module install puppetlabs-stdlib --module_working_dir C:\Windows\Temp --debug\r\n...\r\nError: Could not install package\r\n  Package attempted to install file into\r\n  "C:/Windows/Temp/cache/tmp-unpacker20150714-3276-hqzekd/puppetlabs-stdlib-4.6.0" under "C:\\Windows\\Temp/cache/tmp-unpacker20150714-3276-hqzekd".\r\n{noformat}\r\n\r\nChanging that to forward slashes works, including if the case doesn"t match:\r\n\r\n{noformat}\r\nC:\work\puppet [stable +25 ~0 -0 !]> bundle exec puppet module install puppetlab\r\ns-stdlib --module_working_dir C:/windows/temp --debug\r\n...\r\nDebug: Extracting: C:/windows/temp/cache/tmp-unpacker20150714-2640-1mynaxp/puppe\r\ntlabs-stdlib-4.6.0/lib/facter/util/puppet_settings.rb\r\nNotice: Installing -- do not interrupt ...\r\nC:/ProgramData/PuppetLabs/code/modules\r\n└── puppetlabs-stdlib (v4.6.0)\r\n{noformat}\r\n\r\nA simple fix would be to ensure we call File.expand_path on whatever value is specified, as that canonicalizes the path (from ruby"s perspective):\r\n\r\n{noformat}\r\nC:\work\puppet [stable +25 ~0 -0 !]> irb\r\nirb(main):001:0> File.expand_path("C:\Windows\Temp")\r\n=> "C:/Windows/Temp"\r\n{noformat}\r\n\r\n', 'https://tickets.puppetlabs.com/browse/PUP-4884', 'https://github.com/puppetlabs/puppet/pull/8629', '2015-07-15T11:18:28.000-0700', '2021-07-13T03:34:38.000-0700', '2021-07-13T03:34:38.000-0700', 'Resolved', 'doc-reviewed;windows', 2, '0', 1, 3, 4, 3, '59ac9fee264d9840fb0f38278e835f5f92168270', 'https://tickets.puppetlabs.com/browse/PUP-4884', 'https://github.com/puppetlabs/puppet/pull/8629'),
('puppet', 289473, 669964150, 8634, 'Parsedfile produces a undefined method each for nil:NilClass', 'The parsedfile provider will output a difficult to identify error message {{undefined method `each" for nil:NilClass}} when prefetching targets.\r\n\r\n{{target_records}} can be set to nil in [https://github.com/puppetlabs/puppet/blob/5.5.8/lib/puppet/provider/parsedfile.rb#L264-L276] when {{retrieve(targets)}} returns nil at [https://github.com/puppetlabs/puppet/blob/5.5.8/lib/puppet/provider/parsedfile.rb#L291-L293]. The {{nil}} {{target_records}} is not handled, so it throws the undefined method error nil does not have en each method.\r\n\r\nThis error was seen in the nagios_service resource, where there was a line containing only {{################################}} in the {{/etc/nagios/nagios_service.cfg}} file. It was difficult to identify what the cause of the issue was and where it could be coming from. Removing the file and regenerating it resolved the issue, but we would like to see more coherent error messages to reduce troubleshooting effort when there is an issue in the parsed file.', 'https://tickets.puppetlabs.com/browse/PUP-9369', 'https://github.com/puppetlabs/puppet/pull/8634', '2018-12-19T13:24:12.000-0800', '2021-07-13T03:35:28.000-0700', '2021-07-13T03:35:28.000-0700', 'Resolved', 'cspapercuts;doc-reviewed', 3, '0', 1, 13, 0, 2, 'f29829eee4b4d7c712626ba923fe2ca5ac1d6e22', 'https://tickets.puppetlabs.com/browse/PUP-9369', 'https://github.com/puppetlabs/puppet/pull/8634'),
('puppet', 67460, 666418595, 8627, 'Prevent node resource names from overlapping with other resources', 'Before the pull request for PUP-3167 was submitted, if a node with a regex name matched the name of of another resource (like a class), then it was possible that the two would step on each other. This is pretty clearly illustrated by the example given in the original ticket:\r\n\r\n{noformat} class foo {\r\n  $bar = "one"\r\n}\r\n \r\nnode /foo/ {\r\n  $bar = "two"\r\n  include foo\r\n  notice("${::foo::bar}")\r\n} {noformat}\r\n\r\nAlthough the issue was fixed for nodes specified with a regex, we were unable to fix the issue for all node names, since that fix would have been significantly more complicated than the one we implemented for regular expressions (see Henrik"s comment on PUP-3167). As such, we need to find a way to prevent resource names for non-regex nodes and other resources from overlapping.\r\n', 'https://tickets.puppetlabs.com/browse/PUP-3995', 'https://github.com/puppetlabs/puppet/pull/8627', '2015-02-10T12:02:08.000-0800', '2021-07-13T03:37:23.000-0700', '2021-07-13T03:37:23.000-0700', 'Resolved', 'doc-reviewed;help_wanted;needs_repro', 5, '0', 1, 49, 2, 4, '9fdb0ab59613a9a6e9f3503be7e8b564bf6c1768', 'https://tickets.puppetlabs.com/browse/PUP-3995', 'https://github.com/puppetlabs/puppet/pull/8627'),
('puppet', 316059, 670064801, 8635, 'Print meaningful error message if the user/group providers are not suitable when applying the settings catalog', 'Hi Folks\r\n\r\nWe have a problem when trying to run the Puppet Agent on a freshly reinstalled Mac. This issue is occurring on most versions on MacOS - Sierra, High Sierra, Mojave\r\n\r\nWhat is happening, is that after the first Puppet run, Puppet will fail to run again and throw the following error. If we delete the cache in /opt/puppetlabs/puppet/cache, we can re-run Puppet again, however the error will then re-occur on the next run, and the cache will need deleting again.\r\n\r\n{code}\r\nError: Could not create resources for managing Puppet"s files and directories in sections [:main, :agent, :ssl]: undefined method `exists?" for nil:NilClass\r\nError: Could not prepare for execution: Could not create resources for managing Puppet"s files and directories in sections [:main, :agent, :ssl]: undefined method `exists?" for nil:NilClass\r\nundefined method `exists?" for nil:NilClass\r\n{code}\r\n\r\nThis also happens in no-op mode, so I speculate it"s something to do with merely downloading the cache files from the server.\r\n\r\nI"d like to stress that we"re only seeing this on freshly reinstalled Macs (using Apple"s internet recovery). Macs new from the shop are fine.\r\n\r\nThanks\r\n\r\nJT', 'https://tickets.puppetlabs.com/browse/PUP-9825', 'https://github.com/puppetlabs/puppet/pull/8635', '2019-07-11T05:38:56.000-0700', '2021-07-13T03:38:35.000-0700', '2021-07-13T03:38:35.000-0700', 'Closed', 'doc-reviewed', 10, '0', 1, 32, 4, 2, '1ed5b391f71daf6fb6b57265737deae30be06e81', 'https://tickets.puppetlabs.com/browse/PUP-9825', 'https://github.com/puppetlabs/puppet/pull/8635'),
('puppet', 200793, 675834042, 8653, 'Puppet may fail if setting values appear to be numerics', '/etc/puppetlabs/puppet/puppet.conf\r\ncertname = 000000000180\r\n------------------------------------------------------------------------------------------------------\r\n Error: Could not parse /etc/puppetlabs/puppet/puppet.conf: invalid value for Integer(): "000000000180"                                                                             \r\nError: Could not request certificate: Failed to open TCP connection to puppet:8140 (getaddrinfo: Name\r\n or service not known)                                   \r\nExiting; failed to retrieve certificate and waitforcert is disabled\r\n------------------------------------------------------------------------------------------------------\r\ncertname in quotations makes puppet agent run but then an error on the server side is thrown:\r\nError: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: invalid value for Integer(): "000000000180"\r\n', 'https://tickets.puppetlabs.com/browse/PUP-7785', 'https://github.com/puppetlabs/puppet/pull/8653', '2017-07-18T07:17:45.000-0700', '2021-07-13T03:42:37.000-0700', '2021-07-13T03:42:37.000-0700', 'Resolved', 'doc-reviewed', 4, '0', 1, 1, 0, 1, '311f3b51803548c20780973c6815e4c535ee1706', 'https://tickets.puppetlabs.com/browse/PUP-7785', 'https://github.com/puppetlabs/puppet/pull/8653'),
('puppet', 201900, 668459778, 8631, 'Puppet::Resources.search fails if conditions provided', 'The [Puppet::Resource::Ral indirection|https://github.com/puppetlabs/puppet/blob/5.0.1/lib/puppet/indirector/resource/ral.rb#L24-L27] appears to attempt to convert ral to_resource() twice when you provide search criteria (shown here with package).  I"m guessing the specs are mocked such as to be validating the broken behavior.\r\n\r\n{code}\r\nrequire "puppet"\r\nrequire "pp"\r\n\r\npackages = Puppet::Resource.indirection.search("package")\r\npp packages.find { |r| r.name == "Package/bash" }\r\n\r\nbegin\r\n  Puppet::Resource.indirection.search("package/bash")\r\nrescue Exception => e\r\n  pp e.backtrace\r\n  puts e\r\nend\r\n\r\nbegin\r\n  Puppet::Resource.indirection.search("package", {:ensure => "installed"})\r\nrescue Exception => e\r\n  pp e.backtrace\r\n  puts e\r\nend\r\n{code}\r\n\r\n{code}\r\njpartlow@percival:~/work/src/pl/puppet$ be ruby test.rb \r\nPackage[bash]{:name=>"bash", :ensure=>"4.3-7ubuntu1.7", :provider=>:apt, :configfiles=>:keep, :reinstall_on_refresh=>:false, :loglevel=>:notice}\r\n["/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `block (2 levels) in search"",\r\n "/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `each"",\r\n "/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `all?"",\r\n "/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `block in search"",\r\n "/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:26:in `each"",\r\n "/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:26:in `find_all"",\r\n "/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:26:in `search"",\r\n "/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/indirection.rb:270:in `search"",\r\n "test.rb:8:in `<main>""]\r\nundefined method `to_resource" for #<Puppet::Resource:0x007f1c8e0d57f8>\r\n["/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `block (2 levels) in search"",\r\n "/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `each"",\r\n "/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `all?"",\r\n "/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:27:in `block in search"",\r\n "/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:26:in `each"",\r\n "/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:26:in `find_all"",\r\n "/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/resource/ral.rb:26:in `search"",\r\n "/home/jpartlow/work/src/pl/puppet/lib/puppet/indirector/indirection.rb:270:in `search"",\r\n "test.rb:15:in `<main>""]\r\nundefined method `to_resource" for #<Puppet::Resource:0x007f1c8dacac00>\r\n{code}', 'https://tickets.puppetlabs.com/browse/PUP-7799', 'https://github.com/puppetlabs/puppet/pull/8631', '2017-07-21T16:37:00.000-0700', '2021-07-13T03:43:32.000-0700', '2021-07-13T03:43:32.000-0700', 'Closed', 'doc-reviewed', 2, '0', 2, 46, 76, 2, '31e6d83a110e7ed00ee0efe5a287acbbcdaeb0c4', 'https://tickets.puppetlabs.com/browse/PUP-7799', 'https://github.com/puppetlabs/puppet/pull/8631'),
('puppet', 244849, 668698129, 8632, 'Repository error message uri is missing part of the path', 'We had a problem with our artifactory server, where it would return a 404 for the Puppet repository it was providing. This caused an error message to appear, about 404 errors. I tried to install the module manually (or search for it) and also got a 404 error:\r\n{code:java}\r\n[root@puppetmaster ~]# puppet module --debug search saz-sudo\r\nDebug: Runtime environment: puppet_version=5.3.5, ruby_version=2.4.3, run_mode=user, default_encoding=UTF-8\r\nNotice: Searching https://artifactory.domain.com/artifactory/api/puppet/puppet ...\r\nDebug: HTTP GET https://artifactory.domain.com/artifactory/api/puppet/puppet/artifactory/api/puppet/puppet/v3/modules?query=saz-sudo&module_groups=base%20pe_only\r\nError: Request to Puppet Forge failed.\r\n  The server being queried was https://artifactory.domain.com/v3/modules?query=saz-sudo&module_groups=base%20pe_only\r\n  The HTTP response we received was "404 "\r\nError: Try "puppet help module search" for usage {code}\r\n \r\n\r\nBefore adding the debug flag, I thought that the puppet module tool was loosing the "path" part of the "module_repository" configuration when it read it from the puppet.conf, vs when it was specified on the command line. This was not the case, but it led to a lot of pointless troubleshooting. The error message should have the correct URL that failed.\r\n\r\n \r\n\r\nNOTICE the difference between:\r\n{code:java}\r\nDebug: HTTP GET https://artifactory.domain.com/artifactory/api/puppet/puppet/artifactory/api/puppet/puppet/v3/modules?query=saz-sudo&module_groups=base%20pe_only {code}\r\n... and:\r\n{code:java}\r\nThe server being queried was https://artifactory.domain.com/v3/modules?query=saz-sudo&module_groups=base%20pe_only {code}\r\n ', 'https://tickets.puppetlabs.com/browse/PUP-8650', 'https://github.com/puppetlabs/puppet/pull/8632', '2018-04-09T14:43:23.000-0700', '2021-07-13T04:00:18.000-0700', '2021-07-13T04:00:18.000-0700', 'Closed', 'beginner;doc-reviewed;help_wanted', 6, '0', 1, 24, 3, 2, 'a5511f8e5eaa2fa741b3c04c23dc3908f8bf5511', 'https://tickets.puppetlabs.com/browse/PUP-8650', 'https://github.com/puppetlabs/puppet/pull/8632'),
('puppet', 379509, 670533538, 8637, 'puppet filebucket fails when using non-default environment from master', '*Puppet Version:* 5.5.21\r\n *Puppet Server Version:* 5.3.8\r\n *OS Name/Version:* RHEL 7\r\n\r\nWhen using a non default environment (something other than {{production}}) on a puppet agent from the puppet master, for example {{testenv}}, running {{puppet filebucket -l list --bucket /opt/puppetlabs/puppet/cache/clientbucket/ fails with Puppet::Environments::EnvironmentNotFound}}\r\n\r\n*Desired Behavior:* {{puppet filebucket}} uses Puppet environment from {{/etc/puppetlabs/puppet/puppet.conf and runs successfully.}}\r\n\r\n*Actual Behavior:*\r\n\r\n \r\n{noformat}\r\n $ sudo puppet filebucket -l list --bucket /opt/puppetlabs/puppet/cache/clientbucket/ \r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:38:in `get!": Could not find a directory environment named "testenv" anywhere in the path: /etc/puppetlabs/code/environments. Does the directory exist? (Puppet::Environments::EnvironmentNotFound)\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application_support.rb:34:in `push_application_context"\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:363:in `run"\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:139:in `run"\r\n        from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:77:in `execute"\r\n        from /opt/puppetlabs/puppet/bin/puppet:5:in `<main>"\r\n$ puppet --version\r\n5.5.21\r\n$ ls -lhatr /etc/puppetlabs/code/environments/ total 0 drwxr-xr-x. 4 root root 41 Jul 3 07:34 .. drwxr-xr-x. 3 root root 24 Jul 3 07:34 . drwxr-xr-x. 5 root root 92 Aug 21 01:30 production\r\n$ cat /etc/puppetlabs/puppet/puppet.conf\r\n[main]\r\nenvironment = testenv\r\nserver = puppetmaster.example.com\r\nruntimeout = 1h\r\nsplay = true\r\nsplaylimit = 3m\r\nstrict_variables = true\r\ngraph = true\r\n{noformat}', 'https://tickets.puppetlabs.com/browse/PUP-10796', 'https://github.com/puppetlabs/puppet/pull/8637', '2020-12-01T12:28:20.000-0800', '2021-07-13T04:47:18.000-0700', '2021-07-13T04:47:18.000-0700', 'Closed', 'beginner;doc-reviewed;help_wanted', 3, '0', 1, 12, 0, 2, '3f7321361522982a43158a0f7bc2a202eaaad9cd', 'https://tickets.puppetlabs.com/browse/PUP-10796', 'https://github.com/puppetlabs/puppet/pull/8637'),
('puppet', 405015, 680952931, 8663, 'Cached environment may not be deleted if the directory is removed', 'Puppet::Environments::Cached#list returns environments that exist on disk and either caches the entry or updates its ttl. However, if an environment is in the cache, but is no longer on disk, then it is not removed from the cache. This shouldn"t be an issue with r10k/code manager, because they explicitly delete the environment or all environments after purging the directory. But it could lead to consistency problems if the REST request never occurs or fails. The following shows how after the environment is deleted, it is not returned from the {{list}} method, yet it is still cached:\r\n{code:ruby}require "puppet"\r\nPuppet.initialize_settings(["--environment_timeout", "unlimited"])\r\nPuppet::Util::Log.newdestination(:console)\r\n\r\nname = "test#{Process.pid}"\r\ntestdir = File.join(Puppet[:environmentpath], name)\r\nFileUtils.mkdir_p(testdir)\r\n\r\nPuppet::ApplicationSupport.push_application_context(Puppet::Util::RunMode[:user])\r\n\r\nenvs = Puppet.lookup(:environments)\r\nenvs.get!(:production)\r\nenvs.get!(name)\r\n\r\nputs "Listed #{envs.list.map(&:name).join(", ")} environments"\r\n\r\nFileUtils.rm_rf(testdir)\r\nputs "Deleted #{name} environment"\r\n\r\nputs "Listed #{envs.list.map(&:name).join(", ")} environments"\r\nputs "Cached #{envs.instance_variable_get(:@cache).keys.join(", ")} environments"\r\n{code}\r\n{noformat}❯ ls  ~/.puppetlabs/etc/code/environments/\r\nproduction/\r\n\r\n❯ bx ruby envs.rb                         \r\nListed test2597598, production environments\r\nDeleted test2597598 environment\r\nListed production environments\r\nCached production, test2597598 environments\r\n{noformat}', 'https://tickets.puppetlabs.com/browse/PUP-11129', 'https://github.com/puppetlabs/puppet/pull/8663', '2021-06-28T17:24:00.000-0700', '2021-07-13T04:49:57.000-0700', '2021-07-13T04:49:57.000-0700', 'Resolved', 'doc-reviewed', 2, '0', 1, 45, 0, 2, '6b61e64c4fcbefd875d874a1d1e117df614977f8', 'https://tickets.puppetlabs.com/browse/PUP-11129', 'https://github.com/puppetlabs/puppet/pull/8663'),
('puppet', 143699, 672810193, 8647, 'Can"t run puppet resource on agent with environment specified in main section', 'See also https://tickets.puppetlabs.com/browse/PUP-6048\r\n\r\nGiven a traditional Prod, Dev, Test scenario, and a desire to use MCollective\r\nGiven the desire to configure an environment in the agent"s puppet.conf to cut down on log messages\r\nGiven the need to put the environment setting in [main] and not [agent] so that MCollective also knows the environment\r\n\r\nIf one manually runs puppet commands on a non-production node, such as puppet resource, one gets an error:\r\n\r\n[root@dev-node ~]# puppet resource service puppet ensure=running enable=true\r\n/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/environments.rb:38:in `get!": Could not find a directory environment named "development" anywhere in the path: /etc/puppetlabs/code/environments. Does the directory exist? (Puppet::Environments::EnvironmentNotFound)\r\n	from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application_support.rb:29:in `push_application_context"\r\n	from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:337:in `run"\r\n	from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:128:in `run"\r\n	from /opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:72:in `execute"\r\n	from /usr/local/bin/puppet:5:in `<main>"\r\n\r\nHowever, if one impersonates the production environment, it works as expected:\r\n\r\n[root@dev-node ~]# puppet resource service puppet ensure=running enable=true --environment production\r\nNotice: /Service[puppet]/ensure: ensure changed "stopped" to "running"\r\nservice { "puppet":\r\n  ensure => "running",\r\n  enable => "true",\r\n}\r\n\r\nThis inconsistency is frustrating to customers, regardless of the reasoning behind it. It requires retraining of their staff doing manual operations and lots of comments in their cron jobs, etc. ', 'https://tickets.puppetlabs.com/browse/PUP-6554', 'https://github.com/puppetlabs/puppet/pull/8647', '2016-07-27T06:32:48.000-0700', '2021-07-13T04:50:52.000-0700', '2021-07-13T04:50:52.000-0700', 'Resolved', 'customer;doc-reviewed', 9, '0', 1, 50, 3, 2, '5c358565b07100d98d9371a2685e243f8e7e5c3d', 'https://tickets.puppetlabs.com/browse/PUP-6554', 'https://github.com/puppetlabs/puppet/pull/8647'),
('puppet', 391432, 675541436, 8652, 'Puppet always prints errors in debug when trying to resolve account to SID', 'Puppet on Windows shows the following errors when running with debugging:\r\n\r\n{noformat}\r\nC:\> puppet agent -t --debug\r\n...\r\nDebug: Processing report from xxx with processor Puppet::Reports::Store\r\nDebug: Could not retrieve raw SID bytes from "Administrator": Failed to convert string SID: Administrator:  The security ID structure is invalid.\r\nDebug: Could not retrieve raw SID bytes from "Administrator": Failed to convert string SID: Administrator:  The security ID structure is invalid.\r\n{noformat}\r\n\r\nThis debugging was added in https://github.com/puppetlabs/puppet/commit/bea9ff75d5946dbb92c90ef068cf6c2d4cb0db85. However, the {{name_to_principal}} method is sometimes called with valid account names like {{Administrator}}, so the call to {{string_to_sid_ptr}} fails with ({{ERROR_INVALID_SID}} 0x539 and the debug message is printed.\r\n\r\nI think it"d be better to check if {{name}} starts with something like {{S-\d+-\d+}} or only log the error if {{e.code != 0x539}}. For example, if the SID string refers to an account that doesn"t exist, you"ll get 0x534 {{ERROR_NONE_MAPPED}}.', 'https://tickets.puppetlabs.com/browse/PUP-10967', 'https://github.com/puppetlabs/puppet/pull/8652', '2021-03-16T18:16:23.000-0700', '2021-07-13T05:04:40.000-0700', '2021-07-13T05:04:40.000-0700', 'Resolved', 'doc-reviewed', 2, '0', 1, 42, 5, 2, '658b3f0ef876576a5dfa14e6f6495a2866462681', 'https://tickets.puppetlabs.com/browse/PUP-10967', 'https://github.com/puppetlabs/puppet/pull/8652'),
('puppet', 401529, 671572178, 8644, 'Setting age=0 on a tidy resource does not remove all files', '*Puppet Version:* any\r\n *Puppet Server Version:* n/a\r\n *OS Name/Version:* n/a\r\n\r\nThe documentation for the {{age}} parameter for the {{tidy}} type states:\r\n{quote}Tidy files whose age is *equal to or greater* than the specified time. You can choose seconds, minutes, hours, days, or weeks by specifying the first letter of any of those words (for example, ‘1w’ represents one week).\r\n\r\nDocs: [https://puppet.com/docs/puppet/7.7/types/tidy.html#tidy-attribute-age]\r\n\r\n*Specifying 0 will remove all files*.\r\n{quote}\r\n*Desired Behavior:*\r\n\r\nSetting {{age=0}} removes all files\r\n\r\n*Actual Behavior:*\r\n\r\nSetting {{age=0}} requires the target file to be at least 1 second old.\r\n\r\nThis was discovered when writing integration tests for the {{puppet resource}} subcommand (PUP-11074).\r\n\r\nRelevant code: [https://github.com/puppetlabs/puppet/blob/b91e53a38cb4671d4de9078837c05931c69121f9/lib/puppet/type/tidy.rb#L147]\r\n{code}    def tidy?(path, stat)\r\n      # If the file"s older than we allow, we should get rid of it.\r\n      (Time.now.to_i - stat.send(resource[:type]).to_i) > value\r\n    end\r\n{code}\r\nNote that the greater than or equal comparison is respected for the {{size}} parameter:\r\n{code}    def tidy?(path, stat)\r\n      stat.size >= value\r\n    end\r\n{code}', 'https://tickets.puppetlabs.com/browse/PUP-11079', 'https://github.com/puppetlabs/puppet/pull/8644', '2021-06-03T06:21:34.000-0700', '2021-07-13T05:06:50.000-0700', '2021-07-13T05:06:50.000-0700', 'Resolved', 'doc-reviewed', 1, '0', 1, 8, 1, 2, 'a76ae479db62a34fdb8b6df3f6097f9ec3c48f29', 'https://tickets.puppetlabs.com/browse/PUP-11079', 'https://github.com/puppetlabs/puppet/pull/8644'),
('puppet', 155635, 671638544, 8645, 'agent_specified_environment fact doesn"t populate with the environment setting in the [agent] section', 'Currently, if I want to use the agent_specified_environment fact, I need to set the environment setting in puppet.conf in the [main] section.\r\n\r\nIf I happen to be hitting this bug: PUP-6048, this isn"t possible.  \r\n\r\nPutting the environment setting in the [agent] section works around PUP-6048, but doesn"t allow me to use agent_specified_environment, the fact ends up empty.', 'https://tickets.puppetlabs.com/browse/PUP-6801', 'https://github.com/puppetlabs/puppet/pull/8645', '2016-10-06T16:33:51.000-0700', '2021-07-13T05:12:16.000-0700', '2021-07-13T05:12:16.000-0700', 'Resolved', 'doc-reviewed', 4, '0', 3, 189, 102, 6, '7722e3a19a97ff5517eaed003243752f3a613178', 'https://tickets.puppetlabs.com/browse/PUP-6801', 'https://github.com/puppetlabs/puppet/pull/8645'),
('puppet', 395833, 683420491, 8675, 'pip ensure=>latest fails with pip>=20.3.0', '*Puppet Version: 6.21.1*\r\n *Puppet Server Version: 6.15.1*\r\n *OS Name/Version: Ubuntu 18.04 and MacOS 10.15*\r\n\r\n*Desired Behavior:*\r\n\r\nA package is installed:\r\n\r\n{code:puppet}\r\npackage { "my_package":\r\n  ensure => latest,\r\n  provider => "pip3",\r\n  install_options => [ "--extra-index-url", "http://artifactory.mydomain.com:8081/artifactory/api/pypi/pypi-virtual/simple",\r\n"--trusted-host", "artifactory.mydomain.com" ],\r\n}\r\n{code}\r\n\r\nNormal behavior is that puppet keeps this package updated to latest.\r\n\r\n*Actual Behavior:*\r\n\r\n\r\nThis fails. I believe the failure is due to a change in the output of pip when ==versionplease is used:\r\n\r\nlooks like a change in behavior after pip20.2.4 (so 20.3 and 21). Previously if you sent a weird version (like my_package==versionplease) you would get a result like this:\r\n\r\n{code}\r\nLooking in indexes: [https://pypi.org/simple], [http://artifactory.mydomain.com:8081/artifactory/api/pypi/pypi-virtual/simple|http://artifactory.arxan.com:8081/artifactory/api/pypi/pypi-virtual/simple]\r\nERROR: Could not find a version that satisfies the requirement my_package==versionplease (from versions: 2.33.6, 2.33.8, 2.33.9, 2.33.112, 2.34.7, 2.34.113, 2.34.114, 2.34.115, 2.35.116, 2.35.117, 2.35.118, 2.35.119, 2.35.120, 2.35.121, 2.35.122, 2.35.123, 2.35.124, 3.0.1, 3.0.2, 3.0.3, 3.0.4, 3.0.5, 3.0.6, 3.0.7, 3.0.8, 3.0.9, 3.0.125, 3.0.126, 3.0.127, 3.0.128, 3.0.129, 3.0.130, 3.0.131, 3.0.132, 3.0.138, 3.0.139, 3.0.143, 3.0.146, 3.0.147, 3.0.148, 3.0.149, 3.0.153, 3.0.154, 3.0.156, 3.0.157, 3.0.159, 3.0.160, 3.0.161, 3.0.162, 3.0.163, 3.0.164, 3.0.165, 3.0.166, 3.0.167, 3.0.168, 3.0.169, 3.0.170, 3.0.171, 3.0.172, 3.1.10, 3.1.11, 3.1.12, 3.1.13, 3.1.17, 3.1.20, 3.1.21, 3.1.22, 3.1.23, 3.1.24, 3.2.25, 3.2.26, 3.2.27, 3.2.28, 3.2.35, 3.2.36, 3.2.37, 3.2.38, 3.2.39, 3.2.40, 3.2.41, 3.2.42, 3.2.43, 3.2.44, 3.2.45, 3.2.46, 3.2.47, 3.2.48, 3.2.49, 3.2.50, 3.2.51, 3.2.52, 3.2.53, 3.2.56, 3.2.59, 3.2.64, 3.2.65, 3.2.66, 3.2.74, 3.2.75, 3.2.83, 3.2.87, 3.2.88, 3.2.89, 3.2.90, 3.2.92, 3.2.94, 3.2.97, 3.2.99, 3.2.102, 3.2.104, 3.2.116, 3.2.118, 3.2.119, 3.2.121, 3.2.123, 3.2.125, 3.2.127, 3.2.131, 3.2.136, 3.2.138, 3.2.159, 3.2.163, 4.0.168, 4.0.170, 4.0.171, 4.0.173, 4.0.175, 4.0.176, 4.0.177, 4.0.178, 4.0.179, 4.0.182, 4.0.183, 4.0.187, 4.0.189, 4.0.190, 4.0.191, 4.0.192, 4.0.193, 4.0.196, 4.0.197, 4.0.198, 4.0.199, 4.0.203, 4.0.226, 4.0.228, 4.0.230, 4.0.234, 4.0.235, 4.0.236, 4.0.237, 4.0.239, 4.0.240, 4.0.242, 4.0.243, 4.0.244, 4.0.245, 4.0.246, 4.0.248, 4.0.276, 4.0.277, 4.0.278, 4.0.279, 4.0.280, 4.0.281, 4.0.282, 4.0.299, 4.0.300, 4.0.309, 4.0.315, 4.0.316, 4.0.319, 4.0.328, 4.0.329, 4.0.333, 4.0.334, 5.335, 6.0.13, 6.0.14, 6.0.15, 6.0.16, 6.0.19, 6.0.20, 6.0.22, 6.0.336, 6.0.337, 6.0.338, 6.0.340, 6.0.351, 6.0.352, 6.0.353, 6.0.355, 6.0.357, 6.0.362, 6.0.363, 6.0.366, 6.0.368, 6.0.369, 6.0.370, 6.0.374, 6.1.27, 6.1.28, 6.1.29, 6.1.30, 6.1.31, 6.1.33, 6.1.34, 6.1.35, 6.1.37, 7.0.48, 7.0.49, 7.0.50, 7.0.51, 7.0.54, 7.0.55, 7.0.56, 7.0.58, 7.0.59, 7.0.62, 7.0.64, 7.0.65, 7.0.66, 7.0.67, 7.0.68, 7.0.70, 7.0.73, 7.0.74, 7.0.76, 7.0.78, 7.0.81, 7.0.82, 7.0.84, 7.0.85, 7.0.86, 7.0.88, 7.0.89, 7.0.91, 7.0.93, 7.0.96, 7.0.97, 7.0.98, 7.0.99, 7.0.105, 7.0.106)\r\nERROR: No matching distribution found for my_package==versionplease\r\n{code}\r\n\r\nAfter 20.3 you get this:\r\n{code}\r\nLooking in indexes: [https://pypi.org/simple], [http://artifactory.my_domain.com:8081/artifactory/api/pypi/pypi-virtual/simple|http://artifactory.arxan.com:8081/artifactory/api/pypi/pypi-virtual/simple]\r\nERROR: Could not find a version that satisfies the requirement my_package==versionplease\r\nERROR: No matching distribution found for my_package==versionplease\r\n{code}\r\n\r\nSo puppet"s parsing to figure out if it needs to install a new version to satisfy "ensure => latest" doesn"t work. This is using puppet 6.21.1. Backing down to pip==20.2.4 gets everything working again.', 'https://tickets.puppetlabs.com/browse/PUP-11029', 'https://github.com/puppetlabs/puppet/pull/8675', '2021-04-16T10:08:53.000-0700', '2021-07-13T05:13:04.000-0700', '2021-07-13T05:13:04.000-0700', 'Resolved', 'doc-reviewed', 2, '0', 1, 52, 3, 2, 'a79fcb7464fdc005953db645591b2df276c36c6e', 'https://tickets.puppetlabs.com/browse/PUP-11029', 'https://github.com/puppetlabs/puppet/pull/8675'),
('puppet', 306584, 279790113, 7528, 'User resource sets password on every puppet agent run (Windows)', '*Puppet Version: 5.5.10\r\n*Puppet Server Version: 	5.3.7\r\n*OS Name/Version:* WIndows Server 2016\r\n\r\nWhen using the following simple code to set the Administrator password on Windows:\r\n\r\n{code:java}\r\n$adminpassword = "slkdhfl@#$slkW223" \r\n\r\nif $adminpassword { \r\n    user { "Administrator": \r\n    ensure => present, \r\n    password => $adminpassword, \r\n    } \r\n} \r\n{code}\r\n\r\nThe above sets the password correctly but if \r\n{code:java}\r\nDeny access to this computer from the network\r\n{code}\r\n local group policy has been configured for members of the Administrator group, the password will get applied on every puppet agent run.\r\n\r\nThis has been reproduced locally on my Windows 2016 box where Deny access to this computer from the network has been set for the admin group, using the above code and puppet apply.\r\n\r\n*Desired Behavior:* Corrective change for the password happens on the first puppet only.\r\n\r\n\r\n*Actual Behavior:* Corrective change for the password gets made on every puppet run.\r\n\r\n\r\n', 'https://tickets.puppetlabs.com/browse/PUP-9688', 'https://github.com/puppetlabs/puppet/pull/7528', '2019-04-29T03:25:21.000-0700', '2021-07-20T08:29:04.000-0700', '2021-07-20T08:29:04.000-0700', 'Resolved', 'resolved-issue-added', 3, '0', 1, 33, 4, 2, 'e031bc742bdbd820bf08748abef0e272104deb60', 'https://tickets.puppetlabs.com/browse/PUP-9688', 'https://github.com/puppetlabs/puppet/pull/7528'),
('puppet', 143764, 78947900, 5150, 'Dir.glob in Ruby 2.3 has changed behavior on Windows, can break code loading', 'Ruby 2.3 addressed a bug in {{Dir.glob}} on Windows - https://bugs.ruby-lang.org/issues/10819 with commit https://github.com/ruby/ruby/commit/45df1c24d269f93a2bc1e7a6fe0ffcecc1193051\r\n\r\nUnfortunately this has changed the behavior in such a way that prevents file paths from being compared as they were previously.  Previously an 8.3 style file path was passed to {{Dir.glob}} and it returned {{8.3}} style paths in Ruby 2.1.  Due to bug fix 10819, the paths are now expanded from {{8.3}} paths.\r\n\r\nThis should also involve adding a new test, so that AppVeyor catches the problem (which it currently does *not*)\r\n\r\n\r\nAnalysis of the various call sites led to this gist - showing any time an Environment / Environment / Module was created - https://gist.github.com/Iristyle/9389f62d60a402f861df8a98012535c9', 'https://tickets.puppetlabs.com/browse/PUP-6557', 'https://github.com/puppetlabs/puppet/pull/5150', '2016-07-27T10:48:47.000-0700', '2021-07-22T17:15:10.000-0700', '2021-07-22T17:15:10.000-0700', 'Closed', 'windows', 5, '0', 1, 78, 12, 9, 'ffc1762eaa164f9db96d458cc13fd8bfdb4e5545', 'https://tickets.puppetlabs.com/browse/PUP-6557', 'https://github.com/puppetlabs/puppet/pull/5150'),
('puppet', 283012, 297432614, 7609, '`puppet facts upload` always uses environment "production" ignoring setting from puppet.conf', 'We have nodes with environment different than default "production", in here it"s "qa":\r\n{code}\r\n[root@app03.XXX:~]# cat /etc/puppet/puppet.conf\r\n(...)\r\n[agent]\r\nreport      = true\r\nruninterval = 1800\r\nenvironment = qa\r\nsplay = true\r\n{code}\r\n\r\nBut if we upload facts using `puppet facts upload` always environment "production" is being used:\r\n{code}\r\n[root@app03.XXX:~]# /opt/puppetlabs/puppet/bin/puppet facts upload --debug\r\nDebug: Runtime environment: puppet_version=5.5.2, ruby_version=2.4.4, run_mode=user, default_encoding=UTF-8\r\nDebug: Evicting cache entry for environment "production"\r\n(...)\r\n{code}\r\n\r\nIn puppetdb facts from such nodes have "facts_environment" set to "production", while "report_environment" and "catalog_environment" are set correctly to "qa".\r\n\r\nIf you simply run "puppet agent -t" facts with correct environment, "qa", are being uploaded. \r\n\r\n', 'https://tickets.puppetlabs.com/browse/PUP-9290', 'https://github.com/puppetlabs/puppet/pull/7609', '2018-10-30T05:37:50.000-0700', '2021-08-03T15:13:02.000-0700', '2021-08-03T15:13:02.000-0700', 'Closed', '', 5, '0', 1, 1, 1, 1, '', 'https://tickets.puppetlabs.com/browse/PUP-9290', 'https://github.com/puppetlabs/puppet/pull/7609'),
('puppet', 405825, 698046315, 8716, 'An environment may be reloaded during a single compilation', 'The environment cache"s keys may be strings or symbols, so you can end up with same environment cached under two different names (see PUP-10955). We tried fixing the issue, but it turns out we"re currently relying on the symbol/string confusion to prevent an environment from being reloaded during a compilation.\r\n\r\nFor example, given this script:\r\n\r\n{code:ruby}\r\nrequire "puppet"\r\nLocale.current = "ja_JP"\r\nPuppet.initialize_settings\r\nPuppet::GettextConfig.setup_locale\r\nPuppet::Resource::Catalog.indirection.terminus_class = :compiler\r\nPuppet[:log_level] = "debug"\r\nPuppet::Util::Log.newdestination(:console)\r\n\r\nPuppet::ApplicationSupport.push_application_context(Puppet::Util::RunMode[:server])\r\ncatalog = Puppet::Resource::Catalog.indirection.find(Puppet[:certname], environment: :production)\r\nputs catalog.resource(:notify, "happy")[:message]\r\n{code}\r\n\r\nResults in the following:\r\n{code}\r\n$ bundle exec puppet module install eputnam-i18ndemo\r\n$ bundle exec ruby envs.rb\r\n...\r\nDebug: Loaded translations for puppetlabs-stdlib.\r\nDebug: Loaded translations for eputnam-i18ndemo.\r\nDebug: Evicting cache entry for environment "production"\r\nDebug: Deleted current text domain :production: true\r\nDebug: Path to /home/josh/.puppetlabs/etc/code/environments/production does not exist, using default environment.conf\r\n...`\r\nNotice: Compiled catalog for localhost in environment production in 0.02 seconds\r\n--*IT"S HAPPY FUN TIME*--\r\nyppah\r\n--*IT"S HAPPY FUN TIME*--\r\n{code}\r\n\r\nNote the translations are loaded, but the environment is cleared and the text domain is deleted prior to compilation, so we end up with the non-localized message {{IT"S HAPPY FUN TIME}}.\r\n\r\nChanging the {{environment}} parameter to a string, prevents the environment from being cleared:\r\n\r\n{code:ruby}\r\ncatalog = Puppet::Resource::Catalog.indirection.find(Puppet[:certname], environment: "production")\r\n{code}\r\n\r\nAnd we get the localized message:\r\n{code}\r\n--*eputnam-i18ndemo function: それは楽しい時間です*--\r\nyppah\r\n--*eputnam-i18ndemo function: それは楽しい時間です*--\r\n{code}\r\n\r\nWe should be explicit about not reloading an environment during a single compilation. If environment_timeout=0, then the environment should be reloaded during the next compilation (or any indirected request).\r\n\r\nAlso [~maggie] says it"s important for versioned code deploys to keep the same environment object throughout a compile.', 'https://tickets.puppetlabs.com/browse/PUP-11158', 'https://github.com/puppetlabs/puppet/pull/8716', '2021-07-02T16:43:10.000-0700', '2021-08-11T05:59:47.000-0700', '2021-08-11T05:59:47.000-0700', 'Resolved', 'doc-reviewed', 5, '0', 1, 26, 171, 5, 'e86d11c57cf0875b140504cc33a75d5e7a0e5a5a', 'https://tickets.puppetlabs.com/browse/PUP-11158', 'https://github.com/puppetlabs/puppet/pull/8716'),
('puppet', 300842, 682008022, 8672, 'Catalog failure on first run due to pluginsync and environment switch', 'On the first run, the Puppet agent can fail to run due to a catalog failure, if its environment assignment in the classifier is based on facts.\r\n\r\nWhat will happen is:\r\n\r\n# The new agent queries node terminus to determine environment to pluginsync against\r\n# Master queries classifier with no facts to determine environment\r\n# The classifier returns some default environment value, because the fact that matches the node to the correct environment node group has not been uploaded and saved to PuppetDB yet\r\n# The agent pluginsync"s against this default environment\r\n# The agent uploads its facts and requests a catalog\r\n# The master queries the classifier _with_ the facts\r\n# The classifier returns the _correct_ environment\r\n# The master starts compiling a catalog using the correct environment\r\n# The correct environment"s Puppet code expects one or more facts to be available, but they are not. The absence of these facts causes the catalog compilation to fail.\r\n# The agent aborts the run due to the catalog compilation failure.\r\n\r\nFor example:\r\n\r\nSet up an environment called "default" with no modules. Assign this environment as the default.\r\n\r\nSet up an environment called "production". Install the puppetlabs-stdlib module, and give it a site.pp that looks like:\r\n\r\n{code}\r\nif ($facts["puppet_server"] == undef) {\r\n  fail("No value provided for facts.puppet_server!")\r\n}\r\n{code}\r\n\r\nSet up the classifier so that nodes are assigned the "Production environment" env node group if they have {{puppet_environment = production}} as a fact.\r\n\r\n !Screenshot 2019-03-19 11.52.33.png|width=500! \r\n\r\nThen run Puppet *for the first time* on a new agent. It will get something like this:\r\n\r\n{code}\r\npuppet agent [root@pe-xl-core-2 ~]# puppet agent -t\r\nNotice: Local environment: "production" doesn"t match server specified node environment "default", switching agent to "default".\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nNotice: /File[/opt/puppetlabs/puppet/cache/lib/facter]/ensure: created\r\nNotice: /File[/opt/puppetlabs/puppet/cache/lib/facter/aio_agent_build.rb]/ensure: defined content as "{md5}cdcc1ff07bc245c66cc1d46be56b3af5"\r\nNotice: /File[/opt/puppetlabs/puppet/cache/lib/facter/aio_agent_version.rb]/ensure: defined content as "{md5}d05c8cbf788f47d33efd46a935dda61e"\r\n[...]\r\nNotice: /File[/opt/puppetlabs/puppet/cache/lib/shared/pe_build.rb]/ensure: defined content as "{md5}4f4652af20c4f0391b9ca2976940a710"\r\nNotice: /File[/opt/puppetlabs/puppet/cache/lib/shared/pe_server_version.rb]/ensure: defined content as "{md5}f3d3fc8776512ae73d3293c97b8f3dfe"\r\nInfo: Retrieving locales\r\nInfo: Loading facts\r\nError: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Function Call, No value provided for facts.puppet_server! (file: /et\r\nc/puppetlabs/code/environments/production/manifests/site.pp, line: 4, column: 3) on node pe-xl-core-2.dev33.puppet.vm\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\n[root@pe-xl-core-2 ~]#\r\n{code}\r\n\r\n*What would be better*:\r\n\r\nRather than trying to compile a catalog if the agent pluginsync"d the wrong environment, fail fast. Don"t compile a catalog the agent is going to throw away anyway. Tell the agent to try again. The agent already has logic to retry, and wouldn"t use a catalog with the "wrong" environment anyway.', 'https://tickets.puppetlabs.com/browse/PUP-9570', 'https://github.com/puppetlabs/puppet/pull/8672', '2019-03-19T11:55:16.000-0700', '2021-08-11T06:00:43.000-0700', '2021-08-11T06:00:43.000-0700', 'Resolved', '001G000001p3dQmIAI;doc-reviewed;jira_escalated', 17, '0', 5, 143, 3, 11, '55c0a8187def07efd88a751a66532919b3af7c54', 'https://tickets.puppetlabs.com/browse/PUP-9570', 'https://github.com/puppetlabs/puppet/pull/8672'),
('puppet', 390307, 698108990, 8717, 'Environment caches string and symbol environment names differently', 'The {{Puppet::Environments::Cached#get}} method says it accepts Strings or Symbols, but it  doesn"t normalize the name when getting/setting the environment in the cache. So you can end up caching environments for {{"production"}} and {{:production}}. \r\n\r\nAgent side we lookup the environment based on the {{Puppet[:environment]}} setting. Server side we lookup the [{{environment}} from a query parameter|https://github.com/puppetlabs/puppet/blob/12401c3af42cfbae41b48621f5b42336db1ace1d/lib/puppet/network/http/api/indirected_routes.rb#L95]. But there are other entry points like Bolt and non-indirected REST APIs, so it would be good to fix this.\r\n\r\n{code:ruby}\r\nrequire "puppet"\r\nPuppet.initialize_settings\r\nPuppet::Util::Log.newdestination(:console)\r\nPuppet::ApplicationSupport.push_application_context(Puppet::Util::RunMode[:user])\r\nenvs = Puppet.lookup(:environments)\r\nenvs.get!("production")\r\nenvs.get!(:production)\r\npp envs.instance_variable_get(:@cache).keys\r\n{code}\r\n\r\n{noformat}\r\n$ bx ruby cache.rb\r\n["production", :production]\r\n{noformat}', 'https://tickets.puppetlabs.com/browse/PUP-10955', 'https://github.com/puppetlabs/puppet/pull/8717', '2021-03-08T12:41:19.000-0800', '2021-08-11T06:10:22.000-0700', '2021-08-11T06:10:22.000-0700', 'Resolved', 'doc-reviewed', 5, '0', 1, 71, 3, 3, '0d8c1d5a1b70674450fd80e919d198ab919bcb46', 'https://tickets.puppetlabs.com/browse/PUP-10955', 'https://github.com/puppetlabs/puppet/pull/8717'),
('puppet', 347236, 687706302, 8689, 'Puppet.lookup(:current_environment) is wrong if environment changes during convergence', 'At the start of the configurer run, puppet pushes its configured environment (from Puppet[:environment]) or the server-specified environment (from the ENC) onto the context in https://github.com/puppetlabs/puppet/blob/6.13.0/lib/puppet/configurer.rb#L319-L331\r\n\r\nHowever, if pluginsync causes environment to change, then the agent switches to the new environment, but {{Puppet.lookup(:current_environment)}} still returns old value, while {{Puppet::Resource::Catalog#environment}} returns the new value:\r\n\r\n{noformat}\r\n$ bx puppet agent -t\r\nInfo: Using configured environment "production"\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nNotice: Local environment: "production" doesn"t match server specified environment "dev", restarting agent run with environment "dev"\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Caching catalog for XXX\r\nInfo: Applying configuration version "1582308523"\r\n\r\n[261, 270] in /Users/josh/work/puppet/lib/puppet/type/file/source.rb\r\n   261:       end\r\n   262:     end\r\n   263:\r\n   264:     def each_chunk_from\r\n   265:       require "byebug"; byebug\r\n=> 266:       if Puppet[:default_file_terminus] == :file_server && scheme == "puppet" && (uri.host.nil? || uri.host.empty?)\r\n   267:         chunk_file_from_disk(metadata.path) { |chunk| yield chunk }\r\n   268:       elsif local?\r\n   269:         chunk_file_from_disk(full_path) { |chunk| yield chunk }\r\n   270:       else\r\n(byebug) Puppet.lookup(:current_environment)\r\n<Puppet::Node::Environment::Remote:70205531253460 @name="production" @manifest="no_manifest" @modulepath="" >\r\n(byebug) resource.catalog.environment\r\n"dev"\r\n{noformat}\r\n\r\nPuppet relies on the catalog"s environment being correct when retrieving file metadata & content, such as https://github.com/puppetlabs/puppet/blob/6.13.0/lib/puppet/type/file/source.rb#L194', 'https://tickets.puppetlabs.com/browse/PUP-10308', 'https://github.com/puppetlabs/puppet/pull/8689', '2020-02-21T10:11:11.000-0800', '2021-08-11T06:12:56.000-0700', '2021-08-11T06:12:56.000-0700', 'Resolved', '001G000001p3dQmIAI;doc-reviewed', 1, '0', 1, 23, 0, 2, '50f377a57e2cedb809879f2492a80cabb603d7b0', 'https://tickets.puppetlabs.com/browse/PUP-10308', 'https://github.com/puppetlabs/puppet/pull/8689'),
('puppet', 406437, 686372661, 8683, 'launchd service provider fails if a parsable but invalid LaunchAgent or LaunchDaemon plist file exists', 'If a file in the {{LaunchAgents}} or {{LaunchDaemons}} paths is encountered that"s parseable by {{Puppet::Util::Plist.read_plist_from_file}} but not a valid {{launchd}} plist file, then Puppet will crash with an error.\r\n\r\nTo reproduce:\r\n{code}\r\n# echo "aaa" >/Library/LaunchDaemons/invalid.txt\r\n# puppet resource service\r\nError: Could not run: undefined method `has_key?" for "aaa":String\r\n{code}\r\n\r\nIn [launchd.rb line 141|https://github.com/puppetlabs/puppet/blob/aa1df95ab3c8ee5bd8f007ba45cca422b1de2498/lib/puppet/provider/service/launchd.rb#L141], the parsed plist ({{job}}) is checked with {{.has_key?}} to ensure  a {{Label}} is present. If the parsed plist is not a {{Hash}}, though, this will fail.\r\n\r\nI expect the correct course of action is to add a {{job.is_a?(Hash)}} check first.', 'https://tickets.puppetlabs.com/browse/PUP-11164', 'https://github.com/puppetlabs/puppet/pull/8683', '2021-07-08T15:49:27.000-0700', '2021-08-11T06:23:30.000-0700', '2021-08-11T06:23:30.000-0700', 'Resolved', 'doc-reviewed', 2, '0', 1, 12, 1, 2, '557fb61e9089ff513b7efe86f927afe864d91612', 'https://tickets.puppetlabs.com/browse/PUP-11164', 'https://github.com/puppetlabs/puppet/pull/8683'),
('puppet', 390409, 686122909, 8682, 'pkg provider cannot unhold and update package in the same run', '*Puppet Version:* starting with 5.5.19, 6.13.0 and 7.0.0\r\n *Puppet Server Version:* n/a\r\n *OS Name/Version:* Solaris 11\r\n\r\nDescribe your issue in as much detail as possible…\r\n\r\nAfter the addition of the {{mark}} property, a package cannot pe unheld and updated in the same run.\r\n\r\nDescribe steps to reproduce…\r\n\r\nAssuming {{mypkg}} is installed with version 0.0.2, and held/frozen, apply the following manifest:\r\n\r\n{code}\r\npackage {mypkg : ensure=>"0.0.3", mark=>"none", provider=>"pkg"}\r\n{code}\r\n\r\n*Desired Behavior:*\r\n\r\nThe package is unheld/unfrozen, and updated to 0.0.3\r\n\r\n*Actual Behavior:*\r\n\r\nPuppet attempts to update the package first, which results in:\r\n\r\n{code}\r\nDebug: Executing: "/usr/bin/pkg update -n mypkg@0.0.3,5.11:20210309T130735Z"\r\nError: No version of mypkg matching 0.0.3 is installable, even though the package is currently installed\r\nError: /Stage[main]/Main/Package[mypkg]/ensure: change from "0.0.2,5.11:20210309T130605Z" to "0.0.3" failed: No version of mypkg matching 0.0.3 is installable, even though the package is currently installed\r\n{code}\r\n\r\nAttempting to manually run {{pkg update}} gives:\r\n{code}\r\nCreating Plan (Solver setup): \\r\npkg update: No matching version of mypkg can be installed:\r\n  Reject:  pkg://tstpub.lan/mypkg@0.0.3,5.11:20210309T130735Z\r\n  Reason:  This version is excluded by a freeze on mypkg at version 0.0.2,5.11:20210309T130605Z.\r\n{code}\r\n', 'https://tickets.puppetlabs.com/browse/PUP-10956', 'https://github.com/puppetlabs/puppet/pull/8682', '2021-03-09T05:27:23.000-0800', '2021-08-11T06:24:36.000-0700', '2021-08-11T06:24:36.000-0700', 'Resolved', 'doc-reviewed', 2, '0', 1, 61, 5, 3, '7ef40abb91e11ceceaaf8fe6f8ce28c12aa1ed0c', 'https://tickets.puppetlabs.com/browse/PUP-10956', 'https://github.com/puppetlabs/puppet/pull/8682'),
('puppet', 407578, 698741196, 8718, 'undefined method `[]" for nil:NilClass when handling SemanticPuppet::Dependency::UnsatisfiableGraph', '*Installed Software*\r\n # rpm -qa |grep -E "(puppet|pdk)"\r\n puppet7-release-7.0.0-2.el7.noarch\r\n puppet-agent-7.8.0-1.el7.x86_64\r\n pdk-2.1.1.0-1.el7.x86_64\r\n\r\n \r\n\r\n*Steps to reproduce*\r\n\r\nI am trying to deploy a custom puppet module and I went through:\r\n\r\nrake build:pdk\r\n\r\nthen:\r\n\r\npuppet module install ./path/to/OUR_MODULE_NAME-3.0.0.tar.gz --debug\r\n\r\n \r\n\r\n*Desired Behavior:*\r\n\r\nOur module with all dependencies be installed\r\n\r\n*Actual Behavior:*\r\n\r\nCode exits non-zero trying to call ..constraints[*nil*].first[1]\r\n\r\n \r\n\r\nIt seems like the error is caused because of a logical issue at:\r\n\r\n[https://github.com/puppetlabs/puppet/blob/main/lib/puppet/module_tool/applications/installer.rb#L141]\r\n\r\nWith some janky\r\n{quote}{\{ rescue SemanticPuppet::Dependency::UnsatisfiableGraph => e}}\r\n {{  unsatisfied = nil}}\r\n {{  pp "e"}}\r\n {{  pp e}}\r\n {{  pp "e.respond_to?(:unsatisfied)"}}\r\n {{  pp e.respond_to?(:unsatisfied)}}\r\n {{  pp "e.respond_to?(:unsatisfied)"}}\r\n {{  pp e.respond_to?(:unsatisfied)}}\r\n{quote}\r\nThe output below shows that `e` does respond to :unsatisfied, but e.unsatisfied is nil, so when it"s called on L167 it fails\r\n\r\n \r\n{quote}{{$ puppet module install ./pkg/OUR_MODULE_NAME-3.0.0.tar.gz --debug}}\r\n {{Debug: Runtime environment: puppet_version=7.8.0, ruby_version=2.7.3, run_mode=user, default_encoding=UTF-8}}\r\n {{Notice: Preparing to install into /home/vagrant/.puppetlabs/etc/code/modules ...}}\r\n {{Debug: Could not find library "archive/tar/minitar" required to enable feature "minitar"}}\r\n {{Debug: Executing: "gzip -dc /REDACTED/pkg/OUR_MODULE_NAME-3.0.0.tar.gz | tar xof -"}}\r\n {{Debug: Executing: "find . -type d -exec chmod 755 {} +"}}\r\n {{Debug: Executing: "find . -type f -exec chmod u+rw,g+r,a-st {} +"}}\r\n {{Debug: Executing: "chown -R 1000:1000 ."}}\r\n {{Debug: Unpacked local tarball to /home/vagrant/.puppetlabs/opt/puppet/cache/OUR_MODULE_NAME/cache/local-tarball20210721-26316-1jpeh2d}}\r\n {{Notice: Downloading from [https://forgeapi.puppet.com|https://forgeapi.puppet.com/] ...}}\r\n {{Debug: Could not find library "pe_license" required to enable feature "pe_license"}}\r\n {{Debug: Creating new connection for [https://forgeapi.puppet.com:443|https://forgeapi.puppet.com/]}}\r\n {{Debug: Starting connection for [https://forgeapi.puppet.com:443|https://forgeapi.puppet.com/]}}\r\n {{Debug: Using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384}}\r\n {{Debug: HTTP GET [https://forgeapi.puppet.com/v3/releases?module=cds-puppet&sort_by=version&exclude_fields=readme%2Cchangelog%2Clicense%2Curi%2Cmodule%2Ctags%2Csupported%2Cfile_size%2Cdownloads%2Ccreated_at%2Cupdated_at%2Cdeleted_at] returned 200 OK}}\r\n {{Debug: Caching connection for [https://forgeapi.puppet.com:443|https://forgeapi.puppet.com/]}}\r\n {{Debug: Using cached connection for [https://forgeapi.puppet.com:443\r\n|https://forgeapi.puppet.com/]}}{{<SOME OUTPUT OMITTED>}}|\r\n\r\n{{Debug: Caching connection for [https://forgeapi.puppet.com:443|https://forgeapi.puppet.com/]}}\r\n {{Debug: Using cached connection for [https://forgeapi.puppet.com:443|https://forgeapi.puppet.com/]}}\r\n {{Debug: HTTP GET [https://forgeapi.puppet.com/v3/releases?module=thias-postfix&sort_by=version&exclude_fields=readme%2Cchangelog%2Clicense%2Curi%2Cmodule%2Ctags%2Csupported%2Cfile_size%2Cdownloads%2Ccreated_at%2Cupdated_at%2Cdeleted_at] returned 200 OK}}\r\n {{Debug: Caching connection for [https://forgeapi.puppet.com:443|https://forgeapi.puppet.com/]}}\r\n {{Info: Resolving dependencies ...}}\r\n{quote}\r\n{quote}{{"e"}}\r\n {{#<SemanticPuppet::Dependency::UnsatisfiableGraph: Could not find satisfying releases for OUR_MODULE_NAME>}}\r\n {{"e.unsatisfied"}}\r\n {{nil}}\r\n {{"e.respond_to?(:unsatisfied)"}}\r\n {{true}}\r\n{quote}\r\n{quote}{{Error: undefined method `[]" for nil:NilClass}}\r\n {{Error: Try "puppet help module install" for usage}}\r\n{quote}\r\n \r\n\r\n*Bonus Info* \r\n * I am only seeing this now because I have finally been able to schedule time on upgrading from puppet 5, and am going straight to 7.\r\n * rake works:\r\n ** check\r\n ** rubocop\r\n ** lint\r\n ** metadata_lint\r\n ** validate', 'https://tickets.puppetlabs.com/browse/PUP-11172', 'https://github.com/puppetlabs/puppet/pull/8718', '2021-07-21T03:16:26.000-0700', '2021-08-11T06:25:16.000-0700', '2021-08-11T06:25:16.000-0700', 'Resolved', 'doc-reviewed', 6, '0', 1, 47, 16, 2, 'd5f6b69174fdd36a862d45af7d4ce3f035a20736', 'https://tickets.puppetlabs.com/browse/PUP-11172', 'https://github.com/puppetlabs/puppet/pull/8718'),
('puppet', 410089, 705057884, 8732, 'Allow loading from scripts mount when loading Task files', 'When loading files specified in Task metadata, Puppet specifies which mounts those files can be loaded from. This adds the scripts mount to the list of mounts that Task files can be loaded from.', 'https://tickets.puppetlabs.com/browse/PUP-11200', 'https://github.com/puppetlabs/puppet/pull/8732', '2021-08-05T15:11:52.000-0700', '2021-08-12T01:43:21.000-0700', '2021-08-12T01:43:21.000-0700', 'Resolved', 'doc-reviewed', 2, '0', 1, 28, 4, 4, 'ab668b3029ec1047cf45a0eb88ad396e95facb99', 'https://tickets.puppetlabs.com/browse/PUP-11200', 'https://github.com/puppetlabs/puppet/pull/8732'),
('puppet', 379779, 688117746, 8692, 'Unable to install rpm packages via provides of the package', '*Puppet Version: 6.14*\r\n *OS Name/Version: CentOS 8.2*\r\n\r\nIt is not possible to install an rpm package via an provides name of the package.\r\n\r\nSample:\r\n{code:java}\r\npackage { "dnf-plugin-post-transaction-actions": ensure => installed} {code}\r\nit will fails with:\r\n{code:java}\r\nError: Execution of "/usr/bin/dnf -d 0 -e 1 -y list dnf-plugin-post-transaction-actions" returned 1: Error: No matching Packages to list{code}\r\nbecause dnf list only work with real package names, not with package provides.\r\n\r\nBut an blind dnf call will work:\r\n{code:java}\r\nLANG=C dnf install dnf-plugin-post-transaction-actions\r\nLast metadata expiration check: 0:00:11 ago on Thu Dec  3 12:02:50 2020.\r\nDependencies resolved.\r\n===================================================================================================================================================================================================================\r\n Package                                                                     Architecture                           Version                                           Repository                              Size\r\n===================================================================================================================================================================================================================\r\nInstalling:\r\n python3-dnf-plugin-post-transaction-actions                                 noarch                                 4.0.12-4.el8_2                                    BaseOS                                  51 kTransaction Summary\r\n===================================================================================================================================================================================================================\r\nInstall  1 Package\r\n\r\n{code}\r\nIt will provides:\r\n{code:java}\r\ndnf download dnf-plugin-post-transaction-actions\r\npython3-dnf-plugin-post-transaction-actions-4.0.12-4.el8_2.noarch.rpm\r\n\r\nrpm -qp --provides python3-dnf-plugin-post-transaction-actions-4.0.12-4.el8_2.noarch.rpm\r\nconfig(python3-dnf-plugin-post-transaction-actions) = 4.0.12-4.el8_2\r\ndnf-plugin-post-transaction-actions = 4.0.12-4.el8_2\r\npython3-dnf-plugin-post-transaction-actions = 4.0.12-4.el8_2\r\n{code}\r\nSo it can be installed via dnf install dnf-plugin-post-transaction-actions. But puppet can"t handle package provides of an rpm package. So doing the same with puppet will fail.\r\n\r\n ', 'https://tickets.puppetlabs.com/browse/PUP-10798', 'https://github.com/puppetlabs/puppet/pull/8692', '2020-12-03T03:08:14.000-0800', '2021-08-24T02:08:46.000-0700', '2021-08-24T02:08:46.000-0700', 'Accepted', '', 0, '0', 1, 2, 2, 2, '', 'https://tickets.puppetlabs.com/browse/PUP-10798', 'https://github.com/puppetlabs/puppet/pull/8692'),
('puppet', 342644, 365686529, 7937, 'Puppet gem has no/missing development/test gems', 'Hi,\r\n\r\nI took a look at the puppet gem dependencies for the latest release:\r\n\r\nhttps://rubygems.org/gems/puppet/versions/6.12.0\r\n\r\nIt lists a few runtime dependencies, but no additional dependencies for development/test. Could you add gems required to execute the test suite as well?', 'https://tickets.puppetlabs.com/browse/PUP-10240', 'https://github.com/puppetlabs/puppet/pull/7937', '2020-01-19T10:35:24.000-0800', '2021-09-03T11:04:58.000-0700', '2021-09-03T11:04:58.000-0700', 'Closed', '', 5, '0', 4, 33, 26, 6, '', 'https://tickets.puppetlabs.com/browse/PUP-10240', 'https://github.com/puppetlabs/puppet/pull/7937'),
('puppet', 152161, 715425975, 8741, 'Agent does not save local copy of last_run_report.yaml if submission to report server fails', 'On an Ubuntu 16.04 VM running Puppet 1.6.2 agent:\r\n\r\nThe agent does not appear to save a run report if it fails to submit the report to its report server.\r\n\r\n*Repro*\r\n{code}\r\nroot@ubuntu16:~# puppet agent -t --server=foo:1 --report_server=bar:2 --http_connect_timeout=3s --http_debug\r\nopening connection to foo:1:8140...\r\nWarning: Unable to fetch my node definition, but the agent run will continue:\r\nWarning: execution expired\r\nInfo: Retrieving pluginfacts\r\nopening connection to foo:1:8140...\r\nError: /File[/opt/puppetlabs/puppet/cache/facts.d]: Failed to generate additional resources using "eval_generate": execution expired\r\nopening connection to foo:1:8140...\r\nError: /File[/opt/puppetlabs/puppet/cache/facts.d]: Could not evaluate: Could not retrieve file metadata for puppet:///pluginfacts: execution expired\r\nInfo: Retrieving plugin\r\nopening connection to foo:1:8140...\r\nError: /File[/opt/puppetlabs/puppet/cache/lib]: Failed to generate additional resources using "eval_generate": execution expired\r\nopening connection to foo:1:8140...\r\nError: /File[/opt/puppetlabs/puppet/cache/lib]: Could not evaluate: Could not retrieve file metadata for puppet:///plugins: execution expired\r\nInfo: Loading facts\r\nopening connection to foo:1:8140...\r\nError: Could not retrieve catalog from remote server: execution expired\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\nopening connection to bar:2:8140...\r\nError: Could not send report: execution expired\r\n# Afterward, no report is saved on the agent:\r\nroot@ubuntu16:~# ls /opt/puppetlabs/puppet/cache/\r\nclientbucket  client_data  client_yaml  facts.d  lib  preview  state\r\nroot@ubuntu16:~# ls /opt/puppetlabs/puppet/cache/state/\r\nclasses.txt  graphs  last_run_summary.yaml  resources.txt  state.yaml  transactionstore.yaml\r\n{code}\r\n\r\n', 'https://tickets.puppetlabs.com/browse/PUP-6708', 'https://github.com/puppetlabs/puppet/pull/8741', '2016-09-15T14:40:34.000-0700', '2021-09-08T02:30:52.000-0700', '2021-09-08T02:30:52.000-0700', 'Resolved', 'doc-reviewed', 11, '0', 2, 49, 9, 7, '01f39811f0fe804e12a9439cf20fbcd18b27f015', 'https://tickets.puppetlabs.com/browse/PUP-6708', 'https://github.com/puppetlabs/puppet/pull/8741'),
('puppet', 386484, 715374669, 8740, 'lookup fails if module lookup_options are empty', 'Doing a test on a module with hiera that has an empty `lookup_options:` will result in errors during unit tests like \r\n\r\n \r\n      # --- Caused by: ---\r\n      # NoMethodError:\r\n      #   undefined method `each_pair" for nil:NilClass\r\n      #   /opt/puppetlabs/pdk/private/puppet/ruby/2.4.0/gems/puppet-5.5.21/lib/puppet/pops/lookup/lookup_adapter.rb:292:in `validate_lookup_options"', 'https://tickets.puppetlabs.com/browse/PUP-10890', 'https://github.com/puppetlabs/puppet/pull/8740', '2021-02-05T12:57:32.000-0800', '2021-09-08T02:31:27.000-0700', '2021-09-08T02:31:27.000-0700', 'Resolved', 'community;doc-reviewed', 6, '0', 2, 67, 2, 2, 'd2eae86fd7b08fd931f3928f4e888c597b6d2711', 'https://tickets.puppetlabs.com/browse/PUP-10890', 'https://github.com/puppetlabs/puppet/pull/8740'),
('puppet', 408666, 708766285, 8737, 'User resource not removing password on AIX agents', '*Puppet Version:* 7.8.0\r\n*Puppet Server Version:* PE 2021.2 (	7.2.0) \r\n*OS Name/Version:* AIX 7.2\r\n\r\nwhen deleting a user with Puppet (User resource type), the password entry in /etc/security/passwd is not being cleaned up.\r\n\r\nResource definition example:\r\n\r\n{code:java}\r\n  user { "saaddm":\r\n    ensure     => "absent",\r\n    managehome => true\r\n  }\r\n \r\n{code}\r\n\r\n\r\nDebug:\r\n\r\n(130)PROD:root@xxxxxx:/root# puppet agent -t --debug 2>&1 | grep rmuser\r\nDebug: Executing: "/usr/sbin/rmuser saaddm"\r\n(0)PROD:root@xxxxxx:/root#\r\n\r\n*Desired Behavior:* password gets cleaned up\r\n\r\n\r\n*Actual Behavior:* password is still present in /etc/security/passwd\r\n\r\n\r\n', 'https://tickets.puppetlabs.com/browse/PUP-11190', 'https://github.com/puppetlabs/puppet/pull/8737', '2021-07-27T05:48:35.000-0700', '2021-09-08T02:46:43.000-0700', '2021-09-08T02:46:43.000-0700', 'Resolved', 'doc-reviewed;jira_escalated', 1, '0', 1, 15, 0, 2, 'bb27df9fc857aaf09769d8967c16db6183b5d0a7', 'https://tickets.puppetlabs.com/browse/PUP-11190', 'https://github.com/puppetlabs/puppet/pull/8737'),
('puppet', 407149, 701766276, 8725, 'User resource unable to remove user"s home directory when set to absent in AIX', 'OS agent: AIX 7.1 or 7.2\r\n\r\nwhen using the following manifest with puppet apply to create finch user\r\n\r\n{code:java}\r\ninclude add_user\r\nclass add_user {\r\n  # add user, create homedir and set a password\r\n  user { "finch":\r\n    ensure     => "present",\r\n    comment    => "H Finch",\r\n    managehome => true,\r\n    # note the single quotes to stop $ expanding\r\n    password   => "Pa$$w0rd",\r\n    home       => "/home/finch",\r\n  }\r\n\r\n}\r\n{code}\r\n\r\nthe user finch gets created along with its home folder as expected\r\n\r\nThen, if we use the following manifest to get rid of the same user\r\n\r\n{code:java}\r\ninclude delete_user\r\nclass delete_user{\r\n\r\n user { "finch":\r\n   ensure           => "absent",\r\n   managehome       => true,\r\n   home             => "/home/finch",\r\n }\r\n}\r\n{code}\r\n\r\nthe user finch gets deleted but its home folder (/home/finch) is left behind.\r\n\r\nI have used the same code in centos7 and both user and home folder gets deleted at once as expected\r\n\r\n*Desired Behavior:*\r\n\r\nthe code should work in the same manner independently of the OS platform - here AIX and centos\r\n\r\n*Actual Behavior:*\r\n\r\ncode is not removing deleted user"s home directory in AIX\r\n\r\n\r\n', 'https://tickets.puppetlabs.com/browse/PUP-11170', 'https://github.com/puppetlabs/puppet/pull/8725', '2021-07-16T09:33:13.000-0700', '2021-09-08T02:47:32.000-0700', '2021-09-08T02:47:32.000-0700', 'Resolved', 'doc-reviewed;jira_escalated', 1, '0', 1, 167, 27, 4, '374bc3e7953d670cfd3136ef13cc1eabb94ebc09', 'https://tickets.puppetlabs.com/browse/PUP-11170', 'https://github.com/puppetlabs/puppet/pull/8725'),
('puppet', 409781, 719689971, 8747, 'puppet warns about BOM and US-ASCII encoding', 'The fix for PUP-8243 causes ruby to generate a warning if the default external encoding is US-ASCII:\r\n{noformat}/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/file_system/file_impl.rb:83: warning: BOM with non-UTF encoding US-ASCII is nonsense \r\n{noformat}\r\nSince ASCII characters are single bytes, there is no need for a BOM to detect byte ordering (LSB/MSB), hence the message. I had assumed ruby would just ignore the `bom` prefix.\r\n\r\nWe"ll need to check that the current external encoding starts with `utf-` (case-insensitively I think), and only add the `bom` prefix if it does.\r\n\r\nSee [https://github.com/puppetlabs/puppet/pull/8639#issuecomment-891939114]\r\n\r\nTo reproduce:\r\n{noformat}$ bx ruby -e "Encoding.default_external = "US-ASCII"; require "puppet"; Puppet::FileSystem.read_preserve_line_endings("Gemfile")"\r\n/home/josh/work/puppet/lib/puppet/file_system/file_impl.rb:83: warning: BOM with non-UTF encoding US-ASCII is nonsense\r\n{noformat}', 'https://tickets.puppetlabs.com/browse/PUP-11196', 'https://github.com/puppetlabs/puppet/pull/8747', '2021-08-03T10:57:52.000-0700', '2021-09-08T02:52:25.000-0700', '2021-09-08T02:52:25.000-0700', 'Resolved', 'doc-reviewed', 2, '0', 1, 10, 1, 2, '6418310105f2eae06deefbcbf2d8342162564908', 'https://tickets.puppetlabs.com/browse/PUP-11196', 'https://github.com/puppetlabs/puppet/pull/8747'),
('puppet', 329731, 714961512, 8739, 'regression: puppet resource --to_yaml should not emit puppet class tags', 'From https://tickets.puppetlabs.com/browse/PUP-7808?focusedCommentId=693345&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-693345\r\n\r\nThis change caused a regression. The option --to_yaml no longer generates syntactically valid YAML.\r\n\r\nBefore pull request #7718:\r\n{code:java}\r\nmysql_database:\r\n  PERCONA_SCHEMA:\r\n    ensure : "present"\r\n    charset: "utf8"\r\n    collate: "utf8_general_ci"\r\n{code}\r\nAfter pull request #7718:\r\n{code:java}\r\nmysql_database:\r\n  PERCONA_SCHEMA:\r\n    ensure: present\r\n    charset: !ruby/string:Puppet::Util::Execution::ProcessOutput utf8\r\n    collate: !ruby/string:Puppet::Util::Execution::ProcessOutput utf8_general_ci\r\n{code}', 'https://tickets.puppetlabs.com/browse/PUP-10105', 'https://github.com/puppetlabs/puppet/pull/8739', '2019-10-16T08:15:44.000-0700', '2021-09-08T02:53:11.000-0700', '2021-09-08T02:53:11.000-0700', 'Resolved', 'doc-reviewed;jira_escalated', 16, '0', 4, 57, 15, 6, 'bbe8cfdf84fcdbafdee18f31c2f40d13a196eda7', 'https://tickets.puppetlabs.com/browse/PUP-10105', 'https://github.com/puppetlabs/puppet/pull/8739'),
('puppet', 21360, 723034657, 8753, 'Change --write-catalog-summary option into a config setting', '# Overview #\r\nThe classes.txt file is only written when running Puppet in the agent run mode.\r\n\r\nIt would be useful for integration with MCollective filtering if this\r\nfile were also written when running Puppet the stand alone apply run\r\nmode.\r\n\r\n{code}\r\n# The file in which puppet agent stores a list of the classes\r\n# associated with the retrieved configuration.  Can be loaded in\r\n# the separate `puppet` executable using the `--loadclasses`\r\n# option.\r\n# The default value is "$statedir/classes.txt".\r\nclassfile = /var/lib/puppet/state/classes.txt\r\n{code}\r\n\r\nThis would be useful with MCollective"s configuration setting of:\r\n\r\n    classesfile = /var/lib/puppet/state/classes.txt\r\n\r\n# Impact Data #\r\n\r\nAt least one community member has requested this feature.  (See comments below).\r\n\r\nThis ticket is important for mcollective integration with "puppet apply."', 'https://tickets.puppetlabs.com/browse/PUP-1042', 'https://github.com/puppetlabs/puppet/pull/8753', '2013-12-16T03:01:33.000-0800', '2021-09-13T04:09:20.000-0700', '2021-09-13T04:09:20.000-0700', 'Resolved', 'doc-reviewed;redmine', 11, '0', 2, 111, 60, 5, 'aff8428d7a19ea255dd74dd0dcd5cbfe5d701516', 'https://tickets.puppetlabs.com/browse/PUP-1042', 'https://github.com/puppetlabs/puppet/pull/8753'),
('puppet', 266411, 203635778, 6943, 'Autoloader module_directories should not include duplicate modules', 'The autoloader"s {{module_directories}} method can return the same module multiple times, or more likely different versions of the same module. This can lead to situations where the autoloader loads a type from one version of the module, but a provider from a different version.\r\n\r\nThe {{module_directories}} method should only return the first instance of the module in the modulepath, which is how other parts of puppet, eg Puppet::Pops::Loaders, file serving, load facts from modules, and PMT.', 'https://tickets.puppetlabs.com/browse/PUP-9018', 'https://github.com/puppetlabs/puppet/pull/6943', '2018-07-24T12:36:28.000-0700', '2021-09-13T21:40:50.000-0700', '2021-09-13T21:40:50.000-0700', 'Accepted', '', 1, '0', 2, 34, 10, 2, '', 'https://tickets.puppetlabs.com/browse/PUP-9018', 'https://github.com/puppetlabs/puppet/pull/6943'),
('puppet', 300292, 325337939, 7768, 'User resource does not respect forcelocal for the comment parameter', 'A user resource configured with {{forcelocal}} will still try to sync the comment with the external directory services. It does use the `lusermod` to modify the local `/etc/passwd` to the comment specified in the user resource, but it compares the `in_sync` with the external directory services, meaning that it always updates the comment on catalog compilation.\r\n\r\n*Reproduction*:\r\n1. Configure an agent with LDAP\r\n2. Ensure nsswitch.conf has LDAP before `files` for `passwd`\r\n3. Add a user to LDAP with a comment. Below is an example user.\r\n{code}testuser:*:510:10:test:/home/test:/bin/bash\r\n{code}\r\n4. Apply the following manifest on the agent multiple times and observe that it tries to update the comment every time.\r\n{code}user{"test":\r\n  ensure => present,\r\n  forcelocal => true,\r\n  comment => "local comment",\r\n  uid => "510",\r\n  gid => "10",\r\n}\r\n{code}\r\n*Expected Behavior*:\r\nThe agent should check the local passwd file for the comment as per [https://github.com/puppetlabs/puppet/blob/master/lib/puppet/provider/user/useradd.rb#L58-L72]', 'https://tickets.puppetlabs.com/browse/PUP-9562', 'https://github.com/puppetlabs/puppet/pull/7768', '2019-03-14T11:48:45.000-0700', '2021-09-14T18:09:29.000-0700', '2021-09-14T18:09:29.000-0700', 'Resolved', 'resolved-issue-added', 0, '0', 2, 66, 11, 2, '980b2060e30f7d9bb81160d5f7809fe1810851b0', 'https://tickets.puppetlabs.com/browse/PUP-9562', 'https://github.com/puppetlabs/puppet/pull/7768'),
('puppet', 410096, 708377610, 8736, 'Refine when the last used environment is used', 'With the recent changes in PUP-10216, the agent stores the last used environment in {{last_run_summary.yaml}}. If the next run does not specify an environment on the CLI, then the last used environment *always* takes precedence over the environment specified in puppet.conf. For example, given:\r\n{noformat}# puppet agent -t --environment feature_branch\r\n# puppet agent -t\r\n{noformat}\r\nIf the agent is allowed to specify its environment:\r\n\r\nPrior to PUP-10216, the second run would use the original configured environment from puppet.conf or default to "production".\r\n\r\nAfter PUP-10216, the second run uses the "feature_branch" environment. This is also true if the second run occurs in the background (systemd/cron), which is especially surprising.\r\n\r\nIn cases where the agent is *not* allowed to specify its environment, the last used environment provides the same function that the node request did. So the agent"s behavior before and after PUP-10216 is the same, assuming the agent pluginsync"ed the right set of facts and classification doesn"t change between runs.\r\n\r\nThis ticket proposes we make an exception for the agent-specified case so that the second run only uses the environment from the previous run if it was server-specified. Otherwise, the agent should start in its configured environment (from puppet.conf) or default to "production".\r\n\r\nSo I think this means:\r\n # If environment specified on CLI, use it\r\n # If last environment was server-specified, use it\r\n # Otherwise use our configured environment {{Puppet[:environment]}}\r\n\r\nI think we can detect if the last environment was server-specified by saving both the initial environment and the converged environment in {{last_run_summary.yaml}}. If those are different, then the server told us to use a different environment.\r\n\r\nIf they are the same, then it doesn"t matter if it"s agent or server-specified, just use Puppet[:environment]\r\n\r\nInitial should be initially set with the values from first run (step 1 or 3) and carried over, not overwritten with values received from server', 'https://tickets.puppetlabs.com/browse/PUP-11201', 'https://github.com/puppetlabs/puppet/pull/8736', '2021-08-05T17:04:02.000-0700', '2021-09-27T05:53:00.000-0700', '2021-09-27T05:53:00.000-0700', 'Resolved', '', 9, '0', 1, 2, 2, 1, '8392cb6aefde42509895af45c5db2bfae111cc64', 'https://tickets.puppetlabs.com/browse/PUP-11201', 'https://github.com/puppetlabs/puppet/pull/8736'),
('puppet', 387947, 730451587, 8761, 'Default timeout not respected for Windows services', '*Puppet Version: 6.21.1*\r\n *Puppet Server Version: n/a*\r\n *OS Name/Version: Windows*\r\n\r\nWindows services have a timeout for service-related operations that defaults to 30 seconds, as seen here: [https://github.com/puppetlabs/puppet/blob/e4a654400a4c1ad3b5bc73fb558d28219a4626b2/lib/puppet/util/windows/service.rb#L24]\r\n\r\nThis variable is used in the following method: [https://github.com/puppetlabs/puppet/blob/c6412ea369aa1613ca166b10fb819fcf6130814b/lib/puppet/provider/service/windows.rb#L118]\r\n\r\nThe method is called in the base service type: [https://github.com/puppetlabs/puppet/blob/e4a654400a4c1ad3b5bc73fb558d28219a4626b2/lib/puppet/type/service.rb#L301]\r\n\r\n*Desired Behavior:*\r\n\r\nNot setting the timeout parameter on a Windows service should cause it to default to 30 seconds.\r\n\r\n*Actual Behavior:*\r\n\r\nNot setting the timeout parameter on a Windows services causes it to default to 10 seconds.\r\n\r\n \r\n\r\nThe line in the service type should change from:\r\n{code}\r\ndefaultto { provider.class.respond_to?(:default_timeout) ? provider.default_timeout : 10 }\r\n{code}\r\n\r\nto\r\n\r\n{code}\r\ndefaultto { provider.respond_to?(:default_timeout) ? provider.default_timeout : 10 }\r\n{code}', 'https://tickets.puppetlabs.com/browse/PUP-10925', 'https://github.com/puppetlabs/puppet/pull/8761', '2021-02-18T08:01:49.000-0800', '2021-10-05T05:09:52.000-0700', '2021-10-05T05:09:52.000-0700', 'Resolved', 'community;doc-reviewed', 0, '0', 2, 35, 3, 2, 'ab3870c90552a70041cf7115b1a81a01c86768c2', 'https://tickets.puppetlabs.com/browse/PUP-10925', 'https://github.com/puppetlabs/puppet/pull/8761'),
('puppet', 415709, 734897392, 8767, 'Not all user attributes honor forcelocal (e.g. home, shell)', '*Puppet Version:* 6.19.1, 7.9.0\r\n*Puppet Server Version:* N/A\r\n*OS Name/Version:* CentOS 7\r\n\r\nWhen setting {{forcelocal => true}} on a {{user}} resource, I"d expect all user attributes available via {{/etc/passwd}} to be used as the "is" value for the insync? check.\r\n\r\nThis appears to not be the case for the {{home}} and {{shell}} attributes.\r\n\r\nThose are always checked against their values from directory services rather than from {{/etc/passwd}}, which means those attributes appear to change on each puppet run and the {{user}} resource is no longer idempotent.\r\n\r\n*Desired Behavior:*\r\n\r\nWhen an OS has directory services enabled (e.g. LDAP via SSSD) and a puppet-managed user exists in LDAP...\r\n\r\nGiven an {{/etc/passwd}} file containing:\r\n{noformat}\r\nnate:x:1000:1001:hello world:/opt/hello:/bin/zsh\r\n{noformat}\r\n\r\nThis code should read "shell", "home", and "comment" all from {{/etc/passwd}} when comparing the "is" state to the "should" state:\r\n{code}\r\nuser { "nate":\r\n  ensure     => present,\r\n  forcelocal => true,\r\n  shell      => "/bin/zsh",\r\n  home       => "/opt/hello",\r\n  comment    => "hello world",\r\n}\r\n{code}\r\n\r\n*Actual Behavior:*\r\n\r\nOnly "uid", "gid", "comment", and "groups" are fetched from {{/etc/passwd}} when {{forcelocal => true}}:\r\nhttps://github.com/puppetlabs/puppet/blob/7.11.0/lib/puppet/provider/user/useradd.rb#L60-L78\r\n\r\n"home" and "shell" are fetched from directory services, not from {{/etc/passwd}}.\r\n\r\nThe user resource shows a change to "home" and "shell" on each Puppet run even though nothing is changing.\r\n\r\n\r\n*Related:*\r\nSupport for "comment" when forcelocal is true was added here: https://github.com/puppetlabs/puppet/pull/7768\r\n\r\nBasically, I"m asking for that same support for all the other attributes pulled from {{/etc/passwd}} in [the finduser() method|https://github.com/puppetlabs/puppet/blob/7.11.0/lib/puppet/provider/user/useradd.rb#L80-L96]', 'https://tickets.puppetlabs.com/browse/PUP-11241', 'https://github.com/puppetlabs/puppet/pull/8767', '2021-09-14T18:03:13.000-0700', '2021-10-05T05:10:23.000-0700', '2021-10-05T05:10:23.000-0700', 'Resolved', 'doc-reviewed', 2, '0', 2, 60, 0, 2, 'be821fb32d741a21feecaee29fa745e0be1696a0', 'https://tickets.puppetlabs.com/browse/PUP-11241', 'https://github.com/puppetlabs/puppet/pull/8767'),
('puppet', 412673, 741266714, 8769, 'Puppet fails to install packages on Solaris if another pkg install is running', 'Puppet fails hard if it tries to install a package on Solaris 11 while a {{pkg install}} command is already running in the background.\r\n\r\n{{pkg install}} fails with the following error:\r\n{code:java}root@initial-holdup:~# pkg install nano\r\npkg: The image cannot be modified as it is currently in use by another package client.\r\nroot@initial-holdup:~# echo $?\r\n7 {code}\r\nThe same error can be reproduced in a zone set up, if you execute {{pkg install something}} concurrently on global and the zone (the following output is from a puppet manifest with the nano package resource):\r\n{code:java}Debug: Executing: "/usr/bin/pkg install --accept --sync-actuators-timeout 900 nano"\r\nError: Unable to update  Startup: Linked image publisher check ... Done\r\npkg: install failed (linked image exception(s)):A "pubcheck-linked" operation failed for child "zone:devzone" with an unexpected\r\nreturn value of 7 and generated the following output:\r\npkg: The image cannot be modified as it is currently in use by another package client.\r\nError: /Stage[main]/Main/Package[nano]/ensure: change from "absent" to "present" failed: Unable to update  Startup: Linked image publisher check ... Done\r\npkg: install failed (linked image exception(s)):A "pubcheck-linked" operation failed for child "zone:devzone" with an unexpected\r\nreturn value of 7 and generated the following output:\r\npkg: The image cannot be modified as it is currently in use by another package client. {code}\r\n \r\n\r\nFrom the Solaris pkg manpages ([https://docs.oracle.com/cd/E36784_01/html/E36870/pkg-1.html):]\r\n{quote}7: The image is currently in use by another process and cannot be modified.\r\n{quote}\r\n From a Solaris KB article ([https://docs.oracle.com/cd/E53394_01/html/E54739/nomodimg.html]):\r\n\r\n \r\n{quote}Try your {{pkg}} command again after the current package process exits (process 26604 in this example). If the process does not exit quickly, use {{ptree -a}}, for example, to begin to examine the process.\r\n{quote}\r\n \r\n\r\nWe probably need to implement a similar defense in Puppet, that checks to see if the {{pkg}} command failed with error code 7 and keeps retrying the command a number of times (tbd how many times & how often). 5 x 2^n; 1; 2; 4; 8; 16', 'https://tickets.puppetlabs.com/browse/PUP-11208', 'https://github.com/puppetlabs/puppet/pull/8769', '2021-08-19T04:17:38.000-0700', '2021-10-05T05:11:17.000-0700', '2021-10-05T05:11:17.000-0700', 'Resolved', 'doc-reviewed', 1, '0', 1, 24, 0, 2, '2faf6ceda489b862a60ac33eb0d03ad65c556704', 'https://tickets.puppetlabs.com/browse/PUP-11208', 'https://github.com/puppetlabs/puppet/pull/8769'),
('puppet', 413595, 744640198, 8770, 'puppet-agent : Concat not respecting environments', '_Basic Info_\r\n*Module Version:* puppetlabs-concat 7.1.1\r\n*Puppet Version:* 7.10.0\r\n*OS Name/Version:* Centos 7\r\n\r\n_Describe your issue in as much detail as possible..._\r\nConcat is not respecting the choosen environment via external enc when fetching module content for files.\r\n\r\nError:\r\n{noformat}\r\nError: /Stage[main]/Df_modsec::Config/Concat[/etc/nginx/modsecurity_main.conf]/Concat_file[/etc/nginx/modsecurity_main.conf]: Failed to generate additional resources using "eval_generate": Could not retrieve \r\nsource(s) puppet:///modules/df_modsec/modsecurity_main.conf\r\n{noformat}\r\n\r\nCode:\r\n{code:puppet}\r\n -> concat { $df_modsec::config_main:\r\n    ensure => "present",\r\n    owner  => 0,\r\n    group  => 0,\r\n    mode   => "0644",\r\n    order  => "numeric",\r\n    notify => Class["::df_web::nginx::service"],\r\n  }\r\n  -> concat::fragment { $df_modsec::config_main:\r\n    order  => 0,\r\n    target => $df_modsec::config_main,\r\n    source => "puppet:///modules/df_modsec/modsecurity_main.conf",\r\n    notify => Class["::df_web::nginx::service"],\r\n  }\r\n{code}\r\n\r\nAfter further inspection of the run with the --debug parameter it is visible that puppet switched back to the default environment "production" during the run. The file itself is managed in a different environment.\r\n\r\n{noformat}\r\n[root@somehost0 ~]# puppet agent -tv  --noop --debug \r\nInfo: Using environment "customer1_production"\r\n...\r\nDebug: Using cached connection for https://puppet.int.hostname.net:8140\r\nDebug: HTTP GET https://puppet.int.hostname.net:8140/puppet/v3/file_metadata/modules/df_varnish/backend.vcl?*environment=production* returned 404 Not Found\r\n{noformat}\r\n\r\nbackend.vcl?environment=production should be customer1_production if i am not mistaken by the logic.\r\n\r\n\r\n*Desired Behavior:*\r\nRun resulting no error\r\n\r\n*Actual Behavior:*\r\nRun unable to fetch files via concat.\r\n\r\nPlease take a moment and attach any relevant log output and/or manifests. This will help us immensely when troubleshooting the issue.\r\n\r\nCan provide further logs if needed, just let me know.\r\nThanks for your time', 'https://tickets.puppetlabs.com/browse/PUP-11265', 'https://github.com/puppetlabs/puppet/pull/8770', '2021-08-26T23:42:32.000-0700', '2021-10-05T05:16:17.000-0700', '2021-10-05T05:16:17.000-0700', 'Resolved', 'doc-reviewed', 5, '0', 1, 29, 16, 2, '90b6393df0bdbb6656042a2b4aae060b5e9f5711', 'https://tickets.puppetlabs.com/browse/PUP-11265', 'https://github.com/puppetlabs/puppet/pull/8770'),
('puppet', 414255, 731648594, 8765, 'Util::JSON.dump receives non-hash options', '*Puppet Version:* Main branch (401e01b2691d9c496749ff07f7fca7fc852e105c)\r\n*Puppet Server Version:* Main branch (38479aafcb6c27d826976e31a993258e9e9e4de2)\r\n*OS Name/Version:* Ubuntu 20.04\r\n\r\nWhile testing the {{file_metadatas}} Puppetserver endpoint, when sending this request:\r\n{{code}}\r\n  https://localhost:8140/puppet/v3/file_metadatas/scripts/mymodule/script.sh?environment=production&recurse=yes\r\n{{code}}\r\nPuppet errors with (apologies for the backtrace!):\r\n{{code}}\r\n2021-09-03 07:58:27,688 DEBUG [qtp1541353205-57] [puppetserver] Puppet Could not render_multiple to Puppet::Network::Format[json]: undefined method `delete" for #<JSON::Ext::Generator::State:0x79067448>\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/util/json.rb:64:in `dump"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/format_support.rb:105:in `to_json"\r\njson/ext/GeneratorMethods.java:79:in `to_json"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/util/json.rb:65:in `dump"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/formats.rb:129:in `render_multiple"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/format_support.rb:26:in `render_multiple"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/api/indirected_routes.rb:161:in `block in do_search"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/api/indirected_routes.rb:192:in `block in first_response_formatter_for"\r\norg/jruby/RubyEnumerable.java:690:in `find"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/api/indirected_routes.rb:190:in `first_response_formatter_for"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/api/indirected_routes.rb:160:in `do_search"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/api/indirected_routes.rb:53:in `block in call"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/context.rb:62:in `override"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet.rb:306:in `override"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/api/indirected_routes.rb:52:in `call"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/api/server/v3.rb:17:in `block in wrap"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/route.rb:82:in `block in process"\r\norg/jruby/RubyArray.java:1809:in `each"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/route.rb:81:in `process"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/route.rb:88:in `process"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/route.rb:88:in `process"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/handler.rb:86:in `block in process"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/handler.rb:69:in `block in with_request_profiling"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/util/profiler/around_profiler.rb:58:in `profile"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/util/profiler.rb:51:in `profile"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/handler.rb:65:in `with_request_profiling"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/handler.rb:85:in `block in process"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/handler.rb:92:in `respond_to_errors"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/network/http/handler.rb:84:in `process"\r\nuri:classloader:/puppetserver-lib/puppet/server/master.rb:69:in `block in handleRequest"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet/context.rb:62:in `override"\r\n/home/lucy/githubs/puppetserver/ruby/puppet/lib/puppet.rb:306:in `override"\r\nuri:classloader:/puppetserver-lib/puppet/server/master.rb:68:in `handleRequest"\r\n{{code}}\r\n\r\nThis only happens when requesting the {{scripts}} mount - the request\r\n{{code}}\r\nhttps://localhost:8140/puppet/v3/file_metadatas/modules/mymodule/file?environment=production&recurse=yes\r\n{{code}}\r\nbehaves as expected.\r\n\r\nThe object that {{dump}} is receiving in this case actually can be converted to a hash, and adding\r\n{{code}}\r\noptions = options.to_h unless options.is_a?(Hash)\r\n{{code}}\r\nfixes the issue, but doesn"t really get to *why* this method is receiving the wrong object to begin with.\r\n\r\nHappy to provide more testing and info!', 'https://tickets.puppetlabs.com/browse/PUP-11237', 'https://github.com/puppetlabs/puppet/pull/8765', '2021-09-03T08:13:51.000-0700', '2021-10-05T05:17:37.000-0700', '2021-10-05T05:17:37.000-0700', 'Closed', 'doc-reviewed', 4, '0', 1, 9, 0, 2, 'd5207c38881397d451c4d454cbbda3c317a5cd13', 'https://tickets.puppetlabs.com/browse/PUP-11237', 'https://github.com/puppetlabs/puppet/pull/8765'),
('puppet', 408088, 736710681, 8768, 'Autoloader is confused by Windows 8.3 paths', '*Puppet Version: 7.9.0*\r\n\r\nThe autoloader can load the same file twice if the ruby load path contains Windows 8.3 style paths. The file {{lib/puppet/file_system/uniquefile.rb}} creates a class whose parent is an anonymous class. If the file is loaded twice, then it will fail with: {{superclass mismatch for class Uniquefile (TypeError)}}.\r\n\r\nTo reproduce, install puppet-agent on Windows:\r\n{noformat}C:\> cmd /c start /w msiexec /qn /i http://builds.puppetlabs.lan/puppet-agent/7.9.0/artifacts/windows/puppet-agent-7.9.0-x64.msi\r\nC:\> net stop puppet\r\nC:\> cd C:\PROGRA~1\PUPPET~1\Puppet\puppet\bin\r\n{noformat}\r\ncreate "puppettest.rb" containing:\r\n{code:ruby}require "puppet"\r\nPuppet.initialize_settings\r\nputs "RUBYLIBDIR #{RbConfig::CONFIG["rubylibdir"]}"\r\nputs "Loaded Puppet"\r\npp $LOADED_FEATURES.grep(/uniquefile/).first\r\nPuppet::Type.type(:exec)\r\n{code}\r\nAnd execute the script:\r\n{noformat}C:\PROGRA~1\PUPPET~1\Puppet\puppet\bin>ruby puppettest.rb\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/facter/util/file_helper.rb:9: warning: already initialized constant Class::DEBUG_MESSAGE\r\nC:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/facter/util/file_helper.rb:9: warning: previous definition of DEBUG_MESSAGE was here\r\n...\r\nHundreds of already initialized constant errors\r\n...\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/file_system/windows.rb:123: warning: already initialized constant Puppet::FileSystem::Windows::LOCK_VIOLATION\r\nC:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/file_system/windows.rb:123: warning: previous definition of LOCK_VIOLATION was here\r\nTraceback (most recent call last):\r\n        33: from puppettest.rb:6:in `<main>"\r\n        32: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/metatype/manager.rb:154:in `type"\r\n        31: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/concurrent/lock.rb:10:in `synchronize"\r\n        30: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/metatype/manager.rb:171:in `block in type"\r\n        29: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:182:in `load"\r\n        28: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:78:in `load_file"\r\n        27: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:78:in `load"\r\n        26: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/type/exec.rb:1:in `<top (required)>"\r\n        25: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/type/exec.rb:2:in `<module:Puppet>"\r\n        24: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/metatype/manager.rb:73:in `newtype"\r\n        23: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/concurrent/lock.rb:10:in `synchronize"\r\n        22: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/metatype/manager.rb:126:in `block in newtype"\r\n        21: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:196:in `loadall"\r\n        20: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:91:in `loadall"\r\n        19: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:91:in `each"\r\n        18: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:93:in `block in loadall"\r\n        17: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:78:in `load_file"\r\n        16: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:78:in `load"\r\n        15: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/exec/posix.rb:1:in `<top (required)>"\r\n        14: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/exec/posix.rb:1:in `require_relative"\r\n        13: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/exec.rb:1:in `<top (required)>"\r\n        12: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/exec.rb:1:in `require_relative"\r\n        11: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider.rb:37:in `<top (required)>"\r\n        10: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider.rb:43:in `<class:Provider>"\r\n         9: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider.rb:43:in `require_relative"\r\n         8: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/confiner.rb:1:in `<top (required)>"\r\n         7: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/confiner.rb:1:in `require_relative"\r\n         6: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/confine_collection.rb:3:in `<top (required)>"\r\n         5: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/confine_collection.rb:3:in `require_relative"\r\n         4: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/confine.rb:3:in `<top (required)>"\r\n         3: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/confine.rb:3:in `require_relative"\r\n         2: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util.rb:11:in `<top (required)>"\r\n         1: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util.rb:11:in `require_relative"\r\nC:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/file_system/uniquefile.rb:17:in `<top (required)>": superclass mismatch for class Uniquefile (TypeError)\r\n{noformat}\r\nThe problem stems from a behavior change in Dir.glob in Ruby 2.1 combined with using relative_require. See PUP-6557 and [https://bugs.ruby-lang.org/issues/10819].\r\n\r\nWhen puppet is initially loaded, all LOADED_FEATURES are added using 8.3 paths:\r\n{noformat}C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/file_system/uniquefile.rb\r\n{noformat}\r\nWhen we call `Puppet::Type.type(:exec)`, it uses the autoloader to load the exec type and all of its providers. The autoloader uses `Dir.glob` to find them. Ruby 2.1 changed the behavior of `Dir.glob` to always return the long path name on Windows. So then the autoloader tries to load:\r\n{noformat}C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/file_system/uniquefile.rb\r\n{noformat}\r\nAlso note in the stack trace above how the path changes from 8.3 to long paths:\r\n{noformat} 17: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:78:in `load_file"\r\n 16: from C:/PROGRA~1/PUPPET~1/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util/autoload.rb:78:in `load"\r\n 15: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/exec/posix.rb:1:in `<top (required)>"\r\n ...\r\n 1: from C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/util.rb:11:in `require_relative"\r\n C:/Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/file_system/uniquefile.rb:17:in `<top (required)>": Could not autoload puppet/type/exec: Could not autoload ../../../../../../../Program Files/Puppet Labs/Puppet/puppet/lib/ruby/vendor_ruby/puppet/provider/exec/posix: superclass mismatch for class Uniquefile (Puppet::Error)\r\n{noformat}', 'https://tickets.puppetlabs.com/browse/PUP-11184', 'https://github.com/puppetlabs/puppet/pull/8768', '2021-07-22T16:54:59.000-0700', '2021-10-08T16:19:08.000-0700', '2021-10-08T16:19:08.000-0700', 'Resolved', 'doc-reviewed', 3, '0', 2, 28, 10, 3, 'ca7fac811fbd905ca5e61db79b48b2be21cf2188', 'https://tickets.puppetlabs.com/browse/PUP-11184', 'https://github.com/puppetlabs/puppet/pull/8768'),
('puppet', 418429, 750809894, 8782, 'Requiring files inside settings hook is slow on Windows', 'Calling require/require_relative inside of the storeconfigs setting hook is really slow on Windows: https://github.com/puppetlabs/puppet/blob/75737603872883d8d72224e2a6857804938f9634/lib/puppet/defaults.rb#L2122-L2123\r\n\r\nIt appears to add several minutes to the overall rspec time on Windows.\r\n\r\n', 'https://tickets.puppetlabs.com/browse/PUP-11314', 'https://github.com/puppetlabs/puppet/pull/8782', '2021-10-05T09:23:59.000-0700', '2021-10-08T19:46:55.000-0700', '2021-10-08T19:46:55.000-0700', 'Resolved', '', 3, '0', 1, 11, 5, 3, '78246ca8d08dee770886f0940a6472c45483d627', 'https://tickets.puppetlabs.com/browse/PUP-11314', 'https://github.com/puppetlabs/puppet/pull/8782'),
('puppet', 405654, 690091516, 8697, 'static catalogs not working for file resource when versioned_deploys enabled', '*Puppet Version:* \r\n *Puppet Server Version:* *2019.8.5* and *2019.8.6*\r\n *OS Name/Version: Centos 7*\r\n\r\nWhen versioned_deploys is enabled (lockless deploys feature) the file resource stops operating as static catalog \r\n\r\n*Desired Behavior:*\r\n\r\nWhen deploy_versions is enabled (lockless deploys feature) the file resource stops operating as static catalog ** \r\n\r\n*Actual Behavior:*\r\n\r\n \r\n\r\nUsing the following class as example:\r\n\r\n\r\n{code:java}\r\nclass file_serving_test {\r\n# creating a file in the root folder\r\n  file { "/root/jordi9.conf":\r\n    ensure => file,\r\n    source => "puppet:///modules/file_serving_test/jordi9.conf"\r\n  }\r\n}\r\n{code}\r\n\r\n\r\nwithout version_deploys - static catalogs working\r\n\r\n{code:java}\r\n 10.64.132.119 - - [02/Jul/2021:14:22:22 +0000] "GET /puppet/v3/static_file_content/site/file_serving_test/files/jordi9.conf?environment=production&code_id=urn%3Apuppet%3Acode-id%3A1%3Acc6a314c8caf1c58434ba024e0a38c234044cbe0%3Bproduction HTTP/1.1" 200 14 "-" "Puppet/6.22.1 Ruby/2.5.9-p229 (x86_64-linux)" 8 - -\r\n{code}\r\n\r\n with version_deploys and no other changes - static catalogs not working\r\n\r\n{code:java}\r\n 10.64.132.119 - - [02/Jul/2021:14:28:52 +0000] "GET /puppet/v3/file_metadata/modules/file_serving_test/jordi9.conf?links=manage&checksum_type=md5&source_permissions=ignore&environment=production HTTP/1.1" 200 289 "-" "Puppet/6.22.1 Ruby/2.5.9-p229 (x86_64-linux)" 16 - 12\r\n 10.64.132.119 - - [02/Jul/2021:14:35:10 +0000] "GET /puppet/v3/file_metadata/modules/file_serving_test/jordi9.conf?links=manage&checksum_type=md5&source_permissions=ignore&environment=production HTTP/1.1" 200 367 "-" "Puppet/6.22.1 Ruby/2.5.9-p229 (x86_64-linux)" 11 - 8\r\n 10.64.132.119 - - [02/Jul/2021:14:58:46 +0000] "GET /puppet/v3/file_metadata/modules/file_serving_test/jordi9.conf?links=manage&checksum_type=md5&source_permissions=ignore&environment=production HTTP/1.1" 200 367 "-" "Puppet/6.22.1 Ruby/2.5.9-p229 (x86_64-linux)" 10 - 7\r\n{code}\r\n\r\n with version_deploys, deleting {{jordi9.conf}} from the agent and no other changes - static catalogs not working\r\n\r\n{code:java}\r\n 10.64.132.119 - - [02/Jul/2021:15:04:41 +0000] "GET /puppet/v3/file_metadata/modules/file_serving_test/jordi9.conf?links=manage&checksum_type=md5&source_permissions=ignore&environment=production HTTP/1.1" 200 367 "-" "Puppet/6.22.1 Ruby/2.5.9-p229 (x86_64-linux)" 18 - 14\r\n 10.64.132.119 - - [02/Jul/2021:15:04:42 +0000] "GET /puppet/v3/file_content/modules/file_serving_test/jordi9.conf?environment=production HTTP/1.1" 200 14 "-" "Puppet/6.22.1 Ruby/2.5.9-p229 (x86_64-linux)" 10 - 7 1\r\n{code}\r\n\r\nLogic steps to reproduce:\r\n# Add a file resource with source => "puppet:///modules..." into the control repo in a module\r\n# Enable code manager\r\n# Observe static catalogs are working and the metadata for the file is inlined in the catalog.\r\n# Enable versioned code deploys\r\n# Observe that the static catalogs do not include the inlined metadata and the agent makes the file_metadata API call for the files\r\n\r\n*OUTCOMES*\r\n* Determine the cause of this bug - if you"ve put in ~2 points worth of work into this and can"t determine the cause, we should stop and re-evaluate next steps.\r\n* If it"s easy, fix it\r\n* If not, open separate ticket(s) describing the necessary changes', 'https://tickets.puppetlabs.com/browse/PUP-11169', 'https://github.com/puppetlabs/puppet/pull/8697', '2021-07-02T09:38:16.000-0700', '2021-10-14T09:13:21.000-0700', '2021-10-14T09:13:21.000-0700', 'Resolved', 'doc-reviewed;jira_escalated;versioned_deploys', 1, '0', 1, 48, 4, 3, '55d3d008a8a6d7d816a054c9d0a0954fffdc0e34', 'https://tickets.puppetlabs.com/browse/PUP-11169', 'https://github.com/puppetlabs/puppet/pull/8697'),
('puppet', 14942, 123784411, 5938, 'Install windows packages from remote sources', 'This may not be an issue anymore, need to validate for both msi and exe based packages', 'https://tickets.puppetlabs.com/browse/PUP-394', 'https://github.com/puppetlabs/puppet/pull/5938', '2013-09-19T00:16:58.000-0700', '2021-10-20T01:50:06.000-0700', '2021-10-20T01:50:06.000-0700', 'Accepted', 'fileserver;package;platform-os;source;type_and_provider;windows', 5, '0', 4, 39, 16, 4, '3d90821cbac52813cd25bd1ac4f352207f9a065c', 'https://tickets.puppetlabs.com/browse/PUP-394', 'https://github.com/puppetlabs/puppet/pull/5938'),
('puppet', 14945, 366205803, 7942, 'Manage both 32 and 64-bit windows applications', '', 'https://tickets.puppetlabs.com/browse/PUP-397', 'https://github.com/puppetlabs/puppet/pull/7942', '2013-09-19T00:20:16.000-0700', '2021-10-20T01:52:01.000-0700', '2021-10-20T01:52:01.000-0700', 'Accepted', 'package;platform-os;type_and_provider;windows', 1, '0', 1, 5, 17, 3, '07db7cf6d0d9fde8257462745a352096e847ab13', 'https://tickets.puppetlabs.com/browse/PUP-397', 'https://github.com/puppetlabs/puppet/pull/7942'),
('puppet', 105646, 50696385, 4447, 'Reading services on Mac is very slow', 'Currently Puppet runs `plutil -convert xml1` on EVERY plist it encounters because it has no way of supporting binary plist files. This occurs even if the plist is a text file.\r\n\r\nSpeed up reading plists so it doesn"t take 30 seconds to do so. The most promising approach to this is to first try reading the plist file as text, and if that fails (which happens immediately with binary plists) pipe it through plutil.\r\n\r\nMeasurements demonstrating that this gives significant performance improvements are attached to PUP-1455.', 'https://tickets.puppetlabs.com/browse/PUP-5505', 'https://github.com/puppetlabs/puppet/pull/4447', '2015-11-13T13:39:56.000-0800', '2021-11-04T12:47:41.000-0700', '2021-11-04T12:47:41.000-0700', 'Closed', '', 3, '0', 1, 17, 0, 2, '2583586c3dd45b9c1d0ecb8ac0958b65ab68feb9', 'https://tickets.puppetlabs.com/browse/PUP-5505', 'https://github.com/puppetlabs/puppet/pull/4447'),
('puppet', 114329, 62157440, 4764, 'Fix problematic usage of ENV for Windows', 'As part of PUP-5726, Windows API calls for retrieving / setting environment variables were added.  This was done to work around a Ruby {{ENV}} bug https://bugs.ruby-lang.org/issues/8822 that corrupts UTF8 characters set in the environment (as keys or values) that don"t map cleanly to the local codepage.  While this was allegedly fixed in Ruby 2.3.0, it has not yet been backported or scheduled for backport.\r\n\r\nTherefore, the {{withenv}} helper was updated to not use Rubys {{ENV}}, and to instead use the API calls.\r\n\r\nHowever, there are a number of places where ENV is accessed and modified that may also trigger corruption issues.\r\n\r\nThis ticket should cover:\r\n\r\n* Finding other danger spots in the code - for instance access through {{ENV}} of  {{PATH}} and {{HOME}} have risks of being problematic, but {{SYSTEMROOT}}, {{PATHEXT}}, {{windir}} and {{COMSPEC}} should be safe to ignore due to the low likelihood of these values containing Unicode characters.  {{ENV}} usage inside tests can also generally be ignored, as problems running specs would likely only manifest on a non-English Windows install with a username that includes Unicode chars, that has a Unicode path as a home dir.\r\n** One way to synthetically trigger failures would be to insert a Unicode value into {{PATH}} like {{c:\ᚠ}} or similarly set {{HOME}}\r\n* Potentially adding a cross-platform wrapper for setting / reading env vars (that delegates to {{ENV}} for POSIX and calls Windows APIs otherwise)\r\n* Replace Windows specific {{ENV}} access where there is danger \r\n* Finding danger spots in other modules by auditing the forge / notifying authors where appropriate (probably best done in another ticket)\r\n\r\nI"ve grepped through all of the code, and have narrowed the problematic spots (covering the first point), down to:\r\n\r\n{noformat}\r\nC:\source\puppet\lib\puppet\defaults.rb:\r\n  236:           ENV["PATH"] = "" if ENV["PATH"].nil?\r\n  237:           ENV["PATH"] = value unless value == "none"\r\n  238:           paths = ENV["PATH"].split(File::PATH_SEPARATOR)\r\n  239            Puppet::Util::Platform.default_paths.each do |path|\r\n  240:             ENV["PATH"] += File::PATH_SEPARATOR + path unless paths.include?(path)\r\n\r\nC:\source\puppet\lib\puppet\util.rb:\r\n  201:       ENV["PATH"].split(File::PATH_SEPARATOR).each do |dir|\r\n  202          begin\r\n  ...\r\n  208:           if e.to_s =~ /HOME/ and (ENV["HOME"].nil? || ENV["HOME"] == "")\r\n  209              # if we get here they have a tilde in their PATH.  We"ll issue a single warning about this and then\r\n\r\nC:\source\puppet\lib\puppet\file_system\uniquefile.rb:\r\n  159:       for dir in [ENV["TMPDIR"], ENV["TMP"], ENV["TEMP"], @@systmpdir, "/tmp"]\r\n  160          if dir and stat = File.stat(dir) and stat.directory? and stat.writable?\r\n\r\nC:\source\puppet\lib\puppet\node\environment.rb:\r\n  451    def self.extralibs()\r\n  452:     if ENV["PUPPETLIB"]\r\n  453:       split_path(ENV["PUPPETLIB"])\r\n\r\nC:\source\puppet\lib\puppet\test\test_helper.rb:\r\n  124:       $old_env = ENV.to_hash\r\n  125  \r\n  ...\r\n  176        # faster to use the compare-then-set model to avoid excessive work that it\r\n  177        # justifies the complexity.  --daniel 2012-03-15\r\n  178:       unless ENV.to_hash == $old_env\r\n  179:         ENV.clear\r\n  180:         $old_env.each {|k, v| ENV[k] = v }\r\n\r\nC:\source\puppet\spec\unit\util\run_mode_spec.rb:\r\n  276    def without_env(name, &block)\r\n  277:     saved = ENV[name]\r\n  278:     ENV.delete name\r\n  279      yield\r\n  280    ensure\r\n  281:     ENV[name] = saved\r\n  282    end\r\n{noformat}', 'https://tickets.puppetlabs.com/browse/PUP-5768', 'https://github.com/puppetlabs/puppet/pull/4764', '2016-01-28T14:50:16.000-0800', '2021-11-11T11:30:14.000-0800', '2021-11-11T11:30:14.000-0800', 'Closed', 'i18n;utf-8;windows', 13, '0', 5, 332, 96, 15, '010dd2144eaecd1e72f4ac9eb0e839b568764dbc', 'https://tickets.puppetlabs.com/browse/PUP-5768', 'https://github.com/puppetlabs/puppet/pull/4764'),
('puppet', 178530, 109103608, 5687, 'Avoid excessive type inference when checking instance_of?', 'The type of an instance is often inferred when checking if it is instance of a Pcore type. I.e:\r\n{code}\r\nt.instance_of?(o)\r\n{code}\r\ncan be written as:\r\n{code}\r\nt.assignable?(<inferred type of o>)\r\n{code}\r\nWhile this makes the instance check very simple and elegant, inferring a type can be very expensive in terms of CPU. Especially if the {{o}} is a large data structure. This means that inferring the type should not be done unless there"s a real need for it. Consider the case where {{t}} is the type {{Scalar}} and {{o}} is a huge hash. There"s no need to infer the type of {{o}} since it"s already a known fact that a hash isn"t a scalar.\r\n\r\nIn addition to the {{Scalar}} example, there are a couple of similar low hanging fruits that needs to be fixed in the Pcore type system.\r\n\r\nThe problem became very apparent in 4.9.x where the type of loaded Hiera data hashes is asserted. See PUP-7294 for more info.\r\n', 'https://tickets.puppetlabs.com/browse/PUP-7301', 'https://github.com/puppetlabs/puppet/pull/5687', '2017-03-04T00:31:24.000-0800', '2021-11-11T11:54:35.000-0800', '2021-11-11T11:54:35.000-0800', 'Closed', 'flanders-ss', 7, '0', 4, 77, 37, 3, '2edd30e0305d589f6c5ef2de3a91d6825d793faf', 'https://tickets.puppetlabs.com/browse/PUP-7301', 'https://github.com/puppetlabs/puppet/pull/5687'),
('puppet', 65158, 778276735, 8814, 'Noop changes to file ownership generate failures if required User or Group does not exist', 'If a noop run contains File resources, and those resources have pending changes for User or Group ownership, the run will show failures if those User or Group resources don"t exist yet.\r\n\r\nh2. Reproduction Case\r\n\r\n- Create the following manifest:\r\n\r\n{code:puppet}\r\n# noop_test.pp\r\nfile {"/tmp/usertest":\r\n  ensure => present,\r\n  owner => testuser,\r\n}\r\n\r\nfile {"/tmp/grouptest":\r\n  ensure => present,\r\n  group => testgroup,\r\n}\r\n\r\nuser{"testuser":\r\n  ensure => present,\r\n}\r\n\r\ngroup{"testgroup":\r\n  ensure => present,\r\n}\r\n{code}\r\n\r\nCreate the test file:\r\n\r\n{code:bash}\r\ntouch /tmp/usertest\r\ntouch /tmp/grouptest\r\n{code}\r\n\r\nh3. Outcome\r\n\r\nA noop application produces errors:\r\n\r\n{noformat}\r\n# puppet apply --noop noop_test.pp\r\n\r\nNotice: Compiled catalog for poss-head-master.puppetdebug.vlan in environment production in 1.87 seconds\r\nNotice: /Stage[main]/Main/User[testuser]/ensure: current_value absent, should be present (noop)\r\nError: Could not find user testuser\r\nError: /Stage[main]/Main/File[/tmp/usertest]/owner: change from root to testuser failed: Could not find user testuser\r\nNotice: /Stage[main]/Main/Group[testgroup]/ensure: current_value absent, should be present (noop)\r\nError: Could not find group testgroup\r\nError: /Stage[main]/Main/File[/tmp/grouptest]/group: change from root to testgroup failed: Could not find group testgroup\r\nNotice: Applied catalog in 0.08 seconds\r\n{noformat}\r\n\r\nh3. Expected Outcome\r\n\r\nThe noop run notes that the values _would_ be changed but doesn"t produce an error. The error should only happen if Users or Groups are missing when Puppet enforces the change.\r\n', 'https://tickets.puppetlabs.com/browse/PUP-3907', 'https://github.com/puppetlabs/puppet/pull/8814', '2015-01-23T12:11:42.000-0800', '2021-11-19T08:30:14.000-0800', '2021-11-19T08:30:14.000-0800', 'Resolved', 'noop', 3, '0', 1, 30, 2, 4, 'e6e78b181459ad49b20b057781d888341b8d6556', 'https://tickets.puppetlabs.com/browse/PUP-3907', 'https://github.com/puppetlabs/puppet/pull/8814'),
('puppet', 418030, 754430435, 8787, 'Puppet creates excessive numbers of Pathname instances', 'There are a few different places where we make excessive numbers of Pathname objects and resulting Strings:\r\n\r\n1. Most of Puppet"s FileSystem methods make two copies of their string arguments. Once to create the Pathname instance (via assert_path) and another when ruby"s File.xxx method calls {{Pathname#to_path}} to get the original string back.\r\n\r\n2. Some of Puppet"s FileSystem implementation, eg {{Windows#replace_file}}, methods call "back out" to {{Puppet::FileSystem.replace_file}}, which makes another copy of Pathname instead of using the existing instance.\r\n\r\n3. {{Checker4_0#namespace_for_file(file)}} creates N Pathname instances (one for each module path directory in the environment) for each file argument. And then calls {{Pathname#cleanpath}} and  {{Pathname#relative_path_from}}, both of which resolve each path component, e.g. "/a/b/c/d/etc" is copied to "/a/b/c/d", "/a/b/c", "/a/b", "/a", "". The mapping of {{file}} to {{namespace}} is cached in the environment, but if you have M files in an environment, then we get N * M Pathname instances and N * M * P string copies.\r\n\r\n4. {{PathNamePattern}} calls {{Pathname.each_filename}} to determine if any path component contains {{..}}. That ends up calling {{Pathname#chop_basename}}. We should just call {{String.split}}. It also calls {{Pathname#to_s}} multiple times during validation.', 'https://tickets.puppetlabs.com/browse/PUP-11312', 'https://github.com/puppetlabs/puppet/pull/8787', '2021-10-01T09:42:53.000-0700', '2021-11-19T08:32:29.000-0800', '2021-11-19T08:32:29.000-0800', 'Resolved', '', 2, '0', 3, 17, 17, 2, 'fd6784c30a96012a7ac324d9e5e3036f8265f55b', 'https://tickets.puppetlabs.com/browse/PUP-11312', 'https://github.com/puppetlabs/puppet/pull/8787'),
('puppet', 134404, 0, 0, 'SemanticPuppet::VersionRange incorrectly assumes that it can rely on ruby Range semantics', 'A semantic version can contain a suffix that denotes a prerelease. Such prereleases are included in the natural ordering of a version (a prerelease tagged version is less than the same version without such a tag). A semantic version range must however exclude all versions that has a prerelease tag by default. Such versions can only be considered included when prereleases are explicitly requested.\r\n\r\nHere is an exerpt from the [npm semver range specification|https://docs.npmjs.com/misc/semver]:\r\n{quote}\r\nh4. Prerelease Tags\r\nh4. \r\nIf a version has a prerelease tag (for example, *1.2.3-alpha.3*) then it will only be allowed to satisfy comparator sets if at least one comparator with the same *\[major, minor, patch\]* tuple also has a prerelease tag.\r\n\r\nFor example, the range *>1.2.3-alpha.3* would be allowed to match the version *1.2.3-alpha.7*, but it would _not_ be satisfied by *3.4.5-alpha.9*, even though *3.4.5-alpha.9* is technically "greater than" *1.2.3-alpha.3* according to the SemVer sort rules. The version range only accepts prerelease tags on the *1.2.3* version. The version *3.4.5* _would_ satisfy the range, because it does not have a prerelease flag, and *3.4.5* is greater than *1.2.3-alpha.7*.\r\n\r\nThe purpose for this behavior is twofold. First, prerelease versions frequently are updated very quickly, and contain many breaking changes that are (by the author"s design) not yet fit for public consumption. Therefore, by default, they are excluded from range matching semantics.\r\n\r\nSecond, a user who has opted into using a prerelease version has clearly indicated the intent to use _that specific set_ of alpha/beta/rc versions. By including a prerelease tag in the range, the user is indicating that they are aware of the risk. However, it is still not appropriate to assume that they have opted into taking a similar risk on the _next_ set of prerelease versions.\r\n{quote}\r\n\r\nThis means that the {{SemanticPuppet::VersionRange}} implementation that relies solely on the Ruby {{Range}} semantics to compute inclusion is flawed. A semantic version range cannot be expressed as something with a begin and an end (the ability to exclude the end doesn"t help).', 'https://tickets.puppetlabs.com/browse/PUP-6373', '', '2016-05-30T05:53:43.000-0700', '2021-11-19T11:05:40.000-0800', '2021-11-19T11:05:40.000-0800', 'Resolved', '', 7, '0', 0, 0, 0, 0, '3eac0b1a9a616fe8e9aa5a497f23628f2b8c3db2', 'https://tickets.puppetlabs.com/browse/PUP-6373', 'https://github.com/puppetlabs/puppet/commit/3eac0b1a9a616fe8e9aa5a497f23628f2b8c3db2'),
('puppet', 183334, 113880648, 5776, 'Fix code that rely on incorrect SemanticPuppet::VersionRange prerelease behavior', 'Several tests related to the {{PSemverType}} relies on the fact that the {{SemanticPuppet::VersionRange}} includes pre-release versions in ranges although the range doesn"t explicitly state this. These tests must be adjusted before Puppet can be upgraded to use a semantic_puppet gem where PUP-6373 has been fixed.', 'https://tickets.puppetlabs.com/browse/PUP-7410', 'https://github.com/puppetlabs/puppet/pull/5776', '2017-03-30T05:28:20.000-0700', '2021-11-19T11:06:11.000-0800', '2021-11-19T11:06:11.000-0800', 'Closed', '', 3, '0', 1, 16, 21, 3, '3eac0b1a9a616fe8e9aa5a497f23628f2b8c3db2', 'https://tickets.puppetlabs.com/browse/PUP-7410', 'https://github.com/puppetlabs/puppet/pull/5776'),
('puppet', 406447, 686397250, 8687, 'Don"t change current working directory when listing modules', 'When listing modules by path, puppet changes the current working directory unnecessarily. This was first reported in PUP-9997, but broken out here into a separate issue:\r\n{code:ruby}def modules_by_path\r\n    modules_by_path = {}\r\n    modulepath.each do |path|\r\n      if Puppet::FileSystem.exist?(path)\r\n        Dir.chdir(path) do\r\n          module_names = Dir.entries(path).select do |name|\r\n            Puppet::Module.is_module_directory?(name, path)\r\n          end\r\n          modules_by_path[path] = module_names.sort.map do |name|\r\n            Puppet::Module.new(name, File.join(path, name), self)\r\n          end\r\n        end\r\n      else\r\n        modules_by_path[path] = []\r\n      end\r\n    end\r\n    modules_by_path\r\n  end\r\n{code}', 'https://tickets.puppetlabs.com/browse/PUP-11166', 'https://github.com/puppetlabs/puppet/pull/8687', '2021-07-08T16:54:21.000-0700', '2021-11-30T02:48:23.000-0800', '2021-11-30T02:48:23.000-0800', 'Resolved', 'doc-reviewed', 2, '0', 1, 5, 10, 1, 'e771304e7f916b339393b418fca346b66839902e', 'https://tickets.puppetlabs.com/browse/PUP-11166', 'https://github.com/puppetlabs/puppet/pull/8687'),
('puppet', 412611, 0, 0, 'puppet agent silently skips augeas settings, possibly causing severe security problems', 'Nasty Security and Configuration problem.\r\n\r\nI"m currently testing and migrating an older puppet configuration made for puppet 5 (as delivered with ubuntu 20.04) with puppet 7. Since Ubuntu doesn"t deliver anything above puppet 5, I"m using\r\n\r\nserver side: Ubuntu 20.04, running puppet server in the official puppet/puppetserver, latest version from today, running puppetserver 7.3.0, installing some modules through Puppetfile\r\nclient side: Ubuntu 20.04, using the regular ruby package from ubuntu and the gem puppet 7.10.0\r\n\r\nI"m using the augeas \{...}  resource type to configure several security relevant file, e.g. to turn password authentication off in /etc/ssh/sshd_config.\r\n\r\nI"ve noticed that puppet agent --test  ran smoothly and silently without any error message, reporting success, but did not execute the augeas commands. Therefore, the configured machine is running as if puppet was successful, but still with weak security options.\r\n\r\n{color:#ff8b00}*This is highly dangerous.* {color}\r\n\r\nI did some debugging and found, that on the server side maybe thee module augeas_core was missing (which I have installed then) and on the client side the packages ruby-augeas and augeas-tools where not installed. Even then, it did not work, but silently reported success.\r\n\r\nThe reason is that the ubuntu package ruby-augeas contains the file\r\n\r\n/usr/lib/ruby/vendor_ruby/augeas.rb\r\n\r\nwhich is never found by the puppet agent. strace reveals that the agent looks for augeas.rb on plenty of locations, but not there, and thus never finds it.\r\n\r\nAgain, the agent does not report any problem, and silently finishes as if everything war running well, leaving files like /etc/ssh/sshd_config unconfigured.\r\n\r\nWhatever modules, gems, programs are missing or cannot be found, under no circumstances should puppet, neither server nor agent, ever report success for something it hasn"t actually done.\r\n\r\nI"m not really sure whether this is a server or agent side problem. But since the agent (unsuccessfully) tries to find augeas.rb and /opt/puppetlabs/puppet/cache/client_data/catalog/hostname.json contains the translated ressource, this is rather an agent side problem. \r\n \r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\n ', 'https://tickets.puppetlabs.com/browse/PUP-11209', '', '2021-08-18T17:51:36.000-0700', '2021-12-06T14:53:26.000-0800', '2021-12-06T14:53:26.000-0800', 'Resolved', 'doc-reviewed', 5, '0', 0, 0, 0, 0, 'da8b73edca174309a9bef5f62cd276933fe733e8', 'https://tickets.puppetlabs.com/browse/PUP-11209', 'https://github.com/puppetlabs/puppet/commit/da8b73edca174309a9bef5f62cd276933fe733e8'),
('puppet', 422993, 777131565, 8810, 'Puppet::FileSystem.chmod doesn"t validate its arguments like other FS methods', '{{Puppet::FileSystem}} methods generally assert that they are passed either a {{String}} or {{Pathname}} and raise {{ArgumentError}} if that isn"t the case. For example:\r\n\r\n{noformat}\r\nirb(main):009:0> Puppet::FileSystem.mkpath(nil)\r\n...\r\nArgumentError (FileSystem implementation expected Pathname, got: "NilClass")\r\n{noformat}\r\n\r\nHowever, {{Puppet::FileSystem.chmod}} raises an unhelpful {{TypeError}} trying to convert nil to a String:\r\n\r\n{noformat}\r\nirb(main):007:0> Puppet::FileSystem.chmod(0644, nil)\r\n...\r\nTypeError (no implicit conversion of nil into String)\r\n{noformat}\r\n\r\nThe {{chmod}} method should raise {{ArgumentError}} like the other methods', 'https://tickets.puppetlabs.com/browse/PUP-11345', 'https://github.com/puppetlabs/puppet/pull/8810', '2021-11-09T16:48:59.000-0800', '2021-12-07T19:46:59.000-0800', '2021-12-07T19:46:59.000-0800', 'Resolved', 'docs_reviewed', 3, '0', 3, 47, 17, 5, 'ee43ce64ec460893174c7e51e90c201e71de9c2e', 'https://tickets.puppetlabs.com/browse/PUP-11345', 'https://github.com/puppetlabs/puppet/pull/8810'),
('puppet', 419320, 756354659, 8792, 'puppet code merger should use concat not plus', 'lib/puppet/pops/parser/code_merger.rb calls Array#+ which makes an unnecessary copy of parse results. It should call Array#flat_map instead.', 'https://tickets.puppetlabs.com/browse/PUP-11318', 'https://github.com/puppetlabs/puppet/pull/8792', '2021-10-12T08:35:41.000-0700', '2021-12-07T20:09:47.000-0800', '2021-12-07T20:09:47.000-0800', 'Resolved', 'docs_reviewed', 2, '0', 3, 22, 5, 4, '1cb4979dc0e81a38139969708e3f4164555b8073', 'https://tickets.puppetlabs.com/browse/PUP-11318', 'https://github.com/puppetlabs/puppet/pull/8792'),
('puppet', 395282, 750468312, 8781, 'Plans apply function collides with resource types that have apply attribute', 'When using apply function in a Bolt as well as Puppet plan, it conflicts with a resource type that is having *apply* as an attribute. \r\n\r\nWays to reproduce:\r\n\r\nFinding a module *augeasproviders_sysctl* who has a resource type *sysctl* that has *apply* as an attribute.\r\n\r\nPlans with the following content will fail:\r\n{code:java}plan plans::test (\r\n  TargetSpec $targets = "localhost"\r\n) {\r\n#  out::message("Hello from plans::test")\r\n#  $command_result = run_command("whoami", $targets)$targets.apply_prep$apply_results = apply($targets)\r\n{\r\n$shmmax_size = 184467440\r\n      \r\nsysctl{ "kernel.shmmax":\r\n        apply => false,\r\n        ensure => present,\r\n        value => $shmmax_size,\r\n      }\r\n}\r\n}{code}\r\nWith errors:\r\n{code:java}Syntax error at "apply" (file: /root/boltProjects/43878/plans/plans/test.pp, line: 21, column: 8){code}\r\nIf we comment out the `apply` line within the resource type, it is working without an error.\r\n\r\nHowever, directly running *bolt apply* _doesn"t_ trigger the issue.\r\n{code:java}root@puppetmom manifests]# cat server.pp\r\n$shmmax_size = 184467440\r\nsysctl{ "kernel.shmmax":\r\nensure => present,\r\napply => false,\r\nvalue => $shmmax_size,\r\n}\r\n\r\n[root@puppetmom manifests]# bolt apply server.pp --targets localhost\r\nStarting: install puppet and gather facts on localhost\r\nFinished: install puppet and gather facts with 0 failures in 12.94 sec\r\nStarting: apply catalog on localhost\r\nStarted on localhost...\r\nFinished on localhost:\r\n  Notice: /Stage[main]/Main/Sysctl[kernel.shmmax]/value: changed configuration value from "" to "184467440"\r\n  changed: 1, failed: 0, unchanged: 0 skipped: 0, noop: 0\r\nFinished: apply catalog with 0 failures in 15.31 sec\r\nSuccessful on 1 node: localhost\r\nRan on 1 node in 28.41 sec\r\n\r\n[root@puppetmom manifests]# cat /etc/sysctl.conf\r\n# sysctl settings are defined through files in\r\n# /usr/lib/sysctl.d/, /run/sysctl.d/, and /etc/sysctl.d/.\r\n#\r\n# Vendors settings live in /usr/lib/sysctl.d/.\r\n# To override a whole file, create a new file with the same in\r\n# /etc/sysctl.d/ and put new settings there. To override\r\n# only specific settings, add a file with a lexically later\r\n# name in /etc/sysctl.d/ and put new settings there.\r\n#\r\n# For more information, see sysctl.conf(5) and sysctl.d(5).\r\nkernel.shmmax = 184467440 {code}\r\nIt looks like the inline function apply within a plan is conflicting with the keyword *apply* in a manifest.', 'https://tickets.puppetlabs.com/browse/PUP-11315', 'https://github.com/puppetlabs/puppet/pull/8781', '2021-04-13T17:46:08.000-0700', '2021-12-07T20:15:26.000-0800', '2021-12-07T20:15:26.000-0800', 'Resolved', 'docs_reviewed;jira_escalated', 2, '0', 2, 822, 796, 4, '05125268f98ee311e92fd907c158c2deb23c84ab', 'https://tickets.puppetlabs.com/browse/PUP-11315', 'https://github.com/puppetlabs/puppet/pull/8781'),
('puppet', 387911, 750051945, 8779, 'Puppet is trying to execute /etc/init.d/rc{0..6}.d directories', '*Puppet Version: 5.5.22*\r\n *Puppet Server Version: 5.3.7*\r\n *OS Name/Version: SLES 12 SP5*\r\n\r\nRunning *puppet agent -t* results in multiple error messages in /var/log/messages which state the following:\r\n\r\nCould not execute posix command: Permission denied - /etc/init.d/rc0.d\r\n\r\nRunning puppet in debug mode gives the following hint:\r\n\r\n*Debug: Executing: "/etc/init.d/rc0.d status"*\r\n\r\nThese files have 755 permissions, owner is root and are part of the *insserv-compat* package.\r\n\r\n \r\n\r\n*Desired Behavior:*\r\n\r\n*Not having these error messages*\r\n\r\n ', 'https://tickets.puppetlabs.com/browse/PUP-11313', 'https://github.com/puppetlabs/puppet/pull/8779', '2021-02-18T05:32:18.000-0800', '2021-12-07T20:18:47.000-0800', '2021-12-07T20:18:47.000-0800', 'Resolved', 'community;docs_reviewed;needs_repro', 6, '0', 3, 50, 49, 5, '2d177e909d047f2c716e9d048da27893a8c5be6f', 'https://tickets.puppetlabs.com/browse/PUP-11313', 'https://github.com/puppetlabs/puppet/pull/8779'),
('puppet', 414011, 760921714, 8797, 'Reduce allocated memory in `lib/puppet/pops/parser/lexer2.rb`', 'PUP-11232 added *# frozen_string_literal: true* to some high memory consumption files but even after that, [lib/puppet/pops/parser/lexer2.rb|https://github.com/puppetlabs/puppet/blob/6.x/lib/puppet/pops/parser/lexer2.rb] still seems to have the most memory allocated.\r\n\r\nProposed investigation direction as stated by [~josh]:\r\n{panel}\r\nI"m guessing the lexer2 allocations are due to the closure scope bound to each [lambda|https://github.com/puppetlabs/puppet/blob/6.x/lib/puppet/pops/parser/lexer2.rb#L187-L580]? I"m thinking Ruby may be doing more work than is necessary to create the Binding as each token is scanned and the corresponding lambda is called? Or perhaps it"s the [byteslice|https://github.com/puppetlabs/puppet/blob/6.x/lib/puppet/pops/parser/lexer2.rb#L197] calls?\r\n{panel}\r\n\r\n\r\n\r\n', 'https://tickets.puppetlabs.com/browse/PUP-11236', 'https://github.com/puppetlabs/puppet/pull/8797', '2021-09-01T05:51:42.000-0700', '2021-12-07T20:42:14.000-0800', '2021-12-07T20:42:14.000-0800', 'Resolved', 'docs_reviewed', 3, '0', 1, 39, 0, 1, '1ce7d99dcbeb9524584b3a2769f86e93faa9179c', 'https://tickets.puppetlabs.com/browse/PUP-11236', 'https://github.com/puppetlabs/puppet/pull/8797'),
('puppet', 418025, 747874781, 8776, 'Reduce memory usage from Pathname absolute?', 'Pathname.absolute?("/a/b/c/etc") makes recursively smaller copies of the path, e.g. "/a/b/c", "/a/b", "/a", "", which leads to excessive numbers of temporary strings. Pathname was fixed upstream and that was included in ruby 3.0, but it would be good to apply the same to our 2.x builds:\r\n\r\nSee https://github.com/ruby/ruby/commit/39312cf4d6c2ab3f07d688ad1a467c8f84b58db0\r\n\r\n ', 'https://tickets.puppetlabs.com/browse/PUP-11311', 'https://github.com/puppetlabs/puppet/pull/8776', '2021-10-01T09:06:49.000-0700', '2021-12-07T20:42:32.000-0800', '2021-12-07T20:42:32.000-0800', 'Resolved', 'docs_reviewed', 2, '0', 2, 40, 1, 4, 'bda1e273234d2952a15f68c4d1e4afea22521f7d', 'https://tickets.puppetlabs.com/browse/PUP-11311', 'https://github.com/puppetlabs/puppet/pull/8776'),
('puppet', 413995, 746752310, 8773, 'versioncmp() thinks 11.0 is greater than 11', '*Puppet Version:* 6.24.0\r\n*Puppet Server Version:* none\r\n*OS Name/Version:* Debian 11\r\n\r\nwhile debugging https://github.com/puppetlabs/puppetlabs-apache/pull/2186 i noticed that versioncmp("11.0", "11") doesn"t return 0, it returns 1. Is that expected?\r\n\r\n*Desired Behavior:*\r\n\r\nI think 11.0 and 11 should be treated as equal\r\n\r\n*Actual Behavior:*\r\n\r\nversioncmp() thinks 11.0 is greater than 11\r\n\r\nto debug:\r\n{code}\r\nnotify { "operatingsystemrelease compared to 11: ${versioncmp($::operatingsystemrelease, "11")}":\r\n}\r\nnotify { "operatingsystemmajrelease compared to 11: ${versioncmp($::operatingsystemmajrelease, "11")}":\r\n}\r\nnotify { "operatingsystemrelease: ${::operatingsystemrelease}":\r\n}\r\nnotify { "operatingsystemmajrelease: ${::operatingsystemrelease}":\r\n}\r\n{code}\r\n\r\nwhich brings us:\r\n{code}\r\npuppet apply test.pp\r\nNotice: Compiled catalog for blal in environment production in 0.02 seconds\r\nNotice: operatingsystemrelease compared to 11: 1\r\nNotice: /Stage[main]/Main/Notify[operatingsystemrelease compared to 11: 1]/message: defined "message" as "operatingsystemrelease compared to 11: 1"\r\nNotice: operatingsystemmajrelease compared to 11: 0\r\nNotice: /Stage[main]/Main/Notify[operatingsystemmajrelease compared to 11: 0]/message: defined "message" as "operatingsystemmajrelease compared to 11: 0"\r\nNotice: operatingsystemrelease: 11.0\r\nNotice: /Stage[main]/Main/Notify[operatingsystemrelease: 11.0]/message: defined "message" as "operatingsystemrelease: 11.0"\r\nNotice: operatingsystemmajrelease: 11.0\r\nNotice: /Stage[main]/Main/Notify[operatingsystemmajrelease: 11.0]/message: defined "message" as "operatingsystemmajrelease: 11.0"\r\nNotice: Applied catalog in 0.01 seconds\r\n{code}\r\n\r\nand the facts:\r\n{code}\r\n:~> facter operatingsystemmajrelease\r\n11\r\n:~> facter operatingsystemrelease\r\n11.0\r\n{code}\r\n', 'https://tickets.puppetlabs.com/browse/PUP-11235', 'https://github.com/puppetlabs/puppet/pull/8773', '2021-09-01T01:47:31.000-0700', '2021-12-07T20:45:17.000-0800', '2021-12-07T20:45:17.000-0800', 'Resolved', 'docs_reviewed;help_wanted', 3, '0', 2, 71, 22, 3, 'baf7048b09bfcac75907147dfbb0590ff8124060', 'https://tickets.puppetlabs.com/browse/PUP-11235', 'https://github.com/puppetlabs/puppet/pull/8773'),
('puppet', 411148, 753234977, 8784, 'puppet lookup --facts {filename} fails if filename does not contain a dot', 'Calling:\r\n{code:java}\r\npuppet lookup --facts dummy keyX\r\nError: Could not parse application options: undefined method `[]" for nil:NilClass\r\n{code}\r\nFails because the code that verifies the filename expects, that the filename contains a dot:\r\n{code:java}\r\n  option("--facts FACT_FILE") do |arg|\r\n    if %w{.yaml .yml .json}.include?(arg.match(/\.[^.]*$/)[0])\r\n      options[:fact_file] = arg\r\n    else\r\n      raise _("The --fact file only accepts yaml and json files.\n%{run_help}") % { run_help: RUN_HELP }\r\n    end\r\n  end\r\n{code}\r\nAlso, verifying based on the filename that the file contains json/yaml data is not correct in my opinion. In my opinion, the following should also be supported:\r\n{code:java}\r\npuppet lookup --facts <(puppet facts find $nodename | jq .values) --node $nodename keyX\r\n{code}', 'https://tickets.puppetlabs.com/browse/PUP-11204', 'https://github.com/puppetlabs/puppet/pull/8784', '2021-08-09T07:41:38.000-0700', '2021-12-08T08:14:46.000-0800', '2021-12-08T08:14:46.000-0800', 'Resolved', 'docs_reviewed', 0, '0', 1, 312, 48, 6, '430ffa30cc480cc6e43cacb55f09532f13d8cbdf', 'https://tickets.puppetlabs.com/browse/PUP-11204', 'https://github.com/puppetlabs/puppet/pull/8784'),
('puppet', 356460, 753887313, 8786, 'facts provided in a file cannot be used for classification', 'If a facts file is provided to puppet lookup, then its contents are merged to the node"s facts after classification, which means the lookup may be occur in the wrong environment.\r\n\r\nIt would be more consistent if lookup retrieved facts using the facts terminus, merged the facts file, and submitted the facts in the node request.', 'https://tickets.puppetlabs.com/browse/PUP-10435', 'https://github.com/puppetlabs/puppet/pull/8786', '2020-04-22T17:49:27.000-0700', '2021-12-08T08:18:39.000-0800', '2021-12-08T08:18:39.000-0800', 'Resolved', 'docs_reviewed', 2, '0', 1, 23, 13, 2, 'b8fa3a41fd10c6d553c9a69f3099ed39daa72023', 'https://tickets.puppetlabs.com/browse/PUP-10435', 'https://github.com/puppetlabs/puppet/pull/8786'),
('puppet', 224769, 765532053, 8800, 'Verify trusted facts are overridden consistently', 'The handling of trusted facts in the lookup CLI is somewhat unclear. In this ticket we need to discuss and decide on how it should handle trusted information and if something needs to change.\r\n\r\nSee background in PUP-7507.', 'https://tickets.puppetlabs.com/browse/PUP-8220', 'https://github.com/puppetlabs/puppet/pull/8800', '2017-11-30T01:25:58.000-0800', '2021-12-08T08:24:08.000-0800', '2021-12-08T08:24:08.000-0800', 'Resolved', 'docs_reviewed', 8, '0', 1, 35, 0, 2, '38c221f0aeb67a51e4888277972c5100385c045d', 'https://tickets.puppetlabs.com/browse/PUP-8220', 'https://github.com/puppetlabs/puppet/pull/8800'),
('puppet', 114746, 783926189, 8824, 'Filenames in recursive directories appear to be shell expanded', 'When a file in a directory used as a source for a recursive file resource starts with a {{\~}}, then it"s evaluated as a username. I didn"t check to see if other patterns expand. This is a real edge case, except that some editors save backup files with a prepended {{\~}}.\r\n\r\n{code}\r\nroot@ip-172-31-8-159:~ # puppet apply test.pp\r\nNotice: Compiled catalog for puppetfactory.puppetlabs.vm in environment production in 0.03 seconds\r\nNotice: /Stage[main]/Main/File[/tmp/test]/ensure: created\r\nError: Could not set "file" on ensure: user bar.txt20160201-23101-1o0dulq doesn"t exist\r\nError: Could not set "file" on ensure: user bar.txt20160201-23101-1o0dulq doesn"t exist\r\nWrapped exception:\r\nuser bar.txt20160201-23101-1o0dulq doesn"t exist\r\nError: /Stage[main]/Main/File[/tmp/test/~bar.txt]/ensure: change from absent to file failed: Could not set "file" on ensure: user bar.txt20160201-23101-1o0dulq doesn"t exist\r\nNotice: Applied catalog in 0.28 seconds\r\nroot@ip-172-31-8-159:~ # cat test.pp\r\nfile { "/tmp/test":\r\n  ensure  => directory,\r\n  recurse => true,\r\n  source  => "/root/foo",\r\n}\r\n\r\nroot@ip-172-31-8-159:~ # ls foo/\r\n~bar.txt\r\n{code}\r\n', 'https://tickets.puppetlabs.com/browse/PUP-5800', 'https://github.com/puppetlabs/puppet/pull/8824', '2016-02-01T14:37:24.000-0800', '2021-12-08T08:33:57.000-0800', '2021-12-08T08:33:57.000-0800', 'Resolved', 'docs_reviewed', 2, '0', 2, 8, 2, 2, '030f8331e77e1582ee9483e817f982ad4764e423', 'https://tickets.puppetlabs.com/browse/PUP-5800', 'https://github.com/puppetlabs/puppet/pull/8824'),
('puppet', 23952, 782475197, 8820, 'Puppet hangs trying to replace a FIFO', 'Puppet does some stupid things trying to replace a FIFO, including opening it and trying to MD5 the content.\r\n\r\nThis allows a DoS for any managed file that can be replaced with a disconnected FIFO, at least.\r\n\r\nTo reproduce:\r\n{noformat}\r\nmkfifo /tmp/boom\r\npuppet apply <<EOT\r\nfile { "/tmp/boom": ensure => file, content => "Hello, World" }\r\nEOT\r\n{noformat}', 'https://tickets.puppetlabs.com/browse/PUP-1460', 'https://github.com/puppetlabs/puppet/pull/8820', '2014-01-17T01:06:47.000-0800', '2021-12-08T08:41:31.000-0800', '2021-12-08T08:41:31.000-0800', 'Resolved', 'docs_reviewed;redmine', 4, '0', 1, 64, 1, 2, '0f59f12cf7c8fd4d5afb5f021dbff6ad9f66513a', 'https://tickets.puppetlabs.com/browse/PUP-1460', 'https://github.com/puppetlabs/puppet/pull/8820'),
('puppet', 405068, 681704021, 8667, 'Puppet type "user" does not honor "purge_ssh_keys: false"', 'It seems that the type {{user}} does not honor setting {{purge_ssh_keys => false}} correctly.\r\n\r\npuppet language:\r\n{code:config}\r\nuser { "myuser":\r\n  ensure => present,\r\n  [...]\r\n  purge_ssh_keys => false,\r\n}\r\n{code}\r\n\r\nleads to the following warning:\r\n{code:log}\r\n/Stage[main]/Mymodule/Mymodule::Mydefinedtype[myuser]/User[myuser] (warning): Ssh_authorized_key type is not available. Cannot purge SSH keys.\r\n{code}\r\n\r\n\r\nDiving into the code, this seems logical: https://github.com/puppetlabs/puppet/blob/main/lib/puppet/type/user.rb#L698\r\n\r\n{{self[:purge_ssh_keys]}} may take values {{:true}}, {{:false}} and {{["string1", "string2"]}}, but\r\n{code:ruby}\r\nirb(main):001:0> foo = :false\r\nirb(main):002:0> foo.empty?\r\n=> false\r\nirb(main):003:1* if !foo.empty?\r\nirb(main):004:1*   puts "something wrong here"\r\nirb(main):005:0> end\r\nsomething wrong here\r\n=> nil\r\n{code}\r\n\r\nI"d recommend the following patch to fix this:\r\n{code:ruby}\r\n--- /opt/puppetlabs/puppet/lib64/ruby/vendor_ruby/puppet/type/user.rb	2021-06-29 14:56:58.756944173 +0200\r\n+++ /tmp/user.rb	2021-06-29 14:56:35.920004027 +0200\r\n@@ -695,7 +695,7 @@\r\n     end\r\n \r\n     def generate\r\n-      if !self[:purge_ssh_keys].empty?\r\n+      if !self[:purge_ssh_keys].empty? && !(self[:purge_ssh_keys] == :false)\r\n         return [] if self[:ensure] == :present && !provider.exists? \r\n         if Puppet::Type.type(:ssh_authorized_key).nil?\r\n           warning _("Ssh_authorized_key type is not available. Cannot purge SSH keys.")\r\n{code}', 'https://tickets.puppetlabs.com/browse/PUP-11131', 'https://github.com/puppetlabs/puppet/pull/8667', '2021-06-29T07:01:54.000-0700', '2021-12-08T16:57:45.000-0800', '2021-12-08T16:57:45.000-0800', 'Resolved', 'doc-reviewed', 6, '0', 1, 1, 1, 1, '2cb83ae8eed73031d95862b130e32007d47a802c', 'https://tickets.puppetlabs.com/browse/PUP-11131', 'https://github.com/puppetlabs/puppet/pull/8667'),
('puppet', 147251, 417934478, 8157, 'purge_ssh_keys parameter requires home to be set in the manifest', 'If you try to manage a user using puppet and set purge_ssh_keys option to true, it fails unless the user has home directory set in the manifest. For example:\r\n\r\n{noformat}\r\n  user { "root":\r\n    purge_ssh_keys => true,\r\n  }\r\n{noformat}\r\n\r\nExpected result:\r\n\r\nKeys are purged.\r\n\r\nActual result:\r\n\r\n{color:red}Failed to apply catalog: Parameter purge_ssh_keys failed on User[root]: Munging failed for value true in class purge_ssh_keys: purge_ssh_keys can only be true for users with a defined home directory at PATH_TO_MANIFEST_HERE{color}', 'https://tickets.puppetlabs.com/browse/PUP-10506', 'https://github.com/puppetlabs/puppet/pull/8157', '2016-08-15T13:00:43.000-0700', '2021-12-08T16:59:07.000-0800', '2021-12-08T16:59:07.000-0800', 'Resolved', 'doc_reviewed;purge_ssh_keys;ssh_authorized_key;user', 3, '0', 1, 20, 20, 2, 'b424130fedcc7c79fac939487f5bc69f920c061b', 'https://tickets.puppetlabs.com/browse/PUP-10506', 'https://github.com/puppetlabs/puppet/pull/8157'),
('puppet', 399645, 651937036, 8610, 'Specifying purge_ssh_keys parameter for non-existing user errors out', '*Puppet Version:* 7.6.1\r\n*Puppet Server Version:* N/A - reproducible via local {{puppet apply}}\r\n*OS Name/Version:* Ubuntu 20.04 (LTS "Focal")\r\n\r\n----\r\n\r\nA {{user}} resource, with {{purge_ssh_keys}} parameter provided as either {{true}} or as an array of paths results in a "Failed to apply catalog" error, if the user account does not previously exist.\r\n\r\n{code:bash}\r\n$ puppet apply -e "user { "test123": ensure => present, purge_ssh_keys => true, }" --noop\r\n{code}\r\n\r\n\r\n*Desired Behavior:*\r\n\r\nUser account is created, with SSH keys as provided.\r\nSSH key purging for user is enforced following creation.\r\n\r\n*Actual Behavior:*\r\n\r\n{noformat}\r\nNotice: Compiled catalog for host.example.com in environment production in 0.02 seconds\r\nError: Parameter purge_ssh_keys failed on User[test123]: Munging failed for value true in class purge_ssh_keys: user test123 doesn"t exist (line: 1)\r\n{noformat}', 'https://tickets.puppetlabs.com/browse/PUP-11067', 'https://github.com/puppetlabs/puppet/pull/8610', '2021-05-15T05:16:40.000-0700', '2021-12-08T16:59:07.000-0800', '2021-12-08T16:59:07.000-0800', 'Resolved', 'community;docs-reviewed', 1, '0', 1, 169, 20, 3, '5c8472ca2b6266cb22cfb896663ac0b191609c63', 'https://tickets.puppetlabs.com/browse/PUP-11067', 'https://github.com/puppetlabs/puppet/pull/8610'),
('puppet', 419684, 806363036, 8847, 'Regression on user resource', '*Puppet Version: 7.8.0 6.23.0 6.24.0 6.24.1 6.25.1*\r\n *Puppet Server Version:* -\r\n *OS Name/Version: RHEL 7 RHEL 8 CENTOS 7 CENTOS 8*\r\n\r\nThe user resource is not working as expected since puppet agent 6.23/7.8.\r\n\r\nDuring a puppet run, if a user is created by any utility (package / exec), the puppet user resource try to luseradd the same user instead of lusermod as the user already exists.\r\n\r\n \r\n\r\nThe following code:\r\n{code}\r\nexec { "/sbin/luseradd -u 50080 -M myuser": }\r\n-> user { "myuser":\r\n  uid        => 50081,\r\n  forcelocal => true,\r\n}\r\n{code}\r\nproduce an error on user resource\r\n\r\n*Desired Behavior:*\r\n before version 6.23\r\n{code}\r\nNotice: /Stage[main]/Main/Exec[/sbin/luseradd -u 50080 -M myuser]/returns: executed successfully\r\nNotice: /Stage[main]/Main/User[myuser]/uid: uid changed "50080" to 50081\r\n{code}\r\n \r\n\r\n*Actual Behavior:*\r\n version 6.23 and after\r\n{code}\r\nNotice: /Stage[main]/Main/Exec[/sbin/luseradd -u 50080 -M myuser]/returns: executed successfully\r\nError: Could not create user myuser: Execution of "/usr/sbin/luseradd -g myuser -u 50081 -M myuser" returned 3: Account creation failed: entry already present in file.\r\nError: /Stage[main]/Main/User[myuser]/ensure: change from "absent" to "present" failed: Could not create user myuser: Execution of "/usr/sbin/luseradd -g myuser -u 50081 -M myuser" returned 3: Account creation failed: entry already present in file.\r\n{code}\r\nSeem regression introduced by https://tickets.puppetlabs.com/browse/PUP-11067\r\n\r\nseems puppet 7.9 has fixed default behavior with https://tickets.puppetlabs.com/browse/PUP-11131 but not done on puppet 6. \r\n\r\nwith:\r\n{code:java}\r\n-      if !self[:purge_ssh_keys].empty?\r\n+     if !self[:purge_ssh_keys].empty? && self[:purge_ssh_keys] != :false\r\n           return [] if self[:ensure] == :present && !provider.exists?\r\n{code}\r\n \r\n\r\n(I don"t see exactly the link between the regression and this purge_ssh_keys setting, but changing this, is fixing it)\r\n\r\nBut if the purge_ssh_keys is set to true, it is not working anymore even in puppet 7.12 agent...\r\n{code}\r\nexec { "/sbin/luseradd -u 50080 -M myuser": }\r\n-> user { "myuser":\r\n  uid            => 50081,\r\n  forcelocal     => true,\r\n  purge_ssh_keys => true,\r\n}\r\n{code}\r\n\r\n{code}\r\nNotice: /Stage[main]/Main/Exec[/sbin/luseradd -u 50080 -M myuser]/returns: executed successfully\r\nError: Could not create user myuser: Execution of "/usr/sbin/luseradd -g myuser -u 50081 -M myuser" returned 3: Account creation failed: entry already present in file.\r\nError: /Stage[main]/Main/User[myuser]/ensure: change from "absent" to "present" failed: Could not create user myuser: Execution of "/usr/sbin/luseradd -g myuser -u 50081 -M myuser" returned 3: Account creation failed: entry already present in file.\r\n\r\n{code}', 'https://tickets.puppetlabs.com/browse/PUP-11320', 'https://github.com/puppetlabs/puppet/pull/8847', '2021-10-15T05:29:11.000-0700', '2021-12-14T09:58:48.000-0800', '2021-12-14T09:58:48.000-0800', 'Resolved', 'docs_reviewed', 2, '0', 1, 3, 3, 1, '0343d57302956e9338eaf83ddfd90dce30794993', 'https://tickets.puppetlabs.com/browse/PUP-11320', 'https://github.com/puppetlabs/puppet/pull/8847'),
('puppet', 419688, 792185198, 8828, 'Warning: #<Puppet::Transaction::Persistence since upgrade to puppet-agent 6.25.0', '*Puppet Version:* 6.25.0\r\n *Puppet Server Version:* 6.0.10\r\n *OS Name/Version:* Debian GNU/Linux 11 (bullseye)\r\n\r\nSince puppet-agent has been upgraded from 6.24.0, we get warnings on nodes using a specific configuration involving [cataphract/yaml_settings|https://forge.puppet.com/modules/cataphract/yaml_settings] wrapped by [trepasi/cassandra|https://forge.puppet.com/modules/trepasi/cassandra].\r\n\r\n*Desired Behavior:* work without warnings\r\n\r\n*Actual Behavior:* while the catalog is applied properly, warnings are raised for every hash key passed to the values parameter of yaml_settings resource stating a type cast issue.\r\n\r\nExample:\r\n\r\nNode manifest includes a {{contain cassandra}} and gets parameter via Hiera:\r\n{code:yaml}cassandra::config:\r\n  listen_address: "%{facts.networking.ip}"\r\n  broadcast_rpc_address: "%{facts.networking.ip}"\r\n  rpc_address: 0.0.0.0\r\n  num_tokens: 256\r\n  auto_bootstrap: true\r\n  cluster_name: "Test Cassandra %{facts.mam_stage}"\r\n  endpoint_snitch: GossipingPropertyFileSnitch\r\n  authenticator: PasswordAuthenticator\r\n  authorizer: CassandraAuthorizer\r\n  seed_provider:\r\n    - class_name: org.apache.cassandra.locator.SimpleSeedProvider\r\n      parameters:\r\n        - seeds: 10.90.21.10,10.90.18.238\r\n  diagnostic_events_enabled: true\r\n{code}\r\nOutput of {{puppet agent --test}} on a node includes the warnings:\r\n{code:console}Warning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0] contains a hash with an Array key. It will be converted to the String "["listen_address"]"\r\nWarning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0] contains a hash with an Array key. It will be converted to the String "["broadcast_rpc_address"]"\r\nWarning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0] contains a hash with an Array key. It will be converted to the String "["rpc_address"]"\r\nWarning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0] contains a hash with an Array key. It will be converted to the String "["num_tokens"]"\r\nWarning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0] contains a hash with an Array key. It will be converted to the String "["auto_bootstrap"]"\r\nWarning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0] contains a hash with an Array key. It will be converted to the String "["cluster_name"]"\r\nWarning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0] contains a hash with an Array key. It will be converted to the String "["endpoint_snitch"]"\r\nWarning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0] contains a hash with an Array key. It will be converted to the String "["authenticator"]"\r\nWarning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0] contains a hash with an Array key. It will be converted to the String "["authorizer"]"\r\nWarning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0] contains a hash with an Array key. It will be converted to the String "["seed_provider"]"\r\nWarning: #<Puppet::Transaction::Persistence:0x00005598a2c1ebf8>["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0]["resources"]["Yaml_settings[cassandra::config]"]["parameters"]["values"]["system_value"][0] contains a hash with an Array key. It will be converted to the String "["diagnostic_events_enabled"]"\r\n{code}\r\nDebug and trace options does not unveil more relevant information.\r\n\r\nContents of the transaction store on the node however changed from:\r\n{code:transactionstore.yaml}  Yaml_settings[cassandra::config]:\r\n    parameters:\r\n      values:\r\n        system_value:\r\n        - ? - listen_address\r\n          : 10.90.18.238\r\n          ? - broadcast_rpc_address\r\n          : 10.90.18.238\r\n          ? - rpc_address\r\n          : 0.0.0.0\r\n          ? - num_tokens\r\n          : 256\r\n          ? - auto_bootstrap\r\n          : true\r\n          ? - cluster_name\r\n          : Test Cassandra qa\r\n          ? - endpoint_snitch\r\n          : GossipingPropertyFileSnitch\r\n          ? - authenticator\r\n          : PasswordAuthenticator\r\n          ? - authorizer\r\n          : CassandraAuthorizer\r\n          ? - seed_provider\r\n          : - class_name: org.apache.cassandra.locator.SimpleSeedProvider\r\n              parameters:\r\n              - seeds: 10.90.21.10,10.90.18.238\r\n          ? - diagnostic_events_enabled\r\n          : true\r\n{code}\r\nwith 6.24.0 to:\r\n{code:transactionstore.yaml}  Yaml_settings[cassandra::config]:\r\n    parameters:\r\n      values:\r\n        system_value:\r\n        - "["listen_address"]": 10.90.18.238\r\n          "["broadcast_rpc_address"]": 10.90.18.238\r\n          "["rpc_address"]": 0.0.0.0\r\n          "["num_tokens"]": 256\r\n          "["auto_bootstrap"]": true\r\n          "["cluster_name"]": Test Cassandra qa\r\n          "["endpoint_snitch"]": GossipingPropertyFileSnitch\r\n          "["authenticator"]": PasswordAuthenticator\r\n          "["authorizer"]": CassandraAuthorizer\r\n          "["seed_provider"]":\r\n          - class_name: org.apache.cassandra.locator.SimpleSeedProvider\r\n            parameters:\r\n            - seeds: 10.90.21.10,10.90.18.238\r\n          "["diagnostic_events_enabled"]": true\r\n{code}\r\nwith 6.25.0, which is the only change on the node.\r\n\r\nThings need to be clarified:\r\n * is this an actual issue involving a poor usage pattern\r\n * could this lead to a future issue\r\n * could the warnings be suppressed if not relevant\r\n\r\n ', 'https://tickets.puppetlabs.com/browse/PUP-11321', 'https://github.com/puppetlabs/puppet/pull/8828', '2021-10-15T05:57:49.000-0700', '2021-12-16T12:45:51.000-0800', '2021-12-16T12:45:51.000-0800', 'Resolved', 'docs_reviewed;jira_escalated', 6, '0', 2, 79, 88, 4, '27b7c7387403291038464250e9b41ddaf626233b', 'https://tickets.puppetlabs.com/browse/PUP-11321', 'https://github.com/puppetlabs/puppet/pull/8828'),
('puppet', 421154, 766412772, 8802, 'Puppet agent may download all plugins after updating', 'When using a server-specified environment, the agent will re-download all of its plugins after updating to 6.25.0 or 7.12.0. This occurs, because the agent cannot determine what the last server-specified environment was. So it will:\r\n\r\n* fallback to "production"\r\n* download plugins from "production"\r\n* request a catalog from "production"\r\n* be redirected to the original environment\r\n* download plugins from the original environment\r\n* request a catalog from the original environment\r\n\r\nIf the puppet-agent package on the server is not updated to 6.25/7.12 or later, and the server-specified environment references a fact that doesn"t exist in the "production" environment, then the "hop back" to the original environment will fail as described in PUP-9570.\r\n\r\nTo prevent the agent from redownloading all plugins, the agent should fallback to making a node request if its last run summary does not contain the last server-specified environment.\r\n\r\nThis was originally reported in PUP-11323 and PUP-11327.', 'https://tickets.puppetlabs.com/browse/PUP-11328', 'https://github.com/puppetlabs/puppet/pull/8802', '2021-10-25T15:35:19.000-0700', '2022-01-05T04:46:33.000-0800', '2022-01-05T04:46:33.000-0800', 'Closed', 'doc-reviewed;needs_repro', 21, '0', 2, 182, 33, 3, '9d3e630a6729e1b0bbecb2dc64295618e4033da2', 'https://tickets.puppetlabs.com/browse/PUP-11328', 'https://github.com/puppetlabs/puppet/pull/8802'),
('puppet', 111071, 56474427, 4578, 'Add Iterable type and runtime object', 'Commit 3a9db247c432d469e625d4abf7bee8e747178af9 regressed support for "descending" ranges, where the "max" is less than the "min":\r\n\r\n{code}\r\nnotice Integer[5, 1]\r\nInteger[5, 1].each |$x| {\r\n  notice $x\r\n}\r\n{code}\r\n\r\nThis is expected to output:\r\n{code}\r\nNotice: Scope(Class[main]): Integer[5, 1]\r\nNotice: Scope(Class[main]): 5\r\nNotice: Scope(Class[main]): 4\r\nNotice: Scope(Class[main]): 3\r\nNotice: Scope(Class[main]): 2\r\nNotice: Scope(Class[main]): 1\r\n{code}\r\n\r\nThis is because having a maximum less than a minimum treats the range as being in "descending" order.\r\n\r\nInstead, this is the actual output:\r\n{code}\r\nNotice: Scope(Class[main]): Integer[1, 5]\r\nNotice: Scope(Class[main]): 1\r\nNotice: Scope(Class[main]): 2\r\nNotice: Scope(Class[main]): 3\r\nNotice: Scope(Class[main]): 4\r\nNotice: Scope(Class[main]): 5\r\n{code}\r\n\r\nIt appears the min and max are silently being swapped when the max < min.\r\n\r\nRelated: I believe the compiler should error if a type is given a max argument less than a min argument when the type does not support a "descending" semantic, e.g. {{Callable[1, 0]}} should error rather than silently swapping the min and max.', 'https://tickets.puppetlabs.com/browse/PUP-5648', 'https://github.com/puppetlabs/puppet/pull/4578', '2016-01-04T15:53:17.000-0800', '2022-01-05T17:00:43.000-0800', '2022-01-05T17:00:43.000-0800', 'Closed', '', 42, '0', 6, 985, 139, 18, '4ae1ab4d6ade307fa939f69886ef0fbc5a9bbb7b', 'https://tickets.puppetlabs.com/browse/PUP-5648', 'https://github.com/puppetlabs/puppet/pull/4578'),
('puppet', 425101, 790175912, 8827, 'The pw user provider should support creating system users', 'When managing users with system=true, the pw provider should restrict uid / gid to system users.', 'https://tickets.puppetlabs.com/browse/PUP-11369', 'https://github.com/puppetlabs/puppet/pull/8827', '2021-11-28T13:19:05.000-0800', '2022-01-10T07:36:49.000-0800', '2022-01-10T07:36:49.000-0800', 'Needs Information', '', 1, '0', 1, 8, 1, 2, '', 'https://tickets.puppetlabs.com/browse/PUP-11369', 'https://github.com/puppetlabs/puppet/pull/8827'),
('puppet', 69478, 782783262, 8821, 'Failed to generate additional resources using "eval_generate": Cannot manage files of type socket', 'Using a slightly modified version of the code from "Pro Puppet" I am getting the following error:\r\n\r\n{code}\r\n    Jun 13 01:36:33 media puppet-agent[18196]: (/Stage[main]/Mysql::Config/File[mysql_data_dir]) Failed to generate additional resources using "eval_generate": Cannot manage files of type socket\r\n{code}\r\n\r\nThe file resource in mysql/manifests/config.pp is as follows: \r\n\r\n{code}\r\n    file { "mysql_data_dir" :\r\n        path => $mysql::params::data_directory,\r\n        group => "mysql",\r\n        owner => "mysql",\r\n        recurse => true,\r\n        require => File["my.cnf"],\r\n    }\r\n{code}\r\n\r\nAnd for this particular $operatingsystem (Fedora) the value for $data_directory in mysql/manifests/params.pp is :\r\n\r\n{code}\r\n    $data_directory = "/var/lib/mysql"\r\n{code}\r\n\r\nBy default mysql on a Fedora system places its mysql.sock file in the data directory but it appears when a you try and change the permissions recursively, puppet doesn"t know what to do with the socket file. \r\n\r\nI can place the socket file elsewhere as a work around but I believe that puppet needs to ignore socket files when changing permissions. \r\n\r\n{code}\r\n    [root@media modules]# puppet --version\r\n    2.6.8\r\n    [root@media modules]# puppet master --version\r\n    2.6.8\r\n{code}\r\n', 'https://tickets.puppetlabs.com/browse/PUP-4045', 'https://github.com/puppetlabs/puppet/pull/8821', '2015-02-26T01:58:41.000-0800', '2022-01-11T20:15:26.000-0800', '2022-01-11T20:15:26.000-0800', 'Resolved', 'customer;docs_reviewed;jira_escalated;redmine', 7, '0', 1, 72, 0, 2, '50d0adc053bf191148690e2b166f353ac8b1c3be', 'https://tickets.puppetlabs.com/browse/PUP-4045', 'https://github.com/puppetlabs/puppet/pull/8821'),
('puppet', 124108, 64593619, 4822, 'Circular type aliases are not handled gracefully.', 'The following code:\r\n\r\n{code}\r\ntype Foo = Bar\r\ntype Bar = Foo\r\n0 =~ Bar\r\n{code}\r\n\r\nproduces:\r\n\r\n{code}\r\nError: Could not run: stack level too deep\r\n{code}\r\n\r\nExpected an error message saying that type {{Bar}} cannot be resolved due to a circular reference.\r\n\r\nAlso reproduced with a self-reference:\r\n\r\n{code}\r\ntype Foo = Foo\r\n0 =~ Foo\r\n{code}\r\n\r\nACCEPTANCE CRITERIA\r\n----\r\n* That a circular type alias does not cause an out of stack error\r\n* That the error message identifies at least one of the involved types in the circularity in the error message', 'https://tickets.puppetlabs.com/browse/PUP-6108', 'https://github.com/puppetlabs/puppet/pull/4822', '2016-03-29T14:50:58.000-0700', '2022-01-12T20:58:34.000-0800', '2022-01-12T20:58:34.000-0800', 'Closed', '', 4, '0', 1, 142, 56, 2, 'c7dfe3dc80ea241786c27f5826deef199cacae1a', 'https://tickets.puppetlabs.com/browse/PUP-6108', 'https://github.com/puppetlabs/puppet/pull/4822'),
('puppet', 313541, 318279357, 7726, 'Merge of lookup_options not working', '*Puppet Version: 5.5.14*\r\n *Puppet Server Version: 5.3.8*\r\n *OS Name/Version: RHEL 7.x*\r\n\r\nIn our Hiera data, we have made use of lookup_options to control the merge behaviour, so in our catch-all common.yaml there are entries such as:\r\n{noformat}---\r\nlookup_options:\r\n  profile::autofs::mounts:\r\n    merge: hash {noformat}\r\nThis works as desired. However we have some exceptions where we want to override this on a per-role basis back to the original "first" behaviour, so as we have a higher priority role level, I added the following in a role/foo.yaml:\r\n{noformat}---\r\nlookup_options:\r\n  profile::autofs::mounts:\r\n    merge: first {noformat}\r\nIf I use the "puppet lookup" command against the correct host, this appears to work as desired, using `--explain-options` I get the following result:\r\n{noformat}  Merged result: {\r\n    "profile::autofs::mounts" => {\r\n      "merge" => "first"\r\n    }\r\n  }{noformat}\r\nFor any other hosts I still get the behaviour defined at the common level:\r\n{noformat}  Merged result: {\r\n    "profile::autofs::mounts" => {\r\n      "merge" => "hash"\r\n    }\r\n  } {noformat}\r\nAll good. However this doesn"t seem to actually apply to the lookup itself:\r\n{noformat}Using merge options from "lookup_options" hash\r\nSearching for "profile::autofs::mounts"  Merge strategy hash\r\n  ... {noformat}\r\nIt only ever picks up the behaviour defined at the common level.\r\n\r\n*Desired Behavior:*\r\n\r\nI would expect to see:\r\n{noformat}Using merge options from "lookup_options" hash\r\nSearching for "profile::autofs::mounts"  ... {noformat}\r\ni.e. (no merge strategy displayed here)\r\n\r\n*Actual Behavior:*\r\n\r\nOne bit of information that might be relevant is that in order for our lookups to work from the CLI, I have to use the --compile option, so basically something like:\r\n{noformat}puppet lookup --compile --environment <env> --node <node> profile::autofs::mounts --explain(-options){noformat}\r\nWe have multiple backends/levels configured in Hiera, a mix of YAML/eYAML and using the HTTP backend too.\r\n\r\n \r\n\r\nI noticed there was PUP-7037 which was raised for similar behaviour but was ultimately traced to a typo. I"m confident this isn"t down to a typo.\r\n\r\n \r\n\r\nEdit: After a bit more experimenting, I was a bit confused about where "hash" should be printed vs other merge strategies, the "Using merge options from "lookup_options" hash" is pretty much a fixed string, it"s the presence/lack of "Merge strategy ..." that is the identifier.', 'https://tickets.puppetlabs.com/browse/PUP-9792', 'https://github.com/puppetlabs/puppet/pull/7726', '2019-06-21T04:09:02.000-0700', '2022-01-12T22:03:09.000-0800', '2022-01-12T22:03:09.000-0800', 'Accepted', '', 11, '0', 1, 8, 0, 2, '', 'https://tickets.puppetlabs.com/browse/PUP-9792', 'https://github.com/puppetlabs/puppet/pull/7726'),
('puppet', 341077, 687891539, 8691, 'Failure to fetch node definition may result in bad pluginsync and cascading failure', '*Puppet Version:* all\r\n\r\nEarly on in the agent run process, Puppet calls an indirector to choose an environment to pluginsync against. If _anything_ goes wrong with that call, pretty much anything at all, Puppet will *pluginsync against the agent-configured environment* (usually "production") and spit out a warning.\r\n{code}Warning: Unable to fetch my node definition, but the agent run will continue{code}\r\n \r\n\r\n*Desired Behavior:*\r\n\r\nPuppet should pluginsync against the *last-used environment*, or alternatively, *fail fast*. At customer sites where "production" is not used, pluginsyncing against what is probably an empty environment has been observed to add ten minutes+ of time to a Puppet agent run, as it first deletes all of its plugins, and then has to re-sync them fresh from the correct environment after it switches over. This can negatively affect the delivery of changes that need to be performed within a change control window.\r\n\r\n*Actual Behavior:*\r\n\r\nPuppet pluginsyncs against *production*, or the environment value set with {{--environment}} or in puppet.conf.\r\n\r\n \r\n\r\n*Reproduction:*\r\n * Create an environment "r1" and "production"\r\n * Pin a test agent to "r1"\r\n * Edit /etc/puppetlabs/puppetserver/conf.d/auth.conf to disallow the test agent from requesting the /puppet/v3/node path\r\n * Run {{puppet agent}} -t on the test agent\r\n\r\nThe agent will produce the expected error, pluginsync against production, retrieve a catalog, switch to r1, pluginsync against r1, retrieve a catalog, and apply it.\r\n\r\nThe kind of problem this can cause may be made clearly evident if you supply a fact in environment r1 that is needed to compile an r1 catalog. See below.\r\n{code:java}\r\n[root@pe-xl-compiler-2 ~]# puppet agent -t\r\nWarning: Unable to fetch my node definition, but the agent run will continue:\r\nWarning: Error 403 on SERVER: Forbidden request: /puppet/v3/node/pe-xl-compiler-2.dev36.puppet.vm (method :get). Please see the server logs for details.\r\nInfo: Retrieving pluginfacts\r\nNotice: /File[/opt/puppetlabs/puppet/cache/facts.d/r1.txt]/ensure: removed\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Loading facts\r\nError: Could not retrieve catalog from remote server: Error 500 on SERVER: Server Error: Evaluation Error: Error while evaluating a Function Call, Fact r1_fact does not exist! (file: /etc/puppetlabs/code/environments/r1/manifests/site.pp, line: 29, column: 5) on node pe-xl-compiler-2.dev36.puppet.vm\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\n{code}\r\nSpecifying r1 with the environment flag mitigates the issue, and demonstrates what a better behavior might look like when this problem occurs.\r\n{code:java}\r\n[root@pe-xl-compiler-2 ~]# puppet agent -t --environment=r1\r\nWarning: Unable to fetch my node definition, but the agent run will continue:\r\nWarning: Error 403 on SERVER: Forbidden request: /puppet/v3/node/pe-xl-compiler-2.dev36.puppet.vm (method :get). Please see the server logs for details.\r\nInfo: Retrieving pluginfacts\r\nNotice: /File[/opt/puppetlabs/puppet/cache/facts.d/r1.txt]/ensure: defined content as "{md5}13b8114b76258d0104dd0568b031361d"\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Loading facts\r\nInfo: Caching catalog for pe-xl-compiler-2.dev36.puppet.vm\r\nInfo: Applying configuration version "pe-xl-core-0-r1-bb4c21dbce5"\r\nNotice: Applied catalog in 14.23 seconds  {code}', 'https://tickets.puppetlabs.com/browse/PUP-10216', 'https://github.com/puppetlabs/puppet/pull/8691', '2020-01-03T14:11:31.000-0800', '2022-01-17T17:42:05.000-0800', '2022-01-17T17:42:05.000-0800', 'Resolved', 'doc-reviewed;jira_escalated', 6, '0', 2, 249, 179, 20, 'e928d5cc5b92e0e5d2a0ae28fa1fda5b8c03612c', 'https://tickets.puppetlabs.com/browse/PUP-10216', 'https://github.com/puppetlabs/puppet/pull/8691'),
('puppet', 72541, 0, 0, 'Add Utopic Unicorn 14.10 and Debian 8 jessie host configurations', 'Add host configuration files for utopic unicorn 14.10 and debian 8 jessie', 'https://tickets.puppetlabs.com/browse/PUP-4279', '', '2015-03-20T16:22:50.000-0700', '2022-01-18T06:53:30.000-0800', '2022-01-18T06:53:30.000-0800', 'Resolved', 'AIO', 2, '0', 0, 0, 0, 0, '76afe2e8c7d7942c805e99f83f115a27d78684a8', 'https://tickets.puppetlabs.com/browse/PUP-4279', 'https://github.com/puppetlabs/puppet/commit/76afe2e8c7d7942c805e99f83f115a27d78684a8'),
('puppet', 147771, 83124601, 5237, 'Information Disclosure - Puppet Server Stacktraces', 'The new Puppet Server 2.5 and Puppet 4.6 now provide way too much information when a server side error occurs.  The new {{Could not retrieve catalog from remote server: Error 500 on SERVER: }} now prints a JSON object of the entire server side stacktrace, which leads to information disclosure (ref [CERT Secure Coding|https://www.securecoding.cert.org/confluence/display/java/ERR01-J.+Do+not+allow+exceptions+to+expose+sensitive+information]).  This message object contains the original error message, but it also contains the full stacktrace.  \r\n\r\nPuppet Server shouldn"t expose the stacktrace.  ', 'https://tickets.puppetlabs.com/browse/PUP-6659', 'https://github.com/puppetlabs/puppet/pull/5237', '2016-08-18T06:25:05.000-0700', '2022-01-18T06:53:31.000-0800', '2022-01-18T06:53:31.000-0800', 'Closed', '', 12, '0', 2, 17, 12, 5, '7a765b70bb392f1d6ce9c230686f780d249720d0', 'https://tickets.puppetlabs.com/browse/PUP-6659', 'https://github.com/puppetlabs/puppet/pull/5237'),
('puppet', 406565, 689356772, 8694, 'Add RHEL9 support for services', '*Puppet Version:*\r\npuppet-7.8.0\r\n\r\n*Puppet Server Version:*\r\n*OS Name/Version:*\r\n\r\nCentOS Stream 9\r\n\r\nDescribe your issue in as much detail as possible…\r\n\r\nUsing the service provider results in chkconfig being used instead of systemd. This is similar to the steps we had to do for PUP-9069\r\n\r\nDescribe steps to reproduce…\r\n\r\nUse the service provider to manage a service.\r\n\r\n*Desired Behavior:*\r\n\r\nsystemd provider is used\r\n\r\n*Actual Behavior:*\r\n\r\nchkconfig provider is used\r\n\r\n*Example*\r\nhttps://github.com/openstack/puppet-pacemaker/blob/master/manifests/service.pp#L60-L66\r\n\r\nResults in:\r\n\r\n<13>Jul 12 19:00:39 puppet-user: Error: Could not enable pcsd: Execution of "/sbin/chkconfig --add pcsd" returned 1: error reading information on service pcsd: No such file or directory\r\n<13>Jul 12 19:00:39 puppet-user: Error: /Stage[main]/Pacemaker::Service/Service[pcsd]/ensure: change from "stopped" to "running" failed: Could not enable pcsd: Execution of "/sbin/chkconfig --add pcsd" returned 1: error reading information on service pcsd: No such file or directory\r\n\r\n', 'https://tickets.puppetlabs.com/browse/PUP-11168', 'https://github.com/puppetlabs/puppet/pull/8694', '2021-07-12T12:29:52.000-0700', '2022-01-24T04:29:59.000-0800', '2022-01-24T04:29:59.000-0800', 'Resolved', 'doc-reviewed', 1, '0', 1, 2, 2, 2, 'b8711b541c04fde2326a6471da965fe1feafe9f0', 'https://tickets.puppetlabs.com/browse/PUP-11168', 'https://github.com/puppetlabs/puppet/pull/8694'),
('puppet', 419463, 758247277, 8794, 'Updated puppet gem and rspec-puppet Failures', 'Hi,\r\n\r\nWhen updating the puppet gem from 7.11 --> 7.12, we are now seeing rspec-puppet (via onceover) failures for all Windows related tests:\r\n{code:java}\r\nrole::windows::hyperv: failed\r\n  errors:\r\n    uninitialized constant Puppet::Util::Windows::Service\r\n      factsets: windows-2016-x86_64\r\n{code}\r\nAt a quick glance I didn"t find any of our currently used modules using that, but will keep looking for any helpful information to provide.', 'https://tickets.puppetlabs.com/browse/PUP-11319', 'https://github.com/puppetlabs/puppet/pull/8794', '2021-10-13T07:16:21.000-0700', '2022-01-31T11:29:57.000-0800', '2022-01-31T11:29:57.000-0800', 'Resolved', 'customer0;doc-reviewed', 2, '0', 1, 3, 5, 2, '44eb6870b66ff440a78057ac9635174115c5163c', 'https://tickets.puppetlabs.com/browse/PUP-11319', 'https://github.com/puppetlabs/puppet/pull/8794'),
('puppet', 432109, 830351651, 8862, 'Use systemd provider by default in RHEL/CentOS', 'Since RHEL7/CentOS7, systemd is used to manage services.\r\n\r\nHowever in RHEL/CentOS, the old "redhat" provider is used by default, and the module should be updated when adding support for a new version.\r\n\r\n ', 'https://tickets.puppetlabs.com/browse/PUP-11433', 'https://github.com/puppetlabs/puppet/pull/8862', '2022-01-24T04:29:59.000-0800', '2022-02-01T13:48:58.000-0800', '2022-02-01T13:48:58.000-0800', 'Needs Information', '', 0, '0', 1, 8, 7, 3, '', 'https://tickets.puppetlabs.com/browse/PUP-11433', 'https://github.com/puppetlabs/puppet/pull/8862'),
('puppet', 383136, 589333867, 8536, 'When blocking legacy facts in puppet7, puppet agent run fails to fetch "operatingsystem" fact', 'In puppet 7, when blocking legacy facts, puppet agent run will fail in PE trying to fetch the "operatingsystem" fact [here|https://github.com/puppetlabs/puppet/blob/main/lib/puppet/provider/service/init.rb#L24] with following error\r\n{code}\r\n# puppet agent -t --debug\r\n...\r\nDebug: Facter: Loading internal facts\r\nDebug: Facter: Loading all internal facts\r\nDebug: Facter: Loading external facts\r\nDebug: Facter: Loading custom facts\r\nDebug: Facter: Loading external facts\r\nDebug: Facter: User query is: ["operatingsystem"]\r\nDebug: Facter: Query is operatingsystem\r\nDebug: Facter: Checking query tokens operatingsystem\r\nDebug: Facter: List of resolvable facts: []\r\nDebug: Facter: Resolving facts sequentially\r\nError: Could not autoload puppet/provider/service/init: undefined method `downcase" for nil:NilClass\r\nError: Could not autoload puppet/provider/service/bsd: Could not autoload puppet/provider/service/init: undefined method `downcase" for nil:NilClass\r\nError: Could not autoload puppet/type/service: Could not autoload puppet/provider/service/bsd: Could not autoload puppet/provider/service/init: undefined method `downcase" for nil:NilClass\r\nError: Could not retrieve catalog from remote server: Failed to deserialize Puppet::Resource::Catalog from rich_data_json: Could not autoload puppet/type/service: Could not autoload puppet/provider/service/bsd: Could not autoload puppet/provider/service/init: undefined method `downcase" for nil:NilClass\r\nWrapped exception:\r\nCould not autoload puppet/type/service: Could not autoload puppet/provider/service/bsd: Could not autoload puppet/provider/service/init: undefined method `downcase" for nil:NilClass\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\n...\r\n{code}', 'https://tickets.puppetlabs.com/browse/PUP-10853', 'https://github.com/puppetlabs/puppet/pull/8536', '2021-01-13T10:39:39.000-0800', '2022-02-01T13:59:18.000-0800', '2022-02-01T13:59:18.000-0800', 'Accepted', '', 8, '0', 1, 494, 493, 146, 'f75363ea79ad7021328b0f801208fc98f30a30f1', 'https://tickets.puppetlabs.com/browse/PUP-10853', 'https://github.com/puppetlabs/puppet/pull/8536'),
('puppet', 380578, 783720977, 8823, 'Binary, Sensitive, etc deferred results can corrupt the transaction store', 'If the result of a deferred function is the desired value for a resource"s property, then the agent will save that in the transaction store, causing an error the next time the agent runs. As a result, our ability to report on corrective/intentional change is lost.\r\n\r\nGiven {{site.pp}} containing:\r\n\r\n{code:puppet}\r\nnotify { "deferred":\r\n  message => Deferred.new("binary_file", ["/tmp/binary"])\r\n}\r\n{code}\r\n\r\nwhere {{/tmp/binary}} contains {{hi\n}}, the agent evaluates the deferred function correctly:\r\n\r\n{noformat}\r\n[root@keen-lecture ~]# rm -f /opt/puppetlabs/puppet/cache/state/transactionstore.yaml\r\n[root@keen-lecture ~]# rm -f /opt/puppetlabs/puppet/cache/client_data/catalog/$(facter fqdn).json\r\n[root@keen-lecture ~]# puppet agent -t\r\nInfo: Using configured environment "production"\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Loading facts\r\nInfo: Caching catalog for keen-lecture.delivery.puppetlabs.net\r\nInfo: Applying configuration version "1607561363"\r\nNotice: aGkK\r\nNotice: /Stage[main]/Main/Notify[deferred]/message: defined "message" as Binary("aGkK")\r\nNotice: Applied catalog in 0.01 seconds\r\n{noformat}\r\n\r\nBut the transactionstore contains the raw {{Puppet::Pops::Types::PBinaryType::Binary}} object, not the pcore representation:\r\n\r\n{noformat}\r\n[root@keen-lecture ~]# cat /opt/puppetlabs/puppet/cache/state/transactionstore.yaml\r\n---\r\nresources:\r\n  Notify[deferred]:\r\n    parameters:\r\n      message:\r\n        system_value:\r\n        - !ruby/object:Puppet::Pops::Types::PBinaryType::Binary\r\n          binary_buffer: "hi\r\n\r\n"\r\n{noformat}\r\n\r\nThe next agent run will generate an error:\r\n\r\n{noformat}\r\n[root@keen-lecture ~]# puppet agent -t\r\nInfo: Using configured environment "production"\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Retrieving locales\r\nInfo: Loading facts\r\nInfo: Caching catalog for keen-lecture.delivery.puppetlabs.net\r\nError: Transaction store file /opt/puppetlabs/puppet/cache/state/transactionstore.yaml is corrupt ((/opt/puppetlabs/puppet/cache/state/transactionstore.yaml): Tried to load unspecified class: Puppet::Pops::Types::PBinaryType::Binary); replacing\r\nWrapped exception:\r\nTried to load unspecified class: Puppet::Pops::Types::PBinaryType::Binary\r\nInfo: Applying configuration version "1607561397"\r\nNotice: aGkK\r\nNotice: /Stage[main]/Main/Notify[deferred]/message: defined "message" as Binary("aGkK")\r\nNotice: Applied catalog in 0.01 seconds\r\n{noformat}\r\n\r\nThis issue doesn"t happen if the deferred result is type that YAML natively supports (string, integer, etc).\r\n\r\nPuppet should probably be using {{Puppet::Pops::Serialization::ToDataConverter}} to persist the transactionstore instead of yaml.', 'https://tickets.puppetlabs.com/browse/PUP-10820', 'https://github.com/puppetlabs/puppet/pull/8823', '2020-12-09T17:03:21.000-0800', '2022-02-02T06:48:36.000-0800', '2022-02-02T06:48:36.000-0800', 'Resolved', 'doc-reviewed', 5, '0', 2, 16, 87, 4, '4e466d6a45fc699e2b9ef11d9b008e61dd0e2d1f', 'https://tickets.puppetlabs.com/browse/PUP-10820', 'https://github.com/puppetlabs/puppet/pull/8823'),
('puppet', 419718, 760971597, 8798, 'Excessive copying of already merged code for the main hostclass', 'When parsing manifests, we merge the main hostclass" code. Each merge creates a new BlockExpression containing the children from the old and new codes: https://github.com/puppetlabs/puppet/blob/e0ea9a23bc867d337abf6c9d274e46729b058f15/lib/puppet/resource/type.rb#L145\r\n\r\nThis means we"re copying the code that has already been merged into {{self}} N times and the array gets bigger each time. The many_modules benchmark creates 100 modules each with 11 manifests and it generates an extra 11MB of allocated memory.\r\n\r\nIt seems like we should be *appending* the new code with the already merged code while preserving the flattening behavior.', 'https://tickets.puppetlabs.com/browse/PUP-11322', 'https://github.com/puppetlabs/puppet/pull/8798', '2021-10-15T10:29:08.000-0700', '2022-02-02T17:05:27.000-0800', '2022-02-02T17:05:27.000-0800', 'Closed', '', 1, '0', 2, 53, 12, 3, '', 'https://tickets.puppetlabs.com/browse/PUP-11322', 'https://github.com/puppetlabs/puppet/pull/8798'),
('puppet', 170107, 127657655, 6022, 'Insufficient logging when encountering "permission denied" on environmentpath', 'It seems that when the puppetserver runs into "permission denied" when trying to cd into a configured environmentpath, there"s no message to be found of that happening in the puppetservers logs, nor does that show in the puppet agent output (it just completes really quickly.\r\n\r\nI understand that there is automatic fallback to the next configured path (seperated by a colon in the config line), or even the default path, but it would be nice if the result of that selection process would get logged into puppetserver log in some way especially when it ran into a access problem on the way, and not "just" a non-existing folder.\r\n\r\nPresumably this same problem also exists with other configuration options that allow colons to denote several possible paths to be tried. The lack of detail in the logs makes it harder then necessary to debug a relatively simple problem.', 'https://tickets.puppetlabs.com/browse/PUP-7102', 'https://github.com/puppetlabs/puppet/pull/6022', '2017-01-13T04:54:29.000-0800', '2022-02-07T23:43:59.000-0800', '2022-02-07T23:43:59.000-0800', 'Ready for Engineering', '', 24, '0', 6, 180, 15, 5, 'e4a4e09323436c5e44bc3b3154f42cd020c05a92', 'https://tickets.puppetlabs.com/browse/PUP-7102', 'https://github.com/puppetlabs/puppet/pull/6022'),
('puppet', 155674, 691543072, 8701, 'Agent cannot compile catalog if it specifies an non-existent environment in puppet.conf even when the classifier is controlling environment', 'h1.  The Problem\r\n\r\n{code}\r\n[root@agent201621-centos ~]# puppet agent -t \r\nInfo: Using configured environment "production"\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for agent201621-centos\r\nInfo: Applying configuration version "1475855527"\r\nNotice: Applied catalog in 0.40 seconds\r\n\r\n[root@agent201621-centos ~]# puppet config set environment fake --section agent\r\n\r\n[root@agent201621-centos ~]# puppet agent -t\r\nWarning: Unable to fetch my node definition, but the agent run will continue:\r\nWarning: Error 400 on SERVER: Could not find environment "fake"\r\nInfo: Retrieving pluginfacts\r\nError: /File[/opt/puppetlabs/puppet/cache/facts.d]: Failed to generate additional resources using "eval_generate": Error 400 on SERVER: Could not find environment "fake"\r\nError: /File[/opt/puppetlabs/puppet/cache/facts.d]: Could not evaluate: Could not retrieve file metadata for puppet:///pluginfacts: Error 400 on SERVER: Could not find environment "fake"\r\nInfo: Retrieving plugin\r\nError: /File[/opt/puppetlabs/puppet/cache/lib]: Failed to generate additional resources using "eval_generate": Error 400 on SERVER: Could not find environment "fake"\r\nError: /File[/opt/puppetlabs/puppet/cache/lib]: Could not evaluate: Could not retrieve file metadata for puppet:///plugins: Error 400 on SERVER: Could not find environment "fake"\r\nInfo: Loading facts\r\nError: Could not retrieve catalog from remote server: Error 400 on SERVER: Could not find environment "fake"\r\nWarning: Not using cache on failed catalog\r\nError: Could not retrieve catalog; skipping run\r\nError: Could not send report: Error 400 on SERVER: Could not find environment "fake"\r\n{code}\r\n\r\nNow if I go ahead and make the environment on the master, it"ll compile the catalog against the production environment as expected.  \r\n\r\nOn the master: \r\n{code}\r\n[root@master201621-centos ~]# cp -r /etc/puppetlabs/code/environments/production/ /etc/puppetlabs/code/environments/fake\r\n{code}\r\n\r\nNow on the agent:\r\n{code}\r\n[root@agent201621-centos ~]# puppet agent -t\r\nNotice: Local environment: "fake" doesn"t match server specified node environment "production", switching agent to "production".\r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for agent201621-centos\r\nInfo: Applying configuration version "1475855805"\r\nNotice: Applied catalog in 0.36 seconds\r\n{code}\r\n\r\nh1.  Expected Behavior\r\n\r\nThe existence of the environment that the agent sets in puppet.conf should not matter if the ENC is controlling the environment.  I expect this message in both cases.  \r\n\r\n{code}\r\nNotice: Local environment: "fake" doesn"t match server specified node environment "production", switching agent to "production".\r\n{code}', 'https://tickets.puppetlabs.com/browse/PUP-6802', 'https://github.com/puppetlabs/puppet/pull/8701', '2016-10-07T08:58:39.000-0700', '2022-02-09T23:58:11.000-0800', '2022-02-09T23:58:11.000-0800', 'Resolved', 'doc-reviewed;tcse;the-goods', 11, '0', 1, 72, 5, 8, 'f7cf9f318d4c1a83f6ccc24a6d697d519429cf76', 'https://tickets.puppetlabs.com/browse/PUP-6802', 'https://github.com/puppetlabs/puppet/pull/8701'),
('puppet', 295431, 504476845, 8395, 'Setting certname in multiple sections bypasses validation', '*Puppet Version:* 6.0.5\r\n *Puppet Server Version:* N/A\r\n *OS Name/Version:* Windows Server 2012, CentOS 7\r\n\r\nWhen a config file is created with the certname setting on both the agent and main sections as follows:\r\n{code:java}\r\n[main]\r\ncertname = my-windows-server.puppet.com\r\n[agent]\r\ncertname = MY-WINDOWS-SERVER.puppet.com\r\n{code}\r\nPuppet"s validation that certnames must be lowercase if bypassed and allows for very broken certs to be generated\r\n\r\n*Desired Behavior:* Cert generation fails with "Error: Could not initialize global default settings: Certificate names must be lower case"\r\n\r\n*Actual Behavior:* Certs are generated with uppercase names\r\n\r\n ', 'https://tickets.puppetlabs.com/browse/PUP-9481', 'https://github.com/puppetlabs/puppet/pull/8395', '2019-02-08T01:43:22.000-0800', '2022-02-15T22:11:24.000-0800', '2022-02-15T22:11:24.000-0800', 'Resolved', 'doc_reviewed', 2, '0', 7, 443, 241, 5, '25254664c54f9500ce9622fed5d3a90eb487626f', 'https://tickets.puppetlabs.com/browse/PUP-9481', 'https://github.com/puppetlabs/puppet/pull/8395'),
('puppet', 214573, 780769835, 8819, 'Lookup ignores environment from the classifier when using rule with trusted facts', 'I have 2 environments, production and acceptance.\r\n\r\nI have an environment group for Acceptance:\r\n\r\n{code}\r\nnode_group { "Acceptance Environment":\r\n  ensure               => "present",\r\n  environment          => "acceptance",\r\n  id                   => "539f71ae-50d3-42f6-8201-289dba160ba5",\r\n  override_environment => "true",\r\n  parent               => "Production environment",\r\n  rule                 => ["and",\r\n  ["~",\r\n    ["trusted", "extensions", "pp_role"],\r\n    "agent"]],\r\n}\r\n{code}\r\n\r\n"Production Environment" node group has not been modified.\r\n\r\nWhen I run puppet agent in a node with pp_role = agent, I confirm that it is using the right environment:\r\n\r\n{code}\r\n[root@10-32-175-131 ~]# puppet agent -t\r\nNotice: Local environment: "production" doesn"t match server specified node environment "acceptance", switching agent to "acceptance".\r\n{code}\r\n\r\nYet when I try to do a lookup for that node, the data retrieved is from Production:\r\n\r\n{code}\r\npuppet lookup --node 10-32-175-131.rfc1918.puppetlabs.net message --explain\r\nSearching for "message"\r\n  Global Data Provider (hiera configuration version 5)\r\n    Using configuration "/etc/puppetlabs/puppet/hiera.yaml"\r\n    Hierarchy entry "Classifier Configuration Data"\r\n      No such key: "message"\r\n  Environment Data Provider (hiera configuration version 5)\r\n    Using configuration "/etc/puppetlabs/code/environments/production/hiera.yaml"\r\n    Hierarchy entry "Per-node data"\r\n{code}\r\n\r\nIf I pin the node to the "Acceptance Environment" group, I get the right output for lookup:\r\n\r\n{code}\r\nnode_group { "Acceptance Environment":\r\n  ensure               => "present",\r\n  environment          => "acceptance",\r\n  id                   => "539f71ae-50d3-42f6-8201-289dba160ba5",\r\n  override_environment => "true",\r\n  parent               => "Production environment",\r\n  rule                 => ["or",\r\n  ["and",\r\n    ["~",\r\n      ["trusted", "extensions", "pp_role"],\r\n      "agent"]],\r\n  ["=", "name", "10-32-175-131.rfc1918.puppetlabs.net"]],\r\n}\r\n{code}\r\n\r\n{code}\r\nroot@10-32-175-155.rfc1918.puppetlabs.net /root> puppet lookup --node 10-32-175-131.rfc1918.puppetlabs.net message --explain\r\nSearching for "message"\r\n  Global Data Provider (hiera configuration version 5)\r\n    Using configuration "/etc/puppetlabs/puppet/hiera.yaml"\r\n    Hierarchy entry "Classifier Configuration Data"\r\n      No such key: "message"\r\n  Environment Data Provider (hiera configuration version 5)\r\n    Using configuration "/etc/puppetlabs/code/environments/acceptance/hiera.yaml"\r\n{code}\r\n\r\nFound the issue in LTS, reproduced in 2017.3.0.\r\n\r\nEDIT: A rule created with an out-of-the-box fact like domain honors the environment. A rule created with a trusted fact defaults to production. A mix of trusted + normal fact, like trusted.extensions.pp_role + domain defaults to production.', 'https://tickets.puppetlabs.com/browse/PUP-8094', 'https://github.com/puppetlabs/puppet/pull/8819', '2017-10-04T11:25:32.000-0700', '2022-02-20T16:32:06.000-0800', '2022-02-20T16:32:06.000-0800', 'Resolved', 'docs_reviewed', 30, '0', 2, 17, 4, 2, '3338148f1bb91a7edcab8cb33f9845910619a08c', 'https://tickets.puppetlabs.com/browse/PUP-8094', 'https://github.com/puppetlabs/puppet/pull/8819'),
('puppet', 425363, 793907170, 8834, 'Server with multithreaded enabled hangs after upgrade v6 -> v7', 'After upgrading from Puppet v6 to v7, the server hangs after ~10 min of work. More precisely, *there are no free JRuby Instances*. All configs (puppetserver, puppetdb, puppetagent) including resources are absolutely equal between v6 and v7.  We have ~300 agents, the server is configured according to an official guideline. v6 has worked with no issues. \r\n\r\nConfig, environment, thread dump, graphs, and logs are attached. \r\n\r\n[Heapdump is here.|https://drive.google.com/file/d/1STOr8L9YzbzbDGmH8YyiOeUSDuOM6rTR/view?usp=sharing] ', 'https://tickets.puppetlabs.com/browse/PUP-11373', 'https://github.com/puppetlabs/puppet/pull/8834', '2021-12-01T06:19:08.000-0800', '2022-02-22T11:45:04.000-0800', '2022-02-22T11:45:04.000-0800', 'Resolved', 'docs-reviewed', 9, '0', 1, 21, 17, 1, '0a626f14ac8ed7717f443aa021150373f78283a4', 'https://tickets.puppetlabs.com/browse/PUP-11373', 'https://github.com/puppetlabs/puppet/pull/8834'),
('puppet', 401491, 788750730, 8826, 'puppet generate types should return non-zero when types cannot be generated', 'When {{puppet generate types}} cannot generate types, it will error, but it explicitly just logs it and keeps going.\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/1a13e0cf96c70b303492e684f9ccf4c38207b3dd/lib/puppet/generate/type.rb#L204-L211\r\n\r\n{code}\r\n[~/.puppetlabs/etc/code/environments/production]$ puppet generate types\r\nNotice: Generating Puppet resource types.\r\nError: /Users/ben/.puppetlabs/etc/code/environments/production/modules/drupal/lib/puppet/type/drupal_module.rb: title patterns that use procs are not supported.\r\nError: /Users/ben/.puppetlabs/etc/code/environments/production/modules/drupal/lib/puppet/type/drupal_theme.rb: title patterns that use procs are not supported.\r\nError: /Users/ben/.puppetlabs/etc/code/environments/production/modules/drupal/lib/puppet/type/drupal_variable.rb: title patterns that use procs are not supported.\r\n[~/.puppetlabs/etc/code/environments/production]$ echo $?\r\n0\r\n{code}\r\n\r\nThis might be so that code manager doesn"t fail when code is deployed, but this is certainly not expected. Should there be an option for explicit error codes?', 'https://tickets.puppetlabs.com/browse/PUP-11078', 'https://github.com/puppetlabs/puppet/pull/8826', '2021-06-02T16:44:55.000-0700', '2022-02-22T21:00:36.000-0800', '2022-02-22T21:00:36.000-0800', 'Resolved', 'docs-reviewed', 0, '0', 1, 75, 0, 3, '9e1ba56e3011daecb075df72bd8c258906152325', 'https://tickets.puppetlabs.com/browse/PUP-11078', 'https://github.com/puppetlabs/puppet/pull/8826'),
('puppet', 428219, 816876376, 8855, 'puppet lookup --explain fails out of the box starting with 7.13.1', 'Starting with Puppet 7.13.1 (as installed via YUM for EL7) `puppet lookup --explain` now fails.\r\n{code:java}\r\n puppet lookup --explain test\r\nError: Failed to initialize SSL: The CA certificates are missing from "/etc/puppetlabs/puppet/ssl/certs/ca.pem"\r\nError: Run `puppet agent -t`\r\nError: Connection to https://puppet:8140/puppet-ca/v1 failed, trying next route: Request to https://puppet:8140/puppet-ca/v1 failed after 0.001 seconds: The CA certificates are missing from "/etc/puppetlabs/puppet/ssl/certs/ca.pem"\r\nWrapped exception:\r\nThe CA certificates are missing from "/etc/puppetlabs/puppet/ssl/certs/ca.pem"\r\nError: Could not run: No more routes to ca{code}\r\n7.12.1 and prior do not have this issue.', 'https://tickets.puppetlabs.com/browse/PUP-11402', 'https://github.com/puppetlabs/puppet/pull/8855', '2021-12-29T13:24:21.000-0800', '2022-02-22T21:01:17.000-0800', '2022-02-22T21:01:17.000-0800', 'Resolved', 'docs-reviewed', 2, '0', 1, 1, 1, 1, '30ee48be4495375a09813adcad4b14c53bab8506', 'https://tickets.puppetlabs.com/browse/PUP-11402', 'https://github.com/puppetlabs/puppet/pull/8855'),
('puppet', 427206, 814625125, 8853, 'Regression: agent no longer calls local enc script', 'As a result of changes made in the environment convergence epic, the agent no longer calls the {{Puppet::Node}} terminus to resolve the environment during the run (before doing pluginsync and the catalog request). If the agent is configured to use a **local** enc, then it will no longer be called.\r\n\r\nSee [~gabriel.nagy] comment in https://tickets.puppetlabs.com/browse/PUP-11328?focusedCommentId=839470&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-839470 for more information.\r\n\r\nWe should re-add this capability with the following notes:\r\n\r\n1. The terminus should only be called when the following is true:\r\n\r\n{code:ruby}\r\n      unless (cached_catalog || options[:catalog] || Puppet[:strict_environment_mode])\r\n{code}\r\n\r\n2. The terminus should only be called if it"s overridden from the default.\r\n\r\n3. If the terminus should be called with the same parameters as last time, e.g. transaction_uuid.\r\n\r\n4. If the terminus returns a node, then the agent should use its environment as the "last known environment" ignoring what is stored in the last run summary.\r\n\r\n5. If the terminus returns a node whose environment is nil, then I"m not sure. We should check what happened previously.', 'https://tickets.puppetlabs.com/browse/PUP-11379', 'https://github.com/puppetlabs/puppet/pull/8853', '2021-12-14T08:42:46.000-0800', '2022-02-22T21:01:23.000-0800', '2022-02-22T21:01:23.000-0800', 'Closed', 'docs_reviewed', 1, '0', 1, 102, 59, 3, '3a7cf6754a6a7c91e37f89f84e1d667d554fdd0b', 'https://tickets.puppetlabs.com/browse/PUP-11379', 'https://github.com/puppetlabs/puppet/pull/8853'),
('puppet', 421293, 803304044, 8842, 'Puppet::Node#environment_name may return the wrong value', 'If an environment instance is set on a node, then the {{Node#environment_name}} returns nil, but {{Node#environment}} returns the instance whose name is the expected symbolic value:\r\n\r\n{noformat}\r\nirb(main):010:0> node = Puppet::Node.new("hostname")\r\n=> #<Puppet::Node:0x00005582e746c3e0 @name="hostname", @classes=[], @parameters={}, @facts=nil, @server_facts={}, @time...\r\nirb(main):011:0> node.environment = Puppet::Node::Environment.remote("www123")\r\n=> <Puppet::Node::Environment::Remote:7880 @name="www123" @manifest="no_manifest" @modulepath="" >\r\nirb(main):012:0> node.environment_name\r\n=> nil\r\nirb(main):013:0> node.environment.name\r\n=> :www123\r\n{noformat}\r\n\r\nHowever, setting {{environment_name}} on the node *DOES* cause {{Node#environment}} to load that environment (which must exist on disk):\r\n\r\n{noformat}\r\nirb(main):001:0> require "puppet"\r\n=> true\r\nirb(main):002:0> Puppet.initialize_settings\r\n=> {}\r\nirb(main):003:0> FileUtils.mkdir(File.join(Puppet[:environmentpath], "www123"))\r\n=> ["/home/josh/.puppetlabs/etc/code/environments/www123"]\r\nirb(main):004:0> run_mode = Puppet::Util::RunMode[:agent]\r\n=> #<Puppet::Util::UnixRunMode:0x00005582e7075520 @name=:agent>\r\nirb(main):005:0> Puppet::ApplicationSupport.push_application_context(run_mode)\r\n=> #<Puppet::Context::Stack:0x00005582e646cc88 ...\r\nirb(main):006:0> node = Puppet::Node.new("hostname")\r\n=> #<Puppet::Node:0x00005582e7152c40 @name="hostname", @classes=[], @parameters={}, @facts=nil, @server_facts={}, @time...\r\nirb(main):007:0> node.environment_name = "www123"\r\n=> "www123"\r\nirb(main):008:0> node.environment_name\r\n=> "www123"\r\nirb(main):009:0> node.environment.name\r\n=> :www123\r\n{noformat}\r\n\r\nThis inconsistency leads to complicated logic where we can never be sure how to retrieve the node"s environment, while trying to be careful to not load the environment from disk:\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/e89bc9f1e0a9365cb7f0e8b105c04c50a7b43395/lib/puppet/configurer.rb#L313-L317', 'https://tickets.puppetlabs.com/browse/PUP-11330', 'https://github.com/puppetlabs/puppet/pull/8842', '2021-10-26T17:45:22.000-0700', '2022-02-22T21:01:40.000-0800', '2022-02-22T21:01:40.000-0800', 'Resolved', 'docs_reviewed;tbd', 1, '0', 1, 8, 12, 3, '905ec6a25d71f34affa1aa445c833b678b27fcbb', 'https://tickets.puppetlabs.com/browse/PUP-11330', 'https://github.com/puppetlabs/puppet/pull/8842'),
('puppet', 395612, 643067266, 8599, 'puppet cannot set/change password of a user resource on Big Sur', 'Similar changes done for osx 10.15: https://github.com/puppetlabs/puppet/commit/688779d43c770598ca72c83e14b555f342252150', 'https://tickets.puppetlabs.com/browse/PUP-11026', 'https://github.com/puppetlabs/puppet/pull/8599', '2021-04-15T06:19:53.000-0700', '2022-02-23T18:44:29.000-0800', '2022-02-23T18:44:29.000-0800', 'Resolved', 'docs-reviewed', 0, '0', 2, 171, 58, 6, 'f4540310480288d4b3bf4a0217633bbe98414528', 'https://tickets.puppetlabs.com/browse/PUP-11026', 'https://github.com/puppetlabs/puppet/pull/8599'),
('puppet', 107312, 874656864, 8890, 'show_diff does not show content changes for new files', 'I searched in jira but did not see a similar issue. \r\nIt was filed in old issue tracker linked here: https://projects.puppetlabs.com/issues/21537\r\n\r\nh2. Overview\r\n\r\nshow_diff does not show diff for files that hasn"t been created\r\n\r\nh2. Example\r\n\r\n    file { "/tmp/hahaha/":\r\n        ensure => present,\r\n        content => "Hello Puppet Labs",\r\n        show_diff => "true",\r\n    }\r\n\r\nh2. Expected behavior\r\n\r\npuppet agent --test --noop will show the diff of the file\r\n\r\nh2. Actual Behaviour\r\n\r\n[root@pe-383-master manifests]# puppet agent --test --noop \r\nInfo: Retrieving pluginfacts\r\nInfo: Retrieving plugin\r\nInfo: Loading facts\r\nInfo: Caching catalog for pe-383-master.puppetdebug.vlan\r\nInfo: Applying configuration version "1448882931"\r\nNotice: /Stage[main]/Main/Node[default]/File[/tmp/hahaha/]/ensure: current_value absent, should be present (noop)\r\nNotice: Node[default]: Would have triggered "refresh" from 1 events\r\nNotice: Class[Main]: Would have triggered "refresh" from 1 events\r\nNotice: Stage[main]: Would have triggered "refresh" from 1 events\r\nNotice: Finished catalog run in 8.09 seconds\r\n\r\nCustomer KPN Supply is facing this problem and is looking for possible workaround, (to see file content before it got apply)', 'https://tickets.puppetlabs.com/browse/PUP-9001', 'https://github.com/puppetlabs/puppet/pull/8890', '2015-11-30T03:29:34.000-0800', '2022-03-08T14:14:42.000-0800', '2022-03-08T14:14:42.000-0800', 'Closed', 'cspapercuts', 2, '0', 1, 43, 13, 3, '', 'https://tickets.puppetlabs.com/browse/PUP-9001', 'https://github.com/puppetlabs/puppet/pull/8890'),
('puppet', 432469, 847972576, 8875, 'Puppet 6.26 and 7.13 may cause specs to fail', 'Commit 78246ca8d08dee770886f0940a6472c45483d627 first released in 6.26.0 and 7.13.0 speeds up rspec tests but breaks puppet-enteprise-modules due to the way {{Facter.reset}} breaks stubbing for a custom fact.\r\n\r\n[https://github.com/puppetlabs/puppet/commit/78246ca8d08dee770886f0940a6472c45483d627]\r\n\r\nThis ticket is to:\r\n\r\n1. Delete the call to {{Facter.reset}} line in [https://github.com/puppetlabs/puppet/blob/4772afa194402a3876069785a178611797a8eb7d/lib/puppet/defaults.rb#L1998]\r\n2. Optional (attempt 1), try adding {{Facter.reset}} to puppet"s [spec_helper.rb|https://github.com/puppetlabs/puppet/blob/4772afa194402a3876069785a178611797a8eb7d/sec/spec_helper.rb]. That way the facter search path is reset across tests, but it"s only triggered when running puppet"s spec tests. But not when a module runs tests and calls puppet as a library.\r\n3. Optional (attempt 2), if attempt 1 doesn"t work, try adding {{Facter.reset}} to puppet"s [test helper|https://github.com/puppetlabs/puppet/blob/4772afa194402a3876069785a178611797a8eb7d/lib/puppet/test/test_helper.rb#L145-L146] This likely has to be done after the call to {{{}Puppet.runtime[:facter]{}}}. Note this code will be invoked by modules that are using puppetlabs_spec_helper.\r\n4. If neither work, just omit the call to Facter.reset entirely.\r\n5. A more complete fix is to understand why this issue affects PE modules, but not a custom module generated via pdk (see comment below).\r\n\r\nTo reproduce the issue:\r\n{code}\r\n$ git clone git@github.com:puppetlabs/puppet_enterprise_modules\r\n$ cd puppet_enterprise_modules\r\n$ git revert f8ec0e5d9234be99b3566034e921d797fb85ea43\r\n$ PUPPET_VERSION="6.26.0" bundle install --without system_tests \r\n$ cd modules/puppet_enterprise\r\n$ PUPPET_VERSION="6.26.0" bundle exec rake spec SPEC=spec/unit/facter/inventory_spec.rb\r\n...\r\nFailures:  \r\n1) inventory facts the inventory and metadata facts when setting the inventory fact wil be populated when enabled\r\n     Failure/Error: expect(Facter.value("_puppet_inventory_1")).not_to be nil\r\n     \r\n       expected not #<NilClass:8> => nil\r\n                got #<NilClass:8> => nil\r\n     \r\n       Compared using equal?, which compares object identity.\r\n     # ./spec/unit/facter/inventory_spec.rb:77:in `block (4 levels) in <top (required)>"  \r\n2) inventory facts the inventory and metadata facts when setting the metadata fact sets enabled to true if enabled\r\n     Failure/Error: expect(Facter.value("puppet_inventory_metadata")["packages"]["collection_enabled"]).to be true\r\n     \r\n       expected true\r\n            got false\r\n     # ./spec/unit/facter/inventory_spec.rb:89:in `block (4 levels) in <top (required)>"Finished in 0.16165 seconds (files took 0.97491 seconds to load)\r\n9 examples, 2 failures\r\nFailed examples:\r\nrspec ./spec/unit/facter/inventory_spec.rb:75 # inventory facts the inventory and metadata facts when setting the inventory fact wil be populated when enabled\r\nrspec ./spec/unit/facter/inventory_spec.rb:87 # inventory facts the inventory and metadata facts when setting the metadata fact sets enabled to true if enabled{code}\r\nBut if then if you downgrade to 6.25.1 it works:\r\n{code}$ PUPPET_VERSION="6.25.1" bundle update\r\n...\r\nUsing puppet 6.25.1 (was 6.26.0)\r\n...\r\n$ PUPPET_VERSION="6.25.1" bundle exec rake spec SPEC=spec/unit/facter/inventory_spec.rb\r\n...\r\nFinished in 0.08799 seconds (files took 0.97687 seconds to load)\r\n9 examples, 0 failures\r\n{code}\r\n\r\nIf you go back to 6.26.0 and comment out the {{Facter.reset}} line in defaults.rb it works:\r\n\r\n{code}\r\n$ PUPPET_VERSION="6.26.0" bundle update\r\n$ vi $(PUPPET_VERSION="6.26.0" bundle exec gem which puppet/defaults.rb)\r\n# comment out the call to "facter.reset" and it should now pass\r\n$ PUPPET_VERSION="6.26.0" bundle exec rake spec SPEC=spec/unit/facter/inventory_spec.rb\r\n{code}', 'https://tickets.puppetlabs.com/browse/PUP-11435', 'https://github.com/puppetlabs/puppet/pull/8875', '2022-01-25T16:57:10.000-0800', '2022-03-15T10:45:53.000-0700', '2022-03-15T10:45:53.000-0700', 'Resolved', 'docs_reviewed', 4, '0', 1, 0, 1, 1, '2811b8b343ee8390d7f20327be804368c430d3fb', 'https://tickets.puppetlabs.com/browse/PUP-11435', 'https://github.com/puppetlabs/puppet/pull/8875'),
('puppet', 433415, 863889278, 8886, 'No option to fail fast when agent-specified environment does not exist', '*Puppet Version:*\r\n*Puppet Server Version:*\r\n*OS Name/Version:*\r\n\r\nDescribe your issue in as much detail as possible…\r\nDescribe steps to reproduce…\r\n\r\n*Desired Behavior:*\r\n\r\n\r\n*Actual Behavior:*\r\n\r\n\r\nPlease take a moment and attach any relevant log output and/or manifests. This will help us immensely when troubleshooting the issue.\r\n\r\nExamples:\r\nRun puppet agent with --test --trace --debug\r\n\r\nRelevant sections of {{/var/log/puppetlabs/puppetserver/puppetserver.log}} or any applicable logs from the same directory.\r\n\r\nFor more detailed information turn up the server logs by upping the log level in the server"s logback.xml\r\n\r\nRelevant sections of configurations files (puppet.conf, hiera.conf, Server"s conf.d, defaults/sysconfig)\r\n\r\nFor memory issues with server heap dumps are also helpful.\r\n', 'https://tickets.puppetlabs.com/browse/PUP-11440', 'https://github.com/puppetlabs/puppet/pull/8886', '2022-01-31T14:18:22.000-0800', '2022-03-15T10:46:12.000-0700', '2022-03-15T10:46:12.000-0700', 'Resolved', 'docs_reviewed', 5, '0', 1, 40, 5, 2, 'bb902a38aa3553b439aa561e36e3151a5896de98', 'https://tickets.puppetlabs.com/browse/PUP-11440', 'https://github.com/puppetlabs/puppet/pull/8886'),
('puppet', 436205, 856410402, 8883, 'Puppet::Util::Windows is undefined on non-Windows platforms', 'The file {{lib/puppet/util/windows.rb}} defines a set of constants that should be available on all platforms, such as {{Puppet::Util::Windows}}, {{Puppet::Util::Windows::Service}} and {{Puppet::Util::Windows::Service::DEFAULT_TIMEOUT}}.\r\n\r\nIt also requires Windows-specific code that is only safe to load on Windows, because the code tries to load native libraries, such as {{user32.dll}}.\r\n\r\nThe problem is when puppet is running on a non-Windows platform, then {{lib/puppet/util/windows.rb}} is never loaded. As a result, trying to test a {{service}} resource using rspec-puppet fails when trying to reference the {{Puppet::Util::Windows}} constant. See PDK-1760 for steps to reproduce.\r\n\r\nA quicker reproduction is:\r\n\r\n{code}\r\n$ bundle exec ruby -e "require "puppet"; puts Puppet::Util::Windows"\r\nTraceback (most recent call last):\r\n-e:1:in `<main>": uninitialized constant Puppet::Util::Windows (NameError)\r\n{code}', 'https://tickets.puppetlabs.com/browse/PUP-11459', 'https://github.com/puppetlabs/puppet/pull/8883', '2022-02-17T20:47:18.000-0800', '2022-03-15T10:46:21.000-0700', '2022-03-15T10:46:21.000-0700', 'Resolved', 'docs_reviewed;jira_escalated', 1, '0', 1, 24, 4, 3, '297c11b0695493a133ace2bd3ce4a0ce21429e5c', 'https://tickets.puppetlabs.com/browse/PUP-11459', 'https://github.com/puppetlabs/puppet/pull/8883'),
('puppet', 432982, 875674883, 8892, 'puppet lookup fails to interpolate topscope variables when an environment is specified', 'A regression introduced in PUP-7479 causes "puppet lookup --environment <env> <key>" to no longer set node parameters as topscope variables. If hiera.yaml is configured to interpolate based on topscope variables, such as "nodes/%\{fqdn}.yaml", then the variable will be interpolated as an empty string.\r\n\r\nGiven a basic setup:\r\n{code}# tree /etc/puppetlabs/code/environments/\r\n/etc/puppetlabs/code/environments/\r\n├── production\r\n└── test\r\n    ├── data\r\n    │   ├── common.yaml\r\n    │   └── iron-judgement.yaml\r\n    └── hiera.yaml\r\n\r\n3 directories, 3 files\r\n# cat /etc/puppetlabs/code/environments/test/hiera.yaml \r\n---\r\nversion: 5\r\nhierarchy:\r\n  - name: "node"\r\n    paths:\r\n      - "%{hostname}.yaml"\r\n  - name: "common"\r\n    paths:\r\n      - "common.yaml"\r\n# cat /etc/puppetlabs/code/environments/test/data/common.yaml \r\n---\r\nfoo: defined in common\r\n# cat /etc/puppetlabs/code/environments/test/data/iron-judgement.yaml \r\n--- {}\r\n{code}\r\nThen a warning is generated trying to resolve the `hostname` variable:\r\n{code}# bundle exec puppet lookup -E test foo --explain\r\nWarning: Undefined variable "hostname"; \r\n   (file & line not available)\r\nSearching for "lookup_options"\r\n  Global Data Provider (hiera configuration version 5)\r\n    No such key: "lookup_options"\r\n  Environment Data Provider (hiera configuration version 5)\r\n    Using configuration "/etc/puppetlabs/code/environments/test/hiera.yaml"\r\n    Merge strategy hash\r\n      Hierarchy entry "node"\r\n        Path "/etc/puppetlabs/code/environments/test/data/.yaml"\r\n          Original path: "%{hostname}.yaml"\r\n          Path not found\r\n      Hierarchy entry "common"\r\n        Path "/etc/puppetlabs/code/environments/test/data/common.yaml"\r\n          Original path: "common.yaml"\r\n          No such key: "lookup_options"\r\n{code}\r\nNote the path "/etc/puppetlabs/code/environments/test/data/.yaml"\r\n\r\nThe issue does not occur when an environment is omitted from the command line or when hiera interpolation uses facts such as "nodes/%\{facts.hostname}.yaml".', 'https://tickets.puppetlabs.com/browse/PUP-11437', 'https://github.com/puppetlabs/puppet/pull/8892', '2022-01-27T16:11:31.000-0800', '2022-03-18T09:00:07.000-0700', '2022-03-18T09:00:07.000-0700', 'Resolved', 'docs_reviewed', 5, '0', 1, 43, 37, 3, '82bda0ebe3ec0828d2fccf2f12b2e99a2370a7df', 'https://tickets.puppetlabs.com/browse/PUP-11437', 'https://github.com/puppetlabs/puppet/pull/8892'),
('puppet', 147729, 83186612, 5241, 'Corrective Change YAML file causes errors when type parameter is a complex type', 'https://jenkins-modules.puppetlabs.com/view/3.%20windows%20only/view/acl/view/acl%20-%20master/job/forge-windows_puppetlabs-acl_intn-sys_smoke-master/PLATFORM=windows-2008r2-64a,WORKER_LABEL=beaker/20/consoleFull\r\n\r\n{code}\r\n\r\nfile { "c:/tmp":\r\n  ensure  => directory,\r\n}\r\n\r\nuser { "bob":\r\n  ensure     => present,\r\n  groups     => "Users",\r\n  managehome => true,\r\n  password   => "L0v3Pupp3t!"\r\n}\r\n\r\nacl { "c:/tmp":\r\n  permissions  => [\r\n    { identity => "bob", perm_type => "allow", rights => ["modify"] },\r\n  ],\r\n}\r\n{code}\r\n\r\nThe permissions property of acl is a hash type. This looks to be killing runs for anyone using acl or another type that has a parameter/property that is a hash type.\r\n\r\nThe contents of the transactionstore.yaml are as so:\r\n\r\n{code}\r\n---\r\nresources:\r\n  File[c:/temp]:\r\n    parameters:\r\n      ensure:\r\n        system_value: :directory\r\n  File[c:/temp/deny_full_rights_dir]:\r\n    parameters:\r\n      ensure:\r\n        system_value: :directory\r\n  User[bob]:\r\n    parameters:\r\n      ensure:\r\n        system_value: :present\r\n      password:\r\n        system_value: L0v3Pupp3t!\r\n      groups:\r\n        system_value: BUILTIN\Users,Users\r\n  Acl[c:/temp/deny_full_rights_dir]:\r\n    parameters:\r\n      permissions:\r\n        system_value:\r\n        - !ruby/hash:Puppet::Type::Acl::Ace {}\r\n      inherit_parent_permissions:\r\n        system_value: :true\r\n{code}\r\n\r\n', 'https://tickets.puppetlabs.com/browse/PUP-6629', 'https://github.com/puppetlabs/puppet/pull/5241', '2016-08-17T15:40:55.000-0700', '2022-03-23T08:45:51.000-0700', '2022-03-23T08:45:51.000-0700', 'Closed', 'regression;windows', 19, '0', 1, 2, 1, 1, '54b3b61e37e77650274747f6bf52ca8d8c402389', 'https://tickets.puppetlabs.com/browse/PUP-6629', 'https://github.com/puppetlabs/puppet/pull/5241'),
('puppet', 226812, 0, 0, 'Puppet::FileSystem::Windows should support LFN', 'As mentioned in PUP-4866 & PUP-6152, there is [support for using long file names|https://msdn.microsoft.com/en-us/library/aa365247(v=vs.85).aspx#maxpath] greater than 260 characters in Windows by using the "\\?\" prefix.\r\n\r\nUnfortunately, this doesn"t quite work with Ruby"s normal file path handling, as it also uses "/" on Windows as the path separator, and this needs to be converted to "\" for the "\\?\" prefix to work. Because of the requirement to translate "/" to "\" on the final file path for the "\\?\" LFN prefix to work, we should probably be putting the LFN support directly in to {{Puppet::FileSystem::Windows}}, and making sure that we are not using the native Ruby file path handling methods (Eg: {{File.expand_path}}, {{File.join}}, etc.) anywhere, and are using the {{Puppet::FileSystem}} versions instead.', 'https://tickets.puppetlabs.com/browse/PUP-8257', '', '2017-12-15T09:59:57.000-0800', '2022-03-31T13:44:00.000-0700', '2022-03-31T13:44:00.000-0700', 'Closed', 'jira_escalated;windows', 5, '0', 0, 0, 0, 0, '8ae474b1291566335d9c6f1ef6600399ac368a48', 'https://tickets.puppetlabs.com/browse/PUP-8257', 'https://github.com/puppetlabs/puppet/commit/8ae474b1291566335d9c6f1ef6600399ac368a48'),
('puppet', 433034, 843303727, 8871, 'An iterable returned by tree_each iterator does not work with reduce ', '_tree_each_ function returns an iterator, which is supposed to chain with _revers_each,_ _filter, map_ and _reduce_ according to the [documentation|https://puppet.com/docs/puppet/7/function.html#tree-each|#tree-each]. In practice one of the chained functions, _reduce_ does not work.\r\n\r\nThe minimal code to reproduce with {_}puppet apply{_}:\r\n{code:java}$tree = {}\r\nnotice $tree.tree_each.reduce({}) |$m, $v| { $m } {code}\r\nThis results in an error:\r\n{code:java}Error: Evaluation Error: Error while evaluating a Method call, undefined method `reduce" for #<Puppet::Pops::Types::Iterable::DepthFirstTreeIterator:0x00005653899c8280>\r\nDid you mean?  rescue (file: /srv/production/site/profile/manifests/test.pp, line: 2, column: 30) on node ruthenium-dev{code}\r\n[~josh] ', 'https://tickets.puppetlabs.com/browse/PUP-11438', 'https://github.com/puppetlabs/puppet/pull/8871', '2022-01-28T09:27:07.000-0800', '2022-04-01T15:01:03.000-0700', '2022-04-01T15:01:03.000-0700', 'Resolved', '', 3, '0', 1, 0, 1, 1, '229a0f918a108028d5585bc838ec6e53c3ee67e6', 'https://tickets.puppetlabs.com/browse/PUP-11438', 'https://github.com/puppetlabs/puppet/pull/8871'),
('puppet', 48712, 20652326, 3043, 'The read_mounts function reads /proc/mounts for every file call and should instead cache.', 'During a puppet run, the read_mounts function in util/selinux is called for each file that it managed on the system.\r\n\r\nAs currently implemented, the system will read /proc/mounts for each file.\r\n\r\nWhile initially being unwanted due to unnecessary file IO, certain systems that use namespacing, such as OpenShift, create potentially thousands of redundant mount entries in /proc/mounts (5500 on one system that I"ve seen).\r\n\r\nThis causes each puppet run to observably crawl to over 30 minutes when normally it runs in 30 seconds.\r\n\r\nI"ve attached a patch that uses a caching mechanism to alleviate this issue.\r\n\r\n*However*, I"m 90% certain that there is some global space where this can be done instead of using a global variable and I"m hoping that someone that knows this off the top of their head can update the code appropriately.', 'https://tickets.puppetlabs.com/browse/PUP-3116', 'https://github.com/puppetlabs/puppet/pull/3043', '2014-08-20T13:38:05.000-0700', '2022-04-01T17:55:05.000-0700', '2022-04-01T17:55:05.000-0700', 'Accepted', 'file;jira_escalated;linux;optimization;platform-os;selinux;type_and_provider', 6, '0', 1, 36, 26, 1, '', 'https://tickets.puppetlabs.com/browse/PUP-3116', 'https://github.com/puppetlabs/puppet/pull/3043'),
('puppet', 81272, 149927526, 6329, 'Yum provider uses rpm -e to uninstall packages', '{code:puppet}\r\nclass gvpbi::install ($ensure) {\r\n\r\n package {"pdi-gvp-bi-core":\r\n    require => Class["gvpbibase"],\r\n    provider => "yum",\r\n    install_options => [ "-d5", "-e5" ],\r\n    ensure  => $ensure,\r\n }\r\n package {"pdi-python2.7-numpy":\r\n    require => Class["gvpbibase"],\r\n    provider => "yum",\r\n    install_options => [ "-d5", "-e5" ],\r\n    ensure  => absent,\r\n    before => Package["pdi-gvp-bi-core"],\r\n }\r\n}\r\n{code}\r\n\r\nbut:\r\n\r\n{noformat}\r\nError: Execution of "/bin/rpm -e pdi-python2.7-numpy-1.8.1-1.x86_64" returned 1: error: Failed dependencies:\r\n	pdi-python2.7-numpy is needed by (installed) pdi-gvp-bi-core-3.1.0-175.ga7bcd2c.noarch\r\nError: /Stage[main]/Gvpbi::Install/Package[pdi-python2.7-numpy]/ensure: change from 1.8.1-1 to absent failed: Execution of "/bin/rpm -e pdi-python2.7-numpy-1.8.1-1.x86_64" returned 1: error: Failed dependencies:\r\n	pdi-python2.7-numpy is needed by (installed) pdi-gvp-bi-core-3.1.0-175.ga7bcd2c.noarch\r\n{noformat}\r\n\r\nbut if I remove the package using yum the dependecies are automatically resolved and unistall the pdi-gvp-bi-core package.', 'https://tickets.puppetlabs.com/browse/PUP-4647', 'https://github.com/puppetlabs/puppet/pull/6329', '2015-05-22T03:24:36.000-0700', '2022-04-11T03:31:06.000-0700', '2022-04-11T03:31:06.000-0700', 'Closed', 'package;type_and_provider', 9, '0', 1, 20, 1, 1, '', 'https://tickets.puppetlabs.com/browse/PUP-4647', 'https://github.com/puppetlabs/puppet/pull/6329'),
('puppet', 429291, 897917841, 8899, 'Puppet Agent does not automatically refresh CRLs on crl_refresh_interval', 'We have setup our puppet server"s with a SubCA issued from our internal root. We have also setup a script to automatically load the Root CRLs into the PuppetServer CRL using the "puppet-ca/v1/certificate_revocation_list" API endpoint. Finally, we have set crl_refresh_interval = 1d in puppet.conf on all of our agents.\r\n\r\nHowever, the behavior we are seeing is that the CRL is only refreshed when puppet is manually run (eg. using puppet agent --test from a root shell) or if the existing CRL is >1d old the first time puppet runs after the service is restarted. If the puppet agent is just left running (automatic runs every 30 minutes) the CRL is never refreshed and eventually expires.', 'https://tickets.puppetlabs.com/browse/PUP-11428', 'https://github.com/puppetlabs/puppet/pull/8899', '2022-01-11T07:50:06.000-0800', '2022-04-20T09:39:22.000-0700', '2022-04-20T09:39:22.000-0700', 'Closed', '', 4, '0', 10, 283, 81, 14, 'dae6a925c110886ec1e2b76d64bfe66e149edeb3', 'https://tickets.puppetlabs.com/browse/PUP-11428', 'https://github.com/puppetlabs/puppet/pull/8899'),
('puppet', 438698, 878541287, 8895, 'Yum Provider Does Not Properly Update Package Using Version Range and Install Options', '*Puppet Version:* 7.14.0\r\n*Puppet Server Version:* N/A\r\n*OS Name/Version:* CentOS 7\r\n\r\nThe yum provider does not appear to pass in the install_options (disablerepo, enablerepo, disableexcludes) when listing available packages if a version range is specified\r\n\r\nhttps://github.com/puppetlabs/puppet/blob/7.14.0/lib/puppet/provider/package/yum.rb#L228-L231\r\n\r\n\r\n\r\nWe have a custom / internal repo which has excludes enabled so packages are not updated during normal patching, but use install options to ensure the package is present during initial configurations, and would like to be able to use the version ranges to specify a minimum version to upgrade to when code is changed as well.\r\n\r\n*Desired Behavior:* The provider properly appends the install_options to the yum list command like it does with update and other commands currently\r\n\r\ni.e.\r\n{code:java}\r\n// Pseudo Example\r\nyumrepo { "myrepofile":\r\n  ensure  => present,    \r\n  name    => "myrepofile",\r\n  descr   => "myrepofile",\r\n  baseurl => "https://my.repo.file",\r\n  enabled => "1",\r\n  exclude => "mypackage*",\r\n}\r\n\r\npackage { "mypackage":\r\n  ensure          => ">=1.2.3",\r\n  install_options => [     \r\n    {\r\n      "--disableexcludes" => "myrepofile"\r\n    },\r\n  ],\r\n}{code}\r\n \r\n{code:java}\r\n/usr/bin/yum list <package> --showduplicates --disableexcludes=<repo> | sed -e "1,/Available Packages/ d" | awk "{print $2}"{code}\r\nSample of where this is currently done during check-update: https://github.com/puppetlabs/puppet/blob/7.14.0/lib/puppet/provider/package/yum.rb#L109-L115\r\n\r\n \r\n\r\n*Actual Behavior:* \r\n\r\nAvailable versions are listed without {_}disablerepo{_}, {_}enablerepo{_}, _disableexcludes_ from _install_options_ that are necessary to properly list all available updates.\r\n\r\n \r\n{code:java}\r\n/usr/bin/yum list <package> --showduplicates | sed -e "1,/Available Packages/ d" | awk "{print $2}"{code}\r\nResulting in no available packages from _myrepofile_ because it is excluded by default\r\n\r\n ', 'https://tickets.puppetlabs.com/browse/PUP-11475', 'https://github.com/puppetlabs/puppet/pull/8895', '2022-03-08T11:15:25.000-0800', '2022-04-25T14:56:51.000-0700', '2022-04-25T14:56:51.000-0700', 'Closed', '', 4, '0', 1, 8, 3, 1, '73c645194674a619e82d916249738d8f97365ce0', 'https://tickets.puppetlabs.com/browse/PUP-11475', 'https://github.com/puppetlabs/puppet/pull/8895'),
('puppet', 102362, 876471541, 8893, 'systemd: Puppet agent starts before network-online.target is reached', 'On Ubuntu 15.04 the puppet agent starts with multi-user.target.\r\nDue to this if using NetworkManager with DHCP, the agent tries to apply configuration before network connection is up resulting in printing several errors to the logs.\r\n\r\nChanging the puppet.service file and moving the symlink from /etc/systemd/system/multi-user.target.wants/puppet.service to /etc/systemd/system/network-online.target.wants/puppet.service is fixing the problem.\r\n\r\nContent of edited puppet.service file:\r\n\r\n{code:java}\r\n[Unit]\r\nDescription=Puppet agent\r\nWants=network-online.target\r\nAfter=network-online.target\r\n\r\n[Service]\r\nType=forking\r\nPIDFile=/run/puppet/agent.pid\r\nExecStart=/usr/bin/puppet agent\r\n\r\n[Install]\r\nWantedBy=network-online.target\r\n{code}\r\n', 'https://tickets.puppetlabs.com/browse/PUP-5402', 'https://github.com/puppetlabs/puppet/pull/8893', '2015-10-21T02:07:51.000-0700', '2022-04-26T12:15:35.000-0700', '2022-04-26T12:15:35.000-0700', 'Resolved', 'daemon;packaging;platform-os;systemd', 10, '0', 1, 1, 1, 1, '1d65d0780ec87a1f66d4e1a92669299d1ea01f62', 'https://tickets.puppetlabs.com/browse/PUP-5402', 'https://github.com/puppetlabs/puppet/pull/8893'),
('puppet', 434835, 904260363, 8900, 'Cannot login under user created by Puppet on MacOS 12.1', 'I create a new user using code example from  stdlib docs\r\n{code}$pw = Sensitive.new("Pa55w0rd")\r\n$salt = Sensitive.new("Using s0m3 s@lt")\r\n$pw_info = Sensitive.new(str2saltedpbkdf2($pw, $salt, 50000))\r\nuser { "jdoe":\r\n  ensure     => present,\r\n  iterations => unwrap($pw_info)["iterations"],\r\n  password   => unwrap($pw_info)["password_hex"],\r\n  salt       => unwrap($pw_info)["salt_hex"],\r\n}\r\n{code}\r\nEverything applies with no error, but I can"t login until I change password via system preferences. \r\nSystem:\r\n{code} uname -prsv\r\nDarwin 21.2.0 Darwin Kernel Version 21.2.0: Sun Nov 28 20:28:54 PST 2021; root:xnu-8019.61.5~1/RELEASE_X86_64 i386\r\n{code}\r\nPuppet:\r\n{code}puppet --version\r\n7.14.0\r\n{code}', 'https://tickets.puppetlabs.com/browse/PUP-11454', 'https://github.com/puppetlabs/puppet/pull/8900', '2022-02-10T03:52:00.000-0800', '2022-04-26T19:07:26.000-0700', '2022-04-26T19:07:26.000-0700', 'Resolved', '', 2, '0', 1, 10, 2, 3, 'a58001af8a4cee1d6a6c42e490214aeb5fcae2b6', 'https://tickets.puppetlabs.com/browse/PUP-11454', 'https://github.com/puppetlabs/puppet/pull/8900'),
('puppet', 434448, 844033844, 8872, 'puppetserver_gem doesn"t install gems when they are loaded by facter', 'The {{puppetserver_gem}} package provider fails to list the correct gem list in puppetserver when there is a gem installed with `puppet_gem` and added by a `require` during the agent run or apply. In this scenario, the gem is listed as already installed by the {{puppetserver_gem}} provider when it is not installed in the puppetserver gem space.\r\n\r\n*Logs*\r\nThe gem is only installed into the puppet gem space\r\n{code}# puppetserver gem list aws-sdk-s3\r\n\r\n*** LOCAL GEMS ***\r\n\r\n# /opt/puppetlabs/puppet/bin/gem list aws-sdk-s3\r\n\r\n*** LOCAL GEMS ***\r\n\r\naws-sdk-s3 (1.112.0)\r\n{code}\r\nRunning the agent or apply shows the gem is prefetched in the {{puppetserver_gem}} provider\r\n{code}# puppet apply install.pp --debug |& grep aws-sdk-s3\r\nDebug: /Package[aws-sdk-s3]: Provider puppetserver_gem does not support features targetable; not managing attribute command\r\nDebug: /Package[aws-sdk-s3]: Provider puppetserver_gem does not support features install_only; not managing attribute install_only\r\nDebug: /Package[aws-sdk-s3]: Provider puppetserver_gem does not support features virtual_packages; not managing attribute allow_virtual\r\nDebug: Puppet::Type::Package::ProviderPuppetserver_gem: Prefetched instance: aws-sdk-s3 via command: default\r\n{code}\r\n*Reproduction*\r\n1) On a 7.x Puppetserver - PE 2021.4.0 in this example\r\n2) Install the gem using the `puppet_gem` provider: {{puppet resource package aws-sdk-s3 ensure=installed provider=puppet_gem}}\r\n3) Add the following fact into the environment and ensure it is downloaded with {{puppet plugin download}}\r\n{code}Facter.add(:testing) do\r\n  setcode do\r\n    require "aws-sdk-s3"\r\n    Aws::S3::GEM_VERSION\r\n  end\r\nend\r\n{code}\r\n4) Apply the following manifest to observe that the {{puppetserver_gem}} package is not installed\r\n{code} package{"aws-sdk-s3":\r\n  ensure => installed,\r\n  provider => puppetserver_gem\r\n}\r\n{code}\r\n*Potential Fix*\r\nThis looks to be an issue due to the {{puppetserver_gem}} not forking the gem list command, so the [loaded gems are listed in these lines|https://github.com/puppetlabs/puppet/blob/main/lib/puppet/provider/package/puppetserver_gem.rb#L162-L170].\r\n\r\nIf I replace those lines with one that uses the {{/opt/puppetlabs/puppet/bin/gem}} command, the issue no longer appears. For example:\r\n{code}output = execute_gem_command(Puppet::Type::Package::ProviderPuppet_gem.provider_command, ["list","--local"], gem_env)\r\ngem_list = output.lines.reject { |gem| gem =~ / \(default\: / }\r\n{code}\r\nThere is a significant difference in the number of gems listed between the two outputs.\r\n{code}# The current implementation\r\n> sio_out.string.lines.reject { |gem| gem =~ / \(default\: / }.length\r\n=> 56\r\n# Shelling out to `gem`\r\n> output.lines.reject { |gem| gem =~ / \(default\: / }.length\r\n=> 25\r\n{code}\r\nThis aligns with the `puppetserver gem list` and `gem list` commands.\r\n{code}# /opt/puppetlabs/puppet/bin/gem list |grep -v default | wc -l56# puppetserver gem list |grep -v default | wc -l\r\n25\r\n{code}', 'https://tickets.puppetlabs.com/browse/PUP-11452', 'https://github.com/puppetlabs/puppet/pull/8872', '2022-02-07T07:31:09.000-0800', '2022-04-26T19:08:57.000-0700', '2022-04-26T19:08:57.000-0700', 'Closed', 'jira_escalated', 2, '0', 1, 9, 18, 2, 'ea8a34f22bb29d770e494024ac5f996bd9c60727', 'https://tickets.puppetlabs.com/browse/PUP-11452', 'https://github.com/puppetlabs/puppet/pull/8872'),
('puppet', 283213, 238138702, 7285, 'Raise Error when a legacy function illegally defines methods', 'When a 3.x function .rb file contains calls to `def` they will end up in a place where they are not supposed to be. It is illegal to have such definitions (they used to work in 3.x because they ended up being methods on {{Object}} (i.e. it polluted every class in Ruby which is obviously horrible and unwanted).\r\n\r\nFrom 6.0.0, legacy functions are loaded by a new loader and it should catch these illegal definitions and raise an error instead of causing other hard to understand errors. (Currently the methods are defined, but in a place where the legacy function later cannot find and call them).\r\n\r\nIn the rare case that 3.x functions with illegal constructs are used in such a way that the illegal constructs are only loaded but never called users that want to prevent errors from being raised by the new check can set {{-\-func3x_check}} to {{false}}.', 'https://tickets.puppetlabs.com/browse/PUP-9294', 'https://github.com/puppetlabs/puppet/pull/7285', '2018-10-31T07:55:07.000-0700', '2022-04-27T09:25:11.000-0700', '2022-04-27T09:25:11.000-0700', 'Closed', 'resolved-issue-added', 11, '0', 3, 189, 7, 8, '1e864906aa3d71853e0a19450c4c8c0f71afb315', 'https://tickets.puppetlabs.com/browse/PUP-9294', 'https://github.com/puppetlabs/puppet/pull/7285'),
('puppet', 102767, 268831243, 7477, 'Compile catalogs on demand with user-specified facts', 'puppetserver currently lacks the equivalent of `puppet master --compile <node>`, which can make debugging difficult, particularly when `puppet master --compile` gives you a catalog in a few seconds but `puppet agent --test` hangs until the configtimeout is reached.', 'https://tickets.puppetlabs.com/browse/PUP-9055', 'https://github.com/puppetlabs/puppet/pull/7477', '2015-10-23T12:45:15.000-0700', '2022-05-10T08:51:00.000-0700', '2022-05-10T08:51:00.000-0700', 'Resolved', 'resolved-issue-added', 25, '0', 1, 19, 0, 1, '94b189dd3b430a844635a97a5dffac9b01ebbce6', 'https://tickets.puppetlabs.com/browse/PUP-9055', 'https://github.com/puppetlabs/puppet/pull/7477'),
('puppet', 437580, 867270549, 8888, 'Legacy function error does not include the source ref', '*Puppet Version:* main\r\n\r\n*Desired Behavior:*\r\n\r\nLegacy function errors should include the source path. For example, if you have a 3x function in module, like "$codedir/environments/production/modules/sample/lib/puppet/parser/functions/sample.rb" containing:\r\n\r\n{code:ruby}\r\nmodule Puppet::Parser::Functions\r\n  newfunction(:sample, :type => :rvalue, :doc => <<-EOS\r\n    A function using the 3x API\r\n  EOS\r\n  ) do |arguments|\r\n    "the returned value"\r\n  end\r\n\r\n  def method_here_is_illegal()\r\n  end\r\nend\r\n{code}\r\n\r\nThen puppet should return the filename where the legacy function is defined. See PUP-9294 and https://puppet.com/docs/puppet/5.5/functions_legacy.html for information about legacy (3x) function errors.\r\n\r\nFor example, the following should indicate the path and line number of the legacy function:\r\n\r\n{noformat}\r\n$ bundle exec puppet apply -e "notice(sample(""))"\r\n{noformat}\r\n\r\n*Actual Behavior:*\r\n\r\nNo source path is included, e.g.\r\n\r\n{noformat}\r\nruby_legacy_function_instantiator.rb:97:in `walk": Illegal method definition of method "initialize" on line 8 in legacy function. See https://puppet.com/docs/puppet/latest/functions_refactor_legacy.html for more information (SecurityError)\r\n{noformat}', 'https://tickets.puppetlabs.com/browse/PUP-11472', 'https://github.com/puppetlabs/puppet/pull/8888', '2022-02-28T15:17:45.000-0800', '2022-05-10T09:18:10.000-0700', '2022-05-10T09:18:10.000-0700', 'Resolved', '', 2, '0', 1, 8, 7, 2, '36c916f644b343bf9738b283c9875833b3b0020b', 'https://tickets.puppetlabs.com/browse/PUP-11472', 'https://github.com/puppetlabs/puppet/pull/8888'),
('puppet', 447479, 932444763, 8910, 'Sub-directory names returned as task names when listing tasks from a module', '*Puppet Version: 7*\r\n*Puppet Server Version: 7*\r\n*OS Name/Version: any*\r\n\r\nWhen querying puppetserver for a list of tasks, if a module has a sub-directory in its "tasks" directory, this sub-directory name is incorrectly returned as an available task of the module.\r\n\r\n*Desired Behavior:* The API should only return the actual tasks names{*}{*}{*}{*}\r\n\r\n*Actual Behavior:*\r\n\r\nCreate a sub-directory in the tasks directory of a module ({{{}mkdir /etc/puppetlabs/code/environments/production/site-modules/profile/tasks/foo/{}}}) and query using the API endpoint {{GET /puppet/v3/tasks?environment=production}}\r\n\r\nA _profile::foo_ task is incorrectly listed', 'https://tickets.puppetlabs.com/browse/PUP-11539', 'https://github.com/puppetlabs/puppet/pull/8910', '2022-05-11T01:42:36.000-0700', '2022-05-11T02:12:19.000-0700', '2022-05-11T02:12:19.000-0700', 'Open', '', 0, '0', 1, 61, 14, 2, '', 'https://tickets.puppetlabs.com/browse/PUP-11539', 'https://github.com/puppetlabs/puppet/pull/8910'),
('puppet', 444827, 927243996, 8908, 'Allow Puppet::HTTP::Client to connect to a server requiring client cert authentication and whose server cert is issued by a CA in the "ssl_trust_store"', '*Puppet Version:* 6.27.0 and 7.16.0\r\n*Puppet Server Version:* N/A\r\n*OS Name/Version:* Any\r\n\r\nPUP-11471 enabled using the system CA store when using HTTP::Client, however, it did not enable users to use the "ssl_trust_store" Puppet.conf option with client SSL authentication. After PUP-11471 a user can use "create_context" or "load_context" to use client based authentication with "include_system_store: true" to load the trusted CA certificates from "/opt/puppetlabs/puppet/ssl/certs/" and "/opt/puppetlabs/puppet/ssl/cert.pem". It does not enable a user to use "create_context" or "load_context" to use client based authentication with "include_system_store: true" to load the trusted CA certificates from the "ssl_trust_store" Puppet.conf option. \r\n\r\nThe "ssl_trust_store" Puppet.conf option removes the requirement of using "c_rehash" or appending the CA bundle to "/opt/puppetlabs/puppet/ssl/cert.pem", which is overwritten on any agent upgrade. \r\n\r\nWhen "include_system_store: true" is passed, "create_context" should load "Puppet[:ssl_trust_store]" the same way that "create_system_context` does here: https://github.com/puppetlabs/puppet/blob/d894861565aa95bd6f4f1cb85fe44ab62cc37854/lib/puppet/ssl/ssl_provider.rb#L73-L89 \r\n\r\n\r\n\r\n*Desired Behavior:*\r\n\r\n"create_context" should load the certificates from "Puppet[:ssl_trust_store]" with "include_system_store: true".\r\n\r\n*Actual Behavior:*\r\nThere is no way to load the certificates from "Puppet[:ssl_trust_store]" with "create_context".\r\n\r\nUsing the system context is not an option in this scenario as it does not use the client certificates for authentication.\r\n\r\nExamples:\r\n\r\nWe would expect the following to use client certificates and load the certificate bundles defined in "Puppet[:ssl_trust_store]".  It does not work unless the CA certificate is loaded into {{/opt/puppetlabs/puppet/ssl/certs/}} and {{/opt/puppetlabs/puppet/bin/c_rehash}} is run.\r\n\r\n{code}\r\nurl = "https://example.com/file.tar.gz" # server trusted by system trust store, and demanding a client certificate signed by the puppet CA\r\nclient = Puppet.runtime[:http]\r\nprovider = Puppet::SSL::SSLProvider.new\r\nssl_context = provider.load_context(revocation: false, include_system_store: true)\r\nclient.get(URI(url), options: { ssl_context: ssl_context }) do |response|\r\n  raise "Failed to download artifact" unless response.success?\r\n\r\n  response.read_body { |data| do_something(data) }\r\nend\r\n{code}', 'https://tickets.puppetlabs.com/browse/PUP-11522', 'https://github.com/puppetlabs/puppet/pull/8908', '2022-04-26T11:12:23.000-0700', '2022-05-11T08:46:14.000-0700', '2022-05-11T08:46:14.000-0700', 'Ready for Merge', 'jira_escalated', 4, '0', 6, 148, 25, 5, '71b887be0fb1465d374e5d4688402f153333ce25', 'https://tickets.puppetlabs.com/browse/PUP-11522', 'https://github.com/puppetlabs/puppet/pull/8908'),
('puppet', 443524, 0, 0, 'macOS agents fails to retrieve password hash - old bug  still there', '*Puppet Version: 7.14.0*\r\n*Puppet Server Version: 7.6.1*\r\n*OS Name/Version: MacOS 12.3.1*\r\n\r\n*Puppet user provider fails - see also PUP-8330*\r\n\r\n*Desired Behavior:*\r\n\r\nNo error\r\n\r\n*Actual Behavior:*\r\n\r\n*Errors*\r\n\r\nCreating a local user appears to work on some instances of MacOS but at least one agent fails with:\r\n\r\nCould not prefetch user provider "directoryservice": undefined method `unpack" for nil:NilClass\r\n\r\nThis is similar to the error reported in PUP-8330 but a password change does not fix it.\r\n\r\n{{# puppet resource user pacscan --trace --debug }}\r\n{{Debug: Runtime environment: puppet_version=7.14.0, ruby_version=2.7.5, run_mode=user, default_encoding=US-ASCII}}\r\n{{Debug: Evicting cache entry for environment :production}}\r\n{{Debug: Deleted text domain :production: false}}\r\n{{Debug: Caching environment :production (ttl = 0 sec)}}\r\n{{Debug: Evicting cache entry for environment :production}}\r\n{{Debug: Deleted text domain :production: false}}\r\n{{Debug: Facter: Resolving facts sequentially}}\r\n{{Debug: Facter: resolving fact with user_query: operatingsystem}}\r\n{{Debug: Facter: Searching fact: operatingsystem in file: operatingsystem.rb}}\r\n{{Debug: Facter: Searching fact: operatingsystem in core facts and external facts}}\r\n{{Debug: Facter: Loading all internal facts}}\r\n{{Debug: Facter: List of resolvable facts: [#<Facter::SearchedFact:0x00007f97428120a0 @name="operatingsystem", @fact_class=Facts::Macosx::Os::Name, @user_query="operatingsystem", @type=:legacy, @file=nil>]}}\r\n{{Debug: Facter: Executing command: uname -m &&}}\r\n{{           uname -n &&}}\r\n{{           uname -p &&}}\r\n{{           uname -r &&}}\r\n{{           uname -s &&}}\r\n{{           uname -v}}\r\n{{Debug: Facter: Loading external facts}}\r\n{{Debug: Facter: fact "operatingsystem" has resolved to: Darwin}}\r\n{{Debug: Facter: resolving fact with user_query: operatingsystem}}\r\n{{Debug: Facter: Searching fact: operatingsystem in file: operatingsystem.rb}}\r\n{{Debug: Facter: Searching fact: operatingsystem in core facts and external facts}}\r\n{{Debug: Facter: Loading all internal facts}}\r\n{{Debug: Facter: List of resolvable facts: [#<Facter::SearchedFact:0x00007f979718c8e8 @name="operatingsystem", @fact_class=Facts::Macosx::Os::Name, @user_query="operatingsystem", @type=:legacy, @file=nil>]}}\r\n{{Debug: Facter: Loading external facts}}\r\n{{Debug: Facter: fact "operatingsystem" has resolved to: Darwin}}\r\n{{Debug: Facter: resolving fact with user_query: operatingsystem}}\r\n{{Debug: Facter: Searching fact: operatingsystem in file: operatingsystem.rb}}\r\n{{Debug: Facter: Searching fact: operatingsystem in core facts and external facts}}\r\n{{Debug: Facter: Loading all internal facts}}\r\n{{Debug: Facter: List of resolvable facts: [#<Facter::SearchedFact:0x00007f9792abe6a0 @name="operatingsystem", @fact_class=Facts::Macosx::Os::Name, @user_query="operatingsystem", @type=:legacy, @file=nil>]}}\r\n{{Debug: Facter: Loading external facts}}\r\n{{Debug: Facter: fact "operatingsystem" has resolved to: Darwin}}\r\n{{Debug: Puppet::Type::User::ProviderUseradd: file useradd does not exist}}\r\n{{Debug: Facter: resolving fact with user_query: operatingsystem}}\r\n{{Debug: Facter: Searching fact: operatingsystem in file: operatingsystem.rb}}\r\n{{Debug: Facter: Searching fact: operatingsystem in core facts and external facts}}\r\n{{Debug: Facter: Loading all internal facts}}\r\n{{Debug: Facter: List of resolvable facts: [#<Facter::SearchedFact:0x00007f9782149aa8 @name="operatingsystem", @fact_class=Facts::Macosx::Os::Name, @user_query="operatingsystem", @type=:legacy, @file=nil>]}}\r\n{{Debug: Facter: Loading external facts}}\r\n{{Debug: Facter: fact "operatingsystem" has resolved to: Darwin}}\r\n{{Debug: Puppet::Type::User::ProviderPw: file pw does not exist}}\r\n{{Debug: Facter: resolving fact with user_query: operatingsystem}}\r\n{{Debug: Facter: Searching fact: operatingsystem in file: operatingsystem.rb}}\r\n{{Debug: Facter: Searching fact: operatingsystem in core facts and external facts}}\r\n{{Debug: Facter: Loading all internal facts}}\r\n{{Debug: Facter: List of resolvable facts: [#<Facter::SearchedFact:0x00007f978213b4d0 @name="operatingsystem", @fact_class=Facts::Macosx::Os::Name, @user_query="operatingsystem", @type=:legacy, @file=nil>]}}\r\n{{Debug: Facter: Loading external facts}}\r\n{{Debug: Facter: fact "operatingsystem" has resolved to: Darwin}}\r\n{{Debug: Puppet::Type::User::ProviderUser_role_add: file useradd does not exist}}\r\n{{Debug: Could not find library "ldap" required to enable feature "ldap"}}\r\n{{Debug: Puppet::Type::User::ProviderLdap: feature ldap is missing}}\r\n{{Debug: Puppet::Type::User::ProviderOpenbsd: file useradd does not exist}}\r\n{{Debug: Facter: resolving fact with user_query: operatingsystem}}\r\n{{Debug: Facter: Searching fact: operatingsystem in file: operatingsystem.rb}}\r\n{{Debug: Facter: Searching fact: operatingsystem in core facts and external facts}}\r\n{{Debug: Facter: Loading all internal facts}}\r\n{{Debug: Facter: List of resolvable facts: [#<Facter::SearchedFact:0x00007f97961814d0 @name="operatingsystem", @fact_class=Facts::Macosx::Os::Name, @user_query="operatingsystem", @type=:legacy, @file=nil>]}}\r\n{{Debug: Facter: Loading external facts}}\r\n{{Debug: Facter: fact "operatingsystem" has resolved to: Darwin}}\r\n{{Debug: Facter: resolving fact with user_query: operatingsystem}}\r\n{{Debug: Facter: Searching fact: operatingsystem in file: operatingsystem.rb}}\r\n{{Debug: Facter: Searching fact: operatingsystem in core facts and external facts}}\r\n{{Debug: Facter: Loading all internal facts}}\r\n{{Debug: Facter: List of resolvable facts: [#<Facter::SearchedFact:0x00007f9782121e90 @name="operatingsystem", @fact_class=Facts::Macosx::Os::Name, @user_query="operatingsystem", @type=:legacy, @file=nil>]}}\r\n{{Debug: Facter: Loading external facts}}\r\n{{Debug: Facter: fact "operatingsystem" has resolved to: Darwin}}\r\n{{Debug: Facter: resolving fact with user_query: operatingsystem}}\r\n{{Debug: Facter: Searching fact: operatingsystem in file: operatingsystem.rb}}\r\n{{Debug: Facter: Searching fact: operatingsystem in core facts and external facts}}\r\n{{Debug: Facter: Loading all internal facts}}\r\n{{Debug: Facter: List of resolvable facts: [#<Facter::SearchedFact:0x00007f979213e508 @name="operatingsystem", @fact_class=Facts::Macosx::Os::Name, @user_query="operatingsystem", @type=:legacy, @file=nil>]}}\r\n{{Debug: Facter: Loading external facts}}\r\n{{Debug: Facter: fact "operatingsystem" has resolved to: Darwin}}\r\n{{Debug: Facter: resolving fact with user_query: operatingsystem}}\r\n{{Debug: Facter: Searching fact: operatingsystem in file: operatingsystem.rb}}\r\n{{Debug: Facter: Searching fact: operatingsystem in core facts and external facts}}\r\n{{Debug: Facter: Loading all internal facts}}\r\n{{Debug: Facter: List of resolvable facts: [#<Facter::SearchedFact:0x00007f9795925f70 @name="operatingsystem", @fact_class=Facts::Macosx::Os::Name, @user_query="operatingsystem", @type=:legacy, @file=nil>]}}\r\n{{Debug: Facter: Loading external facts}}\r\n{{Debug: Facter: fact "operatingsystem" has resolved to: Darwin}}\r\n{{Debug: Facter: resolving fact with user_query: operatingsystem}}\r\n{{Debug: Facter: Searching fact: operatingsystem in file: operatingsystem.rb}}\r\n{{Debug: Facter: Searching fact: operatingsystem in core facts and external facts}}\r\n{{Debug: Facter: Loading all internal facts}}\r\n{{Debug: Facter: List of resolvable facts: [#<Facter::SearchedFact:0x00007f97820f1ba0 @name="operatingsystem", @fact_class=Facts::Macosx::Os::Name, @user_query="operatingsystem", @type=:legacy, @file=nil>]}}\r\n{{Debug: Facter: Loading external facts}}\r\n{{Debug: Facter: fact "operatingsystem" has resolved to: Darwin}}\r\n{{Debug: Puppet::Type::User::ProviderUseradd: file useradd does not exist}}\r\n{{Debug: Facter: resolving fact with user_query: operatingsystem}}\r\n{{Debug: Facter: Searching fact: operatingsystem in file: operatingsystem.rb}}\r\n{{Debug: Facter: Searching fact: operatingsystem in core facts and external facts}}\r\n{{Debug: Facter: Loading all internal facts}}\r\n{{Debug: Facter: List of resolvable facts: [#<Facter::SearchedFact:0x00007f97958a8868 @name="operatingsystem", @fact_class=Facts::Macosx::Os::Name, @user_query="operatingsystem", @type=:legacy, @file=nil>]}}\r\n{{Debug: Facter: Loading external facts}}\r\n{{Debug: Facter: fact "operatingsystem" has resolved to: Darwin}}\r\n{{Debug: Puppet::Type::User::ProviderPw: file pw does not exist}}\r\n{{Debug: Facter: resolving fact with user_query: operatingsystem}}\r\n{{Debug: Facter: Searching fact: operatingsystem in file: operatingsystem.rb}}\r\n{{Debug: Facter: Searching fact: operatingsystem in core facts and external facts}}\r\n{{Debug: Facter: Loading all internal facts}}\r\n{{Debug: Facter: List of resolvable facts: [#<Facter::SearchedFact:0x00007f97969273b0 @name="operatingsystem", @fact_class=Facts::Macosx::Os::Name, @user_query="operatingsystem", @type=:legacy, @file=nil>]}}\r\n{{Debug: Facter: Loading external facts}}\r\n{{Debug: Facter: fact "operatingsystem" has resolved to: Darwin}}\r\n{{Debug: Puppet::Type::User::ProviderUser_role_add: file useradd does not exist}}\r\n{{Debug: Puppet::Type::User::ProviderLdap: feature ldap is missing}}\r\n{{Debug: Puppet::Type::User::ProviderOpenbsd: file useradd does not exist}}\r\n{{Debug: Executing: "/usr/bin/dscl -plist . readall /Users"}}\r\n{{Debug: Executing: "/usr/bin/dscl -plist . readall /Groups"}}\r\n{{Debug: Converting binary plist to hash}}\r\n{{Debug: Converting binary plist to hash}}\r\n{{Debug: Converting binary plist to hash}}\r\n{{Error: Could not run: undefined method `unpack" for nil:NilClass}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/user/directoryservice.rb:211:in `get_salted_sha512_pbkdf2"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/user/directoryservice.rb:151:in `generate_attribute_hash"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/user/directoryservice.rb:88:in `block in instances"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/user/directoryservice.rb:87:in `collect"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/provider/user/directoryservice.rb:87:in `instances"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:1186:in `block in instances"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:1185:in `collect"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/type.rb:1185:in `instances"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/resource/ral.rb:14:in `find"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/indirector/indirection.rb:223:in `find"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/resource.rb:231:in `block in find_or_save_resources"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:62:in `override"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:302:in `override"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/resource.rb:228:in `find_or_save_resources"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/resource.rb:147:in `block in main"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/context.rb:62:in `override"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet.rb:302:in `override"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application/resource.rb:142:in `main"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:437:in `run_command"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:421:in `block in run"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util.rb:744:in `exit_on_fail"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/application.rb:421:in `run"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:143:in `run"}}\r\n{{/opt/puppetlabs/puppet/lib/ruby/vendor_ruby/puppet/util/command_line.rb:77:in `execute"}}\r\n{{/opt/puppetlabs/puppet/bin/puppet:5:in `<main>"}}', 'https://tickets.puppetlabs.com/browse/PUP-11507', '', '2022-04-13T07:25:04.000-0700', '2022-05-11T08:46:20.000-0700', '2022-05-11T08:46:20.000-0700', 'In Progress', '', 1, '0', 0, 0, 0, 0, 'b49066160a9f8da05360df4fa9b588a4f5931626', 'https://tickets.puppetlabs.com/browse/PUP-11507', 'https://github.com/puppetlabs/puppet/commit/b49066160a9f8da05360df4fa9b588a4f5931626');
