When state.highstate is run for the first time on a machine the custom grains file is not synced and evaluated before the jinja templating of the top.sls file. This means obviously that custom grains cannot be used in the top.sls with consistent results.
